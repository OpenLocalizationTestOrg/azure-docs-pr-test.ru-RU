---
title: "Импорт и экспорт файла зоны домена в Azure DNS с помощью Azure CLI 1.0 | Документы Майкрософт"
description: "Узнайте, как импортировать файл зоны DNS в Azure DNS и экспортировать его оттуда с помощью интерфейса командной строки Azure CLI 1.0."
services: dns
documentationcenter: na
author: georgewallace
manager: timlt
ms.assetid: f5797782-3005-4663-a488-ac0089809010
ms.service: dns
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/16/2016
ms.author: gwallace
ms.openlocfilehash: d6d3fa7aa0e8b2462b3a6b4b66d3d87ab5535314
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="import-and-export-a-dns-zone-file-using-the-azure-cli-10"></a>Импорт и экспорт файла зоны DNS с помощью Azure CLI 1.0 

В этой статье приводятся пошаговые инструкции по импорту и экспорту файлов зоны DNS для Azure DNS с помощью Azure CLI 1.0.

## <a name="introduction-to-dns-zone-migration"></a>Общие сведения о миграции зоны DNS

Файл зоны DNS — текстовый файл, содержащий сведения о каждой записи службы доменных имен (DNS) в зоне. Он соответствует стандартному формату и позволяет передавать записи DNS в системы DNS. Использование файла зоны — это быстрый, надежный и удобный способ передачи зоны DNS в Azure DNS или в обратном направлении.

Azure DNS поддерживает импорт и экспорт файлов зоны с помощью интерфейса командной строки Azure (CLI). Импорт файла зоны с помощью Azure PowerShell или портала Azure в настоящее время **не** поддерживается.

Azure CLI 1.0 — это кроссплатформенная программа командной строки для управления службами Azure. Для платформ Windows, Mac и Linux ее можно скачать на [странице скачивания Azure](https://azure.microsoft.com/downloads/). Поддержка разных платформ важна при экспорте и импорте файлов зоны, так как наиболее распространенное программное обеспечение сервера доменных имен ([BIND](https://www.isc.org/downloads/bind/)) обычно выполняется в системе Linux.

> [!NOTE]
> В настоящее время имеются две версии Azure CLI. Версия CLI1.0 основана на Node.js, и ее команды начинаются с "azure".
> Версия CLI2.0 основана на Python, и ее команды начинаются с "az". Импорт файла зоны поддерживается в обеих версиях, однако мы рекомендуем использовать команды CLI1.0, как описано на этой странице.

## <a name="obtain-your-existing-dns-zone-file"></a>Получение существующего файла зоны DNS

Прежде чем импортировать файл зоны DNS в Azure DNS, необходимо получить копию файла зоны. Источник этого файла зависит от текущего размещения зоны DNS.

* Если для размещения зоны DNS используется партнерская служба (например, регистратор доменных имен, поставщик услуг размещения DNS или альтернативный поставщик облачных служб), такая служба должна поддерживать скачивание файла зоны DNS.
* Если зона DNS размещена на DNS-сервере Windows, по умолчанию файлы зоны можно найти в папке **%systemroot%\system32\dns**. Полный путь к каждому файлу зоны также отображается на вкладке **Общие** консоли DNS.
* Если для размещения зоны DNS используется BIND, расположение файла зоны для каждой зоны задается в файле конфигурации BIND **named.conf**.

> [!NOTE]
> Файлы зоны, скачанные с GoDaddy, слегка нестандартного формата. Это нужно исправить, прежде чем импортировать эти файлы зоны в Azure DNS.
>
> DNS-имена в RDATA каждой записи DNS указываются как полные имена без точки в конце. Это означает, что другие системы DNS интерпретируют их как относительные имена. Необходимо изменить файл зоны, добавив точку в конце каждого имени, прежде чем импортировать их в Azure DNS.
>
> Например, запись CNAME "www 3600 IN CNAME contoso.com" следует изменить на "www 3600 IN CNAME contoso.com."
> (с точкой в конце).

## <a name="import-a-dns-zone-file-into-azure-dns"></a>Импорт файла зоны DNS в Azure DNS

Импорт файла зоны создает зону в Azure DNS, если таковая не существует. Если зона существует, наборы записей в файле зоны нужно объединить с существующими наборами.

### <a name="merge-behavior"></a>Поведение объединения

* По умолчанию объединяются существующие и новые наборы записей. Одинаковые записи в рамках объединенного набора записей дедуплицируются.
* Если указать параметр `--force`, процесс импорта будет заменять существующие наборы записей новыми. Существующие наборы записей, у которых нет соответствующих наборов записей в импортированном файле зоны, не удаляются.
* При объединении наборов записей используется значение срока жизни (TTL) существующих наборов записей. При использовании параметра `--force` задается значение срока жизни нового набора записей.
* Параметры начальной записи зоны (SOA) (кроме `host`) всегда берутся из импортированного файла зоны (независимо от использования параметра `--force`). Аналогичным образом для набора записей сервера доменных имен на вершине зоны значение срока жизни всегда извлекается из импортированного файла зоны.
* Импортированная запись CNAME не заменяет существующую запись CNAME с тем же именем, если только не указан параметр `--force`.
* Если возникает конфликт между записью CNAME и другой записью с таким же именем, но другим типом (независимо от того, новая она или существующая), сохраняется существующая запись. Это не зависит от параметра `--force`.

### <a name="additional-information-about-importing"></a>Дополнительная информация об импорте

Ниже приведены дополнительные технические сведения о процессе импорта зоны.

* `$TTL` — необязательная поддерживаемая директива. Если директива `$TTL` не указывается, записи без явного значения срока жизни импортируются со значением срока жизни по умолчанию (3600 секунд). Если в одном наборе записей есть две записи с разными значениями срока жизни, используется меньшее значение.
* `$ORIGIN` — необязательная поддерживаемая директива. Если директива `$ORIGIN` не указывается, используется значение по умолчанию — имя зоны, указанное в командной строке (с точкой в конце).
* Директивы `$INCLUDE` и `$GENERATE` не поддерживаются.
* Поддерживаются такие типы записей: A, AAAA, CNAME, MX, NS, SOA, SRV и TXT.
* Запись типа SOA автоматически создается в Azure DNS во время создания зоны. При импорте файла зоны все параметры SOA, *кроме* параметра `host`, берутся из файла зоны. Этот параметр использует значение, предоставляемое Azure DNS. Это происходит, потому что данный параметр должен ссылаться на первичный сервер имен, предоставляемый Azure DNS.
* Набор записей сервера доменных имен в вершине зоны также создается службой Azure DNS автоматически во время создания зоны. Импортируется только значение TTL этого набора записей. Эти записи содержат имена серверов доменных имен, предоставляемые Azure DNS. Данные записей не перезаписываются значениями в импортированном файле зоны.
* Общедоступная предварительная версия Azure DNS поддерживает только записи типа TXT с одной строкой. Записи типа TXT, состоящие из нескольких строк, сцепляются и усекаются до 255 символов.

### <a name="cli-format-and-values"></a>Формат и значения CLI

Команда Azure CLI для импорта зоны DNS имеет следующий формат.

```azurecli
azure network dns zone import [options] <resource group> <zone name> <zone file name>
```

Значения:

* `<resource group>` — имя группы ресурсов для зоны в Azure DNS;
* `<zone name>` — имя зоны;
* `<zone file name>` — путь и имя импортируемого файла зоны.

Если зона с таким именем не существует в группе ресурсов, она создается автоматически. Если зона существует, импортированные наборы записей объединяются с существующими наборами. Чтобы перезаписать существующие наборы записей, используйте параметр `--force` .

Чтобы проверить формат файла зоны, не импортируя его, используйте параметр `--parse-only` .

### <a name="step-1-import-a-zone-file"></a>Шаг 1. Импорт файла зоны

Предположим, необходимо импортировать файл зоны для зоны **contoso.com**.

1. Войдите в подписку Azure с помощью Azure CLI 1.0.

    ```azurecli
    azure login
    ```

2. Выберите подписку, в рамках которой будет создана зона DNS.

    ```azurecli
    azure account set <subscription name>
    ```

3. Azure DNS — это служба, управляемая диспетчером ресурсов Azure, поэтому Azure CLI необходимо переключить в режим диспетчера ресурсов.

    ```azurecli
    azure config mode arm
    ```

4. Прежде чем использовать службу Azure DNS, необходимо зарегистрировать подписку для использования поставщика ресурсов Microsoft.Network. (Эта операция выполняется один раз для каждой подписки).

    ```azurecli
    azure provider register Microsoft.Network
    ```

5. Если у вас еще нет группы ресурсов Resource Manager, создайте ее.

    ```azurecli
    azure group create myresourcegroup westeurope
    ```

6. Чтобы импортировать зону **contoso.com** из файла **contoso.com.txt** в зону DNS в группе ресурсов **myresourcegroup**, выполните команду `azure network dns zone import`.<BR>Эта команда загружает файл зоны и анализирует его. Затем она инициирует выполнение ряда команд в службе Azure DNS, чтобы создать зону и все наборы записей в ней. В окне консоли виден ход выполнения команды, а также все ошибки и предупреждения. Так как наборы записей создаются в серии, при импорте большого файла зоны этот процесс может занять несколько минут.

    ```azurecli
    azure network dns zone import myresourcegroup contoso.com contoso.com.txt
    ```

### <a name="step-2-verify-the-zone"></a>Шаг 2. Проверка зоны

Чтобы проверить зону DNS после импорта файла, можно использовать один из следующих методов.

* Список записей можно получить, используя следующую команду Azure CLI:

    ```azurecli
    azure network dns record-set list myresourcegroup contoso.com
    ```

* Список записей можно вывести с помощью командлета PowerShell `Get-AzureRmDnsRecordSet`.
* С помощью `nslookup` можно проверить разрешение имен для записей. Так как зона еще не делегирована, нужно явно указать правильные серверы доменных имен Azure DNS. В примере ниже показано, как получить имена серверов доменных имен, назначенных зоне. В нем также показано, как запросить запись www с помощью команды `nslookup`.

        C:\>azure network dns record-set show myresourcegroup contoso.com @ NS
        info:Executing command network dns record-set show
        + Looking up the DNS Record Set "@" of type "NS"
        data:Id: /subscriptions/.../resourceGroups/myresourcegroup/providers/Microsoft.Network/dnszones/contoso.com/NS/@
        data:Name: @
        data:Type: Microsoft.Network/dnszones/NS
        data:Location: global
        data:TTL : 3600
        data:NS records
        data:Name server domain name : ns1-01.azure-dns.com
        data:Name server domain name : ns2-01.azure-dns.net
        data:Name server domain name : ns3-01.azure-dns.org
        data:Name server domain name : ns4-01.azure-dns.info
        data:
        info:network dns record-set show command OK

        C:\> nslookup www.contoso.com ns1-01.azure-dns.com

        Server: ns1-01.azure-dns.com
        Address:  40.90.4.1

        Name:www.contoso.com
        Addresses:  134.170.185.46
        134.170.188.221

### <a name="step-3-update-dns-delegation"></a>Шаг 3. Обновление делегирования DNS

После проверки правильности импорта зоны требуется обновить делегирование DNS, чтобы указать серверы доменных имен Azure DNS. Дополнительные сведения см. в статье [Делегирование домена в Azure DNS](dns-domain-delegation.md).

## <a name="export-a-dns-zone-file-from-azure-dns"></a>Экспорт файла зоны DNS из Azure DNS

Команда Azure CLI для импорта зоны DNS имеет следующий формат.

```azurecli
azure network dns zone export [options] <resource group> <zone name> <zone file name>
```

Значения:

* `<resource group>` — имя группы ресурсов для зоны в Azure DNS;
* `<zone name>` — имя зоны;
* `<zone file name>` — путь и имя экспортируемого файла зоны.

Как и при импорте зоны, сначала требуется войти, выбрать подписку и настроить Azure CLI для использования режима Resource Manager.

### <a name="to-export-a-zone-file"></a>Экспорт файла зоны

1. Войдите в подписку Azure с помощью Azure CLI.

    ```azurecli
    azure login
    ```

2. Выберите подписку, в которой нужно создать зону DNS.

    ```azurecli
    azure account set <subscription name>
    ```

3. DNS Azure является исключительно службой диспетчера ресурсов Azure. Azure CLI необходимо переключить в режим диспетчера ресурсов.

    ```azurecli
    azure config mode arm
    ```

4. Чтобы экспортировать имеющуюся зону Azure DNS **contoso.com** (в группе ресурсов **myresourcegroup**) в файл **contoso.com.txt** (в текущей папке), выполните команду `azure network dns zone export`. Эта команда вызывает службу Azure DNS для перечисления наборов записей в зоне и экспорта результатов в файл зоны, совместимый с форматом BIND.

    ```azurecli
    azure network dns zone export myresourcegroup contoso.com contoso.com.txt
    ```
