---
title: "Использование поставщика ресурсов API | Документы Microsoft"
description: "Ссылку для использования ресурсов API, которая получить сведения об использовании Azure стека."
services: azure-stack
documentationcenter: 
author: AlfredoPizzirani
manager: byronr
editor: 
ms.assetid: b6055923-b6a6-45f0-8979-225b713150ae
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/10/2017
ms.author: alfredop
ms.openlocfilehash: f43ec070e0269fad89b83c3075101e610a90ad96
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="provider-resource-usage-api"></a><span data-ttu-id="e4389-103">Использование поставщика ресурсов API</span><span class="sxs-lookup"><span data-stu-id="e4389-103">Provider Resource Usage API</span></span>
<span data-ttu-id="e4389-104">Термин поставщика применяется для администратора службы и любых делегированного поставщиков.</span><span class="sxs-lookup"><span data-stu-id="e4389-104">The term provider applies to the service administrator and to any delegated providers.</span></span> <span data-ttu-id="e4389-105">Администраторы службы и делегированные поставщики могут использовать API использования поставщика для просмотра использования своих прямых клиентов.</span><span class="sxs-lookup"><span data-stu-id="e4389-105">Service admins and delegated providers can use the Provider Usage API to view the usage of their direct tenants.</span></span> <span data-ttu-id="e4389-106">Например P0 может вызывать API-Интерфейс поставщика для получения сведений об использовании на его P1 и P2 в прямом использовании и P1 можно вызвать для получения сведений об использовании на P3 и P4.</span><span class="sxs-lookup"><span data-stu-id="e4389-106">For example, P0 can call the Provider API to get usage information on P1's and P2's direct usage, and P1 can call for usage information on P3 and P4.</span></span>

![Концептуальная модель поставщика иерархии](media/azure-stack-provider-resource-api/image1.png)

## <a name="api-call-reference"></a><span data-ttu-id="e4389-108">Вызов API-ссылка</span><span class="sxs-lookup"><span data-stu-id="e4389-108">API call reference</span></span>
### <a name="request"></a><span data-ttu-id="e4389-109">Запрос</span><span class="sxs-lookup"><span data-stu-id="e4389-109">Request</span></span>
<span data-ttu-id="e4389-110">Запрос возвращает сведения о потреблении для запрошенной подписки, а также для запрошенного периода времени.</span><span class="sxs-lookup"><span data-stu-id="e4389-110">The request gets consumption details for the requested subscriptions and for the requested time frame.</span></span> <span data-ttu-id="e4389-111">Нет текста запроса нет.</span><span class="sxs-lookup"><span data-stu-id="e4389-111">There is no request body.</span></span>

<span data-ttu-id="e4389-112">Такое использование API является API-Интерфейс поставщика, поэтому вызывающая сторона должна быть назначена владельца, участника или чтения в подписке поставщика.</span><span class="sxs-lookup"><span data-stu-id="e4389-112">This usage API is a Provider API, so the caller must be assigned an Owner, Contributor, or Reader role in the provider’s subscription.</span></span>

| <span data-ttu-id="e4389-113">**Метод**</span><span class="sxs-lookup"><span data-stu-id="e4389-113">**Method**</span></span> | <span data-ttu-id="e4389-114">**URI запроса**</span><span class="sxs-lookup"><span data-stu-id="e4389-114">**Request URI**</span></span> |
| --- | --- |
| <span data-ttu-id="e4389-115">ПОЛУЧЕНИЕ</span><span class="sxs-lookup"><span data-stu-id="e4389-115">GET</span></span> |<span data-ttu-id="e4389-116">https://{armendpoint}/subscriptions/{subId}/providers/Microsoft.Commerce/subscriberUsageAggregates?reportedStartTime={reportedStartTime}&reportedEndTime={reportedEndTime}&aggregationGranularity={granularity}& subscriberId = {sub1.1} & api-version = 2015-06-01-preview & continuationToken = {значение маркера}</span><span class="sxs-lookup"><span data-stu-id="e4389-116">https://{armendpoint}/subscriptions/{subId}/providers/Microsoft.Commerce/subscriberUsageAggregates?reportedStartTime={reportedStartTime}&reportedEndTime={reportedEndTime}&aggregationGranularity={granularity}&subscriberId={sub1.1}&api-version=2015-06-01-preview&continuationToken={token-value}</span></span> |

### <a name="arguments"></a><span data-ttu-id="e4389-117">Аргументы</span><span class="sxs-lookup"><span data-stu-id="e4389-117">Arguments</span></span>
| <span data-ttu-id="e4389-118">**Аргумент**</span><span class="sxs-lookup"><span data-stu-id="e4389-118">**Argument**</span></span> | <span data-ttu-id="e4389-119">**Описание**</span><span class="sxs-lookup"><span data-stu-id="e4389-119">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="e4389-120">*armendpoint*</span><span class="sxs-lookup"><span data-stu-id="e4389-120">*armendpoint*</span></span> |<span data-ttu-id="e4389-121">Конечная точка Azure диспетчер ресурсов среды Azure стека.</span><span class="sxs-lookup"><span data-stu-id="e4389-121">Azure Resource Manager endpoint of your Azure Stack environment.</span></span> <span data-ttu-id="e4389-122">Стек Azure соглашение является имя конечной точки диспетчера ресурсов Azure в формате `https://adminmanagement.{domain-name}`.</span><span class="sxs-lookup"><span data-stu-id="e4389-122">The Azure Stack convention is that the name of Azure Resource Manager endpoint is in the format `https://adminmanagement.{domain-name}`.</span></span> <span data-ttu-id="e4389-123">Например, если имя домена local.azurestack.external, затем конечную точку диспетчера ресурсов является `https://adminmanagement.local.azurestack.external`.</span><span class="sxs-lookup"><span data-stu-id="e4389-123">For example, if the domain name is local.azurestack.external, then the Resource Manager endpoint is `https://adminmanagement.local.azurestack.external`.</span></span> |
| <span data-ttu-id="e4389-124">*subId*</span><span class="sxs-lookup"><span data-stu-id="e4389-124">*subId*</span></span> |<span data-ttu-id="e4389-125">Идентификатор подписки пользователя, который выполняет вызов.</span><span class="sxs-lookup"><span data-stu-id="e4389-125">Subscription ID of the user who is making the call.</span></span> |
| <span data-ttu-id="e4389-126">*reportedStartTime*</span><span class="sxs-lookup"><span data-stu-id="e4389-126">*reportedStartTime*</span></span> |<span data-ttu-id="e4389-127">Запуск запроса.</span><span class="sxs-lookup"><span data-stu-id="e4389-127">Start time of the query.</span></span> <span data-ttu-id="e4389-128">Значение для *DateTime* должно быть в формате UTC и в начале часа, 13:00.</span><span class="sxs-lookup"><span data-stu-id="e4389-128">The value for *DateTime* should be in UTC and at the beginning of the hour, for example, 13:00.</span></span> <span data-ttu-id="e4389-129">Для ежедневного статистической обработки это значение до полуночи в формате UTC.</span><span class="sxs-lookup"><span data-stu-id="e4389-129">For daily aggregation, set this value to UTC midnight.</span></span> <span data-ttu-id="e4389-130">Недопустимый формат *escape-последовательность* ISO 8601, например, 2015-06-16T18% 3a53% 3a11% 2b00% 3a00Z, где двоеточие, экранируется % 3a и плюс, экранируется % 2b, чтобы оно было понятное URI.</span><span class="sxs-lookup"><span data-stu-id="e4389-130">The format is *escaped* ISO 8601, for example, 2015-06-16T18%3a53%3a11%2b00%3a00Z, where colon is escaped to %3a and plus is escaped to %2b so that it is URI friendly.</span></span> |
| <span data-ttu-id="e4389-131">*reportedEndTime*</span><span class="sxs-lookup"><span data-stu-id="e4389-131">*reportedEndTime*</span></span> |<span data-ttu-id="e4389-132">Время окончания запроса.</span><span class="sxs-lookup"><span data-stu-id="e4389-132">End time of the query.</span></span> <span data-ttu-id="e4389-133">Ограничения, которые применяются к *reportedStartTime* также применяются для данного аргумента.</span><span class="sxs-lookup"><span data-stu-id="e4389-133">The constraints that apply to *reportedStartTime* also apply to this argument.</span></span> <span data-ttu-id="e4389-134">Значение для *reportedEndTime* не может быть в будущем или текущей даты.</span><span class="sxs-lookup"><span data-stu-id="e4389-134">The value for *reportedEndTime* cannot be in the future or the current date.</span></span> <span data-ttu-id="e4389-135">Если это так, результат имеет значение «обработка не полный.»</span><span class="sxs-lookup"><span data-stu-id="e4389-135">If it is, the result is set to "processing not complete."</span></span> |
| <span data-ttu-id="e4389-136">*aggregationGranularity*</span><span class="sxs-lookup"><span data-stu-id="e4389-136">*aggregationGranularity*</span></span> |<span data-ttu-id="e4389-137">Необязательный параметр, который имеет два дискретных возможные значения: дням или часам.</span><span class="sxs-lookup"><span data-stu-id="e4389-137">Optional parameter that has two discrete potential values: daily and hourly.</span></span> <span data-ttu-id="e4389-138">Как предложить значения, один возвращает данные в дням, а другой — почасовой разрешения.</span><span class="sxs-lookup"><span data-stu-id="e4389-138">As the values suggest, one returns the data in daily granularity, and the other is an hourly resolution.</span></span> <span data-ttu-id="e4389-139">Ежедневный вариант используется по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="e4389-139">The daily option is the default.</span></span> |
| <span data-ttu-id="e4389-140">*subscriberId*</span><span class="sxs-lookup"><span data-stu-id="e4389-140">*subscriberId*</span></span> |<span data-ttu-id="e4389-141">Идентификатор подписки.</span><span class="sxs-lookup"><span data-stu-id="e4389-141">Subscription ID.</span></span> <span data-ttu-id="e4389-142">Чтобы получить отфильтрованных данных, требуется идентификатор подписки прямой клиента поставщика.</span><span class="sxs-lookup"><span data-stu-id="e4389-142">To get filtered data, the subscription ID of a direct tenant of the provider is required.</span></span> <span data-ttu-id="e4389-143">Если задано ни одного параметра идентификатор подписки, вызов возвращает данные об использовании для прямых клиентов поставщика.</span><span class="sxs-lookup"><span data-stu-id="e4389-143">If no subscription ID parameter is specified, the call returns usage data for all the provider’s direct tenants.</span></span> |
| <span data-ttu-id="e4389-144">*версия API*</span><span class="sxs-lookup"><span data-stu-id="e4389-144">*api-version*</span></span> |<span data-ttu-id="e4389-145">Версия протокола, используемого для выполнения этого запроса.</span><span class="sxs-lookup"><span data-stu-id="e4389-145">Version of the protocol that is used to make this request.</span></span> <span data-ttu-id="e4389-146">Это значение 2015-06-01-preview.</span><span class="sxs-lookup"><span data-stu-id="e4389-146">This value is set to 2015-06-01-preview.</span></span> |
| <span data-ttu-id="e4389-147">*continuationToken*</span><span class="sxs-lookup"><span data-stu-id="e4389-147">*continuationToken*</span></span> |<span data-ttu-id="e4389-148">Маркер извлекается из последнего вызова API использования поставщика.</span><span class="sxs-lookup"><span data-stu-id="e4389-148">Token retrieved from the last call to the Usage API provider.</span></span> <span data-ttu-id="e4389-149">Этот токен необходим в том случае, когда ответ больше 1 000 строк, и он действует в качестве закладки для хода выполнения.</span><span class="sxs-lookup"><span data-stu-id="e4389-149">This token is needed when a response is greater than 1,000 lines and it acts as a bookmark for the progress.</span></span> <span data-ttu-id="e4389-150">Если он отсутствует, данные извлекаются с самого начала дня или переданный часа, в зависимости от гранулярности.</span><span class="sxs-lookup"><span data-stu-id="e4389-150">If not present, the data is retrieved from the beginning of the day or hour, based on the granularity passed in.</span></span> |

### <a name="response"></a><span data-ttu-id="e4389-151">Ответ</span><span class="sxs-lookup"><span data-stu-id="e4389-151">Response</span></span>
<span data-ttu-id="e4389-152">ПОЛУЧИТЬ /subscriptions/sub1/providers/Microsoft.Commerce/subscriberUsageAggregates?reportedStartTime=reportedStartTime=2014-05-01T00%3a00%3a00%2b00%3a00 & reportedEndTime = 2015-06-01T00% 3a00% 3a00% 2b00% 3a00 & aggregationGranularity = ежедневно & subscriberId = sub1.1 & api-version = 1,0</span><span class="sxs-lookup"><span data-stu-id="e4389-152">GET /subscriptions/sub1/providers/Microsoft.Commerce/subscriberUsageAggregates?reportedStartTime=reportedStartTime=2014-05-01T00%3a00%3a00%2b00%3a00&reportedEndTime=2015-06-01T00%3a00%3a00%2b00%3a00&aggregationGranularity=Daily&subscriberId=sub1.1&api-version=1.0</span></span>

<span data-ttu-id="e4389-153">{</span><span class="sxs-lookup"><span data-stu-id="e4389-153">{</span></span>

<span data-ttu-id="e4389-154">«значение»:\[</span><span class="sxs-lookup"><span data-stu-id="e4389-154">"value": \[</span></span>

<span data-ttu-id="e4389-155">{</span><span class="sxs-lookup"><span data-stu-id="e4389-155">{</span></span>

<span data-ttu-id="e4389-156">«Идентификатор»: «/subscriptions/sub1.1/providers/Microsoft.Commerce/UsageAggregate/sub1.1-</span><span class="sxs-lookup"><span data-stu-id="e4389-156">"id": "/subscriptions/sub1.1/providers/Microsoft.Commerce/UsageAggregate/sub1.1-</span></span>

<span data-ttu-id="e4389-157">meterID1»,</span><span class="sxs-lookup"><span data-stu-id="e4389-157">meterID1",</span></span>

<span data-ttu-id="e4389-158">«Имя»: «sub1.1-meterID1»</span><span class="sxs-lookup"><span data-stu-id="e4389-158">"name": "sub1.1-meterID1",</span></span>

<span data-ttu-id="e4389-159">«Тип»: «Microsoft.Commerce/UsageAggregate»</span><span class="sxs-lookup"><span data-stu-id="e4389-159">"type": "Microsoft.Commerce/UsageAggregate",</span></span>

<span data-ttu-id="e4389-160">"properties": {</span><span class="sxs-lookup"><span data-stu-id="e4389-160">"properties": {</span></span>

<span data-ttu-id="e4389-161">«subscriptionId»: «sub1.1»</span><span class="sxs-lookup"><span data-stu-id="e4389-161">"subscriptionId":"sub1.1",</span></span>

<span data-ttu-id="e4389-162">«usageStartTime»: «2015-03-03T00:00:00 + 00:00»,</span><span class="sxs-lookup"><span data-stu-id="e4389-162">"usageStartTime": "2015-03-03T00:00:00+00:00",</span></span>

<span data-ttu-id="e4389-163">«usageEndTime»: «2015-03-04T00:00:00 + 00:00»,</span><span class="sxs-lookup"><span data-stu-id="e4389-163">"usageEndTime": "2015-03-04T00:00:00+00:00",</span></span>

<span data-ttu-id="e4389-164">«instanceData»: «{\\» Microsoft.Resources\\«: {\\» resourceUri\\»:\\» resourceUri1\\»,\\«местоположение\\</span><span class="sxs-lookup"><span data-stu-id="e4389-164">"instanceData":"{\\"Microsoft.Resources\\":{\\"resourceUri\\":\\"resourceUri1\\",\\"location\\</span></span>

<span data-ttu-id="e4389-165">«:\\«Аляска\\»,\\«теги\\»: имеет значение null,\\» additionalInfo\\«: null}}»,</span><span class="sxs-lookup"><span data-stu-id="e4389-165">":\\"Alaska\\",\\"tags\\":null,\\"additionalInfo\\":null}}",</span></span>

<span data-ttu-id="e4389-166">:2.4000000000 «quantity»</span><span class="sxs-lookup"><span data-stu-id="e4389-166">"quantity":2.4000000000,</span></span>

<span data-ttu-id="e4389-167">«meterId»: «meterID1»</span><span class="sxs-lookup"><span data-stu-id="e4389-167">"meterId":"meterID1"</span></span>

<span data-ttu-id="e4389-168">}</span><span class="sxs-lookup"><span data-stu-id="e4389-168">}</span></span>

<span data-ttu-id="e4389-169">},</span><span class="sxs-lookup"><span data-stu-id="e4389-169">},</span></span>

<span data-ttu-id="e4389-170">…</span><span class="sxs-lookup"><span data-stu-id="e4389-170">…</span></span>

### <a name="response-details"></a><span data-ttu-id="e4389-171">Сведения об ответе</span><span class="sxs-lookup"><span data-stu-id="e4389-171">Response details</span></span>
| <span data-ttu-id="e4389-172">**Аргумент**</span><span class="sxs-lookup"><span data-stu-id="e4389-172">**Argument**</span></span> | <span data-ttu-id="e4389-173">**Описание**</span><span class="sxs-lookup"><span data-stu-id="e4389-173">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="e4389-174">*id*</span><span class="sxs-lookup"><span data-stu-id="e4389-174">*id*</span></span> |<span data-ttu-id="e4389-175">Уникальный идентификатор использования статистической функции</span><span class="sxs-lookup"><span data-stu-id="e4389-175">Unique ID of the usage aggregate</span></span> |
| <span data-ttu-id="e4389-176">*name*</span><span class="sxs-lookup"><span data-stu-id="e4389-176">*name*</span></span> |<span data-ttu-id="e4389-177">Имя агрегатной функции использования</span><span class="sxs-lookup"><span data-stu-id="e4389-177">Name of the usage aggregate</span></span> |
| <span data-ttu-id="e4389-178">*type*</span><span class="sxs-lookup"><span data-stu-id="e4389-178">*type*</span></span> |<span data-ttu-id="e4389-179">Определение ресурсов</span><span class="sxs-lookup"><span data-stu-id="e4389-179">Resource definition</span></span> |
| <span data-ttu-id="e4389-180">*subscriptionId*</span><span class="sxs-lookup"><span data-stu-id="e4389-180">*subscriptionId*</span></span> |<span data-ttu-id="e4389-181">Идентификатор подписки Azure стека пользователя</span><span class="sxs-lookup"><span data-stu-id="e4389-181">Subscription identifier of the Azure Stack user</span></span> |
| <span data-ttu-id="e4389-182">*usageStartTime*</span><span class="sxs-lookup"><span data-stu-id="e4389-182">*usageStartTime*</span></span> |<span data-ttu-id="e4389-183">Время использования сегмента, к которому принадлежит это статистическое выражение использования начала UTC</span><span class="sxs-lookup"><span data-stu-id="e4389-183">UTC start time of the usage bucket to which this usage aggregate belongs</span></span> |
| <span data-ttu-id="e4389-184">*usageEndTime*</span><span class="sxs-lookup"><span data-stu-id="e4389-184">*usageEndTime*</span></span> |<span data-ttu-id="e4389-185">В формате UTC окончания использования сегмента, к которому принадлежит это статистическое выражение использования</span><span class="sxs-lookup"><span data-stu-id="e4389-185">UTC end time of the usage bucket to which this usage aggregate belongs</span></span> |
| <span data-ttu-id="e4389-186">*instanceData*</span><span class="sxs-lookup"><span data-stu-id="e4389-186">*instanceData*</span></span> |<span data-ttu-id="e4389-187">Подробные сведения об экземпляре (в новом формате) пар ключ значение:</span><span class="sxs-lookup"><span data-stu-id="e4389-187">Key-value pairs of instance details (in a new format):</span></span><br> <span data-ttu-id="e4389-188">*resourceUri*: полный идентификатор ресурса, включая группы ресурсов и имя экземпляра</span><span class="sxs-lookup"><span data-stu-id="e4389-188">*resourceUri*: Fully qualified resource ID, which includes the resource groups and the instance name</span></span> <br> <span data-ttu-id="e4389-189">*расположение*: область, в котором эта служба была запущена</span><span class="sxs-lookup"><span data-stu-id="e4389-189">*location*: Region in which this service was run</span></span> <br> <span data-ttu-id="e4389-190">*теги*: теги ресурсов, указанных пользователем</span><span class="sxs-lookup"><span data-stu-id="e4389-190">*tags*: Resource tags that are specified by the user</span></span> <br> <span data-ttu-id="e4389-191">*additionalInfo*: более подробные сведения о ресурсе, которое было получено, например, тип версии или образа ОС</span><span class="sxs-lookup"><span data-stu-id="e4389-191">*additionalInfo*: More details about the resource that was consumed, for example, OS version or image type</span></span> |
| <span data-ttu-id="e4389-192">*количество*</span><span class="sxs-lookup"><span data-stu-id="e4389-192">*quantity*</span></span> |<span data-ttu-id="e4389-193">Объем потребления ресурсов, возникшее в этот промежуток времени</span><span class="sxs-lookup"><span data-stu-id="e4389-193">Amount of resource consumption that occurred in this time frame</span></span> |
| <span data-ttu-id="e4389-194">*meterId*</span><span class="sxs-lookup"><span data-stu-id="e4389-194">*meterId*</span></span> |<span data-ttu-id="e4389-195">Уникальный идентификатор ресурса, которое было получено (также называемый *ResourceID*)</span><span class="sxs-lookup"><span data-stu-id="e4389-195">Unique ID for the resource that was consumed (also called *ResourceID*)</span></span> |

## <a name="next-steps"></a><span data-ttu-id="e4389-196">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="e4389-196">Next steps</span></span>
[<span data-ttu-id="e4389-197">Использование ресурсов клиента Справочник по API</span><span class="sxs-lookup"><span data-stu-id="e4389-197">Tenant resource usage API reference</span></span>](azure-stack-tenant-resource-usage-api.md)

[<span data-ttu-id="e4389-198">Часто задаваемые вопросы, относящиеся к использованию</span><span class="sxs-lookup"><span data-stu-id="e4389-198">Usage-related FAQ</span></span>](azure-stack-usage-related-faq.md)

