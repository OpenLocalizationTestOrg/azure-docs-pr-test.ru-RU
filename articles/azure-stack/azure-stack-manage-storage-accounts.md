---
title: "Управление учетными записями хранения Azure Stack | Документация Майкрософт"
description: "Сведения о поиске, восстановлении, освобождении учетных записей хранения Azure Stack и управлении ими."
services: azure-stack
documentationcenter: 
author: AniAnirudh
manager: darmour
editor: 
ms.assetid: 627d355b-4812-45cb-bc1e-ce62476dab34
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 4/6/2017
ms.author: anirudha
ms.openlocfilehash: 6e14bd6312135b45984a82099e68a934ec2a4a70
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="manage-storage-accounts-in-azure-stack"></a>Управление учетными записями хранения в Azure Stack
В этой статье приведены сведения об управлении учетными записями хранения, включая их поиск, восстановление и освобождение емкости хранилища в соответствии с бизнес-потребностями.

## <a name="find"></a>Поиск учетной записи хранения
Чтобы просмотреть список учетных записей хранения в регионе в Azure Stack, сделайте следующее:

1. В браузере перейдите по адресу https://adminportal.local.azurestack.external.
2. Войдите на портал администрирования Azure Stack как оператор облачной среды (используя учетные данные, предоставленные во время развертывания).
3. На панели мониторинга по умолчанию найдите список **Region management** (Управление регионами) и щелкните регион, который нужно просмотреть. Например, регион **(local**).
   
   ![](media/azure-stack-manage-storage-accounts/image1.png)
4. В списке **Поставщики ресурсов** выберите **Хранилище**.
   
   ![](media/azure-stack-manage-storage-accounts/image2.png)
5. В колонке администрирования поставщика ресурсов хранилища прокрутите вниз до вкладки **Учетные записи хранения** и щелкните ее.
   
   ![](media/azure-stack-manage-storage-accounts/image3.png)
   
   После этого откроется страница со списком учетных записей хранения в этом регионе.
   
   ![](media/azure-stack-manage-storage-accounts/image4.png)

По умолчанию отображаются первые 10 учетных записей. Чтобы просмотреть другие учетные записи, щелкните ссылку **Загрузить еще** в нижней части списка.

ИЛИ

Если вы заинтересованы в определенной учетной записи хранения, **отфильтруйте список и получите только соответствующие**.


**Чтобы отфильтровать учетные записи, сделайте следующее:**

1. Щелкните **Фильтр** в верхней части колонки.
2. В колонке "Фильтр" можно указать **имя учетной записи**, **идентификатор подписки** или **состояние**, чтобы на основе этих критериев отобразить список учетных записей хранения. Укажите нужные значения.
3. Нажмите кнопку **Обновить**. Список должен обновиться соответствующим образом.
   
    ![](media/azure-stack-manage-storage-accounts/image5.png)
4. Чтобы сбросить фильтр, щелкните **Фильтр**, очистите выбранные элементы и нажмите кнопку "Обновить".

Текстовое поле поиска (в верхней части колонки со списком учетных записей хранения) позволяет выделить нужный текст в списке. Это очень удобно в случае, если полное имя или идентификатор трудно найти.

Вы можете ввести здесь любой текст, чтобы найти нужную учетную запись.

![](media/azure-stack-manage-storage-accounts/image6.png)

## <a name="look-at-account-details"></a>Просмотр сведений учетной записи
Выбрав нужные учетные записи, вы можете щелкнуть любую из них, чтобы просмотреть определенные сведения. После этого откроется новая колонка со сведениями об учетной записи, например ее тип, время создания, расположение и т. д.

![](media/azure-stack-manage-storage-accounts/image7.png)

## <a name="recover-a-deleted-account"></a>Восстановление удаленной учетной записи
В некоторых ситуациях вам, возможно, потребуется восстановить удаленную учетную запись.

В Azure Stack это сделать очень просто:

1. Перейдите к списку учетных записей хранения. Дополнительные сведения см. в разделе [Поиск учетной записи хранения](#find) этой статьи.
2. Найдите эту конкретную учетную запись в списке. Вам, возможно, потребуется отфильтровать его.
3. Проверьте *состояние* учетной записи. Оно должно быть таким: **Удалено**.
4. Щелкните учетную запись, после чего откроется колонка сведений о ней.
5. В верхней части этой колонки найдите кнопку **Восстановить** и нажмите ее.
6. Нажмите кнопку **Да** для подтверждения.
   
   ![](media/azure-stack-manage-storage-accounts/image8.png)
7. После этого должно отобразиться оповещение о *выполнении восстановления*. Это означает, что процесс выполняется успешно.
   Кроме того, вы можете щелкнуть значок колокольчика в верхней части портала, чтобы просмотреть оповещения о ходе выполнения.
   
   ![](media/azure-stack-manage-storage-accounts/image9.png)
   
   После синхронизации восстановленную учетную запись можно снова использовать.

### <a name="some-gotchas"></a>Некоторые проблемы
* Состояние удаленной учетной записи — **out of retention** (Срок хранения истек).
  
  Это означает, что срок хранения учетной записи истек и ее невозможно восстановить.
* Удаленная учетная запись не отображается в списке.
  
  Это означает, что эта учетная запись удалена сборщиком мусора. В этом случае восстановить ее невозможно. Дополнительные сведения см. в разделе [Освобождение емкости](#reclaim) этой статьи.

## <a name="set-the-retention-period"></a>Установка срока хранения
В параметрах срока хранения оператор облачной среди может указать время (0–9999 дней), в течение которого можно восстановить удаленную учетную запись. По умолчанию срок хранения составляет 15 дней. Если задать этому параметру значение 0, срок хранения всех удаленных учетных записей мгновенно истекает и они отмечаются для периодической сборки мусора.

**Чтобы изменить срок хранения, сделайте следующее:**

1. В браузере перейдите по адресу https://adminportal.local.azurestack.external.
2. Войдите на портал администрирования Azure Stack как оператор облачной среды (используя учетные данные, предоставленные во время развертывания).
3. На панели мониторинга по умолчанию найдите список **Region management** (Управление регионами) и щелкните регион, который нужно просмотреть, например **(local**).
4. В списке **Поставщики ресурсов** выберите **Хранилище**.
5. В верхней части нажмите кнопку **Параметры**, чтобы открыть колонку параметров.
6. Щелкните **Конфигурация**, а затем измените значение срока хранения.

   Задайте количество дней, а затем сохраните изменение.
   
   Это значение немедленно вступает в силу и применяется ко всему региону.

   ![](media/azure-stack-manage-storage-accounts/image10.png)

## <a name="reclaim"></a>Освобождение емкости
Один из недостатков срока хранения заключается в том, что удаленная учетная запись продолжает потреблять емкость до истечения срока. Оператору облачной среды может потребоваться освободить емкость удаленной учетной записи до истечения срока хранения.

Это можно сделать на портале Azure или с помощью PowerShell.

**Чтобы освободить емкость на портале, сделайте следующее:**
1. Перейдите к колонке с учетными записями хранения. Дополнительные сведения см. в разделе [Поиск учетной записи хранения](#find).
2. Щелкните **Reclaim space** (Освобождение пространства) в верхней части колонки.
3. Прочтите сообщение и нажмите кнопку **ОК**.

    ![](media/azure-stack-manage-storage-accounts/image11.png)
4. Дождитесь, пока не отобразится уведомление об успешном выполнении, или щелкните значок колокольчика на портале.

    ![](media/azure-stack-manage-storage-accounts/image12.png)
5. Обновите страницу "Учетные записи хранения". После этого удаленные учетные записи больше не отображаются в списке, так как они очищены.

С помощью PowerShell вы можете явно переопределить срок хранения и мгновенно освободить емкость.

**Чтобы освободить емкость с помощью PowerShell, сделайте следующее:**   

1. Проверьте, установлена и настроена ли среда Azure PowerShell. Если нет, сделайте следующее: 
   * Чтобы установить последнюю версию Azure PowerShell и связать ее с подпиской Azure, см. сведения в статье [Общие сведения об Azure PowerShell](http://azure.microsoft.com/documentation/articles/powershell-install-configure/).
   Дополнительные сведения о командлетах Azure Resource Manager см. в статье [Управление ресурсами с помощью Azure PowerShell и Resource Manager](http://go.microsoft.com/fwlink/?LinkId=394767).
2. Выполните следующий командлет:

> [!NOTE]
> При выполнении этого командлета вы окончательно удалите учетную запись и ее содержимое. Восстановить его будет невозможно. Используйте этот командлет с осторожностью.


        Clear-ACSStorageAccount -ResourceGroupName system.local -FarmName <farm ID>


Дополнительные сведения см. в [документации по PowerShell для Azure Stack](https://msdn.microsoft.com/library/mt637964.aspx).
 

## <a name="migrate-a-container"></a>Перенос контейнера
Из-за неравномерного использования хранилища клиентами одна или несколько общих папок клиента могут потреблять больше пространства, чем другие. В этом случае оператор облачной среды может попытаться освободить место в этих общих папках, вручную переместив некоторые контейнеры больших двоичных объектов в другую папку. 

Это нужно делать с помощью PowerShell.
> [!NOTE]
>Сейчас контейнеры больших двоичных объектов не поддерживают динамическое перемещение. Эту операцию можно выполнить в автономном режиме. Во время переноса и до завершения операции базовые большие двоичные объекты в этом контейнере нельзя использовать. Они находятся в автономном режиме. 

**Чтобы перенести контейнеры с помощью PowerShell, сделайте следующее:**

1. Проверьте, установлена и настроена ли среда Azure PowerShell. Если нет, сделайте следующее:
    * Чтобы установить последнюю версию Azure PowerShell и связать ее с подпиской Azure, см. сведения в статье [Общие сведения об Azure PowerShell](http://azure.microsoft.com/documentation/articles/powershell-install-configure/). Дополнительные сведения о командлетах Azure Resource Manager см. в статье [Управление ресурсами с помощью Azure PowerShell и Resource Manager](http://go.microsoft.com/fwlink/?LinkId=394767).
2. Получите имя фермы: 
      
      `$farm = Get-ACSFarm -ResourceGroupName system.local`
3. Получите список общих папок: 

   `$shares = Get-ACSShare -ResourceGroupName system.local -FarmName $farm.FarmName`

4. Получите список контейнеров нужной общей папки. Обратите внимание, что Count и Intent Migration — это необязательные параметры:
            
   `$containers = Get-ACSContainer -ResourceGroupName system.local -FarmName $farm.FarmName -ShareName $shares[0].ShareName -Count 4 -Intent Migration`  

   Затем проверьте значение $containers:

   `$containers`

    ![](media/azure-stack-manage-storage-accounts/image13.png)
5. Получите список общих папок, в которые лучше всего перенести контейнеры:

    `$destinationshares= Get-ACSSharesForMigration  -ResourceGroupName system.local -FarmName $farm.farmname -SourceShareName $shares[0].ShareName`

    Затем проверьте значение $destinationshares:

    `$destinationshares`

    ![](media/azure-stack-manage-storage-accounts/image14.png)
6. Начните перенос контейнеров. Обратите внимание, что это асинхронное внедрение. За счет этого вы можете перебрать список всех контейнеров в общей папке и отследить состояния на основе возвращенного идентификатора задания.

    `$jobId = Start-ACSContainerMigration -ResourceGroupName system.local -FarmName $farm.farmname -ContainerToMigrate $containers[1] -DestinationShareUncPath $destinationshares.UncPath`

    Затем проверьте значение $jobId:

   ```
   $jobId
   d1d5277f-6b8d-4923-9db3-8bb00fa61b65
   ```
7. Проверьте состояние задания переноса по идентификатору задания. По завершении переноса параметру MigrationStatus присваивается значение Completed.

    `Get-ACSContainerMigrationStatus -ResourceGroupName system.local -FarmName $farm.farmname -JobId $jobId`

    ![](media/azure-stack-manage-storage-accounts/image15.png)

8. Вы можете отменить выполняющиеся задания переноса. Это также асинхронная операция, состояние которой можно отследить на основе значения $jobid:

    `Stop-ACSContainerMigration-ResourceGroupName system.local -FarmName $farm.farmname -JobId $jobId-Verbose`

    ![](media/azure-stack-manage-storage-accounts/image16.png)

    Вы можете проверить состояние отмены переноса:

    `Get-ACSContainerMigrationStatus-ResourceGroupName system.local -FarmName $farm.farmname -JobId $jobId`

    ![](media/azure-stack-manage-storage-accounts/image17.png)




  
  