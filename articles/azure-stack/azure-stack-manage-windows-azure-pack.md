---
title: "aaaManage Windows Azure Pack виртуальных машин из стека Azure | Документы Microsoft"
description: "Узнайте, как toomanage виртуальных машин Windows Azure Pack (MAP) из пользовательского портала hello Azure стека."
services: azure-stack
documentationcenter: 
author: walterov
manager: byronr
editor: 
ms.assetid: 213c2792-d404-4b44-8340-235adf3f8f0b
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/10/2017
ms.author: walterov
ms.openlocfilehash: 97dbe34055667a72fddc8507ae389562e885a32e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="manage-windows-azure-pack-virtual-machines-from-azure-stack"></a><span data-ttu-id="ff30f-103">Управление виртуальными машинами Windows Azure Pack из стека Azure</span><span class="sxs-lookup"><span data-stu-id="ff30f-103">Manage Windows Azure Pack virtual machines from Azure Stack</span></span>
<span data-ttu-id="ff30f-104">В hello пакет средств разработки стек Azure вы можете включить доступ из hello Azure стека пользователя портала tootenant виртуальных машин, работающих на Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-104">In hello Azure Stack Development Kit, you can enable access from hello Azure Stack user portal tootenant virtual machines running on Windows Azure Pack.</span></span> <span data-ttu-id="ff30f-105">Клиенты могут использовать toomanage портала Azure стека hello их существующие виртуальные машины IaaS и виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="ff30f-105">Tenants can use hello Azure Stack portal toomanage their existing IaaS virtual machines and virtual networks.</span></span> <span data-ttu-id="ff30f-106">Эти ресурсы становятся доступными в Windows Azure Pack через hello базовых Service Provider Foundation (SPF) и Virtual Machine Manager (VMM) компонента.</span><span class="sxs-lookup"><span data-stu-id="ff30f-106">These resources are made available on Windows Azure Pack through hello underlying Service Provider Foundation (SPF) and Virtual Machine Manager (VMM) components.</span></span> <span data-ttu-id="ff30f-107">В частности клиенты могут:</span><span class="sxs-lookup"><span data-stu-id="ff30f-107">Specifically, tenants can:</span></span>

* <span data-ttu-id="ff30f-108">Просмотр ресурсов</span><span class="sxs-lookup"><span data-stu-id="ff30f-108">Browse resources</span></span>
* <span data-ttu-id="ff30f-109">Просмотр значений конфигурации</span><span class="sxs-lookup"><span data-stu-id="ff30f-109">Examine configuration values</span></span>
* <span data-ttu-id="ff30f-110">Остановка или запуск виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="ff30f-110">Stop or start a virtual machine</span></span>
* <span data-ttu-id="ff30f-111">Подключите виртуальную машину tooa через протокол удаленного рабочего стола (RDP)</span><span class="sxs-lookup"><span data-stu-id="ff30f-111">Connect tooa virtual machine through Remote Desktop Protocol (RDP)</span></span>
* <span data-ttu-id="ff30f-112">Создание и управление контрольными точками</span><span class="sxs-lookup"><span data-stu-id="ff30f-112">Create and manage checkpoints</span></span>
* <span data-ttu-id="ff30f-113">Удалите виртуальные машины и виртуальные сети</span><span class="sxs-lookup"><span data-stu-id="ff30f-113">Delete virtual machines and virtual networks</span></span>

<span data-ttu-id="ff30f-114">Эта функциональность обеспечивается hello соединителя пакет Windows Azure для стека Azure (Предварительная версия).</span><span class="sxs-lookup"><span data-stu-id="ff30f-114">This functionality is provided by hello Windows Azure Pack Connector for Azure Stack (Preview).</span></span> <span data-ttu-id="ff30f-115">В этой статье показано, как tooconfigure hello соединитель для среды стека Azure с одним узлом.</span><span class="sxs-lookup"><span data-stu-id="ff30f-115">This article shows how tooconfigure hello connector for a single-node Azure Stack environment.</span></span>

<span data-ttu-id="ff30f-116">В этой предварительной версии соединителя hello помните о следующих hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-116">For this preview release of hello connector, be aware of hello following:</span></span>
* <span data-ttu-id="ff30f-117">Используйте hello соединителя пакет Windows Azure только в тестовых сред (стек Azure и пакета Windows Azure), а не в производственной среде.</span><span class="sxs-lookup"><span data-stu-id="ff30f-117">Use hello Windows Azure Pack Connector only in test environments (for both Azure Stack and Windows Azure Pack), and not in production deployments.</span></span>
* <span data-ttu-id="ff30f-118">Необходимо иметь Windows Azure Pack набор исправлений (UR) 9.1 или более поздней версии и System Center SPF и VMM с НАКОПИТЕЛЬНЫМ пакетом обновления 9 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="ff30f-118">You must have Windows Azure Pack Update Rollup (UR) 9.1 or later and System Center SPF and VMM UR 9 or later.</span></span>
* <span data-ttu-id="ff30f-119">Hello VMM и SPF компонентов может быть System Center 2012 R2 или System Center 2016.</span><span class="sxs-lookup"><span data-stu-id="ff30f-119">hello VMM and SPF components can be either System Center 2012 R2 or System Center 2016.</span></span>
* <span data-ttu-id="ff30f-120">На обоих стек Azure и пакета Windows Azure необходимо выполнить действия по настройке.</span><span class="sxs-lookup"><span data-stu-id="ff30f-120">You must perform configuration steps on both Azure Stack and on Windows Azure Pack.</span></span>
* <span data-ttu-id="ff30f-121">Hello инструкции применяются toonon облачных сред Platform System (CPS).</span><span class="sxs-lookup"><span data-stu-id="ff30f-121">hello instructions apply toonon-Cloud Platform System (CPS) environments.</span></span>
* <span data-ttu-id="ff30f-122">tooreview hello известные проблемы см. в разделе [Устранение неполадок Microsoft Azure стека](azure-stack-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="ff30f-122">tooreview hello known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span></span>


## <a name="architecture"></a><span data-ttu-id="ff30f-123">Архитектура</span><span class="sxs-lookup"><span data-stu-id="ff30f-123">Architecture</span></span>
<span data-ttu-id="ff30f-124">Hello следующей схеме показаны основные компоненты hello hello соединителя пакет Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="ff30f-124">hello following diagram shows hello main components of hello Windows Azure Pack Connector.</span></span>

![компоненты Windows Azure Pack Connector Hello](media/azure-stack-manage-wap/image1.png)

<span data-ttu-id="ff30f-126">Обратите внимание, hello, приведенные ниже сведения:</span><span class="sxs-lookup"><span data-stu-id="ff30f-126">Notice hello following details:</span></span>
* <span data-ttu-id="ff30f-127">пользовательский портал Azure стека Hello обращается к hello сведения о ресурсах из обоих облаков (стек Azure и пакета Windows Azure).</span><span class="sxs-lookup"><span data-stu-id="ff30f-127">hello Azure Stack user portal accesses hello resource information from both clouds (Azure Stack and Windows Azure Pack).</span></span>
* <span data-ttu-id="ff30f-128">Hello пользователь должен иметь учетную запись, которая является допустимым в обеих средах.</span><span class="sxs-lookup"><span data-stu-id="ff30f-128">hello user must have an account that is valid in both environments.</span></span>
* <span data-ttu-id="ff30f-129">Hello Azure стека пользовательский портал должен иметь toohello компонентов доступа к сети, работающих на Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-129">hello Azure Stack user portal must have network access toohello components running on Windows Azure Pack.</span></span>
* <span data-ttu-id="ff30f-130">В hello **WAP** раздела схемы hello hello новый соединитель пакет Windows Azure модули (расширения WAP и соединителя) и получить hello существующих API Windows Azure Pack клиента с компонентами VMM и SPF.</span><span class="sxs-lookup"><span data-stu-id="ff30f-130">In hello **WAP** section of hello diagram, you can see hello new Windows Azure Pack Connector modules (WAP Extension and Connector) and hello existing Windows Azure Pack Tenant API with SPF and VMM components.</span></span>


## <a name="identity-management"></a><span data-ttu-id="ff30f-131">Управление удостоверениями</span><span class="sxs-lookup"><span data-stu-id="ff30f-131">Identity management</span></span>
<span data-ttu-id="ff30f-132">Hello API клиента Windows Azure Pack должен доверять hello службы маркеров безопасности Azure стека (STS).</span><span class="sxs-lookup"><span data-stu-id="ff30f-132">hello Windows Azure Pack Tenant API must trust hello Azure Stack security token service (STS).</span></span>

<span data-ttu-id="ff30f-133">Когда пользователь выполняет действие через портал Azure стека hello, ориентированном ресурсов пакета Windows Azure, портал hello использует hello API клиента Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-133">When a user performs an action through hello Azure Stack portal that targets Windows Azure Pack resources, hello portal uses hello Windows Azure Pack Tenant API.</span></span> <span data-ttu-id="ff30f-134">Таким образом предоставляемые hello маркер проверки подлинности должны поступать из доверенных маркеров безопасности.</span><span class="sxs-lookup"><span data-stu-id="ff30f-134">Therefore, hello provided user authentication token must come from a trusted STS.</span></span> <span data-ttu-id="ff30f-135">В разделе hello, следующая схема:</span><span class="sxs-lookup"><span data-stu-id="ff30f-135">See hello following diagram:</span></span>

![Схема проверки подлинности соединителя пакет Windows Azure](media/azure-stack-manage-wap/image2.png)

<span data-ttu-id="ff30f-137">В среде комплект средств для разработки hello, пакет Windows Azure и Azure стека имеют независимых поставщиков.</span><span class="sxs-lookup"><span data-stu-id="ff30f-137">In hello development kit environment, Windows Azure Pack and Azure Stack have independent identity providers.</span></span> <span data-ttu-id="ff30f-138">Пользователям, обращающимся к обеих средах с портала Azure стека hello должен иметь имя того же основного имени пользователя (UPN) в обоих поставщиков удостоверений hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-138">Users who access both environments from hello Azure Stack portal must have hello same user principal name (UPN) name in both identity providers.</span></span> <span data-ttu-id="ff30f-139">Например, hello учетной записи  *azurestackadmin@azurestack.local*  должны также существовать в hello STS для Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-139">For example, hello account *azurestackadmin@azurestack.local* should also exist in hello STS for Windows Azure Pack.</span></span> <span data-ttu-id="ff30f-140">Где AD FS не настроен toosupport исходящих доверительных отношений, будут устанавливать отношения доверия из hello Windows Azure Pack компонентов (API клиента) toohello стека Azure экземпляра AD FS.</span><span class="sxs-lookup"><span data-stu-id="ff30f-140">Where AD FS is not set up toosupport outbound trust relationships, you will establish trust from hello Windows Azure Pack components (Tenant API) toohello Azure Stack instance of AD FS.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="ff30f-141">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="ff30f-141">Prerequisites</span></span>

### <a name="download-hello-windows-azure-pack-connector"></a><span data-ttu-id="ff30f-142">Загрузите hello соединителя пакет Windows Azure</span><span class="sxs-lookup"><span data-stu-id="ff30f-142">Download hello Windows Azure Pack Connector</span></span>
<span data-ttu-id="ff30f-143">На hello [центра загрузки Майкрософт](https://aka.ms/wapconnectorazurestackdlc), загрузите файл .exe hello и извлеките его tooyour локального компьютера.</span><span class="sxs-lookup"><span data-stu-id="ff30f-143">On hello [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), download hello .exe file and extract it tooyour local computer.</span></span> <span data-ttu-id="ff30f-144">Более поздней версии необходимо скопировать hello содержимое tooa компьютера, можно получить доступ к вашей среде Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-144">Later, you copy hello contents tooa computer that can access your Windows Azure Pack environment.</span></span>

### <a name="deployment-option-requirement"></a><span data-ttu-id="ff30f-145">Параметр требования развертывания</span><span class="sxs-lookup"><span data-stu-id="ff30f-145">Deployment option requirement</span></span>
<span data-ttu-id="ff30f-146">toointegrate с пакетом Windows Azure, Azure стека можно развернуть с помощью параметр hello AD FS или Azure Active Directory hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-146">toointegrate with Windows Azure Pack, you can deploy Azure Stack by using hello AD FS option or hello Azure Active Directory option.</span></span>

### <a name="connectivity-requirements"></a><span data-ttu-id="ff30f-147">Требований к подключению</span><span class="sxs-lookup"><span data-stu-id="ff30f-147">Connectivity requirements</span></span>
1. <span data-ttu-id="ff30f-148">С hello компьютера, на котором доступ hello Azure стека пользовательского портала убедитесь в том, что можно обращаться из портала клиента Windows Azure Pack hello hello веб-браузера.</span><span class="sxs-lookup"><span data-stu-id="ff30f-148">From hello computer on which you access hello Azure Stack user portal, make sure that you can access hello Windows Azure Pack tenant portal through hello web browser.</span></span>
2. <span data-ttu-id="ff30f-149">Виртуальная машина Hello AzS WASP01 стек Azure должна быть портала компьютер клиента Windows Azure Pack может tooconnect toohello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-149">hello AzS-WASP01 virtual machine on Azure Stack must be able tooconnect toohello Windows Azure Pack tenant portal computer.</span></span> <span data-ttu-id="ff30f-150">Используйте Ping.exe tooverify сетевое подключение.</span><span class="sxs-lookup"><span data-stu-id="ff30f-150">Use Ping.exe tooverify network connectivity.</span></span> 
3.  <span data-ttu-id="ff30f-151">Необходимо иметь действительные сертификаты для hello новый соединитель служб.</span><span class="sxs-lookup"><span data-stu-id="ff30f-151">You must have valid certificates for hello new Connector services.</span></span> <span data-ttu-id="ff30f-152">Эти сертификаты SSL должен быть выдан доверенным центром сертификации (ЦС).</span><span class="sxs-lookup"><span data-stu-id="ff30f-152">These SSL certificates must be issued by a trusted certification authority (CA).</span></span> <span data-ttu-id="ff30f-153">Нельзя использовать самозаверяющие сертификаты.</span><span class="sxs-lookup"><span data-stu-id="ff30f-153">You can't use self-signed certificates.</span></span> <span data-ttu-id="ff30f-154">Hello SSL-сертификаты должны быть доверенными Azure стека (в частности hello AzS WASP01 ВМ) и любым другим компьютером, hello клиента может использовать tooaccess hello Azure стека пользовательского портала.</span><span class="sxs-lookup"><span data-stu-id="ff30f-154">hello SSL certificates must be trusted by Azure Stack (specifically hello AzS-WASP01 VM) and any other computer that hello tenant may use tooaccess hello Azure Stack user portal.</span></span>
 
    >[!NOTE]
    <span data-ttu-id="ff30f-155">Поскольку AzS WASP01 выполняется hello вариант установки основных серверных компонентов Windows Server, можно использовать средство командной строки, такие как Certutil.ext tooimport hello сертификат.</span><span class="sxs-lookup"><span data-stu-id="ff30f-155">Because AzS-WASP01 runs Windows Server with hello Server Core installation option, you can use a command-line tool such as Certutil.ext tooimport hello certificate.</span></span> <span data-ttu-id="ff30f-156">Например, можно скопировать tooc:\temp файл .cer hello на AzS WASP01 и выполните команду hello **certutil - addstore «Калифорния» «c:\temp\certname.cer»**.</span><span class="sxs-lookup"><span data-stu-id="ff30f-156">For example, you could copy hello .cer file tooc:\temp on AzS-WASP01, and then run hello command **certutil -addstore "CA" "c:\temp\certname.cer"**.</span></span>

4.  <span data-ttu-id="ff30f-157">tooWindows подключение RDP tooestablish виртуальных машин Azure Pack клиента через портал Azure стека hello, среды Windows Azure Pack hello должны разрешать виртуальные машины клиента toohello трафика удаленного рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="ff30f-157">tooestablish RDP connectivity tooWindows Azure Pack tenant virtual machines through hello Azure Stack portal, hello Windows Azure Pack environment must allow Remote Desktop traffic toohello tenant VMs.</span></span>
5.  <span data-ttu-id="ff30f-158">Для связи между Azure стека клиента виртуальных машин и виртуальных машин клиента Windows Azure Pack их внешних IP-адресов должно быть маршрутизируемым для hello двух средах.</span><span class="sxs-lookup"><span data-stu-id="ff30f-158">For connectivity between Azure Stack tenant virtual machines and Windows Azure Pack tenant virtual machines, their external IP addresses must be routable across hello two environments.</span></span> <span data-ttu-id="ff30f-159">Эта связь также может включать связывание имена DNS-серверов tooresolve виртуальной машины между средами hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-159">This connectivity could also include associating a DNS server tooresolve virtual machine names between hello environments.</span></span>

### <a name="iis-requirements"></a><span data-ttu-id="ff30f-160">Требования к IIS</span><span class="sxs-lookup"><span data-stu-id="ff30f-160">IIS requirements</span></span>
<span data-ttu-id="ff30f-161">Hello компьютера, на котором размещен портал клиента Windows Azure Pack hello (который может быть физического узла, виртуальной машины или несколько виртуальных машин) должен иметь после установки расширения IIS перепишите URL-адрес hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-161">hello computer that hosts hello Windows Azure Pack tenant portal (which may be a physical host, a virtual machine, or multiple virtual machines) must have hello URL Rewrite IIS extension installed.</span></span> <span data-ttu-id="ff30f-162">Если не установлен, его можно загрузить из [здесь](https://www.iis.net/downloads/microsoft/url-rewrite).</span><span class="sxs-lookup"><span data-stu-id="ff30f-162">If it is not already installed, you can download it from [here](https://www.iis.net/downloads/microsoft/url-rewrite).</span></span> <span data-ttu-id="ff30f-163">Если несколько виртуальных машин разместить портал клиента hello, установите расширение hello на каждой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="ff30f-163">If multiple virtual machines host hello tenant portal, install hello extension on each virtual machine.</span></span>

## <a name="configure-azure-stack"></a><span data-ttu-id="ff30f-164">Настройка стек Azure</span><span class="sxs-lookup"><span data-stu-id="ff30f-164">Configure Azure Stack</span></span>
<span data-ttu-id="ff30f-165">Прежде чем настраивать hello соединителя пакет Windows Azure, необходимо включить режим несколько компонентов в облаке на пользовательском портале hello Azure стека.</span><span class="sxs-lookup"><span data-stu-id="ff30f-165">Before you configure hello Windows Azure Pack Connector, you must enable multi-cloud mode in hello Azure Stack user portal.</span></span> <span data-ttu-id="ff30f-166">Этот режим позволяет пользователям tooselect из tooaccess какие облачные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="ff30f-166">This mode enables users tooselect from which cloud tooaccess resources.</span></span>

<span data-ttu-id="ff30f-167">режим tooenable несколько компонентов в облаке, необходимо запустить hello AzurePackConnector.ps1 добавить скрипт после развертывания Azure стека.</span><span class="sxs-lookup"><span data-stu-id="ff30f-167">tooenable multi-cloud mode, you must run hello Add-AzurePackConnector.ps1 script after Azure Stack deployment.</span></span> <span data-ttu-id="ff30f-168">Hello в следующей таблице описаны параметры сценария hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-168">hello following table describes hello script parameters.</span></span>


|  <span data-ttu-id="ff30f-169">Параметр</span><span class="sxs-lookup"><span data-stu-id="ff30f-169">Parameter</span></span> | <span data-ttu-id="ff30f-170">Описание</span><span class="sxs-lookup"><span data-stu-id="ff30f-170">Description</span></span> | <span data-ttu-id="ff30f-171">Пример</span><span class="sxs-lookup"><span data-stu-id="ff30f-171">Example</span></span> |   
| -------- | ------------- | ------- |  
| <span data-ttu-id="ff30f-172">AzurePackClouds</span><span class="sxs-lookup"><span data-stu-id="ff30f-172">AzurePackClouds</span></span> | <span data-ttu-id="ff30f-173">URI hello соединители пакет Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="ff30f-173">URIs of hello Windows Azure Pack Connectors.</span></span> <span data-ttu-id="ff30f-174">Эти URI должен соответствовать toohello порталы клиентами Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-174">These URIs should correspond toohello Windows Azure Pack tenant portals.</span></span> | <span data-ttu-id="ff30f-175">@{CloudName = «AzurePack1»; CloudEndpoint = «https://waptenantportal1:40005"},@{CloudName = «AzurePack2»; CloudEndpoint = «https://waptenantportal2:40005»}</span><span class="sxs-lookup"><span data-stu-id="ff30f-175">@{CloudName = "AzurePack1"; CloudEndpoint = "https://waptenantportal1:40005"},@{CloudName = "AzurePack2"; CloudEndpoint = "https://waptenantportal2:40005"}</span></span><br><br>  <span data-ttu-id="ff30f-176">(По умолчанию hello значение порта не является 40005.)</span><span class="sxs-lookup"><span data-stu-id="ff30f-176">(By default, hello port value is 40005.)</span></span> |  
| <span data-ttu-id="ff30f-177">AzureStackCloudName</span><span class="sxs-lookup"><span data-stu-id="ff30f-177">AzureStackCloudName</span></span> | <span data-ttu-id="ff30f-178">Метка toorepresent hello Azure стека облака.</span><span class="sxs-lookup"><span data-stu-id="ff30f-178">Label toorepresent hello local Azure Stack cloud.</span></span>| <span data-ttu-id="ff30f-179">«AzureStack»</span><span class="sxs-lookup"><span data-stu-id="ff30f-179">"AzureStack"</span></span> |
| <span data-ttu-id="ff30f-180">DisableMultiCloud</span><span class="sxs-lookup"><span data-stu-id="ff30f-180">DisableMultiCloud</span></span> | <span data-ttu-id="ff30f-181">Переключите режим несколько компонентов в облаке toodisable.</span><span class="sxs-lookup"><span data-stu-id="ff30f-181">A switch toodisable multi-cloud mode.</span></span>| <span data-ttu-id="ff30f-182">Недоступно</span><span class="sxs-lookup"><span data-stu-id="ff30f-182">N/A</span></span> |
| | |

<span data-ttu-id="ff30f-183">Hello AzurePackConnector.ps1 добавить скрипт можно запустить сразу после развертывания, или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="ff30f-183">You can run hello Add-AzurePackConnector.ps1 script immediately after deployment, or later.</span></span> <span data-ttu-id="ff30f-184">toorun Здравствуйте сразу после развертывания скрипт, используйте hello же сеанса Windows PowerShell, где развертывания Azure стека.</span><span class="sxs-lookup"><span data-stu-id="ff30f-184">toorun hello script immediately after deployment, use hello same Windows PowerShell session where Azure Stack deployment completed.</span></span> <span data-ttu-id="ff30f-185">В противном случае можно открыть новый сеанс Windows PowerShell с правами администратора (выполнили вход как учетная запись azurestackadmin hello).</span><span class="sxs-lookup"><span data-stu-id="ff30f-185">Otherwise, you can open a new Windows PowerShell session as an administrator (signed in as hello azurestackadmin account).</span></span>

1. <span data-ttu-id="ff30f-186">Запустите сценарий hello AzurePackConnector.ps1 добавить с помощью hello, следующие команды (со средой определенные tooyour значения).</span><span class="sxs-lookup"><span data-stu-id="ff30f-186">Run hello Add-AzurePackConnector.ps1 script by using hello following commands (with values specific tooyour environment).</span></span> <span data-ttu-id="ff30f-187">Обратите внимание, hello AzurePackConnector добавить сценарий позволяет вам tooadd более одной конечной точки соединителя пакет Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="ff30f-187">Notice that hello Add-AzurePackConnector script enables you tooadd more than one Windows Azure Pack Connector endpoint.</span></span>
 
 ```powershell
    $cred = New-Object System.Management.Automation.PSCredential("cloudadmin@azurestack.local", `
    (ConvertTo-SecureString -String "<password>" -AsPlainText -Force))
    $session = New-PSSession -ComputerName 'azs-ercs01' `
     -Credential $cred `
     -ConfigurationName PrivilegedEndpoint `
     -Authentication Credssp

    # Enable Multicloud
    Invoke-Command -Session $session -ScriptBlock { Add-AzurePackConnector -AzurePackClouds `
    @{CloudName = "AzurePack_1"; CloudEndpoint = "https://waptenantportal1:40005"},`
    @{CloudName = "AzurePack_2"; CloudEndpoint = "https://waptenantportal2:40005" } `
    -AzureStackCloudName "AzureStack" }

 ```
> [!NOTE]
> <span data-ttu-id="ff30f-188">В текущем построении hello имеется проблема при окончании hello AzurePackConnector добавить скрипт остается в цикл опроса для длительного времени (несколько минут) до завершения.</span><span class="sxs-lookup"><span data-stu-id="ff30f-188">In hello current build there is an issue where after hello Add-AzurePackConnector script ends, it remains in a polling loop for an extended period of time (several minutes) until it ends.</span></span> <span data-ttu-id="ff30f-189">После появления сообщения hello **VERBOSE: шага «Настройка соединителя Azure Pack» состояние: «Успех»**, можно остановить hello сценарий или подождать, пока он перестает сам по себе.</span><span class="sxs-lookup"><span data-stu-id="ff30f-189">After you see hello message **VERBOSE: Step 'Configure Azure Pack Connector' status: 'Success'**, you can stop hello script or wait until it stops by itself.</span></span> <span data-ttu-id="ff30f-190">Он не будет провести различие, поскольку hello конфигурации уже завершилась успешно.</span><span class="sxs-lookup"><span data-stu-id="ff30f-190">It won’t make a difference because hello configuration has already succeeded.</span></span>

2. <span data-ttu-id="ff30f-191">Запишите hello выходные файлы, созданные с помощью этого сценария, один для каждой среды Windows Azure Pack, указанный вами.</span><span class="sxs-lookup"><span data-stu-id="ff30f-191">Make note of hello output files that are produced by this script, one for each Windows Azure Pack environment that you specified.</span></span> <span data-ttu-id="ff30f-192">Hello файлы расположены в: \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput.</span><span class="sxs-lookup"><span data-stu-id="ff30f-192">hello files are located at:  \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput.</span></span> <span data-ttu-id="ff30f-193">Эти файлы содержат hello сведения, необходимые tooconfigure hello целевых Windows Azure Pack средах.</span><span class="sxs-lookup"><span data-stu-id="ff30f-193">These files contain hello information that is required tooconfigure hello target Windows Azure Pack environments.</span></span> <span data-ttu-id="ff30f-194">Передать этот файл как сценарий tooa параметр позднее в этих инструкциях.</span><span class="sxs-lookup"><span data-stu-id="ff30f-194">You pass this file as a parameter tooa script later in these instructions.</span></span> <span data-ttu-id="ff30f-195">Этот файл содержит hello следующую информацию:</span><span class="sxs-lookup"><span data-stu-id="ff30f-195">This file contains hello following information:</span></span>

    * <span data-ttu-id="ff30f-196">**AzurePackConnectorEndpoint**: содержит toohello соединителя пакет Windows Azure hello конечной точки службы.</span><span class="sxs-lookup"><span data-stu-id="ff30f-196">**AzurePackConnectorEndpoint**: Contains hello endpoint toohello Windows Azure Pack Connector service.</span></span>
    * <span data-ttu-id="ff30f-197">**AuthenticationIdentityProviderPartner**: содержит hello следующие пары значение:</span><span class="sxs-lookup"><span data-stu-id="ff30f-197">**AuthenticationIdentityProviderPartner**: Contains hello following value pair:</span></span>
        * <span data-ttu-id="ff30f-198">Сертификат, который hello API клиента Windows Azure Pack для подписи маркера проверки подлинности должен tootrust tooaccept вызовы из hello расширения портала Azure стека.</span><span class="sxs-lookup"><span data-stu-id="ff30f-198">Authentication Token signing certificate that hello Windows Azure Pack Tenant API needs tootrust tooaccept calls from hello Azure Stack portal extension.</span></span>

        * <span data-ttu-id="ff30f-199">Здравствуйте, «Области», связанной с hello сертификата для подписи.</span><span class="sxs-lookup"><span data-stu-id="ff30f-199">hello "Realm" associated with hello signing certificate.</span></span> <span data-ttu-id="ff30f-200">Например: https://adfs.local.azurestack.global.external/adfs/c1d72562-534e-4aa5-92aa-d65df289a107/.</span><span class="sxs-lookup"><span data-stu-id="ff30f-200">For example: https://adfs.local.azurestack.global.external/adfs/c1d72562-534e-4aa5-92aa-d65df289a107/.</span></span>

3.  <span data-ttu-id="ff30f-201">Обзор toohello папку, которая содержит hello выходные файлы (\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput) и копировать файлы hello tooyour локального компьютера.</span><span class="sxs-lookup"><span data-stu-id="ff30f-201">Browse toohello folder that contains hello output files (\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput), and copy hello files tooyour local computer.</span></span> <span data-ttu-id="ff30f-202">файлы Hello будет выглядеть аналогично toothis: AzurePack-06-27-15-50.txt.</span><span class="sxs-lookup"><span data-stu-id="ff30f-202">hello files will look similar toothis: AzurePack-06-27-15-50.txt.</span></span>

4.  <span data-ttu-id="ff30f-203">Конфигурация теста hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-203">Test hello configuration.</span></span>

    <span data-ttu-id="ff30f-204">а.</span><span class="sxs-lookup"><span data-stu-id="ff30f-204">a.</span></span> <span data-ttu-id="ff30f-205">Откройте в браузере и войдите в портал пользователей Azure стека toohello (https://portal.local.azurestack.external/).</span><span class="sxs-lookup"><span data-stu-id="ff30f-205">Open your browser and sign in toohello Azure Stack user portal (https://portal.local.azurestack.external/).</span></span>
    
    <span data-ttu-id="ff30f-206">b.</span><span class="sxs-lookup"><span data-stu-id="ff30f-206">b.</span></span> <span data-ttu-id="ff30f-207">После входа в качестве клиента и hello портала загружает вы увидите ошибку в отсутствии подписок может toofetch или расширения из hello облако Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-207">After you sign in as a tenant and hello portal loads, you'll see errors about not being able toofetch subscriptions or extensions from hello Azure Pack cloud.</span></span> <span data-ttu-id="ff30f-208">Нажмите кнопку **ОК** tooclose эти сообщения.</span><span class="sxs-lookup"><span data-stu-id="ff30f-208">Click **OK** tooclose these messages.</span></span> <span data-ttu-id="ff30f-209">(Эти сообщения об ошибках исчезнут после настройки Windows Azure Pack.)</span><span class="sxs-lookup"><span data-stu-id="ff30f-209">(These error messages will go away after you configure Windows Azure Pack.)</span></span>

    <span data-ttu-id="ff30f-210">c.</span><span class="sxs-lookup"><span data-stu-id="ff30f-210">c.</span></span> <span data-ttu-id="ff30f-211">Обратите внимание hello **облака** раскрывающегося списка в левом верхнем углу hello hello портала.</span><span class="sxs-lookup"><span data-stu-id="ff30f-211">Notice hello **Cloud** drop-down list in hello upper-left corner of hello portal.</span></span>

    ![Селектор облака Hello в пользовательском интерфейсе hello стек Azure](media/azure-stack-manage-wap/image3.png)

## <a name="configure-windows-azure-pack"></a><span data-ttu-id="ff30f-213">Настройка Windows Azure Pack</span><span class="sxs-lookup"><span data-stu-id="ff30f-213">Configure Windows Azure Pack</span></span>
<span data-ttu-id="ff30f-214">Для этого соединителя предварительной версии пакета Windows Azure требуется ручная настройка.</span><span class="sxs-lookup"><span data-stu-id="ff30f-214">For this Connector preview release only, Windows Azure Pack requires manual configuration.</span></span>

>[!IMPORTANT]
<span data-ttu-id="ff30f-215">Для этой предварительной версии используйте hello соединителя пакет Windows Azure только в тестовой среде, а не в производственной среде.</span><span class="sxs-lookup"><span data-stu-id="ff30f-215">For this preview release, use hello Windows Azure Pack Connector only in test environments, and not in production deployments.</span></span>

1.  <span data-ttu-id="ff30f-216">Установите соединитель MSI-файлы на приветствия Windows Azure Pack портала виртуальная машина клиента и установить сертификаты.</span><span class="sxs-lookup"><span data-stu-id="ff30f-216">Install Connector MSI files on hello Windows Azure Pack tenant portal virtual machine, and install certificates.</span></span> <span data-ttu-id="ff30f-217">(При наличии нескольких виртуальных машин портала клиента, необходимо выполнить это действие для каждой виртуальной машины.)</span><span class="sxs-lookup"><span data-stu-id="ff30f-217">(If you have multiple tenant portal virtual machines, you must complete this step on each virtual machine.)</span></span>

    <span data-ttu-id="ff30f-218">а.</span><span class="sxs-lookup"><span data-stu-id="ff30f-218">a.</span></span> <span data-ttu-id="ff30f-219">В проводнике, скопируйте hello **WAPConnector** (что был загружен ранее) tooa папку с именем **c:\temp** hello клиента портала виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="ff30f-219">In File Explorer, copy hello **WAPConnector** folder (what you downloaded earlier) tooa folder named **c:\temp** in hello tenant portal virtual machine.</span></span>

    <span data-ttu-id="ff30f-220">b.</span><span class="sxs-lookup"><span data-stu-id="ff30f-220">b.</span></span> <span data-ttu-id="ff30f-221">Откройте консоль или RDP соединение toohello портала виртуальной машины клиента.</span><span class="sxs-lookup"><span data-stu-id="ff30f-221">Open a Console or RDP connection toohello tenant portal virtual machine.</span></span>

    <span data-ttu-id="ff30f-222">c.</span><span class="sxs-lookup"><span data-stu-id="ff30f-222">c.</span></span> <span data-ttu-id="ff30f-223">Измените каталоги слишком**c:\temp\wapconnector\setup\scripts**и выполнения hello **Connector.ps1 установки** tooinstall три MSI файлы сценариев.</span><span class="sxs-lookup"><span data-stu-id="ff30f-223">Change directories too**c:\temp\wapconnector\setup\scripts**, and run hello **Install-Connector.ps1** script tooinstall three MSI files.</span></span> <span data-ttu-id="ff30f-224">Параметры не требуются.</span><span class="sxs-lookup"><span data-stu-id="ff30f-224">No parameters are required.</span></span>

     ```powershell
    cd C:\temp\wapconnector\setup\scripts\

    .\Install-Connector.ps1
    ```
     <span data-ttu-id="ff30f-225">d.</span><span class="sxs-lookup"><span data-stu-id="ff30f-225">d.</span></span> <span data-ttu-id="ff30f-226">Измените каталоги слишком**c:\inetpub** и проверки установки hello три новых сайтов:</span><span class="sxs-lookup"><span data-stu-id="ff30f-226">Change directories too**c:\inetpub** and verify that hello three new sites are installed:</span></span>

       * <span data-ttu-id="ff30f-227">Соединитель MgmtSvc</span><span class="sxs-lookup"><span data-stu-id="ff30f-227">MgmtSvc-Connector</span></span>

       * <span data-ttu-id="ff30f-228">MgmtSvc ConnectorExtension</span><span class="sxs-lookup"><span data-stu-id="ff30f-228">MgmtSvc-ConnectorExtension</span></span>

       * <span data-ttu-id="ff30f-229">MgmtSvc ConnectorController</span><span class="sxs-lookup"><span data-stu-id="ff30f-229">MgmtSvc-ConnectorController</span></span>

    <span data-ttu-id="ff30f-230">д.</span><span class="sxs-lookup"><span data-stu-id="ff30f-230">e.</span></span> <span data-ttu-id="ff30f-231">Из hello же **c:\temp\wapconnector\setup\scripts** папки, запустите hello **Certificates.ps1 Настройка** скрипт tooinstall сертификаты.</span><span class="sxs-lookup"><span data-stu-id="ff30f-231">From hello same **c:\temp\wapconnector\setup\scripts** folder, run hello **Configure-Certificates.ps1** script tooinstall certificates.</span></span> <span data-ttu-id="ff30f-232">По умолчанию, он будет использовать hello одного сертификата, доступного для узла портала клиента hello в Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-232">By default, it will use hello same certificate that is available for hello Tenant Portal site in Windows Azure Pack.</span></span> <span data-ttu-id="ff30f-233">Убедитесь в том, что это действительный сертификат (доверенным для виртуальной машины Azure стека AzS-WASP01 hello и любого клиентского компьютера, получающего hello Azure стека портала).</span><span class="sxs-lookup"><span data-stu-id="ff30f-233">Make sure this is a valid certificate (trusted by hello Azure Stack AzS-WASP01 virtual machine and any client computer that accesses hello Azure Stack portal).</span></span> <span data-ttu-id="ff30f-234">В противном случае связи не будут работать.</span><span class="sxs-lookup"><span data-stu-id="ff30f-234">Otherwise, communication won’t work.</span></span> <span data-ttu-id="ff30f-235">(Кроме того, можно явно передать отпечаток сертификата как параметр с помощью hello - параметр отпечатка.)</span><span class="sxs-lookup"><span data-stu-id="ff30f-235">(Alternatively, you can explicitly pass a certificate thumbprint as a parameter by using hello -Thumbprint parameter.)</span></span>

     ```powershell
        cd C:\temp\wapconnector\setup\scripts\

        .\Configure-Certificates.ps1
    ```

    <span data-ttu-id="ff30f-236">f.</span><span class="sxs-lookup"><span data-stu-id="ff30f-236">f.</span></span> <span data-ttu-id="ff30f-237">Конфигурация hello toofinish эти три службы запуска hello **WapConnector.ps1 Настройка** параметры файла Web.config hello tooupdate сценария.</span><span class="sxs-lookup"><span data-stu-id="ff30f-237">toofinish hello configuration of these three services, run hello **Configure-WapConnector.ps1** script tooupdate hello Web.config file parameters.</span></span>

    |  <span data-ttu-id="ff30f-238">Параметр</span><span class="sxs-lookup"><span data-stu-id="ff30f-238">Parameter</span></span> | <span data-ttu-id="ff30f-239">Описание</span><span class="sxs-lookup"><span data-stu-id="ff30f-239">Description</span></span> | <span data-ttu-id="ff30f-240">Пример</span><span class="sxs-lookup"><span data-stu-id="ff30f-240">Example</span></span> |   
    | -------- | ------------- | ------- |  
    | <span data-ttu-id="ff30f-241">TenantPortalFQDN</span><span class="sxs-lookup"><span data-stu-id="ff30f-241">TenantPortalFQDN</span></span> | <span data-ttu-id="ff30f-242">портал клиента Windows Azure Pack Hello полное доменное имя.</span><span class="sxs-lookup"><span data-stu-id="ff30f-242">hello Windows Azure Pack tenant portal FQDN.</span></span> | <span data-ttu-id="ff30f-243">tenant.contoso.com</span><span class="sxs-lookup"><span data-stu-id="ff30f-243">tenant.contoso.com</span></span> | 
    | <span data-ttu-id="ff30f-244">TenantAPIFQDN</span><span class="sxs-lookup"><span data-stu-id="ff30f-244">TenantAPIFQDN</span></span> | <span data-ttu-id="ff30f-245">Здравствуйте, полное доменное имя Windows Azure Pack клиента API.</span><span class="sxs-lookup"><span data-stu-id="ff30f-245">hello Windows Azure Pack Tenant API FQDN.</span></span> | <span data-ttu-id="ff30f-246">tenantapi.contoso.com</span><span class="sxs-lookup"><span data-stu-id="ff30f-246">tenantapi.contoso.com</span></span>  |
    | <span data-ttu-id="ff30f-247">AzureStackPortalFQDN</span><span class="sxs-lookup"><span data-stu-id="ff30f-247">AzureStackPortalFQDN</span></span> | <span data-ttu-id="ff30f-248">пользовательский портал Azure стека Hello полное доменное имя.</span><span class="sxs-lookup"><span data-stu-id="ff30f-248">hello Azure Stack user portal FQDN.</span></span> | <span data-ttu-id="ff30f-249">Portal.local.azurestack.external</span><span class="sxs-lookup"><span data-stu-id="ff30f-249">portal.local.azurestack.external</span></span> |
    | | |
    
     ```powershell
    .\Configure-WapConnector.ps1 -TenantPortalFQDN "tenant.contoso.com" `
         -TenantAPIFQDN "tenantapi.contoso.com" `
         -AzureStackPortalFQDN "portal.local.azurestack.external"
    ```
    <span data-ttu-id="ff30f-250">ж.</span><span class="sxs-lookup"><span data-stu-id="ff30f-250">g.</span></span> <span data-ttu-id="ff30f-251">При наличии нескольких виртуальных машин портала клиента, повторите шаг 1 для каждого из этих виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="ff30f-251">If you have multiple tenant portal virtual machines, repeat step 1 for each of these virtual machines.</span></span>

2. <span data-ttu-id="ff30f-252">Установка hello новый MSI API клиента на каждой виртуальной машине API клиента Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="ff30f-252">Install hello new Tenant API MSI on each Windows Azure Pack Tenant API virtual machine.</span></span>

    <span data-ttu-id="ff30f-253">а.</span><span class="sxs-lookup"><span data-stu-id="ff30f-253">a.</span></span> <span data-ttu-id="ff30f-254">Если используется подсистемой балансировки нагрузки, вы можете toomark hello виртуальной машины как автономные.</span><span class="sxs-lookup"><span data-stu-id="ff30f-254">If a load balancer is in use, you may want toomark hello virtual machine as offline.</span></span>

    <span data-ttu-id="ff30f-255">b.</span><span class="sxs-lookup"><span data-stu-id="ff30f-255">b.</span></span> <span data-ttu-id="ff30f-256">В проводнике, скопируйте hello **WAPConnector** tooa папка с именем **c:\temp** на каждом компьютере, API клиента.</span><span class="sxs-lookup"><span data-stu-id="ff30f-256">In File Explorer, copy hello **WAPConnector** folder tooa folder named **c:\temp** on each Tenant API machine.</span></span>

    <span data-ttu-id="ff30f-257">c.</span><span class="sxs-lookup"><span data-stu-id="ff30f-257">c.</span></span> <span data-ttu-id="ff30f-258">Копирование файла hello AzurePackConnectorOutput.txt сохраненный ранее, слишком**c:\temp\WAPConnector**.</span><span class="sxs-lookup"><span data-stu-id="ff30f-258">Copy hello AzurePackConnectorOutput.txt file that you saved earlier, too**c:\temp\WAPConnector**.</span></span>

    <span data-ttu-id="ff30f-259">d.</span><span class="sxs-lookup"><span data-stu-id="ff30f-259">d.</span></span> <span data-ttu-id="ff30f-260">Откройте консоль или RDP соединение toohello виртуальных Машин API клиента, скопированные файлы hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-260">Open a Console or RDP connection toohello Tenant API VM you copied hello files to.</span></span>
    
    <span data-ttu-id="ff30f-261">д.</span><span class="sxs-lookup"><span data-stu-id="ff30f-261">e.</span></span> <span data-ttu-id="ff30f-262">Измените каталоги слишком**c:\temp\wapconnector\setup\scripts**и запустите **TenantAPI.ps1 обновление**.</span><span class="sxs-lookup"><span data-stu-id="ff30f-262">Change directories too**c:\temp\wapconnector\setup\scripts**, and run **Update-TenantAPI.ps1**.</span></span> <span data-ttu-id="ff30f-263">Эту новую версию API клиента WAP hello содержит tooenable изменение отношения доверия не только с текущей STS hello, но также с hello экземпляр AD FS в Azure стека.</span><span class="sxs-lookup"><span data-stu-id="ff30f-263">This new version of hello WAP Tenant API contains a change tooenable a trust relationship not only with hello current STS, but also with hello instance of AD FS in Azure Stack.</span></span>

     ```powershell
    cd C:\temp\wapconnector\setup\packages\

    .\Update-TenantAPI.ps1
    ```

    <span data-ttu-id="ff30f-264">f.</span><span class="sxs-lookup"><span data-stu-id="ff30f-264">f.</span></span>  <span data-ttu-id="ff30f-265">Повторите шаг 2 на другой виртуальной машине под управлением hello API клиента.</span><span class="sxs-lookup"><span data-stu-id="ff30f-265">Repeat step 2 on any other virtual machine running hello Tenant API.</span></span>
3. <span data-ttu-id="ff30f-266">Из **только один** hello виртуальных машин API клиента, выполняли tooadd сценария hello TrustAzureStack.ps1 Настройка отношения доверия между hello API клиента и экземпляр hello AD FS стек Azure.</span><span class="sxs-lookup"><span data-stu-id="ff30f-266">From **only one** of hello Tenant API VMs, run hello Configure-TrustAzureStack.ps1 script tooadd a trust relationship between hello Tenant API and hello AD FS instance on Azure Stack.</span></span> <span data-ttu-id="ff30f-267">Необходимо использовать учетную запись с базы данных Microsoft.MgmtSvc.Store toohello доступа sysadmin.</span><span class="sxs-lookup"><span data-stu-id="ff30f-267">You must use an account with sysadmin access toohello Microsoft.MgmtSvc.Store database.</span></span> <span data-ttu-id="ff30f-268">Этот сценарий состоит из hello следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="ff30f-268">This script has hello following parameters:</span></span>

    | <span data-ttu-id="ff30f-269">Параметр</span><span class="sxs-lookup"><span data-stu-id="ff30f-269">Parameter</span></span> | <span data-ttu-id="ff30f-270">Описание</span><span class="sxs-lookup"><span data-stu-id="ff30f-270">Description</span></span> | <span data-ttu-id="ff30f-271">Пример</span><span class="sxs-lookup"><span data-stu-id="ff30f-271">Example</span></span> |
    | --------- | ------------| ------- |
   | <span data-ttu-id="ff30f-272">SqlServer</span><span class="sxs-lookup"><span data-stu-id="ff30f-272">SqlServer</span></span> | <span data-ttu-id="ff30f-273">имя SQL Server, содержащий базы данных Microsoft.MgmtSvc.Store hello hello Hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-273">hello name of hello SQL Server that contains hello Microsoft.MgmtSvc.Store database.</span></span> <span data-ttu-id="ff30f-274">Этот параметр является обязательным.</span><span class="sxs-lookup"><span data-stu-id="ff30f-274">This parameter is required.</span></span> | <span data-ttu-id="ff30f-275">SQLServer</span><span class="sxs-lookup"><span data-stu-id="ff30f-275">SQLServer</span></span> | 
   | <span data-ttu-id="ff30f-276">файл данных</span><span class="sxs-lookup"><span data-stu-id="ff30f-276">DataFile</span></span> | <span data-ttu-id="ff30f-277">Hello выходной файл, который был создан во время настройки hello режима несколько компонентов в облаке Azure стека hello ранее.</span><span class="sxs-lookup"><span data-stu-id="ff30f-277">hello output file that was generated during hello configuration of hello Azure Stack multi-cloud mode earlier.</span></span> <span data-ttu-id="ff30f-278">Этот параметр является обязательным.</span><span class="sxs-lookup"><span data-stu-id="ff30f-278">This parameter is required.</span></span> | <span data-ttu-id="ff30f-279">AzurePack-06-27-15-50.txt</span><span class="sxs-lookup"><span data-stu-id="ff30f-279">AzurePack-06-27-15-50.txt</span></span> | 
   | <span data-ttu-id="ff30f-280">PromptForSqlCredential</span><span class="sxs-lookup"><span data-stu-id="ff30f-280">PromptForSqlCredential</span></span> | <span data-ttu-id="ff30f-281">Указывает, что скрипт hello должен запросить интерактивно toouse учетных данных проверки подлинности SQL при подключении экземпляра SQL Server toohello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-281">Indicates that hello script should prompt you interactively for a SQL Authentication credential toouse when connecting toohello SQL Server instance.</span></span> <span data-ttu-id="ff30f-282">Hello, учитывая учетных данных необходимо иметь достаточные разрешения toouninstall баз данных, схемы и удалить имена входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="ff30f-282">hello given credential must have sufficient permissions toouninstall databases, schemas, and delete user logins.</span></span> <span data-ttu-id="ff30f-283">Если не указан, hello сценарии предполагается, что этот контекст текущего пользователя есть доступ.</span><span class="sxs-lookup"><span data-stu-id="ff30f-283">If none is provided, hello script assumes that current user context has access.</span></span> | <span data-ttu-id="ff30f-284">Значение не требуется.</span><span class="sxs-lookup"><span data-stu-id="ff30f-284">No value is needed.</span></span> |
   |  |  |

    <span data-ttu-id="ff30f-285">Если вы не знаете toouse hello SQL Server, вы можете узнать.</span><span class="sxs-lookup"><span data-stu-id="ff30f-285">If you don't know hello SQL Server toouse, you can discover it.</span></span> <span data-ttu-id="ff30f-286">Подключите компьютер toohello API клиента и использовать файл Web.config интерфейса API клиента hello toounprotect команд hello Unprotect MgmtSvc hello, имя сервера в строке подключения hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-286">Connect toohello Tenant API computer, use hello Unprotect-MgmtSvc command toounprotect hello Tenant API Web.config file, and look for hello server name in hello connection string.</span></span> <span data-ttu-id="ff30f-287">Снова помните toorun MgmtSvc защитить файл Web.config интерфейса API клиента tooprotect hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-287">Remember toorun Protect-MgmtSvc again tooprotect hello Tenant API Web.config file.</span></span>

  ```powershell
  cd C:\temp\wapconnector\setup\scripts\

 .\Configure-TrustAzureStack.ps1 -SqlServer "SQLServer" `
       -DataFile "C:\temp\wapconnector\AzurePackConnectorOutput.txt"
  ```

## <a name="example"></a><span data-ttu-id="ff30f-288">Пример</span><span class="sxs-lookup"><span data-stu-id="ff30f-288">Example</span></span>
<span data-ttu-id="ff30f-289">Hello следующем примере показано полное развертывание соединителя пакет Windows Azure одним узлом стек Azure и две установки пакета Windows Azure Express.</span><span class="sxs-lookup"><span data-stu-id="ff30f-289">hello following example shows a complete Windows Azure Pack Connector deployment on a single-node Azure Stack configuration and two Windows Azure Pack Express installations.</span></span> <span data-ttu-id="ff30f-290">(Каждый экспресс-установки находится на одном компьютере с именами пример hello *wapcomputer1* и*wapcomputer2*.)</span><span class="sxs-lookup"><span data-stu-id="ff30f-290">(Each Express installation is on a single computer, with hello example names *wapcomputer1* and*wapcomputer2*.)</span></span>

```powershell
# Run hello following script on hello Azure Stack host
$cred = New-Object System.Management.Automation.PSCredential("cloudadmin@azurestack.local",`
     (ConvertTo-SecureString -String "p@ssw0rd" -AsPlainText -Force))
$session = New-PSSession -ComputerName 'azs-ercs01' -Credential $cred `
     -ConfigurationName PrivilegedEndpoint -Authentication Credssp
 
# Enable Multicloud
invoke-command -Session $session -ScriptBlock { Add-AzurePackConnector -AzurePackClouds `
     @{CloudName = "AzurePack_1"; CloudEndpoint = "https://wapcomputer1.contoso.com:40005"},`
     @{CloudName = "AzurePack_2"; CloudEndpoint = "https://wapcomputer2.contoso.com:40005"}`
     -AzureStackCloudName "AzureStack" }  

```
<span data-ttu-id="ff30f-291">Загрузите файл .exe hello из hello [центра загрузки Майкрософт](https://aka.ms/wapconnectorazurestackdlc), извлеките его и скопируйте папку tooa hello WAPConnector **c:\temp** папку на компьютере Windows Azure Pack hello.</span><span class="sxs-lookup"><span data-stu-id="ff30f-291">Download hello .exe file from hello [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), extract it, and copy hello WAPConnector folder tooa **c:\temp** folder on hello Windows Azure Pack computer.</span></span> <span data-ttu-id="ff30f-292">Скопируйте файлы hello, которые были созданы в качестве выходных данных в предыдущем сценарии hello (расположенный в \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput) toohello **c:\temp\WAPConnector** папки.</span><span class="sxs-lookup"><span data-stu-id="ff30f-292">Copy hello files that were generated as output in hello previous script (located at \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput) toohello **c:\temp\WAPConnector** folder.</span></span> <span data-ttu-id="ff30f-293">(hello файлы будут выглядит примерно toothis: AzurePack-06-27-15-50.txt.) Затем выполните следующий сценарий один раз в экземпляр Windows Azure Pack hello:</span><span class="sxs-lookup"><span data-stu-id="ff30f-293">(hello files will looks similar toothis: AzurePack-06-27-15-50.txt.) Then, run hello following script, once per instance of Windows Azure Pack:</span></span>

 ```powershell
# Install Connector components
cd C:\temp\WAPConnector\Setup\Scripts
.\Install-Connector.ps1

# Configure Certificates for hello new Connector services
.\Configure-Certificates.ps1

# Configure hello Connector services
.\Configure-WapConnector.ps1 -TenantPortalFQDN "wapcomputer1.contoso.com" `
     -TenantAPIFQDN "wapcomputer1.contoso.com" `
     -AzureStackPortalFQDN "portal.local.azurestack.external"

# Install hello updated TenantAPI
.\Update-TenantAPI.ps1

# Establish trust with hello Azure Stack AD FS
.\Configure-TrustAzureStack.ps1 -SqlServer "wapcomputer1" `
     -DataFile "C:\temp\wapconnector\AzurePack-06-27-15-50.txt" 

```
## <a name="troubleshooting-tips"></a><span data-ttu-id="ff30f-294">Советы по устранению неполадок</span><span class="sxs-lookup"><span data-stu-id="ff30f-294">Troubleshooting tips</span></span>
1.  <span data-ttu-id="ff30f-295">Убедитесь, что имеется сетевое соединение между стек Azure и пакета Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="ff30f-295">Ensure there is network connectivity between Azure Stack and Windows Azure Pack.</span></span> <span data-ttu-id="ff30f-296">Это подключение должно быть между любой компьютере клиента, который обращается к портала Azure стека hello и hello Windows Azure Pack портала виртуальная машина клиента запущенным hello новый соединитель служб.</span><span class="sxs-lookup"><span data-stu-id="ff30f-296">This connectivity should be between any tenant computer that accesses hello Azure Stack portal and hello Windows Azure Pack tenant portal virtual machine where hello new Connector services are running.</span></span>
2.  <span data-ttu-id="ff30f-297">Убедитесь, что все указанные правильность полных доменных имен.</span><span class="sxs-lookup"><span data-stu-id="ff30f-297">Ensure that all specified FQDNs are correct.</span></span>
3.  <span data-ttu-id="ff30f-298">Убедитесь, что hello SSL-сертификатов, используемых в новые службы соединителя hello доверия со стороны Azure стека (в частности hello AzS WASP01 ВМ) и любым другим клиентом hello компьютер может использовать tooaccess hello Azure стека пользовательского портала.</span><span class="sxs-lookup"><span data-stu-id="ff30f-298">Ensure that hello SSL certificates used in hello new Connector services are trusted by Azure Stack (specifically hello AzS-WASP01 VM) and any other computer hello tenant may use tooaccess hello Azure Stack user portal.</span></span>
4. <span data-ttu-id="ff30f-299">Известные проблемы см. в разделе [Устранение неполадок Microsoft Azure стека](azure-stack-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="ff30f-299">For known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span></span>


## <a name="next-steps"></a><span data-ttu-id="ff30f-300">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ff30f-300">Next steps</span></span>
[<span data-ttu-id="ff30f-301">С помощью hello порталы администратора и пользователя в стек Azure</span><span class="sxs-lookup"><span data-stu-id="ff30f-301">Using hello administrator and user portals in Azure Stack</span></span>](azure-stack-manage-portals.md)
