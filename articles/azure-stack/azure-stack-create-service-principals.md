---
title: "Создание субъекта-службы для Azure стека | Документы Microsoft"
description: "В этой статье описывается создание нового участника службы, который может использоваться для управления доступом к ресурсам с помощью элемента управления доступом на основе ролей в диспетчере ресурсов Azure."
services: azure-resource-manager
documentationcenter: na
author: heathl17
manager: byronr
ms.assetid: 7068617b-ac5e-47b3-a1de-a18c918297b6
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/26/2017
ms.author: helaw
ms.openlocfilehash: b3992b296d5a999601eb69b071559f9d37dacf8f
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="provide-applications-access-to-azure-stack"></a>Предоставление доступа приложений к стек Azure
При приложению доступ для развертывания или настройте ресурсами с помощью диспетчера ресурсов Azure в стек Azure, вы создаете субъект-служба, являющийся учетных данных для приложения.  Затем можно делегировать только необходимые разрешения для этого участника службы.  

Например имеется средство управления конфигурации, которое использует диспетчера ресурсов Azure для инвентаризации ресурсов Azure.  В этом случае можно создать участника службы, предоставления роли чтения данных этого участника службы и ограничить средство управления конфигурации для доступа только для чтения. 

Субъекты-службы предпочтительнее выполнение приложения в своих собственных учетных данных, так как:

* Можно назначить разрешения для участника, отличаются от разрешений учетной записи службы. Как правило, приложение получает именно те разрешения, которые требуются для его работы.
* Не требуется изменять учетные данные приложения в случае изменения ваших обязанностей.
* Можно использовать сертификат, чтобы автоматизировать аутентификацию при выполнении автоматического сценария.  

## <a name="getting-started"></a>Приступая к работе

В зависимости от способа развертывания Azure стека начните с создания участника службы.  Этот документ поможет создать участника-службы для обоих [Azure Active Directory (Azure AD)](azure-stack-create-service-principals.md#create-service-principal-for-azure-ad) и [Services(AD FS) федерации Active Directory](azure-stack-create-service-principals.md#create-service-principal-for-ad-fs).  После создания участника службы, набор общих шагов в AD FS и Azure Active Directory используются для [делегировать разрешения](azure-stack-create-service-principals.md#assign-role-to-service-principal) к роли.     

## <a name="create-service-principal-for-azure-ad"></a>Создание участника службы для Azure AD

При развертывании с помощью Azure AD в качестве хранилища идентификаторов стек Azure можно создать участников службы, так же, как и для Azure.  В этом разделе показано, как выполнять действия на портале.  Убедитесь, что у вас есть [Azure AD разрешения, необходимые](../azure-resource-manager/resource-group-create-service-principal-portal.md#required-permissions) перед началом.

### <a name="create-service-principal"></a>Создание субъекта-службы
В этом разделе создается приложение (субъекта-службы) в Azure AD, который будет представлять приложение.

1. Войдите в учетную запись Azure на [портале Azure](https://portal.azure.com).
2. Выберите **Azure Active Directory** > **регистрации приложения** > **добавить**   
3. Укажите имя и URL-адрес для приложения. Выберите тип создаваемого приложения: **веб-приложение или API** или **собственное приложение**. Выбрав нужные значения, нажмите кнопку **Создать**.

Вы создали субъекта-службы для приложения.

### <a name="get-credentials"></a>Получить учетные данные
Программным способом входа в систему используется идентификатор для приложения и ключ проверки подлинности. Получить эти значения можно следующим образом.

1. В Active Directory в разделе **регистрации приложений** выберите нужное приложение.

2. Скопируйте **идентификатор приложения** и сохраните его в коде приложения. Приложения в разделе [примеров приложений](#sample-applications) используют это значение как идентификатор клиента.

     ![Идентификатор клиента](./media/azure-stack-create-service-principal/image12.png)
3. Чтобы создать ключ проверки подлинности, щелкните **Ключи**.

4. Введите описание и срок действия ключа. Затем нажмите кнопку **Сохранить**.

После этого отобразится значение ключа. Это значение нельзя будет получить позже, поэтому скопируйте его сразу. Укажите значение ключа с Идентификатором приложения для подписи приложения. Сохраните значение ключа, чтобы приложение могло получить к нему доступ.

![сохраненный ключ](./media/azure-stack-create-service-principal/image15.png)


После завершения, перейдите к [назначение роли приложения](azure-stack-create-service-principals.md#assign-role-to-service-principal).

## <a name="create-service-principal-for-ad-fs"></a>Создание участника службы для AD FS
Если вы развернули Azure стека с AD FS, можно использовать PowerShell для создания участника службы, назначение роли для доступа и входа с PowerShell, с использованием указанного удостоверения.

### <a name="before-you-begin"></a>Перед началом работы

[Загрузите средства, необходимые для работы со стеком Azure на локальный компьютер.](azure-stack-powershell-download.md)

### <a name="import-the-identity-powershell-module"></a>Импортируйте модуль PowerShell идентификаторов
После загрузки средств, перейдите в папку загруженные и импортируйте модуль PowerShell идентификаторов с помощью следующей команды:

```PowerShell
Import-Module .\Identity\AzureStack.Identity.psm1
```

При импорте модуля может появиться сообщение об ошибке: «AzureStack.Connect.psm1 не имеет цифровой подписи. Скрипт не будет выполняться в системе». Чтобы устранить эту проблему, можно задать политику выполнения и разрешить запуск скрипта с помощью следующей команды в сеансе PowerShell с повышенными привилегиями:

```PowerShell
Set-ExecutionPolicy Unrestricted
```

### <a name="create-the-service-principal"></a>Создание субъекта-службы
Можно создать субъект-службу, выполнив следующую команду, убедившись, что обновление *DisplayName* параметр:
```powershell
$servicePrincipal = New-AzSADGraphServicePrincipal `
 -DisplayName "<YourServicePrincipalName>" `
 -AdminCredential $(Get-Credential) `
 -AdfsMachineName "AZS-ADFS01" `
 -Verbose
```
### <a name="assign-a-role"></a>Назначение роли
После создания участника службы необходимо [назначение роли](azure-stack-create-service-principals.md#assign-role-to-service-principal)

### <a name="sign-in-through-powershell"></a>Войти с помощью PowerShell
После был назначен роли, вы сможете войти в стек Azure, используя имя участника службы с помощью следующей команды:

```powershell
Add-AzureRmAccount -EnvironmentName "<AzureStackEnvironmentName>" `
 -ServicePrincipal `
 -CertificateThumbprint $servicePrincipal.Thumbprint `
 -ApplicationId $servicePrincipal.ApplicationId ` 
 -TenantId $directoryTenantId
```

## <a name="assign-role-to-service-principal"></a>Назначение роли участника-службы
Чтобы обеспечить доступ к ресурсам в подписке, необходимо назначить приложению роль. Укажите, какая роль предоставит приложению необходимые разрешения. Дополнительные сведения о доступных ролях см. в статье [RBAC: встроенные роли](../active-directory/role-based-access-built-in-roles.md).

Вы можете задать область действия на уровне подписки, группы ресурсов или ресурса. Разрешения наследуют более низкие уровни области действия. Например, добавление приложения в роль читателя для группы ресурсов означает, что оно может считывать группу ресурсов и все содержащиеся в ней ресурсы.

1. На портале Azure стека перейдите на уровень области действия, которые вы хотите назначить приложению. Например, чтобы назначить роль в области действия подписки выберите **Подписки**. Или же вы можете выбрать группу ресурсов либо отдельный ресурс.

2. Выберите определенную подписку, группу ресурсов или ресурс, которым будет назначено приложение.

     ![выбрать подписку для назначения](./media/azure-stack-create-service-principal/image16.png)

3. Выберите **Управление доступом (IAM)**.

     ![выбрать доступ](./media/azure-stack-create-service-principal/image17.png)

4. Выберите **Добавить**.

5. Выберите роль, которая будет назначена приложению.

6. Найдите приложение и выберите его.

7. Нажмите кнопку **ОК**, чтобы завершить назначение роли. Вы увидите свое приложение в списке пользователей, назначенных выбранной роли для выбранной области действия.

Теперь, создания участника службы и назначить роль, можно начать с помощью этого приложения для доступа к ресурсам Azure стека.  

## <a name="next-steps"></a>Дальнейшие действия

[Добавление пользователей для служб федерации Active Directory](azure-stack-add-users-adfs.md)
[управлять разрешениями пользователей](azure-stack-manage-permissions.md)