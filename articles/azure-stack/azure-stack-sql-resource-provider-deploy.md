---
title: "С помощью базы данных SQL Azure стек | Документы Microsoft"
description: "Дополнительные сведения о развертывании баз данных SQL как служба Azure стека и быстрых действий, чтобы развернуть адаптер поставщика ресурсов SQL Server"
services: azure-stack
documentationCenter: 
author: JeffGoldner
manager: bradleyb
editor: 
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/10/2017
ms.author: JeffGo
ms.openlocfilehash: 018d556d52aa1a1f436460d9811c43f9b45bd440
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="use-sql-databases-on-microsoft-azure-stack"></a>Использование баз данных SQL Microsoft Azure стеке


Используется адаптером поставщика ресурсов SQL Server для предоставления баз данных SQL, как служба Azure стека. После установки поставщика ресурсов и подключите его к один или несколько экземпляров SQL Server, вас и ваших пользователей можно создавать базы данных для рабочих нагрузок, основанных на SQL без необходимости подготовки (виртуальной машины, облако в собственном коде приложений и веб-сайтов, которые основаны на SQL Виртуальная машина), на котором размещается SQL Server каждый раз.

Поставщик ресурсов не поддерживает все возможности управления базами данных из [базы данных SQL Azure](https://azure.microsoft.com/services/sql-database/). Например пулы эластичных баз данных и возможность масштабирования производительности базы данных не поддерживаются. API-Интерфейс несовместим с баз данных SQL Server.


## <a name="sql-server-resource-provider-adapter-architecture"></a>Архитектура адаптера поставщика ресурсов SQL Server
Поставщик ресурсов не основан на, а также его есть все базы данных возможности управления базы данных SQL Azure. Например недоступны пулы эластичных баз данных и возможности подключения автоматически производительность базы данных вверх и вниз. Тем не менее ресурс поставщик поддерживает аналогичные создания, чтения, обновления и удаления (CRUD).

Поставщик ресурсов состоит из трех компонентов:

- **Адаптер поставщика ресурсов SQL виртуальной Машины**, который является виртуальной машине, где запущены службы поставщика.
- **Поставщик ресурсов**, который обрабатывает запросы на подготовку, и предоставляет доступ к базе данных ресурсов.
- **Серверы, на которых размещаются SQL Server**, предоставляющие емкости для баз данных, называемые серверами размещения. 

Этот выпуск больше не создает экземпляр SQL Server. Необходимо создать один (или несколько) и/или предоставления доступа к внешней экземпляры SQL Server. Существует несколько параметров, доступных шаблонов в том числе [коллекции быстрый запуск Azure стека](https://github.com/Azure/AzureStack-QuickStart-Templates/tree/master/mysql-standalone-server-windows) и элементы Marketplace. 

>[!NOTE]
Если вы загрузили какие-либо элементы SQL Marketplace, убедитесь, что также загрузить расширения SQL IaaS или они не будут развернуты.


## <a name="deploy-the-resource-provider"></a>Разверните поставщик ресурсов

1. Если вы еще не сделали регистрации вашего пакета средств разработки и загрузить образ Windows Server 2016 EVAL загружаемых посредством управления Marketplace. Можно также использовать сценарий для создания [образа Windows Server 2016](https://docs.microsoft.com/azure/azure-stack/azure-stack-add-default-image). Среда выполнения .NET 3.5 больше не требуется.

2. [Загрузите файл двоичных файлов поставщика ресурсов SQL](https://aka.ms/azurestacksqlrp) и извлеките его на узле разработки пакета.

3. Войдите в узел комплект средств для разработки и извлеките файл установщика SQL RP во временный каталог.

4. Стек Azure корневой сертификат извлекается и самозаверяющий сертификат создается как часть этого процесса. 

    __Необязательно:__ Если необходимо предоставить собственную, Подготовка сертификатов и скопировать в локальный каталог, если вы хотите настроить сертификаты (передачи в сценарий установки). Требуются следующие сертификаты:

    а. Сертификатом с подстановочными символами для *.dbadapter. \<область\>.\< полного доменного имени\>. Этот сертификат должен быть доверенным, такие как будет выдан центром сертификации (то есть цепочку доверия должен существовать без промежуточных сертификатов.) (Один сайт сертификат можно использовать с явной имя виртуальной Машины, указываемые во время установки.)

    b. Корневой сертификат, используемый диспетчером ресурсов Azure для экземпляра Azure стека. Если он не найден, будет получен корневой сертификат.


5. Откройте **новый** с повышенными привилегиями консоль PowerShell и изменения в каталоге, где были извлечены файлы. Используйте новое окно, чтобы избежать проблемы, которые могут быть вызваны неверные модули PowerShell, которые уже загружены в системе.

6. После установки любой версии AzureRm или AzureStack PowerShell модулей, кроме 1.2.9 или 1.2.10, вам будет предложено удалить их или установку не удастся. Сюда входят версии 1.3 или выше.

7. Запустите сценарий DeploySqlProvider.ps1 с перечисленными ниже параметрами.

Скрипт выполняет следующие действия.

* При необходимости, загрузите совместимую версию Azure PowerShell.
* Учетная запись хранения в комплекте Azure для передачи сертификаты и другие артефакты.
* Опубликуйте пакеты коллекции, чтобы выполнить развертывание базы данных SQL из коллекции.
* Развертывание виртуальной Машины с помощью образа Windows Server 2016, созданной на шаге 1 и установка поставщика ресурсов.
* Зарегистрируйте локальный DNS-запись, сопоставляемый с поставщиком ресурсов виртуальной Машины.
* Регистрация поставщика ресурсов с помощью локального диспетчера ресурсов Azure (клиента и администратора).

> [!NOTE]
> Если установка занимает более 90 минут, может произойти сбой вы видите сообщение об ошибке на экране и в файле журнала, а развертывание повторяется с шага сбоя. Системы, не соответствует рекомендуемым характеристикам памяти и основных компонентов не может иметь возможность развернуть SQL RP.
>

Ниже приведен пример, можно запустить из PowerShell запрашивать (но при необходимости изменить конечные точки сведения и портала учетной записи):

```
# Install the AzureRM.Bootstrapper module
Install-Module -Name AzureRm.BootStrapper -Force

# Installs and imports the API Version Profile required by Azure Stack into the current PowerShell session.
Use-AzureRmProfile -Profile 2017-03-09-profile
Install-Module -Name AzureStack -RequiredVersion 1.2.10 -Force

# Download the Azure Stack Tools from GitHub and set the environment
cd c:\
Invoke-Webrequest https://github.com/Azure/AzureStack-Tools/archive/master.zip -OutFile master.zip
Expand-Archive master.zip -DestinationPath . -Force

# This endpoint may be different for your installation
Import-Module C:\AzureStack-Tools-master\Connect\AzureStack.Connect.psm1
Add-AzureRmEnvironment -Name AzureStackAdmin -ArmEndpoint "https://adminmanagement.local.azurestack.external" 

# For AAD, use the following
$tenantID = Get-AzsDirectoryTenantID -AADTenantName "<your directory name>" -EnvironmentName AzureStackAdmin

# For ADFS, replace the previous line with
# $tenantID = Get-AzsDirectoryTenantID -ADFS -EnvironmentName AzureStackAdmin

$vmLocalAdminPass = ConvertTo-SecureString "P@ssw0rd1" -AsPlainText -Force
$vmLocalAdminCreds = New-Object System.Management.Automation.PSCredential ("sqlrpadmin", $vmLocalAdminPass)

$AdminPass = ConvertTo-SecureString "P@ssw0rd1" -AsPlainText -Force
$AdminCreds = New-Object System.Management.Automation.PSCredential ("admin@mydomain.onmicrosoft.com", $AdminPass)

# change this as appropriate
$PfxPass = ConvertTo-SecureString "P@ssw0rd1" -AsPlainText -Force

# Change directory to the folder where you extracted the installation files 
# and adjust the endpoints
<extracted file directory>\DeploySQLProvider.ps1 -DirectoryTenantID $tenantID -AzCredential $AdminCreds -VMLocalCredential $vmLocalAdminCreds -ResourceGroupName "SqlRPRG" -VmName "SqlVM" -ArmEndpoint "https://adminmanagement.local.azurestack.external" -TenantArmEndpoint "https://management.local.azurestack.external" -DefaultSSLCertificatePassword $PfxPass
 ```

### <a name="deploysqlproviderps1-parameters"></a>Параметры DeploySqlProvider.ps1
Эти параметры можно указать в командной строке. Если этого не сделать, или происходит сбой проверки параметров, вам будет предложено предоставить необходимые методы.

| Имя параметра | Описание | Комментарий или значение по умолчанию |
| --- | --- | --- |
| **DirectoryTenantID** | Azure и каталог служб федерации Active Directory с Идентификатором (guid). | _Обязательно_ |
| **AzCredential** | Учетные данные для учетной записи администратора служб Azure стека. Необходимо использовать те же учетные данные используются для развертывания Azure стека). | _Обязательно_ |
| **VMLocalCredential** | Укажите учетные данные учетной записи локального администратора поставщика ресурсов SQL виртуальной Машины. Этот пароль также используется для SQL **sa** учетной записи. | _Обязательно_ |
| **ResourceGroupName** | Определите имя для группы ресурсов, в котором будут храниться элементы, созданный этим сценарием. Например *SqlRPRG*. |  _Обязательно_ |
| **VmName** | Укажите имя виртуальной машины, на котором требуется установить поставщик ресурсов. Например *SqlVM*. |  _Обязательно_ |
| **DependencyFilesLocalPath** | Файлы сертификата должен быть помещен в этот каталог также. | _Необязательный_ |
| **DefaultSSLCertificatePassword** | Пароль для PFX-сертификата | _Обязательно_ |
| **Значение параметра MaxRetryCount** | Определите сколько раз повторить каждой операции, если имеется ошибка.| 2 |
| **RetryDuration** | Укажите время ожидания между повторными попытками в секундах. | 120 |
| **Удаление** | Удалить поставщик ресурсов и все связанные ресурсы (см. примечания ниже) | Нет |
| **DebugMode** | Предотвращает автоматическую очистку в случае ошибки | Нет |


## <a name="verify-the-deployment-using-the-azure-stack-portal"></a>Проверка развертывания на портале Azure стека

> [!NOTE]
>  После завершения сценария установки, необходимо будет обновить портал для см. в колонке администратора.


1. На рабочем столе виртуальной Машины в консоли щелкните **стека портал Microsoft Azure** и выполните вход на портал администратора службы.

2. Проверьте успешность развертывания. Нажмите кнопку **групп ресурсов** &gt; щелкните группы ресурсов, который использовался, а затем убедитесь, что компонент essentials колонке (верхняя половина) операции чтения  **_даты_ (успешно)**.

      ![Проверка развертывания SQL RP](./media/azure-stack-sql-rp-deploy/sqlrp-verify.png)


## <a name="provide-capacity-by-connecting-to-a-hosting-sql-server"></a>Укажите емкость, подключившись к серверу управления SQL

1. Войдите в портал администрирования стек Azure как администратор службы

2. Создание виртуальной машины SQL, если таковая имеется уже доступны. Marketplace управления предлагает некоторые возможности для развертывания виртуальных машин SQL.

3. Нажмите кнопку **поставщиков ресурсов** &gt; **SQLAdapter** &gt; **серверы размещения** &gt; **+ добавить**.

    **Серверов размещения SQL** колонка находится где поставщика ресурсов SQL Server могут подключаться к фактических экземпляров SQL Server, используемые в качестве серверной части поставщик ресурсов.

    ![Серверы размещения](./media/azure-stack-sql-rp-deploy/sqlrp-hostingserver.PNG)

4. Заполнение формы данные подключения к экземпляру SQL Server.

    ![Новый сервер размещения](./media/azure-stack-sql-rp-deploy/sqlrp-newhostingserver.PNG)

    > [!NOTE]
    > До тех пор, пока экземпляр SQL может осуществляться клиента и администратора диспетчера ресурсов Azure, можно поместить в группе управления поставщика ресурсов. Экземпляр SQL __должен__ выделить исключительно для RP.

5. При добавлении серверов, их необходимо назначить новую или существующую номера SKU для различения предложения услуг. Например может иметь экземпляр SQL Enterprise, предоставляя объем базы данных и автоматическое резервное копирование, зарезервировать высокопроизводительных серверов для отдельных подразделений и т. д. Имя SKU должны отражать свойства, чтобы соответствующим образом клиентов можно размещать свои базы данных и все серверы размещения в номере SKU должен иметь те же возможности.

    Пример:

    ![Номера SKU](./media/azure-stack-sql-rp-deploy/sqlrp-newsku.png)

>[!NOTE]
Номера SKU может занять до часа должен отображаться на портале. Невозможно создать базу данных, пока не будет создан SKU.


## <a name="create-your-first-sql-database-to-test-your-deployment"></a>Создание первой базы данных SQL для тестирования развертывания

1. Войдите в портал администрирования стек Azure как администратора службы.

2. Нажмите кнопку **+ создать** &gt; **данные + хранилище»** &gt; **базы данных SQL Server (Предварительная версия)** &gt; **добавить**.

3. Заполните форму с сведения о базе данных, включая **имя базы данных**, **максимальный размер**и при необходимости измените другие параметры. Вам будет предложено выбрать SKU для базы данных. По мере добавления серверов размещения они назначаются SKU и базы данных создаются в этом пуле размещения серверов, которые составляют SKU.

    ![Новая база данных](./media/azure-stack-sql-rp-deploy/newsqldb.png)


4. Заполните параметры входа: **входа базы данных**, и **пароль**. Это учетные данные проверки подлинности SQL, созданный для доступа к этой базе данных только. Имя пользователя должно быть глобально уникальным. Создайте новый параметр имени входа или выберите существующий. Можно повторно использовать параметры входа для других баз данных с помощью того же SKU.

    ![Создать новое имя входа базы данных](./media/azure-stack-sql-rp-deploy/create-new-login.png)


5. Отправить форму и ожидания для завершения развертывания.

    В колонке полученный Обратите внимание, поле «Строка соединения». В комплекте Azure можно использовать этой строки в любое приложение, которое требуется доступ к SQL Server (например, веб-приложение).

    ![Получить строку подключения](./media/azure-stack-sql-rp-deploy/sql-db-settings.png)

## <a name="add-capacity"></a>Добавить емкость

Добавление емкости путем добавления дополнительных узлов SQL на портале Azure стека и связать их с соответствующий номер SKU. Если вы хотите использовать другой экземпляр SQL Server вместо того, установлен на поставщика виртуальной Машины, нажмите кнопку **поставщиков ресурсов** &gt; **SQLAdapter** &gt; **размещения SQL Серверы** &gt; **+ добавить**.

## <a name="making-sql-databases-available-to-tenants"></a>Предоставление клиентам баз данных SQL

Создайте планы и предложения для предоставления базы данных SQL для клиентов. Необходимо создать план, добавьте службу Microsoft.SqlAdapter к плану и добавить существующую квоту или создать новую. При создании квоты, можно указать возможность разрешить клиента.
    ![Создание планов и предложения для включения базы данных](./media/azure-stack-sql-rp-deploy/sqlrp-newplan.png)

## <a name="tenant-usage-of-the-resource-provider"></a>Использование клиента поставщика ресурсов

Самообслуживания баз данных доступны через интерфейс портала клиента.

## <a name="removing-the-sql-adapter-resource-provider"></a>Удаление поставщика ресурсов адаптера SQL

Чтобы удалить поставщик ресурсов, необходимо сначала удалить все зависимости.

1. Убедитесь, что у вас есть исходный пакет развертывания, загруженный для этой версии поставщика ресурсов.

2. Все базы данных клиента, необходимо удалить из поставщика ресурсов (это не удалит данные). Это следует выполнять с сами клиенты.

3. Администратор должен удалить серверы размещения из адаптера SQL

4. Администратор должен удалить все планы, которые ссылаются на адаптере SQL.

5. Администратору необходимо удалить все номера SKU и квоты, связанные с адаптера SQL.

6. Снова запустите скрипт развертывания с удалить параметр, конечные точки диспетчера ресурсов Azure, DirectoryTenantID и учетные данные для учетной записи администратора службы.



## <a name="next-steps"></a>Дальнейшие действия


Попробуйте другой [служб PaaS](azure-stack-tools-paas-services.md) как [поставщик ресурсов MySQL Server](azure-stack-mysql-resource-provider-deploy.md) и [поставщик ресурсов службы приложений](azure-stack-app-service-overview.md).
