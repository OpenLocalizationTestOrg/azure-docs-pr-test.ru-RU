---
title: "приложения Azure Service Bus aaaInsulating от сбоев и аварий | Документы Microsoft"
description: "Описание методов, можно использовать tooprotect приложений от возможных перебоев Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: 349b4968456c9f15375753d83495246f5a3ddfdb
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="2b587-103">Рекомендации по изолированию приложений от простоев и аварий служебной шины</span><span class="sxs-lookup"><span data-stu-id="2b587-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="2b587-104">Критически важные приложения должны работать постоянно даже при наличии hello незапланированных простоях или авариях.</span><span class="sxs-lookup"><span data-stu-id="2b587-104">Mission-critical applications must operate continuously, even in hello presence of unplanned outages or disasters.</span></span> <span data-ttu-id="2b587-105">В этом разделе описаны методы, которые можно использовать приложения Service Bus tooprotect от потенциальных простоя службы или аварии.</span><span class="sxs-lookup"><span data-stu-id="2b587-105">This topic describes techniques you can use tooprotect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="2b587-106">Сбой определяется как Временная недоступность hello Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="2b587-106">An outage is defined as hello temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="2b587-107">Hello может затронуть некоторые компоненты Service Bus, например хранилище сообщений, или даже hello весь центр обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2b587-107">hello outage can affect some components of Service Bus, such as a messaging store, or even hello entire datacenter.</span></span> <span data-ttu-id="2b587-108">После устранения проблемы hello Service Bus снова становится доступной.</span><span class="sxs-lookup"><span data-stu-id="2b587-108">After hello problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="2b587-109">Как правило, простой не приводит к утрате сообщений или других данных.</span><span class="sxs-lookup"><span data-stu-id="2b587-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="2b587-110">Примером сбоя компонента является недоступность определенного хранилища сообщений hello.</span><span class="sxs-lookup"><span data-stu-id="2b587-110">An example of a component failure is hello unavailability of a particular messaging store.</span></span> <span data-ttu-id="2b587-111">Примером сбоя центра обработки данных является отказ электроснабжения hello центра обработки данных или неисправность сетевого коммутатора.</span><span class="sxs-lookup"><span data-stu-id="2b587-111">An example of a datacenter-wide outage is a power failure of hello datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="2b587-112">Сбой может длиться от нескольких минут tooa несколько дней.</span><span class="sxs-lookup"><span data-stu-id="2b587-112">An outage can last from a few minutes tooa few days.</span></span>

<span data-ttu-id="2b587-113">Авария определяется как hello безвозвратная потеря единицы масштабирования служебной шины или центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2b587-113">A disaster is defined as hello permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="2b587-114">Hello центра обработки данных может включать или не будут доступны еще раз.</span><span class="sxs-lookup"><span data-stu-id="2b587-114">hello datacenter may or may not become available again.</span></span> <span data-ttu-id="2b587-115">Авария обычно вызывает потерю некоторых или всех сообщений или других данных.</span><span class="sxs-lookup"><span data-stu-id="2b587-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="2b587-116">Примеры аварий — пожар, наводнение или землетрясение.</span><span class="sxs-lookup"><span data-stu-id="2b587-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="2b587-117">Текущая архитектура</span><span class="sxs-lookup"><span data-stu-id="2b587-117">Current architecture</span></span>
<span data-ttu-id="2b587-118">Шина обслуживания использует несколько хранилищ toostore сообщений, отправляемых tooqueues или разделы.</span><span class="sxs-lookup"><span data-stu-id="2b587-118">Service Bus uses multiple messaging stores toostore messages that are sent tooqueues or topics.</span></span> <span data-ttu-id="2b587-119">Несекционированной очереди или разделу назначается tooone хранилище обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="2b587-119">A non-partitioned queue or topic is assigned tooone messaging store.</span></span> <span data-ttu-id="2b587-120">Если это хранилище сообщений недоступно, все операции с этой очередью или разделом завершатся с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="2b587-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="2b587-121">Все сущности обмена сообщениями служебной шины (очереди, разделы, ретрансляторы) располагаются в пространстве имен службы, которое связывается с центром обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2b587-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="2b587-122">Service Bus не поддерживает автоматическую географическую репликацию данных, и не позволяет toospan пространства имен нескольких центрах обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2b587-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace toospan multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="2b587-123">Защита от простоев ACS</span><span class="sxs-lookup"><span data-stu-id="2b587-123">Protecting against ACS outages</span></span>
<span data-ttu-id="2b587-124">Если вы используете учетные данные ACS и ACS становится недоступной, клиенты больше не смогут получать маркеры.</span><span class="sxs-lookup"><span data-stu-id="2b587-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="2b587-125">Клиенты, имеющие маркер hello момент сбоя ACS, можно продолжить toouse Service Bus, до истечения срока действия маркеров hello.</span><span class="sxs-lookup"><span data-stu-id="2b587-125">Clients that have a token at hello time ACS goes down can continue toouse Service Bus until hello tokens expire.</span></span> <span data-ttu-id="2b587-126">Срок действия маркера по умолчанию Hello составляет 3 часа.</span><span class="sxs-lookup"><span data-stu-id="2b587-126">hello default token lifetime is 3 hours.</span></span>

<span data-ttu-id="2b587-127">tooprotect от сбоев ACS использовать маркеры подписи общего доступа (SAS).</span><span class="sxs-lookup"><span data-stu-id="2b587-127">tooprotect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="2b587-128">В этом случае hello клиент проверяет подлинность непосредственно с Service Bus, подписывая самостоятельно созданный маркер секретным ключом.</span><span class="sxs-lookup"><span data-stu-id="2b587-128">In this case, hello client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="2b587-129">Вызовы tooACS больше не требуются.</span><span class="sxs-lookup"><span data-stu-id="2b587-129">Calls tooACS are no longer required.</span></span> <span data-ttu-id="2b587-130">Дополнительные сведения о токенах SAS см. в статье [Аутентификация и авторизация в служебной шине][Service Bus authentication].</span><span class="sxs-lookup"><span data-stu-id="2b587-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="2b587-131">Защита очередей и разделов от сбоев хранилища сообщений</span><span class="sxs-lookup"><span data-stu-id="2b587-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="2b587-132">Несекционированной очереди или разделу назначается tooone хранилище обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="2b587-132">A non-partitioned queue or topic is assigned tooone messaging store.</span></span> <span data-ttu-id="2b587-133">Если это хранилище сообщений недоступно, все операции с этой очередью или разделом завершатся с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="2b587-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="2b587-134">Объект секционированные очереди на hello другой стороны, состоит из нескольких фрагментов.</span><span class="sxs-lookup"><span data-stu-id="2b587-134">A partitioned queue, on hello other hand, consists of multiple fragments.</span></span> <span data-ttu-id="2b587-135">Все они хранятся в разных хранилищах сообщений.</span><span class="sxs-lookup"><span data-stu-id="2b587-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="2b587-136">При отправке сообщения tooa секционированной очереди или раздела Service Bus назначает tooone сообщение hello hello фрагментов.</span><span class="sxs-lookup"><span data-stu-id="2b587-136">When a message is sent tooa partitioned queue or topic, Service Bus assigns hello message tooone of hello fragments.</span></span> <span data-ttu-id="2b587-137">В случае недоступности соответствующее хранилище сообщений hello Service Bus записывает hello tooa различных фрагментов сообщений, если это возможно.</span><span class="sxs-lookup"><span data-stu-id="2b587-137">If hello corresponding messaging store is unavailable, Service Bus writes hello message tooa different fragment, if possible.</span></span> <span data-ttu-id="2b587-138">Дополнительные сведения о секционированных сущностях см. в статье [Секционированные сущности обмена сообщениями][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="2b587-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="2b587-139">Защита от простоев или аварий центра обработки данных</span><span class="sxs-lookup"><span data-stu-id="2b587-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="2b587-140">tooallow для отработки отказа между двумя центрами обработки данных, можно создать пространство имен службы служебной шины в каждом центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2b587-140">tooallow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="2b587-141">Например, hello пространства имен службы Service Bus **contosoPrimary.servicebus.windows.net** может находиться в регионе США или центральном hello, и **contosoSecondary.servicebus.windows.net**может находиться в hello нам южном или центральном регионе.</span><span class="sxs-lookup"><span data-stu-id="2b587-141">For example, hello Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in hello United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in hello US South/Central region.</span></span> <span data-ttu-id="2b587-142">Если сущность обмена сообщениями служебной шины должен быть доступен в hello наличие сбоя центра обработки данных, можно создать сущность в обоих пространствах имен.</span><span class="sxs-lookup"><span data-stu-id="2b587-142">If a Service Bus messaging entity must remain accessible in hello presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="2b587-143">Дополнительные сведения см. в разделе статьи «Сбой служебной шины в центре обработки данных Azure» hello [асинхронного обмена сообщениями, шаблонов и высокий уровень доступности][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="2b587-143">For more information, see hello "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="2b587-144">Защита конечных точек ретрансляции от простоев или аварий центра обработки данных</span><span class="sxs-lookup"><span data-stu-id="2b587-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="2b587-145">Географическая репликация конечных точек ретрансляции обеспечивает службу, предоставляющую toobe для конечной точки ретрансляции, доступным при наличии hello перебоев в работе службы.</span><span class="sxs-lookup"><span data-stu-id="2b587-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint toobe reachable in hello presence of Service Bus outages.</span></span> <span data-ttu-id="2b587-146">tooachieve георепликации, hello службы необходимо создать две конечных точки ретрансляции в разных пространствах имен.</span><span class="sxs-lookup"><span data-stu-id="2b587-146">tooachieve geo-replication, hello service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="2b587-147">пространства имен Hello должны находиться в разных центрах обработки данных и hello две конечные точки должны иметь разные имена.</span><span class="sxs-lookup"><span data-stu-id="2b587-147">hello namespaces must reside in different datacenters and hello two endpoints must have different names.</span></span> <span data-ttu-id="2b587-148">Например, первичная конечная точка может быть доступна как **contosoPrimary.servicebus.windows.net/myPrimaryService**, а ее вторичный аналог — как **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span><span class="sxs-lookup"><span data-stu-id="2b587-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="2b587-149">Затем служба Здравствуй прослушивает обе конечные точки, и клиент может вызывать службу hello через конечную точку.</span><span class="sxs-lookup"><span data-stu-id="2b587-149">hello service then listens on both endpoints, and a client can invoke hello service via either endpoint.</span></span> <span data-ttu-id="2b587-150">Клиентское приложение случайным образом выбирает ретрансляции hello как hello основной конечной точки и отправляет его запрос toohello активной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="2b587-150">A client application randomly picks one of hello relays as hello primary endpoint, and sends its request toohello active endpoint.</span></span> <span data-ttu-id="2b587-151">Если hello операция завершается ошибкой с кодом ошибки, эта ошибка означает, что этой конечной точки ретрансляции hello недоступен.</span><span class="sxs-lookup"><span data-stu-id="2b587-151">If hello operation fails with an error code, this failure indicates that hello relay endpoint is not available.</span></span> <span data-ttu-id="2b587-152">приложение Hello открывает канал toohello резервной конечной точке и снова отправляет запрос hello.</span><span class="sxs-lookup"><span data-stu-id="2b587-152">hello application opens a channel toohello backup endpoint and reissues hello request.</span></span> <span data-ttu-id="2b587-153">На этом этапе hello активных и резервных конечных точек hello переключения ролей: hello клиентское приложение считает hello старого активную конечную точку toobe hello новой резервной конечной точкой, а старой резервной конечной точке toobe hello hello новой активной конечной точкой.</span><span class="sxs-lookup"><span data-stu-id="2b587-153">At that point hello active and hello backup endpoints switch roles: hello client application considers hello old active endpoint toobe hello new backup endpoint, and hello old backup endpoint toobe hello new active endpoint.</span></span> <span data-ttu-id="2b587-154">Если сбоя обеих операций отправки, роли hello hello двух сущностей остаются без изменений и возвращается сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="2b587-154">If both send operations fail, hello roles of hello two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="2b587-155">Hello [георепликация с использованием Service Bus с ретрансляцией сообщения] [ Geo-replication with Service Bus relayed Messages] образце показано, как tooreplicate ретрансляции.</span><span class="sxs-lookup"><span data-stu-id="2b587-155">hello [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how tooreplicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="2b587-156">Защита очередей и разделов от простоев или аварий центра обработки данных</span><span class="sxs-lookup"><span data-stu-id="2b587-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="2b587-157">tooachieve устойчивости к сбоям ЦОД при с помощью обмена сообщениями через посредника, Service Bus поддерживает два подхода: *active* и *пассивный* репликации.</span><span class="sxs-lookup"><span data-stu-id="2b587-157">tooachieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="2b587-158">Для каждого подхода Если очередь или раздел должны оставаться доступными в hello наличие сбоя центра обработки данных можно создать ее в обоих пространствах имен.</span><span class="sxs-lookup"><span data-stu-id="2b587-158">For each approach, if a given queue or topic must remain accessible in hello presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="2b587-159">Обе сущности могут иметь hello таким же именем.</span><span class="sxs-lookup"><span data-stu-id="2b587-159">Both entities can have hello same name.</span></span> <span data-ttu-id="2b587-160">Например, первичная очередь может быть доступна как **contosoPrimary.servicebus.windows.net/myQueue**, а ее вторичный аналог — как **contosoSecondary.servicebus.windows.net/myQueue**.</span><span class="sxs-lookup"><span data-stu-id="2b587-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="2b587-161">Если приложение hello не требует постоянного взаимодействия отправителя и получателя, приложение hello можно реализовать надежная очередь на стороне клиента tooprevent потери и tooshield hello отправителя сообщения из любой временных ошибок Service Bus.</span><span class="sxs-lookup"><span data-stu-id="2b587-161">If hello application does not require permanent sender-to-receiver communication, hello application can implement a durable client-side queue tooprevent message loss and tooshield hello sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="2b587-162">Активная репликация</span><span class="sxs-lookup"><span data-stu-id="2b587-162">Active replication</span></span>
<span data-ttu-id="2b587-163">При активной репликации для каждой операции используются объекты в обоих пространствах имен.</span><span class="sxs-lookup"><span data-stu-id="2b587-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="2b587-164">Любой клиент, отправляющий сообщение отправляет hello две копии одного сообщения.</span><span class="sxs-lookup"><span data-stu-id="2b587-164">Any client that sends a message sends two copies of hello same message.</span></span> <span data-ttu-id="2b587-165">Hello первая копия отправляется toohello основная сущность (например, **contosoPrimary.servicebus.windows.net/sales**), и вторую копию hello приветственное сообщение отправляется toohello дополнительный объект (например,  **contosoSecondary.servicebus.windows.net/sales**).</span><span class="sxs-lookup"><span data-stu-id="2b587-165">hello first copy is sent toohello primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and hello second copy of hello message is sent toohello secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="2b587-166">Клиент получает сообщения из обеих очередей.</span><span class="sxs-lookup"><span data-stu-id="2b587-166">A client receives messages from both queues.</span></span> <span data-ttu-id="2b587-167">процессы приемника Hello hello первую копию сообщения и hello вторая копия пропускается.</span><span class="sxs-lookup"><span data-stu-id="2b587-167">hello receiver processes hello first copy of a message, and hello second copy is suppressed.</span></span> <span data-ttu-id="2b587-168">toosuppress дубликатов сообщений hello отправитель должен помечать все сообщения, с уникальным идентификатором.</span><span class="sxs-lookup"><span data-stu-id="2b587-168">toosuppress duplicate messages, hello sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="2b587-169">Обе копии сообщения hello должен быть помечен hello такой же идентификатор.</span><span class="sxs-lookup"><span data-stu-id="2b587-169">Both copies of hello message must be tagged with hello same identifier.</span></span> <span data-ttu-id="2b587-170">Можно использовать hello [BrokeredMessage.MessageId] [ BrokeredMessage.MessageId] или [BrokeredMessage.Label] [ BrokeredMessage.Label] свойства или типа hello tootag пользовательских свойств Сообщение.</span><span class="sxs-lookup"><span data-stu-id="2b587-170">You can use hello [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property tootag hello message.</span></span> <span data-ttu-id="2b587-171">Hello получатель должен иметь список уже полученных им сообщений.</span><span class="sxs-lookup"><span data-stu-id="2b587-171">hello receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="2b587-172">Hello [георепликации с сообщениями через посредника Service Bus] [ Geo-replication with Service Bus Brokered Messages] образце показана активная репликация сущностей обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="2b587-172">hello [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="2b587-173">Hello активная репликация удваивает количество hello операций, поэтому этот подход может привести toohigher затрат.</span><span class="sxs-lookup"><span data-stu-id="2b587-173">hello active replication approach doubles hello number of operations, therefore this approach can lead toohigher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="2b587-174">Пассивная репликация</span><span class="sxs-lookup"><span data-stu-id="2b587-174">Passive replication</span></span>
<span data-ttu-id="2b587-175">В случае сбоя освободить hello пассивная репликация использует только один из двух сущностей обмена сообщениями hello.</span><span class="sxs-lookup"><span data-stu-id="2b587-175">In hello fault-free case, passive replication uses only one of hello two messaging entities.</span></span> <span data-ttu-id="2b587-176">Клиент отправляет сообщение hello: toohello активной сущности.</span><span class="sxs-lookup"><span data-stu-id="2b587-176">A client sends hello message toohello active entity.</span></span> <span data-ttu-id="2b587-177">Если операция hello на hello активной сущности завершается неудачей с кодом ошибки, указывающее hello центра обработки данных, что узлы hello активной сущности могут быть недоступны, hello клиент отправляет копию сущности резервного копирования toohello сообщение hello.</span><span class="sxs-lookup"><span data-stu-id="2b587-177">If hello operation on hello active entity fails with an error code that indicates hello datacenter that hosts hello active entity might be unavailable, hello client sends a copy of hello message toohello backup entity.</span></span> <span data-ttu-id="2b587-178">На этом этапе hello active и сущности резервного копирования hello переключения ролей: hello отправляющий клиент принимает hello старого активной сущности toobe hello новую резервную сущность и hello старая резервная сущность является новой активной сущности hello.</span><span class="sxs-lookup"><span data-stu-id="2b587-178">At that point hello active and hello backup entities switch roles: hello sending client considers hello old active entity toobe hello new backup entity, and hello old backup entity is hello new active entity.</span></span> <span data-ttu-id="2b587-179">Если сбоя обеих операций отправки, роли hello hello двух сущностей остаются без изменений и возвращается сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="2b587-179">If both send operations fail, hello roles of hello two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="2b587-180">Клиент получает сообщения из обеих очередей.</span><span class="sxs-lookup"><span data-stu-id="2b587-180">A client receives messages from both queues.</span></span> <span data-ttu-id="2b587-181">Поскольку есть вероятность, что hello получатель получит две копии hello сообщение, hello получатель должен отслеживать повторяющихся сообщений.</span><span class="sxs-lookup"><span data-stu-id="2b587-181">Because there is a chance that hello receiver receives two copies of hello same message, hello receiver must suppress duplicate messages.</span></span> <span data-ttu-id="2b587-182">Можно подавить дублирует hello так же, как описано для активной репликации.</span><span class="sxs-lookup"><span data-stu-id="2b587-182">You can suppress duplicates in hello same way as described for active replication.</span></span>

<span data-ttu-id="2b587-183">В целом пассивная репликация экономичнее активной, поскольку в большинстве случаев выполняется только одна операция.</span><span class="sxs-lookup"><span data-stu-id="2b587-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="2b587-184">Задержки, пропускной способности и денежное выражение стоимости являются идентичными toohello сценариях без репликации.</span><span class="sxs-lookup"><span data-stu-id="2b587-184">Latency, throughput, and monetary cost are identical toohello non-replicated scenario.</span></span>

<span data-ttu-id="2b587-185">При использовании пассивной репликации в hello следующие сценарии сообщения может быть потерян или получены дважды:</span><span class="sxs-lookup"><span data-stu-id="2b587-185">When using passive replication, in hello following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="2b587-186">**Задержка или потеря сообщений**: предположим, что hello отправитель успешно отправил сообщение m1 toohello основная очередь и затем hello очереди становится недоступным, прежде чем hello получатель получит m1.</span><span class="sxs-lookup"><span data-stu-id="2b587-186">**Message delay or loss**: Assume that hello sender successfully sent a message m1 toohello primary queue, and then hello queue becomes unavailable before hello receiver receives m1.</span></span> <span data-ttu-id="2b587-187">Hello отправитель отправляет последующие сообщения очереди получателя m2 toohello.</span><span class="sxs-lookup"><span data-stu-id="2b587-187">hello sender sends a subsequent message m2 toohello secondary queue.</span></span> <span data-ttu-id="2b587-188">Если основная очередь hello временно недоступна, получатель hello получает m1 после hello очередь снова станет доступной.</span><span class="sxs-lookup"><span data-stu-id="2b587-188">If hello primary queue is temporarily unavailable, hello receiver receives m1 after hello queue becomes available again.</span></span> <span data-ttu-id="2b587-189">В случае аварии hello получатель может никогда не получить m1.</span><span class="sxs-lookup"><span data-stu-id="2b587-189">In case of a disaster, hello receiver may never receive m1.</span></span>
* <span data-ttu-id="2b587-190">**Двойное получение**: предположим, что hello отправитель отправляет сообщения m toohello основная очередь.</span><span class="sxs-lookup"><span data-stu-id="2b587-190">**Duplicate reception**: Assume that hello sender sends a message m toohello primary queue.</span></span> <span data-ttu-id="2b587-191">Шина обслуживания успешно обрабатывает m, но завершается сбоем toosend ответа.</span><span class="sxs-lookup"><span data-stu-id="2b587-191">Service Bus successfully processes m but fails toosend a response.</span></span> <span data-ttu-id="2b587-192">После hello отправить операции истечением времени ожидания, отправитель hello отправляет идентичную копию дополнительной очереди toohello m.</span><span class="sxs-lookup"><span data-stu-id="2b587-192">After hello send operation times out, hello sender sends an identical copy of m toohello secondary queue.</span></span> <span data-ttu-id="2b587-193">Если получатель hello может tooreceive hello первую копию m до hello основной очереди, hello получатель получит обе копии m в приблизительно hello то же время.</span><span class="sxs-lookup"><span data-stu-id="2b587-193">If hello receiver is able tooreceive hello first copy of m before hello primary queue becomes unavailable, hello receiver receives both copies of m at approximately hello same time.</span></span> <span data-ttu-id="2b587-194">Если hello получатель не может tooreceive hello первую копию m до hello основной очереди, получатель hello сначала получит только hello вторая копия m, но затем получает вторая копия m, когда hello основная очередь станет доступна.</span><span class="sxs-lookup"><span data-stu-id="2b587-194">If hello receiver is not able tooreceive hello first copy of m before hello primary queue becomes unavailable, hello receiver initially receives only hello second copy of m, but then receives a second copy of m when hello primary queue becomes available.</span></span>

<span data-ttu-id="2b587-195">Hello [георепликация с использованием Service Bus через посредника сообщений] [ Geo-replication with Service Bus Brokered Messages] образце показана пассивная репликация сущностей обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="2b587-195">hello [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2b587-196">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="2b587-196">Next steps</span></span>
<span data-ttu-id="2b587-197">toolearn Дополнительные сведения о аварийного восстановления, см. в этих статьях:</span><span class="sxs-lookup"><span data-stu-id="2b587-197">toolearn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="2b587-198">[Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="2b587-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="2b587-199">[Проектирование устойчивых приложений для Azure][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="2b587-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency
