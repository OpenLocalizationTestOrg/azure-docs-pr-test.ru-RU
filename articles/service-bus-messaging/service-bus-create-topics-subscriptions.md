---
title: "aaaCreate приложений, использующих подписки и темы шины обслуживания Azure | Документы Microsoft"
description: "Введение toohello публикация-подписка на возможности, предлагаемые подписки и темы Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: a48fc9b0-b7b0-464e-8187-a517bf8b4eb4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/07/2017
ms.author: sethm
ms.openlocfilehash: f6d7de46ace7bd5b49de612db213ced789308d91
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="create-applications-that-use-service-bus-topics-and-subscriptions"></a><span data-ttu-id="16a00-103">Создание приложений, использующих разделы и подписки служебной шины</span><span class="sxs-lookup"><span data-stu-id="16a00-103">Create applications that use Service Bus topics and subscriptions</span></span>
<span data-ttu-id="16a00-104">Служебная шина Azure поддерживает набор облачных технологий промежуточного уровня, ориентированных на обработку сообщений. Эти технологии представлены надежными очередями сообщений, а также возможностями публикации и подписки в рамках обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="16a00-104">Azure Service Bus supports a set of cloud-based, message-oriented middleware technologies including reliable message queuing and durable publish/subscribe messaging.</span></span> <span data-ttu-id="16a00-105">Эта статья основана на информации hello из [создание приложений, использующих очереди шины обслуживания](service-bus-create-queues.md) и содержит введение в возможности публикации или подписки toohello, предлагаемые разделы служебной шины.</span><span class="sxs-lookup"><span data-stu-id="16a00-105">This article builds on hello information provided in [Create applications that use Service Bus queues](service-bus-create-queues.md) and offers an introduction toohello publish/subscribe capabilities offered by Service Bus topics.</span></span>

## <a name="evolving-retail-scenario"></a><span data-ttu-id="16a00-106">Развитие сценария розничной торговли</span><span class="sxs-lookup"><span data-stu-id="16a00-106">Evolving retail scenario</span></span>
<span data-ttu-id="16a00-107">В этой статье продолжается hello сценарии розничной торговли, используемом в [создание приложений, использующих очереди шины обслуживания](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="16a00-107">This article continues hello retail scenario used in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span> <span data-ttu-id="16a00-108">Помните, что данные о продажах из индивидуального терминала точки продажи (POS) должен быть система управления запасами перенаправленное tooan, использующий, toodetermine данных после toobe времени пополнения запасов.</span><span class="sxs-lookup"><span data-stu-id="16a00-108">Recall that sales data from individual Point of Sale (POS) terminals must be routed tooan inventory management system which uses that data toodetermine when stock has toobe replenished.</span></span> <span data-ttu-id="16a00-109">Каждый терминал передает данные о продажах, отправляя сообщения toohello **DataCollectionQueue** очереди, где они остаются до поступления в систему управления запасами hello, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="16a00-109">Each POS terminal reports its sales data by sending messages toohello **DataCollectionQueue** queue, where they remain until they are received by hello inventory management system, as shown here:</span></span>

![Служебная шина 1](./media/service-bus-create-topics-subscriptions/IC657161.gif)

<span data-ttu-id="16a00-111">tooevolve, это новое требование было добавлено toohello системы: hello владелец магазина хочет toomonitor toobe возможности, как работает хранилище hello в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="16a00-111">tooevolve this scenario, a new requirement has been added toohello system: hello store owner wants toobe able toomonitor how hello store is performing in real time.</span></span>

<span data-ttu-id="16a00-112">tooaddress это требование hello системы должен «нажать» отключение потока данных о продажах hello.</span><span class="sxs-lookup"><span data-stu-id="16a00-112">tooaddress this requirement, hello system must "tap" off hello sales data stream.</span></span> <span data-ttu-id="16a00-113">Нам по-прежнему каждое сообщение, отправленное по hello POS терминалы toobe отправляемых системой управления запасами toohello как до, но мы хотим другую копию каждого сообщения, мы используем владелец магазина toohello представления панели мониторинга toopresent hello.</span><span class="sxs-lookup"><span data-stu-id="16a00-113">We still want each message sent by hello POS terminals toobe sent toohello inventory management system as before, but we want another copy of each message that we can use toopresent hello dashboard view toohello store owner.</span></span>

<span data-ttu-id="16a00-114">В любой такой ситуации, в которой требуется toobe каждого сообщения, используются в нескольких местах, можно использовать служебную шину *разделы*.</span><span class="sxs-lookup"><span data-stu-id="16a00-114">In any situation such as this, in which you require each message toobe consumed by multiple parties, you can use Service Bus *topics*.</span></span> <span data-ttu-id="16a00-115">Разделы содержат публикации и подписки, в котором каждое опубликованное сообщение становится доступной tooone или несколько подписок, зарегистрированных в разделе hello.</span><span class="sxs-lookup"><span data-stu-id="16a00-115">Topics provide a publish/subscribe pattern in which each published message is made available tooone or more subscriptions registered with hello topic.</span></span> <span data-ttu-id="16a00-116">В отличие от этой схемы, в очереди каждое сообщение доступно только одному потребителю.</span><span class="sxs-lookup"><span data-stu-id="16a00-116">In contrast, with queues each message is received by a single consumer.</span></span>

<span data-ttu-id="16a00-117">Сообщения отправляются теме tooa hello так же, как они отправляются tooa очереди.</span><span class="sxs-lookup"><span data-stu-id="16a00-117">Messages are sent tooa topic in hello same way as they are sent tooa queue.</span></span> <span data-ttu-id="16a00-118">Тем не менее не были получены сообщения из раздела hello напрямую. они принимаются из подписок.</span><span class="sxs-lookup"><span data-stu-id="16a00-118">However, messages are not received from hello topic directly; they are received from subscriptions.</span></span> <span data-ttu-id="16a00-119">Раздела tooa подписки можно представить как виртуальную очередь, получающую копии сообщений hello, отправляемых toothat раздела.</span><span class="sxs-lookup"><span data-stu-id="16a00-119">You can think of a subscription tooa topic as a virtual queue that receives copies of hello messages that are sent toothat topic.</span></span> <span data-ttu-id="16a00-120">Сообщения принимаются из подписки hello таким же способом, что они поступают из очереди.</span><span class="sxs-lookup"><span data-stu-id="16a00-120">Messages are received from a subscription hello same way as they are received from a queue.</span></span>

<span data-ttu-id="16a00-121">Вернемся toohello сценария розничной торговли, hello очереди не будет заменен раздел и добавляется подписки, можно использовать системный компонент управления какие инвентаризации hello.</span><span class="sxs-lookup"><span data-stu-id="16a00-121">Going back toohello retail scenario, hello queue is replaced by a topic, and a subscription is added, which hello inventory management system component can use.</span></span> <span data-ttu-id="16a00-122">система Hello теперь выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="16a00-122">hello system now appears as follows:</span></span>

![Служебная шина 2](./media/service-bus-create-topics-subscriptions/IC657165.gif)

<span data-ttu-id="16a00-124">Hello конфигурация здесь работает одинаково toohello предыдущей схемой использования очередей.</span><span class="sxs-lookup"><span data-stu-id="16a00-124">hello configuration here performs identically toohello previous queue-based design.</span></span> <span data-ttu-id="16a00-125">То есть сообщения, отправляемые toohello раздела, перенаправленное toohello **инвентаризации** подписки, из которой hello **систему управления запасами** использует их.</span><span class="sxs-lookup"><span data-stu-id="16a00-125">That is, messages sent toohello topic are routed toohello **Inventory** subscription, from which hello **Inventory Management System** consumes them.</span></span>

<span data-ttu-id="16a00-126">В порядке toosupport hello панели мониторинга мы создадим вторую подписку на раздел hello, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="16a00-126">In order toosupport hello management dashboard, we create a second subscription on hello topic, as shown here:</span></span>

![Служебная шина 3](./media/service-bus-create-topics-subscriptions/IC657166.gif)

<span data-ttu-id="16a00-128">С этой конфигурацией каждое сообщение из hello POS-терминалы становится доступной tooboth hello **мониторинга** и **инвентаризации** подписки.</span><span class="sxs-lookup"><span data-stu-id="16a00-128">With this configuration, each message from hello POS terminals is made available tooboth hello **Dashboard** and **Inventory** subscriptions.</span></span>

## <a name="show-me-hello-code"></a><span data-ttu-id="16a00-129">Покажите мне код hello</span><span class="sxs-lookup"><span data-stu-id="16a00-129">Show me hello code</span></span>
<span data-ttu-id="16a00-130">статья Hello [создание приложений, использующих очереди шины обслуживания](service-bus-create-queues.md) описывает способ toosign учетную запись Azure и создайте пространство имен службы.</span><span class="sxs-lookup"><span data-stu-id="16a00-130">hello article [Create applications that use Service Bus queues](service-bus-create-queues.md) describes how toosign up for an Azure account and create a service namespace.</span></span> <span data-ttu-id="16a00-131">Hello простым способом tooreference Service Bus зависимостей — hello tooinstall Service Bus [пакет Nuget](https://www.nuget.org/packages/WindowsAzure.ServiceBus/).</span><span class="sxs-lookup"><span data-stu-id="16a00-131">hello easiest way tooreference Service Bus dependencies is tooinstall hello Service Bus [Nuget package](https://www.nuget.org/packages/WindowsAzure.ServiceBus/).</span></span> <span data-ttu-id="16a00-132">Также можно найти hello библиотеки служебной шины в рамках hello Azure SDK.</span><span class="sxs-lookup"><span data-stu-id="16a00-132">You can also find hello Service Bus libraries as part of hello Azure SDK.</span></span> <span data-ttu-id="16a00-133">Hello загрузка доступна на hello [странице загрузки пакета Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="16a00-133">hello download is available at hello [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span>

### <a name="create-hello-topic-and-subscriptions"></a><span data-ttu-id="16a00-134">Создать раздел hello и подписки</span><span class="sxs-lookup"><span data-stu-id="16a00-134">Create hello topic and subscriptions</span></span>
<span data-ttu-id="16a00-135">Операции управления для сущностей обмена сообщениями (очередей и публикации или подписки разделов) выполняются через hello Service Bus [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) класса.</span><span class="sxs-lookup"><span data-stu-id="16a00-135">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class.</span></span> <span data-ttu-id="16a00-136">Соответствующие учетные данные являются обязательными в порядке toocreate **NamespaceManager** экземпляр для определенного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="16a00-136">Appropriate credentials are required in order toocreate a **NamespaceManager** instance for a particular namespace.</span></span> <span data-ttu-id="16a00-137">Служебная шина использует модель безопасности на основе [подписанного URL-адреса](service-bus-sas.md) (SAS).</span><span class="sxs-lookup"><span data-stu-id="16a00-137">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="16a00-138">Hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) класс представляет поставщик маркеров безопасности со встроенными методами-фабрики возвращение некоторые хорошо известные поставщики токенов.</span><span class="sxs-lookup"><span data-stu-id="16a00-138">hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="16a00-139">Мы будем использовать [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) учетные данные SAS метод toohold hello.</span><span class="sxs-lookup"><span data-stu-id="16a00-139">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method toohold hello SAS credentials.</span></span> <span data-ttu-id="16a00-140">Hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) экземпляр конструируется с базовым адресом hello пространства имен Service Bus hello и поставщик маркеров hello.</span><span class="sxs-lookup"><span data-stu-id="16a00-140">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) instance is then constructed with hello base address of hello Service Bus namespace and hello token provider.</span></span>

<span data-ttu-id="16a00-141">Hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) класс предоставляет методы toocreate, перечисления и удаления сущностей обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="16a00-141">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class provides methods toocreate, enumerate and delete messaging entities.</span></span> <span data-ttu-id="16a00-142">Здравствуйте, код, показанный здесь показано, как hello **NamespaceManager** экземпляра — hello создана и используется toocreate **DataCollectionTopic** раздела.</span><span class="sxs-lookup"><span data-stu-id="16a00-142">hello code that is shown here shows how hello **NamespaceManager** instance is created and used toocreate hello **DataCollectionTopic** topic.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = new NamespaceManager(uri, tokenProvider);

namespaceManager.CreateTopic("DataCollectionTopic");
```

<span data-ttu-id="16a00-143">Обратите внимание, что существуют перегрузки hello [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) метод, с помощью которых tooset свойства раздела hello.</span><span class="sxs-lookup"><span data-stu-id="16a00-143">Note that there are overloads of hello [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) method that enable you tooset properties of hello topic.</span></span> <span data-ttu-id="16a00-144">Например можно задать hello значение по умолчанию срока жизни (TTL) для сообщений, отправляемых toohello раздела.</span><span class="sxs-lookup"><span data-stu-id="16a00-144">For example, you can set hello default time-to-live (TTL) value for messages sent toohello topic.</span></span> <span data-ttu-id="16a00-145">Добавьте hello **инвентаризации** и **мониторинга** подписки.</span><span class="sxs-lookup"><span data-stu-id="16a00-145">Next, add hello **Inventory** and **Dashboard** subscriptions.</span></span>

```csharp
namespaceManager.CreateSubscription("DataCollectionTopic", "Inventory");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard");
```

### <a name="send-messages-toohello-topic"></a><span data-ttu-id="16a00-146">Отправить toohello темы о сообщениях</span><span class="sxs-lookup"><span data-stu-id="16a00-146">Send messages toohello topic</span></span>
<span data-ttu-id="16a00-147">Для выполнения операций над сущностями служебной шины, например для отправки и получения сообщений, приложение сначала должно создать объект [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory).</span><span class="sxs-lookup"><span data-stu-id="16a00-147">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory) object.</span></span> <span data-ttu-id="16a00-148">Аналогичные toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) класса hello **MessagingFactory** из hello базового адреса пространства имен службы hello и поставщик маркеров hello создается экземпляр.</span><span class="sxs-lookup"><span data-stu-id="16a00-148">Similar toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class, hello **MessagingFactory** instance is created from hello base address of hello service namespace and hello token provider.</span></span>

```
MessagingFactory factory = MessagingFactory.Create(uri, tokenProvider);
```

<span data-ttu-id="16a00-149">Сообщения, отправленные tooand, полученных от темы Service Bus являются экземплярами hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) класса.</span><span class="sxs-lookup"><span data-stu-id="16a00-149">Messages sent tooand received from Service Bus topics, are instances of hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="16a00-150">Этот класс — это набор стандартных свойств (например, [метка](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) и [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), словаря, используемые toohold свойств приложения и тело произвольных данных приложения.</span><span class="sxs-lookup"><span data-stu-id="16a00-150">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used toohold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="16a00-151">Приложения можно задать текст hello, передав ему любой сериализуемый объект (hello следующем примере передается в **SalesData** объект, представляющий данные о продажах hello из hello POS терминала), который будет использоваться hello [ DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello объекта.</span><span class="sxs-lookup"><span data-stu-id="16a00-151">An application can set hello body by passing in any serializable object (hello following example passes in a **SalesData** object that represents hello sales data from hello POS terminal), which will use hello [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello object.</span></span> <span data-ttu-id="16a00-152">Также можно предоставить объект [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx).</span><span class="sxs-lookup"><span data-stu-id="16a00-152">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

```csharp
BrokeredMessage bm = new BrokeredMessage(salesData);
bm.Label = "SalesReport";
bm.Properties["StoreName"] = "Redmond";
bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="16a00-153">Hello простым способом toosend toohello темы о сообщениях — toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) объекта непосредственно hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) экземпляр:</span><span class="sxs-lookup"><span data-stu-id="16a00-153">hello easiest way toosend messages toohello topic is toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance:</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionTopic");
sender.Send(bm);
```

### <a name="receive-messages-from-a-subscription"></a><span data-ttu-id="16a00-154">Получение сообщений из подписки</span><span class="sxs-lookup"><span data-stu-id="16a00-154">Receive messages from a subscription</span></span>
<span data-ttu-id="16a00-155">Аналогичные toousing очередей, tooreceive сообщения из подписки, можно использовать [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) объект, который создается непосредственно в hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) с помощью [ CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="16a00-155">Similar toousing queues, tooreceive messages from a subscription you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="16a00-156">Можно использовать один из hello двух различных режимов приема (**ReceiveAndDelete** и **PeekLock**), как описано в [создание приложений, использующих очереди шины обслуживания](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="16a00-156">You can use one of hello two different receive modes (**ReceiveAndDelete** and **PeekLock**), as discussed in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span>

<span data-ttu-id="16a00-157">Обратите внимание, что при создании **MessageReceiver** подписок, hello *entityPath* параметр имеет форму hello `topicPath/subscriptions/subscriptionName`.</span><span class="sxs-lookup"><span data-stu-id="16a00-157">Note that when you create a **MessageReceiver** for subscriptions, hello *entityPath* parameter is of hello form `topicPath/subscriptions/subscriptionName`.</span></span> <span data-ttu-id="16a00-158">Таким образом, toocreate **MessageReceiver** для hello **инвентаризации** подписку hello **DataCollectionTopic** разделе *entityPath*необходимо задать слишком`DataCollectionTopic/subscriptions/Inventory`.</span><span class="sxs-lookup"><span data-stu-id="16a00-158">Therefore, toocreate a **MessageReceiver** for hello **Inventory** subscription of hello **DataCollectionTopic** topic, *entityPath* must be set too`DataCollectionTopic/subscriptions/Inventory`.</span></span> <span data-ttu-id="16a00-159">Hello кода выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="16a00-159">hello code appears as follows:</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionTopic/subscriptions/Inventory");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

## <a name="subscription-filters"></a><span data-ttu-id="16a00-160">Фильтры подписки</span><span class="sxs-lookup"><span data-stu-id="16a00-160">Subscription filters</span></span>
<span data-ttu-id="16a00-161">Таким образом в этом случае все сообщения, отправленные toohello разделе вносятся доступных tooall регистрации подписки.</span><span class="sxs-lookup"><span data-stu-id="16a00-161">So far, in this scenario all messages sent toohello topic are made available tooall registered subscriptions.</span></span> <span data-ttu-id="16a00-162">Hello здесь ключевую фразу «доступны.»</span><span class="sxs-lookup"><span data-stu-id="16a00-162">hello key phrase here is "made available."</span></span> <span data-ttu-id="16a00-163">А подписках Service Bus считать, что все сообщения, отправленные toohello раздела, можно скопировать только подмножество этих сообщений toohello виртуальную очередь подписки.</span><span class="sxs-lookup"><span data-stu-id="16a00-163">While Service Bus subscriptions see all messages sent toohello topic, you can copy only a subset of those messages toohello virtual subscription queue.</span></span> <span data-ttu-id="16a00-164">Это возможно благодаря использованию *фильтров* подписок.</span><span class="sxs-lookup"><span data-stu-id="16a00-164">This is performed using subscription *filters*.</span></span> <span data-ttu-id="16a00-165">При создании подписки можно указать критерий фильтра в форме предиката SQL92, работающую на свойства hello приветственное сообщение hello, оба hello системные свойства (например, [метка](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) и приложения hello свойства, такие как **StoreName** в предыдущем примере hello.</span><span class="sxs-lookup"><span data-stu-id="16a00-165">When you create a subscription, you can supply a filter expression in hello form of a SQL92 style predicate that operates over hello properties of hello message, both hello system properties (for example, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) and hello application properties, such as **StoreName** in hello previous example.</span></span>

<span data-ttu-id="16a00-166">Это развивается tooillustrate сценарий hello второй магазин встречается toobe добавлены tooour розничной торговли.</span><span class="sxs-lookup"><span data-stu-id="16a00-166">Evolving hello scenario tooillustrate this, a second store is toobe added tooour retail scenario.</span></span> <span data-ttu-id="16a00-167">Данные о продажах из всех hello POS-терминалы из обоих магазинов по-прежнему иметь систему управления запасами централизованное toohello toobe маршрутизации, но директор магазина, с помощью средства мониторинга hello заинтересован только hello производительности хранилища.</span><span class="sxs-lookup"><span data-stu-id="16a00-167">Sales data from all of hello POS terminals from both stores still have toobe routed toohello centralized inventory management system, but a store manager using hello dashboard tool is only interested in hello performance of that store.</span></span> <span data-ttu-id="16a00-168">Можно использовать фильтрацию tooachieve это подписки.</span><span class="sxs-lookup"><span data-stu-id="16a00-168">You can use subscription filtering tooachieve this.</span></span> <span data-ttu-id="16a00-169">Обратите внимание, что при публикации сообщений hello POS-терминалы они задается hello **StoreName** свойство приложения приветственное сообщение.</span><span class="sxs-lookup"><span data-stu-id="16a00-169">Note that when hello POS terminals publish messages, they set hello **StoreName** application property on hello message.</span></span> <span data-ttu-id="16a00-170">Получает два хранилища, например **Redmond** и **Seattle**, hello POS терминалы в Редмонде hello хранить свои данные о продажах сообщения с метки **StoreName** равно слишком **Redmond**, тогда как hello Сиэтл хранения POS терминалы используйте **StoreName** равно слишком**Seattle**.</span><span class="sxs-lookup"><span data-stu-id="16a00-170">Given two stores, for example **Redmond** and **Seattle**, hello POS terminals in hello Redmond store stamp their sales data messages with a **StoreName** equal too**Redmond**, whereas hello Seattle store POS terminals use a **StoreName** equal too**Seattle**.</span></span> <span data-ttu-id="16a00-171">Hello директор hello только хранить Redmond хочет toosee данных со своих терминалов.</span><span class="sxs-lookup"><span data-stu-id="16a00-171">hello store manager of hello Redmond store only wants toosee data from its POS terminals.</span></span> <span data-ttu-id="16a00-172">система Hello выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="16a00-172">hello system appears as follows:</span></span>

![Служебная шина 4](./media/service-bus-create-topics-subscriptions/IC657167.gif)

<span data-ttu-id="16a00-174">tooset копии этой маршрутизации создать hello **мониторинга** подписки следующим образом:</span><span class="sxs-lookup"><span data-stu-id="16a00-174">tooset up this routing, you create hello **Dashboard** subscription as follows:</span></span>

```csharp
SqlFilter dashboardFilter = new SqlFilter("StoreName = 'Redmond'");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard", dashboardFilter);
```

<span data-ttu-id="16a00-175">С этим [фильтр подписки](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), только сообщения, имеющие hello **StoreName** значение свойства слишком**Redmond** будет скопированный toohello виртуальную очередь для hello **Мониторинга** подписки.</span><span class="sxs-lookup"><span data-stu-id="16a00-175">With this [subscription filter](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), only messages that have hello **StoreName** property set too**Redmond** will be copied toohello virtual queue for hello **Dashboard** subscription.</span></span> <span data-ttu-id="16a00-176">Гораздо больше toosubscription фильтрации, однако не существует.</span><span class="sxs-lookup"><span data-stu-id="16a00-176">There is much more toosubscription filtering, however.</span></span> <span data-ttu-id="16a00-177">Приложения могут иметь несколько правил фильтрации для каждой подписки в дополнение toohello возможность toomodify hello свойств сообщения при его прохождении tooa в виртуальную очередь подписки.</span><span class="sxs-lookup"><span data-stu-id="16a00-177">Applications can have multiple filter rules per subscription in addition toohello ability toomodify hello properties of a message as it passes tooa subscription's virtual queue.</span></span>

## <a name="summary"></a><span data-ttu-id="16a00-178">Сводка</span><span class="sxs-lookup"><span data-stu-id="16a00-178">Summary</span></span>
<span data-ttu-id="16a00-179">Все очереди toouse причинам hello описано в [создание приложений, использующих очереди шины обслуживания](service-bus-create-queues.md) справедливы tootopics, в частности:</span><span class="sxs-lookup"><span data-stu-id="16a00-179">All of hello reasons toouse queuing described in [Create applications that use Service Bus queues](service-bus-create-queues.md) also apply tootopics, specifically:</span></span>

* <span data-ttu-id="16a00-180">Временная развязка — производители и потребители имеют toobe через Интернет в hello сообщения одновременно.</span><span class="sxs-lookup"><span data-stu-id="16a00-180">Temporal decoupling – message producers and consumers do not have toobe online at hello same time.</span></span>
* <span data-ttu-id="16a00-181">Выравнивание нагрузки — пики нагрузки смягчаются по разделам hello Включение много toobe приложения, подготовленные для среднюю нагрузку вместо пиковой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="16a00-181">Load leveling – peaks in load are smoothed out by hello topic enabling consuming applications toobe provisioned for average load instead of peak load.</span></span>
* <span data-ttu-id="16a00-182">Балансировка нагрузки — аналогично tooa очереди, может иметь несколько конкурирующих потребителей, прослушивающих одну подписку, для каждого сообщения, передан один tooonly потребителей hello, тем самым балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="16a00-182">Load balancing – similar tooa queue, you can have multiple competing consumers listening on a single subscription, with each message handed off tooonly one of hello consumers, thereby balancing load.</span></span>
* <span data-ttu-id="16a00-183">Слабая связь — можно развивать hello обмена сообщениями сети, не затрагивая существующие конечные точки; например добавление подписок или изменение фильтров раздела tooallow tooa для новых потребителей.</span><span class="sxs-lookup"><span data-stu-id="16a00-183">Loose coupling – you can evolve hello messaging network without affecting existing endpoints; for example, adding subscriptions or changing filters tooa topic tooallow for new consumers.</span></span>

## <a name="next-steps"></a><span data-ttu-id="16a00-184">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="16a00-184">Next steps</span></span>

<span data-ttu-id="16a00-185">В разделе [создание приложений, использующих очереди шины обслуживания](service-bus-create-queues.md) сведения о как toouse очереди в сценарии hello POS розничной торговли.</span><span class="sxs-lookup"><span data-stu-id="16a00-185">See [Create applications that use Service Bus queues](service-bus-create-queues.md) for information about how toouse queues in hello POS retail scenario.</span></span>

