---
title: "aaaOverview обмена сообщениями, очереди, разделы и подписки Azure Service Bus | Документы Microsoft"
description: "Общие сведения о сущностях обмена сообщениями в служебной шине."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: a306ced4-74e9-47c6-990a-d9c47efa31d5
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 06/28/2017
ms.author: sethm
ms.openlocfilehash: 73135d2658e341c14dbb114ab938faed91578ff1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="service-bus-queues-topics-and-subscriptions"></a><span data-ttu-id="c891a-103">Очереди, разделы и подписки служебной шины</span><span class="sxs-lookup"><span data-stu-id="c891a-103">Service Bus queues, topics, and subscriptions</span></span>

<span data-ttu-id="c891a-104">Служебная шина Microsoft Azure поддерживает набор облачных технологий промежуточного уровня, ориентированных на обработку сообщений. Эти технологии представлены надежными очередями сообщений, а также возможностями публикации и подписки в рамках обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="c891a-104">Microsoft Azure Service Bus supports a set of cloud-based, message-oriented middleware technologies including reliable message queuing and durable publish/subscribe messaging.</span></span> <span data-ttu-id="c891a-105">Эти «через посредника» возможности обмена сообщениями может рассматриваться как несвязанный обмен сообщениями с поддержкой публикации, подписки, временного разъединения и сценариев, с помощью фабрики обмена сообщениями Service Bus hello балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c891a-105">These "brokered" messaging capabilities can be thought of as decoupled messaging features that support publish-subscribe, temporal decoupling, and load balancing scenarios using hello Service Bus messaging fabric.</span></span> <span data-ttu-id="c891a-106">Разделенный обмен данными имеет множество преимуществ. Например, клиенты и серверы могут подключаться по необходимости, выполняя свои операции в асинхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="c891a-106">Decoupled communication has many advantages; for example, clients and servers can connect as needed and perform their operations in an asynchronous fashion.</span></span>

<span data-ttu-id="c891a-107">сущности обмена сообщениями Hello, формирующие ядро hello hello этой возможности в Service Bus являются очереди, разделы и подписки и правила/действия.</span><span class="sxs-lookup"><span data-stu-id="c891a-107">hello messaging entities that form hello core of hello messaging capabilities in Service Bus are queues, topics and subscriptions, and rules/actions.</span></span>

## <a name="queues"></a><span data-ttu-id="c891a-108">Очереди</span><span class="sxs-lookup"><span data-stu-id="c891a-108">Queues</span></span>

<span data-ttu-id="c891a-109">Очереди обеспечивают *первым пришел, первым ушел* tooone доставки сообщений (FIFO) или несколько конкурирующих клиентов.</span><span class="sxs-lookup"><span data-stu-id="c891a-109">Queues offer *First In, First Out* (FIFO) message delivery tooone or more competing consumers.</span></span> <span data-ttu-id="c891a-110">То есть сообщения, обычно ожидаемый toobe получаются и обрабатываются получателями hello в порядке hello, в котором они были добавлены toohello очереди, и каждое сообщение принимается и обрабатывается с только одним потребителем сообщения.</span><span class="sxs-lookup"><span data-stu-id="c891a-110">That is, messages are typically expected toobe received and processed by hello receivers in hello order in which they were added toohello queue, and each message is received and processed by only one message consumer.</span></span> <span data-ttu-id="c891a-111">Основное преимущество использования очередей состоит tooachieve «временная развязка» компонентов приложений.</span><span class="sxs-lookup"><span data-stu-id="c891a-111">A key benefit of using queues is tooachieve "temporal decoupling" of application components.</span></span> <span data-ttu-id="c891a-112">Здравствуйте, другими словами, создатели (отправители) и потребители (получатели) не имеют toobe отправке и получении сообщений в hello же времени, так как сообщения долговременно хранятся в очереди hello.</span><span class="sxs-lookup"><span data-stu-id="c891a-112">In other words, hello producers (senders) and consumers (receivers) do not have toobe sending and receiving messages at hello same time, because messages are stored durably in hello queue.</span></span> <span data-ttu-id="c891a-113">Кроме того производитель hello не имеют toowait ответа от получателя hello в порядке toocontinue tooprocess и отправки сообщений.</span><span class="sxs-lookup"><span data-stu-id="c891a-113">Furthermore, hello producer does not have toowait for a reply from hello consumer in order toocontinue tooprocess and send messages.</span></span>

<span data-ttu-id="c891a-114">Связанные поощрение представляет «выравниванию нагрузки, «что позволяет toosend отправителями и получателями и получать сообщения с разной интенсивностью.</span><span class="sxs-lookup"><span data-stu-id="c891a-114">A related benefit is "load leveling," which enables producers and consumers toosend and receive messages at different rates.</span></span> <span data-ttu-id="c891a-115">Во многих приложениях системная нагрузка hello изменяется со временем; время обработки hello, необходимое для каждой единицы работы то, как правило, постоянно.</span><span class="sxs-lookup"><span data-stu-id="c891a-115">In many applications, hello system load varies over time; however, hello processing time required for each unit of work is typically constant.</span></span> <span data-ttu-id="c891a-116">Посредничество отправителями и получателями сообщений с очередью означает, что этот hello использует только приложение toobe подготовленных toobe может toohandle среднюю нагрузку вместо пиковой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c891a-116">Intermediating message producers and consumers with a queue means that hello consuming application only has toobe provisioned toobe able toohandle average load instead of peak load.</span></span> <span data-ttu-id="c891a-117">Глубина Hello hello очереди будет расти или уменьшаться как hello входящая нагрузка меняется.</span><span class="sxs-lookup"><span data-stu-id="c891a-117">hello depth of hello queue grows and contracts as hello incoming load varies.</span></span> <span data-ttu-id="c891a-118">Это напрямую экономит деньги с учета toohello объем нагрузки приложения hello необходимые tooservice инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="c891a-118">This directly saves money with regard toohello amount of infrastructure required tooservice hello application load.</span></span> <span data-ttu-id="c891a-119">Повышении нагрузки hello, больше рабочих процессов могут быть добавлены tooread из очереди hello.</span><span class="sxs-lookup"><span data-stu-id="c891a-119">As hello load increases, more worker processes can be added tooread from hello queue.</span></span> <span data-ttu-id="c891a-120">Каждое сообщение обрабатывается только один hello рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="c891a-120">Each message is processed by only one of hello worker processes.</span></span> <span data-ttu-id="c891a-121">Кроме того, этот основе опросов Балансировка нагрузки позволяет для оптимально использовать рабочие компьютеры hello даже если hello рабочий компьютер отличается по с мощностью tooprocessing учета, как они будут опрашивать сообщения на максимальной скорости.</span><span class="sxs-lookup"><span data-stu-id="c891a-121">Furthermore, this pull-based load balancing allows for optimum use of hello worker computers even if hello worker computers differ with regard tooprocessing power, as they will pull messages at their own maximum rate.</span></span> <span data-ttu-id="c891a-122">Данный шаблон часто называется «конкурирующий клиент» шаблон hello.</span><span class="sxs-lookup"><span data-stu-id="c891a-122">This pattern is often termed hello "competing consumer" pattern.</span></span>

<span data-ttu-id="c891a-123">Использование очередей toointermediate между отправителями и получателями сообщений обеспечивает свойственную ей свободную связь между компонентами hello.</span><span class="sxs-lookup"><span data-stu-id="c891a-123">Using queues toointermediate between message producers and consumers provides an inherent loose coupling between hello components.</span></span> <span data-ttu-id="c891a-124">Так как производители и потребители не знают друг друга, потребитель можно обновить без необходимости влияет на производитель hello.</span><span class="sxs-lookup"><span data-stu-id="c891a-124">Because producers and consumers are not aware of each other, a consumer can be upgraded without having any effect on hello producer.</span></span>

<span data-ttu-id="c891a-125">Создание очереди является многоэтапным процессом.</span><span class="sxs-lookup"><span data-stu-id="c891a-125">Creating a queue is a multi-step process.</span></span> <span data-ttu-id="c891a-126">Выполнять операции управления для сущностей (очередей и разделов) через hello обмена сообщениями Service Bus [Microsoft.ServiceBus.NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) класс, который конструируется при вводе hello базовый адрес hello Service Bus пространство имен и hello учетные данные пользователя.</span><span class="sxs-lookup"><span data-stu-id="c891a-126">You perform management operations for Service Bus messaging entities (both queues and topics) via hello [Microsoft.ServiceBus.NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class, which is constructed by supplying hello base address of hello Service Bus namespace and hello user credentials.</span></span> <span data-ttu-id="c891a-127">[NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) предоставляет toocreate методов перечисления и удаления сущностей обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="c891a-127">[NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) provides methods toocreate, enumerate and delete messaging entities.</span></span> <span data-ttu-id="c891a-128">После создания [Microsoft.ServiceBus.TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) объекта из hello SAS имя и ключ и пространство имен службы управления, можно использовать hello [Microsoft.ServiceBus.NamespaceManager.CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) метод toocreate hello очереди.</span><span class="sxs-lookup"><span data-stu-id="c891a-128">After creating a [Microsoft.ServiceBus.TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) object from hello SAS name and key, and a service namespace management object, you can use hello [Microsoft.ServiceBus.NamespaceManager.CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) method toocreate hello queue.</span></span> <span data-ttu-id="c891a-129">Например:</span><span class="sxs-lookup"><span data-stu-id="c891a-129">For example:</span></span>

```csharp
// Create management credentials
TokenProvider credentials = TokenProvider.CreateSharedAccessSignatureTokenProvider(sasKeyName,sasKeyValue);
// Create namespace client
NamespaceManager namespaceClient = new NamespaceManager(ServiceBusEnvironment.CreateServiceUri("sb", ServiceNamespace, string.Empty), credentials);
```

<span data-ttu-id="c891a-130">Затем можно создать объект очереди и фабрику обмена сообщениями с hello URI служебной шины в качестве аргумента.</span><span class="sxs-lookup"><span data-stu-id="c891a-130">You can then create a queue object and a messaging factory with hello Service Bus URI as an argument.</span></span> <span data-ttu-id="c891a-131">Например:</span><span class="sxs-lookup"><span data-stu-id="c891a-131">For example:</span></span>

```csharp
QueueDescription myQueue;
myQueue = namespaceClient.CreateQueue("TestQueue");
MessagingFactory factory = MessagingFactory.Create(ServiceBusEnvironment.CreateServiceUri("sb", ServiceNamespace, string.Empty), credentials); 
QueueClient myQueueClient = factory.CreateQueueClient("TestQueue");
```

<span data-ttu-id="c891a-132">Затем можно отправить toohello сообщений в очереди.</span><span class="sxs-lookup"><span data-stu-id="c891a-132">You can then send messages toohello queue.</span></span> <span data-ttu-id="c891a-133">Например, если имеется список сообщений посредника вызывается `MessageList`, кода hello появится примерно следующее toohello:</span><span class="sxs-lookup"><span data-stu-id="c891a-133">For example, if you have a list of brokered messages called `MessageList`, hello code appears similar toohello following:</span></span>

```csharp
for (int count = 0; count < 6; count++)
{
    var issue = MessageList[count];
    issue.Label = issue.Properties["IssueTitle"].ToString();
    myQueueClient.Send(issue);
}
```

<span data-ttu-id="c891a-134">Затем сообщения из очереди hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="c891a-134">You then receive messages from hello queue as follows:</span></span>

```csharp
while ((message = myQueueClient.Receive(new TimeSpan(hours: 0, minutes: 0, seconds: 5))) != null)
    {
        Console.WriteLine(string.Format("Message received: {0}, {1}, {2}", message.SequenceNumber, message.Label, message.MessageId));
        message.Complete();

        Console.WriteLine("Processing message (sleeping...)");
        Thread.Sleep(1000);
    }
```

<span data-ttu-id="c891a-135">В hello [ReceiveAndDelete](/dotnet/api/microsoft.servicebus.messaging.receivemode) получать hello режиме единовременной операцией; то есть, Service Bus, получив запрос hello, он помечает приветственное сообщение как полученное и возвращает его toohello приложения.</span><span class="sxs-lookup"><span data-stu-id="c891a-135">In hello [ReceiveAndDelete](/dotnet/api/microsoft.servicebus.messaging.receivemode) mode, hello receive operation is single-shot; that is, when Service Bus receives hello request, it marks hello message as being consumed and returns it toohello application.</span></span> <span data-ttu-id="c891a-136">**ReceiveAndDelete** режим — самая простая модель hello и лучше всего подходит для сценариев, в которых hello приложение может не обрабатывать сообщение hello в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="c891a-136">**ReceiveAndDelete** mode is hello simplest model and works best for scenarios in which hello application can tolerate not processing a message in hello event of a failure.</span></span> <span data-ttu-id="c891a-137">toounderstand это, рассмотрим сценарий, в какие неполадки потребителя hello hello получают запрос и затем ломается до его обработки.</span><span class="sxs-lookup"><span data-stu-id="c891a-137">toounderstand this, consider a scenario in which hello consumer issues hello receive request and then crashes before processing it.</span></span> <span data-ttu-id="c891a-138">Поскольку Service Bus помечает приветственное сообщение как полученное, когда приложение hello перезапускается и начинает получать сообщения снова, оно пропустит сообщение hello, потребляет предыдущих toohello аварийного завершения.</span><span class="sxs-lookup"><span data-stu-id="c891a-138">Because Service Bus marks hello message as being consumed, when hello application restarts and begins consuming messages again, it will have missed hello message that was consumed prior toohello crash.</span></span>

<span data-ttu-id="c891a-139">В [PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode) получать hello режиме операции становится два этапа, что делает его возможных toosupport приложений, которые не удается обработать отсутствующие сообщения.</span><span class="sxs-lookup"><span data-stu-id="c891a-139">In [PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode) mode, hello receive operation becomes two-stage, which makes it possible toosupport applications that cannot tolerate missing messages.</span></span> <span data-ttu-id="c891a-140">Service Bus, получив запрос hello, он выполняет поиск следующего сообщения toobe hello потребляет, блокирует его tooprevent других потребителей получать и возвращает его toohello приложения.</span><span class="sxs-lookup"><span data-stu-id="c891a-140">When Service Bus receives hello request, it finds hello next message toobe consumed, locks it tooprevent other consumers from receiving it, and then returns it toohello application.</span></span> <span data-ttu-id="c891a-141">После того, как приложение hello завершает обработку сообщения hello (или хранит его для будущей обработки), его выполнить hello второго этапа hello процесс получения путем вызова [завершить](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) на полученных приветственное сообщение.</span><span class="sxs-lookup"><span data-stu-id="c891a-141">After hello application finishes processing hello message (or stores it reliably for future processing), it completes hello second stage of hello receive process by calling [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) on hello received message.</span></span> <span data-ttu-id="c891a-142">Когда Service Bus обнаруживает hello **завершить** вызов, она помечает приветственное сообщение как полученное.</span><span class="sxs-lookup"><span data-stu-id="c891a-142">When Service Bus sees hello **Complete** call, it marks hello message as being consumed.</span></span>

<span data-ttu-id="c891a-143">Если приложение hello не может tooprocess сообщение hello для какой-либо причине, оно может вызвать hello [отказаться от](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) метод для получения приветственное сообщение (вместо [завершить](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span><span class="sxs-lookup"><span data-stu-id="c891a-143">If hello application is unable tooprocess hello message for some reason, it can call hello [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) method on hello received message (instead of [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span></span> <span data-ttu-id="c891a-144">Это позволяет сообщение hello toounlock служебной шины и сделать ее доступной toobe получили еще раз, либо путем Привет одному клиенту или другим конкурирующих объектом-получателем.</span><span class="sxs-lookup"><span data-stu-id="c891a-144">This enables Service Bus toounlock hello message and make it available toobe received again, either by hello same consumer or by another competing consumer.</span></span> <span data-ttu-id="c891a-145">Во-вторых существует время ожидания, связанного с блокировкой hello и если происходит сбой приложения hello tooprocess hello сообщение перед hello срок блокировки (например, если приложение hello терпит сбой), то Service Bus разблокирует приветственное сообщение и делает ее доступной toobe получен еще раз (фактически выполняет [прервать](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) операции по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="c891a-145">Secondly, there is a timeout associated with hello lock and if hello application fails tooprocess hello message before hello lock timeout expires (for example, if hello application crashes), then Service Bus unlocks hello message and makes it available toobe received again (essentially performing an [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) operation by default).</span></span>

<span data-ttu-id="c891a-146">Обратите внимание, что в hello событие, которое приложение hello аварийно завершает работу после обработки сообщения hello, но перед hello **завершить** выдается запрос, приветственное сообщение повторно доставлены toohello приложения после его перезапуска.</span><span class="sxs-lookup"><span data-stu-id="c891a-146">Note that in hello event that hello application crashes after processing hello message, but before hello **Complete** request is issued, hello message is redelivered toohello application when it restarts.</span></span> <span data-ttu-id="c891a-147">Такой подход предполагает принцип обработки сообщения *хотя бы один раз*.</span><span class="sxs-lookup"><span data-stu-id="c891a-147">This is often called *At Least Once* processing; that is, each message is processed at least once.</span></span> <span data-ttu-id="c891a-148">Однако в некоторых ситуациях hello же сообщение может доставляться.</span><span class="sxs-lookup"><span data-stu-id="c891a-148">However, in certain situations hello same message may be redelivered.</span></span> <span data-ttu-id="c891a-149">Если сценарий hello не допускает обработку дубликатов, то требуется дополнительная логика в дубликаты toodetect приложения hello, которые может осуществляться на основе hello **MessageId** свойства сообщения hello, который остается Константа протяжении всех попыток доставки.</span><span class="sxs-lookup"><span data-stu-id="c891a-149">If hello scenario cannot tolerate duplicate processing, then additional logic is required in hello application toodetect duplicates which can be achieved based upon hello **MessageId** property of hello message, which remains constant across delivery attempts.</span></span> <span data-ttu-id="c891a-150">Такой подход предполагает концепцию обработки *только один раз*.</span><span class="sxs-lookup"><span data-stu-id="c891a-150">This is known as *Exactly Once* processing.</span></span>

## <a name="topics-and-subscriptions"></a><span data-ttu-id="c891a-151">Разделы и подписки</span><span class="sxs-lookup"><span data-stu-id="c891a-151">Topics and subscriptions</span></span>
<span data-ttu-id="c891a-152">В отличие от tooqueues, в котором каждое сообщение обрабатывается одним потребителем *разделы* и *подписки* обеспечивают один ко многим связь, в *публикациииподписки* шаблон.</span><span class="sxs-lookup"><span data-stu-id="c891a-152">In contrast tooqueues, in which each message is processed by a single consumer, *topics* and *subscriptions* provide a one-to-many form of communication, in a *publish/subscribe* pattern.</span></span> <span data-ttu-id="c891a-153">Это удобно при масштабировании toovery большое число получателей, каждого опубликованное сообщение становится доступной tooeach подписки, зарегистрированной разделе hello.</span><span class="sxs-lookup"><span data-stu-id="c891a-153">Useful for scaling toovery large numbers of recipients, each published message is made available tooeach subscription registered with hello topic.</span></span> <span data-ttu-id="c891a-154">Сообщения отправляются в разделе tooa и доставленный tooone или более связанных подписок, в зависимости от правил фильтрации, которые могут быть установлены в соответствии с подписками.</span><span class="sxs-lookup"><span data-stu-id="c891a-154">Messages are sent tooa topic and delivered tooone or more associated subscriptions, depending on filter rules that can be set on a per-subscription basis.</span></span> <span data-ttu-id="c891a-155">Hello подписки могут использовать, они должны tooreceive сообщений hello toorestrict дополнительные фильтры.</span><span class="sxs-lookup"><span data-stu-id="c891a-155">hello subscriptions can use additional filters toorestrict hello messages that they want tooreceive.</span></span> <span data-ttu-id="c891a-156">Сообщения отправляются теме tooa в hello таким же, каким образом они отправляются tooa очереди, но не были получены сообщения из раздела hello напрямую.</span><span class="sxs-lookup"><span data-stu-id="c891a-156">Messages are sent tooa topic in hello same way they are sent tooa queue, but messages are not received from hello topic directly.</span></span> <span data-ttu-id="c891a-157">Зато их можно получить из подписок.</span><span class="sxs-lookup"><span data-stu-id="c891a-157">Instead, they are received from subscriptions.</span></span> <span data-ttu-id="c891a-158">Подписка раздела напоминает виртуальную очередь, получающую копии сообщений hello, отправляемых toohello раздела.</span><span class="sxs-lookup"><span data-stu-id="c891a-158">A topic subscription resembles a virtual queue that receives copies of hello messages that are sent toohello topic.</span></span> <span data-ttu-id="c891a-159">Сообщения принимаются из подписки идентично toohello способ их получения из очереди.</span><span class="sxs-lookup"><span data-stu-id="c891a-159">Messages are received from a subscription identically toohello way they are received from a queue.</span></span>

<span data-ttu-id="c891a-160">Для сравнения hello функция очереди по отправке сообщений сопоставляется напрямую tooa раздела, и ее функция приема сообщений — карты tooa подписки.</span><span class="sxs-lookup"><span data-stu-id="c891a-160">By way of comparison, hello message-sending functionality of a queue maps directly tooa topic and its message-receiving functionality maps tooa subscription.</span></span> <span data-ttu-id="c891a-161">Помимо прочего, это означает, что подписки поддерживают hello же шаблоны, описанные ранее в этом разделе с учета tooqueues: конкурирующий клиент, временное разъединение, выравнивание нагрузки и балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="c891a-161">Among other things, this means that subscriptions support hello same patterns described earlier in this section with regard tooqueues: competing consumer, temporal decoupling, load leveling, and load balancing.</span></span>

<span data-ttu-id="c891a-162">Создание раздела является аналогичные toocreating очереди, как показано в примере hello в предыдущем разделе hello.</span><span class="sxs-lookup"><span data-stu-id="c891a-162">Creating a topic is similar toocreating a queue, as shown in hello example in hello previous section.</span></span> <span data-ttu-id="c891a-163">Создайте URI службы hello, а затем используйте hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) hello пространство имен класса toocreate клиента.</span><span class="sxs-lookup"><span data-stu-id="c891a-163">Create hello service URI, and then use hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class toocreate hello namespace client.</span></span> <span data-ttu-id="c891a-164">Затем можно создать раздел с помощью hello [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) метод.</span><span class="sxs-lookup"><span data-stu-id="c891a-164">You can then create a topic using hello [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) method.</span></span> <span data-ttu-id="c891a-165">Например:</span><span class="sxs-lookup"><span data-stu-id="c891a-165">For example:</span></span>

```csharp
TopicDescription dataCollectionTopic = namespaceClient.CreateTopic("DataCollectionTopic");
```

<span data-ttu-id="c891a-166">Затем добавьте необходимые подписки:</span><span class="sxs-lookup"><span data-stu-id="c891a-166">Next, add subscriptions as desired:</span></span>

```csharp
SubscriptionDescription myAgentSubscription = namespaceClient.CreateSubscription(myTopic.Path, "Inventory");
SubscriptionDescription myAuditSubscription = namespaceClient.CreateSubscription(myTopic.Path, "Dashboard");
```

<span data-ttu-id="c891a-167">После этого можно создать клиент раздела.</span><span class="sxs-lookup"><span data-stu-id="c891a-167">You can then create a topic client.</span></span> <span data-ttu-id="c891a-168">Например:</span><span class="sxs-lookup"><span data-stu-id="c891a-168">For example:</span></span>

```csharp
MessagingFactory factory = MessagingFactory.Create(serviceUri, tokenProvider);
TopicClient myTopicClient = factory.CreateTopicClient(myTopic.Path)
```

<span data-ttu-id="c891a-169">Отправитель сообщения hello можно отправлять и получать сообщения tooand hello раздела, как показано в предыдущем разделе hello.</span><span class="sxs-lookup"><span data-stu-id="c891a-169">Using hello message sender, you can send and receive messages tooand from hello topic, as shown in hello previous section.</span></span> <span data-ttu-id="c891a-170">Например:</span><span class="sxs-lookup"><span data-stu-id="c891a-170">For example:</span></span>

```csharp
foreach (BrokeredMessage message in messageList)
{
    myTopicClient.Send(message);
    Console.WriteLine(
    string.Format("Message sent: Id = {0}, Body = {1}", message.MessageId, message.GetBody<string>()));
}
```

<span data-ttu-id="c891a-171">Аналогичные tooqueues, сообщения принимаются из подписки с помощью [SubscriptionClient](/dotnet/api/microsoft.servicebus.messaging.subscriptionclient) объекта вместо [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) объекта.</span><span class="sxs-lookup"><span data-stu-id="c891a-171">Similar tooqueues, messages are received from a subscription using a [SubscriptionClient](/dotnet/api/microsoft.servicebus.messaging.subscriptionclient) object instead of a [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) object.</span></span> <span data-ttu-id="c891a-172">Создайте клиент подписки hello, передав имя hello hello раздела, имя подписки hello hello и (необязательно) hello режим получения в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="c891a-172">Create hello subscription client, passing hello name of hello topic, hello name of hello subscription, and (optionally) hello receive mode as parameters.</span></span> <span data-ttu-id="c891a-173">Например, с помощью hello **инвентаризации** подписки:</span><span class="sxs-lookup"><span data-stu-id="c891a-173">For example, with hello **Inventory** subscription:</span></span>

```csharp
// Create hello subscription client
MessagingFactory factory = MessagingFactory.Create(serviceUri, tokenProvider); 

SubscriptionClient agentSubscriptionClient = factory.CreateSubscriptionClient("IssueTrackingTopic", "Inventory", ReceiveMode.PeekLock);
SubscriptionClient auditSubscriptionClient = factory.CreateSubscriptionClient("IssueTrackingTopic", "Dashboard", ReceiveMode.ReceiveAndDelete); 

while ((message = agentSubscriptionClient.Receive(TimeSpan.FromSeconds(5))) != null)
{
    Console.WriteLine("\nReceiving message from Inventory...");
    Console.WriteLine(string.Format("Message received: Id = {0}, Body = {1}", message.MessageId, message.GetBody<string>()));
    message.Complete();
}          

// Create a receiver using ReceiveAndDelete mode
while ((message = auditSubscriptionClient.Receive(TimeSpan.FromSeconds(5))) != null)
{
    Console.WriteLine("\nReceiving message from Dashboard...");
    Console.WriteLine(string.Format("Message received: Id = {0}, Body = {1}", message.MessageId, message.GetBody<string>()));
}
```

### <a name="rules-and-actions"></a><span data-ttu-id="c891a-174">Правила и действия</span><span class="sxs-lookup"><span data-stu-id="c891a-174">Rules and actions</span></span>
<span data-ttu-id="c891a-175">Во многих ситуациях сообщения с определенными характеристиками должны обрабатываться разными способами.</span><span class="sxs-lookup"><span data-stu-id="c891a-175">In many scenarios, messages that have specific characteristics must be processed in different ways.</span></span> <span data-ttu-id="c891a-176">tooenable это, можно настроить подписки toofind сообщений, которые нужными свойствами, а затем выполнить некоторые изменения toothose свойства.</span><span class="sxs-lookup"><span data-stu-id="c891a-176">tooenable this, you can configure subscriptions toofind messages that have desired properties and then perform certain modifications toothose properties.</span></span> <span data-ttu-id="c891a-177">А подписках Service Bus считать, что все сообщения, отправленные toohello раздела, можно копировать только подмножество этих сообщений toohello виртуальную очередь подписки.</span><span class="sxs-lookup"><span data-stu-id="c891a-177">While Service Bus subscriptions see all messages sent toohello topic, you can only copy a subset of those messages toohello virtual subscription queue.</span></span> <span data-ttu-id="c891a-178">Это возможно благодаря использованию фильтров подписок.</span><span class="sxs-lookup"><span data-stu-id="c891a-178">This is accomplished using subscription filters.</span></span> <span data-ttu-id="c891a-179">Такие изменения называются *действиями фильтров*.</span><span class="sxs-lookup"><span data-stu-id="c891a-179">Such modifications are called *filter actions*.</span></span> <span data-ttu-id="c891a-180">При создании подписки можно указать критерий фильтра, который обрабатывает свойства приветственное сообщение hello, оба hello системные свойства (например, **метка**) и пользовательских параметров (например, **StoreName**.) hello SQL-критерий фильтра является необязательным в этом случае; без критерия фильтра SQL любое действие фильтра, заданное для подписки выполняется на все сообщения hello для этой подписки.</span><span class="sxs-lookup"><span data-stu-id="c891a-180">When a subscription is created, you can supply a filter expression that operates on hello properties of hello message, both hello system properties (for example, **Label**) and custom application properties (for example, **StoreName**.) hello SQL filter expression is optional in this case; without a SQL filter expression, any filter action defined on a subscription will be performed on all hello messages for that subscription.</span></span>

<span data-ttu-id="c891a-181">Используя предыдущий пример hello, toofilter сообщений только из **Store1**, необходимо создать подписку панели мониторинга hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="c891a-181">Using hello previous example, toofilter messages coming only from **Store1**, you would create hello Dashboard subscription as follows:</span></span>

```csharp
namespaceManager.CreateSubscription("IssueTrackingTopic", "Dashboard", new SqlFilter("StoreName = 'Store1'"));
```

<span data-ttu-id="c891a-182">С помощью такого фильтра подписки на месте, только сообщения, имеющие hello `StoreName` значение свойства слишком`Store1` , скопированный toohello виртуальную очередь для hello `Dashboard` подписки.</span><span class="sxs-lookup"><span data-stu-id="c891a-182">With this subscription filter in place, only messages that have hello `StoreName` property set too`Store1` are copied toohello virtual queue for hello `Dashboard` subscription.</span></span>

<span data-ttu-id="c891a-183">Дополнительные сведения о возможные значения фильтра документации hello hello [SqlFilter](/dotnet/api/microsoft.servicebus.messaging.sqlfilter) и [SqlRuleAction](/dotnet/api/microsoft.servicebus.messaging.sqlruleaction) классы.</span><span class="sxs-lookup"><span data-stu-id="c891a-183">For more information about possible filter values, see hello documentation for hello [SqlFilter](/dotnet/api/microsoft.servicebus.messaging.sqlfilter) and [SqlRuleAction](/dotnet/api/microsoft.servicebus.messaging.sqlruleaction) classes.</span></span> <span data-ttu-id="c891a-184">См. также, hello [обмен сообщениями через посредника: дополнительных фильтров](http://code.msdn.microsoft.com/Brokered-Messaging-6b0d2749) и [фильтры разделов](https://github.com/Azure-Samples/azure-servicebus-messaging-samples/tree/master/TopicFilters) образцов.</span><span class="sxs-lookup"><span data-stu-id="c891a-184">Also, see hello [Brokered Messaging: Advanced Filters](http://code.msdn.microsoft.com/Brokered-Messaging-6b0d2749) and [Topic Filters](https://github.com/Azure-Samples/azure-servicebus-messaging-samples/tree/master/TopicFilters) samples.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c891a-185">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c891a-185">Next steps</span></span>
<span data-ttu-id="c891a-186">В разделе hello следующие дополнительные разделы, Дополнительные сведения и примеры использования сообщений Service Bus.</span><span class="sxs-lookup"><span data-stu-id="c891a-186">See hello following advanced topics for more information and examples of using Service Bus messaging.</span></span>

* [<span data-ttu-id="c891a-187">Основные сведения об обмене сообщениями через служебную шину</span><span class="sxs-lookup"><span data-stu-id="c891a-187">Service Bus messaging overview</span></span>](service-bus-messaging-overview.md)
* [<span data-ttu-id="c891a-188">Учебное пособие по обмену сообщениями .NET через посредника в служебной шине</span><span class="sxs-lookup"><span data-stu-id="c891a-188">Service Bus brokered messaging .NET tutorial</span></span>](service-bus-brokered-tutorial-dotnet.md)
* [<span data-ttu-id="c891a-189">Руководство по обмену сообщениями через посредника служебной шины на основе REST</span><span class="sxs-lookup"><span data-stu-id="c891a-189">Service Bus brokered messaging REST tutorial</span></span>](service-bus-brokered-tutorial-rest.md)
* [<span data-ttu-id="c891a-190">Пример фильтров разделов</span><span class="sxs-lookup"><span data-stu-id="c891a-190">Topic Filters sample </span></span>](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/TopicFilters)
* [<span data-ttu-id="c891a-191">Brokered Messaging: Advanced Filters (Обмен сообщениями через брокер: расширенные фильтры)</span><span class="sxs-lookup"><span data-stu-id="c891a-191">Brokered Messaging: Advanced Filters sample</span></span>](http://code.msdn.microsoft.com/Brokered-Messaging-6b0d2749)

