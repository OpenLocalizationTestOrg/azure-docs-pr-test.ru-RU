---
title: "Географическое аварийное восстановление в служебной шине Azure | Документация Майкрософт"
description: "Способы использования географических регионов для отработки отказа и аварийного восстановления в служебной шине Azure"
services: service-bus-messaging
documentationcenter: 
author: christianwolf42
manager: timlt
editor: 
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2017
ms.author: sethm
ms.openlocfilehash: fdeb9ba55fc8eade95f6fca88f47dd12aa18a480
ms.sourcegitcommit: 821b6306aab244d2feacbd722f60d99881e9d2a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/16/2017
---
# <a name="azure-service-bus-geo-disaster-recovery"></a>Azure Service Bus Geo аварийного восстановления

Если весь регионах Azure или центры обработки данных (если не [доступности зоны](../availability-zones/az-overview.md) используются) избежать простоя, крайне важно для обработки данных продолжить работать и в другом регионе и центре обработки данных. Таким образом *географическое аварийное восстановление* и *георепликация* являются важными функциями для любого предприятия. Azure Service Bus поддерживает географически аварийного восстановления и георепликации, на уровне пространства имен. 

Функция Geo аварийного восстановления глобально доступной для SKU Premium шины службы. 

## <a name="outages-and-disasters"></a>Сбои и аварийные ситуации

Важно отметить различия между «сбои в работе» и «бедствия.» *Сбой* — это временная недоступность служебной шины Azure. Он может повлиять на некоторые компоненты службы, такие как хранилище сообщений, или даже весь центр обработки данных. Однако после исправления проблемы Service Bus снова становится доступной. Как правило, простой не приводит к утрате сообщений или других данных. Примером такого сбоя может быть сбой питания в центре обработки данных. Некоторые сбои являются только короткие подключения убытки из-за временной или сетевых проблем. 

Объект *аварийного* определяется как потеря постоянных и долговременного кластер Service Bus, регион Azure или центра обработки данных. Регион или центра обработки данных может не будут доступны еще раз или может простаивать в течение часов или дней. Примеры аварий — пожар, наводнение или землетрясение. Сбой, который становится постоянной может привести к потере некоторые сообщения, события или другие данные. Но в большинстве случаев потеря данных не происходит и сообщения можно восстановить сразу же после резервного копирования в центре обработки данных.

Функция географического аварийного восстановления служебной шины Azure — это решение для аварийного восстановления. Основные понятия и рабочий процесс, описанные в этой статье, относятся к сценариям восстановления после аварий, но не временных сбоев. Дополнительные сведения об аварийном восстановлении в Microsoft Azure см. в статье [Аварийное восстановление для приложений на платформе Azure](/azure/architecture/resiliency/disaster-recovery-azure-applications).   

## <a name="basic-concepts-and-terms"></a>Основные понятия и термины

Функции аварийного восстановления реализует метаданных аварийного восстановления и зависит от пространства имен первичных и вторичных аварийного восстановления. Обратите внимание, что функция Geo аварийного восстановления для [Premium SKU](service-bus-premium-messaging.md) только. Вам не нужно изменять какие-либо строки подключения, так как соединение выполняется через псевдоним.

В этом руководстве используются термины, представленные ниже.

-  *Псевдоним*: имя для конфигурации аварийного восстановления, которую вы настроили. Псевдоним предоставляет единую стабильную строку подключения полного доменного имени (FQDN). Приложения используют ее для подключения к пространству имен. 

-  *Пространство имен первичный или вторичный*: пространств имен, которые соответствуют псевдоним. Основное пространство имен «активно» и получает сообщения (это может быть существующего или нового пространства имен). Дополнительное пространство имен «пассивный» и не получает сообщения. Метаданные между открывающими синхронизированы, так как можно легко принимать сообщения без изменений строки кода или соединения приложения. Чтобы убедиться, что только активное пространство имен получает сообщения, необходимо использовать псевдоним. 

-  *Метаданные*: сущности, такие как очереди, разделы и подписки и их свойства службы, связанные с пространством имен. Обратите внимание, что автоматически реплицируются только сущностей и их параметры. Сообщения, не реплицируются. 

-  *Отработка отказа*: процесс активации дополнительного пространства имен.

## <a name="setup-and-failover-flow"></a>Поток, настройки и отработки отказа

В следующем разделе приведен обзор процесса отработки отказа и объясняется, как настроить начальные отработку отказа. 

![1][]

### <a name="setup"></a>Настройка

Можно сначала создать или использовать существующий основного пространства имен и нового дополнительного пространства имен, а затем связать два. Это связывание предоставит псевдоним, который можно использовать для подключения. Так как используется псевдоним, нет необходимости изменять строки подключения. Только новые пространства имен могут быть добавлены к вашему связыванию. Наконец следует добавить некоторыми функциями мониторинга, чтобы определить, является ли необходимые отработки отказа. В большинстве случаев служба входит в состав экосистемы больших, таким образом редко, возможно, автоматический переход на другой ресурс, очень часто переход на другой ресурс выполняется в соответствии с оставшиеся подсистемы или инфраструктуры.

### <a name="example"></a>Пример

Примером такого сценария рассмотрите решение точки продажи (POS), создает сообщения или события. Service Bus передает эти события некоторые сопоставления или переформатировании решения, который затем пересылает сопоставленные данные в другую систему для дальнейшей обработки. В этот момент все эти системы могут размещаться в том же регионе Azure. Решение, когда и какие части переход на другой ресурс зависит от потока данных в вашей инфраструктуре. 

Можно автоматизировать переход на другой ресурс с контроль различных систем, или пользовательские решений для мониторинга. Однако такие автоматизации занимает дополнительное планирование и работы, которая выходит за рамки данной статьи.

### <a name="failover-flow"></a>Поток отработки отказа

Если запустить отработку отказа, необходимы два шага:

1. Если возникает другой сбой, необходимо иметь возможность перехода на другой ресурс снова. Таким образом Настройка другой пассивный пространства имен и обновление сопряжение. 

2. Извлекать сообщения из бывшей основного пространства имен, как только она снова станет доступной. После этого использовать это пространство имен для регулярного обмена сообщениями вне настройку geo восстановления или удаления старого основного пространства имен.

> [!NOTE]
> Поддерживается семантика сбоя вперед. В этом случае при сбое и повторно связать с новым пространством имен. Не поддерживается сбоя; Например в кластере SQL. 

![2][]

## <a name="management"></a>управления

Если ошибки; Например связан неправильный области во время начальной настройки, можно прервать связывания двух пространств имен в любое время. Если вы хотите использовать сопряженные пространства имен в качестве регулярного пространства имен, удалите псевдоним.

## <a name="use-existing-namespace-as-alias"></a>Использовать существующее пространство имен в качестве псевдонима

Если у вас есть сценарии, в котором невозможно изменить связь между отправителями и получателями, можно повторно использовать ваше пространство имен как псевдоним. В разделе [пример кода на GitHub здесь](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/GeoDR/SBGeoDR2/SBGeoDR_existing_namespace_name).

## <a name="samples"></a>Примеры

[Примерами на GitHub](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/GeoDR/SBGeoDR2/SBGeoDR2) показывают, как установить и инициировать отработку отказа. В этих примерах демонстрируются следующие понятия:

- Параметры, необходимые в Azure Active Directory для использования Azure Resource Manager с Service Bus. 
- Шаги, необходимые для выполнения образца кода. 
- Отправка и получение из текущего основного пространства имен. 
- Как использовать существующее пространство имен в качестве псевдонима.

## <a name="considerations"></a>Рекомендации

Обратите внимание на следующие аспекты, необходимо иметь в виду, в этом выпуске:

1. При планировании отработки отказа, следует также учитывать фактором времени. Например при утере подключения к более 15 – 20 минут, можно начать отработку отказа. 
 
2. Тот факт, что данные не реплицируются означает, что в настоящее время активных сеансов не реплицируются. Кроме того обнаружение дубликатов и запланированные сообщения будут недоступны. Новые сеансы, запланированные сообщения и новые дубликаты будут работать. 

3. Должно быть отработки отказа сложной инфраструктуры распределенных [записанные](/azure/architecture/resiliency/disaster-recovery-azure-applications#disaster-simulation) по крайней мере один раз. 

4. Синхронизация сущностей может занять некоторое время примерно на 50 – 100 сущностей в минуту. Подписки и правила также учитывается как сущности. 

## <a name="next-steps"></a>Дальнейшие действия

- Ознакомьтесь со справочными материалами по [REST API для географического аварийного восстановления](/rest/api/servicebus/disasterrecoveryconfigs).
- Запустите пример географического аварийного восстановления [на GitHub](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/GeoDR/SBGeoDR2/SBGeoDR2).
- Ознакомьтесь с примером [географического аварийного восстановления, отправляющим сообщения псевдониму](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/GeoDR/TestGeoDR/ConsoleApp1).

Дополнительную информацию об обмене сообщениями через служебную шину см. в следующих статьях:

* [Базовая информация о служебной шине](service-bus-fundamentals-hybrid-solutions.md)
* [Очереди, разделы и подписки служебной шины](service-bus-queues-topics-subscriptions.md)
* [Начало работы с очередями служебной шины](service-bus-dotnet-get-started-with-queues.md)
* [Как использовать разделы и подписки служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)
* [Azure Service Bus REST API](/rest/api/servicebus/) (REST API служебной шины Azure) 

[1]: ./media/service-bus-geo-dr/geo1.png
[2]: ./media/service-bus-geo-dr/geo2.png
