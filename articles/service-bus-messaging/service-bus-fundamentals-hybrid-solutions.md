---
title: "Обзор служебной шины Azure | Документация Майкрософт"
description: "Общие сведения об использовании служебной шины для подключения приложений Azure к другим программам."
services: service-bus-messaging
documentationcenter: .net
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 12654cdd-82ab-4b95-b56f-08a5a8bbc6f9
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/15/2017
ms.author: sethm
ms.openlocfilehash: af8b10f0a460e695a39879718174e81f78934ef8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="azure-service-bus"></a><span data-ttu-id="5ca99-103">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="5ca99-103">Azure Service Bus</span></span>

<span data-ttu-id="5ca99-104">Независимо от того, работают ли приложение или служба в облаке или локально, они часто должны взаимодействовать с другими приложениями или службами.</span><span class="sxs-lookup"><span data-stu-id="5ca99-104">Whether an application or service runs in the cloud or on premises, it often needs to interact with other applications or services.</span></span> <span data-ttu-id="5ca99-105">Для обеспечения этой возможности Microsoft Azure предлагает Service Bus.</span><span class="sxs-lookup"><span data-stu-id="5ca99-105">To provide a broadly useful way to do this, Microsoft Azure offers Service Bus.</span></span> <span data-ttu-id="5ca99-106">В этой статье приводится обзор, описание и сценарии использования этой технологии.</span><span class="sxs-lookup"><span data-stu-id="5ca99-106">This article looks at this technology, describing what it is and why you might want to use it.</span></span>

## <a name="service-bus-fundamentals"></a><span data-ttu-id="5ca99-107">Базовая информация о Service Bus</span><span class="sxs-lookup"><span data-stu-id="5ca99-107">Service Bus fundamentals</span></span>

<span data-ttu-id="5ca99-108">В разных ситуациях требуются разные способы взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="5ca99-108">Different situations call for different styles of communication.</span></span> <span data-ttu-id="5ca99-109">Иногда лучшим решением является обмен сообщениями между приложениями через простую очередь.</span><span class="sxs-lookup"><span data-stu-id="5ca99-109">Sometimes, letting applications send and receive messages through a simple queue is the best solution.</span></span> <span data-ttu-id="5ca99-110">В других ситуациях обычной очереди недостаточно и лучше использовать очередь с механизмом публикации и подписки.</span><span class="sxs-lookup"><span data-stu-id="5ca99-110">In other situations, an ordinary queue isn't enough; a queue with a publish-and-subscribe mechanism is better.</span></span> <span data-ttu-id="5ca99-111">В некоторых случаях необходимо лишь подключение между приложениями, а очередь не требуется.</span><span class="sxs-lookup"><span data-stu-id="5ca99-111">In some cases, all that's needed is a connection between applications, and queues are not required.</span></span> <span data-ttu-id="5ca99-112">Служебная шина предлагает все три варианта, позволяя приложениям взаимодействовать несколькими разными способами.</span><span class="sxs-lookup"><span data-stu-id="5ca99-112">Service Bus provides all three options, enabling your applications to interact in several different ways.</span></span>

<span data-ttu-id="5ca99-113">Service Bus — это мультитенантная облачная служба, т. е. служба, совместно используемая несколькими пользователями.</span><span class="sxs-lookup"><span data-stu-id="5ca99-113">Service Bus is a multi-tenant cloud service, which means that the service is shared by multiple users.</span></span> <span data-ttu-id="5ca99-114">Каждый пользователь, например разработчик приложений, создает *пространство имен* и определяет механизмы взаимодействия, которые должны в нем использоваться.</span><span class="sxs-lookup"><span data-stu-id="5ca99-114">Each user, such as an application developer, creates a *namespace*, then defines the communication mechanisms needed within that namespace.</span></span> <span data-ttu-id="5ca99-115">Эта архитектура показана на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="5ca99-115">Figure 1 shows how this architecture looks.</span></span>

![][1]

<span data-ttu-id="5ca99-116">**Рис. 1. Служебная шина предоставляет мультитенантную службу для связи приложений через облако**</span><span class="sxs-lookup"><span data-stu-id="5ca99-116">**Figure 1: Service Bus provides a multi-tenant service for connecting applications through the cloud.**</span></span>

<span data-ttu-id="5ca99-117">В рамках пространства имен можно использовать один или несколько экземпляров трех механизмов взаимодействия, связывающих приложения по-разному.</span><span class="sxs-lookup"><span data-stu-id="5ca99-117">Within a namespace, you can use one or more instances of three different communication mechanisms, each of which connects applications in a different way.</span></span> <span data-ttu-id="5ca99-118">Возможны следующие варианты:</span><span class="sxs-lookup"><span data-stu-id="5ca99-118">The choices are:</span></span>

* <span data-ttu-id="5ca99-119">*Очереди*, которые поддерживают однонаправленное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="5ca99-119">*Queues*, which allow one-directional communication.</span></span> <span data-ttu-id="5ca99-120">Каждая очередь действует как посредник (иногда называемый *брокером*), который хранит отправленные сообщения, пока они не будут получены.</span><span class="sxs-lookup"><span data-stu-id="5ca99-120">Each queue acts as an intermediary (sometimes called a *broker*) that stores sent messages until they are received.</span></span> <span data-ttu-id="5ca99-121">Каждое сообщение получает один получатель.</span><span class="sxs-lookup"><span data-stu-id="5ca99-121">Each message is received by a single recipient.</span></span>
* <span data-ttu-id="5ca99-122">*Разделы*, которые поддерживают однонаправленное взаимодействие с использованием *подписок*. В одном разделе может быть несколько подписок.</span><span class="sxs-lookup"><span data-stu-id="5ca99-122">*Topics*, which provide one-directional communication using *subscriptions*-a single topic can have multiple subscriptions.</span></span> <span data-ttu-id="5ca99-123">Подобно очереди, раздел действует как брокер, но каждая подписка может при необходимости применить фильтр, чтобы получать только те сообщения, которые соответствуют определенным условиям.</span><span class="sxs-lookup"><span data-stu-id="5ca99-123">Like a queue, a topic acts as a broker, but each subscription can optionally use a filter to receive only messages that match specific criteria.</span></span>
* <span data-ttu-id="5ca99-124">*Ретрансляторы*, которые обеспечивают двунаправленное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="5ca99-124">*Relays*, which provide bi-directional communication.</span></span> <span data-ttu-id="5ca99-125">В отличие от очередей и разделов ретранслятор не хранит передаваемые сообщения, так как не является брокером.</span><span class="sxs-lookup"><span data-stu-id="5ca99-125">Unlike queues and topics, a relay doesn't store in-flight messages; it's not a broker.</span></span> <span data-ttu-id="5ca99-126">Он просто передает сообщения целевым приложениям.</span><span class="sxs-lookup"><span data-stu-id="5ca99-126">Instead, it just passes them on to the destination application.</span></span>

<span data-ttu-id="5ca99-127">При создании очереди, раздела или ретранслятора задается имя.</span><span class="sxs-lookup"><span data-stu-id="5ca99-127">When you create a queue, topic, or relay, you give it a name.</span></span> <span data-ttu-id="5ca99-128">В комбинации с именем пространства имен это имя создает уникальный идентификатор объекта.</span><span class="sxs-lookup"><span data-stu-id="5ca99-128">Combined with whatever you called your namespace, this name creates a unique identifier for the object.</span></span> <span data-ttu-id="5ca99-129">Приложения могут передать это имя службе Service Bus, а затем использовать соответствующую очередь, раздел или ретранслятор для взаимодействия с другими приложениями.</span><span class="sxs-lookup"><span data-stu-id="5ca99-129">Applications can provide this name to Service Bus, then use that queue, topic, or relay to communicate with one another.</span></span> 

<span data-ttu-id="5ca99-130">Приложения Windows могут использовать эти объекты в сценарии ретрансляции с помощью Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="5ca99-130">To use any of these objects in the relay scenario, Windows applications can use Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="5ca99-131">Эта служба называется [ретранслятором WCF](../service-bus-relay/relay-what-is-it.md).</span><span class="sxs-lookup"><span data-stu-id="5ca99-131">This service is known as [WCF Relay](../service-bus-relay/relay-what-is-it.md).</span></span> <span data-ttu-id="5ca99-132">Для очередей и разделов приложения Windows могут использовать API-интерфейсы для обмена сообщениями, определяемые служебной шиной.</span><span class="sxs-lookup"><span data-stu-id="5ca99-132">For queues and topics, Windows applications can use Service Bus-defined messaging APIs.</span></span> <span data-ttu-id="5ca99-133">Чтобы упростить использование этих объектов из приложений сторонних разработчиков, Майкрософт предлагает пакеты SDK для Java, Node.js и других языков.</span><span class="sxs-lookup"><span data-stu-id="5ca99-133">To make these objects easier to use from non-Windows applications, Microsoft provides SDKs for Java, Node.js, and other languages.</span></span> <span data-ttu-id="5ca99-134">К очередям и разделам можно получить доступ также с помощью интерфейсов [REST API](/rest/api/servicebus/) через HTTP (HTTPS).</span><span class="sxs-lookup"><span data-stu-id="5ca99-134">You can also access queues and topics using [REST APIs](/rest/api/servicebus/) over HTTP(s).</span></span> 

<span data-ttu-id="5ca99-135">Важно понимать, что хотя служебная шина и работает в облаке (т. е. в центрах обработки данных Microsoft Azure), использующие ее приложения могут работать где угодно.</span><span class="sxs-lookup"><span data-stu-id="5ca99-135">It's important to understand that even though Service Bus itself runs in the cloud (that is, in Microsoft's Azure datacenters), applications that use it can run anywhere.</span></span> <span data-ttu-id="5ca99-136">С помощью служебной шины можно связать приложения, выполняемые, например, в Azure и в локальном центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="5ca99-136">You can use Service Bus to connect applications running on Azure, for example, or applications running inside your own datacenter.</span></span> <span data-ttu-id="5ca99-137">Эту службу также можно использовать для связи приложения, работающего в Azure или на другой облачной платформе, с локальным приложением или с планшетами и телефонами.</span><span class="sxs-lookup"><span data-stu-id="5ca99-137">You can also use it to connect an application running on Azure or another cloud platform with an on-premises application or with tablets and phones.</span></span> <span data-ttu-id="5ca99-138">Можно даже связывать бытовые приборы, датчики и другие устройства с центральным приложением или друг с другом.</span><span class="sxs-lookup"><span data-stu-id="5ca99-138">It's even possible to connect household appliances, sensors, and other devices to a central application or to one other.</span></span> <span data-ttu-id="5ca99-139">Служебная шина — это механизм взаимодействия в облаке, доступный практически везде.</span><span class="sxs-lookup"><span data-stu-id="5ca99-139">Service Bus is a communication mechanism in the cloud that's accessible from pretty much anywhere.</span></span> <span data-ttu-id="5ca99-140">Способ ее использования зависит от целей приложения.</span><span class="sxs-lookup"><span data-stu-id="5ca99-140">How you use it depends on what your applications need to do.</span></span>

## <a name="queues"></a><span data-ttu-id="5ca99-141">Очереди</span><span class="sxs-lookup"><span data-stu-id="5ca99-141">Queues</span></span>

<span data-ttu-id="5ca99-142">Предположим, вам необходимо связать два приложения с помощью очереди служебной шины.</span><span class="sxs-lookup"><span data-stu-id="5ca99-142">Suppose you decide to connect two applications using a Service Bus queue.</span></span> <span data-ttu-id="5ca99-143">Эта ситуация показана на рисунке 2.</span><span class="sxs-lookup"><span data-stu-id="5ca99-143">Figure 2 illustrates this situation.</span></span>

![][2]

<span data-ttu-id="5ca99-144">**Рис. 2. Очереди служебной шины обеспечивают однонаправленное асинхронное взаимодействие**</span><span class="sxs-lookup"><span data-stu-id="5ca99-144">**Figure 2: Service Bus queues provide one-way asynchronous queuing.**</span></span>

<span data-ttu-id="5ca99-145">Процесс прост: отправитель отправляет сообщение в очередь Service Bus, а получатель извлекает это сообщение позднее.</span><span class="sxs-lookup"><span data-stu-id="5ca99-145">The process is simple: A sender sends a message to a Service Bus queue, and a receiver picks up that message at some later time.</span></span> <span data-ttu-id="5ca99-146">В очереди может быть только один получатель, как показано на рис.</span><span class="sxs-lookup"><span data-stu-id="5ca99-146">A queue can have just a single receiver, as Figure 2 shows.</span></span> <span data-ttu-id="5ca99-147">2, или несколько приложений могут считывать данные одной очереди.</span><span class="sxs-lookup"><span data-stu-id="5ca99-147">Or, multiple applications can read from the same queue.</span></span> <span data-ttu-id="5ca99-148">В последнем случае каждое сообщение считывает только один получатель.</span><span class="sxs-lookup"><span data-stu-id="5ca99-148">In the latter situation, each message is read by just one receiver.</span></span> <span data-ttu-id="5ca99-149">А для службы многоадресной рассылки следует использовать раздел.</span><span class="sxs-lookup"><span data-stu-id="5ca99-149">For a multi-cast service, you should use a topic instead.</span></span>

<span data-ttu-id="5ca99-150">Каждое сообщение состоит из двух частей: набора свойств (пары ключ-значение) и полезных данных сообщения.</span><span class="sxs-lookup"><span data-stu-id="5ca99-150">Each message has two parts: a set of properties, each a key/value pair, and a message payload.</span></span> <span data-ttu-id="5ca99-151">Полезные данные могут быть представлены двоичными данными, текстом или даже форматом XML.</span><span class="sxs-lookup"><span data-stu-id="5ca99-151">The payload can be binary, text, or even XML.</span></span> <span data-ttu-id="5ca99-152">Способ их использования зависит от целей приложения.</span><span class="sxs-lookup"><span data-stu-id="5ca99-152">How they're used depends on what an application is trying to do.</span></span> <span data-ttu-id="5ca99-153">Например, приложение, отправляющее сообщение о недавней продаже, может включить в него свойства **Seller="Ava"** и **Amount=10000**.</span><span class="sxs-lookup"><span data-stu-id="5ca99-153">For example, an application sending a message about a recent sale might include the properties **Seller="Ava"** and **Amount=10000**.</span></span> <span data-ttu-id="5ca99-154">Текст сообщения может содержать отсканированное изображение подписанного контракта или оставаться пустым.</span><span class="sxs-lookup"><span data-stu-id="5ca99-154">The message body might contain a scanned image of the sale's signed contract or, if there isn't one, remain empty.</span></span>

<span data-ttu-id="5ca99-155">Получатель может считать сообщение из очереди Service Bus двумя способами.</span><span class="sxs-lookup"><span data-stu-id="5ca99-155">A receiver can read a message from a Service Bus queue in two different ways.</span></span> <span data-ttu-id="5ca99-156">Первый способ, *[ReceiveAndDelete](/dotnet/api/microsoft.servicebus.messaging.receivemode)*, извлекает сообщение из очереди и сразу удаляет его.</span><span class="sxs-lookup"><span data-stu-id="5ca99-156">The first option, called *[ReceiveAndDelete](/dotnet/api/microsoft.servicebus.messaging.receivemode)*, removes a message from the queue and immediately deletes it.</span></span> <span data-ttu-id="5ca99-157">Это простой способ, но если у получателя произойдет сбой, прежде чем он завершит обработку сообщения, оно будет потеряно.</span><span class="sxs-lookup"><span data-stu-id="5ca99-157">This option is simple, but if the receiver crashes before it finishes processing the message, the message is lost.</span></span> <span data-ttu-id="5ca99-158">Поскольку сообщение было удалено из очереди, другие получатели не смогут прочитать его.</span><span class="sxs-lookup"><span data-stu-id="5ca99-158">Because it's been removed from the queue, no other receiver can access it.</span></span> 

<span data-ttu-id="5ca99-159">Второй способ, *[PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode)*, используется для решения этой проблемы.</span><span class="sxs-lookup"><span data-stu-id="5ca99-159">The second option, *[PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode)*, is meant to help with this problem.</span></span> <span data-ttu-id="5ca99-160">Как и **ReceiveAndDelete**, **PeekLock** извлекает сообщение из очереди.</span><span class="sxs-lookup"><span data-stu-id="5ca99-160">Like **ReceiveAndDelete**, a **PeekLock** read removes a message from the queue.</span></span> <span data-ttu-id="5ca99-161">Однако он не удаляет сообщение.</span><span class="sxs-lookup"><span data-stu-id="5ca99-161">It doesn't delete the message, however.</span></span> <span data-ttu-id="5ca99-162">Вместо этого он блокирует сообщение, делая его невидимым для других получателей, а затем ожидает одно из трех событий:</span><span class="sxs-lookup"><span data-stu-id="5ca99-162">Instead, it locks the message, making it invisible to other receivers, then waits for one of three events:</span></span>

* <span data-ttu-id="5ca99-163">Если получатель успешно обрабатывает сообщение, вызывается функция [Complete()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) и очередь удаляет сообщение.</span><span class="sxs-lookup"><span data-stu-id="5ca99-163">If the receiver processes the message successfully, it calls [Complete()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete), and the queue deletes the message.</span></span> 
* <span data-ttu-id="5ca99-164">Если получатель не может обработать сообщение, вызывается функция [Abandon()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon).</span><span class="sxs-lookup"><span data-stu-id="5ca99-164">If the receiver decides that it can't process the message successfully, it calls [Abandon()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon).</span></span> <span data-ttu-id="5ca99-165">Тогда очередь разблокирует сообщение и делает его доступным для других получателей.</span><span class="sxs-lookup"><span data-stu-id="5ca99-165">The queue then removes the lock from the message and makes it available to other receivers.</span></span>
* <span data-ttu-id="5ca99-166">Если получатель не вызывает ни один из этих методов в течение заданного периода времени (по умолчанию 60 секунд), в очереди считается, что получателю не удалось обработать сообщение.</span><span class="sxs-lookup"><span data-stu-id="5ca99-166">If the receiver calls neither of these methods within a configurable period of time (by default, 60 seconds), the queue assumes the receiver has failed.</span></span> <span data-ttu-id="5ca99-167">В этом случае очередь делает сообщение доступным для других получателей, как при вызове функции **Abandon**.</span><span class="sxs-lookup"><span data-stu-id="5ca99-167">In this case, it behaves as if the receiver had called **Abandon**, making the message available to other receivers.</span></span>

<span data-ttu-id="5ca99-168">Обратите внимание, что может произойти: одно и то же сообщение может быть доставлено дважды, возможно, двум разным получателям.</span><span class="sxs-lookup"><span data-stu-id="5ca99-168">Notice what can happen here: the same message might be delivered twice, perhaps to two different receivers.</span></span> <span data-ttu-id="5ca99-169">Приложения, использующие очереди служебной шины, должны быть готовы к этому событию.</span><span class="sxs-lookup"><span data-stu-id="5ca99-169">Applications using Service Bus queues must be prepared for this event.</span></span> <span data-ttu-id="5ca99-170">Чтобы упростить поиск повторяющихся данных, каждому сообщению задается уникальное свойство [MessageID](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) , которое по умолчанию не изменяется, независимо от того, сколько раз сообщение считывается из очереди.</span><span class="sxs-lookup"><span data-stu-id="5ca99-170">To make duplicate detection easier, each message has a unique [MessageID](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) property that by default stays the same no matter how many times the message is read from a queue.</span></span> 

<span data-ttu-id="5ca99-171">Очереди полезны во многих ситуациях.</span><span class="sxs-lookup"><span data-stu-id="5ca99-171">Queues are useful in quite a few situations.</span></span> <span data-ttu-id="5ca99-172">Они позволяют приложениям взаимодействовать, даже если эти приложения работают не одновременно. Это особенно удобно при использовании пакетных и мобильных приложений.</span><span class="sxs-lookup"><span data-stu-id="5ca99-172">They enable applications to communicate even when both aren't running at the same time, something that's especially handy with batch and mobile applications.</span></span> <span data-ttu-id="5ca99-173">Очередь с несколькими получателями обеспечивает автоматическую балансировку нагрузки, так как отправленные сообщения распределяются между получателями.</span><span class="sxs-lookup"><span data-stu-id="5ca99-173">A queue with multiple receivers also provides automatic load balancing, since sent messages are spread across these receivers.</span></span>

## <a name="topics"></a><span data-ttu-id="5ca99-174">Разделы</span><span class="sxs-lookup"><span data-stu-id="5ca99-174">Topics</span></span>

<span data-ttu-id="5ca99-175">Хотя очереди удобны, они не всегда являются правильным выбором.</span><span class="sxs-lookup"><span data-stu-id="5ca99-175">Useful as they are, queues aren't always the right solution.</span></span> <span data-ttu-id="5ca99-176">Иногда лучше использовать разделы служебной шины.</span><span class="sxs-lookup"><span data-stu-id="5ca99-176">Sometimes, Service Bus topics are better.</span></span> <span data-ttu-id="5ca99-177">Рисунок 3 иллюстрирует принцип работы разделов.</span><span class="sxs-lookup"><span data-stu-id="5ca99-177">Figure 3 illustrates this idea.</span></span>

![][3]

<span data-ttu-id="5ca99-178">**Рис. 3. Подписанное приложение определяет фильтр, на основании которого оно может получать некоторые или все сообщения, отправленные в раздел служебной шины**</span><span class="sxs-lookup"><span data-stu-id="5ca99-178">**Figure 3: Based on the filter a subscribing application specifies, it can receive some or all the messages sent to a Service Bus topic.**</span></span>

<span data-ttu-id="5ca99-179">*Разделы* во многом похожи на очереди.</span><span class="sxs-lookup"><span data-stu-id="5ca99-179">A *topic* is similar in many ways to a queue.</span></span> <span data-ttu-id="5ca99-180">Отправители отправляют сообщения в раздел так же, как в очередь, и эти сообщения выглядят в разделе так же, как в очереди.</span><span class="sxs-lookup"><span data-stu-id="5ca99-180">Senders submit messages to a topic in the same way that they submit messages to a queue, and those messages look the same as with queues.</span></span> <span data-ttu-id="5ca99-181">Отличие заключается в том, что разделы позволяют каждому принимающему приложению создавать собственную *подписку*, определив *фильтр*.</span><span class="sxs-lookup"><span data-stu-id="5ca99-181">The difference is that topics enable each receiving application to create its own *subscription* by defining a *filter*.</span></span> <span data-ttu-id="5ca99-182">Подписчик будет видеть только те сообщения, которые соответствуют фильтру.</span><span class="sxs-lookup"><span data-stu-id="5ca99-182">A subscriber then sees only the messages that match that filter.</span></span> <span data-ttu-id="5ca99-183">Например, на рисунке 3 показан отправитель и раздел с тремя подписчиками, у каждого из которых имеется собственный фильтр:</span><span class="sxs-lookup"><span data-stu-id="5ca99-183">For example, Figure 3 shows a sender and a topic with three subscribers, each with its own filter:</span></span>

* <span data-ttu-id="5ca99-184">Подписчик 1 получает только сообщения, содержащие свойство *Seller="Ava"*.</span><span class="sxs-lookup"><span data-stu-id="5ca99-184">Subscriber 1 receives only messages that contain the property *Seller="Ava"*.</span></span>
* <span data-ttu-id="5ca99-185">Подписчик 2 получает сообщения, содержащие свойства *Seller="Ruby"* и *Amount* со значением больше 100 000.</span><span class="sxs-lookup"><span data-stu-id="5ca99-185">Subscriber 2 receives messages that contain the property *Seller="Ruby"* and/or contain an *Amount* property whose value is greater than 100,000.</span></span> <span data-ttu-id="5ca99-186">Возможно, Ruby — это продавец, который хочет просматривать свои собственные продажи и крупные продажи независимо от того, кто их осуществил.</span><span class="sxs-lookup"><span data-stu-id="5ca99-186">Perhaps Ruby is the sales manager, so she wants to see both her own sales and all large sales regardless of who makes them.</span></span>
* <span data-ttu-id="5ca99-187">Подписчик 3 задал для фильтра значение *True*, которое означает, что он получает все сообщения.</span><span class="sxs-lookup"><span data-stu-id="5ca99-187">Subscriber 3 has set its filter to *True*, which means that it receives all messages.</span></span> <span data-ttu-id="5ca99-188">Это приложение может, к примеру, вести журнал аудита, и поэтому ему нужен доступ ко всем сообщениям.</span><span class="sxs-lookup"><span data-stu-id="5ca99-188">For example, this application might be responsible for maintaining an audit trail and therefore it needs to see all the messages.</span></span>

<span data-ttu-id="5ca99-189">Как и очереди, подписчики раздела могут считывать сообщения с помощью методов [ReceiveAndDelete или PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode).</span><span class="sxs-lookup"><span data-stu-id="5ca99-189">As with queues, subscribers to a topic can read messages using either [ReceiveAndDelete or PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode).</span></span> <span data-ttu-id="5ca99-190">Однако отдельное сообщение, отправленное в раздел (в отличие от очереди), может быть получено несколькими подписками.</span><span class="sxs-lookup"><span data-stu-id="5ca99-190">Unlike queues, however, a single message sent to a topic can be received by multiple subscriptions.</span></span> <span data-ttu-id="5ca99-191">Такой подход, обычно называемый *публикация и подписка* (или *pub/sub*), используется, когда несколько приложений ожидают одни и те же сообщения.</span><span class="sxs-lookup"><span data-stu-id="5ca99-191">This approach, commonly called *publish and subscribe* (or *pub/sub*), is useful whenever multiple applications are interested in the same messages.</span></span> <span data-ttu-id="5ca99-192">Правильно определив фильтр, каждый подписчик может получить доступ лишь к той части потока сообщений, которая ему необходима.</span><span class="sxs-lookup"><span data-stu-id="5ca99-192">By defining the right filter, each subscriber can tap into just the part of the message stream that it needs to see.</span></span>

## <a name="relays"></a><span data-ttu-id="5ca99-193">Ретрансляторы</span><span class="sxs-lookup"><span data-stu-id="5ca99-193">Relays</span></span>

<span data-ttu-id="5ca99-194">Очереди и разделы обеспечивают однонаправленное асинхронное взаимодействие через брокер.</span><span class="sxs-lookup"><span data-stu-id="5ca99-194">Both queues and topics provide one-way asynchronous communication through a broker.</span></span> <span data-ttu-id="5ca99-195">Трафик протекает только в одном направлении, и между отправителями и получателями нет прямой связи.</span><span class="sxs-lookup"><span data-stu-id="5ca99-195">Traffic flows in just one direction, and there's no direct connection between senders and receivers.</span></span> <span data-ttu-id="5ca99-196">Но что делать, если требуется другое подключение?</span><span class="sxs-lookup"><span data-stu-id="5ca99-196">But what if you don't want this connection?</span></span> <span data-ttu-id="5ca99-197">Предположим, что вашим приложениям нужно и отправлять, и получать сообщения или необходима прямая связь между приложениями, а посредник для хранения сообщений не требуется.</span><span class="sxs-lookup"><span data-stu-id="5ca99-197">Suppose your applications need to both send and receive messages, or perhaps you want a direct link between them and you don't need a broker to store messages.</span></span> <span data-ttu-id="5ca99-198">Для таких случаев в служебной шине есть *ретрансляторы*, как показано на рисунке 4.</span><span class="sxs-lookup"><span data-stu-id="5ca99-198">To address scenarios such as this, Service Bus provides *relays*, as Figure 4 shows.</span></span>

![][4]

<span data-ttu-id="5ca99-199">**Рис. 4. Ретранслятор служебной шины обеспечивает синхронное двунаправленное взаимодействие между приложениями**</span><span class="sxs-lookup"><span data-stu-id="5ca99-199">**Figure 4: Service Bus relay provides synchronous, two-way communication between applications.**</span></span>

<span data-ttu-id="5ca99-200">В каких случаях используются ретрансляторы?</span><span class="sxs-lookup"><span data-stu-id="5ca99-200">The obvious question to ask about relays is this: why would I use one?</span></span> <span data-ttu-id="5ca99-201">Даже если очереди не нужны, почему бы приложениям взаимодействовать не через облачную службу, а напрямую?</span><span class="sxs-lookup"><span data-stu-id="5ca99-201">Even if I don't need queues, why make applications communicate via a cloud service rather than just interact directly?</span></span> <span data-ttu-id="5ca99-202">Дело в том, что организовать прямой обмен сообщениями сложнее, чем кажется.</span><span class="sxs-lookup"><span data-stu-id="5ca99-202">The answer is that talking directly can be harder than you might think.</span></span>

<span data-ttu-id="5ca99-203">Предположим, нужно связать два локальных приложения, которые выполняются в корпоративных центрах обработки данных.</span><span class="sxs-lookup"><span data-stu-id="5ca99-203">Suppose you want to connect two on-premises applications, both running inside corporate datacenters.</span></span> <span data-ttu-id="5ca99-204">Каждое из этих приложений находится за брандмауэром, а центры обработки данных могут использовать преобразование сетевых адресов (NAT).</span><span class="sxs-lookup"><span data-stu-id="5ca99-204">Each of these applications sits behind a firewall, and each datacenter probably uses network address translation (NAT).</span></span> <span data-ttu-id="5ca99-205">Брандмауэр блокирует входящие данные на всех портах кроме нескольких, а вследствие действия NAT компьютеры, на которых работают приложения, не имеют фиксированных IP-адресов, к которым можно получить непосредственный доступ за пределами центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="5ca99-205">The firewall blocks incoming data on all but a few ports, and NAT implies that the machine each application is running on doesn't have a fixed IP address that you can reach directly from outside the datacenter.</span></span> <span data-ttu-id="5ca99-206">Без дополнительных средств эти приложения непросто связать через общедоступный Интернет.</span><span class="sxs-lookup"><span data-stu-id="5ca99-206">Without some extra help, connecting these applications over the public internet is problematic.</span></span>

<span data-ttu-id="5ca99-207">Ретранслятор служебной шины Azure может помочь в этом.</span><span class="sxs-lookup"><span data-stu-id="5ca99-207">A Service Bus relay can help.</span></span> <span data-ttu-id="5ca99-208">Для двунаправленного взаимодействия через ретранслятор каждое приложение устанавливает исходящее TCP-соединение с Service Bus и держит его открытым.</span><span class="sxs-lookup"><span data-stu-id="5ca99-208">To communicate bi-directionally through a relay, each application establishes an outbound TCP connection with Service Bus, then keeps it open.</span></span> <span data-ttu-id="5ca99-209">Весь обмен данными между двумя приложениями проходит через эти соединения.</span><span class="sxs-lookup"><span data-stu-id="5ca99-209">All communication between the two applications travels over these connections.</span></span> <span data-ttu-id="5ca99-210">Так как каждое соединение установлено из центра обработки данных, брандмауэр разрешает входящий трафик для каждого приложения без открытия новых портов.</span><span class="sxs-lookup"><span data-stu-id="5ca99-210">Because each connection was established from inside the datacenter, the firewall allows incoming traffic to each application without opening new ports.</span></span> <span data-ttu-id="5ca99-211">Этот подход также решает проблему NAT, так как каждое приложение имеет постоянную конечную точку в облаке на протяжении всего обмена данными.</span><span class="sxs-lookup"><span data-stu-id="5ca99-211">This approach also gets around the NAT problem, because each application has a consistent endpoint in the cloud throughout the communication.</span></span> <span data-ttu-id="5ca99-212">Обмениваясь данными через ретранслятор, приложения могут избежать проблем, которые в противном случае осложнили бы взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="5ca99-212">By exchanging data through the relay, the applications can avoid the problems that would otherwise make communication difficult.</span></span> 

<span data-ttu-id="5ca99-213">Приложения могут использовать ретрансляторы служебной шины с помощью Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="5ca99-213">To use Service Bus relays, applications rely on the Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="5ca99-214">Service Bus предоставляет привязки WCF, которые упрощают взаимодействие приложений Windows через ретрансляторы.</span><span class="sxs-lookup"><span data-stu-id="5ca99-214">Service Bus provides WCF bindings that make it straightforward for Windows applications to interact via relays.</span></span> <span data-ttu-id="5ca99-215">Приложения, которые уже используют WCF, могут указать одну из этих привязок и обмениваться данными через ретранслятор.</span><span class="sxs-lookup"><span data-stu-id="5ca99-215">Applications that already use WCF can typically specify one of these bindings, then talk to each other through a relay.</span></span> <span data-ttu-id="5ca99-216">В отличие от использования очередей и разделов, использование ретрансляторов из приложений, работающих не под управлением Windows, хотя и возможно, но требует дополнительных усилий программистов, так как стандартные библиотеки не предусмотрены.</span><span class="sxs-lookup"><span data-stu-id="5ca99-216">Unlike queues and topics, however, using relays from non-Windows applications, while possible, requires some programming effort; no standard libraries are provided.</span></span>

<span data-ttu-id="5ca99-217">В отличие от очередей и разделов, приложения не создают ретрансляторы явно.</span><span class="sxs-lookup"><span data-stu-id="5ca99-217">Unlike queues and topics, applications don't explicitly create relays.</span></span> <span data-ttu-id="5ca99-218">Когда приложение, которое собирается получать сообщения, устанавливает TCP-соединение с Service Bus, ретранслятор создается автоматически.</span><span class="sxs-lookup"><span data-stu-id="5ca99-218">Instead, when an application that wishes to receive messages establishes a TCP connection with Service Bus, a relay is created automatically.</span></span> <span data-ttu-id="5ca99-219">Когда соединение разрывается, ретранслятор удаляется.</span><span class="sxs-lookup"><span data-stu-id="5ca99-219">When the connection is dropped, the relay is deleted.</span></span> <span data-ttu-id="5ca99-220">Чтобы приложение могло найти ретранслятор, созданный конкретным прослушивателем, служебная шина предоставляет реестр, который позволяет приложениям найти конкретный ретранслятор по имени.</span><span class="sxs-lookup"><span data-stu-id="5ca99-220">To enable an application to find the relay created by a specific listener, Service Bus provides a registry that enables applications to locate a specific relay by name.</span></span>

<span data-ttu-id="5ca99-221">Ретрансляторы являются оптимальным решением, когда требуется прямое взаимодействие между приложениями.</span><span class="sxs-lookup"><span data-stu-id="5ca99-221">Relays are the right solution when you need direct communication between applications.</span></span> <span data-ttu-id="5ca99-222">Например, система бронирования авиабилетов, работающая в локальном центре обработки данных, к которой должен осуществляться доступ из киосков регистрации, с мобильных устройств и с других компьютеров.</span><span class="sxs-lookup"><span data-stu-id="5ca99-222">For example, consider an airline reservation system running in an on-premises datacenter that must be accessed from check-in kiosks, mobile devices, and other computers.</span></span> <span data-ttu-id="5ca99-223">Приложения, работающие во всех этих системах, могут взаимодействовать через ретрансляторы служебной шины в облаке, где бы они ни находились.</span><span class="sxs-lookup"><span data-stu-id="5ca99-223">Applications running on all these systems could rely on Service Bus relays in the cloud to communicate, wherever they might be running.</span></span>

## <a name="summary"></a><span data-ttu-id="5ca99-224">Сводка</span><span class="sxs-lookup"><span data-stu-id="5ca99-224">Summary</span></span>

<span data-ttu-id="5ca99-225">Подключение приложений всегда было частью создания полноценных решений. Диапазон сценариев, для которых требуется взаимодействие между приложениями и службами, будет расти по мере подключения все большего количества приложений и устройств к Интернету.</span><span class="sxs-lookup"><span data-stu-id="5ca99-225">Connecting applications has always been part of building complete solutions, and the range of scenarios that require applications and services to communicate with each other is set to increase as more applications and devices are connected to the internet.</span></span> <span data-ttu-id="5ca99-226">При предоставлении облачных технологий для взаимодействия с помощью очередей, разделов и ретрансляторов используется служебная шина, которая упрощает эту важную функцию и делает ее более доступной.</span><span class="sxs-lookup"><span data-stu-id="5ca99-226">By providing cloud-based technologies for achieving communication through queues, topics, and relays, Service Bus aims to make this essential function easier to implement and more broadly available.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5ca99-227">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="5ca99-227">Next steps</span></span>

<span data-ttu-id="5ca99-228">Вы познакомились с основами служебной шины Azure, используйте следующие ссылки для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="5ca99-228">Now that you've learned the fundamentals of Azure Service Bus, follow these links to learn more.</span></span>

* <span data-ttu-id="5ca99-229">Как использовать [очереди служебной шины](service-bus-dotnet-get-started-with-queues.md)</span><span class="sxs-lookup"><span data-stu-id="5ca99-229">How to use [Service Bus queues](service-bus-dotnet-get-started-with-queues.md)</span></span>
* <span data-ttu-id="5ca99-230">Как использовать [разделы служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)</span><span class="sxs-lookup"><span data-stu-id="5ca99-230">How to use [Service Bus topics](service-bus-dotnet-how-to-use-topics-subscriptions.md)</span></span>
* <span data-ttu-id="5ca99-231">Как использовать [ретрансляторы служебной шины](../service-bus-relay/service-bus-dotnet-how-to-use-relay.md)</span><span class="sxs-lookup"><span data-stu-id="5ca99-231">How to use [Service Bus relay](../service-bus-relay/service-bus-dotnet-how-to-use-relay.md)</span></span>
* [<span data-ttu-id="5ca99-232">Служебная шина: примеры</span><span class="sxs-lookup"><span data-stu-id="5ca99-232">Service Bus samples</span></span>](service-bus-samples.md)

[1]: ./media/service-bus-fundamentals-hybrid-solutions/SvcBus_01_architecture.png
[2]: ./media/service-bus-fundamentals-hybrid-solutions/SvcBus_02_queues.png
[3]: ./media/service-bus-fundamentals-hybrid-solutions/SvcBus_03_topicsandsubscriptions.png
[4]: ./media/service-bus-fundamentals-hybrid-solutions/SvcBus_04_relay.png
