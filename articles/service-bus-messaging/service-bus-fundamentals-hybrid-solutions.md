---
title: "aaaOverview из принципы работы Azure Service Bus | Документы Microsoft"
description: "Введение toousing Service Bus tooconnect программного обеспечения tooother приложения Azure."
services: service-bus-messaging
documentationcenter: .net
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 12654cdd-82ab-4b95-b56f-08a5a8bbc6f9
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/15/2017
ms.author: sethm
ms.openlocfilehash: 1abd5cf310ef06ba35e1e2489a7c0a07e1797736
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-service-bus"></a>Azure Service Bus

Приложение или служба выполняется в облаке hello, или на локальном компьютере, должен ли он часто toointeract с другими приложениями или службами. tooprovide toodo широко удобным способом, предложения Microsoft Azure Service Bus. В этой статье рассматривается эта технология, описывающее, что это такое и зачем может потребоваться toouse его.

## <a name="service-bus-fundamentals"></a>Базовая информация о Service Bus

В разных ситуациях требуются разные способы взаимодействия. Иногда позволяя приложениям отправлять и получать сообщения с помощью простой очереди является наилучшим решением hello. В других ситуациях обычной очереди недостаточно и лучше использовать очередь с механизмом публикации и подписки. В некоторых случаях необходимо лишь подключение между приложениями, а очередь не требуется. Шина обслуживания предоставляет все три параметра, включение toointeract вашего приложения несколькими способами.

Шина обслуживания — это служба многопользовательского облачного, это означает, что служба hello совместно используется несколькими пользователями. Каждый пользователь, например, разработчик приложения создает *имен*, затем определяет механизмы hello связи, необходимые в этом пространстве имен. Эта архитектура показана на рис. 1.

![][1]

**Рисунок 1: Service Bus предоставляет службу несколькими клиентами для подключения с помощью hello облачных приложений.**

В рамках пространства имен можно использовать один или несколько экземпляров трех механизмов взаимодействия, связывающих приложения по-разному. Hello следующие варианты:

* *Очереди*, которые поддерживают однонаправленное взаимодействие. Каждая очередь действует как посредник (иногда называемый *брокером*), который хранит отправленные сообщения, пока они не будут получены. Каждое сообщение получает один получатель.
* *Разделы*, которые поддерживают однонаправленное взаимодействие с использованием *подписок*. В одном разделе может быть несколько подписок. Как и очередь тема выступает посредником, но каждая подписка может дополнительно использовать фильтр tooreceive только сообщения, которые соответствуют определенным критериям.
* *Ретрансляторы*, которые обеспечивают двунаправленное взаимодействие. В отличие от очередей и разделов ретранслятор не хранит передаваемые сообщения, так как не является брокером. Вместо этого он просто передает их на toohello конечное приложение.

При создании очереди, раздела или ретранслятора задается имя. Вместе с любой Вы вызвали пространства имен, оно создает уникальный идентификатор для hello объекта. Приложения можно указать это имя tooService шины, а затем использовать этой очереди, раздела или ретрансляции toocommunicate друг с другом. 

любой из этих объектов в сценарии ретрансляции hello toouse, приложения Windows можно использовать Windows Communication Foundation (WCF). Эта служба называется [ретранслятором WCF](../service-bus-relay/relay-what-is-it.md). Для очередей и разделов приложения Windows могут использовать API-интерфейсы для обмена сообщениями, определяемые служебной шиной. toomake этими объектами проще toouse из приложений, отличных от Windows, корпорация Майкрософт предоставляет пакеты SDK для Java, Node.js и другие языки. К очередям и разделам можно получить доступ также с помощью интерфейсов [REST API](/rest/api/servicebus/) через HTTP (HTTPS). 

Очень важно, несмотря на то что службы шины сам toounderstand работает в облаке hello (то есть в центрах обработки данных Azure корпорации Майкрософт), приложения, использующие его можно запустить в любом месте. Можно использовать приложения tooconnect Service Bus, работающие в Azure, например, или приложений, работающих в собственном центре обработки данных. Ее можно также использовать tooconnect приложения, работающего в Azure или другой облачной платформы приложения локально или с планшетов и телефонов. Это возможно также tooconnect домашние приборы, датчики и другие приложения центра tooa устройства или tooone других. Шина обслуживания — это механизм связи в облаке hello, доступный отовсюду во многом. Как использовать зависит какие приложения требуются toodo.

## <a name="queues"></a>Очереди

Предположим, что вы решите tooconnect двух приложений с помощью очереди Service Bus. Эта ситуация показана на рисунке 2.

![][2]

**Рис. 2. Очереди служебной шины обеспечивают однонаправленное асинхронное взаимодействие**

Hello процедура проста: отправитель посылает сообщение очереди Service Bus tooa и приемник забирает сообщения в дальнейшем. В очереди может быть только один получатель, как показано на рис. Или несколько приложений могут считываться hello одной очереди. В последнем случае hello каждое сообщение считывается только один получатель. А для службы многоадресной рассылки следует использовать раздел.

Каждое сообщение состоит из двух частей: набора свойств (пары ключ-значение) и полезных данных сообщения. Hello полезных данных может быть двоичный файл, текст или даже XML. Их использование зависит от того, какое приложение пытается toodo. Например, приложения, отправляющие сообщения о последних продаж могут включать свойства hello **продавца = «Ava»** и **сумма = 10000**. текст сообщения Hello может содержать отсканированные изображения hello продажи знаком контракта или, если нет, остаются пустыми.

Получатель может считать сообщение из очереди Service Bus двумя способами. Здравствуйте, первый параметр, называемый  *[ReceiveAndDelete](/dotnet/api/microsoft.servicebus.messaging.receivemode)*, удаляет сообщение из очереди hello и немедленно удаляется. Этот параметр является простой, но если получатель hello аварийно завершает работу после окончания обработки сообщения hello, приветственное сообщение теряется. Так как оно является было удалено из очереди hello, нет других приемника к нему возможен доступ. 

Здравствуйте, второй параметр  *[PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode)*, предназначена toohelp с этой проблемой. Как **ReceiveAndDelete**, **PeekLock** чтения удаляет сообщение из очереди hello. Приветственное сообщение, но не удаляется. Вместо этого блокирует приветственное сообщение, делая его невидимым tooother приемников, затем ожидает один из трех событий:

* Если процессы приемника hello hello сообщение успешно, он вызывает метод [Complete()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete), и hello очереди удаляет сообщение hello. 
* Если получатель hello решает, что он не может успешно обработать сообщение hello, он вызывает [Abandon()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon). очередь Hello затем удаление hello блокировки с приветственное сообщение и делает его доступных tooother получателей.
* Если получатель hello вызывает ни один из этих методов в течение настроенного периода времени (по умолчанию — 60 секунд), hello очереди предполагается, что получатель hello произошел сбой. В этом случае он ведет себя как если бы вызвана hello получателя **прервать**, делая hello доступных tooother получателей сообщений.

Обратите внимание, что может произойти здесь: hello же сообщение может быть доставлен дважды, возможно tootwo разные получатели. Приложения, использующие очереди служебной шины, должны быть готовы к этому событию. toomake обнаружения повторяющихся сообщений проще, каждое сообщение имеет уникальный [MessageID](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) свойство, которое по умолчанию hello остается таким же, независимо от того, сколько раз приветственное сообщение считывается из очереди. 

Очереди полезны во многих ситуациях. Они позволяют приложениям toocommunicate даже в том случае, если оба работают не под управлением в hello же время, то, что особенно удобно, поскольку с помощью пакета и приложений для мобильных устройств. Очередь с несколькими получателями обеспечивает автоматическую балансировку нагрузки, так как отправленные сообщения распределяются между получателями.

## <a name="topics"></a>Разделы

Полезным, как они являются, очереди не всегда hello подходящее решение. Иногда лучше использовать разделы служебной шины. Рисунок 3 иллюстрирует принцип работы разделов.

![][3]

**Рисунок 3: На основании hello фильтр, который указывает подписанного приложения, он может получить некоторые или все сообщения hello отправлены tooa раздел служебной шины.**

Объект *разделе* аналогично и во многих способов tooa очереди. Отправители отправки сообщений tooa раздела hello так же, как они отправляют tooa сообщений в очереди, что внешний вид этих сообщений hello так же, как очереди. Hello отличие заключается в том, что разделы включить каждого принимающее приложение toocreate свой собственный *подписки* путем определения *фильтра*. Затем подписчик видит только сообщения hello, которые соответствуют этим фильтром. Например, на рисунке 3 показан отправитель и раздел с тремя подписчиками, у каждого из которых имеется собственный фильтр:

* Подписчик 1 получает только те сообщения, которые содержат свойство hello *продавца = «Ava»*.
* Подписчик 2 получает сообщения, содержащие свойство hello *продавца = «Ruby»* и/или содержать *сумма* свойства, значение которого больше, чем 100 000. Возможно, Ruby является hello менеджер по продажам, поэтому ей toosee собственный продаж и все большие продажи, независимо от того, кто их.
* Подписчик 3 задал фильтром слишком*True*, что означает, что он получает все сообщения. Например возможно, это приложение отвечает за поддержание след аудита и поэтому он должен toosee все сообщения hello.

Как с очередями, в разделе tooa подписчиков доступны для чтения с помощью [ReceiveAndDelete или PeekLock](/dotnet/api/microsoft.servicebus.messaging.receivemode). В отличие от очередей тем не менее, одно сообщение отправлено tooa раздела могут быть получены несколько подписок. Такой подход часто называется *публикации и подписки* (или *pub/sub*), параметр полезен, если несколько приложений интересуют hello же сообщения. Путем определения фильтра справа hello, можно воспользоваться каждому подписчику только часть hello, что ему требуется toosee потока сообщений hello.

## <a name="relays"></a>Ретрансляторы

Очереди и разделы обеспечивают однонаправленное асинхронное взаимодействие через брокер. Трафик протекает только в одном направлении, и между отправителями и получателями нет прямой связи. Но что делать, если требуется другое подключение? Предположим, что приложения должны tooboth отправлять и получать сообщения, или может быть нужно прямую связь между ними и toostore брокера сообщений не требуется. Шина обслуживания предоставляет tooaddress сценарии, такие как это, *ретранслирует*, как показано на рис. 4.

![][4]

**Рис. 4. Ретранслятор служебной шины обеспечивает синхронное двунаправленное взаимодействие между приложениями**

Hello tooask очевидным вопрос о ретрансляциях это: Почему используется? Даже если не создавать очереди, почему бы сделать приложениях взаимодействуют через облачную службу, а не просто взаимодействуют напрямую? получен ответ Hello, взаимодействуют напрямую может быть сложнее, чем может показаться.

Предположим, что нужно tooconnect двух локальных приложений, как выполняется внутри корпоративной центрах обработки данных. Каждое из этих приложений находится за брандмауэром, а центры обработки данных могут использовать преобразование сетевых адресов (NAT). брандмауэр блокирует Hello входящих данных для всех, кроме несколько портов и NAT подразумевает, что компьютер hello, каждое приложение, на котором выполняется не имеет фиксированный IP-адрес, который требуется получить доступ непосредственно из внешнего центра обработки данных hello. Без некоторых дополнительных справки этих приложений можно подключаться по hello общедоступный Интернет проблематичным.

Ретранслятор служебной шины Azure может помочь в этом. toocommunicate двунаправленно через ретранслятор, каждое приложение устанавливает исходящее подключение TCP с Service Bus, а затем поддерживает открытым. Весь обмен данными между двумя приложениями hello проходит через эти подключения. Поскольку каждое соединение было установлено из внутри центра данных hello, hello брандмауэр разрешает входящий трафик tooeach приложения без открытия новых портов. Такой подход также получает проблемы hello NAT, поскольку каждое приложение имеет согласованное конечную точку в облаке hello во всей hello связи. Обмен данными через посредника hello, приложения hello избежать hello проблемы, которые бы в противном случае затруднить связи. 

toouse ретрансляции Service Bus, приложения используют hello Windows Communication Foundation (WCF). Шина обслуживания предоставляет привязок WCF, упрощения toointeract приложений Windows через ретрансляции. Приложения, которые уже используют WCF можно обычно указать один из этих привязок, а затем взаимодействовать tooeach других через ретранслятор. В отличие от использования очередей и разделов, использование ретрансляторов из приложений, работающих не под управлением Windows, хотя и возможно, но требует дополнительных усилий программистов, так как стандартные библиотеки не предусмотрены.

В отличие от очередей и разделов, приложения не создают ретрансляторы явно. Вместо этого когда приложение, которое желает tooreceive сообщений устанавливает соединение TCP со служебной шиной, ретрансляции будет создана автоматически. При удалении подключения hello ретрансляции hello удаляется. tooenable создан сервером приложения toofind hello ретрансляции определенных прослушиватель, Service Bus предоставляет реестра, который позволяет приложениям toolocate конкретных ретрансляции по имени.

Ретрансляторы относятся hello подходящее решение, когда требуется прямой обмен данными между приложениями. Например, система бронирования авиабилетов, работающая в локальном центре обработки данных, к которой должен осуществляться доступ из киосков регистрации, с мобильных устройств и с других компьютеров. Приложения, работающие в этих системах могли полагаться на ретранслятор Service Bus в toocommunicate облаке hello, везде, где они могут запущены.

## <a name="summary"></a>Сводка

Подключение приложений всегда была частью создавать комплексные решения, и диапазон hello ряд сценариев, требующих приложений и служб toocommunicate друг с другом задан tooincrease как несколько приложений и устройств, подключенных toohello Интернета. Предоставляя облачных технологий для достижения взаимодействие через очереди, разделы и ретрансляции Service Bus, цель — toomake проще tooimplement это важная функция и более широкий доступ.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали основы hello Azure Service Bus, выполните следующие дополнительные toolearn ссылки.

* Как toouse [очереди шины обслуживания](service-bus-dotnet-get-started-with-queues.md)
* Как toouse [разделы служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)
* Как toouse [ретрансляции служебной шины](../service-bus-relay/service-bus-dotnet-how-to-use-relay.md)
* [Служебная шина: примеры](service-bus-samples.md)

[1]: ./media/service-bus-fundamentals-hybrid-solutions/SvcBus_01_architecture.png
[2]: ./media/service-bus-fundamentals-hybrid-solutions/SvcBus_02_queues.png
[3]: ./media/service-bus-fundamentals-hybrid-solutions/SvcBus_03_topicsandsubscriptions.png
[4]: ./media/service-bus-fundamentals-hybrid-solutions/SvcBus_04_relay.png
