---
title: "Удостоверение управляемой службы с предварительной версией Azure Service Bus | Документы Microsoft"
description: "Использование управляемой службы удостоверений с Azure Service Bus"
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/19/2017
ms.author: sethm
ms.openlocfilehash: 6965e80cf10b732d4d0a8fb78447f188c133979d
ms.sourcegitcommit: f46cbcff710f590aebe437c6dd459452ddf0af09
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2017
---
# <a name="managed-service-identity-preview"></a>Управляемые учетные данные службы (Предварительная версия)

Управляемые службы удостоверений (MSI) является функцией между Azure, которая позволяет создавать безопасные удостоверение, связанное с развертыванием, под которой выполняется код приложения. Затем можно связать его с ролями управления доступом, предоставляющими пользовательских разрешений для доступа к определенным ресурсам Azure, необходимые приложению.

С помощью MSI платформа Azure управляет этот идентификатор среды выполнения. Необязательно для хранения и защиты ключей доступа в коде приложения или конфигурации, либо для идентификации себя, либо необходимо получить доступ к ресурсам. Service Bus клиентского приложения, выполнив внутри приложения службы приложений Azure или на виртуальной машине включена поддержка MSI не требуется обрабатывать правила SAS и ключи или любые другие маркеры доступа. В клиентском приложении достаточно только адрес конечной точки пространства имен обмен сообщениями Service Bus. Когда приложение подключается, Service Bus привязывает контекст MSI клиенту в операции, показанный в примере далее в этой статье. 

Как только он связан с удостоверением управляемой службы, полномочными операции можно выполнять клиента служебной шины. Авторизация выполняется с помощью привязывания MSI роли Service Bus. 

## <a name="service-bus-roles-and-permissions"></a>Роли Service Bus и разрешения

Для начальной общедоступном предварительном выпуске можно добавлять только идентификаторы управляемых служб роли «Владелец» или «Участник» пространства имен служебной шины, который предоставляет удостоверение полный доступ на все сущности в пространстве имен. Однако управление операций, изменяющих топологии пространства имен, изначально являются только то, что поддерживается диспетчера ресурсов Azure, а не через интерфейс управления Service Bus REST в машинном коде. Эта поддержка также означает, что нельзя использовать клиент .NET Framework [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) объекта в идентификаторы управляемых служб.

## <a name="use-service-bus-with-a-managed-service-identity"></a>Использование Service Bus с помощью управляемой службы удостоверения

В следующем разделе описаны шаги, необходимые для создания и развертывания образца приложения, работающего под идентификаторы управляемых служб, предоставьте этой идентификации доступ к пространству имен, обмен сообщениями Service Bus и как оно взаимодействует с Service Bus сущности, с использованием указанного удостоверения.

Это Введение Описание веб-приложения, размещенного в [службе приложений Azure](https://azure.microsoft.com/services/app-service/). Шаги, необходимые для приложения, разместить виртуальную Машину похожи.

### <a name="create-an-app-service-web-application"></a>Создание веб-приложения служб приложений

Первым шагом является создание приложения ASP.NET службы приложения. Если вы не знакомы с тем, как это сделать в Azure, выполните [это руководство](../app-service/app-service-web-get-started-dotnet-framework.md). Тем не менее вместо того чтобы создавать приложения MVC, как показано в этом учебнике, создайте приложение веб-форм.

### <a name="set-up-the-managed-service-identity"></a>Настройка удостоверений управляемой службы

После создания приложения, перейдите к только что созданный веб-приложения на портале Azure (также отображаются в практическом руководстве), а затем перейдите к **управляемого удостоверения службы** страницы и включить функцию: 

![](./media/service-bus-managed-service-identity/msi1.png)

После включения компонента нового удостоверения службы создается в Azure Active Directory и настраивается в узел службы приложений.

### <a name="create-a-new-service-bus-messaging-namespace"></a>Создать новое пространство имен обмена сообщениями Service Bus

Далее, [создать пространство имен обмена сообщениями Service Bus](service-bus-create-namespace-portal.md) в одном из регионов Azure с поддержкой предварительного просмотра RBAC: **Востоке**, **Восток 2**, или **Западная Европа** . 

Перейдите к пространству имен **управления доступа (IAM)** на портале и нажмите кнопку **добавить** Добавление удостоверение управляемой службы **владельца** роли. Для этого найдите имя веб-приложения в **добавить разрешения** панель **выберите** , а затем щелкните запись. Нажмите кнопку **Сохранить**.

![](./media/service-bus-managed-service-identity/msi2.png)
 
Удостоверение управляемой службы веб-приложение теперь имеет доступ к пространству имен Service Bus, а в очередь созданного ранее. 

### <a name="run-the-app"></a>Запуск приложения

Теперь можно измените страницу по умолчанию созданное приложение ASP.NET. Можно также использовать кода веб-приложений из [этот репозиторий GitHub](https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/ManagedServiceIdentity). 

Страница Default.aspx является целевой страницы. Код можно найти в файле Default.aspx.cs. Результатом является минимальной веб-приложения с несколько полей ввода и **отправки** и **получать** кнопок, подключиться к служебной шины для отправки или получения сообщений.

Обратите внимание как [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) инициализации объекта. Вместо того чтобы использовать Поставщик маркера общего доступа маркера (SAS), код создает поставщик маркеров для управляемой службы удостоверения с `TokenProvider.CreateManagedServiceIdentityTokenProvider(ServiceAudience.EventHubAudience)` вызова. Таким образом нет не секретные данные, чтобы сохранять и использовать. Поток контекста удостоверение управляемой службы Service Bus и подтверждения авторизации параметры автоматически обрабатываются поставщиком маркера, который является моделью проще, чем при использовании SAS.

После внесения этих изменений, публикация и запуск приложения. Для загрузки и затем импортировать профиль публикации в Visual Studio — простой способ получить правильные данные публикации:

![](./media/service-bus-managed-service-identity/msi3.png)
 
Для отправки и получения сообщений, введите имя пространства имен и имя сущности, вы создали, а затем выберите либо **отправки** или **получать**. 
 
Обратите внимание, что удостоверение управляемой службы работает только в среде Azure и только в развертывании службы приложения, в котором она была настроена. Также Обратите внимание, что управляемые удостоверения службы не работают с слоты развертывания служб приложений в настоящее время.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительную информацию об обмене сообщениями через служебную шину см. в следующих разделах.

* [Базовая информация о Service Bus](service-bus-fundamentals-hybrid-solutions.md)
* [Очереди, разделы и подписки служебной шины](service-bus-queues-topics-subscriptions.md)
* [Начало работы с очередями служебной шины](service-bus-dotnet-get-started-with-queues.md)
* [Как использовать разделы и подписки служебной шины](service-bus-dotnet-how-to-use-topics-subscriptions.md)