---
title: "aaaBest и рекомендации по улучшению производительности с помощью Azure Service Bus | Документы Microsoft"
description: "Описывает, как toouse Service Bus toooptimize производительности при обмене через посредника сообщений."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: 52764d227757cbb11246675878933f21685817f1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="8b0de-103">Рекомендации по повышению производительности с помощью обмена сообщениями через служебную шину</span><span class="sxs-lookup"><span data-stu-id="8b0de-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="8b0de-104">В этой статье описывается как toouse [обмена сообщениями Azure Service Bus](https://azure.microsoft.com/services/service-bus/) toooptimize производительности при обмене через посредника сообщений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-104">This article describes how toouse [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) toooptimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="8b0de-105">Hello первая часть этого раздела описывает hello различные механизмы, предлагаемые toohelp увеличение производительности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-105">hello first part of this topic describes hello different mechanisms that are offered toohelp increase performance.</span></span> <span data-ttu-id="8b0de-106">Вторая часть Hello даются рекомендации по как toouse Service Bus способом, который может предложить hello оптимальной производительности для конкретного сценария.</span><span class="sxs-lookup"><span data-stu-id="8b0de-106">hello second part provides guidance on how toouse Service Bus in a way that can offer hello best performance in a given scenario.</span></span>

<span data-ttu-id="8b0de-107">В этом разделе hello термин «клиент» означает tooany сущность, которая обращается к Service Bus.</span><span class="sxs-lookup"><span data-stu-id="8b0de-107">Throughout this topic, hello term "client" refers tooany entity that accesses Service Bus.</span></span> <span data-ttu-id="8b0de-108">Клиент может выполнять роль отправителя или получателя hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-108">A client can take hello role of a sender or a receiver.</span></span> <span data-ttu-id="8b0de-109">Hello термин «отправитель» используется для клиента очереди или раздела Service Bus, который отправляет сообщения tooa Service Bus очереди или раздела.</span><span class="sxs-lookup"><span data-stu-id="8b0de-109">hello term "sender" is used for a Service Bus queue or topic client that sends messages tooa Service Bus queue or topic.</span></span> <span data-ttu-id="8b0de-110">Hello термин «получатель» относится tooa Service Bus очереди или подписки клиента, который получает сообщения из очереди Service Bus или подписки.</span><span class="sxs-lookup"><span data-stu-id="8b0de-110">hello term "receiver" refers tooa Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="8b0de-111">В этих разделах представлены некоторые понятия, Service Bus использует toohelp повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-111">These sections introduce several concepts that Service Bus uses toohelp boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="8b0de-112">Протоколы</span><span class="sxs-lookup"><span data-stu-id="8b0de-112">Protocols</span></span>
<span data-ttu-id="8b0de-113">Service Bus позволяет клиентам toosend и получения сообщений через одну из трех протоколов:</span><span class="sxs-lookup"><span data-stu-id="8b0de-113">Service Bus enables clients toosend and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="8b0de-114">Протокол AMQP</span><span class="sxs-lookup"><span data-stu-id="8b0de-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="8b0de-115">Протокол SBMP</span><span class="sxs-lookup"><span data-stu-id="8b0de-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="8b0de-116">HTTP</span><span class="sxs-lookup"><span data-stu-id="8b0de-116">HTTP</span></span>

<span data-ttu-id="8b0de-117">AMQP и SBMP являются более эффективен, поскольку они поддерживают tooService подключения hello шины при условии, что существует фабрика сообщений hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-117">AMQP and SBMP are more efficient, because they maintain hello connection tooService Bus as long as hello messaging factory exists.</span></span> <span data-ttu-id="8b0de-118">Он также реализует функции пакетной обработки и предварительной выборки.</span><span class="sxs-lookup"><span data-stu-id="8b0de-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="8b0de-119">Если не было упомянуто явно, все содержимое этого раздела предполагается, что используется hello AMQP или SBMP.</span><span class="sxs-lookup"><span data-stu-id="8b0de-119">Unless explicitly mentioned, all content in this topic assumes hello use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="8b0de-120">Повторное использование фабрик и клиентов</span><span class="sxs-lookup"><span data-stu-id="8b0de-120">Reusing factories and clients</span></span>
<span data-ttu-id="8b0de-121">Клиентские объекты служебной шины, такие как [QueueClient][QueueClient] или [MessageSender][MessageSender], создаются с помощью объекта [MessagingFactory][MessagingFactory]. Этот объект также обеспечивает внутреннее управление подключениями.</span><span class="sxs-lookup"><span data-stu-id="8b0de-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="8b0de-122">Вам не следует закрывать фабрики обмена сообщениями или очереди, раздела и подписки клиентов после отправки сообщения, а затем создайте их повторно при отправке следующего сообщения hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send hello next message.</span></span> <span data-ttu-id="8b0de-123">Закрытие фабрики обмена сообщениями удаляет службу Service Bus toohello соединения hello и новое подключение устанавливается при повторном создании фабрики hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-123">Closing a messaging factory deletes hello connection toohello Service Bus service, and a new connection is established when recreating hello factory.</span></span> <span data-ttu-id="8b0de-124">Соединение — ресурсоемкая операция, можно избежать, повторно используя hello же фабрики и клиента для установки объектов для нескольких операций.</span><span class="sxs-lookup"><span data-stu-id="8b0de-124">Establishing a connection is an expensive operation that you can avoid by re-using hello same factory and client objects for multiple operations.</span></span> <span data-ttu-id="8b0de-125">Можно безопасно использовать hello [QueueClient] [ QueueClient] объект для отправки сообщений от параллельных асинхронных операций и нескольких потоков.</span><span class="sxs-lookup"><span data-stu-id="8b0de-125">You can safely use hello [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="8b0de-126">Параллельные операции</span><span class="sxs-lookup"><span data-stu-id="8b0de-126">Concurrent operations</span></span>
<span data-ttu-id="8b0de-127">Выполнение любой операции (отправка, получение, удаление и т. д.) занимает определенное время.</span><span class="sxs-lookup"><span data-stu-id="8b0de-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="8b0de-128">Это время включает в себя hello обработку hello операции по hello службы Service Bus задержки toohello сложения hello запроса и ответа hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-128">This time includes hello processing of hello operation by hello Service Bus service in addition toohello latency of hello request and hello reply.</span></span> <span data-ttu-id="8b0de-129">tooincrease число hello операций в единицу времени, необходимо выполнять их параллельно.</span><span class="sxs-lookup"><span data-stu-id="8b0de-129">tooincrease hello number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="8b0de-130">Это можно сделать несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="8b0de-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="8b0de-131">**Асинхронные операции**: hello клиент планирует операции, выполняя асинхронные операции.</span><span class="sxs-lookup"><span data-stu-id="8b0de-131">**Asynchronous operations**: hello client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="8b0de-132">Следующий запрос Hello запускается до завершения предыдущего запроса hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-132">hello next request is started before hello previous request is completed.</span></span> <span data-ttu-id="8b0de-133">Hello ниже приведен пример асинхронной отправки операции:</span><span class="sxs-lookup"><span data-stu-id="8b0de-133">hello following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="8b0de-134">Вот пример асинхронной операции получения:</span><span class="sxs-lookup"><span data-stu-id="8b0de-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="8b0de-135">**Несколько фабрик**: все клиенты (отправители в tooreceivers сложения), созданные hello фабрики папки один TCP-подключению.</span><span class="sxs-lookup"><span data-stu-id="8b0de-135">**Multiple factories**: all clients (senders in addition tooreceivers) that are created by hello same factory share one TCP connection.</span></span> <span data-ttu-id="8b0de-136">Hello максимальная пропускная способность сообщений ограничена hello количество операций, которые могут проходить через это TCP-соединение.</span><span class="sxs-lookup"><span data-stu-id="8b0de-136">hello maximum message throughput is limited by hello number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="8b0de-137">пропускная способность Hello, которые могут быть получены в одной фабрике, существенно зависит от времени приема-передачи TCP и размера сообщения.</span><span class="sxs-lookup"><span data-stu-id="8b0de-137">hello throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="8b0de-138">tooobtain более высокую пропускную, следует использовать несколько фабрик обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="8b0de-138">tooobtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="8b0de-139">Режим получения</span><span class="sxs-lookup"><span data-stu-id="8b0de-139">Receive mode</span></span>
<span data-ttu-id="8b0de-140">При создании клиента очереди или подписки вы можете выбрать режим получения: *блокировка для просмотра* или *получение и удаление*.</span><span class="sxs-lookup"><span data-stu-id="8b0de-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="8b0de-141">режим получения по умолчанию Hello — [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="8b0de-141">hello default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="8b0de-142">При работе в этом режиме hello клиент отправляет запрос tooreceive сообщение через служебную шину.</span><span class="sxs-lookup"><span data-stu-id="8b0de-142">When operating in this mode, hello client sends a request tooreceive a message from Service Bus.</span></span> <span data-ttu-id="8b0de-143">После получения приветственное сообщение hello клиента он отправляет сообщение hello toocomplete запроса.</span><span class="sxs-lookup"><span data-stu-id="8b0de-143">After hello client has received hello message, it sends a request toocomplete hello message.</span></span>

<span data-ttu-id="8b0de-144">Если параметр hello режим получения слишком[ReceiveAndDelete][ReceiveAndDelete], оба действия объединяются в одном запросе.</span><span class="sxs-lookup"><span data-stu-id="8b0de-144">When setting hello receive mode too[ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="8b0de-145">Это уменьшает общее количество операций hello, а также повышает hello общую пропускную способность сообщений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-145">This reduces hello overall number of operations, and can improve hello overall message throughput.</span></span> <span data-ttu-id="8b0de-146">Такое увеличение производительности вызывает риск потери сообщений hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-146">This performance gain comes at hello risk of losing messages.</span></span>

<span data-ttu-id="8b0de-147">Служебная шина не поддерживает транзакции для операций получения и удаления.</span><span class="sxs-lookup"><span data-stu-id="8b0de-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="8b0de-148">Кроме того, требуются для сценариев, в которых hello клиенту toodefer семантику блокировки для просмотра или [недоставленных](service-bus-dead-letter-queues.md) сообщение.</span><span class="sxs-lookup"><span data-stu-id="8b0de-148">In addition, peek-lock semantics are required for any scenarios in which hello client wants toodefer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="8b0de-149">Пакетная обработка на стороне клиента</span><span class="sxs-lookup"><span data-stu-id="8b0de-149">Client-side batching</span></span>
<span data-ttu-id="8b0de-150">Пакетная обработка на стороне клиента позволяет очереди или разделе клиента toodelay hello отправку сообщения для определенного периода времени.</span><span class="sxs-lookup"><span data-stu-id="8b0de-150">Client-side batching enables a queue or topic client toodelay hello sending of a message for a certain period of time.</span></span> <span data-ttu-id="8b0de-151">Если hello клиент отправляет дополнительные сообщения в этот период времени, он передает сообщения hello в одном пакете.</span><span class="sxs-lookup"><span data-stu-id="8b0de-151">If hello client sends additional messages during this time period, it transmits hello messages in a single batch.</span></span> <span data-ttu-id="8b0de-152">Пакетная обработка на стороне клиента также приводит клиента очереди или подписки toobatch несколько **завершить** запросов в один запрос.</span><span class="sxs-lookup"><span data-stu-id="8b0de-152">Client-side batching also causes a queue or subscription client toobatch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="8b0de-153">Пакетная обработка возможна только для асинхронных операций **отправки** и **завершения**.</span><span class="sxs-lookup"><span data-stu-id="8b0de-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="8b0de-154">Синхронные операции отправляются немедленно toohello службы шины обслуживания.</span><span class="sxs-lookup"><span data-stu-id="8b0de-154">Synchronous operations are immediately sent toohello Service Bus service.</span></span> <span data-ttu-id="8b0de-155">Пакетная обработка недоступна для операций просмотра или получения. Также пакетную обработку нельзя использовать для объединения операций нескольких клиентов.</span><span class="sxs-lookup"><span data-stu-id="8b0de-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="8b0de-156">По умолчанию интервал пакетной обработки в клиенте составляет 20 мс.</span><span class="sxs-lookup"><span data-stu-id="8b0de-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="8b0de-157">Можно изменить интервал пакетов hello, установка hello [BatchFlushInterval] [ BatchFlushInterval] свойство перед созданием hello фабрики обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="8b0de-157">You can change hello batch interval by setting hello [BatchFlushInterval][BatchFlushInterval] property before creating hello messaging factory.</span></span> <span data-ttu-id="8b0de-158">Этот параметр влияет на все клиенты, создаваемые этой фабрикой.</span><span class="sxs-lookup"><span data-stu-id="8b0de-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="8b0de-159">Пакетная обработка toodisable, задайте hello [BatchFlushInterval] [ BatchFlushInterval] свойство слишком**TimeSpan.Zero**.</span><span class="sxs-lookup"><span data-stu-id="8b0de-159">toodisable batching, set hello [BatchFlushInterval][BatchFlushInterval] property too**TimeSpan.Zero**.</span></span> <span data-ttu-id="8b0de-160">Например:</span><span class="sxs-lookup"><span data-stu-id="8b0de-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="8b0de-161">Пакетная обработка не влияет на количество оплачиваемых операций обмена сообщениями в hello и доступна только для hello протокола клиента Service Bus.</span><span class="sxs-lookup"><span data-stu-id="8b0de-161">Batching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="8b0de-162">Hello протокол HTTP не поддерживает пакетную обработку.</span><span class="sxs-lookup"><span data-stu-id="8b0de-162">hello HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="8b0de-163">Пакетный доступ к хранилищу</span><span class="sxs-lookup"><span data-stu-id="8b0de-163">Batching store access</span></span>
<span data-ttu-id="8b0de-164">При записи внутреннее хранилище tooits tooincrease hello пропускную способность очереди, раздела или подписки, Service Bus пакетов несколько сообщений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-164">tooincrease hello throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes tooits internal store.</span></span> <span data-ttu-id="8b0de-165">Если включена очередь или раздел, запись сообщений в хранилище hello будут объединены.</span><span class="sxs-lookup"><span data-stu-id="8b0de-165">If enabled on a queue or topic, writing messages into hello store will be batched.</span></span> <span data-ttu-id="8b0de-166">Если включена очередь или подписка, удаление сообщений из hello хранилища будут передаваться пакетами.</span><span class="sxs-lookup"><span data-stu-id="8b0de-166">If enabled on a queue or subscription, deleting messages from hello store will be batched.</span></span> <span data-ttu-id="8b0de-167">Если для сущности включен доступ к хранилищу в пакетном режиме, задержки при операции записи хранилища, относительно этой сущности путем копирования too20ms Service Bus.</span><span class="sxs-lookup"><span data-stu-id="8b0de-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up too20ms.</span></span> <span data-ttu-id="8b0de-168">Дополнительные операции с хранилищем, возникающие во время этого интервала, добавляются toohello пакета.</span><span class="sxs-lookup"><span data-stu-id="8b0de-168">Additional store operations that occur during this interval are added toohello batch.</span></span> <span data-ttu-id="8b0de-169">Пакетный доступ к хранилищу влияет только на операции **отправки** и **завершения**. Операции получения не затрагиваются.</span><span class="sxs-lookup"><span data-stu-id="8b0de-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="8b0de-170">Пакетный доступ к хранилищу является свойством сущности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="8b0de-171">Пакетная обработка применяется ко всем сущностям, для которых включен пакетный доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="8b0de-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="8b0de-172">При создании новой очереди, раздела или подписки пакетный доступ к хранилищу включен по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8b0de-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="8b0de-173">доступ к хранилищу, набор hello в пакетном режиме toodisable [EnableBatchedOperations] [ EnableBatchedOperations] свойство слишком**false** перед созданием сущности hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-173">toodisable batched store access, set hello [EnableBatchedOperations][EnableBatchedOperations] property too**false** before creating hello entity.</span></span> <span data-ttu-id="8b0de-174">Например:</span><span class="sxs-lookup"><span data-stu-id="8b0de-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="8b0de-175">Доступ к хранилищу в пакетном режиме не влияет на количество оплачиваемых операций обмена сообщениями в hello и является свойством очереди, раздела или подписки.</span><span class="sxs-lookup"><span data-stu-id="8b0de-175">Batched store access does not affect hello number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="8b0de-176">Она не зависит от hello получать режим и hello протокола, используемого между клиентом и hello службы Service Bus.</span><span class="sxs-lookup"><span data-stu-id="8b0de-176">It is independent of hello receive mode and hello protocol that is used between a client and hello Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="8b0de-177">Предварительная выборка</span><span class="sxs-lookup"><span data-stu-id="8b0de-177">Prefetching</span></span>
<span data-ttu-id="8b0de-178">Предварительная выборка позволяет hello очереди или подписки клиента tooload дополнительные сообщения от службы hello, при выполнении операции получения.</span><span class="sxs-lookup"><span data-stu-id="8b0de-178">Prefetching enables hello queue or subscription client tooload additional messages from hello service when it performs a receive operation.</span></span> <span data-ttu-id="8b0de-179">Hello клиент сохраняет эти сообщения в локальном кэше.</span><span class="sxs-lookup"><span data-stu-id="8b0de-179">hello client stores these messages in a local cache.</span></span> <span data-ttu-id="8b0de-180">размер Hello hello кэша определяется hello [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] или [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] свойства.</span><span class="sxs-lookup"><span data-stu-id="8b0de-180">hello size of hello cache is determined by hello [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="8b0de-181">В каждом клиенте с включенной предварительной выборкой создается собственный кэш.</span><span class="sxs-lookup"><span data-stu-id="8b0de-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="8b0de-182">Кэш не может использоваться одновременно несколькими клиентами.</span><span class="sxs-lookup"><span data-stu-id="8b0de-182">A cache is not shared across clients.</span></span> <span data-ttu-id="8b0de-183">Если hello клиент инициирует операцию получения и его кэш пуст, hello служба передает пакет сообщений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-183">If hello client initiates a receive operation and its cache is empty, hello service transmits a batch of messages.</span></span> <span data-ttu-id="8b0de-184">Hello размер пакета hello равен размеру hello hello кэша или 256 КБ, какое значение меньше.</span><span class="sxs-lookup"><span data-stu-id="8b0de-184">hello size of hello batch equals hello size of hello cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="8b0de-185">Если кэш hello содержит сообщение hello клиент инициирует операцию получения, приветственное сообщение берется из кэша hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-185">If hello client initiates a receive operation and hello cache contains a message, hello message is taken from hello cache.</span></span>

<span data-ttu-id="8b0de-186">Если сообщение предварительно выбрано, предварительно выбранное сообщение hello блокировки hello службы.</span><span class="sxs-lookup"><span data-stu-id="8b0de-186">When a message is prefetched, hello service locks hello prefetched message.</span></span> <span data-ttu-id="8b0de-187">Благодаря этому предварительно выбранное сообщение hello не может получить другой получатель.</span><span class="sxs-lookup"><span data-stu-id="8b0de-187">By doing this, hello prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="8b0de-188">Если получатель hello не может завершить приветственное сообщение, до истечения срока действия блокировки Здравствуй, приветственное сообщение становится доступных tooother приемников.</span><span class="sxs-lookup"><span data-stu-id="8b0de-188">If hello receiver cannot complete hello message before hello lock expires, hello message becomes available tooother receivers.</span></span> <span data-ttu-id="8b0de-189">упреждающая выборка Hello копию сообщения hello остается в кэше hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-189">hello prefetched copy of hello message remains in hello cache.</span></span> <span data-ttu-id="8b0de-190">Hello получатель, который использует hello истек срок действия кэшированных копии получит сообщение об ошибке, когда он пытается toocomplete этого сообщения.</span><span class="sxs-lookup"><span data-stu-id="8b0de-190">hello receiver that consumes hello expired cached copy will receive an exception when it tries toocomplete that message.</span></span> <span data-ttu-id="8b0de-191">По умолчанию блокировка сообщения hello истекает через 60 секунд.</span><span class="sxs-lookup"><span data-stu-id="8b0de-191">By default, hello message lock expires after 60 seconds.</span></span> <span data-ttu-id="8b0de-192">Это значение может быть расширенные too5 минут.</span><span class="sxs-lookup"><span data-stu-id="8b0de-192">This value can be extended too5 minutes.</span></span> <span data-ttu-id="8b0de-193">Использование hello tooprevent сообщений с истекшим сроком, размер кэша hello всегда должно быть меньше hello количество сообщений, которые могут быть использованы клиентом в течение времени ожидания блокировки hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-193">tooprevent hello consumption of expired messages, hello cache size should always be smaller than hello number of messages that can be consumed by a client within hello lock time-out interval.</span></span>

<span data-ttu-id="8b0de-194">При использовании срока блокировки по умолчанию hello 60 секунд, хорошо подходит значение для [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] 20 раз hello максимальное скорость обработки для всех получателей фабрики hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-194">When using hello default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times hello maximum processing rates of all receivers of hello factory.</span></span> <span data-ttu-id="8b0de-195">Например фабрика создает 3 получателей, и каждый получатель может обработать too10 сообщений в секунду.</span><span class="sxs-lookup"><span data-stu-id="8b0de-195">For example, a factory creates 3 receivers, and each receiver can process up too10 messages per second.</span></span> <span data-ttu-id="8b0de-196">Счетчик предварительной выборки Hello не должна превышать 20 X 3 X 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="8b0de-196">hello prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="8b0de-197">По умолчанию [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] — набор too0, это означает, что никаких дополнительных сообщений не будут выбраны из службы hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set too0, which means that no additional messages are fetched from hello service.</span></span>

<span data-ttu-id="8b0de-198">Предварительная выборка сообщений, что повышает общую пропускную способность очереди или подписки hello, так как это снижает hello общее количество операций с сообщениями или циклов приема-передачи.</span><span class="sxs-lookup"><span data-stu-id="8b0de-198">Prefetching messages increases hello overall throughput for a queue or subscription because it reduces hello overall number of message operations, or round trips.</span></span> <span data-ttu-id="8b0de-199">Получение первого сообщения hello, однако займет больше времени (из-за toohello увеличить размер сообщения).</span><span class="sxs-lookup"><span data-stu-id="8b0de-199">Fetching hello first message, however, will take longer (due toohello increased message size).</span></span> <span data-ttu-id="8b0de-200">Получение предварительно выбранных сообщений будет выполняться быстрее, поскольку эти сообщения уже были загружены клиентом hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-200">Receiving prefetched messages will be faster because these messages have already been downloaded by hello client.</span></span>

<span data-ttu-id="8b0de-201">срок жизни (TTL) свойство Hello сообщения проверяется сервером hello hello момент hello сервер отправляет клиенту toohello сообщение hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-201">hello time-to-live (TTL) property of a message is checked by hello server at hello time hello server sends hello message toohello client.</span></span> <span data-ttu-id="8b0de-202">При получении сообщения hello Hello клиент не проверяет свойство TTL сообщения hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-202">hello client does not check hello message’s TTL property when hello message is received.</span></span> <span data-ttu-id="8b0de-203">Вместо этого может быть получено сообщение hello, даже если срок ЖИЗНИ сообщения hello истек во время кэширования клиентом hello приветственное сообщение.</span><span class="sxs-lookup"><span data-stu-id="8b0de-203">Instead, hello message can be received even if hello message’s TTL has passed while hello message was cached by hello client.</span></span>

<span data-ttu-id="8b0de-204">Предварительная выборка не влияет на количество оплачиваемых операций обмена сообщениями в hello и доступна только для hello протокола клиента Service Bus.</span><span class="sxs-lookup"><span data-stu-id="8b0de-204">Prefetching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="8b0de-205">Hello протокол HTTP не поддерживает предварительную выборку.</span><span class="sxs-lookup"><span data-stu-id="8b0de-205">hello HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="8b0de-206">Предварительная выборка доступна как для синхронных, так и для асинхронных операций получения.</span><span class="sxs-lookup"><span data-stu-id="8b0de-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="8b0de-207">Экспресс-очереди и экспресс-разделы</span><span class="sxs-lookup"><span data-stu-id="8b0de-207">Express queues and topics</span></span>

<span data-ttu-id="8b0de-208">Экспресс-сущностей включите высокой пропускной способности и сценариях сокращенной задержки и поддерживаются только стандартный уровень обмена сообщениями hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in hello Standard messaging tier.</span></span> <span data-ttu-id="8b0de-209">Сущности, созданные в [пространства имен Premium](service-bus-premium-messaging.md) не поддерживают параметр express hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support hello express option.</span></span> <span data-ttu-id="8b0de-210">С экспресс-сущностей Если сообщение отправляется tooa очередь или раздел, приветственное сообщение не хранятся непосредственно в хранилище сообщений hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-210">With express entities, if a message is sent tooa queue or topic, hello message is not immediately stored in hello messaging store.</span></span> <span data-ttu-id="8b0de-211">Вместо этого оно сохраняется в кэше, расположенном в памяти.</span><span class="sxs-lookup"><span data-stu-id="8b0de-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="8b0de-212">Если сообщение остается в очереди hello на несколько секунд, оно автоматически записывается toostable хранилище, таким образом защищая его от потери из-за сбоя tooan.</span><span class="sxs-lookup"><span data-stu-id="8b0de-212">If a message remains in hello queue for more than a few seconds, it is automatically written toostable storage, thus protecting it against loss due tooan outage.</span></span> <span data-ttu-id="8b0de-213">Написание приветственное сообщение в кэш памяти повышает пропускную способность и сокращает задержки, так как нет доступа к toostable отправляется хранилище на приветственное сообщение hello времени.</span><span class="sxs-lookup"><span data-stu-id="8b0de-213">Writing hello message into a memory cache increases throughput and reduces latency because there is no access toostable storage at hello time hello message is sent.</span></span> <span data-ttu-id="8b0de-214">Сообщения, используемые в течение нескольких секунд не записываются toohello хранилище обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="8b0de-214">Messages that are consumed within a few seconds are not written toohello messaging store.</span></span> <span data-ttu-id="8b0de-215">Следующий пример Hello создается экспресс-раздел.</span><span class="sxs-lookup"><span data-stu-id="8b0de-215">hello following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="8b0de-216">При отправке сообщения, содержащего критически важной информации, которая не может быть потеряна tooan экспресс-сущность hello отправитель может потребовать Service Bus tooimmediately сохранения хранилища toostable сообщений hello, установка hello [ForcePersistence] [ ForcePersistence] свойство слишком**true**.</span><span class="sxs-lookup"><span data-stu-id="8b0de-216">If a message containing critical information that must not be lost is sent tooan express entity, hello sender can force Service Bus tooimmediately persist hello message toostable storage by setting hello [ForcePersistence][ForcePersistence] property too**true**.</span></span>

> [!NOTE]
> <span data-ttu-id="8b0de-217">Транзакции не поддерживаются экспресс-сущностями.</span><span class="sxs-lookup"><span data-stu-id="8b0de-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="8b0de-218">Использование секционированных очередей или разделов</span><span class="sxs-lookup"><span data-stu-id="8b0de-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="8b0de-219">На внутреннем уровне использует Service Bus hello того же узла и обмена сообщениями tooprocess хранилища и хранить все сообщения для сущности обмена сообщениями (очереди или раздела).</span><span class="sxs-lookup"><span data-stu-id="8b0de-219">Internally, Service Bus uses hello same node and messaging store tooprocess and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="8b0de-220">Секционированная очередь или раздел, на hello другой стороны, распределяется по нескольким узлам и хранилищам сообщений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-220">A partitioned queue or topic, on hello other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="8b0de-221">Секционированные очереди и разделы не только повышают пропускную способность в сравнении с обычными очередями и разделами, но также обеспечивают высочайший уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="8b0de-222">toocreate секционированную сущность hello набор [параметр EnablePartitioning] [ EnablePartitioning] свойство слишком**true**, как показано в следующий пример hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-222">toocreate a partitioned entity, set hello [EnablePartitioning][EnablePartitioning] property too**true**, as shown in hello following example.</span></span> <span data-ttu-id="8b0de-223">Дополнительные сведения о секционированных сущностях см. в статье [Секционированные сущности обмена сообщениями][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="8b0de-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="8b0de-224">Использование нескольких очередей</span><span class="sxs-lookup"><span data-stu-id="8b0de-224">Use of multiple queues</span></span>

<span data-ttu-id="8b0de-225">Если нет возможности toouse, секционированная очередь или раздел или hello ожидаемого нагрузки не может быть обработана одной секционированной очереди или раздела, необходимо использовать несколько сущностей обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="8b0de-225">If it is not possible toouse a partitioned queue or topic, or hello expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="8b0de-226">При использовании нескольких сущностей создайте выделенный клиент для каждой сущности, вместо использования hello же клиента для всех сущностей.</span><span class="sxs-lookup"><span data-stu-id="8b0de-226">When using multiple entities, create a dedicated client for each entity, instead of using hello same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="8b0de-227">Возможности для разработки и тестирования</span><span class="sxs-lookup"><span data-stu-id="8b0de-227">Development and testing features</span></span>

<span data-ttu-id="8b0de-228">В служебной шине доступна одна функция, используемая специально для разработки, которую **никогда не следует использовать в рабочих конфигурациях**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="8b0de-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="8b0de-229">Когда toohello разделе добавляются новые правила или фильтры, можно использовать [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify, hello нового критерия фильтра работает надлежащим образом.</span><span class="sxs-lookup"><span data-stu-id="8b0de-229">When new rules or filters are added toohello topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify that hello new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="8b0de-230">Сценарии</span><span class="sxs-lookup"><span data-stu-id="8b0de-230">Scenarios</span></span>
<span data-ttu-id="8b0de-231">Hello следующих разделах описаны распространенные сценарии обмена сообщениями и указаны параметры hello предпочитаемый Service Bus.</span><span class="sxs-lookup"><span data-stu-id="8b0de-231">hello following sections describe typical messaging scenarios and outline hello preferred Service Bus settings.</span></span> <span data-ttu-id="8b0de-232">Пропускная способность бывает небольшой (менее 1 сообщения в секунду), средней (1 сообщение в секунду или больше, но не более 100 сообщений в секунду) и высокой (100 сообщений в секунду или больше).</span><span class="sxs-lookup"><span data-stu-id="8b0de-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="8b0de-233">Hello число клиентов классифицируется как малое Средний (5 или меньше) (более 5 но меньше или равно too20) и большой (более 20).</span><span class="sxs-lookup"><span data-stu-id="8b0de-233">hello number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal too20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="8b0de-234">Очередь с высокой пропускной способностью</span><span class="sxs-lookup"><span data-stu-id="8b0de-234">High-throughput queue</span></span>
<span data-ttu-id="8b0de-235">Цель: Максимально увеличить пропускную способность hello одной очереди.</span><span class="sxs-lookup"><span data-stu-id="8b0de-235">Goal: Maximize hello throughput of a single queue.</span></span> <span data-ttu-id="8b0de-236">Hello количество отправителей и получателей невелико.</span><span class="sxs-lookup"><span data-stu-id="8b0de-236">hello number of senders and receivers is small.</span></span>

* <span data-ttu-id="8b0de-237">Используйте секционированную очередь для повышения производительности и доступности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="8b0de-238">tooincrease hello общую скорость отправки в очередь hello, используйте несколько фабрик toocreate отправителей.</span><span class="sxs-lookup"><span data-stu-id="8b0de-238">tooincrease hello overall send rate into hello queue, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="8b0de-239">Для каждого отправителя используйте асинхронные операции или разделение на потоки.</span><span class="sxs-lookup"><span data-stu-id="8b0de-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="8b0de-240">tooincrease hello общую скорость приема из очереди hello, используйте несколько получателей toocreate фабрики сообщений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-240">tooincrease hello overall receive rate from hello queue, use multiple message factories toocreate receivers.</span></span>
* <span data-ttu-id="8b0de-241">Используйте асинхронные операции tootake преимуществами пакетной обработки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="8b0de-241">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="8b0de-242">Задать hello пакетной обработки интервалов too50ms tooreduce hello число передач клиентского протокола Service Bus.</span><span class="sxs-lookup"><span data-stu-id="8b0de-242">Set hello batching interval too50ms tooreduce hello number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="8b0de-243">Если используется несколько отправителей, увеличьте hello пакетной обработки too100ms интервал.</span><span class="sxs-lookup"><span data-stu-id="8b0de-243">If multiple senders are used, increase hello batching interval too100ms.</span></span>
* <span data-ttu-id="8b0de-244">Не отключайте пакетный доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="8b0de-244">Leave batched store access enabled.</span></span> <span data-ttu-id="8b0de-245">Это увеличивает hello общую скорость, с которой сообщения могут записываться в очередь hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-245">This increases hello overall rate at which messages can be written into hello queue.</span></span>
* <span data-ttu-id="8b0de-246">Время too20 счетчик упреждающей выборки hello задайте hello максимальную скорость обработки всех получателей фабрики.</span><span class="sxs-lookup"><span data-stu-id="8b0de-246">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="8b0de-247">Это уменьшает количество передач клиентского протокола Service Bus в hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-247">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="8b0de-248">Несколько очередей с высокой пропускной способностью</span><span class="sxs-lookup"><span data-stu-id="8b0de-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="8b0de-249">Цель: максимально повысить общую пропускную способность нескольких очередей.</span><span class="sxs-lookup"><span data-stu-id="8b0de-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="8b0de-250">Hello пропускная способность отдельной очереди средняя или высокая.</span><span class="sxs-lookup"><span data-stu-id="8b0de-250">hello throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="8b0de-251">tooobtain максимальную пропускную способность нескольких очередей, используйте параметры hello контура toomaximize hello пропускной способности одной очереди.</span><span class="sxs-lookup"><span data-stu-id="8b0de-251">tooobtain maximum throughput across multiple queues, use hello settings outlined toomaximize hello throughput of a single queue.</span></span> <span data-ttu-id="8b0de-252">Кроме того можно используйте различные фабрики toocreate клиенты, отправляющие или получающие в разных очередях.</span><span class="sxs-lookup"><span data-stu-id="8b0de-252">In addition, use different factories toocreate clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="8b0de-253">Очередь с небольшой задержкой</span><span class="sxs-lookup"><span data-stu-id="8b0de-253">Low latency queue</span></span>
<span data-ttu-id="8b0de-254">Цель: минимизировать совокупное время задержки в очереди или разделе.</span><span class="sxs-lookup"><span data-stu-id="8b0de-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="8b0de-255">Hello количество отправителей и получателей невелико.</span><span class="sxs-lookup"><span data-stu-id="8b0de-255">hello number of senders and receivers is small.</span></span> <span data-ttu-id="8b0de-256">пропускная способность Hello hello очереди низкая или средняя.</span><span class="sxs-lookup"><span data-stu-id="8b0de-256">hello throughput of hello queue is small or moderate.</span></span>

* <span data-ttu-id="8b0de-257">Используйте секционированную очередь для повышения доступности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="8b0de-258">Отключите пакетную обработку на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="8b0de-258">Disable client-side batching.</span></span> <span data-ttu-id="8b0de-259">Hello клиент немедленно отправляет сообщение.</span><span class="sxs-lookup"><span data-stu-id="8b0de-259">hello client immediately sends a message.</span></span>
* <span data-ttu-id="8b0de-260">Отключите пакетный доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="8b0de-260">Disable batched store access.</span></span> <span data-ttu-id="8b0de-261">Hello служба немедленно записывает хранилища toohello сообщений hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-261">hello service immediately writes hello message toohello store.</span></span>
* <span data-ttu-id="8b0de-262">При использовании одного клиента, задайте hello упреждающей выборки счетчика too20 раз hello скорость обработки hello приемника.</span><span class="sxs-lookup"><span data-stu-id="8b0de-262">If using a single client, set hello prefetch count too20 times hello processing rate of hello receiver.</span></span> <span data-ttu-id="8b0de-263">Если несколько сообщений поступают в очередь hello по hello же времени, hello протокола клиента Service Bus передает их все на hello то же время.</span><span class="sxs-lookup"><span data-stu-id="8b0de-263">If multiple messages arrive at hello queue at hello same time, hello Service Bus client protocol transmits them all at hello same time.</span></span> <span data-ttu-id="8b0de-264">Когда клиент hello получает следующее сообщение hello, данное сообщение уже находится в локальном кэше hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-264">When hello client receives hello next message, that message is already in hello local cache.</span></span> <span data-ttu-id="8b0de-265">кэш Hello должен быть небольшим.</span><span class="sxs-lookup"><span data-stu-id="8b0de-265">hello cache should be small.</span></span>
* <span data-ttu-id="8b0de-266">При использовании нескольких клиентов, задайте число too0 hello упреждающей выборки.</span><span class="sxs-lookup"><span data-stu-id="8b0de-266">If using multiple clients, set hello prefetch count too0.</span></span> <span data-ttu-id="8b0de-267">Таким образом, hello второй клиент может получить второе сообщение hello, пока первый клиент hello по-прежнему обрабатывается первое сообщение hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-267">By doing this, hello second client can receive hello second message while hello first client is still processing hello first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="8b0de-268">Очередь с большим числом отправителей</span><span class="sxs-lookup"><span data-stu-id="8b0de-268">Queue with a large number of senders</span></span>
<span data-ttu-id="8b0de-269">Цель: максимально повысить пропускную способность очереди или раздела с большим количеством отправителей.</span><span class="sxs-lookup"><span data-stu-id="8b0de-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="8b0de-270">Каждый отправитель отправляет сообщения со средней скоростью.</span><span class="sxs-lookup"><span data-stu-id="8b0de-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="8b0de-271">Hello количества получателей мал.</span><span class="sxs-lookup"><span data-stu-id="8b0de-271">hello number of receivers is small.</span></span>

<span data-ttu-id="8b0de-272">Service Bus обеспечивает копирование tooa одновременных подключений too1000 сущности обмена сообщениями (или 5000 использовании AMQP).</span><span class="sxs-lookup"><span data-stu-id="8b0de-272">Service Bus enables up too1000 concurrent connections tooa messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="8b0de-273">Это ограничение действует на уровне пространства имен hello и очередей, разделов и подписок устанавливается ограничение hello количество параллельных соединений для каждого пространства имен.</span><span class="sxs-lookup"><span data-stu-id="8b0de-273">This limit is enforced at hello namespace level, and queues/topics/subscriptions are capped by hello limit of concurrent connections per namespace.</span></span> <span data-ttu-id="8b0de-274">В случае очередей это значение распределяется между отправителями и получателями.</span><span class="sxs-lookup"><span data-stu-id="8b0de-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="8b0de-275">Если отправителям требуются все 1000 подключений, следует заменить очередь hello разделом и одной подписке.</span><span class="sxs-lookup"><span data-stu-id="8b0de-275">If all 1000 connections are required for senders, you should replace hello queue with a topic and a single subscription.</span></span> <span data-ttu-id="8b0de-276">Раздел принимает вверх too1000 параллельных подключений от отправителей, а hello подписка принимает Дополнительно 1000 параллельных подключений от получателей.</span><span class="sxs-lookup"><span data-stu-id="8b0de-276">A topic accepts up too1000 concurrent connections from senders, whereas hello subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="8b0de-277">Если требуется более 1000 параллельных отправителей, hello отправители должны отправлять сообщения toohello протокол Service Bus с помощью HTTP.</span><span class="sxs-lookup"><span data-stu-id="8b0de-277">If more than 1000 concurrent senders are required, hello senders should send messages toohello Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="8b0de-278">toomaximize пропускной способности, hello следующие:</span><span class="sxs-lookup"><span data-stu-id="8b0de-278">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="8b0de-279">Используйте секционированную очередь для повышения производительности и доступности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="8b0de-280">Если каждый отправитель размещается в отдельном процессе, используйте одну фабрику для этого процесса.</span><span class="sxs-lookup"><span data-stu-id="8b0de-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="8b0de-281">Используйте асинхронные операции tootake преимуществами пакетной обработки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="8b0de-281">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="8b0de-282">Используйте пакетную обработку 20 мс tooreduce hello количество передач клиентского протокола Service Bus интервала по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-282">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="8b0de-283">Не отключайте пакетный доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="8b0de-283">Leave batched store access enabled.</span></span> <span data-ttu-id="8b0de-284">Это увеличивает hello общую скорость, с которой сообщения могут записываться в очередь hello или раздел.</span><span class="sxs-lookup"><span data-stu-id="8b0de-284">This increases hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="8b0de-285">Время too20 счетчик упреждающей выборки hello задайте hello максимальную скорость обработки всех получателей фабрики.</span><span class="sxs-lookup"><span data-stu-id="8b0de-285">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="8b0de-286">Это уменьшает количество передач клиентского протокола Service Bus в hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-286">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="8b0de-287">Очередь с большим числом получателей</span><span class="sxs-lookup"><span data-stu-id="8b0de-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="8b0de-288">Цель: Максимизировать hello скорость очереди или подписки с большим числом получателей приема.</span><span class="sxs-lookup"><span data-stu-id="8b0de-288">Goal: Maximize hello receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="8b0de-289">Каждый получатель получает сообщения со средней скоростью.</span><span class="sxs-lookup"><span data-stu-id="8b0de-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="8b0de-290">Hello число отправителей невелико.</span><span class="sxs-lookup"><span data-stu-id="8b0de-290">hello number of senders is small.</span></span>

<span data-ttu-id="8b0de-291">Service Bus обеспечивает копирование сущности tooan too1000 одновременных подключений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-291">Service Bus enables up too1000 concurrent connections tooan entity.</span></span> <span data-ttu-id="8b0de-292">Если очереди требуется более 1000 получателей, следует заменить очередь hello разделом и несколькими подписками.</span><span class="sxs-lookup"><span data-stu-id="8b0de-292">If a queue requires more than 1000 receivers, you should replace hello queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="8b0de-293">Каждая подписка может поддерживать too1000 параллельных соединений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-293">Each subscription can support up too1000 concurrent connections.</span></span> <span data-ttu-id="8b0de-294">Кроме того получатели могут обращаться к очереди hello посредством hello протокол HTTP.</span><span class="sxs-lookup"><span data-stu-id="8b0de-294">Alternatively, receivers can access hello queue via hello HTTP protocol.</span></span>

<span data-ttu-id="8b0de-295">toomaximize пропускной способности, hello следующие:</span><span class="sxs-lookup"><span data-stu-id="8b0de-295">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="8b0de-296">Используйте секционированную очередь для повышения производительности и доступности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="8b0de-297">Если каждый получатель размещается в отдельном процессе, используйте одну фабрику для этого процесса.</span><span class="sxs-lookup"><span data-stu-id="8b0de-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="8b0de-298">Получатели могут использовать синхронные и асинхронные операции.</span><span class="sxs-lookup"><span data-stu-id="8b0de-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="8b0de-299">Данный средний hello СК отдельного получателя, пакетная обработка на стороне клиента запроса на завершение не влияет на пропускную способность получателя.</span><span class="sxs-lookup"><span data-stu-id="8b0de-299">Given hello moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="8b0de-300">Не отключайте пакетный доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="8b0de-300">Leave batched store access enabled.</span></span> <span data-ttu-id="8b0de-301">Это уменьшает hello общей нагрузки hello сущности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-301">This reduces hello overall load of hello entity.</span></span> <span data-ttu-id="8b0de-302">Это также уменьшает hello общую скорость, с которой сообщения могут записываться в очередь hello или раздел.</span><span class="sxs-lookup"><span data-stu-id="8b0de-302">It also reduces hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="8b0de-303">Набор hello упреждающей выборки определяет tooa небольшое значение (например, PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="8b0de-303">Set hello prefetch count tooa small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="8b0de-304">Это позволит избежать ситуации, когда одни получатели простаивают, а другие получают множество кэшированных сообщений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="8b0de-305">Раздел с небольшим количеством подписок</span><span class="sxs-lookup"><span data-stu-id="8b0de-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="8b0de-306">Цель: Максимально увеличить пропускную способность раздела с небольшим числом подписок hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-306">Goal: Maximize hello throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="8b0de-307">Сообщение получается большим числом подписок, означающее hello вместе получать скорость по всем подпискам больше, чем скорость отправки hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-307">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is larger than hello send rate.</span></span> <span data-ttu-id="8b0de-308">Hello число отправителей невелико.</span><span class="sxs-lookup"><span data-stu-id="8b0de-308">hello number of senders is small.</span></span> <span data-ttu-id="8b0de-309">Hello число получателей в каждой подписке невелико.</span><span class="sxs-lookup"><span data-stu-id="8b0de-309">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="8b0de-310">toomaximize пропускной способности, hello следующие:</span><span class="sxs-lookup"><span data-stu-id="8b0de-310">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="8b0de-311">Используйте секционированный раздел для повышения уровня доступности и производительности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="8b0de-312">tooincrease hello общую скорость отправки в раздел hello, используйте несколько фабрик toocreate отправителей.</span><span class="sxs-lookup"><span data-stu-id="8b0de-312">tooincrease hello overall send rate into hello topic, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="8b0de-313">Для каждого отправителя используйте асинхронные операции или разделение на потоки.</span><span class="sxs-lookup"><span data-stu-id="8b0de-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="8b0de-314">tooincrease hello общую скорость приема из подписки, используйте несколько получателей toocreate фабрики сообщений.</span><span class="sxs-lookup"><span data-stu-id="8b0de-314">tooincrease hello overall receive rate from a subscription, use multiple message factories toocreate receivers.</span></span> <span data-ttu-id="8b0de-315">Для каждого получателя используйте асинхронные операции или разделение на потоки.</span><span class="sxs-lookup"><span data-stu-id="8b0de-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="8b0de-316">Используйте асинхронные операции tootake преимуществами пакетной обработки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="8b0de-316">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="8b0de-317">Используйте пакетную обработку 20 мс tooreduce hello количество передач клиентского протокола Service Bus интервала по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-317">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="8b0de-318">Не отключайте пакетный доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="8b0de-318">Leave batched store access enabled.</span></span> <span data-ttu-id="8b0de-319">Это увеличивает hello общую скорость, с которой сообщения могут записываться в разделе hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-319">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="8b0de-320">Время too20 счетчик упреждающей выборки hello задайте hello максимальную скорость обработки всех получателей фабрики.</span><span class="sxs-lookup"><span data-stu-id="8b0de-320">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="8b0de-321">Это уменьшает количество передач клиентского протокола Service Bus в hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-321">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="8b0de-322">Раздел с большим количеством подписок</span><span class="sxs-lookup"><span data-stu-id="8b0de-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="8b0de-323">Цель: Максимально увеличить пропускную способность раздела с большим числом подписок hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-323">Goal: Maximize hello throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="8b0de-324">Сообщение получается большим числом подписок, означающее hello вместе получать скорость по всем подпискам гораздо больше, чем скорость отправки hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-324">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is much larger than hello send rate.</span></span> <span data-ttu-id="8b0de-325">Hello число отправителей невелико.</span><span class="sxs-lookup"><span data-stu-id="8b0de-325">hello number of senders is small.</span></span> <span data-ttu-id="8b0de-326">Hello число получателей в каждой подписке невелико.</span><span class="sxs-lookup"><span data-stu-id="8b0de-326">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="8b0de-327">Разделы с большим числом подписок обычно предоставляют низкую общую пропускную способность, если все сообщения, перенаправленные tooall подписки.</span><span class="sxs-lookup"><span data-stu-id="8b0de-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed tooall subscriptions.</span></span> <span data-ttu-id="8b0de-328">Это вызвано hello тем, что каждое сообщение получается несколько раз, и все сообщения, которые содержатся в разделах и все его подписки хранятся в hello же хранения.</span><span class="sxs-lookup"><span data-stu-id="8b0de-328">This is caused by hello fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in hello same store.</span></span> <span data-ttu-id="8b0de-329">Предполагается небольшого числа hello отправителей и получателей в каждой подписке.</span><span class="sxs-lookup"><span data-stu-id="8b0de-329">It is assumed that hello number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="8b0de-330">Служебная шина поддерживает копирование too2 000 подписок для каждого раздела.</span><span class="sxs-lookup"><span data-stu-id="8b0de-330">Service Bus supports up too2,000 subscriptions per topic.</span></span>

<span data-ttu-id="8b0de-331">toomaximize пропускной способности, hello следующие:</span><span class="sxs-lookup"><span data-stu-id="8b0de-331">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="8b0de-332">Используйте секционированный раздел для повышения уровня доступности и производительности.</span><span class="sxs-lookup"><span data-stu-id="8b0de-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="8b0de-333">Используйте асинхронные операции tootake преимуществами пакетной обработки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="8b0de-333">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="8b0de-334">Используйте пакетную обработку 20 мс tooreduce hello количество передач клиентского протокола Service Bus интервала по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-334">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="8b0de-335">Не отключайте пакетный доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="8b0de-335">Leave batched store access enabled.</span></span> <span data-ttu-id="8b0de-336">Это увеличивает hello общую скорость, с которой сообщения могут записываться в разделе hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-336">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="8b0de-337">Задайте hello предварительную загрузку count too20 раз hello требуется получать частота в секундах.</span><span class="sxs-lookup"><span data-stu-id="8b0de-337">Set hello prefetch count too20 times hello expected receive rate in seconds.</span></span> <span data-ttu-id="8b0de-338">Это уменьшает количество передач клиентского протокола Service Bus в hello.</span><span class="sxs-lookup"><span data-stu-id="8b0de-338">This reduces hello number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8b0de-339">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="8b0de-339">Next steps</span></span>
<span data-ttu-id="8b0de-340">toolearn более об оптимизации производительности служебной шины. в разделе [секционированные сущности обмена сообщениями][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="8b0de-340">toolearn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing
