---
title: "Создание секционированных очередей и разделов служебной шины Azure | Документация Майкрософт"
description: "В этой статье описывается, как секционировать очереди и разделы служебной шины с помощью нескольких брокеров сообщений."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: a0c7d5a2-4876-42cb-8344-a1fc988746e7
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/07/2017
ms.author: sethm;hillaryc
ms.openlocfilehash: 5a4e69ea7e13cb017f8fb432c524c6a8ce9228a8
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="partitioned-queues-and-topics"></a><span data-ttu-id="e7abe-103">Секционированные очереди и разделы</span><span class="sxs-lookup"><span data-stu-id="e7abe-103">Partitioned queues and topics</span></span>
<span data-ttu-id="e7abe-104">Служебная шина Azure использует несколько посредников сообщений для обработки сообщений и несколько хранилищ сообщений для их хранения.</span><span class="sxs-lookup"><span data-stu-id="e7abe-104">Azure Service Bus employs multiple message brokers to process messages and multiple messaging stores to store messages.</span></span> <span data-ttu-id="e7abe-105">Обычная очередь или раздел обрабатываются одним брокером сообщений и сохраняются в одном хранилище сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-105">A conventional queue or topic is handled by a single message broker and stored in one messaging store.</span></span> <span data-ttu-id="e7abe-106">*Секции* служебной шины позволяют секционировать очереди, разделы или *сущности обмена сообщениями* между несколькими брокерами сообщений и хранилищами сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-106">Service Bus *partitions* enable queues and topics, or *messaging entities*, to be partitioned across multiple message brokers and messaging stores.</span></span> <span data-ttu-id="e7abe-107">Это означает, что общая пропускная способность секционированной сущности больше не ограничивается производительностью одного брокера сообщений или хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-107">This means that the overall throughput of a partitioned entity is no longer limited by the performance of a single message broker or messaging store.</span></span> <span data-ttu-id="e7abe-108">Кроме того, при возникновении временного сбоя хранилища сообщений секционированная очередь или раздел останутся доступными.</span><span class="sxs-lookup"><span data-stu-id="e7abe-108">In addition, a temporary outage of a messaging store does not render a partitioned queue or topic unavailable.</span></span> <span data-ttu-id="e7abe-109">Секционированные очереди и разделы могут предоставлять все расширенные функции служебной шины, в том числе поддержку транзакций и сеансов.</span><span class="sxs-lookup"><span data-stu-id="e7abe-109">Partitioned queues and topics can contain all advanced Service Bus features, such as support for transactions and sessions.</span></span>

<span data-ttu-id="e7abe-110">Дополнительные сведения о внутренних компонентах служебной шины см. в статье [Архитектура служебной шины][Service Bus architecture].</span><span class="sxs-lookup"><span data-stu-id="e7abe-110">For information about Service Bus internals, see the [Service Bus architecture][Service Bus architecture] article.</span></span>

<span data-ttu-id="e7abe-111">Секционирование включается по умолчанию при создании сущности во всех очередях и разделах на уровне обмена сообщениями "Стандартный" и "Премиум".</span><span class="sxs-lookup"><span data-stu-id="e7abe-111">Partitioning is enabled by default at entity creation on all queues and topics in both Standard and Premium messaging.</span></span> <span data-ttu-id="e7abe-112">Сущности уровня обмена сообщениями "Стандартный"можно создать без секционирования, но очереди и разделы в пространстве имен уровня "Премиум" всегда секционируются. Этот параметр невозможно отключить.</span><span class="sxs-lookup"><span data-stu-id="e7abe-112">You can create Standard messaging tier entities without partitioning, but queues and topics in a Premium namespace are always partitioned; this option cannot be disabled.</span></span> 

<span data-ttu-id="e7abe-113">Параметр секционирования в имеющейся очереди или разделе на уровне "Стандартный" или "Премиум" изменить невозможно. Его можно задать только при создании сущности.</span><span class="sxs-lookup"><span data-stu-id="e7abe-113">It is not possible to change the partitioning option on an existing queue or topic in either Standard or Premium tiers, you can only set the option when you create the entity.</span></span>

## <a name="how-it-works"></a><span data-ttu-id="e7abe-114">Принцип работы</span><span class="sxs-lookup"><span data-stu-id="e7abe-114">How it works</span></span>

<span data-ttu-id="e7abe-115">Каждая секционированная очередь или раздел состоит из нескольких фрагментов.</span><span class="sxs-lookup"><span data-stu-id="e7abe-115">Each partitioned queue or topic consists of multiple fragments.</span></span> <span data-ttu-id="e7abe-116">Фрагменты хранятся в разных хранилищах сообщений и обрабатываются разными посредниками сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-116">Each fragment is stored in a different messaging store and handled by a different message broker.</span></span> <span data-ttu-id="e7abe-117">При отправке сообщения в секционированную очередь или раздел служебная шина назначает сообщение в один из фрагментов.</span><span class="sxs-lookup"><span data-stu-id="e7abe-117">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span></span> <span data-ttu-id="e7abe-118">Выбор фрагмента осуществляется произвольно или по ключу секции, который может указать отправитель.</span><span class="sxs-lookup"><span data-stu-id="e7abe-118">The selection is done randomly by Service Bus or by using a partition key that the sender can specify.</span></span>

<span data-ttu-id="e7abe-119">Если клиент хочет получить сообщение из секционированной очереди или подписки секционированного раздела, служебная шина запрашивает все фрагменты сообщений и возвращает получателю первое сообщение, полученное из любого хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-119">When a client wants to receive a message from a partitioned queue, or from a subscription to a partitioned topic, Service Bus queries all fragments for messages, then returns the first message that is obtained from any of the messaging stores to the receiver.</span></span> <span data-ttu-id="e7abe-120">Служебная шина кэширует другие сообщения и возвращает их при получении дополнительных запросов.</span><span class="sxs-lookup"><span data-stu-id="e7abe-120">Service Bus caches the other messages and returns them when it receives additional receive requests.</span></span> <span data-ttu-id="e7abe-121">Клиент ничего не знает о секционировании, для него поведение секционированных очередей или разделов (например, чтение, завершение, откладывание, недоставление или предварительная выборка) аналогично поведению обычной сущности.</span><span class="sxs-lookup"><span data-stu-id="e7abe-121">A receiving client is not aware of the partitioning; the client-facing behavior of a partitioned queue or topic (for example, read, complete, defer, deadletter, prefetching) is identical to the behavior of a regular entity.</span></span>

<span data-ttu-id="e7abe-122">При отправке или получении сообщения из секционированной очереди или раздела не возникает никаких дополнительных затрат.</span><span class="sxs-lookup"><span data-stu-id="e7abe-122">There is no additional cost when sending a message to, or receiving a message from, a partitioned queue or topic.</span></span>

## <a name="enable-partitioning"></a><span data-ttu-id="e7abe-123">Включение секционирования</span><span class="sxs-lookup"><span data-stu-id="e7abe-123">Enable partitioning</span></span>

<span data-ttu-id="e7abe-124">Для использования секционированных очередей и разделов служебной шины Azure необходимо использовать пакет SDK для Azure 2.2 или более поздней версии или указать `api-version=2013-10` в HTTP-запросах.</span><span class="sxs-lookup"><span data-stu-id="e7abe-124">To use partitioned queues and topics with Azure Service Bus, use the Azure SDK version 2.2 or later, or specify `api-version=2013-10` in your HTTP requests.</span></span>

### <a name="standard"></a><span data-ttu-id="e7abe-125">Standard</span><span class="sxs-lookup"><span data-stu-id="e7abe-125">Standard</span></span>

<span data-ttu-id="e7abe-126">На уровне обмена сообщениями "Стандартный" можно создавать очереди и разделы служебной шины размером в 1, 2, 3, 4 или 5 ГБ (по умолчанию — 1 ГБ).</span><span class="sxs-lookup"><span data-stu-id="e7abe-126">In the Standard messaging tier, you can create Service Bus queues and topics in 1, 2, 3, 4, or 5 GB sizes (the default is 1 GB).</span></span> <span data-ttu-id="e7abe-127">Если секционирование включено, то для каждого гигабайта служебной шиной создается 16 копий (секций) сущности.</span><span class="sxs-lookup"><span data-stu-id="e7abe-127">With partitioning enabled, Service Bus creates 16 copies (16 partitions) of the entity for each GB you specify.</span></span> <span data-ttu-id="e7abe-128">Поэтому при создании очереди размером 5 ГБ с 16 разделами максимальный размер очереди составит 80 ГБ (5 \* 16).</span><span class="sxs-lookup"><span data-stu-id="e7abe-128">As such, if you create a queue that's 5 GB in size, with 16 partitions the maximum queue size becomes (5 \* 16) = 80 GB.</span></span> <span data-ttu-id="e7abe-129">Чтобы просмотреть максимальный размер секционированной очереди или раздела, откройте соответствующую запись на [портале Azure][Azure portal] в колонке **Обзор** для этой сущности.</span><span class="sxs-lookup"><span data-stu-id="e7abe-129">You can see the maximum size of your partitioned queue or topic by looking at its entry on the [Azure portal][Azure portal], in the **Overview** blade for that entity.</span></span>

### <a name="premium"></a><span data-ttu-id="e7abe-130">Premium</span><span class="sxs-lookup"><span data-stu-id="e7abe-130">Premium</span></span>

<span data-ttu-id="e7abe-131">В пространстве имен уровня "Премиум" можно создавать очереди и разделы служебной шины размером в 1, 2, 3, 4, 5, 10, 20, 40 или 80 ГБ (по умолчанию — 1 ГБ).</span><span class="sxs-lookup"><span data-stu-id="e7abe-131">In a Premium tier namespace, you can create Service Bus queues and topics in 1, 2, 3, 4, 5, 10, 20, 40, or 80 GB sizes (the default is 1 GB).</span></span> <span data-ttu-id="e7abe-132">Если секционирование включено по умолчанию, служебная шина создает две секции на каждую сущность.</span><span class="sxs-lookup"><span data-stu-id="e7abe-132">With partitioning enabled by default, Service Bus creates two partitions per entity.</span></span> <span data-ttu-id="e7abe-133">Чтобы просмотреть максимальный размер секционированной очереди или раздела, откройте соответствующую запись на [портале Azure][Azure portal] в колонке **Обзор** для этой сущности.</span><span class="sxs-lookup"><span data-stu-id="e7abe-133">You can see the maximum size of your partitioned queue or topic by looking at its entry on the [Azure portal][Azure portal], in the **Overview** blade for that entity.</span></span>

<span data-ttu-id="e7abe-134">Дополнительные сведения о секционировании на уровне обмена сообщениями "Премиум" см. в статье [Уровни обмена сообщениями через служебную шину Premium и Standard](service-bus-premium-messaging.md).</span><span class="sxs-lookup"><span data-stu-id="e7abe-134">For more information about partitioning in the Premium messaging tier, see [Service Bus Premium and Standard messaging tiers](service-bus-premium-messaging.md).</span></span> 

### <a name="create-a-partitioned-entity"></a><span data-ttu-id="e7abe-135">Создание секционированной сущности</span><span class="sxs-lookup"><span data-stu-id="e7abe-135">Create a partitioned entity</span></span>

<span data-ttu-id="e7abe-136">Создать секционированную очередь или раздел можно несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="e7abe-136">There are several ways to create a partitioned queue or topic.</span></span> <span data-ttu-id="e7abe-137">При создании очереди или раздела из приложения можно включить секционирование очереди или раздела, задав значение true для свойства [QueueDescription.EnablePartitioning][QueueDescription.EnablePartitioning] или [TopicDescription.EnablePartitioning][TopicDescription.EnablePartitioning] **true**, соответственно.</span><span class="sxs-lookup"><span data-stu-id="e7abe-137">When you create the queue or topic from your application, you can enable partitioning for the queue or topic by respectively setting the [QueueDescription.EnablePartitioning][QueueDescription.EnablePartitioning] or [TopicDescription.EnablePartitioning][TopicDescription.EnablePartitioning] property to **true**.</span></span> <span data-ttu-id="e7abe-138">Эти свойства должны быть заданы при создании очереди или раздела.</span><span class="sxs-lookup"><span data-stu-id="e7abe-138">These properties must be set at the time the queue or topic is created.</span></span> <span data-ttu-id="e7abe-139">Как упоминалось ранее, для имеющийся очереди или раздела изменить эти свойства невозможно.</span><span class="sxs-lookup"><span data-stu-id="e7abe-139">As stated previously, it is not possible to change these properties on an existing queue or topic.</span></span> <span data-ttu-id="e7abe-140">Например:</span><span class="sxs-lookup"><span data-stu-id="e7abe-140">For example:</span></span>

```csharp
// Create partitioned topic
NamespaceManager ns = NamespaceManager.CreateFromConnectionString(myConnectionString);
TopicDescription td = new TopicDescription(TopicName);
td.EnablePartitioning = true;
ns.CreateTopic(td);
```

<span data-ttu-id="e7abe-141">Кроме того, секционированную очередь или раздел можно создать на [портале Azure][Azure portal] или в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e7abe-141">Alternatively, you can create a partitioned queue or topic in the [Azure portal][Azure portal] or in Visual Studio.</span></span> <span data-ttu-id="e7abe-142">При создании очереди или раздела на портале флажок **Включить секционирование**, расположенный в колонке **Создать** очереди или раздела, установлен по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="e7abe-142">When you create a queue or topic in the portal, the **Enable partitioning** option in the queue or topic **Create** blade is checked by default.</span></span> <span data-ttu-id="e7abe-143">Этот параметр можно отключить только в сущности уровня "Стандартный". При секционировании на уровне "Премиум" он включен всегда.</span><span class="sxs-lookup"><span data-stu-id="e7abe-143">You can only disable this option in a Standard tier entity; in the Premium tier partitioning is always enabled.</span></span> <span data-ttu-id="e7abe-144">В Visual Studio установите флажок **Включить секционирование** в диалоговом окне **Новая очередь** или **Новый раздел**.</span><span class="sxs-lookup"><span data-stu-id="e7abe-144">In Visual Studio, click the **Enable Partitioning** checkbox in the **New Queue** or **New Topic** dialog box.</span></span>

## <a name="use-of-partition-keys"></a><span data-ttu-id="e7abe-145">Использование ключей секции</span><span class="sxs-lookup"><span data-stu-id="e7abe-145">Use of partition keys</span></span>
<span data-ttu-id="e7abe-146">Когда сообщение добавляется в секционированную очередь или раздел, служебная шина проверяет наличие ключа секции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-146">When a message is enqueued into a partitioned queue or topic, Service Bus checks for the presence of a partition key.</span></span> <span data-ttu-id="e7abe-147">Если ключ есть, то фрагмент выбирается на основе этого ключа.</span><span class="sxs-lookup"><span data-stu-id="e7abe-147">If it finds one, it selects the fragment based on that key.</span></span> <span data-ttu-id="e7abe-148">Если ключа нет, то фрагмент выбирается на основе внутреннего алгоритма.</span><span class="sxs-lookup"><span data-stu-id="e7abe-148">If it does not find a partition key, it selects the fragment based on an internal algorithm.</span></span>

### <a name="using-a-partition-key"></a><span data-ttu-id="e7abe-149">Использование ключа секции</span><span class="sxs-lookup"><span data-stu-id="e7abe-149">Using a partition key</span></span>
<span data-ttu-id="e7abe-150">В некоторых сценариях, например для сессий или транзакций, необходимо, чтобы сообщения хранились в определенном фрагменте.</span><span class="sxs-lookup"><span data-stu-id="e7abe-150">Some scenarios, such as sessions or transactions, require messages to be stored in a specific fragment.</span></span> <span data-ttu-id="e7abe-151">Для всех этих сценариев необходимо использовать ключ секции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-151">All these scenarios require the use of a partition key.</span></span> <span data-ttu-id="e7abe-152">Все сообщения, использующие один и тот же ключ секции, назначаются одному и тому же фрагменту.</span><span class="sxs-lookup"><span data-stu-id="e7abe-152">All messages that use the same partition key are assigned to the same fragment.</span></span> <span data-ttu-id="e7abe-153">Если фрагмент временно недоступен, служебная шина возвращает ошибку.</span><span class="sxs-lookup"><span data-stu-id="e7abe-153">If the fragment is temporarily unavailable, Service Bus returns an error.</span></span>

<span data-ttu-id="e7abe-154">В зависимости от сценария в качестве ключа секции используются разные свойства сообщения:</span><span class="sxs-lookup"><span data-stu-id="e7abe-154">Depending on the scenario, different message properties are used as a partition key:</span></span>

<span data-ttu-id="e7abe-155">**SessionId**: если для сообщения установлено свойство [BrokeredMessage.SessionId][BrokeredMessage.SessionId], то служебная шина использует это свойство в качестве ключа секции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-155">**SessionId**: If a message has the [BrokeredMessage.SessionId][BrokeredMessage.SessionId] property set, then Service Bus uses this property as the partition key.</span></span> <span data-ttu-id="e7abe-156">Таким образом, все сообщения, которые относятся к одному сеансу, обрабатываются одним и тем же посредником сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-156">This way, all messages that belong to the same session are handled by the same message broker.</span></span> <span data-ttu-id="e7abe-157">Это позволяет служебной шине гарантировать порядок сообщений и согласованность состояний сеансов.</span><span class="sxs-lookup"><span data-stu-id="e7abe-157">This enables Service Bus to guarantee message ordering as well as the consistency of session states.</span></span>

<span data-ttu-id="e7abe-158">**PartitionKey**. Если для сообщения установлено свойство [BrokeredMessage.PartitionKey][BrokeredMessage.PartitionKey], но не установлено свойство [BrokeredMessage.SessionId][BrokeredMessage.SessionId], то служебная шина использует свойство [PartitionKey][PartitionKey] в качестве ключа секции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-158">**PartitionKey**: If a message has the [BrokeredMessage.PartitionKey][BrokeredMessage.PartitionKey] property but not the [BrokeredMessage.SessionId][BrokeredMessage.SessionId] property set, then Service Bus uses the [PartitionKey][PartitionKey] property as the partition key.</span></span> <span data-ttu-id="e7abe-159">Если для сообщения установлены оба свойства [SessionId][SessionId] и [PartitionKey][PartitionKey], то их значения должны совпадать.</span><span class="sxs-lookup"><span data-stu-id="e7abe-159">If the message has both the [SessionId][SessionId] and the [PartitionKey][PartitionKey] properties set, both properties must be identical.</span></span> <span data-ttu-id="e7abe-160">Если значение свойства [PartitionKey][PartitionKey] отличается от значения свойства [SessionId][SessionId], служебная шина возвращает исключение недопустимой операции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-160">If the [PartitionKey][PartitionKey] property is set to a different value than the [SessionId][SessionId] property, Service Bus returns an invalid operation exception.</span></span> <span data-ttu-id="e7abe-161">Свойство [PartitionKey][PartitionKey] нужно использовать, если отправитель отправляет транзактные сообщения без учета сеансов.</span><span class="sxs-lookup"><span data-stu-id="e7abe-161">The [PartitionKey][PartitionKey] property should be used if a sender sends non-session aware transactional messages.</span></span> <span data-ttu-id="e7abe-162">Ключ секции гарантирует, что все сообщения, отправленные в транзакции, будут обработаны одним и тем же посредником сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-162">The partition key ensures that all messages that are sent within a transaction are handled by the same messaging broker.</span></span>

<span data-ttu-id="e7abe-163">**MessageId**. Если для очереди или раздела для свойства [QueueDescription.RequiresDuplicateDetection][QueueDescription.RequiresDuplicateDetection] задано значение **true**, а свойства [BrokeredMessage.SessionId][BrokeredMessage.SessionId] или [BrokeredMessage.PartitionKey][BrokeredMessage.PartitionKey] не заданы, то в качестве ключа секции выступает свойство [BrokeredMessage.MessageId][BrokeredMessage.MessageId].</span><span class="sxs-lookup"><span data-stu-id="e7abe-163">**MessageId**: If the queue or topic has the [QueueDescription.RequiresDuplicateDetection][QueueDescription.RequiresDuplicateDetection] property set to **true** and the [BrokeredMessage.SessionId][BrokeredMessage.SessionId] or [BrokeredMessage.PartitionKey][BrokeredMessage.PartitionKey] properties are not set, then the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] property serves as the partition key.</span></span> <span data-ttu-id="e7abe-164">(Обратите внимание, что библиотеки Microsoft .NET и AMQP назначают идентификатор сообщения автоматически, если отправляющее приложение этого не сделало). В этом случае все копии одного сообщения обрабатываются одним и тем же посредником сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-164">(Note that the Microsoft .NET and AMQP libraries automatically assign a message ID if the sending application does not.) In this case, all copies of the same message are handled by the same message broker.</span></span> <span data-ttu-id="e7abe-165">Это позволяет служебной шине находить и исключать повторяющиеся сообщения.</span><span class="sxs-lookup"><span data-stu-id="e7abe-165">This enables Service Bus to detect and eliminate duplicate messages.</span></span> <span data-ttu-id="e7abe-166">Если свойство [QueueDescription.RequiresDuplicateDetection][QueueDescription.RequiresDuplicateDetection] не установлено в значение **true**, служебная шина не рассматривает свойство [MessageId][MessageId] в качестве ключа секции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-166">If the [QueueDescription.RequiresDuplicateDetection][QueueDescription.RequiresDuplicateDetection] property is not set to **true**, Service Bus does not consider the [MessageId][MessageId] property as a partition key.</span></span>

### <a name="not-using-a-partition-key"></a><span data-ttu-id="e7abe-167">Неиспользование ключа секции</span><span class="sxs-lookup"><span data-stu-id="e7abe-167">Not using a partition key</span></span>
<span data-ttu-id="e7abe-168">При отсутствии ключа секции служебная шина распределяет сообщение по принципу циклического перебора всем фрагментам секционированной очереди или раздела.</span><span class="sxs-lookup"><span data-stu-id="e7abe-168">In the absence of a partition key, Service Bus distributes messages in a round-robin fashion to all the fragments of the partitioned queue or topic.</span></span> <span data-ttu-id="e7abe-169">Если выбранный фрагмент недоступен, служебная шина назначает сообщение другому фрагменту.</span><span class="sxs-lookup"><span data-stu-id="e7abe-169">If the chosen fragment is not available, Service Bus assigns the message to a different fragment.</span></span> <span data-ttu-id="e7abe-170">Таким образом, операция отправки выполняется даже при временной недоступности хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="e7abe-170">This way, the send operation succeeds despite the temporary unavailability of a messaging store.</span></span> <span data-ttu-id="e7abe-171">Тем не менее вы не получите гарантированного количества, обеспечиваемого ключом раздела.</span><span class="sxs-lookup"><span data-stu-id="e7abe-171">However, you will not achieve the guaranteed ordering that a partition key provides.</span></span>

<span data-ttu-id="e7abe-172">Более подробно компромисс между доступностью (нет ключа раздела) и целостностью (с использованием ключа раздела) рассматривается [в этой статье](../event-hubs/event-hubs-availability-and-consistency.md).</span><span class="sxs-lookup"><span data-stu-id="e7abe-172">For a more in-depth discussion of the tradeoff between availability (no partition key) and consistency (using a partition key), see [this article](../event-hubs/event-hubs-availability-and-consistency.md).</span></span> <span data-ttu-id="e7abe-173">Эта информация применяется в равной степени в отношении сущностей служебной шины с разделами и разделов концентраторов событий.</span><span class="sxs-lookup"><span data-stu-id="e7abe-173">This information applies equally to partitioned Service Bus entities and Event Hubs partitions.</span></span>

<span data-ttu-id="e7abe-174">Чтобы у служебной шины было достаточно времени для того, чтобы поместить сообщение в другой фрагмент, значение свойства [MessagingFactorySettings.OperationTimeout][MessagingFactorySettings.OperationTimeout], указываемое клиентом, который отправляет сообщение, должно быть больше 15 секунд.</span><span class="sxs-lookup"><span data-stu-id="e7abe-174">To give Service Bus enough time to enqueue the message into a different fragment, the [MessagingFactorySettings.OperationTimeout][MessagingFactorySettings.OperationTimeout] value specified by the client that sends the message must be greater than 15 seconds.</span></span> <span data-ttu-id="e7abe-175">Рекомендуется установить свойство [OperationTimeout][OperationTimeout] в значение по умолчанию 60 секунд.</span><span class="sxs-lookup"><span data-stu-id="e7abe-175">It is recommended that you set the [OperationTimeout][OperationTimeout] property to the default value of 60 seconds.</span></span>

<span data-ttu-id="e7abe-176">Обратите внимание, что ключ секции "прикрепляет" сообщение к определенному фрагменту.</span><span class="sxs-lookup"><span data-stu-id="e7abe-176">Note that a partition key "pins" a message to a specific fragment.</span></span> <span data-ttu-id="e7abe-177">Если хранилище сообщений, содержащее этот фрагмент, недоступно, служебная шина возвращает ошибку.</span><span class="sxs-lookup"><span data-stu-id="e7abe-177">If the messaging store that holds this fragment is unavailable, Service Bus returns an error.</span></span> <span data-ttu-id="e7abe-178">При отсутствии ключа секции служебная шина может выбрать другой фрагмент, и операция будет выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="e7abe-178">In the absence of a partition key, Service Bus can choose a different fragment and the operation succeeds.</span></span> <span data-ttu-id="e7abe-179">Поэтому рекомендуется не указывать ключ раздела, если он не является обязательным.</span><span class="sxs-lookup"><span data-stu-id="e7abe-179">Therefore, it is recommended that you do not supply a partition key unless it is required.</span></span>

## <a name="advanced-topics-use-transactions-with-partitioned-entities"></a><span data-ttu-id="e7abe-180">Дополнительные разделы: использование транзакций и секционированных сущностей</span><span class="sxs-lookup"><span data-stu-id="e7abe-180">Advanced topics: use transactions with partitioned entities</span></span>
<span data-ttu-id="e7abe-181">Сообщения, отправленные в рамках транзакции, должны указать ключ секции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-181">Messages that are sent as part of a transaction must specify a partition key.</span></span> <span data-ttu-id="e7abe-182">Это может быть одно из следующих свойств: [BrokeredMessage.SessionId][BrokeredMessage.SessionId], [BrokeredMessage.PartitionKey][BrokeredMessage.PartitionKey] или [BrokeredMessage.MessageId][BrokeredMessage.MessageId].</span><span class="sxs-lookup"><span data-stu-id="e7abe-182">This can be one of the following properties: [BrokeredMessage.SessionId][BrokeredMessage.SessionId], [BrokeredMessage.PartitionKey][BrokeredMessage.PartitionKey], or [BrokeredMessage.MessageId][BrokeredMessage.MessageId].</span></span> <span data-ttu-id="e7abe-183">Сообщения, отправляемые в рамках одной транзакции, должны иметь один и тот же ключ секции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-183">All messages that are sent as part of the same transaction must specify the same partition key.</span></span> <span data-ttu-id="e7abe-184">При попытке отправить сообщение без ключа секции в рамках транзакции служебная шина возвращает исключение недопустимой операции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-184">If you attempt to send a message without a partition key within a transaction, Service Bus returns an invalid operation exception.</span></span> <span data-ttu-id="e7abe-185">При попытке отправить несколько сообщений с различными ключами секции в рамках одной транзакции служебная шина возвращает исключение недопустимой операции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-185">If you attempt to send multiple messages within the same transaction that have different partition keys, Service Bus returns an invalid operation exception.</span></span> <span data-ttu-id="e7abe-186">Например:</span><span class="sxs-lookup"><span data-stu-id="e7abe-186">For example:</span></span>

```csharp
CommittableTransaction committableTransaction = new CommittableTransaction();
using (TransactionScope ts = new TransactionScope(committableTransaction))
{
    BrokeredMessage msg = new BrokeredMessage("This is a message");
    msg.PartitionKey = "myPartitionKey";
    messageSender.Send(msg); 
    ts.Complete();
}
committableTransaction.Commit();
```

<span data-ttu-id="e7abe-187">Если установлено любое из свойств, которые служат в качестве ключа секции, служебная шина прикрепляет сообщение к определенному фрагменту.</span><span class="sxs-lookup"><span data-stu-id="e7abe-187">If any of the properties that serve as a partition key are set, Service Bus pins the message to a specific fragment.</span></span> <span data-ttu-id="e7abe-188">Это происходит независимо от того, используется ли транзакция.</span><span class="sxs-lookup"><span data-stu-id="e7abe-188">This behavior occurs whether or not a transaction is used.</span></span> <span data-ttu-id="e7abe-189">Рекомендуется не указывать ключ секции, если в этом нет необходимости.</span><span class="sxs-lookup"><span data-stu-id="e7abe-189">It is recommended that you do not specify a partition key if it is not necessary.</span></span>

## <a name="using-sessions-with-partitioned-entities"></a><span data-ttu-id="e7abe-190">Использование сеансов и секционированных сущностей</span><span class="sxs-lookup"><span data-stu-id="e7abe-190">Using sessions with partitioned entities</span></span>
<span data-ttu-id="e7abe-191">Чтобы отправить транзакционное сообщение в раздел или очередь, учитывающие сеансы, для этого сообщения должно быть задано свойство [BrokeredMessage.SessionId][BrokeredMessage.SessionId].</span><span class="sxs-lookup"><span data-stu-id="e7abe-191">To send a transactional message to a session-aware topic or queue, the message must have the [BrokeredMessage.SessionId][BrokeredMessage.SessionId] property set.</span></span> <span data-ttu-id="e7abe-192">Если также установлено свойство [BrokeredMessage.PartitionKey][BrokeredMessage.PartitionKey], оно должно быть идентично свойству [SessionId][SessionId].</span><span class="sxs-lookup"><span data-stu-id="e7abe-192">If the [BrokeredMessage.PartitionKey][BrokeredMessage.PartitionKey] property is specified as well, it must be identical to the [SessionId][SessionId] property.</span></span> <span data-ttu-id="e7abe-193">Если они различаются, служебная шина возвращает исключение недопустимой операции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-193">If they differ, Service Bus returns an invalid operation exception.</span></span>

<span data-ttu-id="e7abe-194">В отличие от обычных (несекционированных) очередей и разделов, использовать одну транзакцию для отправки нескольких сообщений в различные сеансы невозможно.</span><span class="sxs-lookup"><span data-stu-id="e7abe-194">Unlike regular (non-partitioned) queues or topics, it is not possible to use a single transaction to send multiple messages to different sessions.</span></span> <span data-ttu-id="e7abe-195">Если же попытаться это сделать, служебная шина возвращает исключение недопустимой операции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-195">If attempted, Service Bus returns an invalid operation exception.</span></span> <span data-ttu-id="e7abe-196">Например:</span><span class="sxs-lookup"><span data-stu-id="e7abe-196">For example:</span></span>

```csharp
CommittableTransaction committableTransaction = new CommittableTransaction();
using (TransactionScope ts = new TransactionScope(committableTransaction))
{
    BrokeredMessage msg = new BrokeredMessage("This is a message");
    msg.SessionId = "mySession";
    messageSender.Send(msg); 
    ts.Complete();
}
committableTransaction.Commit();
```

## <a name="automatic-message-forwarding-with-partitioned-entities"></a><span data-ttu-id="e7abe-197">Автоматическая переадресация сообщений для секционированных сущностей</span><span class="sxs-lookup"><span data-stu-id="e7abe-197">Automatic message forwarding with partitioned entities</span></span>
<span data-ttu-id="e7abe-198">Служебная шина поддерживает автоматическую переадресацию сообщений в секционированные сущности, из них или между ними.</span><span class="sxs-lookup"><span data-stu-id="e7abe-198">Service Bus supports automatic message forwarding from, to, or between partitioned entities.</span></span> <span data-ttu-id="e7abe-199">Чтобы включить автоматическую переадресацию сообщений, установите свойство [QueueDescription.ForwardTo][QueueDescription.ForwardTo] исходной очереди или подписки.</span><span class="sxs-lookup"><span data-stu-id="e7abe-199">To enable automatic message forwarding, set the [QueueDescription.ForwardTo][QueueDescription.ForwardTo] property on the source queue or subscription.</span></span> <span data-ttu-id="e7abe-200">Если в сообщении указан ключ секции ([SessionId][SessionId], [PartitionKey][PartitionKey] или [MessageId][MessageId]), то этот ключ секции используется для сущности назначения.</span><span class="sxs-lookup"><span data-stu-id="e7abe-200">If the message specifies a partition key ([SessionId][SessionId], [PartitionKey][PartitionKey], or [MessageId][MessageId]), that partition key is used for the destination entity.</span></span>

## <a name="considerations-and-guidelines"></a><span data-ttu-id="e7abe-201">Рекомендации и советы</span><span class="sxs-lookup"><span data-stu-id="e7abe-201">Considerations and guidelines</span></span>
* <span data-ttu-id="e7abe-202">**Функции высокого уровня согласованности**. Если сущность использует такие функции, как сеансы, обнаружение дубликатов или явное управление ключом секционирования, то операции обмена сообщениями всегда направляются в определенные фрагменты.</span><span class="sxs-lookup"><span data-stu-id="e7abe-202">**High consistency features**: If an entity uses features such as sessions, duplicate detection, or explicit control of partitioning key, then the messaging operations are always routed to specific fragments.</span></span> <span data-ttu-id="e7abe-203">Если любой из фрагментов сталкивается с высоким трафиком или базовое хранилище неработоспособно, то эти операции завершаются сбоем и их доступность ограничивается.</span><span class="sxs-lookup"><span data-stu-id="e7abe-203">If any of the fragments experience high traffic or the underlying store is unhealthy, those operations fail and availability is reduced.</span></span> <span data-ttu-id="e7abe-204">В целом уровень согласованности гораздо выше, чем при использовании несекционированных сущностей, поэтому проблемы возникают лишь в некоторой части трафика.</span><span class="sxs-lookup"><span data-stu-id="e7abe-204">Overall, the consistency is still much higher than non-partitioned entities; only a subset of traffic is experiencing issues, as opposed to all the traffic.</span></span> <span data-ttu-id="e7abe-205">Дополнительные сведения см. в этом [обсуждении доступности и целостности](../event-hubs/event-hubs-availability-and-consistency.md).</span><span class="sxs-lookup"><span data-stu-id="e7abe-205">For more information, see this [discussion of availability and consistency](../event-hubs/event-hubs-availability-and-consistency.md).</span></span>
* <span data-ttu-id="e7abe-206">**Управление**. Такие операции, как создание, обновление и удаление, должны выполняться во всех фрагментах сущности.</span><span class="sxs-lookup"><span data-stu-id="e7abe-206">**Management**: Operations such as Create, Update and Delete must be performed on all the fragments of the entity.</span></span> <span data-ttu-id="e7abe-207">Если какой-либо из фрагментов находится в неработоспособном состоянии, это может привести к сбою этих операций.</span><span class="sxs-lookup"><span data-stu-id="e7abe-207">If any fragment is unhealthy it could result in failures for these operations.</span></span> <span data-ttu-id="e7abe-208">Для операции GET требуется, чтобы сведения, например количество сообщений, были собраны для всех фрагментов.</span><span class="sxs-lookup"><span data-stu-id="e7abe-208">For the Get operation, information such as message counts must be aggregated from all fragments.</span></span> <span data-ttu-id="e7abe-209">Если какой-либо из фрагментов находится в неработоспособном состоянии, состояние доступности сущности отображается как ограниченное.</span><span class="sxs-lookup"><span data-stu-id="e7abe-209">If any fragment is unhealthy, the entity availability status is reported as limited.</span></span>
* <span data-ttu-id="e7abe-210">**Сообщения небольших объемов**. Чтобы получить все сообщения в таких сценариях, особенно при использовании протокола HTTP, может потребоваться выполнить несколько операций получения.</span><span class="sxs-lookup"><span data-stu-id="e7abe-210">**Low volume message scenarios**: For such scenarios, especially when using the HTTP protocol, you may have to perform multiple receive operations in order to obtain all the messages.</span></span> <span data-ttu-id="e7abe-211">Для запросов на получение внешний интерфейс выполняет операцию получения во всех фрагментах и кэширует все полученные ответы.</span><span class="sxs-lookup"><span data-stu-id="e7abe-211">For receive requests, the front end performs a receive on all the fragments and caches all the responses received.</span></span> <span data-ttu-id="e7abe-212">Это кэширование повышает производительность последующего запроса на получение при том же подключении, уменьшая задержки получения.</span><span class="sxs-lookup"><span data-stu-id="e7abe-212">A subsequent receive request on the same connection would benefit from this caching and receive latencies will be lower.</span></span> <span data-ttu-id="e7abe-213">Тем не менее при наличии нескольких подключений или использовании протокола HTTP для каждого запроса устанавливается новое подключение.</span><span class="sxs-lookup"><span data-stu-id="e7abe-213">However, if you have multiple connections or use HTTP, that establishes a new connection for each request.</span></span> <span data-ttu-id="e7abe-214">Таким образом, нет никакой гарантии, что запрос будет выполняться на том же узле.</span><span class="sxs-lookup"><span data-stu-id="e7abe-214">As such, there is no guarantee that it would land on the same node.</span></span> <span data-ttu-id="e7abe-215">Если все имеющиеся сообщения блокируются и кэшируются в другом внешнем интерфейсе, операция получения возвращает значение **NULL**.</span><span class="sxs-lookup"><span data-stu-id="e7abe-215">If all existing messages are locked and cached in another front end, the receive operation returns **null**.</span></span> <span data-ttu-id="e7abe-216">Когда в конечном итоге срок действия сообщений истекает, их снова можно получать.</span><span class="sxs-lookup"><span data-stu-id="e7abe-216">Messages eventually expire and you can receive them again.</span></span> <span data-ttu-id="e7abe-217">Рекомендуется выполнить проверку активности HTTP.</span><span class="sxs-lookup"><span data-stu-id="e7abe-217">HTTP keep-alive is recommended.</span></span>
* <span data-ttu-id="e7abe-218">**Обзор и просмотр сообщений**. Метод [PeekBatch](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_PeekBatch_System_Int32_) не всегда возвращает количество сообщений, указанное в свойстве [MessageCount](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_MessageCount).</span><span class="sxs-lookup"><span data-stu-id="e7abe-218">**Browse/Peek messages**: [PeekBatch](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_PeekBatch_System_Int32_) does not always return the number of messages specified in the [MessageCount](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_MessageCount) property.</span></span> <span data-ttu-id="e7abe-219">На это есть две причины.</span><span class="sxs-lookup"><span data-stu-id="e7abe-219">There are two common reasons for this.</span></span> <span data-ttu-id="e7abe-220">Первая причина — объединенный размер коллекции сообщений превышает максимальный размер в 256 КБ.</span><span class="sxs-lookup"><span data-stu-id="e7abe-220">One reason is that the aggregated size of the collection of messages exceeds the maximum size of 256KB.</span></span> <span data-ttu-id="e7abe-221">Вторая причина заключается в том, что если для [свойства EnablePartitioning](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning) очереди или раздела задано значение **true**, то секция может содержать недостаточно сообщений для выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="e7abe-221">Another reason is that if the queue or topic has the [EnablePartitioning property](/dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning) set to **true**, a partition may not have enough messages to complete the requested number of messages.</span></span> <span data-ttu-id="e7abe-222">Как правило, если приложению требуется получить определенное количество сообщений, оно должно вызывать метод [PeekBatch](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_PeekBatch_System_Int32_), пока не получит желаемое количество сообщений или пока не закончатся сообщения, которые можно просмотреть.</span><span class="sxs-lookup"><span data-stu-id="e7abe-222">In general, if an application wants to receive a specific number of messages, it should call [PeekBatch](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_PeekBatch_System_Int32_) repeatedly until it gets that number of messages, or there are no more messages to peek.</span></span> <span data-ttu-id="e7abe-223">Дополнительные сведения, включая примеры кода, см. в разделах [QueueClient.PeekBatch](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_PeekBatch_System_Int32_) или [SubscriptionClient.PeekBatch](/dotnet/api/microsoft.servicebus.messaging.subscriptionclient#Microsoft_ServiceBus_Messaging_SubscriptionClient_PeekBatch_System_Int32_).</span><span class="sxs-lookup"><span data-stu-id="e7abe-223">For more information, including code samples, see [QueueClient.PeekBatch](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_PeekBatch_System_Int32_) or [SubscriptionClient.PeekBatch](/dotnet/api/microsoft.servicebus.messaging.subscriptionclient#Microsoft_ServiceBus_Messaging_SubscriptionClient_PeekBatch_System_Int32_).</span></span>

## <a name="latest-added-features"></a><span data-ttu-id="e7abe-224">Новые функции</span><span class="sxs-lookup"><span data-stu-id="e7abe-224">Latest added features</span></span>
* <span data-ttu-id="e7abe-225">Теперь для секционированных сущностей поддерживаются операции добавления и удаления правила.</span><span class="sxs-lookup"><span data-stu-id="e7abe-225">Add or remove rule is now supported with partitioned entities.</span></span> <span data-ttu-id="e7abe-226">В отличие от несекционированных сущностей эти операции не поддерживаются при выполнении транзакций.</span><span class="sxs-lookup"><span data-stu-id="e7abe-226">Different from non-partitioned entities, these operations are not supported under transactions.</span></span> 
* <span data-ttu-id="e7abe-227">Теперь AMQP может использоваться для обмена сообщениями (отправка и получение) с секционированными сущностями.</span><span class="sxs-lookup"><span data-stu-id="e7abe-227">AMQP is now supported for sending and receiving messages to and from a partitioned entity.</span></span>
* <span data-ttu-id="e7abe-228">Теперь протокол AMQP поддерживается для следующих операций: [пакетная отправка](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_SendBatch_System_Collections_Generic_IEnumerable_Microsoft_ServiceBus_Messaging_BrokeredMessage__), [пакетное получение](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_ReceiveBatch_System_Int32_), [получение по порядковому номеру](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_Receive_System_Int64_), [обзор](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_Peek), [блокировка обновления](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_RenewMessageLock_System_Guid_), [планирование сообщений](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_ScheduleMessageAsync_Microsoft_ServiceBus_Messaging_BrokeredMessage_System_DateTimeOffset_), [отмена запланированных сообщений](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_CancelScheduledMessageAsync_System_Int64_), [добавление правила](/dotnet/api/microsoft.servicebus.messaging.ruledescription), [удаление правила](/dotnet/api/microsoft.servicebus.messaging.ruledescription), [блокировка обновления сеанса](/dotnet/api/microsoft.servicebus.messaging.messagesession#Microsoft_ServiceBus_Messaging_MessageSession_RenewLock), [установка состояния сеанса](/dotnet/api/microsoft.servicebus.messaging.messagesession#Microsoft_ServiceBus_Messaging_MessageSession_SetState_System_IO_Stream_), [получение состояния сеанса](/dotnet/api/microsoft.servicebus.messaging.messagesession#Microsoft_ServiceBus_Messaging_MessageSession_GetState) и [перечисление сеансов](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_GetMessageSessionsAsync).</span><span class="sxs-lookup"><span data-stu-id="e7abe-228">AMQP is now supported for the following operations: [Batch Send](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_SendBatch_System_Collections_Generic_IEnumerable_Microsoft_ServiceBus_Messaging_BrokeredMessage__), [Batch Receive](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_ReceiveBatch_System_Int32_), [Receive by Sequence Number](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_Receive_System_Int64_), [Peek](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_Peek), [Renew Lock](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_RenewMessageLock_System_Guid_), [Schedule Message](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_ScheduleMessageAsync_Microsoft_ServiceBus_Messaging_BrokeredMessage_System_DateTimeOffset_), [Cancel Scheduled Message](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_CancelScheduledMessageAsync_System_Int64_), [Add Rule](/dotnet/api/microsoft.servicebus.messaging.ruledescription), [Remove Rule](/dotnet/api/microsoft.servicebus.messaging.ruledescription), [Session Renew Lock](/dotnet/api/microsoft.servicebus.messaging.messagesession#Microsoft_ServiceBus_Messaging_MessageSession_RenewLock), [Set Session State](/dotnet/api/microsoft.servicebus.messaging.messagesession#Microsoft_ServiceBus_Messaging_MessageSession_SetState_System_IO_Stream_), [Get Session State](/dotnet/api/microsoft.servicebus.messaging.messagesession#Microsoft_ServiceBus_Messaging_MessageSession_GetState), and [Enumerate Sessions](/dotnet/api/microsoft.servicebus.messaging.queueclient#Microsoft_ServiceBus_Messaging_QueueClient_GetMessageSessionsAsync).</span></span>

## <a name="partitioned-entities-limitations"></a><span data-ttu-id="e7abe-229">Ограничения секционированных сущностей</span><span class="sxs-lookup"><span data-stu-id="e7abe-229">Partitioned entities limitations</span></span>
<span data-ttu-id="e7abe-230">В настоящее время служебная шина накладывает следующие ограничения на секционированные очереди и разделы:</span><span class="sxs-lookup"><span data-stu-id="e7abe-230">Currently Service Bus imposes the following limitations on partitioned queues and topics:</span></span>

* <span data-ttu-id="e7abe-231">Секционированные очереди и разделы не поддерживают отправку сообщений, принадлежащих разным сеансам, в одной транзакции.</span><span class="sxs-lookup"><span data-stu-id="e7abe-231">Partitioned queues and topics do not support sending messages that belong to different sessions in a single transaction.</span></span>
* <span data-ttu-id="e7abe-232">В настоящее время служебная шина обеспечивает до 100 секционированных очередей или разделов на пространство имен.</span><span class="sxs-lookup"><span data-stu-id="e7abe-232">Service Bus currently allows up to 100 partitioned queues or topics per namespace.</span></span> <span data-ttu-id="e7abe-233">Каждая секционированная очередь или раздел учитывается в квоте в 10 000 сущностей на пространство имен (не относится к уровню "Премиум").</span><span class="sxs-lookup"><span data-stu-id="e7abe-233">Each partitioned queue or topic counts towards the quota of 10,000 entities per namespace (does not apply to Premium tier).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e7abe-234">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="e7abe-234">Next steps</span></span>
<span data-ttu-id="e7abe-235">Дополнительные сведения о секционировании сущностей обмена сообщениями см. в статье [Руководство по использованию протокола AMQP 1.0 в служебной шине и концентраторах событий Azure][AMQP 1.0 support for Service Bus partitioned queues and topics].</span><span class="sxs-lookup"><span data-stu-id="e7abe-235">See the discussion of [AMQP 1.0 support for Service Bus partitioned queues and topics][AMQP 1.0 support for Service Bus partitioned queues and topics] to learn more about partitioning messaging entities.</span></span> 

[Service Bus architecture]: service-bus-architecture.md
[Azure portal]: https://portal.azure.com
[QueueDescription.EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[TopicDescription.EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.topicdescription#Microsoft_ServiceBus_Messaging_TopicDescription_EnablePartitioning
[BrokeredMessage.SessionId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_SessionId
[BrokeredMessage.PartitionKey]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_PartitionKey
[SessionId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_SessionId
[PartitionKey]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_PartitionKey
[QueueDescription.RequiresDuplicateDetection]: /dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_RequiresDuplicateDetection
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[MessagingFactorySettings.OperationTimeout]: /dotnet/api/microsoft.servicebus.messaging.messagingfactorysettings#Microsoft_ServiceBus_Messaging_MessagingFactorySettings_OperationTimeout
[OperationTimeout]: /dotnet/api/microsoft.servicebus.messaging.messagingfactorysettings#Microsoft_ServiceBus_Messaging_MessagingFactorySettings_OperationTimeout
[QueueDescription.ForwardTo]: /dotnet/api/microsoft.servicebus.messaging.queuedescription#Microsoft_ServiceBus_Messaging_QueueDescription_ForwardTo
[AMQP 1.0 support for Service Bus partitioned queues and topics]: service-bus-partitioned-queues-and-topics-amqp-overview.md
