---
title: "aaaService шины асинхронный обмен сообщениями | Документы Microsoft"
description: "Описание асинхронного обмена сообщениями в служебной шине Azure."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: f1435549-e1f2-40cb-a280-64ea07b39fc7
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/19/2017
ms.author: sethm
ms.openlocfilehash: 5ab6ddf052155a9dd975b413cfaf393119c1999d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="asynchronous-messaging-patterns-and-high-availability"></a><span data-ttu-id="98af0-103">Шаблоны асинхронного обмена сообщениями и высокий уровень доступности</span><span class="sxs-lookup"><span data-stu-id="98af0-103">Asynchronous messaging patterns and high availability</span></span>

<span data-ttu-id="98af0-104">Асинхронный обмен сообщениями может осуществляться различными способами.</span><span class="sxs-lookup"><span data-stu-id="98af0-104">Asynchronous messaging can be implemented in a variety of different ways.</span></span> <span data-ttu-id="98af0-105">Служебная шина Azure поддерживает асинхронность за счет механизма сохранения и пересылки. Этот механизм оперирует очередями, разделами и подписками.</span><span class="sxs-lookup"><span data-stu-id="98af0-105">With queues, topics, and subscriptions, Azure Service Bus supports asynchronism via a store and forward mechanism.</span></span> <span data-ttu-id="98af0-106">В нормальных условиях (синхронный) отправлять сообщения tooqueues и разделы и получения сообщений из очереди и подписки.</span><span class="sxs-lookup"><span data-stu-id="98af0-106">In normal (synchronous) operation, you send messages tooqueues and topics, and receive messages from queues and subscriptions.</span></span> <span data-ttu-id="98af0-107">Для создаваемых приложений важно, чтобы эти сущности всегда были доступны.</span><span class="sxs-lookup"><span data-stu-id="98af0-107">Applications you write depend on these entities always being available.</span></span> <span data-ttu-id="98af0-108">При изменения работоспособности hello объекта, из-за различных обстоятельств tooa необходим способ tooprovide сниженном сущность, которая может удовлетворить большинство потребностей.</span><span class="sxs-lookup"><span data-stu-id="98af0-108">When hello entity health changes, due tooa variety of circumstances, you need a way tooprovide a reduced capability entity that can satisfy most needs.</span></span>

<span data-ttu-id="98af0-109">Приложения обычно используют асинхронного обмена сообщениями шаблоны tooenable ряд сценариев связи.</span><span class="sxs-lookup"><span data-stu-id="98af0-109">Applications typically use asynchronous messaging patterns tooenable a number of communication scenarios.</span></span> <span data-ttu-id="98af0-110">Вы можете создавать приложения, в которых клиенты могут отправлять сообщения tooservices, даже в том случае, если не запущена служба hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-110">You can build applications in which clients can send messages tooservices, even when hello service is not running.</span></span> <span data-ttu-id="98af0-111">Для приложений, которые испытывают пиковыми периодами отправки сообщений очередь может помочь уровня hello загрузки, предоставляя связи toobuffer месте.</span><span class="sxs-lookup"><span data-stu-id="98af0-111">For applications that experience bursts of communications, a queue can help level hello load by providing a place toobuffer communications.</span></span> <span data-ttu-id="98af0-112">Наконец вы можете получить простой, но эффективный нагрузки балансировки toodistribute сообщений между несколькими компьютерами.</span><span class="sxs-lookup"><span data-stu-id="98af0-112">Finally, you can get a simple but effective load balancer toodistribute messages across multiple machines.</span></span>

<span data-ttu-id="98af0-113">В порядке toomaintain доступности какой-либо из этих сущностей следует учитывать ряд различными способами, в котором они могут быть недоступными для устойчивой системы обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="98af0-113">In order toomaintain availability of any of these entities, consider a number of different ways in which these entities can appear unavailable for a durable messaging system.</span></span> <span data-ttu-id="98af0-114">Вообще говоря мы увидим hello сущности становятся недоступны tooapplications, которые мы пишем в hello, следуя различными способами:</span><span class="sxs-lookup"><span data-stu-id="98af0-114">Generally speaking, we see hello entity become unavailable tooapplications we write in hello following different ways:</span></span>

* <span data-ttu-id="98af0-115">Не удается toosend сообщения.</span><span class="sxs-lookup"><span data-stu-id="98af0-115">Unable toosend messages.</span></span>
* <span data-ttu-id="98af0-116">Не удается tooreceive сообщения.</span><span class="sxs-lookup"><span data-stu-id="98af0-116">Unable tooreceive messages.</span></span>
* <span data-ttu-id="98af0-117">Не удается toomanage сущностями (создать, извлекать, обновлять или удалять сущности).</span><span class="sxs-lookup"><span data-stu-id="98af0-117">Unable toomanage entities (create, retrieve, update, or delete entities).</span></span>
* <span data-ttu-id="98af0-118">Не удается toocontact hello службы.</span><span class="sxs-lookup"><span data-stu-id="98af0-118">Unable toocontact hello service.</span></span>

<span data-ttu-id="98af0-119">Для каждой из этих ошибок разных режимов сбоя существует, позволяющие приложения toocontinue tooperform работы некоторых сниженном уровне.</span><span class="sxs-lookup"><span data-stu-id="98af0-119">For each of these failures, different failure modes exist that enable an application toocontinue tooperform work at some level of reduced capability.</span></span> <span data-ttu-id="98af0-120">Например, если система может отправлять сообщения, но не может их получать, вы по-прежнему будете получать заказы от клиентов, но не сможете их обрабатывать.</span><span class="sxs-lookup"><span data-stu-id="98af0-120">For example, a system that can send messages but not receive them can still receive orders from customers but cannot process those orders.</span></span> <span data-ttu-id="98af0-121">В этой статье рассматриваются возможные проблемы и способы их устранения.</span><span class="sxs-lookup"><span data-stu-id="98af0-121">This topic discusses potential issues that can occur, and how those issues are mitigated.</span></span> <span data-ttu-id="98af0-122">Service Bus был представлен ряд исправлений, которые должны согласиться на, а в этом разделе также рассматриваются правила, определяющие hello использование этих исправлений участия в программе приветствия.</span><span class="sxs-lookup"><span data-stu-id="98af0-122">Service Bus has introduced a number of mitigations which you must opt into, and this topic also discusses hello rules governing hello use of those opt-in mitigations.</span></span>

## <a name="reliability-in-service-bus"></a><span data-ttu-id="98af0-123">Надежность служебной шины</span><span class="sxs-lookup"><span data-stu-id="98af0-123">Reliability in Service Bus</span></span>
<span data-ttu-id="98af0-124">Существует несколько способов toohandle проблемы сообщения и сущности и существуют рекомендации, регулирующие соответствующее использование этих исправлений hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-124">There are several ways toohandle message and entity issues, and there are guidelines governing hello appropriate use of those mitigations.</span></span> <span data-ttu-id="98af0-125">рекомендации по toounderstand hello, необходимо сначала понять, что может произойти сбой в Service Bus.</span><span class="sxs-lookup"><span data-stu-id="98af0-125">toounderstand hello guidelines, you must first understand what can fail in Service Bus.</span></span> <span data-ttu-id="98af0-126">Из-за toohello проектирования систем Azure все эти проблемы, как правило, toobe кратковременными.</span><span class="sxs-lookup"><span data-stu-id="98af0-126">Due toohello design of Azure systems, all of these issues tend toobe short-lived.</span></span> <span data-ttu-id="98af0-127">На высоком уровне hello различные причины недоступности могут выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="98af0-127">At a high level, hello different causes of unavailability appear as follows:</span></span>

* <span data-ttu-id="98af0-128">Регулирование из внешней системы, от которой зависит служебная шина.</span><span class="sxs-lookup"><span data-stu-id="98af0-128">Throttling from an external system on which Service Bus depends.</span></span> <span data-ttu-id="98af0-129">Регулирование возникает вследствие взаимодействия с ресурсами хранилища и вычислительными ресурсами.</span><span class="sxs-lookup"><span data-stu-id="98af0-129">Throttling occurs from interactions with storage and compute resources.</span></span>
* <span data-ttu-id="98af0-130">Проблема в системе, от которой зависит служебная шина.</span><span class="sxs-lookup"><span data-stu-id="98af0-130">Issue for a system on which Service Bus depends.</span></span> <span data-ttu-id="98af0-131">Например, могут возникнуть ошибки в определенной части хранилища.</span><span class="sxs-lookup"><span data-stu-id="98af0-131">For example, a given part of storage can encounter issues.</span></span>
* <span data-ttu-id="98af0-132">Сбой служебной шины в единой подсистеме.</span><span class="sxs-lookup"><span data-stu-id="98af0-132">Failure of Service Bus on single subsystem.</span></span> <span data-ttu-id="98af0-133">В этом случае вычислительного узла можно получить в несогласованном состоянии и должен перезагрузиться, что вынуждает все сущности служит баланс tooload tooother узлов.</span><span class="sxs-lookup"><span data-stu-id="98af0-133">In this situation, a compute node can get into an inconsistent state and must restart itself, causing all entities it serves tooload balance tooother nodes.</span></span> <span data-ttu-id="98af0-134">Это, в свою очередь, может стать причиной кратковременного замедления обработки сообщений.</span><span class="sxs-lookup"><span data-stu-id="98af0-134">This in turn can cause a short period of slow message processing.</span></span>
* <span data-ttu-id="98af0-135">Сбой служебной шины в центре обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="98af0-135">Failure of Service Bus within an Azure datacenter.</span></span> <span data-ttu-id="98af0-136">Это «разрушительного сбоя» во время которого hello система недоступна в течение многих минут или нескольких часов.</span><span class="sxs-lookup"><span data-stu-id="98af0-136">This is a "catastrophic failure" during which hello system is unreachable for many minutes or a few hours.</span></span>

> [!NOTE]
> <span data-ttu-id="98af0-137">Термин Hello **хранения** может означать хранилища Azure и SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="98af0-137">hello term **storage** can mean both Azure Storage and SQL Azure.</span></span>
> 
> 

<span data-ttu-id="98af0-138">В служебной шине предусмотрен ряд способов устранения рисков, связанных с этими проблемами.</span><span class="sxs-lookup"><span data-stu-id="98af0-138">Service Bus contains a number of mitigations for these issues.</span></span> <span data-ttu-id="98af0-139">Привет, в следующих разделах описываются все проблемы и их исправления.</span><span class="sxs-lookup"><span data-stu-id="98af0-139">hello following sections discuss each issue and their respective mitigations.</span></span>

### <a name="throttling"></a><span data-ttu-id="98af0-140">Регулирование</span><span class="sxs-lookup"><span data-stu-id="98af0-140">Throttling</span></span>
<span data-ttu-id="98af0-141">Регулирование в служебной шине позволяет управлять скоростью обмена сообщениями "кооперативным" способом.</span><span class="sxs-lookup"><span data-stu-id="98af0-141">With Service Bus, throttling enables cooperative message rate management.</span></span> <span data-ttu-id="98af0-142">Каждый отдельный узел служебной шины хранит множество сущностей.</span><span class="sxs-lookup"><span data-stu-id="98af0-142">Each individual Service Bus node houses many entities.</span></span> <span data-ttu-id="98af0-143">Каждая из этих сущностей предъявляет требования hello системы с точки зрения ЦП, памяти, хранилища и других аспектов.</span><span class="sxs-lookup"><span data-stu-id="98af0-143">Each of those entities makes demands on hello system in terms of CPU, memory, storage, and other facets.</span></span> <span data-ttu-id="98af0-144">Если использование какого-либо из ресурсов превысит установленные ограничения, служебная шина может отклонить запрос.</span><span class="sxs-lookup"><span data-stu-id="98af0-144">When any of these facets detects usage that exceeds defined thresholds, Service Bus can deny a given request.</span></span> <span data-ttu-id="98af0-145">Hello вызывающий объект получает [ServerBusyException] [ ServerBusyException] и повторяет попытку через 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="98af0-145">hello caller receives a [ServerBusyException][ServerBusyException] and retries after 10 seconds.</span></span>

<span data-ttu-id="98af0-146">С целью предотвращения кода hello hello Ошибка чтения и прервать попытки приветственное сообщение в течение 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="98af0-146">As a mitigation, hello code must read hello error and halt any retries of hello message for at least 10 seconds.</span></span> <span data-ttu-id="98af0-147">Поскольку hello ошибка может произойти в разных частях приложения hello клиента, предполагается, что любая часть независимо выполняет логику повторных попыток hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-147">Since hello error can happen across pieces of hello customer application, it is expected that each piece independently executes hello retry logic.</span></span> <span data-ttu-id="98af0-148">Hello код может уменьшить вероятность регулировки за счет разбиения в очередь или раздел hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-148">hello code can reduce hello probability of being throttled by enabling partitioning on a queue or topic.</span></span>

### <a name="issue-for-an-azure-dependency"></a><span data-ttu-id="98af0-149">Проблема с зависимостью в Azure</span><span class="sxs-lookup"><span data-stu-id="98af0-149">Issue for an Azure dependency</span></span>
<span data-ttu-id="98af0-150">В любом из компонентов Azure время от времени могут возникать проблемы, связанные с работой службы.</span><span class="sxs-lookup"><span data-stu-id="98af0-150">Other components within Azure can occasionally have service issues.</span></span> <span data-ttu-id="98af0-151">Например, обновление системы, которая используется служебной шиной, может привести к временному снижению производительности этой системы.</span><span class="sxs-lookup"><span data-stu-id="98af0-151">For example, when a system that Service Bus uses is being upgraded, that system can temporarily experience reduced capabilities.</span></span> <span data-ttu-id="98af0-152">toowork вокруг таких проблем, Service Bus регулярно исследует причины и применяет исправления.</span><span class="sxs-lookup"><span data-stu-id="98af0-152">toowork around these types of issues, Service Bus regularly investigates and implements mitigations.</span></span> <span data-ttu-id="98af0-153">Однако при применении этих способов возможны побочные эффекты.</span><span class="sxs-lookup"><span data-stu-id="98af0-153">Side effects of these mitigations do appear.</span></span> <span data-ttu-id="98af0-154">Например toohandle временной проблемы с хранилищем, Service Bus реализует систему, которая позволяет согласованно toowork операции отправки сообщения.</span><span class="sxs-lookup"><span data-stu-id="98af0-154">For example, toohandle transient issues with storage, Service Bus implements a system that allows message send operations toowork consistently.</span></span> <span data-ttu-id="98af0-155">Из-за особенностей toohello уменьшение hello отправленного сообщения может занять tooappear минут too15 в затронутых hello очереди или подписки и готовности к приему.</span><span class="sxs-lookup"><span data-stu-id="98af0-155">Due toohello nature of hello mitigation, a sent message can take up too15 minutes tooappear in hello affected queue or subscription and be ready for a receive operation.</span></span> <span data-ttu-id="98af0-156">Вообще говоря, эта проблема не затронет большинство сущностей.</span><span class="sxs-lookup"><span data-stu-id="98af0-156">Generally speaking, most entities will not experience this issue.</span></span> <span data-ttu-id="98af0-157">Тем не менее, учитывая hello число сущностей в Service Bus в Azure, это исправление иногда требуется для небольшого подмножества клиентов Service Bus.</span><span class="sxs-lookup"><span data-stu-id="98af0-157">However, given hello number of entities in Service Bus within Azure, this mitigation is sometimes needed for a small subset of Service Bus customers.</span></span>

### <a name="service-bus-failure-on-a-single-subsystem"></a><span data-ttu-id="98af0-158">Сбой служебной шины в единой подсистеме</span><span class="sxs-lookup"><span data-stu-id="98af0-158">Service Bus failure on a single subsystem</span></span>
<span data-ttu-id="98af0-159">В любом приложении определенные обстоятельства могут вызвать внутренним компонентом несогласованные toobecome Service Bus.</span><span class="sxs-lookup"><span data-stu-id="98af0-159">With any application, circumstances can cause an internal component of Service Bus toobecome inconsistent.</span></span> <span data-ttu-id="98af0-160">Когда Service Bus обнаруживает это, он собирает данные из tooaid приложения hello в диагностике причин.</span><span class="sxs-lookup"><span data-stu-id="98af0-160">When Service Bus detects this, it collects data from hello application tooaid in diagnosing what happened.</span></span> <span data-ttu-id="98af0-161">После сбора данных hello, является приложение hello перезагрузки на tooreturn попытки его tooa согласованное состояние.</span><span class="sxs-lookup"><span data-stu-id="98af0-161">Once hello data is collected, hello application is restarted in an attempt tooreturn it tooa consistent state.</span></span> <span data-ttu-id="98af0-162">Этот процесс происходит достаточно быстро, и результаты в сущность toobe недоступным для копирования tooa несколько минут на то, что обычно простоями намного короче.</span><span class="sxs-lookup"><span data-stu-id="98af0-162">This process happens fairly quickly, and results in an entity appearing toobe unavailable for up tooa few minutes, though typical down times are much shorter.</span></span>

<span data-ttu-id="98af0-163">В этих случаях клиентское приложение hello приводит к возникновению ошибки [System.TimeoutException] [ System.TimeoutException] или [MessagingException] [ MessagingException] исключение.</span><span class="sxs-lookup"><span data-stu-id="98af0-163">In these cases, hello client application generates a [System.TimeoutException][System.TimeoutException] or [MessagingException][MessagingException] exception.</span></span> <span data-ttu-id="98af0-164">Service Bus содержится исправление для этой проблемы в форме hello логику повторных попыток автоматического клиента.</span><span class="sxs-lookup"><span data-stu-id="98af0-164">Service Bus contains a mitigation for this issue in hello form of automated client retry logic.</span></span> <span data-ttu-id="98af0-165">После hello период повторения исчерпан приветственное сообщение не доставлено, можно изучить использование других компонентов, таких как [пару пространства имен][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="98af0-165">Once hello retry period is exhausted and hello message is not delivered, you can explore using other features such as [paired namespaces][paired namespaces].</span></span> <span data-ttu-id="98af0-166">С сопряженными пространствами имен связаны другие особенности, которые рассматриваются в этой статье.</span><span class="sxs-lookup"><span data-stu-id="98af0-166">Paired namespaces have other caveats that are discussed in that article.</span></span>

### <a name="failure-of-service-bus-within-an-azure-datacenter"></a><span data-ttu-id="98af0-167">Сбой служебной шины в центре обработки данных Azure</span><span class="sxs-lookup"><span data-stu-id="98af0-167">Failure of Service Bus within an Azure datacenter</span></span>
<span data-ttu-id="98af0-168">Hello наиболее вероятная причина сбоев в центре обработки данных Azure — сбой при развертывании обновления Service Bus или зависимой системы.</span><span class="sxs-lookup"><span data-stu-id="98af0-168">hello most probable reason for a failure in an Azure datacenter is a failed upgrade deployment of Service Bus or a dependent system.</span></span> <span data-ttu-id="98af0-169">Как взросления платформы hello снизилась hello вероятность сбоев данного типа.</span><span class="sxs-lookup"><span data-stu-id="98af0-169">As hello platform has matured, hello likelihood of this type of failure has diminished.</span></span> <span data-ttu-id="98af0-170">Сбой центра обработки данных также может произойти по причинам, которые включают следующие hello:</span><span class="sxs-lookup"><span data-stu-id="98af0-170">A datacenter failure can also happen for reasons that include hello following:</span></span>

* <span data-ttu-id="98af0-171">перебои с электропитанием (сбой источника питания или генераторов);</span><span class="sxs-lookup"><span data-stu-id="98af0-171">Electrical outage (power supply and generating power disappear).</span></span>
* <span data-ttu-id="98af0-172">сбой подключения (обрыв интернет-подключения между клиентами и Azure).</span><span class="sxs-lookup"><span data-stu-id="98af0-172">Connectivity (internet break between your clients and Azure).</span></span>

<span data-ttu-id="98af0-173">В обоих случаях естественная или техногенная аварийного причиной проблемы hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-173">In both cases, a natural or man-made disaster caused hello issue.</span></span> <span data-ttu-id="98af0-174">toowork этой и убедитесь в том, что вы можете отправлять сообщения, можно использовать [пару пространства имен] [ paired namespaces] tooenable сообщений отправленных toobe tooa второе расположение пока hello первичное расположение станет работоспособным.</span><span class="sxs-lookup"><span data-stu-id="98af0-174">toowork around this and make sure that you can still send messages, you can use [paired namespaces][paired namespaces] tooenable messages toobe sent tooa second location while hello primary location is made healthy again.</span></span> <span data-ttu-id="98af0-175">Дополнительные сведения см. в статье [Рекомендации по изолированию приложений от простоев и аварий служебной шины][Best practices for insulating applications against Service Bus outages and disasters].</span><span class="sxs-lookup"><span data-stu-id="98af0-175">For more information, see [Best practices for insulating applications against Service Bus outages and disasters][Best practices for insulating applications against Service Bus outages and disasters].</span></span>

## <a name="paired-namespaces"></a><span data-ttu-id="98af0-176">Сопряженные пространства имен</span><span class="sxs-lookup"><span data-stu-id="98af0-176">Paired namespaces</span></span>
<span data-ttu-id="98af0-177">Hello [пару пространства имен] [ paired namespaces] функция поддерживает сценарии, в котором сущности служебной шины или развертывания в центре обработки данных становится недоступным.</span><span class="sxs-lookup"><span data-stu-id="98af0-177">hello [paired namespaces][paired namespaces] feature supports scenarios in which a Service Bus entity or deployment within a data center becomes unavailable.</span></span> <span data-ttu-id="98af0-178">Хотя это событие возникает редко, распределенные системы по-прежнему должен быть подготовлен toohandle худшего варианта развития событий.</span><span class="sxs-lookup"><span data-stu-id="98af0-178">While this event occurs infrequently, distributed systems still must be prepared toohandle worst case scenarios.</span></span> <span data-ttu-id="98af0-179">Как правило, это связано с краткосрочными проблемами в элементах, от которых зависит служебная шина.</span><span class="sxs-lookup"><span data-stu-id="98af0-179">Typically, this event happens because some element on which Service Bus depends is experiencing a short-term issue.</span></span> <span data-ttu-id="98af0-180">toomaintain доступности приложений во время сбоя, пользователи, служебной шины можно использовать два разных пространства имен, желательно в разных центрах обработки данных, toohost своих сущностей обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="98af0-180">toomaintain application availability during an outage, Service Bus users can use two separate namespaces, preferably in separate data centers, toohost their messaging entities.</span></span> <span data-ttu-id="98af0-181">Hello остальной части этого раздела используется следующая терминология hello:</span><span class="sxs-lookup"><span data-stu-id="98af0-181">hello remainder of this section uses hello following terminology:</span></span>

* <span data-ttu-id="98af0-182">Основное пространство имен: hello пространства имен, с которым взаимодействует приложение для отправки и получения операций.</span><span class="sxs-lookup"><span data-stu-id="98af0-182">Primary namespace: hello namespace with which your application interacts, for send and receive operations.</span></span>
* <span data-ttu-id="98af0-183">Дополнительное пространство имен: hello пространства имен, который выступает в качестве резервного копирования toohello основного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="98af0-183">Secondary namespace: hello namespace that acts as a backup toohello primary namespace.</span></span> <span data-ttu-id="98af0-184">Логика приложения не взаимодействует с этим пространством имен.</span><span class="sxs-lookup"><span data-stu-id="98af0-184">Application logic does not interact with this namespace.</span></span>
* <span data-ttu-id="98af0-185">Интервал отработки отказа: hello объем времени tooaccept обычных ошибок перед приложения hello переходит от основного пространства имен hello toohello дополнительного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="98af0-185">Failover interval: hello amount of time tooaccept normal failures before hello application switches from hello primary namespace toohello secondary namespace.</span></span>

<span data-ttu-id="98af0-186">Сопряженные пространства имен поддерживают *доступность отправки*.</span><span class="sxs-lookup"><span data-stu-id="98af0-186">Paired namespaces support *send availability*.</span></span> <span data-ttu-id="98af0-187">Отправка доступности сохраняет toosend сообщений hello возможности.</span><span class="sxs-lookup"><span data-stu-id="98af0-187">Send availability preserves hello ability toosend messages.</span></span> <span data-ttu-id="98af0-188">доступность отправки toouse, приложения должны отвечать hello следующие требования:</span><span class="sxs-lookup"><span data-stu-id="98af0-188">toouse send availability, your application must meet hello following requirements:</span></span>

1. <span data-ttu-id="98af0-189">Сообщения принимаются только от основного пространства имен hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-189">Messages are only received from hello primary namespace.</span></span>
2. <span data-ttu-id="98af0-190">Сообщения, отправленные tooa заданным очереди или раздела могут приходить в неправильном порядке.</span><span class="sxs-lookup"><span data-stu-id="98af0-190">Messages sent tooa given queue or topic might arrive out of order.</span></span>
3. <span data-ttu-id="98af0-191">Сообщения в рамках сеанса могут поступать не по порядку.</span><span class="sxs-lookup"><span data-stu-id="98af0-191">Messages within a session might arrive out of order.</span></span> <span data-ttu-id="98af0-192">Такой подход не соответствует стандартному порядку работы сеансов.</span><span class="sxs-lookup"><span data-stu-id="98af0-192">This is a break from normal functionality of sessions.</span></span> <span data-ttu-id="98af0-193">Это означает, что приложение использует сеансы toologically группы сообщений.</span><span class="sxs-lookup"><span data-stu-id="98af0-193">This means that your application uses sessions toologically group messages.</span></span>
4. <span data-ttu-id="98af0-194">Состояние сеанса поддерживается только на hello основного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="98af0-194">Session state is only maintained on hello primary namespace.</span></span>
5. <span data-ttu-id="98af0-195">основная очередь Hello можно переходит в оперативный режим и начать прием сообщений, прежде чем hello дополнительная очередь доставит все сообщения в основную очередь hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-195">hello primary queue can come online and start accepting messages before hello secondary queue delivers all messages into hello primary queue.</span></span>

<span data-ttu-id="98af0-196">Hello в следующих разделах обсуждаются hello API-интерфейсы, реализация hello API-интерфейсов и пример кода показывает, используется функция hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-196">hello following sections discuss hello APIs, how hello APIs are implemented, and shows sample code that uses hello feature.</span></span> <span data-ttu-id="98af0-197">Обратите внимание, что использование этой возможности может быть сопряжено с дополнительными расходами.</span><span class="sxs-lookup"><span data-stu-id="98af0-197">Note that there are billing implications associated with this feature.</span></span>

### <a name="hello-messagingfactorypairnamespaceasync-api"></a><span data-ttu-id="98af0-198">Hello MessagingFactory.PairNamespaceAsync API</span><span class="sxs-lookup"><span data-stu-id="98af0-198">hello MessagingFactory.PairNamespaceAsync API</span></span>
<span data-ttu-id="98af0-199">сопряженные пространства имен поддерживают Hello включает hello [PairNamespaceAsync] [ PairNamespaceAsync] метод hello [Microsoft.ServiceBus.Messaging.MessagingFactory] [ Microsoft.ServiceBus.Messaging.MessagingFactory] класса:</span><span class="sxs-lookup"><span data-stu-id="98af0-199">hello paired namespaces feature includes hello [PairNamespaceAsync][PairNamespaceAsync] method on hello [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory] class:</span></span>

```csharp
public Task PairNamespaceAsync(PairedNamespaceOptions options);
```

<span data-ttu-id="98af0-200">По завершении задачи hello hello пары имен являются также готов tooact на предмет [MessageReceiver][MessageReceiver], [QueueClient] [ QueueClient], или [TopicClient] [ TopicClient] созданными hello [MessagingFactory] [ MessagingFactory] экземпляра.</span><span class="sxs-lookup"><span data-stu-id="98af0-200">When hello task completes, hello namespace pairing is also complete and ready tooact upon for any [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], or [TopicClient][TopicClient] created with hello [MessagingFactory][MessagingFactory] instance.</span></span> <span data-ttu-id="98af0-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] [ Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] — hello базовый класс для hello различных типов сопряжения, доступных с [MessagingFactory] [ MessagingFactory] объекта.</span><span class="sxs-lookup"><span data-stu-id="98af0-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] is hello base class for hello different types of pairing that are available with a [MessagingFactory][MessagingFactory] object.</span></span> <span data-ttu-id="98af0-202">В настоящее время hello только производный класс — один с именем [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], который реализует требования к доступности отправки hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-202">Currently, hello only derived class is one named [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], which implements hello send availability requirements.</span></span> <span data-ttu-id="98af0-203">Класс [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] имеет набор взаимозависимых конструкторов.</span><span class="sxs-lookup"><span data-stu-id="98af0-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] has a set of constructors that build on each other.</span></span> <span data-ttu-id="98af0-204">Глядя на конструктор hello с hello большинство параметров, можно понять поведение hello hello других конструкторов.</span><span class="sxs-lookup"><span data-stu-id="98af0-204">Looking at hello constructor with hello most parameters, you can understand hello behavior of hello other constructors.</span></span>

```csharp
public SendAvailabilityPairedNamespaceOptions(
    NamespaceManager secondaryNamespaceManager,
    MessagingFactory messagingFactory,
    int backlogQueueCount,
    TimeSpan failoverInterval,
    bool enableSyphon)
```

<span data-ttu-id="98af0-205">Эти параметры имеют следующие значения hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-205">These parameters have hello following meanings:</span></span>

* <span data-ttu-id="98af0-206">*secondaryNamespaceManager*: инициализированный [NamespaceManager] [ NamespaceManager] экземпляра для дополнительного пространства имен hello, hello [PairNamespaceAsync] [ PairNamespaceAsync] метод может использовать tooset копирование hello дополнительного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="98af0-206">*secondaryNamespaceManager*: An initialized [NamespaceManager][NamespaceManager] instance for hello secondary namespace that hello [PairNamespaceAsync][PairNamespaceAsync] method can use tooset up hello secondary namespace.</span></span> <span data-ttu-id="98af0-207">Диспетчер пространств имен Hello — список hello используется tooobtain очередей из пространства имен hello и toomake наличие необходимых hello очередей невыполненной работы.</span><span class="sxs-lookup"><span data-stu-id="98af0-207">hello namespace manager is used tooobtain hello list of queues in hello namespace and toomake sure that hello required backlog queues exist.</span></span> <span data-ttu-id="98af0-208">Если очереди отсутствуют, они будут созданы.</span><span class="sxs-lookup"><span data-stu-id="98af0-208">If those queues do not exist, they are created.</span></span> <span data-ttu-id="98af0-209">[NamespaceManager] [ NamespaceManager] требуется возможность hello toocreate маркер с hello **управление** утверждения.</span><span class="sxs-lookup"><span data-stu-id="98af0-209">[NamespaceManager][NamespaceManager] requires hello ability toocreate a token with hello **Manage** claim.</span></span>
* <span data-ttu-id="98af0-210">*messagingFactory*: hello [MessagingFactory] [ MessagingFactory] экземпляр для hello дополнительного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="98af0-210">*messagingFactory*: hello [MessagingFactory][MessagingFactory] instance for hello secondary namespace.</span></span> <span data-ttu-id="98af0-211">Hello [MessagingFactory] [ MessagingFactory] объект является используемым toosend и, если hello [EnableSyphon] [ EnableSyphon] задано слишком**true** , получать сообщения из очередей невыполненной работы hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-211">hello [MessagingFactory][MessagingFactory] object is used toosend and, if hello [EnableSyphon][EnableSyphon] property is set too**true**, receive messages from hello backlog queues.</span></span>
* <span data-ttu-id="98af0-212">*backlogQueueCount*: hello число невыполненной работы по очереди toocreate.</span><span class="sxs-lookup"><span data-stu-id="98af0-212">*backlogQueueCount*: hello number of backlog queues toocreate.</span></span> <span data-ttu-id="98af0-213">Минимальное значение — 1.</span><span class="sxs-lookup"><span data-stu-id="98af0-213">This value must be at least 1.</span></span> <span data-ttu-id="98af0-214">При отправке сообщения toohello невыполненной работы по одной из этих очередей выбирается случайным образом.</span><span class="sxs-lookup"><span data-stu-id="98af0-214">When sending messages toohello backlog, one of these queues is randomly chosen.</span></span> <span data-ttu-id="98af0-215">Только одна очередь можно когда-либо использовать, если задать значение too1 hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-215">If you set hello value too1, then only one queue can ever be used.</span></span> <span data-ttu-id="98af0-216">Если при этом hello единственной очереди возникают ошибки, hello клиента не может tootry другую очередь и может завершиться сбоем toosend сообщения.</span><span class="sxs-lookup"><span data-stu-id="98af0-216">When this happens and hello one backlog queue generates errors, hello client is not able tootry a different backlog queue and may fail toosend your message.</span></span> <span data-ttu-id="98af0-217">Рекомендуется установить это значение toosome большего значения и по умолчанию hello значение too10.</span><span class="sxs-lookup"><span data-stu-id="98af0-217">We recommend setting this value toosome larger value and default hello value too10.</span></span> <span data-ttu-id="98af0-218">Вы можете изменить этот tooa высокий или более низкого значения в зависимости от объема данных приложение отправляет за день.</span><span class="sxs-lookup"><span data-stu-id="98af0-218">You can change this tooa higher or lower value depending on how much data your application sends per day.</span></span> <span data-ttu-id="98af0-219">Каждая очередь необработанных сообщений может быть установлено too5 ГБ сообщений.</span><span class="sxs-lookup"><span data-stu-id="98af0-219">Each backlog queue can hold up too5 GB of messages.</span></span>
* <span data-ttu-id="98af0-220">*failoverInterval*: hello объем времени, в течение которого будут приниматься сбои основного пространства имен hello перед переключением отдельных сущностей через toohello дополнительного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="98af0-220">*failoverInterval*: hello amount of time during which you will accept failures on hello primary namespace before switching any single entity over toohello secondary namespace.</span></span> <span data-ttu-id="98af0-221">При отработке отказов сущности обрабатываются поочередно.</span><span class="sxs-lookup"><span data-stu-id="98af0-221">Failovers occur on an entity-by-entity basis.</span></span> <span data-ttu-id="98af0-222">Сущности в одном пространстве имен зачастую размещаются на разных узлах служебной шины.</span><span class="sxs-lookup"><span data-stu-id="98af0-222">Entities in a single namespace frequently live in different nodes within Service Bus.</span></span> <span data-ttu-id="98af0-223">Сбой в одной сущности не подразумевает сбой в другой.</span><span class="sxs-lookup"><span data-stu-id="98af0-223">A failure in one entity does not imply a failure in another.</span></span> <span data-ttu-id="98af0-224">Можно задать это значение слишком[System.DateTime.MaxValue и] [ System.TimeSpan.Zero] toofailover toohello получателей сразу после первого, не является временной ошибкой.</span><span class="sxs-lookup"><span data-stu-id="98af0-224">You can set this value too[System.TimeSpan.Zero][System.TimeSpan.Zero] toofailover toohello secondary immediately after your first, non-transient failure.</span></span> <span data-ttu-id="98af0-225">Сбои, запускающие таймер обработки отказов hello они есть [MessagingException] [ MessagingException] в какой hello [IsTransient] [ IsTransient] свойство имеет значение false, или [System.TimeoutException][System.TimeoutException].</span><span class="sxs-lookup"><span data-stu-id="98af0-225">Failures that trigger hello failover timer are any [MessagingException][MessagingException] in which hello [IsTransient][IsTransient] property is false, or a [System.TimeoutException][System.TimeoutException].</span></span> <span data-ttu-id="98af0-226">Другие исключения, таких как [UnauthorizedAccessException] [ UnauthorizedAccessException] не вызвать отработку отказа, поскольку они указывают на приветствия клиента настроен неправильно.</span><span class="sxs-lookup"><span data-stu-id="98af0-226">Other exceptions, such as [UnauthorizedAccessException][UnauthorizedAccessException] do not cause failover, because they indicate that hello client is configured incorrectly.</span></span> <span data-ttu-id="98af0-227">Объект [ServerBusyException] [ ServerBusyException] может вызвать отработку поскольку правильный шаблон hello toowait 10 секунд, отправьте сообщение hello еще раз.</span><span class="sxs-lookup"><span data-stu-id="98af0-227">A [ServerBusyException][ServerBusyException] does not cause failover because hello correct pattern is toowait 10 seconds, then send hello message again.</span></span>
* <span data-ttu-id="98af0-228">*enableSyphon*: Указывает, что данное сопряжение также должно передавать сообщения из дополнительного пространства имен hello задней toohello основного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="98af0-228">*enableSyphon*: Indicates that this particular pairing should also syphon messages from hello secondary namespace back toohello primary namespace.</span></span> <span data-ttu-id="98af0-229">В общем случае приложения, отправляющие сообщения следует установить это значение слишком**false**; приложения, которые получают сообщения, должны задать значение слишком**true**.</span><span class="sxs-lookup"><span data-stu-id="98af0-229">In general, applications that send messages should set this value too**false**; applications that receive messages should set this value too**true**.</span></span> <span data-ttu-id="98af0-230">Hello причина этого заключается в том, что часто, существует получателей сообщений меньше числа отправителей сообщений.</span><span class="sxs-lookup"><span data-stu-id="98af0-230">hello reason for this is that frequently, there are fewer message receivers than message senders.</span></span> <span data-ttu-id="98af0-231">В зависимости от числа получателей hello вы можете toohave процесс выкачивания сборов hello дескриптор экземпляра одного приложения.</span><span class="sxs-lookup"><span data-stu-id="98af0-231">Depending on hello number of receivers, you can choose toohave a single application instance handle hello syphon duties.</span></span> <span data-ttu-id="98af0-232">Увеличение количества получателей отразится на стоимости каждой очереди невыполненной работы.</span><span class="sxs-lookup"><span data-stu-id="98af0-232">Using many receivers has billing implications for each backlog queue.</span></span>

<span data-ttu-id="98af0-233">toouse Здравствуйте кода, создайте основной [MessagingFactory] [ MessagingFactory] экземпляра дополнительного [MessagingFactory] [ MessagingFactory] экземпляра получателя [NamespaceManager] [ NamespaceManager] экземпляр и [SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] экземпляра.</span><span class="sxs-lookup"><span data-stu-id="98af0-233">toouse hello code, create a primary [MessagingFactory][MessagingFactory] instance, a secondary [MessagingFactory][MessagingFactory] instance, a secondary [NamespaceManager][NamespaceManager] instance, and a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="98af0-234">Hello вызов может быть простым hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="98af0-234">hello call can be as simple as hello following:</span></span>

```csharp
SendAvailabilityPairedNamespaceOptions sendAvailabilityOptions = new SendAvailabilityPairedNamespaceOptions(secondaryNamespaceManager, secondary);
primary.PairNamespaceAsync(sendAvailabilityOptions).Wait();
```

<span data-ttu-id="98af0-235">Здравствуйте, когда задача, возвращаемая hello [PairNamespaceAsync] [ PairNamespaceAsync] метод завершения, все настроено и Готово toouse.</span><span class="sxs-lookup"><span data-stu-id="98af0-235">When hello task returned by hello [PairNamespaceAsync][PairNamespaceAsync] method completes, everything is set up and ready toouse.</span></span> <span data-ttu-id="98af0-236">Перед возвращением задачи hello возможно не завершена все необходимые для связывания справа toowork hello hello фоновой работы.</span><span class="sxs-lookup"><span data-stu-id="98af0-236">Before hello task is returned, you may not have completed all of hello background work necessary for hello pairing toowork right.</span></span> <span data-ttu-id="98af0-237">Поэтому не следует начинать отправку сообщения до возврата задачу hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-237">As a result, you should not start sending messages until hello task returns.</span></span> <span data-ttu-id="98af0-238">При возникновении каких-либо ошибок, например неправильные учетные данные или очередей невыполненной работы hello toocreate сбоя, эти исключения будут создаваться после завершения задачи hello.</span><span class="sxs-lookup"><span data-stu-id="98af0-238">If any failures occurred, such as bad credentials, or failure toocreate hello backlog queues, those exceptions will be thrown once hello task completes.</span></span> <span data-ttu-id="98af0-239">После возвращения задачу hello, убедитесь, что hello очереди были найдены или созданы, проверив hello [BacklogQueueCount] [ BacklogQueueCount] свойство вашей [SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] экземпляра.</span><span class="sxs-lookup"><span data-stu-id="98af0-239">Once hello task returns, verify that hello queues were found or created by examining hello [BacklogQueueCount][BacklogQueueCount] property on your [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="98af0-240">Для hello предшествующий код эта операция выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="98af0-240">For hello preceding code, that operation appears as follows:</span></span>

```csharp
if (sendAvailabilityOptions.BacklogQueueCount < 1)
{
    // Handle case where no queues were created.
}
```

## <a name="next-steps"></a><span data-ttu-id="98af0-241">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="98af0-241">Next steps</span></span>
<span data-ttu-id="98af0-242">Теперь, когда вы узнали основы hello асинхронный обмен сообщениями в шине обслуживания, узнать дополнительные сведения о [пару пространства имен][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="98af0-242">Now that you've learned hello basics of asynchronous messaging in Service Bus, read more details about [paired namespaces][paired namespaces].</span></span>

[ServerBusyException]: /dotnet/api/microsoft.servicebus.messaging.serverbusyexception
[System.TimeoutException]: https://msdn.microsoft.com/library/system.timeoutexception.aspx
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[Best practices for insulating applications against Service Bus outages and disasters]: service-bus-outages-disasters.md
[Microsoft.ServiceBus.Messaging.MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[MessageReceiver]: /dotnet/api/microsoft.servicebus.messaging.messagereceiver
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[NamespaceManager]: /dotnet/api/microsoft.servicebus.namespacemanager
[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[EnableSyphon]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_EnableSyphon
[System.TimeSpan.Zero]: https://msdn.microsoft.com/library/system.timespan.zero.aspx
[IsTransient]: /dotnet/api/microsoft.servicebus.messaging.messagingexception#Microsoft_ServiceBus_Messaging_MessagingException_IsTransient
[UnauthorizedAccessException]: https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx
[BacklogQueueCount]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_BacklogQueueCount
[paired namespaces]: service-bus-paired-namespaces.md
