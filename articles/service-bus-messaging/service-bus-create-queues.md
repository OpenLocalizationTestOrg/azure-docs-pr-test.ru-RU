---
title: "aaaWrite приложений, использующих очереди шины обслуживания Azure | Документы Microsoft"
description: "Как toowrite простое приложение на основе очередей, которое использует Azure Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 754d91b3-1426-405e-84b4-fd36d65b114a
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/07/2017
ms.author: sethm
ms.openlocfilehash: 93b75902a06becd6e33e05298e09f5669d0e2aef
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="create-applications-that-use-service-bus-queues"></a><span data-ttu-id="8811d-103">Создание приложений, использующих очереди служебной шины</span><span class="sxs-lookup"><span data-stu-id="8811d-103">Create applications that use Service Bus queues</span></span>
<span data-ttu-id="8811d-104">В этом разделе описываются очереди Service Bus и показано, как toowrite простое приложение с использованием очереди, которое использует Service Bus.</span><span class="sxs-lookup"><span data-stu-id="8811d-104">This topic describes Service Bus queues and shows how toowrite a simple queue-based application that uses Service Bus.</span></span>

<span data-ttu-id="8811d-105">Рассмотрим сценарий из мира розничной торговли, в котором данные о продажах из отдельных Point-of-Sale (POS) терминалы должны быть направлены tooan система управления запасами, использующий hello данных toodetermine после toobe времени пополнения запасов hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-105">Consider a scenario from hello world of retail in which sales data from individual Point-of-Sale (POS) terminals must be routed tooan inventory management system that uses hello data toodetermine when stock has toobe replenished.</span></span> <span data-ttu-id="8811d-106">Это решение использует сообщений Service Bus для взаимодействия hello hello терминалами и системой управления запасами hello, как показано в следующий рисунок hello:</span><span class="sxs-lookup"><span data-stu-id="8811d-106">This solution uses Service Bus messaging for hello communication between hello terminals and hello inventory management system, as illustrated in hello following figure:</span></span>

![Очереди служебной шины, рисунок 1](./media/service-bus-create-queues/IC657161.gif)

<span data-ttu-id="8811d-108">Каждый терминал передает данные о продажах, отправляя сообщения toohello **DataCollectionQueue**.</span><span class="sxs-lookup"><span data-stu-id="8811d-108">Each POS terminal reports its sales data by sending messages toohello **DataCollectionQueue**.</span></span> <span data-ttu-id="8811d-109">Эти сообщения остаются в этой очереди до их загрузки в систему управления запасами hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-109">These messages remain in this queue until they are retrieved by hello inventory management system.</span></span> <span data-ttu-id="8811d-110">Данный шаблон часто называется *асинхронный обмен сообщениями*, так как hello POS терминал не toowait ответа от обработки toocontinue системы управления инвентаризации hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-110">This pattern is often termed *asynchronous messaging*, because hello POS terminal does not have toowait for a reply from hello inventory management system toocontinue processing.</span></span>

## <a name="why-queuing"></a><span data-ttu-id="8811d-111">Зачем использовать очередь?</span><span class="sxs-lookup"><span data-stu-id="8811d-111">Why queuing?</span></span>
<span data-ttu-id="8811d-112">Прежде чем мы рассмотрим hello код, который является обязательным tooset в этом приложении, рассмотрите преимущества использования очереди в этом случае вместо hello POS-терминалы hello поговорим напрямую (синхронно) toohello инвентаризации системы управления.</span><span class="sxs-lookup"><span data-stu-id="8811d-112">Before we look at hello code that is required tooset up this application, consider hello advantages of using a queue in this scenario instead of having hello POS terminals talk directly (synchronously) toohello inventory management system.</span></span>

### <a name="temporal-decoupling"></a><span data-ttu-id="8811d-113">Временное разделение</span><span class="sxs-lookup"><span data-stu-id="8811d-113">Temporal decoupling</span></span>
<span data-ttu-id="8811d-114">С hello шаблоном асинхронного обмена сообщениями, производители и потребители имеют toobe через Интернет в hello то же время.</span><span class="sxs-lookup"><span data-stu-id="8811d-114">With hello asynchronous messaging pattern, producers and consumers do not have toobe online at hello same time.</span></span> <span data-ttu-id="8811d-115">Hello инфраструктуры обмена сообщениями надежно хранит сообщения, пока сторона потребителя hello не готов tooreceive их.</span><span class="sxs-lookup"><span data-stu-id="8811d-115">hello messaging infrastructure reliably stores messages until hello consuming party is ready tooreceive them.</span></span> <span data-ttu-id="8811d-116">Это означает, что компоненты hello hello распределенного приложения может быть отключен, либо добровольно; Например, для обслуживания или из-за сбоя компонента tooa, не затрагивая hello всей системы.</span><span class="sxs-lookup"><span data-stu-id="8811d-116">This means hello components of hello distributed application can be disconnected, either voluntarily; for example, for maintenance, or due tooa component crash, without affecting hello whole system.</span></span> <span data-ttu-id="8811d-117">Кроме того использование приложения hello может иметь toobe через Интернет в определенное время дня hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-117">Furthermore, hello consuming application may only have toobe online during certain times of hello day.</span></span> <span data-ttu-id="8811d-118">Например в данном сценарии розничной торговли, система управления запасами hello может иметь только toocome через Интернет после окончания рабочего дня hello hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-118">For example, in this retail scenario, hello inventory management system may only have toocome online after hello end of hello business day.</span></span>

### <a name="load-leveling"></a><span data-ttu-id="8811d-119">Выравнивание нагрузки</span><span class="sxs-lookup"><span data-stu-id="8811d-119">Load leveling</span></span>
<span data-ttu-id="8811d-120">Во многих приложениях системная нагрузка изменяется со временем, в то время как hello обработки время, необходимое для каждой единицы работы, как правило, постоянно.</span><span class="sxs-lookup"><span data-stu-id="8811d-120">In many applications system load varies over time, whereas hello processing time required for each unit of work is typically constant.</span></span> <span data-ttu-id="8811d-121">Посредничество сообщения между отправителями и получателями с означает очереди, Здравствуйте, получающее приложение (hello рабочих процессов) имеет только toobe подготовить tooservice среднее загрузить вместо пиковой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="8811d-121">Intermediating message producers and consumers with a queue means that hello consuming application (hello worker) only has toobe provisioned tooservice an average load rather than a peak load.</span></span> <span data-ttu-id="8811d-122">Hello глубины hello очереди будет расти и контракт как hello входящая нагрузка меняется.</span><span class="sxs-lookup"><span data-stu-id="8811d-122">hello depth of hello queue will grow and contract as hello incoming load varies.</span></span> <span data-ttu-id="8811d-123">Это напрямую экономит деньги с учета toohello объем нагрузки приложения hello необходимые tooservice инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="8811d-123">This directly saves money with regard toohello amount of infrastructure required tooservice hello application load.</span></span>

![Очереди служебной шины, рисунок 2](./media/service-bus-create-queues/IC657162.gif)

### <a name="load-balancing"></a><span data-ttu-id="8811d-125">Балансировка нагрузки.</span><span class="sxs-lookup"><span data-stu-id="8811d-125">Load balancing</span></span>
<span data-ttu-id="8811d-126">Повышении нагрузки hello, больше рабочих процессов могут быть добавлены tooread из рабочей очереди hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-126">As hello load increases, more worker processes can be added tooread from hello worker queue.</span></span> <span data-ttu-id="8811d-127">Каждое сообщение обрабатывается только один hello рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="8811d-127">Each message is processed by only one of hello worker processes.</span></span> <span data-ttu-id="8811d-128">Кроме того, этот основе опросов Балансировка нагрузки позволяет для оптимального использования hello рабочие компьютеры даже если hello рабочий компьютер отличается по с мощностью tooprocessing учета, как они будут опрашивать сообщения на максимальной скорости.</span><span class="sxs-lookup"><span data-stu-id="8811d-128">Furthermore, this pull-based load balancing allows for optimum usage of hello worker computers even if hello worker computers differ with regard tooprocessing power, as they will pull messages at their own maximum rate.</span></span> <span data-ttu-id="8811d-129">Данный шаблон часто называется hello конкурирующих потребителей шаблон.</span><span class="sxs-lookup"><span data-stu-id="8811d-129">This pattern is often termed hello competing consumer pattern.</span></span>

![Очереди служебной шины, рисунок 3](./media/service-bus-create-queues/IC657163.gif)

### <a name="loose-coupling"></a><span data-ttu-id="8811d-131">Слабые связи</span><span class="sxs-lookup"><span data-stu-id="8811d-131">Loose coupling</span></span>
<span data-ttu-id="8811d-132">Использование toointermediate очереди сообщений между отправителями и получателями сообщений обеспечивает свойственную ей свободную связь между компонентами hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-132">Using message queuing toointermediate between message producers and consumers provides an intrinsic loose coupling between hello components.</span></span> <span data-ttu-id="8811d-133">Так как производители и потребители не знают друг друга, потребитель можно обновить без необходимости влияет на производитель hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-133">Because producers and consumers are not aware of each other, a consumer can be upgraded without having any effect on hello producer.</span></span> <span data-ttu-id="8811d-134">Кроме того обмен сообщениями топологии hello могут изменяться без влияния на существующие конечные точки hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-134">Furthermore, hello messaging topology can evolve without affecting hello existing endpoints.</span></span> <span data-ttu-id="8811d-135">Мы обсудим это подробнее, когда будем говорить о публикациях и подписках.</span><span class="sxs-lookup"><span data-stu-id="8811d-135">We’ll discuss this more when we talk about publish/subscribe.</span></span>

## <a name="show-me-hello-code"></a><span data-ttu-id="8811d-136">Покажите мне код hello</span><span class="sxs-lookup"><span data-stu-id="8811d-136">Show me hello code</span></span>
<span data-ttu-id="8811d-137">Здравствуйте, после раздела показано, как toobuild Service Bus toouse этого приложения.</span><span class="sxs-lookup"><span data-stu-id="8811d-137">hello following section shows how toouse Service Bus toobuild this application.</span></span>

### <a name="sign-up-for-an-azure-account"></a><span data-ttu-id="8811d-138">Регистрация учетной записи Azure</span><span class="sxs-lookup"><span data-stu-id="8811d-138">Sign up for an Azure account</span></span>
<span data-ttu-id="8811d-139">Вам потребуется учетная запись Azure в работе с Service Bus toostart заказа.</span><span class="sxs-lookup"><span data-stu-id="8811d-139">You’ll need an Azure account in order toostart working with Service Bus.</span></span> <span data-ttu-id="8811d-140">Если у вас ее нет, вы можете зарегистрироваться для получения бесплатной учетной записи [здесь](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A85619ABF).</span><span class="sxs-lookup"><span data-stu-id="8811d-140">If you do not already have one, you can sign up for a free account [here](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A85619ABF).</span></span>

### <a name="create-a-namespace"></a><span data-ttu-id="8811d-141">Создание пространства имен</span><span class="sxs-lookup"><span data-stu-id="8811d-141">Create a namespace</span></span>
<span data-ttu-id="8811d-142">После получения подписки можно [создать пространство имен службы](service-bus-create-namespace-portal.md).</span><span class="sxs-lookup"><span data-stu-id="8811d-142">Once you have a subscription, you can [create a service namespace](service-bus-create-namespace-portal.md).</span></span> <span data-ttu-id="8811d-143">Каждое пространство имен выступает в качестве определяющего область действия контейнера для набора сущностей служебной шины.</span><span class="sxs-lookup"><span data-stu-id="8811d-143">Each namespace acts as a scoping container for a set of Service Bus entities.</span></span> <span data-ttu-id="8811d-144">Присвойте пространству имен имя, которое будет уникальным среди всех учетных записей служебной шины.</span><span class="sxs-lookup"><span data-stu-id="8811d-144">Give your new namespace a unique name across all Service Bus accounts.</span></span> 

### <a name="install-hello-nuget-package"></a><span data-ttu-id="8811d-145">Установка пакета NuGet hello</span><span class="sxs-lookup"><span data-stu-id="8811d-145">Install hello NuGet package</span></span>
<span data-ttu-id="8811d-146">пространство имен служебной шины toouse hello, приложение должно ссылаться hello сборки служебной шины, в частности на Microsoft.ServiceBus.dll.</span><span class="sxs-lookup"><span data-stu-id="8811d-146">toouse hello Service Bus namespace, an application must reference hello Service Bus assembly, specifically Microsoft.ServiceBus.dll.</span></span> <span data-ttu-id="8811d-147">Можно найти эту сборку как часть hello Microsoft Azure SDK и hello загрузка доступна на hello [странице загрузки пакета Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="8811d-147">You can find this assembly as part of hello Microsoft Azure SDK, and hello download is available at hello [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="8811d-148">Здравствуйте, однако [пакет шины обслуживания NuGet](https://www.nuget.org/packages/WindowsAzure.ServiceBus) является hello простым способом tooget hello API служебной шины и tooconfigure приложения со всеми hello зависимости шины обслуживания.</span><span class="sxs-lookup"><span data-stu-id="8811d-148">However, hello [Service Bus NuGet package](https://www.nuget.org/packages/WindowsAzure.ServiceBus) is hello easiest way tooget hello Service Bus API and tooconfigure your application with all of hello Service Bus dependencies.</span></span>

### <a name="create-hello-queue"></a><span data-ttu-id="8811d-149">Создать очередь hello</span><span class="sxs-lookup"><span data-stu-id="8811d-149">Create hello queue</span></span>
<span data-ttu-id="8811d-150">Операции управления для сущностей обмена сообщениями (очередей и публикации или подписки разделов) выполняются через hello Service Bus [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) класса.</span><span class="sxs-lookup"><span data-stu-id="8811d-150">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class.</span></span> <span data-ttu-id="8811d-151">Служебная шина использует модель безопасности на основе [подписанного URL-адреса](service-bus-sas.md) (SAS).</span><span class="sxs-lookup"><span data-stu-id="8811d-151">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="8811d-152">Hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider) класс представляет поставщик маркеров безопасности со встроенными методами-фабрики возвращение некоторые хорошо известные поставщики токенов.</span><span class="sxs-lookup"><span data-stu-id="8811d-152">hello [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="8811d-153">Мы будем использовать [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) учетные данные SAS метод toohold hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-153">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method toohold hello SAS credentials.</span></span> <span data-ttu-id="8811d-154">Hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) экземпляр конструируется с базовым адресом hello пространства имен Service Bus hello и поставщик маркеров hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-154">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instance is then constructed with hello base address of hello Service Bus namespace and hello token provider.</span></span>

<span data-ttu-id="8811d-155">Hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) класс предоставляет методы toocreate, перечисления и удаления сущностей обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="8811d-155">hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class provides methods toocreate, enumerate and delete messaging entities.</span></span> <span data-ttu-id="8811d-156">Здравствуйте, код, показанный здесь показано, как hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) экземпляра — hello создана и используется toocreate **DataCollectionQueue** очереди.</span><span class="sxs-lookup"><span data-stu-id="8811d-156">hello code that is shown here shows how hello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) instance is created and used toocreate hello **DataCollectionQueue** queue.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", 
                "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = 
    TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = 
    new NamespaceManager(uri, tokenProvider);
namespaceManager.CreateQueue("DataCollectionQueue");
```

<span data-ttu-id="8811d-157">Обратите внимание, что существуют перегрузки hello [CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) метода, которые включают свойства настройки toobe очереди hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-157">Note that there are overloads of hello [CreateQueue](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateQueue_System_String_) method that enable properties of hello queue toobe tuned.</span></span> <span data-ttu-id="8811d-158">Например можно задать hello значение по умолчанию срока жизни (TTL) для сообщений, отправляемых toohello очереди.</span><span class="sxs-lookup"><span data-stu-id="8811d-158">For example, you can set hello default time-to-live (TTL) value for messages sent toohello queue.</span></span>

### <a name="send-messages-toohello-queue"></a><span data-ttu-id="8811d-159">Отправка сообщений в очереди toohello</span><span class="sxs-lookup"><span data-stu-id="8811d-159">Send messages toohello queue</span></span>
<span data-ttu-id="8811d-160">Для выполнения операций над сущностями служебной шины, например для отправки и получения сообщений, приложение сначала должно создать объект [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory).</span><span class="sxs-lookup"><span data-stu-id="8811d-160">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) object.</span></span> <span data-ttu-id="8811d-161">Аналогичные toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) класса hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) из hello базового адреса пространства имен службы hello и поставщик маркеров hello создается экземпляр.</span><span class="sxs-lookup"><span data-stu-id="8811d-161">Similar toohello [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) class, hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance is created from hello base address of hello service namespace and hello token provider.</span></span>

```csharp
 BrokeredMessage bm = new BrokeredMessage(salesData);
 bm.Label = "SalesReport";
 bm.Properties["StoreName"] = "Redmond";
 bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="8811d-162">Сообщений, отправленных и полученных через служебную шину очереди являются экземплярами hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) класса.</span><span class="sxs-lookup"><span data-stu-id="8811d-162">Messages sent to, and received from Service Bus queues are instances of hello [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="8811d-163">Этот класс — это набор стандартных свойств (например, [метка](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) и [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), словаря, используемые toohold свойств приложения и тело произвольных данных приложения.</span><span class="sxs-lookup"><span data-stu-id="8811d-163">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used toohold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="8811d-164">Приложения можно задать текст hello, передав ему любой сериализуемый объект (hello следующем примере передается в **SalesData** объект, представляющий данные о продажах hello из hello POS терминала), который будет использоваться hello [ DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello объекта.</span><span class="sxs-lookup"><span data-stu-id="8811d-164">An application can set hello body by passing in any serializable object (hello following example passes in a **SalesData** object that represents hello sales data from hello POS terminal), which will use hello [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) tooserialize hello object.</span></span> <span data-ttu-id="8811d-165">Также можно предоставить объект [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx).</span><span class="sxs-lookup"><span data-stu-id="8811d-165">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

<span data-ttu-id="8811d-166">Здравствуйте, tooa toosend сообщений простым способом, указанной очереди, в нашем вариантов hello **DataCollectionQueue**, является toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) объекта непосредственно из hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) экземпляра.</span><span class="sxs-lookup"><span data-stu-id="8811d-166">hello easiest way toosend messages tooa given queue, in our case hello **DataCollectionQueue**, is toouse [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) toocreate a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance.</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionQueue");
sender.Send(bm);
```

### <a name="receiving-messages-from-hello-queue"></a><span data-ttu-id="8811d-167">Получение сообщений из очереди hello</span><span class="sxs-lookup"><span data-stu-id="8811d-167">Receiving messages from hello queue</span></span>
<span data-ttu-id="8811d-168">tooreceive сообщения из очереди hello, можно использовать [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) объект, который создается непосредственно в hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) с помощью [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="8811d-168">tooreceive messages from hello queue, you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="8811d-169">Получатели сообщений могут работать в двух различных режимах: **ReceiveAndDelete** и **PeekLock**.</span><span class="sxs-lookup"><span data-stu-id="8811d-169">Message receivers can work in two different modes: **ReceiveAndDelete** and **PeekLock**.</span></span> <span data-ttu-id="8811d-170">Hello [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) задается при создании получателя сообщения hello, как toohello параметр [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_Microsoft_ServiceBus_Messaging_ReceiveMode_) вызова.</span><span class="sxs-lookup"><span data-stu-id="8811d-170">hello [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) is set when hello message receiver is created, as a parameter toohello [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_Microsoft_ServiceBus_Messaging_ReceiveMode_) call.</span></span>

<span data-ttu-id="8811d-171">При использовании hello **ReceiveAndDelete** получать hello режиме является единовременной операцией; то есть, Service Bus, получив запрос hello, он помечает приветственное сообщение как полученное и возвращает его toohello приложения.</span><span class="sxs-lookup"><span data-stu-id="8811d-171">When using hello **ReceiveAndDelete** mode, hello receive is a single-shot operation; that is, when Service Bus receives hello request, it marks hello message as being consumed and returns it toohello application.</span></span> <span data-ttu-id="8811d-172">**ReceiveAndDelete** режим — самая простая модель hello и лучше всего подходит для сценариев, в которых hello приложение может не обрабатывать сообщение при возникновении сбоя toooccur.</span><span class="sxs-lookup"><span data-stu-id="8811d-172">**ReceiveAndDelete** mode is hello simplest model and works best for scenarios in which hello application can tolerate not processing a message if a failure were toooccur.</span></span> <span data-ttu-id="8811d-173">toounderstand это, рассмотрим сценарий, в какие неполадки потребителя hello hello получают запрос и затем ломается до его обработки.</span><span class="sxs-lookup"><span data-stu-id="8811d-173">toounderstand this, consider a scenario in which hello consumer issues hello receive request and then crashes before processing it.</span></span> <span data-ttu-id="8811d-174">Поскольку Service Bus помечен приветственное сообщение как полученное, когда перезапусков приложения hello и начинает получать сообщения снова, оно пропустит приветственное сообщение, которое было получено до сбоя hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-174">Since Service Bus marked hello message as being consumed, when hello application restarts and starts consuming messages again, it will have missed hello message that was consumed before hello crash.</span></span>

<span data-ttu-id="8811d-175">В **PeekLock** получать hello режиме становится двух шаговой операцией, поэтому его невозможно toosupport приложений, которые не удается обработать отсутствующие сообщения.</span><span class="sxs-lookup"><span data-stu-id="8811d-175">In **PeekLock** mode, hello receive becomes a two-stage operation, which makes it possible toosupport applications that cannot tolerate missing messages.</span></span> <span data-ttu-id="8811d-176">Получив запрос hello, Service Bus найдет Далее toobe сообщение hello потребляет блокирует ее с tooprevent получения его другими получателями и возвращает его toohello приложения.</span><span class="sxs-lookup"><span data-stu-id="8811d-176">When Service Bus receives hello request, it finds hello next message toobe consumed, locks it tooprevent other consumers receiving it, and then returns it toohello application.</span></span> <span data-ttu-id="8811d-177">После того, как приложение hello завершает обработку сообщения hello (или хранит его для будущей обработки), его выполнить hello второго этапа hello процесс получения путем вызова [завершить](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) на полученных приветственное сообщение.</span><span class="sxs-lookup"><span data-stu-id="8811d-177">After hello application finishes processing hello message (or stores it reliably for future processing), it completes hello second stage of hello receive process by calling [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) on hello received message.</span></span> <span data-ttu-id="8811d-178">Когда Service Bus обнаруживает hello [завершить](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) вызов, она помечает приветственное сообщение как полученное.</span><span class="sxs-lookup"><span data-stu-id="8811d-178">When Service Bus sees hello [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) call, it marks hello message as being consumed.</span></span>

<span data-ttu-id="8811d-179">Также возможны два других результата.</span><span class="sxs-lookup"><span data-stu-id="8811d-179">Two other outcomes are possible.</span></span> <span data-ttu-id="8811d-180">Во-первых, если приложение hello не может tooprocess сообщение hello для какой-либо причине, оно может вызвать [прервать](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) на полученных приветственное сообщение (вместо [завершить](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span><span class="sxs-lookup"><span data-stu-id="8811d-180">First, if hello application is unable tooprocess hello message for some reason, it can call [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) on hello received message (instead of [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete)).</span></span> <span data-ttu-id="8811d-181">Это вызывает сообщение hello toounlock служебной шины и сделать ее доступной toobe получили еще раз, либо путем Привет одному клиенту или другим конкурирующим потребителем.</span><span class="sxs-lookup"><span data-stu-id="8811d-181">This causes Service Bus toounlock hello message and make it available toobe received again, either by hello same consumer or by another completing consumer.</span></span> <span data-ttu-id="8811d-182">Во-вторых есть таймаут, связанный с блокировкой hello и, если приложение hello не может обработать сообщение hello, до времени ожидания блокировки hello истечения срока действия (например, если приложение hello терпит сбой), Service Bus Разблокируйте сообщение hello и сделать ее доступной toobe получен еще раз (фактически выполняет [прервать](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) операции по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="8811d-182">Second, there is a time-out associated with hello lock and if hello application cannot process hello message before hello lock time-out expires (for example, if hello application crashes), then Service Bus will unlock hello message and make it available toobe received again (essentially performing an [Abandon](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Abandon) operation by default).</span></span>

<span data-ttu-id="8811d-183">Обратите внимание, что если hello приложение аварийно завершает работу после обработки приветственное сообщение, но перед hello [завершить](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) запрос был выпущен, сообщение hello будет повторно доставлены toohello приложения, при перезапуске.</span><span class="sxs-lookup"><span data-stu-id="8811d-183">Note that if hello application crashes after it processes hello message but before hello [Complete](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Complete) request was issued, hello message will be redelivered toohello application when it restarts.</span></span> <span data-ttu-id="8811d-184">Оно часто называется * хотя бы один раз * обработки.</span><span class="sxs-lookup"><span data-stu-id="8811d-184">This is often termed *At Least Once * processing.</span></span> <span data-ttu-id="8811d-185">Это означает, что каждое сообщение обрабатывается хотя бы один раз, но в некоторых ситуациях hello же сообщение может доставляться.</span><span class="sxs-lookup"><span data-stu-id="8811d-185">This means that each message will be processed at least once but in certain situations hello same message may be redelivered.</span></span> <span data-ttu-id="8811d-186">Если сценарий hello не допускает обработку дубликатов, в дубликаты toodetect приложения hello требуется дополнительная логика.</span><span class="sxs-lookup"><span data-stu-id="8811d-186">If hello scenario cannot tolerate duplicate processing, then additional logic is required in hello application toodetect duplicates.</span></span> <span data-ttu-id="8811d-187">Это можно сделать на hello основе [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) свойства сообщения hello.</span><span class="sxs-lookup"><span data-stu-id="8811d-187">This can be achieved based on hello [MessageId](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) property of hello message.</span></span> <span data-ttu-id="8811d-188">значение этого свойства Hello остается неизменным для попыток доставки.</span><span class="sxs-lookup"><span data-stu-id="8811d-188">hello value of this property remains constant across delivery attempts.</span></span> <span data-ttu-id="8811d-189">Это называется обработкой *только один раз*.</span><span class="sxs-lookup"><span data-stu-id="8811d-189">This is termed *Exactly Once* processing.</span></span>

<span data-ttu-id="8811d-190">Hello код, показанный здесь получает и обрабатывает сообщения с помощью hello **PeekLock** режиме, используемом по умолчанию hello, если не [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) явно указано значение.</span><span class="sxs-lookup"><span data-stu-id="8811d-190">hello code that is shown here receives and processes a message using hello **PeekLock** mode, which is hello default if no [ReceiveMode](/dotnet/api/microsoft.servicebus.messaging.receivemode) value is explicitly provided.</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionQueue");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

### <a name="use-hello-queue-client"></a><span data-ttu-id="8811d-191">Использование клиента очереди hello</span><span class="sxs-lookup"><span data-stu-id="8811d-191">Use hello queue client</span></span>
<span data-ttu-id="8811d-192">Здравствуйте ранее в примерах этого раздела создан [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) и [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) объекты непосредственно из hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) toosend и получения сообщений из очереди hello соответственно.</span><span class="sxs-lookup"><span data-stu-id="8811d-192">hello examples earlier in this section created [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) and [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objects directly from hello [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) toosend and receive messages from hello queue, respectively.</span></span> <span data-ttu-id="8811d-193">Альтернативный подход — toouse [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) объект, который поддерживает как операций отправки и получения в дополнение toomore дополнительные функции, например сеансов.</span><span class="sxs-lookup"><span data-stu-id="8811d-193">An alternative approach is toouse a [QueueClient](/dotnet/api/microsoft.servicebus.messaging.queueclient) object, which supports both send and receive operations in addition toomore advanced features, such as sessions.</span></span>

```csharp
QueueClient queueClient = factory.CreateQueueClient("DataCollectionQueue");
queueClient.Send(bm);

BrokeredMessage message = queueClient.Receive();

try
{
    ProcessMessage(message);
    message.Complete();
}
catch (Exception e)
{
    message.Abandon();
} 
```

## <a name="next-steps"></a><span data-ttu-id="8811d-194">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="8811d-194">Next steps</span></span>
<span data-ttu-id="8811d-195">Теперь, когда вы узнали основы hello очередей, в разделе [создание приложений, использующих подписки и темы Service Bus](service-bus-create-topics-subscriptions.md) toocontinue данного обсуждения с помощью возможности публикации или подписки hello разделов Service Bus и подписки.</span><span class="sxs-lookup"><span data-stu-id="8811d-195">Now that you've learned hello basics of queues, see [Create applications that use Service Bus topics and subscriptions](service-bus-create-topics-subscriptions.md) toocontinue this discussion using hello publish/subscribe capabilities of Service Bus topics and subscriptions.</span></span>

