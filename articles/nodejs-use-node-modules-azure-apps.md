---
title: "Работа с модулями Node.js"
description: "Узнайте, как работать с модулями Node.js при использовании службы приложений или облачных служб Azure."
services: 
documentationcenter: nodejs
author: TomArcher
manager: routlaw
editor: 
ms.assetid: c0e6cd3d-932d-433e-b72d-e513e23b4eb6
ms.service: multiple
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: nodejs
ms.topic: article
ms.date: 08/17/2016
ms.author: tarcher
ms.openlocfilehash: 1418c19594f19a15402d494880514298826445df
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="using-nodejs-modules-with-azure-applications"></a><span data-ttu-id="8f312-103">Использование модулей Node.js с приложениями Azure</span><span class="sxs-lookup"><span data-stu-id="8f312-103">Using Node.js Modules with Azure applications</span></span>
<span data-ttu-id="8f312-104">Этот документ содержит указания по использованию модулей Node.js с приложениями, размещенными в Azure.</span><span class="sxs-lookup"><span data-stu-id="8f312-104">This document provides guidance on using Node.js modules with applications hosted on Azure.</span></span> <span data-ttu-id="8f312-105">В нем описывается, как обеспечить использование конкретной версии модуля приложением и как использовать собственные модули вместе с Azure.</span><span class="sxs-lookup"><span data-stu-id="8f312-105">It provides guidance on ensuring that your application uses a specific version of module as well as using native modules with Azure.</span></span>

<span data-ttu-id="8f312-106">Возможно, вы уже знакомы с использованием модулей Node.js, файлов **package.json** и **npm-shrinkwrap.json**. Ниже приводится краткая сводка по тем вопросам, которые рассматриваются в этой статье.</span><span class="sxs-lookup"><span data-stu-id="8f312-106">If you are already familiar with using Node.js modules, **package.json** and **npm-shrinkwrap.json** files, the following information provides a quick summary of what is discussed in this article:</span></span>

* <span data-ttu-id="8f312-107">Служба приложений Azure может считывать файлы **package.json** и **npm-shrinkwrap.json** и устанавливать модули на основании записей в этих файлах.</span><span class="sxs-lookup"><span data-stu-id="8f312-107">Azure App Service understands **package.json** and **npm-shrinkwrap.json** files and can install modules based on entries in these files.</span></span>

* <span data-ttu-id="8f312-108">Облачные службы Azure ожидают, что все модули должны быть установлены в среде разработки, а каталог **node\_modules** должен быть включен в пакет развертывания.</span><span class="sxs-lookup"><span data-stu-id="8f312-108">Azure Cloud Services expect all modules to be installed on the development environment, and the **node\_modules** directory to be included as part of the deployment package.</span></span> <span data-ttu-id="8f312-109">Можно включить поддержку установки модулей с помощью файлов **package.json** или **npm-shrinkwrap.json** в облачных службах, однако для такой конфигурации требуется настройка сценариев по умолчанию, используемых проектами облачных служб.</span><span class="sxs-lookup"><span data-stu-id="8f312-109">It is possible to enable support for installing modules using **package.json** or **npm-shrinkwrap.json** files on Cloud Services; however, this configuration requires customization of the default scripts used by Cloud Service projects.</span></span> <span data-ttu-id="8f312-110">Пример того, как настроить эту среду, см. в записи блога [Azure Startup task to run npm install to avoid deploying node modules](https://github.com/woloski/nodeonazure-blog/blob/master/articles/startup-task-to-run-npm-in-azure.markdown) (Задача запуска Azure для выполнения установки npm во избежание развертывания модулей узла).</span><span class="sxs-lookup"><span data-stu-id="8f312-110">For an example of how to configure this environment, see [Azure Startup task to run npm install to avoid deploying node modules](https://github.com/woloski/nodeonazure-blog/blob/master/articles/startup-task-to-run-npm-in-azure.markdown)</span></span>

> [!NOTE]
> <span data-ttu-id="8f312-111">В данной статье не рассматриваются виртуальные машины Azure, так как процедура развертывания на виртуальной машине зависит от операционной системы, размещенной в этой виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="8f312-111">Azure Virtual Machines are not discussed in this article, as the deployment experience in a VM is dependent on the operating system hosted by the Virtual Machine.</span></span>
> 
> 

## <a name="nodejs-modules"></a><span data-ttu-id="8f312-112">Модули Node.js</span><span class="sxs-lookup"><span data-stu-id="8f312-112">Node.js Modules</span></span>
<span data-ttu-id="8f312-113">Модули — это загружаемые пакеты JavaScript, предоставляющие вашему приложению определенные функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="8f312-113">Modules are loadable JavaScript packages that provide specific functionality for your application.</span></span> <span data-ttu-id="8f312-114">Модули обычно устанавливаются с помощью программы командной строки **npm**, однако некоторые из них (например, HTTP-модуль) предоставляются в составе основного пакета Node.js.</span><span class="sxs-lookup"><span data-stu-id="8f312-114">Modules are usually installed using the **npm** command-line tool, however some modules (such as the http module) are provided as part of the core Node.js package.</span></span>

<span data-ttu-id="8f312-115">Установленные модули сохраняются в каталоге **node\_modules**, находящемся в корне структуры каталогов приложения.</span><span class="sxs-lookup"><span data-stu-id="8f312-115">When modules are installed, they are stored in the **node\_modules** directory at the root of your application directory structure.</span></span> <span data-ttu-id="8f312-116">У каждого модуля в каталоге **node\_modules** есть собственный каталог **node\_modules**, который содержит все модули, от которых он зависит. Такие каталоги есть у каждого модуля в цепочке зависимостей.</span><span class="sxs-lookup"><span data-stu-id="8f312-116">Each module within the **node\_modules** directory maintains its own **node\_modules** directory that contains any modules that it depends on, and this behavior repeats for every module all the way down the dependency chain.</span></span> <span data-ttu-id="8f312-117">Эта среда позволяет каждому установленному модулю иметь собственные требования к версиям модулей, от которых он зависит, однако это может привести к слишком большому размеру структуры каталогов.</span><span class="sxs-lookup"><span data-stu-id="8f312-117">This environment allows each module installed to have its own version requirements for the modules it depends on, however it can result in quite a large directory structure.</span></span>

<span data-ttu-id="8f312-118">Когда каталог **node\_modules** развертывается в составе приложения, размер развертывания становится больше, чем при использовании файла **package.json** или **npm-shrinkwrap.json**, однако это гарантирует, что в рабочей среде используются те же версии модулей, что и в среде разработки.</span><span class="sxs-lookup"><span data-stu-id="8f312-118">Deploying the **node\_modules** directory as part of your application increases the size of the deployment when compared to using a **package.json** or **npm-shrinkwrap.json** file; however, it does guarantee that the versions of the modules used in production are the same as the modules used in development.</span></span>

### <a name="native-modules"></a><span data-ttu-id="8f312-119">Собственные модули</span><span class="sxs-lookup"><span data-stu-id="8f312-119">Native Modules</span></span>
<span data-ttu-id="8f312-120">Хотя большинство модулей представляют собой просто текстовые файлы JavaScript, некоторые модули являются двоичными образами, предназначенными для конкретной платформы.</span><span class="sxs-lookup"><span data-stu-id="8f312-120">While most modules are simply plain-text JavaScript files, some modules are platform-specific binary images.</span></span> <span data-ttu-id="8f312-121">Такие модули обычно компилируются во время установки, обычно для этого используется Python и node-gyp.</span><span class="sxs-lookup"><span data-stu-id="8f312-121">These modules are compiled at install time, usually by using Python and node-gyp.</span></span> <span data-ttu-id="8f312-122">Так как облачные службы Azure полагаются на развертывание папки **node\_modules** в составе приложения, любой собственный модуль, входящий в состав установленных модулей, должен работать в облачной службе при условии, что он был установлен и скомпилирован в системе разработки Windows.</span><span class="sxs-lookup"><span data-stu-id="8f312-122">Since Azure Cloud Services rely on the **node\_modules** folder being deployed as part of the application, any native module included as part of the installed modules should work in a cloud service as long as it was installed and compiled on a Windows development system.</span></span>

<span data-ttu-id="8f312-123">Служба приложений Azure не поддерживает все собственные модули и может сообщать об ошибках при компиляции модулей со специфическими предварительными требованиями.</span><span class="sxs-lookup"><span data-stu-id="8f312-123">Azure App Service does not support all native modules, and might fail when compiling modules with specific prerequisites.</span></span> <span data-ttu-id="8f312-124">Хотя у некоторых популярных модулей, например MongoDB, имеются дополнительные собственные зависимости, и они прекрасно работают без них, было найдено два обходных решения, подходящих почти для всех собственных модулей, доступных в настоящее время:</span><span class="sxs-lookup"><span data-stu-id="8f312-124">While some popular modules like MongoDB have optional native dependencies and work fine without them, two workarounds proved successful with almost all native modules available today:</span></span>

* <span data-ttu-id="8f312-125">Выполните **npm install** на компьютере под управлением Windows, на котором установлены все необходимые компоненты собственного модуля.</span><span class="sxs-lookup"><span data-stu-id="8f312-125">Run **npm install** on a Windows machine that has all the native module's prerequisites installed.</span></span> <span data-ttu-id="8f312-126">Затем разверните созданную папку **node\_modules** как часть приложения в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="8f312-126">Then, deploy the created **node\_modules** folder as part of the application to Azure App Service.</span></span>

  * <span data-ttu-id="8f312-127">Перед компиляцией убедитесь, что локальная установка Node.js имеет соответствующую архитектуру и версию, максимально близкую к той, которая используется в Azure (текущие значения можно проверить в среде выполнения из свойств **process.arch** и **process.version**).</span><span class="sxs-lookup"><span data-stu-id="8f312-127">Before compiling, check that your local Node.js installation has matching architecture and the version is as close as possible to the one used in Azure (the current values can be checked on runtime from properties **process.arch** and **process.version**).</span></span>

* <span data-ttu-id="8f312-128">Службу приложений Azure можно настроить для выполнения пользовательских сценариев Bash или сценариев оболочки во время развертывания, что дает возможность выполнять пользовательские команды и точно настроить способ выполнения **npm install** .</span><span class="sxs-lookup"><span data-stu-id="8f312-128">Azure App Service can be configured to execute custom bash or shell scripts during deployment, giving you the opportunity to execute custom commands and precisely configure the way **npm install** is being run.</span></span> <span data-ttu-id="8f312-129">Видео о том, как настроить такую среду, см. по этой ссылке: [Custom Web Site Deployment Scripts with Kudu] (Пользовательские сценарии развертывания веб-сайтов с использованием Kudu).</span><span class="sxs-lookup"><span data-stu-id="8f312-129">For a video showing how to configure that environment, see [Custom Website Deployment Scripts with Kudu].</span></span>

### <a name="using-a-packagejson-file"></a><span data-ttu-id="8f312-130">Использование файла package.json</span><span class="sxs-lookup"><span data-stu-id="8f312-130">Using a package.json file</span></span>
<span data-ttu-id="8f312-131">Файл **package.json** — это способ указать зависимости верхнего уровня, необходимые вашему приложению для того, чтобы платформа размещения могла установить зависимости, а не требовать от вас включить папку **node\_packages** в состав развертывания.</span><span class="sxs-lookup"><span data-stu-id="8f312-131">The **package.json** file is a way to specify the top-level dependencies your application requires so that the hosting platform can install the dependencies, rather than requiring you to include the **node\_packages** folder as part of the deployment.</span></span> <span data-ttu-id="8f312-132">После развертывания приложения используется команда **npm install**, чтобы проанализировать файл **package.json** и установить все указанные зависимости.</span><span class="sxs-lookup"><span data-stu-id="8f312-132">After the application has been deployed, the **npm install** command is used to parse the **package.json** file and install all the dependencies listed.</span></span>

<span data-ttu-id="8f312-133">Во время разработки можно использовать параметры **--save**, **--save-dev** или **--save-optional** при установке модулей, чтобы автоматически добавить запись для модуля в файл **package.json**.</span><span class="sxs-lookup"><span data-stu-id="8f312-133">During development, you can use the **--save**, **--save-dev**, or **--save-optional** parameters when installing modules to add an entry for the module to your **package.json** file automatically.</span></span> <span data-ttu-id="8f312-134">Дополнительные сведения см. в разделе с описанием [npm-install](https://docs.npmjs.com/cli/install).</span><span class="sxs-lookup"><span data-stu-id="8f312-134">For more information, see [npm-install](https://docs.npmjs.com/cli/install).</span></span>

<span data-ttu-id="8f312-135">Одна потенциальная проблема с файлом **package.json** заключается в том, что он указывает версию только для зависимостей верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="8f312-135">One potential problem with the **package.json** file is that it only specifies the version for top-level dependencies.</span></span> <span data-ttu-id="8f312-136">Каждый установленный модуль может указать или не указывать версию модулей, от которых он зависит, поэтому в результате вы можете получить иную цепочку зависимостей, чем в среде разработки.</span><span class="sxs-lookup"><span data-stu-id="8f312-136">Each module installed may or may not specify the version of the modules it depends on, and so it is possible that you may end up with a different dependency chain than the one used in development.</span></span>

> [!NOTE]
> <span data-ttu-id="8f312-137">Если при развертывании приложения в службе приложений Azure ваш файл <b>package.json</b> ссылается на собственный модуль, то может отобразиться ошибка, аналогичная той, что возникает при публикации приложения с помощью Git:</span><span class="sxs-lookup"><span data-stu-id="8f312-137">When deploying to Azure App Service, if your <b>package.json</b> file references a native module you might see an error similar to the following example when publishing the application using Git:</span></span>
> 
> <span data-ttu-id="8f312-138">npm ERR!</span><span class="sxs-lookup"><span data-stu-id="8f312-138">npm ERR!</span></span> <span data-ttu-id="8f312-139">module-name@0.6.0 install: 'node-gyp configure build'</span><span class="sxs-lookup"><span data-stu-id="8f312-139">module-name@0.6.0 install: 'node-gyp configure build'</span></span>
> 
> <span data-ttu-id="8f312-140">npm ERR!</span><span class="sxs-lookup"><span data-stu-id="8f312-140">npm ERR!</span></span> <span data-ttu-id="8f312-141">'cmd "/c" "node-gyp configure build"' failed with 1</span><span class="sxs-lookup"><span data-stu-id="8f312-141">'cmd "/c" "node-gyp configure build"' failed with 1</span></span>
> 
> 

### <a name="using-a-npm-shrinkwrapjson-file"></a><span data-ttu-id="8f312-142">Использование файла npm-shrinkwrap.json</span><span class="sxs-lookup"><span data-stu-id="8f312-142">Using a npm-shrinkwrap.json file</span></span>
<span data-ttu-id="8f312-143">Файл **npm-shrinkwrap.json** представляет собой попытку устранения ограничений управления версиями модуля для файла **package.json**.</span><span class="sxs-lookup"><span data-stu-id="8f312-143">The **npm-shrinkwrap.json** file is an attempt to address the module versioning limitations of the **package.json** file.</span></span> <span data-ttu-id="8f312-144">Хотя файл **package.json** содержит только версии модулей верхнего уровня, файл **npm-shrinkwrap.json** содержит требования к версиям для всей цепочки зависимостей модулей.</span><span class="sxs-lookup"><span data-stu-id="8f312-144">While the **package.json** file only includes versions for the top-level modules, the **npm-shrinkwrap.json** file contains the version requirements for the full module dependency chain.</span></span>

<span data-ttu-id="8f312-145">Когда приложение будет готово к перемещению в рабочую среду, можно заблокировать требования к версии и создать файл **npm-shrinkwrap.json** с помощью команды **npm shrinkwrap**.</span><span class="sxs-lookup"><span data-stu-id="8f312-145">When your application is ready for production, you can lock down version requirements and create an **npm-shrinkwrap.json** file by using the **npm shrinkwrap** command.</span></span> <span data-ttu-id="8f312-146">Эта команда будет использовать версии, установленные в папке **node\_modules**, а их запись будет производиться в файл **npm-shrinkwrap.json**.</span><span class="sxs-lookup"><span data-stu-id="8f312-146">This command will use the versions currently installed in the **node\_modules** folder, and record these versions to the **npm-shrinkwrap.json** file.</span></span> <span data-ttu-id="8f312-147">После развертывания приложения в среде внешнего размещения используется команда **npm install**, чтобы проанализировать файл **npm-shrinkwrap.json** и установить все указанные зависимости.</span><span class="sxs-lookup"><span data-stu-id="8f312-147">After the application has been deployed to the hosting environment, the **npm install** command is used to parse the **npm-shrinkwrap.json** file and install all the dependencies listed.</span></span> <span data-ttu-id="8f312-148">Дополнительные сведения см. в статье о [npm-shrinkwrap](https://docs.npmjs.com/cli/shrinkwrap).</span><span class="sxs-lookup"><span data-stu-id="8f312-148">For more information, see [npm-shrinkwrap](https://docs.npmjs.com/cli/shrinkwrap).</span></span>

> [!NOTE]
> <span data-ttu-id="8f312-149">Если при развертывании приложения в службе приложений Azure ваш файл <b>npm-shrinkwrap.json</b> ссылается на собственный модуль, то может отобразиться ошибка, аналогичная той, что возникает при публикации приложения с помощью Git:</span><span class="sxs-lookup"><span data-stu-id="8f312-149">When deploying to Azure App Service, if your <b>npm-shrinkwrap.json</b> file references a native module you might see an error similar to the following example when publishing the application using Git:</span></span>
> 
> <span data-ttu-id="8f312-150">npm ERR!</span><span class="sxs-lookup"><span data-stu-id="8f312-150">npm ERR!</span></span> <span data-ttu-id="8f312-151">module-name@0.6.0 install: 'node-gyp configure build'</span><span class="sxs-lookup"><span data-stu-id="8f312-151">module-name@0.6.0 install: 'node-gyp configure build'</span></span>
> 
> <span data-ttu-id="8f312-152">npm ERR!</span><span class="sxs-lookup"><span data-stu-id="8f312-152">npm ERR!</span></span> <span data-ttu-id="8f312-153">'cmd "/c" "node-gyp configure build"' failed with 1</span><span class="sxs-lookup"><span data-stu-id="8f312-153">'cmd "/c" "node-gyp configure build"' failed with 1</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="8f312-154">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="8f312-154">Next steps</span></span>
<span data-ttu-id="8f312-155">Теперь, когда вы научились использовать модули Node.js с Azure, узнайте, как [указать версию Node.js], [создать и развернуть веб-приложение Node.js](app-service-web/app-service-web-get-started-nodejs.md) и [использовать интерфейс командной строки Azure для Mac и Linux].</span><span class="sxs-lookup"><span data-stu-id="8f312-155">Now that you understand how to use Node.js modules with Azure, learn how to [specify the Node.js version], [build and deploy a Node.js web app](app-service-web/app-service-web-get-started-nodejs.md), and [How to use the Azure Command-Line Interface for Mac and Linux].</span></span>

<span data-ttu-id="8f312-156">Дополнительную информацию см. в [центре разработчиков Node.js](/nodejs/azure/).</span><span class="sxs-lookup"><span data-stu-id="8f312-156">For more information, see the [Node.js Developer Center](/nodejs/azure/).</span></span>

<span data-ttu-id="8f312-157">[указать версию Node.js]: nodejs-specify-node-version-azure-apps.md</span><span class="sxs-lookup"><span data-stu-id="8f312-157">[specify the Node.js version]: nodejs-specify-node-version-azure-apps.md</span></span>
<span data-ttu-id="8f312-158">[использовать интерфейс командной строки Azure для Mac и Linux]:cli-install-nodejs.md</span><span class="sxs-lookup"><span data-stu-id="8f312-158">[How to use the Azure Command-Line Interface for Mac and Linux]:cli-install-nodejs.md</span></span>
<span data-ttu-id="8f312-159">[Custom Web Site Deployment Scripts with Kudu]: https://channel9.msdn.com/Shows/Azure-Friday/Custom-Web-Site-Deployment-Scripts-with-Kudu-with-David-Ebbo</span><span class="sxs-lookup"><span data-stu-id="8f312-159">[Custom Website Deployment Scripts with Kudu]: https://channel9.msdn.com/Shows/Azure-Friday/Custom-Web-Site-Deployment-Scripts-with-Kudu-with-David-Ebbo</span></span>
