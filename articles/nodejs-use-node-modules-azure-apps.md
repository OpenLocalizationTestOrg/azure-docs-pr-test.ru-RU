---
title: "Работа с модулями Node.js"
description: "Узнайте, как работать с модулями Node.js при использовании службы приложений или облачных служб Azure."
services: 
documentationcenter: nodejs
author: TomArcher
manager: routlaw
editor: 
ms.assetid: c0e6cd3d-932d-433e-b72d-e513e23b4eb6
ms.service: multiple
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: nodejs
ms.topic: article
ms.date: 08/17/2016
ms.author: tarcher
ms.openlocfilehash: 76679ea0ff2c1e88d1923488717a245351437165
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="using-nodejs-modules-with-azure-applications"></a>Использование модулей Node.js с приложениями Azure
Этот документ содержит указания по использованию модулей Node.js с приложениями, размещенными в Azure. В нем описывается, как обеспечить использование конкретной версии модуля приложением и как использовать собственные модули вместе с Azure.

Возможно, вы уже знакомы с использованием модулей Node.js, файлов **package.json** и **npm-shrinkwrap.json**. Ниже приводится краткая сводка по тем вопросам, которые рассматриваются в этой статье.

* Служба приложений Azure может считывать файлы **package.json** и **npm-shrinkwrap.json** и устанавливать модули на основании записей в этих файлах.

* Облачные службы Azure ожидают, что все модули должны быть установлены в среде разработки, а каталог **node\_modules** должен быть включен в пакет развертывания. Можно включить поддержку установки модулей с помощью файлов **package.json** или **npm-shrinkwrap.json** в облачных службах, однако для такой конфигурации требуется настройка сценариев по умолчанию, используемых проектами облачных служб. Пример того, как настроить эту среду, см. в записи блога [Azure Startup task to run npm install to avoid deploying node modules](https://github.com/woloski/nodeonazure-blog/blob/master/articles/startup-task-to-run-npm-in-azure.markdown) (Задача запуска Azure для выполнения установки npm во избежание развертывания модулей узла).

> [!NOTE]
> В данной статье не рассматриваются виртуальные машины Azure, так как процедура развертывания на виртуальной машине зависит от операционной системы, размещенной в этой виртуальной машине.
> 
> 

## <a name="nodejs-modules"></a>Модули Node.js
Модули — это загружаемые пакеты JavaScript, предоставляющие вашему приложению определенные функциональные возможности. Модули обычно устанавливаются с помощью программы командной строки **npm**, однако некоторые из них (например, HTTP-модуль) предоставляются в составе основного пакета Node.js.

Установленные модули сохраняются в каталоге **node\_modules**, находящемся в корне структуры каталогов приложения. У каждого модуля в каталоге **node\_modules** есть собственный каталог **node\_modules**, который содержит все модули, от которых он зависит. Такие каталоги есть у каждого модуля в цепочке зависимостей. Эта среда позволяет каждому установленному модулю иметь собственные требования к версиям модулей, от которых он зависит, однако это может привести к слишком большому размеру структуры каталогов.

Когда каталог **node\_modules** развертывается в составе приложения, размер развертывания становится больше, чем при использовании файла **package.json** или **npm-shrinkwrap.json**, однако это гарантирует, что в рабочей среде используются те же версии модулей, что и в среде разработки.

### <a name="native-modules"></a>Собственные модули
Хотя большинство модулей представляют собой просто текстовые файлы JavaScript, некоторые модули являются двоичными образами, предназначенными для конкретной платформы. Такие модули обычно компилируются во время установки, обычно для этого используется Python и node-gyp. Так как облачные службы Azure полагаются на развертывание папки **node\_modules** в составе приложения, любой собственный модуль, входящий в состав установленных модулей, должен работать в облачной службе при условии, что он был установлен и скомпилирован в системе разработки Windows.

Служба приложений Azure не поддерживает все собственные модули и может сообщать об ошибках при компиляции модулей со специфическими предварительными требованиями. Хотя у некоторых популярных модулей, например MongoDB, имеются дополнительные собственные зависимости, и они прекрасно работают без них, было найдено два обходных решения, подходящих почти для всех собственных модулей, доступных в настоящее время:

* Выполните **npm install** на компьютере под управлением Windows, на котором установлены все необходимые компоненты собственного модуля. Затем разверните созданную папку **node\_modules** как часть приложения в службе приложений Azure.

  * Перед компиляцией убедитесь, что локальная установка Node.js имеет соответствующую архитектуру и версию, максимально близкую к той, которая используется в Azure (текущие значения можно проверить в среде выполнения из свойств **process.arch** и **process.version**).

* Службу приложений Azure можно настроить для выполнения пользовательских сценариев Bash или сценариев оболочки во время развертывания, что дает возможность выполнять пользовательские команды и точно настроить способ выполнения **npm install** . Видео о том, как настроить такую среду, см. по этой ссылке: [Custom Web Site Deployment Scripts with Kudu] (Пользовательские сценарии развертывания веб-сайтов с использованием Kudu).

### <a name="using-a-packagejson-file"></a>Использование файла package.json

С помощью файла **package.json** можно указать зависимости верхнего уровня, необходимые вашему приложению, чтобы платформа размещения могла установить зависимости, а не требовать от вас включить папку **node\_modules** в состав развертывания. После развертывания приложения используется команда **npm install**, чтобы проанализировать файл **package.json** и установить все указанные зависимости.

Во время разработки можно использовать параметры **--save**, **--save-dev** или **--save-optional** при установке модулей, чтобы автоматически добавить запись для модуля в файл **package.json**. Дополнительные сведения см. в разделе с описанием [npm-install](https://docs.npmjs.com/cli/install).

Одна потенциальная проблема с файлом **package.json** заключается в том, что он указывает версию только для зависимостей верхнего уровня. Каждый установленный модуль может указать или не указывать версию модулей, от которых он зависит, поэтому в результате вы можете получить иную цепочку зависимостей, чем в среде разработки.

> [!NOTE]
> Если при развертывании приложения в службе приложений Azure ваш файл <b>package.json</b> ссылается на собственный модуль, то может отобразиться ошибка, аналогичная той, что возникает при публикации приложения с помощью Git:
> 
> npm ERR! module-name@0.6.0 install: 'node-gyp configure build'
> 
> npm ERR! 'cmd "/c" "node-gyp configure build"' failed with 1
> 
> 

### <a name="using-a-npm-shrinkwrapjson-file"></a>Использование файла npm-shrinkwrap.json
Файл **npm-shrinkwrap.json** представляет собой попытку устранения ограничений управления версиями модуля для файла **package.json**. Хотя файл **package.json** содержит только версии модулей верхнего уровня, файл **npm-shrinkwrap.json** содержит требования к версиям для всей цепочки зависимостей модулей.

Когда приложение будет готово к перемещению в рабочую среду, можно заблокировать требования к версии и создать файл **npm-shrinkwrap.json** с помощью команды **npm shrinkwrap**. Эта команда будет использовать версии, установленные в папке **node\_modules**, а их запись будет производиться в файл **npm-shrinkwrap.json**. После развертывания приложения в среде внешнего размещения используется команда **npm install**, чтобы проанализировать файл **npm-shrinkwrap.json** и установить все указанные зависимости. Дополнительные сведения см. в статье о [npm-shrinkwrap](https://docs.npmjs.com/cli/shrinkwrap).

> [!NOTE]
> Если при развертывании приложения в службе приложений Azure ваш файл <b>npm-shrinkwrap.json</b> ссылается на собственный модуль, то может отобразиться ошибка, аналогичная той, что возникает при публикации приложения с помощью Git:
> 
> npm ERR! module-name@0.6.0 install: 'node-gyp configure build'
> 
> npm ERR! 'cmd "/c" "node-gyp configure build"' failed with 1
> 
> 

## <a name="next-steps"></a>Дальнейшие действия
Теперь, когда вы научились использовать модули Node.js с Azure, узнайте, как [указать версию Node.js], [создать и развернуть веб-приложение Node.js](app-service/app-service-web-get-started-nodejs.md) и [использовать интерфейс командной строки Azure для Mac и Linux].

Дополнительную информацию см. в [центре разработчиков Node.js](/nodejs/azure/).

[указать версию Node.js]: nodejs-specify-node-version-azure-apps.md
[использовать интерфейс командной строки Azure для Mac и Linux]:cli-install-nodejs.md
[Custom Web Site Deployment Scripts with Kudu]: https://channel9.msdn.com/Shows/Azure-Friday/Custom-Web-Site-Deployment-Scripts-with-Kudu-with-David-Ebbo
