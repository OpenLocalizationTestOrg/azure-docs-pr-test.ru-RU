---
title: "Настройка политики авторизации ключей содержимого с помощью портала Azure | Документация Майкрософт"
description: "Узнайте, как настроить политику авторизации для ключа содержимого."
services: media-services
documentationcenter: 
author: juliako
manager: cfowler
editor: 
ms.assetid: ee82a3fa-c34b-48f2-a108-8ba321f1691e
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/09/2017
ms.author: juliako
ms.openlocfilehash: 5a35c7255a1c30a693862589c14f6a22a1900790
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="configure-content-key-authorization-policy"></a><span data-ttu-id="f4e5e-103">Настройка политики авторизации ключа содержимого</span><span class="sxs-lookup"><span data-stu-id="f4e5e-103">Configure Content Key Authorization Policy</span></span>
[!INCLUDE [media-services-selector-content-key-auth-policy](../../includes/media-services-selector-content-key-auth-policy.md)]

## <a name="overview"></a><span data-ttu-id="f4e5e-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="f4e5e-104">Overview</span></span>
<span data-ttu-id="f4e5e-105">Службы мультимедиа Microsoft Azure позволяют защищать потоковое содержимое MPEG-DASH, Smooth Streaming и HTTP Live Streaming (HLS) с помощью стандарта AES (использующего 128-разрядные ключи шифрования) или технологии [Microsoft PlayReady DRM](https://www.microsoft.com/playready/overview/).</span><span class="sxs-lookup"><span data-stu-id="f4e5e-105">Microsoft Azure Media Services enables you to deliver MPEG-DASH, Smooth Streaming, and HTTP-Live-Streaming (HLS) streams protected with Advanced Encryption Standard (AES) (using 128-bit encryption keys) or [Microsoft PlayReady DRM](https://www.microsoft.com/playready/overview/).</span></span> <span data-ttu-id="f4e5e-106">AMS позволяет также передавать потоки MPEG DASH с шифрованием Widevine DRM.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-106">AMS also enables you to deliver DASH streams encrypted with Widevine DRM.</span></span> <span data-ttu-id="f4e5e-107">PlayReady и Widewine шифруются согласно спецификации общего шифрования (ISO/IEC 23001-7 CENC).</span><span class="sxs-lookup"><span data-stu-id="f4e5e-107">Both PlayReady and Widevine are encrypted per the Common Encryption (ISO/IEC 23001-7 CENC) specification.</span></span>

<span data-ttu-id="f4e5e-108">Кроме того, службы мультимедиа включают в себя **службы доставки ключей и лицензий** , с помощью которых клиенты могут получать ключи AES либо лицензии PlayReady или Widevine для воспроизведения зашифрованного содержимого.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-108">Media Services also provides a **Key/License Delivery Service** from which clients can obtain AES keys or PlayReady/Widevine licenses to play the encrypted content.</span></span>

<span data-ttu-id="f4e5e-109">В этой статье показано, как настроить политики авторизации ключей содержимого с помощью портала Azure.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-109">This topic shows how to use the Azure portal to configure the content key authorization policy.</span></span> <span data-ttu-id="f4e5e-110">Ключ может использоваться позже для динамического шифрования содержимого.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-110">The key can later be used to dynamically encrypt your content.</span></span> <span data-ttu-id="f4e5e-111">Обратите внимание, что сейчас поддерживается шифрование для таких форматов потоковой передачи: HLS, MPEG DASH и Smooth Streaming.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-111">Note that currently you can encrypt the following streaming formats: HLS, MPEG DASH, and Smooth Streaming.</span></span> <span data-ttu-id="f4e5e-112">Невозможно шифровать последовательно скачиваемые данные.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-112">You cannot encrypt progressive downloads.</span></span>

<span data-ttu-id="f4e5e-113">Когда проигрыватель запрашивает поток, для которого настроено динамическое шифрование, службы мультимедиа используют настроенный ключ для динамического шифрования содержимого с помощью AES или DRM.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-113">When a player requests a stream that is set to be dynamically encrypted, Media Services uses the configured key to dynamically encrypt your content using AES or DRM encryption.</span></span> <span data-ttu-id="f4e5e-114">Чтобы расшифровать поток, проигрыватель запросит ключ у службы доставки ключей.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-114">To decrypt the stream, the player will request the key from the key delivery service.</span></span> <span data-ttu-id="f4e5e-115">Чтобы определить, есть ли у пользователя право на получение ключа, служба оценивает политики авторизации, заданные для ключа.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-115">To decide whether or not the user is authorized to get the key, the service evaluates the authorization policies that you specified for the key.</span></span>

<span data-ttu-id="f4e5e-116">Если вы планируете использовать несколько ключей содержимого или хотите задать URL-адрес **службы доставки ключей или лицензий** , отличный от адреса службы доставки ключей служб мультимедиа, используйте пакет SDK для .NET или интерфейсы REST API для служб мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-116">If you plan to have multiple content keys or want to specify a **Key/License Delivery Service** URL other than the Media Services key delivery service, use Media Services .NET SDK or REST APIs.</span></span>

[<span data-ttu-id="f4e5e-117">Настройка политики авторизации ключей содержимого с помощью пакета .NET SDK служб мультимедиа</span><span class="sxs-lookup"><span data-stu-id="f4e5e-117">Configure Content Key Authorization Policy using Media Services .NET SDK</span></span>](media-services-dotnet-configure-content-key-auth-policy.md)

[<span data-ttu-id="f4e5e-118">Настройка политики авторизации ключей содержимого с помощью интерфейсов REST API служб мультимедиа</span><span class="sxs-lookup"><span data-stu-id="f4e5e-118">Configure Content Key Authorization Policy using Media Services REST API</span></span>](media-services-rest-configure-content-key-auth-policy.md)

### <a name="some-considerations-apply"></a><span data-ttu-id="f4e5e-119">Важные особенности</span><span class="sxs-lookup"><span data-stu-id="f4e5e-119">Some considerations apply:</span></span>
* <span data-ttu-id="f4e5e-120">При создании учетной записи AMS в нее добавляется конечная точка потоковой передачи **по умолчанию** в состоянии **Остановлена**.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-120">When your AMS account is created a **default** streaming endpoint is added  to your account in the **Stopped** state.</span></span> <span data-ttu-id="f4e5e-121">Чтобы начать потоковую передачу содержимого и воспользоваться динамической упаковкой и динамическим шифрованием, конечная точка потоковой передачи должна находиться в состоянии **Выполняется**.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-121">To start streaming your content and take advantage of dynamic packaging and dynamic encryption, your streaming endpoint has to be in the **Running** state.</span></span> 
* <span data-ttu-id="f4e5e-122">Ресурс должен содержать набор MP4-файлов с адаптивной скоростью или файлов Smooth Streaming с адаптивной скоростью.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-122">Your asset must contain a set of adaptive bitrate MP4s or adaptive bitrate Smooth Streaming files.</span></span> <span data-ttu-id="f4e5e-123">Дополнительные сведения см. в статье о [кодировании ресурсов](media-services-encode-asset.md).</span><span class="sxs-lookup"><span data-stu-id="f4e5e-123">For more information, see [Encode an asset](media-services-encode-asset.md).</span></span>
* <span data-ttu-id="f4e5e-124">Служба доставки ключей кэширует политику ContentKeyAuthorizationPolicy и связанные с ней объекты (параметры и ограничения политики) за 15 минут.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-124">The Key Delivery service caches ContentKeyAuthorizationPolicy and its related objects (policy options and restrictions) for 15 minutes.</span></span>  <span data-ttu-id="f4e5e-125">Если создать политику ContentKeyAuthorizationPolicy и задать для нее ограничение "по маркеру", а затем протестировать ее, то последующее обновление для использования ограничения "открытая" займет примерно 15 минут.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-125">If you create a ContentKeyAuthorizationPolicy and specify to use a “Token” restriction, then test it, and then update the policy to “Open” restriction, it will take roughly 15 minutes before the policy switches to the “Open” version of the policy.</span></span>

## <a name="how-to-configure-the-key-authorization-policy"></a><span data-ttu-id="f4e5e-126">Практическое руководство. Настройка политики авторизации ключей</span><span class="sxs-lookup"><span data-stu-id="f4e5e-126">How to: configure the key authorization policy</span></span>
<span data-ttu-id="f4e5e-127">Чтобы настроить политику авторизации ключей, выберите страницу **ЗАЩИТА СОДЕРЖИМОГО** .</span><span class="sxs-lookup"><span data-stu-id="f4e5e-127">To configure the key authorization policy, select the **CONTENT PROTECTION** page.</span></span>

<span data-ttu-id="f4e5e-128">Службы мультимедиа поддерживают несколько способов аутентификации пользователей, которые запрашивают ключи.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-128">Media Services supports multiple ways of authenticating users who make key requests.</span></span> <span data-ttu-id="f4e5e-129">В политике авторизации ключей содержимого можно задать ограничения авторизации — **открытое**, **по маркеру** или **по IP-адресу** (**IP-адрес** можно настроить, используя пакет SDK для .NET или REST).</span><span class="sxs-lookup"><span data-stu-id="f4e5e-129">The content key authorization policy can have **open**, **token**, or **IP** authorization restrictions (**IP** can be configured with REST or .NET SDK).</span></span>

### <a name="open-restriction"></a><span data-ttu-id="f4e5e-130">Ограничение открытого типа</span><span class="sxs-lookup"><span data-stu-id="f4e5e-130">Open restriction</span></span>
<span data-ttu-id="f4e5e-131">Ограничение **открытого** типа означает, что система будет доставлять ключ всем, кто его запросит.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-131">The **open** restriction means the system will deliver the key to anyone who makes a key request.</span></span> <span data-ttu-id="f4e5e-132">Это ограничение подходит для тестирования.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-132">This restriction might be useful for testing purposes.</span></span>

![OpenPolicy][open_policy]

### <a name="token-restriction"></a><span data-ttu-id="f4e5e-134">Ограничение по маркеру</span><span class="sxs-lookup"><span data-stu-id="f4e5e-134">Token restriction</span></span>
<span data-ttu-id="f4e5e-135">Чтобы выбрать политику ограничения по маркеру, нажмите кнопку **МАРКЕР** .</span><span class="sxs-lookup"><span data-stu-id="f4e5e-135">To choose the token restricted policy, press the **TOKEN** button.</span></span>

<span data-ttu-id="f4e5e-136">При ограничении **по маркеру** к политике должен прилагаться маркер, выданный **службой маркеров безопасности**.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-136">The **token** restricted policy must be accompanied by a token issued by a **Secure Token Service** (STS).</span></span> <span data-ttu-id="f4e5e-137">Службы мультимедиа поддерживают маркеры в формате **простого веб-маркера** ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) и формате **JSON Web Token** (JWT).</span><span class="sxs-lookup"><span data-stu-id="f4e5e-137">Media Services supports tokens in the **Simple Web Tokens** ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) format and **JSON Web Token** (JWT) format.</span></span> <span data-ttu-id="f4e5e-138">Дополнительные сведения см. в статье, посвященной [проверке подлинности по маркерам JWT](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="f4e5e-138">For information, see [JWT token authentication](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span>

<span data-ttu-id="f4e5e-139">Службы мультимедиа не предоставляют **службы маркеров безопасности**.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-139">Media Services does not provide **Secure Token Services**.</span></span> <span data-ttu-id="f4e5e-140">Для выдачи маркеров можно создать пользовательскую службу STS или использовать службу Microsoft Azure ACS.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-140">You can create a custom STS or leverage Microsoft Azure ACS to issue tokens.</span></span> <span data-ttu-id="f4e5e-141">Чтобы создать маркер, подписанный указанным ключом, и получить утверждения, указанные в конфигурации ограничения по маркерам, должна быть настроена служба маркеров безопасности.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-141">The STS must be configured to create a token signed with the specified key and issue claims that you specified in the token restriction configuration.</span></span> <span data-ttu-id="f4e5e-142">Служба доставки ключей служб мультимедиа возвращает клиенту ключ шифрования, если маркер является допустимым и утверждения маркера соответствуют утверждениям, настроенным для ключа содержимого.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-142">The Media Services key delivery service will return the encryption key to the client if the token is valid and the claims in the token match those configured for the content key.</span></span> <span data-ttu-id="f4e5e-143">Дополнительные сведения см. в статье об [использовании Azure ACS для выдачи маркеров](http://mingfeiy.com/acs-with-key-services).</span><span class="sxs-lookup"><span data-stu-id="f4e5e-143">For more information, see [Use Azure ACS to issue tokens](http://mingfeiy.com/acs-with-key-services).</span></span>

<span data-ttu-id="f4e5e-144">Если вы настроили политику с ограничением **МАРКЕР**, необходимо указать значения **ключа проверки**, **издателя** и **аудитории**.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-144">When configuring the **TOKEN** restricted policy, you must set values for **verification key**, **issuer** and **audience**.</span></span> <span data-ttu-id="f4e5e-145">Основной ключ проверки содержит ключ, которым подписан маркер, а издатель — это служба маркеров безопасности, которая выдает маркер.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-145">The primary verification key contains the key that the token was signed with, issuer is the secure token service that issues the token.</span></span> <span data-ttu-id="f4e5e-146">Аудитория (иногда называется областью) описывает назначение маркера или ресурс, доступ к которому обеспечивает маркер.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-146">The audience (sometimes called scope) describes the intent of the token or the resource the token authorizes access to.</span></span> <span data-ttu-id="f4e5e-147">Служба доставки ключей служб мультимедиа проверяет, соответствуют ли эти значения в маркере значениям в шаблоне.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-147">The Media Services key delivery service validates that these values in the token match the values in the template.</span></span>

### <a name="playready"></a><span data-ttu-id="f4e5e-148">PlayReady</span><span class="sxs-lookup"><span data-stu-id="f4e5e-148">PlayReady</span></span>
<span data-ttu-id="f4e5e-149">Когда защита содержимого выполняется с помощью **PlayReady**, в политике авторизации необходимо помимо прочего указать XML-строку, определяющую шаблон лицензии PlayReady.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-149">When protecting your content with **PlayReady**, one of the things you need to specify in your authorization policy is an XML string that defines the PlayReady license template.</span></span> <span data-ttu-id="f4e5e-150">По умолчанию задана следующая политика:</span><span class="sxs-lookup"><span data-stu-id="f4e5e-150">By default, the following policy is set:</span></span>

<span data-ttu-id="f4e5e-151"><PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1"> <LicenseTemplates> <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices> <ContentKey i:type="ContentEncryptionKeyFromHeader" /> <LicenseType>Nonpersistent</LicenseType> <PlayRight> <AllowPassingVideoContentToUnknownOutput>Allowed</AllowPassingVideoContentToUnknownOutput> </PlayRight> </PlayReadyLicenseTemplate> </LicenseTemplates> </PlayReadyLicenseResponseTemplate></span><span class="sxs-lookup"><span data-stu-id="f4e5e-151"><PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1"> <LicenseTemplates> <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices> <ContentKey i:type="ContentEncryptionKeyFromHeader" /> <LicenseType>Nonpersistent</LicenseType> <PlayRight> <AllowPassingVideoContentToUnknownOutput>Allowed</AllowPassingVideoContentToUnknownOutput> </PlayRight> </PlayReadyLicenseTemplate> </LicenseTemplates> </PlayReadyLicenseResponseTemplate></span></span>

<span data-ttu-id="f4e5e-152">Вы можете нажать кнопку **импорт XML-файла политики** и выбрать другой XML-файл, который соответствует XML-схеме, определенной [здесь](media-services-playready-license-template-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f4e5e-152">You can click the **import policy xml** button and provide a different XML which conforms to the  XML Schema defined [here](media-services-playready-license-template-overview.md).</span></span>

## <a name="next-step"></a><span data-ttu-id="f4e5e-153">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="f4e5e-153">Next step</span></span>
<span data-ttu-id="f4e5e-154">Просмотрите схемы обучения работе со службами мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="f4e5e-154">Review Media Services learning paths.</span></span>

[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="f4e5e-155">Отзывы</span><span class="sxs-lookup"><span data-stu-id="f4e5e-155">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[open_policy]: ./media/media-services-portal-configure-content-key-auth-policy/media-services-protect-content-with-open-restriction.png
[token_policy]: ./media/media-services-key-authorization-policy/media-services-protect-content-with-token-restriction.png

