---
title: "Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью REST | Документация Майкрософт"
description: "Узнайте, как обращаться к API служб мультимедиа Azure с помощью аутентификации Azure Active Directory, используя REST."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/17/2017
ms.author: willzhan;juliako
ms.openlocfilehash: 1c62857699fb29b3583363e1c6f2dc7874635f40
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="use-azure-ad-authentication-to-access-the-azure-media-services-api-with-rest"></a><span data-ttu-id="355e7-103">Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью REST</span><span class="sxs-lookup"><span data-stu-id="355e7-103">Use Azure AD authentication to access the Azure Media Services API with REST</span></span>

<span data-ttu-id="355e7-104">Команда разработчиков служб мультимедиа Azure реализовала поддержку аутентификации Azure Active Directory (Azure AD) для доступа к службам мультимедиа Azure.</span><span class="sxs-lookup"><span data-stu-id="355e7-104">The Azure Media Services team has released Azure Active Directory (Azure AD) authentication support for Azure Media Services access.</span></span> <span data-ttu-id="355e7-105">Она также анонсировала намерение объявить устаревшей аутентификацию на основе службы контроля доступа Azure, используемую для доступа к службам мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="355e7-105">It also announced plans to deprecate Azure Access Control service authentication for Media Services access.</span></span> <span data-ttu-id="355e7-106">Так как каждая подписка Azure и каждая учетная запись служб мультимедиа подключена к клиенту Azure AD, поддержка аутентификации Azure AD дает много преимуществ с точки зрения безопасности.</span><span class="sxs-lookup"><span data-stu-id="355e7-106">Because every Azure subscription, and every Media Services account, is attached to an Azure AD tenant, Azure AD authentication support brings many security benefits.</span></span> <span data-ttu-id="355e7-107">Дополнительные сведения об этом изменении и миграции (если вы используете пакет SDK служб мультимедиа для .NET для своего приложения) можно получить в приведенных ниже записях блога и статьях.</span><span class="sxs-lookup"><span data-stu-id="355e7-107">For details about this change and migration (if you use the Media Services .NET SDK for your app), see the following blog posts and articles:</span></span>

- <span data-ttu-id="355e7-108">[Azure Media Services announces support for Azure AD and deprecation of Access Control authentication](https://azure.microsoft.com/blog/azure%20media%20service%20aad%20auth%20and%20acs%20deprecation) (Команда разработчиков служб мультимедиа Azure анонсирует поддержку аутентификации AAD и объявление устаревшей аутентификацию ACS)</span><span class="sxs-lookup"><span data-stu-id="355e7-108">[Azure Media Services announces support for Azure AD and deprecation of Access Control authentication](https://azure.microsoft.com/blog/azure%20media%20service%20aad%20auth%20and%20acs%20deprecation)</span></span>
- <span data-ttu-id="355e7-109">[Access Azure Media Services API by using Azure AD authentication](media-services-use-aad-auth-to-access-ams-api.md) (Доступ к API служб мультимедиа Azure с помощью аутентификации Azure AD)</span><span class="sxs-lookup"><span data-stu-id="355e7-109">[Access Azure Media Services API by using Azure AD authentication](media-services-use-aad-auth-to-access-ams-api.md)</span></span>
- <span data-ttu-id="355e7-110">[Use Azure AD authentication to access Azure Media Services API by using Microsoft .NET](media-services-dotnet-get-started-with-aad.md) (Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью Microsoft .NET)</span><span class="sxs-lookup"><span data-stu-id="355e7-110">[Use Azure AD authentication to access Azure Media Services API by using Microsoft .NET](media-services-dotnet-get-started-with-aad.md)</span></span>
- [<span data-ttu-id="355e7-111">Приступая к работе с аутентификацией Azure AD с помощью портала Azure</span><span class="sxs-lookup"><span data-stu-id="355e7-111">Getting started with Azure AD authentication by using the Azure portal</span></span>](media-services-portal-get-started-with-aad.md)

<span data-ttu-id="355e7-112">Некоторым клиентам приходится разрабатывать свои решения служб мультимедиа с учетом следующих ограничений:</span><span class="sxs-lookup"><span data-stu-id="355e7-112">Some customers need to develop their Media Services solutions under the following constraints:</span></span>

*   <span data-ttu-id="355e7-113">Они используют язык программирования, отличный от Microsoft .NET или C#, или среду выполнения, отличную от Windows.</span><span class="sxs-lookup"><span data-stu-id="355e7-113">They use a programming language that is not Microsoft .NET or C#, or the runtime environment is not Windows.</span></span>
*   <span data-ttu-id="355e7-114">Библиотеки Azure AD, такие как библиотеки аутентификации Active Directory, недоступны для их языка программирования или не могут использоваться в среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="355e7-114">Azure AD libraries such as Active Directory Authentication Libraries are not available for the programming language or can't be used for their runtime environment.</span></span>

<span data-ttu-id="355e7-115">Некоторые клиенты разработали приложения с помощью REST API для аутентификации ACS и доступа к службам мультимедиа Azure.</span><span class="sxs-lookup"><span data-stu-id="355e7-115">Some customers have developed applications by using REST API for both Access Control authentication and Azure Media Services access.</span></span> <span data-ttu-id="355e7-116">Таким клиентам необходим способ использования REST API для аутентификации Azure AD и последующего доступа к службам мультимедиа Azure.</span><span class="sxs-lookup"><span data-stu-id="355e7-116">For these customers, you need a way to use only the REST API for Azure AD authentication and subsequent Azure Media Services access.</span></span> <span data-ttu-id="355e7-117">Не нужно полагаться на какую-либо из библиотек Azure AD или пакет SDK служб мультимедиа для .NET.</span><span class="sxs-lookup"><span data-stu-id="355e7-117">You need to not rely on any of the Azure AD libraries or on the Media Services .NET SDK.</span></span> <span data-ttu-id="355e7-118">В этой статье описывается решение и рассматриваются примеры кода для такого сценария.</span><span class="sxs-lookup"><span data-stu-id="355e7-118">In this article, we describe a solution and provide sample code for this scenario.</span></span> <span data-ttu-id="355e7-119">Так как весь код построен на вызовах REST API и не зависит от библиотек Azure AD или служб мультимедиа Azure, его можно легко преобразовать в код на любом другом языке программирования.</span><span class="sxs-lookup"><span data-stu-id="355e7-119">Because the code is all REST API calls, with no dependency on any Azure AD or Azure Media Services library, the code can easily be translated to any other programming language.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="355e7-120">Службы мультимедиа в настоящее время поддерживают модель аутентификации с помощью службы контроля доступа Azure.</span><span class="sxs-lookup"><span data-stu-id="355e7-120">Currently, Media Services supports the Azure Access Control services authentication model.</span></span> <span data-ttu-id="355e7-121">Тем не менее авторизация посредством службы контроля доступа будет объявлена устаревшей 1 июня 2018 года.</span><span class="sxs-lookup"><span data-stu-id="355e7-121">However, Access Control authentication will be deprecated June 1, 2018.</span></span> <span data-ttu-id="355e7-122">Мы рекомендуем как можно быстрее перейти на использование модели аутентификации Azure AD.</span><span class="sxs-lookup"><span data-stu-id="355e7-122">We recommend that you migrate to the Azure AD authentication model as soon as possible.</span></span>


## <a name="design"></a><span data-ttu-id="355e7-123">Проектирование</span><span class="sxs-lookup"><span data-stu-id="355e7-123">Design</span></span>

<span data-ttu-id="355e7-124">В этой статье мы используем следующую структуру аутентификации и авторизации.</span><span class="sxs-lookup"><span data-stu-id="355e7-124">In this article, we use the following authentication and authorization design:</span></span>

*  <span data-ttu-id="355e7-125">Протокол авторизации: OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="355e7-125">Authorization protocol: OAuth 2.0.</span></span> <span data-ttu-id="355e7-126">OAuth 2.0 — это стандарт безопасности Интернета, включающий в себя аутентификацию и авторизацию.</span><span class="sxs-lookup"><span data-stu-id="355e7-126">OAuth 2.0 is a web security standard that covers both authentication and authorization.</span></span> <span data-ttu-id="355e7-127">Он поддерживается Google, корпорацией Майкрософт, Facebook и PayPal.</span><span class="sxs-lookup"><span data-stu-id="355e7-127">It is supported by Google, Microsoft, Facebook, and PayPal.</span></span> <span data-ttu-id="355e7-128">Он был ратифицирован в октябре 2012 года.</span><span class="sxs-lookup"><span data-stu-id="355e7-128">It was ratified October 2012.</span></span> <span data-ttu-id="355e7-129">Корпорация Майкрософт твердо поддерживает OAuth 2.0 и OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="355e7-129">Microsoft firmly supports OAuth 2.0 and OpenID Connect.</span></span> <span data-ttu-id="355e7-130">Оба эти стандарта поддерживаются во множестве служб и клиентских библиотек, включая Azure Active Directory, Open Web Interface for .NET (OWIN) Katana и библиотеки Azure AD.</span><span class="sxs-lookup"><span data-stu-id="355e7-130">Both of these standards are supported in multiple services and client libraries, including Azure Active Directory, Open Web Interface for .NET (OWIN) Katana, and Azure AD libraries.</span></span>
*  <span data-ttu-id="355e7-131">Тип предоставления разрешения: предоставление учетных данных клиента.</span><span class="sxs-lookup"><span data-stu-id="355e7-131">Grant type: Client credentials grant type.</span></span> <span data-ttu-id="355e7-132">Учетные данные клиента — один из четырех типов предоставления разрешения в OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="355e7-132">Client credentials is one of the four grant types in OAuth 2.0.</span></span> <span data-ttu-id="355e7-133">Они часто используются для доступа к API Microsoft Graph для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="355e7-133">It's often used for Azure AD Microsoft Graph API access.</span></span>
*  <span data-ttu-id="355e7-134">Режим аутентификации: субъект-служба.</span><span class="sxs-lookup"><span data-stu-id="355e7-134">Authentication mode: Service principal.</span></span> <span data-ttu-id="355e7-135">К другим режимам относятся аутентификация пользователя и интерактивная аутентификация.</span><span class="sxs-lookup"><span data-stu-id="355e7-135">The other authentication mode is user or interactive authentication.</span></span>

<span data-ttu-id="355e7-136">В последовательности аутентификации и авторизации Azure AD для использования служб мультимедиа участвуют четыре приложения или службы.</span><span class="sxs-lookup"><span data-stu-id="355e7-136">A total of four applications or services are involved in the Azure AD authentication and authorization flow for using Media Services.</span></span> <span data-ttu-id="355e7-137">Эти приложения и службы, а также сама последовательность описаны в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="355e7-137">The applications and services, and the flow, are described in the following table:</span></span>

|<span data-ttu-id="355e7-138">Тип приложения</span><span class="sxs-lookup"><span data-stu-id="355e7-138">Application type</span></span> |<span data-ttu-id="355e7-139">Приложение</span><span class="sxs-lookup"><span data-stu-id="355e7-139">Application</span></span> |<span data-ttu-id="355e7-140">Поток</span><span class="sxs-lookup"><span data-stu-id="355e7-140">Flow</span></span>|
|---|---|---|
|<span data-ttu-id="355e7-141">Клиент</span><span class="sxs-lookup"><span data-stu-id="355e7-141">Client</span></span> | <span data-ttu-id="355e7-142">Приложение или решение клиента</span><span class="sxs-lookup"><span data-stu-id="355e7-142">Customer app or solution</span></span> | <span data-ttu-id="355e7-143">Это приложение (на самом деле это прокси-сервер), зарегистрированное в клиенте Azure AD, в котором размещены подписка Azure и учетная запись служб мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="355e7-143">This app (actually, its proxy) is registered in the Azure AD tenant in which the Azure subscription and the media service account reside.</span></span> <span data-ttu-id="355e7-144">Субъекту-службе зарегистрированного приложения предоставляется роль владельца или участника в службе контроля доступа (IAM) для учетной записи служб мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="355e7-144">The service principal of the registered app is then granted with Owner or Contributor role in the Access Control (IAM) of the media service account.</span></span> <span data-ttu-id="355e7-145">Имя субъекта-службы представляется посредством идентификатора клиента и секрет клиента приложения.</span><span class="sxs-lookup"><span data-stu-id="355e7-145">The service principal is represented by the app client ID and client secret.</span></span> |
|<span data-ttu-id="355e7-146">Поставщик удостоверений (IdP)</span><span class="sxs-lookup"><span data-stu-id="355e7-146">Identity Provider (IDP)</span></span> | <span data-ttu-id="355e7-147">Azure AD в качестве поставщика удостоверений</span><span class="sxs-lookup"><span data-stu-id="355e7-147">Azure AD as IDP</span></span> | <span data-ttu-id="355e7-148">При аутентификации субъекта-службы зарегистрированного приложения (посредством идентификатора клиента и секрета клиента) Azure AD выступает в роли поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="355e7-148">The registered app service principal (client ID and client secret) is authenticated by Azure AD as the IDP.</span></span> <span data-ttu-id="355e7-149">Это внутренняя аутентификация, которая выполняется неявно.</span><span class="sxs-lookup"><span data-stu-id="355e7-149">This authentication is performed internally and implicitly.</span></span> <span data-ttu-id="355e7-150">Как и в последовательности предоставления учетных данных клиента, аутентификацию проходит клиент, а не пользователь.</span><span class="sxs-lookup"><span data-stu-id="355e7-150">As in client credentials flow, the client is authenticated instead of the user.</span></span> |
|<span data-ttu-id="355e7-151">Служба токенов безопасности (STS) или сервер OAuth</span><span class="sxs-lookup"><span data-stu-id="355e7-151">Secure Token Service (STS)/OAuth server</span></span> | <span data-ttu-id="355e7-152">Azure AD в качестве службы токенов безопасности</span><span class="sxs-lookup"><span data-stu-id="355e7-152">Azure AD as STS</span></span> | <span data-ttu-id="355e7-153">После выполнения аутентификации поставщиком удостоверений (или сервером OAuth в терминологии OAuth 2.0) служба Azure AD, выступая в роли службы токенов безопасности (STS) или сервера OAuth, выпускает маркер доступа или JSON Web Token (JWT) для доступа к ресурсу среднего уровня. В нашем случае это конечная точка REST API служб мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="355e7-153">After authentication by the IDP (or OAuth Server in OAuth 2.0 terms), an access token or JSON Web Token (JWT) is issued by Azure AD as STS/OAuth Server for access to the middle-tier resource: in our case, the Media Services REST API endpoint.</span></span> |
|<span data-ttu-id="355e7-154">Ресурс</span><span class="sxs-lookup"><span data-stu-id="355e7-154">Resource</span></span> | <span data-ttu-id="355e7-155">REST API для службы мультимедиа</span><span class="sxs-lookup"><span data-stu-id="355e7-155">Media Services REST API</span></span> | <span data-ttu-id="355e7-156">Каждый вызов REST API служб мультимедиа авторизуется посредством маркера доступа, выданного Azure AD в роли службы токенов безопасности или сервера OAuth.</span><span class="sxs-lookup"><span data-stu-id="355e7-156">Every Media Services REST API call is authorized by an access token that is issued by Azure AD as STS or the OAuth server.</span></span> |

<span data-ttu-id="355e7-157">Если запустить пример кода и записать JWT или маркер доступа, то он будет иметь приведенные ниже атрибуты.</span><span class="sxs-lookup"><span data-stu-id="355e7-157">If you run the sample code and capture a JWT or an access token, the JWT has the following attributes:</span></span>

    aud: "https://rest.media.azure.net",

    iss: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/",

    iat: 1497146280,

    nbf: 1497146280,
    exp: 1497150180,

    aio: "Y2ZgYDjuy7SptPzO/muf+uRu1B+ZDQA=",

    appid: "02ed1e8e-af8b-477e-af3d-7e7219a99ac6",

    appidacr: "1",

    idp: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/",

    oid: "a938cfcc-d3de-479c-b0dd-d4ffe6f50f7c",

    sub: "a938cfcc-d3de-479c-b0dd-d4ffe6f50f7c",

    tid: "72f988bf-86f1-41af-91ab-2d7cd011db47",

<span data-ttu-id="355e7-158">Ниже приведено сопоставление между атрибутами в JWT и четырьмя приложениями или службами из предыдущей таблицы.</span><span class="sxs-lookup"><span data-stu-id="355e7-158">Here are the mappings between the attributes in the JWT and the four applications or services in the preceding table:</span></span>

|<span data-ttu-id="355e7-159">Тип приложения</span><span class="sxs-lookup"><span data-stu-id="355e7-159">Application type</span></span> |<span data-ttu-id="355e7-160">Приложение</span><span class="sxs-lookup"><span data-stu-id="355e7-160">Application</span></span> |<span data-ttu-id="355e7-161">Атрибут JWT</span><span class="sxs-lookup"><span data-stu-id="355e7-161">JWT attribute</span></span> |
|---|---|---|
|<span data-ttu-id="355e7-162">Клиент</span><span class="sxs-lookup"><span data-stu-id="355e7-162">Client</span></span> |<span data-ttu-id="355e7-163">Приложение или решение клиента</span><span class="sxs-lookup"><span data-stu-id="355e7-163">Customer app or solution</span></span> |<span data-ttu-id="355e7-164">appid: "02ed1e8e-af8b-477e-af3d-7e7219a99ac6".</span><span class="sxs-lookup"><span data-stu-id="355e7-164">appid: "02ed1e8e-af8b-477e-af3d-7e7219a99ac6".</span></span> <span data-ttu-id="355e7-165">Идентификатор клиента приложения, которое вы зарегистрируете в Azure AD в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="355e7-165">The client ID of an application you will register to Azure AD in the next section.</span></span> |
|<span data-ttu-id="355e7-166">Поставщик удостоверений (IdP)</span><span class="sxs-lookup"><span data-stu-id="355e7-166">Identity Provider (IDP)</span></span> | <span data-ttu-id="355e7-167">Azure AD в качестве поставщика удостоверений</span><span class="sxs-lookup"><span data-stu-id="355e7-167">Azure AD as IDP</span></span> |<span data-ttu-id="355e7-168">idp: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/".</span><span class="sxs-lookup"><span data-stu-id="355e7-168">idp: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/".</span></span>  <span data-ttu-id="355e7-169">GUID — это идентификатор клиента Майкрософт (microsoft.onmicrosoft.com).</span><span class="sxs-lookup"><span data-stu-id="355e7-169">The GUID is the ID of Microsoft tenant (microsoft.onmicrosoft.com).</span></span> <span data-ttu-id="355e7-170">У каждого клиента есть уникальный идентификатор.</span><span class="sxs-lookup"><span data-stu-id="355e7-170">Each tenant has its own, unique ID.</span></span> |
|<span data-ttu-id="355e7-171">Служба токенов безопасности (STS) или сервер OAuth</span><span class="sxs-lookup"><span data-stu-id="355e7-171">Secure Token Service (STS)/OAuth server</span></span> |<span data-ttu-id="355e7-172">Azure AD в качестве службы токенов безопасности</span><span class="sxs-lookup"><span data-stu-id="355e7-172">Azure AD as STS</span></span> | <span data-ttu-id="355e7-173">iss: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/".</span><span class="sxs-lookup"><span data-stu-id="355e7-173">iss: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/".</span></span> <span data-ttu-id="355e7-174">GUID — это идентификатор клиента Майкрософт (microsoft.onmicrosoft.com).</span><span class="sxs-lookup"><span data-stu-id="355e7-174">The GUID is the ID of Microsoft tenant (microsoft.onmicrosoft.com).</span></span> |
|<span data-ttu-id="355e7-175">Ресурс</span><span class="sxs-lookup"><span data-stu-id="355e7-175">Resource</span></span> | <span data-ttu-id="355e7-176">REST API для службы мультимедиа</span><span class="sxs-lookup"><span data-stu-id="355e7-176">Media Services REST API</span></span> |<span data-ttu-id="355e7-177">aud: "https://rest.media.azure.net".</span><span class="sxs-lookup"><span data-stu-id="355e7-177">aud: "https://rest.media.azure.net".</span></span> <span data-ttu-id="355e7-178">Получатель или аудитория маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="355e7-178">The recipient or audience of the access token.</span></span> |

## <a name="steps-for-setup"></a><span data-ttu-id="355e7-179">Настройка</span><span class="sxs-lookup"><span data-stu-id="355e7-179">Steps for setup</span></span>

<span data-ttu-id="355e7-180">Чтобы зарегистрировать и настроить приложение Azure AD для аутентификации Azure AD и получить маркер доступа для вызова конечной точки REST API служб мультимедиа Azure, выполните следующее.</span><span class="sxs-lookup"><span data-stu-id="355e7-180">To register and set up an Azure AD application for Azure AD authentication, and to obtain an access token for calling the Azure Media Services REST API endpoint, complete the following steps:</span></span>

1.  <span data-ttu-id="355e7-181">На [классическом портале Azure](http://go.microsoft.com/fwlink/?LinkID=213885) зарегистрируйте приложение Azure AD (например, wzmediaservice) в клиенте Azure AD (например, microsoft.onmicrosoft.com).</span><span class="sxs-lookup"><span data-stu-id="355e7-181">In the [Azure classic portal](http://go.microsoft.com/fwlink/?LinkID=213885), register an Azure AD application (for example, wzmediaservice) to the Azure AD tenant (for example, microsoft.onmicrosoft.com).</span></span> <span data-ttu-id="355e7-182">Не важно, регистрируете вы собственное приложение или веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="355e7-182">It doesn't matter whether you registered as web app or native app.</span></span> <span data-ttu-id="355e7-183">Кроме того, вы можете выбрать любой URL-адрес входа и URL-адрес ответа (например, http://wzmediaservice.com для обоих параметров).</span><span class="sxs-lookup"><span data-stu-id="355e7-183">Also, you can choose any sign-on URL and reply URL (for example, http://wzmediaservice.com for both).</span></span>
2. <span data-ttu-id="355e7-184">На [классическом портале Azure](http://go.microsoft.com/fwlink/?LinkID=213885) откройте вкладку **Конфигурация** приложения.</span><span class="sxs-lookup"><span data-stu-id="355e7-184">In the [Azure classic portal](http://go.microsoft.com/fwlink/?LinkID=213885), go to the **Configure** tab of your application.</span></span> <span data-ttu-id="355e7-185">Запишите **идентификатор клиента**.</span><span class="sxs-lookup"><span data-stu-id="355e7-185">Note the **client ID**.</span></span> <span data-ttu-id="355e7-186">После этого в разделе **Ключи** создайте **ключ клиента** (секрет клиента).</span><span class="sxs-lookup"><span data-stu-id="355e7-186">Then, under **Keys**, generate a **client key** (client secret).</span></span> 

    > [!NOTE] 
    > <span data-ttu-id="355e7-187">Запишите секрет клиента.</span><span class="sxs-lookup"><span data-stu-id="355e7-187">Take note of the client secret.</span></span> <span data-ttu-id="355e7-188">Он больше не будет отображаться.</span><span class="sxs-lookup"><span data-stu-id="355e7-188">It won't be shown again.</span></span>
    
3.  <span data-ttu-id="355e7-189">На [портале Azure](http://ms.portal.azure.com) перейдите к учетной записи служб мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="355e7-189">In the [Azure portal](http://ms.portal.azure.com), go to the Media Services account.</span></span> <span data-ttu-id="355e7-190">Выберите область **Управление доступом (IAM)**.</span><span class="sxs-lookup"><span data-stu-id="355e7-190">Select the **Access Control** (IAM) pane.</span></span> <span data-ttu-id="355e7-191">Добавьте новый элемент с ролью владельца или участника.</span><span class="sxs-lookup"><span data-stu-id="355e7-191">Add a new member that has either the Owner or the Contributor role.</span></span> <span data-ttu-id="355e7-192">Найдите для субъекта имя приложения, зарегистрированного на шаге 1 (в данном примере — wzmediaservice).</span><span class="sxs-lookup"><span data-stu-id="355e7-192">For the principal, search for the application name you registered in step 1 (in this example, wzmediaservice).</span></span>

## <a name="info-to-collect"></a><span data-ttu-id="355e7-193">Собираемые сведения</span><span class="sxs-lookup"><span data-stu-id="355e7-193">Info to collect</span></span>

<span data-ttu-id="355e7-194">Чтобы подготовить программирование REST, соберите данные приведенных точек данных для добавления в код.</span><span class="sxs-lookup"><span data-stu-id="355e7-194">To prepare REST coding, collect the following data points to include in the code:</span></span>

*   <span data-ttu-id="355e7-195">Конечная точка Azure AD в роли службы токенов безопасности: https://login.microsoftonline.com/microsoft.onmicrosoft.com/oauth2/token.</span><span class="sxs-lookup"><span data-stu-id="355e7-195">Azure AD as an STS endpoint: https://login.microsoftonline.com/microsoft.onmicrosoft.com/oauth2/token.</span></span> <span data-ttu-id="355e7-196">У этой конечной точки запрашивается маркер доступа JWT.</span><span class="sxs-lookup"><span data-stu-id="355e7-196">From this endpoint, a JWT access token is requested.</span></span> <span data-ttu-id="355e7-197">Помимо роли поставщика удостоверений служба Azure AD выступает также в роли службы токенов безопасности.</span><span class="sxs-lookup"><span data-stu-id="355e7-197">In addition to serving as an IDP, Azure AD also serves as an STS.</span></span> <span data-ttu-id="355e7-198">Azure AD выдает маркер JWT для доступа к ресурсам (маркер доступа).</span><span class="sxs-lookup"><span data-stu-id="355e7-198">Azure AD issues a JWT for resource access (an access token).</span></span> <span data-ttu-id="355e7-199">Маркер JWT содержит различные утверждения.</span><span class="sxs-lookup"><span data-stu-id="355e7-199">A JWT token has various claims.</span></span>
*   <span data-ttu-id="355e7-200">REST API служб мультимедиа Azure как ресурс или аудитория: https://rest.media.azure.net.</span><span class="sxs-lookup"><span data-stu-id="355e7-200">Azure Media Services REST API as resource or audience: https://rest.media.azure.net.</span></span>
*   <span data-ttu-id="355e7-201">Идентификатор клиента: см. шаг 2 в [инструкциях по настройке](#steps-for-setup).</span><span class="sxs-lookup"><span data-stu-id="355e7-201">Client ID: See step 2 in [Steps for setup](#steps-for-setup).</span></span>
*   <span data-ttu-id="355e7-202">Секрет клиента: см. шаг 2 в [инструкциях по настройке](#steps-for-setup).</span><span class="sxs-lookup"><span data-stu-id="355e7-202">Client secret: See step 2 in  [Steps for setup](#steps-for-setup).</span></span>
*   <span data-ttu-id="355e7-203">Ваша конечная точка API учетной записи служб мультимедиа в следующем формате:</span><span class="sxs-lookup"><span data-stu-id="355e7-203">Your Media Services account REST API endpoint in the following format:</span></span>

    <span data-ttu-id="355e7-204">https://[учетная_запись_служб_мультимедиа].restv2.[центр_обработки_данных].media.azure.net/API</span><span class="sxs-lookup"><span data-stu-id="355e7-204">https://[media_service_account_name].restv2.[data_center].media.azure.net/API</span></span> 

    <span data-ttu-id="355e7-205">Это конечная точка, к которой отправляются все вызовы REST API служб мультимедиа в вашем приложении.</span><span class="sxs-lookup"><span data-stu-id="355e7-205">This is the endpoint against which all Media Services REST API calls in your application are made.</span></span> <span data-ttu-id="355e7-206">Например, https://willzhanmswjapan.restv2.japanwest.media.azure.net/API.</span><span class="sxs-lookup"><span data-stu-id="355e7-206">For example, https://willzhanmswjapan.restv2.japanwest.media.azure.net/API.</span></span>

<span data-ttu-id="355e7-207">Затем можно будет поместить эти пять параметров в файл web.config или app.config, чтобы использовать в коде.</span><span class="sxs-lookup"><span data-stu-id="355e7-207">You can then put these five parameters in your web.config or app.config file, to use in your code.</span></span>

## <a name="sample-code"></a><span data-ttu-id="355e7-208">Пример кода</span><span class="sxs-lookup"><span data-stu-id="355e7-208">Sample code</span></span>

<span data-ttu-id="355e7-209">Пример кода доступен в разделе [Azure AD Authentication for Azure Media Services Access: Both via REST API](https://github.com/willzhan/WAMSRESTSoln) (Аутентификация Azure AD для доступа к службам мультимедиа Azure с помощью REST API).</span><span class="sxs-lookup"><span data-stu-id="355e7-209">You can find the sample code in [Azure AD Authentication for Azure Media Services Access: Both via REST API](https://github.com/willzhan/WAMSRESTSoln).</span></span>

<span data-ttu-id="355e7-210">Пример кода состоит из двух частей:</span><span class="sxs-lookup"><span data-stu-id="355e7-210">The sample code has two parts:</span></span>

*   <span data-ttu-id="355e7-211">Проект библиотеки DLL, который содержит весь код REST API для аутентификации и авторизации Azure AD.</span><span class="sxs-lookup"><span data-stu-id="355e7-211">A DLL library project that has all the REST API code for Azure AD authentication and authorization.</span></span> <span data-ttu-id="355e7-212">Он также содержит метод для выполнения вызовов REST API к конечной точке REST API служб мультимедиа с маркером доступа.</span><span class="sxs-lookup"><span data-stu-id="355e7-212">It also has a method for making REST API calls to the Media Services REST API endpoint, with the access token.</span></span>
*   <span data-ttu-id="355e7-213">Тестовый консольный клиент, который инициирует аутентификацию Azure AD и вызывает другой REST API служб мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="355e7-213">A console test client, which initiates Azure AD authentication and calls different Media Services REST API.</span></span>

<span data-ttu-id="355e7-214">Пример проекта содержит три компонента:</span><span class="sxs-lookup"><span data-stu-id="355e7-214">The sample project has three features:</span></span>

*   <span data-ttu-id="355e7-215">компонент аутентификации Azure AD посредством предоставления учетных данных клиента только с помощью REST API;</span><span class="sxs-lookup"><span data-stu-id="355e7-215">Azure AD authentications via the client credentials grant by using only the REST API.</span></span>
*   <span data-ttu-id="355e7-216">компонент доступа к службам мультимедиа Azure с помощью REST API;</span><span class="sxs-lookup"><span data-stu-id="355e7-216">Azure Media Services access by using only the REST API.</span></span>
*   <span data-ttu-id="355e7-217">компонент доступа к службе хранилища Azure только с помощью REST API (как и при создании учетной записи служб мультимедиа с помощью REST API).</span><span class="sxs-lookup"><span data-stu-id="355e7-217">Azure Storage access by using only the REST API (as used to create a Media Services account, by using REST API).</span></span>


## <a name="where-is-the-refresh-token"></a><span data-ttu-id="355e7-218">Где же маркер обновления?</span><span class="sxs-lookup"><span data-stu-id="355e7-218">Where is the refresh token?</span></span>

<span data-ttu-id="355e7-219">Некоторые читатели могут задаться вопросом: где же маркер обновления?</span><span class="sxs-lookup"><span data-stu-id="355e7-219">Some readers might ask: Where is the refresh token?</span></span> <span data-ttu-id="355e7-220">Почему здесь не используется маркер обновления?</span><span class="sxs-lookup"><span data-stu-id="355e7-220">Why not use a refresh token here?</span></span>

<span data-ttu-id="355e7-221">Маркер обновления предназначен не для обновления маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="355e7-221">The purpose of a refresh token is not to refresh an access token.</span></span> <span data-ttu-id="355e7-222">Он позволяет обойти аутентификацию пользователя или взаимодействие с ним и все равно получить действительный маркер доступа, когда срок предыдущего маркера истечет.</span><span class="sxs-lookup"><span data-stu-id="355e7-222">Instead, it is designed to bypass end-user authentication or user intervention and still get a valid access token when an earlier token expires.</span></span> <span data-ttu-id="355e7-223">Более понятным названием маркера обновления может быть что-то вроде "маркер обхода повторного входа пользователя".</span><span class="sxs-lookup"><span data-stu-id="355e7-223">A better name for a refresh token might be something like "bypass user re-sign-in token."</span></span>

<span data-ttu-id="355e7-224">При использовании последовательности предоставления авторизации OAuth 2.0 (имя пользователя и пароль, предоставляемые от имени пользователя) маркер обновления помогает продлить срок действия маркера доступа без необходимости вмешательства пользователя.</span><span class="sxs-lookup"><span data-stu-id="355e7-224">If you use the OAuth 2.0 authorization grant flow (username and password, acting on behalf of a user), a refresh token helps you get a renewed access token without requesting user intervention.</span></span> <span data-ttu-id="355e7-225">Тем не менее в последовательности предоставления учетных данных клиента OAuth 2.0, который рассматривается в этой статье, клиент действует от собственного имени.</span><span class="sxs-lookup"><span data-stu-id="355e7-225">However, for the OAuth 2.0 client credentials grant flow that we describe in this article, the client acts on its own behalf.</span></span> <span data-ttu-id="355e7-226">Никакое вмешательство пользователя не требуется, и серверу авторизации не требуется (и он не будет) выдавать вам маркер обновления.</span><span class="sxs-lookup"><span data-stu-id="355e7-226">You don't need user intervention at all, and the authorization server doesn't need to (and won't) give you a refresh token.</span></span> <span data-ttu-id="355e7-227">Если выполнить отладку метода **GetUrlEncodedJWT** то вы заметите, что ответ конечной точки выдачи маркеров содержит маркер доступа, но не маркер обновления.</span><span class="sxs-lookup"><span data-stu-id="355e7-227">If you debug the **GetUrlEncodedJWT** method, you notice that the response from the token endpoint has an access token, but no refresh token.</span></span>

## <a name="next-steps"></a><span data-ttu-id="355e7-228">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="355e7-228">Next steps</span></span>

<span data-ttu-id="355e7-229">Приступите к [передаче файлов в учетную запись](media-services-dotnet-upload-files.md).</span><span class="sxs-lookup"><span data-stu-id="355e7-229">Get started with [uploading files to your account](media-services-dotnet-upload-files.md).</span></span>
