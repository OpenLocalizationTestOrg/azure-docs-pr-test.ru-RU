---
title: "aaaUse tooaccess проверки подлинности Azure AD API служб мультимедиа Azure с REST | Документы Microsoft"
description: "Узнайте, как tooaccess API служб мультимедиа Azure с проверкой подлинности Azure Active Directory с помощью REST."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/17/2017
ms.author: willzhan;juliako
ms.openlocfilehash: 114f7bdde3a8f5fe6189d712e05b6afdc8a8787a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-azure-ad-authentication-tooaccess-hello-azure-media-services-api-with-rest"></a>Здравствуйте, tooaccess проверки подлинности Azure AD для использования API служб мультимедиа Azure с REST

разработчиков служб мультимедиа Azure Hello выпустила поддержка проверки подлинности Azure Active Directory (Azure AD) для доступа к службам мультимедиа Azure. Он также объявлены планы toodeprecate контроля доступа Azure службы проверки подлинности для доступа к службам мультимедиа. Поскольку каждая подписка Azure и каждая учетная запись служб мультимедиа, клиент вложенного tooan Azure AD, поддержка проверки подлинности Azure AD имеет много преимуществ безопасности. Подробные сведения об этом изменении и миграции (при использовании hello Media Services .NET SDK для приложения), см. ниже hello блога в блогах и статьи:

- [Azure Media Services announces support for Azure AD and deprecation of Access Control authentication](https://azure.microsoft.com/blog/azure%20media%20service%20aad%20auth%20and%20acs%20deprecation) (Команда разработчиков служб мультимедиа Azure анонсирует поддержку аутентификации AAD и объявление устаревшей аутентификацию ACS)
- [Access Azure Media Services API by using Azure AD authentication](media-services-use-aad-auth-to-access-ams-api.md) (Доступ к API служб мультимедиа Azure с помощью аутентификации Azure AD)
- [Использование проверки подлинности Azure AD tooaccess API служб мультимедиа Azure с помощью Microsoft .NET](media-services-dotnet-get-started-with-aad.md)
- [Начало работы с проверкой подлинности Azure AD с помощью hello портал Azure](media-services-portal-get-started-with-aad.md)

Некоторые клиенты должны toodevelop своих решений служб мультимедиа в hello следующие ограничения:

*   Они используют язык программирования, который не является Microsoft .NET или C#, или не hello среды выполнения Windows.
*   Библиотеки Azure AD, таких как библиотеки проверки подлинности Active Directory недоступны для языка программирования hello или не может использоваться для своей среды выполнения.

Некоторые клиенты разработали приложения с помощью REST API для аутентификации ACS и доступа к службам мультимедиа Azure. Для этих клиентов необходимо типа способом toouse только hello REST API для проверки подлинности Azure AD и доступ к последующих служб мультимедиа Azure. Требуется toonot полагаться на любую из библиотек hello Azure AD или hello Media Services .NET SDK. В этой статье описывается решение и рассматриваются примеры кода для такого сценария. Так как код hello — все вызовы REST API, не зависящий от любого Azure AD или библиотеки служб мультимедиа Azure hello кода можно легко быть переведенные tooany другому языку программирования.

> [!IMPORTANT]
> В настоящее время службы мультимедиа поддерживают модель проверки подлинности служб Azure Access Control hello. Тем не менее авторизация посредством службы контроля доступа будет объявлена устаревшей 1 июня 2018 года. Рекомендуется как можно быстрее перейти модель проверки подлинности toohello Azure AD.


## <a name="design"></a>Проектирование

В этой статье мы используем hello после проверки подлинности и авторизации разработки:

*  Протокол авторизации: OAuth 2.0. OAuth 2.0 — это стандарт безопасности Интернета, включающий в себя аутентификацию и авторизацию. Он поддерживается Google, корпорацией Майкрософт, Facebook и PayPal. Он был ратифицирован в октябре 2012 года. Корпорация Майкрософт твердо поддерживает OAuth 2.0 и OpenID Connect. Оба эти стандарта поддерживаются во множестве служб и клиентских библиотек, включая Azure Active Directory, Open Web Interface for .NET (OWIN) Katana и библиотеки Azure AD.
*  Тип предоставления разрешения: предоставление учетных данных клиента. Учетные данные клиента является одним из типов четыре grant hello в OAuth 2.0. Они часто используются для доступа к API Microsoft Graph для Azure AD.
*  Режим аутентификации: субъект-служба. Hello других используется проверка подлинности пользователя или интерактивной проверки подлинности.

Всего четыре приложения или службы, участвующих в поток проверки подлинности и авторизации hello Azure AD для использования служб мультимедиа. Hello приложений и служб и потока hello, описаны в следующей таблице hello:

|Тип приложения |Приложение |Поток|
|---|---|---|
|Клиент | Приложение или решение клиента | Это приложение (на самом деле, его прокси) регистрируется в hello клиента Azure AD, в которой hello Azure media подписки и hello находятся учетной записи службы. Hello участника-службы приложения hello зарегистрированные предоставляется с владельцем или участником роли в hello управления доступа (IAM) учетной записи службы мультимедиа hello. Hello участника-службы будет представлен hello приложения клиента идентификатор и секрет клиента. |
|Поставщик удостоверений (IdP) | Azure AD в качестве поставщика удостоверений | Hello зарегистрированного приложения субъекта-службы (идентификатор клиента и секрет клиента) проходит проверку подлинности Azure AD в качестве поставщика Удостоверений hello. Это внутренняя аутентификация, которая выполняется неявно. Как и поток клиентских учетных данных клиента hello проходит проверку подлинности вместо пользователя hello. |
|Служба токенов безопасности (STS) или сервер OAuth | Azure AD в качестве службы токенов безопасности | После проверки подлинности поставщика Удостоверений hello (или сервером OAuth в терминах OAuth 2.0), маркер доступа или JSON Web Token (JWT) выданный Azure AD в качестве сервера службы маркеров безопасности или OAuth для ресурса среднего уровня доступа toohello: в нашем случае hello конечной точки API REST служб мультимедиа. |
|Ресурс | REST API для службы мультимедиа | Каждый вызов API REST служб мультимедиа авторизован, маркер доступа, выданный Azure AD как STS или сервер OAuth hello. |

Если запустить пример кода hello и фиксации JWT и маркер доступа, hello JWT имеет hello следующие атрибуты:

    aud: "https://rest.media.azure.net",

    iss: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/",

    iat: 1497146280,

    nbf: 1497146280,
    exp: 1497150180,

    aio: "Y2ZgYDjuy7SptPzO/muf+uRu1B+ZDQA=",

    appid: "02ed1e8e-af8b-477e-af3d-7e7219a99ac6",

    appidacr: "1",

    idp: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/",

    oid: "a938cfcc-d3de-479c-b0dd-d4ffe6f50f7c",

    sub: "a938cfcc-d3de-479c-b0dd-d4ffe6f50f7c",

    tid: "72f988bf-86f1-41af-91ab-2d7cd011db47",

Ниже приведены hello сопоставления между атрибуты hello hello JWT и hello четыре приложений или служб в предшествующей таблице hello.

|Тип приложения |Приложение |Атрибут JWT |
|---|---|---|
|Клиент |Приложение или решение клиента |appid: "02ed1e8e-af8b-477e-af3d-7e7219a99ac6". Hello идентификатор клиента приложения tooAzure AD будет зарегистрирован в следующем разделе hello. |
|Поставщик удостоверений (IdP) | Azure AD в качестве поставщика удостоверений |idp: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/".  Hello GUID — идентификатор Microsoft hello клиента (microsoft.onmicrosoft.com). У каждого клиента есть уникальный идентификатор. |
|Служба токенов безопасности (STS) или сервер OAuth |Azure AD в качестве службы токенов безопасности | iss: "https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/". Hello GUID — идентификатор Microsoft hello клиента (microsoft.onmicrosoft.com). |
|Ресурс | REST API для службы мультимедиа |aud: "https://rest.media.azure.net". Hello получателя или аудитории токена доступа hello. |

## <a name="steps-for-setup"></a>Настройка

tooregister и настройка приложения Azure AD для проверки подлинности Azure AD и tooobtain маркер доступа для вызова конечной точки API REST служб мультимедиа Azure hello, полный hello, следующие шаги:

1.  В hello [классический портал Azure](http://go.microsoft.com/fwlink/?LinkID=213885), регистрация клиента toohello Azure AD (например, wzmediaservice) приложения Azure AD (например, microsoft.onmicrosoft.com). Не важно, регистрируете вы собственное приложение или веб-приложение. Кроме того, вы можете выбрать любой URL-адрес входа и URL-адрес ответа (например, http://wzmediaservice.com для обоих параметров).
2. В hello [классический портал Azure](http://go.microsoft.com/fwlink/?LinkID=213885), go toohello **Настройка** вкладку приложения. Примечание hello **идентификатор клиента**. После этого в разделе **Ключи** создайте **ключ клиента** (секрет клиента). 

    > [!NOTE] 
    > Запишите hello секрет клиента. Он больше не будет отображаться.
    
3.  В hello [портал Azure](http://ms.portal.azure.com), go toohello учетная запись служб мультимедиа. Выберите hello **управления доступом** области (IAM). Добавьте новый элемент, имеющий hello владельца или участника роли hello. Для субъекта hello найдите имя приложения hello, зарегистрированное в шаге 1 (в данном примере wzmediaservice).

## <a name="info-toocollect"></a>Сведения о toocollect

tooprepare REST кодирования, собирать следующие tooinclude точек данных в коде hello hello:

*   Конечная точка Azure AD в роли службы токенов безопасности: https://login.microsoftonline.com/microsoft.onmicrosoft.com/oauth2/token. У этой конечной точки запрашивается маркер доступа JWT. В дополнение к этому tooserving как поставщика Удостоверений Azure AD также служит в качестве STS. Azure AD выдает маркер JWT для доступа к ресурсам (маркер доступа). Маркер JWT содержит различные утверждения.
*   REST API служб мультимедиа Azure как ресурс или аудитория: https://rest.media.azure.net.
*   Идентификатор клиента: см. шаг 2 в [инструкциях по настройке](#steps-for-setup).
*   Секрет клиента: см. шаг 2 в [инструкциях по настройке](#steps-for-setup).
*   Конечной точке REST API учетной записи служб мультимедиа в кодировке hello:

    https://[учетная_запись_служб_мультимедиа].restv2.[центр_обработки_данных].media.azure.net/API 

    Это конечная точка hello, от которого все API REST служб мультимедиа в приложении вызовов. Например, https://willzhanmswjapan.restv2.japanwest.media.azure.net/API.

Затем можно поместить эти пять параметров в файле web.config или app.config, toouse в коде.

## <a name="sample-code"></a>Пример кода

Можно найти примеры кода hello в [проверки подлинности Azure AD для доступа к Azure Media Services: оба через REST API](https://github.com/willzhan/WAMSRESTSoln).

Образец кода Hello состоит из двух частей:

*   Проект библиотеки DLL, который содержит весь код hello REST API для проверки подлинности Azure AD и авторизации. Он также содержит метод для выполнения вызовов toohello API REST служб мультимедиа конечной точкой API, с маркером доступа hello.
*   Тестовый консольный клиент, который инициирует аутентификацию Azure AD и вызывает другой REST API служб мультимедиа.

Образец Hello проекта имеет три функции:

*   Azure AD подлинности по учетным данным клиента hello предоставляются с помощью только hello REST API.
*   Доступа службы мультимедиа Azure с помощью только hello REST API.
*   Azure доступ к хранилищу, используя только hello REST API (как используемых toocreate учетная запись служб мультимедиа с помощью REST API).


## <a name="where-is-hello-refresh-token"></a>Где находится hello токен обновления?

Некоторые средства чтения задаться вопросом: где hello токен обновления? Почему здесь не используется маркер обновления?

Назначение Hello токен обновления не toorefresh маркер доступа. Вместо этого он спроектированный toobypass конечным пользователем проверки подлинности или вмешательство пользователя и по-прежнему получить действительный маркер доступа после истечения срока действия маркера ранее. Более понятным названием маркера обновления может быть что-то вроде "маркер обхода повторного входа пользователя".

Если вы используете hello потока (имя пользователя и пароль, действуя от имени пользователя) предоставления авторизации OAuth 2.0, токен обновления помогает получения токена доступа продленного без вмешательства пользователя запроса. Тем не менее для hello поток, который рассматривается в этой статье предоставления учетных данных клиента OAuth 2.0, hello клиент действует от ее собственного имени. Вмешательство пользователя не требуется во всех, а сервер авторизации hello не требует слишком (и не будет) получить токен обновления. При отладке hello **GetUrlEncodedJWT** метода, вы Обратите внимание, что hello ответа от конечной точки маркера hello маркер доступа, но не токен обновления.

## <a name="next-steps"></a>Дальнейшие действия

Приступая к работе с [передача файлов учетная запись tooyour](media-services-dotnet-upload-files.md).
