---
title: "Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью REST | Документация Майкрософт"
description: "Узнайте, как обращаться к API служб мультимедиа Azure с помощью аутентификации Azure Active Directory, используя REST."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/26/2017
ms.author: willzhan;juliako;johndeu
ms.openlocfilehash: ed78d6c6d4c695b841dbfbf917cd1681adc44ee7
ms.sourcegitcommit: 9ea2edae5dbb4a104322135bef957ba6e9aeecde
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2018
---
# <a name="use-azure-ad-authentication-to-access-the-azure-media-services-api-with-rest"></a>Использование аутентификации Azure AD для доступа к API служб мультимедиа Azure с помощью REST

Процесс аутентификации Azure AD в службах мультимедиа Azure можно выполнить двумя способами.

- **Аутентификация пользователя** позволяет проверить подлинность пользователя, который использует приложение для взаимодействия с ресурсами служб мультимедиа Azure. Интерактивное приложение должно сначала запросить у пользователя учетные данные. Примером может послужить приложение консоли управления, которое используется авторизованными пользователями для мониторинга заданий кодирования или потоковой трансляции. 
- **Аутентификация субъекта-службы** позволяет проверить подлинность службы. Этот метод аутентификации обычно используют приложения, которые выполняют службы управляющей программы, службы среднего уровня или запланированные задания, например веб-приложения, приложения-функции, приложения логики, интерфейсы API или микрослужбы.

    Этого учебника показано, как использовать Azure AD **участника-службы** проверки подлинности для доступа к API AMS с REST. 

    > [!NOTE]
    > **Субъект-служба** рекомендуемые рекомендуется для большинства приложений, подключающихся к службам мультимедиа Azure. 

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Получить данные для проверки подлинности на портале Azure
> * Получить маркер доступа, с помощью почтальон
> * Тест **активы** API с помощью токена доступа


> [!IMPORTANT]
> Службы мультимедиа в настоящее время поддерживают модель аутентификации с помощью службы контроля доступа Azure. Тем не менее авторизация посредством службы контроля доступа будет объявлена устаревшей 1 июня 2018 года. Мы рекомендуем как можно быстрее перейти на использование модели аутентификации Azure AD.

## <a name="prerequisites"></a>Технические условия

- Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?ref=microsoft.com&utm_source=microsoft.com&utm_medium=docs&utm_campaign=visualstudio), прежде чем начинать работу.
- [Создать учетную запись служб мультимедиа Azure с помощью портала Azure](media-services-portal-create-account.md).
- Просмотрите [доступ к Azure API служб мультимедиа с обзор проверки подлинности AAD](media-services-use-aad-auth-to-access-ams-api.md) статьи.
- Установка [почтальон](https://www.getpostman.com/) клиент REST для выполнения API-интерфейсов REST, приведенными в этой статье. 

    В этом учебнике мы являются чение **почтальон** , но подойдет любое средство REST. Существуют другие варианты: **кода Visual Studio** с подключаемый модуль REST или **Telerik Fiddler**. 

## <a name="get-the-authentication-information-from-the-azure-portal"></a>Получить данные для проверки подлинности на портале Azure

### <a name="overview"></a>Обзор

Для доступа к API служб мультимедиа, которые необходимо собрать следующие точки данных.

|Параметр|Пример|ОПИСАНИЕ|
|---|-------|-----|
|Домен клиента Azure Active Directory|Microsoft.onmicrosoft.com|Azure AD в качестве конечной точки службы токенов безопасности (STS) создается в следующем формате: https://login.microsoftonline.com/ {your-aad-tenant-name.onmicrosoft.com}/oauth2/token. Azure AD выдает маркер JWT для доступа к ресурсам (маркер доступа).|
|Конечная точка REST API|https://amshelloworld.restv2.westus.Media.Azure.NET/API/|Это конечная точка, к которой отправляются все вызовы REST API служб мультимедиа в вашем приложении.|
|Идентификатор клиента (идентификатор приложения)|f7fbbb29-a02d-4d91-bbc6-59a2579259d2|Azure AD (клиент) кода. Идентификатор клиента должен получить маркер доступа. |
|Секрет клиента|+ mUERiNzVMoJGggD6aV1etzFGa1n6KeSlLjIq + Dbim0 =|Azure ключи приложения AD (секретный). Секрет клиента должен получить маркер доступа.|

### <a name="get-aad-auth-info-from-the-azure-portal"></a>Получение сведений о проверке подлинности AAD на портале Azure

Для получения сведений, выполните следующие действия.

1. Войдите на [портал Azure](http://portal.azure.com).
2. Перейдите к экземпляру AMS.
3. Выберите **доступ к API**.
4. Щелкните **подключиться к API служб мультимедиа Azure с субъектом-службой**.

    ![Доступ через API](./media/connect-with-rest/connect-with-rest01.png)

5. Выберите существующую **приложения Azure AD** или создайте новую (см. ниже).

    > [!NOTE]
    > Для успешного выполнения запроса REST мультимедиа Azure, вызывающий пользователь должен иметь **участника** или **владельца** роли пытается получить доступ к учетной записи Media Services. Если возникнет исключение, сообщающее «удаленный сервер вернул ошибку: проверки подлинности (401),». в разделе [управления доступом к](media-services-use-aad-auth-to-access-ams-api.md#access-control).

    Если необходимо создать новое приложение AD, выполните следующие действия.
    
    1. Нажмите клавишу **создавать новые**.
    2. Введите имя.
    3. Нажмите клавишу **создать новый** еще раз.
    4. Нажмите кнопку **Save**(Сохранить).

    ![Доступ через API](./media/connect-with-rest/new-app.png)

    Новое приложение отображается на странице.

6. Получить **идентификатор клиента** (идентификатор приложения).
    
    1. Выберите приложение.
    2. Получить **идентификатор клиента** из окна справа. 

    ![Доступ через API](./media/connect-with-rest/existing-client-id.png).

7.  Получить приложения **ключ** (секретный). 

    1. Нажмите кнопку **управления приложением** кнопки (Обратите внимание, что идентификатор клиента сведения в разделе **идентификатор приложения**). 
    2. Нажмите клавишу **ключей**.
    
        ![Доступ через API](./media/connect-with-rest/manage-app.png)
    3. Создать ключ приложения (секретный), заполнив **описание** и **EXPIRES** и нажав клавишу **Сохранить**.
    
        Один раз **Сохранить** нажатии кнопки, отображается значение ключа. Скопируйте значение ключа перед выходом из колонки.

    ![Доступ через API](./media/connect-with-rest/connect-with-rest03.png)

Значения для параметров соединения AD можно добавить в файл web.config или app.config для последующего использования в коде.

> [!IMPORTANT]
> **Ключ клиента** является секретным и необходимо надлежащим образом защищена в хранилище ключей или шифрования в рабочей среде.

## <a name="get-the-access-token-using-postman"></a>Получить маркер доступа, с помощью почтальон

В этом разделе показано, как использовать **почтальон** для выполнения API REST, который возвращает маркеров носителей JWT (токен доступа). Для вызова любого API REST служб мультимедиа, необходимо добавить заголовок «Authorization» вызовы и добавьте параметр «носителя *your_access_token*» для каждого вызова (как показано в следующем разделе данного руководства). 

1. Откройте **почтальон**.
2. Выберите **POST**.
3. Введите URL-адрес, включающий имя клиента, используя следующий формат: имя клиента должен заканчиваться **. onmicrosoft.com** и URL-адрес должен заканчиваться **oauth2 или токен**: 

    https://Login.microsoftonline.com/ {your-aad-tenant-name.onmicrosoft.com}/oauth2/token

4. Выберите **заголовки** вкладки.
5. Введите **заголовки** сведения с помощью сетки данных «Ключ-значение». 

    ![Сетка данных](./media/connect-with-rest/headers-data-grid.png)

    Можно также щелкнуть **массовое редактирование** ссылку в правой части окна почтальон и вставьте следующий код.

        Content-Type:application/x-www-form-urlencoded
        Keep-Alive:true

6. Нажмите клавишу **текст** вкладки.
7. Введите текст с помощью сетки данных «Ключ-значение» (Замените идентификатор клиента и значения секрета). 

    ![Сетка данных](./media/connect-with-rest/data-grid.png)

    Можно также щелкнуть **массовое редактирование** в правой части окна почтальон и вставьте следующий текст (Замените идентификатор клиента и секрета значения):

        grant_type:client_credentials
        client_id:{Your Client ID that you got from your AAD Application}
        client_secret:{Your client secret that you got from your AAD Application's Keys}
        resource:https://rest.media.azure.net

8. Нажмите кнопку **Отправить**.

    ![Получение токена](./media/connect-with-rest/connect-with-rest04.png)

Возвращенный ответ содержит **маркер доступа** необходимо использовать для доступа к любой AMS API-интерфейсы.

## <a name="test-the-assets-api-using-the-access-token"></a>Тест **активы** API с помощью токена доступа

В этом разделе показано, как получить доступ к **активы** с помощью API **почтальон**.

1. Откройте **почтальон**.
2. Выберите **GET**.
3. Вставьте конечной точке REST API (например, https://amshelloworld.restv2.westus.media.azure.net/api/Assets)
4. Выберите **авторизации** вкладки. 
5. Выберите **токена носителя**.
6. Вставьте токен, который был создан в предыдущем разделе.

    ![Получение токена](./media/connect-with-rest/connect-with-rest05.png)

    > [!NOTE]
    > UX почтальон могут быть разными в разных Mac и ПК. Если версия Mac не имеет параметра «Bearer Token» **проверки подлинности** раскрывающийся список в разделе, необходимо добавить **авторизации** заголовок на клиенте для Mac вручную.

   ![Заголовок проверки подлинности](./media/connect-with-rest/auth-header.png)

7. Выберите **заголовки**.
5. Нажмите кнопку **массовое редактирование** ссылку в правом окне почтальон.
6. Вставьте следующие заголовки:

        x-ms-version:2.15
        Accept:application/json
        Content-Type:application/json
        DataServiceVersion:3.0
        MaxDataServiceVersion:3.0

7. Нажмите кнопку **Отправить**.

Возвращенный ответ содержит необходимые ресурсы в вашей учетной записи.

## <a name="next-steps"></a>Дальнейшие действия

* Попробуйте этот пример кода в [проверки подлинности Azure AD для доступа к Azure Media Services: оба через REST API](https://github.com/willzhan/WAMSRESTSoln)
* [Отправка файлов с помощью .NET](media-services-dotnet-upload-files.md)
