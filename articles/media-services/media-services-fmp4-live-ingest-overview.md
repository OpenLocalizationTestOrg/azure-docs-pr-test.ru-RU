---
title: "Спецификация приема aaaAzure Media Services live фрагментированный MP4 | Документы Microsoft"
description: "Эта спецификация описывает протокол hello и формат для фрагментированного MP4-based динамической потоковой передачи приема для служб мультимедиа Azure. Можно использовать событий прямой трансляции toostream служб мультимедиа Azure и вещания содержимого в реальном времени, используя в качестве hello облачной платформы Azure. В этом документе также обсуждаются практические рекомендации по созданию механизмов приема прямой трансляции с высокой избыточностью и надежностью."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 0c191f8d6c5a595621feaba0e571fb984b666f34
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="a6287-105">Спецификация приема фрагментированного MP4 в реальном времени в службах мультимедиа Azure</span><span class="sxs-lookup"><span data-stu-id="a6287-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="a6287-106">Эта спецификация описывает протокол hello и формат для фрагментированного MP4-based динамической потоковой передачи приема для служб мультимедиа Azure.</span><span class="sxs-lookup"><span data-stu-id="a6287-106">This specification describes hello protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="a6287-107">Службы мультимедиа предоставляют службу потоковой трансляции клиентам использовать toostream событий в реальном времени и вещания содержимого в реальном времени, используя в качестве hello облачной платформы Azure.</span><span class="sxs-lookup"><span data-stu-id="a6287-107">Media Services provides a live streaming service that customers can use toostream live events and broadcast content in real time by using Azure as hello cloud platform.</span></span> <span data-ttu-id="a6287-108">В этом документе также обсуждаются практические рекомендации по созданию механизмов приема прямой трансляции с высокой избыточностью и надежностью.</span><span class="sxs-lookup"><span data-stu-id="a6287-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="a6287-109">1. Замечание о соответствии</span><span class="sxs-lookup"><span data-stu-id="a6287-109">1. Conformance notation</span></span>
<span data-ttu-id="a6287-110">Hello ключевые слова «должен»» не,» «Обязательно» «SHALL», «должны не должны,» «SHOULD», «Следует не,» «Рекомендуется», «Может» и «ДОПОЛНИТЕЛЬНО» в этом документе, интерпретируется как они описаны в документе RFC 2119 toobe.</span><span class="sxs-lookup"><span data-stu-id="a6287-110">hello key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are toobe interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="a6287-111">2. Схема службы</span><span class="sxs-lookup"><span data-stu-id="a6287-111">2. Service diagram</span></span>
<span data-ttu-id="a6287-112">Hello следующей схеме показано hello высокоуровневая архитектура hello динамической потоковой передачи службы в службах мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a6287-112">hello following diagram shows hello high-level architecture of hello live streaming service in Media Services:</span></span>

1. <span data-ttu-id="a6287-113">Динамический кодировщик отправляет toochannels динамической веб-каналы, создаваемые и подготовить через hello Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="a6287-113">A live encoder pushes live feeds toochannels that are created and provisioned via hello Azure Media Services SDK.</span></span>
2. <span data-ttu-id="a6287-114">Каналы, программы и конечных точек потоковой передачи в дескриптор Media Services live hello все потоковые функции, включая получение, форматирование, облака DVR, безопасность, масштабируемость и избыточность.</span><span class="sxs-lookup"><span data-stu-id="a6287-114">Channels, programs, and streaming endpoints in Media Services handle all hello live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="a6287-115">Кроме того клиенты могут выбрать toodeploy сети доставки содержимого Azure слой между hello потоковой передачи конечной точки и hello клиентских конечных точек.</span><span class="sxs-lookup"><span data-stu-id="a6287-115">Optionally, customers can choose toodeploy an Azure Content Delivery Network layer between hello streaming endpoint and hello client endpoints.</span></span>
4. <span data-ttu-id="a6287-116">Поток конечных точек клиента из конечной точки потоковой передачи с помощью протоколов адаптивной потоковой передачи HTTP hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-116">Client endpoints stream from hello streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="a6287-117">например Microsoft Smooth Streaming, динамическая адаптивная потоковая передача по HTTP (DASH или MPEG-DASH), а также Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="a6287-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![поток приема данных][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="a6287-119">3. Формат битового потока — ISO 14496-12, фрагментированный MP4</span><span class="sxs-lookup"><span data-stu-id="a6287-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="a6287-120">Hello формат передачи для приема потоковой трансляции обсуждается в этом документе основан на [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="a6287-120">hello wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="a6287-121">Подробные сведения о фрагментированном формате MP4 и расширениях как для файлов видео по запросу, так и для приема потоковой трансляции см. в статье о [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="a6287-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="a6287-122">Определения динамических форматов приема</span><span class="sxs-lookup"><span data-stu-id="a6287-122">Live ingest format definitions</span></span>
<span data-ttu-id="a6287-123">Hello ниже описаны специальные формат определения, которые применяются toolive приема в службы мультимедиа Azure.</span><span class="sxs-lookup"><span data-stu-id="a6287-123">hello following list describes special format definitions that apply toolive ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="a6287-124">Hello **ftyp**, **Live поле сервера манифеста**, и **moov** поля, которые должны отправляться с каждым запросом (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="a6287-124">hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="a6287-125">Эти поля должны быть отправлены в начале hello потока hello и приема в любое время, кодировщик hello необходимо повторно подключить tooresume потока.</span><span class="sxs-lookup"><span data-stu-id="a6287-125">These boxes MUST be sent at hello beginning of hello stream and any time hello encoder must reconnect tooresume stream ingest.</span></span> <span data-ttu-id="a6287-126">Дополнительные сведения см. в разделе 6 в статье [1].</span><span class="sxs-lookup"><span data-stu-id="a6287-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="a6287-127">Раздел 3.3.2 в статье [1] определяет необязательное поле с именем **StreamManifestBox** для приема динамической передачи.</span><span class="sxs-lookup"><span data-stu-id="a6287-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="a6287-128">Из-за логики маршрутизации toohello hello балансировки нагрузки Azure с помощью этого поля является устаревшим.</span><span class="sxs-lookup"><span data-stu-id="a6287-128">Due toohello routing logic of hello Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="a6287-129">поле Hello должны отсутствовать при передаче в службы мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a6287-129">hello box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="a6287-130">При наличии этого поля службы мультимедиа автоматически его игнорируют.</span><span class="sxs-lookup"><span data-stu-id="a6287-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="a6287-131">Hello **TrackFragmentExtendedHeaderBox** поля, определенные в 3.2.3.2 в [1] должен присутствовать для каждого фрагмента.</span><span class="sxs-lookup"><span data-stu-id="a6287-131">hello **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="a6287-132">Версия 2 hello **TrackFragmentExtendedHeaderBox** поле должно быть используется toogenerate сегментами, имеющих одинаковые URL-адресов в нескольких центрах обработки данных.</span><span class="sxs-lookup"><span data-stu-id="a6287-132">Version 2 of hello **TrackFragmentExtendedHeaderBox** box SHOULD be used toogenerate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="a6287-133">поле индекса фрагмент Hello — REQUIRED для отработки отказа между центрами обработки данных на основе индекса потоковой передачи форматы, например Apple HLS и MPEG-DASH, на основе индекса.</span><span class="sxs-lookup"><span data-stu-id="a6287-133">hello fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="a6287-134">между центрами tooenable перехода на другой ресурс, hello фрагменте индекса должны быть синхронизированы между несколькими кодировщиков и увеличивается на 1 для каждого фрагмента последовательных носителя даже через кодировщик перезапуски или сбои.</span><span class="sxs-lookup"><span data-stu-id="a6287-134">tooenable cross-datacenter failover, hello fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="a6287-135">3.3.6 в [1] определяет поле, называемое **MovieFragmentRandomAccessBox** (**mfra**), могут быть отправлены в конце hello toohello (электрической ПЕРЕГРУЗКИ) канала для приема динамической tooindicate конец потока.</span><span class="sxs-lookup"><span data-stu-id="a6287-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at hello end of live ingestion tooindicate end-of-stream (EOS) toohello channel.</span></span> <span data-ttu-id="a6287-136">Из-за toohello приема логики служб мультимедиа с помощью электрической ПЕРЕГРУЗКИ является устаревшим и hello **mfra** поле для динамической приема не следует отправлять.</span><span class="sxs-lookup"><span data-stu-id="a6287-136">Due toohello ingest logic of Media Services, using EOS is deprecated, and hello **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="a6287-137">В случае отправки этого поля службы мультимедиа автоматически его игнорируют.</span><span class="sxs-lookup"><span data-stu-id="a6287-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="a6287-138">состояние hello tooreset hello приема точкой, мы рекомендуем использовать [сброса канала](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="a6287-138">tooreset hello state of hello ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="a6287-139">Также рекомендуется использовать [остановить программу](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend презентации и потоком.</span><span class="sxs-lookup"><span data-stu-id="a6287-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend a presentation and stream.</span></span>
6. <span data-ttu-id="a6287-140">Длительность фрагмента Hello MP4 должна быть константой, размер hello tooreduce hello клиентские манифесты.</span><span class="sxs-lookup"><span data-stu-id="a6287-140">hello MP4 fragment duration SHOULD be constant, tooreduce hello size of hello client manifests.</span></span> <span data-ttu-id="a6287-141">Константа длительность фрагмент MP4 также улучшает эвристики загрузки клиента с использованием hello повторов тегов.</span><span class="sxs-lookup"><span data-stu-id="a6287-141">A constant MP4 fragment duration also improves client download heuristics through hello use of repeat tags.</span></span> <span data-ttu-id="a6287-142">Длительность Hello может изменяться toocompensate для частоты кадров, отличный от integer.</span><span class="sxs-lookup"><span data-stu-id="a6287-142">hello duration MAY fluctuate toocompensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="a6287-143">Длительность фрагмента Hello MP4 должна составлять от приблизительно 2 и 6 секунд.</span><span class="sxs-lookup"><span data-stu-id="a6287-143">hello MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="a6287-144">НЕОБХОДИМО обеспечить поступление меток времени и индексов фрагментов MP4 (`fragment_ absolute_ time` и `fragment_index` в **TrackFragmentExtendedHeaderBox**) в порядке возрастания.</span><span class="sxs-lookup"><span data-stu-id="a6287-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="a6287-145">Несмотря на то, что службы мультимедиа являются устойчивыми tooduplicate фрагментов, имеют ограниченную возможность tooreorder фрагментов в соответствии с временной шкалы мультимедиа toohello.</span><span class="sxs-lookup"><span data-stu-id="a6287-145">Although Media Services is resilient tooduplicate fragments, it has limited ability tooreorder fragments according toohello media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="a6287-146">4. Формат протокола — HTTP</span><span class="sxs-lookup"><span data-stu-id="a6287-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="a6287-147">ISO фрагментированной основе MP4 динамическую приема для служб мультимедиа использует стандартные долго выполняющихся HTTP POST запроса tootransmit кодировке носителя данных, содержащийся в службе toohello формате фрагментированного MP4.</span><span class="sxs-lookup"><span data-stu-id="a6287-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request tootransmit encoded media data that is packaged in fragmented MP4 format toohello service.</span></span> <span data-ttu-id="a6287-148">Каждый HTTP POST отправляет полный фрагментированной bitstream MP4 («stream»), начиная с начала hello с полями заголовок (**ftyp**, **Live поле сервера манифеста**, и **moov** поля) и продолжите последовательность фрагментов (**moof** и **mdat** поля).</span><span class="sxs-lookup"><span data-stu-id="a6287-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from hello beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="a6287-149">Синтаксис URL-адрес для hello HTTP-запроса POST см. раздел 9.2 в [1].</span><span class="sxs-lookup"><span data-stu-id="a6287-149">For URL syntax for hello HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="a6287-150">Пример hello POST URL-адрес выглядит:</span><span class="sxs-lookup"><span data-stu-id="a6287-150">An example of hello POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="a6287-151">Требования</span><span class="sxs-lookup"><span data-stu-id="a6287-151">Requirements</span></span>
<span data-ttu-id="a6287-152">Ниже приведены подробные требования hello:</span><span class="sxs-lookup"><span data-stu-id="a6287-152">Here are hello detailed requirements:</span></span>

1. <span data-ttu-id="a6287-153">Hello кодировщик должен начинаться hello широковещательную рассылку путем отправки запроса HTTP POST с пустым Здравствуйте, «текст» (нулевой длиной содержимого) с помощью URL-адреса приема.</span><span class="sxs-lookup"><span data-stu-id="a6287-153">hello encoder SHOULD start hello broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using hello same ingestion URL.</span></span> <span data-ttu-id="a6287-154">Это может помочь быстро определить конечную точку приема динамической hello является допустимым, и если проверку подлинности или другие условия, необходимые кодировщику hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-154">This can help hello encoder quickly detect whether hello live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="a6287-155">По протоколу HTTP hello сервер не отправляет обратно HTTP-ответа, пока не hello целиком, включая тело POST hello, поступает запрос.</span><span class="sxs-lookup"><span data-stu-id="a6287-155">Per HTTP protocol, hello server can't send back an HTTP response until hello entire request, including hello POST body, is received.</span></span> <span data-ttu-id="a6287-156">Условии характера долго выполняющихся hello трансляция без этого шага hello кодировщик может быть toodetect может любая ошибка завершения отправки всех данных hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-156">Given hello long-running nature of a live event, without this step, hello encoder might not be able toodetect any error until it finishes sending all hello data.</span></span>
2. <span data-ttu-id="a6287-157">Hello кодировщик должен обрабатывать все ошибки и проблемы проверки подлинности из-за (1).</span><span class="sxs-lookup"><span data-stu-id="a6287-157">hello encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="a6287-158">Если (1) завершится успешно с ответом 200, продолжайте.</span><span class="sxs-lookup"><span data-stu-id="a6287-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="a6287-159">кодировщик Hello необходимо запустить новый запрос HTTP POST с потоком MP4 фрагментирован приветствия.</span><span class="sxs-lookup"><span data-stu-id="a6287-159">hello encoder MUST start a new HTTP POST request with hello fragmented MP4 stream.</span></span> <span data-ttu-id="a6287-160">полезные данные Hello должно начинаться с поля заголовка hello, следуют фрагментов.</span><span class="sxs-lookup"><span data-stu-id="a6287-160">hello payload MUST start with hello header boxes, followed by fragments.</span></span> <span data-ttu-id="a6287-161">Обратите внимание, что hello **ftyp**, **Live поле сервера манифеста**, и **moov** поля (в указанном порядке) должны отправляться с каждым запросом, даже если необходимо повторно подключить hello кодировщика, так как hello Предыдущий запрос был завершен предыдущий toohello конец потока hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-161">Note that hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if hello encoder must reconnect because hello previous request was terminated prior toohello end of hello stream.</span></span> 
4. <span data-ttu-id="a6287-162">Hello кодировщик должен использоваться поблочное кодирование для отправки, так как это невозможно toopredict hello всю длину содержимого hello динамические события.</span><span class="sxs-lookup"><span data-stu-id="a6287-162">hello encoder MUST use chunked transfer encoding for uploading, because it’s impossible toopredict hello entire content length of hello live event.</span></span>
5. <span data-ttu-id="a6287-163">При событии hello над, после отправки последнего фрагмента hello, кодировщик hello корректно должно заканчиваться передачи hello Поблочное кодирование сообщений последовательности (большинство стеки HTTP клиента он автоматически обрабатывать).</span><span class="sxs-lookup"><span data-stu-id="a6287-163">When hello event is over, after sending hello last fragment, hello encoder MUST gracefully end hello chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="a6287-164">Hello кодировщик должен ожидать кода hello службы tooreturn hello окончательный ответ и затем разрыва подключения hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-164">hello encoder MUST wait for hello service tooreturn hello final response code, and then terminate hello connection.</span></span> 
6. <span data-ttu-id="a6287-165">кодировщик Hello не должны использовать hello `Events()` существительное, как описано в 9.2 в [1] для динамической приема в службы мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a6287-165">hello encoder MUST NOT use hello `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="a6287-166">Если завершается запрос HTTP POST hello, или время ожидания с TCP ошибки предыдущего toohello конец потока hello hello кодировщик должен выдать новый запрос POST с помощью нового подключения и выполните hello требования.</span><span class="sxs-lookup"><span data-stu-id="a6287-166">If hello HTTP POST request terminates or times out with a TCP error prior toohello end of hello stream, hello encoder MUST issue a new POST request by using a new connection, and follow hello preceding requirements.</span></span> <span data-ttu-id="a6287-167">Кроме того кодировщик hello необходимо повторно отправить hello предыдущих двух фрагментов MP4 для каждой записи в поток hello и возобновить без возникновения разрыв в временной шкалы мультимедиа hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-167">Additionally, hello encoder MUST resend hello previous two MP4 fragments for each track in hello stream, and resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="a6287-168">Повторная отправка hello последних двух фрагментов MP4 для каждой записи гарантирует, что потери данных.</span><span class="sxs-lookup"><span data-stu-id="a6287-168">Resending hello last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="a6287-169">Другими словами Если поток содержит аудио и видео дорожка hello текущий запрос POST завершается ошибкой, hello кодировщика должны повторно подключиться и повторить отправку hello двух последних фрагменты для hello звуковой дорожки, которые были ранее успешно отправлены, и двух последних hello фрагменты для Hello видеодорожки, которая ранее успешно отправленные, tooensure, не происходит потери данных.</span><span class="sxs-lookup"><span data-stu-id="a6287-169">In other words, if a stream contains both an audio and a video track, and hello current POST request fails, hello encoder must reconnect and resend hello last two fragments for hello audio track, which were previously successfully sent, and hello last two fragments for hello video track, which were previously successfully sent, tooensure that there is no data loss.</span></span> <span data-ttu-id="a6287-170">Hello кодировщик должен поддерживать «вперед» буфера фрагментов носителя, которые отправкой после повторного подключения.</span><span class="sxs-lookup"><span data-stu-id="a6287-170">hello encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="a6287-171">5. Шкала времени</span><span class="sxs-lookup"><span data-stu-id="a6287-171">5. Timescale</span></span>
<span data-ttu-id="a6287-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) описывается использование hello шкалы времени для **SmoothStreamingMedia** (раздел 2.2.2.1), **StreamElement** (раздел 2.2.2.3), **StreamFragmentElement**(Раздел 2.2.2.6) и **LiveSMIL** (раздел 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="a6287-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes hello usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="a6287-173">Если значение шкалы времени hello отсутствует, используется значение по умолчанию hello — 10 000 000 (10 МГц).</span><span class="sxs-lookup"><span data-stu-id="a6287-173">If hello timescale value is not present, hello default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="a6287-174">Несмотря на то, что hello Smooth Streaming спецификации формата не блокирует использование других значений шкалы времени, большинство реализаций кодировщика использовать это значение по умолчанию (10 МГц) значение toogenerate Smooth Streaming приема данных.</span><span class="sxs-lookup"><span data-stu-id="a6287-174">Although hello Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) toogenerate Smooth Streaming ingest data.</span></span> <span data-ttu-id="a6287-175">Из-за toohello [динамическое упаковывание мультимедиа Azure](media-services-dynamic-packaging-overview.md) компонентов, рекомендуется использовать шкалы 90 кГц видеопотоков и 44,1 кГц или 48.1 кГц для звуковых потоков.</span><span class="sxs-lookup"><span data-stu-id="a6287-175">Due toohello [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="a6287-176">Если разные шкалы времени значения используются для различных потоков, должны отправляться шкалы времени hello уровне потока.</span><span class="sxs-lookup"><span data-stu-id="a6287-176">If different timescale values are used for different streams, hello stream-level timescale MUST be sent.</span></span> <span data-ttu-id="a6287-177">Дополнительные сведения см. в статье о [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="a6287-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="a6287-178">6. Определение потока</span><span class="sxs-lookup"><span data-stu-id="a6287-178">6. Definition of “stream”</span></span>
<span data-ttu-id="a6287-179">Поток имеет hello основной единицей операции в динамической приема для составления презентации, обработка потоковой передачи отработки отказа и сценарии избыточности.</span><span class="sxs-lookup"><span data-stu-id="a6287-179">Stream is hello basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="a6287-180">Поток определяется как один уникальный фрагментированный битовый поток MP4, который может содержать одну или несколько дорожек.</span><span class="sxs-lookup"><span data-stu-id="a6287-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="a6287-181">Полная презентации может содержать один или несколько потоков, в соответствии с настройками hello динамических кодировщиков hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-181">A full live presentation might contain one or more streams, depending on hello configuration of hello live encoders.</span></span> <span data-ttu-id="a6287-182">Hello следующие примеры демонстрируют различные параметры использования потоков toocompose полной презентации.</span><span class="sxs-lookup"><span data-stu-id="a6287-182">hello following examples illustrate various options of using streams toocompose a full live presentation.</span></span>

<span data-ttu-id="a6287-183">**Пример**</span><span class="sxs-lookup"><span data-stu-id="a6287-183">**Example:**</span></span> 

<span data-ttu-id="a6287-184">Клиенту требуется toocreate потоковой передачи презентации в реальном времени, включающий следующие битрейтах аудио/видео hello:</span><span class="sxs-lookup"><span data-stu-id="a6287-184">A customer wants toocreate a live streaming presentation that includes hello following audio/video bitrates:</span></span>

<span data-ttu-id="a6287-185">видео — 3000 Кбит/с, 1500 Кбит/с, 750 Кбит/с;</span><span class="sxs-lookup"><span data-stu-id="a6287-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="a6287-186">аудио — 128 Кбит/с.</span><span class="sxs-lookup"><span data-stu-id="a6287-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="a6287-187">Вариант 1. Все дорожки в одном потоке</span><span class="sxs-lookup"><span data-stu-id="a6287-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="a6287-188">В этом случае один кодировщик формирует все аудио- и видеодорожки и объединяет их в один фрагментированный битовый поток MP4,</span><span class="sxs-lookup"><span data-stu-id="a6287-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="a6287-189">Hello фрагментированным MP4 bitstream отправляется через одно подключение HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="a6287-189">hello fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="a6287-190">В этом примере имеется только один поток для текущей презентации.</span><span class="sxs-lookup"><span data-stu-id="a6287-190">In this example, there is only one stream for this live presentation.</span></span>

![Потоки (одна дорожка)][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="a6287-192">Вариант 2. Каждая дорожка в отдельном потоке</span><span class="sxs-lookup"><span data-stu-id="a6287-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="a6287-193">В этом параметре кодировщика hello помещает одну запись в каждой bitstream фрагмент MP4 и затем отправляет все потоки hello через отдельные подключения по протоколу HTTP.</span><span class="sxs-lookup"><span data-stu-id="a6287-193">In this option, hello encoder puts one track into each fragment MP4 bitstream, and then posts all of hello streams over separate HTTP connections.</span></span> <span data-ttu-id="a6287-194">Это можно сделать с помощью одного или нескольких кодировщиков.</span><span class="sxs-lookup"><span data-stu-id="a6287-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="a6287-195">Динамическая приема Hello видит презентации в реальном времени, состоит из четырех потоков.</span><span class="sxs-lookup"><span data-stu-id="a6287-195">hello live ingestion sees this live presentation as composed of four streams.</span></span>

![Потоки (отдельные дорожки)][image3]

### <a name="option-3-bundle-audio-track-with-hello-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="a6287-197">Вариант 3: Звуковая дорожка с hello низкий битрейт видеодорожки объединить в один поток</span><span class="sxs-lookup"><span data-stu-id="a6287-197">Option 3: Bundle audio track with hello lowest bitrate video track into one stream</span></span>
<span data-ttu-id="a6287-198">В этом параметре клиента hello выбирает toobundle hello Аудиодорожка с наименьшим скоростями видеодорожки hello в один фрагмент MP4 bitstream и оставьте hello другие два видеодорожек как отдельные потоки.</span><span class="sxs-lookup"><span data-stu-id="a6287-198">In this option, hello customer chooses toobundle hello audio track with hello lowest-bitrate video track in one fragment MP4 bitstream, and leave hello other two video tracks as separate streams.</span></span> 

![Потоки (аудио- и видеодорожки)][image4]

### <a name="summary"></a><span data-ttu-id="a6287-200">Сводка</span><span class="sxs-lookup"><span data-stu-id="a6287-200">Summary</span></span>
<span data-ttu-id="a6287-201">Это не исчерпывающий список всех возможных вариантов приема в данном примере.</span><span class="sxs-lookup"><span data-stu-id="a6287-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="a6287-202">Фактически приемом прямой передачи поддерживается любое группирование дорожек в потоки.</span><span class="sxs-lookup"><span data-stu-id="a6287-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="a6287-203">Заказчики и поставщики кодировщиков могут выбирать собственные реализации в зависимости от инженерной сложности, емкости кодировщика и соображений избыточности и отработки отказов.</span><span class="sxs-lookup"><span data-stu-id="a6287-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="a6287-204">Однако в большинстве случаев есть только один звуковой дорожки hello всей презентации в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="a6287-204">However, in most cases, there is only one audio track for hello entire live presentation.</span></span> <span data-ttu-id="a6287-205">Таким образом он является важным tooensure hello healthiness из hello приема поток, содержащий hello звуковой дорожки. Часто этого вопроса приводит размещение звуковой дорожки hello в собственный поток (как вариант 2) или объединении его с наименьшим скоростями видеодорожки hello (как вариант 3).</span><span class="sxs-lookup"><span data-stu-id="a6287-205">So, it’s important tooensure hello healthiness of hello ingest stream that contains hello audio track. This consideration often results in putting hello audio track in its own stream (as in Option 2) or bundling it with hello lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="a6287-206">Кроме того, для повышения избыточности и отказоустойчивости, отправка hello же звуковой дорожки в двух разных потоков (вариант 2 с избыточностью звуковой файл) или объединение hello звуковой дорожки с по крайней мере двух hello низкий битрейт видеодорожек (вариант 3 с объединенными в в аудио как минимум два видеопотоков) динамическую настоятельно рекомендуется для приема в службы мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a6287-206">Also, for better redundancy and fault tolerance, sending hello same audio track in two different streams (Option 2 with redundant audio tracks) or bundling hello audio track with at least two of hello lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="a6287-207">7. Отработка отказа службы</span><span class="sxs-lookup"><span data-stu-id="a6287-207">7. Service failover</span></span>
<span data-ttu-id="a6287-208">Данный hello характер потоковой трансляции поддержки хорошо отработки отказа важно для обеспечения доступности hello hello службы.</span><span class="sxs-lookup"><span data-stu-id="a6287-208">Given hello nature of live streaming, good failover support is critical for ensuring hello availability of hello service.</span></span> <span data-ttu-id="a6287-209">Службы мультимедиа является спроектированный toohandle различных типов сбоев, включая сетевые ошибки, ошибки сервера и неполадок хранилища.</span><span class="sxs-lookup"><span data-stu-id="a6287-209">Media Services is designed toohandle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="a6287-210">При использовании в сочетании с логикой правильный переход на другой ресурс со стороны динамического кодировщика hello клиентов можно добиться высоконадежными службу потоковой трансляции из облака hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-210">When used in conjunction with proper failover logic from hello live encoder side, customers can achieve a highly reliable live streaming service from hello cloud.</span></span>

<span data-ttu-id="a6287-211">В этом разделе мы обсудим сценарии отработки отказа службы.</span><span class="sxs-lookup"><span data-stu-id="a6287-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="a6287-212">В этом случае происходит сбой hello где-либо в службе hello и проявляется как сетевая ошибка.</span><span class="sxs-lookup"><span data-stu-id="a6287-212">In this case, hello failure happens somewhere within hello service, and it manifests itself as a network error.</span></span> <span data-ttu-id="a6287-213">Ниже приведены некоторые рекомендации по реализации hello кодировщика для обработки отработки отказа служб.</span><span class="sxs-lookup"><span data-stu-id="a6287-213">Here are some recommendations for hello encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="a6287-214">Используйте более 10 секунд времени ожидания для установления hello TCP-подключения.</span><span class="sxs-lookup"><span data-stu-id="a6287-214">Use a 10-second timeout for establishing hello TCP connection.</span></span> <span data-ttu-id="a6287-215">Если подключение hello tooestablish попытки занимает больше 10 секунд, прервать операцию hello и повторите попытку.</span><span class="sxs-lookup"><span data-stu-id="a6287-215">If an attempt tooestablish hello connection takes longer than 10 seconds, abort hello operation and try again.</span></span> 
2. <span data-ttu-id="a6287-216">Используйте короткое время ожидания для отправки фрагментов сообщений hello HTTP запроса.</span><span class="sxs-lookup"><span data-stu-id="a6287-216">Use a short timeout for sending hello HTTP request message chunks.</span></span> <span data-ttu-id="a6287-217">Если длительность фрагмент MP4 целевую hello N секунд, используйте время ожидания отправки от N до 2 секунд N; Например если длительность фрагмент MP4 hello составляет 6 секунд, используйте время ожидания 6 too12 секунд.</span><span class="sxs-lookup"><span data-stu-id="a6287-217">If hello target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if hello MP4 fragment duration is 6 seconds, use a timeout of 6 too12 seconds.</span></span> <span data-ttu-id="a6287-218">Если время ожидания, сброс подключения hello, открыть новое соединение и возобновить поток приема для hello нового подключения.</span><span class="sxs-lookup"><span data-stu-id="a6287-218">If a timeout occurs, reset hello connection, open a new connection, and resume stream ingest on hello new connection.</span></span> 
3. <span data-ttu-id="a6287-219">Ведение последовательного буфера, содержащего hello последних двух фрагментов для каждой записи, посланных успешно и полностью toohello службы.</span><span class="sxs-lookup"><span data-stu-id="a6287-219">Maintain a rolling buffer that has hello last two fragments for each track that were successfully and completely sent toohello service.</span></span>  <span data-ttu-id="a6287-220">Если запрос HTTP POST hello потока завершается или время ожидания предыдущих toohello конец потока hello, открыть новое подключение и начать другой запрос HTTP POST, повторно отправить поток заголовки hello, повторно отправить hello последних двух фрагментов для каждой записи и возобновить hello потока без Представляем разрыв в временной шкалы мультимедиа hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-220">If hello HTTP POST request for a stream is terminated or times out prior toohello end of hello stream, open a new connection and begin another HTTP POST request, resend hello stream headers, resend hello last two fragments for each track, and resume hello stream without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="a6287-221">Это снижает вероятность потери данных hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-221">This reduces hello chance of data loss.</span></span>
4. <span data-ttu-id="a6287-222">Мы рекомендуем этот кодировщик hello не максимальное число повторных попыток tooestablish соединение hello или возобновить потоковой передачи после возникновения ошибки TCP.</span><span class="sxs-lookup"><span data-stu-id="a6287-222">We recommend that hello encoder does NOT limit hello number of retries tooestablish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="a6287-223">После возникновения ошибки TCP:</span><span class="sxs-lookup"><span data-stu-id="a6287-223">After a TCP error:</span></span>
  
    <span data-ttu-id="a6287-224">а.</span><span class="sxs-lookup"><span data-stu-id="a6287-224">a.</span></span> <span data-ttu-id="a6287-225">НЕОБХОДИМО закрыть текущее соединение Hello и необходимо создать новое соединение для нового запроса HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="a6287-225">hello current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="a6287-226">b.</span><span class="sxs-lookup"><span data-stu-id="a6287-226">b.</span></span> <span data-ttu-id="a6287-227">новый HTTP POST URL-адрес должен быть Hello hello так же, как hello POST URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="a6287-227">hello new HTTP POST URL MUST be hello same as hello initial POST URL.</span></span>
  
    <span data-ttu-id="a6287-228">c.</span><span class="sxs-lookup"><span data-stu-id="a6287-228">c.</span></span> <span data-ttu-id="a6287-229">Hello новый HTTP POST необходимо включить заголовки потока (**ftyp**, **Live поле сервера манифеста**, и **moov** поля), являются идентичными toohello заголовков потока в hello первоначального POST.</span><span class="sxs-lookup"><span data-stu-id="a6287-229">hello new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical toohello stream headers in hello initial POST.</span></span>
  
    <span data-ttu-id="a6287-230">d.</span><span class="sxs-lookup"><span data-stu-id="a6287-230">d.</span></span> <span data-ttu-id="a6287-231">Повторите последние два фрагментов Hello, отправляемых для каждого направления и потоковой передачи необходимо возобновить работу без внесения разрыв в временной шкалы мультимедиа hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-231">hello last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="a6287-232">Hello отметки времени фрагмент MP4 необходимо увеличить постоянно, даже через HTTP-запросы POST.</span><span class="sxs-lookup"><span data-stu-id="a6287-232">hello MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="a6287-233">Если данные не были отправлены с частотой потребностям длительность фрагмент MP4 hello Hello кодировщик должен завершить работу hello HTTP-запроса POST.</span><span class="sxs-lookup"><span data-stu-id="a6287-233">hello encoder SHOULD terminate hello HTTP POST request if data is not being sent at a rate commensurate with hello MP4 fragment duration.</span></span>  <span data-ttu-id="a6287-234">Запрос HTTP POST, которые не отправляют данные можно предотвратить быстро отключение от кодировщика hello в событии hello обновление службы Media Services.</span><span class="sxs-lookup"><span data-stu-id="a6287-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update.</span></span> <span data-ttu-id="a6287-235">По этой причине hello HTTP POST для разреженных отслеживает (рекламный сигнал) должно быть небольшим, прерывание, как можно скорее фрагмент разреженных hello отправляется.</span><span class="sxs-lookup"><span data-stu-id="a6287-235">For this reason, hello HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as hello sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="a6287-236">8. Отработка отказа кодировщика</span><span class="sxs-lookup"><span data-stu-id="a6287-236">8. Encoder failover</span></span>
<span data-ttu-id="a6287-237">Кодировщик отработка отказа — второй тип сценария отработки отказа, который должен обращаться toobe для динамической потоковой передачи доставки конца в конец hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-237">Encoder failover is hello second type of failover scenario that needs toobe addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="a6287-238">В этом сценарии hello ошибка возникает на стороне кодировщика hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-238">In this scenario, hello error condition occurs on hello encoder side.</span></span> 

![Отработка отказа кодировщика][image5]

<span data-ttu-id="a6287-240">После ожидания Hello применяются из конечной точки динамической приема hello при отработке кодировщика.</span><span class="sxs-lookup"><span data-stu-id="a6287-240">hello following expectations apply from hello live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="a6287-241">Новый экземпляр кодировщика должны создаваться toocontinue потоковой передачи, как показано на схеме hello (поток для видео с пунктирным k 3000).</span><span class="sxs-lookup"><span data-stu-id="a6287-241">A new encoder instance SHOULD be created toocontinue streaming, as illustrated in hello diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="a6287-242">НЕОБХОДИМО использовать hello же запросов URL-адрес для HTTP POST в качестве hello нового кодировщика Hello сбой экземпляра.</span><span class="sxs-lookup"><span data-stu-id="a6287-242">hello new encoder MUST use hello same URL for HTTP POST requests as hello failed instance.</span></span>
3. <span data-ttu-id="a6287-243">Hello нового кодировщика POST запрос должен включать hello же фрагментированной MP4 заголовок поля как сбойный экземпляр hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-243">hello new encoder’s POST request MUST include hello same fragmented MP4 header boxes as hello failed instance.</span></span>
4. <span data-ttu-id="a6287-244">Hello нового кодировщика необходимо правильно синхронизированы с всех других запущенных кодировщиков, для hello же toogenerate презентации в реальном времени синхронизации образцы аудио/видео с границами выровненных фрагмент.</span><span class="sxs-lookup"><span data-stu-id="a6287-244">hello new encoder MUST be properly synced with all other running encoders for hello same live presentation toogenerate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="a6287-245">Hello новый поток должен быть семантически эквивалентны с hello предыдущего потока и являются взаимозаменяемыми на уровнях hello заголовок и фрагмент.</span><span class="sxs-lookup"><span data-stu-id="a6287-245">hello new stream MUST be semantically equivalent with hello previous stream, and interchangeable at hello header and fragment levels.</span></span>
6. <span data-ttu-id="a6287-246">Hello нового кодировщика следует пробовать toominimize потери данных.</span><span class="sxs-lookup"><span data-stu-id="a6287-246">hello new encoder SHOULD try toominimize data loss.</span></span> <span data-ttu-id="a6287-247">Hello `fragment_absolute_time` и `fragment_index` носителей следует увеличить фрагментов из hello точки, где кодировщика hello последнего останова.</span><span class="sxs-lookup"><span data-stu-id="a6287-247">hello `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from hello point where hello encoder last stopped.</span></span> <span data-ttu-id="a6287-248">Hello `fragment_absolute_time` и `fragment_index` следует увеличить непрерывного способом, но не допустимые toointroduce разрыв, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="a6287-248">hello `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible toointroduce a discontinuity, if necessary.</span></span> <span data-ttu-id="a6287-249">Службы мультимедиа игнорирует фрагменты, которые уже получено и обработано, поэтому лучше tooerr со стороны hello повторной отправки фрагментов, чем toointroduce нарушение непрерывности временной шкалы мультимедиа hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-249">Media Services ignores fragments that it has already received and processed, so it's better tooerr on hello side of resending fragments than toointroduce discontinuities in hello media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="a6287-250">9. Избыточность кодировщиков</span><span class="sxs-lookup"><span data-stu-id="a6287-250">9. Encoder redundancy</span></span>
<span data-ttu-id="a6287-251">Для определенных критических событий, что запросу даже более высокой доступности и качества передачи, мы рекомендуется использовать избыточные кодировщики активных tooachieve эффективное переключение без потери данных.</span><span class="sxs-lookup"><span data-stu-id="a6287-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders tooachieve seamless failover with no data loss.</span></span>

![Избыточность кодировщиков][image6]

<span data-ttu-id="a6287-253">Как показано на этой диаграмме, две группы кодировщиков Принудительная отправка две копии каждого потока одновременно в интерактивную службу hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into hello live service.</span></span> <span data-ttu-id="a6287-254">Такая конфигурация поддерживается благодаря возможности служб мультимедиа фильтровать повторяющиеся фрагменты на основе идентификатора потока и метки времени фрагмента.</span><span class="sxs-lookup"><span data-stu-id="a6287-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="a6287-255">Здравствуйте, полученный обновляющегося потока и архив находится по одной копии все потоки hello, hello лучшие возможности статистической обработки из двух источников hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-255">hello resulting live stream and archive is a single copy of all hello streams that is hello best possible aggregation from hello two sources.</span></span> <span data-ttu-id="a6287-256">Например в гипотетической очень редких случаях при условии, что имеется один кодировщик (это не обязательно toobe hello один) под управлением в любой момент времени для каждого потока hello возникающие обновляющегося потока из службы hello является непрерывным без потери данных.</span><span class="sxs-lookup"><span data-stu-id="a6287-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have toobe hello same one) running at any given point in time for each stream, hello resulting live stream from hello service is continuous without data loss.</span></span> 

<span data-ttu-id="a6287-257">Hello требования для данного сценария, почти hello же, как требования hello в случае «Кодировщик отработки отказа» hello, за исключением hello, второй набор hello кодировщиков, активных в hello же время как hello основной кодировщиков.</span><span class="sxs-lookup"><span data-stu-id="a6287-257">hello requirements for this scenario are almost hello same as hello requirements in hello "Encoder failover" case, with hello exception that hello second set of encoders are running at hello same time as hello primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="a6287-258">10. Избыточность служб</span><span class="sxs-lookup"><span data-stu-id="a6287-258">10. Service redundancy</span></span>
<span data-ttu-id="a6287-259">Иногда высокой избыточностью глобального распространения, необходимо иметь аварий регионального toohandle резервного копирования различных регионах.</span><span class="sxs-lookup"><span data-stu-id="a6287-259">For highly redundant global distribution, sometimes you must have cross-region backup toohandle regional disasters.</span></span> <span data-ttu-id="a6287-260">Расширив топологии «Избыточность кодировщика» hello, клиенты могут выбрать toohave избыточное развертывание служб в другом регионе, связанный с hello второй набор кодировщиков.</span><span class="sxs-lookup"><span data-stu-id="a6287-260">Expanding on hello “Encoder redundancy” topology, customers can choose toohave a redundant service deployment in a different region that's connected with hello second set of encoders.</span></span> <span data-ttu-id="a6287-261">Клиенты также могут работать с toodeploy поставщика сети доставки содержимого глобального диспетчера трафика перед hello две службы развертывания tooseamlessly маршрутизации трафика клиента.</span><span class="sxs-lookup"><span data-stu-id="a6287-261">Customers also can work with a Content Delivery Network provider toodeploy a Global Traffic Manager in front of hello two service deployments tooseamlessly route client traffic.</span></span> <span data-ttu-id="a6287-262">Hello требования для hello кодировщиков, hello так же, как hello вариант «Кодировщик избыточность».</span><span class="sxs-lookup"><span data-stu-id="a6287-262">hello requirements for hello encoders are hello same as hello “Encoder redundancy” case.</span></span> <span data-ttu-id="a6287-263">Hello только исключение — второй набор toobe потребностей кодировщики hello указывает tooa различных динамическую конечную приема.</span><span class="sxs-lookup"><span data-stu-id="a6287-263">hello only exception is that hello second set of encoders needs toobe pointed tooa different live ingest endpoint.</span></span> <span data-ttu-id="a6287-264">Hello следующей схеме показано этой программы установки.</span><span class="sxs-lookup"><span data-stu-id="a6287-264">hello following diagram shows this setup:</span></span>

![избыточность служб][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="a6287-266">11. Специальные типы форматов приема</span><span class="sxs-lookup"><span data-stu-id="a6287-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="a6287-267">В этом разделе рассматриваются специальные типы динамической приема форматах спроектированный toohandle конкретных сценариев.</span><span class="sxs-lookup"><span data-stu-id="a6287-267">This section discusses special types of live ingestion formats that are designed toohandle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="a6287-268">Разреженная дорожка</span><span class="sxs-lookup"><span data-stu-id="a6287-268">Sparse track</span></span>
<span data-ttu-id="a6287-269">При доставке потоковой передачи презентации в реальном времени с широкие возможности клиента, часто ее tootransmit необходимо синхронизировать время события или сообщает по каналу с главной медиаданных hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-269">When delivering a live streaming presentation with a rich client experience, often it's necessary tootransmit time-synced events or signals in-band with hello main media data.</span></span> <span data-ttu-id="a6287-270">Примером этого является динамическая вставка рекламы в текущий поток.</span><span class="sxs-lookup"><span data-stu-id="a6287-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="a6287-271">Этот тип сигнализации о событиях отличается от обычной потоковой передачи аудио/видео из-за своего разреженного характера.</span><span class="sxs-lookup"><span data-stu-id="a6287-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="a6287-272">Другими словами сигналов данных обычно не происходит непрерывно и интервал приветствия может быть жестких toopredict hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-272">In other words, hello signaling data usually does not happen continuously, and hello interval can be hard toopredict.</span></span> <span data-ttu-id="a6287-273">Понятие Hello разреженную дорожку было спроектированный tooingest и сигнал данных broadcast по каналу.</span><span class="sxs-lookup"><span data-stu-id="a6287-273">hello concept of sparse track was designed tooingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="a6287-274">Hello следующие действия приведены рекомендуемые реализацию для обработки разреженную дорожку.</span><span class="sxs-lookup"><span data-stu-id="a6287-274">hello following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="a6287-275">Создайте отдельный фрагментированный битовый поток MP4, содержащий только разреженные дорожки без звуковых дорожек и видеодорожек.</span><span class="sxs-lookup"><span data-stu-id="a6287-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="a6287-276">В hello **Live поле сервера манифеста** согласно разделу 6 в [1], использование hello *parentTrackName* имя hello toospecify параметра дорожки родительского hello. Дополнительные сведения см. в разделе 4.2.1.2.1.2 в статье [1].</span><span class="sxs-lookup"><span data-stu-id="a6287-276">In hello **Live Server Manifest Box** as defined in Section 6 in [1], use hello *parentTrackName* parameter toospecify hello name of hello parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="a6287-277">В hello **Live поле сервера манифеста**, **manifestOutput** необходимо задать слишком**true**.</span><span class="sxs-lookup"><span data-stu-id="a6287-277">In hello **Live Server Manifest Box**, **manifestOutput** MUST be set too**true**.</span></span>
4. <span data-ttu-id="a6287-278">Условии hello разреженных характера hello, сообщающее о событии, мы рекомендуем hello следующее:</span><span class="sxs-lookup"><span data-stu-id="a6287-278">Given hello sparse nature of hello signaling event, we recommended hello following:</span></span>
   
    <span data-ttu-id="a6287-279">а.</span><span class="sxs-lookup"><span data-stu-id="a6287-279">a.</span></span> <span data-ttu-id="a6287-280">В начале hello трансляция hello, hello кодировщик отправляет hello исходный заголовок поля toohello службу, которая позволяет разреженную дорожку tooregister службы hello hello в манифест клиента hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-280">At hello beginning of hello live event, hello encoder sends hello initial header boxes toohello service, which allows hello service tooregister hello sparse track in hello client manifest.</span></span>
   
    <span data-ttu-id="a6287-281">b.</span><span class="sxs-lookup"><span data-stu-id="a6287-281">b.</span></span> <span data-ttu-id="a6287-282">Когда данные не были отправлены Hello кодировщик должен завершить работу hello HTTP-запроса POST.</span><span class="sxs-lookup"><span data-stu-id="a6287-282">hello encoder SHOULD terminate hello HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="a6287-283">Длительные HTTP POST, которые не отправляют данные можно предотвратить быстро отключение от кодировщика hello hello события перезагрузки службы обновлений или сервера служб мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a6287-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update or server reboot.</span></span> <span data-ttu-id="a6287-284">В этих случаях hello сервера мультимедиа временно заблокирован в операции получения hello сокете.</span><span class="sxs-lookup"><span data-stu-id="a6287-284">In these cases, hello media server is temporarily blocked in a receive operation on hello socket.</span></span>
   
    <span data-ttu-id="a6287-285">c.</span><span class="sxs-lookup"><span data-stu-id="a6287-285">c.</span></span> <span data-ttu-id="a6287-286">Во время hello, когда передача сигналов данных недоступен кодировщик hello следует закрывать hello HTTP-запроса POST.</span><span class="sxs-lookup"><span data-stu-id="a6287-286">During hello time when signaling data is not available, hello encoder SHOULD close hello HTTP POST request.</span></span> <span data-ttu-id="a6287-287">Если запрос POST hello активен, hello кодировщик должен отправить данные.</span><span class="sxs-lookup"><span data-stu-id="a6287-287">While hello POST request is active, hello encoder SHOULD send data.</span></span>

    <span data-ttu-id="a6287-288">d.</span><span class="sxs-lookup"><span data-stu-id="a6287-288">d.</span></span> <span data-ttu-id="a6287-289">При отправке разреженных фрагментов, hello кодировщика можно задать явные заголовок content-length, если он доступен.</span><span class="sxs-lookup"><span data-stu-id="a6287-289">When sending sparse fragments, hello encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="a6287-290">д.</span><span class="sxs-lookup"><span data-stu-id="a6287-290">e.</span></span> <span data-ttu-id="a6287-291">При отправке разреженных фрагментов с новым соединением, кодировщик hello следует начать отправку из поля заголовка hello, следуют hello новых фрагментов.</span><span class="sxs-lookup"><span data-stu-id="a6287-291">When sending sparse fragments with a new connection, hello encoder SHOULD start sending from hello header boxes, followed by hello new fragments.</span></span> <span data-ttu-id="a6287-292">Это для случаев, в какие перехода на другой ресурс происходит в промежутке и новое подключение разреженных hello, установленного tooa новый сервер, который не обнаружил hello разреженную дорожку до.</span><span class="sxs-lookup"><span data-stu-id="a6287-292">This is for cases in which failover happens in-between, and hello new sparse connection is being established tooa new server that has not seen hello sparse track before.</span></span>

    <span data-ttu-id="a6287-293">f.</span><span class="sxs-lookup"><span data-stu-id="a6287-293">f.</span></span> <span data-ttu-id="a6287-294">фрагмент разреженную дорожку Hello становится доступной toohello клиента при hello соответствующий родительский отслеживания фрагмент, который имеет значение больше либо равно timestamp становится доступной toohello клиента.</span><span class="sxs-lookup"><span data-stu-id="a6287-294">hello sparse track fragment becomes available toohello client when hello corresponding parent track fragment that has an equal or larger timestamp value is made available toohello client.</span></span> <span data-ttu-id="a6287-295">Например, если фрагмент разреженных hello имеет отметку времени, t = 1000, ожидается, после hello клиент видит отметка времени 1000 фрагмента, «видео» (при условии, что имя отслеживания родительского hello «видео») или выше, можно загрузить hello разреженных фрагмент t = 1000.</span><span class="sxs-lookup"><span data-stu-id="a6287-295">For example, if hello sparse fragment has a timestamp of t=1000, it is expected that after hello client sees "video" (assuming hello parent track name is "video") fragment timestamp 1000 or beyond, it can download hello sparse fragment t=1000.</span></span> <span data-ttu-id="a6287-296">Обратите внимание, что hello фактическое сигнала может использоваться для временной шкалы hello представления в другое место для его указанной цели.</span><span class="sxs-lookup"><span data-stu-id="a6287-296">Note that hello actual signal could be used for a different position in hello presentation timeline for its designated purpose.</span></span> <span data-ttu-id="a6287-297">В этом примере он, возможно, что hello разреженных фрагмент t = 1000 содержит полезные данные XML, предназначенная для вставки рекламы в позиции, которая через несколько секунд позже.</span><span class="sxs-lookup"><span data-stu-id="a6287-297">In this example, it’s possible that hello sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="a6287-298">ж.</span><span class="sxs-lookup"><span data-stu-id="a6287-298">g.</span></span> <span data-ttu-id="a6287-299">полезные данные Hello разреженную дорожку фрагментов можно в различных форматах (например, XML, text или binary) в зависимости от сценария hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-299">hello payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on hello scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="a6287-300">Избыточная звуковая дорожка</span><span class="sxs-lookup"><span data-stu-id="a6287-300">Redundant audio track</span></span>
<span data-ttu-id="a6287-301">В типичном HTTP адаптивной потоковой передачи сценарии (например, Smooth Streaming или дефис) часто имеется только один звуковой дорожки hello всей презентации.</span><span class="sxs-lookup"><span data-stu-id="a6287-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in hello entire presentation.</span></span> <span data-ttu-id="a6287-302">В отличие от видеодорожек, которые имеют несколько уровней качества для toochoose клиента hello в состоянии ошибки, звуковая дорожка hello может быть одной точки сбоя, если hello приема hello потока, который содержит hello аудиодорожки разрывается.</span><span class="sxs-lookup"><span data-stu-id="a6287-302">Unlike video tracks, which have multiple quality levels for hello client toochoose from in error conditions, hello audio track can be a single point of failure if hello ingestion of hello stream that contains hello audio track is broken.</span></span> 

<span data-ttu-id="a6287-303">toosolve поддерживает эту проблему, Media Services live приема избыточных звуковых дорожек.</span><span class="sxs-lookup"><span data-stu-id="a6287-303">toosolve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="a6287-304">Hello идея заключается в том, hello же звуковой дорожки могут быть отосланы несколько раз в разных потоках.</span><span class="sxs-lookup"><span data-stu-id="a6287-304">hello idea is that hello same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="a6287-305">Несмотря на то, что hello служба регистрирует только звуковой дорожки hello один раз в манифест клиента hello, можно использовать избыточные звуковые дорожки как резервные копии для получения звуковых фрагментов, если основной аудиодорожки hello вызывает проблемы.</span><span class="sxs-lookup"><span data-stu-id="a6287-305">Although hello service only registers hello audio track once in hello client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if hello primary audio track has issues.</span></span> <span data-ttu-id="a6287-306">tooingest избыточных аудиодорожки hello кодировщик должен:</span><span class="sxs-lookup"><span data-stu-id="a6287-306">tooingest redundant audio tracks, hello encoder needs to:</span></span>

1. <span data-ttu-id="a6287-307">Создайте несколько фрагментов MP4 bitstreams же звуковая дорожка hello.</span><span class="sxs-lookup"><span data-stu-id="a6287-307">Create hello same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="a6287-308">Hello избыточных звуковые дорожки должны быть семантически эквивалентны, с hello же фрагмент отметки времени и взаимозаменяемыми уровне заголовок hello и фрагмент.</span><span class="sxs-lookup"><span data-stu-id="a6287-308">hello redundant audio tracks MUST be semantically equivalent, with hello same fragment timestamps, and be interchangeable at hello header and fragment levels.</span></span>
2. <span data-ttu-id="a6287-309">Убедитесь что hello «звук» запись в hello Live Server манифеста (раздел 6 в [1]) является hello одинаково для избыточных звуковые дорожки.</span><span class="sxs-lookup"><span data-stu-id="a6287-309">Ensure that hello “audio” entry in hello Live Server Manifest (Section 6 in [1]) is hello same for all redundant audio tracks.</span></span>

<span data-ttu-id="a6287-310">После реализации Hello рекомендуется для избыточных звуковые дорожки.</span><span class="sxs-lookup"><span data-stu-id="a6287-310">hello following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="a6287-311">Передавайте каждую уникальную звуковую дорожку в собственном потоке.</span><span class="sxs-lookup"><span data-stu-id="a6287-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="a6287-312">Кроме того, отправить избыточных поток для каждого из этих потоков звуковой дорожки, когда hello второго потока отличается от hello сначала только по идентификатору hello в hello HTTP POST на URL-адрес: {протокола}. :// {server-адрес} / {path}/Streams({identifier}) точка публикации.</span><span class="sxs-lookup"><span data-stu-id="a6287-312">Also, send a redundant stream for each of these audio track streams, where hello second stream differs from hello first only by hello identifier in hello HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="a6287-313">Используйте отдельные потоки toosend hello два наименьшее видео битрейтов.</span><span class="sxs-lookup"><span data-stu-id="a6287-313">Use separate streams toosend hello two lowest video bitrates.</span></span> <span data-ttu-id="a6287-314">В каждом из этих потоков СЛЕДУЕТ обеспечить наличие копии каждой уникальной звуковой дорожки. Например, при поддержке нескольких языков в эти потоки СЛЕДУЕТ включить звуковые дорожки для каждого языка.</span><span class="sxs-lookup"><span data-stu-id="a6287-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="a6287-315">Используйте tooencode экземпляров на отдельном сервере (кодировщика) и отправлять hello избыточных потоки, упомянутые в (1) и (2).</span><span class="sxs-lookup"><span data-stu-id="a6287-315">Use separate server (encoder) instances tooencode and send hello redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="a6287-316">Схемы обучения работе со службами мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a6287-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="a6287-317">Отзывы</span><span class="sxs-lookup"><span data-stu-id="a6287-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
