---
title: "Фильтры и динамические манифесты | Документация Майкрософт"
description: "В этом разделе описывается создание фильтров, с помощью которых клиент может передавать определенные секции потока. Для достижения такой выборочной потоковой передачи службы мультимедиа создают динамические манифесты."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: ff102765-8cee-4c08-a6da-b603db9e2054
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 4034fd0aa64627c107a43208dcca766f7f44d5d4
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="filters-and-dynamic-manifests"></a><span data-ttu-id="94fc4-104">Фильтры и динамические манифесты</span><span class="sxs-lookup"><span data-stu-id="94fc4-104">Filters and dynamic manifests</span></span>
<span data-ttu-id="94fc4-105">Начиная с версии 2.11, службы мультимедиа позволяют определять фильтры для активов.</span><span class="sxs-lookup"><span data-stu-id="94fc4-105">Starting with 2.11 release, Media Services enables you to define filters for your assets.</span></span> <span data-ttu-id="94fc4-106">Эти фильтры представляют собой правила на стороне сервера, позволяющие пользователям выполнять следующие действия: воспроизведение только части видео (вместо целого) или указание подмножества представлений аудио и видео, которые может обрабатывать устройство клиента (вместо всех представлений, связанных с активом).</span><span class="sxs-lookup"><span data-stu-id="94fc4-106">These filters are server side rules that will allow your customers to choose to do things like: playback only a section of a video (instead of playing the whole video), or specify only a subset of audio and video renditions that your customer's device can handle (instead of all the renditions that are associated with the asset).</span></span> <span data-ttu-id="94fc4-107">Такая фильтрация активов достигается с помощью **динамических манифестов**, которые создаются по запросу клиента для потоковой передачи видео на основе указанных фильтров.</span><span class="sxs-lookup"><span data-stu-id="94fc4-107">This filtering of your assets is archived through **Dynamic Manifest**s that are created upon your customer's request to stream a video based on specified filter(s).</span></span>

<span data-ttu-id="94fc4-108">В этом разделе обсуждаются распространенные сценарии, в которых использование фильтров принесет значительные преимущества вашим клиентам, и содержатся ссылки на статьи, демонстрирующие, как создавать фильтры программно (в настоящее время фильтры можно создавать только с помощью интерфейсов REST API).</span><span class="sxs-lookup"><span data-stu-id="94fc4-108">This topics discusses common scenarios in which using filters would be very beneficial to your customers and links to topics that demonstrate how to create filters programmatically (currently, you can create filters with REST APIs only).</span></span>

## <a name="overview"></a><span data-ttu-id="94fc4-109">Обзор</span><span class="sxs-lookup"><span data-stu-id="94fc4-109">Overview</span></span>
<span data-ttu-id="94fc4-110">При доставке содержимого клиентам (в виде потоковой трансляции событий в режиме реального времени или видео по запросу) ваша задача — доставлять видео высокого качества для различных устройств в разных сетевых условиях.</span><span class="sxs-lookup"><span data-stu-id="94fc4-110">When delivering your content to customers (streaming live events or video-on-demand) your goal is to deliver a high quality video to various devices under different network conditions.</span></span> <span data-ttu-id="94fc4-111">Для достижения этой цели необходимо сделать следующее:</span><span class="sxs-lookup"><span data-stu-id="94fc4-111">To achieve this goal do the following:</span></span>

* <span data-ttu-id="94fc4-112">закодировать видеопоток с разными скоростями ([с адаптивной скоростью](http://en.wikipedia.org/wiki/Adaptive_bitrate_streaming)) (что позволит справиться с условиями качества и сети) и</span><span class="sxs-lookup"><span data-stu-id="94fc4-112">encode your stream to multi-bitrate ([adaptive bitrate](http://en.wikipedia.org/wiki/Adaptive_bitrate_streaming)) video stream (this will take care of quality and network conditions) and</span></span> 
* <span data-ttu-id="94fc4-113">использовать [динамическую упаковку](media-services-dynamic-packaging-overview.md) служб мультимедиа для динамической перепаковки потока в разные протоколы (это позволит транслировать поток на разных устройствах).</span><span class="sxs-lookup"><span data-stu-id="94fc4-113">use Media Services [Dynamic Packaging](media-services-dynamic-packaging-overview.md) to dynamically re-package your stream into different protocols (this will take care of streaming on different devices).</span></span> <span data-ttu-id="94fc4-114">Службы мультимедиа поддерживают доставку данных в следующих форматах потоковой передачи с переменной скоростью: HTTP Live Streaming (HLS), Smooth Streaming и MPEG-DASH.</span><span class="sxs-lookup"><span data-stu-id="94fc4-114">Media Services supports delivery of the following adaptive bitrate streaming technologies: HTTP Live Streaming (HLS), Smooth Streaming, and MPEG DASH.</span></span> 

### <a name="manifest-files"></a><span data-ttu-id="94fc4-115">Файлы манифестов</span><span class="sxs-lookup"><span data-stu-id="94fc4-115">Manifest files</span></span>
<span data-ttu-id="94fc4-116">При кодировании актива для потоковой передачи с адаптивной скоростью создается файл **манифеста** (списка воспроизведения) (в основе файла — текст или XML).</span><span class="sxs-lookup"><span data-stu-id="94fc4-116">When you encode an asset for adaptive bitrate streaming, a **manifest** (playlist) file is created (the file is text-based or XML-based).</span></span> <span data-ttu-id="94fc4-117">Файл **манифеста** содержит потоковые метаданные, например тип дорожки (звук, видео или текст), имя дорожки, время начала и окончания, скорость (качество), языки дорожки, окно представления (скользящее окно фиксированной длительности), видеокодек (FourCC).</span><span class="sxs-lookup"><span data-stu-id="94fc4-117">The **manifest** file includes streaming metadata such as: track type (audio, video, or text), track name, start and end time, bitrate (qualities), track languages, presentation window (sliding window of fixed duration), video codec (FourCC).</span></span> <span data-ttu-id="94fc4-118">Также он предписывает проигрывателю получить следующий фрагмент, предоставляя информацию о следующих доступных для воспроизведения фрагментах видео и их расположении.</span><span class="sxs-lookup"><span data-stu-id="94fc4-118">It also instructs the player to retrieve the next fragment by providing information about the next playable video fragments available and their location.</span></span> <span data-ttu-id="94fc4-119">Фрагменты (или сегменты) — это фактические составные части видеосодержимого.</span><span class="sxs-lookup"><span data-stu-id="94fc4-119">Fragments (or segments) are the actual “chunks” of a video content.</span></span>

<span data-ttu-id="94fc4-120">Ниже приведен пример файла манифеста:</span><span class="sxs-lookup"><span data-stu-id="94fc4-120">Here is an example of a manifest file:</span></span> 

    <?xml version="1.0" encoding="UTF-8"?>    
    <SmoothStreamingMedia MajorVersion="2" MinorVersion="0" Duration="330187755" TimeScale="10000000">

    <StreamIndex Chunks="17" Type="video" Url="QualityLevels({bitrate})/Fragments(video={start time})" QualityLevels="8">
    <QualityLevel Index="0" Bitrate="5860941" FourCC="H264" MaxWidth="1920" MaxHeight="1080" CodecPrivateData="0000000167640028AC2CA501E0089F97015202020280000003008000001931300016E360000E4E1FF8C7076850A4580000000168E9093525" />
    <QualityLevel Index="1" Bitrate="4602724" FourCC="H264" MaxWidth="1920" MaxHeight="1080" CodecPrivateData="0000000167640028AC2CA501E0089F97015202020280000003008000001931100011EDC00002CD29FF8C7076850A45800000000168E9093525" />
    <QualityLevel Index="2" Bitrate="3319311" FourCC="H264" MaxWidth="1280" MaxHeight="720" CodecPrivateData="000000016764001FAC2CA5014016EC054808080A00000300020000030064C0800067C28000103667F8C7076850A4580000000168E9093525" />
    <QualityLevel Index="3" Bitrate="2195119" FourCC="H264" MaxWidth="960" MaxHeight="540" CodecPrivateData="000000016764001FAC2CA503C045FBC054808080A000000300200000064C1000044AA0000ABA9FE31C1DA14291600000000168E9093525" />
    <QualityLevel Index="4" Bitrate="1469881" FourCC="H264" MaxWidth="960" MaxHeight="540" CodecPrivateData="000000016764001FAC2CA503C045FBC054808080A000000300200000064C04000B71A0000E4E1FF8C7076850A4580000000168E9093525" />
    <QualityLevel Index="5" Bitrate="978815" FourCC="H264" MaxWidth="640" MaxHeight="360" CodecPrivateData="000000016764001EAC2CA50280BFE5C0548303032000000300200000064C08001E8480004C4B7F8C7076850A45800000000168E9093525" />
    <QualityLevel Index="6" Bitrate="638374" FourCC="H264" MaxWidth="640" MaxHeight="360" CodecPrivateData="000000016764001EAC2CA50280BFE5C0548303032000000300200000064C080013D60000C65DFE31C1DA1429160000000168E9093525" />
    <QualityLevel Index="7" Bitrate="388851" FourCC="H264" MaxWidth="320" MaxHeight="180" CodecPrivateData="000000016764000DAC2CA505067E7C054830303200000300020000030064C040030D40003D093F8C7076850A45800000000168E9093525" />

    <c t="0" d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="20000000" /><c d="9600000"/>
    </StreamIndex>


    <StreamIndex Chunks="17" Type="audio" Url="QualityLevels({bitrate})/Fragments(AAC_und_ch2_128kbps={start time})" QualityLevels="1" Name="AAC_und_ch2_128kbps">
    <QualityLevel AudioTag="255" Index="0" BitsPerSample="16" Bitrate="125658" FourCC="AACL" CodecPrivateData="1210" Channels="2" PacketSize="4" SamplingRate="44100" />

    <c t="0" d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="6965987" /></StreamIndex>


    <StreamIndex Chunks="17" Type="audio" Url="QualityLevels({bitrate})/Fragments(AAC_und_ch2_56kbps={start time})" QualityLevels="1" Name="AAC_und_ch2_56kbps">
    <QualityLevel AudioTag="255" Index="0" BitsPerSample="16" Bitrate="53655" FourCC="AACL" CodecPrivateData="1210" Channels="2" PacketSize="4" SamplingRate="44100" />

    <c t="0" d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201361" /><c d="20201360" /><c d="20201361" /><c d="20201360" /><c d="6965987" /></StreamIndex>

    </SmoothStreamingMedia>

### <a name="dynamic-manifests"></a><span data-ttu-id="94fc4-121">Динамические манифесты</span><span class="sxs-lookup"><span data-stu-id="94fc4-121">Dynamic manifests</span></span>
<span data-ttu-id="94fc4-122">Существуют [сценарии](media-services-dynamic-manifest-overview.md#scenarios) , когда клиенту требуется больше гибкости, чем описано в файле манифеста актива по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="94fc4-122">There are [scenarios](media-services-dynamic-manifest-overview.md#scenarios) when your client needs more flexibility than what's described in the default asset's manifest file.</span></span> <span data-ttu-id="94fc4-123">Например:</span><span class="sxs-lookup"><span data-stu-id="94fc4-123">For example:</span></span>

* <span data-ttu-id="94fc4-124">Для определенного устройства: доставка только указанных представлений и/или языков дорожек, поддерживаемых устройством, на котором воспроизводится содержимое ("фильтрация представлений").</span><span class="sxs-lookup"><span data-stu-id="94fc4-124">Device specific: deliver only the specified renditions and\or specified language tracks that are supported by the device that is used to playback the content ("rendition filtering").</span></span> 
* <span data-ttu-id="94fc4-125">Сокращение манифеста для отображения субклипа текущего события ("фильтрация субклипов").</span><span class="sxs-lookup"><span data-stu-id="94fc4-125">Reduce the manifest to show a sub-clip of a live event ("sub-clip filtering").</span></span>
* <span data-ttu-id="94fc4-126">Обрезка начала видео ("обрезка видео").</span><span class="sxs-lookup"><span data-stu-id="94fc4-126">Trim the start of a video ("trimming a video").</span></span>
* <span data-ttu-id="94fc4-127">Настройка окна представления (DVR) для предоставления ограниченной длительности окна DVR в проигрывателе ("настройка окна представления").</span><span class="sxs-lookup"><span data-stu-id="94fc4-127">Adjust Presentation Window (DVR) in order to provide a limited length of the DVR window in the player ("adjusting presentation window") .</span></span>

<span data-ttu-id="94fc4-128">Для достижения такой гибкости службы мультимедиа предоставляют **динамические манифесты** на основе предварительно определенных [фильтров](media-services-dynamic-manifest-overview.md#filters).</span><span class="sxs-lookup"><span data-stu-id="94fc4-128">To achieve this flexibility, Media Services offers **Dynamic Manifests** based on pre-defined [filters](media-services-dynamic-manifest-overview.md#filters).</span></span>  <span data-ttu-id="94fc4-129">После определения фильтров клиенты могут использовать их для потоковой передачи определенного представления или субклипов видео.</span><span class="sxs-lookup"><span data-stu-id="94fc4-129">Once you define the filters, your clients could use them to stream a specific rendition or sub-clips of your video.</span></span> <span data-ttu-id="94fc4-130">Фильтры указываются в URL-адресе потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="94fc4-130">They would specify filter(s) in the streaming URL.</span></span> <span data-ttu-id="94fc4-131">Фильтры можно применять к протоколам потоковой передачи с переменной скоростью, которые поддерживаются [динамической упаковкой](media-services-dynamic-packaging-overview.md): HLS, MPEG-DASH и Smooth Streaming.</span><span class="sxs-lookup"><span data-stu-id="94fc4-131">Filters could be applied to adaptive bitrate streaming protocols supported by [Dynamic Packaging](media-services-dynamic-packaging-overview.md): HLS, MPEG-DASH, and Smooth Streaming.</span></span> <span data-ttu-id="94fc4-132">Например:</span><span class="sxs-lookup"><span data-stu-id="94fc4-132">For example:</span></span>

<span data-ttu-id="94fc4-133">URL-адрес MPEG DASH с фильтром</span><span class="sxs-lookup"><span data-stu-id="94fc4-133">MPEG DASH URL with filter</span></span>

    http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=mpd-time-csf,filter=MyLocalFilter)

<span data-ttu-id="94fc4-134">URL-адрес Smooth Streaming с фильтром</span><span class="sxs-lookup"><span data-stu-id="94fc4-134">Smooth Streaming URL with filter</span></span>

    http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(filter=MyLocalFilter)


<span data-ttu-id="94fc4-135">Дополнительные сведения о способах доставки содержимого и построения URL-адресов потоковой передачи см. в статье [Доставка содержимого клиентам](media-services-deliver-content-overview.md).</span><span class="sxs-lookup"><span data-stu-id="94fc4-135">For more information about how to deliver your content and build streaming URLs, see [Delivering content overview](media-services-deliver-content-overview.md).</span></span>

> [!NOTE]
> <span data-ttu-id="94fc4-136">Обратите внимание, что динамические манифесты не изменяют актив и его манифест по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="94fc4-136">Note that Dynamic Manifests do not change the asset and the default manifest for that asset.</span></span> <span data-ttu-id="94fc4-137">Клиент может запросить поток с фильтрами или без них.</span><span class="sxs-lookup"><span data-stu-id="94fc4-137">Your client can choose to request a stream with or without filters.</span></span> 
> 
> 

### <span data-ttu-id="94fc4-138"><a id="filters"></a>Фильтры</span><span class="sxs-lookup"><span data-stu-id="94fc4-138"><a id="filters"></a>Filters</span></span>
<span data-ttu-id="94fc4-139">Существуют два типа фильтров активов.</span><span class="sxs-lookup"><span data-stu-id="94fc4-139">There are two types of asset filters:</span></span> 

* <span data-ttu-id="94fc4-140">Глобальные фильтры (могут применяться к любому активу в учетной записи служб мультимедиа Azure, имеют срок существования учетной записи).</span><span class="sxs-lookup"><span data-stu-id="94fc4-140">Global filters (can be applied to any asset in the Azure Media Services account, have a lifetime of the account) and</span></span> 
* <span data-ttu-id="94fc4-141">Локальные фильтры (могут применяться только к активу, с которым фильтр был связан при создании, имеют срок существования актива).</span><span class="sxs-lookup"><span data-stu-id="94fc4-141">Local filters (can only be applied to an asset with which the filter was associated upon creation, have a lifetime of the asset).</span></span> 

<span data-ttu-id="94fc4-142">Глобальные и локальные типы фильтров обладают в точности одинаковыми свойствами.</span><span class="sxs-lookup"><span data-stu-id="94fc4-142">Global and local filter types have exactly the same properties.</span></span> <span data-ttu-id="94fc4-143">Основное различие между ними — в сценариях, к которым более подходит тот или иной тип фильтра.</span><span class="sxs-lookup"><span data-stu-id="94fc4-143">The main difference between the two is for which scenarios what type of a filer is more suitable.</span></span> <span data-ttu-id="94fc4-144">Глобальные фильтры обычно подходят для профилей устройств (фильтрация представлений), в то время как локальные могут использоваться для обрезки определенного актива.</span><span class="sxs-lookup"><span data-stu-id="94fc4-144">Global filters are generally suitable for device profiles (rendition filtering) where local filters could be used to trim a specific asset.</span></span>

## <span data-ttu-id="94fc4-145"><a id="scenarios"></a>Распространенные сценарии</span><span class="sxs-lookup"><span data-stu-id="94fc4-145"><a id="scenarios"></a>Common scenarios</span></span>
<span data-ttu-id="94fc4-146">Как уже было сказано прежде, при доставке содержимого клиентам (в виде потоковой трансляции событий в режиме реального времени или видео по запросу) вашей целью является доставка видео высокого качества для различных устройств в разных сетевых условиях.</span><span class="sxs-lookup"><span data-stu-id="94fc4-146">As was mentioned before, when delivering your content to customers (streaming live events or video-on-demand) your goal is to deliver a high quality video to various devices under different network conditions.</span></span> <span data-ttu-id="94fc4-147">Кроме этого, возможны и другие требования, задействующие фильтрацию активов и использование **динамических манифестов**.</span><span class="sxs-lookup"><span data-stu-id="94fc4-147">In addition, your might have other requirements that involve filtering your assets and using of **Dynamic Manifest**s.</span></span> <span data-ttu-id="94fc4-148">В следующих разделах содержится краткий обзор различных сценариев фильтрации.</span><span class="sxs-lookup"><span data-stu-id="94fc4-148">The following sections give a short overview of different filtering scenarios.</span></span>

* <span data-ttu-id="94fc4-149">Указание только части представлений аудио и видео, которые могут обрабатываться определенными устройствами (вместо всех представлений, связанных с активом).</span><span class="sxs-lookup"><span data-stu-id="94fc4-149">Specify only a subset of audio and video renditions that certain devices can handle (instead of all the renditions that are associated with the asset).</span></span> 
* <span data-ttu-id="94fc4-150">Воспроизведение только части видео (вместо воспроизведения видео целиком).</span><span class="sxs-lookup"><span data-stu-id="94fc4-150">Playing back only a section of a video (instead of playing the whole video).</span></span>
* <span data-ttu-id="94fc4-151">Настройка окна представления DVR.</span><span class="sxs-lookup"><span data-stu-id="94fc4-151">Adjust DVR presentation window.</span></span>

## <a name="rendition-filtering"></a><span data-ttu-id="94fc4-152">Фильтрация представлений</span><span class="sxs-lookup"><span data-stu-id="94fc4-152">Rendition filtering</span></span>
<span data-ttu-id="94fc4-153">По выбору можно закодировать актив в несколько профилей кодирования (H.264 Baseline, H.264 High, AACL, AACH, Dolby Digital Plus) и с несколькими значениями скорости потока и соответственно качества.</span><span class="sxs-lookup"><span data-stu-id="94fc4-153">You may choose to encode your asset to multiple encoding profiles (H.264 Baseline, H.264 High, AACL, AACH, Dolby Digital Plus) and multiple quality bitrates.</span></span> <span data-ttu-id="94fc4-154">Однако не все клиентские устройства будут поддерживать все профили и скорости потока вашего актива.</span><span class="sxs-lookup"><span data-stu-id="94fc4-154">However, not all client devices will support all your asset's profiles and bitrates.</span></span> <span data-ttu-id="94fc4-155">Например, старые устройства Android поддерживают только H.264 Baseline+AACL.</span><span class="sxs-lookup"><span data-stu-id="94fc4-155">For example, older Android devices only supports H.264 Baseline+AACL.</span></span> <span data-ttu-id="94fc4-156">Отправка высоких скоростей потока на устройство, которое не способно получить их преимущества, приводит к трате излишней пропускной способности и вычислительных ресурсов устройства.</span><span class="sxs-lookup"><span data-stu-id="94fc4-156">Sending higher bitrates to a device which cannot get the benefits, wastes bandwidth and device computation.</span></span> <span data-ttu-id="94fc4-157">Такое устройство должно декодировать всю заданную информацию только для того, чтобы уменьшать ее масштаб для отображения.</span><span class="sxs-lookup"><span data-stu-id="94fc4-157">Such device must decode all the given information, only to scale it down for display.</span></span>

<span data-ttu-id="94fc4-158">С помощью динамического манифеста можно создать профили устройств, например мобильных устройств, консолей, HD/SD и т. д., и включить в них дорожки и варианты качества, которые следует сделать частью каждого из профилей.</span><span class="sxs-lookup"><span data-stu-id="94fc4-158">With Dynamic Manifest, you can create device profiles such as mobile, console, HD/SD, etc. and include the tracks and qualities which you want to be a part of each profile.</span></span>

![Пример фильтрации представлений][renditions2]

<span data-ttu-id="94fc4-160">В следующем примере использовался кодировщик для кодирования промежуточного актива в семь MP4-видеофайлов стандарта ISO (с разрешением от 180p до 1080p).</span><span class="sxs-lookup"><span data-stu-id="94fc4-160">In the following example, an encoder was used to encode a mezzanine asset into seven ISO MP4s video renditions (from 180p to 1080p).</span></span> <span data-ttu-id="94fc4-161">Закодированный ресурс можно динамически упаковать в любой из следующих потоковых протоколов: HLS, Smooth Streaming и MPEG-DASH.</span><span class="sxs-lookup"><span data-stu-id="94fc4-161">The encoded asset can be dynamically packaged into any of the following streaming protocols: HLS, Smooth, and MPEG DASH.</span></span>  <span data-ttu-id="94fc4-162">В верхней части схемы показан манифест HLS манифеста для актива без фильтров (он содержит все семь представлений).</span><span class="sxs-lookup"><span data-stu-id="94fc4-162">At the top of the diagram, the HLS manifest for the asset with no filters is shown (it contains all seven renditions).</span></span>  <span data-ttu-id="94fc4-163">В левом нижнем углу показан манифест HLS, к которому был применен фильтр с именем ott.</span><span class="sxs-lookup"><span data-stu-id="94fc4-163">In the bottom left, the HLS manifest to which a filter named "ott" was applied is shown.</span></span> <span data-ttu-id="94fc4-164">Фильтр ott предписывает удалить все варианты скорости потока ниже 1 Мбит/с, что ведет к исключению двух нижних уровней качества.</span><span class="sxs-lookup"><span data-stu-id="94fc4-164">The "ott" filter specifies to remove all bitrates below 1Mbps, which resulted in the bottom two quality levels being stripped off in the response.</span></span>  <span data-ttu-id="94fc4-165">В правом нижнем углу показан манифест HLS, к которому был применен фильтр с именем mobile.</span><span class="sxs-lookup"><span data-stu-id="94fc4-165">In the bottom right,   the HLS manifest to which a filter named "mobile" was applied is shown.</span></span> <span data-ttu-id="94fc4-166">Фильтр mobile предписывает удалить представления, где разрешение больше 720p, что ведет к исключению двух представлений с разрешением 1080p.</span><span class="sxs-lookup"><span data-stu-id="94fc4-166">The "mobile" filter specifies to remove renditions where the resolution is larger than 720p, which resulted in the two 1080p renditions being stripped off.</span></span>

![Фильтрация представлений][renditions1]

## <a name="removing-language-tracks"></a><span data-ttu-id="94fc4-168">Удаление языковых дорожек</span><span class="sxs-lookup"><span data-stu-id="94fc4-168">Removing language tracks</span></span>
<span data-ttu-id="94fc4-169">Активы могут содержать аудиодорожки на нескольких языках, например английском, испанском, французском и т. д. Как правило, пакет SDK проигрывателя управляет выбором аудиодорожки по умолчанию и доступными на выбор пользователя аудиодорожками.</span><span class="sxs-lookup"><span data-stu-id="94fc4-169">Your assets might include multiple audio languages such as English, Spanish, French, etc. Usually, the Player SDK managers default audio track selection and available audio tracks per user selection.</span></span> <span data-ttu-id="94fc4-170">Такие пакеты SDK для проигрывателей разрабатывать сложно, они требуют разных реализаций для разных платформ проигрывателей на конкретных устройствах.</span><span class="sxs-lookup"><span data-stu-id="94fc4-170">It is challenging to develop such Player SDKs, it requires different implementations across device-specific player-frameworks.</span></span> <span data-ttu-id="94fc4-171">Кроме того, на некоторых платформах API-интерфейсы проигрывателей ограничены и не включают функции выбора звука, когда пользователи не могут выбрать или изменить установленную по умолчанию звуковую дорожку. С помощью фильтров активов можно управлять поведением проигрывателей, создавая фильтры с включением только нужных языков аудио.</span><span class="sxs-lookup"><span data-stu-id="94fc4-171">Also, on some platforms, Player APIs are limited and do not include audio selection feature where users cannot select or change the default audio track. With asset filters, you can control the behavior by creating filters that only include desired audio languages.</span></span>

![Фильтрация языковых дорожек][language_filter]

## <a name="trimming-start-of-an-asset"></a><span data-ttu-id="94fc4-173">Обрезка начала актива</span><span class="sxs-lookup"><span data-stu-id="94fc4-173">Trimming start of an asset</span></span>
<span data-ttu-id="94fc4-174">При большинстве событий потоковой трансляции в реальном времени операторы проводят процедуры тестирования до фактического события.</span><span class="sxs-lookup"><span data-stu-id="94fc4-174">In most live streaming events, operators run some tests before the actual event.</span></span> <span data-ttu-id="94fc4-175">Например, перед началом события они могут включить заставку: "Программа начнется очень скоро".</span><span class="sxs-lookup"><span data-stu-id="94fc4-175">For example, they might include a slate like this before the start of the event: "Program will begin momentarily".</span></span> <span data-ttu-id="94fc4-176">При архивировании программы данные проверок и заставок также будут архивированы и включены в представление.</span><span class="sxs-lookup"><span data-stu-id="94fc4-176">If the program is archiving, the test and slate data are also archived and will be included in the presentation.</span></span> <span data-ttu-id="94fc4-177">Однако эту информацию не следует отображать клиентам.</span><span class="sxs-lookup"><span data-stu-id="94fc4-177">However, this information should not be shown to the clients.</span></span> <span data-ttu-id="94fc4-178">С помощью динамического манифеста можно создать фильтр времени начала и удалить ненужные данные из манифеста.</span><span class="sxs-lookup"><span data-stu-id="94fc4-178">With Dynamic Manifest, you can create a start time filter and remove the unwanted data from the manifest.</span></span>

![Начало обрезки][trim_filter]

## <a name="creating-sub-clips-views-from-a-live-archive"></a><span data-ttu-id="94fc4-180">Создание субклипов (представлений) из текущего архива</span><span class="sxs-lookup"><span data-stu-id="94fc4-180">Creating sub-clips (views) from a live archive</span></span>
<span data-ttu-id="94fc4-181">Многие текущие события являются длительными, и их текущий архив может включать в себя несколько событий.</span><span class="sxs-lookup"><span data-stu-id="94fc4-181">Many live events are long running and live archive might include multiple events.</span></span> <span data-ttu-id="94fc4-182">После окончания текущего события вещателям может потребоваться разбить текущий архив на логические последовательности начала и остановки программ.</span><span class="sxs-lookup"><span data-stu-id="94fc4-182">After the live event ends broadcasters may want to break up the live archive into logical program start and stop sequences.</span></span> <span data-ttu-id="94fc4-183">Затем нужно опубликовать эти виртуальные программы отдельно без последующей обработки текущего архива и без создания отдельных активов (что не позволит воспользоваться преимуществами существующих кэшированных фрагментов в CDN).</span><span class="sxs-lookup"><span data-stu-id="94fc4-183">Then, publish these virtual programs separately without post processing the live archive and not creating separate assets (which will not get benefit of the existing cached fragments in the CDNs).</span></span> <span data-ttu-id="94fc4-184">Примерами таких виртуальных программ (субклипов) являются четверти при игре в американский футбол или баскетбол, иннинги в бейсболе или отдельные события вечера программы Олимпийских игр.</span><span class="sxs-lookup"><span data-stu-id="94fc4-184">Examples of such virtual programs (sub-clips) are the quarters of a football or basketball game, the innings in baseball, or individual events of an afternoon of Olympics program.</span></span>

<span data-ttu-id="94fc4-185">С помощью динамического манифеста можно создавать фильтры с указанием времени начала и окончания, а также создавать виртуальные представления поверх текущего архива.</span><span class="sxs-lookup"><span data-stu-id="94fc4-185">With Dynamic Manifest, you can create filters using start/end times and create virtual views over the top of your live archive.</span></span> 

![Фильтр субклипа][subclip_filter]

<span data-ttu-id="94fc4-187">Фильтрованный архив:</span><span class="sxs-lookup"><span data-stu-id="94fc4-187">Filtered Asset:</span></span>

![Лыжный спорт][skiing]

## <a name="adjusting-presentation-window-dvr"></a><span data-ttu-id="94fc4-189">Настройка окна презентации (DVR)</span><span class="sxs-lookup"><span data-stu-id="94fc4-189">Adjusting Presentation Window (DVR)</span></span>
<span data-ttu-id="94fc4-190">В настоящее время службы мультимедиа Azure поддерживают циклический архив, продолжительность которого можно настроить от 5 минут до 25 часов.</span><span class="sxs-lookup"><span data-stu-id="94fc4-190">Currently, Azure Media Services offers circular archive where the duration can be configured between 5 minutes - 25 hours.</span></span> <span data-ttu-id="94fc4-191">Фильтрация манифеста позволяет создать скользящее окно DVR поверх архива, без удаления медиаданных.</span><span class="sxs-lookup"><span data-stu-id="94fc4-191">Manifest filtering can be used to create a rolling DVR window over the top of the archive, without deleting media.</span></span> <span data-ttu-id="94fc4-192">Существует множество сценариев, где вещателям требуется предоставить ограниченное окно DVR, которое перемещается вместе с текущей границей, и в то же время поддерживать более крупное окно архивации.</span><span class="sxs-lookup"><span data-stu-id="94fc4-192">There are many scenarios where broadcasters want to provide a limited DVR window which moves with the live edge and at the same time keep a bigger archiving window.</span></span> <span data-ttu-id="94fc4-193">Вещателю может понадобиться использовать данные, находящиеся за пределами окна DVR, для выделения клипов, или же предоставлять разные окна DVR для различных устройств.</span><span class="sxs-lookup"><span data-stu-id="94fc4-193">A broadcaster may want to use the data that is out of the DVR window to highlight clips, or he\she may want to provide different DVR windows for different devices.</span></span> <span data-ttu-id="94fc4-194">Например, большинство мобильных устройств не обрабатывает большие окна DVR (для мобильных устройств можно установить 2-минутное окно DVR, а для настольных клиентов — продолжительностью в 1 час).</span><span class="sxs-lookup"><span data-stu-id="94fc4-194">For example, most of the mobile devices don’t handle big DVR windows (you can have a 2 minute DVR window for mobile devices and 1 hour for desktop clients).</span></span>

![Окно DVR][dvr_filter]

## <a name="adjusting-livebackoff-live-position"></a><span data-ttu-id="94fc4-196">Настройка LiveBackoff (динамической позиции)</span><span class="sxs-lookup"><span data-stu-id="94fc4-196">Adjusting LiveBackoff (live position)</span></span>
<span data-ttu-id="94fc4-197">Фильтрация манифеста позволяет удалить несколько секунд с динамической границы текущей программы.</span><span class="sxs-lookup"><span data-stu-id="94fc4-197">Manifest filtering can be used to remove several seconds from the live edge of a live program.</span></span> <span data-ttu-id="94fc4-198">Это позволяет вещателям просматривать представление в точке предварительной публикации и создавать точки вставки рекламы до того, как зрители получат поток (обычно резерв составляет 30 секунд).</span><span class="sxs-lookup"><span data-stu-id="94fc4-198">This allows broadcasters to watch the presentation on the preview publication point and create advertisement insertion points before the viewers receive the stream (usually backed-off by 30 seconds).</span></span> <span data-ttu-id="94fc4-199">Затем вещатели могут передавать рекламу на клиентские платформы, располагая временем для получения и обработки информации до появления возможности для рекламы.</span><span class="sxs-lookup"><span data-stu-id="94fc4-199">Broadcasters can then push these advertisements to their client frameworks in time for them to received and process the information before the advertisement opportunity.</span></span>

<span data-ttu-id="94fc4-200">Помимо поддержки рекламы, функция LiveBackoff позволяет регулировать позицию загрузки текущего потока клиентами, благодаря чему даже если клиенты переместятся и достигнут текущей границы, они все равно смогут получать фрагменты с сервера вместо ошибок HTTP 404 или 412.</span><span class="sxs-lookup"><span data-stu-id="94fc4-200">In addition to the advertisement support, LiveBackoff can be used for adjusting client live download position so that when clients drift and hit the live edge they can still get fragments from server instead of getting 404 or 412 HTTP errors.</span></span>

![livebackoff_filter][livebackoff_filter]

## <a name="combining-multiple-rules-in-a-single-filter"></a><span data-ttu-id="94fc4-202">Объединение нескольких правил в одном фильтре</span><span class="sxs-lookup"><span data-stu-id="94fc4-202">Combining multiple rules in a single filter</span></span>
<span data-ttu-id="94fc4-203">В одном фильтре можно объединить несколько правил фильтрации.</span><span class="sxs-lookup"><span data-stu-id="94fc4-203">You can combine multiple filtering rules in a single filter.</span></span> <span data-ttu-id="94fc4-204">В качестве примера можно определить правило диапазона для удаления заставки из текущего архива, а также для фильтрации доступных скоростей потока.</span><span class="sxs-lookup"><span data-stu-id="94fc4-204">As an example you can define a range rule to remove slate from a live archive and also filter available bitrates.</span></span> <span data-ttu-id="94fc4-205">Для нескольких правил фильтрации конечным результатом является композиция (только пересечение) этих правил.</span><span class="sxs-lookup"><span data-stu-id="94fc4-205">For multiple filtering rules the end result is the composition (intersection only) of these rules.</span></span>

![multiple-rules][multiple-rules]

## <a name="create-filters-programmatically"></a><span data-ttu-id="94fc4-207">Программное создание фильтров</span><span class="sxs-lookup"><span data-stu-id="94fc4-207">Create filters programmatically</span></span>
<span data-ttu-id="94fc4-208">В следующем разделе обсуждаются сущности служб мультимедиа, которые связаны с фильтрами.</span><span class="sxs-lookup"><span data-stu-id="94fc4-208">The following topic discusses Media Services entities that are related to filters.</span></span> <span data-ttu-id="94fc4-209">В разделе также показано, как создавать фильтры программным путем.</span><span class="sxs-lookup"><span data-stu-id="94fc4-209">The topic also shows how to programmatically create filters.</span></span>  

<span data-ttu-id="94fc4-210">[Создание фильтров с помощью интерфейсов REST API](media-services-rest-dynamic-manifest.md).</span><span class="sxs-lookup"><span data-stu-id="94fc4-210">[Create filters with REST APIs](media-services-rest-dynamic-manifest.md).</span></span>

## <a name="combining-multiple-filters-filter-composition"></a><span data-ttu-id="94fc4-211">Объединение нескольких фильтров (сложение фильтров)</span><span class="sxs-lookup"><span data-stu-id="94fc4-211">Combining multiple filters (filter composition)</span></span>
<span data-ttu-id="94fc4-212">Кроме того, вы можете объединять несколько фильтров в одном URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="94fc4-212">You can also combine multiple filters in a single URL.</span></span> 

<span data-ttu-id="94fc4-213">В следующем сценарии показано, для чего могут потребоваться подобные фильтры:</span><span class="sxs-lookup"><span data-stu-id="94fc4-213">The following scenario demonstrates why you might want to combine filters:</span></span>

1. <span data-ttu-id="94fc4-214">При необходимости отфильтровать качество видео для мобильных устройств, например, Android или iPAD (для ограничения качества видео).</span><span class="sxs-lookup"><span data-stu-id="94fc4-214">You need to filter your video qualities for mobile devices such as Android or iPAD (in order to limit video qualities).</span></span> <span data-ttu-id="94fc4-215">Чтобы удалить содержимое нежелательного качества, вы могли бы создать глобальный фильтр, который подходит для профилей устройств.</span><span class="sxs-lookup"><span data-stu-id="94fc4-215">To remove the unwanted qualities, you would create a global filter which is suitable for device profiles.</span></span> <span data-ttu-id="94fc4-216">Как упоминалось выше, глобальные фильтры можно использовать для всех ресурс-контейнеров в одной учетной записи служб мультимедиа без каких-либо дополнительных связей.</span><span class="sxs-lookup"><span data-stu-id="94fc4-216">As mentioned above, global filters can be used for all your assets under the same media services account without any further association.</span></span> 
2. <span data-ttu-id="94fc4-217">При необходимости обрезать время начала и окончания ресурс-контейнера.</span><span class="sxs-lookup"><span data-stu-id="94fc4-217">You also want to trim the start and end time of an asset.</span></span> <span data-ttu-id="94fc4-218">Для этого можно создать локальный фильтр и задать время начала и окончания.</span><span class="sxs-lookup"><span data-stu-id="94fc4-218">To achieve this, you would create a local filter and set the start/end time.</span></span> 
3. <span data-ttu-id="94fc4-219">При необходимости объединить оба этих фильтра. Без объединения вам потребуется добавить фильтрацию качества в фильтр обрезки, что может затруднить использование фильтра.</span><span class="sxs-lookup"><span data-stu-id="94fc4-219">You want to combine both of these filters (without combination you would need to add quality filtering to the trimming filter which will make filter usage difficult).</span></span>

<span data-ttu-id="94fc4-220">Для объединения фильтров необходимо указать их имена в URL-адресе манифеста или списка воспроизведения через точку с запятой.</span><span class="sxs-lookup"><span data-stu-id="94fc4-220">To combine filters, you need to set the filter names to the manifest/playlist URL with semicolon delimited.</span></span> <span data-ttu-id="94fc4-221">Допустим, у вас есть фильтр качества с именем *MyMobileDevice* и фильтр *MyStartTime* для выбора конкретного времени начала.</span><span class="sxs-lookup"><span data-stu-id="94fc4-221">Let’s assume you have a filter named *MyMobileDevice* that filters qualities and you have another named *MyStartTime* to set a specific start time.</span></span> <span data-ttu-id="94fc4-222">Их можно объединить следующим образом:</span><span class="sxs-lookup"><span data-stu-id="94fc4-222">You can combine them like this:</span></span>

    http://teststreaming.streaming.mediaservices.windows.net/3d56a4d-b71d-489b-854f-1d67c0596966/64ff1f89-b430-43f8-87dd-56c87b7bd9e2.ism/Manifest(filter=MyMobileDevice;MyStartTime)

<span data-ttu-id="94fc4-223">Можно объединять до трех фильтров.</span><span class="sxs-lookup"><span data-stu-id="94fc4-223">You can combine up to 3 filters.</span></span> 

<span data-ttu-id="94fc4-224">Дополнительную информацию см. в [этом блоге](https://azure.microsoft.com/blog/azure-media-services-release-dynamic-manifest-composition-remove-hls-audio-only-track-and-hls-i-frame-track-support/).</span><span class="sxs-lookup"><span data-stu-id="94fc4-224">For more information see [this](https://azure.microsoft.com/blog/azure-media-services-release-dynamic-manifest-composition-remove-hls-audio-only-track-and-hls-i-frame-track-support/) blog.</span></span>

## <a name="know-issues-and-limitations"></a><span data-ttu-id="94fc4-225">Известные проблемы и ограничения</span><span class="sxs-lookup"><span data-stu-id="94fc4-225">Know issues and limitations</span></span>
* <span data-ttu-id="94fc4-226">Динамический манифест работает в пределах GOP (по ключевым кадрам), поэтому обрезка производится с точностью GOP.</span><span class="sxs-lookup"><span data-stu-id="94fc4-226">Dynamic manifest operates in GOP boundaries (Key Frames) hence trimming has GOP accuracy.</span></span> 
* <span data-ttu-id="94fc4-227">Одно и то же имя фильтра можно использовать для локальных и глобальных фильтров.</span><span class="sxs-lookup"><span data-stu-id="94fc4-227">You can use same filter name for local and global filters.</span></span> <span data-ttu-id="94fc4-228">Обратите внимание, что локальный фильтр имеет более высокий приоритет и переопределяет глобальные фильтры.</span><span class="sxs-lookup"><span data-stu-id="94fc4-228">Note that local filter have higher precedence and will override global filters.</span></span>
* <span data-ttu-id="94fc4-229">При обновлении фильтра может понадобиться до 2 минут на обновление правил конечной точкой потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="94fc4-229">If you update a filter, it can take up to 2 minutes for streaming endpoint to refresh the rules.</span></span> <span data-ttu-id="94fc4-230">Если содержимое было обработано с помощью каких-либо фильтров (и кэшировано на прокси-серверах и в кэшах CDN), обновление этих фильтров может привести к сбоям проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="94fc4-230">If the content was served using some filters (and cached in proxies and CDN caches), updating these filters can result in player failures.</span></span> <span data-ttu-id="94fc4-231">Рекомендуется очистить кэш после обновления фильтра.</span><span class="sxs-lookup"><span data-stu-id="94fc4-231">It is recommend to clear the cache after updating the filter.</span></span> <span data-ttu-id="94fc4-232">Если такой вариант невозможен, рассмотрите возможность использования другого фильтра.</span><span class="sxs-lookup"><span data-stu-id="94fc4-232">If this option is not possible, consider using a different filter.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="94fc4-233">Схемы обучения работе со службами мультимедиа</span><span class="sxs-lookup"><span data-stu-id="94fc4-233">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="94fc4-234">Отзывы</span><span class="sxs-lookup"><span data-stu-id="94fc4-234">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

## <a name="see-also"></a><span data-ttu-id="94fc4-235">См. также</span><span class="sxs-lookup"><span data-stu-id="94fc4-235">See Also</span></span>
[<span data-ttu-id="94fc4-236">Обзор доставки содержимого клиентам</span><span class="sxs-lookup"><span data-stu-id="94fc4-236">Delivering Content to Customers Overview</span></span>](media-services-deliver-content-overview.md)

[renditions1]: ./media/media-services-dynamic-manifest-overview/media-services-rendition-filter.png
[renditions2]: ./media/media-services-dynamic-manifest-overview/media-services-rendition-filter2.png

[rendered_subclip]: ./media/media-services-dynamic-manifests/media-services-rendered-subclip.png
[timeline_trim_event]: ./media/media-services-dynamic-manifests/media-services-timeline-trim-event.png
[timeline_trim_subclip]: ./media/media-services-dynamic-manifests/media-services-timeline-trim-subclip.png

[multiple-rules]:./media/media-services-dynamic-manifest-overview/media-services-multiple-rules-filters.png

[subclip_filter]: ./media/media-services-dynamic-manifest-overview/media-services-subclips-filter.png
[trim_event]: ./media/media-services-dynamic-manifests/media-services-timeline-trim-event.png
[trim_subclip]: ./media/media-services-dynamic-manifests/media-services-timeline-trim-subclip.png
[trim_filter]: ./media/media-services-dynamic-manifest-overview/media-services-trim-filter.png
[redered_subclip]: ./media/media-services-dynamic-manifests/media-services-rendered-subclip.png
[livebackoff_filter]: ./media/media-services-dynamic-manifest-overview/media-services-livebackoff-filter.png
[language_filter]: ./media/media-services-dynamic-manifest-overview/media-services-language-filter.png
[dvr_filter]: ./media/media-services-dynamic-manifest-overview/media-services-dvr-filter.png
[skiing]: ./media/media-services-dynamic-manifest-overview/media-services-skiing.png
