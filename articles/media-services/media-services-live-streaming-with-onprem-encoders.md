---
title: "aaaStream live с локальных кодировщиков, которые создают потоки многоскоростной - Azure | Документы Microsoft"
description: "Описывается, как tooset канал, принимающий многоскоростной динамический поток из кодировщика в локальной среде. Hello поток может затем быть доставлен tooclient воспроизведения приложений через один или несколько конечных точек потоковой передачи, с помощью одного из hello следующие протоколы адаптивной потоковой передачи: HLS, Smooth Streaming, DASH."
services: media-services
documentationcenter: 
author: Juliako
manager: cfowler
editor: 
ms.assetid: d9f0912d-39ec-4c9c-817b-e5d9fcf1f7ea
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 04/12/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 00709cecfc3b5b5dcfaa8f1e4b25bcf9d470d50b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="live-streaming-with-on-premises-encoders-that-create-multi-bitrate-streams"></a>Потоковая трансляция с помощью локальных кодировщиков, создающих потоки с разными скоростями
## <a name="overview"></a>Обзор
В службах мультимедиа Azure *канал* представляет собой конвейер для обработки контента, передаваемого в потоковом режиме. Канал получает входные потоки одним из двух способов.

* Локальный динамический кодировщик отправляет многоскоростной RTMP или Smooth Streaming (фрагментированный MP4) поток toohello канал, не включена tooperform live кодирования с помощью служб мультимедиа. Hello полученный потоки проход через каналы без дополнительной обработки. Этот способ называется *сквозной передачей*. Можно использовать следующие динамические кодировщики, иметь в качестве выходных данных Smooth Streaming с несколькими скоростями hello: Excel мультимедиа, Ateme, представьте себе связи, Envivio, Cisco и кодировщики Elemental. следующие динамические кодировщики Hello имеют RTMP в качестве выходных данных: Adobe Flash Live кодировщика мультимедиа, Telestream Wirecast, Haivision, Teradek и TriCaster. Динамический кодировщик также можно отправлять канала tooa скоростями одного потока, не включена для динамического кодирования, но не рекомендуется. Службы мультимедиа доставляют toocustomers поток hello, запросить его.

  > [!NOTE]
  > С помощью сквозной метода является наиболее экономичным способом hello toodo динамической потоковой передачи.


* Локальный динамический кодировщик отправляет скоростями один поток toohello канала включена динамического кодирования с помощью служб мультимедиа в одном из следующих форматов hello tooperform: RTP (MPEG-TS), RTMP или Smooth Streaming (фрагментированный MP4). канал Hello выполняет динамическое кодирование hello входящих скоростями один поток tooa многоскоростной (адаптивный) видеопоток. Службы мультимедиа доставляют toocustomers поток hello, запросить его.

Начиная с версии 2.10 служб мультимедиа hello, при создании канала, можно указать способ канала tooreceive потока входных данных hello. Можно также указать, следует ли tooperform канала hello динамического кодирования этого потока. Существует два варианта.

* **Пропуск**: задайте это значение, если планируется toouse на локальный динамический кодировщик, будет иметь многоскоростной поток (сквозной поток) в качестве выходных данных. В этом случае входящий поток hello проходит через toohello выходные данные без какой-либо кодировке. Это поведение канала до выпуска hello 2.10 hello. В этой статье приведены подробные сведения о работе с каналами такого типа.
* **Кодировка Live**: выберите это значение, если планируется tooencode Media Services toouse вашей скоростями один динамический поток tooa многоскоростной поток. Помните о том, что если вы оставите канал кодирования в реальном времени в состоянии **Работает**, вам будут выставлены соответствующие счета. Рекомендуется немедленно прекратить выполнение каналы после события потоковую передачу — полный tooavoid лишние почасовая плата. Службы мультимедиа доставляют toocustomers поток hello, запросить его.

> [!NOTE]
> В этом разделе рассматриваются атрибуты каналов, которые не были включены tooperform динамического кодирования. Сведения о работе с каналами, которые будут включены в tooperform динамического кодирования, см. в разделе [потоковой трансляции с помощью служб мультимедиа Azure toocreate многоскоростной потоков](media-services-manage-live-encoder-enabled-channels.md).
>
>

Привет, следующая схема представляет потоковую передачу рабочий процесс, который использует локального динамического кодировщика toohave многоскоростной RTMP или фрагментированный MP4 (Smooth Streaming) потоки в качестве выходных данных.

![Динамический рабочий процесс][live-overview]

## <a id="scenario"></a>Стандартный сценарий потоковой передачи в режиме реального времени
Hello следующие шаги описывают задачи, связанные с созданием распространенных потоковую передачу приложений.

1. Подключение компьютера tooa камеры. Запустите и настройте локальный динамический кодировщик, который выводит поток с разными скоростями RTMP или поток в формате "фрагментированный MP4" (Smooth Streaming). Дополнительные сведения см. в статье о [поддержке протокола RTMP в службах мультимедиа Azure и о динамических кодировщиках](http://go.microsoft.com/fwlink/?LinkId=532824).

    Это действие также можно выполнить после создания канала.
2. Создайте и запустите канал.

3. URL-адреса входящих получить hello канала.

    Hello hello использует динамический кодировщик приема URL-адрес toosend hello поток toohello канала.
4. Получить URL-адрес предварительного просмотра канала hello.

    Используйте этот URL-адрес tooverify, что ваш канал правильно получает hello обновляющегося потока.
5. Создайте программу.

    При использовании hello портал Azure, создание программы также создает актива.

    При использовании hello .NET SDK или REST, требуется toocreate актива и указать toouse этот ресурс, при создании программы.
6. Опубликуйте активов hello, связанной с программой hello.   

    >[!NOTE]
    >При создании учетной записи служб мультимедиа Azure **по умолчанию** конечной точки потоковой передачи в hello добавлена учетная запись tooyour **остановлена** состояния. Привет, из которого нужно toostream содержимое конечной точки потоковой передачи имеет toobe в hello **под управлением** состояния.

7. Запуск программы hello, когда вы будете готовы toostart потоковой передачи и архивированию.

8. При необходимости hello динамическому кодировщику можно сигнальное toostart объявления. объявления Hello вставляется в выходной поток hello.

9. Остановите программу hello, когда захотите toostop потоковую передачу и архивировать событие hello.

10. Удалить программу hello (и при необходимости удалить средство hello).     

## <a id="channel"></a>Описание канала и связанных с ним компонентов
### <a id="channel_input"></a>Конфигурации входа (приема) канала
#### <a id="ingest_protocols"></a>Протокол входного потока
Службы мультимедиа поддерживают прием динамических каналов с использованием фрагментированного MP4 и RTMP с поддержкой разных скоростей в качестве потоковых протоколов. Когда приема hello RTMP выбран протокол потоковой передачи, два приема (input) конечные точки создаются для hello канала:

* **Основной URL-адрес**: hello указывает полный URL-адрес источника RTMP канала hello приема конечной точки.
* **Дополнительный URL-адрес** (необязательно): hello указывает полный URL-адрес получателя RTMP канала hello приема конечной точки.

Используйте hello URL-адрес получателя, если требуется, чтобы tooimprove hello надежность и отказоустойчивость в случае вашего приема потока (а также отработки отказа и отказоустойчивость кодировщика), особенно для hello следующие сценарии:

- Один кодировщик tooboth основной и дополнительный URL-адреса в принудительной отправки:

    Здравствуйте, основная цель данного сценария является tooprovide больше колебаний toonetwork устойчивости и jitters. Некоторые кодировщики RTMP не очень хорошо справляются с сетевыми отключениями. В случае отключения сетевого кодировщик может остановить кодирование и не отправлять данные в буфер hello в случае переподключения. Это ведет к перебоям в работе и потере данных. Отключает сетевой может произойти из-за обслуживания или неисправная сетевая hello Azure стороне. URL-адреса первичный или вторичный сократить hello сетевые проблемы и обеспечить управляемой процесса обновления. Каждый раз, происходит отключения запланированного сетевого служб мультимедиа управляет hello первичный и вторичный отключаются, а также предоставляет отложенное соединения между двумя hello. Затем кодировщики имеют tookeep время отправки данных и повторно. Отключает Hello порядок hello может быть случайным, но всегда будет задержка между первичный или вторичный или вторичной источник URL-адресов. В этом сценарии hello кодировщика по-прежнему hello единственной точки отказа.

- Несколько кодировщиков, с каждого помещает tooa кодировщика выделенной точки:

    Этот сценарий обеспечивает избыточность как кодировщиков, так и приема. В этом сценарии encoder1 помещает toohello основной URL-адрес и encoder2 помещает toohello URL-адрес получателя. В случае сбоя кодировщик hello других кодировщика можно сохранить отправки данных. Избыточность данных может осуществляться так, как службы мультимедиа не отключает основной и дополнительный URL-адреса в hello то же время. Этот сценарий предполагает, что кодировщики время синхронизации и укажите ровно hello и тех же данных.  

- Несколько кодировщиков tooboth основной и дополнительный URL-адреса в принудительной отправки:

    В этом сценарии кодировщиков принудительной отправки данных tooboth основной и дополнительный URL-адреса. Это обеспечивает hello наиболее надежность и отказоустойчивость, а также избыточность данных. Такая конфигурация может выдержать отключения и сбои обоих кодировщиков, даже если один из кодировщиков перестанет работать. Предполагается, что кодировщики время синхронизации и укажите ровно hello и тех же данных.  

Сведения о динамических кодировщиках RTMP см. в записи блога [Azure Media Services RTMP Support and Live Encoders](http://go.microsoft.com/fwlink/?LinkId=532824) (Поддержка RTMP в службах мультимедиа Azure и динамические кодировщики).

#### <a name="ingest-urls-endpoints"></a>URL-адреса (конечные точки) приема
Канал предоставляет входную конечную точку (URL-адрес приема), указанные в кодировщика hello, поэтому hello кодировщик может поместить потоки tooyour каналов.   

Вы можете получить hello URL-адреса приема при создании канала hello. Вы tooget эти URL-адреса канала hello не toobe в hello **под управлением** состояния. Когда вы будете готовы toostart помещает toohello канал данных, hello канал должен находиться в hello **под управлением** состояния. После запуска hello канала передачи данных можно просмотреть потока через URL-адрес предварительного просмотра hello.

Предусмотрена возможность приема динамического потока в формате "фрагментированный MP4" (Smooth Streaming) по SSL-подключению. tooingest по протоколу SSL, убедитесь, что hello tooupdate приема tooHTTPS URL-адрес. В настоящее время прием RTMP по протоколу SSL не поддерживается.

#### <a id="keyframe_interval"></a>Интервал опорного кадра
При использовании локального динамического кодировщика toogenerate многоскоростной поток интервал опорного кадра hello задает длительность hello hello группы изображений (GOP), используемые этим внешним кодировщиком. Получив hello канал этого входящего потока можно доставлять обновляющийся поток tooclient приложения для воспроизведения в любом из следующих форматов hello: Smooth Streaming, динамические адаптивной потоковой передачи по HTTP (дефис), а также HTTP Live Streaming (HLS). При динамической потоковой трансляции HLS всегда упаковывается динамически. По умолчанию службы мультимедиа автоматически вычисляют hello коэффициент упаковки сегментов HLS (число фрагментов на сегмент) на основе интервала опорных кадров hello, получаемой из динамического кодировщика hello.

Привет, в следующей таблице показано вычисление продолжительности сегментов hello.

| Интервал опорного кадра | Соотношение упаковки сегмента HLS (FragmentsPerSegment) | Пример |
| --- | --- | --- |
| Меньше или равен too3 секунд |3:1 |Если KeyFrameInterval (или GOP) 2 секунды, коэффициент упаковки сегментов HLS по умолчанию hello — 3 too1. Это приведет к созданию сегмента HLS длительностью 6 секунд. |
| 3 too5 секунд |2:1 |Если KeyFrameInterval (или GOP) составляет 4 секунды, коэффициент упаковки сегментов HLS по умолчанию hello — 2 too1. Это приведет к созданию сегмента HLS длительностью 8 секунд. |
| Более 5 секунд |1:1 |Если KeyFrameInterval (или GOP) 6 секунд, коэффициент упаковки сегментов HLS по умолчанию hello — 1 too1. Это приведет к созданию сегмента HLS длительностью 6 секунд. |

Можно изменить соотношение фрагментов на сегмент hello с выходных данных, указав FragmentsPerSegment на ChannelOutputHls Настройка канала hello.

Также можно изменить значение интервала опорного кадра hello, установив свойство KeyFrameInterval hello на ChanneInput. Если KeyFrameInterval, коэффициент упаковки сегментов HLS hello FragmentsPerSegment вычисляется с помощью описанных ранее правил hello заданы явно.  

Если явно задать KeyFrameInterval и FragmentsPerSegment служб мультимедиа будет использовать устанавливаемые значения hello.

#### <a name="allowed-ip-addresses"></a>Разрешенные IP-адреса
Можно определить hello IP-адреса, разрешенные toopublish видео toothis канала. Разрешенные IP-адреса можно указать как один из следующих hello.

* отдельный IP-адрес (например, 10.0.0.1);
* диапазон IP-адресов, заданный с помощью IP-адреса и маски подсети CIDR (например,10.0.0.1/22);
* диапазон IP-адресов, заданный с помощью IP-адреса и маски подсети в десятичной записи (например, 10.0.0.1(255.255.252.0)).

Если IP-адреса не указаны и правила не заданы, ни один IP-адрес не разрешен. tooallow любой IP-адрес, создайте правило и задайте 0.0.0.0/0.

### <a name="channel-preview"></a>Предварительный просмотр канала
#### <a name="preview-urls"></a>URL-адреса предварительного просмотра
Каналы обеспечивают конечную точку предварительного просмотра (URL-адрес предварительного просмотра) использовать toopreview и проверки потока перед дальнейшей обработкой и доставкой.

URL-адрес предварительного просмотра hello можно получить при создании канала hello. Вы tooget hello URL-адреса канала hello не имеют toobe hello **под управлением** состояния. После запуска hello канала передачи данных можно Предварительный просмотр потока.

В настоящий момент поток предварительного просмотра hello может быть доставлен только в фрагментированный MP4 (Smooth Streaming) формат, независимо от того, hello указан тип входных данных. Можно использовать hello [Smooth Streaming монитор работоспособности](http://smf.cloudapp.net/healthmonitor) проигрывателя tootest hello smooth stream. Можно также использовать проигрыватель, который размещается в hello Azure портала tooview потока.

#### <a name="allowed-ip-addresses"></a>Разрешенные IP-адреса
Можно определить hello IP-адреса, разрешенные конечную точку предварительного просмотра toohello tooconnect. Если этого не сделать, будут разрешены все IP-адреса. Разрешенные IP-адреса можно указать как один из следующих hello.

* отдельный IP-адрес (например, 10.0.0.1);
* диапазон IP-адресов, заданный с помощью IP-адреса и маски подсети CIDR (например,10.0.0.1/22);
* диапазон IP-адресов, заданный с помощью IP-адреса и маски подсети в десятичной записи (например, 10.0.0.1(255.255.252.0)).

### <a name="channel-output"></a>Вывод канала
Сведения о выходных данных канала см hello [интервал опорного кадра](#keyframe_interval) раздела.

### <a name="channel-managed-programs"></a>Программы, управляемые каналом
Канал связан с программами, можно использовать toocontrol hello публикацией и хранением сегментов в потоковой трансляции. Каналы управляют программами. Hello каналом и программой связь является очень похожа tootraditional мультимедиа, где канал передает постоянный поток содержимого, а программа области toosome истекло время ожидания события в канале.

Можно указать hello количество часов, должна tooretain hello записанного содержимого для программы hello, установка hello **размер окна архива** длины. Это значение может быть задано в диапазоне от 5 минут до tooa 25 часов. Размер окна архива также указывает максимальное количество раз, когда клиенты могут вернуться назад от текущей позиции трансляции hello hello. Программы могут выходить за hello определенный промежуток времени, но контент за пределами hello длину промежутка постоянно удаляется. Это значение этого свойства также определяет, как долго клиента hello манифестов может увеличиваться.

Каждая программа связана с актив, который хранит содержимое hello потоковой передачи. Ресурс — контейнер больших двоичных объектов сопоставленных tooa блок в учетной записи хранилища Azure hello и hello файлы в активе hello хранятся в виде больших двоичных объектов в этом контейнере. Программа hello toopublish, клиентам можно открыть поток hello, необходимо создать указатель OnDemand для связанного hello активов. Можно использовать URL-адрес потоковой передачи, могут предоставить клиентам tooyour toobuild этот указатель.

Канал поддерживает до toothree одновременно запускаемых программ, поэтому можно создавать несколько архивов hello того же входящего потока. Благодаря этому можно публиковать и архивировать разные части транслируемого мероприятия. Например представьте, что ваших бизнес-требований tooarchive 6-часовой программы, но только hello toobroadcast последние 10 минут. tooaccomplish это, необходимо toocreate две параллельно выполняющиеся программы. Одна программа устанавливается tooarchive 6 часов hello события, но программа hello не публикуется. Hello другие программы tooarchive набор на 10 минут, а эта программа опубликована.

Не используйте существующие программы повторно для новых мероприятий. Вместо этого создайте новую программу для каждого события. Запуск программы hello, когда вы будете готовы toostart потоковой передачи и архивированию. Остановите программу hello, когда захотите toostop потоковую передачу и архивировать событие hello.

содержимое архива toodelete остановить и удалить программу hello и удалите связанный ресурс hello. Ресурс невозможно удалить, пока он используется какой-либо программой. Программа Hello, необходимо сначала удалить.

Даже после остановки и удаления программы hello, пользователи могут потоковую передачу заархивированного контента как видео по запросу, пока не будет удалена hello активов. Если tooretain hello архивировать содержимое, но не было доступно для потоковой передачи, удалите hello потоковой передачи указателя.

## <a id="states"></a>Состояния канала и их сопоставление с режимом выставления счетов
Возможные значения для hello текущее состояние канала:

* **Остановить**: это начальное состояние канала hello hello после ее создания. В этом состоянии свойства канала hello могут обновляться, но потоковая передача не разрешена.
* **Запуск**: hello канал запускается. В этом состоянии обновление и потоковая передача запрещены. Если возникает ошибка, hello канал возвращает toohello **остановлена** состояния.
* **Под управлением**: hello канал может обрабатывать обновляющиеся потоки.
* **Остановка**: hello канал останавливается. В этом состоянии обновление и потоковая передача запрещены.
* **Удаление**: hello канал удаляется. В этом состоянии обновление и потоковая передача запрещены.

Hello ниже показано, как канал состояния режим карты toohello для выставления счетов.

| Состояние канала | Индикаторы в пользовательском интерфейсе портала | Выставление счетов |
| --- | --- | --- | --- |
| **Запуск** |**Запуск** |Нет (переходное состояние) |
| **Выполнение** |**Готово** (нет запущенных программ)<p><p>или<p>**Потоковая передача** (запущена по крайней мере одна программа) |Да |
| **Остановка** |**Остановка** |Нет (переходное состояние) |
| **Stopped** |**Stopped** |Нет |

## <a id="cc_and_ads"></a>Вставка субтитров и рекламы
Привет, в следующей таблице показано, поддерживаемые стандарты субтитры и вставки рекламы.

| Standard | Примечания |
| --- | --- |
| CEA-708 и EIA-608 (708/608) |CEA-708 и EIA-608 закрыт субтитры стандарты для hello США и Канады.<p><p>В настоящее время субтитры поддерживаются только при передаче в закодированном входном потоке hello. Необходимо toouse динамический кодировщик мультимедиа, может вставлять субтитры 608 или 708 в hello закодированный поток, который отправил tooMedia служб. Службы мультимедиа доставляют содержимое hello со средствами просмотра tooyour вставленными титрами. |
| TTML в ismt (текстовые дорожки Smooth Streaming) |Динамическая упаковка служб мультимедиа включает содержимое toostream клиентов в любом из следующих форматов hello: DASH, HLS или Smooth Streaming. Тем не менее, при получении фрагментированном формате MP4 (Smooth Streaming) с субтитрами в файле ismt (текстовые дорожки Smooth Streaming), можно доставить tooonly hello потока Smooth Streaming клиентов. |
| SCTE-35 |Стандарт SCTE-35 является цифровая обработка сигналов, применяющее toocue вставки рекламы. Нисходящие получатели используют hello сигнала toosplice рекламы в поток hello для hello, отведенное время. Стандарт SCTE-35 необходимо отправить как разреженную дорожку во входном потоке hello.<p><p>В настоящее время фрагментировано hello поддерживается только формат входного потока, который для передачи сигналов ad MP4 (Smooth Streaming). Hello поддерживается только выходной формат — также Smooth Streaming. |

## <a id="considerations"></a>Рекомендации
При использовании локального динамического кодировщика toosend канал tooa многоскоростной поток применяются следующие ограничения hello.

* Убедитесь, что имеется достаточно свободного Интернет подключения toosend данных toohello приема точек.
* Для использования дополнительного URL-адреса приема требуется дополнительная пропускная способность.
* Hello входящих многоскоростной поток может быть более 10 уровней качества видео (слои) и более 5 звуковые дорожки.
* Hello наибольший Средняя скорость для всех уровней качества видео hello всегда должно быть меньше 10 Мбит/с.
* Hello hello среднее скоростей для всех hello видео- и аудиопотоки результат статистической обработки должен быть менее 25 Мбит/с.
* Входной протокол hello при канала hello нельзя изменить или его связанного приложения. Если вам нужны другие протоколы, создайте отдельный канал для каждого из них.
* Канал может принимать поток с одной скоростью передачи. Но так как канал hello не обрабатывает поток hello, hello клиентские приложения также будет получать односкоростной поток. (Этот вариант не рекомендуется.)

Ниже приведены другие связанные вопросы-tooworking с каналами и связанных компонентов.

* Каждой повторной настройке динамического кодировщика hello, вызовите hello **Сброс** метод на канале hello. Перед сбросом канала hello установлена программа toostop hello. После сброса канала hello, перезапустите программу hello.
* Канал можно остановить только в том случае, когда он находится в hello **под управлением** состояние и все программы канала hello были остановлены.
* По умолчанию можно добавить учетную запись служб мультимедиа tooyour только 5 каналов. Дополнительные сведения см. в статье [Квоты и ограничения](media-services-quotas-and-limitations.md).
* С вас взимается плата только в том случае, если канал находится в hello **под управлением** состояния. Дополнительные сведения см. в разделе toohello [каналов состояний и выставление счетов](media-services-live-streaming-with-onprem-encoders.md#states) раздела.

## <a name="media-services-learning-paths"></a>Схемы обучения работе со службами мультимедиа
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="feedback"></a>Отзыв
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

## <a name="related-topics"></a>Связанные разделы
[Спецификация приема фрагментированного потока MP4 в режиме реального времени в службах мультимедиа Azure](media-services-fmp4-live-ingest-overview.md)

[Общие сведения о службах мультимедиа Azure и распространенные сценарии](media-services-overview.md)

[Основные понятия служб мультимедиа Azure](media-services-concepts.md)

[live-overview]: ./media/media-services-manage-channels-overview/media-services-live-streaming-current.png
