---
title: "Устранение неполадок прокси-сервера приложений | Документация Майкрософт"
description: "Способы устранения ошибок в прокси-сервере приложений Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 970caafb-40b8-483c-bb46-c8b032a4fb74
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/21/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017; it-pro
ms.openlocfilehash: 3ef74c8d5d5b75eb2bca4e6c994f4718b5226db8
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshoot-application-proxy-problems-and-error-messages"></a><span data-ttu-id="5de50-103">Устранение неполадок и сообщения об ошибках прокси приложения</span><span class="sxs-lookup"><span data-stu-id="5de50-103">Troubleshoot Application Proxy problems and error messages</span></span>
<span data-ttu-id="5de50-104">Если во время доступа к опубликованному приложению или публикации приложений возникают ошибки, проверьте следующие параметры, чтобы выяснить, правильно ли работает прокси-сервер приложений Microsoft Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de50-104">If errors occur in accessing a published application or in publishing applications, check the following options to see if Microsoft Azure AD Application Proxy is working correctly:</span></span>

* <span data-ttu-id="5de50-105">Откройте консоль служб Windows и убедитесь, что служба **Соединитель прокси-сервера приложения Microsoft AAD** включена и работает.</span><span class="sxs-lookup"><span data-stu-id="5de50-105">Open the Windows Services console and verify that the **Microsoft AAD Application Proxy Connector** service is enabled and running.</span></span> <span data-ttu-id="5de50-106">Вы также можете проверить страницу свойств службы прокси-сервера приложения, как показано на следующем рисунке: </span><span class="sxs-lookup"><span data-stu-id="5de50-106">You may also want to look at the Application Proxy service properties page, as shown in the following image:</span></span>  
  <span data-ttu-id="5de50-107">![Снимок экрана свойств соединителя прокси-сервера приложений Microsoft AAD](./media/active-directory-application-proxy-troubleshoot/connectorproperties.png)</span><span class="sxs-lookup"><span data-stu-id="5de50-107">![Microsoft AAD Application Proxy Connector Properties window screenshot](./media/active-directory-application-proxy-troubleshoot/connectorproperties.png)</span></span>
* <span data-ttu-id="5de50-108">Откройте средство просмотра событий и найдите события для соединителя прокси приложения в узле **Журналы приложений и служб** > **Microsoft** > **AadApplicationProxy** > **Соединитель** > **Администратор**.</span><span class="sxs-lookup"><span data-stu-id="5de50-108">Open Event Viewer and look for Application Proxy connector events in **Applications and Services Logs** > **Microsoft** > **AadApplicationProxy** > **Connector** > **Admin**.</span></span>
* <span data-ttu-id="5de50-109">При необходимости доступны более подробные журналы, если [включить журналы сеансов соединителя прокси-сервера приложения](application-proxy-understand-connectors.md#under-the-hood).</span><span class="sxs-lookup"><span data-stu-id="5de50-109">If needed, more detailed logs are available by [turning on the Application Proxy connector session logs](application-proxy-understand-connectors.md#under-the-hood).</span></span>

<span data-ttu-id="5de50-110">См. дополнительные сведения о [средстве для устранения неполадок Azure AD для проверки условий, необходимых для работы соединителя в сети](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/03/troubleshooting-tool-to-validate-connector-networking-prerequisites).</span><span class="sxs-lookup"><span data-stu-id="5de50-110">For more information about the Azure AD Troubleshooting tool, see [Troubleshooting tool to validate connector networking prerequisites](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/03/troubleshooting-tool-to-validate-connector-networking-prerequisites).</span></span>

## <a name="the-page-is-not-rendered-correctly"></a><span data-ttu-id="5de50-111">Страница не отображается правильно</span><span class="sxs-lookup"><span data-stu-id="5de50-111">The page is not rendered correctly</span></span>
<span data-ttu-id="5de50-112">Даже если вы не получаете сообщения о конкретных ошибках, все равно возможны проблемы с отображением или работой приложения.</span><span class="sxs-lookup"><span data-stu-id="5de50-112">You may have problems with your application rendering or functioning incorrectly without receiving specific error messages.</span></span> <span data-ttu-id="5de50-113">Это может произойти если вы опубликовали путь к статье, но приложение требует содержимое, которое находится за пределами этого пути.</span><span class="sxs-lookup"><span data-stu-id="5de50-113">This can occur if you published the article path, but the application requires content that exists outside that path.</span></span>

<span data-ttu-id="5de50-114">Например, если опубликован путь https://yourapp/app, но приложение вызывает изображения с адреса https://yourapp/media, они не будут отображены.</span><span class="sxs-lookup"><span data-stu-id="5de50-114">For example, if you publish the path https://yourapp/app but the application calls images in https://yourapp/media, they won't be rendered.</span></span> <span data-ttu-id="5de50-115">Чтобы включить все соответствующее содержимое, обязательно публикуйте приложение, используя путь самого высокого уровня.</span><span class="sxs-lookup"><span data-stu-id="5de50-115">Make sure that you publish the application using the highest level path you need to include all relevant content.</span></span> <span data-ttu-id="5de50-116">В этом примере путь должен быть таким: http://yourapp/.</span><span class="sxs-lookup"><span data-stu-id="5de50-116">In this example, it would be http://yourapp/.</span></span>

<span data-ttu-id="5de50-117">Если вы изменили путь, чтобы включить содержимое, на которое указывает ссылка, но при этом хотите перенаправлять пользователей по внутренней ссылке пути, см. инструкции в записи блога [Setting the right link for Application Proxy applications in the Azure AD access panel and Office 365 app launcher](https://blogs.technet.microsoft.com/applicationproxyblog/2016/04/06/setting-the-right-link-for-application-proxy-applications-in-the-azure-ad-access-panel-and-office-365-app-launcher/) (Настройка правильной ссылки на приложения прокси приложений на панели доступа Azure AD и в средстве запуска приложений Office 365).</span><span class="sxs-lookup"><span data-stu-id="5de50-117">If you change your path to include referenced content, but still need users to land on a deeper link in the path, see the blog post [Setting the right link for Application Proxy applications in the Azure AD access panel and Office 365 app launcher](https://blogs.technet.microsoft.com/applicationproxyblog/2016/04/06/setting-the-right-link-for-application-proxy-applications-in-the-azure-ad-access-panel-and-office-365-app-launcher/).</span></span>

## <a name="connector-errors"></a><span data-ttu-id="5de50-118">Ошибки соединителя</span><span class="sxs-lookup"><span data-stu-id="5de50-118">Connector errors</span></span>

<span data-ttu-id="5de50-119">Воспользуйтесь [средством проверки портов соединителей прокси-службы приложения Azure AD](https://aadap-portcheck.connectorporttest.msappproxy.net/), чтобы проверить, сможет ли ваш соединитель подключиться к прокси-службе приложения.</span><span class="sxs-lookup"><span data-stu-id="5de50-119">Use the [Azure AD Application Proxy Connector Ports Test Tool](https://aadap-portcheck.connectorporttest.msappproxy.net/) to verify that your connector can reach the Application Proxy service.</span></span> <span data-ttu-id="5de50-120">Как минимум следует убедиться, что для региона Central US (Центральная часть США) и ближайшего к вам региона отображаются все зеленые флажки.</span><span class="sxs-lookup"><span data-stu-id="5de50-120">At a minimum, make sure that the Central US region and the region closest to you have all green checkmarks.</span></span> <span data-ttu-id="5de50-121">Учитывайте также, что большее число зеленых флажков означает большую устойчивость.</span><span class="sxs-lookup"><span data-stu-id="5de50-121">Beyond that, more green checkmarks means greater resiliency.</span></span> 

<span data-ttu-id="5de50-122">Если при установке мастера создания соединителя произойдет сбой регистрации, его причину можно проверить двумя способами.</span><span class="sxs-lookup"><span data-stu-id="5de50-122">If registration fails during the Connector wizard installation, there are two ways to view the reason for the failure.</span></span> <span data-ttu-id="5de50-123">Вы можете просмотреть записи в журнале событий в разделе **Applications and Services Logs\Microsoft\AadApplicationProxy\Connector\Admin** или выполнить следующую команду Windows PowerShell:</span><span class="sxs-lookup"><span data-stu-id="5de50-123">Either look in the event log under **Applications and Services Logs\Microsoft\AadApplicationProxy\Connector\Admin**, or run the following Windows PowerShell command:</span></span>

    Get-EventLog application –source “Microsoft AAD Application Proxy Connector” –EntryType “Error” –Newest 1

<span data-ttu-id="5de50-124">При обнаружении ошибки соединителя в журнале событий воспользуйтесь приведенной таблицей распространенных ошибок, чтобы устранить проблему.</span><span class="sxs-lookup"><span data-stu-id="5de50-124">Once you find the Connector error from the event log, use this table of common errors to resolve the problem:</span></span>

| <span data-ttu-id="5de50-125">Ошибка</span><span class="sxs-lookup"><span data-stu-id="5de50-125">Error</span></span> | <span data-ttu-id="5de50-126">Рекомендуемые действия</span><span class="sxs-lookup"><span data-stu-id="5de50-126">Recommended steps</span></span> |
| ----- | ----------------- |
| <span data-ttu-id="5de50-127">Не удалось зарегистрировать соединитель: убедитесь, что включен прокси-сервер приложений на портале управления Azure и что имя пользователя и пароль Active Directory введены правильно.</span><span class="sxs-lookup"><span data-stu-id="5de50-127">Connector registration failed: Make sure you enabled Application Proxy in the Azure Management Portal and that you entered your Active Directory user name and password correctly.</span></span> <span data-ttu-id="5de50-128">Ошибка: "Произошла одна или несколько ошибок".</span><span class="sxs-lookup"><span data-stu-id="5de50-128">Error: 'One or more errors occurred.'</span></span> | <span data-ttu-id="5de50-129">Если вы закрыли окно регистрации, не войдя в Azure AD, еще раз запустите мастер настройки соединителя и зарегистрируйте соединитель.</span><span class="sxs-lookup"><span data-stu-id="5de50-129">If you closed the registration window without signing in to Azure AD, run the Connector wizard again and register the Connector.</span></span> <br><br> <span data-ttu-id="5de50-130">Если окно регистрации открывается, а затем немедленно закрывается, не позволяя выполнить вход, возможно, возникнет эта ошибка.</span><span class="sxs-lookup"><span data-stu-id="5de50-130">If the registration window opens and then immediately closes without allowing you to log in, you will probably get this error.</span></span> <span data-ttu-id="5de50-131">Эта ошибка возникает при ошибках сетевого подключения в системе.</span><span class="sxs-lookup"><span data-stu-id="5de50-131">This error occurs when there is a networking error on your system.</span></span> <span data-ttu-id="5de50-132">Убедитесь, что из браузера можно подключаться к общедоступному веб-сайту и что открыты порты, указанные в разделе [Предварительные требования к прокси-серверу приложений](active-directory-application-proxy-enable.md).</span><span class="sxs-lookup"><span data-stu-id="5de50-132">Make sure that it is possible to connect from a browser to a public website and that the ports are open as specified in [Application Proxy prerequisites](active-directory-application-proxy-enable.md).</span></span> |
| <span data-ttu-id="5de50-133">В окне регистрации отображается чистая ошибка.</span><span class="sxs-lookup"><span data-stu-id="5de50-133">Clear error is presented in the registration window.</span></span> <span data-ttu-id="5de50-134">Продолжение невозможно.</span><span class="sxs-lookup"><span data-stu-id="5de50-134">Cannot proceed</span></span> | <span data-ttu-id="5de50-135">Если вы видите эту ошибку, после чего окно закрывается, это означает, что вы неправильно ввели имя пользователя или пароль.</span><span class="sxs-lookup"><span data-stu-id="5de50-135">If you see this error and then the window closes, you entered the wrong username or password.</span></span> <span data-ttu-id="5de50-136">Повторите попытку.</span><span class="sxs-lookup"><span data-stu-id="5de50-136">Try again.</span></span> |
| <span data-ttu-id="5de50-137">Не удалось зарегистрировать соединитель: убедитесь, что включен прокси-сервер приложений на портале управления Azure и что имя пользователя и пароль Active Directory введены правильно.</span><span class="sxs-lookup"><span data-stu-id="5de50-137">Connector registration failed: Make sure you enabled Application Proxy in the Azure Management Portal and that you entered your Active Directory user name and password correctly.</span></span> <span data-ttu-id="5de50-138">Ошибка: "AADSTS50059: не найдены идентификационные сведения о клиенте в запросе или в предоставленных учетных данных, а поиск URI субъекта-службы завершился ошибкой.</span><span class="sxs-lookup"><span data-stu-id="5de50-138">Error: 'AADSTS50059: No tenant-identifying information found in either the request or implied by any provided credentials and search by service principal URI has failed.</span></span> | <span data-ttu-id="5de50-139">Вы пытаетесь выполнить вход с помощью учетной записи Майкрософт, а не домена, который является частью идентификатора организации в каталоге, к которому вы пытаетесь получить доступ.</span><span class="sxs-lookup"><span data-stu-id="5de50-139">You are trying to sign in using a Microsoft Account and not a domain that is part of the organization ID of the directory you are trying to access.</span></span> <span data-ttu-id="5de50-140">Убедитесь, что администратор является частью того же имени домена, что и домен клиента, например, если домен Azure AD — contoso.com, администратором должен быть admin@contoso.com.</span><span class="sxs-lookup"><span data-stu-id="5de50-140">Make sure that the admin is part of the same domain name as the tenant domain, for example, if the Azure AD domain is contoso.com, the admin should be admin@contoso.com.</span></span> |
| <span data-ttu-id="5de50-141">Не удалось получить текущую политику выполнения для запуска сценариев PowerShell</span><span class="sxs-lookup"><span data-stu-id="5de50-141">Failed to retrieve the current execution policy for running PowerShell scripts.</span></span> | <span data-ttu-id="5de50-142">В случае сбоя установки соединителя проверьте, не отключена ли политика выполнения PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5de50-142">If the Connector installation fails, check to make sure that PowerShell execution policy is not disabled.</span></span> <br><br><span data-ttu-id="5de50-143">1. Откройте редактор групповой политики.</span><span class="sxs-lookup"><span data-stu-id="5de50-143">1. Open the Group Policy Editor.</span></span><br><span data-ttu-id="5de50-144">2) Выберите **Конфигурация компьютера** > **Административные шаблоны** > **Компоненты Windows** > **Windows PowerShell** и дважды щелкните пункт **Включить выполнение сценариев**.</span><span class="sxs-lookup"><span data-stu-id="5de50-144">2. Go to **Computer Configuration** > **Administrative Templates** > **Windows Components** > **Windows PowerShell** and double-click **Turn on Script Execution**.</span></span><br><span data-ttu-id="5de50-145">3. Возможные значения политики выполнения: **Не настроено** и **Включено**.</span><span class="sxs-lookup"><span data-stu-id="5de50-145">3. The execution policy can be set to either **Not Configured** or **Enabled**.</span></span> <span data-ttu-id="5de50-146">Если установлено значение **Включено**, убедитесь, что в разделе "Параметры" для параметра "Политика выполнения" установлено значение **Разрешать локальные сценарии и удаленные подписанные сценарии** или **Разрешать все сценарии**.</span><span class="sxs-lookup"><span data-stu-id="5de50-146">If set to **Enabled**, make sure that under Options, the Execution Policy is set to either **Allow local scripts and remote signed scripts** or to **Allow all scripts**.</span></span> |
| <span data-ttu-id="5de50-147">Соединителю не удалось загрузить конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="5de50-147">Connector failed to download the configuration.</span></span> | <span data-ttu-id="5de50-148">Истек срок действия сертификата клиента соединителя, который используется для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="5de50-148">The Connector’s client certificate, which is used for authentication, expired.</span></span> <span data-ttu-id="5de50-149">Это также может произойти, если соединитель установлен за прокси-сервером.</span><span class="sxs-lookup"><span data-stu-id="5de50-149">This may also occur if you have the Connector installed behind a proxy.</span></span> <span data-ttu-id="5de50-150">В этом случае у соединителя нет доступа к Интернету и он не может предоставлять приложения удаленным пользователям.</span><span class="sxs-lookup"><span data-stu-id="5de50-150">In this case, the Connector cannot access the Internet and will not be able to provide applications to remote users.</span></span> <span data-ttu-id="5de50-151">Обновите отношение доверия вручную с помощью командлета `Register-AppProxyConnector` в Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5de50-151">Renew trust manually using the `Register-AppProxyConnector` cmdlet in Windows PowerShell.</span></span> <span data-ttu-id="5de50-152">Если соединитель находится за прокси-сервером, необходимо предоставить доступ к Интернету учетным записям соединителя (сетевые службы и локальная система).</span><span class="sxs-lookup"><span data-stu-id="5de50-152">If your Connector is behind a proxy, it is necessary to grant Internet access to the Connector accounts “network services” and “local system.”</span></span> <span data-ttu-id="5de50-153">Для этого предоставьте им доступ к прокси-серверу или настройте их на обход прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="5de50-153">This can be accomplished either by granting them access to the Proxy or by setting them to bypass the proxy.</span></span> |
| <span data-ttu-id="5de50-154">Не удалось зарегистрировать соединитель: чтобы зарегистрировать соединитель, вы должны быть глобальным администратором своей службы Active Directory.</span><span class="sxs-lookup"><span data-stu-id="5de50-154">Connector registration failed: Make sure you are a Global Administrator of your Active Directory to register the Connector.</span></span> <span data-ttu-id="5de50-155">Ошибка: "Запрос на регистрацию отклонен".</span><span class="sxs-lookup"><span data-stu-id="5de50-155">Error: 'The registration request was denied.'</span></span> | <span data-ttu-id="5de50-156">Псевдоним, с помощью которого вы пытаетесь войти в систему, не является администратором в этом домене.</span><span class="sxs-lookup"><span data-stu-id="5de50-156">The alias you're trying to log in with isn't an admin on this domain.</span></span> <span data-ttu-id="5de50-157">Соединитель всегда устанавливается для каталога, которому принадлежит домен пользователя.</span><span class="sxs-lookup"><span data-stu-id="5de50-157">Your Connector is always installed for the directory that owns the user’s domain.</span></span> <span data-ttu-id="5de50-158">Убедитесь, что учетная запись администратора, с которой вы пытаетесь войти в систему, обладает глобальными разрешениями для клиента Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de50-158">Make sure that the admin account you are trying to sign in with has global permissions to the Azure AD tenant.</span></span> |

## <a name="kerberos-errors"></a><span data-ttu-id="5de50-159">Ошибки Kerberos</span><span class="sxs-lookup"><span data-stu-id="5de50-159">Kerberos errors</span></span>

<span data-ttu-id="5de50-160">Эта таблица охватывает более распространенные ошибки, происходящие при установке и настройке Kerberos, и содержит рекомендации по устранению.</span><span class="sxs-lookup"><span data-stu-id="5de50-160">This table covers the more common errors that come from Kerberos setup and configuration, and includes suggestions for resolution.</span></span>

| <span data-ttu-id="5de50-161">Ошибка</span><span class="sxs-lookup"><span data-stu-id="5de50-161">Error</span></span> | <span data-ttu-id="5de50-162">Рекомендуемые действия</span><span class="sxs-lookup"><span data-stu-id="5de50-162">Recommended steps</span></span> |
| ----- | ----------------- |
| <span data-ttu-id="5de50-163">Не удалось получить текущую политику выполнения для запуска сценариев PowerShell</span><span class="sxs-lookup"><span data-stu-id="5de50-163">Failed to retrieve the current execution policy for running PowerShell scripts.</span></span> | <span data-ttu-id="5de50-164">В случае сбоя установки соединителя проверьте, не отключена ли политика выполнения PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5de50-164">If the Connector installation fails, check to make sure that PowerShell execution policy is not disabled.</span></span><br><br><span data-ttu-id="5de50-165">1. Откройте редактор групповой политики.</span><span class="sxs-lookup"><span data-stu-id="5de50-165">1. Open the Group Policy Editor.</span></span><br><span data-ttu-id="5de50-166">2) Выберите **Конфигурация компьютера** > **Административные шаблоны** > **Компоненты Windows** > **Windows PowerShell** и дважды щелкните пункт **Включить выполнение сценариев**.</span><span class="sxs-lookup"><span data-stu-id="5de50-166">2. Go to **Computer Configuration** > **Administrative Templates** > **Windows Components** > **Windows PowerShell** and double-click **Turn on Script Execution**.</span></span><br><span data-ttu-id="5de50-167">3. Возможные значения политики выполнения: **Не настроено** и **Включено**.</span><span class="sxs-lookup"><span data-stu-id="5de50-167">3. The execution policy can be set to either **Not Configured** or **Enabled**.</span></span> <span data-ttu-id="5de50-168">Если установлено значение **Включено**, убедитесь, что в разделе "Параметры" для параметра "Политика выполнения" установлено значение **Разрешать локальные сценарии и удаленные подписанные сценарии** или **Разрешать все сценарии**.</span><span class="sxs-lookup"><span data-stu-id="5de50-168">If set to **Enabled**, make sure that under Options, the Execution Policy is set to either **Allow local scripts and remote signed scripts** or to **Allow all scripts**.</span></span> |
| <span data-ttu-id="5de50-169">12008 — для Azure AD превышено максимальное количество попыток проверки подлинности Kerberos на внутреннем сервере.</span><span class="sxs-lookup"><span data-stu-id="5de50-169">12008 - Azure AD exceeded the maximum number of permitted Kerberos authentication attempts to the backend server.</span></span> | <span data-ttu-id="5de50-170">Эта ошибка может означать неправильную конфигурацию между Azure AD и внутренним сервером приложений или проблему в настройках даты и времени на обоих компьютерах.</span><span class="sxs-lookup"><span data-stu-id="5de50-170">This error may indicate incorrect configuration between Azure AD and the backend application server, or a problem in time and date configuration on both machines.</span></span> <span data-ttu-id="5de50-171">Внутренний сервер отклонил билет Kerberos, созданный службой Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de50-171">The backend server declined the Kerberos ticket created by Azure AD.</span></span> <span data-ttu-id="5de50-172">Проверьте правильность конфигурации Azure AD и сервера внутренних приложений.</span><span class="sxs-lookup"><span data-stu-id="5de50-172">Verify that Azure AD and the backend application server are configured correctly.</span></span> <span data-ttu-id="5de50-173">Убедитесь, что конфигурация даты и времени в Azure AD и на внутреннем сервере приложений синхронизирована.</span><span class="sxs-lookup"><span data-stu-id="5de50-173">Make sure that the time and date configuration on the Azure AD and the backend application server are synchronized.</span></span> |
| <span data-ttu-id="5de50-174">13016 — службе Azure AD не удается получить билет Kerberos от имени пользователя из-за отсутствия UPN в граничном маркере или файле cookie доступа.</span><span class="sxs-lookup"><span data-stu-id="5de50-174">13016 - Azure AD cannot retrieve a Kerberos ticket on behalf of the user because there is no UPN in the edge token or in the access cookie.</span></span> | <span data-ttu-id="5de50-175">Существует проблема с конфигурацией службы маркеров безопасности.</span><span class="sxs-lookup"><span data-stu-id="5de50-175">There is a problem with the STS configuration.</span></span> <span data-ttu-id="5de50-176">Исправьте конфигурацию утверждения UPN в службе маркеров безопасности.</span><span class="sxs-lookup"><span data-stu-id="5de50-176">Fix the UPN claim configuration in the STS.</span></span> |
| <span data-ttu-id="5de50-177">13019 — службе Azure AD не удается получить билет Kerberos от имени пользователя из-за следующей общей ошибки API.</span><span class="sxs-lookup"><span data-stu-id="5de50-177">13019 - Azure AD cannot retrieve a Kerberos ticket on behalf of the user because of the following general API error.</span></span> | <span data-ttu-id="5de50-178">Это событие может означать неправильную конфигурацию между Azure AD и сервером контроллера домена или проблему в конфигурации даты и времени на обоих компьютерах.</span><span class="sxs-lookup"><span data-stu-id="5de50-178">This event may indicate incorrect configuration between Azure AD and the domain controller server, or a problem in time and date configuration on both machines.</span></span> <span data-ttu-id="5de50-179">Контроллер домена отклонил билет Kerberos, созданный службой Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de50-179">The domain controller declined the Kerberos ticket created by Azure AD.</span></span> <span data-ttu-id="5de50-180">Проверьте правильность конфигурации Azure AD и сервера внутренних приложений, особенно конфигурацию имени субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="5de50-180">Verify that Azure AD and the backend application server are configured correctly, especially the SPN configuration.</span></span> <span data-ttu-id="5de50-181">Убедитесь, что служба Azure AD присоединена к тому же домену, что и контроллер домена, чтобы контроллер домена мог установить отношения доверия с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de50-181">Make sure the Azure AD is domain joined to the same domain as the domain controller to ensure that the domain controller establishes trust with Azure AD.</span></span> <span data-ttu-id="5de50-182">Убедитесь, что конфигурация даты и времени в Azure AD и на контроллере домена синхронизирована.</span><span class="sxs-lookup"><span data-stu-id="5de50-182">Make sure that the time and date configuration on the Azure AD and the domain controller are synchronized.</span></span> |
| <span data-ttu-id="5de50-183">13020 — службе Azure AD не удается получить билет Kerberos от имени пользователя, так как имя субъекта-службы для внутреннего сервера не определено.</span><span class="sxs-lookup"><span data-stu-id="5de50-183">13020 - Azure AD cannot retrieve a Kerberos ticket on behalf of the user because the backend server SPN is not defined.</span></span> | <span data-ttu-id="5de50-184">Это событие может означать неправильную конфигурацию между Azure AD и сервером контроллера домена или проблему в конфигурации даты и времени на обоих компьютерах.</span><span class="sxs-lookup"><span data-stu-id="5de50-184">This event may indicate incorrect configuration between Azure AD and the domain controller server, or a problem in time and date configuration on both machines.</span></span> <span data-ttu-id="5de50-185">Контроллер домена отклонил билет Kerberos, созданный службой Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de50-185">The domain controller declined the Kerberos ticket created by Azure AD.</span></span> <span data-ttu-id="5de50-186">Проверьте правильность конфигурации Azure AD и сервера внутренних приложений, особенно конфигурацию имени субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="5de50-186">Verify that Azure AD and the backend application server are configured correctly, especially the SPN configuration.</span></span> <span data-ttu-id="5de50-187">Убедитесь, что служба Azure AD присоединена к тому же домену, что и контроллер домена, чтобы контроллер домена мог установить отношения доверия с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de50-187">Make sure the Azure AD is domain joined to the same domain as the domain controller to ensure that the domain controller establishes trust with Azure AD.</span></span> <span data-ttu-id="5de50-188">Убедитесь, что конфигурация даты и времени в Azure AD и на контроллере домена синхронизирована.</span><span class="sxs-lookup"><span data-stu-id="5de50-188">Make sure that the time and date configuration on the Azure AD and the domain controller are synchronized.</span></span> |
| <span data-ttu-id="5de50-189">13022 — службе Azure AD не удается проверить подлинность пользователя, так как внутренний сервер отвечает на попытки проверки подлинности Kerberos ошибкой HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="5de50-189">13022 - Azure AD cannot authenticate the user because the backend server responds to Kerberos authentication attempts with an HTTP 401 error.</span></span> | <span data-ttu-id="5de50-190">Это событие может означать неправильную конфигурацию между Azure AD и внутренним сервером приложений или проблему в конфигурации даты и времени на обоих компьютерах.</span><span class="sxs-lookup"><span data-stu-id="5de50-190">This event may indicate incorrect configuration between Azure AD and the backend application server, or a problem in time and date configuration on both machines.</span></span> <span data-ttu-id="5de50-191">Внутренний сервер отклонил билет Kerberos, созданный службой Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de50-191">The backend server declined the Kerberos ticket created by Azure AD.</span></span> <span data-ttu-id="5de50-192">Проверьте правильность конфигурации Azure AD и сервера внутренних приложений.</span><span class="sxs-lookup"><span data-stu-id="5de50-192">Verify that Azure AD and the backend application server are configured correctly.</span></span> <span data-ttu-id="5de50-193">Убедитесь, что конфигурация даты и времени в Azure AD и на внутреннем сервере приложений синхронизирована.</span><span class="sxs-lookup"><span data-stu-id="5de50-193">Make sure that the time and date configuration on the Azure AD and the backend application server are synchronized.</span></span> |

## <a name="end-user-errors"></a><span data-ttu-id="5de50-194">Ошибки пользователей</span><span class="sxs-lookup"><span data-stu-id="5de50-194">End-user errors</span></span>

<span data-ttu-id="5de50-195">Этот список содержит ошибки, с которыми могут столкнуться пользователи при неудачной попытке доступа к приложению.</span><span class="sxs-lookup"><span data-stu-id="5de50-195">This list covers errors that your end users might encounter when they try to access the app and fail.</span></span> 

| <span data-ttu-id="5de50-196">Ошибка</span><span class="sxs-lookup"><span data-stu-id="5de50-196">Error</span></span> | <span data-ttu-id="5de50-197">Рекомендуемые действия</span><span class="sxs-lookup"><span data-stu-id="5de50-197">Recommended steps</span></span> |
| ----- | ----------------- |
| <span data-ttu-id="5de50-198">Веб-сайт не может отобразить страницу.</span><span class="sxs-lookup"><span data-stu-id="5de50-198">The website cannot display the page.</span></span> | <span data-ttu-id="5de50-199">Пользователь может увидеть эту ошибку при попытке доступа к опубликованному вами приложению, если оно является приложением IWA.</span><span class="sxs-lookup"><span data-stu-id="5de50-199">Your user may get this error when trying to access the app you published if the application is an IWA application.</span></span> <span data-ttu-id="5de50-200">Возможно, для этого приложения определено неправильное имя субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="5de50-200">The defined SPN for this application may be incorrect.</span></span> <span data-ttu-id="5de50-201">Для приложений IWA: убедитесь, что для приложения настроено правильное имя субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="5de50-201">For IWA apps, make sure that the SPN configured for this application is correct.</span></span> |
| <span data-ttu-id="5de50-202">Веб-сайт не может отобразить страницу.</span><span class="sxs-lookup"><span data-stu-id="5de50-202">The website cannot display the page.</span></span> | <span data-ttu-id="5de50-203">Пользователь может получить эту ошибку при попытке доступа к опубликованному вами приложению, если оно является приложением OWA.</span><span class="sxs-lookup"><span data-stu-id="5de50-203">Your user may get this error when trying to access the app you published if the application is an OWA application.</span></span> <span data-ttu-id="5de50-204">Это может быть вызвано одной из следующих причин:</span><span class="sxs-lookup"><span data-stu-id="5de50-204">This could be caused by one of the following:</span></span><br><li><span data-ttu-id="5de50-205">Для этого приложения определено неверное имя субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="5de50-205">The defined SPN for this application is incorrect.</span></span> <span data-ttu-id="5de50-206">Убедитесь в правильности имени субъекта-службы (SPN), настроенного для этого приложения.</span><span class="sxs-lookup"><span data-stu-id="5de50-206">Make sure that the SPN configured for this application is correct.</span></span></li><li><span data-ttu-id="5de50-207">Пользователь, который попытался получить доступ к приложению, использует для входа учетную запись Майкрософт, а не надлежащую корпоративную учетную запись, или является гостевым пользователем.</span><span class="sxs-lookup"><span data-stu-id="5de50-207">The user who tried to access the application is using a Microsoft account rather than the proper corporate account to sign in, or the user is a guest user.</span></span> <span data-ttu-id="5de50-208">Убедитесь, что пользователь выполняет вход с помощью корпоративной учетной записи, которая соответствует имени домена опубликованного приложения.</span><span class="sxs-lookup"><span data-stu-id="5de50-208">Make sure the user signs in using their corporate account that matches the domain of the published application.</span></span> <span data-ttu-id="5de50-209">Пользователи учетных записей Майкрософт и гости не могут получить доступ к приложениям IWA.</span><span class="sxs-lookup"><span data-stu-id="5de50-209">Microsoft Account users and guest cannot access IWA applications.</span></span></li><li><span data-ttu-id="5de50-210">Пользователь, который пытался получить доступ к приложению, не определен должным образом для этого приложения на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="5de50-210">The user who tried to access the application is not properly defined for this application on the on-prem side.</span></span> <span data-ttu-id="5de50-211">Убедитесь, что этот пользователь имеет соответствующие разрешения, определенные для данного внутреннего приложения на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="5de50-211">Make sure that this user has the proper permissions as defined for this backend application on the on-prem machine.</span></span> |
| <span data-ttu-id="5de50-212">К этому корпоративному приложению нет доступа.</span><span class="sxs-lookup"><span data-stu-id="5de50-212">This corporate app can’t be accessed.</span></span> <span data-ttu-id="5de50-213">Вы не авторизованы для доступа к этому приложению.</span><span class="sxs-lookup"><span data-stu-id="5de50-213">You are not authorized to access this application.</span></span> <span data-ttu-id="5de50-214">Ошибка авторизации.</span><span class="sxs-lookup"><span data-stu-id="5de50-214">Authorization failed.</span></span> <span data-ttu-id="5de50-215">Не забудьте назначить пользователю доступ к этому приложению.</span><span class="sxs-lookup"><span data-stu-id="5de50-215">Make sure to assign the user with access to this application.</span></span> | <span data-ttu-id="5de50-216">Пользователи могут получать такую ошибку при попытке доступа к опубликованному приложению, если они используют для входа учетные записи Майкрософт вместо своей корпоративной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="5de50-216">Your users may get this error when trying to access the app you published if they use Microsoft accounts instead of their corporate account to sign in.</span></span> <span data-ttu-id="5de50-217">Также эта ошибка возникает при входе с помощью гостевой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="5de50-217">Guest users may also get this error.</span></span> <span data-ttu-id="5de50-218">Пользователи учетных записей Майкрософт и гости не могут получить доступ к приложениям IWA.</span><span class="sxs-lookup"><span data-stu-id="5de50-218">Microsoft Account users and guests cannot access IWA applications.</span></span> <span data-ttu-id="5de50-219">Убедитесь, что пользователь выполняет вход с помощью корпоративной учетной записи, которая соответствует имени домена опубликованного приложения.</span><span class="sxs-lookup"><span data-stu-id="5de50-219">Make sure the user signs in using their corporate account that matches the domain of the published application.</span></span><br><br><span data-ttu-id="5de50-220">Возможно, вы не назначили пользователя для этого приложения.</span><span class="sxs-lookup"><span data-stu-id="5de50-220">You may not have assigned the user for this application.</span></span> <span data-ttu-id="5de50-221">Перейдите на вкладку **Приложение** и в разделе **Пользователи и группы** назначьте этого пользователя или группу пользователей для этого приложения.</span><span class="sxs-lookup"><span data-stu-id="5de50-221">Go to the **Application** tab, and under **Users and Groups**, assign this user or user group to this application.</span></span> |
| <span data-ttu-id="5de50-222">Доступ к этому корпоративному приложению невозможно получить прямо сейчас.</span><span class="sxs-lookup"><span data-stu-id="5de50-222">This corporate app can’t be accessed right now.</span></span> <span data-ttu-id="5de50-223">Повторите попытку позже. Истекло время ожидания для соединителя.</span><span class="sxs-lookup"><span data-stu-id="5de50-223">Please try again later…The connector timed out.</span></span> | <span data-ttu-id="5de50-224">Пользователь может получить эту ошибку при попытке доступа к опубликованному вами приложению, если этот пользователь не определен надлежащим образом для этого приложения на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="5de50-224">Your users may get this error when trying to access the app you published if they are not properly defined for this application on the on-prem side.</span></span> <span data-ttu-id="5de50-225">Убедитесь, что такой пользователь имеет соответствующие разрешения, определенные для этого внутреннего приложения на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="5de50-225">Make sure that your users have the proper permissions as defined for this backend application on the on-prem machine.</span></span> |
| <span data-ttu-id="5de50-226">К этому корпоративному приложению нет доступа.</span><span class="sxs-lookup"><span data-stu-id="5de50-226">This corporate app can’t be accessed.</span></span> <span data-ttu-id="5de50-227">Вы не авторизованы для доступа к этому приложению.</span><span class="sxs-lookup"><span data-stu-id="5de50-227">You are not authorized to access this application.</span></span> <span data-ttu-id="5de50-228">Ошибка авторизации.</span><span class="sxs-lookup"><span data-stu-id="5de50-228">Authorization failed.</span></span> <span data-ttu-id="5de50-229">Убедитесь, что у пользователя есть лицензия на Azure Active Directory Premium или Basic.</span><span class="sxs-lookup"><span data-stu-id="5de50-229">Make sure that the user has a license for Azure Active Directory Premium or Basic.</span></span> | <span data-ttu-id="5de50-230">Пользователь может получить такую ошибку при попытке доступа к опубликованному вами приложению, если администратор подписчика не назначил явно такому пользователю лицензию уровня "Премиум" или "Базовый".</span><span class="sxs-lookup"><span data-stu-id="5de50-230">Your users may get this error when trying to access the app you published if they weren't explicitly assigned with a Premium/Basic license by the subscriber’s administrator.</span></span> <span data-ttu-id="5de50-231">Откройте вкладку **Лицензии** службы Active Directory подписчика и убедитесь, что этому пользователю или группе пользователей назначена лицензия Премиум или Базовая.</span><span class="sxs-lookup"><span data-stu-id="5de50-231">Go to the subscriber’s Active Directory **Licenses** tab and make sure that this user or user group is assigned a Premium or Basic license.</span></span> |

## <a name="my-error-wasnt-listed-here"></a><span data-ttu-id="5de50-232">Моей ошибки здесь нет</span><span class="sxs-lookup"><span data-stu-id="5de50-232">My error wasn't listed here</span></span>

<span data-ttu-id="5de50-233">Если вы столкнулись с ошибкой и проблемой в работе прокси приложения Azure AD, не указанной в этом руководстве по устранению неполадок, нам бы хотелось услышать об этом.</span><span class="sxs-lookup"><span data-stu-id="5de50-233">If you encounter an error or problem with Azure AD Application Proxy that isn't listed in this troubleshooting guide, we'd like to hear about it.</span></span> <span data-ttu-id="5de50-234">Отправьте нашей [команде по отзывам и предложениям](mailto:aadapfeedback@microsoft.com) электронное сообщение с описанием обнаруженной ошибки.</span><span class="sxs-lookup"><span data-stu-id="5de50-234">Send an email to our [feedback team](mailto:aadapfeedback@microsoft.com) with the details of the error you encountered.</span></span>

## <a name="see-also"></a><span data-ttu-id="5de50-235">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="5de50-235">See also</span></span>
* [<span data-ttu-id="5de50-236">Включение прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="5de50-236">Enable Application Proxy for Azure Active Directory</span></span>](active-directory-application-proxy-enable.md)
* [<span data-ttu-id="5de50-237">Опубликуйте приложения с помощью прокси-сервера приложений.</span><span class="sxs-lookup"><span data-stu-id="5de50-237">Publish applications with Application Proxy</span></span>](active-directory-application-proxy-publish.md)
* [<span data-ttu-id="5de50-238">Доступ с единым входом</span><span class="sxs-lookup"><span data-stu-id="5de50-238">Enable single sign-on</span></span>](active-directory-application-proxy-sso-using-kcd.md)
* [<span data-ttu-id="5de50-239">Включение условного доступа</span><span class="sxs-lookup"><span data-stu-id="5de50-239">Enable conditional access</span></span>](active-directory-application-proxy-conditional-access.md)


<!--Image references-->
[1]: ./media/active-directory-application-proxy-troubleshoot/connectorproperties.png
[2]: ./media/active-directory-application-proxy-troubleshoot/sessionlog.png
