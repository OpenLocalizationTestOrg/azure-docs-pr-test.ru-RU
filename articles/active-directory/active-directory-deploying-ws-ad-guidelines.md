---
title: "aaaGuidelines по развертыванию Windows Server Active Directory на виртуальных машинах Azure | Документы Microsoft"
description: "Если вы знаете, как toodeploy AD доменных служб и служб федерации AD на локальном компьютере, узнайте, как они работают на виртуальных машинах Azure."
services: active-directory
documentationcenter: 
author: femila
manager: femila
editor: 
ms.assetid: 04df4c46-e6b6-4754-960a-57b823d617fa
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 07/26/2017
ms.author: femila
ms.openlocfilehash: 9ad5a5f138a6402cbb656d9160545846051207b6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-for-deploying-windows-server-active-directory-on-azure-virtual-machines"></a><span data-ttu-id="e0141-103">Рекомендации по развертыванию Windows Server Active Directory на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="e0141-103">Guidelines for deploying Windows Server Active Directory on Azure virtual machines</span></span>
<span data-ttu-id="e0141-104">В этой статье описываются hello важные отличия развертывании служб Windows Server Active Directory домена (AD DS) и служб федерации Active Directory (AD FS) в локальной сравнению с их развертыванием на виртуальных машинах Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-104">This article explains hello important differences between deploying Windows Server Active Directory Domain Services (AD DS) and Active Directory Federation Services (AD FS) on-premises versus deploying them on Microsoft Azure virtual machines.</span></span>

## <a name="scope-and-audience"></a><span data-ttu-id="e0141-105">Область и аудитория</span><span class="sxs-lookup"><span data-stu-id="e0141-105">Scope and audience</span></span>
<span data-ttu-id="e0141-106">Hello статья предназначена для имеющих опыт развертывания Active Directory в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="e0141-106">hello article is intended for those already experienced with deploying Active Directory on-premises.</span></span> <span data-ttu-id="e0141-107">Она охватывает hello различия при развертывании Active Directory в Microsoft Azure виртуальных машин и виртуальных сетях Azure и традиционном локальном развертывании Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-107">It covers hello differences between deploying Active Directory on Microsoft Azure virtual machines/Azure virtual networks and traditional on-premises Active Directory deployments.</span></span> <span data-ttu-id="e0141-108">Виртуальные машины Azure и виртуальными сетями Azure являются частью инфраструктуры как услуги (IaaS) для вычислительных ресурсов в облаке hello tooleverage организаций.</span><span class="sxs-lookup"><span data-stu-id="e0141-108">Azure virtual machines and Azure virtual networks are part of an Infrastructure-as-a-Service (IaaS) offering for organizations tooleverage computing resources in hello cloud.</span></span>

<span data-ttu-id="e0141-109">Для тех, кто не знаком с развертыванием AD, в разделе hello [по развертыванию AD DS](https://technet.microsoft.com/library/cc753963) или [Планирование развертывания AD FS](https://technet.microsoft.com/library/dn151324.aspx) соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="e0141-109">For those that are not familiar with AD deployment, see hello [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963) or [Plan your AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) as appropriate.</span></span>

<span data-ttu-id="e0141-110">В этой статье предполагается, что читатель hello хорошо знаком с hello следующие основные понятия:</span><span class="sxs-lookup"><span data-stu-id="e0141-110">This article assumes that hello reader is familiar with hello following concepts:</span></span>

* <span data-ttu-id="e0141-111">развертывание служб Windows Server AD DS и управление ими;</span><span class="sxs-lookup"><span data-stu-id="e0141-111">Windows Server AD DS deployment and management</span></span>
* <span data-ttu-id="e0141-112">Развертывание и настройку инфраструктуры DNS toosupport Windows Server AD DS</span><span class="sxs-lookup"><span data-stu-id="e0141-112">Deployment and configuration of DNS toosupport a Windows Server AD DS infrastructure</span></span>
* <span data-ttu-id="e0141-113">развертывание служб Windows Server AD FS и управление ими;</span><span class="sxs-lookup"><span data-stu-id="e0141-113">Windows Server AD FS deployment and management</span></span>
* <span data-ttu-id="e0141-114">развертывание и настройка приложений проверяющей стороны (веб-сайтов и веб-служб), которые могут использовать маркеры Windows Server AD FS, а также управление ими;</span><span class="sxs-lookup"><span data-stu-id="e0141-114">Deploying, configuring, and managing relying party applications (websites and web services) that can consume Windows Server AD FS tokens</span></span>
* <span data-ttu-id="e0141-115">Виртуальную машину, общие понятия, например как tooconfigure a виртуальной машины, виртуальные диски и виртуальные сети</span><span class="sxs-lookup"><span data-stu-id="e0141-115">General virtual machine concepts, such as how tooconfigure a virtual machine, virtual disks, and virtual networks</span></span>

<span data-ttu-id="e0141-116">В этой статье указаны hello требования для гибридного развертывания, в котором службы Windows Server AD DS или AD FS развертываются частично локально и частично на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-116">This article highlights hello requirements for a hybrid deployment scenario in which Windows Server AD DS or AD FS are partly deployed on-premises and partly deployed on Azure virtual machines.</span></span> <span data-ttu-id="e0141-117">Hello сначала описываются важные различия hello между операционной системой Windows Server AD DS и AD FS на виртуальных машинах Azure и локальной и точки принятия важных решений, влияющие на проектирование и развертывание.</span><span class="sxs-lookup"><span data-stu-id="e0141-117">hello document first covers hello critical differences between running Windows Server AD DS and AD FS on Azure virtual machines versus on-premises, and important decision points that affect design and deployment.</span></span> <span data-ttu-id="e0141-118">Hello остальная часть hello документ содержит инструкции для каждой точки принятия решений hello более подробно, и как tooapply hello сценарии развертывания toovarious рекомендации.</span><span class="sxs-lookup"><span data-stu-id="e0141-118">hello rest of hello paper explains guidelines for each of hello decision points in more detail, and how tooapply hello guidelines toovarious deployment scenarios.</span></span>

<span data-ttu-id="e0141-119">В этой статье не рассматривается настройка hello [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), которая является службой, предоставляющей возможности управления идентификаторами и доступом управления для облачных приложений на основе REST.</span><span class="sxs-lookup"><span data-stu-id="e0141-119">This article does not discuss hello configuration of [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), which is a REST-based service that provides identity management and access control capabilities for cloud applications.</span></span> <span data-ttu-id="e0141-120">Azure Active Directory (Azure AD) и Windows Server AD DS, однако спроектированный toowork вместе tooprovide решения управления доступом и удостоверениями для современных гибридных ИТ сред и приложений.</span><span class="sxs-lookup"><span data-stu-id="e0141-120">Azure Active Directory (Azure AD) and Windows Server AD DS are, however, designed toowork together tooprovide an identity and access management solution for today’s hybrid IT environments and modern applications.</span></span> <span data-ttu-id="e0141-121">toohelp понять различия hello и связи между Windows Server AD DS и Azure AD, примите во внимание hello ниже:</span><span class="sxs-lookup"><span data-stu-id="e0141-121">toohelp understand hello differences and relationships between Windows Server AD DS and Azure AD, consider hello following:</span></span>

1. <span data-ttu-id="e0141-122">Можно запускать Windows Server AD DS в облаке hello на виртуальных машинах Azure при использовании Azure tooextend локального центра обработки данных в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-122">You might run Windows Server AD DS in hello cloud on Azure virtual machines when you are using Azure tooextend your on-premises datacenter into hello cloud.</span></span>
2. <span data-ttu-id="e0141-123">Toogive Azure AD может использовать приложения единого входа tooSoftware как услуга (SaaS) пользователей.</span><span class="sxs-lookup"><span data-stu-id="e0141-123">You might use Azure AD toogive your users single sign-on tooSoftware-as-a-Service (SaaS) applications.</span></span> <span data-ttu-id="e0141-124">Эта технология используется, например, в Microsoft Office 365, а также в приложениях, работающих на платформе Azure и других облачных платформах.</span><span class="sxs-lookup"><span data-stu-id="e0141-124">Microsoft Office 365 uses this technology, for example, and applications running on Azure or other cloud platforms can also use it.</span></span>
3. <span data-ttu-id="e0141-125">Можно использовать Azure AD (ее службу для управления доступом) toolet пользователи будут выполнять вход с использованием идентификаторов от Facebook, Google, Microsoft и других tooapplications Поставщики удостоверений, размещенным в облаке hello или в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="e0141-125">You might use Azure AD (its Access Control Service) toolet users sign in using identities from Facebook, Google, Microsoft, and other identity providers tooapplications that are hosted in hello cloud or on-premises.</span></span>

<span data-ttu-id="e0141-126">Дополнительные сведения об этих различиях см. в статье об [удостоверениях Azure](fundamentals-identity.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-126">For more information about these differences, see [Azure Identity](fundamentals-identity.md).</span></span>

## <a name="related-resources"></a><span data-ttu-id="e0141-127">Связанные ресурсы</span><span class="sxs-lookup"><span data-stu-id="e0141-127">Related resources</span></span>
<span data-ttu-id="e0141-128">Вы можете загрузить и запустить hello [Оценка готовности виртуальной машины Azure](https://www.microsoft.com/download/details.aspx?id=40898).</span><span class="sxs-lookup"><span data-stu-id="e0141-128">You may download and run hello [Azure Virtual Machine Readiness Assessment](https://www.microsoft.com/download/details.aspx?id=40898).</span></span> <span data-ttu-id="e0141-129">Hello оценки будет автоматически проверять в локальной среде и создавать настраиваемые отчета на основе hello рекомендации найден в этой статье toohelp переносе tooAzure среды hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-129">hello assessment will automatically inspect your on-premises environment and generate a customized report based on hello guidance found in this topic toohelp you migrate hello environment tooAzure.</span></span>

<span data-ttu-id="e0141-130">Рекомендуется также в первую очередь изучить учебники hello, руководства и видеоролики, охватывающие hello следующие вопросы:</span><span class="sxs-lookup"><span data-stu-id="e0141-130">We recommend that you also first review hello tutorials, guides, and videos that cover hello following topics:</span></span>

* [<span data-ttu-id="e0141-131">Настройка виртуальной сети только в hello портала Azure</span><span class="sxs-lookup"><span data-stu-id="e0141-131">Configure a Cloud-Only Virtual Network in hello Azure Portal</span></span>](../virtual-network/virtual-networks-create-vnet-arm-pportal.md)
* [<span data-ttu-id="e0141-132">Настроить VPN сайтами в hello портала Azure</span><span class="sxs-lookup"><span data-stu-id="e0141-132">Configure a Site-to-Site VPN in hello Azure Portal</span></span>](../vpn-gateway/vpn-gateway-site-to-site-create.md)
* [<span data-ttu-id="e0141-133">Установка нового леса Active Directory в виртуальной сети Azure</span><span class="sxs-lookup"><span data-stu-id="e0141-133">Install a new Active Directory forest on an Azure virtual network</span></span>](active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="e0141-134">установка реплики контроллера домена Active Directory в Azure;</span><span class="sxs-lookup"><span data-stu-id="e0141-134">Install a replica Active Directory domain controller on Azure</span></span>](active-directory-install-replica-active-directory-domain-controller.md)
* [<span data-ttu-id="e0141-135">Microsoft Azure IaaS для профессионалов в сфере IT. (01) Основная информация о виртуальных машинах</span><span class="sxs-lookup"><span data-stu-id="e0141-135">Microsoft Azure IT Pro IaaS: (01) Virtual Machine Fundamentals</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/01)
* [<span data-ttu-id="e0141-136">Microsoft Azure IaaS для профессионалов в сфере IT. (05) Создание виртуальных сетей и подключений между организациями</span><span class="sxs-lookup"><span data-stu-id="e0141-136">Microsoft Azure IT Pro IaaS: (05) Creating Virtual Networks and Cross-Premises Connectivity</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/05)

## <a name="introduction"></a><span data-ttu-id="e0141-137">Введение</span><span class="sxs-lookup"><span data-stu-id="e0141-137">Introduction</span></span>
<span data-ttu-id="e0141-138">Hello основные требования к развертыванию Windows Server Active Directory на виртуальных машинах Azure мало отличаются от его развертывания в локальных виртуальных машин (и, toosome степени на физических компьютерах).</span><span class="sxs-lookup"><span data-stu-id="e0141-138">hello fundamental requirements for deploying Windows Server Active Directory on Azure virtual machines differ very little from deploying it in on-premises virtual machines (and, toosome extent, physical machines).</span></span> <span data-ttu-id="e0141-139">Например, в hello регистр Windows Server AD DS, если контроллеры домена hello (КД), развертываемые на виртуальных машинах Azure являются репликами в существующем локальной корпоративном домене или лесе, то hello развертывания Azure могут интерпретироваться во многом hello так же, как вы может обрабатывать дополнительным сайтом Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-139">For example, in hello case of Windows Server AD DS, if hello domain controllers (DCs) that you deploy on Azure virtual machines are replicas in an existing on-premises corporate domain/forest, then hello Azure deployment can largely be treated in hello same way as you might treat any other additional Windows Server Active Directory site.</span></span> <span data-ttu-id="e0141-140">То есть подсети должны быть определены в Windows Server AD DS, создан сайт, подсетей hello связаны toothat сайта и подключенных tooother сайтов с помощью соответствующих ссылок.</span><span class="sxs-lookup"><span data-stu-id="e0141-140">That is, subnets must be defined in Windows Server AD DS, a site created, hello subnets linked toothat site, and connected tooother sites using appropriate site-links.</span></span> <span data-ttu-id="e0141-141">Существуют, однако некоторые различия, общие tooall Azure развертываний и некоторые, изменяться соответствующим toohello выбранного варианта развертывания.</span><span class="sxs-lookup"><span data-stu-id="e0141-141">There are, however, some differences that are common tooall Azure deployments and some that vary according toohello specific deployment scenario.</span></span> <span data-ttu-id="e0141-142">Ниже описываются два основных различия.</span><span class="sxs-lookup"><span data-stu-id="e0141-142">Two fundamental differences are outlined below:</span></span>

### <a name="azure-virtual-machines-may-need-connectivity-toohello-on-premises-corporate-network"></a><span data-ttu-id="e0141-143">Виртуальные машины Azure может потребоваться подключение toohello локальной корпоративной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-143">Azure virtual machines may need connectivity toohello on-premises corporate network.</span></span>
<span data-ttu-id="e0141-144">Подключение виртуальных машин задней tooan локальной корпоративной сети требуется виртуальная сеть Azure, включая сайта для сайта или сайта в точке виртуальной частной сети (VPN) Azure может tooseamlessly компонента подключения виртуальных машин Azure и локальные компьютеры.</span><span class="sxs-lookup"><span data-stu-id="e0141-144">Connecting Azure virtual machines back tooan on-premises corporate network requires Azure virtual network, which includes a site-to-site or site-to-point virtual private network (VPN) component able tooseamlessly connect Azure virtual machines and on-premises machines.</span></span> <span data-ttu-id="e0141-145">Этот компонент VPN также может позволить локального домена член компьютеров tooaccess домена Windows Server Active Directory домена, чьи контроллеры размещены только на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-145">This VPN component could also enable on-premises domain member computers tooaccess a Windows Server Active Directory domain whose domain controllers are hosted exclusively on Azure virtual machines.</span></span> <span data-ttu-id="e0141-146">Также завершится неудачно, если hello VPN завершается ошибкой, хотя есть важные toonote, проверка подлинности и других операций, зависящих от Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-146">It is important toonote, though, that if hello VPN fails, authentication and other operations that depend on Windows Server Active Directory will also fail.</span></span> <span data-ttu-id="e0141-147">Хотя пользователей может быть toosign доступ с помощью существующих кэшированные учетные данные, все для одноранговых или клиент сервер проверки подлинности для какие билеты еще toobe выдан или устарели завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="e0141-147">While users may be able toosign in using existing cached credentials, all peer-to-peer or client-to-server authentication attempts for which tickets have yet toobe issued or have become stale will fail.</span></span>

<span data-ttu-id="e0141-148">В разделе [виртуальной сети](http://azure.microsoft.com/documentation/services/virtual-network/) демонстрационный видеоролик и список пошаговых руководств, включая [настроить VPN сайтами в hello портал Azure](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-148">See [Virtual Network](http://azure.microsoft.com/documentation/services/virtual-network/) for a demonstration video and a list of step-by-step tutorials, including [Configure a Site-to-Site VPN in hello Azure portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e0141-149">Вы также можете развернуть Windows Server Active Directory в виртуальной сети Azure, которая не подключена к локальной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-149">You can also deploy Windows Server Active Directory on an Azure virtual network that does not have connectivity with an on-premises network.</span></span> <span data-ttu-id="e0141-150">Hello рекомендации в этом разделе, тем не менее, предполагается использование виртуальной сети Azure, так как она предоставляет IP-адресов, которые essential tooWindows Server.</span><span class="sxs-lookup"><span data-stu-id="e0141-150">hello guidelines in this topic, however, assume that an Azure virtual network is used because it provides IP addressing capabilities that are essential tooWindows Server.</span></span>
> 
> 

### <a name="static-ip-addresses-must-be-configured-with-azure-powershell"></a><span data-ttu-id="e0141-151">Необходимость настройки статических IP-адресов в Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="e0141-151">Static IP addresses must be configured with Azure PowerShell.</span></span>
<span data-ttu-id="e0141-152">Динамические адреса выделяются по умолчанию, но вместо этого используйте tooassign командлета Set-AzureStaticVNetIP hello статический IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="e0141-152">Dynamic addresses are allocated by default, but use hello Set-AzureStaticVNetIP cmdlet tooassign a static IP address instead.</span></span> <span data-ttu-id="e0141-153">Он устанавливает статический IP-адрес, который будет сохраняться при восстановлении работоспособности службы, а также при завершении работы и перезагрузке виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="e0141-153">That sets a static IP address that will persist through service healing and VM shutdown/restart.</span></span> <span data-ttu-id="e0141-154">Дополнительные сведения см. в записи блога [Static internal IP address for virtual machines](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) (Настройка статического внутреннего IP-адреса для виртуальных машин).</span><span class="sxs-lookup"><span data-stu-id="e0141-154">For more information, see [Static internal IP address for virtual machines](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span></span>

## <span data-ttu-id="e0141-155"><a name="BKMK_Glossary"></a>Термины и определения</span><span class="sxs-lookup"><span data-stu-id="e0141-155"><a name="BKMK_Glossary"></a>Terms and definitions</span></span>
<span data-ttu-id="e0141-156">Hello Приведем неполном списке терминов для различных технологий Azure, которые будет ссылаться в этой статье.</span><span class="sxs-lookup"><span data-stu-id="e0141-156">hello following is a non-exhaustive list of terms for various Azure technologies which will be referenced in this article.</span></span>

* <span data-ttu-id="e0141-157">**Виртуальные машины Azure**: hello предложения IaaS в Azure, позволяющая клиентам toodeploy виртуальных машин, работающих практически любого традиционно в локальной рабочей нагрузки сервера.</span><span class="sxs-lookup"><span data-stu-id="e0141-157">**Azure virtual machines**: hello IaaS offering in Azure that allows customers toodeploy VMs running nearly any traditionally on-premises server workload.</span></span>
* <span data-ttu-id="e0141-158">**Виртуальная сеть Azure**: hello, сетевые службы в Azure, которая позволяет клиентам создавать и управлять виртуальными сетями в Azure, а также безопасно соединять их собственные tootheir локальной сетевой инфраструктурой с помощью виртуальной частной сети (VPN).</span><span class="sxs-lookup"><span data-stu-id="e0141-158">**Azure virtual network**: hello networking service in Azure that lets customers create and manage virtual networks in Azure and securely link them tootheir own on-premises networking infrastructure by using a virtual private network (VPN).</span></span>
* <span data-ttu-id="e0141-159">**Виртуальный IP-адрес**: IP-адрес Интернет-адрес, который указывается не привязана tooa конкретного компьютера или интерфейсу сетевого адаптера.</span><span class="sxs-lookup"><span data-stu-id="e0141-159">**Virtual IP address**: An internet-facing IP address that is not bound tooa specific computer or network interface card.</span></span> <span data-ttu-id="e0141-160">Облачным службам назначается виртуальный IP-адрес для получения сетевого трафика, являющийся перенаправленный tooan виртуальной Машине Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-160">Cloud services are assigned a virtual IP address for receiving network traffic which is redirected tooan Azure VM.</span></span> <span data-ttu-id="e0141-161">Этот адрес является свойством облачной службы, в которую может входить одна или несколько виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-161">A virtual IP address is a property of a cloud-service which can contain one or more Azure virtual machines.</span></span> <span data-ttu-id="e0141-162">Кроме того, обратите внимание, что в виртуальной сети Azure может работать одна или несколько облачных служб.</span><span class="sxs-lookup"><span data-stu-id="e0141-162">Also note that an Azure virtual network can contain one or more cloud-services.</span></span> <span data-ttu-id="e0141-163">Виртуальные IP-адреса обеспечивают системные возможности балансировки рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="e0141-163">Virtual IP addresses provide native load-balancing capabilities.</span></span>
* <span data-ttu-id="e0141-164">**Динамический IP-адрес**: это hello IP-адрес, который является только внутренним.</span><span class="sxs-lookup"><span data-stu-id="e0141-164">**Dynamic IP address**: This is hello IP address that is internal only.</span></span> <span data-ttu-id="e0141-165">Его следует настроить как статический IP-адрес (с помощью командлета Set-AzureStaticVNetIP hello) для виртуальных машин, на которых размещаются роли сервера DC/DNS hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-165">It should be configured as a static IP address (by using hello Set-AzureStaticVNetIP cmdlet) for VMs that host hello DC/DNS server roles.</span></span>
* <span data-ttu-id="e0141-166">**Восстановление службы**: ошибка в процессе hello которого Azure автоматически возвращает tooa служба работает состояния снова после обнаружения службы hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-166">**Service healing**: hello process in which Azure automatically returns a service tooa running state again after it detects that hello service has failed.</span></span> <span data-ttu-id="e0141-167">Восстановление службы является одним из аспектов hello Azure поддержания доступности и устойчивости.</span><span class="sxs-lookup"><span data-stu-id="e0141-167">Service healing is one of hello aspects of Azure that supports availability and resiliency.</span></span> <span data-ttu-id="e0141-168">Хотя это маловероятно, результат hello после проведения восстановления для выполнения на виртуальной Машине контроллера домена службы аналогичные tooan незапланированной перезагрузкой, но имеет несколько побочных эффектов:</span><span class="sxs-lookup"><span data-stu-id="e0141-168">While unlikely, hello result following a service healing incident for a DC running on a VM is similar tooan unplanned reboot, but has a few side-effects:</span></span>
  
  * <span data-ttu-id="e0141-169">изменится виртуальный сетевой адаптер Hello в hello виртуальной Машины</span><span class="sxs-lookup"><span data-stu-id="e0141-169">hello virtual network adapter in hello VM will change</span></span>
  * <span data-ttu-id="e0141-170">изменится MAC-адрес виртуального сетевого адаптера hello Hello</span><span class="sxs-lookup"><span data-stu-id="e0141-170">hello MAC address of hello virtual network adapter will change</span></span>
  * <span data-ttu-id="e0141-171">изменится идентификатор процессора и процессорных Ресурсов hello ВМ Hello</span><span class="sxs-lookup"><span data-stu-id="e0141-171">hello Processor/CPU ID of hello VM will change</span></span>
  * <span data-ttu-id="e0141-172">Hello IP-конфигурации hello виртуального сетевого адаптера не изменится при условии, что hello виртуальной Машины — вложенное tooa виртуальная сеть и hello IP-адрес является статическим.</span><span class="sxs-lookup"><span data-stu-id="e0141-172">hello IP configuration of hello virtual network adapter will not change as long as hello VM is attached tooa virtual network and hello VM’s IP address is static.</span></span>
  
  <span data-ttu-id="e0141-173">Ни один из этих процессов влияет на Windows Server Active Directory, поскольку эта технология не зависит hello MAC-адрес или идентификатор процессора или ЦП, и все развертывания Windows Server Active Directory в Azure рекомендуется toobe проведение виртуальной сети Azure, как описано выше .</span><span class="sxs-lookup"><span data-stu-id="e0141-173">None of these behaviors affect Windows Server Active Directory because it has no dependency on hello MAC address or Processor/CPU ID, and all Windows Server Active Directory deployments on Azure are recommended toobe run on an Azure virtual network as outlined above.</span></span>

## <a name="is-it-safe-toovirtualize-windows-server-active-directory-domain-controllers"></a><span data-ttu-id="e0141-174">Это безопасно toovirtualize контроллеров домена Windows Server Active Directory?</span><span class="sxs-lookup"><span data-stu-id="e0141-174">Is it safe toovirtualize Windows Server Active Directory domain controllers?</span></span>
<span data-ttu-id="e0141-175">Развертывание контроллеров домена Windows Server Active Directory на виртуальных машинах Azure — тема toohello же правила, как при запуске контроллеров на локальной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="e0141-175">Deploying Windows Server Active Directory DCs on Azure virtual machines is subject toohello same guidelines as running DCs on-premises in a virtual machine.</span></span> <span data-ttu-id="e0141-176">Запуск виртуализированных контроллеров домена безопасен, если выполнены рекомендации по их резервному копированию и восстановлению.</span><span class="sxs-lookup"><span data-stu-id="e0141-176">Running virtualized DCs is a safe practice as long as guidelines for backing up and restoring DCs are followed.</span></span> <span data-ttu-id="e0141-177">Дополнительные сведения об ограничениях запуска виртуализированных контроллеров домена и рекомендации по нему см. в разделе [Работа контроллеров домена в среде Hyper-V](https://technet.microsoft.com/library/dd363553).</span><span class="sxs-lookup"><span data-stu-id="e0141-177">For more information about constraints and guidelines for running virtualized DCs, see [Running Domain Controllers in Hyper-V](https://technet.microsoft.com/library/dd363553).</span></span>

<span data-ttu-id="e0141-178">Низкоуровневые оболочки предоставляют и упрощают технологии, использование которых может создавать проблемы во многих распределенных системах, в том числе в Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-178">Hypervisors provide or trivialize technologies that can cause problems for many distributed systems, including Windows Server Active Directory.</span></span> <span data-ttu-id="e0141-179">Например на физическом сервере можно клонировать диск или используйте неподдерживаемые методы tooroll назад hello состояние сервера, включая использование SAN-сетей и т. д., но сделать это на физическом сервере гораздо сложнее, чем восстановление моментального снимка виртуальной машины в низкоуровневой оболочке.</span><span class="sxs-lookup"><span data-stu-id="e0141-179">For example, on a physical server, you can clone a disk or use unsupported methods tooroll back hello state of a server, including using SANs and so on, but doing that on a physical server is much harder than restoring a virtual machine snapshot in a hypervisor.</span></span> <span data-ttu-id="e0141-180">Azure предлагает функциональность, что может привести к hello же нежелательном условие.</span><span class="sxs-lookup"><span data-stu-id="e0141-180">Azure offers functionality that can result in hello same undesirable condition.</span></span> <span data-ttu-id="e0141-181">Например не следует копировать VHD-файлы контроллеров домена вместо выполнения обычного резервного копирования, так как их восстановление может привести к аналогичные моментального снимка toousing ситуации восстановления функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="e0141-181">For example, you should not copy VHD files of DCs instead of performing regular backups because restoring them can result in a similar situation toousing snapshot restore features.</span></span>

<span data-ttu-id="e0141-182">Подобные откаты вводят пузырьков USN, можно привести toopermanently разные состояния между контроллерами доменов.</span><span class="sxs-lookup"><span data-stu-id="e0141-182">Such rollbacks introduce USN bubbles that can lead toopermanently divergent states between DCs.</span></span> <span data-ttu-id="e0141-183">Кроме того, могут возникнуть такие проблемы:</span><span class="sxs-lookup"><span data-stu-id="e0141-183">That can cause issues such as:</span></span>

* <span data-ttu-id="e0141-184">наличие устаревших объектов;</span><span class="sxs-lookup"><span data-stu-id="e0141-184">Lingering objects</span></span>
* <span data-ttu-id="e0141-185">наличие несогласованных паролей;</span><span class="sxs-lookup"><span data-stu-id="e0141-185">Inconsistent passwords</span></span>
* <span data-ttu-id="e0141-186">наличие несогласованных значений атрибутов;</span><span class="sxs-lookup"><span data-stu-id="e0141-186">Inconsistent attribute values</span></span>
* <span data-ttu-id="e0141-187">Несоответствия схемы, если откат hello хозяин схемы.</span><span class="sxs-lookup"><span data-stu-id="e0141-187">Schema mismatches if hello schema master is rolled back</span></span>

<span data-ttu-id="e0141-188">Дополнительные сведения о влиянии на контроллеры домена см. в разделе об [USN и откате USN](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span><span class="sxs-lookup"><span data-stu-id="e0141-188">For more information about how DCs are impacted, see [USN and USN Rollback](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span></span>

<span data-ttu-id="e0141-189">Начиная с Windows Server 2012 [в tooAD DS встроены дополнительные меры безопасности](https://technet.microsoft.com/library/hh831734.aspx).</span><span class="sxs-lookup"><span data-stu-id="e0141-189">Beginning with Windows Server 2012, [additional safeguards are built in tooAD DS](https://technet.microsoft.com/library/hh831734.aspx).</span></span> <span data-ttu-id="e0141-190">Эти меры безопасности помогают защитить виртуализированные контроллеры домена от упомянутых выше опасностей hello, при условии, что базовая платформа низкоуровневой оболочки hello поддерживает ИД создания Виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="e0141-190">These safeguards help protect virtualized domain controllers against hello aforementioned problems, as long as hello underlying hypervisor platform supports VM-GenerationID.</span></span> <span data-ttu-id="e0141-191">Azure поддерживает VM-GenerationID, это означает, что контроллеры домена под управлением Windows Server 2012 или более поздней версии на виртуальных машинах Azure hello дополнительные меры безопасности.</span><span class="sxs-lookup"><span data-stu-id="e0141-191">Azure supports VM-GenerationID, which means that domain controllers that run Windows Server 2012 or later on Azure virtual machines have hello additional safeguards.</span></span>

> [!NOTE]
> <span data-ttu-id="e0141-192">Необходимо завершить работу и перезапустить виртуальную Машину, поддерживаемом hello гостевой операционной системы вместо использования hello hello роль контроллера домена в Azure **завершение работы** параметр в Azure портальных hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-192">You should shut down and restart a VM that runs hello domain controller role in Azure within hello guest operating system instead of using hello **Shut Down** option in hello Azure porta.</span></span> <span data-ttu-id="e0141-193">В настоящее время использование портала tooshut hello работу виртуальной Машины приводит toobe ВМ hello освобождена.</span><span class="sxs-lookup"><span data-stu-id="e0141-193">Today, using hello portal tooshut down a VM causes hello VM toobe deallocated.</span></span> <span data-ttu-id="e0141-194">Освобожденные ВМ имеет преимущество hello не взимается плата, но он также возвращает hello VM-GenerationID, что нежелательно для контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-194">A deallocated VM has hello advantage of not incurring charges, but it also resets hello VM-GenerationID, which is undesirable for a DC.</span></span> <span data-ttu-id="e0141-195">При сбросе hello Виртуальной машины также сбрасывается invocationID hello базы данных hello AD DS, удаляется пул RID hello и SYSVOL помечается как не заслуживающий доверия.</span><span class="sxs-lookup"><span data-stu-id="e0141-195">When hello VM-GenerationID is reset, hello invocationID of hello AD DS database is also reset, hello RID pool is discarded, and SYSVOL is marked as non-authoritative.</span></span> <span data-ttu-id="e0141-196">Дополнительные сведения см. в разделе [tooActive введение Directory Domain Services (AD DS) Virtualization](https://technet.microsoft.com/library/hh831734.aspx) и [безопасная виртуализация DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span><span class="sxs-lookup"><span data-stu-id="e0141-196">For more information, see [Introduction tooActive Directory Domain Services (AD DS) Virtualization](https://technet.microsoft.com/library/hh831734.aspx) and [Safely Virtualizing DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span></span>
> 
> 

## <a name="why-deploy-windows-server-ad-ds-on-azure-virtual-machines"></a><span data-ttu-id="e0141-197">Почему стоит развертывать Windows Server AD DS на виртуальных машинах Azure?</span><span class="sxs-lookup"><span data-stu-id="e0141-197">Why deploy Windows Server AD DS on Azure Virtual Machines?</span></span>
<span data-ttu-id="e0141-198">Для развертывания на виртуальных машинах в Azure подходит много сценариев развертывания Windows Server AD DS.</span><span class="sxs-lookup"><span data-stu-id="e0141-198">Many Windows Server AD DS deployment scenarios are well-suited for deployment as VMs on Azure.</span></span> <span data-ttu-id="e0141-199">Например предположим, что имеется компания в Европе, которой необходимо tooauthenticate пользователей в удаленном местоположении в Азии.</span><span class="sxs-lookup"><span data-stu-id="e0141-199">For example, suppose you have a company in Europe that needs tooauthenticate users in a remote location in Asia.</span></span> <span data-ttu-id="e0141-200">Hello компании не развернут ранее Windows Server контроллеров домена Active Directory в Азии из-за затрат toohello toodeploy или ограниченного опыта toomanage hello серверов после развертывания.</span><span class="sxs-lookup"><span data-stu-id="e0141-200">hello company has not previously deployed Windows Server Active Directory DCs in Asia due toohello cost toodeploy them and limited expertise toomanage hello servers post-deployment.</span></span> <span data-ttu-id="e0141-201">В результате запросы проверки подлинности из Азии обслуживают контроллеры домена в Европе, но неэффективно.</span><span class="sxs-lookup"><span data-stu-id="e0141-201">As a result, authentication requests from Asia are serviced by DCs in Europe with suboptimal results.</span></span> <span data-ttu-id="e0141-202">В этом случае можно развернуть КД на виртуальной Машине, который указан, должны быть запущены в центре обработки данных Azure в Азии hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-202">In this case, you can deploy a DC on a VM that you have specified must be run within hello Azure datacenter in Asia.</span></span> <span data-ttu-id="e0141-203">Присоединение этого контроллера домена tooan виртуальной сети Azure, подключенной непосредственно в удаленном расположении toohello улучшит производительность процесса проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="e0141-203">Attaching that DC tooan Azure virtual network that is connected directly toohello remote location will improve authentication performance.</span></span>

<span data-ttu-id="e0141-204">Azure также хорошо подходит как замена toootherwise дорогостоящих аварийного восстановления (DR) узлов.</span><span class="sxs-lookup"><span data-stu-id="e0141-204">Azure is also well-suited as a substitute toootherwise costly disaster recovery (DR) sites.</span></span> <span data-ttu-id="e0141-205">Hello относительно недорогая цена размещения малого числа контроллеров домена и одной виртуальной сети в Azure представляет является привлекательной альтернативой.</span><span class="sxs-lookup"><span data-stu-id="e0141-205">hello relatively low-cost of hosting a small number of domain controllers and a single virtual network on Azure represents an attractive alternative.</span></span>

<span data-ttu-id="e0141-206">Наконец вы можете toodeploy сетевое приложение в Azure, такие как SharePoint, которому требуется Windows Server Active Directory, но не требуется на hello в локальной сети или hello корпоративной Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-206">Finally, you may want toodeploy a network application on Azure, such as SharePoint, that requires Windows Server Active Directory but has no dependency on hello on-premises network or hello corporate Windows Server Active Directory.</span></span> <span data-ttu-id="e0141-207">В этом случае изолированного леса в Azure toomeet hello SharePoint сервера оптимальным будет развертывание.</span><span class="sxs-lookup"><span data-stu-id="e0141-207">In this case, deploying an isolated forest on Azure toomeet hello SharePoint server’s requirements is optimal.</span></span> <span data-ttu-id="e0141-208">Еще раз и развертывание сетевых приложений, которые требуют подключения к toohello в локальной сети и hello корпоративной Active Directory также поддерживается.</span><span class="sxs-lookup"><span data-stu-id="e0141-208">Again, deploying network applications that do require connectivity toohello on-premises network and hello corporate Active Directory is also supported.</span></span>

> [!NOTE]
> <span data-ttu-id="e0141-209">Так как она предоставляет соединение 3-го уровня hello VPN-компонента, обеспечивающий связь между виртуальной сетью Azure и локальной сети можно также включить рядовыми серверами, работающими tooleverage на локальных контроллеров доменов, работающих как виртуальные машины Azure в Azure Виртуальная сеть.</span><span class="sxs-lookup"><span data-stu-id="e0141-209">Since it provides a layer-3 connection, hello VPN component that provides connectivity between an Azure virtual network and an on-premises network can also enable member servers that run on-premises tooleverage DCs that run as Azure virtual machines on Azure virtual network.</span></span> <span data-ttu-id="e0141-210">Однако в случае недоступности hello VPN обмен данными между локальными компьютерами и контроллерами домена в Azure не будет работать, приводит к проверки подлинности и других ошибок.</span><span class="sxs-lookup"><span data-stu-id="e0141-210">But if hello VPN is unavailable, communication between on-premises computers and Azure-based domain controllers will not function, resulting in authentication and various other errors.</span></span>  
> 
> 

## <a name="contrasts-between-deploying-windows-server-active-directory-domain-controllers-on-azure-virtual-machines-versus-on-premises"></a><span data-ttu-id="e0141-211">Разница между развертыванием контроллеров домена Windows Server Active Directory на виртуальных машинах Azure и локальным развертыванием</span><span class="sxs-lookup"><span data-stu-id="e0141-211">Contrasts between deploying Windows Server Active Directory domain controllers on Azure Virtual Machines versus on-premises</span></span>
* <span data-ttu-id="e0141-212">Для любого сценария развертывания Windows Server Active Directory, который включает более одной виртуальной Машины это необходимые toouse виртуальной сети Azure согласованность IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="e0141-212">For any Windows Server Active Directory deployment scenario that includes more than a single VM, it is necessary toouse an Azure virtual network for IP address consistency.</span></span> <span data-ttu-id="e0141-213">Обратите внимание, в этом руководстве подразумевается, что контроллеры домена работают в виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-213">Note that this guide assumes that DCs are running on an Azure virtual network.</span></span>
* <span data-ttu-id="e0141-214">Как и для локальных контроллеров, рекомендуется настройка статических IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="e0141-214">As with on-premises DCs, static IP addresses are recommended.</span></span> <span data-ttu-id="e0141-215">Статический IP-адрес можно настроить только с помощью Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e0141-215">A static IP address can only be configured by using Azure PowerShell.</span></span> <span data-ttu-id="e0141-216">Дополнительные сведения см. в статье [Static internal IP address for VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) (Настройка статического внутреннего IP-адреса для виртуальных машин).</span><span class="sxs-lookup"><span data-stu-id="e0141-216">See [Static internal IP address for VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) for more details.</span></span> <span data-ttu-id="e0141-217">Если имеются системы мониторинга или другие решения, которые проверяют статический IP-адрес в пределах hello гостевой операционной системы, можно назначить hello же статического свойства IP-адреса toohello сетевой адаптер из виртуальной Машины hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-217">If you have monitoring systems or other solutions that check for static IP address configuration within hello guest operating system, you can assign hello same static IP address toohello network adapter properties of hello VM.</span></span> <span data-ttu-id="e0141-218">Но Обратите внимание, что для этого сетевого адаптера hello будут потеряны, если hello ВМ пройдет Восстановление службы или завершить работу портала hello и ей адреса будет отменено.</span><span class="sxs-lookup"><span data-stu-id="e0141-218">But be aware that hello network adapter will be discarded if hello VM undergoes service healing or is shut down in hello portal and has its address deallocated.</span></span> <span data-ttu-id="e0141-219">В этом случае потребуется hello статический IP-адрес в виртуальной машине hello toobe сброса.</span><span class="sxs-lookup"><span data-stu-id="e0141-219">In that case, hello static IP address within hello guest will need toobe reset.</span></span>
* <span data-ttu-id="e0141-220">Развертывание виртуальных машин в виртуальной сети не подразумевает (и не требует) подключения к задней tooan локальной сети; Hello виртуальная сеть лишь обеспечивает данную возможность.</span><span class="sxs-lookup"><span data-stu-id="e0141-220">Deploying VMs on a virtual network does not imply (or require) connectivity back tooan on-premises network; hello virtual network merely enables that possibility.</span></span> <span data-ttu-id="e0141-221">Чтобы обеспечить частную связь между Azure и вашей локальной сетью, нужно создать виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="e0141-221">You must create a virtual network for private communication between Azure and your on-premises network.</span></span> <span data-ttu-id="e0141-222">Необходимо toodeploy конечной точки VPN hello в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-222">You need toodeploy a VPN endpoint on hello on-premises network.</span></span> <span data-ttu-id="e0141-223">Hello VPN открывается из Azure toohello локальной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-223">hello VPN is opened from Azure toohello on-premises network.</span></span> <span data-ttu-id="e0141-224">Дополнительные сведения см. в разделе [Обзор виртуальной сети](../virtual-network/virtual-networks-overview.md) и [настроить VPN сайтами в hello портала Azure](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-224">For more information, see [Virtual Network Overview](../virtual-network/virtual-networks-overview.md) and [Configure a Site-to-Site VPN in hello Azure Portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e0141-225">Параметр слишком[создать VPN-Подключение точка сеть](../vpn-gateway/vpn-gateway-point-to-site-create.md) — доступные tooconnect отдельных компьютеров Windows напрямую tooan виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-225">An option too[create a point-to-site VPN](../vpn-gateway/vpn-gateway-point-to-site-create.md) is available tooconnect individual Windows-based computers directly tooan Azure virtual network.</span></span>
> 
> 

* <span data-ttu-id="e0141-226">Azure взимает плату за исходящий трафик (не за входящий) независимо от того, создана ли виртуальная сеть.</span><span class="sxs-lookup"><span data-stu-id="e0141-226">Regardless of whether you create a virtual network or not, Azure charges for egress traffic but not ingress.</span></span> <span data-ttu-id="e0141-227">Объем входящего трафика развертывания может зависеть от выбранной архитектуры Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-227">Various Windows Server Active Directory design choices can affect how much egress traffic is generated by a deployment.</span></span> <span data-ttu-id="e0141-228">Например, при развертывании контроллера домена только для чтения входящий трафик ограничен, так как исходящие данные не реплицируются.</span><span class="sxs-lookup"><span data-stu-id="e0141-228">For example, deploying a read-only domain controller (RODC) limits egress traffic because it does not replicate outbound.</span></span> <span data-ttu-id="e0141-229">Но hello решение toodeploy RODC необходимо оценивать с tooperform необходимость hello toobe записи операций, выполняемых hello контроллера домена и hello [совместимости](https://technet.microsoft.com/library/cc755190) у приложений и служб в hello сайта с подобными контроллерами.</span><span class="sxs-lookup"><span data-stu-id="e0141-229">But hello decision toodeploy an RODC needs toobe weighed against hello need tooperform write operations against hello DC and hello [compatibility](https://technet.microsoft.com/library/cc755190) that applications and services in hello site have with RODCs.</span></span> <span data-ttu-id="e0141-230">Дополнительные сведения о ценах на использование трафика см. в разделе [Цены Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="e0141-230">For more information about traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>
* <span data-ttu-id="e0141-231">Хотя у вас есть полный контроль над какие toouse ресурсы сервера для виртуальных машин локально, например ОЗУ, место на диске и т. д., в Azure необходимо выбрать из списка предварительно определенных размеров сервера.</span><span class="sxs-lookup"><span data-stu-id="e0141-231">While you have complete control over what server resources toouse for VMs on-premises, such as RAM, disk size, and so on, on Azure you must select from a list of preconfigured server sizes.</span></span> <span data-ttu-id="e0141-232">Для контроллера домена в добавление диска операционной системы toohello базы данных заказа toostore hello Windows Server Active Directory требуется диск данных.</span><span class="sxs-lookup"><span data-stu-id="e0141-232">For a DC, a data disk is needed in addition toohello operating system disk in order toostore hello Windows Server Active Directory database.</span></span>

## <a name="can-you-deploy-windows-server-ad-fs-on-azure-virtual-machines"></a><span data-ttu-id="e0141-233">Можно ли развернуть Windows Server AD FS на виртуальных машинах Azure?</span><span class="sxs-lookup"><span data-stu-id="e0141-233">Can you deploy Windows Server AD FS on Azure virtual machines?</span></span>
<span data-ttu-id="e0141-234">Да, можно развернуть Windows Server AD FS на виртуальных машинах Azure и hello [советы и рекомендации по развертыванию AD FS](https://technet.microsoft.com/library/dn151324.aspx) локальной применяются tooAD FS развертывания в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-234">Yes, you can deploy Windows Server AD FS on Azure virtual machines, and hello [best practices for AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) on-premises apply equally tooAD FS deployment on Azure.</span></span> <span data-ttu-id="e0141-235">Но некоторые рекомендации по hello, таких как Балансировка нагрузки и высокий уровень доступности требует технологии, отсутствующие в AD FS возможностях сам.</span><span class="sxs-lookup"><span data-stu-id="e0141-235">But some of hello best practices such as load balancing and high availability require technologies beyond what AD FS offers itself.</span></span> <span data-ttu-id="e0141-236">Они должны предоставляться базовой инфраструктурой hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-236">They must be provided by hello underlying infrastructure.</span></span> <span data-ttu-id="e0141-237">Рассмотрим некоторые из этих рекомендаций, чтобы узнать, как их реализовать с помощью виртуальных машин Azure и виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-237">Let’s review some of those best practices and see how they can be achieved by using Azure VMs and an Azure virtual network.</span></span>

1. <span data-ttu-id="e0141-238">**Никогда не предоставлять серверов security token service (STS) непосредственно toohello Интернета.**</span><span class="sxs-lookup"><span data-stu-id="e0141-238">**Never expose security token service (STS) servers directly toohello Internet.**</span></span>
   
    <span data-ttu-id="e0141-239">Это важно, поскольку hello STS издает маркеры безопасности.</span><span class="sxs-lookup"><span data-stu-id="e0141-239">This is important because hello STS issues security tokens.</span></span> <span data-ttu-id="e0141-240">В результате серверы STS такие как серверы AD FS должна обрабатываться с hello таким же уровнем защиты как контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-240">As a result, STS servers such as AD FS servers should be treated with hello same level of protection as a domain controller.</span></span> <span data-ttu-id="e0141-241">В случае компрометации STS пользователи-злоумышленники имеют hello tooissue возможность доступа токены, потенциально могут содержать утверждения их выбор toorelying приложений и других серверов STS в доверяющих организациях.</span><span class="sxs-lookup"><span data-stu-id="e0141-241">If an STS is compromised, malicious users have hello ability tooissue access tokens potentially containing claims of their choosing toorelying party applications and other STS servers in trusting organizations.</span></span>
2. <span data-ttu-id="e0141-242">**Развертывание контроллеров домена Active Directory для всех доменов пользователей в сетевых как серверы AD FS hello hello.**</span><span class="sxs-lookup"><span data-stu-id="e0141-242">**Deploy Active Directory domain controllers for all user domains in hello same network as hello AD FS servers.**</span></span>
   
    <span data-ttu-id="e0141-243">Серверы AD FS используют доменные службы Active Directory tooauthenticate пользователей.</span><span class="sxs-lookup"><span data-stu-id="e0141-243">AD FS servers use Active Directory Domain Services tooauthenticate users.</span></span> <span data-ttu-id="e0141-244">Рекомендуется toodeploy контроллеров домена на hello сетевых как серверы hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-244">It is recommended toodeploy domain controllers on hello same network as hello AD FS servers.</span></span> <span data-ttu-id="e0141-245">Это обеспечивает непрерывность бизнеса в случае hello связь между hello сети Azure, а не работает в локальной сети и позволяет уменьшить задержку и повышенную производительность для имен входа.</span><span class="sxs-lookup"><span data-stu-id="e0141-245">This provides business continuity in case hello link between hello Azure network and your on-premises network is broken, and enables lower latency and increased performance for logins.</span></span>
3. <span data-ttu-id="e0141-246">**Разверните несколько узлов AD FS для обеспечения высокой доступности и балансировки нагрузки hello.**</span><span class="sxs-lookup"><span data-stu-id="e0141-246">**Deploy multiple AD FS nodes for high availability and balancing hello load.**</span></span>
   
    <span data-ttu-id="e0141-247">В большинстве случаев сбой приложения, обслуживаемого AD FS hello недопустима, поскольку приложения hello, которые требуют токены безопасности, часто критически важны для бизнеса.</span><span class="sxs-lookup"><span data-stu-id="e0141-247">In most cases, hello failure of an application that AD FS enables is unacceptable because hello applications that require security tokens are often mission critical.</span></span> <span data-ttu-id="e0141-248">В результате и поскольку AD FS теперь располагается hello критический путь tooaccessing критически важных приложений, служба hello AD FS необходим высокий уровень доступности, через несколько прокси-серверы AD FS и серверами AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-248">As a result, and because AD FS now resides in hello critical path tooaccessing mission critical applications, hello AD FS service must be highly available through multiple AD FS proxies and AD FS servers.</span></span> <span data-ttu-id="e0141-249">tooachieve распределение запросов подсистемы балансировки нагрузки обычно разворачиваются перед прокси-серверы hello AD FS и серверами AD FS hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-249">tooachieve distribution of requests, load balancers are typically deployed in front of both hello AD FS Proxies and hello AD FS servers.</span></span>
4. <span data-ttu-id="e0141-250">**Разверните один или несколько узлов прокси-служб веб-приложений для доступа в Интернете.**</span><span class="sxs-lookup"><span data-stu-id="e0141-250">**Deploy one or more Web Application Proxy nodes for internet access.**</span></span>
   
    <span data-ttu-id="e0141-251">Если пользователям требуется tooaccess приложениям, защищенным службой hello AD FS, hello AD FS службы потребностей toobe предоставляемые hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="e0141-251">When users need tooaccess applications protected by hello AD FS service, hello AD FS service needs toobe available from hello internet.</span></span> <span data-ttu-id="e0141-252">Это достигается путем развертывания службы прокси веб-приложения hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-252">This is achieved by deploying hello Web Application Proxy service.</span></span> <span data-ttu-id="e0141-253">Настоятельно рекомендуется toodeploy больше, чем один узел для hello в целях балансировки нагрузки и высокий уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="e0141-253">It is strongly recommended toodeploy more than one node for hello purposes of high availability and load balancing.</span></span>
5. <span data-ttu-id="e0141-254">**Ограничьте доступ из hello прокси веб-приложения узлы toointernal сетевых ресурсов.**</span><span class="sxs-lookup"><span data-stu-id="e0141-254">**Restrict access from hello Web Application Proxy nodes toointernal network resources.**</span></span>
   
    <span data-ttu-id="e0141-255">Здравствуйте, tooaccess tooallow внешних пользователей AD FS из Интернета, необходимо toodeploy узлы прокси веб-приложения (или прокси-сервера AD FS в более ранних версиях Windows Server).</span><span class="sxs-lookup"><span data-stu-id="e0141-255">tooallow external users tooaccess AD FS from hello internet, you need toodeploy Web Application Proxy nodes (or AD FS Proxy in earlier versions of Windows Server).</span></span> <span data-ttu-id="e0141-256">Hello прокси-сервера веб-приложение, которое узлы находятся непосредственно предоставляются toohello Интернета.</span><span class="sxs-lookup"><span data-stu-id="e0141-256">hello Web Application proxy nodes are directly exposed toohello Internet.</span></span> <span data-ttu-id="e0141-257">Они не являются обязательным toobe присоединенных к домену и только требуется доступ к серверам toohello AD FS TCP-портам 443 и 80.</span><span class="sxs-lookup"><span data-stu-id="e0141-257">They are not required toobe domain-joined and they only need access toohello AD FS servers over TCP ports 443 and 80.</span></span> <span data-ttu-id="e0141-258">Настоятельно рекомендуется этой связи tooall заблокирован другими компьютерами (особенно на контроллерах домена).</span><span class="sxs-lookup"><span data-stu-id="e0141-258">It is strongly recommended that communication tooall other computers (especially domain controllers) is blocked.</span></span>
   
    <span data-ttu-id="e0141-259">Обычно это делают локально с использованием сети периметра.</span><span class="sxs-lookup"><span data-stu-id="e0141-259">This is typically achieved on-premises by means of a DMZ.</span></span> <span data-ttu-id="e0141-260">Брандмауэры используют режим белого списка операции toorestrict трафика из hello DMZ toohello в локальной сети (то есть только трафик от hello указанные IP-адреса с указанием через порты допускается, а весь остальной трафик блокируется).</span><span class="sxs-lookup"><span data-stu-id="e0141-260">Firewalls use a whitelist mode of operation toorestrict traffic from hello DMZ toohello on-premises network (that is, only traffic from hello specified IP addresses and over specified ports is allowed, and all other traffic is blocked).</span></span>

<span data-ttu-id="e0141-261">Hello следующей схеме показана традиционном локальном развертывании AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-261">hello following diagram shows a traditional on-premises AD FS deployment.</span></span>

![Схема стандартного локального развертывания служб федерации Active Directory](media/active-directory-deploying-ws-ad-guidelines/ADFS_onprem.png)

<span data-ttu-id="e0141-263">Тем не менее поскольку Azure не предоставляет возможностей собственного, полнофункциональный брандмауэр, другие параметры должны использовать toobe toorestrict трафика.</span><span class="sxs-lookup"><span data-stu-id="e0141-263">However, because Azure does not provide native, full-featured firewall capability, other options need toobe used toorestrict traffic.</span></span> <span data-ttu-id="e0141-264">Hello следующей таблице показаны каждый параметр, преимущества и недостатки.</span><span class="sxs-lookup"><span data-stu-id="e0141-264">hello following table shows each option and its advantages and disadvantages.</span></span>

| <span data-ttu-id="e0141-265">Параметр</span><span class="sxs-lookup"><span data-stu-id="e0141-265">Option</span></span> | <span data-ttu-id="e0141-266">Преимущество</span><span class="sxs-lookup"><span data-stu-id="e0141-266">Advantage</span></span> | <span data-ttu-id="e0141-267">Недостаток</span><span class="sxs-lookup"><span data-stu-id="e0141-267">Disadvantage</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="e0141-268">ACL сети Azure</span><span class="sxs-lookup"><span data-stu-id="e0141-268">Azure network ACLs</span></span>](../virtual-network/virtual-networks-acl.md) |<span data-ttu-id="e0141-269">Стоят меньше, простая начальная настройка</span><span class="sxs-lookup"><span data-stu-id="e0141-269">Less costly and simpler initial configuration</span></span> |<span data-ttu-id="e0141-270">Требуется дополнительная настройка ACL, если новые виртуальные машины будут добавлены toohello развертывания</span><span class="sxs-lookup"><span data-stu-id="e0141-270">Additional network ACL configuration required if any new VMs are added toohello deployment</span></span> |
| [<span data-ttu-id="e0141-271">Barracuda NG Firewall</span><span class="sxs-lookup"><span data-stu-id="e0141-271">Barracuda NG firewall</span></span>](https://www.barracuda.com/products/ngfirewall) |<span data-ttu-id="e0141-272">Режим списка разрешений, не требуется настройка ACL</span><span class="sxs-lookup"><span data-stu-id="e0141-272">Whitelist mode of operation and it requires no network ACL configuration</span></span> |<span data-ttu-id="e0141-273">Стоит дороже, сложная начальная настройка</span><span class="sxs-lookup"><span data-stu-id="e0141-273">Increased cost and complexity for initial setup</span></span> |

<span data-ttu-id="e0141-274">в этом случае toodeploy высокоуровневые действия Hello AD FS являются следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e0141-274">hello high-level steps toodeploy AD FS in this case are as follows:</span></span>

1. <span data-ttu-id="e0141-275">Создайте виртуальную сеть с распределенным подключением, используя VPN или [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span><span class="sxs-lookup"><span data-stu-id="e0141-275">Create a virtual network with cross-premises connectivity, using either a VPN or [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span></span>
2. <span data-ttu-id="e0141-276">Развертывание контроллеров домена в виртуальной сети hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-276">Deploy domain controllers on hello virtual network.</span></span> <span data-ttu-id="e0141-277">Этот шаг необязателен, но мы рекомендуем его выполнить.</span><span class="sxs-lookup"><span data-stu-id="e0141-277">This step is optional but recommended.</span></span>
3. <span data-ttu-id="e0141-278">Развертывание присоединенных к домену серверов AD FS в виртуальной сети hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-278">Deploy domain-joined AD FS servers on hello virtual network.</span></span>
4. <span data-ttu-id="e0141-279">Создание [набор с балансировкой нагрузки внутренней](http://azure.microsoft.com/blog/internal-load-balancing/) , входят серверы hello AD FS и использует новый частный IP-адрес в виртуальной сети hello (динамический IP-адрес).</span><span class="sxs-lookup"><span data-stu-id="e0141-279">Create an [internal load balanced set](http://azure.microsoft.com/blog/internal-load-balancing/) that includes hello AD FS servers and uses a new private IP address within hello virtual network (a dynamic IP address).</span></span>
   
   1. <span data-ttu-id="e0141-280">Обновите DNS toocreate hello полное доменное имя toopoint toohello закрытый (динамически) IP-адрес набора hello внутренней подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="e0141-280">Update DNS toocreate hello FQDN toopoint toohello private (dynamic) IP address of hello internal load balanced set.</span></span>
5. <span data-ttu-id="e0141-281">Создание облачной службы (или отдельной виртуальной сети) для hello узлы прокси веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="e0141-281">Create a cloud service (or a separate virtual network) for hello Web Application Proxy nodes.</span></span>
6. <span data-ttu-id="e0141-282">Развертывание узлов прокси веб-приложения hello в hello облачной службы или виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="e0141-282">Deploy hello Web Application Proxy nodes in hello cloud service or virtual network</span></span>
   
   1. <span data-ttu-id="e0141-283">Создание внешнего комплекта балансировки нагрузки, включает в себя узлы прокси веб-приложения hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-283">Create an external load balanced set that includes hello Web Application Proxy nodes.</span></span>
   2. <span data-ttu-id="e0141-284">Обновите hello внешних DNS имя (FQDN) toopoint toohello облачной службы открытый IP-адрес (hello виртуальный IP-адрес).</span><span class="sxs-lookup"><span data-stu-id="e0141-284">Update hello external DNS name (FQDN) toopoint toohello cloud service public IP address (hello virtual IP address).</span></span>
   3. <span data-ttu-id="e0141-285">Настройка службы федерации Active Directory учетные записи-посредники toouse hello полное доменное имя, соответствующее toohello внутреннего комплекта балансировки нагрузки для серверов hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-285">Configure AD FS proxies toouse hello FQDN that corresponds toohello internal load balanced set for hello AD FS servers.</span></span>
   4. <span data-ttu-id="e0141-286">Обновить веб-сайтов на основе утверждений toouse hello полного доменного ИМЕНИ для поставщика утверждений.</span><span class="sxs-lookup"><span data-stu-id="e0141-286">Update claims-based web sites toouse hello external FQDN for their claims provider.</span></span>
7. <span data-ttu-id="e0141-287">Ограничение доступа между прокси веб-приложения tooany машины в виртуальной сети hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-287">Restrict access between Web Application Proxy tooany machine in hello AD FS virtual network.</span></span>

<span data-ttu-id="e0141-288">трафик toorestrict hello в набор балансировки нагрузки для hello Azure внутренней подсистемы балансировки нагрузки должен toobe настраиваются только портов tooTCP трафика 80 и 443, и удалить все другие трафика toohello внутренний динамический IP-адрес hello набор балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="e0141-288">toorestrict traffic, hello load-balanced set for hello Azure internal load balancer needs toobe configured for only traffic tooTCP ports 80 and 443, and all other traffic toohello internal dynamic IP address of hello load balanced set is dropped.</span></span>

![Схема сетевых списков ACL служб ADFS с разрешенным набором портов TCP 443 и 80.](media/active-directory-deploying-ws-ad-guidelines/ADFS_ACLs.png)

<span data-ttu-id="e0141-290">Трафик toohello AD FS серверы допустимы только по hello следующие источники:</span><span class="sxs-lookup"><span data-stu-id="e0141-290">Traffic toohello AD FS servers would be permitted only by hello following sources:</span></span>

* <span data-ttu-id="e0141-291">Hello Azure внутренней подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="e0141-291">hello Azure internal load balancer.</span></span>
* <span data-ttu-id="e0141-292">Hello IP-адрес администратора hello в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-292">hello IP address of an administrator on hello on-premises network.</span></span>

> [!WARNING]
> <span data-ttu-id="e0141-293">Hello разработки необходимо предотвратить достижение других виртуальных машин в виртуальной сети Azure hello или по локальной сети hello узлы прокси веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="e0141-293">hello design must prevent Web Application Proxy nodes from reaching any other VMs in hello Azure virtual network or any locations on hello on-premises network.</span></span> <span data-ttu-id="e0141-294">Что можно сделать, настроив правила брандмауэра в hello на локальном устройстве для подключений Express Route или hello VPN-устройство для VPN-подключения сеть сеть.</span><span class="sxs-lookup"><span data-stu-id="e0141-294">That can be done by configuring firewall rules in hello on-premises appliance for Express Route connections or hello VPN device for site-to-site VPN connections.</span></span>
> 
> 

<span data-ttu-id="e0141-295">Параметр toothis недостаток — hello необходимость tooconfigure hello списков ACL сети для нескольких устройств, включая внутреннюю подсистему балансировки нагрузки, серверы AD FS hello и другие серверы, которые добавляются toohello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-295">A disadvantage toothis option is hello need tooconfigure hello network ACLs for multiple devices, including internal load balancer, hello AD FS servers, and any other servers that get added toohello virtual network.</span></span> <span data-ttu-id="e0141-296">Если устройство добавляется toohello развертывания без настройки сетевых списков ACL toorestrict трафика tooit, hello все развертывание может быть под угрозой.</span><span class="sxs-lookup"><span data-stu-id="e0141-296">If any device is added toohello deployment without configuring network ACLs toorestrict traffic tooit, hello entire deployment can be at risk.</span></span> <span data-ttu-id="e0141-297">Если hello IP-адреса узлов прокси веб-приложения hello изменятся, необходимо сбросить hello управления сетевым доступом (означающее hello учетные записи-посредники должны быть настроенный toouse [статические динамического IP-адреса](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span><span class="sxs-lookup"><span data-stu-id="e0141-297">If hello IP addresses of hello Web Application Proxy nodes ever change, hello network ACLs must be reset (which means hello proxies should be configured toouse [static dynamic IP addresses](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span></span>

![Службы ADFS в Azure с использованием сетевых списков ACL.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure.png)

<span data-ttu-id="e0141-299">Другой вариант — toouse hello [брандмауэр Barracuda NG](https://www.barracuda.com/products/ngfirewall) устройства toocontrol трафика между прокси-сервера AD FS и серверами AD FS hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-299">Another option is toouse hello [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) appliance toocontrol traffic between AD FS proxy servers and hello AD FS servers.</span></span> <span data-ttu-id="e0141-300">Этот параметр соответствует рекомендациям по безопасности и высокой доступности и требует меньше администрирования после начальной установки hello поскольку hello брандмауэр NG Barracuda использует режим белого списка администрирования брандмауэра и его можно установить непосредственно в виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-300">This option complies with best practices for security and high availability, and requires less administration after hello initial setup because hello Barracuda NG Firewall appliance provides a whitelist mode of firewall administration and it can be installed directly on an Azure virtual network.</span></span> <span data-ttu-id="e0141-301">Любое время, на новый сервер добавлен toohello развертывания, исключает hello необходимость tooconfigure сетевым доступом.</span><span class="sxs-lookup"><span data-stu-id="e0141-301">That eliminates hello need tooconfigure network ACLs any time a new server is added toohello deployment.</span></span> <span data-ttu-id="e0141-302">Но при использовании этого варианта начальное развертывание становится сложнее и дороже.</span><span class="sxs-lookup"><span data-stu-id="e0141-302">But this option adds initial deployment complexity and cost.</span></span>

<span data-ttu-id="e0141-303">В этом случае развертываются две виртуальные сети вместо одной.</span><span class="sxs-lookup"><span data-stu-id="e0141-303">In this case, two virtual networks are deployed instead of one.</span></span> <span data-ttu-id="e0141-304">Мы назовем их VNet1 и VNet2.</span><span class="sxs-lookup"><span data-stu-id="e0141-304">We'll call them VNet1 and VNet2.</span></span> <span data-ttu-id="e0141-305">VNet1 содержит прокси hello, а VNet2 STS hello и hello сетевого подключения задней toohello корпоративной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-305">VNet1 contains hello proxies and VNet2 contains hello STSs and hello network connection back toohello corporate network.</span></span> <span data-ttu-id="e0141-306">Таким образом VNet1 физически (хотя и виртуально) изолирована от VNet2 и, в свою очередь, из корпоративной сети hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-306">VNet1 is therefore physically (albeit virtually) isolated from VNet2 and, in turn, from hello corporate network.</span></span> <span data-ttu-id="e0141-307">VNet1 затем подключенных tooVNet2 с помощью специальной технологии туннелирования, известные как транспорт независимых сетевой архитектуры (TINA).</span><span class="sxs-lookup"><span data-stu-id="e0141-307">VNet1 is then connected tooVNet2 using a special tunneling technology known as Transport Independent Network Architecture (TINA).</span></span> <span data-ttu-id="e0141-308">Hello туннель ТИНА — вложенное tooeach hello виртуальных сетей с помощью брандмауэра Barracuda NG — один брандмауэр barracuda используется для всех виртуальных сетей hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-308">hello TINA tunnel is attached tooeach of hello virtual networks using a Barracuda NG firewall—one Barracuda on each of hello virtual networks.</span></span>  <span data-ttu-id="e0141-309">Для высокой доступности рекомендуется развернуть два брандмауэра Barracuda в каждой виртуальной сети; один активный, другой пассивный hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-309">For high-availability, it is recommended that you deploy two Barracudas on each virtual network; one active, hello other passive.</span></span> <span data-ttu-id="e0141-310">Они предоставляют множество полезных возможностей, которые позволяют нам toomimic hello работу традиционной локальной демилитаризованной ЗОНЫ в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-310">They offer extremely rich firewalling capabilities which allow us toomimic hello operation of a traditional on-premises DMZ in Azure.</span></span>

![Службы ADFS в Azure с использованием брандмауэра.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure_firewall.png)

<span data-ttu-id="e0141-312">Дополнительные сведения см. в разделе [AD FS: расширить утверждениям локального клиентского приложения toohello Internet](#BKMK_CloudOnlyFed).</span><span class="sxs-lookup"><span data-stu-id="e0141-312">For more information, see [AD FS: Extend a claims-aware on-premises front-end application toohello Internet](#BKMK_CloudOnlyFed).</span></span>

### <a name="an-alternative-tooad-fs-deployment-if-hello-goal-is-office-365-sso-alone"></a><span data-ttu-id="e0141-313">Альтернативные tooAD FS развертывания единого входа Office 365 только в случае цели hello</span><span class="sxs-lookup"><span data-stu-id="e0141-313">An alternative tooAD FS deployment if hello goal is Office 365 SSO alone</span></span>
<span data-ttu-id="e0141-314">Если вашей целью является только tooenable входа в Office 365 нет другого полностью альтернативных toodeploying AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-314">There is another alternative toodeploying AD FS altogether if your goal is only tooenable sign-in for Office 365.</span></span> <span data-ttu-id="e0141-315">В этом случае можно просто развернуть службу DirSync с паролем синхронизация локальных и достижения hello аналогичного конечного результата с помощью простого развертывания, поскольку этот подход не требует AD FS или Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-315">In that case, you can simply deploy DirSync with password sync on-premises and achieve hello same end-result with minimal deployment complexity because this approach does not require AD FS or Azure.</span></span>

<span data-ttu-id="e0141-316">Hello следующей таблице приведено сравнение hello вход процессы работы с и без развертывания AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-316">hello following table compares how hello sign-in processes work with and without deploying AD FS.</span></span>

| <span data-ttu-id="e0141-317">Единый вход в Office 365 с использованием AD FS и DirSync</span><span class="sxs-lookup"><span data-stu-id="e0141-317">Office 365 single sign-on using AD FS and DirSync</span></span> | <span data-ttu-id="e0141-318">"Такой же вход" в Office 365 с использованием DirSync и синхронизации паролей</span><span class="sxs-lookup"><span data-stu-id="e0141-318">Office 365 same sign-on using DirSync + Password Sync</span></span> |
| --- | --- |
| <span data-ttu-id="e0141-319">1. пользователь hello журнала tooa корпоративной сети и проверкой подлинности tooWindows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-319">1. hello user logs on tooa corporate network, and is authenticated tooWindows Server Active Directory.</span></span> |<span data-ttu-id="e0141-320">1. пользователь hello журнала tooa корпоративной сети и проверкой подлинности tooWindows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-320">1. hello user logs on tooa corporate network, and is authenticated tooWindows Server Active Directory.</span></span> |
| <span data-ttu-id="e0141-321">2. hello пользователь пытается tooaccess Office 365 (я @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="e0141-321">2. hello user tries tooaccess Office 365 (I am @contoso.com).</span></span> |<span data-ttu-id="e0141-322">2. hello пользователь пытается tooaccess Office 365 (я @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="e0141-322">2. hello user tries tooaccess Office 365 (I am @contoso.com).</span></span> |
| <span data-ttu-id="e0141-323">3. Office 365 перенаправляет пользователя hello tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="e0141-323">3. Office 365 redirects hello user tooAzure AD.</span></span> |<span data-ttu-id="e0141-324">3. Office 365 перенаправляет пользователя hello tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="e0141-324">3. Office 365 redirects hello user tooAzure AD.</span></span> |
| <span data-ttu-id="e0141-325">4. Поскольку Azure AD не может проверить подлинность пользователя hello и учитывает, что отношения доверия с локальным AD FS, он перенаправляет пользователя hello tooAD федерации Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-325">4. Since Azure AD can’t authenticate hello user and understands there is a trust with AD FS on-premises, it redirects hello user tooAD FS.</span></span> |<span data-ttu-id="e0141-326">4. Azure AD не может принимать билеты Kerberos напрямую, и отношений доверия не существует, поэтому он запрашивает hello пользователя ввести учетные данные.</span><span class="sxs-lookup"><span data-stu-id="e0141-326">4. Azure AD can’t accept Kerberos tickets directly and no trust relationship exists so it requests that hello user enter credentials.</span></span> |
| <span data-ttu-id="e0141-327">5. hello пользователь отправляет Kerberos билета toohello AD FS STS.</span><span class="sxs-lookup"><span data-stu-id="e0141-327">5. hello user sends a Kerberos ticket toohello AD FS STS.</span></span> |<span data-ttu-id="e0141-328">5. hello пользователь вводит hello же локальный пароль, и Azure AD проверяет их по hello имя пользователя и пароль, которые были синхронизированы с DirSync.</span><span class="sxs-lookup"><span data-stu-id="e0141-328">5. hello user enters hello same on-premises password, and Azure AD validates them against hello user name and password that was synchronized by DirSync.</span></span> |
| <span data-ttu-id="e0141-329">6. AD FS преобразует hello toohello билет Kerberos не требуется маркер формат и утверждения и перенаправляет пользователя hello tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="e0141-329">6. AD FS transforms hello Kerberos ticket toohello required token format/claims and redirects hello user tooAzure AD.</span></span> |<span data-ttu-id="e0141-330">6. Azure AD перенаправляет пользователя hello tooOffice 365.</span><span class="sxs-lookup"><span data-stu-id="e0141-330">6. Azure AD redirects hello user tooOffice 365.</span></span> |
| <span data-ttu-id="e0141-331">7. hello пользователь проходит проверку подлинности tooAzure AD (выполняется еще одно преобразование).</span><span class="sxs-lookup"><span data-stu-id="e0141-331">7. hello user authenticates tooAzure AD (another transformation occurs).</span></span> |<span data-ttu-id="e0141-332">7. hello пользователь может войти в tooOffice 365 и OWA, используя токен Azure AD hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-332">7. hello user can sign in tooOffice 365 and OWA using hello Azure AD token.</span></span> |
| <span data-ttu-id="e0141-333">8. Azure AD перенаправляет пользователя hello tooOffice 365.</span><span class="sxs-lookup"><span data-stu-id="e0141-333">8. Azure AD redirects hello user tooOffice 365.</span></span> | |
| <span data-ttu-id="e0141-334">9. hello пользователя без уведомления подписывается на tooOffice 365.</span><span class="sxs-lookup"><span data-stu-id="e0141-334">9. hello user is silently signed on tooOffice 365.</span></span> | |

<span data-ttu-id="e0141-335">В hello Office 365 с помощью DirSync с синхронизацией паролей (без AD FS) единый вход заменяется «же вход» где» «просто означает, что пользователю нужно повторно ввести те же учетные данные локально, при доступе к Office 365.</span><span class="sxs-lookup"><span data-stu-id="e0141-335">In hello Office 365 with DirSync with password sync scenario (no AD FS), single sign-on is replaced by “same sign-on” where “same” simply means that users must re-enter their same on-premises credentials when accessing Office 365.</span></span> <span data-ttu-id="e0141-336">Обратите внимание, что эти данные можно запомнить, toohelp браузер пользователя hello уменьшить приглашений в будущем.</span><span class="sxs-lookup"><span data-stu-id="e0141-336">Note that this data can be remembered by hello user’s browser toohelp reduce subsequent prompts.</span></span>

### <a name="additional-food-for-thought"></a><span data-ttu-id="e0141-337">Важные сведения</span><span class="sxs-lookup"><span data-stu-id="e0141-337">Additional food for thought</span></span>
* <span data-ttu-id="e0141-338">При развертывании прокси AD FS на виртуальной машине Azure требуется подключение toohello AD FS серверы.</span><span class="sxs-lookup"><span data-stu-id="e0141-338">If you deploy an AD FS proxy on an Azure virtual machine, connectivity toohello AD FS servers is needed.</span></span> <span data-ttu-id="e0141-339">Если они являются локальными, рекомендуется использовать hello сеть сеть VPN-подключение, предоставляемые hello виртуальной сети tooallow hello прокси веб-приложения узлы toocommunicate со своими серверами AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-339">If they are on-premises, it is recommended that you leverage hello site-to-site VPN connectivity provided by hello virtual network tooallow hello Web Application Proxy nodes toocommunicate with their AD FS servers.</span></span>
* <span data-ttu-id="e0141-340">При развертывании сервера AD FS в Azure виртуального компьютера, контроллеры домена Active Directory сервера tooWindows подключения, хранилищах атрибутов и конфигурации базы данных является обязательным и может потребоваться подключение ExpressRoute или VPN-подключения сеть сеть между hello Azure виртуальной сети и hello в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-340">If you deploy an AD FS server on an Azure virtual machine, connectivity tooWindows Server Active Directory domain controllers, Attribute Stores, and Configuration databases is necessary and may also require an ExpressRoute or a site-to-site VPN connection between hello Azure virtual network and hello on-premises network.</span></span>
* <span data-ttu-id="e0141-341">Счета выставляются tooall трафик из виртуальных машин (исходящий трафик) Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-341">Charges are applied tooall traffic from Azure virtual machines (egress traffic).</span></span> <span data-ttu-id="e0141-342">Если затраты являются определяющим фактором hello, это узлы прокси веб-приложения рекомендуется toodeploy hello в Azure, оставив hello AD FS локальными серверами.</span><span class="sxs-lookup"><span data-stu-id="e0141-342">If cost is hello driving factor, it is advisable toodeploy hello Web Application Proxy nodes on Azure, leaving hello AD FS servers on-premises.</span></span> <span data-ttu-id="e0141-343">Если при развертывании серверов hello AD FS на виртуальных машинах Azure также дополнительные затраты будут платежи tooauthenticate локальных пользователей.</span><span class="sxs-lookup"><span data-stu-id="e0141-343">If hello AD FS servers are deployed on Azure virtual machines as well, additional costs will be incurred tooauthenticate on-premises users.</span></span> <span data-ttu-id="e0141-344">Исходящий трафик приводит к затратам независимо от того, является ли он проходит через hello ExpressRoute или VPN-подключения сеть сеть hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-344">Egress traffic incurs a cost regardless of whether or not it is traversing hello ExpressRoute or hello VPN site-to-site connection.</span></span>
* <span data-ttu-id="e0141-345">Если вы решите toouse Azure собственной балансировки нагрузки возможности для обеспечения высокой доступности серверов AD FS, обратите внимание, что балансировка нагрузки предоставляет пробы, используемые toodetermine hello работоспособности hello виртуальных машин в облачной службе hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-345">If you decide toouse Azure’s native server load balancing capabilities for high availability of AD FS servers, note that load balancing provides probes that are used toodetermine hello health of hello virtual machines within hello cloud service.</span></span> <span data-ttu-id="e0141-346">В случае hello Azure виртуальных машин (как противоположность tooweb или рабочие роли) необходимо использовать пользовательский зонд с момента hello агент, который отвечает toohello пробы по умолчанию не установлен на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-346">In hello case of Azure virtual machines (as opposed tooweb or worker roles), a custom probe must be used since hello agent that responds toohello default probes is not present on Azure virtual machines.</span></span> <span data-ttu-id="e0141-347">Для простоты можно использовать пользовательские TCP-зонды — это требует только соединения TCP (сегмент TCP SYN и получить ответ toowith сегмент TCP SYN ACK) успешно установленных toodetermine работоспособность виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="e0141-347">For simplicity, you might use a custom TCP probe — this requires only that a TCP connection (a TCP SYN segment sent and responded toowith a TCP SYN ACK segment) be successfully established toodetermine virtual machine health.</span></span> <span data-ttu-id="e0141-348">Можно настроить пользовательский зонд toouse hello любой toowhich порта TCP, который активно прослушивается на виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="e0141-348">You can configure hello custom probe toouse any TCP port toowhich your virtual machines are actively listening.</span></span>

> [!NOTE]
> <span data-ttu-id="e0141-349">Виртуальных машин, использующих hello tooexpose же набор портов, напрямую toohello Интернета (например, порт 80 и 443), не могут совместно использовать hello одной облачной службе.</span><span class="sxs-lookup"><span data-stu-id="e0141-349">Machines that need tooexpose hello same set of ports directly toohello Internet (such as port 80 and 443) cannot share hello same cloud service.</span></span> <span data-ttu-id="e0141-350">Поэтому рекомендуется создать выделенный облачной службе для серверов Windows Server AD FS в порядке tooavoid потенциальных перекрытий в требованиях к портам для приложения и Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-350">It is, therefore, recommended that you create a dedicated cloud service for your Windows Server AD FS servers in order tooavoid potential overlaps between port requirements for an application and Windows Server AD FS.</span></span>
> 
> 

## <a name="deployment-scenarios"></a><span data-ttu-id="e0141-351">Сценарии развертывания</span><span class="sxs-lookup"><span data-stu-id="e0141-351">Deployment scenarios</span></span>
<span data-ttu-id="e0141-352">Привет, в следующем разделе описаны обычных сценариях toodraw внимания tooimportant рекомендации по развертыванию, необходимо принимать во внимание.</span><span class="sxs-lookup"><span data-stu-id="e0141-352">hello following section outlines commonplace deployment scenarios toodraw attention tooimportant considerations that must be taken into account.</span></span> <span data-ttu-id="e0141-353">Каждый сценарий имеет ссылки toomore сведения о решениях hello и tooconsider факторов.</span><span class="sxs-lookup"><span data-stu-id="e0141-353">Each scenario has links toomore details about hello decisions and factors tooconsider.</span></span>

1. [<span data-ttu-id="e0141-354">AD DS: развертывание приложения с поддержкой AD DS, для которого не требуется подключение к корпоративной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-354">AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>](#BKMK_CloudOnly)
   
    <span data-ttu-id="e0141-355">К примеру, служба SharePoint с доступом через Интернет развертывается на виртуальной машине Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-355">For example, an Internet-facing SharePoint service is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="e0141-356">приложение Hello не имеет зависимостей от ресурсов корпоративной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-356">hello application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="e0141-357">Hello приложения требуется Windows Server AD DS, но не требует hello корпоративной Windows Server AD DS.</span><span class="sxs-lookup"><span data-stu-id="e0141-357">hello application does require Windows Server AD DS but does NOT require hello corporate Windows Server AD DS.</span></span>
2. [<span data-ttu-id="e0141-358">Службы федерации Active Directory: Расширить утверждениям локального клиентского приложения toohello Интернета</span><span class="sxs-lookup"><span data-stu-id="e0141-358">AD FS: Extend a claims-aware on-premises front-end application toohello Internet</span></span>](#BKMK_CloudOnlyFed)
   
    <span data-ttu-id="e0141-359">Например поддерживающее утверждения, успешно развернутое локально и используемое корпоративными пользователями приложению toobecome доступен из Интернета hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-359">For example, a claims-aware application that has been successfully deployed on-premises and used by corporate users needs toobecome accessible from hello Internet.</span></span> <span data-ttu-id="e0141-360">Hello приложению toobe доступно напрямую через Интернет hello деловым партнерам при использовании собственных корпоративных удостоверений и существующим корпоративным пользователям.</span><span class="sxs-lookup"><span data-stu-id="e0141-360">hello application needs toobe accessed directly over hello Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>
3. [<span data-ttu-id="e0141-361">AD DS: Развертывание Windows Server AD DS поддержкой приложения, которое требует подключения к toohello корпоративной сети</span><span class="sxs-lookup"><span data-stu-id="e0141-361">AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity toohello corporate network</span></span>](#BKMK_HybridExt)
   
    <span data-ttu-id="e0141-362">Например, поддерживающее LDAP и встроенную проверку подлинности Windows приложение, которое использует службы Windows Server AD DS в качестве репозитория для данных конфигурации и профилей пользователей, развертывается на виртуальной машине Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-362">For example, an LDAP-aware application that supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user-profile data is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="e0141-363">Он является предпочтительным для tooleverage hello приложения hello с существующие корпоративной Windows Server AD DS и обеспечить единый вход.</span><span class="sxs-lookup"><span data-stu-id="e0141-363">It is desirable for hello application tooleverage hello existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="e0141-364">приложение Hello не поддерживающих утверждения.</span><span class="sxs-lookup"><span data-stu-id="e0141-364">hello application is not claims-aware.</span></span>

### <span data-ttu-id="e0141-365"><a name="BKMK_CloudOnly"></a>1. AD DS: развертывание приложения с поддержкой AD DS, для которого не требуется подключение к корпоративной сети</span><span class="sxs-lookup"><span data-stu-id="e0141-365"><a name="BKMK_CloudOnly"></a>1. AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>
<span data-ttu-id="e0141-366">![Развертывание служб AD DS только в облаке](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Рис. 1**</span><span class="sxs-lookup"><span data-stu-id="e0141-366">![Cloud-only AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figure 1**</span></span>

#### <a name="description"></a><span data-ttu-id="e0141-367">Описание</span><span class="sxs-lookup"><span data-stu-id="e0141-367">Description</span></span>
<span data-ttu-id="e0141-368">SharePoint развернуто на виртуальной машине Azure, и приложение hello не имеет зависимостей от ресурсов корпоративной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-368">SharePoint is deployed on an Azure virtual machine and hello application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="e0141-369">Hello приложения требуется Windows Server AD DS, но не *не* требуют hello корпоративной Windows Server AD DS.</span><span class="sxs-lookup"><span data-stu-id="e0141-369">hello application does require Windows Server AD DS but does *not* require hello corporate Windows Server AD DS.</span></span> <span data-ttu-id="e0141-370">Нет Kerberos и федеративные доверенности необходимы, поскольку пользователи самостоятельно подготавливаются через приложение hello в домен hello Windows Server AD DS, который также размещается в облаке hello на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-370">No Kerberos or federated trusts are required because users are self-provisioned through hello application into hello Windows Server AD DS domain that is also hosted in hello cloud on Azure virtual machines.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="e0141-371">Сценарий рекомендации и применение сценария toohello технологическим областям</span><span class="sxs-lookup"><span data-stu-id="e0141-371">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="e0141-372">[Топология сети](#BKMK_NetworkTopology). Создайте виртуальную сеть Azure без подключения между организациями (также называется подключением типа "сеть — сеть").</span><span class="sxs-lookup"><span data-stu-id="e0141-372">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network without cross-premises connectivity (also known as site-to-site connectivity).</span></span>
* <span data-ttu-id="e0141-373">[Настройка развертывания контроллера домена](#BKMK_DeploymentConfig). Разверните новый контроллер домена в новый лес Windows Server Active Directory с одним доменом.</span><span class="sxs-lookup"><span data-stu-id="e0141-373">[DC deployment configuration](#BKMK_DeploymentConfig): Deploy a new domain controller into a new, single-domain, Windows Server Active Directory forest.</span></span> <span data-ttu-id="e0141-374">Он должен быть развернут вместе с сервером Windows DNS hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-374">This should be deployed along with hello Windows DNS server.</span></span>
* <span data-ttu-id="e0141-375">[Топология сайта Windows Server Active Directory](#BKMK_ADSiteTopology): Windows Server Active Directory по умолчанию hello использовать сайт (все компьютеры будут в Default-First-Site-Name).</span><span class="sxs-lookup"><span data-stu-id="e0141-375">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Use hello default Windows Server Active Directory site (all computers will be in Default-First-Site-Name).</span></span>
* <span data-ttu-id="e0141-376">[Назначение IP-адресов и DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="e0141-376">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="e0141-377">Настройте статический IP-адрес для hello контроллера домена с помощью командлета Set-AzureStaticVNetIP Azure PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-377">Set a static IP address for hello DC by using hello Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="e0141-378">Установите и настройте Windows Server DNS на контроллерах домена hello в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-378">Install and configure Windows Server DNS on hello domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="e0141-379">Настройте свойства виртуальной сети hello с именем hello и IP-адрес hello виртуальной Машины, на которой размещены серверные роли hello DC и DNS.</span><span class="sxs-lookup"><span data-stu-id="e0141-379">Configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles.</span></span>
* <span data-ttu-id="e0141-380">[Глобальный каталог](#BKMK_GC): hello первого контроллера домена в лесу hello должен быть сервером глобального каталога.</span><span class="sxs-lookup"><span data-stu-id="e0141-380">[Global Catalog](#BKMK_GC): hello first DC in hello forest must be a global catalog server.</span></span> <span data-ttu-id="e0141-381">Дополнительные КД также быть настроена как глобальных каталогов, так как в лесе одного домена глобального каталога hello не требует никаких дополнительных действий из hello контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-381">Additional DCs should also be configured as GCs because in a single domain forest, hello global catalog does not require any additional work from hello DC.</span></span>
* <span data-ttu-id="e0141-382">[Размещение базы данных hello Windows Server AD DS и SYSVOL](#BKMK_PlaceDB): Добавление tooDCs диск данных, выполняющимся как виртуальные машины Azure, в базе данных Windows Server Active Directory hello toostore заказов, журналов и SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="e0141-382">[Placement of hello Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk tooDCs running as Azure VMs in order toostore hello Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="e0141-383">[Резервное копирование и восстановление](#BKMK_BUR): Определите, где toostore резервные копии состояния системы.</span><span class="sxs-lookup"><span data-stu-id="e0141-383">[Backup and Restore](#BKMK_BUR): Determine where you want toostore system state backups.</span></span> <span data-ttu-id="e0141-384">При необходимости добавьте другой диск toohello виртуальной Машины контроллера домена toostore резервных копий данных.</span><span class="sxs-lookup"><span data-stu-id="e0141-384">If necessary, add another data disk toohello DC VM toostore backups.</span></span>

### <span data-ttu-id="e0141-385"><a name="BKMK_CloudOnlyFed"></a>2 службы федерации Active Directory: расширить утверждениям локального клиентского приложения toohello Интернета</span><span class="sxs-lookup"><span data-stu-id="e0141-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS: Extend a claims-aware on-premises front-end application toohello Internet</span></span>
<span data-ttu-id="e0141-386">![Федерация с подключением между организациями](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Рис. 2**</span><span class="sxs-lookup"><span data-stu-id="e0141-386">![Federation with cross-premises connectivity](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figure 2**</span></span>

#### <a name="description"></a><span data-ttu-id="e0141-387">Описание</span><span class="sxs-lookup"><span data-stu-id="e0141-387">Description</span></span>
<span data-ttu-id="e0141-388">Приложение утверждений, успешно развернутое локально и используемые доступным напрямую из Интернета hello toobecome потребностей пользователей организации.</span><span class="sxs-lookup"><span data-stu-id="e0141-388">A claims-aware application that has been successfully deployed on-premises and used by corporate users needs toobecome accessible directly from hello Internet.</span></span> <span data-ttu-id="e0141-389">приложение Hello служит web переднего плана tooa базы данных SQL в котором он хранит данные.</span><span class="sxs-lookup"><span data-stu-id="e0141-389">hello application serves as a web frontend tooa SQL database in which it stores data.</span></span> <span data-ttu-id="e0141-390">Hello серверов SQL Server, используемого приложением hello, также находятся в корпоративной сети hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-390">hello SQL servers used by hello application are also located on hello corporate network.</span></span> <span data-ttu-id="e0141-391">Две службы маркеров безопасности Windows Server AD FS и Подсистема балансировки нагрузки были развернуты локально tooprovide toohello доступа корпоративным пользователям.</span><span class="sxs-lookup"><span data-stu-id="e0141-391">Two Windows Server AD FS STSs and a load-balancer have been deployed on-premises tooprovide access toohello corporate users.</span></span> <span data-ttu-id="e0141-392">Теперь приложение Hello должно toobe Дополнительно доступно напрямую через Интернет hello деловым партнерам при использовании собственных корпоративных удостоверений и существующим корпоративным пользователям.</span><span class="sxs-lookup"><span data-stu-id="e0141-392">hello application now needs toobe additionally accessed directly over hello Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>

<span data-ttu-id="e0141-393">В toosimplify усилий и соответствует hello развертывание и настройку потребностей это новое требование, принимается решение о том, что два дополнительных веб-, клиента и два прокси-сервера Windows Server AD FS устанавливается на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-393">In an effort toosimplify and meet hello deployment and configuration needs of this new requirement, it is decided that two additional web frontends and two Windows Server AD FS proxy servers be installed on Azure virtual machines.</span></span> <span data-ttu-id="e0141-394">Все четыре виртуальные машины будут доступы непосредственно toohello Internet и будет иметь подключения toohello локальной сети через VPN виртуальной сети Azure сеть сеть.</span><span class="sxs-lookup"><span data-stu-id="e0141-394">All four VMs will be exposed directly toohello Internet and will be provided connectivity toohello on-premises network using Azure Virtual Network’s site-to-site VPN capability.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="e0141-395">Сценарий рекомендации и применение сценария toohello технологическим областям</span><span class="sxs-lookup"><span data-stu-id="e0141-395">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="e0141-396">[Топология сети](#BKMK_NetworkTopology). Создайте виртуальную сеть Azure и [настройте подключение между организациями](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-396">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network and [configure cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="e0141-397">Для каждого из сертификатов Windows Server AD FS hello убедитесь, что hello URL-адрес задан в пределах hello шаблона сертификата и полученных сертификатах hello доступным экземплярам hello Windows Server AD FS, запущенным в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-397">For each of hello Windows Server AD FS certificates, ensure that hello URL defined within hello certificate template and hello resulting certificates can be reached by hello Windows Server AD FS instances running on Azure.</span></span> <span data-ttu-id="e0141-398">Для этого может потребоваться tooparts подключения между организациями для инфраструктуры открытых КЛЮЧЕЙ.</span><span class="sxs-lookup"><span data-stu-id="e0141-398">This may require cross-premises connectivity tooparts of your PKI infrastructure.</span></span> <span data-ttu-id="e0141-399">Например, если конечная точка hello CRL LDAP и исключительно размещенного локально, а затем подключения между организациями будет обязательным.</span><span class="sxs-lookup"><span data-stu-id="e0141-399">For example if hello CRL's endpoint is LDAP-based and hosted exclusively on-premises, then cross-premises connectivity will be required.</span></span> <span data-ttu-id="e0141-400">Если это нежелательно, возможно toouse необходимые сертификаты, выпущенные центром сертификации, чьи списки CRL возможен доступ через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-400">If this is not desirable, it may be necessary toouse certificates issued by a CA whose CRL is accessible over hello Internet.</span></span>
  > 
  > 
* <span data-ttu-id="e0141-401">[Настройка облачных служб](#BKMK_CloudSvcConfig). Для предоставления двух виртуальных IP-адресов с балансировкой нагрузки требуются две облачные службы.</span><span class="sxs-lookup"><span data-stu-id="e0141-401">[Cloud services configuration](#BKMK_CloudSvcConfig): Ensure you have two cloud services in order provide two load-balanced virtual IP addresses.</span></span> <span data-ttu-id="e0141-402">виртуальный IP-адрес Hello первой облачной службы будет два прокси Windows Server AD FS направленной toohello виртуальных машин на портах 80 и 443.</span><span class="sxs-lookup"><span data-stu-id="e0141-402">hello first cloud service’s virtual IP address will be directed toohello two Windows Server AD FS proxy VMs on ports 80 and 443.</span></span> <span data-ttu-id="e0141-403">Hello прокси-сервера Windows Server AD FS виртуальные машины будут toopoint toohello IP-адрес настроен hello локальной подсистемы балансировки загрузки hello, стоит перед серверами службы токенов безопасности Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-403">hello Windows Server AD FS proxy VMs will be configured toopoint toohello IP address of hello on-premises load-balancer that fronts hello Windows Server AD FS STSs.</span></span> <span data-ttu-id="e0141-404">виртуальный IP-адрес Hello второй облачной службы будет направленной toohello две виртуальные машины веб-клиентом hello снова на порты 80 и 443.</span><span class="sxs-lookup"><span data-stu-id="e0141-404">hello second cloud service’s virtual IP address will be directed toohello two VMs running hello web frontend again on ports 80 and 443.</span></span> <span data-ttu-id="e0141-405">Настройте пользовательский зонд tooensure hello подсистемы балансировки нагрузки только направляет трафик toofunctioning Windows Server AD FS прокси-сервера и веб-клиента виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="e0141-405">Configure a custom probe tooensure hello load-balancer only directs traffic toofunctioning Windows Server AD FS proxy and web frontend VMs.</span></span>
* <span data-ttu-id="e0141-406">[Настройка сервера федерации](#BKMK_FedSrvConfig): Настройка Windows Server AD FS toogenerate безопасности (STS) сервера федерации токены для леса Windows Server Active Directory hello, созданного в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-406">[Federation server configuration](#BKMK_FedSrvConfig): Configure Windows Server AD FS as a federation server (STS) toogenerate security tokens for hello Windows Server Active Directory forest created in hello cloud.</span></span> <span data-ttu-id="e0141-407">Отношения доверия поставщика утверждений федерации с различными участниками hello которых надо tooaccept удостоверения из и настройте доверенные отношения проверяющей стороны с различными приложениями hello нужные toogenerate маркеров.</span><span class="sxs-lookup"><span data-stu-id="e0141-407">Set federation claims provider trust relationships with hello different partners you wish tooaccept identities from, and configure relying party trust relationships with hello different applications you want toogenerate tokens to.</span></span>
  
    <span data-ttu-id="e0141-408">В большинстве сценариев в целях безопасности прокси-серверы Windows Server AD FS развертываются с возможностью доступа к Интернету, в то время как соответствующие части федерации остаются изолированными от прямого подключения к Интернету.</span><span class="sxs-lookup"><span data-stu-id="e0141-408">In most scenarios, Windows Server AD FS proxy servers are deployed in an Internet-facing capacity for security purposes while their Windows Server AD FS federation counterparts remain isolated from direct Internet connectivity.</span></span> <span data-ttu-id="e0141-409">Независимо от вашего сценария развертывания облачной службы необходимо настроить виртуальный IP-адрес, который предоставит открытый IP-адрес и порт, который может tooload сальдо по двух экземпляров Windows Server AD FS STS или по экземплярам прокси.</span><span class="sxs-lookup"><span data-stu-id="e0141-409">Regardless of your deployment scenario, you must configure your cloud service with a virtual IP address that will provide a publicly exposed IP address and port that is able tooload-balance across either your two Windows Server AD FS STS instances or proxy instances.</span></span>
* <span data-ttu-id="e0141-410">[Windows Server AD FS высокого уровня доступности конфигурации](#BKMK_ADFSHighAvail): это рекомендуется toodeploy ферму Windows Server AD FS с по крайней мере с двумя серверами для отработки отказа и балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="e0141-410">[Windows Server AD FS high availability configuration](#BKMK_ADFSHighAvail): It is advisable toodeploy a Windows Server AD FS farm with at least two servers for failover and load balancing.</span></span> <span data-ttu-id="e0141-411">Вы может tooconsider использования hello внутренней базы данных Windows (WID) для данных конфигурации Windows Server AD FS и использовать hello внутренней возможность балансировки нагрузки Azure toodistribute входящие запросы по серверам hello в ферме hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-411">You might want tooconsider using hello Windows Internal Database (WID) for Windows Server AD FS configuration data, and use hello internal load balancing capability of Azure toodistribute incoming requests across hello servers in hello farm.</span></span>

<span data-ttu-id="e0141-412">Дополнительные сведения см. в разделе hello [по развертыванию AD DS](https://technet.microsoft.com/library/cc753963).</span><span class="sxs-lookup"><span data-stu-id="e0141-412">For more information, see hello [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963).</span></span>

### <span data-ttu-id="e0141-413"><a name="BKMK_HybridExt"></a>3. AD DS: Развертывание Windows Server AD DS поддержкой приложения, которое требует подключения к toohello корпоративной сети</span><span class="sxs-lookup"><span data-stu-id="e0141-413"><a name="BKMK_HybridExt"></a>3. AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity toohello corporate network</span></span>
<span data-ttu-id="e0141-414">![Развертывание служб AD DS между организациями](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Рис. 3**</span><span class="sxs-lookup"><span data-stu-id="e0141-414">![Cross-premises AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figure 3**</span></span>

#### <a name="description"></a><span data-ttu-id="e0141-415">Описание</span><span class="sxs-lookup"><span data-stu-id="e0141-415">Description</span></span>
<span data-ttu-id="e0141-416">Приложение, поддерживающее LDAP, развертывается на виртуальной машине Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-416">An LDAP-aware application is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="e0141-417">Оно поддерживает встроенную проверку подлинности Windows и использует Windows Server AD DS в качестве репозитория для данных конфигурации и профилей пользователей.</span><span class="sxs-lookup"><span data-stu-id="e0141-417">It supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user profile data.</span></span> <span data-ttu-id="e0141-418">Цель Hello tooleverage hello приложения hello с существующие корпоративной Windows Server AD DS и единого входа.</span><span class="sxs-lookup"><span data-stu-id="e0141-418">hello goal is for hello application tooleverage hello existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="e0141-419">приложение Hello не поддерживающих утверждения.</span><span class="sxs-lookup"><span data-stu-id="e0141-419">hello application is not claims-aware.</span></span> <span data-ttu-id="e0141-420">Пользователи также должны приложение hello tooaccess непосредственно из Интернета hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-420">Users also need tooaccess hello application directly from hello Internet.</span></span> <span data-ttu-id="e0141-421">toooptimize производительности и стоимости, принимается решение о том, что вместе с приложения hello в Azure будут развернуты два дополнительных контроллера домена, являющихся частью hello корпоративного домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-421">toooptimize for performance and cost, it is decided that two additional domain controllers that are part of hello corporate domain be deployed alongside hello application on Azure.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-toohello-scenario"></a><span data-ttu-id="e0141-422">Сценарий рекомендации и применение сценария toohello технологическим областям</span><span class="sxs-lookup"><span data-stu-id="e0141-422">Scenario considerations and how technology areas apply toohello scenario</span></span>
* <span data-ttu-id="e0141-423">[Топология сети](#BKMK_NetworkTopology). Создайте виртуальную сеть Azure с возможностью [подключения между организациями](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-423">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network with [cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
* <span data-ttu-id="e0141-424">[Метод установки](#BKMK_InstallMethod): разверните КД реплики из корпоративного домена Windows Server Active Directory hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-424">[Installation method](#BKMK_InstallMethod): Deploy replica DCs from hello corporate Windows Server Active Directory domain.</span></span> <span data-ttu-id="e0141-425">Для реплики контроллера домена Windows Server AD DS можно установить на hello виртуальной Машины, и при необходимости используйте hello установки с носителя (IFM) компонент tooreduce hello объем данных, которые должны toobe реплицируются toohello нового контроллера домена во время установки.</span><span class="sxs-lookup"><span data-stu-id="e0141-425">For a replica DC, you can install Windows Server AD DS on hello VM, and optionally use hello Install From Media (IFM) feature tooreduce hello amount of data that needs toobe replicated toohello new DC during installation.</span></span> <span data-ttu-id="e0141-426">Руководство см. в статье [Установка реплики контроллера домена Active Directory в виртуальной сети Azure](active-directory-install-replica-active-directory-domain-controller.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-426">For a tutorial, see [Install a replica Active Directory domain controller on Azure](active-directory-install-replica-active-directory-domain-controller.md).</span></span> <span data-ttu-id="e0141-427">Даже при использовании Носителя может более эффективно hello toobuild локального виртуального контроллера домена и переместить hello весь виртуальный жесткий диск (VHD) toohello облако вместо репликации Windows Server AD DS во время установки.</span><span class="sxs-lookup"><span data-stu-id="e0141-427">Even if you use IFM, it may be more efficient toobuild hello virtual DC on-premises and move hello entire Virtual Hard Disk (VHD) toohello cloud instead of replicating Windows Server AD DS during installation.</span></span> <span data-ttu-id="e0141-428">В целях безопасности рекомендуется удалить hello виртуального жесткого диска из локальной сети hello после ее скопированный tooAzure.</span><span class="sxs-lookup"><span data-stu-id="e0141-428">For safety, it is recommended that you delete hello VHD from hello on-premises network once it has been copied tooAzure.</span></span>
* <span data-ttu-id="e0141-429">[Топология сайтов Windows Server Active Directory](#BKMK_ADSiteTopology). Создайте сайт Azure в оснастке "Active Directory — сайты и службы".</span><span class="sxs-lookup"><span data-stu-id="e0141-429">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Create a new Azure site in Active Directory Sites and Services.</span></span> <span data-ttu-id="e0141-430">Создайте Windows Server Active Directory подсети объекта toorepresent hello виртуальной сети Azure и добавьте узел toohello подсети hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-430">Create a Windows Server Active Directory subnet object toorepresent hello Azure virtual network and add hello subnet toohello site.</span></span> <span data-ttu-id="e0141-431">Создание новой связи сайтов, включая новый сайт Azure hello и hello сайта, в которых hello Azure конечная точка VPN виртуальной сети находится в порядке toocontrol и оптимизировать tooand трафика Windows Server Active Directory из Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-431">Create a new site link that includes hello new Azure site and hello site in which hello Azure virtual network VPN endpoint is located in order toocontrol and optimize Windows Server Active Directory traffic tooand from Azure.</span></span>
* <span data-ttu-id="e0141-432">[Назначение IP-адресов и DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="e0141-432">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="e0141-433">Настройте статический IP-адрес для hello контроллера домена с помощью командлета Set-AzureStaticVNetIP Azure PowerShell hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-433">Set a static IP address for hello DC by using hello Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="e0141-434">Установите и настройте Windows Server DNS на контроллерах домена hello в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-434">Install and configure Windows Server DNS on hello domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="e0141-435">Настройте свойства виртуальной сети hello с именем hello и IP-адрес hello виртуальной Машины, на которой размещены серверные роли hello DC и DNS.</span><span class="sxs-lookup"><span data-stu-id="e0141-435">Configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles.</span></span>
* <span data-ttu-id="e0141-436">[Географически распределенные контроллеры домена](#BKMK_DistributedDCs). При необходимости настройте дополнительные виртуальные сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-436">[Geo-distributed DCs](#BKMK_DistributedDCs): Configure additional virtual networks as needed.</span></span> <span data-ttu-id="e0141-437">Если топологию сайта Active Directory требует контроллеры доменов в географических регионах, которые соответствуют toodifferent Azure области, чем требуется сайты Active Directory toocreate соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="e0141-437">If your Active Directory site topology requires DCs in geographies that correspond toodifferent Azure regions, than you want toocreate Active Directory sites accordingly.</span></span>
* <span data-ttu-id="e0141-438">[Контроллеры домена только для чтения](#BKMK_RODC): вы можете развернуть RODC в hello Azure узла, в зависимости от требований к выполнению операций записи от контроллера домена и hello совместимости hello приложений и служб в hello сайта с подобными контроллерами.</span><span class="sxs-lookup"><span data-stu-id="e0141-438">[Read-only DCs](#BKMK_RODC): You might deploy an RODC in hello Azure site, depending on your requirements for performing write operations against hello DC and hello compatibility of applications and services in hello site with RODCs.</span></span> <span data-ttu-id="e0141-439">Дополнительные сведения о совместимости приложений см. в разделе hello [руководство по совместимости приложений контроллеры домена только для чтения](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="e0141-439">For more information about application compatibility, see hello [Read-Only domain controllers application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>
* <span data-ttu-id="e0141-440">[Глобальный каталог](#BKMK_GC): глобальных каталогов, необходимые tooservice запросов на вход в мультидоменных лесах.</span><span class="sxs-lookup"><span data-stu-id="e0141-440">[Global Catalog](#BKMK_GC): GCs are needed tooservice logon requests in multidomain forests.</span></span> <span data-ttu-id="e0141-441">Если сборка Мусора hello Azure сайта не будет развернута, как запросы на проверку подлинности приводить к обращениям к на других сайтах повлечет расходы на исходящие данные трафика.</span><span class="sxs-lookup"><span data-stu-id="e0141-441">If you do not deploy a GC in hello Azure site, you will incur egress traffic costs as authentication requests cause queries GCs in other sites.</span></span> <span data-ttu-id="e0141-442">toominimize, трафик, можно включить кэширование для hello Azure сайт в Active Directory — сайты и службы членства в универсальных группах.</span><span class="sxs-lookup"><span data-stu-id="e0141-442">toominimize that traffic, you can enable universal group membership caching for hello Azure site in Active Directory Sites and Services.</span></span>
  
    <span data-ttu-id="e0141-443">При развертывании глобального Каталога, настройте связи сайтов и связей сайтов, затраты, чтобы сборка Мусора hello hello сайт Azure не выбиралась как исходная другими сборками, необходимые tooreplicate hello же частичных секций домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-443">If you deploy a GC, configure site links and site links costs so that hello GC in hello Azure site is not preferred as a source DC by other GCs that need tooreplicate hello same partial domain partitions.</span></span>
* <span data-ttu-id="e0141-444">[Размещение базы данных hello Windows Server AD DS и SYSVOL](#BKMK_PlaceDB): Добавление tooDCs диск данных, работающих на виртуальных машинах Azure в базу данных Windows Server Active Directory hello toostore заказов, журналов и SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="e0141-444">[Placement of hello Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk tooDCs running on Azure VMs in order toostore hello Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="e0141-445">[Резервное копирование и восстановление](#BKMK_BUR): Определите, где toostore резервные копии состояния системы.</span><span class="sxs-lookup"><span data-stu-id="e0141-445">[Backup and Restore](#BKMK_BUR): Determine where you want toostore system state backups.</span></span> <span data-ttu-id="e0141-446">При необходимости добавьте другой диск toohello виртуальной Машины контроллера домена toostore резервных копий данных.</span><span class="sxs-lookup"><span data-stu-id="e0141-446">If necessary, add another data disk toohello DC VM toostore backups.</span></span>

## <a name="deployment-decisions-and-factors"></a><span data-ttu-id="e0141-447">Решения и факторы, связанные с развертыванием</span><span class="sxs-lookup"><span data-stu-id="e0141-447">Deployment decisions and factors</span></span>
<span data-ttu-id="e0141-448">В следующей таблице перечислены области технологии Windows Server Active Directory hello, которые затрагиваются в предыдущих сценариях hello и hello соответствующего решения tooconsider, со сведениями о toomore ссылки ниже.</span><span class="sxs-lookup"><span data-stu-id="e0141-448">This table summarizes hello Windows Server Active Directory technology areas that are impacted in hello preceding scenarios and hello corresponding decisions tooconsider, with links toomore detail below.</span></span> <span data-ttu-id="e0141-449">Некоторые технологические области не может быть применимо tooevery сценарий развертывания, и некоторые области могут быть более важным tooa сценарий развертывания, чем другие.</span><span class="sxs-lookup"><span data-stu-id="e0141-449">Some technology areas might not be applicable tooevery deployment scenario, and some technology areas might be more critical tooa deployment scenario than other technology areas.</span></span>

<span data-ttu-id="e0141-450">Например при развертывании реплики контроллера домена в виртуальной сети, в лесу имеется только один домен, выбрав toodeploy сервер глобального каталога в этом случае не будет критических toohello сценарий развертывания, так как он не создает любые дополнительные репликации требования.</span><span class="sxs-lookup"><span data-stu-id="e0141-450">For example, if you deploy a replica DC on a virtual network and your forest has only a single domain, then choosing toodeploy a global catalog server in that case will not be critical toohello deployment scenario because it will not create any additional replication requirements.</span></span> <span data-ttu-id="e0141-451">На hello другой стороны, если hello лес имеет несколько доменов, а затем toodeploy решение hello глобальный каталог в виртуальной сети может повлиять на пропускную способность, производительность, проверки подлинности, уточняющие запросы каталога и т. д.</span><span class="sxs-lookup"><span data-stu-id="e0141-451">On hello other hand, if hello forest has several domains, then hello decision toodeploy a global catalog on a virtual network could affect available bandwidth, performance, authentication, directory lookups, and so on.</span></span>

| <span data-ttu-id="e0141-452">Технологическая область Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="e0141-452">Windows Server Active Directory technology area</span></span> | <span data-ttu-id="e0141-453">Решения</span><span class="sxs-lookup"><span data-stu-id="e0141-453">Decisions</span></span> | <span data-ttu-id="e0141-454">Факторы</span><span class="sxs-lookup"><span data-stu-id="e0141-454">Factors</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="e0141-455">Топология сети</span><span class="sxs-lookup"><span data-stu-id="e0141-455">Network topology</span></span>](#BKMK_NetworkTopology) |<span data-ttu-id="e0141-456">Нужно ли создавать виртуальную сеть?</span><span class="sxs-lookup"><span data-stu-id="e0141-456">Do you create a virtual network?</span></span> |<li><span data-ttu-id="e0141-457">Требования к tooaccess корп. ресурсам</span><span class="sxs-lookup"><span data-stu-id="e0141-457">Requirements tooaccess Corp resources</span></span></li> <li><span data-ttu-id="e0141-458">Аутентификация</span><span class="sxs-lookup"><span data-stu-id="e0141-458">Authentication</span></span></li> <li><span data-ttu-id="e0141-459">Управление учетными записями</span><span class="sxs-lookup"><span data-stu-id="e0141-459">Account management</span></span></li> |
| [<span data-ttu-id="e0141-460">Настройка развертывания контроллера домена</span><span class="sxs-lookup"><span data-stu-id="e0141-460">DC deployment configuration</span></span>](#BKMK_DeploymentConfig) |<li><span data-ttu-id="e0141-461">Нужно ли развернуть отдельный лес без отношений доверия?</span><span class="sxs-lookup"><span data-stu-id="e0141-461">Deploy a separate forest without any trusts?</span></span></li> <li><span data-ttu-id="e0141-462">Нужно ли развернуть новый лес с федерацией?</span><span class="sxs-lookup"><span data-stu-id="e0141-462">Deploy a new forest with federation?</span></span></li> <li><span data-ttu-id="e0141-463">Нужно ли развернуть новый лес с отношениями доверия с лесом Windows Server Active Directory или Kerberos?</span><span class="sxs-lookup"><span data-stu-id="e0141-463">Deploy a new forest with Windows Server Active Directory forest trust or Kerberos?</span></span></li> <li><span data-ttu-id="e0141-464">Нужно ли расширить корпоративный лес путем развертывания реплики контроллера домена?</span><span class="sxs-lookup"><span data-stu-id="e0141-464">Extend Corp forest by deploying a replica DC?</span></span></li> <li><span data-ttu-id="e0141-465">Нужно ли расширить корпоративный лес с помощью развертывания нового дочернего домена или доменного дерева?</span><span class="sxs-lookup"><span data-stu-id="e0141-465">Extend Corp forest by deploying a new child domain or domain tree?</span></span></li> |<li><span data-ttu-id="e0141-466">Безопасность</span><span class="sxs-lookup"><span data-stu-id="e0141-466">Security</span></span></li> <li><span data-ttu-id="e0141-467">Соответствие нормативным требованиям</span><span class="sxs-lookup"><span data-stu-id="e0141-467">Compliance</span></span></li> <li><span data-ttu-id="e0141-468">Стоимость</span><span class="sxs-lookup"><span data-stu-id="e0141-468">Cost</span></span></li> <li><span data-ttu-id="e0141-469">Устойчивость к сбоям</span><span class="sxs-lookup"><span data-stu-id="e0141-469">Resiliency and fault-tolerance</span></span></li> <li><span data-ttu-id="e0141-470">Совместимость приложений</span><span class="sxs-lookup"><span data-stu-id="e0141-470">Application compatibility</span></span></li> |
| [<span data-ttu-id="e0141-471">Топология сайтов Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="e0141-471">Windows Server Active Directory site topology</span></span>](#BKMK_ADSiteTopology) |<span data-ttu-id="e0141-472">Как настроить подсетей, сайтов и связей сайтов виртуальной сети Azure toooptimize трафика и снижения стоимости</span><span class="sxs-lookup"><span data-stu-id="e0141-472">How do you configure subnets, sites, and site links with Azure Virtual Network toooptimize traffic and minimize cost?</span></span> |<li><span data-ttu-id="e0141-473">Определения подсетей и сайтов</span><span class="sxs-lookup"><span data-stu-id="e0141-473">Subnet and site definitions</span></span></li> <li><span data-ttu-id="e0141-474">Свойства связей сайтов и уведомления об изменениях</span><span class="sxs-lookup"><span data-stu-id="e0141-474">Site link properties and change notification</span></span></li> <li><span data-ttu-id="e0141-475">Сжатие репликации</span><span class="sxs-lookup"><span data-stu-id="e0141-475">Replication compression</span></span></li> |
| [<span data-ttu-id="e0141-476">Назначение IP-адресов и DNS</span><span class="sxs-lookup"><span data-stu-id="e0141-476">IP addressing and DNS</span></span>](#BKMK_IPAddressDNS) |<span data-ttu-id="e0141-477">Как tooconfigure IP адресов и разрешение имен?</span><span class="sxs-lookup"><span data-stu-id="e0141-477">How tooconfigure IP addresses and name resolution?</span></span> |<li><span data-ttu-id="e0141-478">Используйте командлет Set-AzureStaticVNetIP tooassign статический IP-адрес hello используйте hello</span><span class="sxs-lookup"><span data-stu-id="e0141-478">Use hello Use hello Set-AzureStaticVNetIP cmdlet tooassign a static IP address</span></span></li> <li><span data-ttu-id="e0141-479">Установите DNS-сервера Windows server и настройте свойства виртуальной сети hello с именем hello и IP-адрес hello виртуальной Машины, на которой размещены серверные роли hello DC и DNS</span><span class="sxs-lookup"><span data-stu-id="e0141-479">Install Windows Server DNS server and configure hello virtual network properties with hello name and IP address of hello VM that hosts hello DC and DNS server roles</span></span></li> |
| [<span data-ttu-id="e0141-480">Географически распределенные контроллеры домена</span><span class="sxs-lookup"><span data-stu-id="e0141-480">Geo-distributed DCs</span></span>](#BKMK_DistributedDCs) |<span data-ttu-id="e0141-481">Как tooDCs tooreplicate на отдельные виртуальные сети?</span><span class="sxs-lookup"><span data-stu-id="e0141-481">How tooreplicate tooDCs on separate virtual networks?</span></span> |<span data-ttu-id="e0141-482">Если топологию сайта Active Directory требует контроллеры доменов в географических регионах, соответствующих toodifferent Azure области, чем требуется сайты Active Directory toocreate соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="e0141-482">If your Active Directory site topology requires DCs in geographies that corresponds toodifferent Azure regions, than you want toocreate Active Directory sites accordingly.</span></span> <span data-ttu-id="e0141-483">[Настройка виртуальной сети toovirtual сетевого подключения](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) tooreplicate между контроллерами домена в разных виртуальных сетях.</span><span class="sxs-lookup"><span data-stu-id="e0141-483">[Configure virtual network toovirtual network Connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) tooreplicate between domain controllers on separate virtual networks.</span></span> |
| [<span data-ttu-id="e0141-484">Контроллеры доменов только для чтения</span><span class="sxs-lookup"><span data-stu-id="e0141-484">Read-only DCs</span></span>](#BKMK_RODC) |<span data-ttu-id="e0141-485">Нужно ли использовать контроллеры домена только для чтения или с возможностью записи?</span><span class="sxs-lookup"><span data-stu-id="e0141-485">Use read-only or writeable DCs?</span></span> |<li><span data-ttu-id="e0141-486">Фильтрация атрибутов HBI и PII</span><span class="sxs-lookup"><span data-stu-id="e0141-486">Filter HBI/PII attributes</span></span></li> <li><span data-ttu-id="e0141-487">Фильтрация секретных данных</span><span class="sxs-lookup"><span data-stu-id="e0141-487">Filter secrets</span></span></li> <li><span data-ttu-id="e0141-488">Ограничения исходящего трафика</span><span class="sxs-lookup"><span data-stu-id="e0141-488">Limit outbound traffic</span></span></li> |
| [<span data-ttu-id="e0141-489">Глобальный каталог</span><span class="sxs-lookup"><span data-stu-id="e0141-489">Global catalog</span></span>](#BKMK_GC) |<span data-ttu-id="e0141-490">Нужно ли устанавливать глобальный каталог?</span><span class="sxs-lookup"><span data-stu-id="e0141-490">Install global catalog?</span></span> |<li><span data-ttu-id="e0141-491">Для леса с одним доменом настройте все контроллеры домена в качестве глобальных каталогов.</span><span class="sxs-lookup"><span data-stu-id="e0141-491">For single-domain forest, make all DCs GCs</span></span></li> <li><span data-ttu-id="e0141-492">При использовании мультидоменного леса глобальные каталоги необходимы для аутентификации.</span><span class="sxs-lookup"><span data-stu-id="e0141-492">For multidomain forest, GCs are required for authentication</span></span></li> |
| [<span data-ttu-id="e0141-493">Метод установки</span><span class="sxs-lookup"><span data-stu-id="e0141-493">Installation method</span></span>](#BKMK_InstallMethod) |<span data-ttu-id="e0141-494">Как tooinstall контроллера домена в Azure?</span><span class="sxs-lookup"><span data-stu-id="e0141-494">How tooinstall DC in Azure?</span></span> |<span data-ttu-id="e0141-495">Одно из двух:</span><span class="sxs-lookup"><span data-stu-id="e0141-495">Either:</span></span> <li><span data-ttu-id="e0141-496">Установите AD DS с помощью Windows PowerShell или Dcpromo.</span><span class="sxs-lookup"><span data-stu-id="e0141-496">Install AD DS using Windows PowerShell or Dcpromo</span></span></li> <li><span data-ttu-id="e0141-497">Переместите VHD локального виртуального контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-497">Move VHD of an on-premises virtual DC</span></span></li> |
| [<span data-ttu-id="e0141-498">Размещение базы данных hello Windows Server AD DS и SYSVOL</span><span class="sxs-lookup"><span data-stu-id="e0141-498">Placement of hello Windows Server AD DS database and SYSVOL</span></span>](#BKMK_PlaceDB) |<span data-ttu-id="e0141-499">Там, где базы данных toostore Windows Server AD DS, журналов и SYSVOL?</span><span class="sxs-lookup"><span data-stu-id="e0141-499">Where toostore Windows Server AD DS database, logs, and SYSVOL?</span></span> |<span data-ttu-id="e0141-500">Измените значения по умолчанию в файле Dcpromo.exe.</span><span class="sxs-lookup"><span data-stu-id="e0141-500">Change Dcpromo.exe default values.</span></span> <span data-ttu-id="e0141-501">Эти критически важные файлы Active Directory *необходимо* разместить на дисках данных Azure, а не на дисках операционной системы, которые реализуют кэширование записи.</span><span class="sxs-lookup"><span data-stu-id="e0141-501">These critical Active Directory files *must* be placed on Azure Data Disks instead of Operating System disks that implement write caching.</span></span> |
| [<span data-ttu-id="e0141-502">Резервное копирование и восстановление</span><span class="sxs-lookup"><span data-stu-id="e0141-502">Backup and Restore</span></span>](#BKMK_BUR) |<span data-ttu-id="e0141-503">Как toosafeguard и восстановление данных?</span><span class="sxs-lookup"><span data-stu-id="e0141-503">How toosafeguard and recover data?</span></span> |<span data-ttu-id="e0141-504">Создайте резервные копии состояния системы.</span><span class="sxs-lookup"><span data-stu-id="e0141-504">Create system state backups</span></span> |
| [<span data-ttu-id="e0141-505">Настройка сервера федерации</span><span class="sxs-lookup"><span data-stu-id="e0141-505">Federation server configuration</span></span>](#BKMK_FedSrvConfig) |<li><span data-ttu-id="e0141-506">Развертывается новый лес с федерацией в облаке hello?</span><span class="sxs-lookup"><span data-stu-id="e0141-506">Deploy a new forest with federation in hello cloud?</span></span></li> <li><span data-ttu-id="e0141-507">Развертывание AD FS локально и предоставить учетной записи-посредника в облаке hello?</span><span class="sxs-lookup"><span data-stu-id="e0141-507">Deploy AD FS on-premises and expose a proxy in hello cloud?</span></span></li> |<li><span data-ttu-id="e0141-508">Безопасность</span><span class="sxs-lookup"><span data-stu-id="e0141-508">Security</span></span></li> <li><span data-ttu-id="e0141-509">Соответствие нормативным требованиям</span><span class="sxs-lookup"><span data-stu-id="e0141-509">Compliance</span></span></li> <li><span data-ttu-id="e0141-510">Стоимость</span><span class="sxs-lookup"><span data-stu-id="e0141-510">Cost</span></span></li> <li><span data-ttu-id="e0141-511">Tooapplications доступа деловым партнерам</span><span class="sxs-lookup"><span data-stu-id="e0141-511">Access tooapplications by business partners</span></span></li> |
| [<span data-ttu-id="e0141-512">Настройка облачных служб</span><span class="sxs-lookup"><span data-stu-id="e0141-512">Cloud services configuration</span></span>](#BKMK_CloudSvcConfig) |<span data-ttu-id="e0141-513">Облачная служба неявно развертывается hello первом создании виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="e0141-513">A cloud service is implicitly deployed hello first time you create a virtual machine.</span></span> <span data-ttu-id="e0141-514">Требуется toodeploy дополнительные облачные службы?</span><span class="sxs-lookup"><span data-stu-id="e0141-514">Do you need toodeploy additional cloud services?</span></span> |<li><span data-ttu-id="e0141-515">Требуется ли для виртуальной Машины или виртуальные машины напрямую toohello Интернет?</span><span class="sxs-lookup"><span data-stu-id="e0141-515">Does a VM or VMs require direct exposure toohello Internet?</span></span></li> <li> <span data-ttu-id="e0141-516">Требуется ли для hello службы балансировки нагрузки?</span><span class="sxs-lookup"><span data-stu-id="e0141-516">Does hello service require load-balancing?</span></span></li> |
| [<span data-ttu-id="e0141-517">Требования сервера федерации в отношении общих и частных IP-адресов (динамические и виртуальные IP-адреса)</span><span class="sxs-lookup"><span data-stu-id="e0141-517">Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>](#BKMK_FedReqVIPDIP) |<li><span data-ttu-id="e0141-518">Требуется ли экземпляр hello Windows Server AD FS доступен непосредственно через Интернет hello toobe?</span><span class="sxs-lookup"><span data-stu-id="e0141-518">Does hello Windows Server AD FS instance need toobe reached directly from hello Internet?</span></span></li> <li><span data-ttu-id="e0141-519">Требуется ли hello приложению, которое развертывается в облаке hello свой Интернета IP-адрес и порт?</span><span class="sxs-lookup"><span data-stu-id="e0141-519">Does hello application being deployed in hello cloud require its own Internet-facing IP address and port?</span></span></li> |<span data-ttu-id="e0141-520">Создайте одну облачную службу для каждого виртуального IP-адреса, требуемого для развертывания.</span><span class="sxs-lookup"><span data-stu-id="e0141-520">Create one cloud-service for each virtual IP address that is required by your deployment</span></span> |
| [<span data-ttu-id="e0141-521">Настройка высокой доступности Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="e0141-521">Windows Server AD FS high availability configuration</span></span>](#BKMK_ADFSHighAvail) |<li><span data-ttu-id="e0141-522">Сколько узлов будет содержаться в ферме серверов Windows Server AD FS?</span><span class="sxs-lookup"><span data-stu-id="e0141-522">How many nodes in my Windows Server AD FS server farm?</span></span></li> <li><span data-ttu-id="e0141-523">Сколько toodeploy узлов в моей ферме прокси-сервера Windows Server AD FS?</span><span class="sxs-lookup"><span data-stu-id="e0141-523">How many nodes toodeploy in my Windows Server AD FS proxy farm?</span></span></li> |<span data-ttu-id="e0141-524">Устойчивость к сбоям</span><span class="sxs-lookup"><span data-stu-id="e0141-524">Resiliency and fault tolerance</span></span> |

### <span data-ttu-id="e0141-525"><a name="BKMK_NetworkTopology"></a>Топология сети</span><span class="sxs-lookup"><span data-stu-id="e0141-525"><a name="BKMK_NetworkTopology"></a>Network topology</span></span>
<span data-ttu-id="e0141-526">Согласованность порядок toomeet hello IP-адресов и DNS требованиям Windows Server AD DS, при необходимости создать toofirst [виртуальной сети Azure](../virtual-network/virtual-networks-overview.md) и присоединения к tooit виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="e0141-526">In order toomeet hello IP address consistency and DNS requirements of Windows Server AD DS, it is necessary toofirst create an [Azure virtual network](../virtual-network/virtual-networks-overview.md) and attach your virtual machines tooit.</span></span> <span data-ttu-id="e0141-527">Во время ее создания необходимо решить, ли toooptionally расширить подключения tooyour локальной корпоративной сетью, которая прозрачно соединит Azure виртуальные машины tooon локальные компьютеры — это достигается путем использования традиционной технологии виртуальных частных СЕТЕЙ и требует наличия Открытой конечной точки на краю корпоративной сети hello hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-527">During its creation, you must decide whether toooptionally extend connectivity tooyour on-premises corporate network, which transparently connects Azure virtual machines tooon-premises machines — this is achieved using traditional VPN technologies and requires that a VPN endpoint be exposed on hello edge of hello corporate network.</span></span> <span data-ttu-id="e0141-528">Другими словами hello VPN инициируется из Azure toohello корпоративной сети, а не наоборот.</span><span class="sxs-lookup"><span data-stu-id="e0141-528">That is, hello VPN is initiated from Azure toohello corporate network, not vice-versa.</span></span>

<span data-ttu-id="e0141-529">Обратите внимание, что за дополнительную плату при расширении локальной сети tooyour виртуальной сети за пределами hello Стандартная плата, применяемые tooeach виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="e0141-529">Note that additional charges apply when extending a virtual network tooyour on-premises network beyond hello standard charges that apply tooeach VM.</span></span> <span data-ttu-id="e0141-530">В частности существует плата за время ЦП шлюза виртуальной сети Azure hello и для hello исходящего трафика, сформированного каждой виртуальной Машиной, взаимодействующее с локальными компьютерами через hello VPN.</span><span class="sxs-lookup"><span data-stu-id="e0141-530">Specifically, there are charges for CPU time of hello Azure Virtual Network gateway and for hello egress traffic generated by each VM that communicates with on-premises machines across hello VPN.</span></span> <span data-ttu-id="e0141-531">Дополнительные сведения о ценах на использование сетевого трафика см. в статье [Цены Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="e0141-531">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

### <span data-ttu-id="e0141-532"><a name="BKMK_DeploymentConfig"></a>Настройка развертывания контроллера домена</span><span class="sxs-lookup"><span data-stu-id="e0141-532"><a name="BKMK_DeploymentConfig"></a>DC deployment configuration</span></span>
<span data-ttu-id="e0141-533">Hello способ настройки приветствия контроллера домена зависит от требований hello для hello службы вы хотите toorun в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-533">hello way you configure hello DC depends on hello requirements for hello service you want toorun on Azure.</span></span> <span data-ttu-id="e0141-534">Например вы можете развернуть новый лес, изолированный от вашего корпоративного леса, для тестирования подтверждение концепции, нового приложения или другого краткосрочного проекта, требуется служб каталогов, но не определенный доступ toointernal корпоративным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="e0141-534">For example, you might deploy a new forest, isolated from your own corporate forest, for testing a proof-of-concept, a new application, or some other short term project that requires directory services but not specific access toointernal corporate resources.</span></span>

<span data-ttu-id="e0141-535">В рамках изолированного леса контроллера домена не реплицируется с локальными контроллеров домена, что приводит к меньшему объему исходящего сетевого трафика самой системой hello непосредственное снижение затрат.</span><span class="sxs-lookup"><span data-stu-id="e0141-535">As a benefit, an isolated forest DC does not replicate with on-premises DCs, resulting in less outbound network traffic generated by hello system itself, directly reducing costs.</span></span> <span data-ttu-id="e0141-536">Дополнительные сведения о ценах на использование сетевого трафика см. в статье [Цены Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="e0141-536">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

<span data-ttu-id="e0141-537">Другой пример: предположим, что существуют требования к конфиденциальности для службы, но служба hello зависит от tooyour доступа внутренней Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-537">As another example, suppose you have privacy requirements for a service, but hello service depends on access tooyour internal Windows Server Active Directory.</span></span> <span data-ttu-id="e0141-538">Если допускаются данные toohost hello службы в облаке hello, вы можете развернуть новый дочерний домен для внутреннего леса в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-538">If you are allowed toohost data for hello service in hello cloud, you might deploy a new child domain for your internal forest on Azure.</span></span> <span data-ttu-id="e0141-539">В этом случае можно развернуть КД для нового дочернего домена hello (без глобального каталога hello в порядке toohelp конфиденциальность).</span><span class="sxs-lookup"><span data-stu-id="e0141-539">In this case, you can deploy a DC for hello new child domain (without hello global catalog in order toohelp address privacy concerns).</span></span> <span data-ttu-id="e0141-540">В этом сценарии, как и при развертывании реплики контроллера домена, требуется виртуальная сеть для подключения к локальным контроллерам доменов.</span><span class="sxs-lookup"><span data-stu-id="e0141-540">This scenario, along with a replica DC deployment, requires a virtual network for connectivity with your on-premises DCs.</span></span>

<span data-ttu-id="e0141-541">При создании нового леса, выберите ли toouse [отношения доверия Active Directory](https://technet.microsoft.com/library/cc771397) или [отношения доверия федерации](https://technet.microsoft.com/library/dd807036).</span><span class="sxs-lookup"><span data-stu-id="e0141-541">If you create a new forest, choose whether toouse [Active Directory trusts](https://technet.microsoft.com/library/cc771397) or [Federation trusts](https://technet.microsoft.com/library/dd807036).</span></span> <span data-ttu-id="e0141-542">Сбалансируйте требования hello, учитывая совместимость, безопасности, соответствия, стоимость и устойчивости.</span><span class="sxs-lookup"><span data-stu-id="e0141-542">Balance hello requirements dictated by compatibility, security, compliance, cost, and resiliency.</span></span> <span data-ttu-id="e0141-543">Например, tootake преимуществами [Выборочная проверка подлинности](https://technet.microsoft.com/library/cc755844) может выбрать toodeploy нового леса в Azure и создание отношений доверия с Windows Server Active Directory между локальным hello и лесом hello облака.</span><span class="sxs-lookup"><span data-stu-id="e0141-543">For example, tootake advantage of [selective authentication](https://technet.microsoft.com/library/cc755844) you might choose toodeploy a new forest on Azure and create a Windows Server Active Directory trust between hello on-premises forest and hello cloud forest.</span></span> <span data-ttu-id="e0141-544">Тем не менее, если приложение hello утверждениям, вы можете развернуть доверенности федерации вместо доверенностей леса Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e0141-544">If hello application is claims-aware, however, you might deploy federation trusts instead of Active Directory forest trusts.</span></span> <span data-ttu-id="e0141-545">Другим фактором будет что hello стоимости tooeither реплицировать больше данных, расширяя локальную toohello облака Windows Server Active Directory или формировать больше исходящего трафика в результате проверки подлинности и отправки запросов.</span><span class="sxs-lookup"><span data-stu-id="e0141-545">Another factor will be hello cost tooeither replicate more data by extending your on-premises Windows Server Active Directory toohello cloud or generate more outbound traffic as a result of authentication and query load.</span></span>

<span data-ttu-id="e0141-546">На выбор способа настройки также влияют требования к доступности и отказоустойчивости.</span><span class="sxs-lookup"><span data-stu-id="e0141-546">Requirements for availability and fault tolerance also affect your choice.</span></span> <span data-ttu-id="e0141-547">Например если hello связь будет разорвана, приложения, использующие доверенность Kerberos или доверие федерации, все скорее работать, пока вы не развернете достаточную инфраструктуру в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-547">For example, if hello link is interrupted, applications leveraging either a Kerberos trust or a federation trust are all likely entirely broken unless you have deployed sufficient infrastructure on Azure.</span></span> <span data-ttu-id="e0141-548">Альтернативные конфигурации развертывания КД реплики (для записи или только для чтения) повысить hello вероятность того, что может tootolerate сбоев связи.</span><span class="sxs-lookup"><span data-stu-id="e0141-548">Alternative deployment configurations such as replica DCs (writeable or RODCs) increase hello likelihood of being able tootolerate link outages.</span></span>

### <span data-ttu-id="e0141-549"><a name="BKMK_ADSiteTopology"></a>Топология сайтов Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="e0141-549"><a name="BKMK_ADSiteTopology"></a>Windows Server Active Directory site topology</span></span>
<span data-ttu-id="e0141-550">Вы должны определить toocorrectly сайтов и связей сайтов в порядке toooptimize трафика и снижения стоимости.</span><span class="sxs-lookup"><span data-stu-id="e0141-550">You need toocorrectly define sites and site links in order toooptimize traffic and minimize cost.</span></span> <span data-ttu-id="e0141-551">Сайты, связи сайтов и подсетей влияет на hello топологии репликации между КД и hello поток трафика проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="e0141-551">Sites, site-links, and subnets affect hello replication topology between DCs and hello flow of authentication traffic.</span></span> <span data-ttu-id="e0141-552">Рассмотрим следующие выставлении счетов за трафик hello, а затем развернуть и настроить КД согласно toohello требованиям вашего сценария развертывания:</span><span class="sxs-lookup"><span data-stu-id="e0141-552">Consider hello following traffic charges and then deploy and configure DCs according toohello requirements of your deployment scenario:</span></span>

* <span data-ttu-id="e0141-553">Есть номинальная плата за час для самого шлюза hello:</span><span class="sxs-lookup"><span data-stu-id="e0141-553">There is a nominal fee per hour for hello gateway itself:</span></span>
  
  * <span data-ttu-id="e0141-554">Его можно запустить и остановить по своему усмотрению.</span><span class="sxs-lookup"><span data-stu-id="e0141-554">It can be started and stopped as you see fit</span></span>
  * <span data-ttu-id="e0141-555">При остановке виртуальные машины Azure будут изолированы от корпоративной сети hello</span><span class="sxs-lookup"><span data-stu-id="e0141-555">If stopped, Azure VMs are isolated from hello corporate network</span></span>
* <span data-ttu-id="e0141-556">Входящий трафик бесплатный.</span><span class="sxs-lookup"><span data-stu-id="e0141-556">Inbound traffic is free</span></span>
* <span data-ttu-id="e0141-557">Исходящий трафик взимается слишком в соответствии с[Azure цены на быстро](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="e0141-557">Outbound traffic is charged, according too[Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span> <span data-ttu-id="e0141-558">Вы можете оптимизировать свойства связи между локальной и облачной сайтов hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e0141-558">You can optimize site link properties between on-premises sites and hello cloud sites as follows:</span></span>
  
  * <span data-ttu-id="e0141-559">При использовании нескольких виртуальных сетей настройте связи сайтов hello и их стоимость соответствующим образом tooprevent Windows Server AD DS из определения приоритетов hello Azure сайта через один, который может предоставлять hello же уровень обслуживания бесплатно.</span><span class="sxs-lookup"><span data-stu-id="e0141-559">If you are using multiple virtual networks, configure hello site-links and their costs appropriately tooprevent Windows Server AD DS from prioritizing hello Azure site over one that can provide hello same levels of service at no charge.</span></span> <span data-ttu-id="e0141-560">Также можно отключить мост hello все сайта link (функции BASL)-параметр (который включен по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="e0141-560">You might also consider disabling hello Bridge all site link (BASL) option (which is enabled by default).</span></span> <span data-ttu-id="e0141-561">Если ее отключить, друг с другом будут реплицироваться только напрямую подключенные сайты.</span><span class="sxs-lookup"><span data-stu-id="e0141-561">This ensures that only directly-connected sites replicate with one another.</span></span> <span data-ttu-id="e0141-562">Контроллеры домена в сайтах больше не будет tooreplicate напрямую друг с другом, но должны реплицироваться через общий сайт или сайты.</span><span class="sxs-lookup"><span data-stu-id="e0141-562">DCs in transitively connected sites are no longer able tooreplicate directly with each other, but must replicate through a common site or sites.</span></span> <span data-ttu-id="e0141-563">Если по некоторым причинам hello промежуточных узлов становятся недоступными, репликация между КД в сайтах не произойдет, даже если доступно соединение между сайтами hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-563">If hello intermediary sites become unavailable for some reason, replication between DCs in transitively connected sites will not occur even if connectivity between hello sites is available.</span></span> <span data-ttu-id="e0141-564">Наконец где части поведения транзитивной репликации остаются желательными, создайте мосты связей, содержащие hello соответствующих ссылок и сайтов, таких как локальные, корпоративные сетевые узлы.</span><span class="sxs-lookup"><span data-stu-id="e0141-564">Finally, where sections of transitive replication behavior remain desirable, create site link bridges that contain hello appropriate site-links and sites, such as on-premises, corporate network sites.</span></span>
  * <span data-ttu-id="e0141-565">[Настройте стоимость связей сайтов](https://technet.microsoft.com/library/cc794882) соответствующим образом tooavoid формирования нежелательного трафика.</span><span class="sxs-lookup"><span data-stu-id="e0141-565">[Configure site link costs](https://technet.microsoft.com/library/cc794882) appropriately tooavoid unintended traffic.</span></span> <span data-ttu-id="e0141-566">Например если **пробовать следующий ближайший сайт** включен параметр, убедитесь, что виртуальная сеть hello сайты не являются рядом hello ближайший увеличив hello стоимость, связанную с объектом hello связи сайтов, который соединяет задней toohello hello Azure site корпоративной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-566">For example, if **Try Next Closest Site** setting is enabled, make sure hello virtual network sites are not hello next closest by increasing hello cost associated of hello site-link object that connects hello Azure site back toohello corporate network.</span></span>
  * <span data-ttu-id="e0141-567">Настройка связи сайтов [интервалы](https://technet.microsoft.com/library/cc794878) и [расписания](https://technet.microsoft.com/library/cc816906) в соответствии с требованиями tooconsistency и скорости изменений объектов.</span><span class="sxs-lookup"><span data-stu-id="e0141-567">Configure site link [intervals](https://technet.microsoft.com/library/cc794878) and [schedules](https://technet.microsoft.com/library/cc816906) according tooconsistency requirements and rate of object changes.</span></span> <span data-ttu-id="e0141-568">Расписание репликации должно предусматривать задержку.</span><span class="sxs-lookup"><span data-stu-id="e0141-568">Align replication schedule with latency tolerance.</span></span> <span data-ttu-id="e0141-569">КД реплицируют hello только последнее состояние значения, поэтому уменьшающегося интервал приветствия репликации может уменьшить затраты при наличии достаточных скорость изменения объекта.</span><span class="sxs-lookup"><span data-stu-id="e0141-569">DCs replicate only hello last state of a value, so decreasing hello replication interval can save costs if there is a sufficient object change rate.</span></span>
* <span data-ttu-id="e0141-570">Чтобы снизить затраты, настройте расписание репликации и отключите уведомления об изменениях.</span><span class="sxs-lookup"><span data-stu-id="e0141-570">If minimizing costs is a priority, ensure replication is scheduled and change notification is not enabled.</span></span> <span data-ttu-id="e0141-571">Это конфигурация по умолчанию hello при репликации между сайтами.</span><span class="sxs-lookup"><span data-stu-id="e0141-571">This is hello default configuration when replicating between sites.</span></span> <span data-ttu-id="e0141-572">Это не имеет значения, при развертывании RODC в виртуальной сети, так как hello RODC не выполнять репликацию изменений вовне.</span><span class="sxs-lookup"><span data-stu-id="e0141-572">This is not important if you are deploying an RODC on a virtual network because hello RODC will not replicate any changes outbound.</span></span> <span data-ttu-id="e0141-573">Но если развертывается КД, вы должны убедитесь, что связь сайтов hello не является настроенным tooreplicate обновлений с ненужной частотой.</span><span class="sxs-lookup"><span data-stu-id="e0141-573">But if you deploy a writable DC, you should make sure hello site link is not configured tooreplicate updates with unnecessary frequency.</span></span> <span data-ttu-id="e0141-574">При развертывании сервера глобального каталога (GC), убедитесь, что каждый другой сайт, содержащий сборку Мусора, реплицирует секции домена из исходного КД на сайте, который связан с связь сайтов или связей сайтов, которые имеют более низкую стоимость, чем hello сборка Мусора hello Azure site.</span><span class="sxs-lookup"><span data-stu-id="e0141-574">If you deploy a global catalog server (GC), make sure that every other site that contains a GC replicates domain partitions from a source DC in a site that is connected with a site-link or site-links that have a lower cost than hello GC in hello Azure site.</span></span>
* <span data-ttu-id="e0141-575">Возможно toofurther по-прежнему сократить объем сетевого трафика, формируемого в результате репликации между сайтами, сменив алгоритм сжатия репликации hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-575">It is possible toofurther still reduce network traffic generated by replication between sites by changing hello replication compression algorithm.</span></span> <span data-ttu-id="e0141-576">Hello алгоритм сжатия управляется алгоритм сжатия в реестр запись hello REG_DWORD HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator.</span><span class="sxs-lookup"><span data-stu-id="e0141-576">hello compression algorithm is controlled by hello REG_DWORD registry entry HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator compression algorithm.</span></span> <span data-ttu-id="e0141-577">значение по умолчанию Hello равно 3, которая сопоставляет toohello алгоритму Xpress Compress.</span><span class="sxs-lookup"><span data-stu-id="e0141-577">hello default value is 3, which correlates toohello Xpress Compress algorithm.</span></span> <span data-ttu-id="e0141-578">Можно изменить значение too2 hello, какие изменения hello tooMSZip алгоритма.</span><span class="sxs-lookup"><span data-stu-id="e0141-578">You can change hello value too2, which changes hello algorithm tooMSZip.</span></span> <span data-ttu-id="e0141-579">В большинстве случаев это приведет к увеличению hello сжатие, но это достигается за счет hello использования ЦП.</span><span class="sxs-lookup"><span data-stu-id="e0141-579">In most cases, this will increase hello compression, but it does so at hello expense of CPU utilization.</span></span> <span data-ttu-id="e0141-580">Дополнительные сведения см. в статье [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994) (Принципы работы топологии репликации Active Directory).</span><span class="sxs-lookup"><span data-stu-id="e0141-580">For more information, see [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994).</span></span>

### <span data-ttu-id="e0141-581"><a name="BKMK_IPAddressDNS"></a>Назначение IP-адресов и DNS</span><span class="sxs-lookup"><span data-stu-id="e0141-581"><a name="BKMK_IPAddressDNS"></a>IP addressing and DNS</span></span>
<span data-ttu-id="e0141-582">По умолчанию для виртуальных машин Azure выделяются адреса по протоколу DHCP на определенный срок аренды.</span><span class="sxs-lookup"><span data-stu-id="e0141-582">Azure virtual machines are allocated “DHCP-leased addresses” by default.</span></span> <span data-ttu-id="e0141-583">Поскольку динамических адресов виртуальной сети Azure сохраняется с виртуальной машиной в течение времени существования hello hello виртуальной машины, hello требования для Windows Server AD DS выполняются полностью.</span><span class="sxs-lookup"><span data-stu-id="e0141-583">Because Azure virtual network dynamic addresses persist with a virtual machine for hello lifetime of hello virtual machine, hello requirements of Windows Server AD DS are met.</span></span>

<span data-ttu-id="e0141-584">В результате при использовании динамического адреса в Azure, вы находитесь в фактически используется статический IP-адрес, поскольку он может быть маршрутизирован hello срок аренды hello, а hello срок аренды hello — время существования равно toohello hello облачной службы.</span><span class="sxs-lookup"><span data-stu-id="e0141-584">As a result, when you use a dynamic address on Azure, you are in effect using a static IP address because it is routable for hello period of hello lease, and hello period of hello lease is equal toohello lifetime of hello cloud service.</span></span>

<span data-ttu-id="e0141-585">Однако hello динамический адрес освобождается, если hello виртуальной Машины завершается.</span><span class="sxs-lookup"><span data-stu-id="e0141-585">However, hello dynamic address is deallocated if hello VM is shutdown.</span></span> <span data-ttu-id="e0141-586">tooprevent hello IP-адрес из освобождение, вы можете [использовать Set-AzureStaticVNetIP tooassign статический IP-адрес](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span><span class="sxs-lookup"><span data-stu-id="e0141-586">tooprevent hello IP address from being deallocated, you can [use Set-AzureStaticVNetIP tooassign a static IP address](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span></span>

<span data-ttu-id="e0141-587">Для разрешения имен разверните собственную (или используйте существующую) инфраструктуру DNS-сервера Azure DNS не отвечает требованиям, hello advanced необходимы для Windows Server AD DS.</span><span class="sxs-lookup"><span data-stu-id="e0141-587">For name resolution, deploy your own (or leverage your existing) DNS server infrastructure; Azure-provided DNS does not meet hello advanced name resolution needs of Windows Server AD DS.</span></span> <span data-ttu-id="e0141-588">Например, он не поддерживает динамические записи SRV и т. п.</span><span class="sxs-lookup"><span data-stu-id="e0141-588">For example, it does not support dynamic SRV records, and so on.</span></span> <span data-ttu-id="e0141-589">Разрешение имени — это критически важный компонент настройки контроллеров домена и присоединенных к домену клиентов.</span><span class="sxs-lookup"><span data-stu-id="e0141-589">Name resolution is a critical configuration item for DCs and domain-joined clients.</span></span> <span data-ttu-id="e0141-590">Контроллеры домена должны регистрировать записи ресурсов и разрешать другие записи контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-590">DCs must be capable of registering resource records and resolving other DC’s resource records.</span></span>
<span data-ttu-id="e0141-591">Для обеспечения отказоустойчивости и производительности наилучшей это оптимальный tooinstall службы DNS-сервера Windows hello на hello контроллеры, работающие в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-591">For fault tolerance and performance reasons, it is optimal tooinstall hello Windows Server DNS service on hello DCs running on Azure.</span></span> <span data-ttu-id="e0141-592">Затем настройте свойства виртуальной сети Azure hello с именем hello и IP-адрес DNS-сервера hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-592">Then configure hello Azure virtual network properties with hello name and IP address of hello DNS server.</span></span> <span data-ttu-id="e0141-593">Когда запускаются другие виртуальные машины в виртуальной сети hello, их параметры сопоставителя DNS-клиента настраивается с помощью DNS-сервера как часть hello выделения динамических IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="e0141-593">When other VMs on hello virtual network start, their DNS client resolver settings will be configured with DNS server as part of hello dynamic IP address allocation.</span></span>

> [!NOTE]
> <span data-ttu-id="e0141-594">Нельзя присоединить локальные tooa компьютеров Windows Server AD DS Active Directory домена, размещенной в Azure непосредственно через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-594">You cannot join on-premises computers tooa Windows Server AD DS Active Directory domain that is hosted on Azure directly over hello Internet.</span></span> <span data-ttu-id="e0141-595">Здравствуйте требования к портам для Active Directory и операции присоединения к домену hello делают нецелесообразным toodirectly предоставляют hello необходимые порты и соответственно весь toohello контроллера домена Интернета.</span><span class="sxs-lookup"><span data-stu-id="e0141-595">hello port requirements for Active Directory and hello domain-join operation render it impractical toodirectly expose hello necessary ports and in effect, an entire DC toohello Internet.</span></span>
> 
> 

<span data-ttu-id="e0141-596">При запуске или изменении DNS-имя виртуальных машин регистрируется автоматически.</span><span class="sxs-lookup"><span data-stu-id="e0141-596">VMs register their DNS name automatically on startup or when there is a name change.</span></span>

<span data-ttu-id="e0141-597">Дополнительные сведения об этом и других примерах, показано, как tooprovision hello первой ВМ и установку на нее AD DS см. в разделе [Установка нового леса Active Directory в Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-597">For more information about this example and another example that shows how tooprovision hello first VM and install AD DS on it, see [Install a new Active Directory forest on Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span></span> <span data-ttu-id="e0141-598">Дополнительные сведения об использовании Windows PowerShell см. в разделах [Справка по Azure PowerShell](/powershell/azureps-cmdlets-docs) и [Azure Management Cmdlets](/powershell/module/azurerm.compute/#virtual_machines) (Командлеты управления Azure).</span><span class="sxs-lookup"><span data-stu-id="e0141-598">For more information about using Windows PowerShell, see [Install Azure PowerShell](/powershell/azureps-cmdlets-docs) and [Azure Management Cmdlets](/powershell/module/azurerm.compute/#virtual_machines).</span></span>

### <span data-ttu-id="e0141-599"><a name="BKMK_DistributedDCs"></a>Географически распределенные контроллеры домена</span><span class="sxs-lookup"><span data-stu-id="e0141-599"><a name="BKMK_DistributedDCs"></a>Geo-distributed DCs</span></span>
<span data-ttu-id="e0141-600">Преимущества размещения нескольких контроллеров домена в разных виртуальных сетях Azure:</span><span class="sxs-lookup"><span data-stu-id="e0141-600">Azure offers advantages when hosting multiple DCs on different virtual networks:</span></span>

* <span data-ttu-id="e0141-601">отказоустойчивость нескольких сайтов;</span><span class="sxs-lookup"><span data-stu-id="e0141-601">Multi-site fault-tolerance</span></span>
* <span data-ttu-id="e0141-602">Физическая близость toobranch офисов (меньшая задержка)</span><span class="sxs-lookup"><span data-stu-id="e0141-602">Physical proximity toobranch offices (lower latency)</span></span>

<span data-ttu-id="e0141-603">Сведения о настройке прямого взаимодействия между виртуальными сетями см. в разделе [настройки сетевых подключений виртуальной сети toovirtual](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-603">For information about configuring direct communication between virtual networks, see [Configure virtual network toovirtual network connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

### <span data-ttu-id="e0141-604"><a name="BKMK_RODC"></a>Контроллеры доменов только для чтения</span><span class="sxs-lookup"><span data-stu-id="e0141-604"><a name="BKMK_RODC"></a>Read-only DCs</span></span>
<span data-ttu-id="e0141-605">Требуется toochoose ли чтение toodeploy-только или для записи контроллеров домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-605">You need toochoose whether toodeploy read-only or writeable DCs.</span></span> <span data-ttu-id="e0141-606">Может быть держите toodeploy контроллеры только для чтения, так как не будет физического контроля над ними, но контроллеры только для чтения спроектированный toobe развертывания в местах, где их физическая безопасность подвергается риску, например в филиалах.</span><span class="sxs-lookup"><span data-stu-id="e0141-606">You might be inclined toodeploy RODCs because you will not have physical control over them, but RODCs are designed toobe deployed in locations where their physical security is at risk, such as branch offices.</span></span>

<span data-ttu-id="e0141-607">Azure нет риска hello физической безопасности филиала, но контроллеры только для чтения могут все равно оказаться toobe наиболее эффективными по затратам, так как функции hello — хорошо подходит toothese среды, но по совершенно другим причинам.</span><span class="sxs-lookup"><span data-stu-id="e0141-607">Azure does not present hello physical security risk of a branch office, but RODCs might still prove toobe more cost effective because hello features they provide are well-suited toothese environments albeit for very different reasons.</span></span> <span data-ttu-id="e0141-608">Например контроллеры только для чтения не имеют исходящей репликации и являются tooselectively могут заполнять секретные данные (пароли).</span><span class="sxs-lookup"><span data-stu-id="e0141-608">For example, RODCs have no outbound replication and are able tooselectively populate secrets (passwords).</span></span> <span data-ttu-id="e0141-609">На недостаток hello hello отсутствие этих секретных может потребоваться исходящего трафика по требованию toovalidate их, как пользователь или компьютер выполняет проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="e0141-609">On hello downside, hello lack of these secrets might require on-demand outbound traffic toovalidate them as a user or computer authenticates.</span></span> <span data-ttu-id="e0141-610">Но секретные коды можно заполнить предварительно и кэшировать.</span><span class="sxs-lookup"><span data-stu-id="e0141-610">But secrets can be selectively prepopulated and cached.</span></span>

<span data-ttu-id="e0141-611">Контроллеры только для чтения предоставляют дополнительное преимущество в и вокруг проблемы ОСОБО и персональные данные, так как вы можете добавить атрибуты, которые содержат конфиденциальные данные toohello RODC отфильтрованный набор атрибутов (FAS).</span><span class="sxs-lookup"><span data-stu-id="e0141-611">RODCs provide an additional advantage in and around HBI and PII concerns because you can add attributes that contain sensitive data toohello RODC filtered attribute set (FAS).</span></span> <span data-ttu-id="e0141-612">Hello FAS является настраиваемым набором атрибутов, которые не являются реплицированных tooRODCs.</span><span class="sxs-lookup"><span data-stu-id="e0141-612">hello FAS is a customizable set of attributes that are not replicated tooRODCs.</span></span> <span data-ttu-id="e0141-613">Можно использовать hello FAS качестве меры предосторожности на случай не разрешено или нежелательно toostore PII или HBI в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-613">You can use hello FAS as a safeguard in case you are not permitted or do not want toostore PII or HBI on Azure.</span></span> <span data-ttu-id="e0141-614">Дополнительные сведения см. в разделе об [отфильтрованном наборе атрибутов контроллеров домена только для чтения[(https://technet.microsoft.com/library/cc753459)].</span><span class="sxs-lookup"><span data-stu-id="e0141-614">For more information, see [RODC filtered attribute set[(https://technet.microsoft.com/library/cc753459)].</span></span>

<span data-ttu-id="e0141-615">Убедитесь, что приложения будут совместимы с подобными контроллерами планирование toouse.</span><span class="sxs-lookup"><span data-stu-id="e0141-615">Make sure that applications will be compatible with RODCs you plan toouse.</span></span> <span data-ttu-id="e0141-616">Многие приложения, работающие с Windows Server Active Directory работы с контроллерами только для чтения, но некоторые приложения могут работать неоптимально или завершиться ошибкой, если они не имеют tooa доступ для записи контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-616">Many Windows Server Active Directory-enabled applications work well with RODCs, but some applications can perform inefficiently or fail if they do not have access tooa writable DC.</span></span> <span data-ttu-id="e0141-617">Дополнительные сведения см. в статье [Read-Only DCs application compatibility guide](https://technet.microsoft.com/library/cc755190) (Совместимость приложений с контроллерами домена только для чтения).</span><span class="sxs-lookup"><span data-stu-id="e0141-617">For more information, see [Read-Only DCs application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>

### <span data-ttu-id="e0141-618"><a name="BKMK_GC"></a>Глобальный каталог</span><span class="sxs-lookup"><span data-stu-id="e0141-618"><a name="BKMK_GC"></a>Global catalog</span></span>
<span data-ttu-id="e0141-619">Требуется toochoose ли tooinstall глобального каталога (GC).</span><span class="sxs-lookup"><span data-stu-id="e0141-619">You need toochoose whether tooinstall a global catalog (GC).</span></span> <span data-ttu-id="e0141-620">В лесу с одним доменом необходимо настроить все контроллеры домена в качестве серверов глобального каталога.</span><span class="sxs-lookup"><span data-stu-id="e0141-620">In a single domain forest, you should configure all DCs as global catalog servers.</span></span> <span data-ttu-id="e0141-621">Это не увеличит затраты, так как не влечет за собой дополнительный трафик репликации.</span><span class="sxs-lookup"><span data-stu-id="e0141-621">It will not increase costs because there will be no additional replication traffic.</span></span>

<span data-ttu-id="e0141-622">В лесу с несколькими доменами глобальные каталоги доступны необходимые tooexpand членства общей группы во время процесса проверки подлинности hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-622">In a multidomain forest, GCs are necessary tooexpand Universal Group memberships during hello authentication process.</span></span> <span data-ttu-id="e0141-623">Если сборка Мусора не будет развернута, рабочие нагрузки на hello виртуальную сеть, проходящие проверку подлинности на КД в Azure будут косвенно формировать tooquery исходящей проверки подлинности трафика локальных сборок мусора во время каждой попытки проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="e0141-623">If you do not deploy a GC, workloads on hello virtual network that authenticate against a DC on Azure will indirectly generate outbound authentication traffic tooquery GCs on-premises during each authentication attempt.</span></span>

<span data-ttu-id="e0141-624">Hello затраты, связанные со сборкой мусора, менее прогнозируемые, так как они размещают каждый домен (частично).</span><span class="sxs-lookup"><span data-stu-id="e0141-624">hello costs associated with GCs are less-predictable because they host every domain (in-part).</span></span> <span data-ttu-id="e0141-625">Если рабочая нагрузка hello с интернет-службу и подтверждает подлинность пользователей с Windows Server AD DS, hello затраты будут совершенно непредсказуемыми.</span><span class="sxs-lookup"><span data-stu-id="e0141-625">If hello workload hosts an Internet-facing service and authenticates users against Windows Server AD DS, hello costs could be completely unpredictable.</span></span> <span data-ttu-id="e0141-626">toohelp снизить запросов сборки Мусора вне hello облака сайта во время проверки подлинности, вы можете [включить возможность кэширования членства универсальной группы](https://technet.microsoft.com/library/cc816928).</span><span class="sxs-lookup"><span data-stu-id="e0141-626">toohelp reduce GC queries outside of hello cloud site during authentication, you can [enable Universal Group Membership Caching](https://technet.microsoft.com/library/cc816928).</span></span>

### <span data-ttu-id="e0141-627"><a name="BKMK_InstallMethod"></a>Метод установки</span><span class="sxs-lookup"><span data-stu-id="e0141-627"><a name="BKMK_InstallMethod"></a>Installation method</span></span>
<span data-ttu-id="e0141-628">Как требуется toochoose tooinstall hello контроллеров домена в виртуальной сети hello:</span><span class="sxs-lookup"><span data-stu-id="e0141-628">You need toochoose how tooinstall hello DCs on hello virtual network:</span></span>

* <span data-ttu-id="e0141-629">Повышение уровня новых контроллеров домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-629">Promote new DCs.</span></span> <span data-ttu-id="e0141-630">Дополнительные сведения см. в статье [Установка нового леса Active Directory в виртуальной сети Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="e0141-630">For more information, see [Install a new Active Directory forest on an Azure virtual network](active-directory-new-forest-virtual-machine.md).</span></span>
* <span data-ttu-id="e0141-631">Переместите hello VHD облака toohello локального виртуального контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-631">Move hello VHD of an on-premises virtual DC toohello cloud.</span></span> <span data-ttu-id="e0141-632">В этом случае необходимо убедиться, что hello локального КД «перемещен» не «скопирован» или «клонирован».</span><span class="sxs-lookup"><span data-stu-id="e0141-632">In this case, you must ensure that hello on-premises virtual DC is “moved,” not “copied” or “cloned.”</span></span>

<span data-ttu-id="e0141-633">Используйте только в Azure виртуальные машины для контроллеров домена (как противоположность tooAzure «веб» или «рабочих» ролей виртуальных машин).</span><span class="sxs-lookup"><span data-stu-id="e0141-633">Use only Azure virtual machines for DCs (as opposed tooAzure “web” or “worker” role VMs).</span></span> <span data-ttu-id="e0141-634">Они надежные, а эта характеристика необходима для контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-634">They are durable and durability of state for a DC is required.</span></span> <span data-ttu-id="e0141-635">Виртуальные машины Azure предназначены для таких рабочих нагрузок, как операции с контроллерами домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-635">Azure virtual machines are designed for workloads such as DCs.</span></span>

<span data-ttu-id="e0141-636">Не используйте SYSPREP toodeploy или клонирования КД.</span><span class="sxs-lookup"><span data-stu-id="e0141-636">Do not use SYSPREP toodeploy or clone DCs.</span></span> <span data-ttu-id="e0141-637">возможность Hello tooclone контроллеров домена появилась только в Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="e0141-637">hello ability tooclone DCs is only available beginning in Windows Server 2012.</span></span> <span data-ttu-id="e0141-638">Hello клонирования требуется поддержка VMGenerationID в базовой низкоуровневой оболочке hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-638">hello cloning feature requires support for VMGenerationID in hello underlying hypervisor.</span></span> <span data-ttu-id="e0141-639">Hyper-V в составе Windows Server 2012 и виртуальные сети Azure поддерживают этот идентификатор, как и сторонние поставщики программного обеспечения виртуализации.</span><span class="sxs-lookup"><span data-stu-id="e0141-639">Hyper-V in Windows Server 2012 and Azure virtual networks both support VMGenerationID, as do third-party virtualization software vendors.</span></span>

### <span data-ttu-id="e0141-640"><a name="BKMK_PlaceDB"></a>Размещение базы данных hello Windows Server AD DS и SYSVOL</span><span class="sxs-lookup"><span data-stu-id="e0141-640"><a name="BKMK_PlaceDB"></a>Placement of hello Windows Server AD DS database and SYSVOL</span></span>
<span data-ttu-id="e0141-641">Выберите, где toolocate hello базы данных Windows Server AD DS, журналов и SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="e0141-641">Select where toolocate hello Windows Server AD DS database, logs, and SYSVOL.</span></span> <span data-ttu-id="e0141-642">Они должны быть развернуты на дисках данных Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-642">They must be deployed on Azure Data disks.</span></span>

> [!NOTE]
> <span data-ttu-id="e0141-643">Диски данных Azure, ограниченного too1 ТБ.</span><span class="sxs-lookup"><span data-stu-id="e0141-643">Azure Data disks are constrained too1 TB.</span></span>
> 
> 

<span data-ttu-id="e0141-644">По умолчанию диски данных не кэшируют операции записи.</span><span class="sxs-lookup"><span data-stu-id="e0141-644">Data disk drives do not cache writes by default.</span></span> <span data-ttu-id="e0141-645">Сквозная запись кэширование использовать диски с данными, присоединенные tooa виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="e0141-645">Data disk drives that are attached tooa VM use write-through caching.</span></span> <span data-ttu-id="e0141-646">Кэширование делает со сквозной убедитесь, что записи hello является зафиксированных toodurable хранилища Azure до hello транзакция считается завершенной с точки зрения операционной системы виртуальной Машины hello hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-646">Write-through caching makes sure hello write is committed toodurable Azure storage before hello transaction is complete from hello perspective of hello VM’s operating system.</span></span> <span data-ttu-id="e0141-647">Это обеспечивает надежность за счет hello объекта более медленных операций записи.</span><span class="sxs-lookup"><span data-stu-id="e0141-647">It provides durability, at hello expense of slightly slower writes.</span></span>

<span data-ttu-id="e0141-648">Это важно для Windows Server AD DS, поскольку кэширование диска записи делает недействительными предположения hello контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="e0141-648">This is important for Windows Server AD DS because write-behind disk-caching invalidates assumptions made by hello DC.</span></span> <span data-ttu-id="e0141-649">Windows Server AD DS пытается toodisable кэширование записи, но он работает toohonor системы ввода-ВЫВОДА диска toohello его.</span><span class="sxs-lookup"><span data-stu-id="e0141-649">Windows Server AD DS attempts toodisable write caching but it is up toohello disk IO system toohonor it.</span></span> <span data-ttu-id="e0141-650">Кэширование записи toodisable сбоя может при определенных обстоятельствах вызвать откат USN, что приводит к появлению устаревших объектов и других проблем.</span><span class="sxs-lookup"><span data-stu-id="e0141-650">Failure toodisable write caching may, under certain circumstances, introduce USN rollback resulting in lingering objects and other problems.</span></span>

<span data-ttu-id="e0141-651">Рекомендуется для виртуальных контроллеров домена hello следующие:</span><span class="sxs-lookup"><span data-stu-id="e0141-651">As a best practice for virtual DCs, do hello following:</span></span>

* <span data-ttu-id="e0141-652">Задайте приветствия настройки кэша узла для диска данных Azure hello не нужна.</span><span class="sxs-lookup"><span data-stu-id="e0141-652">Set hello Host Cache Preference setting on hello Azure data disk for NONE.</span></span> <span data-ttu-id="e0141-653">Это позволяет предотвратить проблемы с кэшированием записи для операций AD DS.</span><span class="sxs-lookup"><span data-stu-id="e0141-653">This prevents issues with write caching for AD DS operations.</span></span>
* <span data-ttu-id="e0141-654">Хранить hello базы данных, журналов и SYSVOL на hello либо и те же данные на диске или отдельных дисках данных.</span><span class="sxs-lookup"><span data-stu-id="e0141-654">Store hello database, logs, and SYSVOL on hello either same data disk or separate data disks.</span></span> <span data-ttu-id="e0141-655">Обычно это диск, отличный от диска hello, используемого для самой операционной системы hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-655">Typically, this is a separate disk from hello disk used for hello operating system itself.</span></span> <span data-ttu-id="e0141-656">Hello мысль заключается hello базы данных Windows Server AD DS и SYSVOL не должны храниться на диске операционной системы Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-656">hello key takeaway is that hello Windows Server AD DS database and SYSVOL must not be stored on an Azure Operating System disk type.</span></span> <span data-ttu-id="e0141-657">По умолчанию hello процесс установки AD DS эти компоненты устанавливаются в папку % systemroot %, что не рекомендуется для Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-657">By default, hello AD DS installation process installs these components in %systemroot% folder, which is NOT recommended for Azure.</span></span>

### <span data-ttu-id="e0141-658"><a name="BKMK_BUR"></a>Резервное копирование и восстановление</span><span class="sxs-lookup"><span data-stu-id="e0141-658"><a name="BKMK_BUR"></a>Backup and restore</span></span>
<span data-ttu-id="e0141-659">Следует учитывать, что поддерживается и не поддерживается для резервного копирования и восстановления контроллеров домена в целом и для контроллеров домена, запущенных на виртуальной машине, в частности.</span><span class="sxs-lookup"><span data-stu-id="e0141-659">Be aware of what is and is not supported for backup and restore of a DC in general, and more specifically, those running in a VM.</span></span> <span data-ttu-id="e0141-660">Дополнительные сведения см. в статье [Backup and Restore Considerations for Virtualized DCs](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers) (Особенности архивации и восстановления виртуализированных контроллеров домена).</span><span class="sxs-lookup"><span data-stu-id="e0141-660">See [Backup and Restore Considerations for Virtualized DCs](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span></span>

<span data-ttu-id="e0141-661">Создайте резервные копии состояния системы с помощью программного обеспечения для архивации, которое поддерживает требования для резервного копирования Windows Server AD DS (например, с помощью системы архивации данных Windows Server).</span><span class="sxs-lookup"><span data-stu-id="e0141-661">Create system state backups by using only backup software that is specifically aware of backup requirements for Windows Server AD DS, such as Windows Server Backup.</span></span>

<span data-ttu-id="e0141-662">Не копируйте и не клонируйте VHD-файлы контроллеров домена вместо регулярного создания резервных копий.</span><span class="sxs-lookup"><span data-stu-id="e0141-662">Do not copy or clone VHD files of DCs instead of performing regular backups.</span></span> <span data-ttu-id="e0141-663">Если потребуется восстановление, при использовании скопированных или клонированных VHD-файлов отдельно от Windows Server 2012 и поддерживаемой низкоуровневой оболочки создаются USN-пузыри.</span><span class="sxs-lookup"><span data-stu-id="e0141-663">Should a restore ever be required, doing so using cloned or copied VHDs without Windows Server 2012 and a supported hypervisor will introduce USN bubbles.</span></span>

### <span data-ttu-id="e0141-664"><a name="BKMK_FedSrvConfig"></a>Настройка сервера федерации</span><span class="sxs-lookup"><span data-stu-id="e0141-664"><a name="BKMK_FedSrvConfig"></a>Federation server configuration</span></span>
<span data-ttu-id="e0141-665">Hello Конфигурация серверов федерации AD FS Windows Server (STS) отчасти зависит ли hello приложения, которые должны toodeploy в Azure должны tooaccess ресурсам в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-665">hello configuration of Windows Server AD FS federation servers (STSs) depends in part on whether hello applications that you want toodeploy on Azure need tooaccess resources on your on-premises network.</span></span>

<span data-ttu-id="e0141-666">Если приложения hello удовлетворять hello следующие критерии, можно развернуть приложения hello отдельно от вашей локальной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-666">If hello applications meet hello following criteria, you could deploy hello applications in isolation from your on-premises network.</span></span>

* <span data-ttu-id="e0141-667">они принимают маркеры безопасности SAML;</span><span class="sxs-lookup"><span data-stu-id="e0141-667">They accept SAML security tokens</span></span>
* <span data-ttu-id="e0141-668">Они являются toohello через Интернет</span><span class="sxs-lookup"><span data-stu-id="e0141-668">They are exposable toohello Internet</span></span>
* <span data-ttu-id="e0141-669">они не осуществляют доступ к локальным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="e0141-669">They do not access on-premises resources</span></span>

<span data-ttu-id="e0141-670">В этом случае службы маркеров безопасности Windows Server AD FS нужно настроить следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e0141-670">In this case, configure Windows Server AD FS STSs as follows:</span></span>

1. <span data-ttu-id="e0141-671">Настройте изолированный лес с одним доменом в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-671">Configure an isolated single-domain forest on Azure.</span></span>
2. <span data-ttu-id="e0141-672">Предоставление федеративного доступа к лесу toohello путем настройки фермы серверов федерации Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-672">Provide federated access toohello forest by configuring a Windows Server AD FS federation server farm.</span></span>
3. <span data-ttu-id="e0141-673">Настройте Windows Server AD FS (ферму серверов федерации и ферму прокси-сервера федерации) в локальном лесу hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-673">Configure Windows Server AD FS (federation server farm and federation server proxy farm) in hello on-premises forest.</span></span>
4. <span data-ttu-id="e0141-674">Установите отношения доверия федерации между hello локальным и облачным экземпляром Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-674">Establish a federation trust relationship between hello on-premises and Azure instances of Windows Server AD FS.</span></span>

<span data-ttu-id="e0141-675">На Здравствуйте другой стороны, если hello приложению требуется доступ к ресурсам локальной tooon, можно настроить Windows Server AD FS с приложением hello в Azure следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e0141-675">On hello other hand, if hello applications require access tooon-premises resources, you could configure Windows Server AD FS with hello application on Azure as follows:</span></span>

1. <span data-ttu-id="e0141-676">Настройте подключение между локальными сетями и Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-676">Configure connectivity between on-premises networks and Azure.</span></span>
2. <span data-ttu-id="e0141-677">Настройка фермы серверов федерации Windows Server AD FS в локальном лесу hello.</span><span class="sxs-lookup"><span data-stu-id="e0141-677">Configure a Windows Server AD FS federation server farm in hello on-premises forest.</span></span>
3. <span data-ttu-id="e0141-678">Настройте ферму прокси-сервера федерации служб AD FS Windows Server в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-678">Configure a Windows Server AD FS federation server proxy farm on Azure.</span></span>

<span data-ttu-id="e0141-679">Эта конфигурация имеет преимущество hello уменьшение раскрытия hello локальных ресурсов, аналогичные tooconfiguring Windows Server AD FS с приложениями в пограничной сети.</span><span class="sxs-lookup"><span data-stu-id="e0141-679">This configuration has hello advantage of reducing hello exposure of on-premises resources, similar tooconfiguring Windows Server AD FS with applications in a perimeter network.</span></span>

<span data-ttu-id="e0141-680">Отметим, что в любом сценарии для взаимодействия типа "бизнес-бизнес" можно установить отношения доверия с дополнительными поставщиками удостоверений.</span><span class="sxs-lookup"><span data-stu-id="e0141-680">Note that in either scenario, you can establish trusts relationships with more identity providers, if business-to-business collaboration is needed.</span></span>

### <span data-ttu-id="e0141-681"><a name="BKMK_CloudSvcConfig"></a>Настройка облачных служб</span><span class="sxs-lookup"><span data-stu-id="e0141-681"><a name="BKMK_CloudSvcConfig"></a>Cloud services configuration</span></span>
<span data-ttu-id="e0141-682">Облачные службы необходимы, если требуется tooexpose виртуальной Машины напрямую toohello Интернет или из Интернета tooexpose балансировки нагрузки приложения.</span><span class="sxs-lookup"><span data-stu-id="e0141-682">Cloud services are necessary if you want tooexpose a VM directly toohello Internet or tooexpose an Internet-facing load-balanced application.</span></span> <span data-ttu-id="e0141-683">Это возможно, потому что для каждой облачной службой предоставляется один настраиваемый виртуальный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="e0141-683">This is possible because each cloud service offers a single configurable virtual IP address.</span></span>

### <span data-ttu-id="e0141-684"><a name="BKMK_FedReqVIPDIP"></a>Требования сервера федерации в отношении общих и частных IP-адресов (динамические и виртуальные IP-адреса)</span><span class="sxs-lookup"><span data-stu-id="e0141-684"><a name="BKMK_FedReqVIPDIP"></a>Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>
<span data-ttu-id="e0141-685">Каждой виртуальной машине Azure присваивается динамический IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="e0141-685">Each Azure virtual machine receives a dynamic IP address.</span></span> <span data-ttu-id="e0141-686">Это частный адрес, который доступен только в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-686">A dynamic IP address is a private address accessible only within Azure.</span></span> <span data-ttu-id="e0141-687">В большинстве случаев Однако, будет необходимости tooconfigure виртуальный IP-адрес для развертываний Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-687">In most cases, however, it will be necessary tooconfigure a virtual IP address for your Windows Server AD FS deployments.</span></span> <span data-ttu-id="e0141-688">Hello виртуальный IP-адрес является необходимые tooexpose toohello конечных точек Windows Server AD FS Интернет и будет использоваться участниками федерации и клиентами для проверки подлинности и последующее управление им.</span><span class="sxs-lookup"><span data-stu-id="e0141-688">hello virtual IP is necessary tooexpose Windows Server AD FS endpoints toohello Internet, and will be used by federated partners and clients for authentication and ongoing management.</span></span> <span data-ttu-id="e0141-689">Этот адрес является свойством облачной службы, в которую входит одна или несколько виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-689">A virtual IP address is a property of a cloud service which contains one or more Azure virtual machines.</span></span> <span data-ttu-id="e0141-690">Если приложение hello-утверждений, развернутых на Azure и Windows Server AD FS из Интернета и совместное использование портов, потребуются виртуальный IP-адрес свои собственные и поэтому будет необходимые toocreate одной облачной службы для приложения hello и Во-вторых, для Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="e0141-690">If hello claims-aware application deployed on Azure and Windows Server AD FS are both Internet-facing and share common ports, each will require a virtual IP address of its own and it will therefore be necessary toocreate one cloud service for hello application and a second for Windows Server AD FS.</span></span>

<span data-ttu-id="e0141-691">Определения hello условия виртуальный IP-адрес и динамический IP-адрес в разделе [термины и определения](#BKMK_Glossary).</span><span class="sxs-lookup"><span data-stu-id="e0141-691">For definitions of hello terms virtual IP address and dynamic IP address, see [Terms and definitions](#BKMK_Glossary).</span></span>

### <span data-ttu-id="e0141-692"><a name="BKMK_ADFSHighAvail"></a>Настройка высокой доступности Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="e0141-692"><a name="BKMK_ADFSHighAvail"></a>Windows Server AD FS high availability configuration</span></span>
<span data-ttu-id="e0141-693">Хотя службы федерации возможных toodeploy автономный Windows Server AD FS рекомендуется toodeploy фермы с по крайней мере два узла для AD FS и прокси-серверы для рабочей среды.</span><span class="sxs-lookup"><span data-stu-id="e0141-693">While it is possible toodeploy standalone Windows Server AD FS federation services, it is recommended toodeploy a farm with at least two nodes for both AD FS STS and proxies for production environments.</span></span>

<span data-ttu-id="e0141-694">В разделе [некоторые аспекты топологии AD FS 2.0 развертывания](https://technet.microsoft.com/library/gg982489) в hello [AD FS 2.0 Design Guide](https://technet.microsoft.com/library/dd807036) toodecide конфигурации развертывания параметры наиболее подходящий под ваши нужды.</span><span class="sxs-lookup"><span data-stu-id="e0141-694">See [AD FS 2.0 deployment topology considerations](https://technet.microsoft.com/library/gg982489) in hello [AD FS 2.0 Design Guide](https://technet.microsoft.com/library/dd807036) toodecide which deployment configuration options best suit your particular needs.</span></span>

> [!NOTE]
> <span data-ttu-id="e0141-695">В подсистеме балансировки нагрузки порядок tooget для конечных точек Windows Server AD FS в Azure, настройте все члены фермы Windows Server AD FS hello hello же облачной службе и используйте hello возможность балансировки нагрузки Azure для HTTP (по умолчанию 80) и HTTPS (по умолчанию 443).</span><span class="sxs-lookup"><span data-stu-id="e0141-695">In order tooget load balancing for Windows Server AD FS endpoints on Azure, configure all members of hello Windows Server AD FS farm in hello same cloud service, and use hello load balancing capability of Azure for HTTP (default 80) and HTTPS ports (default 443).</span></span> <span data-ttu-id="e0141-696">Дополнительные сведения см. в статье [LoadBalancerProbe Schema](https://msdn.microsoft.com/library/azure/jj151530) (Схема LoadBalancerProbe).</span><span class="sxs-lookup"><span data-stu-id="e0141-696">For more information, see [Azure load-balancer probe](https://msdn.microsoft.com/library/azure/jj151530).</span></span>
> <span data-ttu-id="e0141-697">Балансировка сетевой нагрузки Windows Server не поддерживается в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0141-697">Windows Server Network Load Balancing (NLB) is not supported on Azure.</span></span>
> 
> 

