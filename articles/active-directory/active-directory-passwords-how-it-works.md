---
title: "Руководство по Azure AD SSPR | Документация Майкрософт"
description: "Руководство по самостоятельному сбросу пароля в Azure AD."
services: active-directory
keywords: 
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.reviewer: sahenry
ms.assetid: 618c5908-5bf6-4f0d-bf88-5168dfb28a88
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/28/2017
ms.author: joflore
ms.custom: it-pro
ms.openlocfilehash: cbb33988f5db47e35db406c037caa9133616d191
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="self-service-password-reset-in-azure-ad-deep-dive"></a>Руководство по самостоятельному сбросу пароля в Azure AD

Как работает самостоятельный сброс пароля (SSPR)? Что означает этот элемент интерфейса? Прочтите эту статью и расширьте свои знания о самостоятельном сбросе пароля в Azure AD.

## <a name="how-does-the-password-reset-portal-work"></a>Как работает портал для сброса паролей

При переходе пользователя на портал сброса паролей запускается рабочий процесс, определяющий следующее:

   * язык страницы;
   * допустимость учетной записи;
   * организация, к которой принадлежит пользователь;
   * параметры управления паролем пользователя;
   * наличие лицензии на использование функции.


Прочитайте описанные ниже шаги, чтобы узнать о логике страницы сброса пароля.

1. Пользователь открывает ссылку "Не удается получить доступ к своей учетной записи" или переходит непосредственно по адресу [https://passwordreset.microsoftonline.com](https://passwordreset.microsoftonline.com).
2. Язык интерфейса функции сброса паролей зависит от языка браузера. Эта функция переведена на все языки, поддерживаемые Office 365.
3. Пользователь вводит идентификатор пользователя и проходит тест CAPTCHA.
4. Azure AD проверяет, имеется ли у пользователя возможность использовать эту функцию, путем следующих действий:
   * Проверяет, включена ли данная функция у пользователя и назначена ли ему лицензия Azure AD.
     * Если у пользователя эта функция не включена или ему не назначена лицензия, то для сброса пароля ему предлагается обратиться к администратору.
   * Проверяет наличие у пользователя нужных проверочных данных, определенных в его учетной записи в соответствии с политикой администратора.
     * Если политика требует только один запрос, то проверяется, определены ли у пользователя соответствующие данные по крайней мере для одной из проверок, включенных политикой администратора.
       * Если учетная запись не настроена, то для сброса пароля пользователю предлагается обратиться к администратору.
     * Если политика требует два запроса, выполняется проверка наличия у пользователя соответствующих данных, определенных по крайней мере для двух проверок, включенных политикой администратора.
       * Если учетная запись не настроена, то для сброса пароля пользователю предлагается обратиться к администратору.
   * Проверяет, управляется ли пароль пользователя локально (является ли он федеративным или для него включена синхронизация хэшей паролей).
     * Если развернута обратная запись, а управление паролем пользователя осуществляется локально, то пользователю разрешается продолжить проверку подлинности и сбросить свой пароль.
     * Если обратная запись не развернута, а управление паролем пользователя осуществляется локально, то пользователю предлагается обратиться к администратору для сброса своего пароля.
5. Если выяснилось, что пользователь может сбросить свой пароль, ему выдаются указания по ходу процесса сброса.

## <a name="authentication-methods"></a>Методы проверки подлинности

Если функция самостоятельного сброса пароля включена, необходимо выбрать один из приведенных ниже методов проверки подлинности. Мы настоятельно советуем выбрать по крайней мере два метода проверки подлинности.

* Email
* Мобильный телефон
* Рабочий телефон
* Секретные вопросы

### <a name="what-fields-are-used-in-the-directory-for-authentication-data"></a>Поля, используемые в каталоге для данных проверки подлинности

* В поле "Рабочий телефон" необходимо ввести рабочий телефон.
    * Пользователь не может самостоятельно задать значение этого поля. Это должен сделать администратор.
* В поле "Мобильный телефон" необходимо ввести телефон для проверки подлинности (невидимый для пользователей) или мобильный телефон (видимый для пользователей).
    * Служба сначала ищет телефон для проверки подлинности, а если он отсутствует — мобильный телефон.
* В поле "Запасной адрес электронной почты" необходимо ввести адрес электронной почты для проверки подлинности (невидимый для пользователей) или альтернативный электронный адрес.
    * Служба сначала ищет адрес электронной почты для проверки подлинности, а если он отсутствует — альтернативный электронный адрес.

По умолчанию с облачным каталогом синхронизируются только облачные атрибуты "Рабочий телефон" и "Мобильный телефон" из локального каталога данных проверки подлинности.

Пользователи смогут сбросить пароль, только если у них есть необходимые данные для методов проверки подлинности, которые включил администратор.

Если пользователь не хочет, чтобы его номер мобильного телефона отображался в каталоге, но по-прежнему хочет использовать этот метод проверки подлинности, администратор не должен заполнять соответствующее поле в каталоге. Затем пользователь сможет заполнить атрибут **Телефон для проверки подлинности** на [портале регистрации сброса паролей](http://aka.ms/ssprsetup). Администраторы смогут просматривать эту информацию в профиле пользователя, но она не будет публиковаться в другом месте. Если при регистрации учетной записи администратора Azure пользователь указал номер телефона для проверки подлинности, этот номер автоматически добавляется в поле "Мобильный телефон", и его видят другие пользователи.

### <a name="number-of-authentication-methods-required"></a>Необходимое количество методов проверки подлинности

Этот параметр определяет минимальное количество методов проверки подлинности, необходимых пользователю, чтобы сбросить или разблокировать пароль. Пользователь может выбрать 1 или 2 метода.

Кроме того, пользователь может указать дополнительные методы проверки подлинности, если они включены администратором.

Если количество методов проверки подлинности не соответствует минимально установленному значению, отобразится страница ошибки со ссылкой, по которой можно отправить запрос администратору на сброс пароля.

### <a name="how-secure-are-my-security-questions"></a>Уровень безопасности контрольных вопросов

При использовании контрольных вопросов мы советуем усилить безопасность дополнительным методом проверки подлинности, так как в этом случае есть опасение, что другие пользователи могут знать ответы на предложенные вопросы.

> [!NOTE] 
> Контрольные вопросы надежно хранятся в объекте пользователя в каталоге. Ответы на них пользователь может задать только в процессе регистрации. Администратор не может прочитать или изменить вопросы или ответы пользователей.
>

### <a name="security-question-localization"></a>Локализация контрольных вопросов

Все стандартные вопросы переведены на языки, поддерживаемые Office 365. Язык вопросов зависит от языка браузера пользователя.

* В каком городе вы познакомились с первой супругой или первым супругом?
* В каком городе познакомились ваши родители?
* В каком городе живет ваш ближайший родственник?
* В каком городе родился ваш отец?
* В каком городе была ваша первая работа?
* В каком городе родилась ваша мать?
* В каком городе вы провели Новый год в 2000 году?
* Какая фамилия у вашего любимого учителя в старшей школе?
* Как называлось учебное заведение, в которое вы поступили, но не стали учиться?
* В каком месте была ваша первая свадебная церемония?
* Какое отчество у вашего отца?
* Какое ваше любимое блюдо?
* Какие имя и фамилия у вашей бабушки по материнской линии?
* Какое отчество у вашей матери?
* Какой месяц и год рождения вашего старшего брата или сестры? (Например, ноябрь 1985 г.)
* Какое отчество у вашего самого старого родственника?
* Какие имя и фамилия у вашего дедушки по отцовской линии?
* Какое отчество у вашего самого младшего родственника?
* Какую школу вы посещали в шестом классе?
* Какие имя и фамилия у вашего лучшего друга детства?
* Какие имя и фамилия у вашей первой любви?
* Какая фамилия у вашего любимого учителя в начальной школе?
* Какая марка и модель вашей первой машины или мотоцикла?
* Как называлась первая школа, в которую вы ходили?
* Как называлось медицинское учреждение, в котором вы родились?
* Как называлась первая улица, где вы жили в детстве?
* Как звали героя вашего детства?
* Как звали вашу любимую плюшевую игрушку?
* Как звали вашего первого питомца?
* Какое прозвище было у вас в детстве?
* Какой вид спорта вы любили в старших классах?
* Какова ваша первая работа?
* Какие последние 4 цифры вашего номера телефона в детстве?
* Кем вы хотели стать в детстве?
* Какую самую известную личность вы встречали?

### <a name="custom-security-questions"></a>Пользовательские контрольные вопросы

Пользовательские контрольные вопросы не переведены на другие языки. Все пользовательские вопросы отображаются на том языке, на котором вы ввели их в интерфейсе пользователя с правами администратора, даже если язык браузера отличается. Если требуются переведенные вопросы, используйте стандартные вопросы.

Максимальная длина пользовательского контрольного вопроса составляет 200 символов.

### <a name="security-question-requirements"></a>Требования к контрольному вопросу

* Минимальное количество знаков в ответе — 3.
* Максимальное количество знаков в ответе — 40.
* Пользователи не могут отвечать на один и тот же вопрос несколько раз.
* Пользователи не могут давать один и тот же ответ на несколько вопросов.
* Для определения вопросов и ответов можно использовать любой набор символов, в том числе символы Юникода.
* Количество определенных вопросов должно быть не меньше числа вопросов, необходимых для регистрации.

## <a name="registration"></a>Регистрация

### <a name="require-users-to-register-when-signing-in"></a>"Требовать регистрацию пользователей при входе"

Если включить этот параметр, пользователь с возможностью сброса пароля должен завершить регистрацию, если он входит в приложения, использующие Azure AD для входа. К таким приложениям относятся:

* Office 365
* Портал Azure
* Панель доступа
* федеративные приложения;
* пользовательские приложения, использующие Azure AD.

Если отключить эту функцию, пользователь по-прежнему сможет зарегистрировать свои контактные данные вручную, посетив страницу [http://aka.ms/ssprsetup](http://aka.ms/ssprsetup) или щелкнув ссылку **Регистрация для сброса пароля** на вкладке "Профиль" панели доступа.

> [!NOTE]
> Пользователи могут закрыть портал регистрации сброса паролей, нажав кнопку "Отмена" или закрыв окно, но при каждом входе будет появляться запрос вплоть до завершения регистрации.
>

### <a name="number-of-days-before-users-are-asked-to-reconfirm-their-authentication-information"></a>"Количество дней, по истечении которых пользователям будет предложено повторно подтвердить данные проверки подлинности"

Этот параметр определяет период времени между указанием и повторным подтверждением данных проверки подлинности. Он доступен, только если включен параметр **Требовать регистрацию пользователей при входе**.

Допустимые значения: 0–730 дней. Значение 0 означает, что запрос на повторное подтверждение данных проверки подлинности не появляется.

## <a name="notifications"></a>Уведомления

### <a name="notify-users-on-password-resets"></a>"Уведомлять пользователей о сбросе пароля"

Если для этого параметра задать значение "Да", пользователь, сбрасывающий пароль, получит письмо, в котором указано, что его пароль изменили на портале SSPR. Это письмо приходит на основной и запасной адрес электронной почты, указанный в Azure AD. Больше это уведомление никому не отправляется.

### <a name="notify-all-admins-when-other-admins-reset-their-passwords"></a>"Уведомлять всех администраторов, если другие администраторы сбрасывают свои пароли"

Если для этого параметра задать значение "Да", на основной и запасной адрес электронной почты, указанный в Azure AD, **всех администраторов** будет отправлено письмо, указывающее, что другой администратор изменил их пароль на портале SSPR.

Пример. В среде есть 4 администратора. Администратор А сбрасывает их пароли с помощью SSPR. Администраторы Б, В и Г получат письмо с уведомлением об этом событии.

## <a name="on-premises-integration"></a>Интеграция с локальной средой

Установив, настроив и включив Azure AD Connect, вы получите дополнительные параметры интеграции с локальной средой.

### <a name="write-back-passwords-to-your-on-premises-directory"></a>"Включить обратную запись паролей в локальный каталог"

Определяет, включена ли обратная запись паролей для каталога и, если включена, указывает состояние локальной службы обратной записи. Этот параметр удобен, если требуется временно отключить компонент обратной записи паролей без повторной настройки Azure AD Connect.

* Если задано значение "Да", то обратная запись будет включена и федеративные пользователи и пользователи с синхронизацией хэшей паролей смогут сбрасывать свои пароли.
* Если задано значение "Нет", обратная запись будет выключена и федеративные пользователи и пользователи с синхронизацией хэшей паролей не смогут сбрасывать свои пароли.

### <a name="allow-users-to-unlock-accounts-without-resetting-their-password"></a>Разрешить пользователям разблокировать учетные записи без сброса пароля

Указывает, следует ли предоставить пользователям, посещающим портал сброса паролей, возможность разблокировать свои локальные учетные записи Active Directory без сброса пароля. По умолчанию Azure AD снимает блокировку учетных записей при выполнении сброса пароля. Данный параметр позволяет разделить эти две операции. 

* Если выбрано значение "Да", пользователи смогут выполнить сброс пароля и разблокировать учетную запись или разблокировать учетную запись без сброса пароля.
* Если значение — "Нет", пользователи смогут выполнить разблокировку учетной записи только после сброса пароля.

## <a name="network-requirements"></a>Требования к сети

### <a name="firewall-rules"></a>Правила файрволла

[URL-адреса и диапазоны IP-адресов Office 365](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2)

Для Azure AD Connect 1.1.443.0 и более поздних версий вы должны обеспечить исходящий HTTPS-доступ к следующим сайтам:
* passwordreset.microsoftonline.com
* servicebus.windows.net.

Чтобы обеспечить более детальный доступ, см. обновленный список диапазонов IP-адресов центра обработки данных Microsoft Azure [здесь](https://www.microsoft.com/download/details.aspx?id=41653). Этот список обновляется каждую среду, а изменения вступают в силу в следующий понедельник.

### <a name="idle-connection-timeouts"></a>Время ожидания простоя подключения

Чтобы проверять состояние подключений, средство Azure AD Connect отправляет периодические запросы проверки связи и активности конечным точкам служебной шины. Если средство обнаруживает, что слишком много подключений обрываются, оно автоматически увеличивает частоту запросов проверки связи к конечной точке. Самый минимальный интервал проверки связи, при котором подключение прерывается, составляет 1 раз в 60 секунд, но мы настоятельно советуем, чтобы прокси-серверы или брандмауэры позволяли сохранять неактивные подключения в течение по крайней мере 2–3 минут. * Для предыдущих версий мы советуем интервал в 4 минуты или больше.

## <a name="active-directory-permissions"></a>Разрешения Active Directory

Учетная запись, указанная в служебной программе Azure AD Connect, должна иметь разрешения на сброс и изменение пароля, разрешения на запись в lockoutTime и pwdLastSet, а также расширенные права в корневом объекте **каждого домена** **или** в подразделениях пользователей, которые должны находиться в области SSPR.

Если вы не уверены, к какой учетной записи оно относится, откройте интерфейс настройки Azure Active Directory Connect и щелкните "Просмотр текущей конфигурации". Учетная запись, для которой необходимо добавить разрешение, указана в разделе "Синхронизированные каталоги".

Установка этих разрешений позволит учетной записи службы MA для каждого леса управлять паролями от имени учетных записей пользователей в этом лесу. **Если не назначить эти разрешения, то даже при внешне правильной настройке обратной записи паролей пользователи столкнутся с ошибками при попытке управления своими локальными паролями из облака.**

> [!NOTE]
> Репликация этих разрешений по всем объектам вашего каталога может занять один или несколько часов.
>

Чтобы задать соответствующие разрешения для компонента обратной записи паролей, сделайте следующее:

1. Откройте оснастку "Пользователи и компьютеры Active Directory" с учетной записью, обладающей разрешениями на администрирование соответствующего домена.
2. В меню "Вид" включите параметр "Расширенные возможности".
3. На панели слева щелкните правой кнопкой мыши объект, который представляет корень домена, и выберите свойства.
    * Перейдите на вкладку "Безопасность".
    * Затем нажмите "Дополнительно".
4. На вкладке "Разрешения" нажмите кнопку "Добавить".
5. Выберите учетную запись, к которой необходимо применить разрешения (из настроек Azure AD Connect).
6. В раскрывающемся списке "Применяется к" выберите Descendent User objects (Дочерние пользовательские объекты).
7. В разделе разрешений установите флажки для следующих разрешений:
    * отмена истечения срока пароля;
    * Сброс пароля
    * изменение пароля;
    * запись lockoutTime;
    * запись pwdLastSet.
8. Щелкните "Применить" и "ОК", чтобы применить изменения, а затем закройте все открытые диалоговые окна.

## <a name="how-does-password-reset-work-for-b2b-users"></a>Как работает сброс пароля для пользователей B2B
Сброс и изменение пароля полностью поддерживается во всех конфигурациях B2B.  Ниже приведены 3 конфигурации B2B, поддерживаемые системой сброса пароля.

1. **Пользователи из партнерской организации с клиентом Azure AD.** Если организация, с которой вы вступили в партнерские отношения, имеет клиент Azure AD, мы **учитываем политики сброса пароля, включенные в этом клиенте**. Для работы сброса пароля партнерская организация должна включить Azure AD SSPR. Дополнительная плата для клиентов Office 365 не требуется. Указания по включению см. в статье [Приступая к работе с компонентами управления паролями](https://azure.microsoft.com/documentation/articles/active-directory-passwords-getting-started/#enable-users-to-reset-or-change-their-aad-passwords).
2. **Пользователи, зарегистрировавшиеся с помощью функции [самостоятельной регистрации](active-directory-self-service-signup.md)**. Если организация, с которой вы вступили в партнерские отношения, использует функцию [самостоятельной регистрации](active-directory-self-service-signup.md) для входа в клиент, мы позволим ее пользователям сбросить пароль, указав зарегистрированный адрес электронной почты.
3. **Пользователи B2B.** Все новые пользователи B2B, созданные с помощью [возможностей Azure AD B2B](active-directory-b2b-what-is-azure-ad-b2b.md), также смогут сбросить пароль, указав адрес электронной почты, зарегистрированный в процессе приглашения.

Чтобы протестировать один из следующих сценариев, перейдите на сайт http://passwordreset.microsoftonline.com. Если они определили дополнительный адрес электронной почты или адрес электронной почты для проверки подлинности, сброс паролей будет работать должным образом.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о сбросе пароля с помощью Azure AD см. в следующих источниках:

* [**Быстрое начало работы с самостоятельным сбросом пароля в Azure AD**](active-directory-passwords-getting-started.md). Запуск и выполнение службы самостоятельного управления паролями Azure AD. 
* [**Licensing requirements for Azure AD self-service password reset**](active-directory-passwords-licensing.md) (Требования к лицензированию самостоятельного сброса пароля в Azure AD). Сведения о настройке лицензирования Azure AD.
* [**Deploy password reset without requiring end-user registration**](active-directory-passwords-data.md) (Развертывание сброса пароля без регистрации пользователя). Сведения о необходимых данных и их использовании для управления паролями.
* [**Развертывание функции сброса паролей для пользователей**](active-directory-passwords-best-practices.md). Рекомендации по планированию и развертыванию SSPR для пользователей.
* [**Политики и ограничения для паролей в Azure Active Directory**](active-directory-passwords-policy.md). Общие сведения и информация об установке политик паролей Azure AD.
* [**Обзор компонента обратной записи паролей**](active-directory-passwords-writeback.md). Как работает функция обратной записи паролей с вашим локальным каталогом.
* [**Настройка компонентов управления паролями в соответствии с требованиями организации**](active-directory-passwords-customize.md). Сведения о настройке интерфейса и параметров использования SSPR для организации.
* [**Параметры отчетов для управления паролями Azure AD**](active-directory-passwords-reporting.md). Определяйте, кто и когда использовал функцию SSPR.
* [**Вопросы и ответы об управлении паролями**](active-directory-passwords-faq.md). Как? Почему? Что? Где? Кто? Когда? Здесь приведены ответы на интересующие вас вопросы.
* [**Устранение неполадок, связанных с управлением паролями**](active-directory-passwords-troubleshoot.md). Сведения об устранении распространенных проблем с SSPR.

