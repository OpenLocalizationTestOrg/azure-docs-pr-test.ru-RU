---
title: "Настройка входа в auto ускорение для приложения с помощью политики обнаружения домашней области | Документы Microsoft"
description: "Объясняется, какие клиент Azure AD и как управлять Azure через Azure Active Directory."
services: active-directory
documentationcenter: 
author: billmath
manager: mtillman
ms.service: active-directory
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: it-pro
ms.date: 11/09/2017
ms.author: billmath
ms.openlocfilehash: e2e6e5c40dc4a9f67f94c45f8394512db3f777f5
ms.sourcegitcommit: e266df9f97d04acfc4a843770fadfd8edf4fa2b7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2017
---
# <a name="configure-sign-in-auto-acceleration-for-an-application-by-using-a-home-realm-discovery-policy"></a>Настройка входа автоматически ускорением для приложения с помощью политики обнаружения домашней области

В следующем документе содержится введение обнаружения домашней области и ускорения автоматически.

## <a name="home-realm-discovery"></a>Обнаружение домашней области
Обнаружение домашней области (HRD) — это процесс, который позволяет Azure Active Directory (Azure AD), чтобы определить, во время входа в которой требуется проверить подлинность пользователя.  Когда пользователь входит клиент Azure AD, доступ к ресурсу или Azure AD общие страницы входа, они введите имя пользователя (UPN). Azure AD, использует для обнаружения, где пользователь должен выполнить вход. 

Пользователь может потребоваться принимать одно из следующих расположений для проверки подлинности:

- Клиент домашнего пользователя (может быть как ресурс, к которому пользователь пытается получить доступ к того же клиента). 

- Учетную запись Майкрософт.  Пользователь является гостевой в клиенте ресурсов.

- Другой поставщик удостоверений, который входит в федерацию с клиентом Azure AD.

-  Поставщик удостоверений в локальной среде например службы федерации Active Directory (AD FS).

## <a name="auto-acceleration"></a>Автоматическое ускорение 
В некоторых организациях настройте свой клиент Azure Active Directory в федерацию с другого поставщика удостоверений, например службы федерации Active Directory для проверки подлинности пользователя.  

В этих случаях когда пользователь входит в приложение, они сначала сначала выводится страница входа в Azure AD. После их ввода имени UPN, затем он перенаправляется на страницу входа поставщика удостоверений. При определенных обстоятельствах администраторов может возникнуть необходимость направлять пользователей на странице входа, когда пытаетесь войти в определенных приложениях. 

Это означает, что пользователь может пропустить начальную страницу Azure Active Directory. Этот процесс называется «вход автоматически ускорением.»

В случаях, где клиента осуществляется федерализация в другой поставщик удостоверений для входа в систему ускорение автоматически делает пользователя войти более упрощен.  Автоматическое ускорение входа можно настроить для отдельных приложений.

>[!NOTE]
>При настройке приложения для ускорения автоматически гостей вход невозможен. Если пользователь принимает сразу к федеративных удостоверений для проверки подлинности, нет возможности для их, чтобы вернуться на страницу входа в Azure Active Directory. Гостевых пользователей, которые может потребоваться направлять на других клиентов или внешнего поставщика удостоверений, например учетной записи Майкрософт, не сможет войти это приложение, так как они пропуска шага обнаружения домашней области.  

Существует два способа управления автоматически ускорение федеративных удостоверений:   

- Используйте указание домена на запросы проверки подлинности для приложения. 
- Настройка политики обнаружения домашней области, чтобы активировать ускорение автоматически.

## <a name="domain-hints"></a>Указания домена 
Домен ссылки являются директивы, которые включены в запрос на проверку подлинности в приложении. Они могут использоваться для ускорения для их федеративных удостоверений на странице входа пользователя. Или они могут использоваться многопользовательского приложения для ускорения выполнения пользователь непосредственно к типизированной Azure AD на странице входа для своего клиента.  

Например приложения «largeapp.com» может разрешить пользователям доступ к приложению на настраиваемый URL-адрес «contoso.largeapp.com». Приложение также может включать указание домена contoso.com в запрос на проверку подлинности. 

Синтаксис для указания домена зависит от протокола, который используется, и обычно настраивается в приложении.

**WS-Federation**: whr=contoso.com в строке запроса.

**SAML**: либо SAML проверки подлинности запросов, содержащих указание домена или whr=contoso.com строку запроса.

**Откройте подключение идентификатор**: domain_hint=contoso.com строка запроса. 

Если указание домена включается в запрос на проверку подлинности из приложения, а клиент входит в федерацию с этим доменом, Azure AD предпринимается попытка перенаправить входа поставщика удостоверений, настроенного для этого домена. 

Если указание домена не ссылаются на проверенных федеративный домен, он учитывается, и вызывается обычного обнаружения домашней области.

Дополнительные сведения об автоматической ускорение, с помощью указания домена, которые поддерживаются в Azure Active Directory см. в разделе [Enterprise Mobility + безопасности](https://cloudblogs.microsoft.com/enterprisemobility/2015/02/11/using-azure-ad-to-land-users-on-their-custom-login-page-from-within-your-app/).

>[!NOTE]
>Если указание домена включается в запрос проверки подлинности, его наличие переопределяет любую политику обнаружения домашней области, настроенного для приложения.

## <a name="home-realm-discovery-policy"></a>Home Realm Discovery политики
Некоторые приложения не предоставляют способ настроить запрос на проверку подлинности, которые они выдают. В таких случаях не можно использовать для указания домена для ускорения автоматического управления. Автоматическое ускорение можно настроить с помощью политики, чтобы добиться нужного поведения.  

### <a name="set-hrd-policy"></a>Задать политику обнаружения домашней области
Существует три этапа вход автоматически ускорением в приложении.


1. Создание политики обнаружения домашней области для ускорения автоматически.

2. Поиск участника службы, к которому присоединяется политики.

3. Применение политики к субъекту-службы. Политики мог быть создан в клиенте, но они не имеют никакого действия, пока они привязаны к сущности. 

Политику обнаружения домашней области могут присоединяться к участника службы, и только одна политика обнаружения домашней области могут быть активными в заданной сущности в любой момент времени.  

Microsoft Azure AD Graph API напрямую или Azure Active Directory PowerShell командлеты можно использовать для настройки автоматического ускорение с помощью политики обнаружения домашней области.

Graph API, который управляет политики описан в [операции над политики](https://msdn.microsoft.com/library/azure/ad/graph/api/policy-operations) статье на MSDN.

Ниже приведен пример определения политики обнаружения домашней области:
    
 ```
   {  
    "HomeRealmDiscoveryPolicy":
    {  
    "AccelerateToFederatedDomain":true,
    "PreferredDomain":"federated.example.edu"
    }
   }
```

Тип политики — «HomeRealmDiscoveryPolicy.»

Если **AccelerateToFederatedDomain** имеет значение false, политика не оказывает влияния.

**PreferredDomain** следует указать домен, к которому для ускорения выполнения. Можно опустить, если клиент имеет только один федеративный домен.  Если он опущен и имеется более одного проверенную федеративный домен, политика не оказывает влияния.

Если **PreferredDomain** указан, он должен соответствовать проверенному федеративного домена для клиента. Все пользователи приложения должны иметь возможность выполнить вход для этого домена.

### <a name="priority-and-evaluation-of-hrd-policies"></a>Приоритетность и оценка политик HRD
Вы можете создать политики HRD, а затем назначить их отдельным организациям и субъектам-службам. Это означает, что к определенному приложению может применяться сразу несколько политик. Политика HRD оказывает влияние согласно следующим правилам:


- Если указание домена присутствует в запросе проверки подлинности, любая политика, обнаружение домашней области учитывается. Это поведение, определенным указанием домена используется.

- В противном случае, если политика явно назначена субъекту-службе, применяется именно она. 

- Если отсутствует указание не домен и политика не задается явное имя участника службы, применяется политика, явно назначенные родительской организации субъектом-службой. 

- Если отсутствует указание домена и нет политики, назначенной субъекту-службе или организации, используется стандартное поведение HRD.

## <a name="tutorial-for-setting-sign-in-auto-acceleration-on-an-application-by-using-an-hrd-policy"></a>Учебник по заданию вход автоматически ускорением в приложении с помощью политики обнаружения домашней области
Мы будем использовать командлеты Azure AD PowerShell, чтобы пройти через несколько сценариев, включая:


- Настройка автоматического ускорением для приложения для клиента с одним федеративным доменом.

- Настройка автоматического ускорением для приложения к одному из нескольких доменов, которые проверяются для вашего клиента.

- Список приложений, для которых настроен политики.

### <a name="prerequisites"></a>Технические условия
В следующих примерах создания, обновления, связи и удаления политик для участников службы приложения в Azure AD.

1.  Для начала Загрузите последнюю предварительную версию командлетов Azure AD PowerShell. 

2.  После загрузки командлеты Azure AD PowerShell, выполните команду Connect, чтобы войти в Azure AD с учетной записью администратора:

    ``` powershell
    Connect-AzureAD -Confirm
    ```
3.  Выполните следующую команду, чтобы увидеть все политики в вашей организации:

    ``` powershell
    Get-AzureADPolicy
    ```

Если ничего не возвращается, это означает, что у вас нет политик, созданных в клиенте.

### <a name="example-set-auto-acceleration-for-an-application"></a>Пример: Set auto ускорение для приложения 
В этом примере создается политика, который автоматически ускоряет пользователей экран входа в службы федерации Active Directory при их входе в приложение. Пользователи могут входить службы федерации Active Directory без необходимости вводить имя пользователя на страницу входа в Azure AD. 

#### <a name="step-1-create-an-hrd-policy"></a>Шаг 1. Создание политики обнаружения домашней области
``` powershell
New-AzureADPoly -Definition @("{`"HomeRealmDiscoveryPolicy`":{`"AccelerateToFederatedDomain`":true}}") -DisplayName BasicAutoAccelerationPolicy -Type HomeRealmDiscoveryPolicy
```

При наличии одного федеративного домена, выполняющий проверку подлинности пользователей для приложений, необходимо создать только одну политику обнаружения домашней области.  

Чтобы посмотреть новой политики и получить его **ObjectID**, выполните следующую команду:

``` powershell
Get-AzureADPolicy
```


Чтобы включить ускорение автоматически после того как вы политику обнаружения домашней области, можно назначить несколько принципов службы приложения.

#### <a name="step-2-locate-the-service-principal-to-which-to-assign-the-policy"></a>Шаг 2: Найдите участника службы, в которую назначение политики  
Требуется **ObjectID** участников службы, к которым вы хотите назначить политику. Существует несколько способов поиска **ObjectID** субъектов-служб.    

Можно использовать портал, или можно запросить [Microsoft Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity). Можно также перейти к [средства Graph Explorer](https://graphexplorer.cloudapp.net/) и войдите в свою учетную запись Azure AD для просмотра субъектов-служб вашей организации. Поскольку вы используете PowerShell, можно использовать командлет get-AzureADServicePrincipal список принципов службы и их идентификаторы.

#### <a name="step-3-assign-the-policy-to-your-service-principal"></a>Шаг 3. Назначение политики для субъекта-службы  
После того как вы **ObjectID** субъекта-службы приложения, для которого требуется настроить автоматическое ускорение, выполните следующую команду. Эта команда связывает политику обнаружения домашней области, созданный на шаге 1, имя участника службы, определенные на шаге 2.

``` powershell
Add-AzureADServicePrincipalPolicy -Id <ObjectID of the Service Principal> -RefObjectId <ObjectId of the Policy>
```

Эту команду можно повторить для каждого участника службы, к которому требуется добавить политику.

#### <a name="step-4-check-which-application-service-principals-your-auto-acceleration-policy-is-assigned-to"></a>Шаг 4. Проверка субъектов-служб приложения, которым назначена политика автоматического ускорения входа
Чтобы проверить, какие приложения настроена политика автоматического ускорение, используйте **Get AzureADPolicyAppliedObject** командлета. Передайте его **ObjectID** политики, которую требуется проверить.

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```
#### <a name="step-5-youre-done"></a>Шаг 5. Готово!
Испытайте приложение, чтобы проверить новую политику в действии.

### <a name="example-list-the-applications-for-which-an-auto-acceleration-policy-is-configured"></a>Пример: Список приложений, для которых настроен политику автоматического ускорение

#### <a name="step-1-list-all-policies-that-were-created-in-your-organization"></a>Шаг 1: Список всех политик, которые были созданы в вашей организации 

``` powershell
Get-AzureADPolicy
```

Примечание **ObjectID** , которую требуется список назначений для политики.

#### <a name="step-2-list-the-service-principals-to-which-the-policy-is-assigned"></a>Шаг 2: Список субъектов-служб, которым назначена политика  

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```

### <a name="example-remove-an-auto-acceleration-policy-for-an-application"></a>Пример: Удалите политику автоматического ускорение для приложения
#### <a name="step-1-get-the-objectid"></a>Шаг 1: Получение ObjectID
Использовать предыдущий пример для получения **ObjectID** политики и, с которого вы хотите удалить его основного приложения службы. 

#### <a name="step-2-remove-the-policy-assignment-from-the-application-service-principal"></a>Шаг 2: Удаление назначения политики из субъекта-службы приложения  

``` powershell
Remove-AzureADApplicationPolicy -ObjectId <ObjectId of the Service Principal>  -PolicyId <ObjectId of the policy>
```

#### <a name="step-3-check-removal-by-listing-the-service-principals-to-which-the-policy-is-assigned"></a>Шаг 3: Проверка удаления путем перечисления участников службы, которым назначена политика 

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```
## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о том, как работает проверка подлинности в Azure AD см. в разделе [сценарии проверки подлинности в Azure AD](develop/active-directory-authentication-scenarios.md).
- Дополнительные сведения о пользователя единого входа см. в разделе [доступ к приложению и единый вход в Azure Active Directory](active-directory-enterprise-apps-manage-sso.md).
- Сведения для разработчиков см. в [руководстве разработчика по Active Directory](develop/active-directory-developers-guide.md).
