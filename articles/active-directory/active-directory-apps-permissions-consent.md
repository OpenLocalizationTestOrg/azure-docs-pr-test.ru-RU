---
title: "Приложения, разрешения и согласие в Azure Active Directory | Документация Майкрософт"
description: "Azure AD Connect интегрирует локальные каталоги с Azure Active Directory. Таким образом вы сможете предоставить пользователям возможность получать доступ с использованием одного удостоверения для Office 365, Azure и SaaS, интегрированных с Azure AD."
keywords: "введение в Azure AD, приложения, что такое Azure AD Connect, установка Аctive Directory"
services: active-directory
documentationcenter: 
author: billmath
manager: mtillman
editor: 
ms.assetid: 25897cc4-7687-49b6-b0d5-71f51302b6b1
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/03/2018
ms.author: billmath
ms.reviewer: jesakowi
ms.custom: oldportal;it-pro;
ms.openlocfilehash: d3e14c18d5e4cd77f4c68d8a5d9d0b915e896695
ms.sourcegitcommit: 3cdc82a5561abe564c318bd12986df63fc980a5a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/05/2018
---
# <a name="apps-permissions-and-consent-in-azure-active-directory"></a>Приложения, разрешения и согласие в Azure Active Directory
В Azure Active Directory можно добавлять приложения в каталог.  Приложения разделяются по типам задач.  Чтобы просмотреть приложения на портале, выберите каталог и приложения.

> [!IMPORTANT]
> Для управления службой Azure AD мы рекомендуем использовать [Центр администрирования Azure AD](https://aad.portal.azure.com) на портале Azure, а не портал Azure, который упоминается в этой статье.

## <a name="types-of-apps"></a>Типы приложений

1. **Приложения с одним клиентом** </br>
    - **Приложения с одним клиентом** часто называются бизнес-приложениями. В этом случае сотрудник вашей организации разрабатывает свои приложения и хотел бы предоставить корпоративным пользователям возможность входа в это приложение.
    ![](media/active-directory-apps-permissions-consent/apps2.png)
    - **Приложения прокси-сервера приложений.** После размещения локального приложения на прокси-сервере приложений Azure AD в вашем клиенте регистрируется приложение с одним клиентом (помимо службы прокси-сервера приложений). Это приложение представляет ваше локальное приложение для всех взаимодействий в облаке (например, для проверки подлинности). Прокси-сервер приложений требует Azure AD Basic или более поздних выпусков.


2. **Мультитенантные приложения**
    - **Мультитенантные приложения, на использование которых можно дать согласие,** похожи на приложения с одним клиентом, разрабатываемые в организации. Основное различие (помимо логики приложения) заключается в том, что пользователи из других клиентов также могут дать согласие на их использование и войти в них.</br>
    ![](media/active-directory-apps-permissions-consent/apps4.png)
    - **Мультитенантные приложения других разработчиков, на использование которых может дать согласие Contoso.** Для краткости их можно назвать приложениями с обеспечением согласия. Эти приложения по сути противоположны мультитенантным приложениям, разрабатываемым в организации. Если другая организация разрабатывает мультитенантное приложение, пользователи вашей организации могут предоставить согласие на его использование и войти в него.
    - **Приложения Майкрософт, получающие данные напрямую из источника** — это приложения, которые представляют службы Майкрософт. Согласие определяется тем, что вам необходимо пройти регистрацию для использования службы. Иногда в определенных приложениях, получающих данные напрямую из источника, реализованы специальный интерфейс и логика, которые часто используются при создании политики доступа к приложению.</br>
    ![](media/active-directory-apps-permissions-consent/apps3.png)
    - **Предварительно интегрированные приложения** — это приложения в коллекции приложений Azure AD, которые можно добавить в каталог для предоставления возможности единого входа (и в некоторых случаях подготовки) в популярных приложениях SaaS.
    - **Единый вход Azure AD** — "настоящий" единый вход для приложений, которые могут интегрироваться с Azure AD, по поддерживаемому протоколу входа, например SAML 2.0 или OpenID Connect. Мастер поможет настроить его.
    - **Единый вход с использованием пароля.** Azure AD безопасно хранит учетные данные пользователя для приложения, а расширение браузера для доступа к приложениям Azure AD позволяет вставить их в форму единого входа. Этот метод также известен как хранение пароля.

## <a name="permissions"></a>Разрешения

При регистрации приложения пользователь (разработчик) определяет разрешения и ресурсы, к которым приложению нужен доступ. В качестве ресурсов выступают другие приложения. Например, разработчик приложения для чтения почты может заявить, что его приложению требуется разрешение на доступ к почтовым ящикам для пользователя, выполнившего вход, в ресурсе Office 365 Exchange Online:
    
![](media/active-directory-apps-permissions-consent/apps6.png)

Чтобы одно приложение (клиент) могло запросить определенные разрешения у другого приложения (ресурс), разработчик приложения-ресурса определяет существующие разрешения. В нашем примере корпорация Майкрософт, владелец приложения-ресурса Office 365 Exchange Online, определила разрешение с именем "Доступ к почтовым ящикам для пользователя, выполнившего вход".

При определении разрешений разработчику приложений необходимо указать, можно ли дать согласие на использование разрешения или же требуется согласие администратора. Таким образом разработчики могут разрешить пользователям самостоятельно давать согласие на использование приложений, запрашивающих разрешения низкого уровня. При этом согласие на использование приложений с разрешениями высокого уровня может дать только администратор. Например, в приложении-ресурсе Azure Active Directory определено, что пользователи могут дать согласие на использование приложений, запрашивающих ограниченные разрешения только для чтения.  Однако для всех разрешений на чтение и запись требуется согласие администратора.

Так как собственные клиенты не проходят проверку подлинности, приложение, определенное в качестве собственного клиентского приложения, может запрашивать только делегированные разрешения. Это означает, что при получении маркера всегда должен присутствовать реальный пользователь. При получении маркера доступа веб-приложения и веб-API (конфиденциальные клиенты) должны всегда проходить проверку подлинности с помощью Azure AD. То есть у них также есть возможность запрашивать разрешения только для приложения. Например, если одной серверной службе требуется пройти проверку подлинности в другой серверной службе. Для приложений, запрашивающих разрешения только для приложения, всегда требуется согласие администратора.

Выводы:



- Приложение (клиент) сообщает о разрешениях, необходимых для других приложений (ресурсы).
- Приложение (ресурс) сообщает, какие разрешения предоставляются другим приложениям (клиенты).
- Разрешение может быть разрешением только для приложения или делегированным разрешением.
- Делегированное разрешение может быть отмечено как "Разрешает согласие пользователя" или "Требует согласия администратора".
- Приложение может выступать в качестве клиента (объявляя о том, что ему нужны разрешения на ресурс), ресурса (объявляя о предоставляемых разрешениях) или выполнять обе роли.

## <a name="controls"></a>Управление

Ниже приведен список элементов управления администратора для всех указанных выше ситуаций.

На портале Azure — в разделе **Управление** и **Настройки пользователя**.

![](media/active-directory-apps-permissions-consent/apps11.png)



- Вы можете указать, могут ли пользователи дать согласие на использование приложений:

На портале Azure выберите **Users can allow apps to access their data** (Пользователи могут предоставлять приложениям разрешение на доступ к данным).
![](media/active-directory-apps-permissions-consent/apps12.png)



- Вы можете разрешить пользователям регистрировать собственные бизнес-приложения с одним клиентом:

На портале Azure выберите **Пользователи могут регистрировать приложения**.
![](media/active-directory-apps-permissions-consent/apps13.png)

>[!NOTE]
>Даже если разрешить пользователям регистрировать бизнес-приложения с одним клиентом, существуют определенные ограничения относительно того, что можно зарегистрировать.  
>Например, в отношении разработчиков, которые не являются администраторами каталогов.
>
>- Пользователи не могут превратить приложение с одним клиентом в мультитенантное приложение.
>- При регистрации бизнес-приложений с одним клиентом пользователи не могут запрашивать разрешения только для приложений для других приложений.
>- При регистрации бизнес-приложений с одним клиентом пользователи не могут запрашивать делегированные разрешения для других приложений, если эти разрешения требуют согласия администратора.
>- Пользователи не могут вносить изменения в приложения, которые им не принадлежат.


## <a name="example"></a>Пример

Например, рассмотрим приложение FabrikamMail для Office 365. Вы обнаружили, что пользователи в клиенте входят в него. FabrikamMail — это приложение для чтения почты для Android, опубликованное компанией Fabrikam, Inc. Оно попадает в группу "Мультитенантные приложения других разработчиков, на использование которых может дать согласие Contoso".

Если пользователям разрешено давать согласие, при первом входе для них отобразится запрос на согласие: ![](media/active-directory-apps-permissions-consent/apps14.png)

"Доступ к почтовым ящикам" — это строка согласия пользователя для разрешения "Доступ к почтовым ящикам для пользователя, выполнившего вход", предоставляемого приложением Office 365 Exchange Online (то есть Exchange).

Разрешения можно увидеть, посмотрев объект ServicePrincipal для Exchange (ресурс), добавленный при регистрации в Office 365. Объект ServicePrincipal можно рассматривать как экземпляр приложения в клиенте, используемый для записи различных параметров и конфигураций.  Его можно увидеть, используя `Get-AzureADServicePrincipal` в PowerShell.

    PS C:\> Get-AzureADServicePrincipal -ObjectId 383f7b97-6754-4d3d-9474-3908ebcba1c6 | fl *
    
    DeletionTimeStamp         : 
    ObjectId                  : 383f7b97-6754-4d3d-9474-3908ebcba1c6
    ObjectType                : ServicePrincipal
    AccountEnabled            : True
    AppDisplayName            : Office 365 Exchange Online
    AppId                     : 00000002-0000-0ff1-ce00-000000000000
    AppOwnerTenantId          : 
    AppRoleAssignmentRequired : False
    AppRoles                  : {...}
    DisplayName               : Microsoft.Exchange
    ErrorUrl                  : 
    Homepage                  : 
    KeyCredentials            : {}
    LogoutUrl                 : 
    Oauth2Permissions         : {...
                                , class OAuth2Permission {
                                  AdminConsentDescription : Allows the app to have the same access to mailboxes as the signed-in user via Exchange Web Services.
                                  AdminConsentDisplayName : Access mailboxes as the signed-in user via Exchange Web Services
                                  Id                      : 3b5f3d61-589b-4a3c-a359-5dd4b5ee5bd5
                                  IsEnabled               : True
                                  Type                    : User
                                  UserConsentDescription  : Allows the app full access to your mailboxes on your behalf.
                                  UserConsentDisplayName  : Access your mailboxes
                                  Value                   : full_access_as_user
                                },
                                ...}
    PasswordCredentials       : {}
    PublisherName             : 
    ReplyUrl                  : 
    SamlMetadataUrl           : 
    ServicePrincipalNames     : {00000002-0000-0ff1-ce00-000000000000/outlook.office365.com, 00000002-0000-0ff1-ce00-000000000000/mail.office365.com, 00000002-0000-0ff1-ce00-000000000000/outlook.com, 
                                00000002-0000-0ff1-ce00-000000000000/*.outlook.com...}
    Tags                      : {}

Согласие предоставляется, когда пользователь нажимает кнопку "Принять". Сначала в клиенте создается объект ServicePrincipal для приложения FabrikamMail для Office 365. ServicePrincipal выглядит следующим образом:

    PS C:\> Get-AzureADServicePrincipal -SearchString "FabrikamMail for Office 365" | fl *
    
    DeletionTimeStamp         : 
    ObjectId                  : a8b16333-851d-42e8-acd2-eac155849b37
    ObjectType                : ServicePrincipal
    AccountEnabled            : True
    AppDisplayName            : FabrikamMail for Office 365
    AppId                     : aba7c072-2267-4031-8960-e7a2db6e0590
    AppOwnerTenantId          : 4a4076e0-a70f-41c6-b819-6f9c4a86df89
    AppRoleAssignmentRequired : False
    AppRoles                  : {}
    DisplayName               : FabrikamMail for Office 365
    ErrorUrl                  : 
    Homepage                  : 
    KeyCredentials            : {}
    LogoutUrl                 : 
    Oauth2Permissions         : {}
    PasswordCredentials       : {}
    PublisherName             : Fabrikam, Inc.
    ReplyUrl                  : 
    SamlMetadataUrl           : 
    ServicePrincipalNames     : {aba7c072-2267-4031-8960-e7a2db6e0590}
    Tags                      : {WindowsAzureActiveDirectoryIntegratedApp}

При предоставлении согласия на использование приложения создается связь Oauth2PermissionGrant между следующими компонентами:
  
- объект пользователя;
- ServicePrincipalName (SPN) приложений-клиентов;
- ServicePrincipalName (SPN) приложений-ресурсов;
- разрешения в приложении-ресурсе.  

В случае с FabrikamMail это выглядит примерно так:

    PS C:\> Get-AzureADUserOAuth2PermissionGrant -ObjectId ddiggle@aadpremiumlab.onmicrosoft.com | fl *
    
    ClientId    : a8b16333-851d-42e8-acd2-eac155849b37
    ConsentType : Principal
    ExpiryTime  : 05/15/2017 07:02:39 AM
    ObjectId    : M2OxqB2F6EKs0urBVYSbN5d7PzhUZz1NlH25COvLocbJjoxkUFfRQauryBKwBWet
    PrincipalId : 648c8ec9-5750-41d1-abab-c812b00567ad
    ResourceId  : 383f7b97-6754-4d3d-9474-3908ebcba1c6
    Scope       : full_access_as_user
    StartTime   : 01/01/0001 12:00:00 AM

**ClientId** — это созданный идентификатор объекта ServicePrincipal приложения FabrikamMail, **PrincipalId** — идентификатор объекта пользователя, давшего согласие, **ResourceId** — идентификатор объекта ServicePrincipal приложения Exchange, а Scope — это разрешение в Exchange, на использование которого предоставлено согласие.

Если пользователям запрещено давать согласие, они увидят экран с сообщением о том, что требуется разрешение.

