---
title: "aaaAzure Active Directory версии 2.0 области, разрешения и разрешения | Документы Microsoft"
description: "Описание авторизации в конечной точке v2.0 hello Azure AD, включая области, разрешения и разрешения."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 5721d368c435868bfb4ae91cff7fbb9bc4a79b66
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="scopes-permissions-and-consent-in-hello-azure-active-directory-v20-endpoint"></a>Области, разрешения и разрешения в конечной v2.0 hello Azure Active Directory
Приложения, интегрируемые с Azure Active Directory (Azure AD), придерживаются определенной модели авторизации, позволяющей пользователям контролировать способ получения приложением доступа к их данным. Hello v2.0 реализацию модели авторизации hello уже был обновлен, и их изменения необходимо взаимодействие приложения с Azure AD. В этой статье рассматриваются основные понятия hello эта модель авторизации, включая области, разрешения и разрешения.

> [!NOTE]
> Конечная точка v2.0 Hello не поддерживает все сценарии Azure Active Directory и возможности. toodetermine необходимость использования конечной точки v2.0 hello, узнайте, как [ограничения v2.0](active-directory-v2-limitations.md).
>
>

## <a name="scopes-and-permissions"></a>Области и разрешения
Azure AD Реализует hello [OAuth 2.0](active-directory-v2-protocols.md) протокол авторизации. OAuth 2.0 — это метод, посредством которого стороннее приложение может обращаться к интернет-ресурсам от имени пользователя. Любой интернет-ресурс, интегрируемый с Azure AD, имеет идентификатор ресурса или *универсальный код ресурса (URI) идентификатора приложения*. К примеру, ниже приведены некоторые из размещенных в Интернете ресурсов Майкрософт:

* Hello API единой почты Office 365:`https://outlook.office.com`
* Hello API Azure AD Graph:`https://graph.windows.net`
* Microsoft Graph: `https://graph.microsoft.com`

Здравствуйте, это справедливо и для любых ресурсов сторонних разработчиков, которые интегрированы с Azure AD. Кроме того, любой из этих ресурсов можно определить набор разрешений, которые могут быть функции hello используется toodivide этого ресурса на более мелкие части. Например [Microsoft Graph](https://graph.microsoft.io) определенные разрешения toodo hello следующие задачи, в частности:

* чтение календаря пользователя;
* Записи пользователя tooa календаря
* отправка сообщений в качестве пользователя.

Определив эти типы разрешений, hello ресурс имеет точное управление данными и способ предоставления данных hello. Приложение стороннего производителя может запросить эти разрешения у пользователя приложения. hello разрешения должны утверждаться пользователем приложения Hello, прежде чем приложение hello может действовать от имени пользователя hello. С помощью фрагментации функции hello ресурсов разбиваются на небольшие наборы разрешений, приложения сторонних производителей можно создать toorequest только hello конкретные разрешения, они должны tooperform их функции. Пользователи приложения могут узнать точно как приложение будет использовать свои данные, и они могут быть более уверены, что приложение hello неверного злоумышленниками.

В Azure AD и OAuth разрешения такого типа называются *областями*. Они также иногда являются ссылка tooas *oAuth2Permissions*. В Azure AD область представляется как строковое значение. Продолжая пример hello Microsoft Graph, hello области для каждого разрешения, значение:

* чтение календаря пользователя с помощью `Calendar.Read`;
* Запись с помощью календаря tooa пользователя`Mail.ReadWrite`
* отправка сообщений в качестве пользователя с помощью `Mail.Send`.

Приложения могут запрашивать эти разрешения, указание областей hello в конечной точке v2.0 toohello запросов.

## <a name="openid-connect-scopes"></a>Области OpenId Connect
Реализация v2.0 Hello OpenID Connect имеет несколько четко определенных областей, которые не применяются конкретный ресурс tooa: `openid`, `email`, `profile`, и `offline_access`.

### <a name="openid"></a>OpenId
Если приложение выполняет вход с помощью [OpenID Connect](active-directory-v2-protocols.md), необходимо запросить hello `openid` области. Hello `openid` показывает область на hello рабочую учетную запись как hello разрешение «Вход», страница соглашения и на личную учетную запись Майкрософт hello согласие страницы как разрешение «Просмотр профиля и подключения tooapps и служб с использованием учетной записи Майкрософт» hello. С этим разрешением приложение может получать уникальный идентификатор для пользователя hello в форме hello hello `sub` утверждения. Он также предоставляет конечную точку UserInfo toohello доступа приложения hello. Hello `openid` область может использоваться в hello v2.0 конечная точка маркера tooacquire идентификатор токены, которые можно использовать toosecure HTTP вызовы между различными компонентами приложения.

### <a name="email"></a>email
Hello `email` область может использоваться с hello `openid` области видимости и других. Он предоставляет доступ к toohello hello приложения пользователю основной адрес электронной почты в форме hello hello `email` утверждения. Hello `email` утверждения включается в токене только в том случае, если адрес электронной почты связан с учетной записью пользователя hello, что не всегда случай hello. Если он использует hello `email` область, приложение должно быть подготовлен toohandle случай, в которой hello `email` утверждений не существует в маркере hello.

### <a name="profile"></a>Профиль
Hello `profile` область может использоваться с hello `openid` области видимости и других. Он предоставляет hello приложения доступа tooa достаточное число сведениям о пользователе hello. Hello сведений, которые он получает доступ к включает, но не ограничиваясь для hello заданным именем пользователя, Фамилия, предпочтительным имя пользователя и идентификатора объекта. Полный список hello профиля утверждений, доступные в параметре id_tokens hello для конкретного пользователя см. в разделе hello [v2.0 маркеры ссылка](active-directory-v2-tokens.md).

### <a name="offlineaccess"></a>offline_access
Hello [ `offline_access` область](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) дает tooresources доступ вашего приложения от имени пользователя hello на длительное время. На странице согласия hello рабочих учетной записи этой области отображается как hello разрешение «Доступ к данным в любое время». На hello личных страницы учетную запись Майкрософт согласия он отображается как hello разрешение «Доступ к вашим данным в любое время». Если пользователь утверждает hello `offline_access` области, приложение может получать маркеры обновления из конечной точки маркера v2.0 hello. Маркеры обновления имеют большой срок действия. Приложение может получать новые маркеры доступа после того, как срок действия старых истечет.

Если приложение не запрашивает hello `offline_access` области, он не будет получать токены обновления. Это означает, что когда вы активируете кода авторизации в hello [потока кода авторизации OAuth 2.0](active-directory-v2-protocols.md), вы получите токен доступа от hello `/token` конечной точки. маркер доступа Hello действителен в течение некоторого времени. Обычно в течение часа срока действия маркера доступа Hello. На этом этапе приложение должно tooredirect hello пользователя задней toohello `/authorize` tooget endpoint новый код авторизации. Во время этого перенаправления, в зависимости от типа приложения hello hello пользователя может потребоваться tooenter свои учетные данные еще раз или toopermissions согласие еще раз.

Дополнительные сведения о как tooget и используйте обновление токенов см. в разделе hello [v2.0 протокола ссылка](active-directory-v2-protocols.md).

## <a name="requesting-individual-user-consent"></a>Запрос на получение согласия одного пользователя
В [OpenID Connect или OAuth 2.0](active-directory-v2-protocols.md) запрос на авторизацию, приложение может запрашивать разрешения hello, он должен с помощью hello `scope` параметр запроса. Например когда пользователь входит в приложении tooan, приложение hello отправляет запрос как hello в следующем примере (с разрывы строк добавлены для удобочитаемости):

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

Hello `scope` параметр является разделенный пробелами список областей, которые приложение hello запрашивается. Каждая область видимости указывается путем добавления идентификатора значение toohello hello области действия ресурса (hello URI ИД приложения). В примере запроса hello приложение hello должен календарь пользователя разрешение tooread hello и отправка сообщения электронной почты от имени пользователя hello.

После hello пользователь вводит свои учетные данные, конечная точка v2.0 hello проверяет наличие соответствующих записей из *согласие пользователя*. Если пользователь hello не согласился tooany из hello запрашиваемые разрешения на доступ в hello последние, конечная точка v2.0 hello просит пользователя toogrant hello hello запрашиваемые разрешения на доступ.

![Предоставление разрешений рабочей учетной записью](../../media/active-directory-v2-flows/work_account_consent.png)

При hello пользователь утверждает разрешение hello, согласия hello регистрируются, чтобы hello пользователь не имеет tooconsent снова для последующей учетной записи входа в систему.

## <a name="requesting-consent-for-an-entire-tenant"></a>Запрос на получение согласия для клиента
Часто когда организация приобретает лицензию или подписку для приложения, hello организация хочет toofully приложения hello подготовки для ее сотрудников. В рамках этого процесса администратор может предоставить согласие от имени любого сотрудника tooact приложения hello. Если Здравствуйте, администратор предоставляет разрешения для клиента всего hello, сотрудники организации hello увидят страницу согласия для приложения hello.

toorequest согласия для всех пользователей в клиенте, приложение можно использовать конечную точку согласия администратора hello.

## <a name="admin-restricted-scopes"></a>Области только для администраторов
Некоторые разрешения высоким уровнем привилегий в экосистеме hello Microsoft могут быть установлены слишком*ограниченного администрирования*. Примеры таких областей hello следующие разрешения:

* чтение данных из каталога организации с помощью `Directory.Read`;
* Запись каталога организации tooan данных с помощью`Directory.ReadWrite`
* чтение групп безопасности в каталоге организации с помощью `Groups.Read.All`.

Несмотря на то, что пользователь потребитель может предоставить доступ приложения toothis вида данных, пользователи в организации прав на предоставление доступа toohello же набор конфиденциальные данные компании. Если приложение запрашивает доступ tooone эти разрешения от пользователя организации, hello пользователь получает сообщение об ошибке, говорящее, что они не являются разрешений авторизованным tooconsent tooyour приложения.

Если вашему приложению требуется области tooadmin ограниченного доступа для организаций, следует запросить их непосредственно из администратора компании, также с помощью hello admin согласия конечной точки, описанным ниже.

Когда администратор предоставляет эти разрешения посредством Здравствуйте, администратор согласия конечной точки, предоставлены разрешения для всех пользователей в клиенте hello.

## <a name="using-hello-admin-consent-endpoint"></a>С помощью конечной точки согласия администратора hello
Выполнив приведенные действия, приложение получит возможность получать разрешения для всех пользователей в клиенте, включая области только для администраторов. toosee пример кода, который реализует hello действия см. в разделе hello [образец областей ограниченного администрирования](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).

### <a name="request-hello-permissions-in-hello-app-registration-portal"></a>Запрос разрешений hello в портал регистрации приложения hello
1. Go tooyour приложение hello [портала регистрации приложения](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), или [создать приложение](active-directory-v2-app-registration.md) Если это еще не сделано.
2. Найдите hello **Microsoft Graph разрешения** статьи, а затем добавьте hello разрешения, необходимые для приложения.
3. Убедитесь, что **Сохранить** hello регистрации приложения.

### <a name="recommended-sign-hello-user-in-tooyour-app"></a>Рекомендуется: Hello пользователя входа в приложении tooyour
Как правило при построении приложения, использующего конечной точки согласия администратора hello, приложение hello должен страницы или представления, в которых hello администратора может утвердить разрешений приложение hello. Эта страница может быть частью потока регистрации приложение hello, часть параметров приложения hello, или она может быть выделенный поток «подключиться». Во многих случаях имеет смысл для tooshow приложения hello это «подключиться» представление, только после того, что пользователь выполнил вход с рабочей или учебной учетной записи Майкрософт.

При входе пользователя hello в приложении tooyour можно определить hello организации принадлежит toowhich Здравствуйте, администратор перед запросом их tooapprove hello необходимые разрешения. Хотя это не обязательно, таким образом можно сделать пользовательский интерфейс более интуитивно понятным для сотрудников организации. пользователь toosign hello в выполните наши [учебники протокола v2.0](active-directory-v2-protocols.md).

### <a name="request-hello-permissions-from-a-directory-admin"></a>Запросить hello разрешения от администратора каталога
Когда вы будете готовы toorequest разрешения от администратора вашей организации, вы можете перенаправлять hello пользователя toohello v2.0 *конечной точки согласия администратора*.

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting hello below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| Параметр | Условие | Описание |
| --- | --- | --- |
| tenant |Обязательно |Клиент каталога Hello, требуется разрешение toorequest из. Можно указать в виде GUID или понятного имени. |
| client_id |Обязательно |Приложение Hello идентификатор этого hello [портала регистрации приложения](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) назначенный tooyour приложения. |
| redirect_uri |Обязательно |URI, место отправки для вашего приложения toohandle toobe ответа hello перенаправления Hello. Он должен точно соответствовать одной hello перенаправления URI, которые были зарегистрированы в портал регистрации приложения hello. |
| state |Рекомендуется |Значение, включенных в запрос hello, также будет возвращаться в ответ на токен hello. Это может быть строка любого содержания. Используйте hello состояние tooencode сведения о состоянии пользователя hello в приложение hello, до возникновения hello запрос проверки подлинности, таких как страницы hello или представления, которые использовались на. |

В этот момент Azure AD требует toosign администратора клиента в запросе toocomplete hello. Здравствуйте, администратор получает запрос tooapprove все Здравствуйте, запрошенные для приложения на портале регистрации приложения hello разрешения.

#### <a name="successful-response"></a>Успешный ответ
Если Здравствуйте, администратор подтверждает hello разрешений для приложения, hello успешный ответ выглядит следующим образом:

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| Параметр | Описание |
| --- | --- | --- |
| tenant |Hello клиента каталога, которому предоставляется разрешение приложения hello она запрошена, в формате GUID. |
| state |Значение, включенных в запрос hello, также будут возвращены в ответ на токен hello. Это может быть строка любого содержания. состояние Hello — используется tooencode сведения о состоянии пользователя hello в приложение hello, до возникновения hello запрос проверки подлинности, такие как страница hello и представление, в котором они находились на. |
| admin_consent |Будет установлено слишком**true**. |

#### <a name="error-response"></a>Сообщение об ошибке
Здравствуйте, администратор не одобрения hello разрешений для приложения, hello сбой ответа выглядит следующим образом:

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| Параметр | Описание |
| --- | --- | --- |
| error |Ошибка строка кода, который может быть используется tooclassify типы ошибок, которые возникают и может быть tooerrors используется tooreact. |
| error_description |Сообщение об ошибке, которые могут помочь определить причину ошибки hello разработчик. |

После получения успешного ответа от конечной точки согласия администратора hello приложение получило разрешения hello запрошенной. Далее можно запросить маркер для hello ресурс.

## <a name="using-permissions"></a>Использование разрешений
После согласия пользователя hello toopermissions для вашего приложения ваше приложение может получить доступ токенов, представляющих tooaccess разрешение ваше приложение к ресурсу в некоторых емкости. Маркер доступа можно использовать только для одного ресурса, но закодированные внутри hello токен доступа является каждое разрешение, которое приложение было предоставлено для этого ресурса. tooacquire маркер доступа, приложение можно сделать запрос toohello v2.0 маркера конечной точки, следующим образом:

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

Hello полученный маркер доступа можно использовать в HTTP-запросы toohello ресурс. Указывает надежно toohello ресурсов, приложение получит разрешение tooperform hello определенной задачи.  

Дополнительные сведения о hello OAuth 2.0 протокола и tooget маркеры доступа, в статье hello [протокола ссылки на конечную точку v2.0](active-directory-v2-protocols.md).
