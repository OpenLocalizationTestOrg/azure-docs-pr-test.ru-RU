---
title: "aaaAzure Active Directory версии 2.0 области, разрешения и разрешения | Документы Microsoft"
description: "Описание авторизации в конечной точке v2.0 hello Azure AD, включая области, разрешения и разрешения."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 5721d368c435868bfb4ae91cff7fbb9bc4a79b66
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="scopes-permissions-and-consent-in-hello-azure-active-directory-v20-endpoint"></a><span data-ttu-id="507ea-103">Области, разрешения и разрешения в конечной v2.0 hello Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="507ea-103">Scopes, permissions, and consent in hello Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="507ea-104">Приложения, интегрируемые с Azure Active Directory (Azure AD), придерживаются определенной модели авторизации, позволяющей пользователям контролировать способ получения приложением доступа к их данным.</span><span class="sxs-lookup"><span data-stu-id="507ea-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="507ea-105">Hello v2.0 реализацию модели авторизации hello уже был обновлен, и их изменения необходимо взаимодействие приложения с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="507ea-105">hello v2.0 implementation of hello authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="507ea-106">В этой статье рассматриваются основные понятия hello эта модель авторизации, включая области, разрешения и разрешения.</span><span class="sxs-lookup"><span data-stu-id="507ea-106">This article covers hello basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="507ea-107">Конечная точка v2.0 Hello не поддерживает все сценарии Azure Active Directory и возможности.</span><span class="sxs-lookup"><span data-stu-id="507ea-107">hello v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="507ea-108">toodetermine необходимость использования конечной точки v2.0 hello, узнайте, как [ограничения v2.0](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="507ea-108">toodetermine whether you should use hello v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="507ea-109">Области и разрешения</span><span class="sxs-lookup"><span data-stu-id="507ea-109">Scopes and permissions</span></span>
<span data-ttu-id="507ea-110">Azure AD Реализует hello [OAuth 2.0](active-directory-v2-protocols.md) протокол авторизации.</span><span class="sxs-lookup"><span data-stu-id="507ea-110">Azure AD implements hello [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="507ea-111">OAuth 2.0 — это метод, посредством которого стороннее приложение может обращаться к интернет-ресурсам от имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="507ea-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="507ea-112">Любой интернет-ресурс, интегрируемый с Azure AD, имеет идентификатор ресурса или *универсальный код ресурса (URI) идентификатора приложения*.</span><span class="sxs-lookup"><span data-stu-id="507ea-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="507ea-113">К примеру, ниже приведены некоторые из размещенных в Интернете ресурсов Майкрософт:</span><span class="sxs-lookup"><span data-stu-id="507ea-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="507ea-114">Hello API единой почты Office 365:`https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="507ea-114">hello Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="507ea-115">Hello API Azure AD Graph:`https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="507ea-115">hello Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="507ea-116">Microsoft Graph: `https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="507ea-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="507ea-117">Здравствуйте, это справедливо и для любых ресурсов сторонних разработчиков, которые интегрированы с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="507ea-117">hello same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="507ea-118">Кроме того, любой из этих ресурсов можно определить набор разрешений, которые могут быть функции hello используется toodivide этого ресурса на более мелкие части.</span><span class="sxs-lookup"><span data-stu-id="507ea-118">Any of these resources also can define a set of permissions that can be used toodivide hello functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="507ea-119">Например [Microsoft Graph](https://graph.microsoft.io) определенные разрешения toodo hello следующие задачи, в частности:</span><span class="sxs-lookup"><span data-stu-id="507ea-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions toodo hello following tasks, among others:</span></span>

* <span data-ttu-id="507ea-120">чтение календаря пользователя;</span><span class="sxs-lookup"><span data-stu-id="507ea-120">Read a user's calendar</span></span>
* <span data-ttu-id="507ea-121">Записи пользователя tooa календаря</span><span class="sxs-lookup"><span data-stu-id="507ea-121">Write tooa user's calendar</span></span>
* <span data-ttu-id="507ea-122">отправка сообщений в качестве пользователя.</span><span class="sxs-lookup"><span data-stu-id="507ea-122">Send mail as a user</span></span>

<span data-ttu-id="507ea-123">Определив эти типы разрешений, hello ресурс имеет точное управление данными и способ предоставления данных hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-123">By defining these types of permissions, hello resource has fine-grained control over its data and how hello data is exposed.</span></span> <span data-ttu-id="507ea-124">Приложение стороннего производителя может запросить эти разрешения у пользователя приложения.</span><span class="sxs-lookup"><span data-stu-id="507ea-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="507ea-125">hello разрешения должны утверждаться пользователем приложения Hello, прежде чем приложение hello может действовать от имени пользователя hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-125">hello app user must approve hello permissions before hello app can act on hello user's behalf.</span></span> <span data-ttu-id="507ea-126">С помощью фрагментации функции hello ресурсов разбиваются на небольшие наборы разрешений, приложения сторонних производителей можно создать toorequest только hello конкретные разрешения, они должны tooperform их функции.</span><span class="sxs-lookup"><span data-stu-id="507ea-126">By chunking hello resource's functionality into smaller permission sets, third-party apps can be built toorequest only hello specific permissions that they need tooperform their function.</span></span> <span data-ttu-id="507ea-127">Пользователи приложения могут узнать точно как приложение будет использовать свои данные, и они могут быть более уверены, что приложение hello неверного злоумышленниками.</span><span class="sxs-lookup"><span data-stu-id="507ea-127">App users can know exactly how an app will use their data, and they can be more confident that hello app is not behaving with malicious intent.</span></span>

<span data-ttu-id="507ea-128">В Azure AD и OAuth разрешения такого типа называются *областями*.</span><span class="sxs-lookup"><span data-stu-id="507ea-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="507ea-129">Они также иногда являются ссылка tooas *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="507ea-129">They also sometimes are referred tooas *oAuth2Permissions*.</span></span> <span data-ttu-id="507ea-130">В Azure AD область представляется как строковое значение.</span><span class="sxs-lookup"><span data-stu-id="507ea-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="507ea-131">Продолжая пример hello Microsoft Graph, hello области для каждого разрешения, значение:</span><span class="sxs-lookup"><span data-stu-id="507ea-131">Continuing with hello Microsoft Graph example, hello scope value for each permission is:</span></span>

* <span data-ttu-id="507ea-132">чтение календаря пользователя с помощью `Calendar.Read`;</span><span class="sxs-lookup"><span data-stu-id="507ea-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="507ea-133">Запись с помощью календаря tooa пользователя`Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="507ea-133">Write tooa user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="507ea-134">отправка сообщений в качестве пользователя с помощью `Mail.Send`.</span><span class="sxs-lookup"><span data-stu-id="507ea-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="507ea-135">Приложения могут запрашивать эти разрешения, указание областей hello в конечной точке v2.0 toohello запросов.</span><span class="sxs-lookup"><span data-stu-id="507ea-135">An app can request these permissions by specifying hello scopes in requests toohello v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="507ea-136">Области OpenId Connect</span><span class="sxs-lookup"><span data-stu-id="507ea-136">OpenID Connect scopes</span></span>
<span data-ttu-id="507ea-137">Реализация v2.0 Hello OpenID Connect имеет несколько четко определенных областей, которые не применяются конкретный ресурс tooa: `openid`, `email`, `profile`, и `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="507ea-137">hello v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply tooa specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="507ea-138">OpenId</span><span class="sxs-lookup"><span data-stu-id="507ea-138">openid</span></span>
<span data-ttu-id="507ea-139">Если приложение выполняет вход с помощью [OpenID Connect](active-directory-v2-protocols.md), необходимо запросить hello `openid` области.</span><span class="sxs-lookup"><span data-stu-id="507ea-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request hello `openid` scope.</span></span> <span data-ttu-id="507ea-140">Hello `openid` показывает область на hello рабочую учетную запись как hello разрешение «Вход», страница соглашения и на личную учетную запись Майкрософт hello согласие страницы как разрешение «Просмотр профиля и подключения tooapps и служб с использованием учетной записи Майкрософт» hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-140">hello `openid` scope shows on hello work account consent page as hello "Sign you in" permission, and on hello personal Microsoft account consent page as hello "View your profile and connect tooapps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="507ea-141">С этим разрешением приложение может получать уникальный идентификатор для пользователя hello в форме hello hello `sub` утверждения.</span><span class="sxs-lookup"><span data-stu-id="507ea-141">With this permission, an app can receive a unique identifier for hello user in hello form of hello `sub` claim.</span></span> <span data-ttu-id="507ea-142">Он также предоставляет конечную точку UserInfo toohello доступа приложения hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-142">It also gives hello app access toohello UserInfo endpoint.</span></span> <span data-ttu-id="507ea-143">Hello `openid` область может использоваться в hello v2.0 конечная точка маркера tooacquire идентификатор токены, которые можно использовать toosecure HTTP вызовы между различными компонентами приложения.</span><span class="sxs-lookup"><span data-stu-id="507ea-143">hello `openid` scope can be used at hello v2.0 token endpoint tooacquire ID tokens, which can be used toosecure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="507ea-144">email</span><span class="sxs-lookup"><span data-stu-id="507ea-144">email</span></span>
<span data-ttu-id="507ea-145">Hello `email` область может использоваться с hello `openid` области видимости и других.</span><span class="sxs-lookup"><span data-stu-id="507ea-145">hello `email` scope can be used with hello `openid` scope and any others.</span></span> <span data-ttu-id="507ea-146">Он предоставляет доступ к toohello hello приложения пользователю основной адрес электронной почты в форме hello hello `email` утверждения.</span><span class="sxs-lookup"><span data-stu-id="507ea-146">It gives hello app access toohello user's primary email address in hello form of hello `email` claim.</span></span> <span data-ttu-id="507ea-147">Hello `email` утверждения включается в токене только в том случае, если адрес электронной почты связан с учетной записью пользователя hello, что не всегда случай hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-147">hello `email` claim is included in a token only if an email address is associated with hello user account, which is not always hello case.</span></span> <span data-ttu-id="507ea-148">Если он использует hello `email` область, приложение должно быть подготовлен toohandle случай, в которой hello `email` утверждений не существует в маркере hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-148">If it uses hello `email` scope, your app should be prepared toohandle a case in which hello `email` claim does not exist in hello token.</span></span>

### <a name="profile"></a><span data-ttu-id="507ea-149">Профиль</span><span class="sxs-lookup"><span data-stu-id="507ea-149">profile</span></span>
<span data-ttu-id="507ea-150">Hello `profile` область может использоваться с hello `openid` области видимости и других.</span><span class="sxs-lookup"><span data-stu-id="507ea-150">hello `profile` scope can be used with hello `openid` scope and any others.</span></span> <span data-ttu-id="507ea-151">Он предоставляет hello приложения доступа tooa достаточное число сведениям о пользователе hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-151">It gives hello app access tooa substantial amount of information about hello user.</span></span> <span data-ttu-id="507ea-152">Hello сведений, которые он получает доступ к включает, но не ограничиваясь для hello заданным именем пользователя, Фамилия, предпочтительным имя пользователя и идентификатора объекта.</span><span class="sxs-lookup"><span data-stu-id="507ea-152">hello information it can access includes, but is not limited to, hello user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="507ea-153">Полный список hello профиля утверждений, доступные в параметре id_tokens hello для конкретного пользователя см. в разделе hello [v2.0 маркеры ссылка](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="507ea-153">For a complete list of hello profile claims available in hello id_tokens parameter for a specific user, see hello [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="507ea-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="507ea-154">offline_access</span></span>
<span data-ttu-id="507ea-155">Hello [ `offline_access` область](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) дает tooresources доступ вашего приложения от имени пользователя hello на длительное время.</span><span class="sxs-lookup"><span data-stu-id="507ea-155">hello [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access tooresources on behalf of hello user for an extended time.</span></span> <span data-ttu-id="507ea-156">На странице согласия hello рабочих учетной записи этой области отображается как hello разрешение «Доступ к данным в любое время».</span><span class="sxs-lookup"><span data-stu-id="507ea-156">On hello work account consent page, this scope appears as hello "Access your data anytime" permission.</span></span> <span data-ttu-id="507ea-157">На hello личных страницы учетную запись Майкрософт согласия он отображается как hello разрешение «Доступ к вашим данным в любое время».</span><span class="sxs-lookup"><span data-stu-id="507ea-157">On hello personal Microsoft account consent page, it appears as hello "Access your info anytime" permission.</span></span> <span data-ttu-id="507ea-158">Если пользователь утверждает hello `offline_access` области, приложение может получать маркеры обновления из конечной точки маркера v2.0 hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-158">When a user approves hello `offline_access` scope, your app can receive refresh tokens from hello v2.0 token endpoint.</span></span> <span data-ttu-id="507ea-159">Маркеры обновления имеют большой срок действия.</span><span class="sxs-lookup"><span data-stu-id="507ea-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="507ea-160">Приложение может получать новые маркеры доступа после того, как срок действия старых истечет.</span><span class="sxs-lookup"><span data-stu-id="507ea-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="507ea-161">Если приложение не запрашивает hello `offline_access` области, он не будет получать токены обновления.</span><span class="sxs-lookup"><span data-stu-id="507ea-161">If your app does not request hello `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="507ea-162">Это означает, что когда вы активируете кода авторизации в hello [потока кода авторизации OAuth 2.0](active-directory-v2-protocols.md), вы получите токен доступа от hello `/token` конечной точки.</span><span class="sxs-lookup"><span data-stu-id="507ea-162">This means that when you redeem an authorization code in hello [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from hello `/token` endpoint.</span></span> <span data-ttu-id="507ea-163">маркер доступа Hello действителен в течение некоторого времени.</span><span class="sxs-lookup"><span data-stu-id="507ea-163">hello access token is valid for a short time.</span></span> <span data-ttu-id="507ea-164">Обычно в течение часа срока действия маркера доступа Hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-164">hello access token usually expires in one hour.</span></span> <span data-ttu-id="507ea-165">На этом этапе приложение должно tooredirect hello пользователя задней toohello `/authorize` tooget endpoint новый код авторизации.</span><span class="sxs-lookup"><span data-stu-id="507ea-165">At that point, your app needs tooredirect hello user back toohello `/authorize` endpoint tooget a new authorization code.</span></span> <span data-ttu-id="507ea-166">Во время этого перенаправления, в зависимости от типа приложения hello hello пользователя может потребоваться tooenter свои учетные данные еще раз или toopermissions согласие еще раз.</span><span class="sxs-lookup"><span data-stu-id="507ea-166">During this redirect, depending on hello type of app, hello user might need tooenter their credentials again or consent again toopermissions.</span></span>

<span data-ttu-id="507ea-167">Дополнительные сведения о как tooget и используйте обновление токенов см. в разделе hello [v2.0 протокола ссылка](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="507ea-167">For more information about how tooget and use refresh tokens, see hello [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="507ea-168">Запрос на получение согласия одного пользователя</span><span class="sxs-lookup"><span data-stu-id="507ea-168">Requesting individual user consent</span></span>
<span data-ttu-id="507ea-169">В [OpenID Connect или OAuth 2.0](active-directory-v2-protocols.md) запрос на авторизацию, приложение может запрашивать разрешения hello, он должен с помощью hello `scope` параметр запроса.</span><span class="sxs-lookup"><span data-stu-id="507ea-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request hello permissions it needs by using hello `scope` query parameter.</span></span> <span data-ttu-id="507ea-170">Например когда пользователь входит в приложении tooan, приложение hello отправляет запрос как hello в следующем примере (с разрывы строк добавлены для удобочитаемости):</span><span class="sxs-lookup"><span data-stu-id="507ea-170">For example, when a user signs in tooan app, hello app sends a request like hello following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="507ea-171">Hello `scope` параметр является разделенный пробелами список областей, которые приложение hello запрашивается.</span><span class="sxs-lookup"><span data-stu-id="507ea-171">hello `scope` parameter is a space-separated list of scopes that hello app is requesting.</span></span> <span data-ttu-id="507ea-172">Каждая область видимости указывается путем добавления идентификатора значение toohello hello области действия ресурса (hello URI ИД приложения).</span><span class="sxs-lookup"><span data-stu-id="507ea-172">Each scope is indicated by appending hello scope value toohello resource's identifier (hello Application ID URI).</span></span> <span data-ttu-id="507ea-173">В примере запроса hello приложение hello должен календарь пользователя разрешение tooread hello и отправка сообщения электронной почты от имени пользователя hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-173">In hello request example, hello app needs permission tooread hello user's calendar and send mail as hello user.</span></span>

<span data-ttu-id="507ea-174">После hello пользователь вводит свои учетные данные, конечная точка v2.0 hello проверяет наличие соответствующих записей из *согласие пользователя*.</span><span class="sxs-lookup"><span data-stu-id="507ea-174">After hello user enters their credentials, hello v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="507ea-175">Если пользователь hello не согласился tooany из hello запрашиваемые разрешения на доступ в hello последние, конечная точка v2.0 hello просит пользователя toogrant hello hello запрашиваемые разрешения на доступ.</span><span class="sxs-lookup"><span data-stu-id="507ea-175">If hello user has not consented tooany of hello requested permissions in hello past, hello v2.0 endpoint asks hello user toogrant hello requested permissions.</span></span>

![Предоставление разрешений рабочей учетной записью](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="507ea-177">При hello пользователь утверждает разрешение hello, согласия hello регистрируются, чтобы hello пользователь не имеет tooconsent снова для последующей учетной записи входа в систему.</span><span class="sxs-lookup"><span data-stu-id="507ea-177">When hello user approves hello permission, hello consent is recorded so that hello user doesn't have tooconsent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="507ea-178">Запрос на получение согласия для клиента</span><span class="sxs-lookup"><span data-stu-id="507ea-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="507ea-179">Часто когда организация приобретает лицензию или подписку для приложения, hello организация хочет toofully приложения hello подготовки для ее сотрудников.</span><span class="sxs-lookup"><span data-stu-id="507ea-179">Often, when an organization purchases a license or subscription for an application, hello organization wants toofully provision hello application for its employees.</span></span> <span data-ttu-id="507ea-180">В рамках этого процесса администратор может предоставить согласие от имени любого сотрудника tooact приложения hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-180">As part of this process, an administrator can grant consent for hello application tooact on behalf of any employee.</span></span> <span data-ttu-id="507ea-181">Если Здравствуйте, администратор предоставляет разрешения для клиента всего hello, сотрудники организации hello увидят страницу согласия для приложения hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-181">If hello admin grants consent for hello entire tenant, hello organization's employees won't see a consent page for hello application.</span></span>

<span data-ttu-id="507ea-182">toorequest согласия для всех пользователей в клиенте, приложение можно использовать конечную точку согласия администратора hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-182">toorequest consent for all users in a tenant, your app can use hello admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="507ea-183">Области только для администраторов</span><span class="sxs-lookup"><span data-stu-id="507ea-183">Admin-restricted scopes</span></span>
<span data-ttu-id="507ea-184">Некоторые разрешения высоким уровнем привилегий в экосистеме hello Microsoft могут быть установлены слишком*ограниченного администрирования*.</span><span class="sxs-lookup"><span data-stu-id="507ea-184">Some high-privilege permissions in hello Microsoft ecosystem can be set too*admin-restricted*.</span></span> <span data-ttu-id="507ea-185">Примеры таких областей hello следующие разрешения:</span><span class="sxs-lookup"><span data-stu-id="507ea-185">Examples of these kinds of scopes include hello following permissions:</span></span>

* <span data-ttu-id="507ea-186">чтение данных из каталога организации с помощью `Directory.Read`;</span><span class="sxs-lookup"><span data-stu-id="507ea-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="507ea-187">Запись каталога организации tooan данных с помощью`Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="507ea-187">Write data tooan organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="507ea-188">чтение групп безопасности в каталоге организации с помощью `Groups.Read.All`.</span><span class="sxs-lookup"><span data-stu-id="507ea-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="507ea-189">Несмотря на то, что пользователь потребитель может предоставить доступ приложения toothis вида данных, пользователи в организации прав на предоставление доступа toohello же набор конфиденциальные данные компании.</span><span class="sxs-lookup"><span data-stu-id="507ea-189">Although a consumer user might grant an application access toothis kind of data, organizational users are restricted from granting access toohello same set of sensitive company data.</span></span> <span data-ttu-id="507ea-190">Если приложение запрашивает доступ tooone эти разрешения от пользователя организации, hello пользователь получает сообщение об ошибке, говорящее, что они не являются разрешений авторизованным tooconsent tooyour приложения.</span><span class="sxs-lookup"><span data-stu-id="507ea-190">If your application requests access tooone of these permissions from an organizational user, hello user receives an error message that says they are not authorized tooconsent tooyour app's permissions.</span></span>

<span data-ttu-id="507ea-191">Если вашему приложению требуется области tooadmin ограниченного доступа для организаций, следует запросить их непосредственно из администратора компании, также с помощью hello admin согласия конечной точки, описанным ниже.</span><span class="sxs-lookup"><span data-stu-id="507ea-191">If your app requires access tooadmin-restricted scopes for organizations, you should request them directly from a company administrator, also by using hello admin consent endpoint, described next.</span></span>

<span data-ttu-id="507ea-192">Когда администратор предоставляет эти разрешения посредством Здравствуйте, администратор согласия конечной точки, предоставлены разрешения для всех пользователей в клиенте hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-192">When an administrator grants these permissions via hello admin consent endpoint, consent is granted for all users in hello tenant.</span></span>

## <a name="using-hello-admin-consent-endpoint"></a><span data-ttu-id="507ea-193">С помощью конечной точки согласия администратора hello</span><span class="sxs-lookup"><span data-stu-id="507ea-193">Using hello admin consent endpoint</span></span>
<span data-ttu-id="507ea-194">Выполнив приведенные действия, приложение получит возможность получать разрешения для всех пользователей в клиенте, включая области только для администраторов.</span><span class="sxs-lookup"><span data-stu-id="507ea-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="507ea-195">toosee пример кода, который реализует hello действия см. в разделе hello [образец областей ограниченного администрирования](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="507ea-195">toosee a code sample that implements hello steps, see hello [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-hello-permissions-in-hello-app-registration-portal"></a><span data-ttu-id="507ea-196">Запрос разрешений hello в портал регистрации приложения hello</span><span class="sxs-lookup"><span data-stu-id="507ea-196">Request hello permissions in hello app registration portal</span></span>
1. <span data-ttu-id="507ea-197">Go tooyour приложение hello [портала регистрации приложения](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), или [создать приложение](active-directory-v2-app-registration.md) Если это еще не сделано.</span><span class="sxs-lookup"><span data-stu-id="507ea-197">Go tooyour application in hello [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="507ea-198">Найдите hello **Microsoft Graph разрешения** статьи, а затем добавьте hello разрешения, необходимые для приложения.</span><span class="sxs-lookup"><span data-stu-id="507ea-198">Locate hello **Microsoft Graph Permissions** section, and then add hello permissions that your app requires.</span></span>
3. <span data-ttu-id="507ea-199">Убедитесь, что **Сохранить** hello регистрации приложения.</span><span class="sxs-lookup"><span data-stu-id="507ea-199">Make sure you **Save** hello app registration.</span></span>

### <a name="recommended-sign-hello-user-in-tooyour-app"></a><span data-ttu-id="507ea-200">Рекомендуется: Hello пользователя входа в приложении tooyour</span><span class="sxs-lookup"><span data-stu-id="507ea-200">Recommended: Sign hello user in tooyour app</span></span>
<span data-ttu-id="507ea-201">Как правило при построении приложения, использующего конечной точки согласия администратора hello, приложение hello должен страницы или представления, в которых hello администратора может утвердить разрешений приложение hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-201">Typically, when you build an application that uses hello admin consent endpoint, hello app needs a page or view in which hello admin can approve hello app's permissions.</span></span> <span data-ttu-id="507ea-202">Эта страница может быть частью потока регистрации приложение hello, часть параметров приложения hello, или она может быть выделенный поток «подключиться».</span><span class="sxs-lookup"><span data-stu-id="507ea-202">This page can be part of hello app's sign-up flow, part of hello app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="507ea-203">Во многих случаях имеет смысл для tooshow приложения hello это «подключиться» представление, только после того, что пользователь выполнил вход с рабочей или учебной учетной записи Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="507ea-203">In many cases, it makes sense for hello app tooshow this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="507ea-204">При входе пользователя hello в приложении tooyour можно определить hello организации принадлежит toowhich Здравствуйте, администратор перед запросом их tooapprove hello необходимые разрешения.</span><span class="sxs-lookup"><span data-stu-id="507ea-204">When you sign hello user in tooyour app, you can identify hello organization toowhich hello admin belongs before asking them tooapprove hello necessary permissions.</span></span> <span data-ttu-id="507ea-205">Хотя это не обязательно, таким образом можно сделать пользовательский интерфейс более интуитивно понятным для сотрудников организации.</span><span class="sxs-lookup"><span data-stu-id="507ea-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="507ea-206">пользователь toosign hello в выполните наши [учебники протокола v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="507ea-206">toosign hello user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-hello-permissions-from-a-directory-admin"></a><span data-ttu-id="507ea-207">Запросить hello разрешения от администратора каталога</span><span class="sxs-lookup"><span data-stu-id="507ea-207">Request hello permissions from a directory admin</span></span>
<span data-ttu-id="507ea-208">Когда вы будете готовы toorequest разрешения от администратора вашей организации, вы можете перенаправлять hello пользователя toohello v2.0 *конечной точки согласия администратора*.</span><span class="sxs-lookup"><span data-stu-id="507ea-208">When you're ready toorequest permissions from your organization's admin, you can redirect hello user toohello v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting hello below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="507ea-209">Параметр</span><span class="sxs-lookup"><span data-stu-id="507ea-209">Parameter</span></span> | <span data-ttu-id="507ea-210">Условие</span><span class="sxs-lookup"><span data-stu-id="507ea-210">Condition</span></span> | <span data-ttu-id="507ea-211">Описание</span><span class="sxs-lookup"><span data-stu-id="507ea-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="507ea-212">tenant</span><span class="sxs-lookup"><span data-stu-id="507ea-212">tenant</span></span> |<span data-ttu-id="507ea-213">Обязательно</span><span class="sxs-lookup"><span data-stu-id="507ea-213">Required</span></span> |<span data-ttu-id="507ea-214">Клиент каталога Hello, требуется разрешение toorequest из.</span><span class="sxs-lookup"><span data-stu-id="507ea-214">hello directory tenant that you want toorequest permission from.</span></span> <span data-ttu-id="507ea-215">Можно указать в виде GUID или понятного имени.</span><span class="sxs-lookup"><span data-stu-id="507ea-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="507ea-216">client_id</span><span class="sxs-lookup"><span data-stu-id="507ea-216">client_id</span></span> |<span data-ttu-id="507ea-217">Обязательно</span><span class="sxs-lookup"><span data-stu-id="507ea-217">Required</span></span> |<span data-ttu-id="507ea-218">Приложение Hello идентификатор этого hello [портала регистрации приложения](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) назначенный tooyour приложения.</span><span class="sxs-lookup"><span data-stu-id="507ea-218">hello Application ID that hello [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned tooyour app.</span></span> |
| <span data-ttu-id="507ea-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="507ea-219">redirect_uri</span></span> |<span data-ttu-id="507ea-220">Обязательно</span><span class="sxs-lookup"><span data-stu-id="507ea-220">Required</span></span> |<span data-ttu-id="507ea-221">URI, место отправки для вашего приложения toohandle toobe ответа hello перенаправления Hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-221">hello redirect URI where you want hello response toobe sent for your app toohandle.</span></span> <span data-ttu-id="507ea-222">Он должен точно соответствовать одной hello перенаправления URI, которые были зарегистрированы в портал регистрации приложения hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-222">It must exactly match one of hello redirect URIs that you registered in hello app registration portal.</span></span> |
| <span data-ttu-id="507ea-223">state</span><span class="sxs-lookup"><span data-stu-id="507ea-223">state</span></span> |<span data-ttu-id="507ea-224">Рекомендуется</span><span class="sxs-lookup"><span data-stu-id="507ea-224">Recommended</span></span> |<span data-ttu-id="507ea-225">Значение, включенных в запрос hello, также будет возвращаться в ответ на токен hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-225">A value included in hello request that will also be returned in hello token response.</span></span> <span data-ttu-id="507ea-226">Это может быть строка любого содержания.</span><span class="sxs-lookup"><span data-stu-id="507ea-226">It can be a string of any content you want.</span></span> <span data-ttu-id="507ea-227">Используйте hello состояние tooencode сведения о состоянии пользователя hello в приложение hello, до возникновения hello запрос проверки подлинности, таких как страницы hello или представления, которые использовались на.</span><span class="sxs-lookup"><span data-stu-id="507ea-227">Use hello state tooencode information about hello user's state in hello app before hello authentication request occurred, such as hello page or view they were on.</span></span> |

<span data-ttu-id="507ea-228">В этот момент Azure AD требует toosign администратора клиента в запросе toocomplete hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-228">At this point, Azure AD requires a tenant administrator toosign in toocomplete hello request.</span></span> <span data-ttu-id="507ea-229">Здравствуйте, администратор получает запрос tooapprove все Здравствуйте, запрошенные для приложения на портале регистрации приложения hello разрешения.</span><span class="sxs-lookup"><span data-stu-id="507ea-229">hello administrator is asked tooapprove all hello permissions that you have requested for your app in hello app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="507ea-230">Успешный ответ</span><span class="sxs-lookup"><span data-stu-id="507ea-230">Successful response</span></span>
<span data-ttu-id="507ea-231">Если Здравствуйте, администратор подтверждает hello разрешений для приложения, hello успешный ответ выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="507ea-231">If hello admin approves hello permissions for your app, hello successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="507ea-232">Параметр</span><span class="sxs-lookup"><span data-stu-id="507ea-232">Parameter</span></span> | <span data-ttu-id="507ea-233">Описание</span><span class="sxs-lookup"><span data-stu-id="507ea-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="507ea-234">tenant</span><span class="sxs-lookup"><span data-stu-id="507ea-234">tenant</span></span> |<span data-ttu-id="507ea-235">Hello клиента каталога, которому предоставляется разрешение приложения hello она запрошена, в формате GUID.</span><span class="sxs-lookup"><span data-stu-id="507ea-235">hello directory tenant that granted your application hello permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="507ea-236">state</span><span class="sxs-lookup"><span data-stu-id="507ea-236">state</span></span> |<span data-ttu-id="507ea-237">Значение, включенных в запрос hello, также будут возвращены в ответ на токен hello.</span><span class="sxs-lookup"><span data-stu-id="507ea-237">A value included in hello request that also will be returned in hello token response.</span></span> <span data-ttu-id="507ea-238">Это может быть строка любого содержания.</span><span class="sxs-lookup"><span data-stu-id="507ea-238">It can be a string of any content you want.</span></span> <span data-ttu-id="507ea-239">состояние Hello — используется tooencode сведения о состоянии пользователя hello в приложение hello, до возникновения hello запрос проверки подлинности, такие как страница hello и представление, в котором они находились на.</span><span class="sxs-lookup"><span data-stu-id="507ea-239">hello state is used tooencode information about hello user's state in hello app before hello authentication request occurred, such as hello page or view they were on.</span></span> |
| <span data-ttu-id="507ea-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="507ea-240">admin_consent</span></span> |<span data-ttu-id="507ea-241">Будет установлено слишком**true**.</span><span class="sxs-lookup"><span data-stu-id="507ea-241">Will be set too**true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="507ea-242">Сообщение об ошибке</span><span class="sxs-lookup"><span data-stu-id="507ea-242">Error response</span></span>
<span data-ttu-id="507ea-243">Здравствуйте, администратор не одобрения hello разрешений для приложения, hello сбой ответа выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="507ea-243">If hello admin does not approve hello permissions for your app, hello failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="507ea-244">Параметр</span><span class="sxs-lookup"><span data-stu-id="507ea-244">Parameter</span></span> | <span data-ttu-id="507ea-245">Описание</span><span class="sxs-lookup"><span data-stu-id="507ea-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="507ea-246">error</span><span class="sxs-lookup"><span data-stu-id="507ea-246">error</span></span> |<span data-ttu-id="507ea-247">Ошибка строка кода, который может быть используется tooclassify типы ошибок, которые возникают и может быть tooerrors используется tooreact.</span><span class="sxs-lookup"><span data-stu-id="507ea-247">An error code string that can be used tooclassify types of errors that occur, and can be used tooreact tooerrors.</span></span> |
| <span data-ttu-id="507ea-248">error_description</span><span class="sxs-lookup"><span data-stu-id="507ea-248">error_description</span></span> |<span data-ttu-id="507ea-249">Сообщение об ошибке, которые могут помочь определить причину ошибки hello разработчик.</span><span class="sxs-lookup"><span data-stu-id="507ea-249">A specific error message that can help a developer identify hello root cause of an error.</span></span> |

<span data-ttu-id="507ea-250">После получения успешного ответа от конечной точки согласия администратора hello приложение получило разрешения hello запрошенной.</span><span class="sxs-lookup"><span data-stu-id="507ea-250">After you've received a successful response from hello admin consent endpoint, your app has gained hello permissions it requested.</span></span> <span data-ttu-id="507ea-251">Далее можно запросить маркер для hello ресурс.</span><span class="sxs-lookup"><span data-stu-id="507ea-251">Next, you can request a token for hello resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="507ea-252">Использование разрешений</span><span class="sxs-lookup"><span data-stu-id="507ea-252">Using permissions</span></span>
<span data-ttu-id="507ea-253">После согласия пользователя hello toopermissions для вашего приложения ваше приложение может получить доступ токенов, представляющих tooaccess разрешение ваше приложение к ресурсу в некоторых емкости.</span><span class="sxs-lookup"><span data-stu-id="507ea-253">After hello user consents toopermissions for your app, your app can acquire access tokens that represent your app's permission tooaccess a resource in some capacity.</span></span> <span data-ttu-id="507ea-254">Маркер доступа можно использовать только для одного ресурса, но закодированные внутри hello токен доступа является каждое разрешение, которое приложение было предоставлено для этого ресурса.</span><span class="sxs-lookup"><span data-stu-id="507ea-254">An access token can be used only for a single resource, but encoded inside hello access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="507ea-255">tooacquire маркер доступа, приложение можно сделать запрос toohello v2.0 маркера конечной точки, следующим образом:</span><span class="sxs-lookup"><span data-stu-id="507ea-255">tooacquire an access token, your app can make a request toohello v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="507ea-256">Hello полученный маркер доступа можно использовать в HTTP-запросы toohello ресурс.</span><span class="sxs-lookup"><span data-stu-id="507ea-256">You can use hello resulting access token in HTTP requests toohello resource.</span></span> <span data-ttu-id="507ea-257">Указывает надежно toohello ресурсов, приложение получит разрешение tooperform hello определенной задачи.</span><span class="sxs-lookup"><span data-stu-id="507ea-257">It reliably indicates toohello resource that your app has hello proper permission tooperform a specific task.</span></span>  

<span data-ttu-id="507ea-258">Дополнительные сведения о hello OAuth 2.0 протокола и tooget маркеры доступа, в статье hello [протокола ссылки на конечную точку v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="507ea-258">For more information about hello OAuth 2.0 protocol and how tooget access tokens, see hello [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>
