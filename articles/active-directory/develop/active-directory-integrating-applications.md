---
title: "Интеграция приложений с Azure Active Directory"
description: "Сведения о том, как добавить, обновить или удалить приложение в Active Directory (Azure AD)."
services: active-directory
documentationcenter: 
author: PatAltimore
manager: mtillman
editor: mbaldwin
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 10/04/2017
ms.author: bryanla
ms.custom: aaddev
ms.reviewer: luleon
ms.openlocfilehash: e398536ff6f660c75e4e063040eab33a831d65c6
ms.sourcegitcommit: 3cdc82a5561abe564c318bd12986df63fc980a5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/05/2018
---
# <a name="integrating-applications-with-azure-active-directory"></a>Интеграция приложений с Azure Active Directory
[!INCLUDE [active-directory-devguide](../../../includes/active-directory-devguide.md)]

Разработчики корпоративных решений и поставщики программного обеспечения как услуги (SaaS) могут разрабатывать коммерческие облачные службы или бизнес-приложения, которые можно интегрировать с Azure Active Directory (Azure AD) для обеспечения безопасного входа и авторизации для служб. Чтобы интегрировать приложение или службу с Azure AD, разработчику сначала необходимо зарегистрировать приложение в Azure AD.

В этой статье показано, как добавить, обновить или удалить регистрацию приложения в Azure AD. Вы узнаете о различных типах приложений, которые можно интегрировать с Azure AD, способах настройки приложений для доступа к другим ресурсам, таким как веб-API, и многое другое.

Дополнительные сведения об объектах, которые представляют зарегистрированное приложение, и отношениях между ними см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md). Рекомендации по фирменной символике, которых следует придерживаться при разработке приложений с помощью Azure Active Directory, см. в статье [Рекомендации по фирменной символике для приложений](active-directory-branding-guidelines.md).

## <a name="adding-an-application"></a>Добавление приложения
Все приложения, которые будут использовать возможности Azure AD, сначала следует зарегистрировать в клиенте Azure AD. Этот процесс регистрации включает в себя предоставление Azure AD сведений о приложении, например URL-адреса, по которому оно расположено, URL-адреса для отправки ответов после проверки подлинности пользователя, URI, идентифицирующего приложение, и т. д.

### <a name="to-register-a-new-application-using-the-azure-portal"></a>Регистрация нового приложения с помощью портала Azure
1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, а затем выберите **Регистрация приложений** и щелкните **Регистрация нового приложения**.

   ![Регистрация нового приложения](./media/active-directory-integrating-applications/add-app-registration.png)

4. После появления страницы **Создание** введите сведения о регистрации приложения: 

  - **Имя.** Введите понятное имя для приложения.
  - **Тип приложения:** 
    - Выберите "Машинный код" для [клиентских приложений](active-directory-dev-glossary.md#client-application), которые установлены локально на устройстве. Этот параметр используется для общедоступных [собственных клиентов](active-directory-dev-glossary.md#native-client) OAuth.
    - Выберите "Веб-приложение или API" для [клиентских приложений](active-directory-dev-glossary.md#client-application) и [приложений ресурсов или API](active-directory-dev-glossary.md#resource-server), установленных на защищенном сервере. Этот параметр используется для конфиденциальных [веб-клиентов](active-directory-dev-glossary.md#web-client) и общедоступных [клиентов на основе агента пользователя](active-directory-dev-glossary.md#user-agent-based-client) OAuth. То же приложение может также предоставлять клиент и ресурс или API.
  - **URL-адрес входа**. Для приложений "Веб-приложение или API" укажите основной URL-адрес приложения. Например, `http://localhost:31544` может быть URL-адресом веб-приложения, выполняемого на локальном компьютере. Пользователи будут использовать этот URL-адрес для входа в приложение веб-клиента. 
  - **URI перенаправления**. Для приложений "Машинный код" предоставьте универсальный код ресурса (URI), используемый Azure AD для возвращения ответов маркера. Укажите значение, специфичное для вашего приложения, например `http://MyFirstAADApp`.

   ![Раздел регистрации нового приложения, кнопка "Создать"](./media/active-directory-integrating-applications/add-app-registration-create.png)

   Конкретные примеры для веб-приложений или собственных приложений см. в наших [примерах использования](active-directory-developers-guide.md#get-started).

5. По завершении нажмите кнопку **Создать**. Azure AD присвоит вашему приложению уникальный идентификатор, а затем откроется главная страница регистрации приложения. В зависимости от того, является ли ваше приложение веб-приложением или собственным приложением, будут предоставлены различные параметры для добавления дополнительных возможностей в приложение. Общие сведения о предоставлении согласия и подробности о включении дополнительных возможностей настройки при регистрации приложения (учетные данные, разрешения, включения входа для пользователей из других клиентов) см. в следующем разделе.

  > [!NOTE]
  > По умолчанию в только что зарегистрированное приложение могут входить **только** пользователи того же клиента.
  > 
  > 

## <a name="updating-an-application"></a>Обновление приложения
После регистрации приложения в Azure AD может потребоваться обновить его для предоставления доступа к веб-API, обеспечения доступа из других организаций и в других целях. В этом разделе описываются различные способы дальнейшей настройки приложения. Мы начнем с обзора платформы согласия. Ее важно понять для создания приложений, которые будут использовать другие пользователи или приложения.

### <a name="overview-of-the-consent-framework"></a>Обзор платформы согласия

Платформа согласия Azure AD позволяет легко разрабатывать мультитенантные веб-приложения и собственные клиентские приложения, включая многоуровневые приложения. Эти приложения позволяют входить в учетные записи пользователей с клиентов Azure AD, отличных от того, где было зарегистрировано приложение. Им также может потребоваться доступ к веб-API, таким как API Microsoft Graph (для доступа к Azure Active Directory, Intune и службам Office 365), и другие API-интерфейсы служб Майкрософт. Эта платформа использует согласие пользователя или администратора на регистрацию приложения в своем каталоге, что может включать в себя доступ к данным каталога.

Например, если приложению веб-клиента необходимо прочитать сведения календаря о пользователе Office 365, сначала этот пользователь должен дать согласие на использование клиентского приложения. После предоставления такого разрешения клиентское приложение сможет вызывать API Microsoft Graph от имени этого пользователя и пользоваться сведениями календаря по мере необходимости. [API Microsoft Graph](https://graph.microsoft.io) предоставляет доступ к данным в Office 365 (календарям и сообщениям Exchange, сайтам и спискам SharePoint, документам в OneDrive, записным книжкам в OneNote, задачам планировщика, книгам Excel и т. д.), а также к пользователям и группам Azure AD и другим объектам данных других облачных служб Майкрософт. 

Платформа согласия основана на OAuth 2.0 и различных его процедурах, таких как предоставление кода авторизации и учетных данных пользователя, с помощью общедоступных или конфиденциальных клиентов. Благодаря OAuth 2.0 среда Azure AD позволяет создавать множество различных клиентских приложений, например на телефоне, планшете, сервере или в Интернете, и получить доступ к необходимым ресурсам.

Дополнительные сведения об использовании платформы согласия с предоставлением авторизации OAuth 2.0 см. в статьях [Авторизация доступа к веб-приложениям с помощью OAuth 2.0 и Azure Active Directory](active-directory-protocols-oauth-code.md) и [Сценарии аутентификации в Azure Active Directory](active-directory-authentication-scenarios.md). Дополнительные сведения о получении авторизованного доступа к Office 365 через Microsoft Graph см. в статье [Get access tokens to call Microsoft Graph](https://graph.microsoft.io/docs/authorization/auth_overview) (Получение маркеров доступа для вызова Microsoft Graph).

#### <a name="example-of-the-consent-experience"></a>Пример процедуры согласия

Ниже показаны особенности работы процедуры согласия для разработчика приложений и пользователя.

1. Предположим, у вас есть приложение веб-клиента, которому необходимо запросить конкретные разрешения для получения доступа к ресурсу или API. В следующем разделе показано, как выполнить эту настройку, однако фактически портал Azure используется для объявления запросов разрешений во время настройки. Как и другие параметры конфигурации, они становятся частью регистрации Azure AD приложения:
   
  ![Разрешения для других приложений](./media/active-directory-integrating-applications/requiredpermissions.png)
    
2. Представим себе, что разрешения вашего приложения были обновлены, само приложение запущено, а пользователь собирается воспользоваться им в первый раз. Сначала приложение должно получить код авторизации из конечной точки `/authorize` Azure AD. Код авторизации можно использовать для получения новых маркеров доступа или обновления.

3. Если пользователь еще не выполнил проверку подлинности, конечная точка `/authorize` Azure AD запросит данные для входа.
   
  ![Вход пользователя или администратора в Azure AD](./media/active-directory-integrating-applications/usersignin.png)

4. После входа Azure AD определяет, требуется ли отобразить этому пользователю страницу согласия. Принятие этого решения основано на том, дал ли этот пользователь (или администратор его организации) свое согласие для приложения. Если согласие еще не было дано, Azure AD запрашивает у пользователя согласие и отображает необходимые для этого разрешения. В диалоговом окне согласия отображается тот же набор разрешений, который совпадает с набором разрешений "Делегированные разрешения" на портале Azure.
   
  ![Процедура использования согласия пользователей](./media/active-directory-integrating-applications/consent.png)

5. После того как пользователь дает свое согласие, в ваше приложение возвращается код авторизации, который используется для получения токена доступа и токена обновления. Дополнительные сведения об этой процедуре см. в разделе [Из веб-приложения в веб-интерфейс API](active-directory-authentication-scenarios.md#web-application-to-web-api).

6. Обладая правами администратора, вы можете также согласиться использовать делегированные разрешения приложения от имени всех пользователей в клиенте. Административное разрешение предотвращает появление диалогового окна согласия для каждого пользователя в клиенте и выполняется страницей приложения на [портале Azure](https://portal.azure.com). На странице **Параметры** приложения щелкните **Необходимые разрешения** и **Предоставить разрешения**. 

  ![Предоставление разрешений, на которые требуется явное согласие администратора](./media/active-directory-integrating-applications/grantpermissions.png)
    
  > [!NOTE]
  > Для одностраничных приложений (SPA), использующих ADAL.js, в данный момент требуется предоставление явного разрешения с помощью кнопки **Предоставить разрешения**. В противном случае происходит сбой приложения при запросе маркера доступа.   

### <a name="configure-a-client-application-to-access-web-apis"></a>Настройка клиентского приложения для доступа к веб-API
Чтобы клиентское веб-приложение или конфиденциальное клиентское приложение могло участвовать в потоке предоставления кода авторизации, требующего проверки подлинности (и получения маркера доступа), в нем нужно задать защищенные учетные данные. По умолчанию на портале Azure используется метод проверки подлинности "идентификатор клиента + секретный ключ". В этом разделе рассматриваются шаги настройки, необходимые для предоставления секретного ключа учетных данных клиента.

Кроме того, чтобы клиент смог получить доступ к веб-API, предоставляемому приложением ресурсов (например, API Microsoft Graph), платформа согласия должна позволить ему получить требуемое разрешение в зависимости от запрошенных разрешений. По умолчанию все приложения могут выбирать разрешения из "Windows Azure Active Directory" (Graph API) и "API управления службами Microsoft Azure". [Разрешение API Graph "Вход в систему и чтение профиля пользователя"](https://msdn.microsoft.com/Library/Azure/Ad/Graph/howto/azure-ad-graph-api-permission-scopes#PermissionScopeDetails) также будет выбрано по умолчанию. Если клиентское приложение регистрируется в клиенте, в котором есть учетные записи, подписанные на Office 365, можно выбрать веб-API и разрешения для SharePoint и Exchange Online. Можно выбрать из [двух типов разрешений](active-directory-dev-glossary.md#permissions) для каждого требуемого веб-API:

- Разрешения приложения: вашему клиентскому приложению требуется доступ к веб-API от своего имени (без контекста пользователя). Этот тип разрешения требует согласия администратора и недоступен для собственных клиентских приложений.

- Делегированное разрешение: вашему приложению требуется доступ к веб-API от лица выполнившего вход пользователя, но с ограничением доступа по выбранному разрешению. Этот тип разрешения может быть предоставлен пользователем, если только для разрешения не требуется согласие администратора. 

  > [!NOTE]
  > Добавление делегированных разрешений в приложение не предоставляет разрешения для пользователей в клиенте автоматически. Теперь пользователи должны вручную предоставлять согласие на дополнительные делегированные полномочия в процессе их использования, если администратор не нажмет кнопку **Предоставить разрешения** в разделе **Необходимые разрешения** на странице приложения на портале Azure. 

#### <a name="to-add-application-credentials-or-permissions-to-access-web-apis"></a>Добавление учетных данных приложения или разрешений для доступа к веб-API
1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и щелкните приложение, которое необходимо настроить.

   ![Обновление регистрации приложения](./media/active-directory-integrating-applications/update-app-registration.png)

4. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения. Чтобы добавить секретный ключ для учетных данных веб-приложения:
  - Щелкните раздел **Ключи** на странице **Параметры**.  
  - Добавьте описание ключа.
  - Выберите срок действия ключа (один или два года).
  - Выберите команду **Сохранить**. Когда вы сохраните изменения конфигурации, значение ключа отобразится в крайнем правом столбце. **Не забудьте скопировать ключ** для использования в коде клиентского приложения, так как он станет недоступен после выхода со страницы.

  ![Обновление регистрации приложения: ключи](./media/active-directory-integrating-applications/update-app-registration-settings-keys.png)

5. Добавление разрешений для доступа к API ресурсов из клиента
  - Щелкните раздел **Необходимые разрешения** на странице **Параметры**. 
  - Нажмите кнопку **Add** (Добавить).
  - Щелкните **Выбрать API**, чтобы выбрать требуемый тип ресурсов.
  - Просмотрите список доступных API-интерфейсов или используйте поле поиска, чтобы выбрать доступные ресурсы приложений в каталоге, предоставляющие веб-интерфейс API. Щелкните нужный ресурс, а затем — **Выбрать**.
  - Откроется страница **Разрешить доступ**. Выберите разрешения приложения или делегированные разрешения, необходимые приложению для доступа к API.
   
  ![Обновление регистрации приложения: API разрешений](./media/active-directory-integrating-applications/update-app-registration-settings-permissions-api.png)

  ![Обновление регистрации приложения: разрешения](./media/active-directory-integrating-applications/update-app-registration-settings-permissions-perms.png)

6. По завершении нажмите кнопку **Выбрать** на странице **Разрешить доступ**, а затем нажмите кнопку **Готово** на странице **Добавить доступ через API**. Откроется страница **Необходимые разрешения**, на которой новый ресурс будет добавлен в список API.

  > [!NOTE]
  > При нажатии кнопки **Готово** для приложения также автоматически задаются разрешения в каталоге на основе разрешений, которые вы задали для других приложений.  Присвоенные разрешения можно просмотреть на странице **Параметры** приложения.
  > 
  > 

### <a name="configuring-a-resource-application-to-expose-web-apis"></a>Настройка приложения ресурсов для предоставления веб-API

Вы можете разработать веб-API и сделать его доступным для клиентских приложений, предоставив [области доступа](active-directory-dev-glossary.md#scopes) и [роли](active-directory-dev-glossary.md#roles). Доступ к правильно настроенному веб-API предоставляется по аналогии с другими веб-API корпорации Майкрософт, включая API Graph и API Office 365. Области доступа и роли задаются с помощью [манифеста приложения](active-directory-dev-glossary.md#application-manifest), JSON-файла, который представляет собой конфигурацию удостоверения приложения. 

Ниже показано, как задать области доступа, изменив манифест приложения ресурсов.

#### <a name="adding-access-scopes-to-your-resource-application"></a>Добавление областей доступа в приложение ресурсов

1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.

3. В области навигации слева щелкните службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и щелкните приложение, которое необходимо настроить.

   ![Обновление регистрации приложения](./media/active-directory-integrating-applications/update-app-registration.png)

4. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения. Щелкните **Манифест** на странице регистрации приложения, чтобы перейти на страницу **Изменение манифеста**. Откроется веб-редактор манифеста, который позволяет **изменить** манифест на портале. При необходимости можно щелкнуть **Скачать** и выполнить изменение локально, а затем повторно применить его для приложения с помощью команды **Отправить**.

5. В этом примере предоставляется новая область с именем `Employees.Read.All` в ресурсе или API путем добавления следующего элемента JSON в коллекцию `oauth2Permissions`. Имеющаяся область `user_impersonation` предоставляется по умолчанию во время регистрации. `user_impersonation` позволяет приложению клиента запрашивать разрешения для доступа к ресурсу, используя удостоверение пользователя, выполнившего вход. Обязательно добавьте запятую после имеющегося элемента области `user_impersonation` и измените значения свойств в соответствии с потребностями ресурса. 

  ```json
  {
    "adminConsentDescription": "Allow the application to have read-only access to all Employee data.",
    "adminConsentDisplayName": "Read-only access to Employee records",
    "id": "2b351394-d7a7-4a84-841e-08a6a17e4cb8",
    "isEnabled": true,
    "type": "User",
    "userConsentDescription": "Allow the application to have read-only access to your Employee data.",
    "userConsentDisplayName": "Read-only access to your Employee records",
    "value": "Employees.Read.All"
  }
  ```
  > [!NOTE]
  > В качестве значения идентификатора должен выступать новый GUID, созданный с помощью инструмента создания [guidgen](https://msdn.microsoft.com/library/ms241442%28v=vs.80%29.aspx) или программно. Оно представляет уникальный идентификатор для области в качестве предоставляемого веб-API. Когда клиент соответствующим образом настроен и имеет разрешения на доступ к веб-API, Azure AD выдает маркер доступа OAuth 2.0. Во время вызова веб-API клиент предоставляет маркер доступа с утверждением области (scp), для которого заданы разрешения, запрашиваемые в его регистрации приложения.
  >
  > Позднее вы можете по мере необходимости предоставлять дополнительные области доступа. Помните о том, что веб-API может предоставлять несколько областей, связанных с множеством разных функций. Ресурс может управлять доступом к веб-API в среде выполнения, вычисляя утверждения области (`scp`) в полученном маркере доступа OAuth 2.0.
  > 

6. По завершении щелкните **Сохранить**. Теперь веб-интерфейс API настроен для использования другими приложениями в каталоге.  

  ![Обновление регистрации приложения](./media/active-directory-integrating-applications/update-app-registration-manifest.png)

#### <a name="verify-the-web-api-is-exposed-to-other-applications-in-your-tenant"></a>Для проверки доступности веб-API другим приложениям клиента
1. Вернитесь к клиенту Azure AD, щелкните **Регистрация приложений** еще раз, а затем найдите и щелкните приложение клиента, которое необходимо настроить.

   ![Обновление регистрации приложения](./media/active-directory-integrating-applications/update-app-registration.png)

2. Повторите шаг 5, как описано в разделе [Настройка клиентского приложения для доступа к веб-API](#configure-a-client-application-to-access-web-apis). По достижении шага **Выбор API** найдите свой ресурс, введя имя его приложения в поле поиска, и щелкните **Выбрать**. 

3. На странице **Разрешить доступ** отобразится новая область, доступная для запросов разрешений клиента.

  ![Отображение новых разрешений](./media/active-directory-integrating-applications/update-app-registration-settings-permissions-perms-newscopes.png)

#### <a name="more-on-the-application-manifest"></a>Дополнительная информация о манифесте приложения

На самом деле манифест приложения является механизмом обновления сущности "Приложение", который определяет все атрибуты конфигурации удостоверения приложения Azure AD, в том числе области доступа API, рассмотренные выше. Дополнительные сведения см. в разделе, посвященном сущности "Приложение" и ее схеме (в [документации по сущности "Приложение API Graph"](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity)). В этой статье вы найдете полную информацию об элементах сущности "Приложение", которые используются при указании разрешений для API, включая:  

- элемент appRoles — коллекция сущностей [AppRole](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#approle-type), которые используются при определении [разрешений приложения](active-directory-dev-glossary.md#permissions) для веб-API; 
- элемент oauth2Permissions — коллекция сущностей [OAuth2Permission](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#oauth2permission-type), которые используются при определении [делегированных разрешений](active-directory-dev-glossary.md#permissions) для веб-API.

Дополнительные сведения о концепции манифеста приложения см. в статье [Основные сведения о манифесте приложения Azure Active Directory](active-directory-application-manifest.md).

### <a name="accessing-the-azure-ad-graph-and-office-365-via-microsoft-graph-apis"></a>Доступ к Azure AD Graph и Office 365 с помощью API Microsoft Graph  

Как упоминалось ранее, наряду с предоставлением доступа к API в приложениях можно зарегистрировать клиентское приложение для доступа к API, которые предоставляются ресурсами Майкрософт. Microsoft Graph API, называемый "Microsoft Graph" в списке ресурсов и API на портале, доступно всем приложениям, зарегистрированным в Azure AD. При регистрации клиентского приложения в клиенте, который содержит учетные записи, зарегистрированные в подписке Office 365, можно получить доступ к областям, предоставляемым различными ресурсами Office 365.

Полное описание областей, предоставляемых API Microsoft Graph, см. в статье [Справочник по разрешениям Microsoft Graph](https://graph.microsoft.io/docs/authorization/permission_scopes).

> [!NOTE]
> Из-за имеющихся в данный момент ограничений собственные клиентские приложения могут вызывать API Graph Azure AD только при использовании разрешения Access your organization's directory (Доступ к каталогу организации). Это ограничение не распространяется на веб-приложения.
> 
> 

### <a name="configuring-multi-tenant-applications"></a>Настройка мультитенантных приложений

При регистрации приложения в Azure AD вам может потребоваться предоставить доступ к этому приложению только пользователям в вашей организации. Кроме того, может также потребоваться, чтобы доступ к приложению могли получить пользователи из других организаций. Два этих типа приложений называются однотенантными и мультитенантными. В этом разделе описывается, как можно изменить конфигурацию отдельного однотенантного приложения, чтобы сделать его мультитенантным.

Следует отметить различия между однотенантным и мультитенантным приложением:  

- Однотенантное (для одного клиента) приложение предназначено для использования в одной организации. Обычно это бизнес-приложения, которые создает разработчик компании. Доступ к однотенантному приложению могут получить только пользователи с учетными записями в том же клиенте, где зарегистрировано приложение. В результате его достаточно подготовить в одном каталоге.
- Мультитенантное (для нескольких клиентов) приложение предназначено для использования в нескольких организациях. Это веб-приложение категории "программное обеспечение как услуга" (SaaS) обычно создается независимым поставщиком программного обеспечения (ISV). В каждом клиенте, к которому пользователям требуется доступ, необходимо подготовить мультитенантные приложения. Для клиентов, отличных от того, где было зарегистрировано приложение, требуется согласие пользователя или администратора для их регистрации. Обратите внимание, что собственные клиентские приложения являются мультитенантными по умолчанию, так как они установлены на устройстве владельца ресурсов. Дополнительные сведения о платформе согласия см. в разделе [Обзор инфраструктуры согласия](#overview-of-the-consent-framework) выше.

Чтобы сделать приложение мультитенантным, необходимо изменение регистрации приложения, а также изменения в самом веб-приложении. В следующих разделах описываются оба требования.

#### <a name="changing-the-application-registration-to-support-multi-tenant"></a>Изменение регистрации приложения для поддержки нескольких клиентов

Если вы создаете приложение, которое будет доступно для сторонних клиентов или партнеров, следует обновить определение приложения на портале Azure.

> [!IMPORTANT]
> Для Azure AD необходимо, чтобы универсальный код ресурса (URI) идентификатора приложения для мультитенантного приложения был глобально уникальным. URI кода приложения является одним из способов идентификации приложения в сообщениях протокола. Для приложения с одним клиентом достаточно, чтобы URI кода приложения был уникальным в рамках клиента. Для мультитенантного приложения он должен быть глобально уникальным, чтобы служба Azure AD могла найти приложение по всем клиентам. Глобальная уникальность обеспечивается за счет требования, чтобы URI кода приложения имел имя узла, соответствующее проверенному домену клиента Azure AD. Например, если имя клиента — contoso.onmicrosoft.com, то допустимым URI кода приложения будет https://contoso.onmicrosoft.com/myapp. Если у клиента есть проверенный домен contoso.com, тогда допустимый URI идентификатора приложения также будет https://contoso.com/myapp. Если URI идентификатора приложения не соответствует этому шаблону, вы не сможете сделать приложение мультитенантным.
> 

Чтобы предоставить внешним пользователям возможность доступа к приложению: 

1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и щелкните приложение, которое необходимо настроить. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения.
4. На странице **Параметры** выберите **Свойства** и переведите переключатель **Мультитенантное** в положение **Да**.

После внесения изменений пользователи и администраторы в других организациях смогут предоставлять своим пользователям возможность входа в приложение, позволяя приложению получать доступ к ресурсам, которые защищены их клиентом.

#### <a name="changing-the-application-to-support-multi-tenant"></a>Изменение приложения для поддержки нескольких клиентов

Поддержка мультитенантных приложений в значительной степени зависит от платформы согласия Azure AD. Согласие — это механизм, позволяющий пользователям из другого клиента предоставлять приложению доступ к ресурсам, защищаемым клиентом пользователя. Это называется согласием пользователя.

Веб-приложения также могут предлагать:

- Возможность зарегистрировать свою организацию для администраторов. Эта возможность называется согласием администратора и позволяет ему предоставить согласие от имени *всех пользователей* организации. Только пользователь, выполняющий проверку подлинности с помощью учетной записи, принадлежащей роли глобального администратора, может предоставить согласие администратора. Остальные пользователи увидят сообщение об ошибке.

- Возможность входа для пользователей. Предполагается, что пользователю будет предоставлена кнопка "Регистрация", которая перенаправит браузер в конечную точку `/authorize` Azure AD OAuth 2.0 или в конечную точку `/userinfo` OpenID Connect. Эти конечные точки позволяют приложению получить сведения о новом пользователе путем проверки id_token. На следующем этапе регистрации пользователя появится запрос на согласие, как показано в разделе [Обзор платформы согласия](#overview-of-the-consent-framework).

Дополнительные сведения об изменениях приложения, необходимых для поддержки мультитенантного доступа и регистрации или входа, см. в следующих ресурсах:

- [Как реализовать вход любого пользователя Azure Active Directory (AD) с помощью шаблона мультитенантного приложения](active-directory-devhowto-multi-tenant-overview.md)
- Список [примеров кода мультитенантных приложений](https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multi-tenant). 
- [Краткое руководство по добавлению фирменной символики организации на страницу входа в Azure Active Directory](../customize-branding.md)

### <a name="enabling-oauth-20-implicit-grant-for-single-page-applications"></a>Включение неявного предоставления авторизации OAuth 2.0 для одностраничных приложений

В одностраничных приложениях (SPA) обычно используется клиент с большим объемом кода на JavaScript, который выполняется в браузере и вызывает веб-API серверного приложения для выполнения своих операций бизнес-логики. Для одностраничных приложений, размещенных в Azure AD, проверка подлинности пользователя в Azure AD выполняется с помощью протокола OAuth 2.0 Implicit Grant. После этого пользователь получает маркер, который можно использовать для безопасных вызовов серверного веб-API из клиентского кода JavaScript приложения. 

После того как пользователь предоставил свое согласие, этот же протокол проверки подлинности можно использовать для получения маркеров для защиты вызовов между клиентом и другими ресурсами веб-API, которые настроены для приложения. Дополнительные сведения о процессе неявного предоставления авторизации и его совместимости с вашим приложением см. в статье [Общие сведения о неявном потоке предоставления OAuth2 в Azure Active Directory (AD)](active-directory-dev-understanding-oauth2-implicit-grant.md).

По умолчанию неявное предоставление авторизации OAuth 2.0 для приложений отключено. Чтобы включить неявное разрешение OAuth 2.0 для приложения, необходимо установить значение `oauth2AllowImplicitFlow` в [манифесте приложения](active-directory-application-manifest.md).

#### <a name="to-enable-oauth-20-implicit-grant"></a>Чтобы включить неявное предоставление авторизации OAuth 2.0, выполните следующие действия.

> [!NOTE]
> Дополнительные сведения о том, как изменять манифест приложения, см. в предыдущем разделе [Настройка приложения ресурсов для предоставления веб-API](#configuring-a-resource-application-to-expose-web-apis).
>

1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и щелкните приложение, которое необходимо настроить. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения.
4. Щелкните **Манифест** на странице регистрации приложения, чтобы перейти на страницу **Изменение манифеста**. Откроется веб-редактор манифеста, который позволяет **изменить** манифест на портале. Найдите параметр oauth2AllowImplicitFlow и установите для него значение true. По умолчанию установлено значение false.
   
  ```json
  "oauth2AllowImplicitFlow": true,
  ```
5. Сохраните обновленный манифест. Теперь этот веб-интерфейс API будет использовать для аутентификации пользователей протокол OAuth 2.0 Implicit Grant.

## <a name="removing-an-application"></a>Удаление приложения
В этом разделе описывается удаление регистрации приложения из клиента Azure AD.

### <a name="removing-an-application-authored-by-your-organization"></a>Удаление приложения, созданного организацией
Приложения, зарегистрированные организацией, отображаются в категории фильтра "Мои приложения" на главной странице "Регистрация приложений" клиента. Это приложения, зарегистрированные вручную через портал Azure или программно через PowerShell или API Graph. В частности, в вашем клиенте они представлены объектами приложения и субъекта-службы. Дополнительные сведения см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md).

#### <a name="to-remove-a-single-tenant-application-from-your-directory"></a>Порядок удаления однотенантного приложения из каталога
1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и щелкните приложение, которое необходимо настроить. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения.
4. На главной странице регистрации приложения нажмите кнопку **Удалить**.
5. Нажмите кнопку **Да** в сообщении с подтверждением.

#### <a name="to-remove-a-multi-tenant-application-from-its-home-directory"></a>Удаление мультитенантного приложения из домашнего каталога
1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и щелкните приложение, которое необходимо настроить. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения.
4. На странице **Параметры** выберите **Свойства** и переключите **Мультитенантный** в положение **Нет**, чтобы сделать приложение однотенантным, а затем щелкните **Сохранить**. Объекты субъекта-службы приложения остаются в клиентах всех организаций, которые предоставили свое согласие.
5. Нажмите кнопку **Удалить** на главной странице регистрации приложения.
6. Нажмите кнопку **Да** в сообщении с подтверждением.

### <a name="removing-a-multi-tenant-application-authorized-by-another-organization"></a>Удаление мультитенантного приложения, авторизованного другой организацией
Приложения, отображаемые в категории фильтра "Все приложения" (за исключением регистраций "Мои приложения") на главной странице "Регистрация приложений" клиента, являются мультитенантными. С технической точки зрения эти мультитенантные приложения поступили из другого клиента и были зарегистрированы в вашем клиенте во время процесса предоставления разрешения. В частности, они представлены только основным объектом службы в клиенте без соответствующего объекта приложения. Дополнительные сведения о различиях между объектами приложения и субъекта-службы см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory (Azure AD)](active-directory-application-objects.md).

Чтобы удалить доступ к каталогу (после предоставления согласия) для мультитенантного приложения, администратору организации необходимо удалить субъект-службу. Чтобы удалить доступ, у администратора должен быть доступ глобального администратора и возможность удалить доступ с помощью портала Azure или [командлетов Azure AD PowerShell](http://go.microsoft.com/fwlink/?LinkId=294151).

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о принципах работы проверки подлинности в Azure AD см. в статье [Сценарии аутентификации в Azure Active Directory](active-directory-authentication-scenarios.md).
- Сведения о визуальных подсказках для вашего приложения см. в статье [Рекомендации по фирменной символике для приложений](active-directory-branding-guidelines.md).
- Дополнительные сведения о связи между объектами приложения и субъекта-службы см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md).
- Дополнительные сведения о роли манифеста приложения см. в статье [Основные сведения о манифесте приложения Azure Active Directory](active-directory-application-manifest.md).
- Определения некоторых основных понятий для разработчиков Azure Active Directory (AD) приведены в статье [Глоссарий по Azure Active Directory для разработчика](active-directory-dev-glossary.md).
- Сведения для разработчиков см. в [руководстве разработчика по Active Directory](active-directory-developers-guide.md).

