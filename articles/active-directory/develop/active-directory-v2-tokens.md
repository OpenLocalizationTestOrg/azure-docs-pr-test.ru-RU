---
title: "Справочник маркерам Azure Active Directory версии 2.0 | Документация Майкрософт"
description: "Типы маркеров и утверждений, выдаваемых конечной точкой версии 2.0"
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: dc58c282-9684-4b38-b151-f3e079f034fd
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: a3611a239fe044cf1b953220a6e96b0e101f47a4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="azure-active-directory-v20-tokens-reference"></a><span data-ttu-id="c0d99-103">Справочник маркерам Azure Active Directory версии 2.0</span><span class="sxs-lookup"><span data-stu-id="c0d99-103">Azure Active Directory v2.0 tokens reference</span></span>
<span data-ttu-id="c0d99-104">При обработке каждого [потока аутентификации](active-directory-v2-flows.md) конечная точка Azure Active Directory (Azure AD) версии 2.0 выдает маркеры безопасности различных типов.</span><span class="sxs-lookup"><span data-stu-id="c0d99-104">The Azure Active Directory (Azure AD) v2.0 endpoint emits several types of security tokens in each [authentication flow](active-directory-v2-flows.md).</span></span> <span data-ttu-id="c0d99-105">В этом справочнике описывается формат, характеристики безопасности и содержимое маркера каждого типа.</span><span class="sxs-lookup"><span data-stu-id="c0d99-105">This reference describes the format, security characteristics, and contents of each type of token.</span></span>

> [!NOTE]
> <span data-ttu-id="c0d99-106">Не все сценарии и компоненты Azure Active Directory поддерживаются конечной точкой версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-106">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="c0d99-107">Чтобы определить, стоит ли вам использовать конечную точку версии 2.0, ознакомьтесь с [ограничениями версии 2.0](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="c0d99-107">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="types-of-tokens"></a><span data-ttu-id="c0d99-108">Типы маркеров</span><span class="sxs-lookup"><span data-stu-id="c0d99-108">Types of tokens</span></span>
<span data-ttu-id="c0d99-109">Конечная точка версии 2.0 поддерживает [протокол авторизации OAuth 2.0](active-directory-v2-protocols.md), использующий как маркеры доступа, так и маркеры обновления.</span><span class="sxs-lookup"><span data-stu-id="c0d99-109">The v2.0 endpoint supports the [OAuth 2.0 authorization protocol](active-directory-v2-protocols.md), which uses access tokens and refresh tokens.</span></span> <span data-ttu-id="c0d99-110">Конечная точка версии 2.0 также поддерживает аутентификацию и вход с помощью протокола [OpenID Connect](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="c0d99-110">The v2.0 endpoint also supports authentication and sign-in via [OpenID Connect](active-directory-v2-protocols.md).</span></span> <span data-ttu-id="c0d99-111">В OpenID Connect вводится третий тип маркера — маркер идентификации.</span><span class="sxs-lookup"><span data-stu-id="c0d99-111">OpenID Connect introduces a third type of token, the ID token.</span></span> <span data-ttu-id="c0d99-112">Каждый из этих маркеров представлен как токен *носителя*.</span><span class="sxs-lookup"><span data-stu-id="c0d99-112">Each of these tokens is represented as a *bearer* token.</span></span>

<span data-ttu-id="c0d99-113">Токен носителя — это упрощенный маркер безопасности, который предоставляет носителю доступ к защищенному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="c0d99-113">A bearer token is a lightweight security token that grants the bearer access to a protected resource.</span></span> <span data-ttu-id="c0d99-114">В этом смысле носителем является любая сторона, которая может предъявить маркер.</span><span class="sxs-lookup"><span data-stu-id="c0d99-114">The bearer is any party that can present the token.</span></span> <span data-ttu-id="c0d99-115">Несмотря на то, что сторона должна пройти аутентификацию Azure AD, чтобы получить токен носителя, если не приняты меры для защиты токена во время передачи и хранения, он может быть перехвачен и использован несанкционированной стороной.</span><span class="sxs-lookup"><span data-stu-id="c0d99-115">Although a party must authenticate with Azure AD to receive the bearer token, if steps are not taken to secure the token during transmission and storage, it can be intercepted and used by an unintended party.</span></span> <span data-ttu-id="c0d99-116">В некоторых маркерах безопасности предусмотрен встроенный механизм для предотвращения использования несанкционированными сторонами, но это не относится к токенам носителя.</span><span class="sxs-lookup"><span data-stu-id="c0d99-116">Some security tokens have a built-in mechanism to prevent unauthorized parties from using them, but bearer tokens do not.</span></span> <span data-ttu-id="c0d99-117">Токены носителя должны передаваться по защищенному каналу, например по протоколу HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c0d99-117">Bearer tokens must be transported in a secure channel such as transport layer security (HTTPS).</span></span> <span data-ttu-id="c0d99-118">Если токен носителя передается без подобной защиты, то злоумышленник может использовать атаку "злоумышленник в середине", чтобы получить токен и использовать его для несанкционированного доступа к защищенному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="c0d99-118">If a bearer token is transmitted without this type of security, a malicious party could use a "man-in-the-middle attack" to acquire the token and use it for unauthorized access to a protected resource.</span></span> <span data-ttu-id="c0d99-119">Те же принципы безопасности применяются при сохранении или кэшировании маркеров носителя для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="c0d99-119">The same security principles apply when storing or caching bearer tokens for later use.</span></span> <span data-ttu-id="c0d99-120">Всегда следует убедиться, что приложение передает и сохраняет токены носителя, применяя меры безопасности.</span><span class="sxs-lookup"><span data-stu-id="c0d99-120">Always ensure that your app securely transmits and stores bearer tokens.</span></span> <span data-ttu-id="c0d99-121">Дополнительные рекомендации по защите токенов носителя см. в документе [RFC 6750, раздел 5](http://tools.ietf.org/html/rfc6750).</span><span class="sxs-lookup"><span data-stu-id="c0d99-121">For more security considerations for bearer tokens, see [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750).</span></span>

<span data-ttu-id="c0d99-122">Многие маркеры, выдаваемые конечной точкой версии 2.0, реализованы как маркеры JSON Web Token (JWT).</span><span class="sxs-lookup"><span data-stu-id="c0d99-122">Many of the tokens issued by the v2.0 endpoint are implemented as JSON Web Tokens (JWTs).</span></span> <span data-ttu-id="c0d99-123">JWT — это компактное и безопасное для URL-адреса средство передачи информации между двумя сторонами.</span><span class="sxs-lookup"><span data-stu-id="c0d99-123">A JWT is a compact, URL-safe way to transfer information between two parties.</span></span> <span data-ttu-id="c0d99-124">Сведения, содержащиеся в JWT, называются *утверждением*.</span><span class="sxs-lookup"><span data-stu-id="c0d99-124">The information in a JWT is called a *claim*.</span></span> <span data-ttu-id="c0d99-125">Это утверждение информации о носителе и субъекте маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-125">It's an assertion of information about the bearer and subject of the token.</span></span> <span data-ttu-id="c0d99-126">Утверждения в JWT — это объекты JSON, закодированные и сериализованные для передачи.</span><span class="sxs-lookup"><span data-stu-id="c0d99-126">The claims in a JWT are JavaScript Object Notation (JSON) objects that are encoded and serialized for transmission.</span></span> <span data-ttu-id="c0d99-127">Так как выдаваемые конечной точкой версии 2.0 маркеры JWT подписываются, но не шифруются, их содержимое можно без труда изучить с целью отладки.</span><span class="sxs-lookup"><span data-stu-id="c0d99-127">Because the JWTs issued by the v2.0 endpoint are signed but not encrypted, you can easily inspect the contents of a JWT for debugging purposes.</span></span> <span data-ttu-id="c0d99-128">Дополнительные сведения о маркерах JWT см. в [спецификациях JWT](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html).</span><span class="sxs-lookup"><span data-stu-id="c0d99-128">For more information about JWTs, see the [JWT specification](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html).</span></span>

### <a name="id-tokens"></a><span data-ttu-id="c0d99-129">Маркеры идентификации</span><span class="sxs-lookup"><span data-stu-id="c0d99-129">ID tokens</span></span>
<span data-ttu-id="c0d99-130">Маркер идентификации — это разновидность маркера безопасности входа, который приложение получает при аутентификации с использованием [OpenID Connect](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="c0d99-130">An ID token is a form of sign-in security token that your app receives when it performs authentication by using [OpenID Connect](active-directory-v2-protocols.md).</span></span> <span data-ttu-id="c0d99-131">Маркеры идентификации представлены в виде [маркеров JWT](#types-of-tokens) и содержат утверждения, которые можно использовать для входа пользователя в приложение.</span><span class="sxs-lookup"><span data-stu-id="c0d99-131">ID tokens are represented as [JWTs](#types-of-tokens), and they contain claims that you can use to sign the user in to your app.</span></span> <span data-ttu-id="c0d99-132">Утверждения, которые содержит маркер идентификации, можно использовать по-разному.</span><span class="sxs-lookup"><span data-stu-id="c0d99-132">You can use the claims in an ID token in various ways.</span></span> <span data-ttu-id="c0d99-133">Как правило, администраторы используют маркеры идентификации для отображения сведений об учетной записи или принятия решений о контроле доступа в приложении.</span><span class="sxs-lookup"><span data-stu-id="c0d99-133">Typically, admins use ID tokens to display account information or to make access control decisions in an app.</span></span> <span data-ttu-id="c0d99-134">Конечная точка версии 2.0 выдает маркер идентификации только одного типа, который содержит согласованный набор утверждений независимо от типа вошедшего пользователя.</span><span class="sxs-lookup"><span data-stu-id="c0d99-134">The v2.0 endpoint issues only one type of ID token, which has a consistent set of claims, regardless of the type of user that is signed in.</span></span> <span data-ttu-id="c0d99-135">Формат и содержимое маркеров идентификации одинаковы для пользователей как с личными учетными записями Майкрософт, так и с рабочими или учебными учетными записями.</span><span class="sxs-lookup"><span data-stu-id="c0d99-135">The format and content of ID tokens are the same for personal Microsoft account users and for work or school accounts.</span></span>

<span data-ttu-id="c0d99-136">На текущий момент маркеры идентификации подписываются, но не шифруются.</span><span class="sxs-lookup"><span data-stu-id="c0d99-136">Currently, ID tokens are signed but not encrypted.</span></span> <span data-ttu-id="c0d99-137">Когда приложение получает маркер идентификации, оно должно [проверить подпись](#validating-tokens), чтобы подтвердить подлинность маркера, и проверить несколько содержащихся в нем утверждений для подтверждения его действительности.</span><span class="sxs-lookup"><span data-stu-id="c0d99-137">When your app receives an ID token, it must [validate the signature](#validating-tokens) to prove the token's authenticity and validate a few claims in the token to prove its validity.</span></span> <span data-ttu-id="c0d99-138">Утверждения, которые проверяет приложение, зависят от требований сценария, но некоторые [стандартные проверки утверждений](#validating-tokens) приложение должно выполнять в каждом сценарии.</span><span class="sxs-lookup"><span data-stu-id="c0d99-138">The claims validated by an app vary depending on scenario requirements, but your app must perform some [common claim validations](#validating-tokens) in every scenario.</span></span>

<span data-ttu-id="c0d99-139">Мы предоставляем полные сведения об утверждениях в маркерах идентификации и пример такого маркера в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="c0d99-139">We give you the full details about claims in ID tokens in the following sections, in addition to a sample ID token.</span></span> <span data-ttu-id="c0d99-140">Обратите внимание, что утверждения в маркерах идентификации не возвращаются в определенном порядке.</span><span class="sxs-lookup"><span data-stu-id="c0d99-140">Note that claims in ID tokens are not returned in a specific order.</span></span> <span data-ttu-id="c0d99-141">Кроме того, новые утверждения могут появиться в маркерах идентификации в любое время.</span><span class="sxs-lookup"><span data-stu-id="c0d99-141">Also, new claims can be introduced into ID tokens at any time.</span></span> <span data-ttu-id="c0d99-142">Ваше приложение не должно прерывать работу при появлении новых утверждений.</span><span class="sxs-lookup"><span data-stu-id="c0d99-142">Your app should not break when new claims are introduced.</span></span> <span data-ttu-id="c0d99-143">В следующем списке приведены утверждения, которые приложение гарантированно интерпретирует на текущий момент.</span><span class="sxs-lookup"><span data-stu-id="c0d99-143">The following list includes the claims that your app currently can reliably interpret.</span></span> <span data-ttu-id="c0d99-144">Дополнительные сведения можно найти в [спецификации OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html).</span><span class="sxs-lookup"><span data-stu-id="c0d99-144">You can find more details in the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span>

#### <a name="sample-id-token"></a><span data-ttu-id="c0d99-145">Пример маркера идентификации</span><span class="sxs-lookup"><span data-stu-id="c0d99-145">Sample ID token</span></span>
```
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiI2NzMxZGU3Ni0xNGE2LTQ5YWUtOTdiYy02ZWJhNjkxNDM5MWUiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vYjk0MTk4MTgtMDlhZi00OWMyLWIwYzMtNjUzYWRjMWYzNzZlL3YyLjAiLCJpYXQiOjE0NTIyODUzMzEsIm5iZiI6MTQ1MjI4NTMzMSwiZXhwIjoxNDUyMjg5MjMxLCJuYW1lIjoiQmFiZSBSdXRoIiwibm9uY2UiOiIxMjM0NSIsIm9pZCI6ImExZGJkZGU4LWU0ZjktNDU3MS1hZDkzLTMwNTllMzc1MGQyMyIsInByZWZlcnJlZF91c2VybmFtZSI6InRoZWdyZWF0YmFtYmlub0BueXkub25taWNyb3NvZnQuY29tIiwic3ViIjoiTUY0Zi1nZ1dNRWppMTJLeW5KVU5RWnBoYVVUdkxjUXVnNWpkRjJubDAxUSIsInRpZCI6ImI5NDE5ODE4LTA5YWYtNDljMi1iMGMzLTY1M2FkYzFmMzc2ZSIsInZlciI6IjIuMCJ9.p_rYdrtJ1oCmgDBggNHB9O38KTnLCMGbMDODdirdmZbmJcTHiZDdtTc-hguu3krhbtOsoYM2HJeZM3Wsbp_YcfSKDY--X_NobMNsxbT7bqZHxDnA2jTMyrmt5v2EKUnEeVtSiJXyO3JWUq9R0dO-m4o9_8jGP6zHtR62zLaotTBYHmgeKpZgTFB9WtUq8DVdyMn_HSvQEfz-LWqckbcTwM_9RNKoGRVk38KChVJo4z5LkksYRarDo8QgQ7xEKmYmPvRr_I7gvM2bmlZQds2OeqWLB1NSNbFZqyFOCgYn3bAQ-nEQSKwBaA36jYGPOVG2r2Qv1uKcpSOxzxaQybzYpQ
```

> [!TIP]
> <span data-ttu-id="c0d99-146">Чтобы в целях обучения изучить утверждения в примере маркера идентификации, вставьте его в файл [calebb.net](http://calebb.net/).</span><span class="sxs-lookup"><span data-stu-id="c0d99-146">For practice, to inspect the claims in the sample ID token, paste the sample ID token into [calebb.net](http://calebb.net/).</span></span>
>
>

#### <a name="claims-in-id-tokens"></a><span data-ttu-id="c0d99-147">Утверждения в маркерах идентификации</span><span class="sxs-lookup"><span data-stu-id="c0d99-147">Claims in ID tokens</span></span>
| <span data-ttu-id="c0d99-148">Имя</span><span class="sxs-lookup"><span data-stu-id="c0d99-148">Name</span></span> | <span data-ttu-id="c0d99-149">Утверждение</span><span class="sxs-lookup"><span data-stu-id="c0d99-149">Claim</span></span> | <span data-ttu-id="c0d99-150">Пример значения</span><span class="sxs-lookup"><span data-stu-id="c0d99-150">Example value</span></span> | <span data-ttu-id="c0d99-151">Описание</span><span class="sxs-lookup"><span data-stu-id="c0d99-151">Description</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="c0d99-152">audience</span><span class="sxs-lookup"><span data-stu-id="c0d99-152">audience</span></span> |`aud` |`6731de76-14a6-49ae-97bc-6eba6914391e` |<span data-ttu-id="c0d99-153">Определяет целевого получателя маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-153">Identifies the intended recipient of the token.</span></span> <span data-ttu-id="c0d99-154">В маркерах идентификации целевая аудитория обозначена идентификатором приложения, назначенным ему на портале регистрации приложений Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c0d99-154">In ID tokens, the audience is your app's Application ID, assigned to your app in the Microsoft Application Registration Portal.</span></span> <span data-ttu-id="c0d99-155">Приложение должно проверить это значение и отклонить маркер, если он ему не соответствует.</span><span class="sxs-lookup"><span data-stu-id="c0d99-155">Your app should validate this value, and reject the token if the value does not match.</span></span> |
| <span data-ttu-id="c0d99-156">issuer</span><span class="sxs-lookup"><span data-stu-id="c0d99-156">issuer</span></span> |`iss` |`https://login.microsoftonline.com/b9419818-09af-49c2-b0c3-653adc1f376e/v2.0 ` |<span data-ttu-id="c0d99-157">Определяет службу маркеров безопасности (STS), которая создает и возвращает маркер, а также клиент Azure AD, в котором пользователь прошел аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="c0d99-157">Identifies the security token service (STS) that constructs and returns the token, and the Azure AD tenant in which the user was authenticated.</span></span> <span data-ttu-id="c0d99-158">Приложение должно проверить утверждение издателя и убедиться, что маркер пришел от конечной точки версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-158">Your app should validate the issuer claim to ensure that the token came from the v2.0 endpoint.</span></span> <span data-ttu-id="c0d99-159">Ему также следует использовать часть утверждения, содержащую GUID, для ограничения списка клиентов, которым разрешено входить в приложение.</span><span class="sxs-lookup"><span data-stu-id="c0d99-159">It also should use the GUID portion of the claim to restrict the set of tenants that can sign in to the app.</span></span> <span data-ttu-id="c0d99-160">GUID, который указывает, что пользователь является потребителем с учетной записью Майкрософт: `9188040d-6c67-4c5b-b112-36a304b66dad`.</span><span class="sxs-lookup"><span data-stu-id="c0d99-160">The GUID that indicates that the user is a consumer user from a Microsoft account is `9188040d-6c67-4c5b-b112-36a304b66dad`.</span></span> |
| <span data-ttu-id="c0d99-161">issued at</span><span class="sxs-lookup"><span data-stu-id="c0d99-161">issued at</span></span> |`iat` |`1452285331` |<span data-ttu-id="c0d99-162">Время выдачи маркера в виде времени эпохи.</span><span class="sxs-lookup"><span data-stu-id="c0d99-162">The time at which the token was issued, represented in epoch time.</span></span> |
| <span data-ttu-id="c0d99-163">expiration time</span><span class="sxs-lookup"><span data-stu-id="c0d99-163">expiration time</span></span> |`exp` |`1452289231` |<span data-ttu-id="c0d99-164">Время окончания срока действия маркера в виде времени эпохи.</span><span class="sxs-lookup"><span data-stu-id="c0d99-164">The time at which the token becomes invalid, represented in epoch time.</span></span> <span data-ttu-id="c0d99-165">Приложение должно использовать это утверждение для проверки действительности срока действия маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-165">Your app should use this claim to verify the validity of the token lifetime.</span></span> |
| <span data-ttu-id="c0d99-166">not before</span><span class="sxs-lookup"><span data-stu-id="c0d99-166">not before</span></span> |`nbf` |`1452285331` |<span data-ttu-id="c0d99-167">Время начала срока действия маркера в виде времени эпохи.</span><span class="sxs-lookup"><span data-stu-id="c0d99-167">The time at which the token becomes valid, represented in epoch time.</span></span> <span data-ttu-id="c0d99-168">Обычно оно совпадает со временем выдачи.</span><span class="sxs-lookup"><span data-stu-id="c0d99-168">It is usually the same as the issuance time.</span></span> <span data-ttu-id="c0d99-169">Приложение должно использовать это утверждение для проверки действительности срока действия маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-169">Your app should use this claim to verify the validity of the token lifetime.</span></span> |
| <span data-ttu-id="c0d99-170">версия</span><span class="sxs-lookup"><span data-stu-id="c0d99-170">version</span></span> |`ver` |`2.0` |<span data-ttu-id="c0d99-171">Версия маркера идентификации, как указано в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c0d99-171">The version of the ID token, as defined by Azure AD.</span></span> <span data-ttu-id="c0d99-172">Для конечной точки версии 2.0 используется значение `2.0`.</span><span class="sxs-lookup"><span data-stu-id="c0d99-172">For the v2.0 endpoint, the value is `2.0`.</span></span> |
| <span data-ttu-id="c0d99-173">tenant ID</span><span class="sxs-lookup"><span data-stu-id="c0d99-173">tenant ID</span></span> |`tid` |`b9419818-09af-49c2-b0c3-653adc1f376e` |<span data-ttu-id="c0d99-174">Идентификатор GUID, представляющий клиент Azure AD пользователя.</span><span class="sxs-lookup"><span data-stu-id="c0d99-174">A GUID that represents the Azure AD tenant that the user is from.</span></span> <span data-ttu-id="c0d99-175">Для рабочих и учебных учетных записей значением GUID является неизменяемый идентификатор клиента организации, к которой принадлежит пользователь.</span><span class="sxs-lookup"><span data-stu-id="c0d99-175">For work and school accounts, the GUID is the immutable tenant ID of the organization that the user belongs to.</span></span> <span data-ttu-id="c0d99-176">Для личных учетных записей значением является `9188040d-6c67-4c5b-b112-36a304b66dad`.</span><span class="sxs-lookup"><span data-stu-id="c0d99-176">For personal accounts, the value is `9188040d-6c67-4c5b-b112-36a304b66dad`.</span></span> <span data-ttu-id="c0d99-177">Чтобы получить это утверждение, необходимо указать область `profile` .</span><span class="sxs-lookup"><span data-stu-id="c0d99-177">The `profile` scope is required in order to receive this claim.</span></span> |
| <span data-ttu-id="c0d99-178">code hash</span><span class="sxs-lookup"><span data-stu-id="c0d99-178">code hash</span></span> |`c_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |<span data-ttu-id="c0d99-179">Хэш-код включается в состав маркеров идентификации, только если маркер идентификации выдается вместе с кодом авторизации OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-179">The code hash is included in ID tokens only when the ID token is issued with an OAuth 2.0 authorization code.</span></span> <span data-ttu-id="c0d99-180">Его можно использовать для проверки подлинности кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="c0d99-180">It can be used to validate the authenticity of an authorization code.</span></span> <span data-ttu-id="c0d99-181">Дополнительные сведения о выполнении этой проверки можно найти в [спецификации OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) .</span><span class="sxs-lookup"><span data-stu-id="c0d99-181">For details about performing this validation, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span> |
| <span data-ttu-id="c0d99-182">access token hash</span><span class="sxs-lookup"><span data-stu-id="c0d99-182">access token hash</span></span> |`at_hash` |`SGCPtt01wxwfgnYZy2VJtQ` |<span data-ttu-id="c0d99-183">Хэш маркера доступа включается в состав маркеров идентификации, только если маркер выдается вместе с маркером доступа OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-183">The access token hash is included in ID tokens only when the ID token is issued with an OAuth 2.0 access token.</span></span> <span data-ttu-id="c0d99-184">Его можно использовать для проверки подлинности маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="c0d99-184">It can be used to validate the authenticity of an access token.</span></span> <span data-ttu-id="c0d99-185">Дополнительные сведения о выполнении этой проверки можно найти в [спецификации OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) .</span><span class="sxs-lookup"><span data-stu-id="c0d99-185">For details about performing this validation, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html).</span></span> |
| <span data-ttu-id="c0d99-186">nonce</span><span class="sxs-lookup"><span data-stu-id="c0d99-186">nonce</span></span> |`nonce` |`12345` |<span data-ttu-id="c0d99-187">Специальные утверждения используются для предотвращения атак с использованием воспроизведения маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-187">The nonce is a strategy for mitigating token replay attacks.</span></span> <span data-ttu-id="c0d99-188">Приложение может указать специальное утверждение в запросе авторизации с помощью параметра запроса `nonce` .</span><span class="sxs-lookup"><span data-stu-id="c0d99-188">Your app can specify a nonce in an authorization request by using the `nonce` query parameter.</span></span> <span data-ttu-id="c0d99-189">Значение, указанное вами в запросе, будет использовано в утверждении `nonce` маркера идентификации без изменений.</span><span class="sxs-lookup"><span data-stu-id="c0d99-189">The value you provide in the request is emitted in the ID token's `nonce` claim, unmodified.</span></span> <span data-ttu-id="c0d99-190">Приложение может проверить это значение на соответствие значению, указанному в запросе, которое связывает сеанс приложения с определенным маркером идентификации.</span><span class="sxs-lookup"><span data-stu-id="c0d99-190">Your app can verify the value against the value it specified on the request, which associates the app's session with a specific ID token.</span></span> <span data-ttu-id="c0d99-191">Приложение должно выполнять эту проверку во время проверки маркера идентификации.</span><span class="sxs-lookup"><span data-stu-id="c0d99-191">Your app should perform this validation during the ID token validation process.</span></span> |
| <span data-ttu-id="c0d99-192">name</span><span class="sxs-lookup"><span data-stu-id="c0d99-192">name</span></span> |`name` |`Babe Ruth` |<span data-ttu-id="c0d99-193">Утверждение name предоставляет удобное для восприятия значение, определяющее субъект маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-193">The name claim provides a human-readable value that identifies the subject of the token.</span></span> <span data-ttu-id="c0d99-194">Это значение не обязательно должно быть уникальным. Оно изменяемое и предназначено только для отображения.</span><span class="sxs-lookup"><span data-stu-id="c0d99-194">The value is not guaranteed to be unique, it is mutable, and it's designed to be used only for display purposes.</span></span> <span data-ttu-id="c0d99-195">Чтобы получить это утверждение, необходимо указать область `profile` .</span><span class="sxs-lookup"><span data-stu-id="c0d99-195">The `profile` scope is required in order to receive this claim.</span></span> |
| <span data-ttu-id="c0d99-196">email</span><span class="sxs-lookup"><span data-stu-id="c0d99-196">email</span></span> |`email` |`thegreatbambino@nyy.onmicrosoft.com` |<span data-ttu-id="c0d99-197">Основной адрес электронной почты, связанный с учетной записью пользователя (если она существует).</span><span class="sxs-lookup"><span data-stu-id="c0d99-197">The primary email address associated with the user account, if one exists.</span></span> <span data-ttu-id="c0d99-198">Его значение не является неизменяемым и может меняться с течением времени.</span><span class="sxs-lookup"><span data-stu-id="c0d99-198">Its value is mutable and might change over time.</span></span> <span data-ttu-id="c0d99-199">Чтобы получить это утверждение, необходимо указать область `email` .</span><span class="sxs-lookup"><span data-stu-id="c0d99-199">The `email` scope is required in order to receive this claim.</span></span> |
| <span data-ttu-id="c0d99-200">preferred username</span><span class="sxs-lookup"><span data-stu-id="c0d99-200">preferred username</span></span> |`preferred_username` |`thegreatbambino@nyy.onmicrosoft.com` |<span data-ttu-id="c0d99-201">Основное имя пользователя, представляющее пользователя на конечной точке версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-201">The primary username that represents the user in the v2.0 endpoint.</span></span> <span data-ttu-id="c0d99-202">Это может быть адрес электронной почты, телефонный номер или универсальное имя пользователя без определенного формата.</span><span class="sxs-lookup"><span data-stu-id="c0d99-202">It could be an email address, phone number, or a generic username without a specified format.</span></span> <span data-ttu-id="c0d99-203">Его значение не является неизменяемым и может меняться с течением времени.</span><span class="sxs-lookup"><span data-stu-id="c0d99-203">Its value is mutable and might change over time.</span></span> <span data-ttu-id="c0d99-204">Чтобы получить это утверждение, необходимо указать область `profile` .</span><span class="sxs-lookup"><span data-stu-id="c0d99-204">The `profile` scope is required in order to receive this claim.</span></span> |
| <span data-ttu-id="c0d99-205">subject</span><span class="sxs-lookup"><span data-stu-id="c0d99-205">subject</span></span> |`sub` |`MF4f-ggWMEji12KynJUNQZphaUTvLcQug5jdF2nl01Q` | <span data-ttu-id="c0d99-206">Субъект, в отношении которого маркер утверждает сведения, например данные о пользователе приложения.</span><span class="sxs-lookup"><span data-stu-id="c0d99-206">The principal about which the token asserts information, such as the user of an app.</span></span> <span data-ttu-id="c0d99-207">Это значение является неизменяемым и не может быть переназначено или повторно использовано.</span><span class="sxs-lookup"><span data-stu-id="c0d99-207">This value is immutable and cannot be reassigned or reused.</span></span> <span data-ttu-id="c0d99-208">Это значение можно использовать для безопасных проверок авторизации, например, когда маркер используется для доступа к ресурсу, а также в качестве ключа в таблицах базы данных.</span><span class="sxs-lookup"><span data-stu-id="c0d99-208">It can be used to perform authorization checks safely, such as when the token is used to access a resource, and can be used as a key in database tables.</span></span> <span data-ttu-id="c0d99-209">Так как субъект всегда присутствует в выдаваемых Azure AD маркерах, мы советуем использовать это значение в системе авторизации общего назначения.</span><span class="sxs-lookup"><span data-stu-id="c0d99-209">Because the subject is always present in the tokens that Azure AD issues, we recommend using this value in a general-purpose authorization system.</span></span> <span data-ttu-id="c0d99-210">Тем не менее субъект — это попарный идентификатор, который является уникальным для конкретного приложения.</span><span class="sxs-lookup"><span data-stu-id="c0d99-210">The subject is, however, a pairwise identifier - it is unique to a particular application ID.</span></span>  <span data-ttu-id="c0d99-211">Если один пользователь войдет в два различных приложения с помощью двух разных идентификаторов клиента, эти приложения получат два разных значения в утверждении субъекта.</span><span class="sxs-lookup"><span data-stu-id="c0d99-211">Therefore, if a single user signs into two different apps using two different client IDs, those apps will receive two different values for the subject claim.</span></span>  <span data-ttu-id="c0d99-212">Это может быть или не быть необходимым в зависимости от требований архитектуры и конфиденциальности.</span><span class="sxs-lookup"><span data-stu-id="c0d99-212">This may or may not be desired depending on your architecture and privacy requirements.</span></span> |
| <span data-ttu-id="c0d99-213">object ID</span><span class="sxs-lookup"><span data-stu-id="c0d99-213">object ID</span></span> |`oid` |`a1dbdde8-e4f9-4571-ad93-3059e3750d23` | <span data-ttu-id="c0d99-214">Неизменяемый идентификатор объекта в системе идентификации Майкрософт. В данном случае это учетная запись пользователя.</span><span class="sxs-lookup"><span data-stu-id="c0d99-214">The immutable identifier for an object in the Microsoft identity system, in this case, a user account.</span></span>  <span data-ttu-id="c0d99-215">Его можно использовать для безопасных проверок авторизации, а также в качестве ключа в таблицах базы данных.</span><span class="sxs-lookup"><span data-stu-id="c0d99-215">It can also be used to perform authorization checks safely and as a key in database tables.</span></span> <span data-ttu-id="c0d99-216">Этот идентификатор уникально идентифицирует пользователя в приложениях. Если один пользователь войдет в два различных приложения с помощью двух разных идентификаторов клиента, эти приложения получат одинаковое значение в утверждении `oid`.</span><span class="sxs-lookup"><span data-stu-id="c0d99-216">This ID uniquely identifies the user across applications - two different applications signing in the same user will receive the same value in the `oid` claim.</span></span>  <span data-ttu-id="c0d99-217">Это означает, что он может использоваться при выполнении запросов к Microsoft Online Services, например Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="c0d99-217">This means that it can be used when making queries to Microsoft online services, such as the Microsoft Graph.</span></span>  <span data-ttu-id="c0d99-218">Microsoft Graph возвратит этот идентификатор в качестве свойства `id` указанной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="c0d99-218">The Microsoft Graph will return this ID as the `id` property for a given user account.</span></span>  <span data-ttu-id="c0d99-219">Так как `oid` позволяет нескольким приложениям сопоставлять пользователей, для получения этого утверждения необходимо указать область `profile`.</span><span class="sxs-lookup"><span data-stu-id="c0d99-219">Because the `oid` allows multiple apps to correlate users, the `profile` scope is required in order to receive this claim.</span></span> <span data-ttu-id="c0d99-220">Обратите внимание, что если один пользователь существует в нескольких клиентах, его учетная запись в каждом клиенте будет содержать разные идентификаторы объекта. Такие учетные записи считаются разными, даже если пользователь входит в каждую из них с помощью одних учетных данных.</span><span class="sxs-lookup"><span data-stu-id="c0d99-220">Note that if a single user exists in multiple tenants, the user will contain a different object ID in each tenant - they are considered different accounts, even though the user logs into each account with the same credentials.</span></span> |

### <a name="access-tokens"></a><span data-ttu-id="c0d99-221">Маркеры доступа</span><span class="sxs-lookup"><span data-stu-id="c0d99-221">Access tokens</span></span>
<span data-ttu-id="c0d99-222">В настоящее время маркеры доступа, выдаваемые конечной точкой версии 2.0, могут использоваться только службами Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c0d99-222">Currently, access tokens issued by the v2.0 endpoint can be consumed only by Microsoft Services.</span></span> <span data-ttu-id="c0d99-223">В рамках поддерживаемых в настоящее время сценариев приложениям не требуется выполнять проверку или изучение маркеров доступа.</span><span class="sxs-lookup"><span data-stu-id="c0d99-223">Your apps shouldn't need to perform any validation or inspection of access tokens for any of the currently supported scenarios.</span></span> <span data-ttu-id="c0d99-224">Их можно рассматривать как полностью непрозрачные маркеры.</span><span class="sxs-lookup"><span data-stu-id="c0d99-224">You can treat access tokens as completely opaque.</span></span> <span data-ttu-id="c0d99-225">Это просто строки, которые ваше приложение может передать в корпорацию Майкрософт в HTTP-запросах.</span><span class="sxs-lookup"><span data-stu-id="c0d99-225">They are just strings that your app can pass to Microsoft in HTTP requests.</span></span>

<span data-ttu-id="c0d99-226">В ближайшем будущем конечная точка версии 2.0 позволит приложениям получать маркеры доступа от других клиентов.</span><span class="sxs-lookup"><span data-stu-id="c0d99-226">In the near future, the v2.0 endpoint will introduce the ability for your app to receive access tokens from other clients.</span></span> <span data-ttu-id="c0d99-227">После появления такой возможности в этот справочный раздел будет добавлена необходимая информация о проверке подлинности маркера доступа в приложении и других похожих задачах.</span><span class="sxs-lookup"><span data-stu-id="c0d99-227">At that time, the information in this reference topic will be updated with the information that you need for your app to perform access token validation and other similar tasks.</span></span>

<span data-ttu-id="c0d99-228">Когда вы запрашиваете маркер доступа у конечной точки версии 2.0, она также возвращает приложению некоторые метаданные о маркере доступа.</span><span class="sxs-lookup"><span data-stu-id="c0d99-228">When you request an access token from the v2.0 endpoint, the v2.0 endpoint also returns metadata about the access token for your app to use.</span></span> <span data-ttu-id="c0d99-229">Эти сведения включают время окончания срока действия маркера доступа и области, для которых он действителен.</span><span class="sxs-lookup"><span data-stu-id="c0d99-229">This information includes the expiry time of the access token and the scopes for which it is valid.</span></span> <span data-ttu-id="c0d99-230">С помощью этих метаданных приложение может выполнять интеллектуальное кэширование маркеров доступа без необходимости анализа самого маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-230">Your app uses this metadata to perform intelligent caching of access tokens without having to parse open the access token itself.</span></span>

### <a name="refresh-tokens"></a><span data-ttu-id="c0d99-231">Маркеры обновления</span><span class="sxs-lookup"><span data-stu-id="c0d99-231">Refresh tokens</span></span>
<span data-ttu-id="c0d99-232">Маркеры обновления — это маркеры безопасности, которые приложение может использовать для получения новых маркеров доступа в потоке OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-232">Refresh tokens are security tokens that your app can use to get new access tokens in an OAuth 2.0 flow.</span></span> <span data-ttu-id="c0d99-233">Используя маркеры обновления, приложение может получить долговременный доступ к ресурсам от имени пользователя без необходимости взаимодействия с этим пользователем.</span><span class="sxs-lookup"><span data-stu-id="c0d99-233">Your app can use refresh tokens to achieve long-term access to resources on behalf of a user without requiring interaction with the user.</span></span>

<span data-ttu-id="c0d99-234">Маркеры обновления относятся к нескольким ресурсам.</span><span class="sxs-lookup"><span data-stu-id="c0d99-234">Refresh tokens are multi-resource.</span></span> <span data-ttu-id="c0d99-235">Маркер обновления, полученный при запросе маркера для одного ресурса, можно обменять на маркеры доступа к совершенно другому ресурсу.</span><span class="sxs-lookup"><span data-stu-id="c0d99-235">A refresh token received during a token request for one resource can be redeemed for access tokens to a completely different resource.</span></span>

<span data-ttu-id="c0d99-236">Чтобы получить маркер обновления в ответе маркера, приложение должно запросить область `offline_acesss` и получить соответствующие разрешения.</span><span class="sxs-lookup"><span data-stu-id="c0d99-236">To receive a refresh in a token response, your app must request and be granted the `offline_acesss` scope.</span></span> <span data-ttu-id="c0d99-237">Дополнительные сведения об области `offline_access` можно найти в [этой статье о предоставлении разрешений и областях](active-directory-v2-scopes.md).</span><span class="sxs-lookup"><span data-stu-id="c0d99-237">To learn more about the `offline_access` scope, see the [consent and scopes](active-directory-v2-scopes.md) article.</span></span>

<span data-ttu-id="c0d99-238">Маркеры обновления абсолютно непрозрачны для приложения и всегда будут таковыми.</span><span class="sxs-lookup"><span data-stu-id="c0d99-238">Refresh tokens are, and always will be, completely opaque to your app.</span></span> <span data-ttu-id="c0d99-239">Они выдаются конечной точкой версии 2.0 Azure AD, и только эта точка может проверять и интерпретировать их.</span><span class="sxs-lookup"><span data-stu-id="c0d99-239">They are issued by the Azure AD v2.0 endpoint and can only be inspected and interpreted by the v2.0 endpoint.</span></span> <span data-ttu-id="c0d99-240">Они действительны в течение продолжительного времени, но при создании приложение не следует ожидать, что срок действия маркера обновления неограничен.</span><span class="sxs-lookup"><span data-stu-id="c0d99-240">They are long-lived, but your app should not be written to expect that a refresh token will last for any period of time.</span></span> <span data-ttu-id="c0d99-241">Маркеры обновления могут стать недействительными в любое время по разным причинам.</span><span class="sxs-lookup"><span data-stu-id="c0d99-241">Refresh tokens can be invalidated at any moment for various reasons.</span></span> <span data-ttu-id="c0d99-242">Единственный способ, которым приложение может выяснить, является ли маркер действительным, — попытаться использовать его путем отправки запроса маркера на конечную точку версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-242">The only way for your app to know if a refresh token is valid is to attempt to redeem it by making a token request to the v2.0 endpoint.</span></span>

<span data-ttu-id="c0d99-243">При обмене маркера обновления на новый маркер доступа (если при этом приложению предоставлена область `offline_access`) вы получите новый маркер обновления в ответе маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-243">When you redeem a refresh token for a new access token (and if your app had been granted the `offline_access` scope), you receive a new refresh token in the token response.</span></span> <span data-ttu-id="c0d99-244">Сохраните новый маркер обновления, чтобы заменить им использованный в запросе.</span><span class="sxs-lookup"><span data-stu-id="c0d99-244">Save the newly issued refresh token, to replace the one you used in the request.</span></span> <span data-ttu-id="c0d99-245">Такой подход обеспечит максимальный срок действия маркеров обновления.</span><span class="sxs-lookup"><span data-stu-id="c0d99-245">This guarantees that your refresh tokens remain valid for as long as possible.</span></span>

## <a name="validating-tokens"></a><span data-ttu-id="c0d99-246">Проверка маркеров</span><span class="sxs-lookup"><span data-stu-id="c0d99-246">Validating tokens</span></span>
<span data-ttu-id="c0d99-247">В настоящее время приложениям нужно проверять только маркеры идентификации.</span><span class="sxs-lookup"><span data-stu-id="c0d99-247">Currently, the only token validation your apps should need to perform is validating ID tokens.</span></span> <span data-ttu-id="c0d99-248">Для проверки маркера идентификации приложение должно проверить подпись маркера идентификации содержащиеся в нем утверждения.</span><span class="sxs-lookup"><span data-stu-id="c0d99-248">To validate an ID token, your app should validate both the ID token's signature and the claims in the ID token.</span></span>

<!-- TODO: Link -->
<span data-ttu-id="c0d99-249">Корпорация Майкрософт предоставляет библиотеки и примеры кода, демонстрирующие удобство выполнения проверки маркеров.</span><span class="sxs-lookup"><span data-stu-id="c0d99-249">Microsoft provides libraries and code samples that show you how to easily handle token validation.</span></span> <span data-ttu-id="c0d99-250">В следующих разделах описывается базовый процесс.</span><span class="sxs-lookup"><span data-stu-id="c0d99-250">In the next sections, we describe the underlying process.</span></span> <span data-ttu-id="c0d99-251">Кроме того, доступно несколько сторонних библиотек с открытым кодом для проверки JWT.</span><span class="sxs-lookup"><span data-stu-id="c0d99-251">Several third-party open-source libraries also are available for JWT validation.</span></span> <span data-ttu-id="c0d99-252">Существует по крайней мере одна библиотека практически для каждой платформы и языка.</span><span class="sxs-lookup"><span data-stu-id="c0d99-252">There's at least one library option for almost every platform and language.</span></span>

### <a name="validate-the-signature"></a><span data-ttu-id="c0d99-253">проверяют его подпись</span><span class="sxs-lookup"><span data-stu-id="c0d99-253">Validate the signature</span></span>
<span data-ttu-id="c0d99-254">Маркер JWT содержит три сегмента, разделенных символом `.` .</span><span class="sxs-lookup"><span data-stu-id="c0d99-254">A JWT contains three segments, which are separated by the `.` character.</span></span> <span data-ttu-id="c0d99-255">Первый сегмент называется *заголовком*, второй — *текстом*, а третий — *подписью*.</span><span class="sxs-lookup"><span data-stu-id="c0d99-255">The first segment is known as the *header*, the second segment is the *body*, and the third segment is the *signature*.</span></span> <span data-ttu-id="c0d99-256">Сегмент подписи можно использовать для проверки подлинности маркера идентификации, чтобы приложение доверяло ему.</span><span class="sxs-lookup"><span data-stu-id="c0d99-256">The signature segment can be used to validate the authenticity of the ID token so that it can be trusted by your app.</span></span>

<span data-ttu-id="c0d99-257">Маркеры идентификации подписываются при помощи стандартных отраслевых алгоритмов асимметричного шифрования, таких как RSA 256.</span><span class="sxs-lookup"><span data-stu-id="c0d99-257">ID tokens are signed by using industry-standard asymmetric encryption algorithms, such as RSA 256.</span></span> <span data-ttu-id="c0d99-258">Заголовок маркера идентификации содержит сведения о ключе и методе шифрования, использованных для подписания маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-258">The header of the ID token has information about the key and encryption method used to sign the token.</span></span> <span data-ttu-id="c0d99-259">Например:</span><span class="sxs-lookup"><span data-stu-id="c0d99-259">For example:</span></span>

```
{
  "typ": "JWT",
  "alg": "RS256",
  "kid": "MnC_VZcATfM5pOYiJHMba9goEKY"
}
```

<span data-ttu-id="c0d99-260">Утверждение `alg` обозначает алгоритм, с помощью которого был подписан маркер.</span><span class="sxs-lookup"><span data-stu-id="c0d99-260">The `alg` claim indicates the algorithm that was used to sign the token.</span></span> <span data-ttu-id="c0d99-261">Утверждение `kid` обозначает открытый ключ, с помощью которого был подписан маркер.</span><span class="sxs-lookup"><span data-stu-id="c0d99-261">The `kid` claim indicates the public key that was used to sign the token.</span></span>

<span data-ttu-id="c0d99-262">В любой момент времени конечная точка версии 2.0 может подписать маркер идентификации с использованием любой пары открытого и закрытого ключей из определенного их набора.</span><span class="sxs-lookup"><span data-stu-id="c0d99-262">At any time, the v2.0 endpoint might sign an ID token by using any one of a specific set of public-private key pairs.</span></span> <span data-ttu-id="c0d99-263">Конечная точка версии 2.0 периодически изменяет возможный набор ключей, поэтому при создании приложения необходимо обеспечить автоматическую обработку подобных изменений ключей.</span><span class="sxs-lookup"><span data-stu-id="c0d99-263">The v2.0 endpoint periodically rotates the possible set of keys, so your app should be written to handle those key changes automatically.</span></span> <span data-ttu-id="c0d99-264">Рекомендуется проверять наличие обновлений открытых ключей, используемых конечной точкой версии 2.0, каждые 24 часа.</span><span class="sxs-lookup"><span data-stu-id="c0d99-264">A reasonable frequency to check for updates to the public keys used by the v2.0 endpoint is every 24 hours.</span></span>

<span data-ttu-id="c0d99-265">Данные ключа подписи, необходимые для проверки подписи, можно найти в документе метаданных OpenID Connect по приведенной ниже ссылке.</span><span class="sxs-lookup"><span data-stu-id="c0d99-265">You can acquire the signing key data that you need to validate the signature by using the OpenID Connect metadata document located at:</span></span>

```
https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration
```

> [!TIP]
> <span data-ttu-id="c0d99-266">Попробуйте ввести этот URL-адрес в браузере.</span><span class="sxs-lookup"><span data-stu-id="c0d99-266">Try the URL in a browser!</span></span>
>
>

<span data-ttu-id="c0d99-267">Этот документ метаданных представляет собой объект JSON, содержащий несколько ценных блоков информации, таких как расположение различных конечных точек, необходимых для аутентификации OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="c0d99-267">This metadata document is a JSON object that has several useful pieces of information, such as the location of the various endpoints required for OpenID Connect authentication.</span></span>  <span data-ttu-id="c0d99-268">Документ также содержит *jwks_uri*, который указывает расположение набора открытых ключей, использованных для подписания маркеров.</span><span class="sxs-lookup"><span data-stu-id="c0d99-268">The document also includes a *jwks_uri*, which gives the location of the set of public keys used to sign tokens.</span></span> <span data-ttu-id="c0d99-269">Документ JSON, указанный в jwks_uri, содержит все сведения об открытом ключе, который используется в настоящий момент.</span><span class="sxs-lookup"><span data-stu-id="c0d99-269">The JSON document located at the jwks_uri has all the public key information that is currently in use.</span></span> <span data-ttu-id="c0d99-270">Приложение может использовать утверждение `kid` в заголовке JWT, чтобы выбрать в этом документе открытый ключ, использованный для подписания маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-270">Your app can use the `kid` claim in the JWT header to select which public key in this document has been used to sign a token.</span></span> <span data-ttu-id="c0d99-271">Затем оно может проверить подпись с использованием правильного открытого ключа и указанного алгоритма.</span><span class="sxs-lookup"><span data-stu-id="c0d99-271">It then performs signature validation by using the correct public key and the indicated algorithm.</span></span>

<span data-ttu-id="c0d99-272">Выполнение проверки подписи выходит за рамки этого документа.</span><span class="sxs-lookup"><span data-stu-id="c0d99-272">Performing signature validation is outside the scope of this document.</span></span> <span data-ttu-id="c0d99-273">Для этого можно использовать многие библиотеки с открытым кодом.</span><span class="sxs-lookup"><span data-stu-id="c0d99-273">Many open-source libraries are available to help you with this.</span></span>

### <a name="validate-the-claims"></a><span data-ttu-id="c0d99-274">Проверка утверждений</span><span class="sxs-lookup"><span data-stu-id="c0d99-274">Validate the claims</span></span>
<span data-ttu-id="c0d99-275">Когда приложение получает маркер идентификации после входа пользователя, ему также требуется выполнить несколько проверок утверждений в этом маркере.</span><span class="sxs-lookup"><span data-stu-id="c0d99-275">When your app receives an ID token upon user sign-in, it should also perform a few checks against the claims in the ID token.</span></span> <span data-ttu-id="c0d99-276">Помимо прочего, к ним относятся:</span><span class="sxs-lookup"><span data-stu-id="c0d99-276">These include but are not limited to:</span></span>

* <span data-ttu-id="c0d99-277">Утверждение **audience**. Необходимо для подтверждения того, что маркер идентификации действительно должен был быть выдан вашему приложению.</span><span class="sxs-lookup"><span data-stu-id="c0d99-277">**audience** claim, to verify that the ID token was intended to be given to your app</span></span>
* <span data-ttu-id="c0d99-278">Утверждения **not before** и **expiration time**. Необходимы для подтверждения того, что срок действия маркера идентификации не истек.</span><span class="sxs-lookup"><span data-stu-id="c0d99-278">**not before** and **expiration time** claims, to verify that the ID token has not expired</span></span>
* <span data-ttu-id="c0d99-279">Утверждение **issuer**. Необходимо для подтверждения того, что маркер был выдан приложению конечной точкой версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-279">**issuer** claim, to verify that the token was issued to your app by the v2.0 endpoint</span></span>
* <span data-ttu-id="c0d99-280">Утверждение **nonce**. Необходимо для предотвращения атак с использованием воспроизведения маркеров.</span><span class="sxs-lookup"><span data-stu-id="c0d99-280">**nonce**, as a token replay attack mitigation</span></span>

<span data-ttu-id="c0d99-281">Полный список проверок утверждений, которые должно выполнять ваше приложение, представлен в [спецификации OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation).</span><span class="sxs-lookup"><span data-stu-id="c0d99-281">For a full list of claim validations that your app should perform, see the [OpenID Connect specification](http://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation).</span></span>

<span data-ttu-id="c0d99-282">Подробные сведения об ожидаемых значениях этих утверждений можно найти в разделе о [маркерах идентификации](# ID tokens).</span><span class="sxs-lookup"><span data-stu-id="c0d99-282">Details of the expected values for these claims are included in the [ID tokens](# ID tokens) section.</span></span>

## <a name="token-lifetimes"></a><span data-ttu-id="c0d99-283">Время существования маркеров</span><span class="sxs-lookup"><span data-stu-id="c0d99-283">Token lifetimes</span></span>
<span data-ttu-id="c0d99-284">Значения времени существования маркеров приводятся только для ознакомления.</span><span class="sxs-lookup"><span data-stu-id="c0d99-284">We provide the following token lifetimes for your information only.</span></span> <span data-ttu-id="c0d99-285">Они могут помочь при разработке и отладке приложений.</span><span class="sxs-lookup"><span data-stu-id="c0d99-285">The information might help you as you develop and debug apps.</span></span> <span data-ttu-id="c0d99-286">При создании приложений не следует ожидать, что какое-либо из указанных значений времени существования будет постоянным.</span><span class="sxs-lookup"><span data-stu-id="c0d99-286">Your apps should not be written to expect any of these lifetimes to remain constant.</span></span> <span data-ttu-id="c0d99-287">Время существования маркеров может изменяться в любое время, что и будет происходить.</span><span class="sxs-lookup"><span data-stu-id="c0d99-287">Token lifetimes can and will change at any time.</span></span>

| <span data-ttu-id="c0d99-288">Маркер</span><span class="sxs-lookup"><span data-stu-id="c0d99-288">Token</span></span> | <span data-ttu-id="c0d99-289">Срок действия</span><span class="sxs-lookup"><span data-stu-id="c0d99-289">Lifetime</span></span> | <span data-ttu-id="c0d99-290">Описание</span><span class="sxs-lookup"><span data-stu-id="c0d99-290">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c0d99-291">Маркеры идентификации (рабочие или учебные учетные записи)</span><span class="sxs-lookup"><span data-stu-id="c0d99-291">ID tokens (work or school accounts)</span></span> |<span data-ttu-id="c0d99-292">1 час</span><span class="sxs-lookup"><span data-stu-id="c0d99-292">1 hour</span></span> |<span data-ttu-id="c0d99-293">Как правило, маркеры идентификации действительны в течение часа.</span><span class="sxs-lookup"><span data-stu-id="c0d99-293">ID tokens typically are valid for 1 hour.</span></span> <span data-ttu-id="c0d99-294">Веб-приложение может использовать то же время существования в рамках собственного сеанса пользователя (рекомендуется) или выбрать совершенно другое время существования сеанса.</span><span class="sxs-lookup"><span data-stu-id="c0d99-294">Your web app can use this same lifetime to maintain its own session with the user (recommended), or you can choose a completely different session lifetime.</span></span> <span data-ttu-id="c0d99-295">Если приложению требуется получить новый маркер идентификации, ему потребуется отправить новый запрос на вход к конечной точке авторизации версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-295">If your app needs to get a new ID token, it needs to make a new sign-in request to the v2.0 authorize endpoint.</span></span> <span data-ttu-id="c0d99-296">Если у пользователя запущен действительный сеанс браузера с конечной точкой версии 2.0, возможно, вводить учетные данные повторно не придется.</span><span class="sxs-lookup"><span data-stu-id="c0d99-296">If the user has a valid browser session with the v2.0 endpoint, the user might not be required to enter their credentials again.</span></span> |
| <span data-ttu-id="c0d99-297">Маркеры идентификации (личные учетные записи)</span><span class="sxs-lookup"><span data-stu-id="c0d99-297">ID tokens (personal accounts)</span></span> |<span data-ttu-id="c0d99-298">24 часа</span><span class="sxs-lookup"><span data-stu-id="c0d99-298">24 hours</span></span> |<span data-ttu-id="c0d99-299">Маркеры идентификации для личных учетных записей обычно действительны в течение 24 часов.</span><span class="sxs-lookup"><span data-stu-id="c0d99-299">ID tokens for personal accounts typically are valid for 24 hours.</span></span> <span data-ttu-id="c0d99-300">Веб-приложение может использовать то же время существования в рамках собственного сеанса пользователя (рекомендуется) или выбрать совершенно другое время существования сеанса.</span><span class="sxs-lookup"><span data-stu-id="c0d99-300">Your web app can use this same lifetime to maintain its own session with the user (recommended), or you can choose a completely different session lifetime.</span></span> <span data-ttu-id="c0d99-301">Если приложению требуется получить новый маркер идентификации, ему потребуется отправить новый запрос на вход к конечной точке авторизации версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="c0d99-301">If your app needs to get a new ID token, it needs to make a new sign-in request to the v2.0 authorize endpoint.</span></span> <span data-ttu-id="c0d99-302">Если у пользователя запущен действительный сеанс браузера с конечной точкой версии 2.0, возможно, вводить учетные данные повторно не придется.</span><span class="sxs-lookup"><span data-stu-id="c0d99-302">If the user has a valid browser session with the v2.0 endpoint, the user might not be required to enter their credentials again.</span></span> |
| <span data-ttu-id="c0d99-303">Маркеры доступа (рабочие или учебные учетные записи)</span><span class="sxs-lookup"><span data-stu-id="c0d99-303">Access tokens (work or school accounts)</span></span> |<span data-ttu-id="c0d99-304">1 час</span><span class="sxs-lookup"><span data-stu-id="c0d99-304">1 hour</span></span> |<span data-ttu-id="c0d99-305">Указывается в ответах маркера как часть метаданных маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-305">Indicated in token responses as part of the token metadata.</span></span> |
| <span data-ttu-id="c0d99-306">Маркеры доступа (личные учетные записи)</span><span class="sxs-lookup"><span data-stu-id="c0d99-306">Access tokens (personal accounts)</span></span> |<span data-ttu-id="c0d99-307">1 час</span><span class="sxs-lookup"><span data-stu-id="c0d99-307">1 hour</span></span> |<span data-ttu-id="c0d99-308">Указывается в ответах маркера как часть метаданных маркера.</span><span class="sxs-lookup"><span data-stu-id="c0d99-308">Indicated in token responses as part of the token metadata.</span></span> <span data-ttu-id="c0d99-309">Срок действия маркеров доступа, выданных от имени личных учетных записей, можно изменить, но обычно он составляет один час.</span><span class="sxs-lookup"><span data-stu-id="c0d99-309">Access tokens that are issued on behalf of personal accounts can be configured for a different lifetime, but 1 hour is typical.</span></span> |
| <span data-ttu-id="c0d99-310">Маркеры обновления (рабочая или учебная учетная запись)</span><span class="sxs-lookup"><span data-stu-id="c0d99-310">Refresh tokens (work or school account)</span></span> |<span data-ttu-id="c0d99-311">До 14 дней</span><span class="sxs-lookup"><span data-stu-id="c0d99-311">Up to 14 days</span></span> |<span data-ttu-id="c0d99-312">Один маркер обновления действителен до 14 дней.</span><span class="sxs-lookup"><span data-stu-id="c0d99-312">A single refresh token is valid for a maximum of 14 days.</span></span> <span data-ttu-id="c0d99-313">Однако маркер обновления может стать недействительным в любое время по различным причинам, поэтому приложению следует использовать маркер обновления, пока срок его действия не истечет, либо пока приложение не заменит его новым маркером.</span><span class="sxs-lookup"><span data-stu-id="c0d99-313">However, the refresh token might become invalid at any time for various reasons, so your app should continue to try to use a refresh token until it fails, or until your app replaces it with a new refresh token.</span></span> <span data-ttu-id="c0d99-314">Маркер обновления также становится недействительным, если последний раз пользователь вводил учетные данные более 90 дней назад.</span><span class="sxs-lookup"><span data-stu-id="c0d99-314">A refresh token also becomes invalid if it has been 90 days since the user has entered their credentials.</span></span> |
| <span data-ttu-id="c0d99-315">Маркеры обновления (личные учетные записи)</span><span class="sxs-lookup"><span data-stu-id="c0d99-315">Refresh tokens (personal accounts)</span></span> |<span data-ttu-id="c0d99-316">До 1 года</span><span class="sxs-lookup"><span data-stu-id="c0d99-316">Up to 1 year</span></span> |<span data-ttu-id="c0d99-317">Один маркер обновления действителен до 1 года.</span><span class="sxs-lookup"><span data-stu-id="c0d99-317">A single refresh token is valid for a maximum of 1 year.</span></span> <span data-ttu-id="c0d99-318">Однако маркер обновления может стать недействительным в любое время по различным причинам, поэтому приложению следует использовать маркер обновления, пока срок его действия не истечет.</span><span class="sxs-lookup"><span data-stu-id="c0d99-318">However, the refresh token might become invalid at any time for various reasons, so your app should continue to try to use a refresh token until it fails.</span></span> |
| <span data-ttu-id="c0d99-319">Коды авторизации (рабочие или учебные учетные записи)</span><span class="sxs-lookup"><span data-stu-id="c0d99-319">Authorization codes (work or school accounts)</span></span> |<span data-ttu-id="c0d99-320">10 минут</span><span class="sxs-lookup"><span data-stu-id="c0d99-320">10 minutes</span></span> |<span data-ttu-id="c0d99-321">Срок действия кодов авторизации специально ограничен, поэтому сразу же по получении маркеров их следует обменивать на маркеры доступа и обновления.</span><span class="sxs-lookup"><span data-stu-id="c0d99-321">Authorization codes are purposely short-lived, and should be immediately redeemed for access tokens and refresh tokens when the tokens are received.</span></span> |
| <span data-ttu-id="c0d99-322">Коды авторизации (личные учетные записи)</span><span class="sxs-lookup"><span data-stu-id="c0d99-322">Authorization codes (personal accounts)</span></span> |<span data-ttu-id="c0d99-323">5 мин</span><span class="sxs-lookup"><span data-stu-id="c0d99-323">5 minutes</span></span> |<span data-ttu-id="c0d99-324">Срок действия кодов авторизации специально ограничен, поэтому сразу же по получении маркеров их следует обменивать на маркеры доступа и обновления.</span><span class="sxs-lookup"><span data-stu-id="c0d99-324">Authorization codes are purposely short-lived, and should be immediately redeemed for access tokens and refresh tokens when the tokens are received.</span></span> <span data-ttu-id="c0d99-325">Коды авторизации, выданные от имени личных учетных записей, являются одноразовыми.</span><span class="sxs-lookup"><span data-stu-id="c0d99-325">Authorization codes that are issued on behalf of personal accounts are for one-time use.</span></span> |
