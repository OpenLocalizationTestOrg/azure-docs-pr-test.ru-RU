---
title: "Сценарии для Azure AD aaaAuthentication | Документы Microsoft"
description: "Общие сведения о hello пяти наиболее распространенных сценариев проверки подлинности для Azure Active Directory (AAD)"
services: active-directory
documentationcenter: dev-center-name
author: skwan
manager: mbaldwin
editor: 
ms.assetid: 0c84e7d0-16aa-4897-82f2-f53c6c990fd9
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/27/2017
ms.author: skwan
ms.custom: aaddev
ms.openlocfilehash: 5b391e3f096fcb52934c4a8aff08688352bfd3dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="authentication-scenarios-for-azure-ad"></a><span data-ttu-id="9506f-103">Сценарии аутентификации в Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9506f-103">Authentication Scenarios for Azure AD</span></span>
<span data-ttu-id="9506f-104">Azure Active Directory (Azure AD) упрощает проверку подлинности для разработчиков, предоставляя удостоверение как служба, поддерживающая для стандартных протоколов, таких как OAuth 2.0 и OpenID Connect, а также для разных платформ toohelp библиотеки c открытым исходным быстро начать кодирование.</span><span class="sxs-lookup"><span data-stu-id="9506f-104">Azure Active Directory (Azure AD) simplifies authentication for developers by providing identity as a service, with support for industry-standard protocols such as OAuth 2.0 and OpenID Connect, as well as open source libraries for different platforms toohelp you start coding quickly.</span></span> <span data-ttu-id="9506f-105">Этот документ поможет понять hello поддерживает различные сценарии Azure AD и мы покажем, как tooget запущена.</span><span class="sxs-lookup"><span data-stu-id="9506f-105">This document will help you understand hello various scenarios Azure AD supports and will show you how tooget started.</span></span> <span data-ttu-id="9506f-106">Он состоит из hello в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="9506f-106">It’s divided into hello following sections:</span></span>

* [<span data-ttu-id="9506f-107">Основы проверки подлинности в Azure AD</span><span class="sxs-lookup"><span data-stu-id="9506f-107">Basics of Authentication in Azure AD</span></span>](#basics-of-authentication-in-azure-ad)
* [<span data-ttu-id="9506f-108">Утверждения в маркерах безопасности Azure AD</span><span class="sxs-lookup"><span data-stu-id="9506f-108">Claims in Azure AD Security Tokens</span></span>](#claims-in-azure-ad-security-tokens)
* [<span data-ttu-id="9506f-109">Основные сведения о регистрации приложения в Azure AD</span><span class="sxs-lookup"><span data-stu-id="9506f-109">Basics of Registering an Application in Azure AD</span></span>](#basics-of-registering-an-application-in-azure-ad)
* [<span data-ttu-id="9506f-110">Типы приложений и сценарии</span><span class="sxs-lookup"><span data-stu-id="9506f-110">Application Types and Scenarios</span></span>](#application-types-and-scenarios)
  
  * [<span data-ttu-id="9506f-111">Веб-браузер tooWeb приложения</span><span class="sxs-lookup"><span data-stu-id="9506f-111">Web Browser tooWeb Application</span></span>](#web-browser-to-web-application)
  * [<span data-ttu-id="9506f-112">Одностраничное приложение (SPA)</span><span class="sxs-lookup"><span data-stu-id="9506f-112">Single Page Application (SPA)</span></span>](#single-page-application-spa)
  * [<span data-ttu-id="9506f-113">TooWeb собственного приложения API</span><span class="sxs-lookup"><span data-stu-id="9506f-113">Native Application tooWeb API</span></span>](#native-application-to-web-api)
  * [<span data-ttu-id="9506f-114">Веб-приложения tooWeb API</span><span class="sxs-lookup"><span data-stu-id="9506f-114">Web Application tooWeb API</span></span>](#web-application-to-web-api)
  * [<span data-ttu-id="9506f-115">Управляющая программа или серверное приложение tooWeb API</span><span class="sxs-lookup"><span data-stu-id="9506f-115">Daemon or Server Application tooWeb API</span></span>](#daemon-or-server-application-to-web-api)

## <a name="basics-of-authentication-in-azure-ad"></a><span data-ttu-id="9506f-116">Основы проверки подлинности в Azure AD</span><span class="sxs-lookup"><span data-stu-id="9506f-116">Basics of Authentication in Azure AD</span></span>
<span data-ttu-id="9506f-117">Если вы не знакомы с основными концепциями процесса проверки подлинности в Azure AD, прочтите этот раздел.</span><span class="sxs-lookup"><span data-stu-id="9506f-117">If you are unfamiliar with basic concepts of authentication in Azure AD, read this section.</span></span> <span data-ttu-id="9506f-118">В противном случае вы можете tooskip вниз слишком[типы приложений и сценарии](#application-types-and-scenarios).</span><span class="sxs-lookup"><span data-stu-id="9506f-118">Otherwise, you may want tooskip down too[Application Types and Scenarios](#application-types-and-scenarios).</span></span>

<span data-ttu-id="9506f-119">Давайте рассмотрим hello основных сценариев, где требуется удостоверение: пользователю в веб-браузере требуется tooauthenticate tooa веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-119">Let’s consider hello most basic scenario where identity is required: a user in a web browser needs tooauthenticate tooa web application.</span></span> <span data-ttu-id="9506f-120">Данный сценарий описывается более подробно в hello [tooWeb веб-браузере приложений](#web-browser-to-web-application) раздела, но и тот же запуск точки tooillustrate hello возможности Azure AD и объяснить, как работает сценарий hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-120">This scenario is described in greater detail in hello [Web Browser tooWeb Application](#web-browser-to-web-application) section, but it’s a useful starting point tooillustrate hello capabilities of Azure AD and conceptualize how hello scenario works.</span></span> <span data-ttu-id="9506f-121">Примите во внимание следующие схемы для этого сценария hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-121">Consider hello following diagram for this scenario:</span></span>

![Обзор tooweb входа приложения](./media/active-directory-authentication-scenarios/basics_of_auth_in_aad.png)

<span data-ttu-id="9506f-123">С диаграммой hello выше в виду, вот что нужно tooknow о его компонентов:</span><span class="sxs-lookup"><span data-stu-id="9506f-123">With hello diagram above in mind, here’s what you need tooknow about its various components:</span></span>

* <span data-ttu-id="9506f-124">Azure AD — hello поставщик удостоверений, отвечающий по проверке hello удостоверений пользователей и приложений, которые существуют в каталоге организации и выдающий токены безопасности после успешной проверки подлинности этих пользователей и приложений.</span><span class="sxs-lookup"><span data-stu-id="9506f-124">Azure AD is hello identity provider, responsible for verifying hello identity of users and applications that exist in an organization’s directory, and ultimately issuing security tokens upon successful authentication of those users and applications.</span></span>
* <span data-ttu-id="9506f-125">Приложение, желающее tooAzure toooutsource проверки подлинности AD должны регистрироваться в Azure AD, который регистрирует и уникально идентифицирует приложение hello в каталоге hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-125">An application that wants toooutsource authentication tooAzure AD must be registered in Azure AD, which registers and uniquely identifies hello app in hello directory.</span></span>
* <span data-ttu-id="9506f-126">Разработчики могут использовать hello Azure AD с открытым кодом библиотеки toomake проверка подлинности легко путем обработки деталей протокола hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-126">Developers can use hello open source Azure AD authentication libraries toomake authentication easy by handling hello protocol details for you.</span></span> <span data-ttu-id="9506f-127">Дополнительные сведения см. в статье [Библиотеки проверки подлинности в Azure Active Directory](active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="9506f-127">See [Azure Active Directory Authentication Libraries](active-directory-authentication-libraries.md) for more information.</span></span>

<span data-ttu-id="9506f-128">• Один раз пользователь прошел проверку подлинности, приложение hello должно проверить tooensure токена безопасности пользователя hello успешности проверки подлинности для hello сторон.</span><span class="sxs-lookup"><span data-stu-id="9506f-128">• Once a user has been authenticated, hello application must validate hello user’s security token tooensure that authentication was successful for hello intended parties.</span></span> <span data-ttu-id="9506f-129">Разработчики могут использовать hello, предоставляемые проверки toohandle библиотеки проверки подлинности любого токена от Azure AD, включая веб-токены JSON (JWT) и SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="9506f-129">Developers can use hello provided authentication libraries toohandle validation of any token from Azure AD, including JSON Web Tokens (JWT) or SAML 2.0.</span></span> <span data-ttu-id="9506f-130">Если требуется проверка tooperform вручную, см. раздел hello [обработчик токенов JWT](https://msdn.microsoft.com/library/dn205065.aspx) документации.</span><span class="sxs-lookup"><span data-stu-id="9506f-130">If you want tooperform validation manually, see hello [JWT Token Handler](https://msdn.microsoft.com/library/dn205065.aspx) documentation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9506f-131">Azure AD использует шифрование с открытым ключом toosign токены и убедитесь, что они являются допустимыми.</span><span class="sxs-lookup"><span data-stu-id="9506f-131">Azure AD uses public key cryptography toosign tokens and verify that they are valid.</span></span> <span data-ttu-id="9506f-132">В разделе [важные сведения о подписи смене ключей в Azure AD](active-directory-signing-key-rollover.md) Дополнительные сведения о hello необходимую логику, необходимо иметь в tooensure вашего приложения он всегда обновляется hello последние ключи.</span><span class="sxs-lookup"><span data-stu-id="9506f-132">See [Important Information About Signing Key Rollover in Azure AD](active-directory-signing-key-rollover.md) for more information on hello necessary logic you must have in your application tooensure it’s always updated with hello latest keys.</span></span>
> 
> 

<span data-ttu-id="9506f-133">• hello поток запросов и ответов для процесса проверки подлинности hello определяется hello протокол проверки подлинности, который был использован, таким как OAuth 2.0, OpenID Connect, WS-Federation и SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="9506f-133">• hello flow of requests and responses for hello authentication process is determined by hello authentication protocol that was used, such as OAuth 2.0, OpenID Connect, WS-Federation, or SAML 2.0.</span></span> <span data-ttu-id="9506f-134">Эти протоколы рассматриваются более подробно в hello [протоколы проверки подлинности Azure Active Directory](active-directory-authentication-protocols.md) разделе и в следующих разделах hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-134">These protocols are discussed in more detail in hello [Azure Active Directory Authentication Protocols](active-directory-authentication-protocols.md) topic and in hello sections below.</span></span>

> [!NOTE]
> <span data-ttu-id="9506f-135">Azure AD поддерживает hello OAuth 2.0 и OpenID Connect стандарты, которые широко используют токены носителя, включая токены носителя, представленные как JWT.</span><span class="sxs-lookup"><span data-stu-id="9506f-135">Azure AD supports hello OAuth 2.0 and OpenID Connect standards that make extensive use of bearer tokens, including bearer tokens represented as JWTs.</span></span> <span data-ttu-id="9506f-136">Токен носителя — это упрощенный токен безопасности, предоставляет hello tooa доступа «bearer» защищенный ресурс.</span><span class="sxs-lookup"><span data-stu-id="9506f-136">A bearer token is a lightweight security token that grants hello “bearer” access tooa protected resource.</span></span> <span data-ttu-id="9506f-137">В этом смысле hello «bearer» является любая сторона, которая может предъявить токен hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-137">In this sense, hello “bearer” is any party that can present hello token.</span></span> <span data-ttu-id="9506f-138">На то, что субъект должен сначала пройти проверку подлинности с помощью Azure AD токен носителя tooreceive hello, hello требуемые действия не предпринимаются токен toosecure hello в передачи и хранения, его можно перехват и использовать несанкционированной стороной.</span><span class="sxs-lookup"><span data-stu-id="9506f-138">Though a party must first authenticate with Azure AD tooreceive hello bearer token, if hello required steps are not taken toosecure hello token in transmission and storage, it can be intercepted and used by an unintended party.</span></span> <span data-ttu-id="9506f-139">Хотя в некоторых маркерах безопасности для предотвращения несанкционированного использования применяется специальный встроенный механизм, в токенах носителя такого механизма нет, и они должны передаваться по защищенному каналу, например с использованием стандарта безопасности транспортного уровня (HTTPS).</span><span class="sxs-lookup"><span data-stu-id="9506f-139">While some security tokens have a built-in mechanism for preventing unauthorized parties from using them, bearer tokens do not have this mechanism and must be transported in a secure channel such as transport layer security (HTTPS).</span></span> <span data-ttu-id="9506f-140">Если токен носителя, передается в очистить hello, атаке hello man в среднем может использоваться токеном злоумышленник tooacquire hello и использовать его для несанкционированного доступа tooa защищенного ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-140">If a bearer token is transmitted in hello clear, a man-in hello middle attack can be used by a malicious party tooacquire hello token and use it for an unauthorized access tooa protected resource.</span></span> <span data-ttu-id="9506f-141">Hello те же принципы безопасности применяются при сохранении или кэшировании токенов носителя для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="9506f-141">hello same security principles apply when storing or caching bearer tokens for later use.</span></span> <span data-ttu-id="9506f-142">Необходимо всегда проверять, что приложение передает и сохраняет маркеры носителя безопасным образом.</span><span class="sxs-lookup"><span data-stu-id="9506f-142">Always ensure that your application transmits and stores bearer tokens in a secure manner.</span></span> <span data-ttu-id="9506f-143">Дополнительные сведения о безопасности в случае применения токенов носителя см. в [RFC 6750, раздел 5](http://tools.ietf.org/html/rfc6750).</span><span class="sxs-lookup"><span data-stu-id="9506f-143">For more security considerations on bearer tokens, see [RFC 6750 Section 5](http://tools.ietf.org/html/rfc6750).</span></span>
> 
> 

<span data-ttu-id="9506f-144">Теперь, после обзора основ hello, чтение hello разделов ниже toounderstand как работает Подготовка в Azure AD и hello распространенные сценарии поддерживает Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-144">Now that you have an overview of hello basics, read hello sections below toounderstand how provisioning works in Azure AD and hello common scenarios Azure AD supports.</span></span>

## <a name="claims-in-azure-ad-security-tokens"></a><span data-ttu-id="9506f-145">Утверждения в маркерах безопасности Azure AD</span><span class="sxs-lookup"><span data-stu-id="9506f-145">Claims in Azure AD Security Tokens</span></span>
<span data-ttu-id="9506f-146">Маркеры безопасности, выданный Azure AD содержит утверждений или проверочные утверждения информации о субъекте hello, который прошел проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="9506f-146">Security tokens issued by Azure AD contain claims, or assertions of information about hello subject that has been authenticated.</span></span> <span data-ttu-id="9506f-147">Эти утверждения могут использоваться приложением hello для различных задач.</span><span class="sxs-lookup"><span data-stu-id="9506f-147">These claims can be used by hello application for various tasks.</span></span> <span data-ttu-id="9506f-148">Например они могут быть токен используется toovalidate hello, идентификации клиента каталога субъекта hello, отображать сведения о пользователе, определения авторизации субъекта hello и т. д.</span><span class="sxs-lookup"><span data-stu-id="9506f-148">For example, they can be used toovalidate hello token, identify hello subject's directory tenant, display user information, determine hello subject's authorization, and so on.</span></span> <span data-ttu-id="9506f-149">Hello утверждений в любом заданном маркере безопасности зависят от типа hello маркера, типа hello hello пользователя учетные данные, используемые tooauthenticate и конфигурации приложения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-149">hello claims present in any given security token are dependent upon hello type of token, hello type of credential used tooauthenticate hello user, and hello application configuration.</span></span> <span data-ttu-id="9506f-150">Краткое описание каждого типа утверждения, выдаваемого Azure AD, приведен в следующей таблице hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-150">A brief description of each type of claim emitted by Azure AD is provided in hello table below.</span></span> <span data-ttu-id="9506f-151">Дополнительные сведения см. в разделе слишком[типы поддерживаемых токенов и утверждений](active-directory-token-and-claims.md).</span><span class="sxs-lookup"><span data-stu-id="9506f-151">For more information, refer too[Supported Token and Claim Types](active-directory-token-and-claims.md).</span></span>

| <span data-ttu-id="9506f-152">Утверждение</span><span class="sxs-lookup"><span data-stu-id="9506f-152">Claim</span></span> | <span data-ttu-id="9506f-153">Описание</span><span class="sxs-lookup"><span data-stu-id="9506f-153">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9506f-154">Идентификатор приложения</span><span class="sxs-lookup"><span data-stu-id="9506f-154">Application ID</span></span> |<span data-ttu-id="9506f-155">Идентифицирует приложение hello, использующее токен hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-155">Identifies hello application that is using hello token.</span></span> |
| <span data-ttu-id="9506f-156">Аудитория</span><span class="sxs-lookup"><span data-stu-id="9506f-156">Audience</span></span> |<span data-ttu-id="9506f-157">Идентифицирует ресурс получателя hello hello маркер предназначен для.</span><span class="sxs-lookup"><span data-stu-id="9506f-157">Identifies hello recipient resource hello token is intended for.</span></span> |
| <span data-ttu-id="9506f-158">Application Authentication Context Class Reference</span><span class="sxs-lookup"><span data-stu-id="9506f-158">Application Authentication Context Class Reference</span></span> |<span data-ttu-id="9506f-159">Указывает, каким образом hello клиент был аутентифицирован (общедоступный клиент или конфиденциальный клиент).</span><span class="sxs-lookup"><span data-stu-id="9506f-159">Indicates how hello client was authenticated (public client vs. confidential client).</span></span> |
| <span data-ttu-id="9506f-160">Authentication Instant</span><span class="sxs-lookup"><span data-stu-id="9506f-160">Authentication Instant</span></span> |<span data-ttu-id="9506f-161">Записи hello дату и время аутентификации hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-161">Records hello date and time when hello authentication occurred.</span></span> |
| <span data-ttu-id="9506f-162">Метод проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="9506f-162">Authentication Method</span></span> |<span data-ttu-id="9506f-163">Указывает, как был аутентифицирован субъект hello hello маркера (пароль, сертификат, и т. д.).</span><span class="sxs-lookup"><span data-stu-id="9506f-163">Indicates how hello subject of hello token was authenticated (password, certificate, etc.).</span></span> |
| <span data-ttu-id="9506f-164">Имя</span><span class="sxs-lookup"><span data-stu-id="9506f-164">First Name</span></span> |<span data-ttu-id="9506f-165">Предоставляет hello заданное имя пользователя hello, набор в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-165">Provides hello given name of hello user as set in Azure AD.</span></span> |
| <span data-ttu-id="9506f-166">Группы</span><span class="sxs-lookup"><span data-stu-id="9506f-166">Groups</span></span> |<span data-ttu-id="9506f-167">Содержит объект группы идентификаторов Azure AD, которые hello пользователь является членом.</span><span class="sxs-lookup"><span data-stu-id="9506f-167">Contains object Ids of Azure AD groups hello user is a member of.</span></span> |
| <span data-ttu-id="9506f-168">Identity Provider</span><span class="sxs-lookup"><span data-stu-id="9506f-168">Identity Provider</span></span> |<span data-ttu-id="9506f-169">Поставщик удостоверений записей hello проверку подлинности субъекта hello hello маркера.</span><span class="sxs-lookup"><span data-stu-id="9506f-169">Records hello identity provider that authenticated hello subject of hello token.</span></span> |
| <span data-ttu-id="9506f-170">Выдано в</span><span class="sxs-lookup"><span data-stu-id="9506f-170">Issued At</span></span> |<span data-ttu-id="9506f-171">Время записи hello, выдачи маркера какие hello, часто используется для определения актуальности маркера.</span><span class="sxs-lookup"><span data-stu-id="9506f-171">Records hello time at which hello token was issued, often used for token freshness.</span></span> |
| <span data-ttu-id="9506f-172">Издатель</span><span class="sxs-lookup"><span data-stu-id="9506f-172">Issuer</span></span> |<span data-ttu-id="9506f-173">Идентифицирует hello STS, которая выдала маркер hello, а также клиент Azure AD hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-173">Identifies hello STS that emitted hello token as well as hello Azure AD tenant.</span></span> |
| <span data-ttu-id="9506f-174">Фамилия</span><span class="sxs-lookup"><span data-stu-id="9506f-174">Last Name</span></span> |<span data-ttu-id="9506f-175">Предоставляет hello Фамилия пользователя hello в виде набора в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-175">Provides hello surname of hello user as set in Azure AD.</span></span> |
| <span data-ttu-id="9506f-176">Имя</span><span class="sxs-lookup"><span data-stu-id="9506f-176">Name</span></span> |<span data-ttu-id="9506f-177">Предоставляет читаемое значение, идентифицирующее субъект hello hello маркера.</span><span class="sxs-lookup"><span data-stu-id="9506f-177">Provides a human readable value that identifies hello subject of hello token.</span></span> |
| <span data-ttu-id="9506f-178">Идентификатор объекта</span><span class="sxs-lookup"><span data-stu-id="9506f-178">Object Id</span></span> |<span data-ttu-id="9506f-179">Содержит неизменяемый уникальный идентификатор субъекта hello в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-179">Contains an immutable, unique identifier of hello subject in Azure AD.</span></span> |
| <span data-ttu-id="9506f-180">Роли</span><span class="sxs-lookup"><span data-stu-id="9506f-180">Roles</span></span> |<span data-ttu-id="9506f-181">Содержит понятные имена ролей приложения Azure AD, hello пользователю было предоставлено.</span><span class="sxs-lookup"><span data-stu-id="9506f-181">Contains friendly names of Azure AD Application Roles that hello user has been granted.</span></span> |
| <span data-ttu-id="9506f-182">Область</span><span class="sxs-lookup"><span data-stu-id="9506f-182">Scope</span></span> |<span data-ttu-id="9506f-183">Указывает hello разрешения предоставленный toohello клиентское приложение.</span><span class="sxs-lookup"><span data-stu-id="9506f-183">Indicates hello permissions granted toohello client application.</span></span> |
| <span data-ttu-id="9506f-184">Субъект</span><span class="sxs-lookup"><span data-stu-id="9506f-184">Subject</span></span> |<span data-ttu-id="9506f-185">Указывает участника hello, информацию о которой hello подтверждает маркер.</span><span class="sxs-lookup"><span data-stu-id="9506f-185">Indicates hello principal about which hello token asserts information.</span></span> |
| <span data-ttu-id="9506f-186">Идентификатор клиента</span><span class="sxs-lookup"><span data-stu-id="9506f-186">Tenant Id</span></span> |<span data-ttu-id="9506f-187">Содержит неизменяемый уникальный идентификатор клиента каталога hello, выдавшего токен hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-187">Contains an immutable, unique identifier of hello directory tenant that issued hello token.</span></span> |
| <span data-ttu-id="9506f-188">Token Lifetime</span><span class="sxs-lookup"><span data-stu-id="9506f-188">Token Lifetime</span></span> |<span data-ttu-id="9506f-189">Определяет hello интервал времени, в течение которого действителен маркер.</span><span class="sxs-lookup"><span data-stu-id="9506f-189">Defines hello time interval within which a token is valid.</span></span> |
| <span data-ttu-id="9506f-190">Имя участника-пользователя</span><span class="sxs-lookup"><span data-stu-id="9506f-190">User Principal Name</span></span> |<span data-ttu-id="9506f-191">Содержит hello имя участника-пользователя субъекта hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-191">Contains hello user principal name of hello subject.</span></span> |
| <span data-ttu-id="9506f-192">Version (версия)</span><span class="sxs-lookup"><span data-stu-id="9506f-192">Version</span></span> |<span data-ttu-id="9506f-193">Содержит номер версии hello hello маркера.</span><span class="sxs-lookup"><span data-stu-id="9506f-193">Contains hello version number of hello token.</span></span> |

## <a name="basics-of-registering-an-application-in-azure-ad"></a><span data-ttu-id="9506f-194">Основные сведения о регистрации приложения в Azure AD</span><span class="sxs-lookup"><span data-stu-id="9506f-194">Basics of Registering an Application in Azure AD</span></span>
<span data-ttu-id="9506f-195">Любое приложение, передающее проверку подлинности tooAzure AD должны быть зарегистрированы в каталоге.</span><span class="sxs-lookup"><span data-stu-id="9506f-195">Any application that outsources authentication tooAzure AD must be registered in a directory.</span></span> <span data-ttu-id="9506f-196">Этот шаг подразумевает сообщение Azure AD, о приложении, включая hello URL-адрес, где он находится, toosend hello URL-адрес ответа после проверки подлинности, hello URI tooidentify приложения и многое другое.</span><span class="sxs-lookup"><span data-stu-id="9506f-196">This step involves telling Azure AD about your application, including hello URL where it’s located, hello URL toosend replies after authentication, hello URI tooidentify your application, and more.</span></span> <span data-ttu-id="9506f-197">Эта информация необходима по нескольким основным причинам:</span><span class="sxs-lookup"><span data-stu-id="9506f-197">This information is required for a few key reasons:</span></span>

* <span data-ttu-id="9506f-198">Azure AD необходимы координаты toocommunicate с приложением hello при обработке входа или обмене маркерами.</span><span class="sxs-lookup"><span data-stu-id="9506f-198">Azure AD needs coordinates toocommunicate with hello application when handling sign-on or exchanging tokens.</span></span> <span data-ttu-id="9506f-199">К ним относятся следующие hello:</span><span class="sxs-lookup"><span data-stu-id="9506f-199">These include hello following:</span></span>
  
  * <span data-ttu-id="9506f-200">URI идентификатора приложения: идентификатор hello для приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-200">Application ID URI: hello identifier for an application.</span></span> <span data-ttu-id="9506f-201">Это значение отправляется tooAzure AD во время проверки подлинности tooindicate, какие приложения hello вызывающий хочет получить маркер.</span><span class="sxs-lookup"><span data-stu-id="9506f-201">This value is sent tooAzure AD during authentication tooindicate which application hello caller wants a token for.</span></span> <span data-ttu-id="9506f-202">Кроме того это значение включается в токен hello, чтобы приложение hello известно, что оно было что hello предназначен целевой.</span><span class="sxs-lookup"><span data-stu-id="9506f-202">Additionally, this value is included in hello token so that hello application knows it was hello intended target.</span></span>
  * <span data-ttu-id="9506f-203">Ответить URL-адрес и URI перенаправления: В случае веб-API или веб-приложения hello hello URL-адрес ответа является toowhich расположение hello Azure AD будет отправлять ответ проверки подлинности hello, включая маркер, если проверка подлинности прошла успешно.</span><span class="sxs-lookup"><span data-stu-id="9506f-203">Reply URL and Redirect URI: In hello case of a web API or web application, hello Reply URL is hello location toowhich Azure AD will send hello authentication response, including a token if authentication was successful.</span></span> <span data-ttu-id="9506f-204">В случае собственного приложения hello hello URI перенаправления является уникальным идентификатором toowhich Azure AD будет перенаправлять hello user-agent в запросе OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="9506f-204">In hello case of a native application, hello Redirect URI is a unique identifier toowhich Azure AD will redirect hello user-agent in an OAuth 2.0 request.</span></span>
  * <span data-ttu-id="9506f-205">Идентификатор приложения: hello идентификатор для приложения, который создается Azure AD при регистрации приложения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-205">Application ID: hello ID for an application, which is generated by Azure AD when hello application is registered.</span></span> <span data-ttu-id="9506f-206">При запросе кода авторизации или маркер, идентификатор приложения hello и ключ отправляются tooAzure AD во время проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="9506f-206">When requesting an authorization code or token, hello Application ID and key are sent tooAzure AD during authentication.</span></span>
  * <span data-ttu-id="9506f-207">Ключ: hello ключ, который отправляется вместе с Идентификатором приложения при проверке подлинности tooAzure AD toocall веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-207">Key: hello key that is sent along with a Application ID when authenticating tooAzure AD toocall a web API.</span></span>
* <span data-ttu-id="9506f-208">Azure AD требуется приложение hello tooensure имеет hello tooaccess необходимые разрешения на каталог данных, других приложений в вашей организации и т. д</span><span class="sxs-lookup"><span data-stu-id="9506f-208">Azure AD needs tooensure hello application has hello required permissions tooaccess your directory data, other applications in your organization, and so on</span></span>

<span data-ttu-id="9506f-209">Процесс подготовки станет яснее, когда вы поймете, что существует две категории приложений, которые можно разрабатывать и интегрировать с Azure AD:</span><span class="sxs-lookup"><span data-stu-id="9506f-209">Provisioning becomes clearer when you understand that there are two categories of applications that can be developed and integrated with Azure AD:</span></span>

* <span data-ttu-id="9506f-210">Однотенантное приложение. Однотенантное приложение (для одного клиента) предназначено для использования в одной организации.</span><span class="sxs-lookup"><span data-stu-id="9506f-210">Single tenant application: A single tenant application is intended for use in one organization.</span></span> <span data-ttu-id="9506f-211">Обычно это бизнес-приложения (LoB), которые создает разработчик компании.</span><span class="sxs-lookup"><span data-stu-id="9506f-211">These are typically line-of-business (LoB) applications written by an enterprise developer.</span></span> <span data-ttu-id="9506f-212">Приложения одного клиента достаточно toobe пользователями в одном каталоге, и в результате его достаточно подготовить в одном каталоге toobe.</span><span class="sxs-lookup"><span data-stu-id="9506f-212">A single tenant application only needs toobe accessed by users in one directory, and as a result, it only needs toobe provisioned in one directory.</span></span> <span data-ttu-id="9506f-213">Эти приложения обычно регистрируются разработчиком в организации hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-213">These applications are typically registered by a developer in hello organization.</span></span>
* <span data-ttu-id="9506f-214">Мультитенантное приложение. Мультитенантное приложение (для нескольких клиентов) предназначено для использования во многих организациях, а не только в одной.</span><span class="sxs-lookup"><span data-stu-id="9506f-214">Multi-tenant application: A multi-tenant application is intended for use in many organizations, not just one organization.</span></span> <span data-ttu-id="9506f-215">Как правило, это приложения категории "программное обеспечение как услуга" (SaaS), которые создают независимые поставщики программных продуктов (ISV).</span><span class="sxs-lookup"><span data-stu-id="9506f-215">These are typically software-as-a-service (SaaS) applications written by an independent software vendor (ISV).</span></span> <span data-ttu-id="9506f-216">Мультитенантные приложения должны подготовить в каждом каталоге, где они будут использоваться, требующий tooregister согласия пользователя или администратора toobe их.</span><span class="sxs-lookup"><span data-stu-id="9506f-216">Multi-tenant applications need toobe provisioned in each directory where they will be used, which requires user or administrator consent tooregister them.</span></span> <span data-ttu-id="9506f-217">Процесс получения согласия начинается, когда приложение было зарегистрировано в каталоге hello и предоставляется доступ toohello Graph API или возможно другому веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-217">This consent process starts when an application has been registered in hello directory and is given access toohello Graph API or perhaps another web API.</span></span> <span data-ttu-id="9506f-218">Когда пользователь или администратор из другой организации регистрируется toouse приложения hello, они должны быть представлены с помощью диалогового окна, которое отображает hello разрешения, необходимые для приложения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-218">When a user or administrator from a different organization signs up toouse hello application, they are presented with a dialog that displays hello permissions hello application requires.</span></span> <span data-ttu-id="9506f-219">Hello пользователь или администратор может затем согласия toohello приложение, которое предоставляет toohello доступа приложения hello указываются данные, и наконец регистры hello приложения в каталоге.</span><span class="sxs-lookup"><span data-stu-id="9506f-219">hello user or administrator can then consent toohello application, which gives hello application access toohello stated data, and finally registers hello application in their directory.</span></span> <span data-ttu-id="9506f-220">Дополнительные сведения см. в разделе [Обзор инфраструктуры согласия hello](active-directory-integrating-applications.md#overview-of-the-consent-framework).</span><span class="sxs-lookup"><span data-stu-id="9506f-220">For more information, see [Overview of hello Consent Framework](active-directory-integrating-applications.md#overview-of-the-consent-framework).</span></span>

<span data-ttu-id="9506f-221">При разработке мультитенантного приложения вместо однотенантного необходимо учесть некоторые дополнительные соображения.</span><span class="sxs-lookup"><span data-stu-id="9506f-221">Some additional considerations arise when developing a multi-tenant application instead of a single tenant application.</span></span> <span data-ttu-id="9506f-222">Например, при внесении доступных toousers вашего приложения в нескольких каталогах, то необходимо toodetermine механизм какой клиент в которых они расположены.</span><span class="sxs-lookup"><span data-stu-id="9506f-222">For example, if you are making your application available toousers in multiple directories, you need a mechanism toodetermine which tenant they’re in.</span></span> <span data-ttu-id="9506f-223">Приложения одного клиента достаточно toolook в свой собственный каталог для пользователя, пока многопользовательского приложения должен tooidentify конкретного пользователя во всех каталогах hello в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-223">A single tenant application only needs toolook in its own directory for a user, while a multi-tenant application needs tooidentify a specific user from all hello directories in Azure AD.</span></span> <span data-ttu-id="9506f-224">tooaccomplish этой задачи Azure AD предоставляет общую конечную точку проверки подлинности, куда мультитенантное приложение может направлять запросов на вход в, а не клиентская конечная точка.</span><span class="sxs-lookup"><span data-stu-id="9506f-224">tooaccomplish this task, Azure AD provides a common authentication endpoint where any multi-tenant application can direct sign-in requests, instead of a tenant-specific endpoint.</span></span> <span data-ttu-id="9506f-225">Эта конечная точка является https://login.microsoftonline.com/common для всех каталогов в Azure AD, тогда как клиентская конечная точка может быть https://login.microsoftonline.com/contoso.onmicrosoft.com. Hello Обычная конечная точка является особенно важным tooconsider при разработке приложения, так как они потребуются hello toohandle необходимую логику несколько клиентов во время входа, выхода и проверки токенов.</span><span class="sxs-lookup"><span data-stu-id="9506f-225">This endpoint is https://login.microsoftonline.com/common for all directories in Azure AD, whereas a tenant-specific endpoint might be https://login.microsoftonline.com/contoso.onmicrosoft.com. hello common endpoint is especially important tooconsider when developing your application because you’ll need hello necessary logic toohandle multiple tenants during sign-in, sign-out, and token validation.</span></span>

<span data-ttu-id="9506f-226">Если вы разрабатываете приложения одного клиента, которые toomake его доступных toomany организаций, можно легко вносить изменения toohello приложения и его конфигурации в Azure AD toomake он поддерживает нескольких клиентов.</span><span class="sxs-lookup"><span data-stu-id="9506f-226">If you are currently developing a single tenant application but want toomake it available toomany organizations, you can easily make changes toohello application and its configuration in Azure AD toomake it multi-tenant capable.</span></span> <span data-ttu-id="9506f-227">Кроме того, Azure AD использует hello одинаковым подписывания ключа во всех каталогах, следует ли вы предоставляете проверки подлинности в одном клиенте или многопользовательского приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-227">In addition, Azure AD uses hello same signing key for all tokens in all directories, whether you are providing authentication in a single tenant or multi-tenant application.</span></span>

<span data-ttu-id="9506f-228">Каждый сценарий, рассматриваемый в этом документе, содержит подраздел, где описываются соответствующие требования по подготовке.</span><span class="sxs-lookup"><span data-stu-id="9506f-228">Each scenario listed in this document includes a sub-section that describes its provisioning requirements.</span></span> <span data-ttu-id="9506f-229">Дополнительные сведения о подготовке приложения в Azure AD и hello различия между приложениями, одной или нескольких клиентов см. в разделе [интеграция приложений с Azure Active Directory](active-directory-integrating-applications.md) для получения дополнительной информации.</span><span class="sxs-lookup"><span data-stu-id="9506f-229">For more in-depth information about provisioning an application in Azure AD and hello differences between single and multi-tenant applications, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md) for more information.</span></span> <span data-ttu-id="9506f-230">Чтобы продолжайте чтение toounderstand общими сценариями приложения hello в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-230">Continue reading toounderstand hello common application scenarios in Azure AD.</span></span>

## <a name="application-types-and-scenarios"></a><span data-ttu-id="9506f-231">Типы приложений и сценарии</span><span class="sxs-lookup"><span data-stu-id="9506f-231">Application Types and Scenarios</span></span>
<span data-ttu-id="9506f-232">Каждый из сценариев hello, описанные в этом документе может быть разработан на разных языках и платформах.</span><span class="sxs-lookup"><span data-stu-id="9506f-232">Each of hello scenarios described in this document can be developed using various languages and platforms.</span></span> <span data-ttu-id="9506f-233">Все они поддерживаются средствами полные примеры кода, доступных в нашем [руководства образцы кода](active-directory-code-samples.md), или непосредственно из соответствующего hello [образец репозиториях GitHub](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory).</span><span class="sxs-lookup"><span data-stu-id="9506f-233">They are all backed by complete code samples which are available in our [Code Samples guide](active-directory-code-samples.md), or directly from hello corresponding [GitHub sample repositories](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory).</span></span> <span data-ttu-id="9506f-234">Кроме того, если вашему приложению требуется конкретная часть или сегмент комплексного сценария, то в большинстве случаев эти функции можно добавлять независимым образом.</span><span class="sxs-lookup"><span data-stu-id="9506f-234">In addition, if your application needs a specific piece or segment of an end-to-end scenario, in most cases that functionality can be added independently.</span></span> <span data-ttu-id="9506f-235">Например если имеется собственное приложение, которое вызывает веб-API, легко добавить веб-приложение, которое также вызывает hello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-235">For example, if you have a native application that calls a web API, you can easily add a web application that also calls hello web API.</span></span> <span data-ttu-id="9506f-236">Hello следующей схеме приведены эти сценарии и типы приложений, и как можно добавить различные компоненты:</span><span class="sxs-lookup"><span data-stu-id="9506f-236">hello following diagram illustrates these scenarios and application types, and how different components can be added:</span></span>

![Типы приложений и сценарии](./media/active-directory-authentication-scenarios/application_types_and_scenarios.png)

<span data-ttu-id="9506f-238">Это hello пять основных сценариев приложений поддерживаемых Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-238">These are hello five primary application scenarios supported by Azure AD:</span></span>

* <span data-ttu-id="9506f-239">[Веб-браузер tooWeb приложения](#web-browser-to-web-application): пользователю нужно toosign в tooa веб-приложение, защищенное Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-239">[Web Browser tooWeb Application](#web-browser-to-web-application): A user needs toosign in tooa web application that is secured by Azure AD.</span></span>
* <span data-ttu-id="9506f-240">[Одна страница приложения (SPA)](#single-page-application-spa): пользователю нужно toosign в tooa одностраничное приложение, защищенное Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-240">[Single Page Application (SPA)](#single-page-application-spa): A user needs toosign in tooa single page application that is secured by Azure AD.</span></span>
* <span data-ttu-id="9506f-241">[TooWeb собственного приложения API](#native-application-to-web-api): собственное приложение, запускаемое на телефоне, планшете или tooauthenticate потребностей ПК tooget пользователя ресурсы из веб-API, защищенные Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-241">[Native Application tooWeb API](#native-application-to-web-api): A native application that runs on a phone, tablet, or PC needs tooauthenticate a user tooget resources from a web API that is secured by Azure AD.</span></span>
* <span data-ttu-id="9506f-242">[Веб-API приложения tooWeb](#web-application-to-web-api): веб-приложению требуются tooget ресурсы из веб-API, защищенного Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-242">[Web Application tooWeb API](#web-application-to-web-api): A web application needs tooget resources from a web API secured by Azure AD.</span></span>
* <span data-ttu-id="9506f-243">[Управляющая программа или серверное приложение tooWeb API](#daemon-or-server-application-to-web-api): приложение-демон или серверное приложение без веб-интерфейса пользователя требуются tooget ресурсы из веб-API, защищенного Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-243">[Daemon or Server Application tooWeb API](#daemon-or-server-application-to-web-api): A daemon application or a server application with no web user interface needs tooget resources from a web API secured by Azure AD.</span></span>

### <a name="web-browser-tooweb-application"></a><span data-ttu-id="9506f-244">Веб-браузер tooWeb приложения</span><span class="sxs-lookup"><span data-stu-id="9506f-244">Web Browser tooWeb Application</span></span>
<span data-ttu-id="9506f-245">В этом разделе описывается приложение, которое проверяет подлинность пользователя в приложении web tooa веб-браузера.</span><span class="sxs-lookup"><span data-stu-id="9506f-245">This section describes an application that authenticates a user in a web browser tooa web application.</span></span> <span data-ttu-id="9506f-246">В этом сценарии веб-приложение hello направляет toosign hello пользователя обозревателя в tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-246">In this scenario, hello web application directs hello user’s browser toosign them in tooAzure AD.</span></span> <span data-ttu-id="9506f-247">Azure AD возвращает ответ вход через hello в браузере пользователя, который содержит утверждения о пользователе hello в маркере безопасности.</span><span class="sxs-lookup"><span data-stu-id="9506f-247">Azure AD returns a sign-in response through hello user’s browser, which contains claims about hello user in a security token.</span></span> <span data-ttu-id="9506f-248">Этот сценарий поддерживает вход с использованием протоколов WS-Federation, SAML 2.0 и OpenID Connect hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-248">This scenario supports sign-on using hello WS-Federation, SAML 2.0, and OpenID Connect protocols.</span></span>

#### <a name="diagram"></a><span data-ttu-id="9506f-249">Схема</span><span class="sxs-lookup"><span data-stu-id="9506f-249">Diagram</span></span>
![Ход проверки подлинности для приложения браузера tooweb](./media/active-directory-authentication-scenarios/web_browser_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="9506f-251">Описание потока протокола</span><span class="sxs-lookup"><span data-stu-id="9506f-251">Description of Protocol Flow</span></span>
1. <span data-ttu-id="9506f-252">Когда пользователь посещает приложения hello и toosign в, они перенаправляются через конечную точку проверки подлинности toohello запрос вход в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-252">When a user visits hello application and needs toosign in, they are redirected via a sign-in request toohello authentication endpoint in Azure AD.</span></span>
2. <span data-ttu-id="9506f-253">Hello пользователь входит на страницу входа hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-253">hello user signs in on hello sign-in page.</span></span>
3. <span data-ttu-id="9506f-254">При успешном выполнении проверки подлинности Azure AD создает маркер проверки подлинности и возвращает URL-адрес приложения toohello ответа входа ответа, установленный на портале Azure hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-254">If authentication is successful, Azure AD creates an authentication token and returns a sign-in response toohello application’s Reply URL that was configured in hello Azure Portal.</span></span> <span data-ttu-id="9506f-255">В рабочем приложении для этого URL-адреса ответа должен использоваться протокол HTTPS.</span><span class="sxs-lookup"><span data-stu-id="9506f-255">For a production application, this Reply URL should be HTTPS.</span></span> <span data-ttu-id="9506f-256">Hello вернул токен содержит утверждения о пользователе hello и Azure AD, которые требуются маркер hello toovalidate приложения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-256">hello returned token includes claims about hello user and Azure AD that are required by hello application toovalidate hello token.</span></span>
4. <span data-ttu-id="9506f-257">приложение Hello проверяет hello токен с помощью открытого ключа подписывания и издателя сведений, доступных в hello документа метаданных федерации для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-257">hello application validates hello token by using a public signing key and issuer information available at hello federation metadata document for Azure AD.</span></span> <span data-ttu-id="9506f-258">После hello приложение проверяет токен hello, Azure AD запускает новый сеанс с пользователем hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-258">After hello application validates hello token, Azure AD starts a new session with hello user.</span></span> <span data-ttu-id="9506f-259">В этом сеансе можно tooaccess hello пользователя приложения hello до истечения срока его действия.</span><span class="sxs-lookup"><span data-stu-id="9506f-259">This session allows hello user tooaccess hello application until it expires.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="9506f-260">Примеры кода</span><span class="sxs-lookup"><span data-stu-id="9506f-260">Code Samples</span></span>
<span data-ttu-id="9506f-261">Просмотрите образцы кода hello для сценариев приложений tooWeb веб-браузер.</span><span class="sxs-lookup"><span data-stu-id="9506f-261">See hello code samples for Web Browser tooWeb Application scenarios.</span></span> <span data-ttu-id="9506f-262">И возвращайтесь почаще — мы добавляем новые примеры все время hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-262">And, check back frequently -- we add new samples all hello time.</span></span> <span data-ttu-id="9506f-263">[Веб-браузер tooWeb приложения](active-directory-code-samples.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="9506f-263">[Web Browser tooWeb Application](active-directory-code-samples.md#web-browser-to-web-application).</span></span>

#### <a name="registering"></a><span data-ttu-id="9506f-264">Регистрация</span><span class="sxs-lookup"><span data-stu-id="9506f-264">Registering</span></span>
* <span data-ttu-id="9506f-265">Одного клиента: При построении приложения только для одной организации, его должны регистрироваться в каталоге этой организации с помощью портала Azure hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-265">Single Tenant: If you are building an application just for your organization, it must be registered in your company’s directory by using hello Azure Portal.</span></span>
* <span data-ttu-id="9506f-266">Несколько клиентов: При построении приложения, которое может использоваться пользователями за пределами вашей организации, он должен быть зарегистрирован в каталоге этой организации, но также должны быть зарегистрированы в каталоге каждой организации, который будет использовать приложение hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-266">Multi-Tenant: If you are building an application that can be used by users outside your organization, it must be registered in your company’s directory, but also must be registered in each organization’s directory that will be using hello application.</span></span> <span data-ttu-id="9506f-267">toomake вашего приложения в каталоге, можно включить процесс регистрации для клиентов, который позволяет им tooconsent tooyour приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-267">toomake your application available in their directory, you can include a sign-up process for your customers that enables them tooconsent tooyour application.</span></span> <span data-ttu-id="9506f-268">При регистрации приложения, они откроется диалоговое окно, которое показывает, требует приложение hello разрешения hello и затем hello tooconsent параметр.</span><span class="sxs-lookup"><span data-stu-id="9506f-268">When they sign up for your application, they will be presented with a dialog that shows hello permissions hello application requires, and then hello option tooconsent.</span></span> <span data-ttu-id="9506f-269">В зависимости от hello необходимые разрешения, администратор в hello может быть другой организации требуется toogive согласия.</span><span class="sxs-lookup"><span data-stu-id="9506f-269">Depending on hello required permissions, an administrator in hello other organization may be required toogive consent.</span></span> <span data-ttu-id="9506f-270">Когда hello пользователь или администратор дает согласие, приложение hello регистрируется в каталоге.</span><span class="sxs-lookup"><span data-stu-id="9506f-270">When hello user or administrator consents, hello application is registered in their directory.</span></span> <span data-ttu-id="9506f-271">Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="9506f-271">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="9506f-272">Срок действия маркера</span><span class="sxs-lookup"><span data-stu-id="9506f-272">Token Expiration</span></span>
<span data-ttu-id="9506f-273">сеанс пользователя Hello истечения срока действия, когда истекает время существования hello hello маркера, выданного Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-273">hello user’s session expires when hello lifetime of hello token issued by Azure AD expires.</span></span> <span data-ttu-id="9506f-274">При необходимости приложение может сократить этот период времени, например, обеспечивая выход пользователей на основании некоторого периода бездействия.</span><span class="sxs-lookup"><span data-stu-id="9506f-274">Your application can shorten this time period if desired, such as signing out users based on a period of inactivity.</span></span> <span data-ttu-id="9506f-275">По окончании сеанса hello hello пользователя будет запрашиваемые toosign в еще раз.</span><span class="sxs-lookup"><span data-stu-id="9506f-275">When hello session expires, hello user will be prompted toosign in again.</span></span>

### <a name="single-page-application-spa"></a><span data-ttu-id="9506f-276">Одностраничное приложение (SPA)</span><span class="sxs-lookup"><span data-stu-id="9506f-276">Single Page Application (SPA)</span></span>
<span data-ttu-id="9506f-277">В этом разделе описана аутентификация для одностраничного приложения, которое использует Azure AD и hello неявное авторизации OAuth 2.0 предоставьте toosecure завершить обратно его веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-277">This section describes authentication for a Single Page Application, that uses Azure AD and hello OAuth 2.0 implicit authorization grant toosecure its web API back end.</span></span> <span data-ttu-id="9506f-278">Обычно приложений на одной странице структурированы в качестве уровня представления данных JavaScript (интерфейса), работающей в браузере hello и серверную часть веб-API, которая выполняется на сервере и реализует hello бизнес-логики приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-278">Single Page Applications are typically structured as a JavaScript presentation layer (front end) that runs in hello browser and a Web API back end that runs on a server and implements hello application’s business logic.</span></span> <span data-ttu-id="9506f-279">toolearn Дополнительные сведения о предоставления неявное авторизации hello и поможет вам решить, подходит ли она для сценария вашего приложения в разделе [поток в Azure Active Directory разрешений hello основные сведения о неявных OAuth2](active-directory-dev-understanding-oauth2-implicit-grant.md).</span><span class="sxs-lookup"><span data-stu-id="9506f-279">toolearn more about hello implicit authorization grant, and help you decide whether it's right for your application scenario, see [Understanding hello OAuth2 implicit grant flow in Azure Active Directory](active-directory-dev-understanding-oauth2-implicit-grant.md).</span></span>

<span data-ttu-id="9506f-280">В этом случае при входе в систему пользователя hello hello JavaScript front end используется [библиотеку аутентификации Active Directory для JavaScript (ADAL. JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) и hello неявное авторизации предоставлении tooobtain маркер идентификатора (id_token) из Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-280">In this scenario, when hello user signs in, hello JavaScript front end uses [Active Directory Authentication Library for JavaScript (ADAL.JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) and hello implicit authorization grant tooobtain an ID token (id_token) from Azure AD.</span></span> <span data-ttu-id="9506f-281">Hello маркера в кэше и hello клиент присоединяет его toohello запроса как прикрепленный токен носителя hello при выполнении вызовов, что tooits веб-API серверной части, которая защищена с помощью по промежуточного слоя OWIN hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-281">hello token is cached and hello client attaches it toohello request as hello bearer token when making calls tooits Web API back end, which is secured using hello OWIN middleware.</span></span> 

#### <a name="diagram"></a><span data-ttu-id="9506f-282">Схема</span><span class="sxs-lookup"><span data-stu-id="9506f-282">Diagram</span></span>
![Схема одностраничного приложения](./media/active-directory-authentication-scenarios/single_page_app.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="9506f-284">Описание потока протокола</span><span class="sxs-lookup"><span data-stu-id="9506f-284">Description of Protocol Flow</span></span>
1. <span data-ttu-id="9506f-285">Hello пользователь переходит toohello веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-285">hello user navigates toohello web application.</span></span>
2. <span data-ttu-id="9506f-286">приложение Hello возвращает внешнего интерфейса (уровень представления данных) toohello hello JavaScript браузера.</span><span class="sxs-lookup"><span data-stu-id="9506f-286">hello application returns hello JavaScript front end (presentation layer) toohello browser.</span></span>
3. <span data-ttu-id="9506f-287">Hello пользователь инициирует вход, например, щелкнув ссылку входа.</span><span class="sxs-lookup"><span data-stu-id="9506f-287">hello user initiates sign in, for example by clicking a sign in link.</span></span> <span data-ttu-id="9506f-288">Hello браузер отправляет конечной точки toorequest авторизации Azure AD GET toohello маркер идентификатора.</span><span class="sxs-lookup"><span data-stu-id="9506f-288">hello browser sends a GET toohello Azure AD authorization endpoint toorequest an ID token.</span></span> <span data-ttu-id="9506f-289">Этот запрос включает hello идентификатор и ответ URL-адрес приложения в параметрах запроса hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-289">This request includes hello application ID and reply URL in hello query parameters.</span></span>
4. <span data-ttu-id="9506f-290">Azure AD проверяет URL-адрес ответа от hello зарегистрированные URL-адрес ответа, установленный на портале Azure hello hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-290">Azure AD validates hello Reply URL against hello registered Reply URL that was configured in hello Azure Portal.</span></span>
5. <span data-ttu-id="9506f-291">Hello пользователь входит на страницу входа hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-291">hello user signs in on hello sign-in page.</span></span>
6. <span data-ttu-id="9506f-292">При успешном выполнении проверки подлинности Azure AD создает маркер идентификатора и возвращает его как URL-адрес ответа приложения фрагмента (#) URL-адрес toohello.</span><span class="sxs-lookup"><span data-stu-id="9506f-292">If authentication is successful, Azure AD creates an ID token and returns it as a URL fragment (#) toohello application’s Reply URL.</span></span> <span data-ttu-id="9506f-293">В рабочем приложении для этого URL-адреса ответа должен использоваться протокол HTTPS.</span><span class="sxs-lookup"><span data-stu-id="9506f-293">For a production application, this Reply URL should be HTTPS.</span></span> <span data-ttu-id="9506f-294">Hello вернул токен содержит утверждения о пользователе hello и Azure AD, которые требуются маркер hello toovalidate приложения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-294">hello returned token includes claims about hello user and Azure AD that are required by hello application toovalidate hello token.</span></span>
7. <span data-ttu-id="9506f-295">клиентский код JavaScript Hello, выполняются в браузере hello извлекает маркер hello из toouse hello ответа для защиты вызовов завершить обратно toohello приложения веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-295">hello JavaScript client code running in hello browser extracts hello token from hello response toouse in securing calls toohello application’s web API back end.</span></span>
8. <span data-ttu-id="9506f-296">Здравствуйте, приложения для браузера вызовы hello web API обратно заканчиваются hello маркер доступа в заголовок authorization hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-296">hello browser calls hello application’s web API back end with hello access token in hello authorization header.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="9506f-297">Примеры кода</span><span class="sxs-lookup"><span data-stu-id="9506f-297">Code Samples</span></span>
<span data-ttu-id="9506f-298">Просмотрите образцы кода hello для сценариев приложения одной странице (SPA).</span><span class="sxs-lookup"><span data-stu-id="9506f-298">See hello code samples for Single Page Application (SPA) scenarios.</span></span> <span data-ttu-id="9506f-299">Часто, что toocheck назад — мы добавляем новые образцы все время hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-299">Be sure toocheck back frequently -- we add new samples all hello time.</span></span> <span data-ttu-id="9506f-300">[Одностраничное приложение (SPA)](active-directory-code-samples.md#single-page-application-spa).</span><span class="sxs-lookup"><span data-stu-id="9506f-300">[Single Page Application (SPA)](active-directory-code-samples.md#single-page-application-spa).</span></span>

#### <a name="registering"></a><span data-ttu-id="9506f-301">Регистрация</span><span class="sxs-lookup"><span data-stu-id="9506f-301">Registering</span></span>
* <span data-ttu-id="9506f-302">Одного клиента: При построении приложения только для одной организации, его должны регистрироваться в каталоге этой организации с помощью портала Azure hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-302">Single Tenant: If you are building an application just for your organization, it must be registered in your company’s directory by using hello Azure Portal.</span></span>
* <span data-ttu-id="9506f-303">Несколько клиентов: При построении приложения, которое может использоваться пользователями за пределами вашей организации, он должен быть зарегистрирован в каталоге этой организации, но также должны быть зарегистрированы в каталоге каждой организации, который будет использовать приложение hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-303">Multi-Tenant: If you are building an application that can be used by users outside your organization, it must be registered in your company’s directory, but also must be registered in each organization’s directory that will be using hello application.</span></span> <span data-ttu-id="9506f-304">toomake вашего приложения в каталоге, можно включить процесс регистрации для клиентов, который позволяет им tooconsent tooyour приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-304">toomake your application available in their directory, you can include a sign-up process for your customers that enables them tooconsent tooyour application.</span></span> <span data-ttu-id="9506f-305">При регистрации приложения, они откроется диалоговое окно, которое показывает, требует приложение hello разрешения hello и затем hello tooconsent параметр.</span><span class="sxs-lookup"><span data-stu-id="9506f-305">When they sign up for your application, they will be presented with a dialog that shows hello permissions hello application requires, and then hello option tooconsent.</span></span> <span data-ttu-id="9506f-306">В зависимости от hello необходимые разрешения, администратор в hello может быть другой организации требуется toogive согласия.</span><span class="sxs-lookup"><span data-stu-id="9506f-306">Depending on hello required permissions, an administrator in hello other organization may be required toogive consent.</span></span> <span data-ttu-id="9506f-307">Когда hello пользователь или администратор дает согласие, приложение hello регистрируется в каталоге.</span><span class="sxs-lookup"><span data-stu-id="9506f-307">When hello user or administrator consents, hello application is registered in their directory.</span></span> <span data-ttu-id="9506f-308">Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="9506f-308">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

<span data-ttu-id="9506f-309">После регистрации приложения hello, он должен быть настроенный toouse протокола неявного предоставления OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="9506f-309">After registering hello application, it must be configured toouse OAuth 2.0 Implicit Grant protocol.</span></span> <span data-ttu-id="9506f-310">По умолчанию для приложений этот протокол отключен.</span><span class="sxs-lookup"><span data-stu-id="9506f-310">By default, this protocol is disabled for applications.</span></span> <span data-ttu-id="9506f-311">hello tooenable протокола неявного предоставления OAuth2 для своего приложения, измените его манифест приложения с портала Azure hello и задайте tootrue значение «oauth2AllowImplicitFlow» hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-311">tooenable hello OAuth2 Implicit Grant protocol for your application, edit its application manifest from hello Azure Portal and set hello “oauth2AllowImplicitFlow” value tootrue.</span></span> <span data-ttu-id="9506f-312">Подробные инструкции см. в разделе [Включение неявного предоставления авторизации OAuth 2.0 для одностраничных приложений](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="9506f-312">For detailed instructions, see [Enabling OAuth 2.0 Implicit Grant for Single Page Applications](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="9506f-313">Срок действия маркера</span><span class="sxs-lookup"><span data-stu-id="9506f-313">Token Expiration</span></span>
<span data-ttu-id="9506f-314">При использовании проверки подлинности toomanage ADAL.js с Azure AD, преимущества несколько функций, которые упрощают обновление просроченного маркера, а также получение маркеров для дополнительных веб-API ресурсы, которые могут быть вызваны приложения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-314">When you use ADAL.js toomanage authentication with Azure AD, you benefit from several features that facilitate refreshing an expired token as well as getting tokens for additional web API resources that may be called by hello application.</span></span> <span data-ttu-id="9506f-315">Когда hello пользователь успешно проходит проверку подлинности в Azure AD, защищенный файлом cookie сеанса создается hello пользователя между браузером hello и Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-315">When hello user successfully authenticates with Azure AD, a session secured by a cookie is established for hello user between hello browser and Azure AD.</span></span> <span data-ttu-id="9506f-316">Это важные toonote, hello сеанс существует между пользователем hello и Azure AD и not between пользователя hello и hello веб-приложения, запущенные на сервере hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-316">It’s important toonote that hello session exists between hello user and Azure AD and not between hello user and hello web application running on hello server.</span></span> <span data-ttu-id="9506f-317">По истечении срока действия маркера ADAL.js использует этот сеанс, toosilently получить другой маркер.</span><span class="sxs-lookup"><span data-stu-id="9506f-317">When a token expires, ADAL.js uses this session toosilently obtain another token.</span></span> <span data-ttu-id="9506f-318">Он делает это с помощью скрытого iFrame toosend и получать запрос hello, с помощью протокола неявного предоставления OAuth hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-318">It does this by using a hidden iFrame toosend and receive hello request using hello OAuth Implicit Grant protocol.</span></span> <span data-ttu-id="9506f-319">ADAL.js также может использовать такой же механизм toosilently получать токены доступа из Azure AD для других веб-API ресурсы, что приложение вызывает hello до тех пор, пока эти ресурсы поддерживают ресурсов независимо от источника (CORS) для управления доступом зарегистрированы в каталоге пользователя hello, и все необходимые разрешения предоставленный hello пользователя при входе в систему.</span><span class="sxs-lookup"><span data-stu-id="9506f-319">ADAL.js can also use this same mechanism toosilently obtain access tokens from Azure AD for other web API resources that hello application calls as long as these resources support cross-origin resource sharing (CORS), are registered in hello user’s directory, and any required consent was given by hello user during sign-in.</span></span>

### <a name="native-application-tooweb-api"></a><span data-ttu-id="9506f-320">TooWeb собственного приложения API</span><span class="sxs-lookup"><span data-stu-id="9506f-320">Native Application tooWeb API</span></span>
<span data-ttu-id="9506f-321">В этом разделе описывается нативное приложение, которое вызывает веб-интерфейс API от имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="9506f-321">This section describes a native application that calls a web API on behalf of a user.</span></span> <span data-ttu-id="9506f-322">Этот сценарий основан на типе предоставления кода авторизации hello OAuth 2.0 общему клиенту, как описано в разделе 4.1 hello [спецификации OAuth 2.0](http://tools.ietf.org/html/rfc6749).</span><span class="sxs-lookup"><span data-stu-id="9506f-322">This scenario is built on hello OAuth 2.0 authorization code grant type with a public client, as described in section 4.1 of hello [OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749).</span></span> <span data-ttu-id="9506f-323">Hello собственное приложение получает токен доступа для hello пользователя с помощью протокола OAuth 2.0 hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-323">hello native application obtains an access token for hello user by using hello OAuth 2.0 protocol.</span></span> <span data-ttu-id="9506f-324">Затем этот токен доступа отправляется в hello запроса toohello веб-API, который авторизует пользователя hello и возвращает hello требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-324">This access token is then sent in hello request toohello web API, which authorizes hello user and returns hello desired resource.</span></span>

#### <a name="diagram"></a><span data-ttu-id="9506f-325">Схема</span><span class="sxs-lookup"><span data-stu-id="9506f-325">Diagram</span></span>
![Собственного приложения tooWeb схема API](./media/active-directory-authentication-scenarios/native_app_to_web_api.png)

#### <a name="authentication-flow-for-native-application-tooapi"></a><span data-ttu-id="9506f-327">Ход проверки подлинности для собственного приложения tooAPI</span><span class="sxs-lookup"><span data-stu-id="9506f-327">Authentication flow for native application tooAPI</span></span>
#### <a name="description-of-protocol-flow"></a><span data-ttu-id="9506f-328">Описание потока протокола</span><span class="sxs-lookup"><span data-stu-id="9506f-328">Description of Protocol Flow</span></span>
<span data-ttu-id="9506f-329">При использовании библиотеки проверки подлинности hello AD большую часть деталей протокола hello, описанных ниже выполняется за вас, например hello всплывающее окно браузера, кэширование токенов и обработка токенов обновления.</span><span class="sxs-lookup"><span data-stu-id="9506f-329">If you are using hello AD Authentication Libraries, most of hello protocol details described below are handled for you, such as hello browser pop-up, token caching, and handling of refresh tokens.</span></span>

1. <span data-ttu-id="9506f-330">С помощью всплывающего окна браузера, собственное приложение hello делает конечную точку авторизации toohello запроса в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-330">Using a browser pop-up, hello native application makes a request toohello authorization endpoint in Azure AD.</span></span> <span data-ttu-id="9506f-331">Этот запрос включает идентификатор приложения hello и перенаправления hello URI собственного приложения hello, как показано в hello портала Azure и URI идентификатора приложения hello для hello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-331">This request includes hello Application ID and hello redirect URI of hello native application as shown in hello Azure Portal, and hello application ID URI for hello web API.</span></span> <span data-ttu-id="9506f-332">Если пользователь hello еще не зарегистрированы, запрашиваемые toosign в будут снова</span><span class="sxs-lookup"><span data-stu-id="9506f-332">If hello user hasn’t already signed in, they are prompted toosign in again</span></span>
2. <span data-ttu-id="9506f-333">Azure AD проверяет подлинность пользователя hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-333">Azure AD authenticates hello user.</span></span> <span data-ttu-id="9506f-334">Если это многопользовательского приложения, и оно требуется toouse приложения hello, hello пользователю будут необходимые tooconsent, если они еще не сделали этого.</span><span class="sxs-lookup"><span data-stu-id="9506f-334">If it is a multi-tenant application and consent is required toouse hello application, hello user will be required tooconsent if they haven’t already done so.</span></span> <span data-ttu-id="9506f-335">После предоставления согласия и после успешной проверки подлинности Azure AD выдает авторизации код ответа задней toohello клиентского приложения URI перенаправления.</span><span class="sxs-lookup"><span data-stu-id="9506f-335">After granting consent and upon successful authentication, Azure AD issues an authorization code response back toohello client application’s redirect URI.</span></span>
3. <span data-ttu-id="9506f-336">Когда Azure AD отправляет ответ с кодом авторизации обратно toohello URI перенаправления, hello в коде клиентского приложения останавливается браузера взаимодействия и извлекает hello авторизации из ответа hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-336">When Azure AD issues an authorization code response back toohello redirect URI, hello client application stops browser interaction and extracts hello authorization code from hello response.</span></span> <span data-ttu-id="9506f-337">С помощью следующего кода авторизации, hello клиентское приложение отправляет запрос tooAzure AD маркера конечную точку, которая включает код авторизации hello, сведения об hello клиентском приложении (идентификатор приложения и URI перенаправления) и hello нужный ресурс (идентификатор приложения URI для hello веб-API).</span><span class="sxs-lookup"><span data-stu-id="9506f-337">Using this authorization code, hello client application sends a request tooAzure AD’s token endpoint that includes hello authorization code, details about hello client application (Application ID and redirect URI), and hello desired resource (application ID URI for hello web API).</span></span>
4. <span data-ttu-id="9506f-338">Код авторизации Hello и сведения о hello клиентского приложения и веб-API проверяются Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-338">hello authorization code and information about hello client application and web API are validated by Azure AD.</span></span> <span data-ttu-id="9506f-339">После успешной проверки Azure AD возвращает два маркера: маркер доступа JWT и маркер обновления JWT.</span><span class="sxs-lookup"><span data-stu-id="9506f-339">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span> <span data-ttu-id="9506f-340">Кроме того Azure AD возвращает основные сведения о пользователе hello, например их отображаемое имя и идентификатор клиента.</span><span class="sxs-lookup"><span data-stu-id="9506f-340">In addition, Azure AD returns basic information about hello user, such as their display name and tenant ID.</span></span>
5. <span data-ttu-id="9506f-341">По протоколу HTTPS hello клиентское приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-341">Over HTTPS, hello client application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="9506f-342">Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-342">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>
6. <span data-ttu-id="9506f-343">По истечении срока действия маркера доступа hello hello клиентское приложение получит ошибку, которая указывает, что пользователь hello должен tooauthenticate еще раз.</span><span class="sxs-lookup"><span data-stu-id="9506f-343">When hello access token expires, hello client application will receive an error that indicates hello user needs tooauthenticate again.</span></span> <span data-ttu-id="9506f-344">Если приложение hello имеет допустимый токен обновления, может быть используется tooacquire новый маркер доступа без запроса подтверждения hello toosign пользователя в еще раз.</span><span class="sxs-lookup"><span data-stu-id="9506f-344">If hello application has a valid refresh token, it can be used tooacquire a new access token without prompting hello user toosign in again.</span></span> <span data-ttu-id="9506f-345">Если истекает срок действия токена обновления hello, приложение hello должно toointeractively для проверки подлинности hello пользователя еще раз.</span><span class="sxs-lookup"><span data-stu-id="9506f-345">If hello refresh token expires, hello application will need toointeractively authenticate hello user once again.</span></span>

> [!NOTE]
> <span data-ttu-id="9506f-346">токен обновления Hello выданного Azure AD может быть tooaccess используется несколько ресурсов.</span><span class="sxs-lookup"><span data-stu-id="9506f-346">hello refresh token issued by Azure AD can be used tooaccess multiple resources.</span></span> <span data-ttu-id="9506f-347">Например если клиентское приложение, которое имеет разрешение toocall двух в веб-API, hello токен обновления может быть используется tooget access token toohello других веб-API также.</span><span class="sxs-lookup"><span data-stu-id="9506f-347">For example, if you have a client application that has permission toocall two web APIs, hello refresh token can be used tooget an access token toohello other web API as well.</span></span>
> 
> 

#### <a name="code-samples"></a><span data-ttu-id="9506f-348">Примеры кода</span><span class="sxs-lookup"><span data-stu-id="9506f-348">Code Samples</span></span>
<span data-ttu-id="9506f-349">Просмотрите образцы кода hello для собственного приложения tooWeb API сценариев.</span><span class="sxs-lookup"><span data-stu-id="9506f-349">See hello code samples for Native Application tooWeb API scenarios.</span></span> <span data-ttu-id="9506f-350">И возвращайтесь почаще — мы добавляем новые примеры все время hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-350">And, check back frequently -- we add new samples all hello time.</span></span> <span data-ttu-id="9506f-351">[TooWeb собственного приложения API](active-directory-code-samples.md#native-application-to-web-api).</span><span class="sxs-lookup"><span data-stu-id="9506f-351">[Native Application tooWeb API](active-directory-code-samples.md#native-application-to-web-api).</span></span>

#### <a name="registering"></a><span data-ttu-id="9506f-352">Регистрация</span><span class="sxs-lookup"><span data-stu-id="9506f-352">Registering</span></span>
* <span data-ttu-id="9506f-353">Для одного клиента: Оба hello собственное приложение и hello веб-API, которые должны быть зарегистрированы в hello один каталог в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-353">Single Tenant: Both hello native application and hello web API must be registered in hello same directory in Azure AD.</span></span> <span data-ttu-id="9506f-354">Hello веб-API может быть настроенный tooexpose набор разрешений, которые являются используется toolimit hello собственный доступ tooits ресурсы приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-354">hello web API can be configured tooexpose a set of permissions, which are used toolimit hello native application’s access tooits resources.</span></span> <span data-ttu-id="9506f-355">затем Hello клиентское приложение выбирает hello требуемого разрешения из раскрывающегося списка «TooOther разрешений приложения» hello меню в hello портала Azure.</span><span class="sxs-lookup"><span data-stu-id="9506f-355">hello client application then selects hello desired permissions from hello “Permissions tooOther Applications” drop-down menu in hello Azure Portal.</span></span>
* <span data-ttu-id="9506f-356">Несколько клиентов: Во-первых, собственное приложение hello только регистрируется в каталоге издателя или разработчика hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-356">Multi-Tenant: First, hello native application only ever registered in hello developer or publisher’s directory.</span></span> <span data-ttu-id="9506f-357">Во-вторых собственное приложение hello — настроенное tooindicate hello разрешения, необходимые toobe работы.</span><span class="sxs-lookup"><span data-stu-id="9506f-357">Second, hello native application is configured tooindicate hello permissions it requires toobe functional.</span></span> <span data-ttu-id="9506f-358">Этот список необходимых разрешений отображается в диалоговом окне, когда пользователь или администратор в каталоге назначения hello дает согласие toohello приложения, который делает доступными tootheir организации.</span><span class="sxs-lookup"><span data-stu-id="9506f-358">This list of required permissions is shown in a dialog when a user or administrator in hello destination directory gives consent toohello application, which makes it available tootheir organization.</span></span> <span data-ttu-id="9506f-359">Некоторые приложения требуют только правами пользователя, что любой пользователь в организации hello можно дать согласие.</span><span class="sxs-lookup"><span data-stu-id="9506f-359">Some applications require just user-level permissions, which any user in hello organization can consent to.</span></span> <span data-ttu-id="9506f-360">Другие приложения требуют разрешения на уровне администратора, которые пользователь в организации hello не удается разрешить.</span><span class="sxs-lookup"><span data-stu-id="9506f-360">Other applications require administrator-level permissions, which a user in hello organization cannot consent to.</span></span> <span data-ttu-id="9506f-361">Только администратор каталога может предоставить согласие tooapplications, который требует этот уровень разрешений.</span><span class="sxs-lookup"><span data-stu-id="9506f-361">Only a directory administrator can give consent tooapplications that require this level of permissions.</span></span> <span data-ttu-id="9506f-362">Когда hello пользователь или администратор дает согласие, в своем каталоге регистрируется только hello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-362">When hello user or administrator consents, only hello web API is registered in their directory.</span></span> <span data-ttu-id="9506f-363">Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](active-directory-integrating-applications.md).</span><span class="sxs-lookup"><span data-stu-id="9506f-363">For more information, see [Integrating Applications with Azure Active Directory](active-directory-integrating-applications.md).</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="9506f-364">Срок действия маркера</span><span class="sxs-lookup"><span data-stu-id="9506f-364">Token Expiration</span></span>
<span data-ttu-id="9506f-365">Когда собственное приложение hello использует его tooget код авторизации токен доступа JWT, оно также получает токен обновления.</span><span class="sxs-lookup"><span data-stu-id="9506f-365">When hello native application uses its authorization code tooget a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="9506f-366">По истечении срока действия маркера доступа hello hello токен обновления может быть используется toore-для проверки подлинности пользователя hello без необходимости их toosign в еще раз.</span><span class="sxs-lookup"><span data-stu-id="9506f-366">When hello access token expires, hello refresh token can be used toore-authenticate hello user without requiring them toosign in again.</span></span> <span data-ttu-id="9506f-367">Этот токен обновления, а затем используется tooauthenticate hello пользователя, токен, какие результаты в новый доступ и обновление токена.</span><span class="sxs-lookup"><span data-stu-id="9506f-367">This refresh token is then used tooauthenticate hello user, which results in a new access token and refresh token.</span></span>

### <a name="web-application-tooweb-api"></a><span data-ttu-id="9506f-368">Веб-приложения tooWeb API</span><span class="sxs-lookup"><span data-stu-id="9506f-368">Web Application tooWeb API</span></span>
<span data-ttu-id="9506f-369">В этом разделе описываются веб-приложения, который должен tooget ресурсы из веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-369">This section describes a web application that needs tooget resources from a web API.</span></span> <span data-ttu-id="9506f-370">В этом случае существует два типа удостоверений, которые hello веб-приложения можно использовать tooauthenticate и вызвать hello веб-API: удостоверение приложения или удостоверение делегированного пользователя.</span><span class="sxs-lookup"><span data-stu-id="9506f-370">In this scenario, there are two identity types that hello web application can use tooauthenticate and call hello web API: an application identity, or a delegated user identity.</span></span>

<span data-ttu-id="9506f-371">*Удостоверение приложения:* этот сценарий использует предоставления учетных данных клиента OAuth 2.0 tooauthenticate как приложение hello и hello доступа веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-371">*Application identity:* This scenario uses OAuth 2.0 client credentials grant tooauthenticate as hello application and access hello web API.</span></span> <span data-ttu-id="9506f-372">При использовании удостоверения приложения hello web API может только обнаружить, что hello веб-приложения вызов его, как hello веб-API не получено никакой информации о пользователе hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-372">When using an application identity, hello web API can only detect that hello web application is calling it, as hello web API does not receive any information about hello user.</span></span> <span data-ttu-id="9506f-373">Если приложение hello получает сведения о пользователе hello, будут отправляться посредством протокола приложения hello и не подписываются Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-373">If hello application receives information about hello user, it will be sent via hello application protocol, and it is not signed by Azure AD.</span></span> <span data-ttu-id="9506f-374">Hello веб-API доверяет проверку подлинности веб-приложения hello hello пользователя.</span><span class="sxs-lookup"><span data-stu-id="9506f-374">hello web API trusts that hello web application authenticated hello user.</span></span> <span data-ttu-id="9506f-375">По этой причине данная схема называется доверенной (надежной) подсистемой.</span><span class="sxs-lookup"><span data-stu-id="9506f-375">For this reason, this pattern is called a trusted subsystem.</span></span>

<span data-ttu-id="9506f-376">*Делегированное удостоверение пользователя*. Этот сценарий можно реализовать двумя способами: использовать OpenID Connect и предоставить код авторизации OAuth 2.0 с помощью конфиденциального клиента.</span><span class="sxs-lookup"><span data-stu-id="9506f-376">*Delegated user identity:* This scenario can be accomplished in two ways: OpenID Connect, and OAuth 2.0 authorization code grant with a confidential client.</span></span> <span data-ttu-id="9506f-377">Hello веб-приложение получает токен доступа для пользователя hello, который доказывает toohello веб-API, hello toohello пользователь успешно прошел проверку подлинности веб-приложения и веб-приложения hello был может tooobtain делегированного пользователя удостоверения toocall hello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-377">hello web application obtains an access token for hello user, which proves toohello web API that hello user successfully authenticated toohello web application and that hello web application was able tooobtain a delegated user identity toocall hello web API.</span></span> <span data-ttu-id="9506f-378">Этот токен доступа отправляется в hello запроса toohello веб-API, который авторизует пользователя hello и возвращает hello требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-378">This access token is sent in hello request toohello web API, which authorizes hello user and returns hello desired resource.</span></span>

#### <a name="diagram"></a><span data-ttu-id="9506f-379">Схема</span><span class="sxs-lookup"><span data-stu-id="9506f-379">Diagram</span></span>
![Веб-диаграмма tooWeb API приложения](./media/active-directory-authentication-scenarios/web_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="9506f-381">Описание потока протокола</span><span class="sxs-lookup"><span data-stu-id="9506f-381">Description of Protocol Flow</span></span>
<span data-ttu-id="9506f-382">Оба hello удостоверения приложения и типы удостоверения делегированного пользователя рассматриваются ниже потока hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-382">Both hello application identity and delegated user identity types are discussed in hello flow below.</span></span> <span data-ttu-id="9506f-383">Hello ключевое различие между ними состоит в hello делегировать удостоверение пользователя сначала нужно получить код авторизации перед hello пользователь может войти и получить доступ toohello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-383">hello key difference between them is that hello delegated user identity must first acquire an authorization code before hello user can sign-in and gain access toohello web API.</span></span>

##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a><span data-ttu-id="9506f-384">Удостоверение приложения с предоставлением учетных данных клиента OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="9506f-384">Application Identity with OAuth 2.0 Client Credentials Grant</span></span>
1. <span data-ttu-id="9506f-385">Когда пользователь вошел в tooAzure AD в веб-приложение hello (hello в разделе [tooWeb веб-браузере приложений](#web-browser-to-web-application) выше).</span><span class="sxs-lookup"><span data-stu-id="9506f-385">A user is signed in tooAzure AD in hello web application (see hello [Web Browser tooWeb Application](#web-browser-to-web-application) above).</span></span>
2. <span data-ttu-id="9506f-386">веб-приложение Hello должен tooacquire маркер доступа, чтобы она могла проверить подлинность веб-API toohello и получать hello требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-386">hello web application needs tooacquire an access token so that it can authenticate toohello web API and retrieve hello desired resource.</span></span> <span data-ttu-id="9506f-387">Оно выполняет запрос tooAzure AD конечную точку токена, предоставляя hello учетных данных, идентификатор приложения и URI идентификатора приложения веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-387">It makes a request tooAzure AD’s token endpoint, providing hello credential, Application ID, and web API’s application ID URI.</span></span>
3. <span data-ttu-id="9506f-388">Azure AD проверяет подлинность приложения hello и возвращает токен доступа JWT, используемые toocall hello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-388">Azure AD authenticates hello application and returns a JWT access token that is used toocall hello web API.</span></span>
4. <span data-ttu-id="9506f-389">По протоколу HTTPS hello веб-приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-389">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="9506f-390">Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-390">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

##### <a name="delegated-user-identity-with-openid-connect"></a><span data-ttu-id="9506f-391">Делегированное удостоверение пользователя с OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="9506f-391">Delegated User Identity with OpenID Connect</span></span>
1. <span data-ttu-id="9506f-392">Когда пользователь вошел в tooa веб-приложения с помощью Azure AD (hello в разделе [tooWeb веб-браузере приложений](#web-browser-to-web-application) выше).</span><span class="sxs-lookup"><span data-stu-id="9506f-392">A user is signed in tooa web application using Azure AD (see hello [Web Browser tooWeb Application](#web-browser-to-web-application) section above).</span></span> <span data-ttu-id="9506f-393">Если пользователь hello hello веб-приложения еще не согласился tooallowing hello приложения toocall hello веб API от своего имени, hello пользователь должен будет tooconsent.</span><span class="sxs-lookup"><span data-stu-id="9506f-393">If hello user of hello web application has not yet consented tooallowing hello web application toocall hello web API on its behalf, hello user will need tooconsent.</span></span> <span data-ttu-id="9506f-394">приложение Hello отобразит hello разрешения, необходимые, и если любой из этих разрешения уровня администратора, обычный пользователь в каталоге hello не будет может tooconsent.</span><span class="sxs-lookup"><span data-stu-id="9506f-394">hello application will display hello permissions it requires, and if any of these are administrator-level permissions, a normal user in hello directory will not be able tooconsent.</span></span> <span data-ttu-id="9506f-395">Процесс получения согласия применяется только toomulti клиента приложения, не одного клиента, как приложение hello уже будет иметь необходимые разрешения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-395">This consent process only applies toomulti-tenant applications, not single tenant applications, as hello application will already have hello necessary permissions.</span></span> <span data-ttu-id="9506f-396">Когда hello пользователь выполнил вход, hello веб-приложение получает токен идентификатора со сведениями о hello пользователя, а также код авторизации.</span><span class="sxs-lookup"><span data-stu-id="9506f-396">When hello user signed in, hello web application received an ID token with information about hello user, as well as an authorization code.</span></span>
2. <span data-ttu-id="9506f-397">С помощью кода авторизации hello, выданного Azure AD, веб-приложение hello отправляет запрос tooAzure AD маркера конечную точку, которая включает код авторизации hello, сведения о клиентском приложении hello (идентификатор приложения и URI перенаправления) и hello требуемого ресурса ( URI идентификатора приложения для hello веб-API).</span><span class="sxs-lookup"><span data-stu-id="9506f-397">Using hello authorization code issued by Azure AD, hello web application sends a request tooAzure AD’s token endpoint that includes hello authorization code, details about hello client application (Application ID and redirect URI), and hello desired resource (application ID URI for hello web API).</span></span>
3. <span data-ttu-id="9506f-398">Код авторизации Hello и сведения о hello веб-приложения и веб-API проверяются Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-398">hello authorization code and information about hello web application and web API are validated by Azure AD.</span></span> <span data-ttu-id="9506f-399">После успешной проверки Azure AD возвращает два маркера: маркер доступа JWT и маркер обновления JWT.</span><span class="sxs-lookup"><span data-stu-id="9506f-399">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span>
4. <span data-ttu-id="9506f-400">По протоколу HTTPS hello веб-приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-400">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="9506f-401">Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-401">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

##### <a name="delegated-user-identity-with-oauth-20-authorization-code-grant"></a><span data-ttu-id="9506f-402">Делегированное удостоверение пользователя с предоставлением кода авторизации OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="9506f-402">Delegated User Identity with OAuth 2.0 Authorization Code Grant</span></span>
1. <span data-ttu-id="9506f-403">Пользователь уже выполнил вход tooa веб-приложение, механизм проверки подлинности которого не зависит от Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-403">A user is already signed in tooa web application, whose authentication mechanism is independent of Azure AD.</span></span>
2. <span data-ttu-id="9506f-404">Hello веб-приложение требует авторизации кода tooacquire маркер доступа, поэтому оно выдает запрос через конечную точку авторизации tooAzure браузера hello AD, предоставляя hello идентификатор приложения и URI перенаправления для веб-приложения hello после успешной Проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="9506f-404">hello web application requires an authorization code tooacquire an access token, so it issues a request through hello browser tooAzure AD’s authorization endpoint, providing hello Application ID and redirect URI for hello web application after successful authentication.</span></span> <span data-ttu-id="9506f-405">Hello пользователь выполняет вход tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-405">hello user signs in tooAzure AD.</span></span>
3. <span data-ttu-id="9506f-406">Если пользователь hello hello веб-приложения еще не согласился tooallowing hello приложения toocall hello веб API от своего имени, hello пользователь должен будет tooconsent.</span><span class="sxs-lookup"><span data-stu-id="9506f-406">If hello user of hello web application has not yet consented tooallowing hello web application toocall hello web API on its behalf, hello user will need tooconsent.</span></span> <span data-ttu-id="9506f-407">приложение Hello отобразит hello разрешения, необходимые, и если любой из этих разрешения уровня администратора, обычный пользователь в каталоге hello не будет может tooconsent.</span><span class="sxs-lookup"><span data-stu-id="9506f-407">hello application will display hello permissions it requires, and if any of these are administrator-level permissions, a normal user in hello directory will not be able tooconsent.</span></span> <span data-ttu-id="9506f-408">Это согласие применяется tooboth одной или несколькими владельцами приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-408">This consent applies tooboth single and multi-tenant application.</span></span>  <span data-ttu-id="9506f-409">В случае одного клиента hello администратора можно выполнить от имени пользователей tooconsent согласия администратора.</span><span class="sxs-lookup"><span data-stu-id="9506f-409">In hello single tenant case, an admin can perform admin consent tooconsent on behalf of their users.</span></span>  <span data-ttu-id="9506f-410">Это можно сделать с помощью hello `Grant Permissions` кнопку в hello [портала Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="9506f-410">This can be done using hello `Grant Permissions` button in hello [Azure Portal](https://portal.azure.com).</span></span> 
4. <span data-ttu-id="9506f-411">После согласия пользователя hello hello веб-приложение получает код авторизации hello, что ему требуется tooacquire маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="9506f-411">After hello user has consented, hello web application receives hello authorization code that it needs tooacquire an access token.</span></span>
5. <span data-ttu-id="9506f-412">С помощью кода авторизации hello, выданного Azure AD, веб-приложение hello отправляет запрос tooAzure AD маркера конечную точку, которая включает код авторизации hello, сведения о клиентском приложении hello (идентификатор приложения и URI перенаправления) и hello требуемого ресурса ( URI идентификатора приложения для hello веб-API).</span><span class="sxs-lookup"><span data-stu-id="9506f-412">Using hello authorization code issued by Azure AD, hello web application sends a request tooAzure AD’s token endpoint that includes hello authorization code, details about hello client application (Application ID and redirect URI), and hello desired resource (application ID URI for hello web API).</span></span>
6. <span data-ttu-id="9506f-413">Код авторизации Hello и сведения о hello веб-приложения и веб-API проверяются Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-413">hello authorization code and information about hello web application and web API are validated by Azure AD.</span></span> <span data-ttu-id="9506f-414">После успешной проверки Azure AD возвращает два маркера: маркер доступа JWT и маркер обновления JWT.</span><span class="sxs-lookup"><span data-stu-id="9506f-414">Upon successful validation, Azure AD returns two tokens: a JWT access token and a JWT refresh token.</span></span>
7. <span data-ttu-id="9506f-415">По протоколу HTTPS hello веб-приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-415">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="9506f-416">Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-416">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="9506f-417">Примеры кода</span><span class="sxs-lookup"><span data-stu-id="9506f-417">Code Samples</span></span>
<span data-ttu-id="9506f-418">Просмотрите образцы кода hello для сценариев API tooWeb веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-418">See hello code samples for Web Application tooWeb API scenarios.</span></span> <span data-ttu-id="9506f-419">И возвращайтесь почаще — мы добавляем новые примеры все время hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-419">And, check back frequently -- we add new samples all hello time.</span></span> <span data-ttu-id="9506f-420">Web [tooWeb приложения API](active-directory-code-samples.md#web-application-to-web-api).</span><span class="sxs-lookup"><span data-stu-id="9506f-420">Web [Application tooWeb API](active-directory-code-samples.md#web-application-to-web-api).</span></span>

#### <a name="registering"></a><span data-ttu-id="9506f-421">Регистрация</span><span class="sxs-lookup"><span data-stu-id="9506f-421">Registering</span></span>
* <span data-ttu-id="9506f-422">Одного клиента: Удостоверение приложения hello и случае удостоверения делегированного пользователя hello веб-приложения и веб-hello API должны быть зарегистрированы в hello один каталог в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-422">Single Tenant: For both hello application identity and delegated user identity cases, hello web application and hello web API must be registered in hello same directory in Azure AD.</span></span> <span data-ttu-id="9506f-423">Hello веб-API может быть настроенный tooexpose набор разрешений, которые являются ресурсами tooits доступа используется toolimit hello веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-423">hello web API can be configured tooexpose a set of permissions, which are used toolimit hello web application’s access tooits resources.</span></span> <span data-ttu-id="9506f-424">Если используется тип удостоверения делегированного пользователя, веб-приложение hello необходимы разрешения hello требуемого tooselect из раскрывающегося списка «TooOther разрешений приложения» hello меню в hello портала Azure.</span><span class="sxs-lookup"><span data-stu-id="9506f-424">If a delegated user identity type is being used, hello web application needs tooselect hello desired permissions from hello “Permissions tooOther Applications” drop-down menu in hello Azure Portal.</span></span> <span data-ttu-id="9506f-425">Этот шаг не является обязательным, если используется тип удостоверения приложения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-425">This step is not required if hello application identity type is being used.</span></span>
* <span data-ttu-id="9506f-426">Несколько клиентов: Во-первых, веб-приложение hello — настроенное tooindicate hello разрешения, необходимые toobe работы.</span><span class="sxs-lookup"><span data-stu-id="9506f-426">Multi-Tenant: First, hello web application is configured tooindicate hello permissions it requires toobe functional.</span></span> <span data-ttu-id="9506f-427">Этот список необходимых разрешений отображается в диалоговом окне, когда пользователь или администратор в каталоге назначения hello дает согласие toohello приложения, который делает доступными tootheir организации.</span><span class="sxs-lookup"><span data-stu-id="9506f-427">This list of required permissions is shown in a dialog when a user or administrator in hello destination directory gives consent toohello application, which makes it available tootheir organization.</span></span> <span data-ttu-id="9506f-428">Некоторые приложения требуют только правами пользователя, что любой пользователь в организации hello можно дать согласие.</span><span class="sxs-lookup"><span data-stu-id="9506f-428">Some applications require just user-level permissions, which any user in hello organization can consent to.</span></span> <span data-ttu-id="9506f-429">Другие приложения требуют разрешения на уровне администратора, которые пользователь в организации hello не удается разрешить.</span><span class="sxs-lookup"><span data-stu-id="9506f-429">Other applications require administrator-level permissions, which a user in hello organization cannot consent to.</span></span> <span data-ttu-id="9506f-430">Только администратор каталога может предоставить согласие tooapplications, который требует этот уровень разрешений.</span><span class="sxs-lookup"><span data-stu-id="9506f-430">Only a directory administrator can give consent tooapplications that require this level of permissions.</span></span> <span data-ttu-id="9506f-431">Когда hello согласие пользователя или администратора, hello веб-приложения и hello web API регистрируются в каталоге.</span><span class="sxs-lookup"><span data-stu-id="9506f-431">When hello user or administrator consents, hello web application and hello web API are both registered in their directory.</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="9506f-432">Срок действия маркера</span><span class="sxs-lookup"><span data-stu-id="9506f-432">Token Expiration</span></span>
<span data-ttu-id="9506f-433">Когда веб-приложение hello использует его tooget код авторизации токен доступа JWT, оно также получает токен обновления.</span><span class="sxs-lookup"><span data-stu-id="9506f-433">When hello web application uses its authorization code tooget a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="9506f-434">По истечении срока действия маркера доступа hello hello токен обновления может быть используется toore-для проверки подлинности пользователя hello без необходимости их toosign в еще раз.</span><span class="sxs-lookup"><span data-stu-id="9506f-434">When hello access token expires, hello refresh token can be used toore-authenticate hello user without requiring them toosign in again.</span></span> <span data-ttu-id="9506f-435">Этот токен обновления, а затем используется tooauthenticate hello пользователя, токен, какие результаты в новый доступ и обновление токена.</span><span class="sxs-lookup"><span data-stu-id="9506f-435">This refresh token is then used tooauthenticate hello user, which results in a new access token and refresh token.</span></span>

### <a name="daemon-or-server-application-tooweb-api"></a><span data-ttu-id="9506f-436">Управляющая программа или серверное приложение tooWeb API</span><span class="sxs-lookup"><span data-stu-id="9506f-436">Daemon or Server Application tooWeb API</span></span>
<span data-ttu-id="9506f-437">В этом разделе описываются управляющую программу или серверное приложение, которое должно tooget ресурсы из веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-437">This section describes a daemon or server application that needs tooget resources from a web API.</span></span> <span data-ttu-id="9506f-438">Существует два следующих сценария toothis раздела: управляющей программы, которая требует toocall веб-API, построенных на тип предоставления учетных данных клиента OAuth 2.0; и приложения сервера (например, веб-API), которому требуется toocall веб-API, лежит спецификация behalf-of OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="9506f-438">There are two sub-scenarios that apply toothis section: A daemon that needs toocall a web API, built on OAuth 2.0 client credentials grant type; and a server application (such as a web API) that needs toocall a web API, built on OAuth 2.0 On-Behalf-Of draft specification.</span></span>

<span data-ttu-id="9506f-439">Для сценария hello необходимости toocall веб-API, управляющей программы это toounderstand важные моменты.</span><span class="sxs-lookup"><span data-stu-id="9506f-439">For hello scenario when a daemon application needs toocall a web API, it’s important toounderstand a few things.</span></span> <span data-ttu-id="9506f-440">Во-первых взаимодействие с пользователем не поддерживается с управляющей программой, которой требуется toohave приложения hello собственной идентификации.</span><span class="sxs-lookup"><span data-stu-id="9506f-440">First, user interaction is not possible with a daemon application, which requires hello application toohave its own identity.</span></span> <span data-ttu-id="9506f-441">Пример управляющей программы — пакетного задания или выполняться в фоновом режиме hello служба операционной системы.</span><span class="sxs-lookup"><span data-stu-id="9506f-441">An example of a daemon application is a batch job, or an operating system service running in hello background.</span></span> <span data-ttu-id="9506f-442">Этот тип приложений запрашивает токен доступа с помощью своего удостоверения, представляя его идентификатор приложения, учетные данные (пароль или сертификат) и URI идентификатора приложения tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-442">This type of application requests an access token by using its application identity and presenting its Application ID, credential (password or certificate), and application ID URI tooAzure AD.</span></span> <span data-ttu-id="9506f-443">После успешной проверки подлинности управляющая программа hello Получает токен доступа из Azure AD, который затем используется toocall hello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-443">After successful authentication, hello daemon receives an access token from Azure AD, which is then used toocall hello web API.</span></span>

<span data-ttu-id="9506f-444">Для сценария hello при серверного приложения необходимо toocall веб-API, бывает полезно toouse пример.</span><span class="sxs-lookup"><span data-stu-id="9506f-444">For hello scenario when a server application needs toocall a web API, it’s helpful toouse an example.</span></span> <span data-ttu-id="9506f-445">Предположим, что пользователь прошел проверку подлинности в приложении машинного кода, и этому приложению toocall веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-445">Imagine that a user has authenticated on a native application, and this native application needs toocall a web API.</span></span> <span data-ttu-id="9506f-446">Azure AD выдает JWT access token toocall hello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-446">Azure AD issues a JWT access token toocall hello web API.</span></span> <span data-ttu-id="9506f-447">Если hello веб-API должен toocall другой нисходящий веб-API, можно использовать удостоверение toodelegate hello hello потока от имени представляет пользователя и проверки подлинности веб-API второго уровня toohello.</span><span class="sxs-lookup"><span data-stu-id="9506f-447">If hello web API needs toocall another downstream web API, it can use hello on-behalf-of flow toodelegate hello user’s identity and authenticate toohello second-tier web API.</span></span>

#### <a name="diagram"></a><span data-ttu-id="9506f-448">Схема</span><span class="sxs-lookup"><span data-stu-id="9506f-448">Diagram</span></span>
![Схема tooWeb API демон или серверное приложение](./media/active-directory-authentication-scenarios/daemon_server_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a><span data-ttu-id="9506f-450">Описание потока протокола</span><span class="sxs-lookup"><span data-stu-id="9506f-450">Description of Protocol Flow</span></span>
##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a><span data-ttu-id="9506f-451">Удостоверение приложения с предоставлением учетных данных клиента OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="9506f-451">Application Identity with OAuth 2.0 Client Credentials Grant</span></span>
1. <span data-ttu-id="9506f-452">Во-первых серверное приложение hello должно tooauthenticate с Azure AD от своего имени, без вмешательства человека, такие как интерактивное диалоговое окно входа.</span><span class="sxs-lookup"><span data-stu-id="9506f-452">First, hello server application needs tooauthenticate with Azure AD as itself, without any human interaction such as an interactive sign-on dialog.</span></span> <span data-ttu-id="9506f-453">Оно выполняет запрос tooAzure AD конечную точку токена, предоставляя hello учетных данных, идентификатор приложения и URI идентификатора приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-453">It makes a request tooAzure AD’s token endpoint, providing hello credential, Application ID, and application ID URI.</span></span>
2. <span data-ttu-id="9506f-454">Azure AD проверяет подлинность приложения hello и возвращает токен доступа JWT, используемые toocall hello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-454">Azure AD authenticates hello application and returns a JWT access token that is used toocall hello web API.</span></span>
3. <span data-ttu-id="9506f-455">По протоколу HTTPS hello веб-приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-455">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="9506f-456">Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.</span><span class="sxs-lookup"><span data-stu-id="9506f-456">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

##### <a name="delegated-user-identity-with-oauth-20-on-behalf-of-draft-specification"></a><span data-ttu-id="9506f-457">Делегированное удостоверение пользователя с проектом спецификации OAuth 2.0 On-Behalf-Of (от имени)</span><span class="sxs-lookup"><span data-stu-id="9506f-457">Delegated User Identity with OAuth 2.0 On-Behalf-Of Draft Specification</span></span>
<span data-ttu-id="9506f-458">Hello потоке, который рассматривается ниже предполагается, что пользователь прошел проверку подлинности в другом приложении (например, в приложении машинного кода), а учетных данных пользователя была tooacquire используется API-Интерфейс веб-первого уровня toohello токена доступа.</span><span class="sxs-lookup"><span data-stu-id="9506f-458">hello flow discussed below assumes that a user has been authenticated on another application (such as a native application), and their user identity has been used tooacquire an access token toohello first-tier web API.</span></span>

1. <span data-ttu-id="9506f-459">собственное приложение Hello отправляет первого уровня веб-маркера toohello hello доступа к API.</span><span class="sxs-lookup"><span data-stu-id="9506f-459">hello native application sends hello access token toohello first-tier web API.</span></span>
2. <span data-ttu-id="9506f-460">веб-API первого уровня Hello отправляет запрос tooAzure AD конечную точку токена, указав его идентификатор приложения и учетные данные, а также маркер доступа пользователя hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-460">hello first-tier web API sends a request tooAzure AD’s token endpoint, providing its Application ID and credentials, as well as hello user’s access token.</span></span> <span data-ttu-id="9506f-461">Кроме того, hello запрос отправлен с on_behalf_of параметр, указывающий hello web API запрашивает новые токены toocall нижестоящий веб-API от имени исходного пользователя hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-461">In addition, hello request is sent with an on_behalf_of parameter that indicates hello web API is requesting new tokens toocall a downstream web API on behalf of hello original user.</span></span>
3. <span data-ttu-id="9506f-462">Azure AD проверяет hello первого уровня веб-API, имеет разрешения tooaccess hello второго уровня веб-API и проверяет запрос hello, возвращая токен доступа JWT и маркер JWT обновления токена toohello первого уровня веб-API.</span><span class="sxs-lookup"><span data-stu-id="9506f-462">Azure AD verifies that hello first-tier web API has permissions tooaccess hello second-tier web API and validates hello request, returning a JWT access token and a JWT refresh token toohello first-tier web API.</span></span>
4. <span data-ttu-id="9506f-463">По протоколу HTTPS веб-hello первого уровня, который затем вызывает API hello веб-API второго уровня, добавляя строку токена hello в заголовок Authorization hello в запросе hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-463">Over HTTPS, hello first-tier web API then calls hello second-tier web API by appending hello token string in hello Authorization header in hello request.</span></span> <span data-ttu-id="9506f-464">веб-API первого уровня Hello можно продолжить toocall hello второго уровня веб-API, при условии, что маркер доступа hello и токены обновления являются допустимыми.</span><span class="sxs-lookup"><span data-stu-id="9506f-464">hello first-tier web API can continue toocall hello second-tier web API as long as hello access token and refresh tokens are valid.</span></span>

#### <a name="code-samples"></a><span data-ttu-id="9506f-465">Примеры кода</span><span class="sxs-lookup"><span data-stu-id="9506f-465">Code Samples</span></span>
<span data-ttu-id="9506f-466">Просмотрите образцы кода hello для сценариев tooWeb API управляющей программы или серверного приложения.</span><span class="sxs-lookup"><span data-stu-id="9506f-466">See hello code samples for Daemon or Server Application tooWeb API scenarios.</span></span> <span data-ttu-id="9506f-467">И возвращайтесь почаще — мы добавляем новые примеры все время hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-467">And, check back frequently -- we add new samples all hello time.</span></span> [<span data-ttu-id="9506f-468">Сервер или приложение управляющей программы tooWeb API</span><span class="sxs-lookup"><span data-stu-id="9506f-468">Server or Daemon Application tooWeb API</span></span>](active-directory-code-samples.md#server-or-daemon-application-to-web-api)

#### <a name="registering"></a><span data-ttu-id="9506f-469">Регистрация</span><span class="sxs-lookup"><span data-stu-id="9506f-469">Registering</span></span>
* <span data-ttu-id="9506f-470">Одного клиента: Удостоверение приложения hello и случае удостоверения делегированного пользователя управляющую программу или серверное приложение hello необходимо зарегистрировать в hello один каталог в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9506f-470">Single Tenant: For both hello application identity and delegated user identity cases, hello daemon or server application must be registered in hello same directory in Azure AD.</span></span> <span data-ttu-id="9506f-471">Hello веб-API может быть настроенный tooexpose набор разрешений, которые управляющая программа hello используется toolimit или tooits ресурсы сервера доступа.</span><span class="sxs-lookup"><span data-stu-id="9506f-471">hello web API can be configured tooexpose a set of permissions, which are used toolimit hello daemon or server’s access tooits resources.</span></span> <span data-ttu-id="9506f-472">Если используется тип удостоверения делегированного пользователя, серверное приложение hello должно tooselect hello требуемого разрешения из раскрывающегося списка «TooOther разрешений приложения» hello меню в hello портала Azure.</span><span class="sxs-lookup"><span data-stu-id="9506f-472">If a delegated user identity type is being used, hello server application needs tooselect hello desired permissions from hello “Permissions tooOther Applications” drop-down menu in hello Azure Portal.</span></span> <span data-ttu-id="9506f-473">Этот шаг не является обязательным, если используется тип удостоверения приложения hello.</span><span class="sxs-lookup"><span data-stu-id="9506f-473">This step is not required if hello application identity type is being used.</span></span>
* <span data-ttu-id="9506f-474">Несколько клиентов: Во-первых, управляющую программу или серверное приложение hello — настроенное tooindicate hello разрешения, необходимые toobe работы.</span><span class="sxs-lookup"><span data-stu-id="9506f-474">Multi-Tenant: First, hello daemon or server application is configured tooindicate hello permissions it requires toobe functional.</span></span> <span data-ttu-id="9506f-475">Этот список необходимых разрешений отображается в диалоговом окне, когда пользователь или администратор в каталоге назначения hello дает согласие toohello приложения, который делает доступными tootheir организации.</span><span class="sxs-lookup"><span data-stu-id="9506f-475">This list of required permissions is shown in a dialog when a user or administrator in hello destination directory gives consent toohello application, which makes it available tootheir organization.</span></span> <span data-ttu-id="9506f-476">Некоторые приложения требуют только правами пользователя, что любой пользователь в организации hello можно дать согласие.</span><span class="sxs-lookup"><span data-stu-id="9506f-476">Some applications require just user-level permissions, which any user in hello organization can consent to.</span></span> <span data-ttu-id="9506f-477">Другие приложения требуют разрешения на уровне администратора, которые пользователь в организации hello не удается разрешить.</span><span class="sxs-lookup"><span data-stu-id="9506f-477">Other applications require administrator-level permissions, which a user in hello organization cannot consent to.</span></span> <span data-ttu-id="9506f-478">Только администратор каталога может предоставить согласие tooapplications, который требует этот уровень разрешений.</span><span class="sxs-lookup"><span data-stu-id="9506f-478">Only a directory administrator can give consent tooapplications that require this level of permissions.</span></span> <span data-ttu-id="9506f-479">При hello пользователь или администратор дает согласие, оба hello веб-API регистрируются в каталоге.</span><span class="sxs-lookup"><span data-stu-id="9506f-479">When hello user or administrator consents, both of hello web APIs are registered in their directory.</span></span>

#### <a name="token-expiration"></a><span data-ttu-id="9506f-480">Срок действия маркера</span><span class="sxs-lookup"><span data-stu-id="9506f-480">Token Expiration</span></span>
<span data-ttu-id="9506f-481">Когда первое приложение hello использует его tooget код авторизации токен доступа JWT, оно также получает токен обновления.</span><span class="sxs-lookup"><span data-stu-id="9506f-481">When hello first application uses its authorization code tooget a JWT access token, it also receives a JWT refresh token.</span></span> <span data-ttu-id="9506f-482">По истечении срока действия маркера доступа hello hello токен обновления может быть используется toore-для проверки подлинности пользователя hello без запроса учетных данных.</span><span class="sxs-lookup"><span data-stu-id="9506f-482">When hello access token expires, hello refresh token can be used toore-authenticate hello user without prompting for credentials.</span></span> <span data-ttu-id="9506f-483">Этот токен обновления, а затем используется tooauthenticate hello пользователя, токен, какие результаты в новый доступ и обновление токена.</span><span class="sxs-lookup"><span data-stu-id="9506f-483">This refresh token is then used tooauthenticate hello user, which results in a new access token and refresh token.</span></span>

## <a name="see-also"></a><span data-ttu-id="9506f-484">См. также</span><span class="sxs-lookup"><span data-stu-id="9506f-484">See Also</span></span>
[<span data-ttu-id="9506f-485">Руководство разработчика по Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9506f-485">Azure Active Directory Developer's Guide</span></span>](active-directory-developers-guide.md)

[<span data-ttu-id="9506f-486">Примеры кода Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9506f-486">Azure Active Directory Code Samples</span></span>](active-directory-code-samples.md)

[<span data-ttu-id="9506f-487">Важные сведения о смене ключей подписи в Azure AD</span><span class="sxs-lookup"><span data-stu-id="9506f-487">Important Information About Signing Key Rollover in Azure AD</span></span>](active-directory-signing-key-rollover.md)

[<span data-ttu-id="9506f-488">OAuth 2.0 в Azure AD</span><span class="sxs-lookup"><span data-stu-id="9506f-488">OAuth 2.0 in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn645545.aspx)

