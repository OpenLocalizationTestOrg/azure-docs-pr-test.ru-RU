---
title: "Сценарии для Azure AD aaaAuthentication | Документы Microsoft"
description: "Общие сведения о hello пяти наиболее распространенных сценариев проверки подлинности для Azure Active Directory (AAD)"
services: active-directory
documentationcenter: dev-center-name
author: skwan
manager: mbaldwin
editor: 
ms.assetid: 0c84e7d0-16aa-4897-82f2-f53c6c990fd9
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/27/2017
ms.author: skwan
ms.custom: aaddev
ms.openlocfilehash: 5b391e3f096fcb52934c4a8aff08688352bfd3dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="authentication-scenarios-for-azure-ad"></a>Сценарии аутентификации в Azure Active Directory
Azure Active Directory (Azure AD) упрощает проверку подлинности для разработчиков, предоставляя удостоверение как служба, поддерживающая для стандартных протоколов, таких как OAuth 2.0 и OpenID Connect, а также для разных платформ toohelp библиотеки c открытым исходным быстро начать кодирование. Этот документ поможет понять hello поддерживает различные сценарии Azure AD и мы покажем, как tooget запущена. Он состоит из hello в следующих разделах:

* [Основы проверки подлинности в Azure AD](#basics-of-authentication-in-azure-ad)
* [Утверждения в маркерах безопасности Azure AD](#claims-in-azure-ad-security-tokens)
* [Основные сведения о регистрации приложения в Azure AD](#basics-of-registering-an-application-in-azure-ad)
* [Типы приложений и сценарии](#application-types-and-scenarios)
  
  * [Веб-браузер tooWeb приложения](#web-browser-to-web-application)
  * [Одностраничное приложение (SPA)](#single-page-application-spa)
  * [TooWeb собственного приложения API](#native-application-to-web-api)
  * [Веб-приложения tooWeb API](#web-application-to-web-api)
  * [Управляющая программа или серверное приложение tooWeb API](#daemon-or-server-application-to-web-api)

## <a name="basics-of-authentication-in-azure-ad"></a>Основы проверки подлинности в Azure AD
Если вы не знакомы с основными концепциями процесса проверки подлинности в Azure AD, прочтите этот раздел. В противном случае вы можете tooskip вниз слишком[типы приложений и сценарии](#application-types-and-scenarios).

Давайте рассмотрим hello основных сценариев, где требуется удостоверение: пользователю в веб-браузере требуется tooauthenticate tooa веб-приложения. Данный сценарий описывается более подробно в hello [tooWeb веб-браузере приложений](#web-browser-to-web-application) раздела, но и тот же запуск точки tooillustrate hello возможности Azure AD и объяснить, как работает сценарий hello. Примите во внимание следующие схемы для этого сценария hello.

![Обзор tooweb входа приложения](./media/active-directory-authentication-scenarios/basics_of_auth_in_aad.png)

С диаграммой hello выше в виду, вот что нужно tooknow о его компонентов:

* Azure AD — hello поставщик удостоверений, отвечающий по проверке hello удостоверений пользователей и приложений, которые существуют в каталоге организации и выдающий токены безопасности после успешной проверки подлинности этих пользователей и приложений.
* Приложение, желающее tooAzure toooutsource проверки подлинности AD должны регистрироваться в Azure AD, который регистрирует и уникально идентифицирует приложение hello в каталоге hello.
* Разработчики могут использовать hello Azure AD с открытым кодом библиотеки toomake проверка подлинности легко путем обработки деталей протокола hello. Дополнительные сведения см. в статье [Библиотеки проверки подлинности в Azure Active Directory](active-directory-authentication-libraries.md).

• Один раз пользователь прошел проверку подлинности, приложение hello должно проверить tooensure токена безопасности пользователя hello успешности проверки подлинности для hello сторон. Разработчики могут использовать hello, предоставляемые проверки toohandle библиотеки проверки подлинности любого токена от Azure AD, включая веб-токены JSON (JWT) и SAML 2.0. Если требуется проверка tooperform вручную, см. раздел hello [обработчик токенов JWT](https://msdn.microsoft.com/library/dn205065.aspx) документации.

> [!IMPORTANT]
> Azure AD использует шифрование с открытым ключом toosign токены и убедитесь, что они являются допустимыми. В разделе [важные сведения о подписи смене ключей в Azure AD](active-directory-signing-key-rollover.md) Дополнительные сведения о hello необходимую логику, необходимо иметь в tooensure вашего приложения он всегда обновляется hello последние ключи.
> 
> 

• hello поток запросов и ответов для процесса проверки подлинности hello определяется hello протокол проверки подлинности, который был использован, таким как OAuth 2.0, OpenID Connect, WS-Federation и SAML 2.0. Эти протоколы рассматриваются более подробно в hello [протоколы проверки подлинности Azure Active Directory](active-directory-authentication-protocols.md) разделе и в следующих разделах hello.

> [!NOTE]
> Azure AD поддерживает hello OAuth 2.0 и OpenID Connect стандарты, которые широко используют токены носителя, включая токены носителя, представленные как JWT. Токен носителя — это упрощенный токен безопасности, предоставляет hello tooa доступа «bearer» защищенный ресурс. В этом смысле hello «bearer» является любая сторона, которая может предъявить токен hello. На то, что субъект должен сначала пройти проверку подлинности с помощью Azure AD токен носителя tooreceive hello, hello требуемые действия не предпринимаются токен toosecure hello в передачи и хранения, его можно перехват и использовать несанкционированной стороной. Хотя в некоторых маркерах безопасности для предотвращения несанкционированного использования применяется специальный встроенный механизм, в токенах носителя такого механизма нет, и они должны передаваться по защищенному каналу, например с использованием стандарта безопасности транспортного уровня (HTTPS). Если токен носителя, передается в очистить hello, атаке hello man в среднем может использоваться токеном злоумышленник tooacquire hello и использовать его для несанкционированного доступа tooa защищенного ресурса. Hello те же принципы безопасности применяются при сохранении или кэшировании токенов носителя для последующего использования. Необходимо всегда проверять, что приложение передает и сохраняет маркеры носителя безопасным образом. Дополнительные сведения о безопасности в случае применения токенов носителя см. в [RFC 6750, раздел 5](http://tools.ietf.org/html/rfc6750).
> 
> 

Теперь, после обзора основ hello, чтение hello разделов ниже toounderstand как работает Подготовка в Azure AD и hello распространенные сценарии поддерживает Azure AD.

## <a name="claims-in-azure-ad-security-tokens"></a>Утверждения в маркерах безопасности Azure AD
Маркеры безопасности, выданный Azure AD содержит утверждений или проверочные утверждения информации о субъекте hello, который прошел проверку подлинности. Эти утверждения могут использоваться приложением hello для различных задач. Например они могут быть токен используется toovalidate hello, идентификации клиента каталога субъекта hello, отображать сведения о пользователе, определения авторизации субъекта hello и т. д. Hello утверждений в любом заданном маркере безопасности зависят от типа hello маркера, типа hello hello пользователя учетные данные, используемые tooauthenticate и конфигурации приложения hello. Краткое описание каждого типа утверждения, выдаваемого Azure AD, приведен в следующей таблице hello. Дополнительные сведения см. в разделе слишком[типы поддерживаемых токенов и утверждений](active-directory-token-and-claims.md).

| Утверждение | Описание |
| --- | --- |
| Идентификатор приложения |Идентифицирует приложение hello, использующее токен hello. |
| Аудитория |Идентифицирует ресурс получателя hello hello маркер предназначен для. |
| Application Authentication Context Class Reference |Указывает, каким образом hello клиент был аутентифицирован (общедоступный клиент или конфиденциальный клиент). |
| Authentication Instant |Записи hello дату и время аутентификации hello. |
| Метод проверки подлинности |Указывает, как был аутентифицирован субъект hello hello маркера (пароль, сертификат, и т. д.). |
| Имя |Предоставляет hello заданное имя пользователя hello, набор в Azure AD. |
| Группы |Содержит объект группы идентификаторов Azure AD, которые hello пользователь является членом. |
| Identity Provider |Поставщик удостоверений записей hello проверку подлинности субъекта hello hello маркера. |
| Выдано в |Время записи hello, выдачи маркера какие hello, часто используется для определения актуальности маркера. |
| Издатель |Идентифицирует hello STS, которая выдала маркер hello, а также клиент Azure AD hello. |
| Фамилия |Предоставляет hello Фамилия пользователя hello в виде набора в Azure AD. |
| Имя |Предоставляет читаемое значение, идентифицирующее субъект hello hello маркера. |
| Идентификатор объекта |Содержит неизменяемый уникальный идентификатор субъекта hello в Azure AD. |
| Роли |Содержит понятные имена ролей приложения Azure AD, hello пользователю было предоставлено. |
| Область |Указывает hello разрешения предоставленный toohello клиентское приложение. |
| Субъект |Указывает участника hello, информацию о которой hello подтверждает маркер. |
| Идентификатор клиента |Содержит неизменяемый уникальный идентификатор клиента каталога hello, выдавшего токен hello. |
| Token Lifetime |Определяет hello интервал времени, в течение которого действителен маркер. |
| Имя участника-пользователя |Содержит hello имя участника-пользователя субъекта hello. |
| Version (версия) |Содержит номер версии hello hello маркера. |

## <a name="basics-of-registering-an-application-in-azure-ad"></a>Основные сведения о регистрации приложения в Azure AD
Любое приложение, передающее проверку подлинности tooAzure AD должны быть зарегистрированы в каталоге. Этот шаг подразумевает сообщение Azure AD, о приложении, включая hello URL-адрес, где он находится, toosend hello URL-адрес ответа после проверки подлинности, hello URI tooidentify приложения и многое другое. Эта информация необходима по нескольким основным причинам:

* Azure AD необходимы координаты toocommunicate с приложением hello при обработке входа или обмене маркерами. К ним относятся следующие hello:
  
  * URI идентификатора приложения: идентификатор hello для приложения. Это значение отправляется tooAzure AD во время проверки подлинности tooindicate, какие приложения hello вызывающий хочет получить маркер. Кроме того это значение включается в токен hello, чтобы приложение hello известно, что оно было что hello предназначен целевой.
  * Ответить URL-адрес и URI перенаправления: В случае веб-API или веб-приложения hello hello URL-адрес ответа является toowhich расположение hello Azure AD будет отправлять ответ проверки подлинности hello, включая маркер, если проверка подлинности прошла успешно. В случае собственного приложения hello hello URI перенаправления является уникальным идентификатором toowhich Azure AD будет перенаправлять hello user-agent в запросе OAuth 2.0.
  * Идентификатор приложения: hello идентификатор для приложения, который создается Azure AD при регистрации приложения hello. При запросе кода авторизации или маркер, идентификатор приложения hello и ключ отправляются tooAzure AD во время проверки подлинности.
  * Ключ: hello ключ, который отправляется вместе с Идентификатором приложения при проверке подлинности tooAzure AD toocall веб-API.
* Azure AD требуется приложение hello tooensure имеет hello tooaccess необходимые разрешения на каталог данных, других приложений в вашей организации и т. д

Процесс подготовки станет яснее, когда вы поймете, что существует две категории приложений, которые можно разрабатывать и интегрировать с Azure AD:

* Однотенантное приложение. Однотенантное приложение (для одного клиента) предназначено для использования в одной организации. Обычно это бизнес-приложения (LoB), которые создает разработчик компании. Приложения одного клиента достаточно toobe пользователями в одном каталоге, и в результате его достаточно подготовить в одном каталоге toobe. Эти приложения обычно регистрируются разработчиком в организации hello.
* Мультитенантное приложение. Мультитенантное приложение (для нескольких клиентов) предназначено для использования во многих организациях, а не только в одной. Как правило, это приложения категории "программное обеспечение как услуга" (SaaS), которые создают независимые поставщики программных продуктов (ISV). Мультитенантные приложения должны подготовить в каждом каталоге, где они будут использоваться, требующий tooregister согласия пользователя или администратора toobe их. Процесс получения согласия начинается, когда приложение было зарегистрировано в каталоге hello и предоставляется доступ toohello Graph API или возможно другому веб-API. Когда пользователь или администратор из другой организации регистрируется toouse приложения hello, они должны быть представлены с помощью диалогового окна, которое отображает hello разрешения, необходимые для приложения hello. Hello пользователь или администратор может затем согласия toohello приложение, которое предоставляет toohello доступа приложения hello указываются данные, и наконец регистры hello приложения в каталоге. Дополнительные сведения см. в разделе [Обзор инфраструктуры согласия hello](active-directory-integrating-applications.md#overview-of-the-consent-framework).

При разработке мультитенантного приложения вместо однотенантного необходимо учесть некоторые дополнительные соображения. Например, при внесении доступных toousers вашего приложения в нескольких каталогах, то необходимо toodetermine механизм какой клиент в которых они расположены. Приложения одного клиента достаточно toolook в свой собственный каталог для пользователя, пока многопользовательского приложения должен tooidentify конкретного пользователя во всех каталогах hello в Azure AD. tooaccomplish этой задачи Azure AD предоставляет общую конечную точку проверки подлинности, куда мультитенантное приложение может направлять запросов на вход в, а не клиентская конечная точка. Эта конечная точка является https://login.microsoftonline.com/common для всех каталогов в Azure AD, тогда как клиентская конечная точка может быть https://login.microsoftonline.com/contoso.onmicrosoft.com. Hello Обычная конечная точка является особенно важным tooconsider при разработке приложения, так как они потребуются hello toohandle необходимую логику несколько клиентов во время входа, выхода и проверки токенов.

Если вы разрабатываете приложения одного клиента, которые toomake его доступных toomany организаций, можно легко вносить изменения toohello приложения и его конфигурации в Azure AD toomake он поддерживает нескольких клиентов. Кроме того, Azure AD использует hello одинаковым подписывания ключа во всех каталогах, следует ли вы предоставляете проверки подлинности в одном клиенте или многопользовательского приложения.

Каждый сценарий, рассматриваемый в этом документе, содержит подраздел, где описываются соответствующие требования по подготовке. Дополнительные сведения о подготовке приложения в Azure AD и hello различия между приложениями, одной или нескольких клиентов см. в разделе [интеграция приложений с Azure Active Directory](active-directory-integrating-applications.md) для получения дополнительной информации. Чтобы продолжайте чтение toounderstand общими сценариями приложения hello в Azure AD.

## <a name="application-types-and-scenarios"></a>Типы приложений и сценарии
Каждый из сценариев hello, описанные в этом документе может быть разработан на разных языках и платформах. Все они поддерживаются средствами полные примеры кода, доступных в нашем [руководства образцы кода](active-directory-code-samples.md), или непосредственно из соответствующего hello [образец репозиториях GitHub](https://github.com/Azure-Samples?utf8=%E2%9C%93&query=active-directory). Кроме того, если вашему приложению требуется конкретная часть или сегмент комплексного сценария, то в большинстве случаев эти функции можно добавлять независимым образом. Например если имеется собственное приложение, которое вызывает веб-API, легко добавить веб-приложение, которое также вызывает hello веб-API. Hello следующей схеме приведены эти сценарии и типы приложений, и как можно добавить различные компоненты:

![Типы приложений и сценарии](./media/active-directory-authentication-scenarios/application_types_and_scenarios.png)

Это hello пять основных сценариев приложений поддерживаемых Azure AD.

* [Веб-браузер tooWeb приложения](#web-browser-to-web-application): пользователю нужно toosign в tooa веб-приложение, защищенное Azure AD.
* [Одна страница приложения (SPA)](#single-page-application-spa): пользователю нужно toosign в tooa одностраничное приложение, защищенное Azure AD.
* [TooWeb собственного приложения API](#native-application-to-web-api): собственное приложение, запускаемое на телефоне, планшете или tooauthenticate потребностей ПК tooget пользователя ресурсы из веб-API, защищенные Azure AD.
* [Веб-API приложения tooWeb](#web-application-to-web-api): веб-приложению требуются tooget ресурсы из веб-API, защищенного Azure AD.
* [Управляющая программа или серверное приложение tooWeb API](#daemon-or-server-application-to-web-api): приложение-демон или серверное приложение без веб-интерфейса пользователя требуются tooget ресурсы из веб-API, защищенного Azure AD.

### <a name="web-browser-tooweb-application"></a>Веб-браузер tooWeb приложения
В этом разделе описывается приложение, которое проверяет подлинность пользователя в приложении web tooa веб-браузера. В этом сценарии веб-приложение hello направляет toosign hello пользователя обозревателя в tooAzure AD. Azure AD возвращает ответ вход через hello в браузере пользователя, который содержит утверждения о пользователе hello в маркере безопасности. Этот сценарий поддерживает вход с использованием протоколов WS-Federation, SAML 2.0 и OpenID Connect hello.

#### <a name="diagram"></a>Схема
![Ход проверки подлинности для приложения браузера tooweb](./media/active-directory-authentication-scenarios/web_browser_to_web_api.png)

#### <a name="description-of-protocol-flow"></a>Описание потока протокола
1. Когда пользователь посещает приложения hello и toosign в, они перенаправляются через конечную точку проверки подлинности toohello запрос вход в Azure AD.
2. Hello пользователь входит на страницу входа hello.
3. При успешном выполнении проверки подлинности Azure AD создает маркер проверки подлинности и возвращает URL-адрес приложения toohello ответа входа ответа, установленный на портале Azure hello. В рабочем приложении для этого URL-адреса ответа должен использоваться протокол HTTPS. Hello вернул токен содержит утверждения о пользователе hello и Azure AD, которые требуются маркер hello toovalidate приложения hello.
4. приложение Hello проверяет hello токен с помощью открытого ключа подписывания и издателя сведений, доступных в hello документа метаданных федерации для Azure AD. После hello приложение проверяет токен hello, Azure AD запускает новый сеанс с пользователем hello. В этом сеансе можно tooaccess hello пользователя приложения hello до истечения срока его действия.

#### <a name="code-samples"></a>Примеры кода
Просмотрите образцы кода hello для сценариев приложений tooWeb веб-браузер. И возвращайтесь почаще — мы добавляем новые примеры все время hello. [Веб-браузер tooWeb приложения](active-directory-code-samples.md#web-browser-to-web-application).

#### <a name="registering"></a>Регистрация
* Одного клиента: При построении приложения только для одной организации, его должны регистрироваться в каталоге этой организации с помощью портала Azure hello.
* Несколько клиентов: При построении приложения, которое может использоваться пользователями за пределами вашей организации, он должен быть зарегистрирован в каталоге этой организации, но также должны быть зарегистрированы в каталоге каждой организации, который будет использовать приложение hello. toomake вашего приложения в каталоге, можно включить процесс регистрации для клиентов, который позволяет им tooconsent tooyour приложения. При регистрации приложения, они откроется диалоговое окно, которое показывает, требует приложение hello разрешения hello и затем hello tooconsent параметр. В зависимости от hello необходимые разрешения, администратор в hello может быть другой организации требуется toogive согласия. Когда hello пользователь или администратор дает согласие, приложение hello регистрируется в каталоге. Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](active-directory-integrating-applications.md).

#### <a name="token-expiration"></a>Срок действия маркера
сеанс пользователя Hello истечения срока действия, когда истекает время существования hello hello маркера, выданного Azure AD. При необходимости приложение может сократить этот период времени, например, обеспечивая выход пользователей на основании некоторого периода бездействия. По окончании сеанса hello hello пользователя будет запрашиваемые toosign в еще раз.

### <a name="single-page-application-spa"></a>Одностраничное приложение (SPA)
В этом разделе описана аутентификация для одностраничного приложения, которое использует Azure AD и hello неявное авторизации OAuth 2.0 предоставьте toosecure завершить обратно его веб-API. Обычно приложений на одной странице структурированы в качестве уровня представления данных JavaScript (интерфейса), работающей в браузере hello и серверную часть веб-API, которая выполняется на сервере и реализует hello бизнес-логики приложения. toolearn Дополнительные сведения о предоставления неявное авторизации hello и поможет вам решить, подходит ли она для сценария вашего приложения в разделе [поток в Azure Active Directory разрешений hello основные сведения о неявных OAuth2](active-directory-dev-understanding-oauth2-implicit-grant.md).

В этом случае при входе в систему пользователя hello hello JavaScript front end используется [библиотеку аутентификации Active Directory для JavaScript (ADAL. JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js/tree/dev) и hello неявное авторизации предоставлении tooobtain маркер идентификатора (id_token) из Azure AD. Hello маркера в кэше и hello клиент присоединяет его toohello запроса как прикрепленный токен носителя hello при выполнении вызовов, что tooits веб-API серверной части, которая защищена с помощью по промежуточного слоя OWIN hello. 

#### <a name="diagram"></a>Схема
![Схема одностраничного приложения](./media/active-directory-authentication-scenarios/single_page_app.png)

#### <a name="description-of-protocol-flow"></a>Описание потока протокола
1. Hello пользователь переходит toohello веб-приложения.
2. приложение Hello возвращает внешнего интерфейса (уровень представления данных) toohello hello JavaScript браузера.
3. Hello пользователь инициирует вход, например, щелкнув ссылку входа. Hello браузер отправляет конечной точки toorequest авторизации Azure AD GET toohello маркер идентификатора. Этот запрос включает hello идентификатор и ответ URL-адрес приложения в параметрах запроса hello.
4. Azure AD проверяет URL-адрес ответа от hello зарегистрированные URL-адрес ответа, установленный на портале Azure hello hello.
5. Hello пользователь входит на страницу входа hello.
6. При успешном выполнении проверки подлинности Azure AD создает маркер идентификатора и возвращает его как URL-адрес ответа приложения фрагмента (#) URL-адрес toohello. В рабочем приложении для этого URL-адреса ответа должен использоваться протокол HTTPS. Hello вернул токен содержит утверждения о пользователе hello и Azure AD, которые требуются маркер hello toovalidate приложения hello.
7. клиентский код JavaScript Hello, выполняются в браузере hello извлекает маркер hello из toouse hello ответа для защиты вызовов завершить обратно toohello приложения веб-API.
8. Здравствуйте, приложения для браузера вызовы hello web API обратно заканчиваются hello маркер доступа в заголовок authorization hello.

#### <a name="code-samples"></a>Примеры кода
Просмотрите образцы кода hello для сценариев приложения одной странице (SPA). Часто, что toocheck назад — мы добавляем новые образцы все время hello. [Одностраничное приложение (SPA)](active-directory-code-samples.md#single-page-application-spa).

#### <a name="registering"></a>Регистрация
* Одного клиента: При построении приложения только для одной организации, его должны регистрироваться в каталоге этой организации с помощью портала Azure hello.
* Несколько клиентов: При построении приложения, которое может использоваться пользователями за пределами вашей организации, он должен быть зарегистрирован в каталоге этой организации, но также должны быть зарегистрированы в каталоге каждой организации, который будет использовать приложение hello. toomake вашего приложения в каталоге, можно включить процесс регистрации для клиентов, который позволяет им tooconsent tooyour приложения. При регистрации приложения, они откроется диалоговое окно, которое показывает, требует приложение hello разрешения hello и затем hello tooconsent параметр. В зависимости от hello необходимые разрешения, администратор в hello может быть другой организации требуется toogive согласия. Когда hello пользователь или администратор дает согласие, приложение hello регистрируется в каталоге. Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](active-directory-integrating-applications.md).

После регистрации приложения hello, он должен быть настроенный toouse протокола неявного предоставления OAuth 2.0. По умолчанию для приложений этот протокол отключен. hello tooenable протокола неявного предоставления OAuth2 для своего приложения, измените его манифест приложения с портала Azure hello и задайте tootrue значение «oauth2AllowImplicitFlow» hello. Подробные инструкции см. в разделе [Включение неявного предоставления авторизации OAuth 2.0 для одностраничных приложений](active-directory-integrating-applications.md).

#### <a name="token-expiration"></a>Срок действия маркера
При использовании проверки подлинности toomanage ADAL.js с Azure AD, преимущества несколько функций, которые упрощают обновление просроченного маркера, а также получение маркеров для дополнительных веб-API ресурсы, которые могут быть вызваны приложения hello. Когда hello пользователь успешно проходит проверку подлинности в Azure AD, защищенный файлом cookie сеанса создается hello пользователя между браузером hello и Azure AD. Это важные toonote, hello сеанс существует между пользователем hello и Azure AD и not between пользователя hello и hello веб-приложения, запущенные на сервере hello. По истечении срока действия маркера ADAL.js использует этот сеанс, toosilently получить другой маркер. Он делает это с помощью скрытого iFrame toosend и получать запрос hello, с помощью протокола неявного предоставления OAuth hello. ADAL.js также может использовать такой же механизм toosilently получать токены доступа из Azure AD для других веб-API ресурсы, что приложение вызывает hello до тех пор, пока эти ресурсы поддерживают ресурсов независимо от источника (CORS) для управления доступом зарегистрированы в каталоге пользователя hello, и все необходимые разрешения предоставленный hello пользователя при входе в систему.

### <a name="native-application-tooweb-api"></a>TooWeb собственного приложения API
В этом разделе описывается нативное приложение, которое вызывает веб-интерфейс API от имени пользователя. Этот сценарий основан на типе предоставления кода авторизации hello OAuth 2.0 общему клиенту, как описано в разделе 4.1 hello [спецификации OAuth 2.0](http://tools.ietf.org/html/rfc6749). Hello собственное приложение получает токен доступа для hello пользователя с помощью протокола OAuth 2.0 hello. Затем этот токен доступа отправляется в hello запроса toohello веб-API, который авторизует пользователя hello и возвращает hello требуемого ресурса.

#### <a name="diagram"></a>Схема
![Собственного приложения tooWeb схема API](./media/active-directory-authentication-scenarios/native_app_to_web_api.png)

#### <a name="authentication-flow-for-native-application-tooapi"></a>Ход проверки подлинности для собственного приложения tooAPI
#### <a name="description-of-protocol-flow"></a>Описание потока протокола
При использовании библиотеки проверки подлинности hello AD большую часть деталей протокола hello, описанных ниже выполняется за вас, например hello всплывающее окно браузера, кэширование токенов и обработка токенов обновления.

1. С помощью всплывающего окна браузера, собственное приложение hello делает конечную точку авторизации toohello запроса в Azure AD. Этот запрос включает идентификатор приложения hello и перенаправления hello URI собственного приложения hello, как показано в hello портала Azure и URI идентификатора приложения hello для hello веб-API. Если пользователь hello еще не зарегистрированы, запрашиваемые toosign в будут снова
2. Azure AD проверяет подлинность пользователя hello. Если это многопользовательского приложения, и оно требуется toouse приложения hello, hello пользователю будут необходимые tooconsent, если они еще не сделали этого. После предоставления согласия и после успешной проверки подлинности Azure AD выдает авторизации код ответа задней toohello клиентского приложения URI перенаправления.
3. Когда Azure AD отправляет ответ с кодом авторизации обратно toohello URI перенаправления, hello в коде клиентского приложения останавливается браузера взаимодействия и извлекает hello авторизации из ответа hello. С помощью следующего кода авторизации, hello клиентское приложение отправляет запрос tooAzure AD маркера конечную точку, которая включает код авторизации hello, сведения об hello клиентском приложении (идентификатор приложения и URI перенаправления) и hello нужный ресурс (идентификатор приложения URI для hello веб-API).
4. Код авторизации Hello и сведения о hello клиентского приложения и веб-API проверяются Azure AD. После успешной проверки Azure AD возвращает два маркера: маркер доступа JWT и маркер обновления JWT. Кроме того Azure AD возвращает основные сведения о пользователе hello, например их отображаемое имя и идентификатор клиента.
5. По протоколу HTTPS hello клиентское приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API. Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.
6. По истечении срока действия маркера доступа hello hello клиентское приложение получит ошибку, которая указывает, что пользователь hello должен tooauthenticate еще раз. Если приложение hello имеет допустимый токен обновления, может быть используется tooacquire новый маркер доступа без запроса подтверждения hello toosign пользователя в еще раз. Если истекает срок действия токена обновления hello, приложение hello должно toointeractively для проверки подлинности hello пользователя еще раз.

> [!NOTE]
> токен обновления Hello выданного Azure AD может быть tooaccess используется несколько ресурсов. Например если клиентское приложение, которое имеет разрешение toocall двух в веб-API, hello токен обновления может быть используется tooget access token toohello других веб-API также.
> 
> 

#### <a name="code-samples"></a>Примеры кода
Просмотрите образцы кода hello для собственного приложения tooWeb API сценариев. И возвращайтесь почаще — мы добавляем новые примеры все время hello. [TooWeb собственного приложения API](active-directory-code-samples.md#native-application-to-web-api).

#### <a name="registering"></a>Регистрация
* Для одного клиента: Оба hello собственное приложение и hello веб-API, которые должны быть зарегистрированы в hello один каталог в Azure AD. Hello веб-API может быть настроенный tooexpose набор разрешений, которые являются используется toolimit hello собственный доступ tooits ресурсы приложения. затем Hello клиентское приложение выбирает hello требуемого разрешения из раскрывающегося списка «TooOther разрешений приложения» hello меню в hello портала Azure.
* Несколько клиентов: Во-первых, собственное приложение hello только регистрируется в каталоге издателя или разработчика hello. Во-вторых собственное приложение hello — настроенное tooindicate hello разрешения, необходимые toobe работы. Этот список необходимых разрешений отображается в диалоговом окне, когда пользователь или администратор в каталоге назначения hello дает согласие toohello приложения, который делает доступными tootheir организации. Некоторые приложения требуют только правами пользователя, что любой пользователь в организации hello можно дать согласие. Другие приложения требуют разрешения на уровне администратора, которые пользователь в организации hello не удается разрешить. Только администратор каталога может предоставить согласие tooapplications, который требует этот уровень разрешений. Когда hello пользователь или администратор дает согласие, в своем каталоге регистрируется только hello веб-API. Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](active-directory-integrating-applications.md).

#### <a name="token-expiration"></a>Срок действия маркера
Когда собственное приложение hello использует его tooget код авторизации токен доступа JWT, оно также получает токен обновления. По истечении срока действия маркера доступа hello hello токен обновления может быть используется toore-для проверки подлинности пользователя hello без необходимости их toosign в еще раз. Этот токен обновления, а затем используется tooauthenticate hello пользователя, токен, какие результаты в новый доступ и обновление токена.

### <a name="web-application-tooweb-api"></a>Веб-приложения tooWeb API
В этом разделе описываются веб-приложения, который должен tooget ресурсы из веб-API. В этом случае существует два типа удостоверений, которые hello веб-приложения можно использовать tooauthenticate и вызвать hello веб-API: удостоверение приложения или удостоверение делегированного пользователя.

*Удостоверение приложения:* этот сценарий использует предоставления учетных данных клиента OAuth 2.0 tooauthenticate как приложение hello и hello доступа веб-API. При использовании удостоверения приложения hello web API может только обнаружить, что hello веб-приложения вызов его, как hello веб-API не получено никакой информации о пользователе hello. Если приложение hello получает сведения о пользователе hello, будут отправляться посредством протокола приложения hello и не подписываются Azure AD. Hello веб-API доверяет проверку подлинности веб-приложения hello hello пользователя. По этой причине данная схема называется доверенной (надежной) подсистемой.

*Делегированное удостоверение пользователя*. Этот сценарий можно реализовать двумя способами: использовать OpenID Connect и предоставить код авторизации OAuth 2.0 с помощью конфиденциального клиента. Hello веб-приложение получает токен доступа для пользователя hello, который доказывает toohello веб-API, hello toohello пользователь успешно прошел проверку подлинности веб-приложения и веб-приложения hello был может tooobtain делегированного пользователя удостоверения toocall hello веб-API. Этот токен доступа отправляется в hello запроса toohello веб-API, который авторизует пользователя hello и возвращает hello требуемого ресурса.

#### <a name="diagram"></a>Схема
![Веб-диаграмма tooWeb API приложения](./media/active-directory-authentication-scenarios/web_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a>Описание потока протокола
Оба hello удостоверения приложения и типы удостоверения делегированного пользователя рассматриваются ниже потока hello. Hello ключевое различие между ними состоит в hello делегировать удостоверение пользователя сначала нужно получить код авторизации перед hello пользователь может войти и получить доступ toohello веб-API.

##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a>Удостоверение приложения с предоставлением учетных данных клиента OAuth 2.0
1. Когда пользователь вошел в tooAzure AD в веб-приложение hello (hello в разделе [tooWeb веб-браузере приложений](#web-browser-to-web-application) выше).
2. веб-приложение Hello должен tooacquire маркер доступа, чтобы она могла проверить подлинность веб-API toohello и получать hello требуемого ресурса. Оно выполняет запрос tooAzure AD конечную точку токена, предоставляя hello учетных данных, идентификатор приложения и URI идентификатора приложения веб-API.
3. Azure AD проверяет подлинность приложения hello и возвращает токен доступа JWT, используемые toocall hello веб-API.
4. По протоколу HTTPS hello веб-приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API. Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.

##### <a name="delegated-user-identity-with-openid-connect"></a>Делегированное удостоверение пользователя с OpenID Connect
1. Когда пользователь вошел в tooa веб-приложения с помощью Azure AD (hello в разделе [tooWeb веб-браузере приложений](#web-browser-to-web-application) выше). Если пользователь hello hello веб-приложения еще не согласился tooallowing hello приложения toocall hello веб API от своего имени, hello пользователь должен будет tooconsent. приложение Hello отобразит hello разрешения, необходимые, и если любой из этих разрешения уровня администратора, обычный пользователь в каталоге hello не будет может tooconsent. Процесс получения согласия применяется только toomulti клиента приложения, не одного клиента, как приложение hello уже будет иметь необходимые разрешения hello. Когда hello пользователь выполнил вход, hello веб-приложение получает токен идентификатора со сведениями о hello пользователя, а также код авторизации.
2. С помощью кода авторизации hello, выданного Azure AD, веб-приложение hello отправляет запрос tooAzure AD маркера конечную точку, которая включает код авторизации hello, сведения о клиентском приложении hello (идентификатор приложения и URI перенаправления) и hello требуемого ресурса ( URI идентификатора приложения для hello веб-API).
3. Код авторизации Hello и сведения о hello веб-приложения и веб-API проверяются Azure AD. После успешной проверки Azure AD возвращает два маркера: маркер доступа JWT и маркер обновления JWT.
4. По протоколу HTTPS hello веб-приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API. Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.

##### <a name="delegated-user-identity-with-oauth-20-authorization-code-grant"></a>Делегированное удостоверение пользователя с предоставлением кода авторизации OAuth 2.0
1. Пользователь уже выполнил вход tooa веб-приложение, механизм проверки подлинности которого не зависит от Azure AD.
2. Hello веб-приложение требует авторизации кода tooacquire маркер доступа, поэтому оно выдает запрос через конечную точку авторизации tooAzure браузера hello AD, предоставляя hello идентификатор приложения и URI перенаправления для веб-приложения hello после успешной Проверка подлинности. Hello пользователь выполняет вход tooAzure AD.
3. Если пользователь hello hello веб-приложения еще не согласился tooallowing hello приложения toocall hello веб API от своего имени, hello пользователь должен будет tooconsent. приложение Hello отобразит hello разрешения, необходимые, и если любой из этих разрешения уровня администратора, обычный пользователь в каталоге hello не будет может tooconsent. Это согласие применяется tooboth одной или несколькими владельцами приложения.  В случае одного клиента hello администратора можно выполнить от имени пользователей tooconsent согласия администратора.  Это можно сделать с помощью hello `Grant Permissions` кнопку в hello [портала Azure](https://portal.azure.com). 
4. После согласия пользователя hello hello веб-приложение получает код авторизации hello, что ему требуется tooacquire маркер доступа.
5. С помощью кода авторизации hello, выданного Azure AD, веб-приложение hello отправляет запрос tooAzure AD маркера конечную точку, которая включает код авторизации hello, сведения о клиентском приложении hello (идентификатор приложения и URI перенаправления) и hello требуемого ресурса ( URI идентификатора приложения для hello веб-API).
6. Код авторизации Hello и сведения о hello веб-приложения и веб-API проверяются Azure AD. После успешной проверки Azure AD возвращает два маркера: маркер доступа JWT и маркер обновления JWT.
7. По протоколу HTTPS hello веб-приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API. Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.

#### <a name="code-samples"></a>Примеры кода
Просмотрите образцы кода hello для сценариев API tooWeb веб-приложения. И возвращайтесь почаще — мы добавляем новые примеры все время hello. Web [tooWeb приложения API](active-directory-code-samples.md#web-application-to-web-api).

#### <a name="registering"></a>Регистрация
* Одного клиента: Удостоверение приложения hello и случае удостоверения делегированного пользователя hello веб-приложения и веб-hello API должны быть зарегистрированы в hello один каталог в Azure AD. Hello веб-API может быть настроенный tooexpose набор разрешений, которые являются ресурсами tooits доступа используется toolimit hello веб-приложения. Если используется тип удостоверения делегированного пользователя, веб-приложение hello необходимы разрешения hello требуемого tooselect из раскрывающегося списка «TooOther разрешений приложения» hello меню в hello портала Azure. Этот шаг не является обязательным, если используется тип удостоверения приложения hello.
* Несколько клиентов: Во-первых, веб-приложение hello — настроенное tooindicate hello разрешения, необходимые toobe работы. Этот список необходимых разрешений отображается в диалоговом окне, когда пользователь или администратор в каталоге назначения hello дает согласие toohello приложения, который делает доступными tootheir организации. Некоторые приложения требуют только правами пользователя, что любой пользователь в организации hello можно дать согласие. Другие приложения требуют разрешения на уровне администратора, которые пользователь в организации hello не удается разрешить. Только администратор каталога может предоставить согласие tooapplications, который требует этот уровень разрешений. Когда hello согласие пользователя или администратора, hello веб-приложения и hello web API регистрируются в каталоге.

#### <a name="token-expiration"></a>Срок действия маркера
Когда веб-приложение hello использует его tooget код авторизации токен доступа JWT, оно также получает токен обновления. По истечении срока действия маркера доступа hello hello токен обновления может быть используется toore-для проверки подлинности пользователя hello без необходимости их toosign в еще раз. Этот токен обновления, а затем используется tooauthenticate hello пользователя, токен, какие результаты в новый доступ и обновление токена.

### <a name="daemon-or-server-application-tooweb-api"></a>Управляющая программа или серверное приложение tooWeb API
В этом разделе описываются управляющую программу или серверное приложение, которое должно tooget ресурсы из веб-API. Существует два следующих сценария toothis раздела: управляющей программы, которая требует toocall веб-API, построенных на тип предоставления учетных данных клиента OAuth 2.0; и приложения сервера (например, веб-API), которому требуется toocall веб-API, лежит спецификация behalf-of OAuth 2.0.

Для сценария hello необходимости toocall веб-API, управляющей программы это toounderstand важные моменты. Во-первых взаимодействие с пользователем не поддерживается с управляющей программой, которой требуется toohave приложения hello собственной идентификации. Пример управляющей программы — пакетного задания или выполняться в фоновом режиме hello служба операционной системы. Этот тип приложений запрашивает токен доступа с помощью своего удостоверения, представляя его идентификатор приложения, учетные данные (пароль или сертификат) и URI идентификатора приложения tooAzure AD. После успешной проверки подлинности управляющая программа hello Получает токен доступа из Azure AD, который затем используется toocall hello веб-API.

Для сценария hello при серверного приложения необходимо toocall веб-API, бывает полезно toouse пример. Предположим, что пользователь прошел проверку подлинности в приложении машинного кода, и этому приложению toocall веб-API. Azure AD выдает JWT access token toocall hello веб-API. Если hello веб-API должен toocall другой нисходящий веб-API, можно использовать удостоверение toodelegate hello hello потока от имени представляет пользователя и проверки подлинности веб-API второго уровня toohello.

#### <a name="diagram"></a>Схема
![Схема tooWeb API демон или серверное приложение](./media/active-directory-authentication-scenarios/daemon_server_app_to_web_api.png)

#### <a name="description-of-protocol-flow"></a>Описание потока протокола
##### <a name="application-identity-with-oauth-20-client-credentials-grant"></a>Удостоверение приложения с предоставлением учетных данных клиента OAuth 2.0
1. Во-первых серверное приложение hello должно tooauthenticate с Azure AD от своего имени, без вмешательства человека, такие как интерактивное диалоговое окно входа. Оно выполняет запрос tooAzure AD конечную точку токена, предоставляя hello учетных данных, идентификатор приложения и URI идентификатора приложения.
2. Azure AD проверяет подлинность приложения hello и возвращает токен доступа JWT, используемые toocall hello веб-API.
3. По протоколу HTTPS hello веб-приложение использует hello hello tooadd токена доступа JWT строку JWT с назначением «bearer», возвращенная в заголовок авторизации hello hello запроса toohello веб-API. Hello веб-API затем проверяет токен JWT hello, и если проверка прошла успешно, возвращает hello требуемого ресурса.

##### <a name="delegated-user-identity-with-oauth-20-on-behalf-of-draft-specification"></a>Делегированное удостоверение пользователя с проектом спецификации OAuth 2.0 On-Behalf-Of (от имени)
Hello потоке, который рассматривается ниже предполагается, что пользователь прошел проверку подлинности в другом приложении (например, в приложении машинного кода), а учетных данных пользователя была tooacquire используется API-Интерфейс веб-первого уровня toohello токена доступа.

1. собственное приложение Hello отправляет первого уровня веб-маркера toohello hello доступа к API.
2. веб-API первого уровня Hello отправляет запрос tooAzure AD конечную точку токена, указав его идентификатор приложения и учетные данные, а также маркер доступа пользователя hello. Кроме того, hello запрос отправлен с on_behalf_of параметр, указывающий hello web API запрашивает новые токены toocall нижестоящий веб-API от имени исходного пользователя hello.
3. Azure AD проверяет hello первого уровня веб-API, имеет разрешения tooaccess hello второго уровня веб-API и проверяет запрос hello, возвращая токен доступа JWT и маркер JWT обновления токена toohello первого уровня веб-API.
4. По протоколу HTTPS веб-hello первого уровня, который затем вызывает API hello веб-API второго уровня, добавляя строку токена hello в заголовок Authorization hello в запросе hello. веб-API первого уровня Hello можно продолжить toocall hello второго уровня веб-API, при условии, что маркер доступа hello и токены обновления являются допустимыми.

#### <a name="code-samples"></a>Примеры кода
Просмотрите образцы кода hello для сценариев tooWeb API управляющей программы или серверного приложения. И возвращайтесь почаще — мы добавляем новые примеры все время hello. [Сервер или приложение управляющей программы tooWeb API](active-directory-code-samples.md#server-or-daemon-application-to-web-api)

#### <a name="registering"></a>Регистрация
* Одного клиента: Удостоверение приложения hello и случае удостоверения делегированного пользователя управляющую программу или серверное приложение hello необходимо зарегистрировать в hello один каталог в Azure AD. Hello веб-API может быть настроенный tooexpose набор разрешений, которые управляющая программа hello используется toolimit или tooits ресурсы сервера доступа. Если используется тип удостоверения делегированного пользователя, серверное приложение hello должно tooselect hello требуемого разрешения из раскрывающегося списка «TooOther разрешений приложения» hello меню в hello портала Azure. Этот шаг не является обязательным, если используется тип удостоверения приложения hello.
* Несколько клиентов: Во-первых, управляющую программу или серверное приложение hello — настроенное tooindicate hello разрешения, необходимые toobe работы. Этот список необходимых разрешений отображается в диалоговом окне, когда пользователь или администратор в каталоге назначения hello дает согласие toohello приложения, который делает доступными tootheir организации. Некоторые приложения требуют только правами пользователя, что любой пользователь в организации hello можно дать согласие. Другие приложения требуют разрешения на уровне администратора, которые пользователь в организации hello не удается разрешить. Только администратор каталога может предоставить согласие tooapplications, который требует этот уровень разрешений. При hello пользователь или администратор дает согласие, оба hello веб-API регистрируются в каталоге.

#### <a name="token-expiration"></a>Срок действия маркера
Когда первое приложение hello использует его tooget код авторизации токен доступа JWT, оно также получает токен обновления. По истечении срока действия маркера доступа hello hello токен обновления может быть используется toore-для проверки подлинности пользователя hello без запроса учетных данных. Этот токен обновления, а затем используется tooauthenticate hello пользователя, токен, какие результаты в новый доступ и обновление токена.

## <a name="see-also"></a>См. также
[Руководство разработчика по Azure Active Directory](active-directory-developers-guide.md)

[Примеры кода Azure Active Directory](active-directory-code-samples.md)

[Важные сведения о смене ключей подписи в Azure AD](active-directory-signing-key-rollover.md)

[OAuth 2.0 в Azure AD](https://msdn.microsoft.com/library/azure/dn645545.aspx)

