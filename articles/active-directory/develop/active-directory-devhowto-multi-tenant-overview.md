---
title: "aaaHow toobuild приложение, которое можно войти любой пользователь Azure AD | Документы Microsoft"
description: "Пошаговые инструкции по созданию приложения, которое может реализовать вход пользователя из любого клиента Azure Active Directory, также известного как мультитенантное приложение."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 123ea8125fa3c308ce0f124cc58e85ec28d476d5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-toosign-in-any-azure-active-directory-ad-user-using-hello-multi-tenant-application-pattern"></a><span data-ttu-id="3686f-103">Как toosign в любой пользователя Azure Active Directory (AD) с помощью hello шаблон многопользовательского приложения</span><span class="sxs-lookup"><span data-stu-id="3686f-103">How toosign in any Azure Active Directory (AD) user using hello multi-tenant application pattern</span></span>
<span data-ttu-id="3686f-104">Если предлагается программного обеспечения как службы приложения toomany организаций, можно настроить вашего приложения tooaccept входа в систему из любого клиента Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3686f-104">If you offer a Software as a Service application toomany organizations, you can configure your application tooaccept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="3686f-105">В Azure AD это называется "сделать приложение мультитенантным".</span><span class="sxs-lookup"><span data-stu-id="3686f-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="3686f-106">Пользователи в любой клиент Azure AD будут может toosign в приложении tooyour после соглашаетесь toouse учетную запись с приложением.</span><span class="sxs-lookup"><span data-stu-id="3686f-106">Users in any Azure AD tenant will be able toosign in tooyour application after consenting toouse their account with your application.</span></span>  

<span data-ttu-id="3686f-107">Если у вас есть приложение, которое имеет собственную систему учетных записей или поддерживает виды входа от других поставщиков облачных служб, добавить вход в Azure AD с любого клиента не составит труда.</span><span class="sxs-lookup"><span data-stu-id="3686f-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="3686f-108">Просто зарегистрируйте свое приложение, добавьте код входа через OAuth2, OpenID Connect или SAML и поместите кнопку "Вход с учетной записью Майкрософт" в свое приложение.</span><span class="sxs-lookup"><span data-stu-id="3686f-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="3686f-109">Выберите следующие дополнительные сведения о фирменной символике приложения toolearn кнопку hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-109">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="3686f-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="3686f-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="3686f-111">В этой статье предполагается, что вы уже знакомы с процессом создания однотенантного приложения для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3686f-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="3686f-112">Если вы не являетесь, head резервное копирование toohello [Домашняя страница руководство разработчика] [ AAD-Dev-Guide] и попробуйте один из наших краткие руководства!</span><span class="sxs-lookup"><span data-stu-id="3686f-112">If you’re not, head back up toohello [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="3686f-113">Существует четыре простых шагов tooconvert приложения в приложение нескольких клиентов Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3686f-113">There are four simple steps tooconvert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="3686f-114">Обновить приложение регистрации toobe мультитенантным</span><span class="sxs-lookup"><span data-stu-id="3686f-114">Update your application registration toobe multi-tenant</span></span>
2. <span data-ttu-id="3686f-115">Обновите ваш код toosend запросов toohello /common конечной точки</span><span class="sxs-lookup"><span data-stu-id="3686f-115">Update your code toosend requests toohello /common endpoint</span></span> 
3. <span data-ttu-id="3686f-116">Обновите ваш код toohandle нескольких значений поставщиков</span><span class="sxs-lookup"><span data-stu-id="3686f-116">Update your code toohandle multiple issuer values</span></span>
4. <span data-ttu-id="3686f-117">Изучите особенности получения согласия пользователя и администратора и внесите соответствующие изменения в код.</span><span class="sxs-lookup"><span data-stu-id="3686f-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="3686f-118">Давайте рассмотрим каждый из этих шагов подробнее.</span><span class="sxs-lookup"><span data-stu-id="3686f-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="3686f-119">Можно также перейти прямо слишком[этот список образцов несколькими клиентами][AAD-Samples-MT].</span><span class="sxs-lookup"><span data-stu-id="3686f-119">You can also jump straight too[this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-toobe-multi-tenant"></a><span data-ttu-id="3686f-120">Обновление регистрации toobe несколькими клиентами</span><span class="sxs-lookup"><span data-stu-id="3686f-120">Update registration toobe multi-tenant</span></span>
<span data-ttu-id="3686f-121">По умолчанию регистрация веб-приложения или API в Azure AD предусматривает работу только с одним клиентом, то есть является однотенантной.</span><span class="sxs-lookup"><span data-stu-id="3686f-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="3686f-122">Регистрацию можно сделать несколькими клиентами, если поиск hello» несколькими клиентской» переключиться на странице свойств hello регистрации вашего приложения в hello [портал Azure] [ AZURE-portal] и задание его слишком «Да».</span><span class="sxs-lookup"><span data-stu-id="3686f-122">You can make your registration multi-tenant by finding hello “Multi-Tenanted” switch on hello properties page of your application registration in hello [Azure portal][AZURE-portal] and setting it too“Yes”.</span></span>

<span data-ttu-id="3686f-123">Также Обратите внимание, перед тем как сделать приложение нескольких клиентов Azure AD требует hello URI toobe приложения hello глобальный уникальный идентификатор приложения.</span><span class="sxs-lookup"><span data-stu-id="3686f-123">Also note, before an application can be made multi-tenant, Azure AD requires hello App ID URI of hello application toobe globally unique.</span></span> <span data-ttu-id="3686f-124">Hello URI идентификатора приложения является одним из способов hello идентификации приложения в сообщения протокола.</span><span class="sxs-lookup"><span data-stu-id="3686f-124">hello App ID URI is one of hello ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="3686f-125">Для приложения одного клиента достаточно для toobe URI идентификатора приложения hello, уникальным в пределах этого клиента.</span><span class="sxs-lookup"><span data-stu-id="3686f-125">For a single tenant application, it is sufficient for hello App ID URI toobe unique within that tenant.</span></span>  <span data-ttu-id="3686f-126">Для многопользовательского приложения должно быть глобально уникальным, Azure AD можно найти приложения hello распределяются по всем клиентам.</span><span class="sxs-lookup"><span data-stu-id="3686f-126">For a multi-tenant application, it must be globally unique so Azure AD can find hello application across all tenants.</span></span>  <span data-ttu-id="3686f-127">Требование toohave URI идентификатора приложения hello имя узла, которое соответствует проверенного домена клиента Azure AD hello обеспечивается уникальность глобального.</span><span class="sxs-lookup"><span data-stu-id="3686f-127">Global uniqueness is enforced by requiring hello App ID URI toohave a host name that matches a verified domain of hello Azure AD tenant.</span></span>  <span data-ttu-id="3686f-128">Например, если имя вашего клиента hello не contoso.onmicrosoft.com является допустимым URI идентификатора приложения будет `https://contoso.onmicrosoft.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="3686f-128">For example, if hello name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="3686f-129">Если проверенный домен клиента — `contoso.com`, то допустимым URI кода приложения тоже будет `https://contoso.com/myapp`.</span><span class="sxs-lookup"><span data-stu-id="3686f-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="3686f-130">Установку приложения в качестве несколькими клиентами завершится ошибкой, если не следовать этому шаблону, hello URI идентификатора приложения.</span><span class="sxs-lookup"><span data-stu-id="3686f-130">Setting an application as multi-tenant will fail if hello App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="3686f-131">Регистрации собственных клиентов являются мультитенантными по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3686f-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="3686f-132">Не нужно tootake любое действие toomake собственного клиентского приложения регистрации многопользовательское.</span><span class="sxs-lookup"><span data-stu-id="3686f-132">You don’t need tootake any action toomake a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-toosend-requests-toocommon"></a><span data-ttu-id="3686f-133">Обновите ваш код toosend запросы слишком/общие</span><span class="sxs-lookup"><span data-stu-id="3686f-133">Update your code toosend requests too/common</span></span>
<span data-ttu-id="3686f-134">Запросов на вход в приложения одного клиента, отправку клиента toohello входа конечной точки.</span><span class="sxs-lookup"><span data-stu-id="3686f-134">In a single tenant application, sign-in requests are sent toohello tenant’s sign-in endpoint.</span></span> <span data-ttu-id="3686f-135">Например для contoso.onmicrosoft.com будет hello конечной точки:</span><span class="sxs-lookup"><span data-stu-id="3686f-135">For example, for contoso.onmicrosoft.com hello endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="3686f-136">Запросы отправлено конечной точки клиента tooa можно вход пользователей (или Гости), tooapplications клиента в этом клиенте.</span><span class="sxs-lookup"><span data-stu-id="3686f-136">Requests sent tooa tenant’s endpoint can sign in users (or guests) in that tenant tooapplications in that tenant.</span></span>  <span data-ttu-id="3686f-137">С многопользовательским приложением, не знает, приложение hello заранее, какой пользователь hello клиента настолько, не удается отправить запрашивает конечной точки клиента tooa.</span><span class="sxs-lookup"><span data-stu-id="3686f-137">With a multi-tenant application, hello application doesn’t know up front what tenant hello user is from, so you can’t send requests tooa tenant’s endpoint.</span></span>  <span data-ttu-id="3686f-138">Вместо этого запросы отправляются tooan конечную точку, которая multiplexes для всех клиентов Azure AD:</span><span class="sxs-lookup"><span data-stu-id="3686f-138">Instead, requests are sent tooan endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="3686f-139">Когда Azure AD получает запрос на hello/Обычная конечная точка его входе в систему пользователя hello и как вследствие того, что обнаруживает какие hello пользователь клиента, — из.</span><span class="sxs-lookup"><span data-stu-id="3686f-139">When Azure AD receives a request on hello /common endpoint, it signs hello user in and as a consequence discovers which tenant hello user is from.</span></span>  <span data-ttu-id="3686f-140">Hello/Обычная конечная точка работает со всеми hello протоколов проверки подлинности, поддерживаемых Azure AD: OpenID Connect, OAuth 2.0, SAML 2.0 и WS-Federation.</span><span class="sxs-lookup"><span data-stu-id="3686f-140">hello /common endpoint works with all of hello authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="3686f-141">Hello ответа входа toohello затем приложение содержит токен, представляющий пользователя hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-141">hello sign-in response toohello application then contains a token representing hello user.</span></span>  <span data-ttu-id="3686f-142">значение Hello издателя в маркере hello сообщает приложение hello какие клиента пользователь.</span><span class="sxs-lookup"><span data-stu-id="3686f-142">hello issuer value in hello token tells an application what tenant hello user is from.</span></span>  <span data-ttu-id="3686f-143">Если возвращает ответ hello/Обычная конечная точка hello значение издателя в маркере hello будет соответствовать toohello пользователя клиента.</span><span class="sxs-lookup"><span data-stu-id="3686f-143">When a response returns from hello /common endpoint, hello issuer value in hello token will correspond toohello user’s tenant.</span></span>  <span data-ttu-id="3686f-144">Это важные toonote hello/Обычная конечная точка не является клиентом и не является издателем, это просто мультиплексор.</span><span class="sxs-lookup"><span data-stu-id="3686f-144">It’s important toonote hello /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="3686f-145">При использовании /common, логика hello в токенах toovalidate вашего приложения должен обновить toobe tootake это в учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3686f-145">When using /common, hello logic in your application toovalidate tokens needs toobe updated tootake this into account.</span></span> 

<span data-ttu-id="3686f-146">Как упомянутых ранее, несколькими клиентами приложения также должны предоставить согласованный вход для пользователей, следующие hello рекомендации по фирменной символике приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3686f-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following hello Azure AD application branding guidelines.</span></span> <span data-ttu-id="3686f-147">Выберите следующие дополнительные сведения о фирменной символике приложения toolearn кнопку hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-147">Click hello following button toolearn more about branding your application.</span></span>

<span data-ttu-id="3686f-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="3686f-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="3686f-149">Давайте рассмотрим использование hello hello /common конечной точки и код реализации более подробно.</span><span class="sxs-lookup"><span data-stu-id="3686f-149">Let’s take a look at hello use of hello /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-toohandle-multiple-issuer-values"></a><span data-ttu-id="3686f-150">Обновите ваш код toohandle нескольких значений поставщиков</span><span class="sxs-lookup"><span data-stu-id="3686f-150">Update your code toohandle multiple issuer values</span></span>
<span data-ttu-id="3686f-151">Веб-приложения и веб-API получают маркеры из Azure AD и там же выполняют их проверку.</span><span class="sxs-lookup"><span data-stu-id="3686f-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="3686f-152">Собственные клиентские приложения, запрашивать и получать токены из Azure AD, как и поэтому toosend их tooAPIs, где они проходят проверку.</span><span class="sxs-lookup"><span data-stu-id="3686f-152">While native client applications request and receive tokens from Azure AD, they do so toosend them tooAPIs, where they are validated.</span></span>  <span data-ttu-id="3686f-153">Собственные приложения не проверяют маркеры и воспринимают их как непрозрачные.</span><span class="sxs-lookup"><span data-stu-id="3686f-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="3686f-154">Давайте посмотрим, как приложение проверяет маркеры, полученные из Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3686f-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="3686f-155">Однотенантное приложение обычно принимает значение конечной точки, подобное этому:</span><span class="sxs-lookup"><span data-stu-id="3686f-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="3686f-156">и использовать его как URL-адрес метаданных (в данном случае OpenID Connect) tooconstruct:</span><span class="sxs-lookup"><span data-stu-id="3686f-156">and use it tooconstruct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="3686f-157">toodownload два важных части информации, являются маркерами используется toovalidate: hello клиента подписи ключей и значение издателя.</span><span class="sxs-lookup"><span data-stu-id="3686f-157">toodownload two critical pieces of information that are used toovalidate tokens:  hello tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="3686f-158">Каждый клиент Azure AD имеет значение издателя уникальный hello формы:</span><span class="sxs-lookup"><span data-stu-id="3686f-158">Each Azure AD tenant has a unique issuer value of hello form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="3686f-159">где значение GUID hello — hello переименования версия hello идентификатор клиента hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-159">where hello GUID value is hello rename-safe version of hello tenant ID of hello tenant.</span></span>  <span data-ttu-id="3686f-160">При нажатии на предшествующий ссылку метаданных для hello `contoso.onmicrosoft.com`, вы увидите это значение издателя в документе hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-160">If you click on hello preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in hello document.</span></span>

<span data-ttu-id="3686f-161">Когда приложения одного клиента проверяет токен, он проверяет подпись hello hello токена для подписи ключи из документа метаданных hello hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-161">When a single tenant application validates a token, it checks hello signature of hello token against hello signing keys from hello metadata document.</span></span> <span data-ttu-id="3686f-162">Это позволяет toomake убедиться, что значение издателя hello в hello маркера соответствует hello один, обнаруженной в документе метаданных hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-162">This allows it toomake sure hello issuer value in hello token matches hello one that was found in hello metadata document.</span></span>

<span data-ttu-id="3686f-163">С момента hello/общие конечной точки не соответствует tooa клиента и при рассмотрении hello значение издателя в метаданных hello для/общие имеет шаблонного URL-адрес вместо фактического значения не издателя:</span><span class="sxs-lookup"><span data-stu-id="3686f-163">Since hello /common endpoint doesn’t correspond tooa tenant and isn’t an issuer, when you examine hello issuer value in hello metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="3686f-164">Таким образом, многопользовательского приложения не удается проверить токены только путем сопоставления hello значение издателя в метаданных hello с hello `issuer` значение в токене hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-164">Therefore, a multi-tenant application can’t validate tokens just by matching hello issuer value in hello metadata with hello `issuer` value in hello token.</span></span>  <span data-ttu-id="3686f-165">Многопользовательского приложения должен toodecide логику значения издателя, которые являются допустимыми и которой являются не, исходя клиента hello часть Идентификатору значение издателя hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-165">A multi-tenant application needs logic toodecide which issuer values are valid and which are not, based on hello tenant ID portion of hello issuer value.</span></span>  

<span data-ttu-id="3686f-166">Например, если только многопользовательского приложения позволяет войти от конкретных клиентов, которые зарегистрировались для своей службы, затем его необходимо проверить значение издателя hello или hello `tid` значение в hello маркера toomake убедиться, что клиент находится в свой список утверждения подписчики.</span><span class="sxs-lookup"><span data-stu-id="3686f-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either hello issuer value or hello `tid` claim value in hello token toomake sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="3686f-167">Только многопользовательского приложения имеет дело с частных лиц и не делает все решение доступа, исходя из клиентов, затем может игнорировать значение издателя hello вообще.</span><span class="sxs-lookup"><span data-stu-id="3686f-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore hello issuer value altogether.</span></span>

<span data-ttu-id="3686f-168">В образцах hello нескольких клиентов в hello [связанные содержимого](#related-content) раздел в конце hello в этой статье проверки издателя — отключено tooenable любой toosign клиента Azure AD в.</span><span class="sxs-lookup"><span data-stu-id="3686f-168">In hello multi-tenant samples in hello [Related Content](#related-content) section at hello end of this article, issuer validation is disabled tooenable any Azure AD tenant toosign in.</span></span>

<span data-ttu-id="3686f-169">Теперь давайте рассмотрим hello взаимодействие с пользователем для пользователей, которые входят в приложениях toomulti клиента.</span><span class="sxs-lookup"><span data-stu-id="3686f-169">Now let’s look at hello user experience for users that are signing in toomulti-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="3686f-170">Получение согласия пользователя и администратора</span><span class="sxs-lookup"><span data-stu-id="3686f-170">Understanding user and admin consent</span></span>
<span data-ttu-id="3686f-171">Для пользователя toosign, tooan приложения в Azure AD приложение hello должны быть представлены в клиенте hello пользователя.</span><span class="sxs-lookup"><span data-stu-id="3686f-171">For a user toosign in tooan application in Azure AD, hello application must be represented in hello user’s tenant.</span></span>  <span data-ttu-id="3686f-172">Это позволяет организации hello toodo такие действия, как применить уникальных политик, при входе пользователей в свой клиент toohello приложения.</span><span class="sxs-lookup"><span data-stu-id="3686f-172">This allows hello organization toodo things like apply unique policies when users from their tenant sign in toohello application.</span></span>  <span data-ttu-id="3686f-173">Для приложения одного клиента такая регистрация простой; он имеет hello, происходит при регистрации приложения hello в hello [портал Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="3686f-173">For a single tenant application, this registration is simple; it’s hello one that happens when you register hello application in hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="3686f-174">Для многопользовательского приложения hello первоначальной регистрации для приложения hello живет в клиенте Azure AD hello используется hello developer.</span><span class="sxs-lookup"><span data-stu-id="3686f-174">For a multi-tenant application, hello initial registration for hello application lives in hello Azure AD tenant used by hello developer.</span></span>  <span data-ttu-id="3686f-175">Когда пользователь из другой клиент входит в приложении toohello для hello первый раз, Azure AD запросом tooconsent toohello разрешений, запрошенных приложения hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-175">When a user from a different tenant signs in toohello application for hello first time, Azure AD asks them tooconsent toohello permissions requested by hello application.</span></span>  <span data-ttu-id="3686f-176">Если они соглашаются, то вызывается представление приложения hello *участника-службы* создается в hello клиента пользователя и войти можно продолжить.</span><span class="sxs-lookup"><span data-stu-id="3686f-176">If they consent, then a representation of hello application called a *service principal* is created in hello user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="3686f-177">Делегирование также создается в каталоге hello, который записывает hello пользовательского согласия toohello приложения.</span><span class="sxs-lookup"><span data-stu-id="3686f-177">A delegation is also created in hello directory that records hello user’s consent toohello application.</span></span> <span data-ttu-id="3686f-178">В разделе [участника-службы и объекты приложений] [ AAD-App-SP-Objects] подробные сведения о объекты приложения и субъекта-службы приложения hello и как они связаны другие tooeach.</span><span class="sxs-lookup"><span data-stu-id="3686f-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on hello application's Application and ServicePrincipal objects, and how they relate tooeach other.</span></span>

![Согласие toosingle уровня приложения][Consent-Single-Tier] 

<span data-ttu-id="3686f-180">Это взаимодействие согласия влияют hello разрешений, запрошенных приложения hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-180">This consent experience is affected by hello permissions requested by hello application.</span></span>  <span data-ttu-id="3686f-181">Azure AD поддерживает два типа разрешений: делегированные и только для приложения. Различия между ними описаны ниже.</span><span class="sxs-lookup"><span data-stu-id="3686f-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="3686f-182">Делегированных разрешений предоставляет tooact возможности приложения hello, как пользователь, выполнивший вход для подмножества hello вещей hello пользователя можно сделать.</span><span class="sxs-lookup"><span data-stu-id="3686f-182">A delegated permission grants an application hello ability tooact as a signed in user for a subset of hello things hello user can do.</span></span>  <span data-ttu-id="3686f-183">Например можно предоставить приложения hello делегированных разрешений tooread hello вход пользователя календаря.</span><span class="sxs-lookup"><span data-stu-id="3686f-183">For example, you can grant an application hello delegated permission tooread hello signed in user’s calendar.</span></span>
* <span data-ttu-id="3686f-184">Только для приложений разрешение непосредственно toohello удостоверение приложения hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-184">An app-only permission is granted directly toohello identity of hello application.</span></span>  <span data-ttu-id="3686f-185">Например можно предоставить приложения hello разрешение только для приложений tooread hello список пользователей в клиенте, независимо от того, который входил в приложении toohello.</span><span class="sxs-lookup"><span data-stu-id="3686f-185">For example, you can grant an application hello app-only permission tooread hello list of users in a tenant, regardless of who is signed in toohello application.</span></span>

<span data-ttu-id="3686f-186">Некоторые разрешения могут быть согласие tooby обычного пользователя, а для других требуется согласие администратора клиента.</span><span class="sxs-lookup"><span data-stu-id="3686f-186">Some permissions can be consented tooby a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="3686f-187">Согласие администратора</span><span class="sxs-lookup"><span data-stu-id="3686f-187">Admin consent</span></span>
<span data-ttu-id="3686f-188">Для разрешений "только для приложения" всегда требуется согласие администратора клиента.</span><span class="sxs-lookup"><span data-stu-id="3686f-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="3686f-189">Если приложение запрашивает разрешение только для приложений, и пользователь пытается toosign toohello приложения, сообщение об ошибке будет отображаться о том, что пользователь hello не может tooconsent.</span><span class="sxs-lookup"><span data-stu-id="3686f-189">If your application requests an app-only permission and a user tries toosign in toohello application, an error message will be displayed saying hello user isn’t able tooconsent.</span></span>

<span data-ttu-id="3686f-190">Для некоторых делегированных разрешений также требуется согласие администратора клиента.</span><span class="sxs-lookup"><span data-stu-id="3686f-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="3686f-191">Например hello возможность toowrite задней tooAzure AD как hello, находящийся в системе пользователь требует согласия администратора клиента.</span><span class="sxs-lookup"><span data-stu-id="3686f-191">For example, hello ability toowrite back tooAzure AD as hello signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="3686f-192">Как и разрешения только для приложений Если обычный пользователь пытается toosign в tooan приложение, запрашивающее делегированных разрешений, который требуется согласие администратора приложения появится сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="3686f-192">Like app-only permissions, if an ordinary user tries toosign in tooan application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="3686f-193">Требует ли разрешение согласие администратора определяется разработчиком hello, опубликованному hello ресурсов и можно найти в документации hello для ресурса hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-193">Whether or not a permission requires admin consent is determined by hello developer that published hello resource, and can be found in hello documentation for hello resource.</span></span>  <span data-ttu-id="3686f-194">Связывает tootopics, описывающий доступные разрешения hello для hello API Azure AD Graph и API-Интерфейс Microsoft Graph в hello [связанные содержимого](#related-content) этой статьи.</span><span class="sxs-lookup"><span data-stu-id="3686f-194">Links tootopics describing hello available permissions for hello Azure AD Graph API and Microsoft Graph API are in hello [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="3686f-195">Если приложение использует разрешения, которые требуется согласие администратора, необходимо toohave жестов, таких как кнопки или ссылки, где Здравствуйте, администратор может запустить действие hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-195">If your application uses permissions that require admin consent, you need toohave a gesture such as a button or link where hello admin can initiate hello action.</span></span>  <span data-ttu-id="3686f-196">приложение отправляет для этого действия является обычным запроса авторизации OAuth2/OpenID Connect, но который также включает hello запрос Hello `prompt=admin_consent` параметр строки запроса.</span><span class="sxs-lookup"><span data-stu-id="3686f-196">hello request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes hello `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="3686f-197">После согласился Здравствуйте, администратор и создании участника службы hello в hello клиенте, последующие запросы не обязательно hello `prompt=admin_consent` параметра.</span><span class="sxs-lookup"><span data-stu-id="3686f-197">Once hello admin has consented and hello service principal is created in hello customer’s tenant, subsequent sign-in requests do not need hello `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="3686f-198">Поскольку hello администратор решил запрошенную hello, что разрешения являются допустимыми, другие пользователи в клиенте hello не будут запрашиваться согласия с этого момента.</span><span class="sxs-lookup"><span data-stu-id="3686f-198">Since hello administrator has decided hello requested permissions are acceptable, no other users in hello tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="3686f-199">Hello `prompt=admin_consent` параметр также может использоваться приложениями, которые запрашивать разрешения, которые не требуется согласие администратора.</span><span class="sxs-lookup"><span data-stu-id="3686f-199">hello `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="3686f-200">Это делается при приложение hello разработчика требуется опыт работы где Здравствуйте, администратор клиента «во время регистрации» один время и никакие другие пользователи получают запрос на согласие с этого момента на.</span><span class="sxs-lookup"><span data-stu-id="3686f-200">This is done when hello applicaton requires an experience where hello tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="3686f-201">Если приложению требуется согласие администратора и администратора входит в, однако hello `prompt=admin_consent` параметра не передается, Здравствуйте, администратор будет успешно согласия приложения toohello **только для своей учетной записи**.</span><span class="sxs-lookup"><span data-stu-id="3686f-201">If an application requires admin consent, and an admin signs in but hello `prompt=admin_consent` parameter is not sent, hello admin will successfully consent toohello application **only for their user account**.</span></span>  <span data-ttu-id="3686f-202">Обычные пользователи по-прежнему нельзя будет toosign в и приложения toohello согласия.</span><span class="sxs-lookup"><span data-stu-id="3686f-202">Regular users will still not be able toosign in and consent toohello application.</span></span>  <span data-ttu-id="3686f-203">Это полезно, если требуется возможность toogive hello клиента администратора hello tooexplore приложение, прежде чем предоставить доступ другим пользователям.</span><span class="sxs-lookup"><span data-stu-id="3686f-203">This is useful if you want toogive hello tenant administrator hello ability tooexplore your application before allowing other users access.</span></span>

<span data-ttu-id="3686f-204">Администратор клиента можно отключить возможность hello tooapplications tooconsent обычных пользователей.</span><span class="sxs-lookup"><span data-stu-id="3686f-204">A tenant administrator can disable hello ability for regular users tooconsent tooapplications.</span></span>  <span data-ttu-id="3686f-205">Если эта возможность отключена, согласие администратора всегда является обязательным для установки в клиенте hello toobe приложения hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-205">If this capability is disabled, admin consent is always required for hello application toobe set up in hello tenant.</span></span>  <span data-ttu-id="3686f-206">Следует tootest отключены приложения с согласия на обычных пользователей можно найти параметр конфигурации hello в клиенте Azure AD hello раздел конфигурации hello [портал Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="3686f-206">If you want tootest your application with regular user consent disabled, you can find hello configuration switch in hello Azure AD tenant configuration section of hello [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="3686f-207">Для некоторых приложений требуется интерфейс обычных пользователей, изначально являются может tooconsent, куда может включать более поздней версии приложение hello Здравствуйте, администратор и запросить разрешения которых требуется согласие администратора.</span><span class="sxs-lookup"><span data-stu-id="3686f-207">Some applications want an experience where regular users are able tooconsent initially, and later hello application can involve hello administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="3686f-208">Нет не toodo способом это при регистрации одного приложения в настоящее время Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3686f-208">There is no way toodo this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="3686f-209">Конечная точка v2 Hello предстоящих Azure AD будет позволяют приложениям toorequest разрешения во время выполнения, вместо во время регистрации, который будет реализовать этот сценарий.</span><span class="sxs-lookup"><span data-stu-id="3686f-209">hello upcoming Azure AD v2 endpoint will allow applications toorequest permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="3686f-210">Дополнительные сведения см. в разделе hello [руководстве разработчика v2 модель приложения Azure AD][AAD-V2-Dev-Guide].</span><span class="sxs-lookup"><span data-stu-id="3686f-210">For more information, see hello [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="3686f-211">Согласие и многоуровневые приложения</span><span class="sxs-lookup"><span data-stu-id="3686f-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="3686f-212">Приложение может иметь несколько уровней, каждый из которых представлен в Azure AD собственной регистрацией.</span><span class="sxs-lookup"><span data-stu-id="3686f-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="3686f-213">Например, собственное приложение, выполняющее вызовы веб-API, или веб-приложение, выполняющее вызовы веб-API.</span><span class="sxs-lookup"><span data-stu-id="3686f-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="3686f-214">В обоих случаях клиент hello (собственное приложение или веб-приложения) запрашивает ресурс hello toocall разрешения (веб-API).</span><span class="sxs-lookup"><span data-stu-id="3686f-214">In both of these cases, hello client (native app or web app) requests permissions toocall hello resource (web API).</span></span>  <span data-ttu-id="3686f-215">Для клиента toobe hello успешно согласие в клиенте, toowhich все ресурсы, он запрашивает разрешения уже должен существовать в hello клиента.</span><span class="sxs-lookup"><span data-stu-id="3686f-215">For hello client toobe successfully consented into a customer’s tenant, all resources toowhich it requests permissions must already exist in hello customer’s tenant.</span></span>  <span data-ttu-id="3686f-216">Если это условие не соблюдено, Azure AD вернет ошибку, которая hello ресурсов нужно добавить первым.</span><span class="sxs-lookup"><span data-stu-id="3686f-216">If this condition isn’t met, Azure AD will return an error that hello resource must be added first.</span></span>

<span data-ttu-id="3686f-217">**Несколько уровней в одном клиенте**</span><span class="sxs-lookup"><span data-stu-id="3686f-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="3686f-218">Это может быть проблемой, если ваше логические приложение состоит из двух или более регистраций приложения, например, отдельно для клиента и ресурса.</span><span class="sxs-lookup"><span data-stu-id="3686f-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="3686f-219">Как получить ресурс hello в клиенте hello первый?</span><span class="sxs-lookup"><span data-stu-id="3686f-219">How do you get hello resource into hello customer tenant first?</span></span>  <span data-ttu-id="3686f-220">Azure AD описывается в данном случае с Включение клиента и ресурса toobe означает согласие за один шаг.</span><span class="sxs-lookup"><span data-stu-id="3686f-220">Azure AD covers this case by enabling client and resource toobe consented in a single step.</span></span> <span data-ttu-id="3686f-221">Привет, пользователь видит Общая сумма hello hello разрешений, запрошенных hello клиента и ресурсов на странице согласия hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-221">hello user sees hello sum total of hello permissions requested by both hello client and resource on hello consent page.</span></span>  <span data-ttu-id="3686f-222">tooenable такое поведение, Регистрация приложения hello ресурсов должен включать идентификатор приложения hello клиента как `knownClientApplications` в манифесте приложения.</span><span class="sxs-lookup"><span data-stu-id="3686f-222">tooenable this behavior, hello resource’s application registration must include hello client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="3686f-223">Например:</span><span class="sxs-lookup"><span data-stu-id="3686f-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="3686f-224">Это свойство могут обновляться через hello ресурсов [манифест приложения][AAD-App-Manifest].</span><span class="sxs-lookup"><span data-stu-id="3686f-224">This property can be updated via hello resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="3686f-225">Это продемонстрировано в собственном клиенте многоуровневые вызов веб-API образец hello [связанные содержимого](#related-content) раздел в конце hello в этой статье.</span><span class="sxs-lookup"><span data-stu-id="3686f-225">This is demonstrated in a multi-tier native client calling web API sample in hello [Related Content](#related-content) section at hello end of this article.</span></span> <span data-ttu-id="3686f-226">Hello следующей схеме Обзор согласия для многоуровневого приложения, зарегистрированный в один клиент:</span><span class="sxs-lookup"><span data-stu-id="3686f-226">hello following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![Разрешения уровня toomulti известного клиентского приложения][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="3686f-228">**Несколько уровней в нескольких клиентах**</span><span class="sxs-lookup"><span data-stu-id="3686f-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="3686f-229">Аналогичные случай происходит при различных уровнях приложения hello зарегистрированы в разных клиентов.</span><span class="sxs-lookup"><span data-stu-id="3686f-229">A similar case happens if hello different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="3686f-230">Например рассмотрим случай hello построения собственного клиентского приложения, которое вызывает hello Office 365, Exchange Online API.</span><span class="sxs-lookup"><span data-stu-id="3686f-230">For example, consider hello case of building a native client application that calls hello Office 365 Exchange Online API.</span></span>  <span data-ttu-id="3686f-231">toodevelop hello в собственном коде приложения и более поздней версии для toorun собственное приложение hello в клиенте, субъекта-службы Exchange Online hello должен присутствовать.</span><span class="sxs-lookup"><span data-stu-id="3686f-231">toodevelop hello native application, and later for hello native application toorun in a customer’s tenant, hello Exchange Online service principal must be present.</span></span>  <span data-ttu-id="3686f-232">В этом случае hello разработчиков и пользователей необходимо приобрести Exchange Online для toobe основной службы hello в своих клиентов.</span><span class="sxs-lookup"><span data-stu-id="3686f-232">In this case, hello developer and customer must purchase Exchange Online for hello service principal toobe created in their tenants.</span></span>  

<span data-ttu-id="3686f-233">В случае hello API-интерфейса созданных другой организации Microsoft hello разработчик hello API должен tooprovide способом для своего приложения hello клиентов tooconsent в клиентов заказчиков.</span><span class="sxs-lookup"><span data-stu-id="3686f-233">In hello case of an API built by an organization other than Microsoft, hello developer of hello API needs tooprovide a way for their customers tooconsent hello application into their customers' tenants.</span></span> <span data-ttu-id="3686f-234">Hello рекомендуется что конструктора для hello сторонних производителей разработчика toobuild hello API таким образом, чтобы он также может работать как регистрации web tooimplement клиента:</span><span class="sxs-lookup"><span data-stu-id="3686f-234">hello recommended design is for hello 3rd party developer toobuild hello API such that it can also function as a web client tooimplement sign-up :</span></span>

1. <span data-ttu-id="3686f-235">Выполните hello tooensure hello предыдущих разделах API реализует требования к регистрации или код многопользовательского приложения hello</span><span class="sxs-lookup"><span data-stu-id="3686f-235">Follow hello earlier sections tooensure hello API implements hello multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="3686f-236">Кроме областей hello tooexposing API-интерфейса или роли, убедитесь, что регистрация hello включает в себя hello «вход и чтение профиля пользователя» разрешение Azure AD (предоставляется по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="3686f-236">In addition tooexposing hello API's scopes/roles, ensure hello registration includes hello "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="3686f-237">Реализация страницы входа в-регистрации-повышение в hello веб-клиента, следуя hello [согласие администратора](#admin-consent) руководство уже было сказано ранее</span><span class="sxs-lookup"><span data-stu-id="3686f-237">Implement a sign-in/sign-up page in hello web client, following hello [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="3686f-238">После согласия пользователя hello toohello приложения hello службы участника и разрешения делегирования ссылки создаются в свой клиент и собственное приложение hello можно получить маркеры для hello API</span><span class="sxs-lookup"><span data-stu-id="3686f-238">Once hello user consents toohello application, hello service principal and consent delegation links are created in their tenant, and hello native application can get tokens for hello API</span></span>

<span data-ttu-id="3686f-239">Следующая схема Hello Обзор согласия для многоуровневого приложения, зарегистрированный в разных клиентов:</span><span class="sxs-lookup"><span data-stu-id="3686f-239">hello following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![Разрешения уровня toomulti многосторонний приложения][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="3686f-241">Отзыв согласия</span><span class="sxs-lookup"><span data-stu-id="3686f-241">Revoking Consent</span></span>
<span data-ttu-id="3686f-242">Пользователи и Администраторы имеют право отзывать приложения tooyour согласие в любое время:</span><span class="sxs-lookup"><span data-stu-id="3686f-242">Users and administrators can revoke consent tooyour application at any time:</span></span>

* <span data-ttu-id="3686f-243">Tooindividual пользователей revoke получать доступ к приложениям, удалив их из их [приложения панели доступа] [ AAD-Access-Panel] списка.</span><span class="sxs-lookup"><span data-stu-id="3686f-243">Users revoke access tooindividual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="3686f-244">Администраторы отозвать доступ tooapplications, удалив их из Azure AD, используя раздел управления hello Azure AD hello [портал Azure][AZURE-portal].</span><span class="sxs-lookup"><span data-stu-id="3686f-244">Administrators revoke access tooapplications by removing them from Azure AD using hello Azure AD management section of hello [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="3686f-245">Если администратор дает согласие tooan приложения для всех пользователей в клиенте, пользователи не может отозвать доступ по отдельности.</span><span class="sxs-lookup"><span data-stu-id="3686f-245">If an administrator consents tooan application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="3686f-246">Только Здравствуйте, администратор может отозвать доступ и только для всего приложения hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-246">Only hello administrator can revoke access, and only for hello whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="3686f-247">Согласие и поддерживаемые протоколы</span><span class="sxs-lookup"><span data-stu-id="3686f-247">Consent and Protocol Support</span></span>
<span data-ttu-id="3686f-248">Согласие поддерживается в Azure AD через OpenID Connect, hello OAuth, WS-Federation и SAML протоколов.</span><span class="sxs-lookup"><span data-stu-id="3686f-248">Consent is supported in Azure AD via hello OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="3686f-249">Hello протоколы SAML и WS-Federation не поддерживают hello `prompt=admin_consent` параметра, поэтому согласие администратора возможен только с помощью OAuth и OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="3686f-249">hello SAML and WS-Federation protocols do not support hello `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="3686f-250">Мультитенантные приложения и кэширование маркеров доступа</span><span class="sxs-lookup"><span data-stu-id="3686f-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="3686f-251">Приложения с несколькими клиентами можно также получить токены доступа toocall интерфейсы API, защищенные Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3686f-251">Multi-tenant applications can also get access tokens toocall APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="3686f-252">Одна из распространенных ошибок при использовании многопользовательское приложение hello библиотеку проверки подлинности Active Directory (ADAL) — запрос tooinitially маркер для пользователя с помощью /common, возвращается ответ, а затем последующие маркер для этого же пользователя, также с помощью /common.</span><span class="sxs-lookup"><span data-stu-id="3686f-252">A common error when using hello Active Directory Authentication Library (ADAL) with a multi-tenant application, is tooinitially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="3686f-253">Поскольку hello ответа от Azure AD не поступает от клиента, и общие, ADAL кэширует токен hello поступает из клиента hello.</span><span class="sxs-lookup"><span data-stu-id="3686f-253">Since hello response from Azure AD comes from a tenant, not /common, ADAL caches hello token as being from hello tenant.</span></span> <span data-ttu-id="3686f-254">последующие Hello вызвать слишком/общие tooget маркер доступа для записи кэша hello промахов пользователя hello и hello пользователя является запросом toosign в еще раз.</span><span class="sxs-lookup"><span data-stu-id="3686f-254">hello subsequent call too/common tooget an access token for hello user misses hello cache entry, and hello user is prompted toosign in again.</span></span>  <span data-ttu-id="3686f-255">tooavoid отсутствует кэш hello, убедитесь что последующие вызовы для уже вошедшего пользователя выполняются конечной точки клиента toohello.</span><span class="sxs-lookup"><span data-stu-id="3686f-255">tooavoid missing hello cache, make sure subsequent calls for an already signed in user are made toohello tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3686f-256">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="3686f-256">Next steps</span></span>
<span data-ttu-id="3686f-257">В этой статье вы узнали, каким образом toobuild приложение, которое обеспечивает вход пользователя из любого клиента Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="3686f-257">In this article, you learned how toobuild an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="3686f-258">После включения единого входа между приложением и Azure Active Directory, можно также обновить tooaccess вашего приложения API, предоставленным Майкрософт ресурсы, такие как Office 365.</span><span class="sxs-lookup"><span data-stu-id="3686f-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application tooaccess APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="3686f-259">Таким образом можно предлагать персонализированной рабочей среды в приложении, например отображение контекстных сведений toohello пользователей, как их изображение профиля или их далее встречу.</span><span class="sxs-lookup"><span data-stu-id="3686f-259">So you can offer a personalized experience in your application, for example showing contextual information toohello users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="3686f-260">toolearn Дополнительные сведения об обеспечении API вызывает tooAzure Active Directory и службам Office 365, таким как Exchange, SharePoint, OneDrive, OneNote, планировщик, Excel и многое другое, посетите: [Microsoft Graph API][MSFT-Graph-overview].</span><span class="sxs-lookup"><span data-stu-id="3686f-260">toolearn more about making API calls tooAzure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="3686f-261">Связанная информация</span><span class="sxs-lookup"><span data-stu-id="3686f-261">Related content</span></span>
* <span data-ttu-id="3686f-262">[Примеры мультитенантных приложений][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="3686f-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="3686f-263">[Рекомендации по фирменной символике для приложений][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="3686f-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="3686f-264">[Руководство разработчика по Azure Active Directory][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="3686f-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="3686f-265">[Объекты приложения и субъекта-службы в Azure Active Directory][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="3686f-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="3686f-266">[Интеграция приложений с Azure Active Directory][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="3686f-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="3686f-267">[Обзор инфраструктуры согласия hello][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="3686f-267">[Overview of hello Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="3686f-268">[Microsoft Graph permission scopes (Области действия разрешений Microsoft Graph)][MSFT-Graph-permision-scopes]</span><span class="sxs-lookup"><span data-stu-id="3686f-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="3686f-269">[Области разрешений | Основные понятия API Graph][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="3686f-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="3686f-270">Используйте следующие комментарии раздел tooprovide отзыв hello и помогают уточнить и отформатировать содержимое веб-узла.</span><span class="sxs-lookup"><span data-stu-id="3686f-270">Please use hello following comments section tooprovide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














