---
title: "aaaHow tooenable SSO нескольких приложений на iOS с помощью ADAL | Документы Microsoft"
description: "Как функции hello toouse hello tooenable ADAL SDK единого входа для приложения. "
services: active-directory
documentationcenter: 
author: brandwe
manager: mbaldwin
editor: 
ms.assetid: d042d6da-7503-4e20-bb55-06917de01fcd
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: ios
ms.devlang: objective-c
ms.topic: article
ms.date: 04/07/2017
ms.author: brandwe
ms.custom: aaddev
ms.openlocfilehash: b7b4389a8dcd956211ffa1aaa431aaf21ded8961
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooenable-cross-app-sso-on-ios-using-adal"></a>Как tooenable SSO нескольких приложений на iOS с помощью ADAL
Клиенты теперь ожидает предоставления единого входа (SSO), чтобы пользователи tooenter свои учетные данные требуются один раз и иметь эти учетные данные автоматически работать в приложениях. Введите свое имя пользователя и пароль на небольшом экране, часто раз в сочетании с дополнительный фактор (2FA) как телефонный звонок или текстовые сообщения кода, сложности Hello приведет к неудовлетворенности быстрый, если пользователь имеет toodo это более чем один раз для операционной системы.

Кроме того при применении с платформой удостоверений и другие приложения могут использовать как учетные записи Майкрософт или рабочую учетную запись из Office 365, клиентам ожидать, что эти учетные данные toobe доступных toouse для всех приложений независимо от поставщика hello.

Hello платформы Microsoft Identity, вместе с нашей удостоверение пакеты SDK, не это непростая работа для вас и дает возможность toodelight hello клиентов с помощью единого входа, либо в собственного набора приложений, или как с нашими broker возможности и средства проверки подлинности приложения, по всей устройства hello.

В этом пошаговом руководстве будет показывают, как это tooconfigure нашего пакета SDK в рамках вашего приложения tooprovide tooyour это преимущество клиентов.

Руководство применимо при работе с такими службами:

* Azure Active Directory
* Azure Active Directory B2C
* Azure Active Directory B2B
* Условный доступ к Azure Active Directory

документ Hello выше предполагается, вы знаете, как слишком[подготовки приложений прежних версий портале hello для Azure Active Directory](active-directory-how-to-integrate.md) и интегрированные приложения hello [Microsoft Identity iOS SDK](https://github.com/AzureAD/azure-activedirectory-library-for-objc).

## <a name="sso-concepts-in-hello-microsoft-identity-platform"></a>Основные понятия единого входа в hello платформы удостоверений
### <a name="microsoft-identity-brokers"></a>Брокеры Microsoft Identity
Корпорация Майкрософт предоставляет приложениями для каждой платформы мобильных устройств, которые позволяют к мосту hello учетных данных в приложениях различных поставщиков и позволяет специальные расширенные функции, требующих одного надежное место, откуда toovalidate учетные данные. Они называются **брокеры**. В iOS и Android эти брокеры предоставляются через загружаемых приложений, что клиентам установить независимо друг от друга или могут передаваться toohello устройства компании, который управляет некоторые или все устройства hello для своих сотрудников. Эти брокеры поддерживает управление безопасности только для некоторых приложений или hello всего устройства на основании нужен ИТ-администраторов. В Windows эта функциональность обеспечивается выбора учетной записи, встроенной в toohello операционной системы, технически называется hello веб-брокер проверки подлинности.

Дополнительные сведения о том, как использовать эти брокеры и как ваши клиенты могут просматривать в их процедуры входа в систему для чтения на платформе Microsoft Identity hello.

### <a name="patterns-for-logging-in-on-mobile-devices"></a>Способы входа на мобильные устройства
Toocredentials доступ на устройствах выполните две основные шаблоны для платформы Microsoft Identity hello.

* вход без брокера;
* вход с брокером.

#### <a name="non-broker-assisted-logins"></a>вход без брокера;
Имена входа службы помощи брокера не будут возможностей входа, происходит внутри приложения hello и использовать локальное хранилище hello hello устройства для этого приложения. Это хранилище может быть совместно используемых несколькими приложениями, но учетные данные hello, тесно связанных toohello приложения или набора приложений с помощью этих учетных данных. Скорее всего знакомы это во многих мобильных приложениях при вводе имени пользователя и пароля в само приложение hello.

Эти имена входа имеют hello следующие преимущества:

* Взаимодействие с пользователем существует целиком в пределах приложения hello.
* Учетные данные могут совместно использоваться в приложения, которые должны быть подписаны hello один сертификат, предоставляя tooyour интерфейса единого входа для этих приложений.
* Управление вокруг hello возможности ведения журнала предусмотрен toohello приложения до и после входа в систему.

Эти имена входа имеют следующие недостатки hello:

* единый вход будет доступен пользователю не во всех приложениях, в которых используются удостоверения Microsoft Identity, а только для тех удостоверений Microsoft Identity, которые настроены в вашем приложении;
* Приложение не может использоваться с более сложных функций бизнеса, например условный доступ или использование hello InTune набором продуктов.
* приложение не поддерживает аутентификацию бизнес-пользователей на основе сертификата.

Вот представление принципов работы hello удостоверение пакеты SDK с хранилищем общих hello из вашего приложения tooenable единого входа:

```
+------------+ +------------+  +-------------+
|            | |            |  |             |
|   App 1    | |   App 2    |  |   App 3     |
|            | |            |  |             |
|            | |            |  |             |
+------------+ +------------+  +-------------+
| ADAL SDK  |  |  ADAL SDK  |  |  ADAK SDK   |
+------------+-+------------+--+-------------+
|                                            |
|            App Shared Storage              |
+--------------------------------------------+
```

#### <a name="broker-assisted-logins"></a>Вход с брокером
Вспомогательная Broker имена входа будут возможностей входа, которые происходят в приложении broker hello и используют hello хранения и безопасности учетных данных tooshare broker hello для всех приложений на устройстве hello применимые платформы Microsoft Identity hello. Это означает, что приложения зависят от пользователей toosign broker hello в. В iOS и Android эти брокеры предоставляются через загружаемых приложений, что клиентам устанавливать независимо друг от друга или могут передаваться toohello устройства компании, который управляет устройством hello для своих пользователей. Пример приложения такого типа является приложением проверки подлинности Microsoft hello в iOS. В Windows эта функциональность обеспечивается выбора учетной записи, встроенной в toohello операционной системы, технически называется hello веб-брокер проверки подлинности.
взаимодействие Hello зависит от платформы и иногда может быть критическими toousers случае правильного управления. Вы, вероятно, наиболее знакомы с этим шаблоном, если установлено приложение Facebook hello и использовать Facebook Connect из другого приложения. Hello использует платформу Microsoft Identity hello таким шаблоном.

Для iOS это порождает анимация «изменения» tooa которой приложение отправляется фона toohello во время проверки подлинности Microsoft приложения hello поставляется toohello переднего плана для пользователя tooselect hello учетную запись, которая как toosign с.  

Для Android и Windows учетная запись hello выбора отображается поверх вашего приложения, которое находится так сильно мешают toohello пользователя.

#### <a name="how-hello-broker-gets-invoked"></a>Получает вызов hello broker
Если совместимые broker установлено на устройстве hello, как hello приложения проверки подлинности Microsoft, hello пакеты SDK удостоверение будет автоматически hello рабочих вызова hello broker автоматически, когда пользователь указывает, что ими toolog любой учетной записью из Платформа Microsoft Identity Hello. Это может быть личная учетная запись Майкрософт, рабочая или учебная учетная запись либо любая другая учетная запись, которую вы предоставили и разместили в Azure с использованием продуктов B2C и B2B. 

 #### <a name="how-we-ensure-hello-application-is-valid"></a>Как мы обеспечиваем hello приложения является допустимым
 
 необходимость Hello tooensure удостоверением hello hello вызовов приложения-посредника является ключевым toohello безопасности, предоставляемых нами в входа компонента service broker вспомогательная. Не iOS и Android обеспечивает уникальные идентификаторы, которые допустимы только для данного приложения, вредоносные программы могут «спуфинг» идентификатор легальных приложений и получать токены hello предназначены для допустимых приложения hello. tooensure, которым мы всегда связываются с правом приложения hello во время выполнения, мы просим tooprovide developer Привет пользовательских redirectURI при регистрации своих приложений с корпорацией Майкрософт. **Ниже подробно описано, как разработчикам следует создавать этот универсальный код ресурса (URI) для перенаправления.** Этот пользовательский redirectURI содержит hello ИД набора приложения hello и гарантируется toobe уникальный toohello приложения hello Apple App Store. Когда broker hello вызовов приложения, hello broker задает hello операций ввода-вывода операционной системы tooprovide его с Здравствуйте, идентификатор пакета, который вызывается hello broker. Hello broker предоставляет tooMicrosoft этот идентификатор пакета в системы удостоверений tooour вызов hello. Если hello ИД набора приложения hello не соответствует ИД набора предоставленного toous разработчиком hello во время регистрации приветствия, мы будет запрещать доступ toohello маркеры для запрашивает приложение hello hello ресурсов. Эта проверка гарантирует, только приложение hello, зарегистрированные разработчиком hello получение маркеров.

**Разработчик Hello имеет hello выбор, если hello пакет SDK для Microsoft Identity вызывает hello broker или использует службы помощи потока без посредника hello.** Однако если hello разработчик выбирает не toouse hello вспомогательная broker потока потеряют hello преимущество использования учетных данных единого входа этого пользователя hello может уже присутствует на устройстве hello и предотвращает их приложения не могут использоваться с бизнес-функций Microsoft предоставляет клиентам как условного доступа, возможности управления Intune и проверку подлинности на основе сертификата.

Эти имена входа имеют hello следующие преимущества:

* Пользователь получает единого входа для всех приложений независимо от поставщика hello.
* Приложения можно использовать расширенные возможности бизнеса, например условный доступ или hello InTune набором продуктов.
* приложение может поддерживать аутентификацию бизнес-пользователей на основе сертификата;
* Намного безопаснее входа пользователей как hello удостоверения приложения hello и hello пользователя проверяются hello broker приложения с помощью шифрования и алгоритмы дополнительной безопасности.

Эти имена входа имеют следующие недостатки hello:

* В iOS hello пользователь перешел из взаимодействие приложения пока выбираются учетные данные.
* Потеря toomanage hello hello возможность входа взаимодействия для клиентов в приложении.

Вот представление как hello SDK удостоверений Майкрософт работают с hello компонента service broker приложения tooenable единого входа:

```
+------------+ +------------+   +-------------+
|            | |            |   |             |
|   App 1    | |   App 2    |   |   Someone   |
|            | |            |   |    Else's   |
|            | |            |   |     App     |
+------------+ +------------+   +-------------+
| Azure SDK  | | Azure SDK  |   | Azure SDK   |
+-----+------+-+-----+------+-  +-------+-----+
      |              |                  |
      |       +------v------+           |
      |       |             |           |
      |       | Microsoft   |           |
      +-------> Broker      |^----------+
              | Application
              |             |
              +-------------+
              |             |
              |   Broker    |
              |   Storage   |
              |             |
              +-------------+
```

Используя эти сведения в фоновом режиме должен быть toobetter может в изучении и реализации единого входа в приложении с помощью платформы Microsoft Identity hello и пакеты SDK.

## <a name="enabling-cross-app-sso-using-adal"></a>Включение единого входа в нескольких приложениях с помощью ADAL
Здесь мы используем hello ADAL iOS SDK для:

* включение единого входа без помощи брокера для набора приложений;
* включить поддержку единого входа с помощью брокера.

### <a name="turning-on-sso-for-non-broker-assisted-sso"></a>Включение единого входа без брокера
Без посредника интерактивную единый вход для приложения hello пакеты SDK удостоверение управляет значительную часть сложности hello единого входа для. Сюда входят поиска правой пользователя hello в кэше hello и список пользователей, вошедший в систему для вас tooquery обслуживание.

tooenable единого входа в приложениях, владеющих требуется hello toodo следующие:

1. Убедитесь, все вашего приложения пользователя hello же идентификатор клиента или идентификатор приложения.
2. Убедитесь, что все общей папке вашего приложения hello, же сертификатом для подписи у Apple, чтобы вы можете совместно использовать цепочки ключей
3. Запрос hello же правах цепочки ключей для всех приложений.
4. Сообщите, пакеты SDK удостоверение hello о цепочке ключей совместно hello что нам toouse.

#### <a name="using-hello-same-client-id--application-id-for-all-hello-applications-in-your-suite-of-apps"></a>С помощью hello таким же Идентификатором клиента / идентификатор приложения для всех hello приложений в наборе приложений
Чтобы tooknow платформы Microsoft Identity hello допустимость его tooshare токены в приложениях каждое приложение потребуется hello tooshare же идентификатор клиента или идентификатор приложения. Это уникальный идентификатор hello, предоставленный tooyou при регистрации первого приложения hello портала.

Может возникнуть вопрос определяет различные приложения hello toohello службы Microsoft Identity, если он использует же идентификатор приложения. получен ответ Hello с hello **URI перенаправления**. Каждое приложение может иметь несколько URI перенаправления зарегистрирован в портале адаптации hello. Каждое приложение в наборе получит уникальный код URI перенаправления. Вот как это выглядит:

URI перенаправления App1: `x-msauth-mytestiosapp://com.myapp.mytestapp`

URI перенаправления App2: `x-msauth-mytestiosapp://com.myapp.mytestapp2`

URI перенаправления App3: `x-msauth-mytestiosapp://com.myapp.mytestapp3`

....

Они располагаются под hello же идентификатор клиента и идентификатор приложения и hello найденное на основе URI перенаправления, который возвращается toous в конфигурации пакета SDK.

```
+-------------------+
|                   |
|  Client ID        |
+---------+---------+
          |
          |           +-----------------------------------+
          |           |  App 1 Redirect URI               |
          +----------^+                                   |
          |           +-----------------------------------+
          |
          |           +-----------------------------------+
          +----------^+  App 2 Redirect URI               |
          |           |                                   |
          |           +-----------------------------------+
          |
          +----------^+-----------------------------------+
                      |  App 3 Redirect URI               |
                      |                                   |
                      +-----------------------------------+

```


*Обратите внимание, что формат эти URI перенаправления hello описаны ниже. Может использовать любой URI перенаправления, если не нужно toosupport hello брокера, в противном случае они должны выглядеть примерно следующим образом выше hello*

#### <a name="create-keychain-sharing-between-applications"></a>Создание общей цепочки ключей между приложениями
Включение общего доступа к цепочке ключей выходит за рамки данного документа hello и связанная с Apple в своем документе [Добавление возможностей](https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/AddingCapabilities/AddingCapabilities.html). Важно решить, какие действия следует к цепочке ключей, toobe вызывается и добавить эту возможность для всех приложений.

При наличии прав, настроить правильно, вы должны увидеть файл в папке проекта под названием `entitlements.plist` , содержащий нечто, похожее на следующее hello:

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>keychain-access-groups</key>
    <array>
        <string>$(AppIdentifierPrefix)com.myapp.mytestapp</string>
        <string>$(AppIdentifierPrefix)com.myapp.mycache</string>
    </array>
</dict>
</plist>
```

Когда у вас есть права в цепочке ключей hello включен в каждое приложение и будут готовы toouse единого входа, расскажите hello пакет SDK для Microsoft Identity о цепочке ключей с помощью hello следующий параметр в вашей `ADAuthenticationSettings` с hello следующий параметр:

```
defaultKeychainSharingGroup=@"com.myapp.mycache";
```

> [!WARNING]
> При совместном использовании цепочке ключей в приложениях любого приложения можно удалить пользователей или хуже удалить все маркеры hello всего приложения. Это особенно катастрофические при наличии приложений, использующих hello токены toodo фоновой работы. Общий доступ к цепочке ключей означает, что необходимо быть крайне внимательно в все Удаление операции с помощью пакетов SDK удостоверений Microsoft hello.
> 
> 

Вот и все! пакет SDK для Microsoft Identity Hello теперь будут совместно использовать учетные данные для всех приложений. список пользователей Hello также использоваться несколькими экземплярами приложений.

### <a name="turning-on-sso-for-broker-assisted-sso"></a>Включение единого входа с брокером
Здравствуйте, возможность toouse приложения является любой брокера, установленного на устройстве hello **отключена по умолчанию**. Чтобы toouse приложения с помощью посредника hello необходимо выполнить дополнительные настройки и добавить некоторые приложения tooyour кода.

Hello toofollow шаги являются:

1. Включите режим брокера в код приложения вызов toohello MS SDK.
2. Установить новый URI перенаправления, приложение hello tooboth и регистрации вашего приложения.
3. Регистрация схемы URL-адреса.
4. Поддержка iOS9: добавить файл info.plist tooyour разрешений.

#### <a name="step-1-enable-broker-mode-in-your-application"></a>Шаг 1. Включение режима брокера в приложении
При создании hello «контекст» или начальной настройки проверки подлинности объекта включена возможность Hello broker hello toouse вашего приложения. Она выполняется путем настройки типа учетных данных в коде.

```
/*! See hello ADCredentialsType enumeration definition for details */
@propertyADCredentialsType credentialsType;
```
Hello `AD_CREDENTIALS_AUTO` параметр разрешает toocall tootry пакет SDK для Microsoft Identity hello out toohello broker `AD_CREDENTIALS_EMBEDDED` предотвратит вызов toohello broker hello пакет SDK для Microsoft Identity.

#### <a name="step-2-registering-a-url-scheme"></a>Шаг 2. Регистрация схемы URL-адреса
Платформа Microsoft Identity Hello использует broker hello tooinvoke URL-адреса и задней tooyour приложение затем возвращаемого элемента управления. toofinish этого цикла обработки требуется схема URL-адресов, зарегистрированных для приложения, hello известно о платформе Microsoft Identity. Это может быть также tooany других схем приложения, могут уже зарегистрированы с приложением.

> [!WARNING]
> Рекомендуется, чтобы URL-адрес схемы довольно уникальный toominimize hello шансы на другое приложение, с помощью hello hello та же схема URL-адрес. Apple не обеспечивает уникальности hello схемы URL-адресов, которые зарегистрированы в хранилище приложения hello.
> 
> 

Ниже представлен пример того, как это показано в конфигурации проекта. Также это можно сделать в XCode:

```
<key>CFBundleURLTypes</key>
<array>
    <dict>
        <key>CFBundleTypeRole</key>
        <string>Editor</string>
        <key>CFBundleURLName</key>
        <string>com.myapp.mytestapp</string>
        <key>CFBundleURLSchemes</key>
        <array>
            <string>x-msauth-mytestiosapp</string>
        </array>
    </dict>
</array>
```

#### <a name="step-3-establish-a-new-redirect-uri-with-your-url-scheme"></a>Шаг 3. Установка нового URI перенаправления в схеме URL-адреса
В tooensure порядке, что мы всегда возвращает правильного приложения toohello токены hello учетных данных мы должны toomake том, что мы обратного вызова, можно проверить tooyour приложения, в результате которого hello операционной системы iOS. Hello отчеты операционной системы iOS toohello приложений broker Майкрософт hello ИД набора приложения hello, его вызов. Стороннее приложение не может подделать его. Таким образом мы задействуем это вместе с URI нашей tooensure приложения брокера, возврат toohello правильного приложения hello токены hello. Нам требуется вы tooestablish этот уникальный URI, как в приложении и набор перенаправления как URI перенаправления в наших портала для разработчиков.

В URI перенаправления должен быть hello правильный формат:

`<app-scheme>://<your.bundle.id>`

Пример: *x-msauth-mytestiosapp://com.myapp.mytestapp*

Этот URI перенаправления должен toobe, указанный в регистрации вашего приложения, с помощью hello [портал Azure](https://portal.azure.com/). Дополнительные сведения о регистрации приложения Azure AD см. в статье, посвященной [интеграции с Azure Active Directory](active-directory-how-to-integrate.md).

##### <a name="step-3a-add-a-redirect-uri-in-your-app-and-dev-portal-toosupport-certificate-based-authentication"></a>Шаг 3a: Добавление URI перенаправления в приложении "и" Разработка портала toosupport на основе сертификатов проверки подлинности
Проверка подлинности на основе сертификатов toosupport второй «msauth» должен toobe, зарегистрированные в приложении и hello [портал Azure](https://portal.azure.com/) toohandle при желании tooadd проверки подлинности сертификата, которые поддерживают в приложении.

`msauth://code/<broker-redirect-uri-in-url-encoded-form>`

ex: *msauth://code/x-msauth-mytestiosapp%3A%2F%2Fcom.myapp.mytestapp*

#### <a name="step-4-ios9-add-a-configuration-parameter-tooyour-app"></a>Шаг 4: iOS9: Добавление приложения tooyour параметр конфигурации
ADAL использует — canOpenURL: toocheck Если брокер hello установлен на устройстве hello. В iOS 9 Apple заблокированы схемы, которые может запрашивать приложение. Вам потребуется tooadd «msauth» toohello LSApplicationQueriesSchemes части вашего `info.plist file`.

<key>LSApplicationQueriesSchemes</key>

<array><string>msauth</string>
</array>

### <a name="youve-configured-sso"></a>Вы настроили единый вход!
Теперь hello пакет SDK для Microsoft Identity автоматически и совместное использование учетных данных в приложениях и вызова неуправляемого кода hello broker при наличии на устройстве.

