---
title: "aaaHow tooenable нескольких приложений единого входа в Android с помощью ADAL | Документы Microsoft"
description: "Как функции hello toouse hello tooenable ADAL SDK единого входа для приложения. "
services: active-directory
documentationcenter: 
author: danieldobalian
manager: mbaldwin
editor: 
ms.assetid: 40710225-05ab-40a3-9aec-8b4e96b6b5e7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: android
ms.devlang: java
ms.topic: article
ms.date: 04/07/2017
ms.author: dadobali
ms.custom: aaddev
ms.openlocfilehash: 3867e15030e5516464e4dbd92ba35894430daf00
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooenable-cross-app-sso-on-android-using-adal"></a>Как tooenable нескольких приложений единого входа в Android с помощью ADAL
Клиенты теперь ожидает предоставления единого входа (SSO), чтобы пользователи tooenter свои учетные данные требуются один раз и иметь эти учетные данные автоматически работать в приложениях. Введите свое имя пользователя и пароль на небольшом экране, часто раз в сочетании с дополнительный фактор (2FA) как телефонный звонок или текстовые сообщения кода, сложности Hello приведет к неудовлетворенности быстрый, если пользователь имеет toodo это более чем один раз для операционной системы.

Кроме того при применении с платформой удостоверений и другие приложения могут использовать как учетные записи Майкрософт или рабочую учетную запись из Office 365, клиентам ожидать, что эти учетные данные toobe доступных toouse для всех приложений независимо от поставщика hello.

Hello платформы Microsoft Identity, вместе с нашей удостоверение пакеты SDK, не это непростая работа для вас и дает возможность toodelight hello клиентов с помощью единого входа, либо в собственного набора приложений, или как с нашими broker возможности и средства проверки подлинности приложения, по всей устройства hello.

В этом пошаговом руководстве будет показывают, как это tooconfigure нашего пакета SDK в рамках вашего приложения tooprovide tooyour это преимущество клиентов.

Руководство применимо при работе с такими службами:

* Azure Active Directory
* Azure Active Directory B2C
* Azure Active Directory B2B
* Условный доступ к Azure Active Directory

документ Hello выше предполагается, вы знаете, как слишком[подготовки приложений прежних версий портале hello для Azure Active Directory](active-directory-how-to-integrate.md) и интегрированные приложения hello [Microsoft Identity пакета SDK для Android](https://github.com/AzureAD/azure-activedirectory-library-for-android) .

## <a name="sso-concepts-in-hello-microsoft-identity-platform"></a>Основные понятия единого входа в hello платформы удостоверений
### <a name="microsoft-identity-brokers"></a>Брокеры Microsoft Identity
Корпорация Майкрософт предоставляет приложениями для каждой платформы мобильных устройств, которые позволяют к мосту hello учетных данных в приложениях различных поставщиков и позволяет специальные расширенные функции, требующих одного надежное место, откуда toovalidate учетные данные. Они называются **брокеры**. В iOS и Android они предоставляются через загружаемых приложений, что клиентам установить независимо друг от друга или могут передаваться toohello устройства компании, который управляет некоторые или все устройства hello для своих сотрудников. Эти брокеры поддерживает управление безопасности только для некоторых приложений или hello всего устройства на основании нужен ИТ-администраторов. В Windows эта функциональность обеспечивается выбора учетной записи, встроенной в toohello операционной системы, технически называется hello веб-брокер проверки подлинности.

Дополнительные сведения о том, как использовать эти брокеры и как ваши клиенты могут просматривать в их процедуры входа в систему для чтения на платформе Microsoft Identity hello.

### <a name="patterns-for-logging-in-on-mobile-devices"></a>Способы входа на мобильные устройства
Toocredentials доступ на устройствах выполните две основные шаблоны для платформы Microsoft Identity hello.

* вход без брокера;
* вход с брокером.

#### <a name="non-broker-assisted-logins"></a>вход без брокера;
Имена входа службы помощи брокера не будут возможностей входа, происходит внутри приложения hello и использовать локальное хранилище hello hello устройства для этого приложения. Это хранилище может быть совместно используемых несколькими приложениями, но учетные данные hello, тесно связанных toohello приложения или набора приложений с помощью этих учетных данных. Скорее всего знакомы это во многих мобильных приложениях при вводе имени пользователя и пароля в само приложение hello.

Эти имена входа имеют hello следующие преимущества:

* Взаимодействие с пользователем существует целиком в пределах приложения hello.
* Учетные данные могут совместно использоваться в приложения, которые должны быть подписаны hello один сертификат, предоставляя tooyour интерфейса единого входа для этих приложений.
* Управление вокруг hello возможности ведения журнала предусмотрен toohello приложения до и после входа в систему.

Эти имена входа имеют следующие недостатки hello:

* единый вход будет доступен пользователю не во всех приложениях, в которых используются удостоверения Microsoft Identity, а только для тех удостоверений Microsoft Identity, которые настроены в вашем приложении;
* Приложение не может использоваться с более сложных функций бизнеса, например условный доступ или использование hello InTune набором продуктов.
* приложение не поддерживает аутентификацию бизнес-пользователей на основе сертификата.

Вот представление принципов работы hello удостоверение пакеты SDK с хранилищем общих hello из вашего приложения tooenable единого входа:

```
+------------+ +------------+  +-------------+
|            | |            |  |             |
|   App 1    | |   App 2    |  |   App 3     |
|            | |            |  |             |
|            | |            |  |             |
+------------+ +------------+  +-------------+
| Azure SDK  | | Azure SDK  |  | Azure SDK   |
+------------+-+------------+--+-------------+
|                                            |
|            App Shared Storage              |
+--------------------------------------------+
```

#### <a name="broker-assisted-logins"></a>Вход с брокером
Вспомогательная Broker имена входа будут возможностей входа, которые происходят в приложении broker hello и используют hello хранения и безопасности учетных данных tooshare broker hello для всех приложений на устройстве hello применимые платформы Microsoft Identity hello. Это означает, что приложения зависят от пользователей toosign broker hello в. В iOS и Android эти брокеры предоставляются через загружаемых приложений, что клиентам устанавливать независимо друг от друга или могут передаваться toohello устройства компании, который управляет устройством hello для своих пользователей. Пример приложения такого типа является приложением проверки подлинности Microsoft hello в iOS. В Windows эта функциональность обеспечивается выбора учетной записи, встроенной в toohello операционной системы, технически называется hello веб-брокер проверки подлинности.
взаимодействие Hello зависит от платформы и иногда может быть критическими toousers случае правильного управления. Вы, вероятно, наиболее знакомы с этим шаблоном, если установлено приложение Facebook hello и использовать Facebook Connect из другого приложения. Hello использует платформу Microsoft Identity hello таким шаблоном.

Для iOS это порождает анимация «изменения» tooa которой приложение отправляется фона toohello во время проверки подлинности Microsoft приложения hello поставляется toohello переднего плана для пользователя tooselect hello учетную запись, которая как toosign с.  

Для Android и Windows учетная запись hello выбора отображается поверх вашего приложения, которое находится так сильно мешают toohello пользователя.

#### <a name="how-hello-broker-gets-invoked"></a>Получает вызов hello broker
Если совместимые broker установлено на устройстве hello, как hello приложения проверки подлинности Microsoft, hello пакеты SDK удостоверение будет автоматически hello рабочих вызова hello broker автоматически, когда пользователь указывает, что ими toolog любой учетной записью из Платформа Microsoft Identity Hello. Это может быть личная учетная запись Майкрософт, рабочая или учебная учетная запись либо любая другая учетная запись, которую вы предоставили и разместили в Azure с использованием продуктов B2C и B2B. 
 
 #### <a name="how-we-ensure-hello-application-is-valid"></a>Как мы обеспечиваем hello приложения является допустимым
 
 необходимость Hello tooensure удостоверением hello hello вызовов приложения-посредника является ключевым toohello безопасности, предоставляемых нами в входа компонента service broker вспомогательная. Не iOS и Android обеспечивает уникальные идентификаторы, которые допустимы только для данного приложения, вредоносные программы могут «спуфинг» идентификатор легальных приложений и получать токены hello предназначены для допустимых приложения hello. tooensure, которым мы всегда связываются с правом приложения hello во время выполнения, мы просим tooprovide developer Привет пользовательских redirectURI при регистрации своих приложений с корпорацией Майкрософт. **Ниже подробно описано, как разработчикам следует создавать этот универсальный код ресурса (URI) для перенаправления.** Этот пользовательский redirectURI содержит отпечаток сертификата hello приложения hello и гарантируется toobe уникальный toohello приложения hello магазина Google Play. Когда приложение вызывает hello broker hello broker запрашивает hello операционной системы Android tooprovide его с hello отпечаток сертификата, что брокер вызываемой hello. Hello broker предоставляет этот tooMicrosoft отпечаток сертификата в системы удостоверений tooour вызов hello. Если сертификат hello отпечаток приложения hello не соответствует отпечаток сертификата hello toous разработчиком hello во время регистрации, мы будет запрещать доступ toohello маркеры для запрашивает приложение hello hello ресурсов. Эта проверка гарантирует, только приложение hello, зарегистрированные разработчиком hello получение маркеров.

**Разработчик Hello имеет hello выбор, если hello пакет SDK для Microsoft Identity вызывает hello broker или использует службы помощи потока без посредника hello.** Однако если hello разработчик выбирает не toouse hello вспомогательная broker потока потеряют hello преимущество использования учетных данных единого входа этого пользователя hello может уже присутствует на устройстве hello и предотвращает их приложения не могут использоваться с бизнес-функций Microsoft предоставляет клиентам как условного доступа, возможности управления Intune и проверку подлинности на основе сертификата.

Эти имена входа имеют hello следующие преимущества:

* Пользователь получает единого входа для всех приложений независимо от поставщика hello.
* Приложения можно использовать расширенные возможности бизнеса, например условный доступ или hello InTune набором продуктов.
* приложение может поддерживать аутентификацию бизнес-пользователей на основе сертификата;
* Намного безопаснее входа пользователей как hello удостоверения приложения hello и hello пользователя проверяются hello broker приложения с помощью шифрования и алгоритмы дополнительной безопасности.

Эти имена входа имеют следующие недостатки hello:

* В iOS hello пользователь перешел из взаимодействие приложения пока выбираются учетные данные.
* Потеря toomanage hello hello возможность входа взаимодействия для клиентов в приложении.

Вот представление как hello SDK удостоверений Майкрософт работают с hello компонента service broker приложения tooenable единого входа:

```
+------------+ +------------+   +-------------+
|            | |            |   |             |
|   App 1    | |   App 2    |   |   Someone   |
|            | |            |   |    Else's   |
|            | |            |   |     App     |
+------------+ +------------+   +-------------+
|  ADAL SDK  | |  ADAL SDK  |   |  ADAL SDK   |
+-----+------+-+-----+------+-  +-------+-----+
      |              |                  |
      |       +------v------+           |
      |       |             |           |
      |       | Microsoft   |           |
      +-------> Broker      |^----------+
              | Application
              |             |
              +-------------+
              |             |
              |   Broker    |
              |   Storage   |
              |             |
              +-------------+

```

Используя эти сведения в фоновом режиме должен быть toobetter может в изучении и реализации единого входа в приложении с помощью платформы Microsoft Identity hello и пакеты SDK.

## <a name="enabling-cross-app-sso-using-adal"></a>Включение единого входа в нескольких приложениях с помощью ADAL
Здесь мы используем hello ADAL пакета SDK для Android для:

* включение единого входа без помощи брокера для набора приложений;
* включить поддержку единого входа с помощью брокера.

### <a name="turning-on-sso-for-non-broker-assisted-sso"></a>Включение единого входа без брокера
Без посредника интерактивную единый вход для приложения hello пакеты SDK удостоверение управляет значительную часть сложности hello единого входа для. Сюда входят поиска правой пользователя hello в кэше hello и список пользователей, вошедший в систему для вас tooquery обслуживание.

tooenable единого входа в приложениях, владеющих требуется hello toodo следующие:

1. Убедитесь, все вашего приложения пользователя hello же идентификатор клиента или идентификатор приложения.
2. Убедитесь, что все приложения должны задать же SharedUserID hello.
3. Убедитесь, что все из общей папки вашего приложения hello, же подписи сертификат из Google Play hello хранилища, чтобы общий доступ к хранилищу.

#### <a name="step-1-using-hello-same-client-id--application-id-for-all-hello-applications-in-your-suite-of-apps"></a>Шаг 1: С помощью hello таким же Идентификатором клиента / идентификатор приложения для всех hello приложений в наборе приложений
Чтобы tooknow платформы Microsoft Identity hello допустимость его tooshare токены в приложениях каждое приложение потребуется hello tooshare же идентификатор клиента или идентификатор приложения. Это уникальный идентификатор hello, предоставленный tooyou при регистрации первого приложения hello портала.

Может возникнуть вопрос определяет различные приложения hello toohello службы Microsoft Identity, если он использует же идентификатор приложения. получен ответ Hello с hello **URI перенаправления**. Каждое приложение может иметь несколько URI перенаправления зарегистрирован в портале адаптации hello. Каждое приложение в наборе получит уникальный код URI перенаправления. Вот как это выглядит:

URI перенаправления App1: `msauth://com.example.userapp/IcB5PxIyvbLkbFVtBI%2FitkW%2Fejk%3D`

URI перенаправления App2: `msauth://com.example.userapp1/KmB7PxIytyLkbGHuI%2UitkW%2Fejk%4E`

URI перенаправления App3: `msauth://com.example.userapp2/Pt85PxIyvbLkbKUtBI%2SitkW%2Fejk%9F`

....

Они располагаются под hello же идентификатор клиента и идентификатор приложения и hello найденное на основе URI перенаправления, который возвращается toous в конфигурации пакета SDK.

```
+-------------------+
|                   |
|  Client ID        |
+---------+---------+
          |
          |           +-----------------------------------+
          |           |  App 1 Redirect URI               |
          +----------^+                                   |
          |           +-----------------------------------+
          |
          |           +-----------------------------------+
          +----------^+  App 2 Redirect URI               |
          |           |                                   |
          |           +-----------------------------------+
          |
          +----------^+-----------------------------------+
                      |  App 3 Redirect URI               |
                      |                                   |
                      +-----------------------------------+

```


*Обратите внимание, что формат эти URI перенаправления hello описаны ниже. Может использовать любой URI перенаправления, если не нужно toosupport hello брокера, в противном случае они должны выглядеть примерно следующим образом выше hello*

#### <a name="step-2-configuring-shared-storage-in-android"></a>Шаг 2. Настройка общего хранилища в Android
Параметр hello `SharedUserID` выходит за рамки данного документа hello, но могут быть получены путем чтения hello документации Google Android на hello [манифеста](http://developer.android.com/guide/topics/manifest/manifest-element.html). Важно, что именно вы решаете, как следует назвать идентификатор sharedUserID, и используете его во всех ваших приложениях.

При наличии hello `SharedUserID` во всех приложениях будут готовы toouse единого входа.

> [!WARNING]
> При совместном использовании хранилища для приложений любого приложения можно удалить пользователей или хуже удалить все маркеры hello всего приложения. Это особенно катастрофические при наличии приложений, использующих hello токены toodo фоновой работы. Совместное использование хранилища означает, что вы должны быть особой осторожностью удалить все операции с помощью hello SDK Microsoft Identity.
> 
> 

Вот и все! пакет SDK для Microsoft Identity Hello теперь будут совместно использовать учетные данные для всех приложений. список пользователей Hello также использоваться несколькими экземплярами приложений.

### <a name="turning-on-sso-for-broker-assisted-sso"></a>Включение единого входа с брокером
Здравствуйте, возможность toouse приложения является любой брокера, установленного на устройстве hello **отключена по умолчанию**. Чтобы toouse приложения с помощью посредника hello необходимо выполнить дополнительные настройки и добавить некоторые приложения tooyour кода.

Hello toofollow шаги являются:

1. Включить режим брокера в код приложения вызов toohello MS SDK
2. Установить новый URI перенаправления, а также предоставляют tooboth приложение hello и регистрация приложения
3. Настройка hello необходимые разрешения из манифеста Android hello

#### <a name="step-1-enable-broker-mode-in-your-application"></a>Шаг 1. Включение режима брокера в приложении
При создании hello «параметры» или начальной настройки проверки подлинности экземпляра включена возможность Hello broker hello toouse вашего приложения. Это можно сделать, настроив тип ApplicationSettings в коде.

```
AuthenticationSettings.Instance.setUseBroker(true);
```


#### <a name="step-2-establish-a-new-redirect-uri-with-your-url-scheme"></a>Шаг 2. Настройка нового кода URI перенаправления в схеме URL-адреса
В tooensure порядке, что мы всегда возвращает правильного приложения toohello токены hello учетных данных мы должны убедиться, что мы обратного вызова, можно проверить tooyour приложения, в результате которого hello операционной системы Android toomake. Hello Android операционная система использует hello хэш сертификата hello в hello магазина Google Play. Стороннее приложение не может подделать его. Таким образом мы задействуем это вместе с URI нашей tooensure приложения брокера, возврат toohello правильного приложения hello токены hello. Нам требуется вы tooestablish этот уникальный URI, как в приложении и набор перенаправления как URI перенаправления в наших портала для разработчиков.

В URI перенаправления должен быть hello правильный формат:

`msauth://packagename/Base64UrlencodedSignature`

Например, *msauth://com.example.userapp/IcB5PxIyvbLkbFVtBI%2FitkW%2Fejk%3D*

Этот URI перенаправления должен toobe, указанный в регистрации вашего приложения, с помощью hello [портал Azure](https://portal.azure.com/). Дополнительные сведения о регистрации приложения Azure AD см. в статье, посвященной [интеграции с Azure Active Directory](active-directory-how-to-integrate.md).

#### <a name="step-3-set-up-hello-correct-permissions-in-your-application"></a>Шаг 3: Настройка разрешений в вашем приложении hello
Broker приложения в Android использует функцию диспетчера учетных записей hello учетные данные toomanage ОС Android hello в приложениях. Посредник hello toouse заказа в Android манифест приложения должен иметь учетные записи AccountManager toouse разрешения. Это подробно рассматривается в hello [Google документацию для диспетчера учетных записей](http://developer.android.com/reference/android/accounts/AccountManager.html)

Речь идет о следующих разрешениях:

```
GET_ACCOUNTS
USE_CREDENTIALS
MANAGE_ACCOUNTS
```

### <a name="youve-configured-sso"></a>Вы настроили единый вход!
Теперь hello пакет SDK для Microsoft Identity автоматически и совместное использование учетных данных в приложениях и вызова неуправляемого кода hello broker при наличии на устройстве.

