---
title: "вопросы aaaSecurity прокси приложения Azure AD | Документы Microsoft"
description: "В этой статье рассматриваются вопросы безопасности при использовании прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/03/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: ebd14b9d1fc8f4629c5916e5a910595727d935d5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="security-considerations-for-accessing-apps-remotely-with-azure-ad-application-proxy"></a><span data-ttu-id="a9181-103">Вопросы безопасности при удаленном доступе к приложениям через прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="a9181-103">Security considerations for accessing apps remotely with Azure AD Application Proxy</span></span>

<span data-ttu-id="a9181-104">В этой статье описывается, каким образом прокси приложения Azure Active Directory обеспечивает безопасную публикацию приложений и удаленный доступ к ним.</span><span class="sxs-lookup"><span data-stu-id="a9181-104">This article explains how Azure Active Directory Application Proxy provides a secure service for publishing and accessing your applications remotely.</span></span>

<span data-ttu-id="a9181-105">Привет, следующая схема показывает, каким образом Azure AD позволяет приложениям в локальной tooyour безопасного удаленного доступа.</span><span class="sxs-lookup"><span data-stu-id="a9181-105">hello following diagram shows how Azure AD enables secure remote access tooyour on-premises applications.</span></span>

 ![Схема безопасного удаленного доступа через прокси приложения Azure AD](./media/application-proxy-security-considerations/secure-remote-access.png)

## <a name="security-benefits"></a><span data-ttu-id="a9181-107">Преимущества безопасности</span><span class="sxs-lookup"><span data-stu-id="a9181-107">Security benefits</span></span>

<span data-ttu-id="a9181-108">Прокси приложения Azure AD предлагает следующие преимущества безопасности hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-108">Azure AD Application Proxy offers hello following security benefits:</span></span>

### <a name="authenticated-access"></a><span data-ttu-id="a9181-109">Аутентифицируемый доступ</span><span class="sxs-lookup"><span data-stu-id="a9181-109">Authenticated access</span></span> 

<span data-ttu-id="a9181-110">При выборе toouse Azure Active Directory предварительной проверки подлинности только проверенные на подлинность соединения возможность подключения к сети.</span><span class="sxs-lookup"><span data-stu-id="a9181-110">If you choose toouse Azure Active Directory preauthentication, then only authenticated connections can access your network.</span></span>

<span data-ttu-id="a9181-111">Прокси приложения Azure AD использует hello Azure AD службы маркеров безопасности (STS) для всех проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="a9181-111">Azure AD Application Proxy relies on hello Azure AD security token service (STS) for all authentication.</span></span>  <span data-ttu-id="a9181-112">Предварительной проверки подлинности, по своей природе блокирует значительное число анонимных атак, поскольку только прошедших проверку подлинности удостоверений можно получить доступ к серверному приложению hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-112">Preauthentication, by its very nature, blocks a significant number of anonymous attacks, because only authenticated identities can access hello back-end application.</span></span>

<span data-ttu-id="a9181-113">Если выбрать сквозной режим для предварительной аутентификации, это преимущество будет отсутствовать.</span><span class="sxs-lookup"><span data-stu-id="a9181-113">If you choose Passthrough as your preauthentication method, you don't get this benefit.</span></span> 

### <a name="conditional-access"></a><span data-ttu-id="a9181-114">Условный доступ</span><span class="sxs-lookup"><span data-stu-id="a9181-114">Conditional access</span></span>

<span data-ttu-id="a9181-115">Применить расширенные элементы управления политиками перед tooyour сети устанавливаются соединения.</span><span class="sxs-lookup"><span data-stu-id="a9181-115">Apply richer policy controls before connections tooyour network are established.</span></span>

<span data-ttu-id="a9181-116">С [условного доступа](active-directory-conditional-access-azuread-connected-apps.md), можно определить ограничения на трафик будет разрешен tooaccess серверной части приложения.</span><span class="sxs-lookup"><span data-stu-id="a9181-116">With [conditional access](active-directory-conditional-access-azuread-connected-apps.md), you can define restrictions on what traffic is allowed tooaccess your back-end applications.</span></span> <span data-ttu-id="a9181-117">Вы можете создать политики, ограничивающие вход на основе расположения, надежности аутентификации и профиля риска пользователя.</span><span class="sxs-lookup"><span data-stu-id="a9181-117">You can create policies that restrict sign-ins based on location, strength of authentication, and user risk profile.</span></span>

<span data-ttu-id="a9181-118">Также можно использовать политики многофакторной проверки подлинности tooconfigure условного доступа, добавления еще одного уровня проверки подлинности пользователей tooyour безопасности.</span><span class="sxs-lookup"><span data-stu-id="a9181-118">You can also use conditional access tooconfigure Multi-Factor Authentication policies, adding another layer of security tooyour user authentications.</span></span> 

### <a name="traffic-termination"></a><span data-ttu-id="a9181-119">Завершение трафика</span><span class="sxs-lookup"><span data-stu-id="a9181-119">Traffic termination</span></span>

<span data-ttu-id="a9181-120">Весь трафик завершается в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-120">All traffic is terminated in hello cloud.</span></span>

<span data-ttu-id="a9181-121">Так как прокси приложения Azure AD обратного прокси-сервера, все приложения конечным tooback трафика заканчивается на службу hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-121">Because Azure AD Application Proxy is a reverse-proxy, all traffic tooback-end applications is terminated at hello service.</span></span> <span data-ttu-id="a9181-122">Hello сеанса можно получить заново только с внутреннего сервера hello, это означает, что на внутренних серверах, не предоставляемые toodirect HTTP-трафика.</span><span class="sxs-lookup"><span data-stu-id="a9181-122">hello session can get reestablished only with hello back-end server, which means that your back-end servers are not exposed toodirect HTTP traffic.</span></span> <span data-ttu-id="a9181-123">Эта конфигурация означает повышенную защиту от целенаправленных атак.</span><span class="sxs-lookup"><span data-stu-id="a9181-123">This configuration means that you are better protected from targeted attacks.</span></span>

### <a name="all-access-is-outbound"></a><span data-ttu-id="a9181-124">Только исходящий доступ</span><span class="sxs-lookup"><span data-stu-id="a9181-124">All access is outbound</span></span> 

<span data-ttu-id="a9181-125">Не нужно tooopen входящих соединений toohello корпоративной сети.</span><span class="sxs-lookup"><span data-stu-id="a9181-125">You don't need tooopen inbound connections toohello corporate network.</span></span>

<span data-ttu-id="a9181-126">Соединители прокси приложения могут использовать только службы прокси приложения toohello Azure AD для исходящих подключений, это означает, что нет необходимости tooopen порты брандмауэра для входящих подключений.</span><span class="sxs-lookup"><span data-stu-id="a9181-126">Application Proxy connectors only use outbound connections toohello Azure AD Application Proxy service, which means that there is no need tooopen firewall ports for incoming connections.</span></span> <span data-ttu-id="a9181-127">Традиционные учетных записей-посредников требуется в сети периметра (также называется *DMZ*, *демилитаризованная зона*, или *экранированная подсеть*) и toounauthenticated доступ разрешен подключения на границе сети hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-127">Traditional proxies required a perimeter network (also known as *DMZ*, *demilitarized zone*, or *screened subnet*) and allowed access toounauthenticated connections at hello network edge.</span></span> <span data-ttu-id="a9181-128">Этот сценарий требуется много дополнительных вложений в веб-приложение брандмауэра трафик tooanalyze продуктов и предложите Добавление защиты toohello среду.</span><span class="sxs-lookup"><span data-stu-id="a9181-128">This scenario required many additional investments in web application firewall products tooanalyze traffic and offer addition protections toohello environment.</span></span> <span data-ttu-id="a9181-129">Благодаря прокси приложения можно отказаться от сети периметра, так как теперь все подключения являются исходящими и передаются по защищенному каналу.</span><span class="sxs-lookup"><span data-stu-id="a9181-129">With Application Proxy, you don't need a perimeter network because all connections are outbound and take place over a secure channel.</span></span>

<span data-ttu-id="a9181-130">Дополнительные сведения о соединителях см. в статье [Сведения о соединителях прокси приложения Azure AD](application-proxy-understand-connectors.md).</span><span class="sxs-lookup"><span data-stu-id="a9181-130">For more information about connectors, see [Understand Azure AD Application Proxy connectors](application-proxy-understand-connectors.md).</span></span>

### <a name="cloud-scale-analytics-and-machine-learning"></a><span data-ttu-id="a9181-131">Облачная аналитика и машинное обучение</span><span class="sxs-lookup"><span data-stu-id="a9181-131">Cloud-scale analytics and machine learning</span></span> 

<span data-ttu-id="a9181-132">Получите новейшую систему безопасности.</span><span class="sxs-lookup"><span data-stu-id="a9181-132">Get cutting-edge security protection.</span></span>

<span data-ttu-id="a9181-133">Так как он является частью Azure Active Directory, могут использовать прокси-сервер приложения [Azure AD Identity Protection](active-directory-identityprotection.md)с аналитики обучения управляемого компьютера и данные из Microsoft Security Response Center hello и Digital Crimes Unit.</span><span class="sxs-lookup"><span data-stu-id="a9181-133">Because it's part of Azure Active Directory, Application Proxy can leverage [Azure AD Identity Protection](active-directory-identityprotection.md), with machine learning-driven intelligence and data from hello Microsoft Security Response Center and Digital Crimes Unit.</span></span> <span data-ttu-id="a9181-134">Вместе мы в упреждающем режиме определяем скомпрометированные учетные записи и обеспечиваем защиту в реальном времени от входов, представляющих высокий уровень риска. Мы учитываем множество факторов, таких как доступ с зараженных устройств, из нетипичных и сомнительных расположений, а также через анонимизирующие сети.</span><span class="sxs-lookup"><span data-stu-id="a9181-134">Together we proactively identify compromised accounts and offer real-time protection from high-risk sign-ins. We take into account numerous factors, such as access from infected devices, through anonymizing networks, and from atypical and unlikely locations.</span></span>

<span data-ttu-id="a9181-135">Многие из этих отчетов и событий уже сейчас можно использовать в API для интеграции с системами управления сведениями о безопасности и событиями (SIEM).</span><span class="sxs-lookup"><span data-stu-id="a9181-135">Many of these reports and events are already available through an API for integration with your security information and event management (SIEM) systems.</span></span>

### <a name="remote-access-as-a-service"></a><span data-ttu-id="a9181-136">Удаленный доступ как услуга</span><span class="sxs-lookup"><span data-stu-id="a9181-136">Remote access as a service</span></span>

<span data-ttu-id="a9181-137">У вас нет tooworry о поддержке и исправления на локальных серверах.</span><span class="sxs-lookup"><span data-stu-id="a9181-137">You don’t have tooworry about maintaining and patching on-premises servers.</span></span>

<span data-ttu-id="a9181-138">Программное обеспечение, на котором не установлены исправления, по-прежнему подвергается большому количеству атак.</span><span class="sxs-lookup"><span data-stu-id="a9181-138">Unpatched software still accounts for a large number of attacks.</span></span> <span data-ttu-id="a9181-139">Прокси приложения Azure AD — это масштабируемая Интернет-служба, которая принадлежит корпорации Майкрософт, это всегда hello обновления безопасности и обновления.</span><span class="sxs-lookup"><span data-stu-id="a9181-139">Azure AD Application Proxy is an Internet-scale service that Microsoft owns, so you always get hello latest security patches and upgrades.</span></span>

<span data-ttu-id="a9181-140">безопасность hello tooimprove приложений, опубликованных через прокси приложения Azure AD, мы блокировать web роботов программой-обходчиком из индексирования и архивация приложений.</span><span class="sxs-lookup"><span data-stu-id="a9181-140">tooimprove hello security of applications published by Azure AD Application Proxy, we block web crawler robots from indexing and archiving your applications.</span></span> <span data-ttu-id="a9181-141">Каждый раз, когда программа-обходчик пытается получить параметры автоматической обработки для опубликованного приложения, прокси приложения отправляет ей файл robots.txt, который содержит `User-agent: * Disallow: /`.</span><span class="sxs-lookup"><span data-stu-id="a9181-141">Each time a web crawler robot tries to retrieve the robot's settings for a published app, Application Proxy replies with a robots.txt file that includes `User-agent: * Disallow: /`.</span></span>

## <a name="under-hello-hood"></a><span data-ttu-id="a9181-142">Кулисами hello</span><span class="sxs-lookup"><span data-stu-id="a9181-142">Under hello hood</span></span>

<span data-ttu-id="a9181-143">Прокси приложения Azure AD состоит из двух частей:</span><span class="sxs-lookup"><span data-stu-id="a9181-143">Azure AD Application Proxy consists of two parts:</span></span>

* <span data-ttu-id="a9181-144">Здравствуйте, облачная служба: Эта служба работает в Azure и является местом hello подключения внешнего клиента или пользователя.</span><span class="sxs-lookup"><span data-stu-id="a9181-144">hello cloud-based service: This service runs in Azure, and is where hello external client/user connections are made.</span></span>
* <span data-ttu-id="a9181-145">[Hello локального соединителя](application-proxy-understand-connectors.md): компонент локального соединителя hello прослушивает запросы от службы прокси приложения hello Azure AD и обрабатывает внутренних приложений toohello подключений.</span><span class="sxs-lookup"><span data-stu-id="a9181-145">[hello on-premises connector](application-proxy-understand-connectors.md): An on-premises component, hello connector listens for requests from hello Azure AD Application Proxy service and handles connections toohello internal applications.</span></span> 

<span data-ttu-id="a9181-146">Поток между соединитель hello и службы прокси приложения hello устанавливается при:</span><span class="sxs-lookup"><span data-stu-id="a9181-146">A flow between hello connector and hello Application Proxy service is established when:</span></span>

* <span data-ttu-id="a9181-147">Соединитель Hello сначала настроить.</span><span class="sxs-lookup"><span data-stu-id="a9181-147">hello connector is first set up.</span></span>
* <span data-ttu-id="a9181-148">Соединитель Hello запрашивает информацию о конфигурации из службы прокси приложения hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-148">hello connector pulls configuration information from hello Application Proxy service.</span></span>
* <span data-ttu-id="a9181-149">Пользователь получает доступ к опубликованному приложению.</span><span class="sxs-lookup"><span data-stu-id="a9181-149">A user accesses a published application.</span></span>

>[!NOTE]
><span data-ttu-id="a9181-150">Любой обмен данными выполняется по протоколу SSL, и они всегда создаются на toohello hello соединитель прокси приложения службы.</span><span class="sxs-lookup"><span data-stu-id="a9181-150">All communications occur over SSL, and they always originate at hello connector toohello Application Proxy service.</span></span> <span data-ttu-id="a9181-151">только службы Hello является исходящим.</span><span class="sxs-lookup"><span data-stu-id="a9181-151">hello service is outbound only.</span></span>

<span data-ttu-id="a9181-152">Соединитель Hello использует toohello tooauthenticate сертификат клиента службы прокси приложения для почти всех вызовов.</span><span class="sxs-lookup"><span data-stu-id="a9181-152">hello connector uses a client certificate tooauthenticate toohello Application Proxy service for nearly all calls.</span></span> <span data-ttu-id="a9181-153">Hello только процесс toothis исключение — hello начальной настройки шаг, где установлен сертификат клиента hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-153">hello only exception toothis process is hello initial setup step, where hello client certificate is established.</span></span>

### <a name="installing-hello-connector"></a><span data-ttu-id="a9181-154">Установка соединителя hello</span><span class="sxs-lookup"><span data-stu-id="a9181-154">Installing hello connector</span></span>

<span data-ttu-id="a9181-155">При первой настройке соединителя hello hello после событий потока происходить:</span><span class="sxs-lookup"><span data-stu-id="a9181-155">When hello connector is first set up, hello following flow events take place:</span></span>

1. <span data-ttu-id="a9181-156">Служба toohello регистрации соединителя Hello происходит в процессе установки hello hello соединителя.</span><span class="sxs-lookup"><span data-stu-id="a9181-156">hello connector registration toohello service happens as part of hello installation of hello connector.</span></span> <span data-ttu-id="a9181-157">Пользователи являются tooenter запрашиваемые учетные данные администратора Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a9181-157">Users are prompted tooenter their Azure AD admin credentials.</span></span> <span data-ttu-id="a9181-158">Затем токена, полученного от этой проверки подлинности представляется toohello службы прокси приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a9181-158">The token acquired from this authentication is then presented toohello Azure AD Application Proxy service.</span></span>
2. <span data-ttu-id="a9181-159">прокси-служба приложения Hello вычисляет токен hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-159">hello Application Proxy service evaluates hello token.</span></span> <span data-ttu-id="a9181-160">Это гарантирует, что hello пользователя-администратора организации в клиенте hello, hello токена был выпущен для.</span><span class="sxs-lookup"><span data-stu-id="a9181-160">It ensures that hello user is a company administrator within hello tenant that hello token was issued for.</span></span> <span data-ttu-id="a9181-161">Если пользователь hello не является администратором, hello процесс завершается.</span><span class="sxs-lookup"><span data-stu-id="a9181-161">If hello user is not an administrator, hello process is terminated.</span></span>
3. <span data-ttu-id="a9181-162">Соединитель Hello создает запрос на сертификат клиента и передает его, вместе с маркера, toohello hello прокси-сервер приложения службы.</span><span class="sxs-lookup"><span data-stu-id="a9181-162">hello connector generates a client certificate request and passes it, along with hello token, toohello Application Proxy service.</span></span> <span data-ttu-id="a9181-163">в свою очередь, служба Hello проверяет токен hello и подписывает запрос сертификата клиента hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-163">hello service in turn verifies hello token and signs hello client certificate request.</span></span>
4. <span data-ttu-id="a9181-164">Соединитель Hello использует hello клиентский сертификат для будущих связи с прокси-служба приложения hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-164">hello connector uses hello client certificate for future communication with hello Application Proxy service.</span></span>
5. <span data-ttu-id="a9181-165">Соединитель Hello выполняет начальной запросу hello данные конфигурации системы с hello службы с использованием его сертификата клиента и теперь является готов tootake запросов.</span><span class="sxs-lookup"><span data-stu-id="a9181-165">hello connector performs an initial pull of hello system configuration data from hello service using its client certificate, and it is now ready tootake requests.</span></span>

### <a name="updating-hello-configuration-settings"></a><span data-ttu-id="a9181-166">Обновление параметров конфигурации hello</span><span class="sxs-lookup"><span data-stu-id="a9181-166">Updating hello configuration settings</span></span>

<span data-ttu-id="a9181-167">Каждый раз, когда прокси-служба приложения hello обновляет параметры конфигурации hello, hello после событий потока происходить:</span><span class="sxs-lookup"><span data-stu-id="a9181-167">Whenever hello Application Proxy service updates hello configuration settings, hello following flow events take place:</span></span>

1. <span data-ttu-id="a9181-168">Соединитель Hello подключается конечной точки конфигурации toohello внутри hello прокси-сервер приложения службы с помощью сертификата клиента.</span><span class="sxs-lookup"><span data-stu-id="a9181-168">hello connector connects toohello configuration endpoint within hello Application Proxy service by using its client certificate.</span></span>
2. <span data-ttu-id="a9181-169">После проверки сертификата клиента hello службы прокси приложения hello возвращает соединитель toohello данных конфигурации (например, группы соединителей hello, hello соединителя должно быть частью).</span><span class="sxs-lookup"><span data-stu-id="a9181-169">After hello client certificate has been validated, hello Application Proxy service returns configuration data toohello connector (for example, hello connector group that hello connector should be part of).</span></span>
3. <span data-ttu-id="a9181-170">Если hello текущий сертификат более чем 180 дней, соединитель hello создает новый запрос на сертификат, который фактически обновляет сертификат клиента hello раз в 180 дней.</span><span class="sxs-lookup"><span data-stu-id="a9181-170">If hello current certificate is more than 180 days old, hello connector generates a new certificate request, which effectively updates hello client certificate every 180 days.</span></span>

### <a name="accessing-published-applications"></a><span data-ttu-id="a9181-171">Доступ к опубликованным приложениям</span><span class="sxs-lookup"><span data-stu-id="a9181-171">Accessing published applications</span></span>

<span data-ttu-id="a9181-172">При доступе к опубликованному приложению, hello происходит следующее между службой прокси приложения hello и соединитель прокси приложения hello:</span><span class="sxs-lookup"><span data-stu-id="a9181-172">When users access a published application, hello following events take place between hello Application Proxy service and hello Application Proxy connector:</span></span>

1. [<span data-ttu-id="a9181-173">Hello служба проверяет подлинность пользователя hello приложение hello</span><span class="sxs-lookup"><span data-stu-id="a9181-173">hello service authenticates hello user for hello app</span></span>](#the-service-checks-the-configuration-settings-for-the-app)
2. [<span data-ttu-id="a9181-174">Служба Hello помещает запрос в очередь коннектора hello</span><span class="sxs-lookup"><span data-stu-id="a9181-174">hello service places a request in hello connector queue</span></span>](#The-service-places-a-request-in-the-connector-queue)
3. [<span data-ttu-id="a9181-175">Соединитель обрабатывает запрос hello из очереди hello</span><span class="sxs-lookup"><span data-stu-id="a9181-175">A connector processes hello request from hello queue</span></span>](#the-connector-receives-the-request-from-the-queue)
4. [<span data-ttu-id="a9181-176">Соединитель Hello ожидает ответа</span><span class="sxs-lookup"><span data-stu-id="a9181-176">hello connector waits for a response</span></span>](#the-connector-waits-for-a-response)
5. [<span data-ttu-id="a9181-177">Hello службы потоки данных toohello пользователя</span><span class="sxs-lookup"><span data-stu-id="a9181-177">hello service streams data toohello user</span></span>](#the-service-streams-data-to-the-user)

<span data-ttu-id="a9181-178">продолжить чтение toolearn Дополнительные сведения о том, что происходит в каждое из этих действий.</span><span class="sxs-lookup"><span data-stu-id="a9181-178">toolearn more about what takes place in each of these steps, keep reading.</span></span>


#### <a name="1-hello-service-authenticates-hello-user-for-hello-app"></a><span data-ttu-id="a9181-179">1. hello служба проверяет подлинность пользователя hello приложение hello</span><span class="sxs-lookup"><span data-stu-id="a9181-179">1. hello service authenticates hello user for hello app</span></span>

<span data-ttu-id="a9181-180">Если приложение hello toouse Passthrough настроен в качестве его метод предварительной проверки подлинности, hello шаги в этом разделе, пропускаются.</span><span class="sxs-lookup"><span data-stu-id="a9181-180">If you configured hello app toouse Passthrough as its preauthentication method, hello steps in this section are skipped.</span></span>

<span data-ttu-id="a9181-181">Если вы настроили toopreauthenticate приложения hello в Azure AD, пользователи являются перенаправленный toohello tooauthenticate STS Azure AD, и hello следующие шаги выполняются:</span><span class="sxs-lookup"><span data-stu-id="a9181-181">If you configured hello app toopreauthenticate with Azure AD, users are redirected toohello Azure AD STS tooauthenticate, and hello following steps take place:</span></span>

1. <span data-ttu-id="a9181-182">Прокси приложения проверяет все требования политики условного доступа для конкретного приложения hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-182">Application Proxy checks for any conditional access policy requirements for hello specific application.</span></span> <span data-ttu-id="a9181-183">Это действие гарантирует, что этот пользователь hello назначена toohello приложения.</span><span class="sxs-lookup"><span data-stu-id="a9181-183">This step ensures that hello user has been assigned toohello application.</span></span> <span data-ttu-id="a9181-184">При необходимости двухшаговую проверку, hello последовательность проверки подлинности пользователю hello для второй метод проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="a9181-184">If two-step verification is required, hello authentication sequence prompts hello user for a second authentication method.</span></span>

2. <span data-ttu-id="a9181-185">После выполнения всех проверок, hello Azure AD STS выдает подписанный маркер для приложения hello и перенаправляет hello задней toohello пользователя прокси-сервера приложения службы.</span><span class="sxs-lookup"><span data-stu-id="a9181-185">After all checks have passed, hello Azure AD STS issues a signed token for hello application and redirects hello user back toohello Application Proxy service.</span></span>

3. <span data-ttu-id="a9181-186">Прокси приложения, подтверждает, что этот токен hello был выдан toocorrect приложения hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-186">Application Proxy verifies that hello token was issued toocorrect hello application.</span></span> <span data-ttu-id="a9181-187">Он также выполняет другие проверки, с помощью Azure AD, например убедиться, что hello подписан токен и — что он по-прежнему внутри окна допустимым hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-187">It performs other checks also, such as ensuring that hello token was signed by Azure AD, and that it is still within hello valid window.</span></span>

4. <span data-ttu-id="a9181-188">Прокси приложения устанавливается tooindicate зашифрованной проверки подлинности файла cookie возникшей toohello приложения проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="a9181-188">Application Proxy sets an encrypted authentication cookie tooindicate that authentication toohello application has occurred.</span></span> <span data-ttu-id="a9181-189">Hello куки-файл включает отметку времени истечения срока действия, основанный на hello токена от Azure AD и другие данные, такие как имя пользователя hello, Здравствуйте, проверка подлинности основывается на.</span><span class="sxs-lookup"><span data-stu-id="a9181-189">hello cookie includes an expiration timestamp that's based on hello token from Azure AD and other data, such as hello user name that hello authentication is based on.</span></span> <span data-ttu-id="a9181-190">Hello файл cookie шифруется с закрытым ключом, который известен только toohello прокси-сервера приложения службы.</span><span class="sxs-lookup"><span data-stu-id="a9181-190">hello cookie is encrypted with a private key known only toohello Application Proxy service.</span></span>

5. <span data-ttu-id="a9181-191">Приложение прокси-сервера переадресации hello пользователя задней toohello первоначально запрошенный URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="a9181-191">Application Proxy redirects hello user back toohello originally requested URL.</span></span>

<span data-ttu-id="a9181-192">При сбое любой части предварительной проверки подлинности шаги hello пользователя hello запрос отклоняется и hello пользователь увидит сообщение hello источник проблемы hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-192">If any part of hello preauthentication steps fails, hello user’s request is denied, and hello user is shown a message indicating hello source of hello problem.</span></span>


#### <a name="2-hello-service-places-a-request-in-hello-connector-queue"></a><span data-ttu-id="a9181-193">2. hello служба помещает запрос в очередь коннектора hello</span><span class="sxs-lookup"><span data-stu-id="a9181-193">2. hello service places a request in hello connector queue</span></span>

<span data-ttu-id="a9181-194">Соединители сохранить открытые toohello исходящее подключение службы прокси приложения.</span><span class="sxs-lookup"><span data-stu-id="a9181-194">Connectors keep an outbound connection open toohello Application Proxy service.</span></span> <span data-ttu-id="a9181-195">При поступлении запроса службы hello ставит в очередь запрос hello на одном hello открытых соединений для hello соединитель toopick вверх.</span><span class="sxs-lookup"><span data-stu-id="a9181-195">When a request comes in, hello service queues up hello request on one of hello open connections for hello connector toopick up.</span></span>

<span data-ttu-id="a9181-196">запрос Hello содержит элементы из приложения hello, например заголовки запроса данных из файла cookie шифрования hello hello, идентификатор запроса hello пользователя, выполняющего hello запроса и hello</span><span class="sxs-lookup"><span data-stu-id="a9181-196">hello request includes items from hello application, such as hello request headers, data from hello encrypted cookie, hello user making hello request, and hello request ID.</span></span> <span data-ttu-id="a9181-197">Несмотря на то, что данных из зашифрованного файла cookie hello отправляется в запросе hello, файла cookie проверки подлинности hello сам не является.</span><span class="sxs-lookup"><span data-stu-id="a9181-197">Although data from hello encrypted cookie is sent with hello request, hello authentication cookie itself is not.</span></span>

#### <a name="3-hello-connector-processes-hello-request-from-hello-queue"></a><span data-ttu-id="a9181-198">3. hello соединителя обрабатывает запрос hello из очереди hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-198">3. hello connector processes hello request from hello queue.</span></span> 

<span data-ttu-id="a9181-199">На основании запроса hello, прокси-сервер приложения выполняет одно из hello следующие действия.</span><span class="sxs-lookup"><span data-stu-id="a9181-199">Based on hello request, Application Proxy performs one of hello following actions:</span></span>

* <span data-ttu-id="a9181-200">Если запрос hello — простая операция (например, нет данных в теле hello как с категории RESTful *получить* запроса), соединитель hello создает внутренний ресурс целевой toohello подключения и затем ожидает ответа.</span><span class="sxs-lookup"><span data-stu-id="a9181-200">If hello request is a simple operation (for example, there is no data within hello body as is with a RESTful *GET* request), hello connector makes a connection toohello target internal resource and then waits for a response.</span></span>

* <span data-ttu-id="a9181-201">Если запрос hello содержит данные, связанные с ним в тексте hello (например, категории RESTful *POST* операции), соединитель hello делает исходящее подключение, используя экземпляр прокси-сервера приложения toohello сертификат клиента hello.</span><span class="sxs-lookup"><span data-stu-id="a9181-201">If hello request has data associated with it in hello body (for example, a RESTful *POST* operation), hello connector makes an outbound connection by using hello client certificate toohello Application Proxy instance.</span></span> <span data-ttu-id="a9181-202">Он делает их hello toorequest соединение и открыть ресурс toohello внутреннего соединения.</span><span class="sxs-lookup"><span data-stu-id="a9181-202">It makes this connection toorequest hello data and open a connection toohello internal resource.</span></span> <span data-ttu-id="a9181-203">После получения запроса hello из соединителя hello, службы прокси приложения hello начинает принимать содержимое от пользователя hello и пересылает данные toohello соединителя.</span><span class="sxs-lookup"><span data-stu-id="a9181-203">After it receives hello request from hello connector, hello Application Proxy service begins accepting content from hello user and forwards data toohello connector.</span></span> <span data-ttu-id="a9181-204">Соединитель Hello, в свою очередь пересылает hello данных toohello внутренних ресурсов.</span><span class="sxs-lookup"><span data-stu-id="a9181-204">hello connector, in turn, forwards hello data toohello internal resource.</span></span>

#### <a name="4-hello-connector-waits-for-a-response"></a><span data-ttu-id="a9181-205">4. соединитель hello время ожидания ответа.</span><span class="sxs-lookup"><span data-stu-id="a9181-205">4. hello connector waits for a response.</span></span>

<span data-ttu-id="a9181-206">После запроса hello и передачей всего содержимого toohello окончания завершается, соединитель hello ожидает ответа.</span><span class="sxs-lookup"><span data-stu-id="a9181-206">After hello request and transmission of all content toohello back end is complete, hello connector waits for a response.</span></span>

<span data-ttu-id="a9181-207">После получения ответа, соединитель hello делает исходящее подключение toohello прокси-сервера приложения службы, tooreturn сведения заголовка hello с последующим потоковой передачи hello возвращаемых данных.</span><span class="sxs-lookup"><span data-stu-id="a9181-207">After it receives a response, hello connector makes an outbound connection toohello Application Proxy service, tooreturn hello header details and begin streaming hello return data.</span></span>

#### <a name="5-hello-service-streams-data-toohello-user"></a><span data-ttu-id="a9181-208">5. hello службы потоки данных toohello пользователя.</span><span class="sxs-lookup"><span data-stu-id="a9181-208">5. hello service streams data toohello user.</span></span> 

<span data-ttu-id="a9181-209">Некоторые приложения hello могут произойти здесь.</span><span class="sxs-lookup"><span data-stu-id="a9181-209">Some processing of hello application may occur here.</span></span> <span data-ttu-id="a9181-210">Если вы настроили заголовки tootranslate прокси-сервера приложения или URL-адресов в приложении обработки происходит при необходимости во время выполнения этого шага.</span><span class="sxs-lookup"><span data-stu-id="a9181-210">If you configured Application Proxy tootranslate headers or URLs in your application, that processing happens as needed during this step.</span></span>


## <a name="next-steps"></a><span data-ttu-id="a9181-211">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a9181-211">Next steps</span></span>

[<span data-ttu-id="a9181-212">Аспекты топологии сети при использовании прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="a9181-212">Network topology considerations when using Azure AD Application Proxy</span></span>](application-proxy-network-topology-considerations.md)

[<span data-ttu-id="a9181-213">Сведения о соединителях прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="a9181-213">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-understand-connectors.md)
