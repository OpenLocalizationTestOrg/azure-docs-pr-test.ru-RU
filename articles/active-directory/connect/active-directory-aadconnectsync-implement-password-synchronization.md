---
title: "Реализация синхронизации паролей с помощью Azure AD Connect Sync | Документация Майкрософт"
description: "В этой статье объясняется, как работает синхронизация паролей и как ее настроить."
services: active-directory
documentationcenter: 
author: MarkusVi
manager: femila
editor: 
ms.assetid: 05f16c3e-9d23-45dc-afca-3d0fa9dbf501
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: db9b1578a235be9018fc1985cc75a0a05ee47b3a
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="implement-password-synchronization-with-azure-ad-connect-sync"></a><span data-ttu-id="2e6d7-103">Реализация синхронизации паролей с помощью Azure AD Connect Sync</span><span class="sxs-lookup"><span data-stu-id="2e6d7-103">Implement password synchronization with Azure AD Connect sync</span></span>
<span data-ttu-id="2e6d7-104">В этой статье содержатся сведения о том, как синхронизировать пароли пользователей локального экземпляра службы Active Directory (AD) и облачного экземпляра службы Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-104">This article provides information that you need to synchronize your user passwords from an on-premises Active Directory instance to a cloud-based Azure Active Directory (Azure AD) instance.</span></span>

## <a name="what-is-password-synchronization"></a><span data-ttu-id="2e6d7-105">Что такое синхронизация паролей</span><span class="sxs-lookup"><span data-stu-id="2e6d7-105">What is password synchronization</span></span>
<span data-ttu-id="2e6d7-106">Чем больше у вас паролей, которые нужно помнить, тем выше вероятность того, что в какой-то момент из-за забытого пароля работа остановится.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-106">The probability that you're blocked from getting your work done due to a forgotten password is related to the number of different passwords you need to remember.</span></span> <span data-ttu-id="2e6d7-107">Чем больше паролей необходимо помнить, тем выше вероятность забыть один из них.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-107">The more passwords you need to remember, the higher the probability to forget one.</span></span> <span data-ttu-id="2e6d7-108">Вопросы и звонки о восстановлении паролей и прочие проблемы, связанные с паролями, забирают больше всего ресурсов службы технической поддержки.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-108">Questions and calls about password resets and other password-related issues demand the most helpdesk resources.</span></span>

<span data-ttu-id="2e6d7-109">Синхронизация паролей — это функция для синхронизации пользовательских паролей между локальным экземпляром службы Active Directory и облачным экземпляром службы Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-109">Password synchronization is a feature used to synchronize user passwords from an on-premises Active Directory instance to a cloud-based Azure AD instance.</span></span>
<span data-ttu-id="2e6d7-110">Эту функцию можно использовать для входа в службы Azure AD, например Office 365, Microsoft Intune, CRM Online и доменные службы Azure Active Directory (Azure AD DS).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-110">Use this feature to sign in to Azure AD services like Office 365, Microsoft Intune, CRM Online, and Azure Active Directory Domain Services (Azure AD DS).</span></span> <span data-ttu-id="2e6d7-111">Вы можете входить в службу с помощью пароля, который используется на локальном экземпляре Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-111">You sign in to the service by using the same password you use to sign in to your on-premises Active Directory instance.</span></span>

![Что такое Azure AD Connect?](./media/active-directory-aadconnectsync-implement-password-synchronization/arch1.png)

<span data-ttu-id="2e6d7-113">Вместо большого числа паролей, пользователям нужно будет запомнить только один.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-113">By reducing the number of passwords, your users need to maintain to just one.</span></span> <span data-ttu-id="2e6d7-114">Синхронизация паролей дает следующие преимущества.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-114">Password synchronization helps you to:</span></span>

* <span data-ttu-id="2e6d7-115">Повышение производительности пользователей.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-115">Improve the productivity of your users.</span></span>
* <span data-ttu-id="2e6d7-116">Снижение затрат на техническую поддержку.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-116">Reduce your helpdesk costs.</span></span>  

<span data-ttu-id="2e6d7-117">Если вы используете [службу федерации Active Directory (AD FS)](https://channel9.msdn.com/Series/Azure-Active-Directory-Videos-Demos/Configuring-AD-FS-for-user-sign-in-with-Azure-AD-Connect), можете также настроить синхронизацию паролей. Это даст вам дополнительный резервный механизм на случай сбоя в инфраструктуре AD FS.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-117">Also, if you decide to use [Federation with Active Directory Federation Services (AD FS)](https://channel9.msdn.com/Series/Azure-Active-Directory-Videos-Demos/Configuring-AD-FS-for-user-sign-in-with-Azure-AD-Connect), you can optionally set up password synchronization as a backup in case your AD FS infrastructure fails.</span></span>

<span data-ttu-id="2e6d7-118">Синхронизация паролей — это расширение функции синхронизации каталогов, реализованное при помощи служб синхронизации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-118">Password synchronization is an extension to the directory synchronization feature implemented by Azure AD Connect sync.</span></span> <span data-ttu-id="2e6d7-119">Для использования синхронизации паролей в определенной среде необходимо выполнение следующих действий.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-119">To use password synchronization in your environment, you need to:</span></span>

* <span data-ttu-id="2e6d7-120">Установите Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-120">Install Azure AD Connect.</span></span>  
* <span data-ttu-id="2e6d7-121">Настройте синхронизацию каталогов между локальным экземпляром службы Active Directory и облачным экземпляром Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-121">Configure directory synchronization between your on-premises Active Directory instance and your Azure Active Directory instance.</span></span>
* <span data-ttu-id="2e6d7-122">Включите синхронизацию паролей.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-122">Enable password synchronization.</span></span>

<span data-ttu-id="2e6d7-123">Дополнительные сведения см. в статье [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-123">For more details, see [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>

> [!NOTE]
> <span data-ttu-id="2e6d7-124">Дополнительную информацию о настройке доменных служб Azure Active Directory для использования FIPS и синхронизации паролей, см. в разделе "Синхронизация паролей и FIPS" дальше в этой статье.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-124">For more details about Azure Active Directory Domain Services configured for FIPS and password synchronization, see "Password synchronization and FIPS" later in this article.</span></span>
>
>

## <a name="how-password-synchronization-works"></a><span data-ttu-id="2e6d7-125">Как работает синхронизация паролей</span><span class="sxs-lookup"><span data-stu-id="2e6d7-125">How password synchronization works</span></span>
<span data-ttu-id="2e6d7-126">Доменная служба Active Directory хранит пароли в виде хэш-значений, полученных на основе фактических паролей.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-126">The Active Directory domain service stores passwords in the form of a hash value representation of the actual user password.</span></span> <span data-ttu-id="2e6d7-127">Для получения хэш-значений используется необратимая математическая функция (*алгоритм хэширования*).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-127">A hash value is a result of a one-way mathematical function (the *hashing algorithm*).</span></span> <span data-ttu-id="2e6d7-128">Не существует метода для возврата результата односторонней функции в обычную текстовую версию пароля.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-128">There is no method to revert the result of a one-way function to the plain text version of a password.</span></span> <span data-ttu-id="2e6d7-129">Хэш пароля не может использоваться для входа в локальную сеть.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-129">You cannot use a password hash to sign in to your on-premises network.</span></span>

<span data-ttu-id="2e6d7-130">Чтобы синхронизировать пароль, Azure AD Connect Sync извлекает хэш пароля из локального экземпляра Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-130">To synchronize your password, Azure AD Connect sync extracts your password hash from the on-premises Active Directory instance.</span></span> <span data-ttu-id="2e6d7-131">Перед синхронизацией в службу проверки подлинности Azure Active Directory хэш пароля дополнительно обрабатывается системой безопасности.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-131">Extra security processing is applied to the password hash before it is synchronized to the Azure Active Directory authentication service.</span></span> <span data-ttu-id="2e6d7-132">Пароли синхронизируются для каждого пользователя отдельно и в хронологическом порядке.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-132">Passwords are synchronized on a per-user basis and in chronological order.</span></span>

<span data-ttu-id="2e6d7-133">Фактический поток данных в процессе синхронизации паролей аналогичен синхронизации данных пользователей, таких как отображаемые имена или адреса электронной почты.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-133">The actual data flow of the password synchronization process is similar to the synchronization of user data such as DisplayName or Email Addresses.</span></span> <span data-ttu-id="2e6d7-134">Но синхронизация паролей происходит чаще, чем это обычно делается для других атрибутов.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-134">However, passwords are synchronized more frequently than the standard directory synchronization window for other attributes.</span></span> <span data-ttu-id="2e6d7-135">Процесс синхронизации паролей выполняется каждые 2 минуты.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-135">The password synchronization process runs every 2 minutes.</span></span> <span data-ttu-id="2e6d7-136">Нельзя изменять частоту выполнения этого процесса.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-136">You cannot modify the frequency of this process.</span></span> <span data-ttu-id="2e6d7-137">При синхронизации пароль перезаписывает существующий в облачной службе.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-137">When you synchronize a password, it overwrites the existing cloud password.</span></span>

<span data-ttu-id="2e6d7-138">Когда вы впервые включаете функцию синхронизации паролей, выполняется первоначальная синхронизация паролей для всех пользователей в области действия функции.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-138">The first time you enable the password synchronization feature, it performs an initial synchronization of the passwords of all in-scope users.</span></span> <span data-ttu-id="2e6d7-139">Вы не можете явно выделить подмножество пользователей, для которых нужно синхронизировать пароли.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-139">You cannot explicitly define a subset of user passwords that you want to synchronize.</span></span>

<span data-ttu-id="2e6d7-140">При изменении локального пароля новый пароль, как правило, синхронизируется в течение нескольких минут.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-140">When you change an on-premises password, the updated password is synchronized, most often in a matter of minutes.</span></span>
<span data-ttu-id="2e6d7-141">Если синхронизация паролей завершается сбоем, автоматически осуществляется новая попытка.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-141">The password synchronization feature automatically retries failed synchronization attempts.</span></span> <span data-ttu-id="2e6d7-142">Ошибки, возникающие во время синхронизации паролей, записываются в журнал событий.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-142">If an error occurs during an attempt to synchronize a password, an error is logged in your event viewer.</span></span>

<span data-ttu-id="2e6d7-143">Синхронизация пароля не влияет на пользователей Azure, находящихся в системе в момент ее выполнения.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-143">The synchronization of a password has no impact on the user  who is currently signed in.</span></span>
<span data-ttu-id="2e6d7-144">Если изменение пароля синхронизируется во время вашего пребывания в облачной службе, оно не применяется в сеансе облачной службы немедленно.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-144">Your current cloud service session is not immediately affected by a synchronized password change that occurs while you are signed in to a cloud service.</span></span> <span data-ttu-id="2e6d7-145">Однако, когда снова возникнет необходимость в проверке подлинности в облачной службе, потребуется указать новый пароль.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-145">However, when the cloud service requires you to authenticate again, you need to provide your new password.</span></span>

<span data-ttu-id="2e6d7-146">Для аутентификации в Azure AD пользователь должен вводить корпоративные учетные данные повторно, независимо от того, выполнен ли вход в корпоративную сеть.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-146">A user must enter their corporate credentials a second time to authenticate to Azure AD, regardless of whether they're signed in to their corporate network.</span></span> <span data-ttu-id="2e6d7-147">Но эту проблему можно свести к минимуму, если пользователь при входе в систему установит флажок "Оставаться в системе".</span><span class="sxs-lookup"><span data-stu-id="2e6d7-147">These pattern can be minimized, however, if the user selects the Keep me signed in (KMSI) check box at sign in.</span></span> <span data-ttu-id="2e6d7-148">Это действие создает для сеанса файл cookie, который на некоторое время позволяет обходить аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-148">This selection sets a session cookie that bypasses authentication for a short period.</span></span> <span data-ttu-id="2e6d7-149">Администратор Azure Active Directory может включить или отключить функцию "Оставаться в системе".</span><span class="sxs-lookup"><span data-stu-id="2e6d7-149">KMSI behavior can be enabled or disabled by the Azure AD administrator.</span></span>

> [!NOTE]
> <span data-ttu-id="2e6d7-150">Синхронизация паролей поддерживается только для типа объектов user в Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-150">Password sync is only supported for the object type user in Active Directory.</span></span> <span data-ttu-id="2e6d7-151">Она не поддерживается для типа объектов iNetOrgPerson.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-151">It is not supported for the iNetOrgPerson object type.</span></span>

### <a name="detailed-description-of-how-password-synchronization-works"></a><span data-ttu-id="2e6d7-152">Подробное описание принципа действия синхронизации паролей</span><span class="sxs-lookup"><span data-stu-id="2e6d7-152">Detailed description of how password synchronization works</span></span>
<span data-ttu-id="2e6d7-153">Ниже подробно описан принцип действия синхронизации паролей между локальным экземпляром Active Directory и Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-153">The following describes in-depth how password synchronization works between Active Directory and Azure AD.</span></span>

![Подробная схема использования паролей](./media/active-directory-aadconnectsync-implement-password-synchronization/arch3.png)


1. <span data-ttu-id="2e6d7-155">Каждые две минуты агент синхронизации паролей на сервере AD Connect запрашивает хэш сохраненных паролей (атрибут unicodePwd) у контроллера домена по стандартному протоколу репликации [MS-DRSR](https://msdn.microsoft.com/library/cc228086.aspx), используемому для синхронизации данных контроллеров доменов.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-155">Every two minutes, the password synchronization agent on the AD Connect server requests stored password hashes (the unicodePwd attribute) from a DC via the standard [MS-DRSR](https://msdn.microsoft.com/library/cc228086.aspx) replication protocol used to synchronize data between DCs.</span></span> <span data-ttu-id="2e6d7-156">Для получения хэша паролей учетной записи службы требуются разрешения AD "Репликация изменений каталога" и "Репликация всех изменений каталога" (предоставляется по умолчанию при установке).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-156">The service account must have Replicate Directory Changes and Replicate Directory Changes All AD permissions (granted by default on installation) to obtain the password hashes.</span></span>
2. <span data-ttu-id="2e6d7-157">Перед отправкой контроллер домена шифрует MD4-хэш пароля с помощью ключа — комбинации [MD5](http://www.rfc-editor.org/rfc/rfc1321.txt)-хэша от ключа сеанса RPC и случайных данных.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-157">Before sending, the DC encrypts the MD4 password hash by using a key that is a [MD5](http://www.rfc-editor.org/rfc/rfc1321.txt) hash of the RPC session key and a salt.</span></span> <span data-ttu-id="2e6d7-158">После этого он отправляет результат агенту синхронизации паролей по протоколу RPC.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-158">It then sends the result to the password synchronization agent over RPC.</span></span> <span data-ttu-id="2e6d7-159">Контроллер домена также передает агенту синхронизации случайные данные, используя протокол репликации контроллера домена, чтобы агент смог расшифровать конверт.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-159">The DC also passes the salt to the synchronization agent by using the DC replication protocol, so the agent will be able to decrypt the envelope.</span></span>
3.  <span data-ttu-id="2e6d7-160">Когда агент синхронизации паролей получает зашифрованный конверт, он создает ключ для расшифровки полученных данных в исходный формат MD4, используя [MD5CryptoServiceProvider](https://msdn.microsoft.com/library/System.Security.Cryptography.MD5CryptoServiceProvider.aspx) и случайные данные.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-160">After the password synchronization agent has the encrypted envelope, it uses [MD5CryptoServiceProvider](https://msdn.microsoft.com/library/System.Security.Cryptography.MD5CryptoServiceProvider.aspx) and the salt to generate a key to decrypt the received data back to its original MD4 format.</span></span> <span data-ttu-id="2e6d7-161">Агенту синхронизации паролей недоступен пароль в виде открытого текста.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-161">At no point does the password synchronization agent have access to the clear text password.</span></span> <span data-ttu-id="2e6d7-162">Он использует MD5 только для обеспечения совместимости протокола репликации с контроллером домена и только на локальном компьютере между контроллером домена и агентом синхронизации паролей.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-162">The password synchronization agent’s use of MD5 is strictly for replication protocol compatibility with the DC, and it is only used on premises between the DC and the password synchronization agent.</span></span>
4.  <span data-ttu-id="2e6d7-163">Агент синхронизации паролей увеличивает 16-байтовый двоичный хэш пароля до 64 байтов. Сначала он преобразует хэш в 32-байтовую шестнадцатеричную строку, а затем преобразует ее обратно в двоичный файл с кодировкой UTF-16.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-163">The password synchronization agent expands the 16-byte binary password hash to 64 bytes by first converting the hash to a 32-byte hexadecimal string, then converting this string back into binary with UTF-16 encoding.</span></span>
5.  <span data-ttu-id="2e6d7-164">Агент синхронизации паролей добавляет 10-байтовые случайные данные к 64-байтовому двоичному файлу, чтобы обеспечить дополнительную защиту исходного хэша.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-164">The password synchronization agent adds a salt, consisting of a 10-byte length salt, to the 64-byte binary to further protect the original hash.</span></span>
6.  <span data-ttu-id="2e6d7-165">Затем он объединяет хэш MD4 и случайные данные, а результат передает в функцию [PBKDF2](https://www.ietf.org/rfc/rfc2898.txt).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-165">The password synchronization agent then combines the MD4 hash plus salt, and inputs it into the [PBKDF2](https://www.ietf.org/rfc/rfc2898.txt) function.</span></span> <span data-ttu-id="2e6d7-166">Выполняется 1000 итераций алгоритма хэширования с ключом [HMAC-SHA256](https://msdn.microsoft.com/library/system.security.cryptography.hmacsha256.aspx).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-166">1000 iterations of the [HMAC-SHA256](https://msdn.microsoft.com/library/system.security.cryptography.hmacsha256.aspx) keyed hashing algorithm is used.</span></span> 
7.  <span data-ttu-id="2e6d7-167">Агент синхронизации паролей принимает полученный 32-байтовый хэш, присоединяет к нему значение соли и число итераций SHA256 (для использования Azure AD), а затем полученную строку передает из Azure AD Connect в Azure AD по протоколу SSL.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-167">The password synchronization agent takes the resulting 32-byte hash, concatenates both the salt and the number of SHA256 iterations to it (for use by Azure AD), then transmits the string from Azure AD Connect to Azure AD over SSL.</span></span></br> 
8.  <span data-ttu-id="2e6d7-168">Когда пользователь вводит пароль для входа в Azure AD, пароль обрабатывается точно так же (MD4, случайные данные, PBKDF2 и HMAC-SHA256).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-168">When a user attempts to sign in to Azure AD and enters their password, the password is run through the same MD4+salt+PBKDF2+HMAC-SHA256 process.</span></span> <span data-ttu-id="2e6d7-169">Если полученный хэш совпадает с хэшем, хранящимся в Azure AD, это означает, что пользователь ввел правильный пароль и он проходит аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-169">If the resulting hash matches the hash stored in Azure AD, the user has entered the correct password and is authenticated.</span></span> 

>[!Note] 
><span data-ttu-id="2e6d7-170">Оригинальный MD4-хэш не передается в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-170">The original MD4 hash is not transmitted to Azure AD.</span></span> <span data-ttu-id="2e6d7-171">Вместо этого передается SHA256-хэш от оригинального MD4-хэша.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-171">Instead, the SHA256 hash of the original MD4 hash is transmitted.</span></span> <span data-ttu-id="2e6d7-172">Это означает, что хранимый в Azure AD хэш невозможно использовать для атаки Pass-the-Hash на локальную систему, даже если удастся его получить.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-172">As a result, if the hash stored in Azure AD is obtained, it cannot be used in an on-premises pass-the-hash attack.</span></span>

### <a name="how-password-synchronization-works-with-azure-active-directory-domain-services"></a><span data-ttu-id="2e6d7-173">Как работает синхронизация паролей с доменными службами Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="2e6d7-173">How password synchronization works with Azure Active Directory Domain Services</span></span>
<span data-ttu-id="2e6d7-174">Функцию синхронизации паролей можно использовать для синхронизации локальных паролей с [доменными службами Azure Active Directory](../../active-directory-domain-services/active-directory-ds-overview.md).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-174">You can also use the password synchronization feature to synchronize your on-premises passwords to [Azure Active Directory Domain Services](../../active-directory-domain-services/active-directory-ds-overview.md).</span></span> <span data-ttu-id="2e6d7-175">В этом сценарии доменная служба Azure AD выполняет аутентификацию пользователей в облаке, применяя все методы, доступные в локальном экземпляре Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-175">In this scenario, the Azure Active Directory Domain Services instance authenticates your users in the cloud with all the methods available in your on-premises Active Directory instance.</span></span> <span data-ttu-id="2e6d7-176">Действия в этом сценарии аналогичны использованию инструмента миграции Active Directory Migration Tool (ADMT) в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-176">The experience of this scenario is similar to using the Active Directory Migration Tool (ADMT) in an on-premises environment.</span></span>

### <a name="security-considerations"></a><span data-ttu-id="2e6d7-177">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="2e6d7-177">Security considerations</span></span>
<span data-ttu-id="2e6d7-178">При синхронизации пароли в текстовом формате не передаются в службу синхронизации паролей, Azure AD или какие-либо другие связанные службы.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-178">When synchronizing passwords, the plain-text version of your password is not exposed to the password synchronization feature, to Azure AD, or any of the associated services.</span></span>

<span data-ttu-id="2e6d7-179">Пользователь проходит аутентификацию в Azure AD, а не в корпоративном экземпляре Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-179">User authentication takes place against Azure AD rather than against the organization's own Active Directory instance.</span></span> <span data-ttu-id="2e6d7-180">Если в вашей организации строго относятся к передаче данных о пароле за ее пределы в любой форме, учтите, что хранимые в Azure AD данные о пароле (SHA256-хэш от исходного MD4-хэша) имеют существенно более высокий уровень безопасности, чем хранимые в Active Directory данные.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-180">If your organization has concerns about password data in any form leaving the premises, consider the fact that the SHA256 password data stored in Azure AD--a hash of the original MD4 hash--is significantly more secure than what is stored in Active Directory.</span></span> <span data-ttu-id="2e6d7-181">Кроме того, так как хэш SHA256 невозможно расшифровать, его невозможно вернуть в корпоративную среду Active Directory и представить в качестве действительного пароля пользователя в ходе атаки Pass-the-Hash.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-181">Further, because this SHA256 hash cannot be decrypted, it cannot be brought back to the organization's Active Directory environment and presented as a valid user password in a pass-the-hash attack.</span></span>





### <a name="password-policy-considerations"></a><span data-ttu-id="2e6d7-182">Рекомендации по политикам паролей</span><span class="sxs-lookup"><span data-stu-id="2e6d7-182">Password policy considerations</span></span>
<span data-ttu-id="2e6d7-183">Есть два типа политик паролей, которые затрагивает синхронизация паролей:</span><span class="sxs-lookup"><span data-stu-id="2e6d7-183">There are two types of password policies that are affected by enabling password synchronization:</span></span>

* <span data-ttu-id="2e6d7-184">политика сложности паролей;</span><span class="sxs-lookup"><span data-stu-id="2e6d7-184">Password complexity policy</span></span>
* <span data-ttu-id="2e6d7-185">политика срока действия паролей.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-185">Password expiration policy</span></span>

#### <a name="password-complexity-policy"></a><span data-ttu-id="2e6d7-186">Политика сложности паролей</span><span class="sxs-lookup"><span data-stu-id="2e6d7-186">Password complexity policy</span></span>  
<span data-ttu-id="2e6d7-187">Если используется синхронизация паролей, настроенные в локальном экземпляре Active Directory политики сложности паролей переопределяют политики сложности, настроенные в облаке для синхронизированных пользователей.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-187">When password synchronization is enabled, the password complexity policies in your on-premises Active Directory instance override complexity policies in the cloud for synchronized users.</span></span> <span data-ttu-id="2e6d7-188">Все допустимые пароли из локального экземпляра Active Directory можно использовать для доступа к службам Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-188">You can use all of the valid passwords from your on-premises Active Directory instance to access Azure AD services.</span></span>

> [!NOTE]
> <span data-ttu-id="2e6d7-189">Пароли пользователей, созданные непосредственно в облаке, и впредь регулируются политиками паролей, которые настроены в облаке.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-189">Passwords for users that are created directly in the cloud are still subject to password policies as defined in the cloud.</span></span>

#### <a name="password-expiration-policy"></a><span data-ttu-id="2e6d7-190">политика срока действия паролей.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-190">Password expiration policy</span></span>  
<span data-ttu-id="2e6d7-191">Если пароль пользователя синхронизируется, для пароля облачной учетной записи устанавливается*неограниченный срок действия*.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-191">If a user is in the scope of password synchronization, the cloud account password is set to *Never Expire*.</span></span>

<span data-ttu-id="2e6d7-192">Даже если срок действия синхронизируемого пароля в локальной среде истек, его можно использовать для входа в облачные службы.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-192">You can continue to sign in to your cloud services by using a synchronized password that is expired in your on-premises environment.</span></span> <span data-ttu-id="2e6d7-193">Пароль для облачной учетной записи изменяется, когда вы изменяете пароль в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-193">Your cloud password is updated the next time you change the password in the on-premises environment.</span></span>

#### <a name="account-expiration"></a><span data-ttu-id="2e6d7-194">Срок действия учетной записи</span><span class="sxs-lookup"><span data-stu-id="2e6d7-194">Account expiration</span></span>
<span data-ttu-id="2e6d7-195">Если в вашей организация используется атрибут accountExpires для управления учетными записями пользователей, учтите, что этот атрибут не синхронизируется с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-195">If your organization uses the accountExpires attribute as part of user account management, be aware that this attribute is not synchronized to Azure AD.</span></span> <span data-ttu-id="2e6d7-196">В результате учетная запись Active Directory будет всегда активной в Azure AD, даже если срок ее действия истек в той среде, где настроена синхронизация паролей.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-196">As a result, an expired Active Directory account in an environment configured for password synchronization will still be active in Azure AD.</span></span> <span data-ttu-id="2e6d7-197">Мы рекомендуем внедрить рабочий процесс, который при истечении срока действия учетной записи будет активировать сценарий PowerShell, отключающий учетную запись пользователя в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-197">We recommend that if the account is expired, a workflow action should trigger a PowerShell script that disables the user's Azure AD account.</span></span> <span data-ttu-id="2e6d7-198">И наоборот, при включении учетной записи нужно отдельно включать ее в экземпляре Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-198">Conversely, when the account is turned on, the Azure AD instance should be turned on.</span></span>

### <a name="overwrite-synchronized-passwords"></a><span data-ttu-id="2e6d7-199">Перезапись синхронизированных паролей</span><span class="sxs-lookup"><span data-stu-id="2e6d7-199">Overwrite synchronized passwords</span></span>
<span data-ttu-id="2e6d7-200">Администратор может вручную сбросить пароль с помощью Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-200">An administrator can manually reset your password by using Windows PowerShell.</span></span>

<span data-ttu-id="2e6d7-201">В таком случае новый пароль перезапишет синхронизированный пароль и к новому паролю будут применены все политики паролей, настроенные в облаке.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-201">In this case, the new password overrides your synchronized password, and all password policies defined in the cloud are applied to the new password.</span></span>

<span data-ttu-id="2e6d7-202">Если после этого вы измените локальный пароль, новый пароль синхронизируется в облако и перезапишет пароль, измененный вручную.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-202">If you change your on-premises password again, the new password is synchronized to the cloud, and it overrides the manually updated password.</span></span>

<span data-ttu-id="2e6d7-203">Синхронизация пароля не влияет на вошедших в систему пользователей Azure.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-203">The synchronization of a password has no impact on the Azure user who is signed in.</span></span> <span data-ttu-id="2e6d7-204">Если изменение пароля синхронизируется, когда вы вошли в облачную службу, это не повлияет на открытый сеанс связи с облачной службой.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-204">Your current cloud service session is not immediately affected by a synchronized password change that occurs while you're signed in to a cloud service.</span></span> <span data-ttu-id="2e6d7-205">Функция "Оставаться в системе" продлевает срок действия такого расхождения.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-205">KMSI extends the duration of this difference.</span></span> <span data-ttu-id="2e6d7-206">Когда снова возникнет необходимость в аутентификации в облачной службе, потребуется указать новый пароль.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-206">When the cloud service requires you to authenticate again, you need to provide your new password.</span></span>

### <a name="additional-advantages"></a><span data-ttu-id="2e6d7-207">Дополнительные преимущества</span><span class="sxs-lookup"><span data-stu-id="2e6d7-207">Additional advantages</span></span>

- <span data-ttu-id="2e6d7-208">Как правило, синхронизацию паролей реализовать проще, чем службу федерации.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-208">Generally, password synchronization is simpler to implement than a federation service.</span></span> <span data-ttu-id="2e6d7-209">Для этого не требуются дополнительные серверы и высокая доступность, которая важна при аутентификации пользователей в службе федерации.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-209">It doesn't require any additional servers, and eliminates dependence on a highly available federation service to authenticate users.</span></span> 
- <span data-ttu-id="2e6d7-210">Кроме того, синхронизацию паролей можно использовать параллельно с федерацией.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-210">Password synchronization can also be enabled in addition to federation.</span></span> <span data-ttu-id="2e6d7-211">Это будет хорошим резервным механизмом на случай сбоя службы федерации.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-211">It may be used as a fallback if your federation service experiences an outage.</span></span>












## <a name="enable-password-synchronization"></a><span data-ttu-id="2e6d7-212">Включение синхронизации паролей</span><span class="sxs-lookup"><span data-stu-id="2e6d7-212">Enable password synchronization</span></span>
<span data-ttu-id="2e6d7-213">Если для установки Azure AD Connect вы используете **стандартные параметры**, синхронизация паролей включается по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-213">When you install Azure AD Connect by using the **Express Settings** option, password synchronization is automatically enabled.</span></span> <span data-ttu-id="2e6d7-214">Дополнительные сведения см. в статье [Приступая к работе с Azure AD Connect с использованием стандартных параметров](active-directory-aadconnect-get-started-express.md).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-214">For more details, see [Getting started with Azure AD Connect using express settings](active-directory-aadconnect-get-started-express.md).</span></span>

<span data-ttu-id="2e6d7-215">Если для установки Azure AD Connect вы используете пользовательские параметры, синхронизацию паролей нужно включить на странице входа в систему.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-215">If you use custom settings when you install Azure AD Connect, password synchronization is available on the user sign-in page.</span></span> <span data-ttu-id="2e6d7-216">Дополнительные сведения см. в статье [Выборочная установка Azure AD Connect](active-directory-aadconnect-get-started-custom.md).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-216">For more details, see [Custom installation of Azure AD Connect](active-directory-aadconnect-get-started-custom.md).</span></span>

![Включение синхронизации паролей](./media/active-directory-aadconnectsync-implement-password-synchronization/usersignin.png)

### <a name="password-synchronization-and-fips"></a><span data-ttu-id="2e6d7-218">Синхронизация паролей и FIPS</span><span class="sxs-lookup"><span data-stu-id="2e6d7-218">Password synchronization and FIPS</span></span>
<span data-ttu-id="2e6d7-219">Если сервер блокируется в соответствии с федеральным стандартом обработки информации (FIPS), схема MD5 отключается.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-219">If your server has been locked down according to Federal Information Processing Standard (FIPS), then MD5 is disabled.</span></span>

<span data-ttu-id="2e6d7-220">**Чтобы включить MD5 для синхронизации паролей выполните следующие действия.**</span><span class="sxs-lookup"><span data-stu-id="2e6d7-220">**To enable MD5 for password synchronization, perform the following steps:**</span></span>

1. <span data-ttu-id="2e6d7-221">Перейдите к папке %programfiles%\Azure AD Sync\Bin.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-221">Go to %programfiles%\Azure AD Sync\Bin.</span></span>
2. <span data-ttu-id="2e6d7-222">Откройте файл miiserver.exe.config.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-222">Open miiserver.exe.config.</span></span>
3. <span data-ttu-id="2e6d7-223">Перейдите к узлу конфигурации или среды выполнения (в конце файла конфигурации).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-223">Go to the configuration/runtime node at the end of the file.</span></span>
4. <span data-ttu-id="2e6d7-224">Добавьте следующий узел: `<enforceFIPSPolicy enabled="false"/>`</span><span class="sxs-lookup"><span data-stu-id="2e6d7-224">Add the following node: `<enforceFIPSPolicy enabled="false"/>`</span></span>
5. <span data-ttu-id="2e6d7-225">Сохраните изменения.</span><span class="sxs-lookup"><span data-stu-id="2e6d7-225">Save your changes.</span></span>

<span data-ttu-id="2e6d7-226">Этот фрагмент должен выглядеть примерно так:</span><span class="sxs-lookup"><span data-stu-id="2e6d7-226">For reference, this snippet is what it should look like:</span></span>

```
    <configuration>
        <runtime>
            <enforceFIPSPolicy enabled="false"/>
        </runtime>
    </configuration>
```

<span data-ttu-id="2e6d7-227">Дополнительные сведения о безопасности и FIPS см. в записи блога [AAD Password Sync, Encryption and FIPS compliance](https://blogs.technet.microsoft.com/enterprisemobility/2014/06/28/aad-password-sync-encryption-and-fips-compliance/) (Синхронизация паролей, шифрование и соответствие FIPS в AAD).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-227">For information about security and FIPS, see [AAD Password Sync, encryption and FIPS compliance](https://blogs.technet.microsoft.com/enterprisemobility/2014/06/28/aad-password-sync-encryption-and-fips-compliance/).</span></span>

## <a name="troubleshoot-password-synchronization"></a><span data-ttu-id="2e6d7-228">Устранение неполадок с синхронизацией паролей</span><span class="sxs-lookup"><span data-stu-id="2e6d7-228">Troubleshoot password synchronization</span></span>
<span data-ttu-id="2e6d7-229">При возникновении проблем с синхронизацией паролей см. рекомендации в статье [Устранение неполадок синхронизации паролей с помощью службы синхронизации Azure AD Connect](active-directory-aadconnectsync-troubleshoot-password-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="2e6d7-229">If you have problems with password synchronization, see [Troubleshoot password synchronization](active-directory-aadconnectsync-troubleshoot-password-synchronization.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="2e6d7-230">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="2e6d7-230">Next steps</span></span>
* [<span data-ttu-id="2e6d7-231">Службы синхронизации Azure AD Connect: общие сведений о синхронизации и ее настройка</span><span class="sxs-lookup"><span data-stu-id="2e6d7-231">Azure AD Connect sync: Customizing synchronization options</span></span>](active-directory-aadconnectsync-whatis.md)
* [<span data-ttu-id="2e6d7-232">Интеграция локальных удостоверений с Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="2e6d7-232">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)
