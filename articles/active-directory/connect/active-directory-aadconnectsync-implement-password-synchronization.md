---
title: "Синхронизация паролей aaaImplement с Azure AD Connect sync | Документы Microsoft"
description: "Предоставляет сведения о, как работает синхронизация паролей и как tooset вверх."
services: active-directory
documentationcenter: 
author: MarkusVi
manager: femila
editor: 
ms.assetid: 05f16c3e-9d23-45dc-afca-3d0fa9dbf501
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: a0401640f2a4d914419ee4446f923bb3a972389d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="implement-password-synchronization-with-azure-ad-connect-sync"></a>Реализация синхронизации паролей с помощью Azure AD Connect Sync
Эта статья содержит сведения, необходимые toosynchronize пароли пользователей из локальной Active Directory экземпляр tooa облачного Azure Active Directory (Azure AD) экземпляра.

## <a name="what-is-password-synchronization"></a>Что такое синхронизация паролей
Hello вероятности, которые вы запретить выполнение задач из-за tooa забыт пароль связан номер toohello разные пароли должны tooremember. Здравствуйте, пароли должны tooremember hello выше hello вероятности tooforget один. Вопросы и вызовы о сбросах паролей и других проблем, связанных с паролем запросу hello больше всего ресурсов службы технической поддержки.

Синхронизация паролей — это функция используемых toosynchronize пароли пользователей из экземпляра локального экземпляра Active Directory tooa облачного Azure AD.
Используйте этот компонент toosign в tooAzure AD служб, таких как Office 365, Microsoft Intune, CRM Online и доменных служб Azure Active Directory (Azure AD DS). Войти в службе toohello с помощью hello использовать toosign в tooyour пароль локального экземпляра Active Directory.

![Что такое Azure AD Connect?](./media/active-directory-aadconnectsync-implement-password-synchronization/arch1.png)

Благодаря уменьшению числа hello пароли, вашим пользователям требуется toojust toomaintain один. Синхронизация паролей дает следующие преимущества.

* Повысить производительность hello пользователей.
* Снижение затрат на техническую поддержку.  

Кроме того Если вы решите toouse [федерации со службами федерации Active Directory (AD FS)](https://channel9.msdn.com/Series/Azure-Active-Directory-Videos-Demos/Configuring-AD-FS-for-user-sign-in-with-Azure-AD-Connect), то при необходимости можно настроить синхронизацию паролей в резервную копию в случае сбоя инфраструктуры AD FS.

Синхронизация паролей — функции синхронизации каталогов toohello расширения, реализуемых синхронизации Azure AD Connect. Синхронизация паролей toouse в вашей среде, необходимо:

* Установите Azure AD Connect.  
* Настройте синхронизацию каталогов между локальным экземпляром службы Active Directory и облачным экземпляром Azure Active Directory.
* Включите синхронизацию паролей.

Дополнительные сведения см. в статье [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).

> [!NOTE]
> Дополнительную информацию о настройке доменных служб Azure Active Directory для использования FIPS и синхронизации паролей, см. в разделе "Синхронизация паролей и FIPS" дальше в этой статье.
>
>

## <a name="how-password-synchronization-works"></a>Как работает синхронизация паролей
Hello доменные службы Active Directory сохраняет пароли в виде hello представления значение хэша hello фактические пароли пользователей. Хэш-значение является результатом необратимой математической функции (hello *хэш-алгоритм*). Отсутствует результирующий hello метод toorevert версии односторонняя функция toohello обычный текст пароля. Нельзя использовать toosign хэш пароля в tooyour локальной сети.

toosynchronize, пароль, Azure AD Connect sync Извлекает хэш пароля в из hello локальным экземпляром Active Directory. Обработка дополнительной безопасности применяется toohello хэш пароля, прежде чем он будет синхронизирован toohello службы проверки подлинности Azure Active Directory. Пароли синхронизируются для каждого пользователя отдельно и в хронологическом порядке.

Hello реальный поток данных процесса синхронизации пароля hello — примерно toohello синхронизации данных пользователя, таких как DisplayName или адреса электронной почты. Однако пароли синхронизируются чаще, чем окно синхронизации hello стандартного каталога для других атрибутов. процесс синхронизации паролей Hello выполняется каждые 2 минуты. Невозможно изменить частоту hello этого процесса. При синхронизации пароля, он переопределяет hello существующий пароль для облака.

Hello впервые включена функция синхронизации паролей hello, он выполняет начальную синхронизацию hello паролей всех пользователей в области видимости. Нельзя явно определять подмножество пароли пользователей, которые должны toosynchronize.

При изменении пароля с локальными hello обновить пароль будет синхронизирован, наиболее часто в течение нескольких минут.
Hello функция синхронизации паролей автоматически повторяет попытку синхронизации. При возникновении ошибки во время попытки toosynchronize пароль, ошибка записывается в журнал событий.

Синхронизация пароля Hello не оказывает влияния на пользователя hello, который подключен к сети.
Текущий сеанс облачной службы является изменение не затрагивает немедленно синхронизированным паролем при входе в облачной службе tooa. Тем не менее когда hello облачная служба требует tooauthenticate снова, вам нужно tooprovide новый пароль.

Пользователь должен ввести свои корпоративные учетные данные второй раз tooauthenticate tooAzure AD, независимо от того, вошли ли они в tootheir корпоративной сети. Эти шаблон можно свести к минимуму, тем не менее, если hello пользователь выбирает hello оставаться системе флажок (KMSI) при входе. Это действие создает для сеанса файл cookie, который на некоторое время позволяет обходить аутентификацию. KMSI поведения можно включить или отключить Здравствуйте, администратор Azure AD.

> [!NOTE]
> Синхронизация паролей поддерживается только для hello объекта типа пользователя в Active Directory. Не поддерживается для типа объекта iNetOrgPerson hello.

### <a name="detailed-description-of-how-password-synchronization-works"></a>Подробное описание принципа действия синхронизации паролей
Hello ниже приводится подробное описание и как работает синхронизация паролей между Active Directory и Azure AD.

![Подробная схема использования паролей](./media/active-directory-aadconnectsync-implement-password-synchronization/arch3.png)


1. Каждые две минуты hello агент синхронизации паролей на сервере подключение hello AD запрашивает хэши сохраненный пароль (hello атрибута unicodePwd) из контроллера домена через стандартные hello [MS DRSR](https://msdn.microsoft.com/library/cc228086.aspx) toosynchronize данных использовать протокол репликации между контроллерами доменов. Учетная запись службы Hello должен иметь репликация изменений каталога и репликацию каталогов все изменения AD хэши паролей hello tooobtain разрешения (по умолчанию при установке).
2. Перед отправкой, hello DC шифрует hello MD4 хэш пароля с помощью ключа, который является [MD5](http://www.rfc-editor.org/rfc/rfc1321.txt) хэш ключа сеанса RPC hello и соль. Агент синхронизации паролей toohello результат hello отправляется через RPC. Hello контроллера домена также передает агент синхронизации hello соли toohello по протоколу hello контроллера домена репликации, таким образом, агент hello может toodecrypt hello конверта.
3.  Получив зашифрованную оболочку hello, агент синхронизации паролей hello использует [MD5CryptoServiceProvider](https://msdn.microsoft.com/library/System.Security.Cryptography.MD5CryptoServiceProvider.aspx) и hello toogenerate соли ключа toodecrypt hello полученных задней tooits исходного MD4 формат данных. Ни на одном этапе агент синхронизации паролей hello имеет доступ toohello открытый пароль. Hello агент синхронизации паролей MD5 используется исключительно для совместимости протокола репликации с hello контроллера домена и он используется только на локальном компьютере между hello контроллера домена и агент синхронизации паролей hello.
4.  агент синхронизации паролей Hello расширяет байты too64 хэша пароля двоичные 16-байтовый hello, первый преобразование hello хэш tooa 32-разрядного шестнадцатеричную строку, а затем преобразование этой строки обратно в двоичный файл с кодировкой UTF-16.
5.  агент синхронизации паролей Hello добавляет соли, состоящий из 10 байт рассеивание, toohello 64-байтовое двоичное toofurther защиты hello оригинальный хэш-коды.
6.  агент синхронизации паролей Hello на основе хэша hello MD4 плюс соли и он получает на входе в hello [PBKDF2](https://www.ietf.org/rfc/rfc2898.txt) функции. 1000 итераций hello [HMAC-SHA256](https://msdn.microsoft.com/library/system.security.cryptography.hmacsha256.aspx) используется хэш-алгоритма с ключом. 
7.  агент синхронизации паролей Hello принимает hello результирующий хэш 32 байтам, объединяет оба соли hello и hello число tooit итераций SHA256 (для использования Azure AD), а затем передает строку hello из Azure AD Connect tooAzure AD по протоколу SSL.</br> 
8.  Когда пользователь пытается toosign в tooAzure AD и вводит свои пароль, пароль hello запуска с помощью hello же MD4 + соли + PBKDF2 + HMAC-SHA256 процесса. Если результирующий хэш hello соответствует хэш hello, сохраненные в Azure AD, hello пользователь ввел правильный пароль hello и проходит проверку подлинности. 

>[!Note] 
>Hello исходного MD4-хэширования не передано tooAzure AD. Вместо этого передается hello хэш SHA256 hello исходного MD4-хэширования. В результате Если получить хэш hello, сохраненные в Azure AD, он не может использоваться в локальные атаки pass--hash.

### <a name="how-password-synchronization-works-with-azure-active-directory-domain-services"></a>Как работает синхронизация паролей с доменными службами Azure Active Directory
Можно также использовать toosynchronize функция синхронизации паролей hello пароли локальных слишком[доменных служб Active Directory Azure](../../active-directory-domain-services/active-directory-ds-overview.md). В этом случае экземпляр hello доменных служб Active Directory Azure использует для проверки подлинности пользователей в облаке hello всех hello методов, доступных в вашем экземпляре в локальной среде Active Directory. взаимодействие Hello этого сценария — аналогично hello toousing средства миграции Active Directory (ADMT) в локальной среде.

### <a name="security-considerations"></a>Вопросы безопасности
При синхронизации паролей hello текстового версия ваш пароль не предоставляется toohello функция синхронизации паролей, tooAzure AD или любых связанных hello служб.

Проверка подлинности пользователя выполняется в Azure AD, а не с экземпляром службы каталогов Active Directory организации hello. Если у организации есть предложения по поводу пароль данных в формах, оставляя hello локальный, рассмотрите возможность hello фактов, hello SHA256 пароля данные, хранящиеся в Azure AD — хэш hello исходного MD4-хэширования--значительно более безопасную, чем того, что хранится в Active Directory. Кроме того так как не удается расшифровать этот хэш SHA256, не удается возвращены toohello корпоративную среду Active Directory и представлен в виде допустимого пользователя пароль во время атаки pass--hash.





### <a name="password-policy-considerations"></a>Рекомендации по политикам паролей
Есть два типа политик паролей, которые затрагивает синхронизация паролей:

* политика сложности паролей;
* политика срока действия паролей.

#### <a name="password-complexity-policy"></a>Политика сложности паролей  
При включении синхронизации паролей hello политика сложности паролей в локальный экземпляр Active Directory переопределения политики сложности в облаке hello для синхронизированных пользователей. Можно использовать все пароли допустимым hello из вашей локальной Active Directory экземпляр tooaccess служб Azure AD.

> [!NOTE]
> Пароли пользователей, созданные непосредственно в облаке hello по-прежнему являются политики toopassword субъекта, как определено в облаке hello.

#### <a name="password-expiration-policy"></a>политика срока действия паролей.  
Если пользователь входит в область hello синхронизации паролей, пароль учетной записи облачной hello устанавливается слишком*никогда не истекает*.

Вы можете продолжить toosign tooyour облачные службы с помощью синхронизированного пароля с истекшим сроком в локальной среде. Обновить пароль облака hello в следующий раз при смене пароля hello в локальной среде hello.

#### <a name="account-expiration"></a>Срок действия учетной записи
Если ваша организация использует атрибут accountExpires hello как часть управление учетными записями пользователей, имейте в виду, что этот атрибут не синхронизированные tooAzure AD. В результате учетная запись Active Directory будет всегда активной в Azure AD, даже если срок ее действия истек в той среде, где настроена синхронизация паролей. Рекомендуется, если истек срок действия учетной записи hello действия рабочего процесса должны запускать сценарий PowerShell, отключение учетной записи пользователя hello Azure AD. И наоборот при включении учетной записи hello hello экземпляра Azure AD должна быть включена.

### <a name="overwrite-synchronized-passwords"></a>Перезапись синхронизированных паролей
Администратор может вручную сбросить пароль с помощью Windows PowerShell.

В этом случае новый пароль hello переопределяет синхронизированный пароль, и все политики паролей, определенные в облаке hello, примененные toohello новый пароль.

Если снова изменить пароль локального hello новый пароль будет синхронизирован toohello облака и переопределяет hello вручную обновить пароль.

Синхронизация пароля Hello не оказывает влияния на hello Azure пользователю, вошедшему в систему. Текущий сеанс облачной службы является изменение не затрагивает немедленно синхронизированным паролем, имеет место, когда вы вошли в облачной службе tooa. KMSI расширяет hello длительность этого факта. Когда hello облачная служба требует tooauthenticate снова, вам нужно tooprovide новый пароль.

### <a name="additional-advantages"></a>Дополнительные преимущества

- Как правило синхронизация паролей — tooimplement проще, чем служба федерации. Он не требует дополнительные серверы и устраняет зависимость от пользователей tooauthenticate службы федерации высокой доступности. 
- Также можно включить синхронизацию паролей в toofederation сложения. Это будет хорошим резервным механизмом на случай сбоя службы федерации.












## <a name="enable-password-synchronization"></a>Включение синхронизации паролей
При установке Azure AD Connect с помощью hello **параметров Express** параметр, синхронизация паролей включается автоматически. Дополнительные сведения см. в статье [Приступая к работе с Azure AD Connect с использованием стандартных параметров](active-directory-aadconnect-get-started-express.md).

Если вы используете пользовательские параметры при установке Azure AD Connect, синхронизация паролей — доступны на странице входа в систему пользователя hello. Дополнительные сведения см. в статье [Выборочная установка Azure AD Connect](active-directory-aadconnect-get-started-custom.md).

![Включение синхронизации паролей](./media/active-directory-aadconnectsync-implement-password-synchronization/usersignin.png)

### <a name="password-synchronization-and-fips"></a>Синхронизация паролей и FIPS
Если сервер заблокирован в соответствии с tooFederal обработки информации Standard (FIPS), MD5 отключена.

**tooenable MD5 для синхронизации паролей, выполните следующие шаги hello.**

1. Go too%programfiles%\Azure AD sync\bin..
2. Откройте файл miiserver.exe.config.
3. Перейдите узел конфигурации или выполнения toohello конце hello hello файла.
4. Добавьте следующий узлом hello:`<enforceFIPSPolicy enabled="false"/>`
5. Сохраните изменения.

Этот фрагмент должен выглядеть примерно так:

```
    <configuration>
        <runtime>
            <enforceFIPSPolicy enabled="false"/>
        </runtime>
    </configuration>
```

Дополнительные сведения о безопасности и FIPS см. в записи блога [AAD Password Sync, Encryption and FIPS compliance](https://blogs.technet.microsoft.com/enterprisemobility/2014/06/28/aad-password-sync-encryption-and-fips-compliance/) (Синхронизация паролей, шифрование и соответствие FIPS в AAD).

## <a name="troubleshoot-password-synchronization"></a>Устранение неполадок с синхронизацией паролей
При возникновении проблем с синхронизацией паролей см. рекомендации в статье [Устранение неполадок синхронизации паролей с помощью службы синхронизации Azure AD Connect](active-directory-aadconnectsync-troubleshoot-password-synchronization.md).

## <a name="next-steps"></a>Дальнейшие действия
* [Службы синхронизации Azure AD Connect: общие сведений о синхронизации и ее настройка](active-directory-aadconnectsync-whatis.md)
* [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md)
