---
title: "Azure AD Connect: устранение неполадок с простым единым входом | Документы Майкрософт"
description: "Этот раздел описывает устранение неполадок с простым единым входом Azure Active Directory (Azure AD)."
services: active-directory
keywords: "что такое Azure AD Connect, установка Active Directory, необходимые компоненты для Azure AD, единый вход"
documentationcenter: 
author: swkrish
manager: femila
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/04/2017
ms.author: billmath
ms.openlocfilehash: bc4ff9125553c8918df3a1f84041560a5b7d4cd8
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="troubleshoot-azure-active-directory-seamless-single-sign-on"></a>Устранение неполадок с простым единым входом Azure Active Directory

Эта статья поможет вам найти информацию по вопросам относительно устранения неполадок с простым единым входом Azure AD.

## <a name="known-issues"></a>Известные проблемы

- При синхронизации 30 лесов AD и более простой единый вход через Azure AD Connect включить невозможно. Чтобы избежать этого, можно [вручную включить](#manual-reset-of-azure-ad-seamless-sso) эту функцию на своем клиенте.
- Добавление URL-адресов службы Azure AD (https://autologon.microsoftazuread-sso.com, https://aadg.windows.net.nsatc.net) в зону "Надежные сайты" вместо зоны "Местная интрасеть" **блокирует вход пользователей**.
- Простой единый вход не работает в конфиденциальном режиме просмотра в Firefox и Edge, а также в Internet Explorer при включенном режиме повышенной защиты.

>[!IMPORTANT]
>Мы недавно выполнили откат поддержки Edge, чтобы найти причину проблем, о которых сообщили клиенты.

## <a name="check-status-of-the-feature"></a>Проверка состояния функции

Убедитесь, что функция простого единого входа по-прежнему **включена** в клиенте. Можно проверить состояние, перейдя в колонку **Azure AD Connect** в [центре администрирования Azure Active Directory](https://aad.portal.azure.com/).

![Центр администрирования Active Directory Azure — колонка "Azure AD Connect"](./media/active-directory-aadconnect-sso/sso10.png)

## <a name="sign-in-failure-reasons-on-the-azure-active-directory-admin-center"></a>Причины сбоя единого входа в центре администрирования Azure Active Directory

Лучше всего начать поиск неполадок со входом пользователей при использовании простого единого входа — проверить [отчет о действиях при входе](../active-directory-reporting-activity-sign-ins.md) в [центре администрирования Azure Active Directory](https://aad.portal.azure.com/).

![Центр администрирования Azure Active Directory — отчет о действиях входа](./media/active-directory-aadconnect-sso/sso9.png)

Перейдите в раздел **Azure Active Directory** -> **Вход в систему** в [центре администрирования Azure Active Directory](https://aad.portal.azure.com/) и щелкните конкретное действие пользователя при входе. Найдите поле **КОД ОШИБКИ ВХОДА**. Сопоставьте значение этого поля c причиной сбоя и способом разрешения с помощью следующей таблицы:

|Код ошибки входа|Причина ошибки входа|Способы устранения:
| --- | --- | ---
| 81001 | Билет Kerberos пользователя слишком большой. | Сократите список членства пользователя в группах и повторите попытку.
| 81002 | Не удалось проверить билет Kerberos пользователя. | См. [Контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81003 | Не удалось проверить билет Kerberos пользователя. | См. [Контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81004 | Проверка подлинности Kerberos завершилась сбоем. | См. [Контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81008 | Не удалось проверить билет Kerberos пользователя. | См. [Контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81009 | "Не удалось проверить билет Kerberos пользователя. | См. [Контрольный список по устранению неполадок](#troubleshooting-checklist).
| 81010 | Не удалось выполнить простой единый вход, так как срок действия билета Kerberos пользователя истек или этот билет недопустим. | Пользователю следует войти с устройства, присоединенного к домену, в корпоративной сети.
| 81011 | Не удалось найти объект пользователя на основе сведений в билете Kerberos пользователя. | Используйте Azure AD Connect для синхронизации сведений о пользователе с Azure AD.
| 81012 | Пользователь, пытающийся войти в Azure AD, отличается от пользователя устройства. | Войдите с другого устройства.
| 81013 | Не удалось найти объект пользователя на основе сведений в билете Kerberos пользователя. |Используйте Azure AD Connect для синхронизации сведений о пользователе с Azure AD. 

## <a name="troubleshooting-checklist"></a>Контрольный список по устранению неполадок

Используйте следующий контрольный список для устранения неполадок простого единого входа.

- Проверьте, включена ли функция простого единого входа в Azure AD Connect. Если функцию не удается включить (например, из-за заблокированного порта), обеспечьте соблюдение всех [предварительных требований](active-directory-aadconnect-sso-quick-start.md#step-1-check-prerequisites).
- Оба URL-адреса службы Azure AD (https://autologon.microsoftazuread-sso.com и https://aadg.windows.net.nsatc.net) должны быть указаны в параметрах зоны интрасети пользователя.
- Убедитесь, что корпоративное устройство присоединено к домену AD.
- Убедитесь, что пользователь вошел на устройство по доменной учетной записи AD.
- Убедитесь, что учетная запись пользователя относится к лесу AD, где настроен простой единый вход.
- Убедитесь, что устройство подключено к корпоративной сети.
- Убедитесь, что время на устройстве синхронизировано с временем в Active Directory, и разница между временем контроллеров домена не превышает пяти минут.
- Перечислите существующие билеты Kerberos на устройстве с помощью команды **klist** из командной строки. Убедитесь в наличии билетов, выданных для учетной записи компьютера `AZUREADSSOACCT`. Билеты Kerberos пользователей обычно действительны в течение 12 часов. В вашем каталоге Active Directory могут быть заданы другие параметры.
- Удалите имеющиеся билеты Kerberos с устройства с помощью команды **klist purge** и повторите попытку.
- Чтобы определить наличие проблем, связанных с JavaScript, просмотрите журналы консоли из браузера (в разделе "Средства разработчика").
- Просмотрите также [Журналы контроллеров домена](#domain-controller-logs).

### <a name="domain-controller-logs"></a>Журналы контроллеров домена

Если на контроллере домена включен аудит успешных попыток, то каждый раз, когда пользователь входит в систему с использованием простого единого входа, в журнал событий заносится запись безопасности. Можно найти эти события безопасности с помощью следующего запроса (например, ищем событие **4769**, связанное с учетной записью компьютера **AzureADSSOAcc$**):

```
    <QueryList>
      <Query Id="0" Path="Security">
    <Select Path="Security">*[EventData[Data[@Name='ServiceName'] and (Data='AZUREADSSOACC$')]]</Select>
      </Query>
    </QueryList>
```

## <a name="manual-reset-of-the-feature"></a>Ручной сброс функции

Если устранение неполадок не помогло, можно сбросить вручную эту функцию на клиенте. Выполните следующие действия на локальном сервере, на котором выполняется Azure AD Connect:

### <a name="step-1-import-the-seamless-sso-powershell-module"></a>Шаг 1. Импортируйте модуль PowerShell для простого единого входа

1. Для начала скачайте и установите [помощник по входу в Microsoft Online Services](http://go.microsoft.com/fwlink/?LinkID=286152).
2. Затем скачайте и установите [64-разрядный модуль Azure Active Directory для Windows PowerShell](http://go.microsoft.com/fwlink/p/?linkid=236297).
3. Перейдите в папку `%programfiles%\Microsoft Azure Active Directory Connect`.
4. Импортируйте модуль PowerShell для простого единого входа с помощью следующей команды: `Import-Module .\AzureADSSO.psd1`.

### <a name="step-2-get-the-list-of-ad-forests-on-which-seamless-sso-has-been-enabled"></a>Шаг 2. Получение списка лесов AD, для которых включен простой единый вход

1. Запустите PowerShell от имени администратора. В PowerShell вызовите `New-AzureADSSOAuthenticationContext`. При запросе введите свои учетные данные глобального администратора клиента.
2. Вызовите `Get-AzureADSSOStatus`. Эта команда выводит список лесов AD (см. список "Домены"), в которых включена эта функция.

### <a name="step-3-disable-seamless-sso-for-each-ad-forest-that-it-was-set-it-up-on"></a>Шаг 3. Отключите простой единый вход для каждого леса AD, где он был настроен

1. Вызовите `$creds = Get-Credential`. При запросе введите свои учетные данные администратора домена для нужного леса AD.
2. Вызовите `Disable-AzureADSSOForest -OnPremCredentials $creds`. Эта команда удаляет учетную запись компьютера `AZUREADSSOACCT` с локального контроллера домена для конкретного леса AD.
3. Повторите предыдущие шаги для каждого леса AD, где настроена эта функция.

### <a name="step-4-enable-seamless-sso-for-each-ad-forest"></a>Шаг 4. Включение простого единого входа для каждого леса AD

1. Вызовите `Enable-AzureADSSOForest`. При запросе введите свои учетные данные администратора домена для нужного леса AD.
2. Повторите предыдущие шаги для каждого леса AD, где нужно настроить эту функцию.

### <a name="step-5-enable-the-feature-on-your-tenant"></a>Шаг 5. Включить функцию в своем клиенте

Вызовите `Enable-AzureADSSO` и введите "true" в командной строке `Enable: ` для включения функции в клиенте.
