---
title: "Синхронизация Azure AD Connect: планировщик | Документация Майкрософт"
description: "В этом разделе описывается встроенная функция планировщика синхронизации Azure AD Connect."
services: active-directory
documentationcenter: 
author: billmath
manager: mtillman
editor: 
ms.assetid: 6b1a598f-89c0-4244-9b20-f4aaad5233cf
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: df7b16157ccb47a5463570c3ed58b9c44f0b67d0
ms.sourcegitcommit: f1c1789f2f2502d683afaf5a2f46cc548c0dea50
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2018
---
# <a name="azure-ad-connect-sync-scheduler"></a>Синхронизация Azure AD Connect: планировщик
В этом разделе описывается встроенный планировщик синхронизации Azure AD Connect (модуль синхронизации).

Эта функция появилась в сборке 1.1.105.0 (выпущенной в феврале 2016 года).

## <a name="overview"></a>Обзор
Служба синхронизации Azure AD Connect синхронизирует изменения в вашем локальном каталоге, используя планировщик. Планировщики выполняют два процесса — один для синхронизации паролей, другой для синхронизации объектов или атрибутов и задач технического обслуживания. В этом разделе рассматривается второй процесс.

В более ранних версиях планировщик для объектов и атрибутов не входил в модуль синхронизации. Для запуска процесса синхронизации использовался планировщик заданий Windows или отдельная служба Windows. Сейчас в модуль синхронизации встроен планировщик версии 1.1, позволяющий настраивать определенные параметры. Новая частота синхронизации по умолчанию — 30 минут.

Планировщик отвечает за выполнение двух задач:

* **Цикл синхронизации**. Процесс импорта, синхронизации и экспорта изменений.
* **Задачи обслуживания**. Обновление ключей и сертификатов для сброса паролей и службы регистрации устройств (DRS). Удаление старых записей из журнала операций.

Сам планировщик работает всегда, но может быть настроен на выполнение только одной или ни одной из этих задач. Например, чтобы настроить собственный цикл синхронизации, вы можете отключить эту задачу в планировщике — при этом задача обслуживания будет выполняться по-прежнему.

## <a name="scheduler-configuration"></a>Конфигурация планировщика
Чтобы увидеть текущие параметры конфигурации, откройте PowerShell и выполните командлет `Get-ADSyncScheduler`. Отобразятся данные примерно следующего вида:

![GetSyncScheduler](./media/active-directory-aadconnectsync-feature-scheduler/getsynccyclesettings2016.png)

Если при запуске этого командлета отображается сообщение **The sync command or cmdlet is not available** (Команда синхронизации или командлет недоступны), то модуль PowerShell не загружается. Эта проблема может произойти при запуске Azure AD Connect на контроллере домена или на сервере с более высокими уровнями ограничений PowerShell, чем предусмотрено параметрами по умолчанию. Если отображается это сообщение об ошибке, выполните команду `Import-Module ADSync` , чтобы сделать командлет доступным.

* **AllowedSyncCycleInterval**. Самый короткий интервал времени между циклами синхронизации, разрешенный Azure AD. Более частная синхронизация не поддерживается.
* **CurrentlyEffectiveSyncCycleInterval**. Действующее на данный момент расписание. Если значение этого параметра не совпадает с параметром AllowedSyncInterval, оно будет таким же, как у параметра CustomizedSyncInterval (если он задан). При использовании сборки до версии 1.1.281 изменения параметра CustomizedSyncCycleInterval вступают в силу после следующего цикла синхронизации. Начиная со сборки версии 1.1.281 изменение вступает в силу немедленно.
* **CustomizedSyncCycleInterval**. Этот параметр позволяет настроить планировщик таким образом, чтобы синхронизация выполнялась чаще или реже, чем каждые 30 минут. На представленном выше снимке экрана планировщик настроен на ежечасное выполнение. Если значение этого параметра меньше, чем значение параметра AllowedSyncInterval, то используется последний.
* **NextSyncCyclePolicyType**. Изменение или исходное значение. Определяет, что будет происходить при следующем выполнении: только обработка изменений или полный импорт и синхронизация. Второй вариант также подразумевает повторную обработку всех новых и измененных правил.
* **NextSyncCycleStartTimeInUTC**. Время начала следующего цикла синхронизации.
* **PurgeRunHistoryInterval**. Срок хранения журнала операций. Проверить эти журналы можно в Synchronization Service Manager. По умолчанию они хранятся в течение 7 дней.
* **SyncCycleEnabled**. Указывает, если в рамках своей работы планировщик выполняется процессы импорта, синхронизации и экспорта.
* **MaintenanceEnabled**. Показывает, включен ли процесс обслуживания. Обновляет сертификаты и ключи и очищает журнал операций.
* **StagingModeEnabled**. Показано, включен ли [промежуточный режим](active-directory-aadconnectsync-operations.md#staging-mode) . Если включить этот параметр, то операции экспорта не будут выполняться, но по-прежнему будут выполняться операции импорта и синхронизации.
* **SchedulerSuspended**. Задается службой Connect во время обновления, чтобы временно блокировать выполнение планировщика.

Некоторые из этих параметров можно изменить с помощью `Set-ADSyncScheduler`. Можно изменить следующие параметры.

* CustomizedSyncCycleInterval
* NextSyncCyclePolicyType
* PurgeRunHistoryInterval
* SyncCycleEnabled
* MaintenanceEnabled

В предыдущих сборках Azure AD Connect параметр **isStagingModeEnabled** предоставлялся в командлете Set-ADSyncScheduler. Установка этого свойства **не поддерживается**. Свойство **SchedulerSuspended** следует изменять только с помощью Connect. Установка этого свойства напрямую через PowerShell **не поддерживается**.

Конфигурация планировщика хранится в Azure AD. Если используется промежуточный сервер, то любые изменения на сервере-источнике также отражаются на промежуточном сервере (кроме IsStagingModeEnabled).

### <a name="customizedsynccycleinterval"></a>CustomizedSyncCycleInterval
Синтаксис: `Set-ADSyncScheduler -CustomizedSyncCycleInterval d.HH:mm:ss`  
d — дни, HH — часы, mm — минуты, ss — секунды.

Пример: `Set-ADSyncScheduler -CustomizedSyncCycleInterval 03:00:00`  
Планировщик будет запускаться каждые 3 часа.

Пример: `Set-ADSyncScheduler -CustomizedSyncCycleInterval 1.0:0:0`  
Планировщик будет запускаться один раз в день.

### <a name="disable-the-scheduler"></a>Отключение планировщика  
Если в конфигурацию необходимо внести изменения, то следует отключить планировщик. Например, чтобы [настроить фильтрацию](active-directory-aadconnectsync-configure-filtering.md) или [внести изменения в правила синхронизации](active-directory-aadconnectsync-change-the-configuration.md).

Чтобы отключить планировщик, запустите `Set-ADSyncScheduler -SyncCycleEnabled $false`.

![Отключение планировщика](./media/active-directory-aadconnectsync-change-the-configuration/schedulerdisable.png)

После внесения изменений не забудьте снова включить планировщик с помощью `Set-ADSyncScheduler -SyncCycleEnabled $true`.

## <a name="start-the-scheduler"></a>Запуск планировщика
По умолчанию планировщик запускается каждые 30 минут. В некоторых случаях может потребоваться внеплановое выполнение цикла синхронизации или синхронизация другого типа.

**Цикл синхронизации изменений**  
Цикл синхронизации изменений включает следующие этапы:

* Импорт изменений во всех соединителях
* Синхронизация изменений во всех соединителях
* Экспорт во всех соединителях

Если вам необходимо срочно синхронизировать какое-то изменение, цикл синхронизации можно запустить вручную. Для этого используется следующий командлет PowerShell: `Start-ADSyncSyncCycle -PolicyType Delta`.

**Цикл полной синхронизации**  
. Цикл полной (первоначальной) синхронизации необходимо выполнять, если в конфигурацию внесено одно из следующих изменений:

* Добавление объектов или атрибутов для импорта из исходного каталога
* Изменения в правилах синхронизации
* Изменение [фильтрации](active-directory-aadconnectsync-configure-filtering.md), в результате которого изменяется число включаемых объектов.

Если вы внесли одно из таких изменений, выполните цикл полной синхронизации, чтобы модуль синхронизации смог заново согласовать пространства соединителей. Цикл полной синхронизации включает следующие этапы:

* Полный импорт во всех соединителях
* Полная синхронизация во всех соединителях
* Экспорт во всех соединителях

Чтобы запустить цикл полной синхронизации, в командной строке PowerShell выполните командлет `Start-ADSyncSyncCycle -PolicyType Initial` . Эта команда запускает цикл полной синхронизации.

## <a name="stop-the-scheduler"></a>Остановка планировщика
Бывает, что планировщик необходимо остановить в процессе выполнения цикла синхронизации. Это может потребоваться, например, если вы запустили мастер установки и получили следующую ошибку:

![SyncCycleRunningError](./media/active-directory-aadconnectsync-feature-scheduler/synccyclerunningerror.png)

Пока выполняется цикл синхронизации, вносить изменения в конфигурацию нельзя. Вы можете дождаться, пока планировщик завершит синхронизацию, или остановить его и внести изменения незамедлительно. Остановка текущего цикла не вредит системе, а внесенные изменения обрабатываются во время следующей синхронизации.

1. Чтобы остановить планировщик во время цикла синхронизации, используйте командлет PowerShell `Stop-ADSyncSyncCycle`.
2. При использовании сборки до версии 1.1.281 остановка планировщика не означает, что действующий соединитель прекратит выполнение своей текущей задачи. Чтобы принудительно остановить соединитель, выполните следующие действия. ![StopAConnector](./media/active-directory-aadconnectsync-feature-scheduler/stopaconnector.png)
   * Запустите **Synchronization Service** из меню "Пуск". Откройте **Соединители**, выделите соединитель с состоянием **Выполняется** и выберите в меню действий команду **Остановить**.

Планировщик останется активным и при первой возможности запустится снова.

## <a name="custom-scheduler"></a>Настраиваемый планировщик
Командлеты, описанные в этом разделе, доступны только в сборке [1.1.130.0](active-directory-aadconnect-version-history.md#111300) и более поздних версий.

Если встроенный планировщик не соответствует вашим требованиям, составить расписание для соединителей можно с помощью PowerShell.

### <a name="invoke-adsyncrunprofile"></a>Invoke-ADSyncRunProfile
Запустить профиль для соединителя можно таким образом:

```
Invoke-ADSyncRunProfile -ConnectorName "name of connector" -RunProfileName "name of profile"
```

[Имена соединителей](active-directory-aadconnectsync-service-manager-ui-connectors.md) и [имена профилей выполнения](active-directory-aadconnectsync-service-manager-ui-connectors.md#configure-run-profiles) можно найти в [пользовательском интерфейсе Synchronization Service Manager](active-directory-aadconnectsync-service-manager-ui.md).

![Вызов профиля выполнения](./media/active-directory-aadconnectsync-feature-scheduler/invokerunprofile.png)  

Командлет `Invoke-ADSyncRunProfile` является синхронным, т. е. он не возвращает управление до тех пор, пока соединитель не завершит операцию, успешно или с ошибкой.

При создании расписания для соединителей рекомендуется запланировать их в следующем порядке:

1. (полная/изменения) импорт из локальных каталогов, например Active Directory;
2. (полная/изменения) импорт из Azure AD;
3. (полная/изменения) синхронизация из локальных каталогов, например Active Directory;
4. (полная/изменения) синхронизация из Azure AD;
5. экспорт в Azure AD;
6. экспорт в локальные каталоги, например Active Directory.

Этот порядок определяет, в какой последовательности встроенный планировщик запускает соединители.

### <a name="get-adsyncconnectorrunstatus"></a>Get-ADSyncConnectorRunStatus
Вы также можете отслеживать работу модуля синхронизации (занят или бездействует). Этот командлет возвращает пустой результат, если модуль синхронизации бездействует и не запускает соединитель. Если соединитель выполняется, то он возвращает имя соединителя.

```
Get-ADSyncConnectorRunStatus
```

![Состояние выполнения соединителя](./media/active-directory-aadconnectsync-feature-scheduler/getconnectorrunstatus.png)  
На рисунке выше первая строка — из состояния, в котором модуль синхронизации бездействует. Вторая строка — из состояния, в котором соединитель Azure AD выполняется.

## <a name="scheduler-and-installation-wizard"></a>Планировщик и мастер установки
При запуске мастера установки планировщик приостанавливается. Это связано с тем, что вы можете внести изменения в конфигурацию, а во время активной работы модуля синхронизации их нельзя будет применить. Пока мастер установки открыт, модуль синхронизации не выполняет никаких действий по синхронизации.

## <a name="next-steps"></a>Дополнительная информация
Узнайте больше о настройке [службы синхронизации Azure AD Connect](active-directory-aadconnectsync-whatis.md) .

Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).
