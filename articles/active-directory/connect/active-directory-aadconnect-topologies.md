---
title: "Azure AD Connect: поддерживаемые топологии | Документация Майкрософт"
description: "В этой статье подробно описываются поддерживаемые и неподдерживаемые топологии Azure AD Connect."
services: active-directory
documentationcenter: 
author: AndKjell
manager: femila
editor: 
ms.assetid: 1034c000-59f2-4fc8-8137-2416fa5e4bfe
ms.service: active-directory
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: identity
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: d7af3a531bc1bcced1a3c48403a6f60afea0f82f
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="topologies-for-azure-ad-connect"></a><span data-ttu-id="bea5e-103">Топологии Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="bea5e-103">Topologies for Azure AD Connect</span></span>
<span data-ttu-id="bea5e-104">В этой статье описываются различные локальные топологии и топологии Active Directory Azure (Azure AD), в которых служба синхронизации Azure AD Connect используется в качестве основного решения интеграции.</span><span class="sxs-lookup"><span data-stu-id="bea5e-104">This article describes various on-premises and Azure Active Directory (Azure AD) topologies that use Azure AD Connect sync as the key integration solution.</span></span> <span data-ttu-id="bea5e-105">Здесь описываются и поддерживаемые, и неподдерживаемые конфигурации.</span><span class="sxs-lookup"><span data-stu-id="bea5e-105">This article includes both supported and unsupported configurations.</span></span>

<span data-ttu-id="bea5e-106">Ниже приведены условные обозначения для изображений в статье.</span><span class="sxs-lookup"><span data-stu-id="bea5e-106">Here's the legend for pictures in the article:</span></span>

| <span data-ttu-id="bea5e-107">Описание</span><span class="sxs-lookup"><span data-stu-id="bea5e-107">Description</span></span> | <span data-ttu-id="bea5e-108">Знак</span><span class="sxs-lookup"><span data-stu-id="bea5e-108">Symbol</span></span> |
| --- | --- |
| <span data-ttu-id="bea5e-109">Локальный лес Active Directory</span><span class="sxs-lookup"><span data-stu-id="bea5e-109">On-premises Active Directory forest</span></span> |![Локальный лес Active Directory](./media/active-directory-aadconnect-topologies/LegendAD1.png) |
| <span data-ttu-id="bea5e-111">Локальная служба Active Directory с фильтрацией импорта</span><span class="sxs-lookup"><span data-stu-id="bea5e-111">On-premises Active Directory with filtered import</span></span> |![Active Directory с фильтрацией импорта](./media/active-directory-aadconnect-topologies/LegendAD2.png) |
| <span data-ttu-id="bea5e-113">Сервер синхронизации Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="bea5e-113">Azure AD Connect sync server</span></span> |![Сервер синхронизации Azure AD Connect](./media/active-directory-aadconnect-topologies/LegendSync1.png) |
| <span data-ttu-id="bea5e-115">Промежуточный режим сервера синхронизации Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="bea5e-115">Azure AD Connect sync server “staging mode”</span></span> |![Промежуточный режим сервера синхронизации Azure AD Connect](./media/active-directory-aadconnect-topologies/LegendSync2.png) |
| <span data-ttu-id="bea5e-117">GALSync с Forefront Identity Manager (FIM) 2010 или Microsoft Identity Manager (MIM) 2016</span><span class="sxs-lookup"><span data-stu-id="bea5e-117">GALSync with Forefront Identity Manager (FIM) 2010 or Microsoft Identity Manager (MIM) 2016</span></span> |![GALSync с FIM 2010 или MIM 2016](./media/active-directory-aadconnect-topologies/LegendSync3.png) |
| <span data-ttu-id="bea5e-119">Сервер синхронизации Azure AD Connect, подробно</span><span class="sxs-lookup"><span data-stu-id="bea5e-119">Azure AD Connect sync server, detailed</span></span> |![Сервер синхронизации Azure AD Connect, подробно](./media/active-directory-aadconnect-topologies/LegendSync4.png) |
| <span data-ttu-id="bea5e-121">Azure AD</span><span class="sxs-lookup"><span data-stu-id="bea5e-121">Azure AD</span></span> |![Azure Active Directory](./media/active-directory-aadconnect-topologies/LegendAAD.png) |
| <span data-ttu-id="bea5e-123">Неподдерживаемый сценарий</span><span class="sxs-lookup"><span data-stu-id="bea5e-123">Unsupported scenario</span></span> |![Неподдерживаемый сценарий](./media/active-directory-aadconnect-topologies/LegendUnsupported.png) |

## <a name="single-forest-single-azure-ad-tenant"></a><span data-ttu-id="bea5e-125">Один лес, один клиент Azure AD</span><span class="sxs-lookup"><span data-stu-id="bea5e-125">Single forest, single Azure AD tenant</span></span>
![Топология для одного леса и одного клиента](./media/active-directory-aadconnect-topologies/SingleForestSingleDirectory.png)

<span data-ttu-id="bea5e-127">Стандартная топология — один локальный лес с одним или несколькими доменами и один клиент Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-127">The most common topology is a single on-premises forest, with one or multiple domains, and a single Azure AD tenant.</span></span> <span data-ttu-id="bea5e-128">Для проверки подлинности Azure AD используется синхронизация паролей.</span><span class="sxs-lookup"><span data-stu-id="bea5e-128">For Azure AD authentication, password synchronization is used.</span></span> <span data-ttu-id="bea5e-129">Экспресс-установка Azure AD Connect поддерживает только эту топологию.</span><span class="sxs-lookup"><span data-stu-id="bea5e-129">The express installation of Azure AD Connect supports only this topology.</span></span>

### <a name="single-forest-multiple-sync-servers-to-one-azure-ad-tenant"></a><span data-ttu-id="bea5e-130">Один лес, несколько серверов синхронизации в одном клиенте Azure AD</span><span class="sxs-lookup"><span data-stu-id="bea5e-130">Single forest, multiple sync servers to one Azure AD tenant</span></span>
![Неподдерживаемая отфильтрованная топология для одного леса](./media/active-directory-aadconnect-topologies/SingleForestFilteredUnsupported.png)

<span data-ttu-id="bea5e-132">Подключение нескольких серверов синхронизации Azure AD Connect (за исключением [промежуточного сервера](#staging-server)) к одному клиенту Azure AD не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="bea5e-132">Having multiple Azure AD Connect sync servers connected to the same Azure AD tenant is not supported, except for a [staging server](#staging-server).</span></span> <span data-ttu-id="bea5e-133">Такая схема не поддерживается, даже если эти серверы настроены для синхронизации с взаимоисключающим набором объектов.</span><span class="sxs-lookup"><span data-stu-id="bea5e-133">It's unsupported even if these servers are configured to synchronize with a mutually exclusive set of objects.</span></span> <span data-ttu-id="bea5e-134">Возможно, вы рассматривали такую топологию, если у вас нет доступа ко всем доменам леса с одного сервера или если требуется распределить нагрузку на несколько серверов.</span><span class="sxs-lookup"><span data-stu-id="bea5e-134">You might have considered this topology if you can't reach all domains in the forest from a single server, or if you want to distribute load across several servers.</span></span>

## <a name="multiple-forests-single-azure-ad-tenant"></a><span data-ttu-id="bea5e-135">Несколько лесов, один клиент Azure AD</span><span class="sxs-lookup"><span data-stu-id="bea5e-135">Multiple forests, single Azure AD tenant</span></span>
![Топология для нескольких лесов и одного клиента](./media/active-directory-aadconnect-topologies/MultiForestSingleDirectory.png)

<span data-ttu-id="bea5e-137">Во многих организациях есть среды, которые включают несколько локальных лесов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="bea5e-137">Many organizations have environments with multiple on-premises Active Directory forests.</span></span> <span data-ttu-id="bea5e-138">Есть разные причины существования нескольких локальных лесов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="bea5e-138">There are various reasons for having more than one on-premises Active Directory forest.</span></span> <span data-ttu-id="bea5e-139">Типичными примерами являются проекты с лесами ресурсов учетных записей и лесами, появившимися в результате слияния или поглощения.</span><span class="sxs-lookup"><span data-stu-id="bea5e-139">Typical examples are designs with account-resource forests and the result of a merger or acquisition.</span></span>

<span data-ttu-id="bea5e-140">Если у вас есть несколько лесов, все они должны быть доступными для одного сервера синхронизации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="bea5e-140">When you have multiple forests, all forests must be reachable by a single Azure AD Connect sync server.</span></span> <span data-ttu-id="bea5e-141">Присоединять этот сервер к домену не обязательно.</span><span class="sxs-lookup"><span data-stu-id="bea5e-141">You don't have to join the server to a domain.</span></span> <span data-ttu-id="bea5e-142">Если необходимо получить доступ ко всем лесам, можно разместить сервер в сети периметра (также называется DMZ и промежуточной подсетью).</span><span class="sxs-lookup"><span data-stu-id="bea5e-142">If necessary to reach all forests, you can place the server in a perimeter network (also known as DMZ, demilitarized zone, and screened subnet).</span></span>

<span data-ttu-id="bea5e-143">Мастер установки Azure AD Connect предлагает несколько вариантов консолидации пользователей, представленных в нескольких лесах.</span><span class="sxs-lookup"><span data-stu-id="bea5e-143">The Azure AD Connect installation wizard offers several options to consolidate users who are represented in multiple forests.</span></span> <span data-ttu-id="bea5e-144">Каждый пользователь должен быть представлен в Azure AD только один раз.</span><span class="sxs-lookup"><span data-stu-id="bea5e-144">The goal is that a user is represented only once in Azure AD.</span></span> <span data-ttu-id="bea5e-145">Есть несколько распространенных топологий, которые можно настроить в режиме выборочной установки в мастере установки.</span><span class="sxs-lookup"><span data-stu-id="bea5e-145">There are some common topologies that you can configure in the custom installation path in the installation wizard.</span></span> <span data-ttu-id="bea5e-146">На странице **Уникальная идентификация пользователей** выберите вариант, соответствующий вашей топологии.</span><span class="sxs-lookup"><span data-stu-id="bea5e-146">On the **Uniquely identifying your users** page, select the corresponding option that represents your topology.</span></span> <span data-ttu-id="bea5e-147">Функция консолидации настроена только для пользователей.</span><span class="sxs-lookup"><span data-stu-id="bea5e-147">The consolidation is configured only for users.</span></span> <span data-ttu-id="bea5e-148">В конфигурации по умолчанию дубликаты групп не консолидируются.</span><span class="sxs-lookup"><span data-stu-id="bea5e-148">Duplicated groups are not consolidated with the default configuration.</span></span>

<span data-ttu-id="bea5e-149">В следующем разделе описываются такие стандартные топологии, как [отдельные топологии](#multiple-forests-separate-topologies), [полная сетка](#multiple-forests-full-mesh-with-optional-galsync) и [топология ресурсов учетной записи](#multiple-forests-account-resource-forest).</span><span class="sxs-lookup"><span data-stu-id="bea5e-149">Common topologies are discussed in the sections about [separate topologies](#multiple-forests-separate-topologies), [full mesh](#multiple-forests-full-mesh-with-optional-galsync), and [the account-resource topology](#multiple-forests-account-resource-forest).</span></span>

<span data-ttu-id="bea5e-150">При стандартной конфигурации Azure AD Connect предполагается следующее.</span><span class="sxs-lookup"><span data-stu-id="bea5e-150">The default configuration in Azure AD Connect sync assumes:</span></span>

* <span data-ttu-id="bea5e-151">У каждого пользователя есть только одна включенная учетная запись. Лес, в котором располагается эта учетная запись, используется для проверки подлинности пользователя.</span><span class="sxs-lookup"><span data-stu-id="bea5e-151">Each user has only one enabled account, and the forest where this account is located is used to authenticate the user.</span></span> <span data-ttu-id="bea5e-152">Это предположение относится как к синхронизации паролей, так и к федерации.</span><span class="sxs-lookup"><span data-stu-id="bea5e-152">This assumption is for both password sync and federation.</span></span> <span data-ttu-id="bea5e-153">Параметры UserPrincipalName и sourceAnchor/immutableID поступают из этого леса.</span><span class="sxs-lookup"><span data-stu-id="bea5e-153">UserPrincipalName and sourceAnchor/immutableID come from this forest.</span></span>
* <span data-ttu-id="bea5e-154">У каждого пользователя есть только один почтовый ящик.</span><span class="sxs-lookup"><span data-stu-id="bea5e-154">Each user has only one mailbox.</span></span>
* <span data-ttu-id="bea5e-155">Лес, в котором размещаются почтовые ящики пользователей, характеризуется наилучшим качеством данных для атрибутов, отображаемых в глобальном списке адресов Exchange (GAL).</span><span class="sxs-lookup"><span data-stu-id="bea5e-155">The forest that hosts the mailbox for a user has the best data quality for attributes visible in the Exchange Global Address List (GAL).</span></span> <span data-ttu-id="bea5e-156">Если у пользователя нет почтового ящика, для передачи значений этих атрибутов может использоваться любой лес.</span><span class="sxs-lookup"><span data-stu-id="bea5e-156">If there's no mailbox for the user, any forest can be used to contribute these attribute values.</span></span>
* <span data-ttu-id="bea5e-157">Если у пользователя есть связанный почтовый ящик, то есть и другая учетная запись в другом лесу, которая используется для входа.</span><span class="sxs-lookup"><span data-stu-id="bea5e-157">If you have a linked mailbox, there's also an account in a different forest used for sign-in.</span></span>

<span data-ttu-id="bea5e-158">Если среда не соответствует этим предположениям, произойдет следующее:</span><span class="sxs-lookup"><span data-stu-id="bea5e-158">If your environment does not match these assumptions, the following things happen:</span></span>

* <span data-ttu-id="bea5e-159">Если у вас несколько активных учетных записей или несколько почтовых ящиков, модуль синхронизации выберет одну учетную запись или один почтовый ящик и проигнорирует остальные.</span><span class="sxs-lookup"><span data-stu-id="bea5e-159">If you have more than one active account or more than one mailbox, the sync engine picks one and ignores the other.</span></span>
* <span data-ttu-id="bea5e-160">Связанный почтовый ящик, для которого нет другой активной учетной записи, не будет экспортирован в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-160">A linked mailbox with no other active account is not exported to Azure AD.</span></span> <span data-ttu-id="bea5e-161">Учетная запись пользователя не будет представлена как член какой-либо группы.</span><span class="sxs-lookup"><span data-stu-id="bea5e-161">The user account is not represented as a member in any group.</span></span> <span data-ttu-id="bea5e-162">В DirSync связанный почтовый ящик всегда будет представлен как обычный почтовый ящик.</span><span class="sxs-lookup"><span data-stu-id="bea5e-162">A linked mailbox in DirSync is always represented as a normal mailbox.</span></span> <span data-ttu-id="bea5e-163">Такое отличие в поведении является намеренным и служит для поддержки различных сценариев леса.</span><span class="sxs-lookup"><span data-stu-id="bea5e-163">This change is intentionally a different behavior to better support multiple-forest scenarios.</span></span>

<span data-ttu-id="bea5e-164">Дополнительные сведения см. в статье [Службы синхронизации Azure AD Connect: рекомендации по изменению конфигурации по умолчанию](active-directory-aadconnectsync-understanding-default-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="bea5e-164">You can find more details in [Understanding the default configuration](active-directory-aadconnectsync-understanding-default-configuration.md).</span></span>

### <a name="multiple-forests-multiple-sync-servers-to-one-azure-ad-tenant"></a><span data-ttu-id="bea5e-165">Несколько лесов, несколько серверов синхронизации в одном клиенте Azure AD</span><span class="sxs-lookup"><span data-stu-id="bea5e-165">Multiple forests, multiple sync servers to one Azure AD tenant</span></span>
![Неподдерживаемая топология для нескольких лесов и нескольких серверов синхронизации](./media/active-directory-aadconnect-topologies/MultiForestMultiSyncUnsupported.png)

<span data-ttu-id="bea5e-167">Подключение нескольких серверов синхронизации Azure AD Connect к одному клиенту Azure AD не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="bea5e-167">Having more than one Azure AD Connect sync server connected to a single Azure AD tenant is not supported.</span></span> <span data-ttu-id="bea5e-168">В порядке исключения можно использовать [промежуточный сервер](#staging-server).</span><span class="sxs-lookup"><span data-stu-id="bea5e-168">The exception is the use of a [staging server](#staging-server).</span></span>

### <a name="multiple-forests-separate-topologies"></a><span data-ttu-id="bea5e-169">Несколько лесов, отдельные топологии</span><span class="sxs-lookup"><span data-stu-id="bea5e-169">Multiple forests, separate topologies</span></span>
![Параметр для представления пользователей во всех каталогах только один раз](./media/active-directory-aadconnect-topologies/MultiForestUsersOnce.png)

![Изображение нескольких лесов и отдельных топологий](./media/active-directory-aadconnect-topologies/MultiForestSeperateTopologies.png)

<span data-ttu-id="bea5e-172">В этой среде все локальные леса рассматриваются как отдельные сущности.</span><span class="sxs-lookup"><span data-stu-id="bea5e-172">In this environment, all on-premises forests are treated as separate entities.</span></span> <span data-ttu-id="bea5e-173">В любых других лесах пользователи отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="bea5e-173">No user is present in any other forest.</span></span> <span data-ttu-id="bea5e-174">У каждого леса есть своя организация Exchange. Синхронизация GALSync между лесами отсутствует.</span><span class="sxs-lookup"><span data-stu-id="bea5e-174">Each forest has its own Exchange organization, and there's no GALSync between the forests.</span></span> <span data-ttu-id="bea5e-175">Такая топология может возникать в результате слияний и поглощений, а также в организации, в которой все подразделения функционируют независимо.</span><span class="sxs-lookup"><span data-stu-id="bea5e-175">This topology might be the situation after a merger/acquisition or in an organization where each business unit operates independently.</span></span> <span data-ttu-id="bea5e-176">В Azure AD эти леса будут находиться в одной организации и отображаться в едином глобальном списке адресов.</span><span class="sxs-lookup"><span data-stu-id="bea5e-176">These forests are in the same organization in Azure AD and appear with a unified GAL.</span></span> <span data-ttu-id="bea5e-177">На предыдущем рисунке каждый объект в каждом лесу представлен в метавселенной в единственном экземпляре с объединением в целевом клиенте Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-177">In the preceding picture, each object in every forest is represented once in the metaverse and aggregated in the target Azure AD tenant.</span></span>

### <a name="multiple-forests-match-users"></a><span data-ttu-id="bea5e-178">Несколько лесов: сопоставление пользователей</span><span class="sxs-lookup"><span data-stu-id="bea5e-178">Multiple forests: match users</span></span>
<span data-ttu-id="bea5e-179">Для всех сценариев этого рода характерно то, что группы рассылки и группы безопасности могут состоять из пользователей, контактов и внешних субъектов безопасности.</span><span class="sxs-lookup"><span data-stu-id="bea5e-179">Common to all these scenarios is that distribution and security groups can contain a mix of users, contacts, and Foreign Security Principals (FSPs).</span></span> <span data-ttu-id="bea5e-180">Внешние участники безопасности используются в доменных службах Active Directory (AD DS) для представления элементов из других лесов в группе безопасности.</span><span class="sxs-lookup"><span data-stu-id="bea5e-180">FSPs are used in Active Directory Domain Services (AD DS) to represent members from other forests in a security group.</span></span> <span data-ttu-id="bea5e-181">Все внешние субъекты безопасности разрешаются в реальный объект в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-181">All FSPs are resolved to the real object in Azure AD.</span></span>

### <a name="multiple-forests-full-mesh-with-optional-galsync"></a><span data-ttu-id="bea5e-182">Несколько лесов: полная сетка с дополнительным решением GALSync</span><span class="sxs-lookup"><span data-stu-id="bea5e-182">Multiple forests: full mesh with optional GALSync</span></span>
![Параметр для использования атрибута почты для сопоставления в случае, когда удостоверения пользователей присутствуют в нескольких каталогах](./media/active-directory-aadconnect-topologies/MultiForestUsersMail.png)

![Топология полной сетки для нескольких лесов](./media/active-directory-aadconnect-topologies/MultiForestFullMesh.png)

<span data-ttu-id="bea5e-185">Топология полной сетки позволяет пользователям и ресурсам размещаться в любом лесу.</span><span class="sxs-lookup"><span data-stu-id="bea5e-185">A full mesh topology allows users and resources to be located in any forest.</span></span> <span data-ttu-id="bea5e-186">Как правило, между лесами образуются двусторонние отношения доверия.</span><span class="sxs-lookup"><span data-stu-id="bea5e-186">Commonly, there are two-way trusts between the forests.</span></span>

<span data-ttu-id="bea5e-187">Если Exchange присутствует в нескольких лесах, может быть доступным дополнительное локальное решение GALSync.</span><span class="sxs-lookup"><span data-stu-id="bea5e-187">If Exchange is present in more than one forest, there might be (optionally) an on-premises GALSync solution.</span></span> <span data-ttu-id="bea5e-188">Каждый пользователь будет представлен во всех остальных лесах как контакт.</span><span class="sxs-lookup"><span data-stu-id="bea5e-188">Every user is then represented as a contact in all other forests.</span></span> <span data-ttu-id="bea5e-189">GALSync часто реализуется через FIM 2010 или MIM 2016.</span><span class="sxs-lookup"><span data-stu-id="bea5e-189">GALSync is commonly implemented through FIM 2010 or MIM 2016.</span></span> <span data-ttu-id="bea5e-190">Azure AD Connect нельзя использовать в локальном решении GALSync.</span><span class="sxs-lookup"><span data-stu-id="bea5e-190">Azure AD Connect cannot be used for on-premises GALSync.</span></span>

<span data-ttu-id="bea5e-191">В этом сценарии объекты удостоверений соединяются с помощью атрибута почты.</span><span class="sxs-lookup"><span data-stu-id="bea5e-191">In this scenario, identity objects are joined via the mail attribute.</span></span> <span data-ttu-id="bea5e-192">Пользователь с почтовым ящиком в одном лесу объединяется с контактами в других лесах.</span><span class="sxs-lookup"><span data-stu-id="bea5e-192">A user who has a mailbox in one forest is joined with the contacts in the other forests.</span></span>

### <a name="multiple-forests-account-resource-forest"></a><span data-ttu-id="bea5e-193">Несколько лесов: лес ресурсов учетной записи</span><span class="sxs-lookup"><span data-stu-id="bea5e-193">Multiple forests: account-resource forest</span></span>
![Параметр для использования атрибутов ObjectSID и msExchMasterAccountSID для сопоставления, когда удостоверения присутствуют в нескольких каталогах](./media/active-directory-aadconnect-topologies/MultiForestUsersObjectSID.png)

![Топология леса ресурсов учетной записи для нескольких лесов](./media/active-directory-aadconnect-topologies/MultiForestAccountResource.png)

<span data-ttu-id="bea5e-196">В топологии леса ресурсов учетной записи есть один или несколько лесов *учетных записей* с активными учетными записями пользователей.</span><span class="sxs-lookup"><span data-stu-id="bea5e-196">In an account-resource forest topology, you have one or more *account* forests with active user accounts.</span></span> <span data-ttu-id="bea5e-197">Может также существовать один (или несколько) лес *ресурсов* с отключенными учетными записями.</span><span class="sxs-lookup"><span data-stu-id="bea5e-197">You also have one or more *resource* forests with disabled accounts.</span></span>

<span data-ttu-id="bea5e-198">В этом сценарии один (или несколько) лес ресурсов доверяет всем лесам учетных записей.</span><span class="sxs-lookup"><span data-stu-id="bea5e-198">In this scenario, one (or more) resource forest trusts all account forests.</span></span> <span data-ttu-id="bea5e-199">Обычно в лесу ресурсов используется расширенная схема Active Directory с Exchange и Lync.</span><span class="sxs-lookup"><span data-stu-id="bea5e-199">The resource forest typically has an extended Active Directory schema with Exchange and Lync.</span></span> <span data-ttu-id="bea5e-200">Все службы Exchange и Lync, а также другие общие службы находятся в этом лесу.</span><span class="sxs-lookup"><span data-stu-id="bea5e-200">All Exchange and Lync services, along with other shared services, are located in this forest.</span></span> <span data-ttu-id="bea5e-201">У пользователей есть отключенные учетные записи в этом лесу. С лесом учетных записей связан почтовый ящик.</span><span class="sxs-lookup"><span data-stu-id="bea5e-201">Users have a disabled user account in this forest, and the mailbox is linked to the account forest.</span></span>

## <a name="office-365-and-topology-considerations"></a><span data-ttu-id="bea5e-202">Аспекты топологии в Office 365.</span><span class="sxs-lookup"><span data-stu-id="bea5e-202">Office 365 and topology considerations</span></span>
<span data-ttu-id="bea5e-203">Некоторые рабочие нагрузки Office 365 налагают ряд ограничений на поддерживаемые топологии.</span><span class="sxs-lookup"><span data-stu-id="bea5e-203">Some Office 365 workloads have certain restrictions on supported topologies:</span></span>

| <span data-ttu-id="bea5e-204">Рабочая нагрузка</span><span class="sxs-lookup"><span data-stu-id="bea5e-204">Workload</span></span> | <span data-ttu-id="bea5e-205">Ограничения</span><span class="sxs-lookup"><span data-stu-id="bea5e-205">Restrictions</span></span> |
--------- | ---------
| <span data-ttu-id="bea5e-206">Exchange Online</span><span class="sxs-lookup"><span data-stu-id="bea5e-206">Exchange Online</span></span> | <span data-ttu-id="bea5e-207">Если есть несколько локальных организаций Exchange (сервер Exchange развернут для нескольких лесов), необходимо использовать Exchange 2013 с пакетом обновления 1 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="bea5e-207">If there's more than one on-premises Exchange organization (that is, Exchange has been deployed to more than one forest), you must use Exchange 2013 SP1 or later.</span></span> <span data-ttu-id="bea5e-208">Дополнительные сведения см. в статье [Гибридные развертывания в нескольких лесах Active Directory](https://technet.microsoft.com/library/jj873754.aspx).</span><span class="sxs-lookup"><span data-stu-id="bea5e-208">For more information, see [Hybrid deployments with multiple Active Directory forests](https://technet.microsoft.com/library/jj873754.aspx).</span></span> |
| <span data-ttu-id="bea5e-209">Skype для бизнеса</span><span class="sxs-lookup"><span data-stu-id="bea5e-209">Skype for Business</span></span> | <span data-ttu-id="bea5e-210">При использовании нескольких локальных лесов единственной поддерживаемой топологией является лес ресурсов учетной записи.</span><span class="sxs-lookup"><span data-stu-id="bea5e-210">When you're using multiple on-premises forests, only the account-resource forest topology is supported.</span></span> <span data-ttu-id="bea5e-211">Дополнительные сведения см. в статье [Требования к среде Skype для бизнеса Server 2015](https://technet.microsoft.com/library/dn933910.aspx).</span><span class="sxs-lookup"><span data-stu-id="bea5e-211">For more information, see [Environmental requirements for Skype for Business Server 2015](https://technet.microsoft.com/library/dn933910.aspx).</span></span> |


## <a name="staging-server"></a><span data-ttu-id="bea5e-212">промежуточного сервера</span><span class="sxs-lookup"><span data-stu-id="bea5e-212">Staging server</span></span>
![Промежуточный сервер в топологии](./media/active-directory-aadconnect-topologies/MultiForestStaging.png)

<span data-ttu-id="bea5e-214">Azure AD Connect поддерживает установку второго сервера в *промежуточном режиме*.</span><span class="sxs-lookup"><span data-stu-id="bea5e-214">Azure AD Connect supports installing a second server in *staging mode*.</span></span> <span data-ttu-id="bea5e-215">Сервер в этом режиме считывает данные из всех подключенных каталогов, но не записывает ничего в подключенные каталоги.</span><span class="sxs-lookup"><span data-stu-id="bea5e-215">A server in this mode reads data from all connected directories but does not write anything to connected directories.</span></span> <span data-ttu-id="bea5e-216">Он использует обычный цикл синхронизации и поэтому содержит обновленную копию данных удостоверения.</span><span class="sxs-lookup"><span data-stu-id="bea5e-216">It uses the normal synchronization cycle and therefore has an updated copy of the identity data.</span></span>

<span data-ttu-id="bea5e-217">При отказе основного сервера можно выполнить отработку отказа на промежуточный сервер.</span><span class="sxs-lookup"><span data-stu-id="bea5e-217">In a disaster where the primary server fails, you can fail over to the staging server.</span></span> <span data-ttu-id="bea5e-218">Это можно сделать в мастере Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="bea5e-218">You do this in the Azure AD Connect wizard.</span></span> <span data-ttu-id="bea5e-219">Второй сервер может находиться в другом центре обработки данных, так как он не делит инфраструктуру с основным сервером.</span><span class="sxs-lookup"><span data-stu-id="bea5e-219">This second server can be located in a different datacenter because no infrastructure is shared with the primary server.</span></span> <span data-ttu-id="bea5e-220">Любые изменения конфигурации основного сервера следует вручную копировать на второй сервер.</span><span class="sxs-lookup"><span data-stu-id="bea5e-220">You must manually copy any configuration change made on the primary server to the second server.</span></span>

<span data-ttu-id="bea5e-221">Вы можете использовать промежуточный сервер, чтобы проверить новую пользовательскую конфигурацию и узнать, как она повлияет на данные.</span><span class="sxs-lookup"><span data-stu-id="bea5e-221">You can use a staging server to test a new custom configuration and the effect that it has on your data.</span></span> <span data-ttu-id="bea5e-222">Вы можете просмотреть внесенные изменения и выполнить более точную настройку.</span><span class="sxs-lookup"><span data-stu-id="bea5e-222">You can preview the changes and adjust the configuration.</span></span> <span data-ttu-id="bea5e-223">Когда новая конфигурация будет завершена, вы сможете сделать промежуточный сервер активным и перевести старый сервер в промежуточный режим.</span><span class="sxs-lookup"><span data-stu-id="bea5e-223">When you're happy with the new configuration, you can make the staging server the active server and set the old active server to staging mode.</span></span>

<span data-ttu-id="bea5e-224">Этот метод также можно использовать для замены активного сервера синхронизации.</span><span class="sxs-lookup"><span data-stu-id="bea5e-224">You can also use this method to replace the active sync server.</span></span> <span data-ttu-id="bea5e-225">Подготовьте новый сервер и переведите его в промежуточный режим.</span><span class="sxs-lookup"><span data-stu-id="bea5e-225">Prepare the new server and set it to staging mode.</span></span> <span data-ttu-id="bea5e-226">Убедитесь, что он работает правильно, и отключите промежуточный режим (сервер станет активным). Завершите работу текущего сервера.</span><span class="sxs-lookup"><span data-stu-id="bea5e-226">Make sure it's in a good state, disable staging mode (making it active), and shut down the currently active server.</span></span>

<span data-ttu-id="bea5e-227">Чтобы иметь несколько резервных копий в разных центрах обработки данных, можно использовать несколько промежуточных серверов.</span><span class="sxs-lookup"><span data-stu-id="bea5e-227">It's possible to have more than one staging server when you want to have multiple backups in different datacenters.</span></span>

## <a name="multiple-azure-ad-tenants"></a><span data-ttu-id="bea5e-228">Множество клиентов Azure AD</span><span class="sxs-lookup"><span data-stu-id="bea5e-228">Multiple Azure AD tenants</span></span>
<span data-ttu-id="bea5e-229">Мы рекомендуем использовать один клиент в Azure AD для всей организации.</span><span class="sxs-lookup"><span data-stu-id="bea5e-229">We recommend having a single tenant in Azure AD for an organization.</span></span>
<span data-ttu-id="bea5e-230">Прежде чем использовать несколько клиентов Azure AD, ознакомьтесь со статьей [Управление административными единицами в Azure AD (общедоступной предварительной версии)](../active-directory-administrative-units-management.md).</span><span class="sxs-lookup"><span data-stu-id="bea5e-230">Before you plan to use multiple Azure AD tenants, see the article [Administrative units management in Azure AD](../active-directory-administrative-units-management.md).</span></span> <span data-ttu-id="bea5e-231">В ней описываются стандартные сценарии, в которых можно использовать один клиент.</span><span class="sxs-lookup"><span data-stu-id="bea5e-231">It covers common scenarios where you can use a single tenant.</span></span>

![Топология для нескольких лесов и нескольких клиентов](./media/active-directory-aadconnect-topologies/MultiForestMultiDirectory.png)

<span data-ttu-id="bea5e-233">Между сервером синхронизации Azure AD Connect и клиентом Azure AD устанавливается отношение 1:1.</span><span class="sxs-lookup"><span data-stu-id="bea5e-233">There's a 1:1 relationship between an Azure AD Connect sync server and an Azure AD tenant.</span></span> <span data-ttu-id="bea5e-234">Для каждого клиента Azure AD потребуется установить отдельный сервер синхронизации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="bea5e-234">For each Azure AD tenant, you need one Azure AD Connect sync server installation.</span></span> <span data-ttu-id="bea5e-235">Экземпляры клиента Azure AD являются изолированными по своей природе.</span><span class="sxs-lookup"><span data-stu-id="bea5e-235">The Azure AD tenant instances are isolated by design.</span></span> <span data-ttu-id="bea5e-236">Это значит, что пользователям в одном клиенте недоступны пользователи в другом клиенте.</span><span class="sxs-lookup"><span data-stu-id="bea5e-236">That is, users in one tenant can't see users in the other tenant.</span></span> <span data-ttu-id="bea5e-237">Если вам необходимо это разделение, это поддерживаемая конфигурация.</span><span class="sxs-lookup"><span data-stu-id="bea5e-237">If you want this separation, this is a supported configuration.</span></span> <span data-ttu-id="bea5e-238">В противном случае следует использовать модель одного клиента Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-238">Otherwise, you should use the single Azure AD tenant model.</span></span>

### <a name="each-object-only-once-in-an-azure-ad-tenant"></a><span data-ttu-id="bea5e-239">Каждый объект, повторяющийся только один раз в клиенте Azure AD</span><span class="sxs-lookup"><span data-stu-id="bea5e-239">Each object only once in an Azure AD tenant</span></span>
![Отфильтрованная топология для одного леса](./media/active-directory-aadconnect-topologies/SingleForestFiltered.png)

<span data-ttu-id="bea5e-241">В этой топологии один сервер синхронизации Azure AD Connect подключается к каждому клиенту Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-241">In this topology, one Azure AD Connect sync server is connected to each Azure AD tenant.</span></span> <span data-ttu-id="bea5e-242">На серверах синхронизации Azure AD Connect необходимо настроить правила фильтрации, чтобы они обрабатывали взаимоисключающие наборы объектов.</span><span class="sxs-lookup"><span data-stu-id="bea5e-242">The Azure AD Connect sync servers must be configured for filtering so that each has a mutually exclusive set of objects to operate on.</span></span> <span data-ttu-id="bea5e-243">Например, каждый сервер может обслуживать определенный домен или подразделение.</span><span class="sxs-lookup"><span data-stu-id="bea5e-243">You can, for example, scope each server to a particular domain or organizational unit.</span></span>

<span data-ttu-id="bea5e-244">Домен DNS может быть зарегистрирован только в одном клиенте Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-244">A DNS domain can be registered in only a single Azure AD tenant.</span></span> <span data-ttu-id="bea5e-245">Кроме того, имена участников-пользователей для локальных пользователей Active Directory должны располагаться в отдельных пространствах имен.</span><span class="sxs-lookup"><span data-stu-id="bea5e-245">The UPNs of the users in the on-premises Active Directory instance must also use separate namespaces.</span></span> <span data-ttu-id="bea5e-246">Например, на предыдущем рисунке в локальном экземпляре Active Directory регистрируется три отдельных суффикса имен участников-пользователей: contoso.com, fabrikam.com и wingtiptoys.com.</span><span class="sxs-lookup"><span data-stu-id="bea5e-246">For example, in the preceding picture, three separate UPN suffixes are registered in the on-premises Active Directory instance: contoso.com, fabrikam.com, and wingtiptoys.com.</span></span> <span data-ttu-id="bea5e-247">Пользователи каждого локального домена Active Directory используют различные пространства имен.</span><span class="sxs-lookup"><span data-stu-id="bea5e-247">The users in each on-premises Active Directory domain use a different namespace.</span></span>

<span data-ttu-id="bea5e-248">Между экземплярами клиентов Azure AD не применяется GALSync.</span><span class="sxs-lookup"><span data-stu-id="bea5e-248">There is no GALSync between the Azure AD tenant instances.</span></span> <span data-ttu-id="bea5e-249">В адресной книге в Exchange Online и Skype для бизнеса отображаются только пользователи из одного клиента.</span><span class="sxs-lookup"><span data-stu-id="bea5e-249">The address book in Exchange Online and Skype for Business shows only users in the same tenant.</span></span>

<span data-ttu-id="bea5e-250">Эта топология налагает следующие ограничения на сценарии, поддерживаемые в других случаях:</span><span class="sxs-lookup"><span data-stu-id="bea5e-250">This topology has the following restrictions on otherwise supported scenarios:</span></span>

* <span data-ttu-id="bea5e-251">гибридное развертывание Exchange с локальным экземпляром Active Directory можно включить только для одного клиента Azure AD;</span><span class="sxs-lookup"><span data-stu-id="bea5e-251">Only one of the Azure AD tenants can enable an Exchange hybrid with the on-premises Active Directory instance.</span></span>
* <span data-ttu-id="bea5e-252">устройство под управлением Windows 10 можно связать только с одним клиентом Azure AD;</span><span class="sxs-lookup"><span data-stu-id="bea5e-252">Windows 10 devices can be associated with only one Azure AD tenant.</span></span>
* <span data-ttu-id="bea5e-253">параметр единого входа для синхронизации пароля и сквозной проверки подлинности можно использовать только с одним клиентом Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-253">The single sign-on (SSO) option for password synchronization and pass-through authentication can be used with only one Azure AD tenant.</span></span>

<span data-ttu-id="bea5e-254">Требование относительно взаимоисключающих наборов объектов также применяется и к обратной записи.</span><span class="sxs-lookup"><span data-stu-id="bea5e-254">The requirement for a mutually exclusive set of objects also applies to writeback.</span></span> <span data-ttu-id="bea5e-255">Эта топология не будет поддерживать некоторые функции обратной записи, так как они предполагают наличие одной локальной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="bea5e-255">Some writeback features are not supported with this topology because they assume a single on-premises configuration.</span></span> <span data-ttu-id="bea5e-256">Эти функции включают в себя следующие:</span><span class="sxs-lookup"><span data-stu-id="bea5e-256">These features include:</span></span>

* <span data-ttu-id="bea5e-257">групповая обратная запись в конфигурации по умолчанию;</span><span class="sxs-lookup"><span data-stu-id="bea5e-257">Group writeback with default configuration.</span></span>
* <span data-ttu-id="bea5e-258">обратная запись устройств.</span><span class="sxs-lookup"><span data-stu-id="bea5e-258">Device writeback.</span></span>

### <a name="each-object-multiple-times-in-an-azure-ad-tenant"></a><span data-ttu-id="bea5e-259">Каждый объект, повторяющийся несколько раз в клиенте Azure AD</span><span class="sxs-lookup"><span data-stu-id="bea5e-259">Each object multiple times in an Azure AD tenant</span></span>
![Неподдерживаемая топология для одного леса и нескольких клиентов](./media/active-directory-aadconnect-topologies/SingleForestMultiDirectoryUnsupported.png) ![Неподдерживаемая топология для одного леса и нескольких соединителей](./media/active-directory-aadconnect-topologies/SingleForestMultiConnectorsUnsupported.png)

<span data-ttu-id="bea5e-262">Следующие задачи не поддерживаются:</span><span class="sxs-lookup"><span data-stu-id="bea5e-262">These tasks are unsupported:</span></span>

* <span data-ttu-id="bea5e-263">синхронизация одного пользователя с несколькими клиентами Azure AD;</span><span class="sxs-lookup"><span data-stu-id="bea5e-263">Sync the same user to multiple Azure AD tenants.</span></span>
* <span data-ttu-id="bea5e-264">изменение конфигурации таким образом, чтобы пользователи одного клиента Azure AD отображались в другом клиенте Azure AD как контакты;</span><span class="sxs-lookup"><span data-stu-id="bea5e-264">Make a configuration change so that users in one Azure AD tenant appear as contacts in another Azure AD tenant.</span></span>
* <span data-ttu-id="bea5e-265">изменение настройки службы синхронизации Azure AD Connect для подключения к нескольким клиентам Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-265">Modify Azure AD Connect sync to connect to multiple Azure AD tenants.</span></span>

### <a name="galsync-by-using-writeback"></a><span data-ttu-id="bea5e-266">Синхронизация GALSync с помощью обратной записи</span><span class="sxs-lookup"><span data-stu-id="bea5e-266">GALSync by using writeback</span></span>
![Неподдерживаемая топология для нескольких лесов и нескольких каталогов с синхронизацией GALSync, сфокусированной на Azure AD](./media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync1Unsupported.png) ![Неподдерживаемая топология для нескольких лесов и нескольких каталогов с синхронизацией GALSync, сфокусированной на локальном каталоге Active Directory](./media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync2Unsupported.png)

<span data-ttu-id="bea5e-269">Клиенты Azure AD являются изолированными по своей природе.</span><span class="sxs-lookup"><span data-stu-id="bea5e-269">Azure AD tenants are isolated by design.</span></span> <span data-ttu-id="bea5e-270">Следующие задачи не поддерживаются:</span><span class="sxs-lookup"><span data-stu-id="bea5e-270">These tasks are unsupported:</span></span>

* <span data-ttu-id="bea5e-271">изменение настройки службы синхронизации Azure AD Connect для чтения данных из другого клиента Azure AD;</span><span class="sxs-lookup"><span data-stu-id="bea5e-271">Change the configuration of Azure AD Connect sync to read data from another Azure AD tenant.</span></span>
* <span data-ttu-id="bea5e-272">экспорт пользователей как контакты в другой локальный экземпляр Active Directory с использованием службы синхронизации Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-272">Export users as contacts to another on-premises Active Directory instance by using Azure AD Connect sync.</span></span>

### <a name="galsync-with-on-premises-sync-server"></a><span data-ttu-id="bea5e-273">Синхронизация GALSync с локальным сервером синхронизации</span><span class="sxs-lookup"><span data-stu-id="bea5e-273">GALSync with on-premises sync server</span></span>
![Синхронизация GALSync в топологии для нескольких лесов и нескольких каталогов](./media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync.png)

<span data-ttu-id="bea5e-275">Для синхронизации пользователей (с помощью GALSync) между двумя организациями Exchange можно локально использовать FIM 2010 или MIM 2016.</span><span class="sxs-lookup"><span data-stu-id="bea5e-275">You can use FIM 2010 or MIM 2016 on-premises to sync users (via GALSync) between two Exchange organizations.</span></span> <span data-ttu-id="bea5e-276">Пользователи из одной организации будут отображаться в другой организации как внешние пользователи или контакты.</span><span class="sxs-lookup"><span data-stu-id="bea5e-276">The users in one organization appear as foreign users/contacts in the other organization.</span></span> <span data-ttu-id="bea5e-277">Затем эти локальные экземпляры Active Directory можно синхронизировать с их собственными клиентами Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bea5e-277">These different on-premises Active Directory instances can then be synchronized with their own Azure AD tenants.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bea5e-278">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="bea5e-278">Next steps</span></span>
<span data-ttu-id="bea5e-279">Больше об установке Azure AD Connect для этих сценариев можно узнать в статье [Выборочная установка Azure AD Connect](active-directory-aadconnect-get-started-custom.md).</span><span class="sxs-lookup"><span data-stu-id="bea5e-279">To learn how to install Azure AD Connect for these scenarios, see [Custom installation of Azure AD Connect](active-directory-aadconnect-get-started-custom.md).</span></span>

<span data-ttu-id="bea5e-280">Узнайте больше о настройке [службы синхронизации Azure AD Connect](active-directory-aadconnectsync-whatis.md) .</span><span class="sxs-lookup"><span data-stu-id="bea5e-280">Learn more about the [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) configuration.</span></span>

<span data-ttu-id="bea5e-281">Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="bea5e-281">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
