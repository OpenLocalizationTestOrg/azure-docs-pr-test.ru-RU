---
title: "Azure AD Connect: общие сведения о декларативной подготовке | Документация Майкрософт"
description: "В этой статье объясняется модель конфигурации декларативной подготовки в Azure AD Connect."
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: cfbb870d-be7d-47b3-ba01-9e78121f0067
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 7497ec2ca658c3790227c56ef1755d9a1cb74e0a
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-sync-understanding-declarative-provisioning"></a><span data-ttu-id="e911d-103">Служба синхронизации Azure AD Connect: общие сведения о декларативной подготовке</span><span class="sxs-lookup"><span data-stu-id="e911d-103">Azure AD Connect sync: Understanding Declarative Provisioning</span></span>
<span data-ttu-id="e911d-104">В этой статье объясняется используемая в Azure AD Connect модель конфигурации, именуемая декларативной подготовкой.</span><span class="sxs-lookup"><span data-stu-id="e911d-104">This topic explains the configuration model in Azure AD Connect.</span></span> <span data-ttu-id="e911d-105">Она позволяет без труда вносить изменения в конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="e911d-105">The model is called Declarative Provisioning and it allows you to make a configuration change with ease.</span></span> <span data-ttu-id="e911d-106">Некоторые сложные аспекты, описанные в этой статье, не предназначены для большинства клиентских сценариев.</span><span class="sxs-lookup"><span data-stu-id="e911d-106">Many things described in this topic are advanced and not required for most customer scenarios.</span></span>

## <a name="overview"></a><span data-ttu-id="e911d-107">Обзор</span><span class="sxs-lookup"><span data-stu-id="e911d-107">Overview</span></span>
<span data-ttu-id="e911d-108">Декларативная подготовка — это процесс обработки объектов, поступающих из подключенного к источнику каталога. Она определяет тип преобразования исходных объекта и атрибутов.</span><span class="sxs-lookup"><span data-stu-id="e911d-108">Declarative provisioning is processing objects coming in from a source connected directory and determines how the object and attributes should be transformed from a source to a target.</span></span> <span data-ttu-id="e911d-109">Обработка объекта выполняется в конвейере синхронизации. Этот конвейер одинаковый для входящих и исходящих правил.</span><span class="sxs-lookup"><span data-stu-id="e911d-109">An object is processed in a sync pipeline and the pipeline is the same for inbound and outbound rules.</span></span> <span data-ttu-id="e911d-110">Входящие правила поступают из пространства соединителя в метавселенную, а исходящие — наоборот.</span><span class="sxs-lookup"><span data-stu-id="e911d-110">An inbound rule is from a connector space to the metaverse and an outbound rule is from the metaverse to a connector space.</span></span>

![Конвейер синхронизации](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/sync1.png)  

<span data-ttu-id="e911d-112">Конвейер состоит из нескольких разных модулей,</span><span class="sxs-lookup"><span data-stu-id="e911d-112">The pipeline has several different modules.</span></span> <span data-ttu-id="e911d-113">каждый из которых отвечает за определенную концепцию в процессе синхронизации объекта.</span><span class="sxs-lookup"><span data-stu-id="e911d-113">Each one is responsible for one concept in object synchronization.</span></span>

![Конвейер синхронизации](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/pipeline.png)  

* <span data-ttu-id="e911d-115">Исходное пространство представляет исходный объект.</span><span class="sxs-lookup"><span data-stu-id="e911d-115">Source, The source object</span></span>
* <span data-ttu-id="e911d-116">[Область](#scope)— находит все правила синхронизации в области.</span><span class="sxs-lookup"><span data-stu-id="e911d-116">[Scope](#scope), Finds all sync rules that are in scope</span></span>
* <span data-ttu-id="e911d-117">[Объединение](#join)— определяет связь между пространством соединителя и метавселенной.</span><span class="sxs-lookup"><span data-stu-id="e911d-117">[Join](#join), Determines relationship between connector space and metaverse</span></span>
* <span data-ttu-id="e911d-118">[Преобразование](#transform)— вычисляет, как атрибуты должны быть преобразованы, и сам поток.</span><span class="sxs-lookup"><span data-stu-id="e911d-118">[Transform](#transform), Calculates how attributes should be transformed and flow</span></span>
* <span data-ttu-id="e911d-119">[Приоритет](#precedence)— разрешает конфликтующие изменения атрибута.</span><span class="sxs-lookup"><span data-stu-id="e911d-119">[Precedence](#precedence), Resolves conflicting attribute contributions</span></span>
* <span data-ttu-id="e911d-120">Целевое пространство представляет целевой объект.</span><span class="sxs-lookup"><span data-stu-id="e911d-120">Target, The target object</span></span>

## <a name="scope"></a><span data-ttu-id="e911d-121">Область</span><span class="sxs-lookup"><span data-stu-id="e911d-121">Scope</span></span>
<span data-ttu-id="e911d-122">Модуль области оценивает объект и определяет входящие в область правила, которые нужно включить в обработку.</span><span class="sxs-lookup"><span data-stu-id="e911d-122">The scope module is evaluating an object and determines the rules that are in scope and should be included in the processing.</span></span> <span data-ttu-id="e911d-123">В зависимости от значений атрибутов объекта в области вычисляются разные правила синхронизации.</span><span class="sxs-lookup"><span data-stu-id="e911d-123">Depending on the attributes values on the object, different sync rules are evaluated to be in scope.</span></span> <span data-ttu-id="e911d-124">Например, отключенный пользователь, у которого нет почтового ящика Exchange, и включенный пользователь, поддерживающий почту Exchange, имеют разные правила.</span><span class="sxs-lookup"><span data-stu-id="e911d-124">For example, a disabled user with no Exchange mailbox does have different rules than an enabled user with a mailbox.</span></span>  
![Область](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/scope1.png)  

<span data-ttu-id="e911d-126">Область определяется как набор групп и предложений.</span><span class="sxs-lookup"><span data-stu-id="e911d-126">The scope is defined as groups and clauses.</span></span> <span data-ttu-id="e911d-127">Предложения находятся внутри группы.</span><span class="sxs-lookup"><span data-stu-id="e911d-127">The clauses are inside a group.</span></span> <span data-ttu-id="e911d-128">Между всеми предложениями в группе используется логический оператор AND.</span><span class="sxs-lookup"><span data-stu-id="e911d-128">A logical AND is used between all clauses in a group.</span></span> <span data-ttu-id="e911d-129">Например, (department =IT AND country = Denmark).</span><span class="sxs-lookup"><span data-stu-id="e911d-129">For example, (department =IT AND country = Denmark).</span></span> <span data-ttu-id="e911d-130">Группы должны быть соединены логическим оператором OR.</span><span class="sxs-lookup"><span data-stu-id="e911d-130">A logical OR is used between groups.</span></span>

![Область](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/scope2.png)  
<span data-ttu-id="e911d-132">Область на этом рисунке должна читаться как (department = IT AND country = Denmark) OR (country=Sweden).</span><span class="sxs-lookup"><span data-stu-id="e911d-132">The scope in this picture should be read as (department = IT AND country = Denmark) OR (country=Sweden).</span></span> <span data-ttu-id="e911d-133">Если группа 1 или группа 2 принимает значение true, значит правило находится в области.</span><span class="sxs-lookup"><span data-stu-id="e911d-133">If either group 1 or group 2 is evaluated to true, then the rule is in scope.</span></span>

<span data-ttu-id="e911d-134">Модуль области поддерживает следующие операции.</span><span class="sxs-lookup"><span data-stu-id="e911d-134">The scope module supports the following operations.</span></span>

| <span data-ttu-id="e911d-135">Операция</span><span class="sxs-lookup"><span data-stu-id="e911d-135">Operation</span></span> | <span data-ttu-id="e911d-136">Описание</span><span class="sxs-lookup"><span data-stu-id="e911d-136">Description</span></span> |
| --- | --- |
| <span data-ttu-id="e911d-137">EQUAL, NOTEQUAL</span><span class="sxs-lookup"><span data-stu-id="e911d-137">EQUAL, NOTEQUAL</span></span> |<span data-ttu-id="e911d-138">Сравнение строк, в процессе которого вычисляется, совпадает ли значение со значением атрибута.</span><span class="sxs-lookup"><span data-stu-id="e911d-138">A string compare that evaluates if value is equal to the value in the attribute.</span></span> <span data-ttu-id="e911d-139">Для многозначных атрибутов см. операцию ISIN и ISNOTIN.</span><span class="sxs-lookup"><span data-stu-id="e911d-139">For multi-valued attributes, see ISIN and ISNOTIN.</span></span> |
| <span data-ttu-id="e911d-140">LESSTHAN, LESSTHAN_OR_EQUAL</span><span class="sxs-lookup"><span data-stu-id="e911d-140">LESSTHAN, LESSTHAN_OR_EQUAL</span></span> |<span data-ttu-id="e911d-141">Сравнение строк, в процессе которого вычисляется, меньше ли значение, чем значение атрибута.</span><span class="sxs-lookup"><span data-stu-id="e911d-141">A string compare that evaluates if value is less than of the value in the attribute.</span></span> |
| <span data-ttu-id="e911d-142">CONTAINS, NOTCONTAINS</span><span class="sxs-lookup"><span data-stu-id="e911d-142">CONTAINS, NOTCONTAINS</span></span> |<span data-ttu-id="e911d-143">Сравнение строк, в процессе которого вычисляется, присутствует ли значение в значении атрибута.</span><span class="sxs-lookup"><span data-stu-id="e911d-143">A string compare that evaluates if value can be found somewhere inside value in the attribute.</span></span> |
| <span data-ttu-id="e911d-144">STARTSWITH, NOTSTARTSWITH</span><span class="sxs-lookup"><span data-stu-id="e911d-144">STARTSWITH, NOTSTARTSWITH</span></span> |<span data-ttu-id="e911d-145">Сравнение строк, в процессе которого вычисляется, находится ли значение в начале значения атрибута.</span><span class="sxs-lookup"><span data-stu-id="e911d-145">A string compare that evaluates if value is in the beginning of the value in the attribute.</span></span> |
| <span data-ttu-id="e911d-146">ENDSWITH, NOTENDSWITH</span><span class="sxs-lookup"><span data-stu-id="e911d-146">ENDSWITH, NOTENDSWITH</span></span> |<span data-ttu-id="e911d-147">Сравнение строк, в процессе которого вычисляется, находится ли значение в конце значения атрибута.</span><span class="sxs-lookup"><span data-stu-id="e911d-147">A string compare that evaluates if value is in the end of the value in the attribute.</span></span> |
| <span data-ttu-id="e911d-148">GREATERTHAN, GREATERTHAN_OR_EQUAL</span><span class="sxs-lookup"><span data-stu-id="e911d-148">GREATERTHAN, GREATERTHAN_OR_EQUAL</span></span> |<span data-ttu-id="e911d-149">Сравнение строк, в процессе которого вычисляется, больше ли значение, чем значение атрибута.</span><span class="sxs-lookup"><span data-stu-id="e911d-149">A string compare that evaluates if value is greater than of the value in the attribute.</span></span> |
| <span data-ttu-id="e911d-150">ISNULL, ISNOTNULL</span><span class="sxs-lookup"><span data-stu-id="e911d-150">ISNULL, ISNOTNULL</span></span> |<span data-ttu-id="e911d-151">Вычисляет наличие атрибута в объекте.</span><span class="sxs-lookup"><span data-stu-id="e911d-151">Evaluates if the attribute is absent from the object.</span></span> <span data-ttu-id="e911d-152">Если атрибут отсутствует и, следовательно, имеет значение null, тогда правило находится в области.</span><span class="sxs-lookup"><span data-stu-id="e911d-152">If the attribute is not present and therefore null, then the rule is in scope.</span></span> |
| <span data-ttu-id="e911d-153">ISIN, ISNOTIN</span><span class="sxs-lookup"><span data-stu-id="e911d-153">ISIN, ISNOTIN</span></span> |<span data-ttu-id="e911d-154">Вычисляет наличие значения в определенном атрибуте.</span><span class="sxs-lookup"><span data-stu-id="e911d-154">Evaluates if the value is present in the defined attribute.</span></span> <span data-ttu-id="e911d-155">Эта операция является многозначным вариантом операции EQUAL и NOTEQUAL.</span><span class="sxs-lookup"><span data-stu-id="e911d-155">This operation is the multi-valued variation of EQUAL and NOTEQUAL.</span></span> <span data-ttu-id="e911d-156">Атрибут должен быть многозначным. Если в одно из значений атрибутов включено значение, значит правило находится в области.</span><span class="sxs-lookup"><span data-stu-id="e911d-156">The attribute is supposed to be a multi-valued attribute and if the value can be found in any of the attribute values, then the rule is in scope.</span></span> |
| <span data-ttu-id="e911d-157">ISBITSET, ISNOTBITSET</span><span class="sxs-lookup"><span data-stu-id="e911d-157">ISBITSET, ISNOTBITSET</span></span> |<span data-ttu-id="e911d-158">Вычисляет, является ли определенный бит набором.</span><span class="sxs-lookup"><span data-stu-id="e911d-158">Evaluates if a particular bit is set.</span></span> <span data-ttu-id="e911d-159">Например, эти операции можно использовать, чтобы проанализировать биты в атрибуте userAccountControl и определить, включен ли пользователь.</span><span class="sxs-lookup"><span data-stu-id="e911d-159">For example, can be used to evaluate the bits in userAccountControl to see if a user is enabled or disabled.</span></span> |
| <span data-ttu-id="e911d-160">ISMEMBEROF, ISNOTMEMBEROF</span><span class="sxs-lookup"><span data-stu-id="e911d-160">ISMEMBEROF, ISNOTMEMBEROF</span></span> |<span data-ttu-id="e911d-161">Значение должно содержать атрибут DN для группы в пространстве соединителя.</span><span class="sxs-lookup"><span data-stu-id="e911d-161">The value should contain a DN to a group in the connector space.</span></span> <span data-ttu-id="e911d-162">Если объект определен как участник группы, правило находится в области.</span><span class="sxs-lookup"><span data-stu-id="e911d-162">If the object is a member of the group specified, the rule is in scope.</span></span> |

## <a name="join"></a><span data-ttu-id="e911d-163">Объединение</span><span class="sxs-lookup"><span data-stu-id="e911d-163">Join</span></span>
<span data-ttu-id="e911d-164">Модуль объединения в конвейере синхронизации определяет, есть ли связь между объектом в исходном и целевом пространствах.</span><span class="sxs-lookup"><span data-stu-id="e911d-164">The join module in the sync pipeline is responsible for finding the relationship between the object in the source and an object in the target.</span></span> <span data-ttu-id="e911d-165">Во входящем правиле объект в пространстве соединителя ищет связь с объектом в метавселенной.</span><span class="sxs-lookup"><span data-stu-id="e911d-165">On an inbound rule, this relationship would be an object in a connector space finding a relationship to an object in the metaverse.</span></span>  
![Объединение объектов пространства соединителя и метавселенной](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/join1.png)  
<span data-ttu-id="e911d-167">Цель — определить наличие объекта, с которым должна быть установлена связь, в метавселенной, созданной другим соединителем.</span><span class="sxs-lookup"><span data-stu-id="e911d-167">The goal is to see if there is an object already in the metaverse, created by another Connector, it should be associated with.</span></span> <span data-ttu-id="e911d-168">Например, в лесу ресурсов учетной записи пользователь из леса учетных записей должен быть объединен с пользователем из леса ресурсов.</span><span class="sxs-lookup"><span data-stu-id="e911d-168">For example, in an account-resource forest the user from the account forest should be joined with the user from the resource forest.</span></span>

<span data-ttu-id="e911d-169">Обычно модули объединения используются во входящих правилах, чтобы объединить объекты пространства соединителя с таким же объектом метавселенной.</span><span class="sxs-lookup"><span data-stu-id="e911d-169">Joins are used mostly on inbound rules to join connector space objects together to the same metaverse object.</span></span>

<span data-ttu-id="e911d-170">Модули объединения определяются как одна или несколько групп.</span><span class="sxs-lookup"><span data-stu-id="e911d-170">The joins are defined as one or more groups.</span></span> <span data-ttu-id="e911d-171">Внутри группы находятся предложения.</span><span class="sxs-lookup"><span data-stu-id="e911d-171">Inside a group, you have clauses.</span></span> <span data-ttu-id="e911d-172">Между всеми предложениями в группе используется логический оператор AND.</span><span class="sxs-lookup"><span data-stu-id="e911d-172">A logical AND is used between all clauses in a group.</span></span> <span data-ttu-id="e911d-173">Группы должны быть соединены логическим оператором OR.</span><span class="sxs-lookup"><span data-stu-id="e911d-173">A logical OR is used between groups.</span></span> <span data-ttu-id="e911d-174">Эти группы обрабатываются в порядке сверху вниз.</span><span class="sxs-lookup"><span data-stu-id="e911d-174">The groups are processed in order from top to bottom.</span></span> <span data-ttu-id="e911d-175">Если группа обнаружила одно совпадение с объектом в целевом пространстве, оценка правил объединения останавливается.</span><span class="sxs-lookup"><span data-stu-id="e911d-175">When one group has found exactly one match with an object in the target, then no other join rules are evaluated.</span></span> <span data-ttu-id="e911d-176">Если совпадение не обнаружено или обнаружено несколько соответствующих объектов, выполняется обработка следующей группы правил.</span><span class="sxs-lookup"><span data-stu-id="e911d-176">If zero or more than one object is found, processing continues to the next group of rules.</span></span> <span data-ttu-id="e911d-177">По этой причине сначала необходимо создавать самые явные правила, а затем — менее четкие.</span><span class="sxs-lookup"><span data-stu-id="e911d-177">For this reason, the rules should be created in the order of most explicit first and more fuzzy at the end.</span></span>  
![Определение объединения](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/join2.png)  
<span data-ttu-id="e911d-179">На этом рисунке обработка соединений выполняется сверху вниз.</span><span class="sxs-lookup"><span data-stu-id="e911d-179">The joins in this picture are processed from top to bottom.</span></span> <span data-ttu-id="e911d-180">Сначала конвейер синхронизации выполняет поиск соответствий в атрибуте employeeID.</span><span class="sxs-lookup"><span data-stu-id="e911d-180">First the sync pipeline sees if there is a match on employeeID.</span></span> <span data-ttu-id="e911d-181">Если соответствия отсутствуют, второе правило определяет, можно ли использовать имя учетной записи для соединения объектов.</span><span class="sxs-lookup"><span data-stu-id="e911d-181">If not, the second rule sees if the account name can be used to join the objects together.</span></span> <span data-ttu-id="e911d-182">Если соответствия отсутствуют и в этом случае, третье и последнее правило выполняет поиск менее четких совпадений с помощью имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="e911d-182">If that is not a match either, the third and final rule is a more fuzzy match by using the name of user.</span></span>

<span data-ttu-id="e911d-183">Если вычислены все правила объединения и совпадений нет, то используется **тип связи** на странице **описания**.</span><span class="sxs-lookup"><span data-stu-id="e911d-183">If all join rules have been evaluated and there is not exactly one match, the **Link Type** on the **Description** page is used.</span></span> <span data-ttu-id="e911d-184">Если для этого параметра задано значение **Provision**, создается новый объект в целевом пространстве.</span><span class="sxs-lookup"><span data-stu-id="e911d-184">If this option is set to **Provision**, then a new object in the target is created.</span></span>  
<span data-ttu-id="e911d-185">![Подготовка или объединение](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/join3.png)</span><span class="sxs-lookup"><span data-stu-id="e911d-185">![Provision or join](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/join3.png)</span></span>  

<span data-ttu-id="e911d-186">Объект должен иметь только одно правило синхронизации с правилами объединения в области.</span><span class="sxs-lookup"><span data-stu-id="e911d-186">An object should only have one single sync rule with join rules in scope.</span></span> <span data-ttu-id="e911d-187">При наличии в объединении нескольких правил синхронизации возникает ошибка.</span><span class="sxs-lookup"><span data-stu-id="e911d-187">If there are multiple sync rules where join is defined, an error occurs.</span></span> <span data-ttu-id="e911d-188">Конфликты объединения нельзя решить на основании приоритета.</span><span class="sxs-lookup"><span data-stu-id="e911d-188">Precedence is not used to resolve join conflicts.</span></span> <span data-ttu-id="e911d-189">В области объект должен иметь одно правило объединения для атрибутов. Это позволит использовать один поток для входящего и исходящего направления.</span><span class="sxs-lookup"><span data-stu-id="e911d-189">An object must have a join rule in scope for attributes to flow with the same inbound/outbound direction.</span></span> <span data-ttu-id="e911d-190">Чтобы передать входящие и исходящие атрибуты в объект, необходимо иметь входящее и исходящее правило синхронизации для объединения.</span><span class="sxs-lookup"><span data-stu-id="e911d-190">If you need to flow attributes both inbound and outbound to the same object, you must have both an inbound and an outbound sync rule with join.</span></span>

<span data-ttu-id="e911d-191">При попытке подготовить объект в целевом пространстве соединителя исходящее правило объединения характеризуется определенным поведением.</span><span class="sxs-lookup"><span data-stu-id="e911d-191">Outbound join has a special behavior when it tries to provision an object to a target connector space.</span></span> <span data-ttu-id="e911d-192">Атрибут DN используется при первой попытке обратного объединения.</span><span class="sxs-lookup"><span data-stu-id="e911d-192">The DN attribute is used to first try a reverse-join.</span></span> <span data-ttu-id="e911d-193">Если в целевом пространстве соединителя уже есть объект с таким же атрибутом DN, объекты объединяются.</span><span class="sxs-lookup"><span data-stu-id="e911d-193">If there is already an object in the target connector space with the same DN, the objects are joined.</span></span>

<span data-ttu-id="e911d-194">Вычисление модуля объединения выполняется только один раз при вхождении в область нового правила синхронизации.</span><span class="sxs-lookup"><span data-stu-id="e911d-194">The join module is only evaluated once when a new sync rule comes into scope.</span></span> <span data-ttu-id="e911d-195">Объект не исключается из объединения, даже если он больше не соответствует условиям объединения.</span><span class="sxs-lookup"><span data-stu-id="e911d-195">When an object has joined, it is not disjoining even if the join criteria is no longer satisfied.</span></span> <span data-ttu-id="e911d-196">Чтобы исключить объект, правило синхронизации, используемое для объединения объектов, должно выйти из области.</span><span class="sxs-lookup"><span data-stu-id="e911d-196">If you want to disjoin an object, the sync rule that joined the objects must go out of scope.</span></span>

### <a name="metaverse-delete"></a><span data-ttu-id="e911d-197">Удаление метавселенной</span><span class="sxs-lookup"><span data-stu-id="e911d-197">Metaverse delete</span></span>
<span data-ttu-id="e911d-198">Объект метавселенной существует, пока в области остается одно правило синхронизации с **типом связи** **Provision** или **StickyJoin**.</span><span class="sxs-lookup"><span data-stu-id="e911d-198">A metaverse object remains as long as there is one sync rule in scope with **Link Type** set to **Provision** or **StickyJoin**.</span></span> <span data-ttu-id="e911d-199">Параметр StickyJoin используется, когда соединитель не может подготовить новый объект в метавселенной. Но после присоединения к другому объекту его необходимо удалить в исходном пространстве до удаления объекта в метавселенной.</span><span class="sxs-lookup"><span data-stu-id="e911d-199">A StickyJoin is used when a Connector is not allowed to provision a new object to the metaverse, but when it has joined, it must be deleted in the source before the metaverse object is deleted.</span></span>

<span data-ttu-id="e911d-200">Если объект метавселенной удаляется, все объекты, связанные с исходящим правилом синхронизации, отмеченные для **подготовки** , отмечаются для удаления.</span><span class="sxs-lookup"><span data-stu-id="e911d-200">When a metaverse object is deleted, all objects associated with an outbound sync rule marked for **provision** are marked for a delete.</span></span>

## <a name="transformations"></a><span data-ttu-id="e911d-201">Преобразования</span><span class="sxs-lookup"><span data-stu-id="e911d-201">Transformations</span></span>
<span data-ttu-id="e911d-202">В разделе преобразований определяются все потоки атрибутов из исходного пространства в целевое.</span><span class="sxs-lookup"><span data-stu-id="e911d-202">The transformations are used to define how attributes should flow from the source to the target.</span></span> <span data-ttu-id="e911d-203">Потоки могут быть следующих **типов**: "Прямой", "Константа" или "Выражение".</span><span class="sxs-lookup"><span data-stu-id="e911d-203">The flows can have one of the following **flow types**: Direct, Constant, or Expression.</span></span> <span data-ttu-id="e911d-204">Прямой поток передает значение атрибута без дополнительных изменений.</span><span class="sxs-lookup"><span data-stu-id="e911d-204">A direct flow, flows an attribute value as-is with no additional transformations.</span></span> <span data-ttu-id="e911d-205">Поток-константа передает определенное значение.</span><span class="sxs-lookup"><span data-stu-id="e911d-205">A constant value sets the specified value.</span></span> <span data-ttu-id="e911d-206">Поток-выражение использует язык выражений декларативной подготовки, чтобы определить тип преобразований.</span><span class="sxs-lookup"><span data-stu-id="e911d-206">An expression uses the declarative provisioning expression language to express how the transformation should be.</span></span> <span data-ttu-id="e911d-207">Дополнительные сведения о языке выражений см. в статье [Служба синхронизации Azure AD Connect: общие сведения о выражениях декларативной подготовки](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="e911d-207">The details for the expression language can be found in the [understanding declarative provisioning expression language](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md) topic.</span></span>

![Подготовка или объединение](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/transformations1.png)  

<span data-ttu-id="e911d-209">Флажок **Применить однократно** определяет, что атрибут должен быть задан только при первоначальном создании объекта.</span><span class="sxs-lookup"><span data-stu-id="e911d-209">The **Apply once** checkbox defines that the attribute should only be set when the object is initially created.</span></span> <span data-ttu-id="e911d-210">Например, эту конфигурацию можно использовать, чтобы задать первоначальный пароль для нового объекта-пользователя.</span><span class="sxs-lookup"><span data-stu-id="e911d-210">For example, this configuration can be used to set an initial password for a new user object.</span></span>

### <a name="merging-attribute-values"></a><span data-ttu-id="e911d-211">Объединение значений атрибутов</span><span class="sxs-lookup"><span data-stu-id="e911d-211">Merging attribute values</span></span>
<span data-ttu-id="e911d-212">В потоках атрибутов используется параметр, позволяющий определить, нужно ли объединять значения нескольких разных соединителей, чтобы получить многозначные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="e911d-212">In the attribute flows there is a setting to determine if multi-valued attributes should be merged from several different Connectors.</span></span> <span data-ttu-id="e911d-213">По умолчанию используется значение **Update**. Оно указывает, что главным считается правило синхронизации с наивысшим приоритетом.</span><span class="sxs-lookup"><span data-stu-id="e911d-213">The default value is **Update**, which indicates that the sync rule with highest precedence should win.</span></span>

![Типы объединения](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/mergetype.png)  

<span data-ttu-id="e911d-215">Кроме того, существуют и другие параметры, такие как **Merge** и **MergeCaseInsensitive**.</span><span class="sxs-lookup"><span data-stu-id="e911d-215">There is also **Merge** and **MergeCaseInsensitive**.</span></span> <span data-ttu-id="e911d-216">Они позволяют объединять значения из разных источников.</span><span class="sxs-lookup"><span data-stu-id="e911d-216">These options allow you to merge values from different sources.</span></span> <span data-ttu-id="e911d-217">Например, их можно использовать, чтобы объединить атрибут member или proxyAddresses из нескольких разных лесов.</span><span class="sxs-lookup"><span data-stu-id="e911d-217">For example, it can be used to merge the member or proxyAddresses attribute from several different forests.</span></span> <span data-ttu-id="e911d-218">Чтобы использовать этот параметр, у всех правил синхронизации в области объекта должен быть одинаковый тип объединения.</span><span class="sxs-lookup"><span data-stu-id="e911d-218">When you use this option, all sync rules in scope for an object must use the same merge type.</span></span> <span data-ttu-id="e911d-219">В одном соединителе нельзя определить значение **Update**, а в другом — **Merge**.</span><span class="sxs-lookup"><span data-stu-id="e911d-219">You cannot define **Update** from one Connector and **Merge** from another.</span></span> <span data-ttu-id="e911d-220">В этом случае возникнет ошибка.</span><span class="sxs-lookup"><span data-stu-id="e911d-220">If you try, you receive an error.</span></span>

<span data-ttu-id="e911d-221">Разница между параметрами **Merge** и **MergeCaseInsensitive** заключается в обработке повторяющихся значений атрибутов.</span><span class="sxs-lookup"><span data-stu-id="e911d-221">The difference between **Merge** and **MergeCaseInsensitive** is how to process duplicate attribute values.</span></span> <span data-ttu-id="e911d-222">Модуль синхронизации не позволяет вставлять повторяющиеся значения в целевой атрибут.</span><span class="sxs-lookup"><span data-stu-id="e911d-222">The sync engine makes sure duplicate values are not inserted into the target attribute.</span></span> <span data-ttu-id="e911d-223">При использовании параметра **MergeCaseInsensitive**в целевой атрибут нельзя вставить повторяющиеся значения с разным регистром.</span><span class="sxs-lookup"><span data-stu-id="e911d-223">With **MergeCaseInsensitive**, duplicate values with only a difference in case are not going to be present.</span></span> <span data-ttu-id="e911d-224">Например, в целевом атрибуте одновременно не могут быть значения SMTP: SMTP:bob@contoso.com и smtp:bob@contoso.com.</span><span class="sxs-lookup"><span data-stu-id="e911d-224">For example, you should not see both "SMTP:bob@contoso.com" and "smtp:bob@contoso.com" in the target attribute.</span></span> <span data-ttu-id="e911d-225">**Merge** включает в атрибут только точные значения и несколько значений, которые могут отличаться только регистром.</span><span class="sxs-lookup"><span data-stu-id="e911d-225">**Merge** is only looking at the exact values and multiple values where there only is a difference in case might be present.</span></span>

<span data-ttu-id="e911d-226">Параметр **Replace** аналогичен параметру **Update**, но он не используется.</span><span class="sxs-lookup"><span data-stu-id="e911d-226">The option **Replace** is the same as **Update**, but it is not used.</span></span>

### <a name="control-the-attribute-flow-process"></a><span data-ttu-id="e911d-227">Управление потоком атрибута</span><span class="sxs-lookup"><span data-stu-id="e911d-227">Control the attribute flow process</span></span>
<span data-ttu-id="e911d-228">Если для передачи одного и того же атрибута метавселенной настроено несколько входящих правил синхронизации, главное из них определяется по приоритету.</span><span class="sxs-lookup"><span data-stu-id="e911d-228">When multiple inbound sync rules are configured to contribute to the same metaverse attribute, then precedence is used to determine the winner.</span></span> <span data-ttu-id="e911d-229">Для передачи значения используется правило синхронизации с наивысшим приоритетом (с самым низким числовым значением).</span><span class="sxs-lookup"><span data-stu-id="e911d-229">The sync rule with highest precedence (lowest numeric value) is going to contribute the value.</span></span> <span data-ttu-id="e911d-230">То же самое происходит и с исходящими правилами.</span><span class="sxs-lookup"><span data-stu-id="e911d-230">The same happens for outbound rules.</span></span> <span data-ttu-id="e911d-231">Для передачи значения в подключенный каталог используется правило синхронизации с наивысшим приоритетом.</span><span class="sxs-lookup"><span data-stu-id="e911d-231">The sync rule with highest precedence wins and contribute the value to the connected directory.</span></span>

<span data-ttu-id="e911d-232">В некоторых случаях правило синхронизации определяет поведение других правил, а не используется для передачи значения.</span><span class="sxs-lookup"><span data-stu-id="e911d-232">In some cases, rather than contribute a value, the sync rule should determine how other rules should behave.</span></span> <span data-ttu-id="e911d-233">В этом случае используются специальные литералы.</span><span class="sxs-lookup"><span data-stu-id="e911d-233">There are some special literals used for this case.</span></span>

<span data-ttu-id="e911d-234">Для входящих правил синхронизации можно использовать литерал **NULL**. Он указывает, что в потоке нет значения для передачи.</span><span class="sxs-lookup"><span data-stu-id="e911d-234">For inbound Synchronization Rules, the literal **NULL** can be used to indicate that the flow has no value to contribute.</span></span> <span data-ttu-id="e911d-235">Значение может передать другое правило с более низким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="e911d-235">Another rule with lower precedence can contribute a value.</span></span> <span data-ttu-id="e911d-236">Если никакое правило не передает значение, атрибут метавселенной удаляется.</span><span class="sxs-lookup"><span data-stu-id="e911d-236">If no rule contributed a value, then the metaverse attribute is removed.</span></span> <span data-ttu-id="e911d-237">Что касается исходящего правила, если после обработки всех правил синхронизации конечным значением будет **NULL**, то значение будет удалено из каталога.</span><span class="sxs-lookup"><span data-stu-id="e911d-237">For an outbound rule, if **NULL** is the final value after all sync rules have been processed, then the value is removed in the connected directory.</span></span>

<span data-ttu-id="e911d-238">Литералы **AuthoritativeNull** и **NULL** аналогичны. Разница между ними заключается в том, что при использовании литерала AuthoritativeNull правила с более низким приоритетом не могут передавать значение.</span><span class="sxs-lookup"><span data-stu-id="e911d-238">The literal **AuthoritativeNull** is similar to **NULL** but with the difference that no lower precedence rules can contribute a value.</span></span>

<span data-ttu-id="e911d-239">В потоке атрибута также может использоваться литерал **IgnoreThisFlow**.</span><span class="sxs-lookup"><span data-stu-id="e911d-239">An attribute flow can also use **IgnoreThisFlow**.</span></span> <span data-ttu-id="e911d-240">Он, так же как и литерал NULL, указывает, что в потоке нет значения для передачи.</span><span class="sxs-lookup"><span data-stu-id="e911d-240">It is similar to NULL in the sense that it indicates there is nothing to contribute.</span></span> <span data-ttu-id="e911d-241">Разница между ними заключается в том, что при использовании литерала IgnoreThisFlow имеющееся значение в каталоге не удаляется.</span><span class="sxs-lookup"><span data-stu-id="e911d-241">The difference is that it does not remove an already existing value in the target.</span></span> <span data-ttu-id="e911d-242">Это выглядит так, как будто там никогда не было потока.</span><span class="sxs-lookup"><span data-stu-id="e911d-242">It is like the attribute flow has never been there.</span></span>

<span data-ttu-id="e911d-243">Пример:</span><span class="sxs-lookup"><span data-stu-id="e911d-243">Here is an example:</span></span>

<span data-ttu-id="e911d-244">В правиле синхронизации *Out to AD — User Exchange hybrid* (Поступление в AD — пользователи гибридной среды Exchange) доступен следующий поток:</span><span class="sxs-lookup"><span data-stu-id="e911d-244">In *Out to AD - User Exchange hybrid* the following flow can be found:</span></span>  
`IIF([cloudSOAExchMailbox] = True,[cloudMSExchSafeSendersHash],IgnoreThisFlow)`  
<span data-ttu-id="e911d-245">Это выражение читается так: если почтовый ящик пользователя расположен в Azure AD, то атрибут поступает из Azure AD в AD.</span><span class="sxs-lookup"><span data-stu-id="e911d-245">This expression should be read as: if the user mailbox is located in Azure AD, then flow the attribute from Azure AD to AD.</span></span> <span data-ttu-id="e911d-246">Если нет, атрибуты в Active Directory не возвращаются.</span><span class="sxs-lookup"><span data-stu-id="e911d-246">If not, do not flow anything back to Active Directory.</span></span> <span data-ttu-id="e911d-247">В этом случае в AD будет сохранено имеющееся значение.</span><span class="sxs-lookup"><span data-stu-id="e911d-247">In this case, it would keep the existing value in AD.</span></span>

### <a name="importedvalue"></a><span data-ttu-id="e911d-248">Функция ImportedValue</span><span class="sxs-lookup"><span data-stu-id="e911d-248">ImportedValue</span></span>
<span data-ttu-id="e911d-249">Функция ImportedValue отличается от всех других функций, поэтому имя ее атрибута должно заключаться в кавычки, а не в квадратные скобки: </span><span class="sxs-lookup"><span data-stu-id="e911d-249">The function ImportedValue is different than all other functions since the attribute name must be enclosed in quotes rather than square brackets:</span></span>  
<span data-ttu-id="e911d-250">`ImportedValue("proxyAddresses")`.</span><span class="sxs-lookup"><span data-stu-id="e911d-250">`ImportedValue("proxyAddresses")`.</span></span>

<span data-ttu-id="e911d-251">Обычно во время синхронизации атрибут будет использовать ожидаемое значение, даже если оно еще не экспортировано или если во время экспорта произошла ошибка ("верхняя часть башни").</span><span class="sxs-lookup"><span data-stu-id="e911d-251">Usually during synchronization an attribute uses the expected value, even if it hasn’t been exported yet or an error was received during export (“top of the tower”).</span></span> <span data-ttu-id="e911d-252">Во время входящей синхронизации предполагается, что атрибут, который еще не достиг связанного каталога, обязательно достигнет его.</span><span class="sxs-lookup"><span data-stu-id="e911d-252">An inbound synchronization assumes that an attribute that hasn’t yet reached a connected directory eventually reaches it.</span></span> <span data-ttu-id="e911d-253">В некоторых случаях важно синхронизировать только значение, подтвержденное подключенным каталогом ("голограмма и башня импорта разницы").</span><span class="sxs-lookup"><span data-stu-id="e911d-253">In some cases, it is important to only synchronize a value that has been confirmed by the connected directory (“hologram and delta import tower”).</span></span>

<span data-ttu-id="e911d-254">Пример этого использования можно найти в стандартном правиле синхронизации *In from AD – User Common from Exchange* (Поступление из AD — все пользователи с сервера Exchange).</span><span class="sxs-lookup"><span data-stu-id="e911d-254">An example of this function can be found in the out-of-box Synchronization Rule *In from AD – User Common from Exchange*.</span></span> <span data-ttu-id="e911d-255">Согласно этому правилу в гибридной среде Exchange значение, добавленное Exchange Online, должно синхронизироваться только в том случае, если был подтвержден успешный экспорт этого значения.</span><span class="sxs-lookup"><span data-stu-id="e911d-255">In Hybrid Exchange, the value added by Exchange online should only be synchronized when it has been confirmed that the value was exported successfully:</span></span>  
`proxyAddresses` <- `RemoveDuplicates(Trim(ImportedValue("proxyAddresses")))`

## <a name="precedence"></a><span data-ttu-id="e911d-256">Приоритет</span><span class="sxs-lookup"><span data-stu-id="e911d-256">Precedence</span></span>
<span data-ttu-id="e911d-257">Если для передачи значения атрибута в целевое пространство используется несколько правил синхронизации, главное правило выбирается на основании приоритета.</span><span class="sxs-lookup"><span data-stu-id="e911d-257">When several sync rules try to contribute the same attribute value to the target, the precedence value is used to determine the winner.</span></span> <span data-ttu-id="e911d-258">В случае конфликта для передачи атрибута используется правило синхронизации с наивысшим приоритетом (с самым низким числовым значением).</span><span class="sxs-lookup"><span data-stu-id="e911d-258">The rule with highest precedence, lowest numeric value, is going to contribute the attribute in a conflict.</span></span>

![Типы объединения](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/precedence1.png)  

<span data-ttu-id="e911d-260">Этот порядок может использоваться для определения более точного потока атрибутов для небольшого подмножества объектов.</span><span class="sxs-lookup"><span data-stu-id="e911d-260">This ordering can be used to define more precise attribute flows for a small subset of objects.</span></span> <span data-ttu-id="e911d-261">Например, стандартные правила определяют, имеют ли атрибуты из включенной учетной записи (**User AccountEnabled**) более высокий приоритет, чем атрибуты из других учетных записей.</span><span class="sxs-lookup"><span data-stu-id="e911d-261">For example, the out-of-box-rules make sure that attributes from an enabled account (**User AccountEnabled**) have precedence from other accounts.</span></span>

<span data-ttu-id="e911d-262">Для соединителей можно определить приоритет.</span><span class="sxs-lookup"><span data-stu-id="e911d-262">Precedence can be defined between Connectors.</span></span> <span data-ttu-id="e911d-263">Это позволяет использовать для передачи значений сначала соединители с более эффективными данными.</span><span class="sxs-lookup"><span data-stu-id="e911d-263">That allows Connectors with better data to contribute values first.</span></span>

### <a name="multiple-objects-from-the-same-connector-space"></a><span data-ttu-id="e911d-264">Несколько объектов из одного пространства соединителя</span><span class="sxs-lookup"><span data-stu-id="e911d-264">Multiple objects from the same connector space</span></span>
<span data-ttu-id="e911d-265">Если несколько объектов в одном пространстве соединителя объединены с одним и тем же объектом метавселенной, необходимо определить приоритет.</span><span class="sxs-lookup"><span data-stu-id="e911d-265">If you have several objects in the same connector space joined to the same metaverse object, precedence must be adjusted.</span></span> <span data-ttu-id="e911d-266">При наличии в области одного правила синхронизации нескольких объектов модуль синхронизации не может определить приоритет.</span><span class="sxs-lookup"><span data-stu-id="e911d-266">If several objects are in scope of the same sync rule, then the sync engine is not able to determine precedence.</span></span> <span data-ttu-id="e911d-267">Значение приоритета позволяет избежать неоднозначности с определением объекта источника, используемого для передачи значения в метавселенную.</span><span class="sxs-lookup"><span data-stu-id="e911d-267">It is ambiguous which source object should contribute the value to the metaverse.</span></span> <span data-ttu-id="e911d-268">Неоднозначность может возникнуть даже при наличии в атрибутах источника одинакового значения.</span><span class="sxs-lookup"><span data-stu-id="e911d-268">This configuration is reported as ambiguous even if the attributes in the source have the same value.</span></span>  
![Несколько объектов, присоединенных к одному объекту метавселенной](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/multiple1.png)  

<span data-ttu-id="e911d-270">В рамках этого сценария необходимо изменить область правил синхронизации, что, в свою очередь, позволит использовать для объектов источника разные правила синхронизации.</span><span class="sxs-lookup"><span data-stu-id="e911d-270">For this scenario, you need to change the scope of the sync rules so the source objects have different sync rules in scope.</span></span> <span data-ttu-id="e911d-271">Таким образом, можно определить другие значения приоритета.</span><span class="sxs-lookup"><span data-stu-id="e911d-271">That allows you to define different precedence.</span></span>  
![Несколько объектов, присоединенных к одному объекту метавселенной](./media/active-directory-aadconnectsync-understanding-declarative-provisioning/multiple2.png)  

## <a name="next-steps"></a><span data-ttu-id="e911d-273">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="e911d-273">Next steps</span></span>
* <span data-ttu-id="e911d-274">Дополнительные сведения о языке выражений см. в статье [Служба синхронизации Azure AD Connect: общие сведения о выражениях декларативной подготовки](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="e911d-274">Read more about the expression language in [Understanding Declarative Provisioning Expressions](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md).</span></span>
* <span data-ttu-id="e911d-275">Примеры стандартного использования декларативной подготовки см. в статье [Службы синхронизации Azure AD Connect: рекомендации по изменению конфигурации по умолчанию](active-directory-aadconnectsync-understanding-default-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="e911d-275">See how declarative provisioning is used out-of-box in [Understanding the default configuration](active-directory-aadconnectsync-understanding-default-configuration.md).</span></span>
* <span data-ttu-id="e911d-276">Инструкции по практическим изменениям с помощью декларативной подготовки см. в статье [Службы синхронизации Azure AD Connect: изменение конфигурации по умолчанию](active-directory-aadconnectsync-change-the-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="e911d-276">See how to make a practical change using declarative provisioning in [How to make a change to the default configuration](active-directory-aadconnectsync-change-the-configuration.md).</span></span>
* <span data-ttu-id="e911d-277">Чтобы узнать о взаимодействии пользователей и контактов, см. статью [Синхронизация Azure AD Connect: общее представление о пользователях и контактах](active-directory-aadconnectsync-understanding-users-and-contacts.md).</span><span class="sxs-lookup"><span data-stu-id="e911d-277">Continue to read how users and contacts work together in [Understanding Users and Contacts](active-directory-aadconnectsync-understanding-users-and-contacts.md).</span></span>

<span data-ttu-id="e911d-278">**Обзорные статьи**</span><span class="sxs-lookup"><span data-stu-id="e911d-278">**Overview topics**</span></span>

* [<span data-ttu-id="e911d-279">Службы синхронизации Azure AD Connect: общие сведений о синхронизации и ее настройка</span><span class="sxs-lookup"><span data-stu-id="e911d-279">Azure AD Connect sync: Understand and customize synchronization</span></span>](active-directory-aadconnectsync-whatis.md)
* [<span data-ttu-id="e911d-280">Интеграция локальных удостоверений с Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="e911d-280">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)

<span data-ttu-id="e911d-281">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="e911d-281">**Reference topics**</span></span>

* [<span data-ttu-id="e911d-282">Синхронизация Azure AD Connect: справочник по функциям</span><span class="sxs-lookup"><span data-stu-id="e911d-282">Azure AD Connect sync: Functions Reference</span></span>](active-directory-aadconnectsync-functions-reference.md)
