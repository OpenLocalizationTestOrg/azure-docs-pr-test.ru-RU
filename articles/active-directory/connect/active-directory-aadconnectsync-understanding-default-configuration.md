---
title: "Синхронизация Azure AD Connect: общие сведения о конфигурации по умолчанию | Документация Майкрософт"
description: "Эта статья содержит информацию о конфигурации по умолчанию для службы синхронизации Azure AD Connect."
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: ed876f22-6892-4b9d-acbe-6a2d112f1cd1
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 32a693c059a1b4261f33a3d6f50f397365e9dac4
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-sync-understanding-the-default-configuration"></a><span data-ttu-id="dfe38-103">Службы синхронизации Azure AD Connect: рекомендации по изменению конфигурации по умолчанию</span><span class="sxs-lookup"><span data-stu-id="dfe38-103">Azure AD Connect sync: Understanding the default configuration</span></span>
<span data-ttu-id="dfe38-104">В этой статье описываются стандартные правила конфигурации</span><span class="sxs-lookup"><span data-stu-id="dfe38-104">This article explains the out-of-box configuration rules.</span></span> <span data-ttu-id="dfe38-105">и то, как они влияют на конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="dfe38-105">It documents the rules and how these rules impact the configuration.</span></span> <span data-ttu-id="dfe38-106">Кроме того, здесь содержится информация о конфигурации по умолчанию службы синхронизации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="dfe38-106">It also walks you through the default configuration of Azure AD Connect sync.</span></span> <span data-ttu-id="dfe38-107">Статья на реальном примере познакомит читателя с тем, как работает модель конфигурации, именуемая "декларативной подготовкой".</span><span class="sxs-lookup"><span data-stu-id="dfe38-107">The goal is that the reader understands how the configuration model, named declarative provisioning, is working in a real-world example.</span></span> <span data-ttu-id="dfe38-108">Для работы с этой статьей нужно установить и настроить службу Azure AD Connect Sync с помощью мастера установки.</span><span class="sxs-lookup"><span data-stu-id="dfe38-108">This article assumes that you have already installed and configure Azure AD Connect sync using the installation wizard.</span></span>

<span data-ttu-id="dfe38-109">Дополнительные сведения о модели конфигурации см. в статье [Служба синхронизации Azure AD Connect: общие сведения о декларативной подготовке](active-directory-aadconnectsync-understanding-declarative-provisioning.md).</span><span class="sxs-lookup"><span data-stu-id="dfe38-109">To understand the details of the configuration model, read [Understanding Declarative Provisioning](active-directory-aadconnectsync-understanding-declarative-provisioning.md).</span></span>

## <a name="out-of-box-rules-from-on-premises-to-azure-ad"></a><span data-ttu-id="dfe38-110">Стандартные правила, используемые локально и передаваемые в Azure AD</span><span class="sxs-lookup"><span data-stu-id="dfe38-110">Out-of-box rules from on-premises to Azure AD</span></span>
<span data-ttu-id="dfe38-111">Приведенные ниже выражения доступны в стандартной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-111">The following expressions can be found in the out-of-box configuration.</span></span>

### <a name="user-out-of-box-rules"></a><span data-ttu-id="dfe38-112">Стандартные правила: объект-пользователь</span><span class="sxs-lookup"><span data-stu-id="dfe38-112">User out-of-box rules</span></span>
<span data-ttu-id="dfe38-113">Эти правила также применяются к типу объекта iNetOrgPerson.</span><span class="sxs-lookup"><span data-stu-id="dfe38-113">These rules also apply to the iNetOrgPerson object type.</span></span>

<span data-ttu-id="dfe38-114">Для синхронизации объект-пользователь должен соответствовать следующим условиям:</span><span class="sxs-lookup"><span data-stu-id="dfe38-114">A user object must satisfy the following to be synchronized:</span></span>

* <span data-ttu-id="dfe38-115">Должен присутствовать атрибут sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="dfe38-115">Must have a sourceAnchor.</span></span>
* <span data-ttu-id="dfe38-116">После создания объекта в Azure AD атрибут sourceAnchor изменить нельзя.</span><span class="sxs-lookup"><span data-stu-id="dfe38-116">After the object has been created in Azure AD, then sourceAnchor cannot change.</span></span> <span data-ttu-id="dfe38-117">Если значение sourceAnchor изменено локально, синхронизация объекта будет остановлена, пока это значение не будет изменено на предыдущее.</span><span class="sxs-lookup"><span data-stu-id="dfe38-117">If the value is changed on-premises, the object stops synchronizing until the sourceAnchor is changed back to its previous value.</span></span>
* <span data-ttu-id="dfe38-118">Атрибут accountEnabled (userAccountControl) должен быть заполнен.</span><span class="sxs-lookup"><span data-stu-id="dfe38-118">Must have the accountEnabled (userAccountControl) attribute populated.</span></span> <span data-ttu-id="dfe38-119">Для локальной службы Active Directory этот атрибут всегда присутствует и является заполненным.</span><span class="sxs-lookup"><span data-stu-id="dfe38-119">With an on-premises Active Directory, this attribute is always present and populated.</span></span>

<span data-ttu-id="dfe38-120">Следующие объекты-пользователи **не** синхронизируются с Azure AD:</span><span class="sxs-lookup"><span data-stu-id="dfe38-120">The following user objects are **not** synchronized to Azure AD:</span></span>

* <span data-ttu-id="dfe38-121">`IsPresent([isCriticalSystemObject])`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-121">`IsPresent([isCriticalSystemObject])`.</span></span> <span data-ttu-id="dfe38-122">Многие стандартные объекты в Active Directory (например, встроенная учетная запись администратора) не должны синхронизироваться.</span><span class="sxs-lookup"><span data-stu-id="dfe38-122">Ensure many out-of-box objects in Active Directory, such as the built-in administrator account, are not synchronized.</span></span>
* <span data-ttu-id="dfe38-123">`IsPresent([sAMAccountName]) = False`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-123">`IsPresent([sAMAccountName]) = False`.</span></span> <span data-ttu-id="dfe38-124">Объекты-пользователи без атрибута sAMAccountName не должны синхронизироваться.</span><span class="sxs-lookup"><span data-stu-id="dfe38-124">Ensure user objects with no sAMAccountName attribute are not synchronized.</span></span> <span data-ttu-id="dfe38-125">На практике этот случай может произойти только в домене, обновленном с уровня NT4.</span><span class="sxs-lookup"><span data-stu-id="dfe38-125">This case would only practically happen in a domain upgraded from NT4.</span></span>
* <span data-ttu-id="dfe38-126">`Left([sAMAccountName], 4) = "AAD_"`, `Left([sAMAccountName], 5) = "MSOL_"`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-126">`Left([sAMAccountName], 4) = "AAD_"`, `Left([sAMAccountName], 5) = "MSOL_"`.</span></span> <span data-ttu-id="dfe38-127">Не синхронизируйте учетную запись службы, используемую службой Azure AD Connect Sync и ее предыдущими версиями.</span><span class="sxs-lookup"><span data-stu-id="dfe38-127">Do not synchronize the service account used by Azure AD Connect sync and its earlier versions.</span></span>
* <span data-ttu-id="dfe38-128">Не синхронизируйте учетные записи Exchange, которые не будут работать в Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="dfe38-128">Do not synchronize Exchange accounts that would not work in Exchange Online.</span></span>
  * `[sAMAccountName] = "SUPPORT_388945a0"`
  * `Left([mailNickname], 14) = "SystemMailbox{"`
  * `(Left([mailNickname], 4) = "CAS_" && (InStr([mailNickname], "}") > 0))`
  * `(Left([sAMAccountName], 4) = "CAS_" && (InStr([sAMAccountName], "}")> 0))`
* <span data-ttu-id="dfe38-129">Не синхронизируйте объекты, которые не будут работать в Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="dfe38-129">Do not synchronize objects that would not work in Exchange Online.</span></span>
  `CBool(IIF(IsPresent([msExchRecipientTypeDetails]),BitAnd([msExchRecipientTypeDetails],&H21C07000) > 0,NULL))`  
  <span data-ttu-id="dfe38-130">Эта битовая маска (&amp;H21C07000) будет отфильтровывать следующие объекты:</span><span class="sxs-lookup"><span data-stu-id="dfe38-130">This bitmask (&H21C07000) would filter out the following objects:</span></span>
  * <span data-ttu-id="dfe38-131">общедоступную папку с поддержкой электронной почты;</span><span class="sxs-lookup"><span data-stu-id="dfe38-131">Mail-enabled Public Folder</span></span>
  * <span data-ttu-id="dfe38-132">почтовый ящик системного помощника;</span><span class="sxs-lookup"><span data-stu-id="dfe38-132">System Attendant Mailbox</span></span>
  * <span data-ttu-id="dfe38-133">почтовый ящик базы данных почтовых ящиков (системный почтовый ящик);</span><span class="sxs-lookup"><span data-stu-id="dfe38-133">Mailbox Database Mailbox (System Mailbox)</span></span>
  * <span data-ttu-id="dfe38-134">универсальную группу безопасности (не применяется для пользователя, но доступно для прежних версий);</span><span class="sxs-lookup"><span data-stu-id="dfe38-134">Universal Security Group (wouldn't apply for a user, but is present for legacy reasons)</span></span>
  * <span data-ttu-id="dfe38-135">неуниверсальную группу (не применяется для пользователя, но доступно для прежних версий);</span><span class="sxs-lookup"><span data-stu-id="dfe38-135">Non-Universal Group (wouldn't apply for a user, but is present for legacy reasons)</span></span>
  * <span data-ttu-id="dfe38-136">план почтового ящика;</span><span class="sxs-lookup"><span data-stu-id="dfe38-136">Mailbox Plan</span></span>
  * <span data-ttu-id="dfe38-137">почтовый ящик найденных сообщений.</span><span class="sxs-lookup"><span data-stu-id="dfe38-137">Discovery Mailbox</span></span>
* <span data-ttu-id="dfe38-138">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-138">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span></span> <span data-ttu-id="dfe38-139">Не синхронизируйте объекты, являющиеся жертвами репликации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-139">Do not synchronize any replication victim objects.</span></span>

<span data-ttu-id="dfe38-140">Применяются следующие правила атрибутов:</span><span class="sxs-lookup"><span data-stu-id="dfe38-140">The following attribute rules apply:</span></span>

* <span data-ttu-id="dfe38-141">`sourceAnchor <- IIF([msExchRecipientTypeDetails]=2,NULL,..)`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-141">`sourceAnchor <- IIF([msExchRecipientTypeDetails]=2,NULL,..)`.</span></span> <span data-ttu-id="dfe38-142">Атрибут sourceAnchor не предоставляется из связанного почтового ящика.</span><span class="sxs-lookup"><span data-stu-id="dfe38-142">The sourceAnchor attribute is not contributed from a linked mailbox.</span></span> <span data-ttu-id="dfe38-143">Предполагается, что при обнаружении связанного почтового ящика фактическая учетная запись присоединяется позже.</span><span class="sxs-lookup"><span data-stu-id="dfe38-143">It is assumed that if a linked mailbox has been found, the actual account is joined later.</span></span>
* <span data-ttu-id="dfe38-144">Связанные с Exchange атрибуты синхронизируются, только если у атрибута **mailNickName** есть значение.</span><span class="sxs-lookup"><span data-stu-id="dfe38-144">Exchange related attributes are only synchronized if the attribute **mailNickName** has a value.</span></span>
* <span data-ttu-id="dfe38-145">При наличии нескольких лесов атрибуты используются в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="dfe38-145">When there are multiple forests, then attributes are consumed in the following order:</span></span>
  1. <span data-ttu-id="dfe38-146">Атрибуты, связанные с входом (например, userPrincipalName), предоставляются из леса с действующей учетной записью.</span><span class="sxs-lookup"><span data-stu-id="dfe38-146">Attributes related to sign-in (for example userPrincipalName) are contributed from the forest with an enabled account.</span></span>
  2. <span data-ttu-id="dfe38-147">Атрибуты, которые можно обнаружить в глобальном списке адресов (GAL), предоставляются из леса с почтовым ящиком Exchange.</span><span class="sxs-lookup"><span data-stu-id="dfe38-147">Attributes that can be found in an Exchange GAL (Global Address List) are contributed from the forest with an Exchange Mailbox.</span></span>
  3. <span data-ttu-id="dfe38-148">Если почтовый ящик не найден, эти атрибуты могут поступать из любого леса.</span><span class="sxs-lookup"><span data-stu-id="dfe38-148">If no mailbox can be found, then these attributes can come from any forest.</span></span>
  4. <span data-ttu-id="dfe38-149">Атрибуты, связанные с Exchange (технические атрибуты не отображаются в глобальном списке адресов), предоставляются из леса, где `mailNickname ISNOTNULL`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-149">Exchange related attributes (technical attributes not visible in the GAL) are contributed from the forest where `mailNickname ISNOTNULL`.</span></span>
  5. <span data-ttu-id="dfe38-150">Если есть несколько лесов, соответствующих одному из этих правил, для определения леса, предоставляющего атрибуты, используется порядок создания (дата и время) соединителей (лесов).</span><span class="sxs-lookup"><span data-stu-id="dfe38-150">If there are multiple forests that would satisfy one of these rules, then the creation order (date/time) of the Connectors (forests) is used to determine which forest contributes the attributes.</span></span>

### <a name="contact-out-of-box-rules"></a><span data-ttu-id="dfe38-151">Стандартные правила: объект-контакт</span><span class="sxs-lookup"><span data-stu-id="dfe38-151">Contact out-of-box rules</span></span>
<span data-ttu-id="dfe38-152">Для синхронизации объект-контакт должен соответствовать следующим условиям:</span><span class="sxs-lookup"><span data-stu-id="dfe38-152">A contact object must satisfy the following to be synchronized:</span></span>

* <span data-ttu-id="dfe38-153">Контакт должен поддерживать электронную почту.</span><span class="sxs-lookup"><span data-stu-id="dfe38-153">The contact must be mail-enabled.</span></span> <span data-ttu-id="dfe38-154">Проверка выполняется в соответствии со следующими правилами:</span><span class="sxs-lookup"><span data-stu-id="dfe38-154">It is verified with the following rules:</span></span>
  * <span data-ttu-id="dfe38-155">`IsPresent([proxyAddresses]) = True)`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-155">`IsPresent([proxyAddresses]) = True)`.</span></span> <span data-ttu-id="dfe38-156">Атрибут proxyAddresses должен быть заполнен.</span><span class="sxs-lookup"><span data-stu-id="dfe38-156">The proxyAddresses attribute must be populated.</span></span>
  * <span data-ttu-id="dfe38-157">Основной адрес электронной почты можно найти в атрибуте proxyAddresses или в атрибуте mail.</span><span class="sxs-lookup"><span data-stu-id="dfe38-157">A primary email address can be found in either the proxyAddresses attribute or the mail attribute.</span></span> <span data-ttu-id="dfe38-158">Наличие @ используется для проверки, что содержимое будет адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="dfe38-158">The presence of an @ is used to verify that the content is an email address.</span></span> <span data-ttu-id="dfe38-159">Одно из этих двух правил должно иметь значение True.</span><span class="sxs-lookup"><span data-stu-id="dfe38-159">One of these two rules must be evaluated to True.</span></span>
    * <span data-ttu-id="dfe38-160">`(Contains([proxyAddresses], "SMTP:") > 0) && (InStr(Item([proxyAddresses], Contains([proxyAddresses], "SMTP:")), "@") > 0))`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-160">`(Contains([proxyAddresses], "SMTP:") > 0) && (InStr(Item([proxyAddresses], Contains([proxyAddresses], "SMTP:")), "@") > 0))`.</span></span> <span data-ttu-id="dfe38-161">Существует ли запись с «SMTP:» и если нет, можно @ быть найдено в строке?</span><span class="sxs-lookup"><span data-stu-id="dfe38-161">Is there an entry with "SMTP:" and if there is, can an @ be found in the string?</span></span>
    * <span data-ttu-id="dfe38-162">`(IsPresent([mail]) = True && (InStr([mail], "@") > 0)`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-162">`(IsPresent([mail]) = True && (InStr([mail], "@") > 0)`.</span></span> <span data-ttu-id="dfe38-163">Атрибут mail заполняется и если да, можно @ быть найдено в строке?</span><span class="sxs-lookup"><span data-stu-id="dfe38-163">Is the mail attribute populated and if it is, can an @ be found in the string?</span></span>

<span data-ttu-id="dfe38-164">Следующие объекты-контакты **не** синхронизируются с Azure AD:</span><span class="sxs-lookup"><span data-stu-id="dfe38-164">The following contact objects are **not** synchronized to Azure AD:</span></span>

* <span data-ttu-id="dfe38-165">`IsPresent([isCriticalSystemObject])`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-165">`IsPresent([isCriticalSystemObject])`.</span></span> <span data-ttu-id="dfe38-166">Объекты-контакты, отмеченные как критические, не должны синхронизироваться.</span><span class="sxs-lookup"><span data-stu-id="dfe38-166">Ensure no contact objects marked as critical are synchronized.</span></span> <span data-ttu-id="dfe38-167">Не допускаются объекты с конфигурацией по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="dfe38-167">Shouldn't be any with a default configuration.</span></span>
* <span data-ttu-id="dfe38-168">`((InStr([displayName], "(MSOL)") > 0) && (CBool([msExchHideFromAddressLists])))`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-168">`((InStr([displayName], "(MSOL)") > 0) && (CBool([msExchHideFromAddressLists])))`.</span></span>
* <span data-ttu-id="dfe38-169">`(Left([mailNickname], 4) = "CAS_" && (InStr([mailNickname], "}") > 0))`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-169">`(Left([mailNickname], 4) = "CAS_" && (InStr([mailNickname], "}") > 0))`.</span></span> <span data-ttu-id="dfe38-170">Эти объекты не будут работать в Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="dfe38-170">These objects wouldn't work in Exchange Online.</span></span>
* <span data-ttu-id="dfe38-171">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-171">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span></span> <span data-ttu-id="dfe38-172">Не синхронизируйте объекты, являющиеся жертвами репликации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-172">Do not synchronize any replication victim objects.</span></span>

### <a name="group-out-of-box-rules"></a><span data-ttu-id="dfe38-173">Стандартные правила: объект-группа</span><span class="sxs-lookup"><span data-stu-id="dfe38-173">Group out-of-box rules</span></span>
<span data-ttu-id="dfe38-174">Для синхронизации объект-группа должен соответствовать следующим условиям:</span><span class="sxs-lookup"><span data-stu-id="dfe38-174">A group object must satisfy the following to be synchronized:</span></span>

* <span data-ttu-id="dfe38-175">Должен включать менее 50 000 членов.</span><span class="sxs-lookup"><span data-stu-id="dfe38-175">Must have less than 50,000 members.</span></span> <span data-ttu-id="dfe38-176">Это число равно количеству членов локальной группы.</span><span class="sxs-lookup"><span data-stu-id="dfe38-176">This count is the number of members in the on-premises group.</span></span>
  * <span data-ttu-id="dfe38-177">Если группа включает большее количество членов перед первым запуском синхронизации, такая группа не будет синхронизирована.</span><span class="sxs-lookup"><span data-stu-id="dfe38-177">If it has more members before synchronization starts the first time, the group is not synchronized.</span></span>
  * <span data-ttu-id="dfe38-178">Если после создания количество членов увеличилось и затем достигло 50 000, синхронизация останавливается, пока количество членов снова не станет меньше 50 000.</span><span class="sxs-lookup"><span data-stu-id="dfe38-178">If the number of members grow from when it was initially created, then when it reaches 50,000 members it stops synchronizing until the membership count is lower than 50,000 again.</span></span>
  * <span data-ttu-id="dfe38-179">Примечание. Ограничение в 50 000 членов устанавливается также в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dfe38-179">Note: The 50,000 membership count is also enforced by Azure AD.</span></span> <span data-ttu-id="dfe38-180">Вы не сможете синхронизировать группы с превышающим это значение количеством членов, даже если измените или удалите это правило.</span><span class="sxs-lookup"><span data-stu-id="dfe38-180">You are not able to synchronize groups with more members even if you modify or remove this rule.</span></span>
* <span data-ttu-id="dfe38-181">Если группа выступает в качестве **группы рассылки**, для нее также должна быть включена поддержка почты.</span><span class="sxs-lookup"><span data-stu-id="dfe38-181">If the group is a **Distribution Group**, then it must also be mail enabled.</span></span> <span data-ttu-id="dfe38-182">Сведения о принудительном применении этого правила см. разделе [Стандартные правила: объект-контакт](#contact-out-of-box-rules).</span><span class="sxs-lookup"><span data-stu-id="dfe38-182">See [Contact out-of-box rules](#contact-out-of-box-rules) for this rule is enforced.</span></span>

<span data-ttu-id="dfe38-183">Следующие объекты-группы **не** синхронизируются с Azure AD:</span><span class="sxs-lookup"><span data-stu-id="dfe38-183">The following group objects are **not** synchronized to Azure AD:</span></span>

* <span data-ttu-id="dfe38-184">`IsPresent([isCriticalSystemObject])`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-184">`IsPresent([isCriticalSystemObject])`.</span></span> <span data-ttu-id="dfe38-185">Многие стандартные объекты в Active Directory (например, встроенная группа администраторов) не должны синхронизироваться.</span><span class="sxs-lookup"><span data-stu-id="dfe38-185">Ensure many out-of-box objects in Active Directory, such as the built-in administrators group, are not synchronized.</span></span>
* <span data-ttu-id="dfe38-186">`[sAMAccountName] = "MSOL_AD_Sync_RichCoexistence"`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-186">`[sAMAccountName] = "MSOL_AD_Sync_RichCoexistence"`.</span></span> <span data-ttu-id="dfe38-187">Устаревшие группы, используемые DirSync.</span><span class="sxs-lookup"><span data-stu-id="dfe38-187">Legacy group used by DirSync.</span></span>
* <span data-ttu-id="dfe38-188">`BitAnd([msExchRecipientTypeDetails],&amp;H40000000)`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-188">`BitAnd([msExchRecipientTypeDetails],&amp;H40000000)`.</span></span> <span data-ttu-id="dfe38-189">Группа ролей.</span><span class="sxs-lookup"><span data-stu-id="dfe38-189">Role Group.</span></span>
* <span data-ttu-id="dfe38-190">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-190">`CBool(InStr(DNComponent(CRef([dn]),1),"\\0ACNF:")>0)`.</span></span> <span data-ttu-id="dfe38-191">Не синхронизируйте объекты, являющиеся жертвами репликации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-191">Do not synchronize any replication victim objects.</span></span>

### <a name="foreignsecurityprincipal-out-of-box-rules"></a><span data-ttu-id="dfe38-192">Стандартные правила: ForeignSecurityPrincipal</span><span class="sxs-lookup"><span data-stu-id="dfe38-192">ForeignSecurityPrincipal out-of-box rules</span></span>
<span data-ttu-id="dfe38-193">Внешние субъекты безопасности присоединяются к любому (\*) объекту в метавселенной.</span><span class="sxs-lookup"><span data-stu-id="dfe38-193">FSPs are joined to "any" (\*) object in the metaverse.</span></span> <span data-ttu-id="dfe38-194">В действительности это присоединение происходит только для пользователей и групп безопасности.</span><span class="sxs-lookup"><span data-stu-id="dfe38-194">In reality, this join only happens for users and security groups.</span></span> <span data-ttu-id="dfe38-195">Такая конфигурация гарантирует, что членство между лесами будет разрешено и правильно представлено в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dfe38-195">This configuration ensures that cross-forest memberships are resolved and represented correctly in Azure AD.</span></span>

### <a name="computer-out-of-box-rules"></a><span data-ttu-id="dfe38-196">Стандартные правила: объект-компьютер</span><span class="sxs-lookup"><span data-stu-id="dfe38-196">Computer out-of-box rules</span></span>
<span data-ttu-id="dfe38-197">Для синхронизации объект-компьютер должен соответствовать следующим условиям:</span><span class="sxs-lookup"><span data-stu-id="dfe38-197">A computer object must satisfy the following to be synchronized:</span></span>

* <span data-ttu-id="dfe38-198">`userCertificate ISNOTNULL`.</span><span class="sxs-lookup"><span data-stu-id="dfe38-198">`userCertificate ISNOTNULL`.</span></span> <span data-ttu-id="dfe38-199">Этот атрибут заполняют только компьютеры с Windows 10.</span><span class="sxs-lookup"><span data-stu-id="dfe38-199">Only Windows 10 computers populate this attribute.</span></span> <span data-ttu-id="dfe38-200">Синхронизируются все объекты-компьютеры со значением для этого атрибута.</span><span class="sxs-lookup"><span data-stu-id="dfe38-200">All computer objects with a value in this attribute are synchronized.</span></span>

## <a name="understanding-the-out-of-box-rules-scenario"></a><span data-ttu-id="dfe38-201">Основные сведения об использовании стандартных правил</span><span class="sxs-lookup"><span data-stu-id="dfe38-201">Understanding the out-of-box rules scenario</span></span>
<span data-ttu-id="dfe38-202">В этом примере мы используем развертывание с одним лесом учетных записей (A), одним лесом ресурсов (R) и одним каталогом Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dfe38-202">In this example, we are using a deployment with one account forest (A), one resource forest (R), and one Azure AD directory.</span></span>

![Рисунок с описанием сценария](./media/active-directory-aadconnectsync-understanding-default-configuration/scenario.png)

<span data-ttu-id="dfe38-204">В этой конфигурации ожидается, что будет одна активная учетная запись в лесу учетных записей и одна отключенная учетная запись в лесу ресурсов, к которому привязан почтовый ящик.</span><span class="sxs-lookup"><span data-stu-id="dfe38-204">In this configuration, it is assumed there is an enabled account in the account forest and a disabled account in the resource forest with a linked mailbox.</span></span>

<span data-ttu-id="dfe38-205">Наша цель при использовании конфигурации по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="dfe38-205">Our goal with the default configuration is:</span></span>

* <span data-ttu-id="dfe38-206">Атрибуты, связанные с именем входа, синхронизируются из леса с активной учетной записью.</span><span class="sxs-lookup"><span data-stu-id="dfe38-206">Attributes related to sign-in are synchronized from the forest with the enabled account.</span></span>
* <span data-ttu-id="dfe38-207">Атрибуты, находящиеся в глобальном списке адресов, синхронизируются из леса с почтовым ящиком.</span><span class="sxs-lookup"><span data-stu-id="dfe38-207">Attributes that can be found in the GAL (Global Address List) are synchronized from the forest with the mailbox.</span></span> <span data-ttu-id="dfe38-208">Если ни одного почтового ящика нет, используется любой другой лес.</span><span class="sxs-lookup"><span data-stu-id="dfe38-208">If no mailbox can be found, any other forest is used.</span></span>
* <span data-ttu-id="dfe38-209">Если найден связанный почтовый ящик, должна присутствовать и связанная активная учетная запись: только тогда объекта экспортируется в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dfe38-209">If a linked mailbox is found, the linked enabled account must be found for the object to be exported to Azure AD.</span></span>

### <a name="synchronization-rule-editor"></a><span data-ttu-id="dfe38-210">Редактор правил синхронизации</span><span class="sxs-lookup"><span data-stu-id="dfe38-210">Synchronization Rule Editor</span></span>
<span data-ttu-id="dfe38-211">Просмотр и изменение конфигурации выполняются с помощью редактора правил синхронизации, ярлык для которого есть в меню "Пуск".</span><span class="sxs-lookup"><span data-stu-id="dfe38-211">The configuration can be viewed and changed with the tool Synchronization Rules Editor (SRE) and a shortcut to it can be found in the start menu.</span></span>

![Значок редактора правил синхронизации](./media/active-directory-aadconnectsync-understanding-default-configuration/sre.png)

<span data-ttu-id="dfe38-213">Этот редактор входит в набор ресурсов и устанавливается вместе со службой синхронизации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="dfe38-213">The SRE is a resource kit tool and it is installed with Azure AD Connect sync.</span></span> <span data-ttu-id="dfe38-214">Права на его запуск имеют члены группы ADSyncAdmins.</span><span class="sxs-lookup"><span data-stu-id="dfe38-214">To be able to start it, you must be a member of the ADSyncAdmins group.</span></span> <span data-ttu-id="dfe38-215">При запуске редактора вы увидите примерно следующее:</span><span class="sxs-lookup"><span data-stu-id="dfe38-215">When it starts, you see something like this:</span></span>

![Входящие правила синхронизации](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulesinbound.png)

<span data-ttu-id="dfe38-217">Эта панель содержит все правила синхронизации, содержащиеся в вашей конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-217">In this pane, you see all Synchronization Rules created for your configuration.</span></span> <span data-ttu-id="dfe38-218">Каждая строка в таблице представляет одно правило синхронизации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-218">Each line in the table is one Synchronization Rule.</span></span> <span data-ttu-id="dfe38-219">Слева в списке типов правил указаны два разных типа: входящие и исходящие.</span><span class="sxs-lookup"><span data-stu-id="dfe38-219">To the left under Rule Types, the two different types are listed: Inbound and Outbound.</span></span> <span data-ttu-id="dfe38-220">Входящие правила взяты из представления метавселенной.</span><span class="sxs-lookup"><span data-stu-id="dfe38-220">Inbound and Outbound is from the view of the metaverse.</span></span> <span data-ttu-id="dfe38-221">В этом обзоре мы сосредоточимся на правилах для входящих подключений.</span><span class="sxs-lookup"><span data-stu-id="dfe38-221">You are mainly going to focus on the inbound rules in this overview.</span></span> <span data-ttu-id="dfe38-222">Реальный список правил синхронизации зависит от схемы, обнаруженной в AD.</span><span class="sxs-lookup"><span data-stu-id="dfe38-222">The actual list of Synchronization Rules depends on the detected schema in AD.</span></span> <span data-ttu-id="dfe38-223">На рисунке выше лес учетных записей (fabrikamonline.com) не имеет служб, например Exchange или Lync, и для этих служб не созданы правила синхронизации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-223">In the picture above, the account forest (fabrikamonline.com) does not have any services, such as Exchange and Lync, and no Synchronization Rules have been created for these services.</span></span> <span data-ttu-id="dfe38-224">Однако правила синхронизации для этих служб есть в лесу ресурсов (res.fabrikamonline.com).</span><span class="sxs-lookup"><span data-stu-id="dfe38-224">However, in the resource forest (res.fabrikamonline.com) you find Synchronization Rules for these services.</span></span> <span data-ttu-id="dfe38-225">Содержание правил различается в зависимости от обнаруженной версии.</span><span class="sxs-lookup"><span data-stu-id="dfe38-225">The content of the rules is different depending on the version detected.</span></span> <span data-ttu-id="dfe38-226">Например, в развертывании с Exchange 2013 создается больше правил для потоков атрибутов, чем в развертывании с Exchange 2010 или Exchange 2007.</span><span class="sxs-lookup"><span data-stu-id="dfe38-226">For example, in a deployment with Exchange 2013 there are more attribute flows configured than in Exchange 2010/2007.</span></span>

### <a name="synchronization-rule"></a><span data-ttu-id="dfe38-227">Правило синхронизации</span><span class="sxs-lookup"><span data-stu-id="dfe38-227">Synchronization Rule</span></span>
<span data-ttu-id="dfe38-228">Правило синхронизации является объектом конфигурации с набором атрибутов, передаваемых при удовлетворении условия.</span><span class="sxs-lookup"><span data-stu-id="dfe38-228">A Synchronization Rule is a configuration object with a set of attributes flowing when a condition is satisfied.</span></span> <span data-ttu-id="dfe38-229">Кроме того, оно позволяет описать, как объект в пространстве соединителя связан с объектом в метавселенной, называемым **соединением** или **совпадением**.</span><span class="sxs-lookup"><span data-stu-id="dfe38-229">It is also used to describe how an object in a connector space is related to an object in the metaverse, known as **join** or **match**.</span></span> <span data-ttu-id="dfe38-230">Для правил синхронизации заданы значения приоритета, которые обозначают порядок их использования.</span><span class="sxs-lookup"><span data-stu-id="dfe38-230">The Synchronization Rules have a precedence value indicating how they relate to each other.</span></span> <span data-ttu-id="dfe38-231">Правило синхронизации с меньшим числовым значением имеет более высокий приоритет. В случае конфликта потоков атрибутов выполняется правило с более высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="dfe38-231">A Synchronization Rule with a lower numeric value has a higher precedence and in an attribute flow conflict, higher precedence wins the conflict resolution.</span></span>

<span data-ttu-id="dfe38-232">В качестве примера рассмотрим правило синхронизации **In from AD – User AccountEnabled**(Поступление из AD — учетная запись включена).</span><span class="sxs-lookup"><span data-stu-id="dfe38-232">As an example, look at the Synchronization Rule **In from AD – User AccountEnabled**.</span></span> <span data-ttu-id="dfe38-233">Отметьте эту строку в редакторе правил синхронизации и нажмите кнопку **Изменить**.</span><span class="sxs-lookup"><span data-stu-id="dfe38-233">Mark this line in the SRE and select **Edit**.</span></span>

<span data-ttu-id="dfe38-234">Так как это правило входит в стандартный набор, при его открытии отобразится предупреждение.</span><span class="sxs-lookup"><span data-stu-id="dfe38-234">Since this rule is an out-of-box rule, you receive a warning when you open the rule.</span></span> <span data-ttu-id="dfe38-235">Не следует без необходимости вносить [изменения в стандартные правила](active-directory-aadconnectsync-best-practices-changing-default-configuration.md), поэтому редактор уточняет ваши намерения.</span><span class="sxs-lookup"><span data-stu-id="dfe38-235">You should not make any [changes to out-of-box rules](active-directory-aadconnectsync-best-practices-changing-default-configuration.md), so you are asked what your intentions are.</span></span> <span data-ttu-id="dfe38-236">Сейчас мы будем только просматривать правило.</span><span class="sxs-lookup"><span data-stu-id="dfe38-236">In this case, you only want to view the rule.</span></span> <span data-ttu-id="dfe38-237">Выберите вариант **Нет**.</span><span class="sxs-lookup"><span data-stu-id="dfe38-237">Select **No**.</span></span>

![Предупреждение правил синхронизации](./media/active-directory-aadconnectsync-understanding-default-configuration/warningeditrule.png)

<span data-ttu-id="dfe38-239">Правило синхронизации имеет четыре раздела конфигурации: описание, преобразование, правила объединения и фильтр области действия.</span><span class="sxs-lookup"><span data-stu-id="dfe38-239">A Synchronization Rule has four configuration sections: Description, Scoping filter, Join rules, and Transformations.</span></span>

#### <a name="description"></a><span data-ttu-id="dfe38-240">Описание</span><span class="sxs-lookup"><span data-stu-id="dfe38-240">Description</span></span>
<span data-ttu-id="dfe38-241">Первый раздел содержит основные сведения, такие как имя и описание.</span><span class="sxs-lookup"><span data-stu-id="dfe38-241">The first section provides basic information such as a name and description.</span></span>

![<span data-ttu-id="dfe38-242">Вкладка "Описание" в редакторе правил синхронизации</span><span class="sxs-lookup"><span data-stu-id="dfe38-242">Description tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncruledescription.png)

<span data-ttu-id="dfe38-243">Кроме того, здесь находятся сведения о том, к какой подключенной системе это правило относится, к какому типу объекта в подключенной системе оно применяется, а также о типе объекта метавселенной.</span><span class="sxs-lookup"><span data-stu-id="dfe38-243">You also find information about which connected system this rule is related to, which object type in the connected system it applies to, and the metaverse object type.</span></span> <span data-ttu-id="dfe38-244">Тип объекта метавселенной — это всегда лицо, независимо от того, является ли исходный тип объекта пользователем, iNetOrgPerson или контактом.</span><span class="sxs-lookup"><span data-stu-id="dfe38-244">The metaverse object type is always person regardless when the source object type is a user, iNetOrgPerson, or contact.</span></span> <span data-ttu-id="dfe38-245">Тип объекта метавселенной никогда не должен изменяться, поэтому он создается как универсальный тип.</span><span class="sxs-lookup"><span data-stu-id="dfe38-245">The metaverse object type should never change so it is created as a generic type.</span></span> <span data-ttu-id="dfe38-246">Тип связи можно задать как Join, StickyJoin или Provision.</span><span class="sxs-lookup"><span data-stu-id="dfe38-246">The Link Type can be set to Join, StickyJoin, or Provision.</span></span> <span data-ttu-id="dfe38-247">Эта настройка работает совместно с разделом Join Rules (Правила объединения), и мы рассмотрим это позднее.</span><span class="sxs-lookup"><span data-stu-id="dfe38-247">This setting works together with the Join Rules section and is covered later.</span></span>

<span data-ttu-id="dfe38-248">Кроме того, вы видите, что это правило синхронизации используется для синхронизации паролей.</span><span class="sxs-lookup"><span data-stu-id="dfe38-248">You can also see that this sync rule is used for password sync.</span></span> <span data-ttu-id="dfe38-249">Если пользователь находится в области действия этого правила, его пароль в рамках синхронизации передается из локального каталога в облако (разумеется, если вы активировали функцию синхронизации паролей).</span><span class="sxs-lookup"><span data-stu-id="dfe38-249">If a user is in scope for this sync rule, the password is synchronized from on-premises to cloud (assuming you have enabled the password sync feature).</span></span>

#### <a name="scoping-filter"></a><span data-ttu-id="dfe38-250">Фильтр области действия</span><span class="sxs-lookup"><span data-stu-id="dfe38-250">Scoping filter</span></span>
<span data-ttu-id="dfe38-251">Раздел "Фильтр области действия" позволяет настроить, когда следует применять правило синхронизации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-251">The Scoping Filter section is used to configure when a Synchronization Rule should apply.</span></span> <span data-ttu-id="dfe38-252">Имя правила синхронизации напоминает нам, что оно должно применяться только для включенных пользователей. Поэтому в настройках области действия уберите бит 2 для атрибута AD **userAccountControl**.</span><span class="sxs-lookup"><span data-stu-id="dfe38-252">Since the name of the Synchronization Rule you are looking at indicates it should only be applied for enabled users, the scope is configured so the AD attribute **userAccountControl** must not have the bit 2 set.</span></span> <span data-ttu-id="dfe38-253">Это правило применяется к пользователям, обнаруженным модулем синхронизации в AD, для атрибута **userAccountControl** которых задано десятичное значение 512 (включен обычный пользователь).</span><span class="sxs-lookup"><span data-stu-id="dfe38-253">When the sync engine finds a user in AD, it applies this sync rule when **userAccountControl** is set to the decimal value 512 (enabled normal user).</span></span> <span data-ttu-id="dfe38-254">Если атрибут **userAccountControl** имеет значение 514 (отключен обычный пользователь), правило применяться не будет.</span><span class="sxs-lookup"><span data-stu-id="dfe38-254">It does not apply the rule when the user has **userAccountControl** set to 514 (disabled normal user).</span></span>

![<span data-ttu-id="dfe38-255">Вкладка "Определение области" в редакторе правил синхронизации</span><span class="sxs-lookup"><span data-stu-id="dfe38-255">Scoping tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulescopingfilter.png)

<span data-ttu-id="dfe38-256">Фильтр области действия содержит группы и предложения, которые могут быть вложенными.</span><span class="sxs-lookup"><span data-stu-id="dfe38-256">The scoping filter has Groups and Clauses that can be nested.</span></span> <span data-ttu-id="dfe38-257">Для применения правила синхронизации должны удовлетворяться все предложения в группе.</span><span class="sxs-lookup"><span data-stu-id="dfe38-257">All clauses inside a group must be satisfied for a Synchronization Rule to apply.</span></span> <span data-ttu-id="dfe38-258">При определении нескольких групп для применения правила должна удовлетворяться по крайней мере одна группа.</span><span class="sxs-lookup"><span data-stu-id="dfe38-258">When multiple groups are defined, then at least one group must be satisfied for the rule to apply.</span></span> <span data-ttu-id="dfe38-259">Это значит, что между группами вычисляется логический оператор OR, а внутри группы — логический оператор AND.</span><span class="sxs-lookup"><span data-stu-id="dfe38-259">That is, a logical OR is evaluated between groups and a logical AND is evaluated inside a group.</span></span> <span data-ttu-id="dfe38-260">Пример этой конфигурации можно найти в исходящем правиле синхронизации **Out to AAD – Group Join**(Отправка в AAD — объединение групп).</span><span class="sxs-lookup"><span data-stu-id="dfe38-260">An example of this configuration can be found in the outbound Synchronization Rule **Out to AAD – Group Join**.</span></span> <span data-ttu-id="dfe38-261">Существуют несколько групп фильтров синхронизации, например для групп безопасности (`securityEnabled EQUAL True`) и для групп рассылки (`securityEnabled EQUAL False`).</span><span class="sxs-lookup"><span data-stu-id="dfe38-261">There are several synchronization filter groups, for example one for security groups (`securityEnabled EQUAL True`) and one for distribution groups (`securityEnabled EQUAL False`).</span></span>

![<span data-ttu-id="dfe38-262">Вкладка "Определение области" в редакторе правил синхронизации</span><span class="sxs-lookup"><span data-stu-id="dfe38-262">Scoping tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulescopingfilterout.png)

<span data-ttu-id="dfe38-263">Это правило используется для определения групп, которые должны быть подготовлены в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dfe38-263">This rule is used to define which Groups should be provisioned to Azure AD.</span></span> <span data-ttu-id="dfe38-264">Для синхронизации групп рассылки с Azure AD для них должна быть включена функция почты, но для групп безопасности это необязательно.</span><span class="sxs-lookup"><span data-stu-id="dfe38-264">Distribution Groups must be mail enabled to be synchronized with Azure AD, but for security groups an email is not required.</span></span>

#### <a name="join-rules"></a><span data-ttu-id="dfe38-265">Правила объединения</span><span class="sxs-lookup"><span data-stu-id="dfe38-265">Join rules</span></span>
<span data-ttu-id="dfe38-266">Третий раздел позволяет настроить, как объекты в пространстве соединителя относятся к объектам в метавселенной.</span><span class="sxs-lookup"><span data-stu-id="dfe38-266">The third section is used to configure how objects in the connector space relate to objects in the metaverse.</span></span> <span data-ttu-id="dfe38-267">Правило, рассматриваемое ранее, не содержит настроек для правил объединения, поэтому теперь мы рассмотрим правило **In from AD – User Join**(Поступление из AD — объединение пользователей).</span><span class="sxs-lookup"><span data-stu-id="dfe38-267">The rule you have looked at earlier does not have any configuration for Join Rules, so instead you are going to look at **In from AD – User Join**.</span></span>

![<span data-ttu-id="dfe38-268">Вкладка Join rules (Правила объединения) в редакторе правил синхронизации</span><span class="sxs-lookup"><span data-stu-id="dfe38-268">Join rules tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulejoinrules.png)

<span data-ttu-id="dfe38-269">Содержимое правил объединения зависит от параметра совпадения, выбранного в мастере установки.</span><span class="sxs-lookup"><span data-stu-id="dfe38-269">The content of the join rule depends on the matching option selected in the installation wizard.</span></span> <span data-ttu-id="dfe38-270">Для правила входящих подключений вычисление начинается с объекта в исходном пространстве соединителя, а затем последовательно вычисляется каждая группа в правилах объединения.</span><span class="sxs-lookup"><span data-stu-id="dfe38-270">For an inbound rule, the evaluation starts with an object in the source connector space and each group in the join rules is evaluated in sequence.</span></span> <span data-ttu-id="dfe38-271">Если вычисленный исходный объект совпадает в точности с одним объектом в метавселенной при использовании одного из правил объединения, объекты объединяются.</span><span class="sxs-lookup"><span data-stu-id="dfe38-271">If a source object is evaluated to match exactly one object in the metaverse using one of the join rules, the objects are joined.</span></span> <span data-ttu-id="dfe38-272">Если вычислены все правила и совпадений нет, то используется тип связи на странице описания.</span><span class="sxs-lookup"><span data-stu-id="dfe38-272">If all rules have been evaluated and there is no match, then the Link Type on the description page is used.</span></span> <span data-ttu-id="dfe38-273">Если этот параметр установлен как **Provision**, создается новый объект в целевом пространстве (метавселенной).</span><span class="sxs-lookup"><span data-stu-id="dfe38-273">If this configuration is set to **Provision**, then a new object is created in the target, the metaverse.</span></span> <span data-ttu-id="dfe38-274">Подготовка нового объекта в метавселенной также называется **проекцией** объекта в метавселенную.</span><span class="sxs-lookup"><span data-stu-id="dfe38-274">To provision a new object to the metaverse is also known as to **project** an object to the metaverse.</span></span>

<span data-ttu-id="dfe38-275">Правила объединения вычисляются только один раз.</span><span class="sxs-lookup"><span data-stu-id="dfe38-275">The join rules are only evaluated once.</span></span> <span data-ttu-id="dfe38-276">Когда объект пространства соединителя и объект метавселенной объединяются, они остаются объединенными, пока область действия правила синхронизации продолжает выполняться.</span><span class="sxs-lookup"><span data-stu-id="dfe38-276">When a connector space object and a metaverse object are joined, they remain joined as long as the scope of the Synchronization Rule is still satisfied.</span></span>

<span data-ttu-id="dfe38-277">При вычислении правил синхронизации в области действия должно находиться только одно правило синхронизации с определенными правилами объединения.</span><span class="sxs-lookup"><span data-stu-id="dfe38-277">When evaluating Synchronization Rules, only one Synchronization Rule with join rules defined must be in scope.</span></span> <span data-ttu-id="dfe38-278">Если для одного объекта найдено несколько правил синхронизации с правилами объединения, выдается ошибка.</span><span class="sxs-lookup"><span data-stu-id="dfe38-278">If multiple Synchronization Rules with join rules are found for one object, an error is thrown.</span></span> <span data-ttu-id="dfe38-279">По этой причине рекомендуется определить только одно правило синхронизации с объединением, если в области действия для объекта имеется несколько правил синхронизации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-279">For this reason, the best practice is to have only one Synchronization Rule with join defined when multiple Synchronization Rules are in scope for an object.</span></span> <span data-ttu-id="dfe38-280">В изначальной конфигурации для службы синхронизации Azure AD Connect эти правила можно найти по слову **Join** в конце имени.</span><span class="sxs-lookup"><span data-stu-id="dfe38-280">In the out-of-box configuration for Azure AD Connect sync, these rules can be found by looking at the name and find those with the word **Join** at the end of the name.</span></span> <span data-ttu-id="dfe38-281">Правило синхронизации без определенных правил объединения применяет потоки атрибутов, если другое правило синхронизации объединило объекты или подготовило новый объект в целевом пространстве.</span><span class="sxs-lookup"><span data-stu-id="dfe38-281">A Synchronization Rule without any join rules defined applies the attribute flows when another Synchronization Rule joined the objects together or provisioned a new object in the target.</span></span>

<span data-ttu-id="dfe38-282">На приведенном выше рисунке вы видите, что правило пытается объединить **objectSID** с **msExchMasterAccountSid** (Exchange) или **msRTCSIP-OriginatorSid** (Lync). Это логичное действие в рамках топологии, в которой есть леса учетных записей и ресурсов.</span><span class="sxs-lookup"><span data-stu-id="dfe38-282">If you look at the picture above, you can see that the rule is trying to join **objectSID** with **msExchMasterAccountSid** (Exchange) and **msRTCSIP-OriginatorSid** (Lync), which is what we expect in an account-resource forest topology.</span></span> <span data-ttu-id="dfe38-283">Такое же правило можно найти в каждом из лесов.</span><span class="sxs-lookup"><span data-stu-id="dfe38-283">You find the same rule on all forests.</span></span> <span data-ttu-id="dfe38-284">Предполагается, что каждый лес может быть лесом ресурсов или лесом учетных записей.</span><span class="sxs-lookup"><span data-stu-id="dfe38-284">The assumption is that every forest could be either an account or resource forest.</span></span> <span data-ttu-id="dfe38-285">Эта конфигурация также работает для учетных записей, которые существуют в одном лесу и не должны объединяться.</span><span class="sxs-lookup"><span data-stu-id="dfe38-285">This configuration also works if you have accounts that live in a single forest and do not have to be joined.</span></span>

#### <a name="transformations"></a><span data-ttu-id="dfe38-286">Преобразования</span><span class="sxs-lookup"><span data-stu-id="dfe38-286">Transformations</span></span>
<span data-ttu-id="dfe38-287">В разделе преобразований определяются все потоки атрибутов, применяемые к целевому объекту после объединения объектов и при удовлетворении фильтра области действия.</span><span class="sxs-lookup"><span data-stu-id="dfe38-287">The transformation section defines all attribute flows that apply to the target object when the objects are joined and the scope filter is satisfied.</span></span> <span data-ttu-id="dfe38-288">Вернувшись к правилу синхронизации **In from AD – User AccountEnabled** (Поступление из AD — учетная запись включена), вы найдете следующие преобразования.</span><span class="sxs-lookup"><span data-stu-id="dfe38-288">Going back to the **In from AD – User AccountEnabled** Synchronization Rule, you find the following transformations:</span></span>

![<span data-ttu-id="dfe38-289">Вкладка "Преобразования" в редакторе правил синхронизации</span><span class="sxs-lookup"><span data-stu-id="dfe38-289">Transformations tab in Sync rule editor</span></span> ](./media/active-directory-aadconnectsync-understanding-default-configuration/syncruletransformations.png)

<span data-ttu-id="dfe38-290">В общем контексте конфигурации при развертывании леса Account-Resource ожидается, что будет найдена включенная учетная запись в лесу учетных записей и отключенная учетная запись в лесу ресурсов с параметрами Exchange и Lync.</span><span class="sxs-lookup"><span data-stu-id="dfe38-290">To put this configuration in context, in an Account-Resource forest deployment, it is expected to find an enabled account in the account forest and a disabled account in the resource forest with Exchange and Lync settings.</span></span> <span data-ttu-id="dfe38-291">Рассматриваемое правило синхронизации содержит атрибуты, необходимые для входа, и их требуется передать из леса с включенной учетной записью.</span><span class="sxs-lookup"><span data-stu-id="dfe38-291">The Synchronization Rule you are looking at contains the attributes required for sign-in and these attributes should flow from the forest where there is an enabled account.</span></span> <span data-ttu-id="dfe38-292">Эти потоки атрибутов вместе помещаются в одно правило синхронизации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-292">All these attribute flows are put together in one Synchronization Rule.</span></span>

<span data-ttu-id="dfe38-293">Преобразования могут быть разных типов: константа, прямое или выражение.</span><span class="sxs-lookup"><span data-stu-id="dfe38-293">A transformation can have different types: Constant, Direct, and Expression.</span></span>

* <span data-ttu-id="dfe38-294">Поток-константа всегда передает жестко закодированное значение.</span><span class="sxs-lookup"><span data-stu-id="dfe38-294">A constant flow always flows a hardcoded value.</span></span> <span data-ttu-id="dfe38-295">В приведенном выше случае в атрибуте метавселенной с именем **accountEnabled** всегда устанавливается значение **True**.</span><span class="sxs-lookup"><span data-stu-id="dfe38-295">In the case above, it always sets the value **True** in the metaverse attribute named **accountEnabled**.</span></span>
* <span data-ttu-id="dfe38-296">Прямой поток всегда передает значение атрибута из источника в целевой атрибут без изменений.</span><span class="sxs-lookup"><span data-stu-id="dfe38-296">A direct flow always flows the value of the attribute in the source to the target attribute as-is.</span></span>
* <span data-ttu-id="dfe38-297">Третий тип потока — выражение (Expression). Он дает возможность создавать более сложные конфигурации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-297">The third flow type is Expression and it allows for more advanced configurations.</span></span>

<span data-ttu-id="dfe38-298">Языком выражений является VBA (Visual Basic для приложений), поэтому пользователи, обладающие опытом работы с Microsoft Office или VBScript, распознают этот формат.</span><span class="sxs-lookup"><span data-stu-id="dfe38-298">The expression language is VBA (Visual Basic for Applications), so people with experience of Microsoft Office or VBScript will recognize the format.</span></span> <span data-ttu-id="dfe38-299">Атрибуты заключаются в квадратные скобки: [attributeName].</span><span class="sxs-lookup"><span data-stu-id="dfe38-299">Attributes are enclosed in square brackets, [attributeName].</span></span> <span data-ttu-id="dfe38-300">В именах атрибутов и функций учитывается регистр, но редактор правил синхронизации проверяет выражения и предупреждает, если выражение недопустимое.</span><span class="sxs-lookup"><span data-stu-id="dfe38-300">Attribute names and function names are case-sensitive, but the Synchronization Rules Editor evaluates the expressions and provide a warning if the expression is not valid.</span></span> <span data-ttu-id="dfe38-301">Все выражения выражаются в одной строке с вложенными функциями.</span><span class="sxs-lookup"><span data-stu-id="dfe38-301">All expressions are expressed on a single line with nested functions.</span></span> <span data-ttu-id="dfe38-302">Для демонстрации возможностей языка конфигурации ниже приведен поток для pwdLastSet, в который вставлены дополнительные комментарии.</span><span class="sxs-lookup"><span data-stu-id="dfe38-302">To show the power of the configuration language, here is the flow for pwdLastSet, but with additional comments inserted:</span></span>

```
// If-then-else
IIF(
// (The evaluation for IIF) Is the attribute pwdLastSet present in AD?
IsPresent([pwdLastSet]),
// (The True part of IIF) If it is, then from right to left, convert the AD time format to a .Net datetime, change it to the time format used by Azure AD, and finally convert it to a string.
CStr(FormatDateTime(DateFromNum([pwdLastSet]),"yyyyMMddHHmmss.0Z")),
// (The False part of IIF) Nothing to contribute
NULL
)
```

<span data-ttu-id="dfe38-303">Дополнительные сведения о языке выражений для потоков атрибутов см. в статье [Служба синхронизации Azure AD Connect: общие сведения о выражениях декларативной подготовки](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="dfe38-303">See [Understanding Declarative Provisioning Expressions](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md) for more information on the expression language for attribute flows.</span></span>

### <a name="precedence"></a><span data-ttu-id="dfe38-304">Приоритет</span><span class="sxs-lookup"><span data-stu-id="dfe38-304">Precedence</span></span>
<span data-ttu-id="dfe38-305">Вы рассмотрели несколько правил синхронизации по отдельности, но в конфигурации они работают совместно.</span><span class="sxs-lookup"><span data-stu-id="dfe38-305">You have now looked at some individual Synchronization Rules, but the rules work together in the configuration.</span></span> <span data-ttu-id="dfe38-306">В некоторых случаях несколько правил синхронизации влияют на значение одного целевого атрибута.</span><span class="sxs-lookup"><span data-stu-id="dfe38-306">In some cases, an attribute value is contributed from multiple synchronization rules to the same target attribute.</span></span> <span data-ttu-id="dfe38-307">В таких случаях атрибут выбирается на основании приоритета атрибутов.</span><span class="sxs-lookup"><span data-stu-id="dfe38-307">In this case, attribute precedence is used to determine which attribute wins.</span></span> <span data-ttu-id="dfe38-308">В качестве примера рассмотрите атрибут sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="dfe38-308">As an example, look at the attribute sourceAnchor.</span></span> <span data-ttu-id="dfe38-309">Этот атрибут важен для входа в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="dfe38-309">This attribute is an important attribute to be able to sign in to Azure AD.</span></span> <span data-ttu-id="dfe38-310">Потоки для этого атрибута есть в двух различных правилах синхронизации: **In from AD – User AccountEnabled** (Поступление из AD — учетная запись включена) и **In from AD – User Common** (Поступление из AD — все пользователи).</span><span class="sxs-lookup"><span data-stu-id="dfe38-310">You can find an attribute flow for this attribute in two different Synchronization Rules, **In from AD – User AccountEnabled** and **In from AD – User Common**.</span></span> <span data-ttu-id="dfe38-311">Приоритет правил синхронизации таков, что атрибут sourceAnchor заполняется в первую очередь из леса с действующей учетной записью, когда к объекту метавселенной присоединяются несколько объектов.</span><span class="sxs-lookup"><span data-stu-id="dfe38-311">Due to Synchronization Rule precedence, the sourceAnchor attribute is contributed from the forest with an enabled account first when there are several objects joined to the metaverse object.</span></span> <span data-ttu-id="dfe38-312">Если нет включенных учетных записей, модуль синхронизации использует универсальное правило синхронизации **In from AD – User Common**(Поступление из AD — все пользователи).</span><span class="sxs-lookup"><span data-stu-id="dfe38-312">If there are no enabled accounts, then the sync engine uses the catch-all Synchronization Rule **In from AD – User Common**.</span></span> <span data-ttu-id="dfe38-313">Эта конфигурация гарантирует, что атрибут sourceAnchor будет присутствовать даже в отключенных учетных записях.</span><span class="sxs-lookup"><span data-stu-id="dfe38-313">This configuration ensures that even for accounts that are disabled, there is still a sourceAnchor.</span></span>

![Входящие правила синхронизации](./media/active-directory-aadconnectsync-understanding-default-configuration/syncrulesinbound.png)

<span data-ttu-id="dfe38-315">Мастер установки определяет приоритет для групп правил синхронизации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-315">The precedence for Synchronization Rules is set in groups by the installation wizard.</span></span> <span data-ttu-id="dfe38-316">Все правила в группе имеют одинаковое имя, но они присоединены к разным подключенным каталогам.</span><span class="sxs-lookup"><span data-stu-id="dfe38-316">All rules in a group have the same name, but they are connected to different connected directories.</span></span> <span data-ttu-id="dfe38-317">Мастер установки устанавливает наивысший приоритет правилу **In from AD – User Join** (Поступление из AD — объединение пользователей) для всех подключенных каталогов AD.</span><span class="sxs-lookup"><span data-stu-id="dfe38-317">The installation wizard gives the rule **In from AD – User Join** highest precedence and it iterates over all connected AD directories.</span></span> <span data-ttu-id="dfe38-318">Затем он переходит к следующей группе правил в предопределенном порядке.</span><span class="sxs-lookup"><span data-stu-id="dfe38-318">It then continues with the next groups of rules in a predefined order.</span></span> <span data-ttu-id="dfe38-319">Внутри группы правила добавляются в том порядке, в котором добавлены соединители в мастере.</span><span class="sxs-lookup"><span data-stu-id="dfe38-319">Inside a group, the rules are added in the order the Connectors were added in the wizard.</span></span> <span data-ttu-id="dfe38-320">Если добавить новый соединитель с использованием мастера, он изменяет порядок правил синхронизации, при этом правила нового соединителя будут последними в каждой группе.</span><span class="sxs-lookup"><span data-stu-id="dfe38-320">If another Connector is added through the wizard, the Synchronization Rules are reordered and the new Connector’s rules are inserted last in each group.</span></span>

### <a name="putting-it-all-together"></a><span data-ttu-id="dfe38-321">Сборка</span><span class="sxs-lookup"><span data-stu-id="dfe38-321">Putting it all together</span></span>
<span data-ttu-id="dfe38-322">Теперь мы знаем достаточно о правилах синхронизации, чтобы понимать работу конфигураций с различными правилами синхронизации.</span><span class="sxs-lookup"><span data-stu-id="dfe38-322">We now know enough about Synchronization Rules to be able to understand how the configuration works with the different Synchronization Rules.</span></span> <span data-ttu-id="dfe38-323">Правила в отношении пользователя и атрибутов, добавляемых в метавселенную, применяются в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="dfe38-323">If you look at a user and the attributes that are contributed to the metaverse, the rules are applied in the following order:</span></span>

| <span data-ttu-id="dfe38-324">Имя</span><span class="sxs-lookup"><span data-stu-id="dfe38-324">Name</span></span> | <span data-ttu-id="dfe38-325">Комментарий</span><span class="sxs-lookup"><span data-stu-id="dfe38-325">Comment</span></span> |
|:--- |:--- |
| <span data-ttu-id="dfe38-326">In from AD – User Join</span><span class="sxs-lookup"><span data-stu-id="dfe38-326">In from AD – User Join</span></span> |<span data-ttu-id="dfe38-327">Правило для присоединения к метавселенной объектов из пространства соединителя.</span><span class="sxs-lookup"><span data-stu-id="dfe38-327">Rule for joining connector space objects with metaverse.</span></span> |
| <span data-ttu-id="dfe38-328">Поступление из AD — учетная запись включена</span><span class="sxs-lookup"><span data-stu-id="dfe38-328">In from AD – UserAccount Enabled</span></span> |<span data-ttu-id="dfe38-329">Атрибуты, необходимые для входа в Azure AD и Office 365.</span><span class="sxs-lookup"><span data-stu-id="dfe38-329">Attributes required for sign-in to Azure AD and Office 365.</span></span> <span data-ttu-id="dfe38-330">Эти атрибуты нужно перенести из включенной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="dfe38-330">We want these attributes from the enabled account.</span></span> |
| <span data-ttu-id="dfe38-331">Поступление из AD — все пользователи с сервера Exchange</span><span class="sxs-lookup"><span data-stu-id="dfe38-331">In from AD – User Common from Exchange</span></span> |<span data-ttu-id="dfe38-332">Атрибуты из глобального списка адресов.</span><span class="sxs-lookup"><span data-stu-id="dfe38-332">Attributes found in the Global Address List.</span></span> <span data-ttu-id="dfe38-333">Мы предполагаем, что качество этих данных выше в том лесу, где у пользователя есть почтовый ящик.</span><span class="sxs-lookup"><span data-stu-id="dfe38-333">We assume the data quality is best in the forest where we have found the user’s mailbox.</span></span> |
| <span data-ttu-id="dfe38-334">In from AD – User Common</span><span class="sxs-lookup"><span data-stu-id="dfe38-334">In from AD – User Common</span></span> |<span data-ttu-id="dfe38-335">Атрибуты из глобального списка адресов.</span><span class="sxs-lookup"><span data-stu-id="dfe38-335">Attributes found in the Global Address List.</span></span> <span data-ttu-id="dfe38-336">Если мы не нашли почтовый ящик, значение атрибута может предоставить любой присоединенный объект.</span><span class="sxs-lookup"><span data-stu-id="dfe38-336">In case we didn’t find a mailbox, any other joined object can contribute the attribute value.</span></span> |
| <span data-ttu-id="dfe38-337">Поступление из AD — пользователь Exchange</span><span class="sxs-lookup"><span data-stu-id="dfe38-337">In from AD – User Exchange</span></span> |<span data-ttu-id="dfe38-338">Правило существует, только если обнаружена платформа Exchange.</span><span class="sxs-lookup"><span data-stu-id="dfe38-338">Only exists if Exchange has been detected.</span></span> <span data-ttu-id="dfe38-339">Передает все атрибуты инфраструктуры Exchange.</span><span class="sxs-lookup"><span data-stu-id="dfe38-339">It flows all infrastructure Exchange attributes.</span></span> |
| <span data-ttu-id="dfe38-340">Поступление из AD — пользователь Lync</span><span class="sxs-lookup"><span data-stu-id="dfe38-340">In from AD – User Lync</span></span> |<span data-ttu-id="dfe38-341">Правило существует, только если обнаружена платформа Lync.</span><span class="sxs-lookup"><span data-stu-id="dfe38-341">Only exists if Lync has been detected.</span></span> <span data-ttu-id="dfe38-342">Передает все атрибуты инфраструктуры Lync.</span><span class="sxs-lookup"><span data-stu-id="dfe38-342">It flows all infrastructure Lync attributes.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="dfe38-343">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="dfe38-343">Next steps</span></span>
* <span data-ttu-id="dfe38-344">Дополнительные сведения о модели конфигурации, см. в статье о [принципах декларативной подготовки](active-directory-aadconnectsync-understanding-declarative-provisioning.md).</span><span class="sxs-lookup"><span data-stu-id="dfe38-344">Read more about the configuration model in [Understanding Declarative Provisioning](active-directory-aadconnectsync-understanding-declarative-provisioning.md).</span></span>
* <span data-ttu-id="dfe38-345">Дополнительные сведения о языке выражений см. в статье [Служба синхронизации Azure AD Connect: общие сведения о выражениях декларативной подготовки](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="dfe38-345">Read more about the expression language in [Understanding Declarative Provisioning Expressions](active-directory-aadconnectsync-understanding-declarative-provisioning-expressions.md).</span></span>
* <span data-ttu-id="dfe38-346">Дополнительные сведения о принципах работы стандартной конфигурации см. в статье [Службы синхронизации Azure AD Connect: изменение конфигурации по умолчанию](active-directory-aadconnectsync-understanding-users-and-contacts.md).</span><span class="sxs-lookup"><span data-stu-id="dfe38-346">Continue reading how the out-of-box configuration works in [Understanding Users and Contacts](active-directory-aadconnectsync-understanding-users-and-contacts.md)</span></span>
* <span data-ttu-id="dfe38-347">Инструкции по практическим изменениям с помощью декларативной подготовки см. в статье [Службы синхронизации Azure AD Connect: изменение конфигурации по умолчанию](active-directory-aadconnectsync-change-the-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="dfe38-347">See how to make a practical change using declarative provisioning in [How to make a change to the default configuration](active-directory-aadconnectsync-change-the-configuration.md).</span></span>

<span data-ttu-id="dfe38-348">**Обзорные статьи**</span><span class="sxs-lookup"><span data-stu-id="dfe38-348">**Overview topics**</span></span>

* [<span data-ttu-id="dfe38-349">Службы синхронизации Azure AD Connect: общие сведений о синхронизации и ее настройка</span><span class="sxs-lookup"><span data-stu-id="dfe38-349">Azure AD Connect sync: Understand and customize synchronization</span></span>](active-directory-aadconnectsync-whatis.md)
* [<span data-ttu-id="dfe38-350">Интеграция локальных удостоверений с Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="dfe38-350">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)

