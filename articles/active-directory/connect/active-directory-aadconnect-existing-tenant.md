---
title: "Использование Azure AD Connect при наличии существующего клиента Azure AD | Документация Майкрософт"
description: "В этом разделе описывается использование Connect при наличии существующего клиента Azure AD."
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: 908c576b0427a23934c844362a4fd69443800d0f
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-when-you-have-an-existent-tenant"></a><span data-ttu-id="922be-103">Azure AD Connect: если имеется существующий клиент</span><span class="sxs-lookup"><span data-stu-id="922be-103">Azure AD Connect: When you have an existent tenant</span></span>
<span data-ttu-id="922be-104">В большинстве разделов об использовании Azure AD Connect предполагается, что вы начинаете с нового клиента Azure AD, в котором отсутствуют какие-либо пользователи или другие объекты.</span><span class="sxs-lookup"><span data-stu-id="922be-104">Most of the topics for how to use Azure AD Connect assumes you start with a new Azure AD tenant and that there are no users or other objects there.</span></span> <span data-ttu-id="922be-105">Но если вы начали с клиента Azure AD, заполнили его пользователями и другими объектами, а теперь хотите использовать Connect, то этот раздел предназначен именно для вас.</span><span class="sxs-lookup"><span data-stu-id="922be-105">But if you have started with an Azure AD tenant, populated it with users and other objects, and now want to use Connect, then this topic is for you.</span></span>

## <a name="the-basics"></a><span data-ttu-id="922be-106">Основные сведения</span><span class="sxs-lookup"><span data-stu-id="922be-106">The basics</span></span>
<span data-ttu-id="922be-107">Объект в Azure AD управляется в облаке (Azure AD) или в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="922be-107">An object in Azure AD is either mastered in the cloud (Azure AD) or on-premises.</span></span> <span data-ttu-id="922be-108">Невозможно управлять одними атрибутами отдельного объекта в локальной среде, а другими — в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="922be-108">For one single object, you cannot manage some attributes on-premises and some other attributes in Azure AD.</span></span> <span data-ttu-id="922be-109">У каждого объекта имеется флаг, указывающий, где осуществляется управление этим объектом.</span><span class="sxs-lookup"><span data-stu-id="922be-109">Each object has a flag indicating where the object is managed.</span></span>

<span data-ttu-id="922be-110">Можно управлять одними пользователями в локальной среде, а другими — в облаке.</span><span class="sxs-lookup"><span data-stu-id="922be-110">You can manage some users on-premises and other in the cloud.</span></span> <span data-ttu-id="922be-111">Распространенный сценарий для этой конфигурации — организация, состоящая из сотрудников отдела бухгалтерии и отдела продаж.</span><span class="sxs-lookup"><span data-stu-id="922be-111">A common scenario for this configuration is an organization with a mix of accounting workers and sales workers.</span></span> <span data-ttu-id="922be-112">Сотрудники отдела бухгалтерии используют локальную учетную запись AD, а сотрудники отдела продаж  — учетную запись в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="922be-112">The accounting workers have an on-premises AD account, but the sales workers do not, they have an account in Azure AD.</span></span> <span data-ttu-id="922be-113">Будет удобно управлять одними пользователями в локальной среде, а другими — в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="922be-113">You would manage some users on-premises and some in Azure AD.</span></span>

<span data-ttu-id="922be-114">Если вы начали управлять пользователями в Azure AD, и некоторые пользователи также имеются в локальной среде AD, и вам потребовалось использовать Connect, то следует учесть некоторые дополнительные моменты.</span><span class="sxs-lookup"><span data-stu-id="922be-114">If you started to manage users in Azure AD that are also in on-premises AD and later want to use Connect, then there are some additional concerns you need to consider.</span></span>

## <a name="sync-with-existing-users-in-azure-ad"></a><span data-ttu-id="922be-115">Синхронизация с существующими пользователями в Azure AD</span><span class="sxs-lookup"><span data-stu-id="922be-115">Sync with existing users in Azure AD</span></span>
<span data-ttu-id="922be-116">Когда вы установите Azure AD Connect и начнете синхронизацию, служба синхронизации Azure AD (в Azure AD) будет проверять каждый новый объект и пытаться найти существующий объект для сопоставления.</span><span class="sxs-lookup"><span data-stu-id="922be-116">When you install Azure AD Connect and you start synchronizing, the Azure AD sync service (in Azure AD) does a check on every new object and try to find an existing object to match.</span></span> <span data-ttu-id="922be-117">Для этого используются три атрибута: **userPrincipalName**, **proxyAddresses** и **sourceAnchor**/**immutableID**.</span><span class="sxs-lookup"><span data-stu-id="922be-117">There are three attributes used for this process: **userPrincipalName**, **proxyAddresses**, and **sourceAnchor**/**immutableID**.</span></span> <span data-ttu-id="922be-118">Сопоставление по **userPrincipalName** и **proxyAddresses** называется **нестрогим сопоставлением**.</span><span class="sxs-lookup"><span data-stu-id="922be-118">A match on **userPrincipalName** and **proxyAddresses** is known as a **soft match**.</span></span> <span data-ttu-id="922be-119">Сопоставление по**sourceAnchor** называется **строгим сопоставлением**.</span><span class="sxs-lookup"><span data-stu-id="922be-119">A match on **sourceAnchor** is known as **hard match**.</span></span> <span data-ttu-id="922be-120">Для оценки по атрибуту **proxyAddresses** используются только значения с **SMTP:**, представляющие собой основной электронный адрес.</span><span class="sxs-lookup"><span data-stu-id="922be-120">For the **proxyAddresses** attribute only the value with **SMTP:**, that is the primary email address, is used for the evaluation.</span></span>

<span data-ttu-id="922be-121">Соответствие оценивается только для новых объектов, поступающих из Connect.</span><span class="sxs-lookup"><span data-stu-id="922be-121">The match is only evaluated for new objects coming from Connect.</span></span> <span data-ttu-id="922be-122">Если изменить существующий объект, чтобы он соответствовал какому-либо из этих атрибутов, то появится сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="922be-122">If you change an exiting object so it is matching any of these attributes, then you see an error instead.</span></span>

<span data-ttu-id="922be-123">Если Azure AD находит объект, значения атрибутов которого совпадают с объектом, поступившим из Connect, и он уже существует в Azure AD, то предпочтение отдается объекту из Connect.</span><span class="sxs-lookup"><span data-stu-id="922be-123">If Azure AD finds an object where the attribute values are the same for an object coming from Connect and that it is already present in Azure AD, then the object in Azure AD is taken over by Connect.</span></span> <span data-ttu-id="922be-124">Объект, ранее управляемый облаком, помечается как управляемый локально.</span><span class="sxs-lookup"><span data-stu-id="922be-124">The previously cloud-managed object is flagged as on-premises managed.</span></span> <span data-ttu-id="922be-125">Все атрибуты в Azure AD, значения которых есть в локальной среде AD, перезаписываются локальными значениями.</span><span class="sxs-lookup"><span data-stu-id="922be-125">All attributes in Azure AD with a value in on-premises AD are overwritten with the on-premises value.</span></span> <span data-ttu-id="922be-126">Исключением является ситуация, когда атрибут имеет значение **NULL** в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="922be-126">The exception is when an attribute has a **NULL** value on-premises.</span></span> <span data-ttu-id="922be-127">В этом случае значение в Azure AD остается, но вы можете изменить его в локальной среде на другое.</span><span class="sxs-lookup"><span data-stu-id="922be-127">In this case, the value in Azure AD remains, but you can still only change it on-premises to something else.</span></span>

> [!WARNING]
> <span data-ttu-id="922be-128">Так как все атрибуты в Azure AD будут перезаписаны значениями из локальной среды, убедитесь, что в ней хранятся корректные данные.</span><span class="sxs-lookup"><span data-stu-id="922be-128">Since all attributes in Azure AD are going to be overwritten by the on-premises value, make sure you have good data on-premises.</span></span> <span data-ttu-id="922be-129">Например, если вы только использовали управляемый электронный адрес в Office 365 и не обновляли его в локальной среде AD DS, то будут потеряны все значения в Azure AD и Office 365, которые отсутствуют в AD DS.</span><span class="sxs-lookup"><span data-stu-id="922be-129">For example, if you only have managed email address in Office 365 and not kept it updated in on-premises AD DS, then you lose any values in Azure AD/Office 365 not present in AD DS.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="922be-130">Если используется синхронизация паролей, которая всегда включена при стандартных параметрах, то пароль в Azure AD перезаписывается паролем в локальной среде AD.</span><span class="sxs-lookup"><span data-stu-id="922be-130">If you use password sync, which is always used by express settings, then the password in Azure AD is overwritten with the password in on-premises AD.</span></span> <span data-ttu-id="922be-131">Если пользователи управляли разными паролями, то после установки Connect им необходимо сообщить о том, что следует использовать локальный пароль.</span><span class="sxs-lookup"><span data-stu-id="922be-131">If your users are used to manage different passwords, then you need to inform them that they should use the on-premises password when you have installed Connect.</span></span>

<span data-ttu-id="922be-132">При планировании необходимо учитывать предыдущий раздел и приведенные предупреждения.</span><span class="sxs-lookup"><span data-stu-id="922be-132">The previous section and warning must be considered in your planning.</span></span> <span data-ttu-id="922be-133">В случае внесения множества изменений в Azure AD, которые не отражены в локальной среде AD DS, нужно запланировать заполнение AD DS обновленными значениями перед синхронизацией объектов с помощью Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="922be-133">If you have made many changes in Azure AD not reflected in on-premises AD DS, then you need to plan for how to populate AD DS with the updated values before you sync your objects with Azure AD Connect.</span></span>

<span data-ttu-id="922be-134">Если объекты были сопоставлены нестрого, то в объект в Azure AD добавляется атрибут **sourceAnchor**, позволяющий в дальнейшем использовать строгое сопоставление.</span><span class="sxs-lookup"><span data-stu-id="922be-134">If you matched your objects with a soft-match, then the **sourceAnchor** is added to the object in Azure AD so a hard match can be used later.</span></span>

### <a name="hard-match-vs-soft-match"></a><span data-ttu-id="922be-135">Строгое и нестрогое сопоставление</span><span class="sxs-lookup"><span data-stu-id="922be-135">Hard-match vs Soft-match</span></span>
<span data-ttu-id="922be-136">Для нового установленного экземпляра Connect нет практической разницы между строгим и нестрогим сопоставлением.</span><span class="sxs-lookup"><span data-stu-id="922be-136">For a new installation of Connect, there is no practical difference between a soft- and a hard-match.</span></span> <span data-ttu-id="922be-137">Различие имеется в случае аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="922be-137">The difference is in a disaster recovery situation.</span></span> <span data-ttu-id="922be-138">В случае потери сервера с Azure AD Connect можно повторно установить новый экземпляр без потери данных.</span><span class="sxs-lookup"><span data-stu-id="922be-138">If you have lost your server with Azure AD Connect, you can reinstall a new instance without losing any data.</span></span> <span data-ttu-id="922be-139">Во время первоначальной установки в Connect передается объект с атрибутом sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="922be-139">An object with a sourceAnchor is sent to Connect during initial install.</span></span> <span data-ttu-id="922be-140">Затем клиент (Azure AD Connect) может оценить соответствие, что будет гораздо быстрее, чем оценка соответствия в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="922be-140">The match can then be evaluated by the client (Azure AD Connect), which is a lot faster than doing the same in Azure AD.</span></span> <span data-ttu-id="922be-141">Строгое сопоставление оценивается Connect и Azure AD.</span><span class="sxs-lookup"><span data-stu-id="922be-141">A hard match is evaluated both by Connect and by Azure AD.</span></span> <span data-ttu-id="922be-142">Нестрогое сопоставление оценивается только Azure AD.</span><span class="sxs-lookup"><span data-stu-id="922be-142">A soft match is only evaluated by Azure AD.</span></span>

### <a name="other-objects-than-users"></a><span data-ttu-id="922be-143">Объекты, отличные от пользователей</span><span class="sxs-lookup"><span data-stu-id="922be-143">Other objects than users</span></span>
<span data-ttu-id="922be-144">Как правило, у пользователей имеются атрибуты userPrincipalName и proxyAddresses, что упрощает сопоставление.</span><span class="sxs-lookup"><span data-stu-id="922be-144">Users usually have both userPrincipalName and proxyAddresses, making the match easy.</span></span> <span data-ttu-id="922be-145">Но у других объектов, таких как группы безопасности, их нет.</span><span class="sxs-lookup"><span data-stu-id="922be-145">But other objects, such as security groups, do not have those.</span></span> <span data-ttu-id="922be-146">В этом случае возможна только строгое сопоставление по атрибуту sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="922be-146">In this case, you can only match on a hard match using the sourceAnchor.</span></span> <span data-ttu-id="922be-147">В локальной среде атрибут SourceAnchor всегда представляет собой **objectGUID**, преобразованный в Base64. Поэтому необходимо обновить значение в Azure AD, если требуется сопоставить два объекта.</span><span class="sxs-lookup"><span data-stu-id="922be-147">The sourceAnchor is always the Base64 converted **objectGUID** on-premises, so you must update the value in Azure AD when you need two objects to match.</span></span> <span data-ttu-id="922be-148">Атрибут SourceAnchor/immutableID можно обновить только с помощью PowerShell, а не через порталы.</span><span class="sxs-lookup"><span data-stu-id="922be-148">The sourceAnchor/immutableID can only be updated with PowerShell and not through the portals.</span></span>

## <a name="create-a-new-on-premises-active-directory-from-data-in-azure-ad"></a><span data-ttu-id="922be-149">Создание локальной службы Active Directory на основе данных в Azure AD</span><span class="sxs-lookup"><span data-stu-id="922be-149">Create a new on-premises Active Directory from data in Azure AD</span></span>
<span data-ttu-id="922be-150">Некоторые клиенты начинают с облачного решения на основе Azure AD и не используют локальную среду AD.</span><span class="sxs-lookup"><span data-stu-id="922be-150">Some customers start with a cloud-only solution with Azure AD and they do not have an on-premises AD.</span></span> <span data-ttu-id="922be-151">Позднее возникает необходимость использовать локальные ресурсы, и они создают локальную среду AD на основании данных Azure AD.</span><span class="sxs-lookup"><span data-stu-id="922be-151">Later they want to consume on-premises resources and want to build an on-premises AD based on Azure AD data.</span></span> <span data-ttu-id="922be-152">В этом случае Azure AD Connect ничем не поможет.</span><span class="sxs-lookup"><span data-stu-id="922be-152">Azure AD Connect cannot help you for this scenario.</span></span> <span data-ttu-id="922be-153">Это решение не позволяет создать пользователей в локальной среде и не дает возможности установить локальный пароль так же, как и в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="922be-153">It does not create users on-premises and it does not have any ability to set the password on-premises to the same as in Azure AD.</span></span>

<span data-ttu-id="922be-154">Если единственная причина, по которой планируется добавить локальную среду AD, это поддержка бизнес-приложений, то вам следует рассмотреть возможность использования [доменных служб Azure AD](../../active-directory-domain-services/index.md).</span><span class="sxs-lookup"><span data-stu-id="922be-154">If the only reason why you plan to add on-premises AD is to support LOBs (Line-of-Business apps), then maybe you should consider to use [Azure AD domain services](../../active-directory-domain-services/index.md) instead.</span></span>

## <a name="next-steps"></a><span data-ttu-id="922be-155">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="922be-155">Next steps</span></span>
<span data-ttu-id="922be-156">Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="922be-156">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
