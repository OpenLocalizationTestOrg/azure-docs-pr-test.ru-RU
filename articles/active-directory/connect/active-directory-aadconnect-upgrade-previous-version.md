---
title: "Azure AD Connect: обновление до последней версии | Документация Майкрософт"
description: "Описание hello различные методы tooupgrade toohello последний выпуск Azure Active Directory Connect, включая обновление на месте и ходу миграции."
services: active-directory
documentationcenter: 
author: AndKjell
manager: femila
editor: 
ms.assetid: 31f084d8-2b89-478c-9079-76cf92e6618f
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Identity
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 57bd5b094654e4983cafa303b6f3daecadafb01c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-upgrade-from-a-previous-version-toohello-latest"></a><span data-ttu-id="8cc70-103">Azure AD Connect: Обновление с предыдущей версии toohello последняя версия</span><span class="sxs-lookup"><span data-stu-id="8cc70-103">Azure AD Connect: Upgrade from a previous version toohello latest</span></span>
<span data-ttu-id="8cc70-104">В этом разделе описываются hello различные методы, которые можно использовать tooupgrade вашей установки подключение Azure Active Directory (Azure AD) toohello последний выпуск.</span><span class="sxs-lookup"><span data-stu-id="8cc70-104">This topic describes hello different methods that you can use tooupgrade your Azure Active Directory (Azure AD) Connect installation toohello latest release.</span></span> <span data-ttu-id="8cc70-105">Мы рекомендуем оставить самостоятельно текущего с выпусками hello Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="8cc70-105">We recommend that you keep yourself current with hello releases of Azure AD Connect.</span></span> <span data-ttu-id="8cc70-106">Вы также использовать действия hello hello [Вращающаяся миграции](#swing-migration) статьи при внесении значительное изменение конфигурации.</span><span class="sxs-lookup"><span data-stu-id="8cc70-106">You also use hello steps in hello [Swing migration](#swing-migration) section when you make a substantial configuration change.</span></span>

<span data-ttu-id="8cc70-107">Tooupgrade от DirSync см [обновить средство синхронизации Azure AD (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md) вместо него.</span><span class="sxs-lookup"><span data-stu-id="8cc70-107">If you want tooupgrade from DirSync, see [Upgrade from Azure AD sync tool (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md) instead.</span></span>

<span data-ttu-id="8cc70-108">Существует несколько различных стратегий, которые можно использовать tooupgrade Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="8cc70-108">There are a few different strategies that you can use tooupgrade Azure AD Connect.</span></span>

| <span data-ttu-id="8cc70-109">Метод</span><span class="sxs-lookup"><span data-stu-id="8cc70-109">Method</span></span> | <span data-ttu-id="8cc70-110">Описание</span><span class="sxs-lookup"><span data-stu-id="8cc70-110">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="8cc70-111">Автоматическое обновление</span><span class="sxs-lookup"><span data-stu-id="8cc70-111">Automatic upgrade</span></span>](active-directory-aadconnect-feature-automatic-upgrade.md) |<span data-ttu-id="8cc70-112">Это самый простой метод hello для клиентов с экспресс-установки.</span><span class="sxs-lookup"><span data-stu-id="8cc70-112">This is hello easiest method for customers with an express installation.</span></span> |
| [<span data-ttu-id="8cc70-113">Обновление «на месте»</span><span class="sxs-lookup"><span data-stu-id="8cc70-113">In-place upgrade</span></span>](#in-place-upgrade) |<span data-ttu-id="8cc70-114">При наличии одного сервера, вы можете обновить hello установки на месте на сервере hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-114">If you have a single server, you can upgrade hello installation in-place on hello same server.</span></span> |
| [<span data-ttu-id="8cc70-115">Обновление со сменой сервера</span><span class="sxs-lookup"><span data-stu-id="8cc70-115">Swing migration</span></span>](#swing-migration) |<span data-ttu-id="8cc70-116">С двумя серверами можно подготовить один из серверов hello с новым выпуском hello или конфигурации и изменить hello активного сервера, когда вы будете готовы.</span><span class="sxs-lookup"><span data-stu-id="8cc70-116">With two servers, you can prepare one of hello servers with hello new release or configuration, and change hello active server when you're ready.</span></span> |

<span data-ttu-id="8cc70-117">Разрешения подробнее hello [разрешения, необходимые для обновления](active-directory-aadconnect-accounts-permissions.md#upgrade).</span><span class="sxs-lookup"><span data-stu-id="8cc70-117">For permissions information, see hello [permissions required for an upgrade](active-directory-aadconnect-accounts-permissions.md#upgrade).</span></span>

> [!NOTE]
> <span data-ttu-id="8cc70-118">После включения ваш новый Azure AD Connect server toostart синхронизации изменений tooAzure AD, вы должны не откат toousing DirSync или Azure AD Sync. Понижении от клиентов toolegacy Azure AD Connect, включая DirSync и Azure AD Sync не поддерживается и может привести tooissues, такие как потеря данных в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8cc70-118">After you've enabled your new Azure AD Connect server toostart synchronizing changes tooAzure AD, you must not roll back toousing DirSync or Azure AD Sync. Downgrading from Azure AD Connect toolegacy clients, including DirSync and Azure AD Sync, isn't supported and can lead tooissues such as data loss in Azure AD.</span></span>

## <a name="in-place-upgrade"></a><span data-ttu-id="8cc70-119">Обновление «на месте»</span><span class="sxs-lookup"><span data-stu-id="8cc70-119">In-place upgrade</span></span>
<span data-ttu-id="8cc70-120">Обновление на месте подходит для обновления Azure AD Sync или Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="8cc70-120">An in-place upgrade works for moving from Azure AD Sync or Azure AD Connect.</span></span> <span data-ttu-id="8cc70-121">Оно не подходит для перехода с DirSync или для решения на основе Forefront Identity Manager (FIM) и соединителя Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8cc70-121">It doesn't work for moving from DirSync or for a solution with Forefront Identity Manager (FIM) + Azure AD Connector.</span></span>

<span data-ttu-id="8cc70-122">Мы советуем использовать этот вариант, если у вас есть один сервер и меньше 100 000 объектов.</span><span class="sxs-lookup"><span data-stu-id="8cc70-122">This method is preferred when you have a single server and less than about 100,000 objects.</span></span> <span data-ttu-id="8cc70-123">Если имеются изменения правила синхронизации out-of-box toohello, полный импорт и полную синхронизацию возникать после обновления hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-123">If there are any changes toohello out-of-box sync rules, a full import and full synchronization occur after hello upgrade.</span></span> <span data-ttu-id="8cc70-124">Этот метод гарантирует, что новая конфигурация этого hello — примененных tooall существующие объекты в системе hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-124">This method ensures that hello new configuration is applied tooall existing objects in hello system.</span></span> <span data-ttu-id="8cc70-125">Этот запуск может занять несколько часов в зависимости от числа объектов, которые находятся в области действия подсистемы синхронизации hello в hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-125">This run might take a few hours, depending on hello number of objects that are in scope of hello sync engine.</span></span> <span data-ttu-id="8cc70-126">Планировщик синхронизации обычный дельта Hello (который по умолчанию выполняет синхронизацию каждые 30 минут) приостанавливается, но по-прежнему синхронизации паролей.</span><span class="sxs-lookup"><span data-stu-id="8cc70-126">hello normal delta synchronization scheduler (which synchronizes every 30 minutes by default) is suspended, but password synchronization continues.</span></span> <span data-ttu-id="8cc70-127">Может выполнить обновление на месте hello выходные дни.</span><span class="sxs-lookup"><span data-stu-id="8cc70-127">You might consider doing hello in-place upgrade during a weekend.</span></span> <span data-ttu-id="8cc70-128">Если отсутствуют изменения настройки out-of-box toohello с выпуском hello новый Azure AD Connect, затем обычный дельта импорта или синхронизации запускает вместо.</span><span class="sxs-lookup"><span data-stu-id="8cc70-128">If there are no changes toohello out-of-box configuration with hello new Azure AD Connect release, then a normal delta import/sync starts instead.</span></span>  
![Обновление «на месте»](./media/active-directory-aadconnect-upgrade-previous-version/inplaceupgrade.png)

<span data-ttu-id="8cc70-130">Если вы внесли изменения toohello синхронизации out-of-box правила, затем такие правила установлены обратно toohello конфигурация по умолчанию при обновлении.</span><span class="sxs-lookup"><span data-stu-id="8cc70-130">If you've made changes toohello out-of-box synchronization rules, then these rules are set back toohello default configuration on upgrade.</span></span> <span data-ttu-id="8cc70-131">toomake поддерживает конфигурацию между обновления, убедитесь в том, внести изменения, как они описаны в [советы и рекомендации по изменению конфигурации по умолчанию hello](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="8cc70-131">toomake sure that your configuration is kept between upgrades, make sure that you make changes as they're described in [Best practices for changing hello default configuration](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span></span>

<span data-ttu-id="8cc70-132">Во время обновления на месте, возможно, представленные изменения, которые требуют определенных синхронизации действий (в том числе шаге полный импорт и полную синхронизацию) toobe выполняется после завершения обновления.</span><span class="sxs-lookup"><span data-stu-id="8cc70-132">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) toobe executed after upgrade completes.</span></span> <span data-ttu-id="8cc70-133">toodefer такие операции ссылаться toosection [как toodefer полная синхронизация после обновления](#how-to-defer-full-synchronization-after-upgrade).</span><span class="sxs-lookup"><span data-stu-id="8cc70-133">toodefer such activities, refer toosection [How toodefer full synchronization after upgrade](#how-to-defer-full-synchronization-after-upgrade).</span></span>

## <a name="swing-migration"></a><span data-ttu-id="8cc70-134">Обновление со сменой сервера</span><span class="sxs-lookup"><span data-stu-id="8cc70-134">Swing migration</span></span>
<span data-ttu-id="8cc70-135">При наличии комплексного развертывания или нескольких объектов, бывает нецелесообразным toodo обновление на месте в действующей системе hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-135">If you have a complex deployment or many objects, it might be impractical toodo an in-place upgrade on hello live system.</span></span> <span data-ttu-id="8cc70-136">У некоторых клиентов процесс может занять несколько дней, в течение которых никакие изменения синхронизироваться не будут.</span><span class="sxs-lookup"><span data-stu-id="8cc70-136">For some customers, this process might take multiple days--and during this time, no delta changes are processed.</span></span> <span data-ttu-id="8cc70-137">Этот метод также можно использовать при планировании конфигурации tooyour toomake существенные изменения, которые будут tootry их ожидания перед их работе отправить toohello облака.</span><span class="sxs-lookup"><span data-stu-id="8cc70-137">You can also use this method when you plan toomake substantial changes tooyour configuration and you want tootry them out before they're pushed toohello cloud.</span></span>

<span data-ttu-id="8cc70-138">Привет, рекомендуется использовать метод для этих сценариев — toouse миграции ходу.</span><span class="sxs-lookup"><span data-stu-id="8cc70-138">hello recommended method for these scenarios is toouse a swing migration.</span></span> <span data-ttu-id="8cc70-139">Вам потребуется по крайней мере два сервера — активный и промежуточный.</span><span class="sxs-lookup"><span data-stu-id="8cc70-139">You need (at least) two servers--one active server and one staging server.</span></span> <span data-ttu-id="8cc70-140">Hello активного сервера (показана с сплошными синими линиями в hello следующий рисунок) отвечает за hello активной рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="8cc70-140">hello active server (shown with solid blue lines in hello following picture) is responsible for hello active production load.</span></span> <span data-ttu-id="8cc70-141">Hello тестового сервера (показана с пунктирных линий фиолетовый) подготовлен с новым выпуском hello или конфигурации.</span><span class="sxs-lookup"><span data-stu-id="8cc70-141">hello staging server (shown with dashed purple lines) is prepared with hello new release or configuration.</span></span> <span data-ttu-id="8cc70-142">После завершения подготовки к использованию он становится активным сервером.</span><span class="sxs-lookup"><span data-stu-id="8cc70-142">When it's fully ready, this server is made active.</span></span> <span data-ttu-id="8cc70-143">Hello предыдущей active сервер, который теперь имеет старую версию hello или установленную конфигурацию, внесенные в промежуточном сервере hello и обновляется.</span><span class="sxs-lookup"><span data-stu-id="8cc70-143">hello previous active server, which now has hello old version or configuration installed, is made into hello staging server and is upgraded.</span></span>

<span data-ttu-id="8cc70-144">два сервера Hello можно использовать разные версии.</span><span class="sxs-lookup"><span data-stu-id="8cc70-144">hello two servers can use different versions.</span></span> <span data-ttu-id="8cc70-145">Например hello активного сервера планирования toodecommission можно использовать Azure AD Sync, и hello новый промежуточный сервер можно использовать Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="8cc70-145">For example, hello active server that you plan toodecommission can use Azure AD Sync, and hello new staging server can use Azure AD Connect.</span></span> <span data-ttu-id="8cc70-146">При использовании toodevelop миграции ходу новой конфигурации, его toohave смысл hello такие же версии на hello двух серверов.</span><span class="sxs-lookup"><span data-stu-id="8cc70-146">If you use swing migration toodevelop a new configuration, it's a good idea toohave hello same versions on hello two servers.</span></span>  
![Промежуточный сервер.](./media/active-directory-aadconnect-upgrade-previous-version/stagingserver1.png)

> [!NOTE]
> <span data-ttu-id="8cc70-148">Некоторые пользователи предпочитают toohave трех или четырех серверов для данного сценария.</span><span class="sxs-lookup"><span data-stu-id="8cc70-148">Some customers prefer toohave three or four servers for this scenario.</span></span> <span data-ttu-id="8cc70-149">При обновлении hello тестового сервера, у вас нет резервной копии сервера для [аварийного восстановления](active-directory-aadconnectsync-operations.md#disaster-recovery).</span><span class="sxs-lookup"><span data-stu-id="8cc70-149">When hello staging server is upgraded, you don't have a backup server for [disaster recovery](active-directory-aadconnectsync-operations.md#disaster-recovery).</span></span> <span data-ttu-id="8cc70-150">С тремя или четырьмя серверами можно подготовить одного набора серверов основной или резервной hello новой версии, который гарантирует, что всегда промежуточного сервера, готовы tootake через.</span><span class="sxs-lookup"><span data-stu-id="8cc70-150">With three or four servers, you can prepare one set of primary/standby servers with hello new version, which ensures that there is always a staging server that's ready tootake over.</span></span>

<span data-ttu-id="8cc70-151">Эти действия могут быть использованы toomove из Azure AD Sync или решение с FIM + соединитель Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8cc70-151">These steps also work toomove from Azure AD Sync or a solution with FIM + Azure AD Connector.</span></span> <span data-ttu-id="8cc70-152">Эти шаги не работают для DirSync, но hello же ходу метод миграции (также называемые параллельного развертывания) с шагами по DirSync в [обновления Azure Active Directory sync (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="8cc70-152">These steps don't work for DirSync, but hello same swing migration method (also called parallel deployment) with steps for DirSync is in [Upgrade Azure Active Directory sync (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span></span>

### <a name="use-a-swing-migration-tooupgrade"></a><span data-ttu-id="8cc70-153">Использовать tooupgrade ходу миграции</span><span class="sxs-lookup"><span data-stu-id="8cc70-153">Use a swing migration tooupgrade</span></span>
1. <span data-ttu-id="8cc70-154">При использовании Azure AD Connect на серверах и сделать план tooonly изменения конфигурации, убедитесь, что активного сервера и промежуточного серверов заданы оба с помощью одной версии "hello".</span><span class="sxs-lookup"><span data-stu-id="8cc70-154">If you use Azure AD Connect on both servers and plan tooonly make a configuration change, make sure that your active server and staging server are both using hello same version.</span></span> <span data-ttu-id="8cc70-155">Это позволяет упростить различия toocompare позже.</span><span class="sxs-lookup"><span data-stu-id="8cc70-155">That makes it easier toocompare differences later.</span></span> <span data-ttu-id="8cc70-156">При обновлении Azure AD Sync эти серверы имеют разные версии.</span><span class="sxs-lookup"><span data-stu-id="8cc70-156">If you're upgrading from Azure AD Sync, then these servers have different versions.</span></span> <span data-ttu-id="8cc70-157">При обновлении с более старой версии Azure AD Connect, это рекомендуется toostart с hello двух серверов, с помощью одной версии "hello", но это не обязательно.</span><span class="sxs-lookup"><span data-stu-id="8cc70-157">If you're upgrading from an older version of Azure AD Connect, it's a good idea toostart with hello two servers that are using hello same version, but it's not required.</span></span>
2. <span data-ttu-id="8cc70-158">Если вы внесли пользовательской конфигурации и промежуточном сервере нет, выполните действия hello под [перемещение пользовательской конфигурации с тестового сервера toohello активного сервера hello](#move-custom-configuration-from-active-to-staging-server).</span><span class="sxs-lookup"><span data-stu-id="8cc70-158">If you've made a custom configuration and your staging server doesn't have it, follow hello steps under [Move a custom configuration from hello active server toohello staging server](#move-custom-configuration-from-active-to-staging-server).</span></span>
3. <span data-ttu-id="8cc70-159">При обновлении от более раннего выпуска Azure AD Connect, обновите hello промежуточного сервера toohello последнюю версию.</span><span class="sxs-lookup"><span data-stu-id="8cc70-159">If you're upgrading from an earlier release of Azure AD Connect, upgrade hello staging server toohello latest version.</span></span> <span data-ttu-id="8cc70-160">При перемещении из Azure AD Sync установите Azure AD Connect на промежуточном сервере.</span><span class="sxs-lookup"><span data-stu-id="8cc70-160">If you're moving from Azure AD Sync, then install Azure AD Connect on your staging server.</span></span>
4. <span data-ttu-id="8cc70-161">Разрешить hello синхронизации engine работают полный импорт и полную синхронизацию на промежуточном сервере.</span><span class="sxs-lookup"><span data-stu-id="8cc70-161">Let hello sync engine run full import and full synchronization on your staging server.</span></span>
5. <span data-ttu-id="8cc70-162">Проверить новую конфигурацию, hello не вызваны любые непредвиденные изменения с помощью hello шаги в разделе «Проверить» в [hello Проверьте конфигурацию сервера](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span><span class="sxs-lookup"><span data-stu-id="8cc70-162">Verify that hello new configuration didn't cause any unexpected changes by using hello steps under "Verify" in [Verify hello configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span> <span data-ttu-id="8cc70-163">Если что-то не как ожидаемый, верно, запустите hello импорта и синхронизации и убедитесь hello данных пока выглядит неплохо, выполнив указанные ниже действия hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-163">If something isn't as expected, correct it, run hello import and sync, and verify hello data until it looks good, by following hello steps.</span></span>
6. <span data-ttu-id="8cc70-164">Переключение hello промежуточного сервера toobe hello активного сервера.</span><span class="sxs-lookup"><span data-stu-id="8cc70-164">Switch hello staging server toobe hello active server.</span></span> <span data-ttu-id="8cc70-165">Это последний шаг hello «Коммутатора active server» в [hello Проверьте конфигурацию сервера](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span><span class="sxs-lookup"><span data-stu-id="8cc70-165">This is hello final step "Switch active server" in [Verify hello configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span>
7. <span data-ttu-id="8cc70-166">При обновлении Azure AD Connect, обновите сервер hello, теперь в промежуточного режима toohello последний выпуск.</span><span class="sxs-lookup"><span data-stu-id="8cc70-166">If you're upgrading Azure AD Connect, upgrade hello server that's now in staging mode toohello latest release.</span></span> <span data-ttu-id="8cc70-167">Выполните шаги таким же как и прежде tooget hello данных и обновления конфигурации hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-167">Follow hello same steps as before tooget hello data and configuration upgraded.</span></span> <span data-ttu-id="8cc70-168">При обновлении Azure AD Sync на этом этапе можно отключить и списать старый сервер.</span><span class="sxs-lookup"><span data-stu-id="8cc70-168">If you upgraded from Azure AD Sync, you can now turn off and decommission your old server.</span></span>

### <a name="move-a-custom-configuration-from-hello-active-server-toohello-staging-server"></a><span data-ttu-id="8cc70-169">Переместить пользовательской конфигурации с промежуточного сервера hello активного сервера toohello</span><span class="sxs-lookup"><span data-stu-id="8cc70-169">Move a custom configuration from hello active server toohello staging server</span></span>
<span data-ttu-id="8cc70-170">При внесении сервер active toohello изменения конфигурации необходимо toomake убедитесь, что, hello же изменения, примененные toohello тестового сервера.</span><span class="sxs-lookup"><span data-stu-id="8cc70-170">If you've made configuration changes toohello active server, you need toomake sure that hello same changes are applied toohello staging server.</span></span> <span data-ttu-id="8cc70-171">переместить toohelp с этим, можно использовать hello [Архивариус конфигурации Azure AD Connect](https://github.com/Microsoft/AADConnectConfigDocumenter).</span><span class="sxs-lookup"><span data-stu-id="8cc70-171">toohelp with this move, you can use hello [Azure AD Connect configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter).</span></span>

<span data-ttu-id="8cc70-172">Можно перемещать пользовательские синхронизации hello правил, что вы создали с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8cc70-172">You can move hello custom sync rules that you've created by using PowerShell.</span></span> <span data-ttu-id="8cc70-173">Необходимо применить другие изменения hello так же, как систем, и вам не удается выполнить миграцию hello изменения.</span><span class="sxs-lookup"><span data-stu-id="8cc70-173">You must apply other changes hello same way on both systems, and you can't migrate hello changes.</span></span> <span data-ttu-id="8cc70-174">Hello [Архивариус конфигурации](https://github.com/Microsoft/AADConnectConfigDocumenter) может помочь сравнение hello двух систем toomake убедиться, что они совпадают.</span><span class="sxs-lookup"><span data-stu-id="8cc70-174">hello [configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter) can help you comparing hello two systems toomake sure they are identical.</span></span> <span data-ttu-id="8cc70-175">также может помочь Hello средство автоматизации hello шаги, представленные в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="8cc70-175">hello tool can also help in automating hello steps found in this section.</span></span>

<span data-ttu-id="8cc70-176">Требуются следующие hello tooconfigure вещей hello таким же образом на обоих серверах:</span><span class="sxs-lookup"><span data-stu-id="8cc70-176">You need tooconfigure hello following things hello same way on both servers:</span></span>

* <span data-ttu-id="8cc70-177">Подключение toohello того же леса</span><span class="sxs-lookup"><span data-stu-id="8cc70-177">Connection toohello same forests</span></span>
* <span data-ttu-id="8cc70-178">Фильтрацию доменов и подразделений.</span><span class="sxs-lookup"><span data-stu-id="8cc70-178">Any domain and OU filtering</span></span>
* <span data-ttu-id="8cc70-179">Здравствуйте, же дополнительных компонентов, таких как синхронизация паролей и обратная запись паролей</span><span class="sxs-lookup"><span data-stu-id="8cc70-179">hello same optional features, such as password sync and password writeback</span></span>

<span data-ttu-id="8cc70-180">**Перемещение пользовательских правил синхронизации**</span><span class="sxs-lookup"><span data-stu-id="8cc70-180">**Move custom synchronization rules**</span></span>  
<span data-ttu-id="8cc70-181">toomove пользовательские правила синхронизации, hello следующие:</span><span class="sxs-lookup"><span data-stu-id="8cc70-181">toomove custom synchronization rules, do hello following:</span></span>

1. <span data-ttu-id="8cc70-182">Откройте **редактор правил синхронизации** на активном сервере.</span><span class="sxs-lookup"><span data-stu-id="8cc70-182">Open **Synchronization Rules Editor** on your active server.</span></span>
2. <span data-ttu-id="8cc70-183">Выберите пользовательское правило.</span><span class="sxs-lookup"><span data-stu-id="8cc70-183">Select a custom rule.</span></span> <span data-ttu-id="8cc70-184">Щелкните **Экспорт**.</span><span class="sxs-lookup"><span data-stu-id="8cc70-184">Click **Export**.</span></span> <span data-ttu-id="8cc70-185">Откроется окно Блокнота.</span><span class="sxs-lookup"><span data-stu-id="8cc70-185">This brings up a Notepad window.</span></span> <span data-ttu-id="8cc70-186">Сохранение hello временного файла с расширением PS1.</span><span class="sxs-lookup"><span data-stu-id="8cc70-186">Save hello temporary file with a PS1 extension.</span></span> <span data-ttu-id="8cc70-187">он станет скриптом PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8cc70-187">This makes it a PowerShell script.</span></span> <span data-ttu-id="8cc70-188">Скопируйте файл hello PS1 toohello с тестового сервера.</span><span class="sxs-lookup"><span data-stu-id="8cc70-188">Copy hello PS1 file toohello staging server.</span></span>  
   <span data-ttu-id="8cc70-189">![Экспорт правил синхронизации](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span><span class="sxs-lookup"><span data-stu-id="8cc70-189">![Sync rule export](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span></span>
3. <span data-ttu-id="8cc70-190">Hello GUID соединителя отличается на промежуточном сервере hello и необходимо изменить его.</span><span class="sxs-lookup"><span data-stu-id="8cc70-190">hello Connector GUID is different on hello staging server, and you must change it.</span></span> <span data-ttu-id="8cc70-191">Запуск tooget hello GUID, **редактор правил синхронизации**, выберите одно из правил out-of-box hello, представляют Привет же соединение системы, а затем нажмите кнопку **Экспорт**.</span><span class="sxs-lookup"><span data-stu-id="8cc70-191">tooget hello GUID, start **Synchronization Rules Editor**, select one of hello out-of-box rules that represent hello same connected system, and click **Export**.</span></span> <span data-ttu-id="8cc70-192">Замените hello GUID из тестового сервера hello hello GUID в PS1-файл.</span><span class="sxs-lookup"><span data-stu-id="8cc70-192">Replace hello GUID in your PS1 file with hello GUID from hello staging server.</span></span>
4. <span data-ttu-id="8cc70-193">В командной строке PowerShell запустите файл hello PS1.</span><span class="sxs-lookup"><span data-stu-id="8cc70-193">In a PowerShell prompt, run hello PS1 file.</span></span> <span data-ttu-id="8cc70-194">При этом создается правило синхронизации hello на промежуточном сервере hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-194">This creates hello custom synchronization rule on hello staging server.</span></span>
5. <span data-ttu-id="8cc70-195">Повторите эти действия для всех пользовательских правил.</span><span class="sxs-lookup"><span data-stu-id="8cc70-195">Repeat this for all your custom rules.</span></span>

## <a name="how-toodefer-full-synchronization-after-upgrade"></a><span data-ttu-id="8cc70-196">Как toodefer полная синхронизация после обновления</span><span class="sxs-lookup"><span data-stu-id="8cc70-196">How toodefer full synchronization after upgrade</span></span>
<span data-ttu-id="8cc70-197">Во время обновления на месте, возможно, вносимые, требующих синхронизации определенных действий (в том числе шаге полный импорт и полную синхронизацию) toobe выполнена.</span><span class="sxs-lookup"><span data-stu-id="8cc70-197">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) toobe executed.</span></span> <span data-ttu-id="8cc70-198">Например, изменения схемы соединителя требуют **полный импорт** шаг и out-of-box изменения правила синхронизации требуют **полная синхронизация** шаг toobe выполнена на затронутых соединители.</span><span class="sxs-lookup"><span data-stu-id="8cc70-198">For example, connector schema changes require **full import** step and out-of-box synchronization rule changes require **full synchronization** step toobe executed on affected connectors.</span></span> <span data-ttu-id="8cc70-199">Во время обновления Azure AD Connect определяет действия синхронизации, которые необходимо выполнить, и записывает их в виде *переопределений*.</span><span class="sxs-lookup"><span data-stu-id="8cc70-199">During upgrade, Azure AD Connect determines what synchronization activities are required and records them as *overrides*.</span></span> <span data-ttu-id="8cc70-200">В следующий цикл синхронизации hello Планировщик синхронизации hello собирают эти переопределения и выполняет их.</span><span class="sxs-lookup"><span data-stu-id="8cc70-200">In hello following synchronization cycle, hello synchronization scheduler picks up these overrides and executes them.</span></span> <span data-ttu-id="8cc70-201">После успешного выполнения переопределения оно удаляется.</span><span class="sxs-lookup"><span data-stu-id="8cc70-201">Once an override is successfully executed, it is removed.</span></span>

<span data-ttu-id="8cc70-202">Могут возникнуть ситуации, где требуется поместить tootake эти переопределения сразу же после обновления.</span><span class="sxs-lookup"><span data-stu-id="8cc70-202">There may be situations where you do not want these overrides tootake place immediately after upgrade.</span></span> <span data-ttu-id="8cc70-203">Например имеется множество Синхронизируемые объекты и необходимо по окончании рабочего дня эти toooccur действия синхронизации.</span><span class="sxs-lookup"><span data-stu-id="8cc70-203">For example, you have numerous synchronized objects and you would like these synchronization steps toooccur after business hours.</span></span> <span data-ttu-id="8cc70-204">tooremove эти переопределения:</span><span class="sxs-lookup"><span data-stu-id="8cc70-204">tooremove these overrides:</span></span>

1. <span data-ttu-id="8cc70-205">Во время обновления **снимите** hello параметр **запуск процесса синхронизации hello после завершения конфигурации**.</span><span class="sxs-lookup"><span data-stu-id="8cc70-205">During upgrade, **uncheck** hello option **Start hello synchronization process when configuration completes**.</span></span> <span data-ttu-id="8cc70-206">Это отключит Планировщик синхронизации hello и предотвращает цикл синхронизации осуществляются автоматически до удаления hello переопределения.</span><span class="sxs-lookup"><span data-stu-id="8cc70-206">This disables hello synchronization scheduler and prevents synchronization cycle from taking place automatically before hello overrides are removed.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync01.png)

2. <span data-ttu-id="8cc70-208">После завершения обновления выполните следующие toofind командлет out добавили какие переопределения hello:`Get-ADSyncSchedulerConnectorOverride | fl`</span><span class="sxs-lookup"><span data-stu-id="8cc70-208">After upgrade completes, run hello following cmdlet toofind out what overrides have been added: `Get-ADSyncSchedulerConnectorOverride | fl`</span></span>

   >[!NOTE]
   > <span data-ttu-id="8cc70-209">переопределения Hello связаны с конкретной соединителя.</span><span class="sxs-lookup"><span data-stu-id="8cc70-209">hello overrides are connector-specific.</span></span> <span data-ttu-id="8cc70-210">В hello в примере, действия полный импорт и полную синхронизацию были добавлены tooboth hello локального соединителя AD и соединителя Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8cc70-210">In hello following example, Full Import step and Full Synchronization step have been added tooboth hello on-premises AD Connector and Azure AD Connector.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync02.png)

3. <span data-ttu-id="8cc70-212">Запишите hello существующие переопределения, которые были добавлены.</span><span class="sxs-lookup"><span data-stu-id="8cc70-212">Note down hello existing overrides that have been added.</span></span>
   
4. <span data-ttu-id="8cc70-213">полный импорт и полную синхронизацию на произвольный соединитель, запустите следующий командлет hello переопределяет tooremove hello:`Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span><span class="sxs-lookup"><span data-stu-id="8cc70-213">tooremove hello overrides for both full import and full synchronization on an arbitrary connector, run hello following cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span></span>

   <span data-ttu-id="8cc70-214">переопределения hello tooremove на все соединители, выполните следующий сценарий PowerShell hello:</span><span class="sxs-lookup"><span data-stu-id="8cc70-214">tooremove hello overrides on all connectors, execute hello following PowerShell script:</span></span>

   ```
   foreach ($connectorOverride in Get-ADSyncSchedulerConnectorOverride)
   {
       Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier $connectorOverride.ConnectorIdentifier.Guid -FullSyncRequired $false -FullImportRequired $false
   }
   ```

5. <span data-ttu-id="8cc70-215">tooresume планировщик hello, запустите следующий командлет hello:`Set-ADSyncScheduler -SyncCycleEnabled $true`</span><span class="sxs-lookup"><span data-stu-id="8cc70-215">tooresume hello scheduler, run hello following cmdlet: `Set-ADSyncScheduler -SyncCycleEnabled $true`</span></span>

   >[!IMPORTANT]
   > <span data-ttu-id="8cc70-216">Не забывайте действия синхронизации tooexecute hello необходимые по своему усмотрению раннее.</span><span class="sxs-lookup"><span data-stu-id="8cc70-216">Remember tooexecute hello required synchronization steps at your earliest convenience.</span></span> <span data-ttu-id="8cc70-217">Можно либо вручную выполните следующие действия с помощью диспетчера службы синхронизации hello или добавить обратно с помощью командлета Set-ADSyncSchedulerConnectorOverride hello переопределения hello.</span><span class="sxs-lookup"><span data-stu-id="8cc70-217">You can either manually execute these steps using hello Synchronization Service Manager or add hello overrides back using hello Set-ADSyncSchedulerConnectorOverride cmdlet.</span></span>

<span data-ttu-id="8cc70-218">полный импорт и полную синхронизацию на произвольный соединитель, запустите следующий командлет hello переопределяет tooadd hello:`Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span><span class="sxs-lookup"><span data-stu-id="8cc70-218">tooadd hello overrides for both full import and full synchronization on an arbitrary connector, run hello following cmdlet:  `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span></span>

## <a name="next-steps"></a><span data-ttu-id="8cc70-219">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="8cc70-219">Next steps</span></span>
<span data-ttu-id="8cc70-220">Дополнительные сведения об интеграции локальных удостоверений см. в статье [Подключение Active Directory к Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="8cc70-220">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
