---
title: "Синхронизация Azure AD Connect: настройка фильтрации | Документация Майкрософт"
description: "Объясняет, как tooconfigure фильтрации в Azure AD Connect sync."
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: 880facf6-1192-40e9-8181-544c0759d506
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 97979b508c560a6de6cb091b1b621bc1d51b25c4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-sync-configure-filtering"></a>Синхронизация Azure AD Connect: настройка фильтрации
Возможность фильтрации позволяет управлять тем, какие объекты локального каталога будут синхронизированы с Azure Active Directory (Azure AD). Конфигурация по умолчанию Hello принимает все объекты во всех доменах леса настроены hello. Как правило это Рекомендуемая конфигурация hello. Пользователи системы Office 365, будь-то Exchange Online или Skype для бизнеса, могут использовать глобальный список адресов для отправки сообщений электронной почты и осуществления звонков по всем адресам. С конфигурацией по умолчанию hello они бы приветствия одинаковую функциональность, что они бы с реализацией в локальной среде Exchange и Lync.

В некоторых случаях тем не менее, вам требуется внести некоторые изменения toohello по умолчанию конфигурации. Ниже приведены некоторые примеры:

* Планирование toouse hello [несколькими Azure AD directory топологии](active-directory-aadconnect-topologies.md#each-object-only-once-in-an-azure-ad-tenant). Затем необходимо tooapply toocontrol фильтра, какие объекты представляют собой каталогов синхронизированные tooa определенного Azure AD.
* Используется пилотная программа Azure или Office 365, и нужно синхронизировать с Azure AD только определенных пользователей. В небольших пилотных hello не важно toohave полные функции hello toodemonstrate глобального списка адресов.
* Если не нужно синхронизировать с Azure AD много учетных записей служб и других рабочих учетных записей.
* В целях обеспечения соответствия нельзя локально удалять учетные записи пользователей, но можно их отключить. Однако в Azure AD требуется только учетные записи active toobe присутствует.

В этой статье рассказывается, как tooconfigure hello различные методы фильтрации.

> [!IMPORTANT]
> Корпорация Майкрософт не поддерживает изменение, а также ОС Azure AD Connect sync за пределами действия hello, формально задокументированных. Любые иные действия могут привести к несогласованному или неподдерживаемому состоянию служб синхронизации Azure AD Connect. Для таких развертываний Майкрософт не предоставляет техническую поддержку.

## <a name="basics-and-important-notes"></a>Основные сведения и важные примечания
В службах синхронизации Azure AD Connect фильтрацию можно включить в любое время. Если начать с синхронизации службы каталогов конфигурации по умолчанию и затем настроить фильтрацию, hello объекты, которые фильтруются, не синхронизированные tooAzure AD. В результате этого изменения все объекты в Azure AD, которые ранее были синхронизированы, а затем отфильтрованы, будут удалены из Azure AD.

Прежде чем начать, делая toofiltering изменения, убедитесь, что вы [отключить запланированная задача hello](#disable-scheduled-task) так изменений, еще не проверен toobe правильный случайно не экспортировать.

Поскольку фильтрации можно удалить многие объекты hello одновременную, требуется toomake правильность новые фильтры перед началом экспорта любые изменения tooAzure AD. После завершения действия по настройке hello, настоятельно рекомендуется следовать hello [шаги проверки](#apply-and-verify-changes) прежде чем экспортировать и внести изменения tooAzure AD.

функция tooprotect удалять многие объекты случайно, hello»[избежать случайного удаления](active-directory-aadconnectsync-feature-prevent-accidental-deletes.md)» по умолчанию. При удалении нескольких объектов из-за toofiltering (500 по умолчанию), необходимо toofollow hello шаги в этой статье tooallow hello удаляет toogo через tooAzure AD.

При использовании сборки до ноября 2015 г. ([1.0.9125](active-directory-aadconnect-version-history.md#1091250)), внесено изменение конфигурации фильтра tooa и использования синхронизации паролей после завершения настройки hello, потребуется tootrigger полную синхронизацию всех паролей. Инструкции по как tootrigger пароль полная синхронизация. в разделе [запуска полной синхронизации всех паролей](active-directory-aadconnectsync-troubleshoot-password-synchronization.md#trigger-a-full-sync-of-all-passwords). Если вы будете в построении 1.0.9125 или более поздней версии, затем hello regular **полная синхронизация** действие также вычисляет настроить синхронизацию паролей, и если этот дополнительный шаг больше не требуется.

Если **пользователя** в Azure AD случайном удалении объектов из-за ошибки фильтрации, можно повторно создать hello пользовательские объекты в Azure AD, удалив настройки фильтрации. Затем можно снова синхронизировать каталоги. Это действие восстанавливает hello пользователей из корзины hello в Azure AD. Однако удаление объектов других типов отменить нельзя. Например если используется tooACL ресурса было случайно удалить группу безопасности, нельзя восстановить hello группы и ее списки управления доступом.

Azure AD Connect удаляет только объекты, что он один раз считается toobe в области видимости. Объекты Azure AD, созданные в результате работы другого модуля синхронизации и не соответствующие фильтру, удалены не будут. Например если начать с сервером DirSync, созданные полную копию всего каталога в Azure AD, и установить новый сервер синхронизации Azure AD Connect параллельно с включенной с начала hello фильтрацией, Azure AD Connect не удаляет лишние hello объекты, созданные с DirSync.

При установке или обновлении tooa более новой версии Azure AD Connect сохраняется Hello конфигурацией фильтрации. Это всегда всего наиболее tooverify рекомендаций, который hello конфигурации не был случайно изменена после обновления tooa новой версии перед выполнением первого цикла синхронизации hello.

Если у вас есть более чем одном лесе, то необходимо применить фильтрацию настройки, описанные в данном разделе tooevery лесу hello (при условии, что требуется hello же конфигурации для всех из них).

### <a name="disable-hello-scheduled-task"></a>Отключить задание hello
toodisable hello планировщик, инициирует цикл синхронизации каждые 30 минут, выполните следующие действия.

1. Откройте командную строку PowerShell tooa.
2. Запустите `Set-ADSyncScheduler -SyncCycleEnabled $False` toodisable hello планировщика.
3. Сделать hello изменения, описанные в этой статье.
4. Запустите `Set-ADSyncScheduler -SyncCycleEnabled $True` планировщика hello tooenable еще раз.

**При использовании сборки Azure AD Connect до версии 1.1.105.0**  
Запланированная задача hello toodisable, которое запускает цикл синхронизации каждые три часа, выполните следующие действия.

1. Запуск **планировщик** из hello **запустить** меню.
2. Непосредственно под **Библиотека планировщика заданий**, задачу hello поиска с именем **Azure AD Sync Scheduler**, щелкните правой кнопкой мыши и выберите **отключить**.  
   ![планировщик задач](./media/active-directory-aadconnectsync-configure-filtering/taskscheduler.png)  
3. Теперь можно внести изменения в конфигурацию и запустите модуль синхронизации hello вручную из hello **диспетчер службы синхронизации** консоли.

После завершения всех изменений фильтрации, не забывайте toocome назад и **включить** задачу hello еще раз.

## <a name="filtering-options"></a>Параметры фильтрации
Можно применить после фильтрации настройки средства синхронизации каталогов типы toohello hello.

* [**Групповые**](#group-based-filtering): фильтрации, основанной на одну группу можно задавать только при первоначальной установке с помощью мастера установки hello.
* [**На основе домена**](#domain-based-filtering): С помощью этого параметра, можно выбрать, какие домены синхронизации tooAzure AD. Можно также добавлять и удалять домены из конфигурации подсистемы синхронизации hello при внесении изменений tooyour локальной инфраструктуры после установки синхронизации Azure AD Connect.
* [**Организационное подразделение (OU) — на основе**](#organizational-unitbased-filtering): С помощью этого параметра, можно выбрать OU синхронизации tooAzure AD. Действие этого параметра распространяется на все типы объектов в выбранных подразделениях.
* [**Основанное на атрибутах**](#attribute-based-filtering): С помощью этого параметра, можно фильтровать объекты по значениям атрибутов объектов hello. Кроме того, для объектов различных типов можно использовать разные фильтры.

Можно использовать несколько параметров фильтрации на hello то же время. Например, можно использовать фильтрацию на основе Подразделения tooonly включать объекты в одно Подразделение. AT hello же time и дальнейшего использования на основе атрибутов объектов hello toofilter фильтрации. При использовании нескольких методов фильтрации, фильтры hello используйте операцию логического «и» между hello фильтры.

## <a name="domain-based-filtering"></a>Фильтрация по доменам
В этом разделе приводятся шаги tooconfigure hello фильтр домена. При их добавлении и удалении доменов в лесу, после установки Azure AD Connect, необходимо также tooupdate hello конфигурацией фильтрации.

Hello предпочтительный способ фильтрации toochange на основе домена, запустив мастер установки hello и изменив [домен и Подразделение фильтрации](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering). Мастер установки Hello автоматизирует все hello задачи, описанные в этом разделе.

Только, если по некоторым причинам вы мастер установки не удается toorun hello, должны выполнить следующие действия.

Настройка фильтрации по доменам предусматривает следующие шаги:

1. [Выберите домены hello](#select-domains-to-be-synchronized) , которые должны tooinclude в hello синхронизации.
2. Для каждого добавления и удаления домена, настроить hello [профили запуска](#update-run-profiles).
3. [Примените и проверьте изменения](#apply-and-verify-changes).

### <a name="select-hello-domains-toobe-synchronized"></a>Синхронизация toobe доменов выберите hello
домен hello tooset фильтрации, hello следующие действия:

1. Войдите в toohello сервера, на котором выполняется синхронизация Azure AD Connect, используя учетную запись, которая является членом hello **ADSyncAdmins** группы безопасности.
2. Запуск **служба синхронизации** из hello **запустить** меню.
3. Выберите **соединители**и в hello **соединители** выберите hello соединитель с типом hello **доменных служб Active Directory**. В разделе **Действия** выберите **Свойства**.  
   ![Свойства соединителя](./media/active-directory-aadconnectsync-configure-filtering/connectorproperties.png)  
4. Щелкните **Настроить разделы каталога**.
5. В hello **выберите разделы каталога** выберите и отмените выделение доменов, при необходимости. Убедитесь, что выбраны только hello секций, что требуется toosynchronize.  
   ![Разделы](./media/active-directory-aadconnectsync-configure-filtering/connectorpartitions.png)  
   Если был изменен инфраструктуру Active Directory в локальной и добавлен или удален доменов из леса hello, нажмите кнопку hello **обновление** tooget кнопку обновленный список. Во время обновления будет предложено ввести учетные данные. Любые учетные данные с tooWindows доступ на чтение Server Active Directory. Это не обязательно toobe hello пользователя, который подставлена в диалоговое окно «hello».  
   ![Требуется обновление](./media/active-directory-aadconnectsync-configure-filtering/refreshneeded.png)  
6. После завершения закройте hello **свойства** диалоговое окно, нажав кнопку **ОК**. При удалении доменов в лесу hello всплывающего сообщения говорит, что домен был удален, и этой конфигурации будут очищены.
7. Продолжить tooadjust hello [профили запуска](#update-run-profiles).

### <a name="update-hello-run-profiles"></a>Обновить профили запуска hello
Если вы обновили фильтр домена, необходимо также tooupdate профили запуска hello.

1. В hello **соединители** убедитесь, что hello выбран соединитель, измененной в предыдущем шаге hello. В разделе **Действия** выберите **Configure Run Profiles** (Настроить профили выполнения).  
   ![Профили выполнения соединителя 1](./media/active-directory-aadconnectsync-configure-filtering/connectorrunprofiles1.png)  
2. Найдите и определите следующие профили hello:
    * полный импорт;
    * полная синхронизация;
    * импорт изменений;
    * синхронизация изменений;
    * экспорт.
3. Для каждого профиля настроить hello **добавлены** и **удалены** доменов.
    1. Для каждого из профилей пяти hello, hello следующие действия для каждого **добавлены** домена:
        1. Выберите профиль выполнения hello и щелкните **новый шаг**.
        2. На hello **шаг настройки** страницы в hello **тип** раскрывающееся меню hello выберите тип шага с hello точно такое же имя, как hello профиля, который настраивается. Нажмите кнопку **Далее**.  
        ![Профили выполнения соединителя 2](./media/active-directory-aadconnectsync-configure-filtering/runprofilesnewstep1.png)  
        3. На hello **конфигурацию соединителя** страницы в hello **секции** раскрывающееся меню, выберите hello имя домена hello, что вы добавили tooyour фильтр домена.  
        ![Профили выполнения соединителя 3](./media/active-directory-aadconnectsync-configure-filtering/runprofilesnewstep2.png)  
        4. tooclose hello **настройки профилей выполнения** диалоговое окно, нажмите кнопку **Готово**.
    2. Для каждого из профилей пяти hello, hello следующие действия для каждого **удалены** домена:
        1. Выберите профиль выполнения hello.
        2. Если hello **значение** из hello **секции** атрибута представляет собой идентификатор GUID, выберите hello выполнить шаг и щелкните **удалить шаг**.  
        ![Профили выполнения соединителя 4](./media/active-directory-aadconnectsync-configure-filtering/runprofilesdeletestep.png)  
    3. Проверьте внесенные изменения. Каждый домен, следует toosynchronize должно быть указано в ходе каждого профиля выполнения.
4. tooclose hello **Настройка профилей выполнения** диалоговое окно, нажмите кнопку **ОК**.
5.  toocomplete hello конфигурации, необходимые toorun **полный импорт** и **разностной синхронизации**. Продолжить чтение раздела hello [применить и проверка изменений](#apply-and-verify-changes).

## <a name="organizational-unitbased-filtering"></a>Фильтрация по подразделениям
Hello предпочтительный способ фильтрации toochange на основе Подразделения, запустив мастер установки hello и изменив [домен и Подразделение фильтрации](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering). Мастер установки Hello автоматизирует все hello задачи, описанные в этом разделе.

Только, если по некоторым причинам вы мастер установки не удается toorun hello, должны выполнить следующие действия.

tooconfigure организационную единицу фильтрации на основе, hello следующие действия:

1. Войдите в toohello сервера, на котором выполняется синхронизация Azure AD Connect, используя учетную запись, которая является членом hello **ADSyncAdmins** группы безопасности.
2. Запуск **служба синхронизации** из hello **запустить** меню.
3. Выберите **соединители**и в hello **соединители** выберите hello соединитель с типом hello **доменных служб Active Directory**. В разделе **Действия** выберите **Свойства**.  
   ![Свойства соединителя](./media/active-directory-aadconnectsync-configure-filtering/connectorproperties.png)  
4. Нажмите кнопку **Настройка разделов каталога**выберите hello домена требуется tooconfigure и нажмите кнопку **контейнеры**.
5. Когда появится запрос, предоставьте доступ на чтение tooyour локальной Active Directory любые учетные данные. Это не обязательно toobe hello пользователя, который подставлена в диалоговое окно «hello».
6. В hello **выбора контейнеров** диалоговом очистить hello подразделений, не требуется toosynchronize с облачным каталогом hello, а затем выберите **ОК**.  
   ![Подразделений в диалоговое окно выбора контейнеров hello](./media/active-directory-aadconnectsync-configure-filtering/ou.png)  
   * Hello **компьютеров** контейнер должен быть выбран для вашей toobe компьютеров Windows 10 успешно синхронизирован tooAzure AD. Если компьютеры, присоединенные к домену, находятся в других подразделениях, выберите соответствующие подразделения.
   * Hello **ForeignSecurityPrincipals** контейнер должен быть выбран при наличии нескольких лесов с отношениями доверия. Этот контейнер позволяет безопасности между лесами группы членства toobe разрешен.
   * Hello **RegisteredDevices** Подразделения следует выбирать, если включена функция обратной записи устройства hello. Если используется другая функция обратной записи, такая как обратная запись группы, выберите соответствующие расположения.
   * Выберите все подразделения, к которым принадлежат объекты контейнеров «Пользователи», iNetOrgPersons, «Группы», «Контакты» и «Компьютеры». На рисунке hello всех подразделений расположены в hello ManagedObjects Подразделения.
   * При использовании фильтрации на основе группы hello Подразделение, где расположена группа hello должен быть включен.
   * Обратите внимание, что можно определить, нужно ли новых подразделениях, которые будут добавлены после завершения hello конфигурацией фильтрации синхронизированы или не синхронизированы. См. в следующем разделе hello.
7. После завершения закройте hello **свойства** диалоговое окно, нажав кнопку **ОК**.
8. toocomplete hello конфигурации, необходимые toorun **полный импорт** и **разностной синхронизации**. Продолжить чтение раздела hello [применить и проверка изменений](#apply-and-verify-changes).

### <a name="synchronize-new-ous"></a>Синхронизация новых подразделений
Новые подразделения, созданные после настройки фильтрации, синхронизируются по умолчанию. Это состояние обозначается установленным флажком. С некоторых подразделений можно снять флажки. tooget такое поведение, щелкните поле, hello, пока она не станет белый синяя галочка (состояние по умолчанию). Затем снимите флажки для любой отделов, вы не хотите toosynchronize.

При синхронизации всех отделов hello поле имеет белый синяя галочка.  
![Подразделение со всеми установленными флажками](./media/active-directory-aadconnectsync-configure-filtering/ousyncnewall.png)

Если некоторые отделов был отменен, поле hello — серый с белой галочкой.  
![Подразделение, где не выбраны некоторые отделы](./media/active-directory-aadconnectsync-configure-filtering/ousyncnew.png)

С этой конфигурацией новое подразделение, созданное в ManagedObjects, синхронизируется.

Мастер установки Hello Azure AD Connect всегда создает эту конфигурацию.

### <a name="dont-synchronize-new-ous"></a>Как не синхронизировать новые подразделения
Можно настроить синхронизацию hello toonot механизм синхронизации новых подразделениях после завершения hello конфигурацией фильтрации. Это состояние указывается в hello пользовательского интерфейса с hello поле отображаются сплошной серый без флажка. tooget такое поведение, щелкните поле, hello, пока она не станет белый без флажка. Затем выберите hello отделов, которые должны toosynchronize.

![Подразделение с корнем hello не выбрано](./media/active-directory-aadconnectsync-configure-filtering/oudonotsyncnew.png)

С этой конфигурацией синхронизируется новое подразделение, созданное в ManagedObjects.

## <a name="attribute-based-filtering"></a>Фильтрация по атрибутам
Убедитесь, что вы используете hello ноября 2015 г. ([1.0.9125](active-directory-aadconnect-version-history.md#1091250)) или более поздней версии сборки, эти шаги toowork.

Фильтрация на основе атрибута — это hello самый гибкий способ toofilter объектов. Можно использовать возможности hello [декларативной подготовки](active-directory-aadconnectsync-understanding-declarative-provisioning.md) toocontrol практически все аспекты перевода объекта синхронизации tooAzure AD.

Можно применить [входящий](#inbound-filtering) фильтрации из метавселенной toohello Active Directory, и [исходящих](#outbound-filtering) фильтрации из tooAzure метавселенной hello AD. Рекомендуется применять фильтрация входящих сообщений, так как это самый простой toomaintain hello. Фильтрация исходящего трафика, если он должен toojoin объекты из более чем одном лесе перед hello можно вычислить следует использовать только.

### <a name="inbound-filtering"></a>Фильтрация входящих объектов
Фильтрация входящих сообщений использует конфигурацию по умолчанию hello, где объекты будут tooAzure AD, должны иметь hello метавселенной атрибут cloudFiltered не синхронизированы toobe значение tooa. Если этот атрибут имеет значение слишком**True**, а затем hello объекта не синхронизировано. Его не следует задавать слишком**False**, намеренно. toomake убедиться, что другие правила имеют возможность toocontribute hello значение, этот атрибут только должен значения hello toohave **True** или **NULL** (absent).

Фильтрация входящих сообщений используется в степень hello **область** toodetermine toosynchronize объектов или не синхронизируются. Это на них можно вносить корректировки toofit требования вашей организации. модуль Hello области имеет **группы** и **предложение** toodetermine, если в области правила синхронизации. В группе может содержаться одно или несколько предложений. Если предложений несколько, в качестве их разделителя используется логический оператор AND, а при наличии нескольких групп — оператор OR.

Вот пример.  
![Область](./media/active-directory-aadconnectsync-configure-filtering/scope.png)  
Его следует рассматривать так: **(department = IT) OR (department = Sales AND c = US)**.

В hello следующие образцы и пошаговые инструкции, hello объекта-пользователя используется в качестве примера, но его можно использовать для всех типов объектов.

В следующих образцов hello значение приоритета hello начинается с 50. Это может быть любое число меньше 100, которое еще не используется.

#### <a name="negative-filtering-do-not-sync-these"></a>Отрицательная фильтрация (выбор объектов, которые не следует синхронизировать)
В следующем примере hello, можно фильтровать (не синхронизировать) всех пользователей где **extensionAttribute15** имеет значение hello **NoSync**.

1. Войдите в toohello сервера, на котором выполняется синхронизация Azure AD Connect, используя учетную запись, которая является членом hello **ADSyncAdmins** группы безопасности.
2. Запуск **редактор правил синхронизации** из hello **запустить** меню.
3. Выберите параметр **Входящие** и щелкните **Add New Rule** (Добавить новое правило).
4. Присвойте правило hello описательное имя, такое как «*в from AD – User DoNotSyncFilter*». Hello выберите правильный лес, выберите **пользователя** как hello **типа объекта CS**и выберите **лицо** как hello **типа объекта MV**. В поле **Тип связи** выберите **Join** (Присоединение). В поле **Приоритет** введите значение, которое не используется в другом правиле синхронизации (например, 50), и нажмите кнопку **Далее**.  
   ![Описание входящего объекта 1](./media/active-directory-aadconnectsync-configure-filtering/inbound1.png)  
5. В поле **Scoping filter** (Фильтр области действия) выберите **Добавить группу** и щелкните **Добавить предложение**. В поле **Атрибут** выберите **ExtensionAttribute15**. Убедитесь, что **оператор** задано слишком**равно**и введите значение hello **NoSync** в hello **значение** поле. Щелкните **Далее**.  
   ![Область входящего объекта 2](./media/active-directory-aadconnectsync-configure-filtering/inbound2.png)  
6. Оставьте hello **Join** правила пустым и нажмите кнопку **Далее**.
7. Нажмите кнопку **добавить преобразование**выберите hello **FlowType** как **константой**и выберите **cloudFiltered** как hello  **Целевой атрибут**. В hello **источника** введите **True**. Нажмите кнопку **добавить** toosave hello правило.  
   ![Преобразование входящего объекта 3](./media/active-directory-aadconnectsync-configure-filtering/inbound3.png)
8. toocomplete hello конфигурации, необходимые toorun **полная синхронизация**. Продолжить чтение раздела hello [применить и проверка изменений](#apply-and-verify-changes).

#### <a name="positive-filtering-only-sync-these"></a>Положительная фильтрация (выбор объектов, которые нужно синхронизировать)
Выражения положительное Фильтрация может быть более сложной задачей, так как имеется tooconsider объекты, которые не являются очевидным toobe синхронизированы, таких как конференц-зале. Вы также имеются фильтр по умолчанию hello toooverride переход в правило out-of-box hello **в из AD — User Join**. При создании пользовательского фильтра, убедитесь, что toonot включают критические системные объекты, объекты конфликтов репликации, специальные почтовые ящики и hello учетных записей служб для Azure AD Connect.

параметр фильтрации положительное Hello требуется два правила синхронизации. Вам потребуется одно правило (или несколько) с областью правильный hello toosynchronize объектов. а другое правило должно быть универсальным, чтобы отсеять все объекты, не соответствующие объектам, подлежащим синхронизации.

В следующем примере hello, можно синхронизировать только пользовательские объекты, где hello отдел атрибут имеет значение hello **Sales**.

1. Войдите в toohello сервера, на котором выполняется синхронизация Azure AD Connect, используя учетную запись, которая является членом hello **ADSyncAdmins** группы безопасности.
2. Запуск **редактор правил синхронизации** из hello **запустить** меню.
3. Выберите параметр **Входящие** и щелкните **Add New Rule** (Добавить новое правило).
4. Присвойте правило hello описательное имя, такое как «*из AD — пользователь продаж синхронизированы*». Hello выберите правильный лес, выберите **пользователя** как hello **типа объекта CS**и выберите **лицо** как hello **типа объекта MV**. В поле **Тип связи** выберите **Join** (Присоединение). В поле **Приоритет** введите значение, которое не используется в другом правиле синхронизации (например, 51), и нажмите кнопку **Далее**.  
   ![Описание входящего объекта 4](./media/active-directory-aadconnectsync-configure-filtering/inbound4.png)  
5. В поле **Scoping filter** (Фильтр области действия) выберите **Добавить группу** и щелкните **Добавить предложение**. В разделе **Атрибут** выберите **department**. Убедитесь, что оператор задано слишком**равно**и введите значение hello **продажи** в hello **значение** поле. Щелкните **Далее**.  
   ![Область входящего объекта 5](./media/active-directory-aadconnectsync-configure-filtering/inbound5.png)  
6. Оставьте hello **Join** правила пустым и нажмите кнопку **Далее**.
7. Нажмите кнопку **добавить преобразование**выберите **константой** как hello **FlowType**и выберите hello **cloudFiltered** как hello  **Целевой атрибут**. В hello **источника** введите **False**. Нажмите кнопку **добавить** toosave hello правило.  
   ![Преобразование входящего объекта 6](./media/active-directory-aadconnectsync-configure-filtering/inbound6.png)  
   Это особый случай, где вы явным образом задать cloudFiltered слишком**False**.
8. Теперь у нас есть правило синхронизации универсальным toocreate hello. Присвойте правило hello описательное имя, такое как «*в from AD – пользователь универсальным фильтра*». Hello выберите правильный лес, выберите **пользователя** как hello **типа объекта CS**и выберите **лицо** как hello **типа объекта MV**. В поле **Тип связи** выберите **Join** (Присоединение). В поле **Приоритет** введите значение, которое не используется в другом правиле синхронизации (например, 99). Вы выбрали значение приоритета, имеет приоритет выше, (нижнем) чем hello предыдущего правила синхронизации. Но вы также оставили дополнительное пространство, можно добавить несколько правил синхронизации позже при необходимости toostart Синхронизация дополнительных отделов. Щелкните **Далее**.  
   ![Описание входящего объекта 7](./media/active-directory-aadconnectsync-configure-filtering/inbound7.png)  
9. Оставьте поле **Scoping filter** (Фильтр области) пустым и нажмите кнопку **Далее**. Пустой фильтр указывает hello правила применения toobe tooall объектов.
10. Оставьте hello **Join** правила пустым и нажмите кнопку **Далее**.
11. Нажмите кнопку **добавить преобразование**выберите **константой** как hello **FlowType**и выберите **cloudFiltered** как hello  **Целевой атрибут**. В hello **источника** введите **True**. Нажмите кнопку **добавить** toosave hello правило.  
    ![Преобразование входящего объекта 3](./media/active-directory-aadconnectsync-configure-filtering/inbound3.png)  
12. toocomplete hello конфигурации, необходимые toorun **полная синхронизация**. Продолжить чтение раздела hello [применить и проверка изменений](#apply-and-verify-changes).

Если необходимо, можно создать дополнительные правила hello первого типа, где содержат несколько объектов в hello синхронизации.

### <a name="outbound-filtering"></a>Фильтрация исходящих объектов
В некоторых случаях это hello необходимые toodo фильтрацию только после присоединения hello объектов в метавселенной hello. Например бывает необходимо toolook hello атрибут mail из леса ресурсов hello и hello атрибут userPrincipalName из леса учетных записей hello, toodetermine, если объект, должны быть синхронизированы. В таких случаях создание hello, фильтрация по hello правило исходящего трафика.

В этом примере Изменение hello фильтрации, чтобы имеют только пользователи, как почта, так и userPrincipalName, заканчивающиеся на @contoso.com синхронизации:

1. Войдите в toohello сервера, на котором выполняется синхронизация Azure AD Connect, используя учетную запись, которая является членом hello **ADSyncAdmins** группы безопасности.
2. Запуск **редактор правил синхронизации** из hello **запустить** меню.
3. В разделе **Rules Type** (Тип правил) выберите **Outbound** (Исходящие).
4. Правило hello поиска с именем **Out tooAAD – User Join**и нажмите кнопку **изменить**.
5. Во всплывающем hello ответить **Да** toocreate копию hello правило.
6. На hello **описание** измените **приоритет** tooan неиспользуемые значения, например 50.
7. Нажмите кнопку **фильтр области** на hello навигации слева, затем щелкните **добавить предложение**. В разделе **Атрибут** выберите **mail**. В разделе **Оператор** выберите **ENDSWITH**. В разделе **Значение** введите **@contoso.com**, а затем щелкните **Добавить предложение**. В разделе **Атрибут** выберите **userPrincipalName**. В разделе **Оператор** выберите **ENDSWITH**. В разделе **Значение** введите **@contoso.com**.
8. Щелкните **Сохранить**.
9. toocomplete hello конфигурации, необходимые toorun **полная синхронизация**. Продолжить чтение раздела hello [применить и проверка изменений](#apply-and-verify-changes).

## <a name="apply-and-verify-changes"></a>Примените и проверьте изменения
После внесения изменения конфигурации, необходимо применить их toohello объекты, которые уже присутствуют в системе hello. Он также может быть обработки hello объекты, которые в настоящее время отсутствуют в модуль синхронизации hello (и подсистема синхронизации hello должен tooread hello исходной системы снова tooverify его содержимое).

Если вы изменили hello конфигурацию с помощью **домена** или **подразделения** фильтрации, то вы должны toodo **полный импорт**, за которым следует **дельта Синхронизация**.

Если вы изменили hello конфигурацию с помощью **атрибута** фильтрации, то вы должны toodo **полная синхронизация**.

Здравствуйте, следующие действия:

1. Запуск **служба синхронизации** из hello **запустить** меню.
2. Выберите **Соединители**. В hello **соединители** выберите hello соединителя, где был сделан ранее изменение конфигурации. В разделе **Действия** выберите **Запуск**.  
   ![Выполнение соединителя](./media/active-directory-aadconnectsync-configure-filtering/connectorrun.png)  
3. В **профили запуска**, выберите операцию hello, описанный в предыдущем разделе hello. Если требуется два действия toorun выполнения hello, во-вторых, после hello первый завершено. (hello **состояние** столбец **Idle** для соединителя выбран hello.)

После синхронизации hello все изменения будут промежуточных toobe экспортированы. Перед внесением изменений hello фактически в Azure AD требуется tooverify правильность этих изменений.

1. Откройте командную строку и перейдите слишком`%Program Files%\Microsoft Azure AD Sync\bin`.
2. Запустите `csexport "Name of Connector" %temp%\export.xml /f:x`.  
   Имя Hello hello соединителя — в службе синхронизации. Она имеет аналогичные too"contoso.com имя — AAD» для Azure AD.
3. Запустите `CSExportAnalyzer %temp%\export.xml > %temp%\export.csv`.
4. Теперь у вас в папке %temp% есть файл export.csv, который можно просмотреть в Microsoft Excel. Этот файл содержит все изменения hello, высока вероятность toobe экспортированы.
5. Внесите необходимые изменения hello toohello данных или конфигурации и выполните эти шаги еще раз (импорта, синхронизации и проверьте) до hello изменения, которые будут экспортированы toobe, как ожидалось.

Если вы удовлетворены, экспорта tooAzure изменения hello AD.

1. Выберите **Соединители**. В hello **соединители** выберите hello соединителя Azure AD. В разделе **Действия** выберите **Запуск**.
2. В разделе **Run profiles** (Профили выполнения) выберите **Экспорт**.
3. Если изменения конфигурации удаляют множество объектов, появится сообщение об ошибке в файле экспорта hello, когда номер hello больше, чем пороговое значение hello настроен (по умолчанию 500). Если данная ошибка возникает, то вы должны отключить hello tootemporarily "[избежать случайного удаления](active-directory-aadconnectsync-feature-prevent-accidental-deletes.md)» компонента.

Теперь настало время tooenable hello планировщика еще раз.

1. Запуск **планировщик** из hello **запустить** меню.
2. Непосредственно под **Библиотека планировщика заданий**, задачу hello поиска с именем **Azure AD Sync Scheduler**, щелкните правой кнопкой мыши и выберите **включить**.

## <a name="group-based-filtering"></a>Фильтрация на основе группы
Можно настроить на основе групповой фильтрации hello первый раз установить Azure AD Connect с помощью [выборочной установки](active-directory-aadconnect-get-started-custom.md#sync-filtering-based-on-groups). Он предназначен для того, Пилотное развертывание место только небольшому числу toobe объектов синхронизации. После отключения фильтрацию на основе группы невозможно будет включить заново. Он имеет *не поддерживается* toouse фильтрации в пользовательской конфигурации на основе групп. Он поддерживается только tooconfigure этой функции с помощью мастера установки hello. После завершения вашего пилотного развертывания, выполните одно из hello другие параметры фильтрации в этом разделе. При использовании Подразделение фильтрации на основе вместе с фильтрации на основе группы, должен быть включен hello OU(s), где находятся группы hello и его членах.

При синхронизации нескольких лесов AD можно настроить фильтрацию по группам, указав отдельные группы для каждого соединителя AD. Если нужно toosynchronize пользователя в одном лесу AD и hello же пользователь имеет один или более соответствующих FSP (внешней безопасности) объектов в других лесах AD необходимо убедиться, hello объекта пользователя и его соответствующим FSP объекты находятся в групповые Фильтрация области. Если один или несколько объектов FSP hello исключаются фильтром на основе групп, hello объекта-пользователя не будет синхронизированные tooAzure AD.

## <a name="next-steps"></a>Дальнейшие действия
- Сведения о настройке службы синхронизации Azure AD Connect см. в [этой статье](active-directory-aadconnectsync-whatis.md).
- Сведения об интеграции локальных удостоверений с Azure Active Directory см. в [этой статье](active-directory-aadconnect.md).
