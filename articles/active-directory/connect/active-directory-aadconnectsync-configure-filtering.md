---
title: "Синхронизация Azure AD Connect: настройка фильтрации | Документация Майкрософт"
description: "В этой статье объясняется, как настроить фильтрацию в службах синхронизации Azure AD Connect."
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: 880facf6-1192-40e9-8181-544c0759d506
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 064642ebb9cafb0c6e1b3ff306241182a95215cc
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-sync-configure-filtering"></a><span data-ttu-id="22488-103">Синхронизация Azure AD Connect: настройка фильтрации</span><span class="sxs-lookup"><span data-stu-id="22488-103">Azure AD Connect sync: Configure filtering</span></span>
<span data-ttu-id="22488-104">Возможность фильтрации позволяет управлять тем, какие объекты локального каталога будут синхронизированы с Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="22488-104">By using filtering, you can control which objects appear in Azure Active Directory (Azure AD) from your on-premises directory.</span></span> <span data-ttu-id="22488-105">При конфигурации по умолчанию это все объекты во всех доменах настроенных лесов.</span><span class="sxs-lookup"><span data-stu-id="22488-105">The default configuration takes all objects in all domains in the configured forests.</span></span> <span data-ttu-id="22488-106">Эта конфигурация является рекомендуемой в большинстве случаев.</span><span class="sxs-lookup"><span data-stu-id="22488-106">In general, this is the recommended configuration.</span></span> <span data-ttu-id="22488-107">Пользователи системы Office 365, будь-то Exchange Online или Skype для бизнеса, могут использовать глобальный список адресов для отправки сообщений электронной почты и осуществления звонков по всем адресам.</span><span class="sxs-lookup"><span data-stu-id="22488-107">Users using Office 365 workloads, such as Exchange Online and Skype for Business, benefit from a complete Global Address List so they can send email and call everyone.</span></span> <span data-ttu-id="22488-108">Использование конфигурации по умолчанию позволяет им работать так же, как и с локальным экземпляром Exchange или Lync.</span><span class="sxs-lookup"><span data-stu-id="22488-108">With the default configuration, they would have the same experience that they would have with an on-premises implementation of Exchange or Lync.</span></span>

<span data-ttu-id="22488-109">Тем не менее в некоторых случаях в конфигурацию по умолчанию все же нужно внести некоторые изменения.</span><span class="sxs-lookup"><span data-stu-id="22488-109">In some cases however, you're required make some changes to the default configuration.</span></span> <span data-ttu-id="22488-110">Ниже приведены некоторые примеры:</span><span class="sxs-lookup"><span data-stu-id="22488-110">Here are some examples:</span></span>

* <span data-ttu-id="22488-111">Если необходимо использовать [топологию с несколькими каталогами Azure AD](active-directory-aadconnect-topologies.md#each-object-only-once-in-an-azure-ad-tenant).</span><span class="sxs-lookup"><span data-stu-id="22488-111">You plan to use the [multi-Azure AD directory topology](active-directory-aadconnect-topologies.md#each-object-only-once-in-an-azure-ad-tenant).</span></span> <span data-ttu-id="22488-112">В таком случае необходимо применить фильтр, чтобы выбрать, какие объекты следует синхронизировать с определенным каталогом Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-112">Then you need to apply a filter to control which objects are synchronized to a particular Azure AD directory.</span></span>
* <span data-ttu-id="22488-113">Используется пилотная программа Azure или Office 365, и нужно синхронизировать с Azure AD только определенных пользователей.</span><span class="sxs-lookup"><span data-stu-id="22488-113">You run a pilot for Azure or Office 365 and you only want a subset of users in Azure AD.</span></span> <span data-ttu-id="22488-114">Если программа небольшого размера, всеми преимуществами можно воспользоваться и без глобального списка адресов.</span><span class="sxs-lookup"><span data-stu-id="22488-114">In the small pilot, it's not important to have a complete Global Address List to demonstrate the functionality.</span></span>
* <span data-ttu-id="22488-115">Если не нужно синхронизировать с Azure AD много учетных записей служб и других рабочих учетных записей.</span><span class="sxs-lookup"><span data-stu-id="22488-115">You have many service accounts and other nonpersonal accounts that you don't want in Azure AD.</span></span>
* <span data-ttu-id="22488-116">В целях обеспечения соответствия нельзя локально удалять учетные записи пользователей,</span><span class="sxs-lookup"><span data-stu-id="22488-116">For compliance reasons, you don't delete any user accounts on-premises.</span></span> <span data-ttu-id="22488-117">но можно их отключить.</span><span class="sxs-lookup"><span data-stu-id="22488-117">You only disable them.</span></span> <span data-ttu-id="22488-118">Однако с Azure AD необходимо синхронизировать только активные учетные записи.</span><span class="sxs-lookup"><span data-stu-id="22488-118">But in Azure AD, you only want active accounts to be present.</span></span>

<span data-ttu-id="22488-119">В этой статье описано, как настроить различные методы фильтрации.</span><span class="sxs-lookup"><span data-stu-id="22488-119">This article covers how to configure the different filtering methods.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="22488-120">Мы поддерживаем изменение или использование служб синхронизации Azure AD Connect только в контексте официально задокументированных действий.</span><span class="sxs-lookup"><span data-stu-id="22488-120">Microsoft doesn't support modifying or operating Azure AD Connect sync outside of the actions that are formally documented.</span></span> <span data-ttu-id="22488-121">Любые иные действия могут привести к несогласованному или неподдерживаемому состоянию служб синхронизации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="22488-121">Any of these actions might result in an inconsistent or unsupported state of Azure AD Connect sync.</span></span> <span data-ttu-id="22488-122">Для таких развертываний Майкрософт не предоставляет техническую поддержку.</span><span class="sxs-lookup"><span data-stu-id="22488-122">As a result, Microsoft can't provide technical support for such deployments.</span></span>

## <a name="basics-and-important-notes"></a><span data-ttu-id="22488-123">Основные сведения и важные примечания</span><span class="sxs-lookup"><span data-stu-id="22488-123">Basics and important notes</span></span>
<span data-ttu-id="22488-124">В службах синхронизации Azure AD Connect фильтрацию можно включить в любое время.</span><span class="sxs-lookup"><span data-stu-id="22488-124">In Azure AD Connect sync, you can enable filtering at any time.</span></span> <span data-ttu-id="22488-125">Если вы сначала настроили синхронизацию каталогов с параметрами по умолчанию, а затем настроили фильтрацию, отфильтрованные объекты больше не будут синхронизироваться с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-125">If you start with a default configuration of directory synchronization and then configure filtering, the objects that are filtered out are no longer synchronized to Azure AD.</span></span> <span data-ttu-id="22488-126">В результате этого изменения все объекты в Azure AD, которые ранее были синхронизированы, а затем отфильтрованы, будут удалены из Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-126">Because of this change, any objects in Azure AD that were previously synchronized but were then filtered are deleted in Azure AD.</span></span>

<span data-ttu-id="22488-127">Прежде чем внести изменения в параметры фильтрации, [отключите запланированные задачи](#disable-scheduled-task), чтобы случайно не выполнить экспорт неправильно измененных данных.</span><span class="sxs-lookup"><span data-stu-id="22488-127">Before you start making changes to filtering, make sure that you [disable the scheduled task](#disable-scheduled-task) so you don't accidentally export changes that you haven't yet verified to be correct.</span></span>

<span data-ttu-id="22488-128">Поскольку в результате фильтрации можно одновременно удалить множество объектов, прежде чем экспортировать измененные данные в Azure AD, следует убедиться в правильности настроенных фильтров.</span><span class="sxs-lookup"><span data-stu-id="22488-128">Because filtering can remove many objects at the same time, you want to make sure that your new filters are correct before you start exporting any changes to Azure AD.</span></span> <span data-ttu-id="22488-129">После выполнения необходимых шагов по настройке, прежде чем выполнить экспорт и внести изменения в Azure AD, настоятельно рекомендуется выполнить [шаги для проверки](#apply-and-verify-changes).</span><span class="sxs-lookup"><span data-stu-id="22488-129">After you've completed the configuration steps, we strongly recommend that you follow the [verification steps](#apply-and-verify-changes) before you export and make changes to Azure AD.</span></span>

<span data-ttu-id="22488-130">Функция [предотвращения случайного удаления](active-directory-aadconnectsync-feature-prevent-accidental-deletes.md) включена по умолчанию, что позволяет предотвратить случайное удаление множества объектов.</span><span class="sxs-lookup"><span data-stu-id="22488-130">To protect you from deleting many objects by accident, the feature "[prevent accidental deletes](active-directory-aadconnectsync-feature-prevent-accidental-deletes.md)" is on by default.</span></span> <span data-ttu-id="22488-131">При удалении объектов с использованием фильтрации (по умолчанию — 500) необходимо выполнить шаги, описанные в этой статье, чтобы удаление распространилось на Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-131">If you delete many objects due to filtering (500 by default), you need to follow the steps in this article to allow the deletes to go through to Azure AD.</span></span>

<span data-ttu-id="22488-132">Если вы используете сборку, выпущенную до ноября 2015 года ([1.0.9125](active-directory-aadconnect-version-history.md#1091250)), при внесении изменений в конфигурацию фильтра, когда используется синхронизация паролей, необходимо запустить полную синхронизацию всех паролей после завершения настройки.</span><span class="sxs-lookup"><span data-stu-id="22488-132">If you use a build before November 2015 ([1.0.9125](active-directory-aadconnect-version-history.md#1091250)), make a change to a filter configuration, and use password synchronization, then you need to trigger a full sync of all passwords after you've completed the configuration.</span></span> <span data-ttu-id="22488-133">Описание шагов по запуску полной синхронизации паролей см. в разделе [Запуск полной синхронизации всех паролей](active-directory-aadconnectsync-troubleshoot-password-synchronization.md#trigger-a-full-sync-of-all-passwords).</span><span class="sxs-lookup"><span data-stu-id="22488-133">For steps on how to trigger a password full sync, see [Trigger a full sync of all passwords](active-directory-aadconnectsync-troubleshoot-password-synchronization.md#trigger-a-full-sync-of-all-passwords).</span></span> <span data-ttu-id="22488-134">Если вы используете сборку 1.0.9125 или более поздней версии, при выборе стандартного действия **полной синхронизации** можно задать, какие пароли следует синхронизировать, что лишает необходимости в дополнительном шаге.</span><span class="sxs-lookup"><span data-stu-id="22488-134">If you're on build 1.0.9125 or later, then the regular **full synchronization** action also calculates whether passwords should be synchronized and if this extra step is no longer required.</span></span>

<span data-ttu-id="22488-135">Если объекты-**пользователи** случайно удалены в Azure AD в результате ошибки фильтрации, их можно воссоздать в этой службе, удалив настройки фильтрации.</span><span class="sxs-lookup"><span data-stu-id="22488-135">If **user** objects were inadvertently deleted in Azure AD because of a filtering error, you can recreate the user objects in Azure AD by removing your filtering configurations.</span></span> <span data-ttu-id="22488-136">Затем можно снова синхронизировать каталоги.</span><span class="sxs-lookup"><span data-stu-id="22488-136">Then you can synchronize your directories again.</span></span> <span data-ttu-id="22488-137">Это действие позволяет восстановить пользователей из корзины в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-137">This action restores the users from the recycle bin in Azure AD.</span></span> <span data-ttu-id="22488-138">Однако удаление объектов других типов отменить нельзя.</span><span class="sxs-lookup"><span data-stu-id="22488-138">However, you can't undelete other object types.</span></span> <span data-ttu-id="22488-139">Например, если вы случайно удалите группу безопасности, использованную в списках управления доступом к ресурсам, нельзя будет восстановить ни группу, ни соответствующие списки.</span><span class="sxs-lookup"><span data-stu-id="22488-139">For example, if you accidentally delete a security group and it was used to ACL a resource, the group and its ACLs can't be recovered.</span></span>

<span data-ttu-id="22488-140">Azure AD Connect удаляет только те объекты, которые соответствуют фильтру.</span><span class="sxs-lookup"><span data-stu-id="22488-140">Azure AD Connect only deletes objects that it has once considered to be in scope.</span></span> <span data-ttu-id="22488-141">Объекты Azure AD, созданные в результате работы другого модуля синхронизации и не соответствующие фильтру, удалены не будут.</span><span class="sxs-lookup"><span data-stu-id="22488-141">If there are objects in Azure AD that were created by another sync engine and these objects aren't in scope, adding filtering doesn't remove them.</span></span> <span data-ttu-id="22488-142">Например, если изначально вы использовали сервер DirSync, который создал полную копию всего каталога в Azure AD, а затем установили новый сервер синхронизации Azure AD Connect и в начале его работы была включена фильтрация, то Azure AD Connect не удалит объекты, созданные DirSync.</span><span class="sxs-lookup"><span data-stu-id="22488-142">For example, if you start with a DirSync server that created a complete copy of your entire directory in Azure AD, and you install a new Azure AD Connect sync server in parallel with filtering enabled from the beginning, Azure AD Connect doesn't remove the extra objects that are created by DirSync.</span></span>

<span data-ttu-id="22488-143">При установке Azure AD Connect или обновлении до новой версии сохраняются все имеющиеся конфигурации.</span><span class="sxs-lookup"><span data-stu-id="22488-143">The filtering configuration is retained when you install or upgrade to a newer version of Azure AD Connect.</span></span> <span data-ttu-id="22488-144">Перед выполнением первого цикла синхронизации мы настоятельно рекомендуем убедиться, что ваша конфигурация не была случайно изменена после обновления до новой версии.</span><span class="sxs-lookup"><span data-stu-id="22488-144">It's always a best practice to verify that the configuration wasn't inadvertently changed after an upgrade to a newer version before running the first synchronization cycle.</span></span>

<span data-ttu-id="22488-145">При наличии нескольких лесов параметры фильтрации, описанные в этой статье, нужно применить к каждому из них (если у всех лесов должна быть одинаковая конфигурация).</span><span class="sxs-lookup"><span data-stu-id="22488-145">If you have more than one forest, then you must apply the filtering configurations that are described in this topic to every forest (assuming that you want the same configuration for all of them).</span></span>

### <a name="disable-the-scheduled-task"></a><span data-ttu-id="22488-146">Отключение запланированной задачи</span><span class="sxs-lookup"><span data-stu-id="22488-146">Disable the scheduled task</span></span>
<span data-ttu-id="22488-147">Чтобы отключить встроенный планировщик, запускающий цикл синхронизации каждые 30 минут, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="22488-147">To disable the built-in scheduler that triggers a synchronization cycle every 30 minutes, follow these steps:</span></span>

1. <span data-ttu-id="22488-148">Перейдите к командной строке PowerShell.</span><span class="sxs-lookup"><span data-stu-id="22488-148">Go to a PowerShell prompt.</span></span>
2. <span data-ttu-id="22488-149">Запустите `Set-ADSyncScheduler -SyncCycleEnabled $False` , чтобы отключить планировщик.</span><span class="sxs-lookup"><span data-stu-id="22488-149">Run `Set-ADSyncScheduler -SyncCycleEnabled $False` to disable the scheduler.</span></span>
3. <span data-ttu-id="22488-150">Внесите изменения, описанные в этой статье.</span><span class="sxs-lookup"><span data-stu-id="22488-150">Make the changes that are documented in this article.</span></span>
4. <span data-ttu-id="22488-151">Запустите `Set-ADSyncScheduler -SyncCycleEnabled $True` , чтобы снова включить планировщик.</span><span class="sxs-lookup"><span data-stu-id="22488-151">Run `Set-ADSyncScheduler -SyncCycleEnabled $True` to enable the scheduler again.</span></span>

<span data-ttu-id="22488-152">**При использовании сборки Azure AD Connect до версии 1.1.105.0**</span><span class="sxs-lookup"><span data-stu-id="22488-152">**If you use an Azure AD Connect build before 1.1.105.0**</span></span>  
<span data-ttu-id="22488-153">Чтобы отключить запланированную задачу по запуску цикла синхронизации каждые три часа, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="22488-153">To disable the scheduled task that triggers a synchronization cycle every three hours, follow these steps:</span></span>

1. <span data-ttu-id="22488-154">В меню **Пуск** запустите **планировщик задач**.</span><span class="sxs-lookup"><span data-stu-id="22488-154">Start **Task Scheduler** from the **Start** menu.</span></span>
2. <span data-ttu-id="22488-155">Прямо в каталоге **Библиотека планировщика заданий** найдите задачу с именем **Azure AD Sync Scheduler** (Планировщик синхронизации Azure AD Sync), щелкните ее правой кнопкой мыши и выберите пункт **Отключить**.</span><span class="sxs-lookup"><span data-stu-id="22488-155">Directly under **Task Scheduler Library**, find the task named **Azure AD Sync Scheduler**, right-click, and select **Disable**.</span></span>  
   <span data-ttu-id="22488-156">![планировщик задач](./media/active-directory-aadconnectsync-configure-filtering/taskscheduler.png)</span><span class="sxs-lookup"><span data-stu-id="22488-156">![Task Scheduler](./media/active-directory-aadconnectsync-configure-filtering/taskscheduler.png)</span></span>  
3. <span data-ttu-id="22488-157">Теперь можно внести изменения в конфигурацию и запустить модуль синхронизации вручную из консоли **Synchronization Service Manager**.</span><span class="sxs-lookup"><span data-stu-id="22488-157">You can now make configuration changes and run the sync engine manually from the **Synchronization Service Manager** console.</span></span>

<span data-ttu-id="22488-158">После внесения всех изменений в параметры фильтрации вернитесь обратно и снова выполните команду **Включить** для этой задачи.</span><span class="sxs-lookup"><span data-stu-id="22488-158">After you've completed all your filtering changes, don't forget to come back and **Enable** the task again.</span></span>

## <a name="filtering-options"></a><span data-ttu-id="22488-159">Параметры фильтрации</span><span class="sxs-lookup"><span data-stu-id="22488-159">Filtering options</span></span>
<span data-ttu-id="22488-160">В средстве синхронизации каталога можно настроить использование следующих типов конфигурации фильтрации:</span><span class="sxs-lookup"><span data-stu-id="22488-160">You can apply the following filtering configuration types to the directory synchronization tool:</span></span>

* <span data-ttu-id="22488-161">[**По группам.**](#group-based-filtering) Фильтрацию по одной группе можно настроить только при изначальной установке с помощью соответствующего мастера.</span><span class="sxs-lookup"><span data-stu-id="22488-161">[**Group-based**](#group-based-filtering): Filtering based on a single group can only be configured on initial installation by using the installation wizard.</span></span>
* <span data-ttu-id="22488-162">[**По доменам.**](#domain-based-filtering) Этот параметр позволяет выбрать, какие домены следует синхронизировать с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-162">[**Domain-based**](#domain-based-filtering): By using this option, you can select which domains synchronize to Azure AD.</span></span> <span data-ttu-id="22488-163">Также можно добавлять и удалять домены из модуля синхронизации при внесении изменений в локальную инфраструктуру после установки службы синхронизации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="22488-163">You can also add and remove domains from the sync engine configuration when you make changes to your on-premises infrastructure after you install Azure AD Connect sync.</span></span>
* <span data-ttu-id="22488-164">[**По подразделениям.**](#organizational-unitbased-filtering) Этот параметр позволяет выбрать, какие подразделения следует синхронизировать с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-164">[**Organizational unit (OU)–based**](#organizational-unitbased-filtering): By using this option, you can select which OUs synchronize to Azure AD.</span></span> <span data-ttu-id="22488-165">Действие этого параметра распространяется на все типы объектов в выбранных подразделениях.</span><span class="sxs-lookup"><span data-stu-id="22488-165">This option is for all object types in selected OUs.</span></span>
* <span data-ttu-id="22488-166">[**По атрибутам.**](#attribute-based-filtering) Этот параметр позволяет фильтровать объекты по значениям атрибутов.</span><span class="sxs-lookup"><span data-stu-id="22488-166">[**Attribute-based**](#attribute-based-filtering): By using this option, you can filter objects based on attribute values on the objects.</span></span> <span data-ttu-id="22488-167">Кроме того, для объектов различных типов можно использовать разные фильтры.</span><span class="sxs-lookup"><span data-stu-id="22488-167">You can also have different filters for different object types.</span></span>

<span data-ttu-id="22488-168">Можно также одновременно использовать несколько параметров фильтрации.</span><span class="sxs-lookup"><span data-stu-id="22488-168">You can use multiple filtering options at the same time.</span></span> <span data-ttu-id="22488-169">Например, можно использовать фильтрацию по подразделению, чтобы включить объекты в одном подразделении,</span><span class="sxs-lookup"><span data-stu-id="22488-169">For example, you can use OU-based filtering to only include objects in one OU.</span></span> <span data-ttu-id="22488-170">и одновременно фильтрацию по атрибуту, чтобы сузить круг результатов.</span><span class="sxs-lookup"><span data-stu-id="22488-170">At the same time, you can use attribute-based filtering to filter the objects further.</span></span> <span data-ttu-id="22488-171">При использовании нескольких методов фильтрации между фильтрами ставится логический оператор AND.</span><span class="sxs-lookup"><span data-stu-id="22488-171">When you use multiple filtering methods, the filters use a logical "AND" between the filters.</span></span>

## <a name="domain-based-filtering"></a><span data-ttu-id="22488-172">Фильтрация по доменам</span><span class="sxs-lookup"><span data-stu-id="22488-172">Domain-based filtering</span></span>
<span data-ttu-id="22488-173">В этом разделе описана процедура настройки фильтра по доменам.</span><span class="sxs-lookup"><span data-stu-id="22488-173">This section provides you with the steps to configure your domain filter.</span></span> <span data-ttu-id="22488-174">Если вы установили Azure AD Connect, а затем добавили или удалили в лесу домены, вам также необходимо обновить конфигурацию фильтрации.</span><span class="sxs-lookup"><span data-stu-id="22488-174">If you added or removed domains in your forest after you installed Azure AD Connect, you also have to update the filtering configuration.</span></span>

<span data-ttu-id="22488-175">Для изменения фильтрации по доменам лучше всего запустить мастер установки и изменить [фильтрацию домена и подразделения](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering).</span><span class="sxs-lookup"><span data-stu-id="22488-175">The preferred way to change domain-based filtering is by running the installation wizard and changing [domain and OU filtering](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering).</span></span> <span data-ttu-id="22488-176">Мастер установки автоматизирует все описанные здесь задачи.</span><span class="sxs-lookup"><span data-stu-id="22488-176">The installation wizard automates all the tasks that are documented in this topic.</span></span>

<span data-ttu-id="22488-177">Выполнять эти действия вручную следует только в том случае, если мастер установки не удается запустить по какой-либо причине.</span><span class="sxs-lookup"><span data-stu-id="22488-177">You should only follow these steps if you're unable to run the installation wizard for some reason.</span></span>

<span data-ttu-id="22488-178">Настройка фильтрации по доменам предусматривает следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="22488-178">Domain-based filtering configuration consists of these steps:</span></span>

1. <span data-ttu-id="22488-179">[Выберите домены](#select-domains-to-be-synchronized), которые следует задействовать при синхронизации.</span><span class="sxs-lookup"><span data-stu-id="22488-179">[Select the domains](#select-domains-to-be-synchronized) that you want to include in the synchronization.</span></span>
2. <span data-ttu-id="22488-180">Настройте [профили выполнения](#update-run-profiles)для каждого добавленного и удаленного домена.</span><span class="sxs-lookup"><span data-stu-id="22488-180">For each added and removed domain, adjust the [run profiles](#update-run-profiles).</span></span>
3. <span data-ttu-id="22488-181">[Примените и проверьте изменения](#apply-and-verify-changes).</span><span class="sxs-lookup"><span data-stu-id="22488-181">[Apply and verify changes](#apply-and-verify-changes).</span></span>

### <a name="select-the-domains-to-be-synchronized"></a><span data-ttu-id="22488-182">Выбор доменов для синхронизации</span><span class="sxs-lookup"><span data-stu-id="22488-182">Select the domains to be synchronized</span></span>
<span data-ttu-id="22488-183">Настройка фильтрации по доменам</span><span class="sxs-lookup"><span data-stu-id="22488-183">To set the domain filter, do the following steps:</span></span>

1. <span data-ttu-id="22488-184">Войдите на сервер, на котором запущена служба синхронизации Azure AD Connect, используя данные учетной записи участника группы безопасности **ADSyncAdmins** .</span><span class="sxs-lookup"><span data-stu-id="22488-184">Sign in to the server that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.</span></span>
2. <span data-ttu-id="22488-185">Запустите **службу синхронизации** из меню **Пуск**.</span><span class="sxs-lookup"><span data-stu-id="22488-185">Start **Synchronization Service** from the **Start** menu.</span></span>
3. <span data-ttu-id="22488-186">Щелкните **Соединители** и в списке **соединителей** выберите элемент типа **Доменные службы Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="22488-186">Select **Connectors**, and in the **Connectors** list, select the Connector with the type **Active Directory Domain Services**.</span></span> <span data-ttu-id="22488-187">В разделе **Действия** выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="22488-187">In **Actions**, select **Properties**.</span></span>  
   <span data-ttu-id="22488-188">![Свойства соединителя](./media/active-directory-aadconnectsync-configure-filtering/connectorproperties.png)</span><span class="sxs-lookup"><span data-stu-id="22488-188">![Connector properties](./media/active-directory-aadconnectsync-configure-filtering/connectorproperties.png)</span></span>  
4. <span data-ttu-id="22488-189">Щелкните **Настроить разделы каталога**.</span><span class="sxs-lookup"><span data-stu-id="22488-189">Click **Configure Directory Partitions**.</span></span>
5. <span data-ttu-id="22488-190">В списке **Select directory partitions** (Выберите разделы каталога) выберите необходимые домены или отмените выбор.</span><span class="sxs-lookup"><span data-stu-id="22488-190">In the **Select directory partitions** list, select and unselect domains as needed.</span></span> <span data-ttu-id="22488-191">Должны быть выбраны только те разделы, которые следует синхронизировать.</span><span class="sxs-lookup"><span data-stu-id="22488-191">Verify that only the partitions that you want to synchronize are selected.</span></span>  
   <span data-ttu-id="22488-192">![Разделы](./media/active-directory-aadconnectsync-configure-filtering/connectorpartitions.png)</span><span class="sxs-lookup"><span data-stu-id="22488-192">![Partitions](./media/active-directory-aadconnectsync-configure-filtering/connectorpartitions.png)</span></span>  
   <span data-ttu-id="22488-193">Если вы изменили локальную инфраструктуру Active Directory и добавили или удалили домены в лесу, нажмите кнопку **Обновить**, чтобы получить обновленный список.</span><span class="sxs-lookup"><span data-stu-id="22488-193">If you've changed your on-premises Active Directory infrastructure and added or removed domains from the forest, then click the **Refresh** button to get an updated list.</span></span> <span data-ttu-id="22488-194">Во время обновления будет предложено ввести учетные данные.</span><span class="sxs-lookup"><span data-stu-id="22488-194">When you refresh, you're asked for credentials.</span></span> <span data-ttu-id="22488-195">Укажите учетные данные, с помощью которых можно получить доступ для чтения к Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="22488-195">Provide any credentials with read access to Windows Server Active Directory.</span></span> <span data-ttu-id="22488-196">Убедитесь, что в этом диалоговом окне вы не используете предварительно заполненные данные пользователя.</span><span class="sxs-lookup"><span data-stu-id="22488-196">It doesn't have to be the user that is prepopulated in the dialog box.</span></span>  
   <span data-ttu-id="22488-197">![Требуется обновление](./media/active-directory-aadconnectsync-configure-filtering/refreshneeded.png)</span><span class="sxs-lookup"><span data-stu-id="22488-197">![Refresh needed](./media/active-directory-aadconnectsync-configure-filtering/refreshneeded.png)</span></span>  
6. <span data-ttu-id="22488-198">Выполнив все действия, закройте диалоговое окно **Свойства**, нажав кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="22488-198">When you're done, close the **Properties** dialog by clicking **OK**.</span></span> <span data-ttu-id="22488-199">Если вы удалили домены из леса, появится всплывающее сообщение о том, что домен удален и конфигурация будет очищена.</span><span class="sxs-lookup"><span data-stu-id="22488-199">If you removed domains from the forest, a message pop-up says that a domain was removed and that configuration will be cleaned up.</span></span>
7. <span data-ttu-id="22488-200">Продолжите работу, чтобы настроить [профили выполнения](#update-run-profiles).</span><span class="sxs-lookup"><span data-stu-id="22488-200">Continue to adjust the [run profiles](#update-run-profiles).</span></span>

### <a name="update-the-run-profiles"></a><span data-ttu-id="22488-201">Обновление профилей выполнения</span><span class="sxs-lookup"><span data-stu-id="22488-201">Update the run profiles</span></span>
<span data-ttu-id="22488-202">После обновления фильтра доменов нужно также изменить профили выполнения.</span><span class="sxs-lookup"><span data-stu-id="22488-202">If you've updated your domain filter, you also need to update the run profiles.</span></span>

1. <span data-ttu-id="22488-203">В списке **Соединители** выберите соединитель, настроенный на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="22488-203">In the **Connectors** list, make sure that the Connector that you changed in the previous step is selected.</span></span> <span data-ttu-id="22488-204">В разделе **Действия** выберите **Configure Run Profiles** (Настроить профили выполнения).</span><span class="sxs-lookup"><span data-stu-id="22488-204">In **Actions**, select **Configure Run Profiles**.</span></span>  
   <span data-ttu-id="22488-205">![Профили выполнения соединителя 1](./media/active-directory-aadconnectsync-configure-filtering/connectorrunprofiles1.png)</span><span class="sxs-lookup"><span data-stu-id="22488-205">![Connector run profiles 1](./media/active-directory-aadconnectsync-configure-filtering/connectorrunprofiles1.png)</span></span>  
2. <span data-ttu-id="22488-206">Найдите и определите следующие профили:</span><span class="sxs-lookup"><span data-stu-id="22488-206">Find and identify the following profiles:</span></span>
    * <span data-ttu-id="22488-207">полный импорт;</span><span class="sxs-lookup"><span data-stu-id="22488-207">Full Import</span></span>
    * <span data-ttu-id="22488-208">полная синхронизация;</span><span class="sxs-lookup"><span data-stu-id="22488-208">Full Synchronization</span></span>
    * <span data-ttu-id="22488-209">импорт изменений;</span><span class="sxs-lookup"><span data-stu-id="22488-209">Delta Import</span></span>
    * <span data-ttu-id="22488-210">синхронизация изменений;</span><span class="sxs-lookup"><span data-stu-id="22488-210">Delta Synchronization</span></span>
    * <span data-ttu-id="22488-211">экспорт.</span><span class="sxs-lookup"><span data-stu-id="22488-211">Export</span></span>
3. <span data-ttu-id="22488-212">Для каждого профиля настройте **добавленные** и **удаленные** домены.</span><span class="sxs-lookup"><span data-stu-id="22488-212">For each profile, adjust the **added** and **removed** domains.</span></span>
    1. <span data-ttu-id="22488-213">Выполните следующие действия для каждого из пяти профилей всех **добавленных** доменов:</span><span class="sxs-lookup"><span data-stu-id="22488-213">For each of the five profiles, do the following steps for each **added** domain:</span></span>
        1. <span data-ttu-id="22488-214">Выберите профиль выполнения и щелкните **Новый шаг**.</span><span class="sxs-lookup"><span data-stu-id="22488-214">Select the run profile and click **New Step**.</span></span>
        2. <span data-ttu-id="22488-215">На странице **Configure Step** (Настройка шага) в раскрывающемся меню **Тип** выберите тип шага с тем же именем, что и у настраиваемого профиля.</span><span class="sxs-lookup"><span data-stu-id="22488-215">On the **Configure Step** page, in the **Type** drop-down menu, select the step type with the same name as the profile that you're configuring.</span></span> <span data-ttu-id="22488-216">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-216">Then click **Next**.</span></span>  
        <span data-ttu-id="22488-217">![Профили выполнения соединителя 2](./media/active-directory-aadconnectsync-configure-filtering/runprofilesnewstep1.png)</span><span class="sxs-lookup"><span data-stu-id="22488-217">![Connector run profiles 2](./media/active-directory-aadconnectsync-configure-filtering/runprofilesnewstep1.png)</span></span>  
        3. <span data-ttu-id="22488-218">На странице **Connector Configuration** (Настройка соединителя) в раскрывающемся списке **Раздел** выберите имя домена, добавленного в фильтр доменов.</span><span class="sxs-lookup"><span data-stu-id="22488-218">On the **Connector Configuration** page, in the **Partition** drop-down menu, select the name of the domain that you've added to your domain filter.</span></span>  
        <span data-ttu-id="22488-219">![Профили выполнения соединителя 3](./media/active-directory-aadconnectsync-configure-filtering/runprofilesnewstep2.png)</span><span class="sxs-lookup"><span data-stu-id="22488-219">![Connector run profiles 3](./media/active-directory-aadconnectsync-configure-filtering/runprofilesnewstep2.png)</span></span>  
        4. <span data-ttu-id="22488-220">Чтобы закрыть диалоговое окно **Configure Run Profile** (Настройка профиля выполнения), нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="22488-220">To close the **Configure Run Profile** dialog, click **Finish**.</span></span>
    2. <span data-ttu-id="22488-221">Выполните следующие действия для каждого из пяти профилей всех **удаленных** доменов:</span><span class="sxs-lookup"><span data-stu-id="22488-221">For each of the five profiles, do the following steps for each **removed** domain:</span></span>
        1. <span data-ttu-id="22488-222">Выберите профиль выполнения.</span><span class="sxs-lookup"><span data-stu-id="22488-222">Select the run profile.</span></span>
        2. <span data-ttu-id="22488-223">Если для атрибута **Раздел** в поле **Значение** указан GUID, то выберите шаг выполнения и нажмите кнопку **Удалить шаг**.</span><span class="sxs-lookup"><span data-stu-id="22488-223">If the **Value** of the **Partition** attribute is a GUID, select the run step and click **Delete Step**.</span></span>  
        <span data-ttu-id="22488-224">![Профили выполнения соединителя 4](./media/active-directory-aadconnectsync-configure-filtering/runprofilesdeletestep.png)</span><span class="sxs-lookup"><span data-stu-id="22488-224">![Connector run profiles 4](./media/active-directory-aadconnectsync-configure-filtering/runprofilesdeletestep.png)</span></span>  
    3. <span data-ttu-id="22488-225">Проверьте внесенные изменения.</span><span class="sxs-lookup"><span data-stu-id="22488-225">Verify your change.</span></span> <span data-ttu-id="22488-226">Каждый домен, который нужно синхронизировать, должен быть указан в качестве шага в каждом профиле выполнения.</span><span class="sxs-lookup"><span data-stu-id="22488-226">Each domain that you want to synchronize should be listed as a step in each run profile.</span></span>
4. <span data-ttu-id="22488-227">Чтобы закрыть диалоговое окно **Configure Run Profiles** (Настройка профилей выполнения), нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="22488-227">To close the **Configure Run Profiles** dialog, click **OK**.</span></span>
5.  <span data-ttu-id="22488-228">Чтобы завершить настройку, необходимо выполнить **полный импорт** и **разностную синхронизацию**.</span><span class="sxs-lookup"><span data-stu-id="22488-228">To complete the configuration, you need to run a **Full import** and a **Delta sync**.</span></span> <span data-ttu-id="22488-229">Вернитесь к чтению раздела [Применение и проверка изменений](#apply-and-verify-changes).</span><span class="sxs-lookup"><span data-stu-id="22488-229">Continue reading the section [Apply and verify changes](#apply-and-verify-changes).</span></span>

## <a name="organizational-unitbased-filtering"></a><span data-ttu-id="22488-230">Фильтрация по подразделениям</span><span class="sxs-lookup"><span data-stu-id="22488-230">Organizational unit–based filtering</span></span>
<span data-ttu-id="22488-231">Для изменения фильтрации по подразделениям лучше всего запустить мастер установки и изменить [фильтрацию по доменам и подразделениям](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering).</span><span class="sxs-lookup"><span data-stu-id="22488-231">The preferred way to change OU-based filtering is by running the installation wizard and changing [domain and OU filtering](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering).</span></span> <span data-ttu-id="22488-232">Мастер установки автоматизирует все описанные здесь задачи.</span><span class="sxs-lookup"><span data-stu-id="22488-232">The installation wizard automates all the tasks that are documented in this topic.</span></span>

<span data-ttu-id="22488-233">Выполнять эти действия вручную следует только в том случае, если мастер установки не удается запустить по какой-либо причине.</span><span class="sxs-lookup"><span data-stu-id="22488-233">You should only follow these steps if you're unable to run the installation wizard for some reason.</span></span>

<span data-ttu-id="22488-234">Чтобы настроить фильтрацию по подразделениям, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="22488-234">To configure organizational unit–based filtering, do the following steps:</span></span>

1. <span data-ttu-id="22488-235">Войдите на сервер, на котором запущена служба синхронизации Azure AD Connect, используя данные учетной записи участника группы безопасности **ADSyncAdmins** .</span><span class="sxs-lookup"><span data-stu-id="22488-235">Sign in to the server that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.</span></span>
2. <span data-ttu-id="22488-236">Запустите **службу синхронизации** из меню **Пуск**.</span><span class="sxs-lookup"><span data-stu-id="22488-236">Start **Synchronization Service** from the **Start** menu.</span></span>
3. <span data-ttu-id="22488-237">Щелкните **Соединители** и в списке **соединителей** выберите элемент типа **Доменные службы Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="22488-237">Select **Connectors**, and in the **Connectors** list, select the Connector with the type **Active Directory Domain Services**.</span></span> <span data-ttu-id="22488-238">В разделе **Действия** выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="22488-238">In **Actions**, select **Properties**.</span></span>  
   <span data-ttu-id="22488-239">![Свойства соединителя](./media/active-directory-aadconnectsync-configure-filtering/connectorproperties.png)</span><span class="sxs-lookup"><span data-stu-id="22488-239">![Connector properties](./media/active-directory-aadconnectsync-configure-filtering/connectorproperties.png)</span></span>  
4. <span data-ttu-id="22488-240">Щелкните **Configure Directory Partitions** (Настроить разделы каталога), выберите домен, который нужно настроить, а затем щелкните **Контейнеры**.</span><span class="sxs-lookup"><span data-stu-id="22488-240">Click **Configure Directory Partitions**, select the domain that you want to configure, and then click **Containers**.</span></span>
5. <span data-ttu-id="22488-241">Когда отобразится запрос, укажите учетные данные, с помощью которых можно получить доступ для чтения к локальному экземпляру Active Directory.</span><span class="sxs-lookup"><span data-stu-id="22488-241">When you're prompted, provide any credentials with read access to your on-premises Active Directory.</span></span> <span data-ttu-id="22488-242">Убедитесь, что в этом диалоговом окне вы не используете предварительно заполненные данные пользователя.</span><span class="sxs-lookup"><span data-stu-id="22488-242">It doesn't have to be the user that is prepopulated in the dialog box.</span></span>
6. <span data-ttu-id="22488-243">В диалоговом окне **Select Containers** (Выбор контейнеров) удалите подразделения, которые не нужно синхронизировать с облачным каталогом, и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="22488-243">In the **Select Containers** dialog box, clear the OUs that you don’t want to synchronize with the cloud directory, and then click **OK**.</span></span>  
   <span data-ttu-id="22488-244">![Подразделения в диалоговом окне Select Containers (Выбор контейнеров)](./media/active-directory-aadconnectsync-configure-filtering/ou.png)</span><span class="sxs-lookup"><span data-stu-id="22488-244">![OUs in the Select Containers dialog box](./media/active-directory-aadconnectsync-configure-filtering/ou.png)</span></span>  
   * <span data-ttu-id="22488-245">Чтобы синхронизация компьютеров Windows 10 с Azure AD прошла успешно, должен быть установлен флажок для контейнера **Компьютеры** .</span><span class="sxs-lookup"><span data-stu-id="22488-245">The **Computers** container should be selected for your Windows 10 computers to be successfully synchronized to Azure AD.</span></span> <span data-ttu-id="22488-246">Если компьютеры, присоединенные к домену, находятся в других подразделениях, выберите соответствующие подразделения.</span><span class="sxs-lookup"><span data-stu-id="22488-246">If your domain-joined computers are located in other OUs, make sure those are selected.</span></span>
   * <span data-ttu-id="22488-247">При наличии нескольких доверенных лесов должен быть установлен флажок для контейнера **ForeignSecurityPrincipals** .</span><span class="sxs-lookup"><span data-stu-id="22488-247">The **ForeignSecurityPrincipals** container should be selected if you have multiple forests with trusts.</span></span> <span data-ttu-id="22488-248">Этот контейнер позволяет разрешить членство в группе безопасности между лесами.</span><span class="sxs-lookup"><span data-stu-id="22488-248">This container allows cross-forest security group membership to be resolved.</span></span>
   * <span data-ttu-id="22488-249">Если включена функция обратной записи устройств, должен быть установлен флажок для подразделения **RegisteredDevices**.</span><span class="sxs-lookup"><span data-stu-id="22488-249">The **RegisteredDevices** OU should be selected if you enabled the device writeback feature.</span></span> <span data-ttu-id="22488-250">Если используется другая функция обратной записи, такая как обратная запись группы, выберите соответствующие расположения.</span><span class="sxs-lookup"><span data-stu-id="22488-250">If you use another writeback feature, such as group writeback, make sure these locations are selected.</span></span>
   * <span data-ttu-id="22488-251">Выберите все подразделения, к которым принадлежат объекты контейнеров «Пользователи», iNetOrgPersons, «Группы», «Контакты» и «Компьютеры».</span><span class="sxs-lookup"><span data-stu-id="22488-251">Select any other OU where Users, iNetOrgPersons, Groups, Contacts, and Computers are located.</span></span> <span data-ttu-id="22488-252">На рисунке показано, что все они находятся в подразделении ManagedObjects.</span><span class="sxs-lookup"><span data-stu-id="22488-252">In the picture, all these OUs are located in the ManagedObjects OU.</span></span>
   * <span data-ttu-id="22488-253">При использовании фильтрации на основе группы подразделение, где находится группа, должно быть включено.</span><span class="sxs-lookup"><span data-stu-id="22488-253">If you use group-based filtering, then the OU where the group is located must be included.</span></span>
   * <span data-ttu-id="22488-254">Обратите внимание, что можно настроить, следует ли синхронизировать новые подразделения, добавленные после завершения настройки фильтрации.</span><span class="sxs-lookup"><span data-stu-id="22488-254">Note that you can configure whether new OUs that are added after the filtering configuration finishes are synchronized or not synchronized.</span></span> <span data-ttu-id="22488-255">подробности приведены в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="22488-255">See the next section for details.</span></span>
7. <span data-ttu-id="22488-256">Выполнив все действия, закройте диалоговое окно **Свойства**, нажав кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="22488-256">When you're done, close the **Properties** dialog by clicking **OK**.</span></span>
8. <span data-ttu-id="22488-257">Чтобы завершить настройку, необходимо выполнить **полный импорт** и **разностную синхронизацию**.</span><span class="sxs-lookup"><span data-stu-id="22488-257">To complete the configuration, you need to run a **Full import** and a **Delta sync**.</span></span> <span data-ttu-id="22488-258">Вернитесь к чтению раздела [Применение и проверка изменений](#apply-and-verify-changes).</span><span class="sxs-lookup"><span data-stu-id="22488-258">Continue reading the section [Apply and verify changes](#apply-and-verify-changes).</span></span>

### <a name="synchronize-new-ous"></a><span data-ttu-id="22488-259">Синхронизация новых подразделений</span><span class="sxs-lookup"><span data-stu-id="22488-259">Synchronize new OUs</span></span>
<span data-ttu-id="22488-260">Новые подразделения, созданные после настройки фильтрации, синхронизируются по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="22488-260">New OUs that are created after filtering has been configured are synchronized by default.</span></span> <span data-ttu-id="22488-261">Это состояние обозначается установленным флажком.</span><span class="sxs-lookup"><span data-stu-id="22488-261">This state is indicated by a selected check box.</span></span> <span data-ttu-id="22488-262">С некоторых подразделений можно снять флажки.</span><span class="sxs-lookup"><span data-stu-id="22488-262">You can also unselect some sub-OUs.</span></span> <span data-ttu-id="22488-263">Для этого щелкайте поле, пока оно не станет белым и не будет содержать синий флажок (состояние по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="22488-263">To get this behavior, click the box until it becomes white with a blue check mark (its default state).</span></span> <span data-ttu-id="22488-264">Затем снимите флажки для подразделений, которые не нужно синхронизировать.</span><span class="sxs-lookup"><span data-stu-id="22488-264">Then unselect any sub-OUs that you don't want to synchronize.</span></span>

<span data-ttu-id="22488-265">Если синхронизируются все отделы, поле будет белым с синим флажком.</span><span class="sxs-lookup"><span data-stu-id="22488-265">If all sub-OUs are synchronized, then the box is white with a blue check mark.</span></span>  
![Подразделение со всеми установленными флажками](./media/active-directory-aadconnectsync-configure-filtering/ousyncnewall.png)

<span data-ttu-id="22488-267">Если некоторые отделы не были выбраны, то поля будут серыми с белым флажком.</span><span class="sxs-lookup"><span data-stu-id="22488-267">If some sub-OUs have been unselected, then the box is gray with a white check mark.</span></span>  
![Подразделение, где не выбраны некоторые отделы](./media/active-directory-aadconnectsync-configure-filtering/ousyncnew.png)

<span data-ttu-id="22488-269">С этой конфигурацией новое подразделение, созданное в ManagedObjects, синхронизируется.</span><span class="sxs-lookup"><span data-stu-id="22488-269">With this configuration, a new OU that was created under ManagedObjects is synchronized.</span></span>

<span data-ttu-id="22488-270">Мастер установки Azure AD Connect всегда создает такую конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="22488-270">The Azure AD Connect installation wizard always creates this configuration.</span></span>

### <a name="dont-synchronize-new-ous"></a><span data-ttu-id="22488-271">Как не синхронизировать новые подразделения</span><span class="sxs-lookup"><span data-stu-id="22488-271">Don't synchronize new OUs</span></span>
<span data-ttu-id="22488-272">В модуле синхронизации можно настроить так, чтобы он не синхронизировал новые подразделения после завершения настройки фильтрации.</span><span class="sxs-lookup"><span data-stu-id="22488-272">You can configure the sync engine to not synchronize new OUs after the filtering configuration has finished.</span></span> <span data-ttu-id="22488-273">При таком состоянии в пользовательском интерфейсе поле будет полностью серое и без флажка.</span><span class="sxs-lookup"><span data-stu-id="22488-273">This state is indicated in the UI by the box appearing solid gray with no check mark.</span></span> <span data-ttu-id="22488-274">Для этого щелкайте поле, пока оно не станет белым без флажка.</span><span class="sxs-lookup"><span data-stu-id="22488-274">To get this behavior, click the box until it becomes white with no check mark.</span></span> <span data-ttu-id="22488-275">Затем выберите подразделения, которые требуется синхронизировать.</span><span class="sxs-lookup"><span data-stu-id="22488-275">Then select the sub-OUs that you want to synchronize.</span></span>

![Подразделение, где снят корневой флажок](./media/active-directory-aadconnectsync-configure-filtering/oudonotsyncnew.png)

<span data-ttu-id="22488-277">С этой конфигурацией синхронизируется новое подразделение, созданное в ManagedObjects.</span><span class="sxs-lookup"><span data-stu-id="22488-277">With this configuration, a new OU that was created under ManagedObjects isn't synchronized.</span></span>

## <a name="attribute-based-filtering"></a><span data-ttu-id="22488-278">Фильтрация по атрибутам</span><span class="sxs-lookup"><span data-stu-id="22488-278">Attribute-based filtering</span></span>
<span data-ttu-id="22488-279">Прежде чем выполнить следующие действия, убедитесь, что вы используете сборку, выпущенную в ноябре 2015 г. ([1.0.9125](active-directory-aadconnect-version-history.md#1091250)), или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="22488-279">Make sure that you're using the November 2015 ([1.0.9125](active-directory-aadconnect-version-history.md#1091250)) or later build for these steps to work.</span></span>

<span data-ttu-id="22488-280">Фильтрация на основе атрибутов — самый гибкий способ отфильтровать объекты.</span><span class="sxs-lookup"><span data-stu-id="22488-280">Attribute-based filtering is the most flexible way to filter objects.</span></span> <span data-ttu-id="22488-281">Чтобы контролировать все аспекты, касающиеся времени синхронизации объектов с Azure AD, можно использовать функцию [декларативной подготовки](active-directory-aadconnectsync-understanding-declarative-provisioning.md).</span><span class="sxs-lookup"><span data-stu-id="22488-281">You can use the power of [declarative provisioning](active-directory-aadconnectsync-understanding-declarative-provisioning.md) to control almost every aspect of when an object is synchronized to Azure AD.</span></span>

<span data-ttu-id="22488-282">Фильтрацию можно применять ко [входящим](#inbound-filtering) объектам из Active Directory в метавселенной и к [исходящим](#outbound-filtering) объектам из метавселенной в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-282">You can apply [inbound](#inbound-filtering) filtering from Active Directory to the metaverse, and [outbound](#outbound-filtering) filtering from the metaverse to Azure AD.</span></span> <span data-ttu-id="22488-283">Мы рекомендуем использовать самый простой метод фильтрации — по входящим объектам.</span><span class="sxs-lookup"><span data-stu-id="22488-283">We recommend that you apply inbound filtering because that is the easiest to maintain.</span></span> <span data-ttu-id="22488-284">Фильтрацию по исходящим объектам следует использовать, только если это необходимо для присоединения объектов из нескольких лесов, чтобы выполнить оценку.</span><span class="sxs-lookup"><span data-stu-id="22488-284">You should only use outbound filtering if it's required to join objects from more than one forest before the evaluation can take place.</span></span>

### <a name="inbound-filtering"></a><span data-ttu-id="22488-285">Фильтрация входящих объектов</span><span class="sxs-lookup"><span data-stu-id="22488-285">Inbound filtering</span></span>
<span data-ttu-id="22488-286">Для фильтрации по входящим объектам используется конфигурация по умолчанию: для атрибута метавселенной cloudFiltered синхронизируемых объектов, которые передаются в Azure AD, не задано значение.</span><span class="sxs-lookup"><span data-stu-id="22488-286">Inbound filtering uses the default configuration, where objects going to Azure AD must have the metaverse attribute cloudFiltered not set to a value to be synchronized.</span></span> <span data-ttu-id="22488-287">Если для атрибута задано значение **True**, то объект не синхронизируется.</span><span class="sxs-lookup"><span data-stu-id="22488-287">If this attribute's value is set to **True**, then the object isn't synchronized.</span></span> <span data-ttu-id="22488-288">Для этого параметра не следует устанавливать значение **False**.</span><span class="sxs-lookup"><span data-stu-id="22488-288">It shouldn't be set to **False**, by design.</span></span> <span data-ttu-id="22488-289">Чтобы можно было передавать значение с помощью других правил, у этого атрибута должно быть значение **True** или **NULL** (значение отсутствует).</span><span class="sxs-lookup"><span data-stu-id="22488-289">To make sure other rules have the ability to contribute a value, this attribute is only supposed to have the values **True** or **NULL** (absent).</span></span>

<span data-ttu-id="22488-290">Для фильтрации по входящим объектам мы будем использовать **область**, чтобы определить, какие объекты следует или не следует синхронизировать.</span><span class="sxs-lookup"><span data-stu-id="22488-290">In inbound filtering, you use the power of **scope** to determine which objects to synchronize or not synchronize.</span></span> <span data-ttu-id="22488-291">Эта процедура предназначена для внесения изменений в соответствии с требованиями вашей организации.</span><span class="sxs-lookup"><span data-stu-id="22488-291">This is where you make adjustments to fit your own organization's requirements.</span></span> <span data-ttu-id="22488-292">Модуль области использует **группу** и **предложение**, чтобы определить, распространяется ли правило синхронизации на область.</span><span class="sxs-lookup"><span data-stu-id="22488-292">The scope module has a **group** and a **clause** to determine when a sync rule is in scope.</span></span> <span data-ttu-id="22488-293">В группе может содержаться одно или несколько предложений.</span><span class="sxs-lookup"><span data-stu-id="22488-293">A group contains one or many clauses.</span></span> <span data-ttu-id="22488-294">Если предложений несколько, в качестве их разделителя используется логический оператор AND, а при наличии нескольких групп — оператор OR.</span><span class="sxs-lookup"><span data-stu-id="22488-294">There is a logical "AND" between multiple clauses, and a logical "OR" between multiple groups.</span></span>

<span data-ttu-id="22488-295">Вот пример.</span><span class="sxs-lookup"><span data-stu-id="22488-295">Let us look at an example:</span></span>  
<span data-ttu-id="22488-296">![Область](./media/active-directory-aadconnectsync-configure-filtering/scope.png)</span><span class="sxs-lookup"><span data-stu-id="22488-296">![Scope](./media/active-directory-aadconnectsync-configure-filtering/scope.png)</span></span>  
<span data-ttu-id="22488-297">Его следует рассматривать так: **(department = IT) OR (department = Sales AND c = US)**.</span><span class="sxs-lookup"><span data-stu-id="22488-297">This should be read as **(department = IT) OR (department = Sales AND c = US)**.</span></span>

<span data-ttu-id="22488-298">В следующих образцах кода и шагах в качестве примера используется объект-пользователь, но их можно использовать для объектов любого типа.</span><span class="sxs-lookup"><span data-stu-id="22488-298">In the following samples and steps, you use the user object as an example, but you can use this for all object types.</span></span>

<span data-ttu-id="22488-299">В следующих примерах значение приоритета начинается с 50.</span><span class="sxs-lookup"><span data-stu-id="22488-299">In the following samples, the precedence value starts with 50.</span></span> <span data-ttu-id="22488-300">Это может быть любое число меньше 100, которое еще не используется.</span><span class="sxs-lookup"><span data-stu-id="22488-300">This can be any number not used, but should be lower than 100.</span></span>

#### <a name="negative-filtering-do-not-sync-these"></a><span data-ttu-id="22488-301">Отрицательная фильтрация (выбор объектов, которые не следует синхронизировать)</span><span class="sxs-lookup"><span data-stu-id="22488-301">Negative filtering: "do not sync these"</span></span>
<span data-ttu-id="22488-302">В примере ниже отфильтруем (но не синхронизируем) всех пользователей для атрибута **extensionAttribute15** с заданным значением **NoSync**.</span><span class="sxs-lookup"><span data-stu-id="22488-302">In the following example, you filter out (not synchronize) all users where **extensionAttribute15** has the value **NoSync**.</span></span>

1. <span data-ttu-id="22488-303">Войдите на сервер, на котором запущена служба синхронизации Azure AD Connect, используя данные учетной записи участника группы безопасности **ADSyncAdmins** .</span><span class="sxs-lookup"><span data-stu-id="22488-303">Sign in to the server that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.</span></span>
2. <span data-ttu-id="22488-304">В меню **Пуск** запустите **редактор правил синхронизации**.</span><span class="sxs-lookup"><span data-stu-id="22488-304">Start **Synchronization Rules Editor** from the **Start** menu.</span></span>
3. <span data-ttu-id="22488-305">Выберите параметр **Входящие** и щелкните **Add New Rule** (Добавить новое правило).</span><span class="sxs-lookup"><span data-stu-id="22488-305">Make sure **Inbound** is selected, and click **Add New Rule**.</span></span>
4. <span data-ttu-id="22488-306">Задайте для правила описательное имя, например *In from AD – User DoNotSyncFilter*.</span><span class="sxs-lookup"><span data-stu-id="22488-306">Give the rule a descriptive name, such as "*In from AD – User DoNotSyncFilter*".</span></span> <span data-ttu-id="22488-307">Выберите правильный лес, значение **Пользователь** для параметра **CS object type** (Тип объекта CS) и **Person** (Человек) для параметра **MV object type** (Тип объекта MV).</span><span class="sxs-lookup"><span data-stu-id="22488-307">Select the correct forest, select **User** as the **CS object type**, and select **Person** as the **MV object type**.</span></span> <span data-ttu-id="22488-308">В поле **Тип связи** выберите **Join** (Присоединение).</span><span class="sxs-lookup"><span data-stu-id="22488-308">In **Link Type**, select **Join**.</span></span> <span data-ttu-id="22488-309">В поле **Приоритет** введите значение, которое не используется в другом правиле синхронизации (например, 50), и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-309">In **Precedence**, type a value that isn't currently used by another synchronization rule (for example 50), and then click **Next**.</span></span>  
   <span data-ttu-id="22488-310">![Описание входящего объекта 1](./media/active-directory-aadconnectsync-configure-filtering/inbound1.png)</span><span class="sxs-lookup"><span data-stu-id="22488-310">![Inbound 1 description](./media/active-directory-aadconnectsync-configure-filtering/inbound1.png)</span></span>  
5. <span data-ttu-id="22488-311">В поле **Scoping filter** (Фильтр области действия) выберите **Добавить группу** и щелкните **Добавить предложение**.</span><span class="sxs-lookup"><span data-stu-id="22488-311">In **Scoping filter**, click **Add Group**, and click **Add Clause**.</span></span> <span data-ttu-id="22488-312">В поле **Атрибут** выберите **ExtensionAttribute15**.</span><span class="sxs-lookup"><span data-stu-id="22488-312">In **Attribute**, select **ExtensionAttribute15**.</span></span> <span data-ttu-id="22488-313">В качестве **оператора** выберите **EQUAL** и в поле **Значение** введите **NoSyn**.</span><span class="sxs-lookup"><span data-stu-id="22488-313">Make sure that **Operator** is set to **EQUAL**, and type the value **NoSync** in the **Value** box.</span></span> <span data-ttu-id="22488-314">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-314">Click **Next**.</span></span>  
   <span data-ttu-id="22488-315">![Область входящего объекта 2](./media/active-directory-aadconnectsync-configure-filtering/inbound2.png)</span><span class="sxs-lookup"><span data-stu-id="22488-315">![Inbound 2 scope](./media/active-directory-aadconnectsync-configure-filtering/inbound2.png)</span></span>  
6. <span data-ttu-id="22488-316">Оставьте **правила объединения** (Join rules) пустыми и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-316">Leave the **Join** rules empty, and then click **Next**.</span></span>
7. <span data-ttu-id="22488-317">Щелкните **Add Transformation** (Добавить преобразование), для параметра **FlowType** (Тип потока) выберите значение **Константа**, а для параметра **Целевой атрибут** — значение **cloudFiltered**.</span><span class="sxs-lookup"><span data-stu-id="22488-317">Click **Add Transformation**, select the **FlowType** as **Constant**, and select **cloudFiltered** as the **Target Attribute**.</span></span> <span data-ttu-id="22488-318">В текстовом поле **Источник** введите значение **True**.</span><span class="sxs-lookup"><span data-stu-id="22488-318">In the **Source** text box, type **True**.</span></span> <span data-ttu-id="22488-319">Щелкните **Добавить** , чтобы сохранить правило.</span><span class="sxs-lookup"><span data-stu-id="22488-319">Click **Add** to save the rule.</span></span>  
   <span data-ttu-id="22488-320">![Преобразование входящего объекта 3](./media/active-directory-aadconnectsync-configure-filtering/inbound3.png)</span><span class="sxs-lookup"><span data-stu-id="22488-320">![Inbound 3 transformation](./media/active-directory-aadconnectsync-configure-filtering/inbound3.png)</span></span>
8. <span data-ttu-id="22488-321">Чтобы завершить настройку, необходимо выполнить **полную синхронизацию**.</span><span class="sxs-lookup"><span data-stu-id="22488-321">To complete the configuration, you need to run a **Full sync**.</span></span> <span data-ttu-id="22488-322">Вернитесь к чтению раздела [Применение и проверка изменений](#apply-and-verify-changes).</span><span class="sxs-lookup"><span data-stu-id="22488-322">Continue reading the section [Apply and verify changes](#apply-and-verify-changes).</span></span>

#### <a name="positive-filtering-only-sync-these"></a><span data-ttu-id="22488-323">Положительная фильтрация (выбор объектов, которые нужно синхронизировать)</span><span class="sxs-lookup"><span data-stu-id="22488-323">Positive filtering: "only sync these"</span></span>
<span data-ttu-id="22488-324">Настройка положительной фильтрации может оказаться более сложной задачей, так как нужно учесть объекты, для которых необходимость синхронизации не очевидна, например конференц-залы.</span><span class="sxs-lookup"><span data-stu-id="22488-324">Expressing positive filtering can be more challenging because you also have to consider objects that aren't obvious to be synchronized, such as conference rooms.</span></span> <span data-ttu-id="22488-325">Необходимо также переопределить фильтр по умолчанию в стандартном правиле **In from AD - User Join**.</span><span class="sxs-lookup"><span data-stu-id="22488-325">You are also going to override the default filter in the out-of-box rule **In from AD - User Join**.</span></span> <span data-ttu-id="22488-326">При создании пользовательского фильтра убедитесь, что он не включает в себя критически важные системные объекты, конфликтующие объекты репликации, специальные почтовые ящики и учетные записи служб для Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="22488-326">When you create your custom filter, make sure to not include critical system objects, replication conflict objects, special mailboxes, and the service accounts for Azure AD Connect.</span></span>

<span data-ttu-id="22488-327">Использование параметра положительной фильтрации требует настройки двух правил синхронизации.</span><span class="sxs-lookup"><span data-stu-id="22488-327">The positive filtering option requires two sync rules.</span></span> <span data-ttu-id="22488-328">В одном правиле (но их может быть несколько) следует учесть правильную область объектов, которые нужно синхронизировать,</span><span class="sxs-lookup"><span data-stu-id="22488-328">You need one rule (or several) with the correct scope of objects to synchronize.</span></span> <span data-ttu-id="22488-329">а другое правило должно быть универсальным, чтобы отсеять все объекты, не соответствующие объектам, подлежащим синхронизации.</span><span class="sxs-lookup"><span data-stu-id="22488-329">You also need a second catch-all sync rule that filters out all objects that haven't yet been identified as an object that should be synchronized.</span></span>

<span data-ttu-id="22488-330">В примере ниже синхронизируем только объекты-пользователи, у которых для атрибута department задано значение **Sales**.</span><span class="sxs-lookup"><span data-stu-id="22488-330">In the following example, you only synchronize user objects where the department attribute has the value **Sales**.</span></span>

1. <span data-ttu-id="22488-331">Войдите на сервер, на котором запущена служба синхронизации Azure AD Connect, используя данные учетной записи участника группы безопасности **ADSyncAdmins** .</span><span class="sxs-lookup"><span data-stu-id="22488-331">Sign in to the server that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.</span></span>
2. <span data-ttu-id="22488-332">В меню **Пуск** запустите **редактор правил синхронизации**.</span><span class="sxs-lookup"><span data-stu-id="22488-332">Start **Synchronization Rules Editor** from the **Start** menu.</span></span>
3. <span data-ttu-id="22488-333">Выберите параметр **Входящие** и щелкните **Add New Rule** (Добавить новое правило).</span><span class="sxs-lookup"><span data-stu-id="22488-333">Make sure **Inbound** is selected, and click **Add New Rule**.</span></span>
4. <span data-ttu-id="22488-334">Задайте для правила описательное имя, например *In from AD – User Sales sync*.</span><span class="sxs-lookup"><span data-stu-id="22488-334">Give the rule a descriptive name, such as "*In from AD – User Sales sync*".</span></span> <span data-ttu-id="22488-335">Выберите правильный лес, значение **Пользователь** для параметра **CS object type** (Тип объекта CS) и **Person** (Человек) для параметра **MV object type** (Тип объекта MV).</span><span class="sxs-lookup"><span data-stu-id="22488-335">Select the correct forest, select **User** as the **CS object type**, and select **Person** as the **MV object type**.</span></span> <span data-ttu-id="22488-336">В поле **Тип связи** выберите **Join** (Присоединение).</span><span class="sxs-lookup"><span data-stu-id="22488-336">In **Link Type**, select **Join**.</span></span> <span data-ttu-id="22488-337">В поле **Приоритет** введите значение, которое не используется в другом правиле синхронизации (например, 51), и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-337">In **Precedence**, type a value that isn't currently used by another synchronization rule (for example 51), and then click **Next**.</span></span>  
   <span data-ttu-id="22488-338">![Описание входящего объекта 4](./media/active-directory-aadconnectsync-configure-filtering/inbound4.png)</span><span class="sxs-lookup"><span data-stu-id="22488-338">![Inbound 4 description](./media/active-directory-aadconnectsync-configure-filtering/inbound4.png)</span></span>  
5. <span data-ttu-id="22488-339">В поле **Scoping filter** (Фильтр области действия) выберите **Добавить группу** и щелкните **Добавить предложение**.</span><span class="sxs-lookup"><span data-stu-id="22488-339">In **Scoping filter**, click **Add Group**, and click **Add Clause**.</span></span> <span data-ttu-id="22488-340">В разделе **Атрибут** выберите **department**.</span><span class="sxs-lookup"><span data-stu-id="22488-340">In **Attribute**, select **department**.</span></span> <span data-ttu-id="22488-341">В качестве оператора выберите **EQUAL**, а в поле **Значение** введите **Sales**.</span><span class="sxs-lookup"><span data-stu-id="22488-341">Make sure that Operator is set to **EQUAL**, and type the value **Sales** in the **Value** box.</span></span> <span data-ttu-id="22488-342">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-342">Click **Next**.</span></span>  
   <span data-ttu-id="22488-343">![Область входящего объекта 5](./media/active-directory-aadconnectsync-configure-filtering/inbound5.png)</span><span class="sxs-lookup"><span data-stu-id="22488-343">![Inbound 5 scope](./media/active-directory-aadconnectsync-configure-filtering/inbound5.png)</span></span>  
6. <span data-ttu-id="22488-344">Оставьте **правила объединения** (Join rules) пустыми и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-344">Leave the **Join** rules empty, and then click **Next**.</span></span>
7. <span data-ttu-id="22488-345">Щелкните **Add Transformation** (Добавить преобразование), для параметра **FlowType** (Тип потока) выберите значение **Константа**, а для параметра **Целевой атрибут** — значение **sourceObjectType**.</span><span class="sxs-lookup"><span data-stu-id="22488-345">Click **Add Transformation**, select **Constant** as the **FlowType**, and select the **cloudFiltered** as the **Target Attribute**.</span></span> <span data-ttu-id="22488-346">В поле **Источник** введите значение **False**.</span><span class="sxs-lookup"><span data-stu-id="22488-346">In the **Source** box, type **False**.</span></span> <span data-ttu-id="22488-347">Щелкните **Добавить** , чтобы сохранить правило.</span><span class="sxs-lookup"><span data-stu-id="22488-347">Click **Add** to save the rule.</span></span>  
   <span data-ttu-id="22488-348">![Преобразование входящего объекта 6](./media/active-directory-aadconnectsync-configure-filtering/inbound6.png)</span><span class="sxs-lookup"><span data-stu-id="22488-348">![Inbound 6 transformation](./media/active-directory-aadconnectsync-configure-filtering/inbound6.png)</span></span>  
   <span data-ttu-id="22488-349">Это особый случай, когда явно требуется задать для параметра cloudFiltered значение **False**.</span><span class="sxs-lookup"><span data-stu-id="22488-349">This is a special case where you explicitly set cloudFiltered to **False**.</span></span>
8. <span data-ttu-id="22488-350">Теперь универсальное правило синхронизации создано.</span><span class="sxs-lookup"><span data-stu-id="22488-350">We now have to create the catch-all sync rule.</span></span> <span data-ttu-id="22488-351">Задайте для правила описательное имя, например*In from AD — User Catch-all filter*.</span><span class="sxs-lookup"><span data-stu-id="22488-351">Give the rule a descriptive name, such as "*In from AD – User Catch-all filter*".</span></span> <span data-ttu-id="22488-352">Выберите правильный лес, значение **Пользователь** для параметра **CS object type** (Тип объекта CS) и **Person** (Человек) для параметра **MV object type** (Тип объекта MV).</span><span class="sxs-lookup"><span data-stu-id="22488-352">Select the correct forest, select **User** as the **CS object type**, and select **Person** as the **MV object type**.</span></span> <span data-ttu-id="22488-353">В поле **Тип связи** выберите **Join** (Присоединение).</span><span class="sxs-lookup"><span data-stu-id="22488-353">In **Link Type**, select **Join**.</span></span> <span data-ttu-id="22488-354">В поле **Приоритет** введите значение, которое не используется в другом правиле синхронизации (например, 99).</span><span class="sxs-lookup"><span data-stu-id="22488-354">In **Precedence**, type a value that isn't currently used by another Synchronization Rule (for example 99).</span></span> <span data-ttu-id="22488-355">Выбрано значение приоритета выше (с низшим приоритетом), чем у предыдущего правила синхронизации,</span><span class="sxs-lookup"><span data-stu-id="22488-355">You've selected a precedence value that is higher (lower precedence) than the previous sync rule.</span></span> <span data-ttu-id="22488-356">но мы оставили интервал между этими значениями, чтобы в дальнейшем можно было добавить дополнительные правила фильтрации для синхронизации, если нужно будет дополнительно синхронизировать отделы.</span><span class="sxs-lookup"><span data-stu-id="22488-356">But you've also left some room so that you can add more filtering sync rules later when you want to start synchronizing additional departments.</span></span> <span data-ttu-id="22488-357">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-357">Click **Next**.</span></span>  
   <span data-ttu-id="22488-358">![Описание входящего объекта 7](./media/active-directory-aadconnectsync-configure-filtering/inbound7.png)</span><span class="sxs-lookup"><span data-stu-id="22488-358">![Inbound 7 description](./media/active-directory-aadconnectsync-configure-filtering/inbound7.png)</span></span>  
9. <span data-ttu-id="22488-359">Оставьте поле **Scoping filter** (Фильтр области) пустым и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-359">Leave **Scoping filter** empty, and click **Next**.</span></span> <span data-ttu-id="22488-360">Если поле фильтра пустое, правило применяется ко всем объектам.</span><span class="sxs-lookup"><span data-stu-id="22488-360">An empty filter indicates that the rule is to be applied to all objects.</span></span>
10. <span data-ttu-id="22488-361">Оставьте **правила объединения** (Join rules) пустыми и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="22488-361">Leave the **Join** rules empty, and then click **Next**.</span></span>
11. <span data-ttu-id="22488-362">Щелкните **Add Transformation** (Добавить преобразование), выберите значение **Константа** в качестве параметра **FlowType** (Тип потока) и **cloudFiltered** для параметра **Целевой атрибут**.</span><span class="sxs-lookup"><span data-stu-id="22488-362">Click **Add Transformation**, select **Constant** as the **FlowType**, and select **cloudFiltered** as the **Target Attribute**.</span></span> <span data-ttu-id="22488-363">В поле **Источник** введите значение **True**.</span><span class="sxs-lookup"><span data-stu-id="22488-363">In the **Source** box, type **True**.</span></span> <span data-ttu-id="22488-364">Щелкните **Добавить** , чтобы сохранить правило.</span><span class="sxs-lookup"><span data-stu-id="22488-364">Click **Add** to save the rule.</span></span>  
    <span data-ttu-id="22488-365">![Преобразование входящего объекта 3](./media/active-directory-aadconnectsync-configure-filtering/inbound3.png)</span><span class="sxs-lookup"><span data-stu-id="22488-365">![Inbound 3 transformation](./media/active-directory-aadconnectsync-configure-filtering/inbound3.png)</span></span>  
12. <span data-ttu-id="22488-366">Чтобы завершить настройку, необходимо выполнить **полную синхронизацию**.</span><span class="sxs-lookup"><span data-stu-id="22488-366">To complete the configuration, you need to run a **Full sync**.</span></span> <span data-ttu-id="22488-367">Вернитесь к чтению раздела [Применение и проверка изменений](#apply-and-verify-changes).</span><span class="sxs-lookup"><span data-stu-id="22488-367">Continue reading the section [Apply and verify changes](#apply-and-verify-changes).</span></span>

<span data-ttu-id="22488-368">При необходимости можно создать дополнительные правила первого типа в примере, к которому мы добавляли объекты для синхронизации.</span><span class="sxs-lookup"><span data-stu-id="22488-368">If you need to, you can create more rules of the first type where you include more objects in the synchronization.</span></span>

### <a name="outbound-filtering"></a><span data-ttu-id="22488-369">Фильтрация исходящих объектов</span><span class="sxs-lookup"><span data-stu-id="22488-369">Outbound filtering</span></span>
<span data-ttu-id="22488-370">В некоторых случаях фильтрацию необходимо выполнять только после объединения объектов в метавселенной.</span><span class="sxs-lookup"><span data-stu-id="22488-370">In some cases, it's necessary to do the filtering only after the objects have joined in the metaverse.</span></span> <span data-ttu-id="22488-371">Например, определение объектов для синхронизации может выполняться на основе атрибута mail из леса ресурсов и атрибута userPrincipalName из леса учетных записей.</span><span class="sxs-lookup"><span data-stu-id="22488-371">For example, it might be necessary to look at the mail attribute from the resource forest, and the userPrincipalName attribute from the account forest, to determine if an object should be synchronized.</span></span> <span data-ttu-id="22488-372">В таких случаях нужно создать фильтр на основе исходящего правила.</span><span class="sxs-lookup"><span data-stu-id="22488-372">In these cases, you create the filtering on the outbound rule.</span></span>

<span data-ttu-id="22488-373">В примере ниже мы изменим фильтрацию так, чтобы синхронизировались только пользователи, значения атрибутов mail и userPrincipalName которых заканчиваются на @contoso.com.</span><span class="sxs-lookup"><span data-stu-id="22488-373">In this example, you change the filtering so that only users that have both their mail and userPrincipalName ending in @contoso.com are synchronized:</span></span>

1. <span data-ttu-id="22488-374">Войдите на сервер, на котором запущена служба синхронизации Azure AD Connect, используя данные учетной записи участника группы безопасности **ADSyncAdmins** .</span><span class="sxs-lookup"><span data-stu-id="22488-374">Sign in to the server that is running Azure AD Connect sync by using an account that is a member of the **ADSyncAdmins** security group.</span></span>
2. <span data-ttu-id="22488-375">В меню **Пуск** запустите **редактор правил синхронизации**.</span><span class="sxs-lookup"><span data-stu-id="22488-375">Start **Synchronization Rules Editor** from the **Start** menu.</span></span>
3. <span data-ttu-id="22488-376">В разделе **Rules Type** (Тип правил) выберите **Outbound** (Исходящие).</span><span class="sxs-lookup"><span data-stu-id="22488-376">Under **Rules Type**, click **Outbound**.</span></span>
4. <span data-ttu-id="22488-377">Найдите правило с именем **Out to AAD — User Join** (Из внешней среды в AD — присоединение пользователя) и щелкните **Изменить**.</span><span class="sxs-lookup"><span data-stu-id="22488-377">Find the rule named **Out to AAD – User Join**, and click **Edit**.</span></span>
5. <span data-ttu-id="22488-378">Во всплывающем окне нажмите кнопку **Да** , чтобы создать копию правила.</span><span class="sxs-lookup"><span data-stu-id="22488-378">In the pop-up, answer **Yes** to create a copy of the rule.</span></span>
6. <span data-ttu-id="22488-379">На странице **Описание** измените **приоритет**, установив неиспользуемое значение, например 50.</span><span class="sxs-lookup"><span data-stu-id="22488-379">On the **Description** page, change **Precedence** to an unused value, such as 50.</span></span>
7. <span data-ttu-id="22488-380">В области навигации слева щелкните **Scoping filter** (Фильтр области), а затем щелкните **Добавить предложение**.</span><span class="sxs-lookup"><span data-stu-id="22488-380">Click **Scoping filter** on the left-hand navigation, and then click **Add clause**.</span></span> <span data-ttu-id="22488-381">В разделе **Атрибут** выберите **mail**.</span><span class="sxs-lookup"><span data-stu-id="22488-381">In **Attribute**, select **mail**.</span></span> <span data-ttu-id="22488-382">В разделе **Оператор** выберите **ENDSWITH**.</span><span class="sxs-lookup"><span data-stu-id="22488-382">In **Operator**, select **ENDSWITH**.</span></span> <span data-ttu-id="22488-383">В разделе **Значение** введите **@contoso.com**, а затем щелкните **Добавить предложение**.</span><span class="sxs-lookup"><span data-stu-id="22488-383">In **Value**, type **@contoso.com**, and then click **Add clause**.</span></span> <span data-ttu-id="22488-384">В разделе **Атрибут** выберите **userPrincipalName**.</span><span class="sxs-lookup"><span data-stu-id="22488-384">In **Attribute**, select **userPrincipalName**.</span></span> <span data-ttu-id="22488-385">В разделе **Оператор** выберите **ENDSWITH**.</span><span class="sxs-lookup"><span data-stu-id="22488-385">In **Operator**, select **ENDSWITH**.</span></span> <span data-ttu-id="22488-386">В разделе **Значение** введите **@contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="22488-386">In **Value**, type **@contoso.com**.</span></span>
8. <span data-ttu-id="22488-387">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="22488-387">Click **Save**.</span></span>
9. <span data-ttu-id="22488-388">Чтобы завершить настройку, необходимо выполнить **полную синхронизацию**.</span><span class="sxs-lookup"><span data-stu-id="22488-388">To complete the configuration, you need to run a **Full sync**.</span></span> <span data-ttu-id="22488-389">Вернитесь к чтению раздела [Применение и проверка изменений](#apply-and-verify-changes).</span><span class="sxs-lookup"><span data-stu-id="22488-389">Continue reading the section [Apply and verify changes](#apply-and-verify-changes).</span></span>

## <a name="apply-and-verify-changes"></a><span data-ttu-id="22488-390">Примените и проверьте изменения</span><span class="sxs-lookup"><span data-stu-id="22488-390">Apply and verify changes</span></span>
<span data-ttu-id="22488-391">После внесения изменений в конфигурацию их необходимо применить к объектам, которые уже есть в системе.</span><span class="sxs-lookup"><span data-stu-id="22488-391">After you've made your configuration changes, you must apply them to the objects that are already present in the system.</span></span> <span data-ttu-id="22488-392">Кроме того, могут быть объекты, которые отсутствуют в модуле синхронизации, но их нужно обработать. Для этого модулю синхронизации нужно еще раз выполнить чтение из исходной системы, чтобы проверить ее содержимое.</span><span class="sxs-lookup"><span data-stu-id="22488-392">It might also be that the objects that aren't currently in the sync engine should be processed (and the sync engine needs to read the source system again to verify its content).</span></span>

<span data-ttu-id="22488-393">Если для изменения конфигурации вы использовали фильтрацию по **доменам** или **подразделениям**, необходимо выполнить **полный импорт**, а затем **синхронизацию изменений**.</span><span class="sxs-lookup"><span data-stu-id="22488-393">If you changed the configuration by using **domain** or **organizational-unit** filtering, then you need to do a **Full import**, followed by **Delta synchronization**.</span></span>

<span data-ttu-id="22488-394">Если для изменения конфигурации использовалась фильтрация по **атрибутам**, необходимо выполнить **полную синхронизацию**.</span><span class="sxs-lookup"><span data-stu-id="22488-394">If you changed the configuration by using **attribute** filtering, then you need to do a **Full synchronization**.</span></span>

<span data-ttu-id="22488-395">Сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="22488-395">Do the following steps:</span></span>

1. <span data-ttu-id="22488-396">Запустите **службу синхронизации** из меню **Пуск**.</span><span class="sxs-lookup"><span data-stu-id="22488-396">Start **Synchronization Service** from the **Start** menu.</span></span>
2. <span data-ttu-id="22488-397">Выберите **Соединители**.</span><span class="sxs-lookup"><span data-stu-id="22488-397">Select **Connectors**.</span></span> <span data-ttu-id="22488-398">В списке **соединителей** выберите элемент, конфигурация которого ранее была изменена.</span><span class="sxs-lookup"><span data-stu-id="22488-398">In the **Connectors** list, select the Connector where you made a configuration change earlier.</span></span> <span data-ttu-id="22488-399">В разделе **Действия** выберите **Запуск**.</span><span class="sxs-lookup"><span data-stu-id="22488-399">In **Actions**, select **Run**.</span></span>  
   <span data-ttu-id="22488-400">![Выполнение соединителя](./media/active-directory-aadconnectsync-configure-filtering/connectorrun.png)</span><span class="sxs-lookup"><span data-stu-id="22488-400">![Connector run](./media/active-directory-aadconnectsync-configure-filtering/connectorrun.png)</span></span>  
3. <span data-ttu-id="22488-401">В разделе **Run profiles** (Профили выполнения) выберите операцию, о которой шла речь в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="22488-401">In **Run profiles**, select the operation that was mentioned in the previous section.</span></span> <span data-ttu-id="22488-402">Если необходимо выполнить два действия, запустите второе после завершения первого</span><span class="sxs-lookup"><span data-stu-id="22488-402">If you need to run two actions, run the second after the first one has finished.</span></span> <span data-ttu-id="22488-403">(в столбце **Состояние** выбранного соединителя должно быть указано **Неактивно**).</span><span class="sxs-lookup"><span data-stu-id="22488-403">(The **State** column is **Idle** for the selected connector.)</span></span>

<span data-ttu-id="22488-404">После запуска синхронизации будут экспортированы все изменения.</span><span class="sxs-lookup"><span data-stu-id="22488-404">After the synchronization, all changes are staged to be exported.</span></span> <span data-ttu-id="22488-405">Прежде чем применить изменения напрямую в Azure AD, следует проверить их правильность.</span><span class="sxs-lookup"><span data-stu-id="22488-405">Before you actually make the changes in Azure AD, you want to verify that all these changes are correct.</span></span>

1. <span data-ttu-id="22488-406">Откройте командную строку и перейдите в каталог `%Program Files%\Microsoft Azure AD Sync\bin`.</span><span class="sxs-lookup"><span data-stu-id="22488-406">Start a command prompt, and go to `%Program Files%\Microsoft Azure AD Sync\bin`.</span></span>
2. <span data-ttu-id="22488-407">Запустите `csexport "Name of Connector" %temp%\export.xml /f:x`.</span><span class="sxs-lookup"><span data-stu-id="22488-407">Run `csexport "Name of Connector" %temp%\export.xml /f:x`.</span></span>  
   <span data-ttu-id="22488-408">Имя соединителя можно найти в службе синхронизации.</span><span class="sxs-lookup"><span data-stu-id="22488-408">The name of the Connector is in Synchronization Service.</span></span> <span data-ttu-id="22488-409">Это будет имя наподобие "contoso.com — AAD" для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-409">It has a name similar to "contoso.com – AAD" for Azure AD.</span></span>
3. <span data-ttu-id="22488-410">Запустите `CSExportAnalyzer %temp%\export.xml > %temp%\export.csv`.</span><span class="sxs-lookup"><span data-stu-id="22488-410">Run `CSExportAnalyzer %temp%\export.xml > %temp%\export.csv`.</span></span>
4. <span data-ttu-id="22488-411">Теперь у вас в папке %temp% есть файл export.csv, который можно просмотреть в Microsoft Excel.</span><span class="sxs-lookup"><span data-stu-id="22488-411">You now have a file in %temp% named export.csv that can be examined in Microsoft Excel.</span></span> <span data-ttu-id="22488-412">Этот файл содержит все изменения, которые будут экспортированы.</span><span class="sxs-lookup"><span data-stu-id="22488-412">This file contains all the changes that are about to be exported.</span></span>
5. <span data-ttu-id="22488-413">Внесите необходимые изменения в данные и конфигурацию, а затем выполните описанные выше действия (импорт, синхронизация и проверка) повторно, чтобы привести изменения, которые предстоит экспортировать, в нужный вид.</span><span class="sxs-lookup"><span data-stu-id="22488-413">Make the necessary changes to the data or configuration, and run these steps again (Import, Synchronize, and Verify) until the changes that are about to be exported are what you expect.</span></span>

<span data-ttu-id="22488-414">После выполнения этих действий экспортируйте изменения в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-414">When you're satisfied, export the changes to Azure AD.</span></span>

1. <span data-ttu-id="22488-415">Выберите **Соединители**.</span><span class="sxs-lookup"><span data-stu-id="22488-415">Select **Connectors**.</span></span> <span data-ttu-id="22488-416">В списке **соединителей** выберите соединитель Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-416">In the **Connectors** list, select the Azure AD Connector.</span></span> <span data-ttu-id="22488-417">В разделе **Действия** выберите **Запуск**.</span><span class="sxs-lookup"><span data-stu-id="22488-417">In **Actions**, select **Run**.</span></span>
2. <span data-ttu-id="22488-418">В разделе **Run profiles** (Профили выполнения) выберите **Экспорт**.</span><span class="sxs-lookup"><span data-stu-id="22488-418">In **Run profiles**, select **Export**.</span></span>
3. <span data-ttu-id="22488-419">Если в результате изменения конфигурации будет удалено слишком много объектов, вы увидите ошибку во время экспорта, если их количество превышает пороговое значение (по умолчанию — 500).</span><span class="sxs-lookup"><span data-stu-id="22488-419">If your configuration changes delete many objects, then you see an error in the export when the number is more than the configured threshold (by default 500).</span></span> <span data-ttu-id="22488-420">В случае возникновения ошибки необходимо временно отключить функцию [предотвращения случайного удаления](active-directory-aadconnectsync-feature-prevent-accidental-deletes.md).</span><span class="sxs-lookup"><span data-stu-id="22488-420">If you see this error, then you need to temporarily disable the "[prevent accidental deletes](active-directory-aadconnectsync-feature-prevent-accidental-deletes.md)" feature.</span></span>

<span data-ttu-id="22488-421">Теперь можно снова включить планировщик.</span><span class="sxs-lookup"><span data-stu-id="22488-421">Now it's time to enable the scheduler again.</span></span>

1. <span data-ttu-id="22488-422">В меню **Пуск** запустите **планировщик задач**.</span><span class="sxs-lookup"><span data-stu-id="22488-422">Start **Task Scheduler** from the **Start** menu.</span></span>
2. <span data-ttu-id="22488-423">Прямо в каталоге **Библиотека планировщика заданий** найдите задачу с именем **Azure AD Sync Scheduler** (Планировщик синхронизации Azure AD Sync), щелкните ее правой кнопкой мыши и выберите пункт **Включить**.</span><span class="sxs-lookup"><span data-stu-id="22488-423">Directly under **Task Scheduler Library**, find the task named **Azure AD Sync Scheduler**, right-click, and select **Enable**.</span></span>

## <a name="group-based-filtering"></a><span data-ttu-id="22488-424">Фильтрация на основе группы</span><span class="sxs-lookup"><span data-stu-id="22488-424">Group-based filtering</span></span>
<span data-ttu-id="22488-425">Фильтрацию на основе группы можно настроить при первоначальной установке Azure AD Connect, если выбран вариант [выборочной установки](active-directory-aadconnect-get-started-custom.md#sync-filtering-based-on-groups).</span><span class="sxs-lookup"><span data-stu-id="22488-425">You can configure group-based filtering the first time that you install Azure AD Connect by using [custom installation](active-directory-aadconnect-get-started-custom.md#sync-filtering-based-on-groups).</span></span> <span data-ttu-id="22488-426">Она предназначена для пилотного развертывания, в котором должно синхронизироваться только небольшое количество объектов.</span><span class="sxs-lookup"><span data-stu-id="22488-426">It's intended for a pilot deployment where you want only a small set of objects to be synchronized.</span></span> <span data-ttu-id="22488-427">После отключения фильтрацию на основе группы невозможно будет включить заново.</span><span class="sxs-lookup"><span data-stu-id="22488-427">When you disable group-based filtering, it can't be enabled again.</span></span> <span data-ttu-id="22488-428">*Не поддерживается* использование фильтрации на основе группы в настраиваемой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="22488-428">It's *not supported* to use group-based filtering in a custom configuration.</span></span> <span data-ttu-id="22488-429">Эту функцию можно настроить только с помощью мастера установки.</span><span class="sxs-lookup"><span data-stu-id="22488-429">It's only supported to configure this feature by using the installation wizard.</span></span> <span data-ttu-id="22488-430">После завершения пилотного проекта следует использовать какой-либо другой метод фильтрации, описанный в этой статье.</span><span class="sxs-lookup"><span data-stu-id="22488-430">When you've completed your pilot, then use one of the other filtering options in this topic.</span></span> <span data-ttu-id="22488-431">Если вы используете фильтрацию по подразделениям в сочетании с фильтрацией по группам, следует включить подразделения, содержащие группы и их участников.</span><span class="sxs-lookup"><span data-stu-id="22488-431">When using OU-based filtering in conjunction with group-based filtering, the OU(s) where the group and its members are located must be included.</span></span>

<span data-ttu-id="22488-432">При синхронизации нескольких лесов AD можно настроить фильтрацию по группам, указав отдельные группы для каждого соединителя AD.</span><span class="sxs-lookup"><span data-stu-id="22488-432">When synchronizing multiple AD forests, you can configure group-based filtering by specifying a different group for each AD connector.</span></span> <span data-ttu-id="22488-433">Если нужно синхронизировать пользователя в одном лесу AD и у этого пользователя есть несколько соответствующих объектов администратора внешней безопасности в других лесах AD, необходимо убедиться, что на объект пользователя и все соответствующие объекты администратора внешней безопасности распространяется фильтрация на основе групп.</span><span class="sxs-lookup"><span data-stu-id="22488-433">If you wish to synchronize a user in one AD forest and the same user has one or more corresponding FSP (Foreign Security Principal) objects in other AD forests, you must ensure that the user object and all its corresponding FSP objects are within group-based filtering scope.</span></span> <span data-ttu-id="22488-434">Если один или несколько объектов администратора внешней безопасности исключаются из фильтрации на основе групп, объект пользователя не будет синхронизирован с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="22488-434">If one or more of the FSP objects are excluded by group-based filtering, the user object will not be synchronized to Azure AD.</span></span>

## <a name="next-steps"></a><span data-ttu-id="22488-435">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="22488-435">Next steps</span></span>
- <span data-ttu-id="22488-436">Сведения о настройке службы синхронизации Azure AD Connect см. в [этой статье](active-directory-aadconnectsync-whatis.md).</span><span class="sxs-lookup"><span data-stu-id="22488-436">Learn more about [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) configuration.</span></span>
- <span data-ttu-id="22488-437">Сведения об интеграции локальных удостоверений с Azure Active Directory см. в [этой статье](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="22488-437">Learn more about [integrating your on-premises identities with Azure AD](active-directory-aadconnect.md).</span></span>
