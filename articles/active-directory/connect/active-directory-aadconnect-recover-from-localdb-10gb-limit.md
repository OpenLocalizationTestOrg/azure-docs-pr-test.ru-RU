---
title: "Azure AD Connect: Как ограничить toorecover из 10 ГБ LocalDB проблема | Документы Microsoft"
description: "В этом разделе описывается, как toorecover синхронизация Azure AD Connect службы при обнаружении LocalDB 10 ГБ ограничить проблемы."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 7b8ce6e19b68837639017bb0315eda4b924d525a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-how-toorecover-from-localdb-10-gb-limit"></a><span data-ttu-id="6259d-103">Azure AD Connect: Как toorecover из LocalDB 10 ГБ</span><span class="sxs-lookup"><span data-stu-id="6259d-103">Azure AD Connect: How toorecover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="6259d-104">Azure AD Connect требуется база данных SQL Server toostore удостоверений.</span><span class="sxs-lookup"><span data-stu-id="6259d-104">Azure AD Connect requires a SQL Server database toostore identity data.</span></span> <span data-ttu-id="6259d-105">Можно использовать значение по умолчанию hello установлен SQL Server 2012 Express LocalDB с Azure AD Connect или использовать полный SQL.</span><span class="sxs-lookup"><span data-stu-id="6259d-105">You can either use hello default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="6259d-106">SQL Server Express налагает ограничение в размере 10 ГБ.</span><span class="sxs-lookup"><span data-stu-id="6259d-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="6259d-107">Если при использовании LocalDB достигнут этот предел, служба синхронизации Azure AD Connect больше не сможет запускаться или выполнять синхронизацию должным образом.</span><span class="sxs-lookup"><span data-stu-id="6259d-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="6259d-108">Эта статья содержит инструкции по восстановлению hello.</span><span class="sxs-lookup"><span data-stu-id="6259d-108">This article provides hello recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="6259d-109">Симптомы</span><span class="sxs-lookup"><span data-stu-id="6259d-109">Symptoms</span></span>
<span data-ttu-id="6259d-110">Существует два общих признака проблемы:</span><span class="sxs-lookup"><span data-stu-id="6259d-110">There are two common symptoms:</span></span>

* <span data-ttu-id="6259d-111">Служба синхронизации подключения для Azure AD **выполняется** безуспешно toosynchronize с *«остановлено-базы данных диск full»* ошибки.</span><span class="sxs-lookup"><span data-stu-id="6259d-111">Azure AD Connect Synchronization Service **is running** but fails toosynchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="6259d-112">Служба синхронизации подключения для Azure AD **— не удается toostart**.</span><span class="sxs-lookup"><span data-stu-id="6259d-112">Azure AD Connect Synchronization Service **is unable toostart**.</span></span> <span data-ttu-id="6259d-113">При попытке службы toostart hello, он завершается с события 6323 и сообщение об ошибке *«hello сервер обнаружил ошибку, так как SQL Server не хватает места на диске.»*</span><span class="sxs-lookup"><span data-stu-id="6259d-113">When you attempt toostart hello service, it fails with event 6323 and error message *"hello server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="6259d-114">Краткосрочные действия по восстановлению</span><span class="sxs-lookup"><span data-stu-id="6259d-114">Short-term recovery steps</span></span>
<span data-ttu-id="6259d-115">Этот раздел содержит hello действия tooreclaim DB пространство, необходимое для операции tooresume служба синхронизации подключения для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6259d-115">This section provides hello steps tooreclaim DB space required for Azure AD Connect Synchronization Service tooresume operation.</span></span> <span data-ttu-id="6259d-116">Hello шаги включают:</span><span class="sxs-lookup"><span data-stu-id="6259d-116">hello steps include:</span></span>
1. [<span data-ttu-id="6259d-117">Определить состояние службы синхронизации hello</span><span class="sxs-lookup"><span data-stu-id="6259d-117">Determine hello Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="6259d-118">Сжатие базы данных hello</span><span class="sxs-lookup"><span data-stu-id="6259d-118">Shrink hello database</span></span>](#shrink-the-database)
3. <span data-ttu-id="6259d-119">[Удалите данные журнала выполнения](#delete-run-history-data).</span><span class="sxs-lookup"><span data-stu-id="6259d-119">[Delete run history data](#delete-run-history-data)</span></span>
4. <span data-ttu-id="6259d-120">[Сократите срок хранения данных журнала выполнения](#shorten-retention-period-for-run-history-data).</span><span class="sxs-lookup"><span data-stu-id="6259d-120">[Shorten retention period for run history data](#shorten-retention-period-for-run-history-data)</span></span>

### <a name="determine-hello-synchronization-service-status"></a><span data-ttu-id="6259d-121">Определить состояние службы синхронизации hello</span><span class="sxs-lookup"><span data-stu-id="6259d-121">Determine hello Synchronization Service status</span></span>
<span data-ttu-id="6259d-122">Сначала определите, по-прежнему выполняется ли служба синхронизации hello или нет:</span><span class="sxs-lookup"><span data-stu-id="6259d-122">First, determine whether hello Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="6259d-123">Войдите в систему tooyour сервера Azure AD Connect как администратор.</span><span class="sxs-lookup"><span data-stu-id="6259d-123">Log in tooyour Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="6259d-124">Go слишком**диспетчера управления службами**.</span><span class="sxs-lookup"><span data-stu-id="6259d-124">Go too**Service Control Manager**.</span></span>

3. <span data-ttu-id="6259d-125">Проверьте состояние hello **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="6259d-125">Check hello status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="6259d-126">Если он выполняется, не остановить и перезапустить службу hello.</span><span class="sxs-lookup"><span data-stu-id="6259d-126">If it is running, do not stop or restart hello service.</span></span> <span data-ttu-id="6259d-127">Пропустить [жать базу данных hello](#shrink-the-database) шаг и перейти слишком[данные журнала выполнения Delete](#delete-run-history-data) шаг.</span><span class="sxs-lookup"><span data-stu-id="6259d-127">Skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="6259d-128">Если она не запущена, попробуйте toostart hello службы.</span><span class="sxs-lookup"><span data-stu-id="6259d-128">If it is not running, try toostart hello service.</span></span> <span data-ttu-id="6259d-129">Если hello служба была запущена успешно, пропустите [жать базу данных hello](#shrink-the-database) шаг и перейти слишком[данные журнала выполнения удаления](#delete-run-history-data) шаг.</span><span class="sxs-lookup"><span data-stu-id="6259d-129">If hello service starts successfully, skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="6259d-130">В противном случае продолжите [жать базу данных hello](#shrink-the-database) шаг.</span><span class="sxs-lookup"><span data-stu-id="6259d-130">Otherwise, continue with [Shrink hello database](#shrink-the-database) step.</span></span>

### <a name="shrink-hello-database"></a><span data-ttu-id="6259d-131">Сжатие базы данных hello</span><span class="sxs-lookup"><span data-stu-id="6259d-131">Shrink hello database</span></span>
<span data-ttu-id="6259d-132">Используйте toofree операцию сжатия hello копирование достаточно hello toostart пространства БД службы синхронизации.</span><span class="sxs-lookup"><span data-stu-id="6259d-132">Use hello Shrink operation toofree up enough DB space toostart hello Synchronization Service.</span></span> <span data-ttu-id="6259d-133">Она освобождает место в базе данных, удаляя пробельные символы в базе данных hello.</span><span class="sxs-lookup"><span data-stu-id="6259d-133">It frees up DB space by removing whitespaces in hello database.</span></span> <span data-ttu-id="6259d-134">Этот наилучшее, но не всегда действующее решение.</span><span class="sxs-lookup"><span data-stu-id="6259d-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="6259d-135">Эта статья toolearn Дополнительные сведения о операции сжатия [сжатие базы данных](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="6259d-135">toolearn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6259d-136">Пропустите этот шаг, если вы можете получить toorun hello службы синхронизации.</span><span class="sxs-lookup"><span data-stu-id="6259d-136">Skip this step if you can get hello Synchronization Service toorun.</span></span> <span data-ttu-id="6259d-137">Не рекомендуется hello tooshrink баз данных SQL Server как может привести к появлению toopoor производительности из-за фрагментации tooincreased.</span><span class="sxs-lookup"><span data-stu-id="6259d-137">It is not recommended tooshrink hello SQL DB as it can lead toopoor performance due tooincreased fragmentation.</span></span>

<span data-ttu-id="6259d-138">Название Hello hello базы данных, созданных для Azure AD Connect **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="6259d-138">hello name of hello database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="6259d-139">tooperform операцию сжатия, необходимо войти как hello sysadmin или Владельцем базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="6259d-139">tooperform a Shrink operation, you must log in either as hello sysadmin or DBO of hello database.</span></span> <span data-ttu-id="6259d-140">Во время установки Azure AD Connect hello следующие учетные записи предоставляются права системного администратора:</span><span class="sxs-lookup"><span data-stu-id="6259d-140">During Azure AD Connect installation, hello following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="6259d-141">локальные администраторы;</span><span class="sxs-lookup"><span data-stu-id="6259d-141">Local Administrators</span></span>
* <span data-ttu-id="6259d-142">Учетная запись пользователя Hello, установка используется toorun Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="6259d-142">hello user account that was used toorun Azure AD Connect installation.</span></span>
* <span data-ttu-id="6259d-143">Здравствуйте, учетной записи службы синхронизации, которая используется как hello операционной контексте службы подключения синхронизации Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6259d-143">hello Sync Service account that is used as hello operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="6259d-144">Hello локальной группы ADSyncAdmins, который был создан во время установки.</span><span class="sxs-lookup"><span data-stu-id="6259d-144">hello local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="6259d-145">Резервное копирование базы данных hello путем копирования **ADSync.mdf** и **ADSync_log.ldf** файлы, расположенные в группе `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa безопасном месте.</span><span class="sxs-lookup"><span data-stu-id="6259d-145">Back up hello database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa safe location.</span></span>

2. <span data-ttu-id="6259d-146">Запустите сеанс PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6259d-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="6259d-147">Перейдите toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="6259d-147">Navigate toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="6259d-148">Запуск **sqlcmd** программы, выполнив команду hello `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, с помощью учетных данных hello роли sysadmin или hello базы данных DBO.</span><span class="sxs-lookup"><span data-stu-id="6259d-148">Start **sqlcmd** utility by running hello command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using hello credential of a sysadmin or hello database DBO.</span></span>

5. <span data-ttu-id="6259d-149">База данных hello tooshrink командной строки sqlcmd hello (1 >), введите `DBCC Shrinkdatabase(ADSync,1);`, за которым следует `GO` в следующую строку hello.</span><span class="sxs-lookup"><span data-stu-id="6259d-149">tooshrink hello database, at hello sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in hello next line.</span></span>

6. <span data-ttu-id="6259d-150">При успешном выполнении операции hello повторите toostart hello службы синхронизации.</span><span class="sxs-lookup"><span data-stu-id="6259d-150">If hello operation is successful, try toostart hello Synchronization Service again.</span></span> <span data-ttu-id="6259d-151">При запуске службы синхронизации hello go слишком[данные журнала выполнения Delete](#delete-run-history-data) шаг.</span><span class="sxs-lookup"><span data-stu-id="6259d-151">If you can start hello Synchronization Service, go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="6259d-152">В противном случае обратитесь в службу поддержки.</span><span class="sxs-lookup"><span data-stu-id="6259d-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="6259d-153">Удаление данных журнала выполнения</span><span class="sxs-lookup"><span data-stu-id="6259d-153">Delete run history data</span></span>
<span data-ttu-id="6259d-154">По умолчанию Azure AD Connect сохраняет tooseven дней данных журнала выполнения.</span><span class="sxs-lookup"><span data-stu-id="6259d-154">By default, Azure AD Connect retains up tooseven days’ worth of run history data.</span></span> <span data-ttu-id="6259d-155">На этом шаге мы удалить hello пространство tooreclaim DB данных журнала выполнения, для возможности запуска попытку синхронизации службы синхронизации подключения для Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6259d-155">In this step, we delete hello run history data tooreclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="6259d-156">Запуск **диспетчер службы синхронизации** с переходом → tooSTART службы синхронизации.</span><span class="sxs-lookup"><span data-stu-id="6259d-156">Start **Synchronization Service Manager** by going tooSTART → Synchronization Service.</span></span>

2.  <span data-ttu-id="6259d-157">Go toohello **операции** вкладки.</span><span class="sxs-lookup"><span data-stu-id="6259d-157">Go toohello **Operations** tab.</span></span>

3.  <span data-ttu-id="6259d-158">В разделе **Действия** выберите **Clear Runs** (Очистить выполнения).</span><span class="sxs-lookup"><span data-stu-id="6259d-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="6259d-159">Можно выбрать параметр **Clear all runs** (Очистить все выполнения) или **Clear runs before…<date>** (Очистить выполнения до...).</span><span class="sxs-lookup"><span data-stu-id="6259d-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="6259d-160">Рекомендуется начать с очистки тех данных журнала выполнения, которым больше двух дней.</span><span class="sxs-lookup"><span data-stu-id="6259d-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="6259d-161">В случае продолжения toorun в проблема с размером базы данных выберите hello **очистить все фрагменты** параметр.</span><span class="sxs-lookup"><span data-stu-id="6259d-161">If you continue toorun into DB size issue, then choose hello **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="6259d-162">Сокращение срока хранения данных журнала выполнения</span><span class="sxs-lookup"><span data-stu-id="6259d-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="6259d-163">Этот шаг является tooreduce hello вероятность того, что после нескольких циклов синхронизации выполняется в 10 ГБ проблема hello.</span><span class="sxs-lookup"><span data-stu-id="6259d-163">This step is tooreduce hello likelihood of running into hello 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="6259d-164">Запустите новый сеанс PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6259d-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="6259d-165">Запустите `Get-ADSyncScheduler` и запомните hello PurgeRunHistoryInterval свойство, которое указывает текущий срок хранения hello.</span><span class="sxs-lookup"><span data-stu-id="6259d-165">Run `Get-ADSyncScheduler` and take note of hello PurgeRunHistoryInterval property, which specifies hello current retention period.</span></span>

3. <span data-ttu-id="6259d-166">Запустите `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` дней периода tootwo хранения tooset hello.</span><span class="sxs-lookup"><span data-stu-id="6259d-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset hello retention period tootwo days.</span></span> <span data-ttu-id="6259d-167">Настройте срок хранения hello соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="6259d-167">Adjust hello retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-toofull-sql"></a><span data-ttu-id="6259d-168">Долгосрочное решение — toofull миграции SQL</span><span class="sxs-lookup"><span data-stu-id="6259d-168">Long-term solution – Migrate toofull SQL</span></span>
<span data-ttu-id="6259d-169">Как правило, проблемы hello указывает, что размер 10 ГБ базы данных больше не достаточно для Azure AD Connect toosynchronize вашей локальной Active Directory tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="6259d-169">In general, hello issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect toosynchronize your on-premises Active Directory tooAzure AD.</span></span> <span data-ttu-id="6259d-170">Рекомендуется переключиться toousing hello полную версию SQL server.</span><span class="sxs-lookup"><span data-stu-id="6259d-170">It is recommended that you switch toousing hello full version of SQL server.</span></span> <span data-ttu-id="6259d-171">Нельзя напрямую заменить hello LocalDB существующего развертывания Azure AD Connect с базой данных hello hello полной версии SQL.</span><span class="sxs-lookup"><span data-stu-id="6259d-171">You cannot directly replace hello LocalDB of an existing Azure AD Connect deployment with hello database of hello full version of SQL.</span></span> <span data-ttu-id="6259d-172">Вместо этого необходимо развернуть новый сервер с hello полную версию SQL Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="6259d-172">Instead, you must deploy a new Azure AD Connect server with hello full version of SQL.</span></span> <span data-ttu-id="6259d-173">Рекомендуется выполнить миграцию ходу где развертывании hello нового сервера Azure AD Connect (с баз данных SQL Server) в качестве промежуточного сервера Далее toohello существующего Azure AD Connect сервера (с LocalDB).</span><span class="sxs-lookup"><span data-stu-id="6259d-173">It is recommended that you do a swing migration where hello new Azure AD Connect server (with SQL DB) is deployed as a staging server, next toohello existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="6259d-174">Инструкции по как tooconfigure удаленный SQL с Azure AD Connect см. tooarticle [выборочной установки из Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="6259d-174">For instruction on how tooconfigure remote SQL with Azure AD Connect, refer tooarticle [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="6259d-175">Инструкции по ходу миграции для обновления Azure AD Connect, см. в разделе tooarticle [Azure AD Connect: обновление с предыдущей версии toohello последней](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="6259d-175">For instructions on swing migration for Azure AD Connect upgrade, refer tooarticle [Azure AD Connect: Upgrade from a previous version toohello latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="6259d-176">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="6259d-176">Next steps</span></span>
<span data-ttu-id="6259d-177">Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="6259d-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
