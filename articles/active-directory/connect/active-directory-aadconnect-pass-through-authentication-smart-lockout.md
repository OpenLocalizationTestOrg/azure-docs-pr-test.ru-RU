---
title: "Сквозная проверка подлинности в Azure AD Connect — смарт-блокировка | Документы Майкрософт"
description: "В этой статье описано, как сквозная проверка подлинности Azure Active Directory (Azure AD) позволяет защитить локальные учетные записи от атак методом подбора пароля в облаке."
services: active-directory
keywords: "Сквозная аутентификация Azure AD Connect, установка Active Directory, необходимые компоненты для Azure AD, единый вход"
documentationcenter: 
author: swkrish
manager: femila
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/02/2017
ms.author: billmath
ms.openlocfilehash: c84b2406e6373701c83c509342129bd6d7d4034b
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="azure-active-directory-pass-through-authentication-smart-lockout"></a>Сквозная проверка подлинности Azure Active Directory: смарт-блокировка

## <a name="overview"></a>Обзор

Azure AD обеспечивает защиту от атак методом подбора пароля и позволяет предотвратить потерю доступа пользователей к приложениям Office 365 и SaaS. Эта функция, которая называется **смарт-блокировкой**, поддерживается при входе с помощью сквозной проверки подлинности. По умолчанию смарт-блокировка включена для всех клиентов и постоянно защищает учетные записи пользователей; включать ее отдельно не требуется.

Смарт-блокировка отслеживает неудачные попытки входа в систему и по достижении определенного **порогового значения блокировки** включает блокировку в течение заданного **периода блокировки**. Все попытки входа злоумышленника в течение периода блокировки отклоняются. Если атака продолжается, то последующие неудачные попытки входа приводят к увеличению периода блокировки.

>[!NOTE]
>Пороговое значение блокировки по умолчанию — 10 неудачных попыток входа, а период блокировки по умолчанию — 60 секунд.

Смарт-блокировка также различает попытки входа настоящих пользователей и попытки входа злоумышленников и в большинстве случаев блокирует только попытки входа злоумышленников. Это не позволяет злоумышленникам намеренно заблокировать вход для настоящих пользователей. Чтобы различить настоящих пользователей и злоумышленников, мы используем данные о поведении в предыдущих попытках входа, сведения об устройствах и браузерах пользователей и другие сигналы. Мы постоянно улучшаем наши алгоритмы.

Поскольку сквозная проверка подлинности перенаправляет запросы на проверку пароля в локальный каталог Active Directory (AD), необходимо предотвратить блокировку учетных записей пользователей AD злоумышленниками. Так как у вас есть собственные политики блокировки учетных записей AD (в частности, [**пороговое значение блокировки**](https://technet.microsoft.com/library/hh994574(v=ws.11).aspx) и [**политики сброса счетчика блокировки учетных записей**](https://technet.microsoft.com/library/hh994568(v=ws.11).aspx)), необходимо настроить пороговое значение блокировки Azure AD и период блокировки, так чтобы отфильтровать атаки в облаке, прежде чем они достигнут локального каталога AD.

>[!NOTE]
>Функция смарт-блокировки предоставляется бесплатно. Она _включена_ по умолчанию для всех пользователей. Однако для изменения порогового значения блокировки и периода блокировки с помощью API Graph Azure AD клиенту требуется как минимум одна лицензия Azure AD Premium P2. Чтобы получить возможность смарт-блокировки с помощью сквозной аутентификации, не требуется лицензия Azure AD Premium P2 для _каждого пользователя_.

Чтобы убедиться, что локальные учетные записи пользователей AD защищены, необходимо убедиться в следующем:

1.  Пороговое значение блокировки Azure AD _меньше_, чем пороговое значение блокировки учетных записей AD. Рекомендуется устанавливать значения таким образом, чтобы пороговое значение блокировки учетных записей AD как минимум в два-три раза превышало пороговое значение блокировки Azure AD.
2.  Продолжительность блокировки Azure AD (в секундах) _больше_, чем период сброса счетчика блокировки учетных записей AD (в минутах).

## <a name="verify-your-ad-account-lockout-policies"></a>Проверка политик блокировки учетных записей AD

Чтобы проверить политики блокировки учетных записей AD, выполните следующие действия:

1.  Откройте средства управления групповыми политиками.
2.  Измените групповую политику, которая применяется ко всем пользователям, например политику домена по умолчанию.
3.  Перейдите в раздел "Конфигурация компьютера\Политики\Параметры Windows\Параметры безопасности\Политики учетных записей\Политика блокировки учетных записей".
4.  Проверьте пороговое значение блокировки учетных записей и период сброса счетчика блокировки учетных записей.

![Политики блокировки учетных записей AD](./media/active-directory-aadconnect-pass-through-authentication/pta5.png)

## <a name="use-the-graph-api-to-manage-your-tenants-smart-lockout-values"></a>Управление параметрами смарт-блокировки значения вашего клиента с помощью API Graph

>[!IMPORTANT]
>Изменение порогового значения блокировки и периода блокировки с помощью API Graph Azure AD — это функция Azure AD Premium P2. Для использования этой функции вы также должны быть глобальным администратором клиента.

Для просмотра, установки и обновления параметров смарт-блокировки Azure AD можно использовать [Graph Explorer](https://developer.microsoft.com/graph/graph-explorer). Однако эти операции можно также выполнить программными средствами.

### <a name="read-smart-lockout-values"></a>Считывание параметров смарт-блокировки

Для считывания параметров смарт-блокировки вашего клиента выполните следующие действия:

1. Войдите в Graph Explorer как глобальный администратор клиента. При необходимости предоставьте доступ для запрошенных разрешений.
2. Нажмите кнопку "Изменить разрешения" и выберите разрешение "Directory.ReadWrite.All".
3. Настройте запрос к API Graph следующим образом: установите версию в "BETA", тип запроса — в "GET" и URL-адрес в `https://graph.microsoft.com/beta/<your-tenant-domain>/settings`.
4. Нажмите кнопку "Выполнить запрос" для просмотра параметров смарт-блокировки вашего клиента. Если вы не устанавливали значений параметров клиента, вы увидите пустой набор параметров.

### <a name="set-smart-lockout-values"></a>Установка параметров смарт-блокировки

Для установки параметров смарт-блокировки клиента (только в первый раз) выполните следующие действия:

1. Войдите в Graph Explorer как глобальный администратор клиента. При необходимости предоставьте доступ для запрошенных разрешений.
2. Нажмите кнопку "Изменить разрешения" и выберите разрешение "Directory.ReadWrite.All".
3. Настройте запрос к API Graph следующим образом: установите версию в "BETA", тип запроса — в "POST" и URL-адрес в `https://graph.microsoft.com/beta/<your-tenant-domain>/settings`.
4. Скопируйте и вставьте следующий запрос JSON в поле "Текст запроса". Измените параметры смарт-блокировки соответствующим образом и используйте случайный идентификатор GUID в качестве `templateId`.
5. Нажмите кнопку "Выполнить запрос" для просмотра параметров смарт-блокировки вашего клиента.

```
{
  "templateId": "5cf42378-d67d-4f36-ba46-e8b86229381d",
  "values": [
    {
      "name": "LockoutDurationInSeconds",
      "value": "300"
    },
    {
      "name": "LockoutThreshold",
      "value": "5"
    },
    {
      "name" : "BannedPasswordList",
      "value": ""
    },
    {
      "name" : "EnableBannedPasswordCheck",
      "value": "false"
    }
  ]
}
```

>[!NOTE]
>Если вы не используете параметры **BannedPasswordList** и **EnableBannedPasswordCheck**, можно оставить их значения ("") и "false" соответственно без изменений.

Убедитесь, что параметры смарт-блокировки клиента установлены, выполнив [следующие действия](#read-smart-lockout-values).

### <a name="update-smart-lockout-values"></a>Обновление параметров смарт-блокировки

Для обновления параметров смарт-блокировки клиента (если они были установлены ранее), выполните следующие действия:

1. Войдите в Graph Explorer как глобальный администратор клиента. При необходимости предоставьте доступ для запрошенных разрешений.
2. Нажмите кнопку "Изменить разрешения" и выберите разрешение "Directory.ReadWrite.All".
3. [Для считывания параметров смарт-блокировки вашего клиента выполните следующие действия](#read-smart-lockout-values). Скопируйте значение `id` (GUID) элемента с отображаемым именем ("displayName") "PasswordRuleSettings".
4. Настройте запрос к API Graph следующим образом: установите версию в "BETA", тип запроса — в "PATCH" и URL-адрес в `https://graph.microsoft.com/beta/<your-tenant-domain>/settings/<id>` — в качестве `<id>` используйте значение GUID из шага 3.
5. Скопируйте и вставьте следующий запрос JSON в поле "Текст запроса". Измените параметры смарт-блокировки соответствующим образом.
6. Нажмите кнопку "Выполнить запрос" для обновления параметров смарт-блокировки вашего клиента.

```
{
  "values": [
    {
      "name": "LockoutDurationInSeconds",
      "value": "30"
    },
    {
      "name": "LockoutThreshold",
      "value": "4"
    },
    {
      "name" : "BannedPasswordList",
      "value": ""
    },
    {
      "name" : "EnableBannedPasswordCheck",
      "value": "false"
    }
  ]
}
```

Убедитесь, что параметры смарт-блокировки клиента были обновлены, выполнив [следующие действия](#read-smart-lockout-values).

## <a name="next-steps"></a>Дальнейшие действия
- [**UserVoice**](https://feedback.azure.com/forums/169401-azure-active-directory/category/160611-directory-synchronization-aad-connect). Отправка запросов новых функций.
