---
title: "Службы синхронизации Azure AD Connect: изменение учетной записи службы Azure AD | Документация Майкрософт"
description: "В этой статье описывается назначение ключа шифрования и его прерывание после изменения пароля."
services: active-directory
keywords: "учетная запись службы синхронизации Azure AD, пароль"
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 76b19162-8b16-4960-9e22-bd64e6675ecc
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: bf6234d0810f870909957ee1c1e33c225a4922b9
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="changing-the-azure-ad-connect-sync-service-account-password"></a>Изменение пароля учетной записи Azure AD Connect Sync
Если вы измените пароль учетной записи для Azure AD Connect Sync, служба синхронизации не сможет правильно запуститься, пока вы не сбросите ключ шифрования и не выполните повторную инициализацию пароля учетной записи для Azure AD Connect. 

Azure AD Connect входит в состав служб синхронизации. Она использует ключ шифрования для хранения паролей учетных записей служб AD DS и Azure AD.  Эти учетные записи шифруются перед сохранением в базе данных. 

Используемый ключ шифрования защищается с помощью [защиты данных Windows (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx). DPAPI защищает ключ шифрования с помощью **пароля учетной записи для службы синхронизации Azure AD Connect**. 

Если вам нужно изменить пароль учетной записи для службы, вы можете использовать процедуры из раздела [прерывание ключа шифрования в службе синхронизации Azure АD Connect](#abandoning-the-azure-ad-connect-sync-encryption-key).  Эти процедуры вам пригодятся и в том случае, когда по какой-либо причине вам понадобится сбросить ключ шифрования.

##<a name="issues-that-arise-from-changing-the-password"></a>Проблемы, которые возникают из-за смены пароля
Есть две вещи, которые необходимо выполнить при изменении пароля учетной записи службы.

Во-первых, нужно изменить пароль в диспетчере управления службами Windows.  Пока вы не устраните эту проблему, будут появляться следующие ошибки.


- Если попытаться запустить службу синхронизации, в диспетчере управления службами Windows возникает ошибка "**Windows не может запустить службу синхронизации Microsoft Azure AD на локальном компьютере**". **Ошибка 1069. Служба не запущена из-за ошибки входа в систему**".
- В средстве просмотра событий Windows журнал системных событий содержит ошибку **с идентификатором 7038** и текстом сообщения "**Служба ADSync не может войти в систему с текущим паролем из-за следующей ошибки: неверное указано имя пользователя или пароль**".

Во-вторых, при некоторых условиях служба синхронизации после изменения пароля не может получить ключ шифрования через DPAPI. Без ключа шифрования служба синхронизации не может расшифровать пароли, необходимые для синхронизации между локальным экземпляром AD и Azure AD.
Вы этом случае вы увидите такие ошибки.

- Если попытаться запустить службу синхронизации, которая не может получить ключ шифрования, в диспетчере управления службами Windows возникает ошибка "**Windows не может запустить синхронизацию Microsoft Azure AD на локальном компьютере. Дополнительные сведения см. в журнале системных событий. Если это не служба корпорации Майкрософт, обратитесь к разработчику и укажите код ошибки для этой службы **-21451857952****".
- В средстве просмотра событий Windows журнал системных событий содержит ошибку с **идентификатором 6028** и сообщением*"**Невозможно получить ключ шифрования сервера**".*

Чтобы избежать появления этих ошибок, при изменении пароля выполните процедуры, описанные в разделе [Сброс ключа шифрования в службе синхронизации Azure AD Connect](#abandoning-the-azure-ad-connect-sync-encryption-key).
 
## <a name="abandoning-the-azure-ad-connect-sync-encryption-key"></a>Сброс ключа шифрования в службе синхронизации Azure AD Connect
>[!IMPORTANT]
>Следующие процедуры применимы только к Azure AD Connect с номером сборки 1.1.443.0 или более ранних версий.

Используйте следующие процедуры для сброса ключа шифрования.

### <a name="what-to-do-if-you-need-to-abandon-the-encryption-key"></a>Что делать, если нужно сбросить ключ шифрования

Вот как можно сбросить ключ шифрования.

1. [Сброс существующего ключа шифрования](#abandon-the-existing-encryption-key)

2. [Настройка пароля учетной записи для службы AD DS](#provide-the-password-of-the-ad-ds-account)

3. [Повторная инициализация пароля учетной записи синхронизации Azure AD](#reinitialize-the-password-of-the-azure-ad-sync-account)

4. [Запуск службы синхронизации](#start-the-synchronization-service)

#### <a name="abandon-the-existing-encryption-key"></a>Сброс существующего ключа шифрования
Чтобы создать новый ключ шифрования, нужно сначала сбросить существующий ключ шифрования.

1. Войдите на сервер Azure AD Connect от имени администратора.

2. Запустите сеанс PowerShell.

3. Перейдите в папку `$env:Program Files\Microsoft Azure AD Sync\bin\`.

4. Выполните команду `./miiskmu.exe /a`.

![Служебная программа для ключа шифрования в службе синхронизации Azure AD Connect](media/active-directory-aadconnectsync-encryption-key/key5.png)

#### <a name="provide-the-password-of-the-ad-ds-account"></a>Настройка пароля учетной записи для службы AD DS
Так как расшифровка существующих паролей, которые хранятся в базе данных, стала невозможной, необходимо предоставить службе синхронизации пароль для учетной записи службы AD DS. Служба синхронизации зашифрует пароли, с помощью нового ключа шифрования.

1. Запустите Synchronization Service Manager ("Запуск" → "Служба синхронизации").
</br>![Synchronization Service Manager](./media/active-directory-aadconnectsync-service-manager-ui/startmenu.png)  
2. Перейдите на вкладку **Соединители**.
3. Выберите **соединитель AD**, соответствующий локальному экземпляру AD. Если у вас несколько соединителей AD, выполните перечисленные ниже шаги для каждого из них.
4. В разделе **Действия** выберите **Свойства**.
5. Во всплывающем диалоговом окне выберите **Подключиться к лесу Active Directory**.
6. В текстовом поле **Пароль** введите новый пароль для учетной записи AD DS. Если вы не знаете этот пароль, измените его на известное значение перед выполнением этого шага.
7. Нажмите кнопку **ОК**, чтобы сохранить новый пароль и закрыть всплывающее диалоговое окно.
![Служебная программа для ключа шифрования в службе синхронизации Azure AD Connect](media/active-directory-aadconnectsync-encryption-key/key6.png)

#### <a name="reinitialize-the-password-of-the-azure-ad-sync-account"></a>Повторная инициализация пароля учетной записи синхронизации Azure AD
Пароль учетной записи службы Azure AD нельзя напрямую передать в службу синхронизации. Вместо этого нужно использовать командлет **Add-ADSyncAADServiceAccount** для повторной инициализации учетной записи службы Azure AD. Этот командлет сбрасывает пароль учетной записи и передает его в службу синхронизации.

1. Запустите новый сеанс PowerShell на сервере Azure AD Connect.
2. Выполните командлет `Add-ADSyncAADServiceAccount`.
3. Во всплывающем диалоговом окне введите учетные данные глобального администратора Azure AD, действующие для вашего клиента Azure AD.
![Служебная программа для ключа шифрования в службе синхронизации Azure AD Connect](media/active-directory-aadconnectsync-encryption-key/key7.png)
4. Если все пройдет успешно, вы увидите командную строку PowerShell.

#### <a name="start-the-synchronization-service"></a>Запуск службы синхронизации
Теперь, когда служба синхронизации получила доступ к ключу шифрования и всем нужным паролям, вы можете перезапустить службы с помощью диспетчера управления службами Windows.


1. Перейдите к диспетчеру управления службами Windows ("Пуск" → "Службы").
2. Выберите **службу синхронизации Microsoft Azure AD** и нажмите кнопку "Перезапустить".

## <a name="next-steps"></a>Дальнейшие действия
**Обзорные статьи**

* [Службы синхронизации Azure AD Connect: общие сведений о синхронизации и ее настройка](active-directory-aadconnectsync-whatis.md)

* [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md)
