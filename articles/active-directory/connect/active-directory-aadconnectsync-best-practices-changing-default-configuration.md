---
title: "Синхронизация Azure AD Connect: изменение конфигурации по умолчанию | Документация Майкрософт"
description: "В этой статье приведены рекомендации по изменению стандартной конфигурации служб синхронизации Azure AD Connect."
services: active-directory
documentationcenter: 
author: andkjell
manager: femila
editor: 
ms.assetid: 7638a031-1635-4942-94c3-fce8f09eed5e
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: b723ad800ccc0f3040eb480bb72960943b1fdb16
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-sync-best-practices-for-changing-the-default-configuration"></a><span data-ttu-id="c22fa-103">Службы синхронизации Azure AD Connect: рекомендации по изменению конфигурации по умолчанию</span><span class="sxs-lookup"><span data-stu-id="c22fa-103">Azure AD Connect sync: Best practices for changing the default configuration</span></span>
<span data-ttu-id="c22fa-104">В этой статье описываются поддерживаемые и неподдерживаемые изменения в службах синхронизации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="c22fa-104">The purpose of this topic is to describe supported and unsupported changes to Azure AD Connect sync.</span></span>

<span data-ttu-id="c22fa-105">Конфигурация, созданная при помощи Azure AD Connect, подходит для большинства сред, в которых локальные каталоги Active Directory синхронизируются с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c22fa-105">The configuration created by Azure AD Connect works “as is” for most environments that synchronize on-premises Active Directory with Azure AD.</span></span> <span data-ttu-id="c22fa-106">Однако в некоторых случаях, чтобы выполнить определенную задачу или соблюсти нужные требования, в конфигурацию приходится вносить изменения.</span><span class="sxs-lookup"><span data-stu-id="c22fa-106">However, in some cases, it is necessary to apply some changes to a configuration to satisfy a particular need or requirement.</span></span>

## <a name="changes-to-the-service-account"></a><span data-ttu-id="c22fa-107">Изменения в учетной записи службы</span><span class="sxs-lookup"><span data-stu-id="c22fa-107">Changes to the service account</span></span>
<span data-ttu-id="c22fa-108">Службы синхронизации Azure AD Connect работают под учетной записью службы, созданной мастером установки.</span><span class="sxs-lookup"><span data-stu-id="c22fa-108">Azure AD Connect sync is running under a service account created by the installation wizard.</span></span> <span data-ttu-id="c22fa-109">Эта учетная запись содержит ключи шифрования для базы данных, используемой в процессе синхронизации.</span><span class="sxs-lookup"><span data-stu-id="c22fa-109">This service account holds the encryption keys to the database used by sync.</span></span> <span data-ttu-id="c22fa-110">Она создается с паролем длиной 127 символов, срок действия которого не ограничен.</span><span class="sxs-lookup"><span data-stu-id="c22fa-110">It is created with a 127 characters long password and the password is set to not expire.</span></span>

* <span data-ttu-id="c22fa-111">Изменение или сброс пароля учетной записи службы **не поддерживается** .</span><span class="sxs-lookup"><span data-stu-id="c22fa-111">It is **unsupported** to change or reset the password of the service account.</span></span> <span data-ttu-id="c22fa-112">Это приведет к уничтожению ключей шифрования, поэтому служба не сможет получить доступ к базе данных и не сможет запуститься.</span><span class="sxs-lookup"><span data-stu-id="c22fa-112">Doing so destroys the encryption keys and the service is not able to access the database and is not able to start.</span></span>

## <a name="changes-to-the-scheduler"></a><span data-ttu-id="c22fa-113">Изменения в планировщике</span><span class="sxs-lookup"><span data-stu-id="c22fa-113">Changes to the scheduler</span></span>
<span data-ttu-id="c22fa-114">Начиная со сборки 1.1 (февраль 2016 года) можно настроить в [планировщике](active-directory-aadconnectsync-feature-scheduler.md) другой цикл синхронизации по сравнению с 30 минутами по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c22fa-114">Starting with the releases from build 1.1 (February 2016) you can configure the [scheduler](active-directory-aadconnectsync-feature-scheduler.md) to have a different sync cycle than the default 30 minutes.</span></span>

## <a name="changes-to-synchronization-rules"></a><span data-ttu-id="c22fa-115">Изменения в правилах синхронизации</span><span class="sxs-lookup"><span data-stu-id="c22fa-115">Changes to Synchronization Rules</span></span>
<span data-ttu-id="c22fa-116">Мастер установки создает конфигурацию, которая должна работать для наиболее распространенных сценариев.</span><span class="sxs-lookup"><span data-stu-id="c22fa-116">The installation wizard provides a configuration that is supposed to work for the most common scenarios.</span></span> <span data-ttu-id="c22fa-117">Если необходимо внести изменения в конфигурацию, чтобы она по-прежнему была поддерживаемой, необходимо следовать этим правилам.</span><span class="sxs-lookup"><span data-stu-id="c22fa-117">In case you need to make changes to the configuration, then you must follow these rules to still have a supported configuration.</span></span>

* <span data-ttu-id="c22fa-118">Вы можете [изменить потоки атрибутов](active-directory-aadconnectsync-change-the-configuration.md#other-common-attribute-flow-changes) , если прямые потоки атрибутов по умолчанию не подходят для вашей организации.</span><span class="sxs-lookup"><span data-stu-id="c22fa-118">You can [change attribute flows](active-directory-aadconnectsync-change-the-configuration.md#other-common-attribute-flow-changes) if the default direct attribute flows are not suitable for your organization.</span></span>
* <span data-ttu-id="c22fa-119">Если вы не хотите [отправлять атрибут в потоке](active-directory-aadconnectsync-change-the-configuration.md#do-not-flow-an-attribute) и вам требуется удалить существующие значения атрибута в Azure AD, для этого необходимо создать правило.</span><span class="sxs-lookup"><span data-stu-id="c22fa-119">If you want to [not flow an attribute](active-directory-aadconnectsync-change-the-configuration.md#do-not-flow-an-attribute) and remove any existing attribute values in Azure AD, then you need to create a rule for this scenario.</span></span>
* <span data-ttu-id="c22fa-120">[Отключайте ненужные правила синхронизации](#disable-an-unwanted-sync-rule) , вместо того чтобы их удалять.</span><span class="sxs-lookup"><span data-stu-id="c22fa-120">[Disable an unwanted Sync Rule](#disable-an-unwanted-sync-rule) rather than deleting it.</span></span> <span data-ttu-id="c22fa-121">Удаленное правило будет снова создано во время обновления.</span><span class="sxs-lookup"><span data-stu-id="c22fa-121">A deleted rule is recreated during an upgrade.</span></span>
* <span data-ttu-id="c22fa-122">Если вы хотите [внести изменения в стандартное правило](#change-an-out-of-box-rule), сделайте его копию и отключите стандартное правило.</span><span class="sxs-lookup"><span data-stu-id="c22fa-122">To [change an out-of-box rule](#change-an-out-of-box-rule), you should make a copy of the original rule and disable the out-of-box rule.</span></span> <span data-ttu-id="c22fa-123">Редактор правил синхронизации предоставит подсказки и помощь.</span><span class="sxs-lookup"><span data-stu-id="c22fa-123">The Sync Rule Editor prompts and helps you.</span></span>
* <span data-ttu-id="c22fa-124">Экспортируйте настраиваемые правила синхронизации с помощью редактора правил синхронизации.</span><span class="sxs-lookup"><span data-stu-id="c22fa-124">Export your custom synchronization rules using the Synchronization Rules Editor.</span></span> <span data-ttu-id="c22fa-125">Этот редактор создаст скрипт PowerShell, с помощью которого вы сможете легко восстановить правила в случае сбоев.</span><span class="sxs-lookup"><span data-stu-id="c22fa-125">The editor provides you with a PowerShell script you can use to easily recreate them in a disaster recovery scenario.</span></span>

> [!WARNING]
> <span data-ttu-id="c22fa-126">Стандартные правила синхронизации имеют отпечаток.</span><span class="sxs-lookup"><span data-stu-id="c22fa-126">The out-of-box sync rules have a thumbprint.</span></span> <span data-ttu-id="c22fa-127">Если внести в правила изменения, отпечаток также изменится.</span><span class="sxs-lookup"><span data-stu-id="c22fa-127">If you make a change to these rules, the thumbprint is no longer matching.</span></span> <span data-ttu-id="c22fa-128">Тогда при следующей попытке установить новый выпуск Azure AD Connect могут возникнуть проблемы.</span><span class="sxs-lookup"><span data-stu-id="c22fa-128">You might have problems in the future when you try to apply a new release of Azure AD Connect.</span></span> <span data-ttu-id="c22fa-129">Выполняйте изменения только так, как описано в этой статье.</span><span class="sxs-lookup"><span data-stu-id="c22fa-129">Only make changes the way it is described in this article.</span></span>

### <a name="disable-an-unwanted-sync-rule"></a><span data-ttu-id="c22fa-130">Отключайте ненужные правила синхронизации</span><span class="sxs-lookup"><span data-stu-id="c22fa-130">Disable an unwanted Sync Rule</span></span>
<span data-ttu-id="c22fa-131">Не удаляйте правило синхронизации из стандартной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c22fa-131">Do not delete an out-of-box sync rule.</span></span> <span data-ttu-id="c22fa-132">Оно будет создано заново при следующем обновлении.</span><span class="sxs-lookup"><span data-stu-id="c22fa-132">It is recreated during next upgrade.</span></span>

<span data-ttu-id="c22fa-133">В некоторых случаях конфигурация, созданная мастером установки, не будет работать в вашей топологии.</span><span class="sxs-lookup"><span data-stu-id="c22fa-133">In some cases, the installation wizard has produced a configuration that is not working for your topology.</span></span> <span data-ttu-id="c22fa-134">Например, если вы используете топологию лесов ресурсов и учетных записей, но дополнили схему в лесу учетных записей схемой Exchange, будут созданы правила для Exchange: для леса учетных записей и для леса ресурсов.</span><span class="sxs-lookup"><span data-stu-id="c22fa-134">For example, if you have an account-resource forest topology but you have extended the schema in the account forest with the Exchange schema, then rules for Exchange are created for the account forest and the resource forest.</span></span> <span data-ttu-id="c22fa-135">В этом случае необходимо отключить правило синхронизации для Exchange.</span><span class="sxs-lookup"><span data-stu-id="c22fa-135">In this case, you need to disable the Sync Rule for Exchange.</span></span>

![Отключенное правило синхронизации](./media/active-directory-aadconnectsync-best-practices-changing-default-configuration/exchangedisabledrule.png)

<span data-ttu-id="c22fa-137">На рисунке выше мастер установки обнаружил старую схему Exchange 2003 в лесу учетных записей.</span><span class="sxs-lookup"><span data-stu-id="c22fa-137">In the picture above, the installation wizard has found an old Exchange 2003 schema in the account forest.</span></span> <span data-ttu-id="c22fa-138">Это расширение схемы было добавлено до того, как лес ресурсов был введен в среду компании Fabrikam.</span><span class="sxs-lookup"><span data-stu-id="c22fa-138">This schema extension was added before the resource forest was introduced in Fabrikam's environment.</span></span> <span data-ttu-id="c22fa-139">Чтобы не синхронизировать атрибуты из старой реализации Exchange, следует отключить правило синхронизации, как показано здесь.</span><span class="sxs-lookup"><span data-stu-id="c22fa-139">To ensure no attributes from the old Exchange implementation are synchronized, the sync rule should be disabled as shown.</span></span>

### <a name="change-an-out-of-box-rule"></a><span data-ttu-id="c22fa-140">внести изменения в стандартное правило</span><span class="sxs-lookup"><span data-stu-id="c22fa-140">Change an out-of-box rule</span></span>
<span data-ttu-id="c22fa-141">Единственный случай, в котором следует изменить стандартное правило, — когда необходимо изменить правило присоединения.</span><span class="sxs-lookup"><span data-stu-id="c22fa-141">The only time you should change an out-of-box rule is when you need to change the join rule.</span></span> <span data-ttu-id="c22fa-142">Если вам нужно изменить последовательность атрибутов, то следует создать правило синхронизации с более высоким приоритетом, чем стандартные правила.</span><span class="sxs-lookup"><span data-stu-id="c22fa-142">If you need to change an attribute flow, then you should create a sync rule with higher precedence than the out-of-box rules.</span></span> <span data-ttu-id="c22fa-143">Единственное правило, которое действительно нужно клонировать, — правило **In from AD - User Join**.</span><span class="sxs-lookup"><span data-stu-id="c22fa-143">The only rule you practically need to clone is the rule **In from AD - User Join**.</span></span> <span data-ttu-id="c22fa-144">Все прочие правила можно переопределить правилами с более высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="c22fa-144">You can override all other rules with a higher precedence rule.</span></span>

<span data-ttu-id="c22fa-145">Если вы хотите внести изменения в стандартное правило, сделайте его копию и отключите исходное правило.</span><span class="sxs-lookup"><span data-stu-id="c22fa-145">If you need to make changes to an out-of-box rule, then you should make a copy of the out-of-box rule and disable the original rule.</span></span> <span data-ttu-id="c22fa-146">Затем внесите необходимые изменения в клонированное правило.</span><span class="sxs-lookup"><span data-stu-id="c22fa-146">Then make the changes to the cloned rule.</span></span> <span data-ttu-id="c22fa-147">Редактор правил синхронизации поможет вам выполнить эти действия.</span><span class="sxs-lookup"><span data-stu-id="c22fa-147">The Sync Rule Editor is helping you with those steps.</span></span> <span data-ttu-id="c22fa-148">Открыв стандартное правило, вы увидите такое диалоговое окно: </span><span class="sxs-lookup"><span data-stu-id="c22fa-148">When you open an out-of-box rule, you are presented with this dialog box:</span></span>  
![Предупреждение стандартного правила](./media/active-directory-aadconnectsync-best-practices-changing-default-configuration/warningoutofboxrule.png)

<span data-ttu-id="c22fa-150">Выберите **Да** для создания копии правила.</span><span class="sxs-lookup"><span data-stu-id="c22fa-150">Select **Yes** to create a copy of the rule.</span></span> <span data-ttu-id="c22fa-151">Затем будет открыто клонированное правило.</span><span class="sxs-lookup"><span data-stu-id="c22fa-151">The cloned rule is then opened.</span></span>  
<span data-ttu-id="c22fa-152">![Клонированное правило](./media/active-directory-aadconnectsync-best-practices-changing-default-configuration/clonedrule.png)</span><span class="sxs-lookup"><span data-stu-id="c22fa-152">![Cloned rule](./media/active-directory-aadconnectsync-best-practices-changing-default-configuration/clonedrule.png)</span></span>

<span data-ttu-id="c22fa-153">В этом клонированном правиле выполните необходимые изменения в области, объединении и преобразованиях.</span><span class="sxs-lookup"><span data-stu-id="c22fa-153">On this cloned rule, make any necessary changes to scope, join, and transformations.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c22fa-154">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c22fa-154">Next steps</span></span>
<span data-ttu-id="c22fa-155">**Обзорные статьи**</span><span class="sxs-lookup"><span data-stu-id="c22fa-155">**Overview topics**</span></span>

* [<span data-ttu-id="c22fa-156">Службы синхронизации Azure AD Connect: общие сведений о синхронизации и ее настройка</span><span class="sxs-lookup"><span data-stu-id="c22fa-156">Azure AD Connect sync: Understand and customize synchronization</span></span>](active-directory-aadconnectsync-whatis.md)
* [<span data-ttu-id="c22fa-157">Интеграция локальных удостоверений с Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="c22fa-157">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)
