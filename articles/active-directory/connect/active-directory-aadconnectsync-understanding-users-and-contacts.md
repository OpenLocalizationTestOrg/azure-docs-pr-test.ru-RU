---
title: "Синхронизация Azure AD Connect: общие сведения о пользователях и контактах | Документация Майкрософт"
description: "Описание пользователей и контактов в службе синхронизации Azure AD Connect."
services: active-directory
documentationcenter: 
author: MarkusVi
manager: femila
ms.assetid: 8d204647-213a-4519-bd62-49563c421602
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: markvi;andkjell
ms.openlocfilehash: 495e926a1975128707212ba571d47cfc7c9507b3
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-sync-understanding-users-and-contacts"></a><span data-ttu-id="97da0-103">Синхронизация Azure AD Connect: общее представление о пользователях и контактах</span><span class="sxs-lookup"><span data-stu-id="97da0-103">Azure AD Connect sync: Understanding Users and Contacts</span></span>
<span data-ttu-id="97da0-104">Существует несколько разных причин, по которым нужно иметь несколько лесов Active Directory. Кроме того, существует несколько разных топологий развертывания.</span><span class="sxs-lookup"><span data-stu-id="97da0-104">There are several different reasons why you would have multiple Active Directory forests and there are several different deployment topologies.</span></span> <span data-ttu-id="97da0-105">Распространенные модели включают развертывание ресурсов учетной записи и лесов с синхронизированным глобальным списком адресов после слияния и поглощения.</span><span class="sxs-lookup"><span data-stu-id="97da0-105">Common models include an account-resource deployment and GAL sync’ed forests after a merger & acquisition.</span></span> <span data-ttu-id="97da0-106">Но даже при наличии чистых моделей гибридные модели не менее часто используются.</span><span class="sxs-lookup"><span data-stu-id="97da0-106">But even if there are pure models, hybrid models are common as well.</span></span> <span data-ttu-id="97da0-107">Конфигурация по умолчанию в службе синхронизации Azure AD Connect не предполагает какой-то конкретной модели. Тем не менее, в зависимости от выбора сопоставления пользователей в руководстве по установке, можно наблюдать разное поведение.</span><span class="sxs-lookup"><span data-stu-id="97da0-107">The default configuration in Azure AD Connect sync does not assume any particular model but depending on how user matching was selected in the installation guide, different behaviors can be observed.</span></span>

<span data-ttu-id="97da0-108">В этом разделе будет рассмотрено поведение конфигурации по умолчанию в определенных топологиях.</span><span class="sxs-lookup"><span data-stu-id="97da0-108">In this topic, we will go through how the default configuration behaves in certain topologies.</span></span> <span data-ttu-id="97da0-109">Мы изучим конфигурацию с помощью редактора правил синхронизации.</span><span class="sxs-lookup"><span data-stu-id="97da0-109">We will go through the configuration and the Synchronization Rules Editor can be used to look at the configuration.</span></span>

<span data-ttu-id="97da0-110">Конфигурация предполагает наличие нескольких общих правил.</span><span class="sxs-lookup"><span data-stu-id="97da0-110">There are a few general rules the configuration assumes:</span></span>

* <span data-ttu-id="97da0-111">Конечный результат всегда должен быть одинаковым, независимо от используемого порядка импорта исходных каталогов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="97da0-111">Regardless of which order we import from the source Active Directories, the end result should always be the same.</span></span>
* <span data-ttu-id="97da0-112">Активная учетная запись всегда будет передавать данные для входа, включая атрибуты **userPrincipalName** и **sourceAnchor**.</span><span class="sxs-lookup"><span data-stu-id="97da0-112">An active account will always contribute sign-in information, including **userPrincipalName** and **sourceAnchor**.</span></span>
* <span data-ttu-id="97da0-113">Если активная учетная запись не найдена, будут использованы атрибуты userPrincipalName и sourceAnchor из отключенной учетной записи, если только это не связанный почтовый ящик.</span><span class="sxs-lookup"><span data-stu-id="97da0-113">A disabled account will contribute userPrincipalName and sourceAnchor, unless it is a linked mailbox, if there is no active account to be found.</span></span>
* <span data-ttu-id="97da0-114">Учетная запись со связанным почтовым ящиком никогда не будет использоваться для передачи атрибутов userPrincipalName и sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="97da0-114">An account with a linked mailbox will never be used for userPrincipalName and sourceAnchor.</span></span> <span data-ttu-id="97da0-115">Предполагается, что активная учетная запись будет найдена позже.</span><span class="sxs-lookup"><span data-stu-id="97da0-115">It is assumed that an active account will be found later.</span></span>
* <span data-ttu-id="97da0-116">Контактный объект может быть подготовлен в Azure AD как контакт или пользователь.</span><span class="sxs-lookup"><span data-stu-id="97da0-116">A contact object might be provisioned to Azure AD as a contact or as a user.</span></span> <span data-ttu-id="97da0-117">Фактически, это остается неизвестным до тех пор, пока не будут обработаны все исходные леса Active Directory.</span><span class="sxs-lookup"><span data-stu-id="97da0-117">You don’t really know until all source Active Directory forests have been processed.</span></span>

## <a name="contacts"></a><span data-ttu-id="97da0-118">Контакты</span><span class="sxs-lookup"><span data-stu-id="97da0-118">Contacts</span></span>
<span data-ttu-id="97da0-119">Наличие контактов, представляющих пользователя в разных лесах, — распространенное явление. Это происходит после слияния и поглощения, когда решение GALSync связывает два и более леса Exchange.</span><span class="sxs-lookup"><span data-stu-id="97da0-119">Having contacts representing a user in a different forest is common after a merger & acquisition where a GALSync solution is bridging two or more Exchange forests.</span></span> <span data-ttu-id="97da0-120">Контактный объект всегда присоединяется из пространства соединителя к метавселенной с помощью атрибута mail.</span><span class="sxs-lookup"><span data-stu-id="97da0-120">The contact object is always joining from the connector space to the metaverse using the mail attribute.</span></span> <span data-ttu-id="97da0-121">Если контактный объект или объект-пользователь с тем же адресом электронной почты уже существует, такие объекты объединяются.</span><span class="sxs-lookup"><span data-stu-id="97da0-121">If there is already a contact object or user object with the same mail address, the objects are joined together.</span></span> <span data-ttu-id="97da0-122">Это настраивается в правиле **In from AD — Contact Join**.</span><span class="sxs-lookup"><span data-stu-id="97da0-122">This is configured in the rule **In from AD – Contact Join**.</span></span> <span data-ttu-id="97da0-123">Также существует правило с именем **In from AD — Contact Common** с потоком атрибутов в атрибут метавселенной **sourceObjectType** с константой **Contact**.</span><span class="sxs-lookup"><span data-stu-id="97da0-123">There is also a rule named **In from AD – Contact Common** with an attribute flow to the metaverse attribute **sourceObjectType** with the constant **Contact**.</span></span> <span data-ttu-id="97da0-124">Это правило имеет очень низкий приоритет. Поэтому, если любой объект пользователя присоединен к тому же объекту метавселенной, то правило **In from AD — User Common** передаст значение User этому атрибуту.</span><span class="sxs-lookup"><span data-stu-id="97da0-124">This rule has very low precedence so if any user object is joined to the same metaverse object, then the rule **In from AD – User Common** will contribute the value User to this attribute.</span></span> <span data-ttu-id="97da0-125">Благодаря этому правилу атрибут получит значение Contact, если пользователь не был присоединен, а также значение User, если был найден хотя бы один пользователь.</span><span class="sxs-lookup"><span data-stu-id="97da0-125">With this rule, this attribute will have the value Contact if no user has been joined and the value User if at least one user has been found.</span></span>

<span data-ttu-id="97da0-126">Для подготовки объекта в Azure AD исходящее правило **Out to AAD — Contact Join** создаст объект-контакт, если атрибут метавселенной **sourceObjectType** имеет значение **Contact**.</span><span class="sxs-lookup"><span data-stu-id="97da0-126">For provisioning an object to Azure AD, the outbound rule **Out to AAD – Contact Join** will create a contact object if the metaverse attribute **sourceObjectType** is set to **Contact**.</span></span> <span data-ttu-id="97da0-127">Если этот атрибут имеет значение **User**, тогда правило **Out to AAD — User Join** создаст объект-пользователя.</span><span class="sxs-lookup"><span data-stu-id="97da0-127">If this attribute is set to **User**, then the rule **Out to AAD – User Join** will create a user object instead.</span></span>
<span data-ttu-id="97da0-128">Повышение значения Contact до User возможно, если большее количество дополнительных исходных каталогов Active Directory будет импортировано и синхронизировано.</span><span class="sxs-lookup"><span data-stu-id="97da0-128">It is possible that an object is promoted from Contact to User when more source Active Directories are imported and synchronized.</span></span>

<span data-ttu-id="97da0-129">Например, в топологии GALSync мы найдем контактные объекты для всех во втором лесу при импорте первого леса.</span><span class="sxs-lookup"><span data-stu-id="97da0-129">For example, in a GALSync topology we will find contact objects for everyone in the second forest when we import the first forest.</span></span> <span data-ttu-id="97da0-130">Это позволит разместить новые контактные объекты в соединителе AAD.</span><span class="sxs-lookup"><span data-stu-id="97da0-130">This will stage new contact objects in the AAD Connector.</span></span> <span data-ttu-id="97da0-131">При последующем импорте и синхронизации второго леса мы найдем реальных пользователей, которые будут присоединены к существующим объектам метавселенной.</span><span class="sxs-lookup"><span data-stu-id="97da0-131">When we later import and synchronize the second forest, we will find the real users and join them to the existing metaverse objects.</span></span> <span data-ttu-id="97da0-132">Затем мы удалим контактный объект в AAD и создадим вместо него новый объект-пользователь.</span><span class="sxs-lookup"><span data-stu-id="97da0-132">We will then delete the contact object in AAD and create a new user object instead.</span></span>

<span data-ttu-id="97da0-133">Если у вас есть топология, в которой пользователи представлены как контакты, убедитесь, что вы выбрали в руководстве по установке сопоставление пользователей по атрибуту почты (mail).</span><span class="sxs-lookup"><span data-stu-id="97da0-133">If you have a topology where users are represented as contacts, make sure you select to match users on the mail attribute in the installation guide.</span></span> <span data-ttu-id="97da0-134">Если выбран другой вариант, вы получите конфигурацию, зависящую от порядка.</span><span class="sxs-lookup"><span data-stu-id="97da0-134">If you select another option, then you will have an order dependent configuration.</span></span> <span data-ttu-id="97da0-135">Контактные объекты всегда присоединяются по атрибуту mail. При этом объекты-пользователи будут присоединяться по атрибуту mail только в том случае, если этот вариант выбран в руководстве по установке.</span><span class="sxs-lookup"><span data-stu-id="97da0-135">Contact objects will always join on the mail attribute, but user objects will only join on the mail attribute if this option was selected in the installation guide.</span></span> <span data-ttu-id="97da0-136">Если контактный объект импортирован до объекта-пользователя, вы можете получить два разных объекта в метавселенной с одинаковым атрибутом mail.</span><span class="sxs-lookup"><span data-stu-id="97da0-136">You could then end up with two different objects in the metaverse with the same mail attribute if the contact object was imported before the user object.</span></span> <span data-ttu-id="97da0-137">Во время экспорта в Azure AD возникнет ошибка.</span><span class="sxs-lookup"><span data-stu-id="97da0-137">During export to Azure AD, an error will be thrown.</span></span> <span data-ttu-id="97da0-138">Такое поведение является запланированным. Оно указывает на наличие неправильных данных или на неправильное определение топологии во время установки.</span><span class="sxs-lookup"><span data-stu-id="97da0-138">This behavior is by design and would indicate bad data or that the topology was not correctly identified during the installation.</span></span>

## <a name="disabled-accounts"></a><span data-ttu-id="97da0-139">Отключенные учетные записи</span><span class="sxs-lookup"><span data-stu-id="97da0-139">Disabled accounts</span></span>
<span data-ttu-id="97da0-140">Отключенные учетные записи также синхронизируются в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="97da0-140">Disabled accounts are synchronized as well to Azure AD.</span></span> <span data-ttu-id="97da0-141">Обычно отключенные учетные записи представляют ресурсы в Exchange, включая переговорные.</span><span class="sxs-lookup"><span data-stu-id="97da0-141">Disabled accounts are common to represent resources in Exchange, for example conference rooms.</span></span> <span data-ttu-id="97da0-142">Исключением являются пользователи со связанным почтовым ящиком. Как упоминалось выше, для них никогда не выполняется подготовка учетной записи в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="97da0-142">The exception is users with a linked mailbox; as previously mentioned, these will never provision an account to Azure AD.</span></span>

<span data-ttu-id="97da0-143">Предполагается, что при обнаружении отключенной учетной записи пользователя другая активная учетная запись впоследствии найдена не будет. Поэтому объект будет подготовлен в Azure AD с найденными атрибутами userPrincipalName и sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="97da0-143">The assumption is that if a disabled user account is found, then we will not find another active account later and the object is provisioned to Azure AD with the userPrincipalName and sourceAnchor found.</span></span> <span data-ttu-id="97da0-144">Если присоединить другую активную учетную запись к этому же объекту метавселенной, будут использоваться его атрибуты userPrincipalName и sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="97da0-144">In case another active account will join to the same metaverse object, then its userPrincipalName and sourceAnchor will be used.</span></span>

## <a name="changing-sourceanchor"></a><span data-ttu-id="97da0-145">Изменение атрибута sourceAnchor</span><span class="sxs-lookup"><span data-stu-id="97da0-145">Changing sourceAnchor</span></span>
<span data-ttu-id="97da0-146">После экспорта объекта в Azure AD изменить атрибут sourceAnchor невозможно.</span><span class="sxs-lookup"><span data-stu-id="97da0-146">When an object has been exported to Azure AD then it is not allowed to change the sourceAnchor anymore.</span></span> <span data-ttu-id="97da0-147">При экспорте объекта атрибуту метавселенной **cloudSourceAnchor** присваивается значение **sourceAnchor**, принятое Azure AD.</span><span class="sxs-lookup"><span data-stu-id="97da0-147">When the object has been exported the metaverse attribute **cloudSourceAnchor** is set with the **sourceAnchor** value accepted by Azure AD.</span></span> <span data-ttu-id="97da0-148">Если атрибут **sourceAnchor** изменен и не соответствует **cloudSourceAnchor**, то правило **Out to AAD — User Join** породит ошибку **sourceAnchor attribute has changed** (атрибут sourceAnchor изменен).</span><span class="sxs-lookup"><span data-stu-id="97da0-148">If **sourceAnchor** is changed and not match **cloudSourceAnchor**, the rule **Out to AAD – User Join** will throw the error **sourceAnchor attribute has changed**.</span></span> <span data-ttu-id="97da0-149">В таком случае необходимо исправить конфигурацию или данные, чтобы в метавселенной снова был представлен прежний атрибут sourceAnchor, прежде чем объект снова можно будет синхронизировать.</span><span class="sxs-lookup"><span data-stu-id="97da0-149">In this case, the configuration or data must be corrected so the same sourceAnchor is present in the metaverse again before the object can be synchronized again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="97da0-150">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="97da0-150">Additional Resources</span></span>
* [<span data-ttu-id="97da0-151">Azure AD Connect Sync: настройка параметров синхронизации</span><span class="sxs-lookup"><span data-stu-id="97da0-151">Azure AD Connect Sync: Customizing Synchronization options</span></span>](active-directory-aadconnectsync-whatis.md)
* [<span data-ttu-id="97da0-152">Интеграция локальных удостоверений с Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="97da0-152">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)

