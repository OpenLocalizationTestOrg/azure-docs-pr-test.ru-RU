---
title: "Azure AD Connect: использование поставщика удостоверений SAML 2.0 для единого входа | Документы Майкрософт"
description: "В этом разделе описывается использование поставщика удостоверений, совместимого с SAML 2.0, для единого входа."
services: active-directory
author: billmath
manager: femila
ms.custom: it-pro
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: f9653dc44fb284a9b3c1988f623c33f27ae148cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
#  <a name="use-a-saml-20-identity-provider-idp-for-single-sign-on"></a><span data-ttu-id="13c48-103">Использование поставщика удостоверений (IdP) SAML 2.0 для единого входа</span><span class="sxs-lookup"><span data-stu-id="13c48-103">Use a SAML 2.0 Identity Provider (IdP) for Single Sign On</span></span>

<span data-ttu-id="13c48-104">Этот раздел содержит сведения об использовании SAML 2.0 совместимые профилей SP-Lite поставщиком удостоверений на основе как hello основной службы маркеров безопасности (STS) или поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="13c48-104">This topic contains information on using a SAML 2.0 compliant SP-Lite profile based Identity Provider as hello preferred Security Token Service (STS) / identity provider.</span></span> <span data-ttu-id="13c48-105">Это полезно при наличии локального каталога пользователей и хранилища паролей, доступ к которым возможен с помощью SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-105">This is useful where you already have a user directory and password store on-premises that can be accessed using SAML 2.0.</span></span> <span data-ttu-id="13c48-106">Существующий каталог пользователей может использоваться для входа tooOffice 365 и другим ресурсам Azure AD защищены.</span><span class="sxs-lookup"><span data-stu-id="13c48-106">This existing user directory can be used for sign-on tooOffice 365 and other Azure AD-secured resources.</span></span> <span data-ttu-id="13c48-107">Hello SAML 2.0 SP-Lite профиля основан на hello широко используемые Security Assertion Markup Language (SAML) федеративного удостоверения стандартные tooprovide входа и платформы обмена.</span><span class="sxs-lookup"><span data-stu-id="13c48-107">hello SAML 2.0 SP-Lite profile is based on hello widely used Security Assertion Markup Language (SAML) federated identity standard tooprovide a sign-on and attribute exchange framework.</span></span>

>[!NOTE]
><span data-ttu-id="13c48-108">Список сторонних Idps, которые были протестированы для использования с Azure AD см hello [список совместимости федерации Azure AD](active-directory-aadconnect-federation-compatibility.md)</span><span class="sxs-lookup"><span data-stu-id="13c48-108">For a list of 3rd party Idps that have been tested for use with Azure AD see hello [Azure AD federation compatibility list](active-directory-aadconnect-federation-compatibility.md)</span></span>

<span data-ttu-id="13c48-109">Корпорация Майкрософт поддерживает эти возможности входа как интеграция hello облачной службы Майкрософт, таких как Office 365, с помощью SAML 2.0 правильно настроенного профиля на основе поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="13c48-109">Microsoft supports this sign-on experience as hello integration of a Microsoft cloud service, such as Office 365, with your properly configured SAML 2.0 profile based IdP.</span></span> <span data-ttu-id="13c48-110">Поставщики удостоверений SAML 2.0 — это сторонние продукты, и поэтому корпорация Майкрософт не поддерживает hello развертыванию, настройке, устранение неполадок рекомендациям относительно их.</span><span class="sxs-lookup"><span data-stu-id="13c48-110">SAML 2.0 identity providers are third-party products and therefore Microsoft does not provide support for hello deployment, configuration, troubleshooting best practices regarding them.</span></span> <span data-ttu-id="13c48-111">После правильной настройке hello интеграция с SAML 2.0 поставщик удостоверений можно проверить на наличие правильной конфигурации с помощью анализатора подключений Майкрософт описанного ниже более подробно hello hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-111">Once properly configured, hello integration with hello SAML 2.0 identity provider can be tested for proper configuration by using hello Microsoft Connectivity Analyzer Tool which is described in more detail below.</span></span> <span data-ttu-id="13c48-112">Дополнительные сведения о поставщика удостоверений на основе SAML 2.0 SP-Lite профиля попросите предоставившую его организацию hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-112">For more information about your SAML 2.0 SP-Lite profile based identity provider, ask hello organization that supplied it.</span></span>

>[!IMPORTANT]
><span data-ttu-id="13c48-113">В этом сценарии единого входа с помощью поставщиков удостоверений SAML 2.0 доступен только ограниченный набор клиентов, в число которых входят приведенные далее.</span><span class="sxs-lookup"><span data-stu-id="13c48-113">Only a limited set of clients are available in this sign-on scenario with SAML 2.0 identity providers, this includes:</span></span>

>- <span data-ttu-id="13c48-114">Веб-клиенты, такие как Outlook Web Access и SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="13c48-114">Web-based clients such as Outlook Web Access and SharePoint Online</span></span>
- <span data-ttu-id="13c48-115">Полнофункциональные почтовые клиенты, использующие обычную проверку подлинности и поддерживаемый метод доступа Exchange, таких как IMAP, POP, Active Sync, MAPI, т. д. (hello расширенного клиентского протокола конечной точки является обязательным toobe развертывания), в том числе:</span><span class="sxs-lookup"><span data-stu-id="13c48-115">Email-rich clients that use basic authentication and a supported Exchange access method such as IMAP, POP, Active Sync, MAPI, etc. (hello Enhanced Client Protocol end point is required toobe deployed), including:</span></span>
    - <span data-ttu-id="13c48-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016, Apple iPhone (различные версии iOS);</span><span class="sxs-lookup"><span data-stu-id="13c48-116">Microsoft Outlook 2010/Outlook 2013/Outlook 2016, Apple iPhone (various iOS versions)</span></span>
    - <span data-ttu-id="13c48-117">различные устройства Google Android;</span><span class="sxs-lookup"><span data-stu-id="13c48-117">Various Google Android Devices</span></span>
    - <span data-ttu-id="13c48-118">Windows Phone 7, Windows Phone 7.8 и Windows Phone 8.0;</span><span class="sxs-lookup"><span data-stu-id="13c48-118">Windows Phone 7, Windows Phone 7.8, and Windows Phone 8.0</span></span>
    - <span data-ttu-id="13c48-119">почтовый клиент Windows 8 и Windows 8.1;</span><span class="sxs-lookup"><span data-stu-id="13c48-119">Windows 8 Mail Client and Windows 8.1 Mail Client</span></span>
    - <span data-ttu-id="13c48-120">почтовый клиент Windows 10.</span><span class="sxs-lookup"><span data-stu-id="13c48-120">Windows 10 Mail Client</span></span>

<span data-ttu-id="13c48-121">Все остальные клиенты не поддерживаются в сценарии единого входа с помощью поставщика удостоверений SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-121">All other clients are not available in this sign-on scenario with your SAML 2.0 Identity Provider.</span></span> <span data-ttu-id="13c48-122">Например клиент рабочего стола hello Lync 2010 не может toologin в службу hello с поставщиком удостоверений SAML 2.0, настроенного для единого входа.</span><span class="sxs-lookup"><span data-stu-id="13c48-122">For example, hello Lync 2010 desktop client is not able toologin into hello service with your SAML 2.0 Identity Provider configured for single sign-on.</span></span>

## <a name="azure-ad-saml-20-protocol-requirements"></a><span data-ttu-id="13c48-123">Требования Azure AD к протоколу SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="13c48-123">Azure AD SAML 2.0 protocol requirements</span></span>
<span data-ttu-id="13c48-124">Этот раздел содержит подробные требования на протоколе hello и форматирования, что поставщик удостоверений SAML 2.0 должен реализовывать toofederate с Azure AD tooenable входа tooone или несколько облачных служб Майкрософт (например, Office 365) сообщений.</span><span class="sxs-lookup"><span data-stu-id="13c48-124">This topic contains detailed requirements on hello protocol and message formatting that your SAML 2.0 identity provider must implement toofederate with Azure AD tooenable sign-on tooone or more Microsoft cloud services (such as Office 365).</span></span> <span data-ttu-id="13c48-125">Hello SAML 2.0 проверяющей стороны (SP-STS) для облачной службы Майкрософт, используемая в этом сценарии используется Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-125">hello SAML 2.0 relying party (SP-STS) for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

<span data-ttu-id="13c48-126">Рекомендуется убедиться, быть выходных сообщений поставщика удостоверений, что аналогично toohello предоставленный образец трассировок можно SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-126">It is recommended that you ensure your SAML 2.0 identity provider output messages be as similar toohello provided sample traces as possible.</span></span> <span data-ttu-id="13c48-127">Кроме того используйте значения атрибутов из hello предоставил метаданные Azure AD, где это возможно.</span><span class="sxs-lookup"><span data-stu-id="13c48-127">Also, use specific attribute values from hello supplied Azure AD metadata where possible.</span></span> <span data-ttu-id="13c48-128">После ввода требуемых выходных сообщений можно проверить с помощью анализатора подключений Майкрософт hello как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="13c48-128">Once you are happy with your output messages, you can test with hello Microsoft Connectivity Analyzer as described below.</span></span>

<span data-ttu-id="13c48-129">метаданные Hello Azure AD можно загрузить на этот URL-адрес: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="13c48-129">hello Azure AD metadata can be downloaded from this URL: [https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml](http://https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml).</span></span>
<span data-ttu-id="13c48-130">Можно использовать для клиентов в Китае, используя hello Китая экземпляр Office 365, следующая конечная точка федерации hello: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span><span class="sxs-lookup"><span data-stu-id="13c48-130">For customers in China using hello China-specific instance of Office 365, hello following federation endpoint should be used: [https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml](https://nexus.partner.microsoftonline-p.cn/federationmetadata/saml20/federationmetadata.xml).</span></span>

## <a name="saml-protocol-requirements"></a><span data-ttu-id="13c48-131">Требования к протоколу SAML</span><span class="sxs-lookup"><span data-stu-id="13c48-131">SAML protocol requirements</span></span>
<span data-ttu-id="13c48-132">Этот раздел описывает как hello пар сообщений запросов и ответов, объединить в порядке toohelp вы tooformat сообщений правильно.</span><span class="sxs-lookup"><span data-stu-id="13c48-132">This section details how hello request and response message pairs are put together in order toohelp you tooformat your messages correctly.</span></span>

<span data-ttu-id="13c48-133">Azure AD может быть настроенный toowork с поставщиками удостоверений, использующими профиль SAML 2.0 SP Lite hello предъявляется ряд особых требований, указанных ниже.</span><span class="sxs-lookup"><span data-stu-id="13c48-133">Azure AD can be configured toowork with identity providers that use hello SAML 2.0 SP Lite profile with some specific requirements as listed below.</span></span> <span data-ttu-id="13c48-134">Используя образец SAML запроса и ответного сообщения приветствия вместе с автоматическим и ручным тестированием, вы можете работать tooachieve взаимодействие с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-134">Using hello sample SAML request and response messages along with automated and manual testing, you can work tooachieve interoperability with Azure AD.</span></span>

## <a name="signature-block-requirements"></a><span data-ttu-id="13c48-135">Требования к блоку подписи</span><span class="sxs-lookup"><span data-stu-id="13c48-135">Signature block requirements</span></span>
<span data-ttu-id="13c48-136">В пределах hello ответ SAML узел Signature сообщение hello содержит сведения о hello цифровая подпись для само сообщение hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-136">Within hello SAML Response message hello Signature node contains information about hello digital signature for hello message itself.</span></span> <span data-ttu-id="13c48-137">Hello блоку подписи предъявляются следующие требования к hello:</span><span class="sxs-lookup"><span data-stu-id="13c48-137">hello signature block has hello following requirements:</span></span>

1. <span data-ttu-id="13c48-138">Hello узел утверждения должен быть подписан</span><span class="sxs-lookup"><span data-stu-id="13c48-138">hello assertion node itself must be signed</span></span>
2.  <span data-ttu-id="13c48-139">как hello DigestMethod необходимо использовать алгоритм RSA-sha1 Hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-139">hello RSA-sha1 algorithm must be used as hello DigestMethod.</span></span> <span data-ttu-id="13c48-140">Другие алгоритмы цифровой подписи не допускаются.</span><span class="sxs-lookup"><span data-stu-id="13c48-140">Other digital signature algorithms are not accepted.</span></span>
   `<ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>`
3.  <span data-ttu-id="13c48-141">Также можно подписать hello XML-документа.</span><span class="sxs-lookup"><span data-stu-id="13c48-141">You may also sign hello XML document.</span></span> 
4.  <span data-ttu-id="13c48-142">Hello алгоритм преобразования должна соответствовать значениям hello в следующий образец hello:`<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span><span class="sxs-lookup"><span data-stu-id="13c48-142">hello Transform Algorithm must match hello values in hello following sample:    `<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
       <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>`</span></span>
9.  <span data-ttu-id="13c48-143">Алгоритм SignatureMethod Hello должны совпадать следующие образец hello:`<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span><span class="sxs-lookup"><span data-stu-id="13c48-143">hello SignatureMethod Algorithm must match hello following sample:   `<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>`</span></span>

## <a name="supported-bindings"></a><span data-ttu-id="13c48-144">Поддерживаемые привязки</span><span class="sxs-lookup"><span data-stu-id="13c48-144">Supported bindings</span></span>
<span data-ttu-id="13c48-145">Привязки-это транспорт hello связанные параметры взаимодействия, которые необходимы.</span><span class="sxs-lookup"><span data-stu-id="13c48-145">Bindings are hello transport related communications parameters that are required.</span></span> <span data-ttu-id="13c48-146">Привет, следующие требования применяются toohello привязки</span><span class="sxs-lookup"><span data-stu-id="13c48-146">hello following requirements apply toohello bindings</span></span>

1. <span data-ttu-id="13c48-147">HTTPS-transport необходимые hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-147">HTTPS is hello required transport.</span></span>
2.  <span data-ttu-id="13c48-148">Службе Azure AD потребуется запрос HTTP POST для отправки токена во время входа.</span><span class="sxs-lookup"><span data-stu-id="13c48-148">Azure AD will require HTTP POST for token submission during logon</span></span>
3.  <span data-ttu-id="13c48-149">Azure AD будет использовать HTTP POST для поставщика удостоверений toohello запрос проверки подлинности hello и ПЕРЕНАПРАВЛЕНИЯ для выхода из системы сообщение hello toohello-поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="13c48-149">Azure AD will use HTTP POST for hello authentication request toohello identity provider and REDIRECT for hello Logoff message toohello identity provider.</span></span>

## <a name="required-attributes"></a><span data-ttu-id="13c48-150">Требуемые атрибуты</span><span class="sxs-lookup"><span data-stu-id="13c48-150">Required attributes</span></span>
<span data-ttu-id="13c48-151">В этой таблице перечислены требования к для атрибутов в сообщение hello SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-151">This table shows requirements for specific attributes in hello SAML 2.0 message.</span></span>
 
|<span data-ttu-id="13c48-152">Атрибут</span><span class="sxs-lookup"><span data-stu-id="13c48-152">Attribute</span></span>|<span data-ttu-id="13c48-153">Описание</span><span class="sxs-lookup"><span data-stu-id="13c48-153">Description</span></span>|
| ----- | ----- |
|<span data-ttu-id="13c48-154">NameID</span><span class="sxs-lookup"><span data-stu-id="13c48-154">NameID</span></span>|<span data-ttu-id="13c48-155">значение этого утверждения Hello должен hello совпадает с идентификатором ImmutableID пользователя hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-155">hello value of this assertion must be hello same as hello Azure AD user’s ImmutableID.</span></span> <span data-ttu-id="13c48-156">Возможность ее too64 буквенно-цифровые символы.</span><span class="sxs-lookup"><span data-stu-id="13c48-156">It can be up too64 alpha numeric characters.</span></span> <span data-ttu-id="13c48-157">Все небезопасные символы HTML должны кодироваться, например, символ "+" должен быть представлен как ".2B".</span><span class="sxs-lookup"><span data-stu-id="13c48-157">Any non HTML safe characters must be encoded, for example a “+” character is shown as “.2B”.</span></span>|
|<span data-ttu-id="13c48-158">IDPEmail</span><span class="sxs-lookup"><span data-stu-id="13c48-158">IDPEmail</span></span>|<span data-ttu-id="13c48-159">Hello имя участника пользователя (UPN) указан в hello SAML ответа как элемент с hello именем IDPEmail это — UserPrincipalName hello пользователя (UPN) в Azure AD и Office 365.</span><span class="sxs-lookup"><span data-stu-id="13c48-159">hello User Principal Name (UPN) is listed in hello SAML response as an element with hello name IDPEmail This is hello user’s UserPrincipalName (UPN) in Azure AD/Office 365.</span></span> <span data-ttu-id="13c48-160">Hello имени участника-пользователя находится в формате адреса электронной почты.</span><span class="sxs-lookup"><span data-stu-id="13c48-160">hello UPN is in email address format.</span></span> <span data-ttu-id="13c48-161">Значение UPN в Windows Office 365 (Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="13c48-161">UPN value in Windows Office 365 (Azure Active Directory).</span></span>|
|<span data-ttu-id="13c48-162">Издатель</span><span class="sxs-lookup"><span data-stu-id="13c48-162">Issuer</span></span>|<span data-ttu-id="13c48-163">Это обязательный toobe URI поставщика удостоверений hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-163">This is required toobe a URI of hello identity provider.</span></span> <span data-ttu-id="13c48-164">Не следует использовать hello издателя из образцов сообщений hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-164">You should not reuse hello Issuer from hello sample messages.</span></span> <span data-ttu-id="13c48-165">При наличии нескольких доменов верхнего уровня в вашей Issuer должно совпадать с приветствия клиентов Azure AD hello указанного URI, настроенным для домена.</span><span class="sxs-lookup"><span data-stu-id="13c48-165">If you have multiple top-level domains in your Azure AD tenants hello Issuer must match hello specified URI setting configured per domain.</span></span>|

>[!IMPORTANT]
><span data-ttu-id="13c48-166">В настоящее время Azure AD поддерживает следующие URI формат идентификатора имени для SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid hello-формат: постоянно.</span><span class="sxs-lookup"><span data-stu-id="13c48-166">Azure AD currently supports hello following NameID Format URI for SAML 2.0:urn:oasis:names:tc:SAML:2.0:nameid-format:persistent.</span></span>

## <a name="sample-saml-request-and-response-messages"></a><span data-ttu-id="13c48-167">Примеры сообщений SAML с запросом и ответом</span><span class="sxs-lookup"><span data-stu-id="13c48-167">Sample SAML request and response messages</span></span>
<span data-ttu-id="13c48-168">Для обмена сообщениями входа hello показан пару сообщений запросов и ответов.</span><span class="sxs-lookup"><span data-stu-id="13c48-168">A request and response message pair is shown for hello sign-on message exchange.</span></span>
<span data-ttu-id="13c48-169">Это пример сообщения с запросом, полученном от поставщика удостоверений SAML 2.0 образец tooa Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-169">This is a sample request message that is sent from Azure AD tooa sample SAML 2.0 identity provider.</span></span> <span data-ttu-id="13c48-170">Службы федерации Active Directory (AD FS) настроен протокол SAML-P toouse является поставщиком удостоверений SAML 2.0 Образец Hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-170">hello sample SAML 2.0 identity provider is Active Directory Federation Services (AD FS) configured toouse SAML-P protocol.</span></span> <span data-ttu-id="13c48-171">Тестирование взаимодействия было выполнено и для других поставщиков удостоверений SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-171">Interoperability testing has also been completed with other SAML 2.0 identity providers.</span></span>

    `<samlp:AuthnRequest xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" ID="_7171b0b2-19f2-4ba2-8f94-24b5e56b7f1e" IssueInstant="2014-01-30T16:18:35Z" Version="2.0" AssertionConsumerServiceIndex="0" >
    <saml:Issuer>urn:federation:MicrosoftOnline</saml:Issuer>
    <samlp:NameIDPolicy Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"/>
    </samlp:AuthnRequest>`

<span data-ttu-id="13c48-172">Это пример сообщения ответа, полученном от поставщика удостоверений, совместимым tooAzure AD hello образец SAML 2.0 и Office 365.</span><span class="sxs-lookup"><span data-stu-id="13c48-172">This is a sample response message that is sent from hello sample SAML 2.0 compliant identity provider tooAzure AD / Office 365.</span></span>

    `<samlp:Response ID="_592c022f-e85e-4d23-b55b-9141c95cd2a5" Version="2.0" IssueInstant="2014-01-31T15:36:31.357Z" Destination="https://login.microsoftonline.com/login.srf" Consent="urn:oasis:names:tc:SAML:2.0:consent:unspecified" InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <Issuer xmlns="urn:oasis:names:tc:SAML:2.0:assertion">http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <samlp:Status>
    <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success" />
    </samlp:Status>
    <Assertion ID="_7e3c1bcd-f180-4f78-83e1-7680920793aa" IssueInstant="2014-01-31T15:36:31.279Z" Version="2.0" xmlns="urn:oasis:names:tc:SAML:2.0:assertion">
    <Issuer>http://WS2012R2-0.contoso.com/adfs/services/trust</Issuer>
    <ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
      <ds:SignedInfo>
        <ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
        <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
        <ds:Reference URI="#_7e3c1bcd-f180-4f78-83e1-7680920793aa">
          <ds:Transforms>
            <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
            <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
          </ds:Transforms>
          <ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
          <ds:DigestValue>CBn/5YqbheaJP425c0pHva9PhNY=</ds:DigestValue>
        </ds:Reference>
      </ds:SignedInfo>
      <ds:SignatureValue>TciWMyHW2ZODrh/2xrvp5ggmcHBFEd9vrp6DYXp+hZWJzmXMmzwmwS8KNRJKy8H7XqBsdELA1Msqi8I3TmWdnoIRfM/ZAyUppo8suMu6Zw+boE32hoQRnX9EWN/f0vH6zA/YKTzrjca6JQ8gAV1ErwvRWDpyMcwdYCiWALv9ScbkAcebOE1s1JctZ5RBXggdZWrYi72X+I4i6WgyZcIGai/rZ4v2otoWAEHS0y1yh1qT7NDPpl/McDaTGkNU6C+8VfjD78DrUXEcAfKvPgKlKrOMZnD1lCGsViimGY+LSuIdY45MLmyaa5UT4KWph6dA==</ds:SignatureValue>
      <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
        <ds:X509Data>
          <ds:X509Certificate>MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyhBREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDTE1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9ybWVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/+3ZWxd9T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEMb2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvyJOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBySx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==</ds:X509Certificate>
        </ds:X509Data>
      </KeyInfo>
    </ds:Signature>
    <Subject>
      <NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">ABCDEG1234567890</NameID>
      <SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
        <SubjectConfirmationData InResponseTo="_049917a6-1183-42fd-a190-1d2cbaf9b144" NotOnOrAfter="2014-01-31T15:41:31.357Z" Recipient="https://login.microsoftonline.com/login.srf" />
      </SubjectConfirmation>
    </Subject>
    <Conditions NotBefore="2014-01-31T15:36:31.263Z" NotOnOrAfter="2014-01-31T16:36:31.263Z">
      <AudienceRestriction>
        <Audience>urn:federation:MicrosoftOnline</Audience>
      </AudienceRestriction>
    </Conditions>
    <AttributeStatement>
      <Attribute Name="IDPEmail">
        <AttributeValue>administrator@contoso.com</AttributeValue>
      </Attribute>
    </AttributeStatement>
    <AuthnStatement AuthnInstant="2014-01-31T15:36:30.200Z" SessionIndex="_7e3c1bcd-f180-4f78-83e1-7680920793aa">
      <AuthnContext>
        <AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</AuthnContextClassRef>
      </AuthnContext>
    </AuthnStatement>
    </Assertion>
    </samlp:Response>`

## <a name="configure-your-saml-20-compliant-identity-provider"></a><span data-ttu-id="13c48-173">Настройка поставщика удостоверений, совместимого с SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="13c48-173">Configure your SAML 2.0 compliant identity provider</span></span>
<span data-ttu-id="13c48-174">В этом разделе содержатся рекомендации по как tooconfigure toofederate поставщика удостоверений вашей SAML 2.0, с Azure AD tooenable доступа-tooone или дополнительные Microsoft cloud services (например, Office 365) с помощью протокола hello SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-174">This topic contains guidelines on how tooconfigure your SAML 2.0 identity provider toofederate with Azure AD tooenable single sign-on access tooone or more Microsoft cloud services (such as Office 365) using hello SAML 2.0 protocol.</span></span> <span data-ttu-id="13c48-175">Hello SAML 2.0 проверяющей стороной для облачной службы Майкрософт, используемая в этом сценарии используется Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-175">hello SAML 2.0 relying party for a Microsoft cloud service used in this scenario is Azure AD.</span></span>

## <a name="add-azure-ad-metadata"></a><span data-ttu-id="13c48-176">Добавление метаданных Azure AD</span><span class="sxs-lookup"><span data-stu-id="13c48-176">Add Azure AD metadata</span></span>
<span data-ttu-id="13c48-177">Поставщик удостоверений SAML 2.0 должен tooinformation tooadhere о доверяющей стороны hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-177">Your SAML 2.0 identity provider needs tooadhere tooinformation about hello Azure AD relying party.</span></span> <span data-ttu-id="13c48-178">Azure AD публикует метаданные в https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span><span class="sxs-lookup"><span data-stu-id="13c48-178">Azure AD publishes metadata at https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml.</span></span>

<span data-ttu-id="13c48-179">Рекомендуется всегда импортировать метаданные hello последнюю Azure AD при настройке поставщика удостоверений SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-179">It is recommended that you always import hello latest Azure AD metadata when configuring your SAML 2.0 identity provider.</span></span> <span data-ttu-id="13c48-180">Обратите внимание, что Azure AD не считывает метаданные от поставщика удостоверений hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-180">Note that Azure AD does not read metadata from hello identity provider.</span></span>

## <a name="add-azure-ad-as-a-relying-party"></a><span data-ttu-id="13c48-181">Добавление Azure AD в качестве проверяющей стороны</span><span class="sxs-lookup"><span data-stu-id="13c48-181">Add Azure AD as a relying party</span></span>
<span data-ttu-id="13c48-182">У вас есть tooenable обмен данными между поставщиком удостоверений SAML 2.0 и Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-182">You have tooenable communication between your SAML 2.0 identity provider and Azure AD.</span></span> <span data-ttu-id="13c48-183">Эта конфигурация будет зависеть от используемого поставщика удостоверений, и вы должны обращаться toodocumentation для него.</span><span class="sxs-lookup"><span data-stu-id="13c48-183">This configuration will be dependent on your specific identity provider and you should refer toodocumentation for it.</span></span> <span data-ttu-id="13c48-184">Hello проверяющей стороной идентификатор toohello обычно задается то же, что entityID hello из метаданных hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-184">You would typically set hello relying party ID toohello same as hello entityID from hello Azure AD metadata.</span></span>

>[!NOTE]
><span data-ttu-id="13c48-185">Проверьте hello часов на сервере поставщика удостоверений SAML 2.0 синхронизированные tooan источника точного времени.</span><span class="sxs-lookup"><span data-stu-id="13c48-185">Verify hello clock on your SAML 2.0 identity provider server is synchronized tooan accurate time source.</span></span> <span data-ttu-id="13c48-186">Неточное время часов может привести к toofail федеративных входов.</span><span class="sxs-lookup"><span data-stu-id="13c48-186">An inaccurate clock time can cause federated logins toofail.</span></span>

## <a name="install-windows-powershell-for-sign-on-with-saml-20-identity-provider"></a><span data-ttu-id="13c48-187">Установка Windows PowerShell для единого входа с помощью поставщика удостоверений SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="13c48-187">Install Windows PowerShell for sign-on with SAML 2.0 identity provider</span></span>
<span data-ttu-id="13c48-188">После настройки поставщика удостоверений SAML 2.0 для использования с входом Azure AD, следующим шагом hello является toodownload и установки hello Azure Active Directory модуля для Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="13c48-188">After you have configured your SAML 2.0 identity provider for use with Azure AD sign-on, hello next step is toodownload and install hello Azure Active Directory Module for Windows PowerShell.</span></span> <span data-ttu-id="13c48-189">После установки будет использовать эти командлеты tooconfigure доменов Azure AD в качестве федеративных доменов.</span><span class="sxs-lookup"><span data-stu-id="13c48-189">Once installed, you will use these cmdlets tooconfigure your Azure AD domains as federated domains.</span></span>

<span data-ttu-id="13c48-190">Hello Azure Active Directory модуля для Windows PowerShell можно загрузить для управления данными организации в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-190">hello Azure Active Directory Module for Windows PowerShell is a download for managing your organizations data in Azure AD.</span></span> <span data-ttu-id="13c48-191">Этот модуль устанавливает набор командлетов tooWindows PowerShell; выполнить эти командлеты tooset копирование tooAzure единого входа для доступа к AD и в свою очередь tooall из hello облачных служб, которые вы подписаны.</span><span class="sxs-lookup"><span data-stu-id="13c48-191">This module installs a set of cmdlets tooWindows PowerShell; you run those cmdlets tooset up single sign-on access tooAzure AD and in turn tooall of hello cloud services you are subscribed to.</span></span> <span data-ttu-id="13c48-192">Инструкции о hello как toodownload и установка командлетов см. [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span><span class="sxs-lookup"><span data-stu-id="13c48-192">For instructions about how toodownload and install hello cmdlets, see [http://technet.microsoft.com/library/jj151815.aspx](http://technet.microsoft.com/library/jj151815.aspx)</span></span>

## <a name="set-up-a-trust-between-your-saml-identity-provider-and-azure-ad"></a><span data-ttu-id="13c48-193">Настройка отношения доверия между поставщиком удостоверений SAML и Azure AD</span><span class="sxs-lookup"><span data-stu-id="13c48-193">Set up a trust between your SAML identity provider and Azure AD</span></span>
<span data-ttu-id="13c48-194">Перед настройкой федерации в домене Azure AD в нем должен быть настроен личный домен.</span><span class="sxs-lookup"><span data-stu-id="13c48-194">Before configuring federation on an Azure AD domain, it must have a custom domain configured.</span></span> <span data-ttu-id="13c48-195">Не удается создать федерацию домен по умолчанию hello, предоставляемой корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="13c48-195">You cannot federate hello default domain that is provided by Microsoft.</span></span> <span data-ttu-id="13c48-196">домен по умолчанию Hello корпорации Майкрософт заканчивается на «onmicrosoft.com».</span><span class="sxs-lookup"><span data-stu-id="13c48-196">hello default domain from Microsoft ends with “onmicrosoft.com”.</span></span>
<span data-ttu-id="13c48-197">Необходимо выполнить ряд командлетов в tooadd интерфейс командной строки Windows PowerShell hello или преобразовать домены для единого входа.</span><span class="sxs-lookup"><span data-stu-id="13c48-197">You will run a series of cmdlets in hello Windows PowerShell command-line interface tooadd or convert domains for single sign-on.</span></span>

<span data-ttu-id="13c48-198">Каждый домен Azure Active Directory, который вы хотите toofederate с помощью поставщика удостоверений SAML 2.0 необходимо выполнить одно из быть добавлен как домен единого входа или преобразованное toobe домен единого входа из стандартного домена.</span><span class="sxs-lookup"><span data-stu-id="13c48-198">Each Azure Active Directory domain that you want toofederate using your SAML 2.0 identity provider must either be added as a single sign-on domain or converted toobe a single sign-on domain from a standard domain.</span></span> <span data-ttu-id="13c48-199">При добавлении или преобразовании домена между поставщиком удостоверений SAML 2.0 и Azure AD настраивается отношение доверия.</span><span class="sxs-lookup"><span data-stu-id="13c48-199">Adding or converting a domain sets up a trust between your SAML 2.0 identity provider and Azure AD.</span></span>

<span data-ttu-id="13c48-200">Hello следующая процедура поможет выполнить преобразование существующего стандартного домена tooa федеративного домена с помощью SAML 2.0 SP-Lite.</span><span class="sxs-lookup"><span data-stu-id="13c48-200">hello following procedure walks you through converting an existing standard domain tooa federated domain using SAML 2.0 SP-Lite.</span></span> <span data-ttu-id="13c48-201">Обратите внимание, что домен может стать сбоя, оказывает влияние на пользователей too2 часов после выполнения этого действия.</span><span class="sxs-lookup"><span data-stu-id="13c48-201">Note that your domain may experience an outage that impacts users up too2 hours after you take this step.</span></span>

## <a name="configuring-a-domain-in-your-azure-ad-directory-for-federation"></a><span data-ttu-id="13c48-202">Настройка домена в каталоге Azure AD для федерации</span><span class="sxs-lookup"><span data-stu-id="13c48-202">Configuring a domain in your Azure AD Directory for federation</span></span>


1. <span data-ttu-id="13c48-203">Tooyour каталог Azure AD администратор клиента подключения: подключение MsolService.</span><span class="sxs-lookup"><span data-stu-id="13c48-203">Connect tooyour Azure AD Directory as a tenant administrator: Connect-MsolService .</span></span>
2.  <span data-ttu-id="13c48-204">Настройка федерации toouse требуемый домен Office 365 с SAML 2.0:`$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span><span class="sxs-lookup"><span data-stu-id="13c48-204">Configure your desired Office 365 domain toouse federation with SAML 2.0: `$dom = "contoso.com" $BrandName - "Sample SAML 2.0 IDP" $LogOnUrl = "https://WS2012R2-0.contoso.com/passiveLogon" $LogOffUrl = "https://WS2012R2-0.contoso.com/passiveLogOff" $ecpUrl = "https://WS2012R2-0.contoso.com/PAOS" $MyURI = "urn:uri:MySamlp2IDP" $MySigningCert = @" MIIC7jCCAdagAwIBAgIQRrjsbFPaXIlOG3GTv50fkjANBgkqhkiG9w0BAQsFADAzMTEwLwYDVQQDEyh BREZTIFNpZ25pbmcgLSBXUzIwMTJSMi0wLnN3aW5mb3JtZXIuY29tMB4XDTE0MDEyMDE1MTY0MFoXDT E1MDEyMDE1MTY0MFowMzExMC8GA1UEAxMoQURGUyBTaWduaW5nIC0gV1MyMDEyUjItMC5zd2luZm9yb WVyLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKe+rLVmXy1QwCwZwqgbbp1/kupQ VcjKuKLitVDbssFyqbDTjP7WRjlVMWAHBI3kgNT7oE362Gf2WMJFf1b0HcrsgLin7daRXpq4Qi6OA57 sW1YFMj3sqyuTP0eZV3S4+ZbDVob6amsZIdIwxaLP9Zfywg2bLsGnVldB0+XKedZwDbCLCVg+3ZWxd9 T/jV0hpLIIWr+LCOHqq8n8beJvlivgLmDJo8f+EITnAxWcsJUvVai/35AhHCUq9tc9sqMp5PWtabAEM b2AU72/QlX/72D2/NbGQq1BWYbqUpgpCZ2nSgvlWDHlCiUo//UGsvfox01kjTFlmqQInsJVfRxF5AcC AwEAATANBgkqhkiG9w0BAQsFAAOCAQEAi8c6C4zaTEc7aQiUgvnGQgCbMZbhUXXLGRpjvFLKaQzkwa9 eq7WLJibcSNyGXBa/SfT5wJgsm3TPKgSehGAOTirhcqHheZyvBObAScY7GOT+u9pVYp6raFrc7ez3c+ CGHeV/tNvy1hJNs12FYH4X+ZCNFIT9tprieR25NCdi5SWUbPZL0tVzJsHc1y92b2M2FxqRDohxQgJvy JOpcg2mSBzZZIkvDg7gfPSUXHVS1MQs0RHSbwq/XdQocUUhl9/e/YWCbNNxlM84BxFsBUok1dH/gzBy Sx+Fc8zYi7cOq9yaBT3RLT6cGmFGVYZJW4FyhPZOCLVNsLlnPQcX3dDg9A==" "@ $uri = "http://WS2012R2-0.contoso.com/adfs/services/trust" $Protocol = "SAMLP" Set-MsolDomainAuthentication -DomainName $dom -FederationBrandName $dom -Authentication Federated -PassiveLogOnUri $MyURI -ActiveLogOnUri $ecpUrl -SigningCertificate $MySigningCert -IssuerUri $uri -LogOffUri $url -PreferredAuthenticationProtocol $Protocol`</span></span> 

3.  <span data-ttu-id="13c48-205">Вы можете получить сертификат подписи в кодировке base64 из файла метаданных IDP hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-205">You can obtain hello signing certificate base64 encoded string from your IDP metadata file.</span></span> <span data-ttu-id="13c48-206">Пример его расположения приведен, но в зависимости от особенностей развертывания оно может быть немного иным.</span><span class="sxs-lookup"><span data-stu-id="13c48-206">An example of this location has been provided but may differ slightly based on your implementation.</span></span>

    `<IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"> <KeyDescriptor use="signing"> <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"> <X509Data> <X509Certificate>MIIC5jCCAc6gAwIBAgIQLnaxUPzay6ZJsC8HVv/QfTANBgkqhkiG9w0BAQsFADAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwHhcNMTMxMTA0MTgxMzMyWhcNMTQxMTA0MTgxMzMyWjAvMS0wKwYDVQQDEyRBREZTIFNpZ25pbmcgLSBmcy50ZWNobGFiY2VudHJhbC5vcmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCwMdVLTr5YTSRp+ccbSpuuFeXMfABD9mVCi2wtkRwC30TIyPdORz642MkurdxdPCWjwgJ0HW6TvXwcO9afH3OC5V//wEGDoNcI8PV4enCzTYFe/h//w51uqyv48Fbb3lEXs+aVl8155OAj2sO9IX64OJWKey82GQWK3g7LfhWWpp17j5bKpSd9DBH5pvrV+Q1ESU3mx71TEOvikHGCZYitEPywNeVMLRKrevdWI3FAhFjcCSO6nWDiMqCqiTDYOURXIcHVYTSof1YotkJ4tG6mP5Kpjzd4VQvnR7Pjb47nhIYG6iZ3mR1F85Ns9+hBWukQWNN2hcD/uGdPXhpdMVpBAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAK7h7jF7wPzhZ1dPl4e+XMAr8I7TNbhgEU3+oxKyW/IioQbvZVw1mYVCbGq9Rsw4KE06eSMybqHln3w5EeBbLS0MEkApqHY+p68iRpguqa+W7UHKXXQVgPMCpqxMFKonX6VlSQOR64FgpBme2uG+LJ8reTgypEKspQIN0WvtPWmiq4zAwBp08hAacgv868c0MM4WbOYU0rzMIR6Q+ceGVRImlCwZ5b7XKp4mJZ9hlaRjeuyVrDuzBkzROSurX1OXoci08yJvhbtiBJLf3uPOJHrhjKRwIt2TnzS9ElgFZlJiDIA26Athe73n43CT0af2IG6yC7e6sK4L3NEXJrwwUZk=</X509Certificate> </X509Data> </KeyInfo> </KeyDescriptor>` 

<span data-ttu-id="13c48-207">Дополнительные сведения о командлете Set-MsolDomainAuthentication см. на странице по адресу: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span><span class="sxs-lookup"><span data-stu-id="13c48-207">For more information about “Set-MsolDomainAuthentication”, see: [http://technet.microsoft.com/library/dn194112.aspx](http://technet.microsoft.com/library/dn194112.aspx).</span></span>

>[!NOTE]
><span data-ttu-id="13c48-208">Использовать атрибут "$ecpUrl = "https://WS2012R2-0.contoso.com/PAOS"" следует только в том случае, если для поставщика удостоверений настраивается расширение ECP.</span><span class="sxs-lookup"><span data-stu-id="13c48-208">You must run use “$ecpUrl = “https://WS2012R2-0.contoso.com/PAOS“” only if you set up an ECP extension for your identity provider.</span></span> <span data-ttu-id="13c48-209">Клиенты Exchange Online, исключая Outlook Web Application (OWA), используют активную конечную точку на основе метода POST.</span><span class="sxs-lookup"><span data-stu-id="13c48-209">Exchange Online clients, excluding Outlook Web Application (OWA), rely on a POST based active end point.</span></span> <span data-ttu-id="13c48-210">Если служба маркеров безопасности SAML 2.0 реализует активную конечную точку как tooShibboleth ECP реализации активной конечной точки может быть возможно, что эти клиенты с расширенными возможностями toointeract с hello службой Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="13c48-210">If your SAML 2.0 STS implements an active end point similar tooShibboleth’s ECP implementation of an active end point it may be possible for these rich clients toointeract with hello Exchange Online service.</span></span>

<span data-ttu-id="13c48-211">После настройки федерации можно переключиться назад слишком «нефедеративных» (или «managed»), однако это изменение будет занимать toocomplete tootwo часов, а также требуется назначить новый случайный пароль для облака на основе tooeach входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="13c48-211">Once federation has been configured you can switch back too“non-federated” (or “managed”), however this change takes up tootwo hours toocomplete and it requires assigning new random passwords for cloud based sign-in tooeach user.</span></span> <span data-ttu-id="13c48-212">Обратное переключение слишком «managed» может быть требуется в некоторых сценариях tooreset ошибка в параметрах настройки.</span><span class="sxs-lookup"><span data-stu-id="13c48-212">Switching back too“managed” may be required in some scenarios tooreset an error in your settings.</span></span> <span data-ttu-id="13c48-213">Дополнительные сведения о преобразовании домена см. на странице по адресу: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span><span class="sxs-lookup"><span data-stu-id="13c48-213">For more information on Domain conversion see: [http://msdn.microsoft.com/library/windowsazure/dn194122.aspx](http://msdn.microsoft.com/library/windowsazure/dn194122.aspx).</span></span>

## <a name="provision-user-principals-tooazure-ad--office-365"></a><span data-ttu-id="13c48-214">Подготовить tooAzure участников пользователя AD и Office 365</span><span class="sxs-lookup"><span data-stu-id="13c48-214">Provision user principals tooAzure AD / Office 365</span></span>
<span data-ttu-id="13c48-215">Прежде чем входить на пользователей tooOffice 365 Azure AD необходимо подготовить для участников, которые соответствуют toohello утверждению в SAML 2.0 hello утверждения пользователя.</span><span class="sxs-lookup"><span data-stu-id="13c48-215">Before you can authenticate your users tooOffice 365 you must provision Azure AD with user principals that correspond toohello assertion in hello SAML 2.0 claim.</span></span> <span data-ttu-id="13c48-216">Если эти субъекты-пользователи не известны заранее tooAzure AD их нельзя использовать для федеративного входа в систему.</span><span class="sxs-lookup"><span data-stu-id="13c48-216">If these user principals are not known tooAzure AD in advance then they cannot be used for federated sign-in.</span></span> <span data-ttu-id="13c48-217">Azure AD Connect или Windows PowerShell можно использовать tooprovision участников-пользователей.</span><span class="sxs-lookup"><span data-stu-id="13c48-217">Either Azure AD Connect or Windows PowerShell can be used tooprovision user principals.</span></span>

<span data-ttu-id="13c48-218">Azure AD Connect можно используется tooprovision участников tooyour доменах в каталоге Azure AD из hello локальной Active Directory.</span><span class="sxs-lookup"><span data-stu-id="13c48-218">Azure AD Connect can be used tooprovision principals tooyour domains in your Azure AD Directory from hello on-premises Active Directory.</span></span> <span data-ttu-id="13c48-219">Дополнительные сведения см. в статье [Интеграция локальных каталогов с Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="13c48-219">For more detailed information, see [Integrate your on-premises directories with Azure Active Directory](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="13c48-220">Windows PowerShell также можно использовать tooautomate, добавление новых пользователей tooAzure AD и toosynchronize меняется с локальным каталогом hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-220">Windows PowerShell can also be used tooautomate adding new users tooAzure AD and toosynchronize changes from hello on-premises directory.</span></span> <span data-ttu-id="13c48-221">hello toouse командлеты Windows PowerShell, необходимо загрузить hello [модули Azure Active Directory](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span><span class="sxs-lookup"><span data-stu-id="13c48-221">toouse hello Windows PowerShell cmdlets you must download hello [Azure Active Directory Modules](https://docs.microsoft.com/powershell/azure/install-adv2?view=azureadps-2.0).</span></span>

<span data-ttu-id="13c48-222">Эта процедура показывает, как tooadd tooAzure одного пользователя AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-222">This procedure shows how tooadd a single user tooAzure AD.</span></span>


1. <span data-ttu-id="13c48-223">Tooyour каталог Azure AD администратор клиента подключения: подключение MsolService.</span><span class="sxs-lookup"><span data-stu-id="13c48-223">Connect tooyour Azure AD Directory as a tenant administrator: Connect-MsolService.</span></span>
2.  <span data-ttu-id="13c48-224">Создайте субъекта-пользователя: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
        -ImmutableId ABCDEFG1234567890
        -DisplayName "Elwood Folk"
        -FirstName Elwood 
        -LastName Folk 
        -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
        -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
        -UsageLocation "US" `</span><span class="sxs-lookup"><span data-stu-id="13c48-224">Create a new user principal: ` New-MsolUser
        -UserPrincipalName elwoodf1@contoso.com
    -ImmutableId ABCDEFG1234567890
    -DisplayName "Elwood Folk"
    -FirstName Elwood 
    -LastName Folk 
    -AlternateEmailAddresses "Elwood.Folk@contoso.com" 
    -LicenseAssignment "samlp2test:ENTERPRISEPACK" 
    -UsageLocation "US" `</span></span> 

<span data-ttu-id="13c48-225">Дополнительные сведения о командлете New-MsolUser см. на странице по адресу: [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx).</span><span class="sxs-lookup"><span data-stu-id="13c48-225">For more information about “New-MsolUser” check out, [http://technet.microsoft.com/library/dn194096.aspx](http://technet.microsoft.com/library/dn194096.aspx)</span></span>

>[!NOTE]
><span data-ttu-id="13c48-226">Здравствуйте, «UserPrinciplName» значение должно соответствовать значение hello, которое будет отправляться для атрибута «IDPEmail» в утверждении SAML 2.0 и hello «ImmutableID» значение должно соответствовать значение hello, отправляемый в утверждение «NameID».</span><span class="sxs-lookup"><span data-stu-id="13c48-226">hello “UserPrinciplName” value must match hello value that you will send for “IDPEmail” in your SAML 2.0 claim and hello “ImmutableID” value must match hello value sent in your “NameID” assertion.</span></span>

## <a name="verify-single-sign-on-with-your-saml-20-idp"></a><span data-ttu-id="13c48-227">Проверка единого входа с помощью поставщика удостоверений SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="13c48-227">Verify single sign-on with your SAML 2.0 IDP</span></span>
<span data-ttu-id="13c48-228">Администратор hello перед проверкой и управления единым входом (также называемого федерацией удостоверений), просмотрите сведения hello и выполните действия hello в hello следующие статьи tooset копирование единого входа с помощью поставщика удостоверений на основе SAML 2.0 SP-Lite.</span><span class="sxs-lookup"><span data-stu-id="13c48-228">As hello administrator, before you verify and manage single sign-on (also called identity federation), review hello information and perform hello steps in hello following articles tooset up single sign-on with your SAML 2.0 SP-Lite based identity provider:</span></span>


1.  <span data-ttu-id="13c48-229">После знакомства с hello требования к протоколу Azure AD SAML 2.0</span><span class="sxs-lookup"><span data-stu-id="13c48-229">You have reviewed hello Azure AD SAML 2.0 Protocol Requirements</span></span>
2.  <span data-ttu-id="13c48-230">Настройки поставщика удостоверений SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-230">You have configured your SAML 2.0 identity provider</span></span>
3.  <span data-ttu-id="13c48-231">Установка Windows PowerShell для единого входа с помощью поставщика удостоверений SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-231">Install Windows PowerShell for single sign-on with SAML 2.0 identity provider</span></span>
4.  <span data-ttu-id="13c48-232">Настройка отношения доверия между поставщиком удостоверений SAML 2.0 и Azure AD.</span><span class="sxs-lookup"><span data-stu-id="13c48-232">Set up a trust between SAML 2.0 identity provider and Azure AD</span></span>
5.  <span data-ttu-id="13c48-233">Подготовить основной tooAzure каталога пользователя тестового Active Directory (Office 365) через Windows PowerShell или Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="13c48-233">Provisioned a known test user principal tooAzure Active Directory (Office 365) either through Windows PowerShell or Azure AD Connect.</span></span>
6.  <span data-ttu-id="13c48-234">Настройка синхронизации каталогов с помощью [Azure AD Connect](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="13c48-234">Configure directory synchronization using [Azure AD Connect](active-directory-aadconnect.md).</span></span>

<span data-ttu-id="13c48-235">После настройки единого входа с помощью поставщика удостоверений на основе SAML 2.0 SP-Lite следует проверить, правильно ли он работает.</span><span class="sxs-lookup"><span data-stu-id="13c48-235">After setting up single sign-on with your SAML 2.0 SP-Lite based identity Provider, you should verify that it is working correctly.</span></span>

>[!NOTE]
><span data-ttu-id="13c48-236">Если был преобразован в домен, а не добавлен, может занять tooset часы too24 копирование единого входа.</span><span class="sxs-lookup"><span data-stu-id="13c48-236">If you converted a domain, rather than adding one, it may take up too24 hours tooset up single sign-on.</span></span>
<span data-ttu-id="13c48-237">Перед проверкой единого входа следует завершить настройку синхронизации Active Directory, синхронизировать каталоги и активировать синхронизированных пользователей.</span><span class="sxs-lookup"><span data-stu-id="13c48-237">Before you verify single sign-on, you should finish setting up Active Directory synchronization, synchronize your directories, and activate your synced users.</span></span>

### <a name="use-hello-tool-tooverify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="13c48-238">Используйте hello средство tooverify, единый вход настроен неправильно</span><span class="sxs-lookup"><span data-stu-id="13c48-238">Use hello tool tooverify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="13c48-239">tooverify, единый вход настроен правильно, можно выполнить следующие tooconfirm процедуры, которые могут toosign в toohello облачной службе с помощью корпоративных учетных данных hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-239">tooverify that single sign-on has been set up correctly, you can perform hello following procedure tooconfirm that you are able toosign in toohello cloud service with your corporate credentials.</span></span>

<span data-ttu-id="13c48-240">Корпорация Майкрософт предоставляет средства, которые можно использовать tootest SAML 2.0 на основе поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="13c48-240">Microsoft has provided a tool that you can use tootest your SAML 2.0 based identity provider.</span></span> <span data-ttu-id="13c48-241">Перед запуском hello тестирования инструмент, необходимо настроить toofederate клиента Azure AD с поставщиком удостоверений.</span><span class="sxs-lookup"><span data-stu-id="13c48-241">Before running hello test tool you must have configured an Azure AD tenant toofederate with your identity provider.</span></span>

>[!NOTE]
><span data-ttu-id="13c48-242">Hello анализатора подключений требуется Internet Explorer 10 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="13c48-242">hello Connectivity Analyzer requires Internet Explorer 10 or later.</span></span>



1. <span data-ttu-id="13c48-243">Загрузка hello анализатор подключений, [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span><span class="sxs-lookup"><span data-stu-id="13c48-243">Download hello Connectivity Analyzer from, [https://testconnectivity.microsoft.com/?tabid=Client](https://testconnectivity.microsoft.com/?tabid=Client).</span></span>
2.  <span data-ttu-id="13c48-244">Нажмите кнопку Установить сейчас toobegin Загрузка и установка средства hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-244">Click Install Now toobegin downloading and installing hello tool.</span></span>
3.  <span data-ttu-id="13c48-245">Выберите пункт "Не удается настроить федерацию с Office 365, Azure или другими службами, использующими Azure Active Directory".</span><span class="sxs-lookup"><span data-stu-id="13c48-245">Select “I can’t set up federation with Office 365, Azure, or other services that use Azure Active Directory”.</span></span>
4.  <span data-ttu-id="13c48-246">После загрузки и запуска средства hello, вы увидите окно диагностики подключения hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-246">Once hello tool is downloaded and running, you will see hello Connectivity Diagnostics window.</span></span> <span data-ttu-id="13c48-247">Hello средство предоставляет пошаговые инструкции по тестированию подключения федерации.</span><span class="sxs-lookup"><span data-stu-id="13c48-247">hello tool will step you through testing your federation connection.</span></span>
5.  <span data-ttu-id="13c48-248">Hello анализатор подключений будет открыть поставщика Удостоверений SAML 2.0 вы toologon, введите учетные данные hello hello тестировании участника-пользователя: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span><span class="sxs-lookup"><span data-stu-id="13c48-248">hello Connectivity Analyzer will open your SAML 2.0 IDP for you toologon, enter hello credentials for hello user principal you are testing: ![SAML](media/active-directory-aadconnect-federation-saml-idp/saml1.png)</span></span>
6.  <span data-ttu-id="13c48-249">По hello федерации Проверьте в окне входа следует ввести имя пользователя и пароль для клиента Azure AD hello, настроенных toobe федерации с поставщиком удостоверений SAML 2.0.</span><span class="sxs-lookup"><span data-stu-id="13c48-249">At hello Federation test sign-in window you should enter an account name and password for hello Azure AD tenant that is configured toobe federated with your SAML 2.0 identity provider.</span></span> <span data-ttu-id="13c48-250">Средство Hello попытается toosign в с использованием этих учетных данных и подробные результаты тестов, выполненных во время попытки входа hello будут представлены в виде выходных данных.</span><span class="sxs-lookup"><span data-stu-id="13c48-250">hello tool will attempt toosign-in using those credentials and detailed results of tests performed during hello sign-in attempt will be provided as output.</span></span>
<span data-ttu-id="13c48-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span><span class="sxs-lookup"><span data-stu-id="13c48-251">![SAML](media/active-directory-aadconnect-federation-saml-idp/saml2.png)</span></span>
7. <span data-ttu-id="13c48-252">В этом окне показано, что тест не пройден.</span><span class="sxs-lookup"><span data-stu-id="13c48-252">This window shows a failed result of testing.</span></span> <span data-ttu-id="13c48-253">Щелкнув просмотрите подробные результаты можно просмотреть сведения о hello результаты для каждого выполненного теста.</span><span class="sxs-lookup"><span data-stu-id="13c48-253">Clicking on Review detailed results will show information about hello results for each test that was performed.</span></span> <span data-ttu-id="13c48-254">Можно также сохранить результаты toodisk hello в порядке tooshare их.</span><span class="sxs-lookup"><span data-stu-id="13c48-254">You can also save hello results toodisk in order tooshare them.</span></span>
 
>[!NOTE]
><span data-ttu-id="13c48-255">Hello анализатор подключений также тестирует активную федерацию с помощью hello WS *-протоколы на основе и ECP и PAOS.</span><span class="sxs-lookup"><span data-stu-id="13c48-255">hello Connectivity analyzer also tests Active Federation using hello WS*-based and ECP/PAOS protocols.</span></span> <span data-ttu-id="13c48-256">Если вы не используете можно пренебречь hello следующая ошибка: тестирование hello активного потока входа, с помощью конечной точки активной федерации вашего поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="13c48-256">If you are not using these you can disregard hello following error: Testing hello Active sign-in flow using your identity provider’s Active federation endpoint.</span></span>

### <a name="manually-verify-that-single-sign-on-has-been-set-up-correctly"></a><span data-ttu-id="13c48-257">Проверка правильной настройки единого входа с помощью средства</span><span class="sxs-lookup"><span data-stu-id="13c48-257">Manually verify that single sign-on has been set up correctly</span></span>
<span data-ttu-id="13c48-258">Ручная проверка — это дополнительные действия, которые можно предпринять tooensure, поставщик удостоверений SAML 2.0 работает правильно во многих сценариях.</span><span class="sxs-lookup"><span data-stu-id="13c48-258">Manual verification provides additional steps that you can take tooensure that your SAML 2.0 identity Provider is working properly in many scenarios.</span></span>
<span data-ttu-id="13c48-259">tooverify, единый вход настроен правильно, воспользуйтесь hello следующих шагов:</span><span class="sxs-lookup"><span data-stu-id="13c48-259">tooverify that single sign-on has been set up correctly, complete hello following steps:</span></span>


1. <span data-ttu-id="13c48-260">На компьютере, присоединенном к домену вход tooyour облачной службы, с помощью hello же имя, которое используется для корпоративных учетных данных входа в систему.</span><span class="sxs-lookup"><span data-stu-id="13c48-260">On a domain-joined computer, sign in tooyour cloud service using hello same logon name that you use for your corporate credentials.</span></span>
2.  <span data-ttu-id="13c48-261">Щелкните в поле "пароль" hello.</span><span class="sxs-lookup"><span data-stu-id="13c48-261">Click inside hello password box.</span></span> <span data-ttu-id="13c48-262">Если единый вход настроен, hello пароля будет неактивным и вы увидите следующие сообщение hello: «вы находитесь необходимые toosign в в <your company>.»</span><span class="sxs-lookup"><span data-stu-id="13c48-262">If single sign-on is set up, hello password box will be shaded, and you will see hello following message: “You are now required toosign in at <your company>.”</span></span>
3.  <span data-ttu-id="13c48-263">Нажмите кнопку hello войдите в систему в <your company> ссылку.</span><span class="sxs-lookup"><span data-stu-id="13c48-263">Click hello Sign in at <your company> link.</span></span> <span data-ttu-id="13c48-264">Если вы не можете toosign в, затем единый вход настроен.</span><span class="sxs-lookup"><span data-stu-id="13c48-264">If you are able toosign in, then single sign-on has been set up.</span></span>

## <a name="next-steps"></a><span data-ttu-id="13c48-265">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="13c48-265">Next Steps</span></span>


- [<span data-ttu-id="13c48-266">Управление службами федерации Active Directory и их настройка с помощью Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="13c48-266">Active Directory Federation Services management and customization with Azure AD Connect</span></span>](active-directory-aadconnect-federation-management.md)
- [<span data-ttu-id="13c48-267">Список совместимости с федерацией Azure AD</span><span class="sxs-lookup"><span data-stu-id="13c48-267">Azure AD federation compatibility list</span></span>](active-directory-aadconnect-federation-compatibility.md)
- [<span data-ttu-id="13c48-268">Выборочная установка Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="13c48-268">Azure AD Connect Custom Installation</span></span>](active-directory-aadconnect-get-started-custom.md)
