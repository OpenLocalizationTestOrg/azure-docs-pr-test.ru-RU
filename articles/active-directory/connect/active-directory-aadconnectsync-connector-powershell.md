---
title: "Соединитель PowerShell | Документация Майкрософт"
description: "В этой статье описана настройка соединителя Windows PowerShell корпорации Майкрософт."
services: active-directory
documentationcenter: 
author: billmath
manager: mtillman
editor: 
ms.assetid: 6dba8e34-a874-4ff0-90bc-bd2b0a4199b5
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 2caf8dd8a657f116df0342893763829676602cd6
ms.sourcegitcommit: f1c1789f2f2502d683afaf5a2f46cc548c0dea50
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2018
---
# <a name="windows-powershell-connector-technical-reference"></a>Технический справочник по соединителю Windows PowerShell
В этой статье описан соединитель Windows PowerShell. Статья относится к следующим продуктам:

* Microsoft Identity Manager 2016 (MIM2016);
* Forefront Identity Manager 2010 R2 (FIM2010R2).
  * Необходимо установить исправление 4.1.3671.0 или более позднюю версию ( [KB3092178](https://support.microsoft.com/kb/3092178)).

Для MIM2016 и FIM2010R2 соединитель можно скачать из [Центра загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=717495).

## <a name="overview-of-the-powershell-connector"></a>Общие сведения о соединителе PowerShell
Соединитель PowerShell позволяет интегрировать службу синхронизации с внешними системами, которые предоставляют API-интерфейсы на основе Windows PowerShell. Соединитель обеспечивает связь между возможностями платформы расширяемого агента управления подключением 2 (ECMA2) на основе вызова и Windows PowerShell. Дополнительные сведения о платформе ECMA см. в разделе [Справочник по расширяемому агенту управления подключением 2.2](https://msdn.microsoft.com/library/windows/desktop/hh859557.aspx).

### <a name="prerequisites"></a>предварительным требованиям
Прежде чем использовать соединитель, установите на сервере синхронизации такие компоненты:

* Microsoft .NET Framework, начиная с версии 4.5.2.
* Windows PowerShell 2.0, 3.0 или 4.0.

Политику выполнения на сервере службы синхронизации необходимо настроить для выполнения сценариев Windows PowerShell. Если скрипты, выполняющиеся соединителем, не снабжены цифровой подписью, настройте политику выполнения с помощью следующей команды:   
`Set-ExecutionPolicy -ExecutionPolicy RemoteSigned`

## <a name="create-a-new-connector"></a>Создание нового соединителя
Чтобы создать в службе синхронизации соединитель Windows PowerShell, необходимо задать ряд сценариев Windows PowerShell, выполняющих шаги по запросу службы синхронизации. Выбор скриптов для реализации зависит от источника данных, к которому будет подключаться система, и требуемых функций. В этом разделе описаны все скрипты, которые могут быть реализованы по мере необходимости.

Соединитель Windows PowerShell предназначен для хранения всех скриптов в базе данных службы синхронизации. Хотя можно выполнять скрипты, которые хранятся в файловой системе, гораздо проще вставить текст каждого скрипта непосредственно в конфигурацию соединителя.

Чтобы создать соединитель PowerShell, в **Synchronization Service** (Служба синхронизации) последовательно выберите элементы **Management Agent** (Агент управления)и **Create** (Создать). Выберите соединитель **PowerShell (Microsoft)** .

![Создание соединителя](./media/active-directory-aadconnectsync-connector-powershell/createconnector.png)

### <a name="connectivity"></a>Соединение
Задайте параметры конфигурации для подключения к удаленной системе. Эти значения будут безопасно храниться в службе синхронизации и станут доступны для скриптов Windows PowerShell при запуске соединителя.

![Соединение](./media/active-directory-aadconnectsync-connector-powershell/connectivity.png)

Можно настроить указанные ниже параметры подключения.

**Соединение**

| Параметр | По умолчанию | Назначение |
| --- | --- | --- |
| сервер; |<Blank> |Имя сервера, к которому будет подключен соединитель. |
| Домен |<Blank> |Домен учетных данных, который будет сохранен для использования при запуске соединителя. |
| Пользователь |<Blank> |Имя пользователя учетных данных, которое будет сохранено для использования при запуске соединителя. |
| Пароль |<Blank> |Пароль учетных данных, который будет сохранен для использования при запуске соединителя. |
| Выполнять олицетворение учетной записи соединителя |Ложь |Если задано значение true, служба синхронизации выполняет скрипты Windows PowerShell в контексте указанных учетных данных. По возможности вместо олицетворения рекомендуется использовать параметр **$Credentials**, передаваемый в каждый сценарий. Подробные сведения о дополнительных разрешениях для использования этого параметра см. в разделе [Дополнительные настройки для олицетворения](#additional-configuration-for-impersonation). |
| Загрузить профиль пользователя при олицетворении |Ложь |Указывает Windows загрузить профиль пользователя учетных данных для соединителя при олицетворении пользователя. Если олицетворяемый пользователь использует перемещаемый профиль, соединитель не загрузит этот профиль. Подробные сведения о дополнительных разрешениях для использования этого параметра см. в разделе [Дополнительные настройки для олицетворения](#additional-configuration-for-impersonation). |
| Тип входа при олицетворении |Нет |Тип входа при олицетворении. Дополнительные сведения см. в документации по [dwLogonType][dw]. |
| Только для подписанных сценариев |Ложь |Если установлено значение «истина», соединитель Windows PowerShell проверяет, содержит ли каждый сценарий действительную цифровую подпись. Если установлено значение «ложь», убедитесь, что для политики выполнения Windows PowerShell на сервере службы синхронизации установлено значение RemoteSigned или Unrestricted. |

**Общий модуль**  
Соединитель позволяет хранить в конфигурации общий модуль Windows PowerShell. При выполнении соединителем скрипта модуль Windows PowerShell извлекается в файловую систему, чтобы он мог импортироваться каждым скриптом.

Для сценариев импорта, экспорта и синхронизации паролей общий модуль извлекается в папку соединителя MAData. Для сценариев обнаружения схемы, проверки, иерархии и секций общий модуль извлекается в папку %TEMP%. В обоих случаях извлеченный сценарий общего модуля именуется в соответствии с настройкой имени общего модуля сценария.

Чтобы загрузить модуль с именем FIMPowerShellConnectorModule.psm1 из папки MAData, воспользуйтесь следующим оператором: `Import-Module (Join-Path -Path [Microsoft.MetadirectoryServices.MAUtils]::MAFolder -ChildPath "FIMPowerShellConnectorModule.psm1")`

Чтобы загрузить модуль с именем FIMPowerShellConnectorModule.psm1 из папки %TEMP%, воспользуйтесь следующим оператором: `Import-Module (Join-Path -Path $env:TEMP -ChildPath "FIMPowerShellConnectorModule.psm1")`

**Проверка параметров**  
Сценарий проверки является необязательным сценарием Windows PowerShell, который может использоваться для проверки допустимости параметров конфигурации соединителя, установленных администратором. Как правило, этот скрипт используется для проверки сервера и учетных данных, а также параметров подключения. Сценарий проверки вызывается после изменения указанных ниже вкладок и диалоговых окон.

* Соединение
* Глобальные параметры
* Конфигурация секции

Сценарий проверки принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameterPage |[ConfigParameterPage][cpp] |Вкладка или диалоговое окно «Конфигурация», где был активирован запрос на проверку. |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |

Сценарий проверки должен вернуть в конвейер один объект ParameterValidationResult.

**Обнаружение схемы**  
Сценарий обнаружения схемы является обязательным для использования. Этот скрипт возвращает типы и атрибуты объектов, а также ограничения атрибутов, которые служба синхронизации использует при настройке правил потока атрибутов. Скрипт обнаружения схемы выполняется во время создания соединителя и заполняет схему соединителя. Он также используется действием "Обновление схемы" в Synchronization Service Manager.

Сценарий обнаружения схемы принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |

Сценарий должен возвращать в конвейер один объект [Schema][schema]. Объект Schema состоит из объектов [SchemaType][schemaT], представляющих типы объектов (например, пользователи и группы). Объект SchemaType содержит коллекцию объектов [SchemaAttribute][schemaA], представляющих атрибуты типа (например, имя, фамилия и почтовый адрес).

**Дополнительные параметры**  
Помимо стандартных настроек конфигурации, можно определить дополнительные настраиваемые параметры конфигурации, относящиеся к конкретному экземпляру соединителя. Эти параметры могут быть заданы на уровнях соединителя, секции или этапа выполнения. Доступ к ним можно получить из соответствующего сценария Windows PowerShell. Настраиваемые параметры конфигурации могут храниться в базе данных службы синхронизации в формате обычного текста или в зашифрованном виде. Служба синхронизации при необходимости автоматически шифрует и расшифровывает защищенные параметры конфигурации.

При установке настраиваемых параметров конфигурации их имена разделяются запятыми (,).

Чтобы получить доступ к настраиваемым параметрам конфигурации из сценария, необходимо добавить к имени суффикс, содержащий символ подчеркивания (\_) и область параметра (Global, Partition или RunStep). Например, чтобы получить доступ к параметру Global FileName, используйте следующий фрагмент кода: `$ConfigurationParameters["FileName_Global"].Value`

### <a name="capabilities"></a>Возможности
На вкладке возможностей конструктора агента управления определяются поведение и функции соединителя. Выбранные на этой вкладке параметры после создания соединителя изменить нельзя. В таблице ниже перечислены параметры функций.

![Возможности](./media/active-directory-aadconnectsync-connector-powershell/capabilities.png)

| Функция | ОПИСАНИЕ |
| --- | --- |
| [Стиль различающегося имени][dnstyle] |Указывает, поддерживает ли соединитель различающиеся имена, и, если это так, определяет их стили. |
| [Тип экспорта][exportT] |Определяет тип объектов, которые представлены в сценарии экспорта. <li>AttributeReplace — включает полный набор значений для многозначного атрибута при его изменении.</li><li>AttributeUpdate — включает только изменения атрибута с несколькими значениями при его изменении.</li><li>MultivaluedReferenceAttributeUpdate — включает полный набор значений для не являющихся ссылками многозначных атрибутов и только изменения для многозначных ссылочных атрибутов.</li><li>ObjectReplace — включает все атрибуты объекта при изменении любого атрибута.</li> |
| [Нормализация данных][DataNorm] |Указывает службе синхронизации нормализовать привязки атрибутов, перед тем как они будут заданы в сценариях. |
| [Подтверждение объекта][oconf] |Настраивает поведение при ожидании импорта в службу синхронизации. <li>Normal — поведение по умолчанию, при котором предполагается, что все экспортированные изменения должны быть подтверждены посредством импорта.</li><li>NoDeleteConfirmation — при удалении объекта ожидание импорта отсутствует.</li><li>NoAddAndDeleteConfirmation — при создании или удалении объекта ожидание импорта отсутствует.</li> |
| Использование DN как привязки |Если для стиля различающегося имени установлено значение LDAP, атрибут привязки для пространства соединителя также является различающимся именем. |
| Параллельная работа нескольких соединителей |Если этот флажок установлен, можно одновременно запустить несколько соединителей Windows PowerShell. |
| Разделы |Если этот флажок установлен, соединитель будет поддерживать несколько секций и функцию их обнаружения. |
| Иерархия |Если этот флажок установлен, соединитель будет поддерживать иерархическую структуру стиля LDAP. |
| Включить импорт |Если этот флажок установлен, соединитель импортирует данные с помощью скриптов импорта. |
| Включить импорт изменений |Если этот флажок установлен, соединитель может подавать в сценарии импорта запросы на изменения. |
| Включить экспорт |Если этот флажок установлен, соединитель экспортирует данные с помощью скриптов экспорта. |
| Включить полный экспорт |Если этот флажок установлен, сценарии экспорта будут поддерживать экспорт всего пространства соединителя. Для использования этого параметра должен быть установлен флажок «Включить экспорт». |
| Без ссылочных значений на первом этапе экспорта |Если этот флажок установлен, ссылочные атрибуты экспортируются на втором этапе экспорта. |
| Включить переименование объекта |Если этот флажок установлен, различающиеся имена можно изменить. |
| Удаление и добавление как замена |Если этот флажок установлен, операции удаления и добавления экспортируются как одна операция замены. |
| Включить операции паролей |Если этот флажок установлен, поддерживаются сценарии синхронизации паролей. |
| Включить пароль для экспорта на первом этапе |Если этот флажок установлен, пароли, заданные во время подготовки, экспортируются при создании объекта. |

### <a name="global-parameters"></a>Глобальные параметры
Скрипты Windows PowerShell, которые запускаются с помощью соединителя, можно настроить на вкладке "Глобальные параметры" в конструкторе агента управления. Можно также настроить глобальные значения настраиваемых параметров конфигурации на вкладке "Подключение".

**Обнаружение секции**  
Секция — отдельное пространство имен в пределах одной общей схемы. Например, в Active Directory каждый домен представляет собой секцию в пределах одного леса. Секция является логической группой для операций импорта и экспорта. Импорт и экспорт разбиваются на секции по контексту, и все операции выполняются в этом контексте. Секции должны представлять иерархию в LDAP. Различающееся имя секции используется при импорте. Оно позволяет проверить, находятся ли все возвращаемые объекты в пределах секции. Различающееся имя секции также используется при подготовке передачи из метавселенной в пространство соединителя, чтобы определить, с какой секцией должен быть связан объект во время экспорта.

Сценарий обнаружения секции принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |

Сценарий должен возвращать в конвейер отдельный объект [Partition][part] или объект List[T] с объектами Partition.

**Обнаружение иерархии**  
Сценарий обнаружения иерархии используется только в том случае, когда различающееся имя стиля возможностей является LDAP. Скрипт позволяет просматривать и выбирать контейнеры, которые будут учитываться в области операций импорта и экспорта или вне ее. Сценарий должен указывать только список узлов, которые являются непосредственными дочерними элементами корневого узла, заданного для сценария.

Сценарий обнаружения иерархии принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |
| ParentNode |[HierarchyNode][hn] |Корневой узел иерархии, в которой сценарий должен возвращать непосредственные дочерние элементы. |

Сценарий должен возвращать в конвейер один дочерний объект HierarchyNode или список дочерних объектов HierarchyNode.

#### <a name="import"></a>Импорт
Соединители, которые поддерживают операции импорта, должны реализовать три сценария.

**Начало импорта**  
Сценарий начала импорта реализуется в начале этапа выполнения импорта. На этом этапе можно установить подключение к исходной системе и выполнить все необходимые подготовительные действия перед импортом данных из подключенной системы.

Сценарий начала импорта принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |
| OpenImportConnectionRunStep |[OpenImportConnectionRunStep][oicrs] |Информирует сценарий о типе запуска импорта (измененный или полный), секции, иерархии, водяном знаке и ожидаемом размере страницы. |
| Типы |[Schema][schema] |Схема для импортируемого пространства соединителя. |

Сценарий должен возвращать в конвейер один объект [OpenImportConnectionResults][oicres], например: `Write-Output (New-Object Microsoft.MetadirectoryServices.OpenImportConnectionResults)`.

**Импорт данных**  
Соединитель вызывает сценарий импорта данных, пока сценарий не укажет, что данных для импорта больше нет. Размер страницы соединителя Windows PowerShell составляет 9999 объектов. Если скрипт возвращает более 9999 объектов для импорта, должна поддерживаться разбивка на страницы. Соединитель представляет свойство настраиваемых данных, которое можно использовать для хранения водяного знака, чтобы при каждом вызове сценарий импорта данных возобновлял импорт объектов с того момента, на котором он был остановлен.

Сценарий импорта данных принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |
| GetImportEntriesRunStep |[ImportRunStep][irs] |Содержит водяной знак (CustomData), который можно использовать во время постраничного импорта и импорта изменений. |
| OpenImportConnectionRunStep |[OpenImportConnectionRunStep][oicrs] |Информирует сценарий о типе запуска импорта (измененный или полный), секции, иерархии, водяном знаке и ожидаемом размере страницы. |
| Типы |[Schema][schema] |Схема для импортируемого пространства соединителя. |

Сценарий импорта данных должен записать в конвейер объект List[[CSEntryChange][csec]]. Эта коллекция состоит из атрибутов CSEntryChange, представляющих каждый импортируемый объект. При выполнении полного импорта эта коллекция должна содержать полный набор объектов CSEntryChange со всеми атрибутами для каждого объекта. При импорте изменений объект CSEntryChange должен содержать изменения уровня атрибутов для каждого импортируемого объекта или полное представление измененных объектов (режим замены).

**Окончание импорта**  
По завершении импорта выполняется сценарий окончания импорта. Этот скрипт должен выполнять все необходимые задачи очистки (например, закрытие подключений к системам и реагирование на сбои).

Сценарий окончания импорта принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |
| OpenImportConnectionRunStep |[OpenImportConnectionRunStep][oicrs] |Информирует сценарий о типе запуска импорта (измененный или полный), секции, иерархии, водяном знаке и ожидаемом размере страницы. |
| CloseImportConnectionRunStep |[CloseImportConnectionRunStep][cecrs] |Информирует сценарий о причине завершения импорта. |

Сценарий должен возвращать в конвейер отдельный объект [CloseImportConnectionResults][cicres], например: `Write-Output (New-Object Microsoft.MetadirectoryServices.CloseImportConnectionResults)`.

#### <a name="export"></a>экспорт.
Идентичен архитектуре импорта соединителя. Соединители, поддерживающие экспорт, должны реализовать три сценария.

**Начало экспорта**  
Сценарий «Начало экспорта» реализуется в начале этапа выполнения экспорта. На этом этапе можно установить подключение к исходной системе и выполнить все необходимые подготовительные действия перед экспортом данных в подключенную систему.

Сценарий начала экспорта принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |
| OpenExportConnectionRunStep |[OpenExportConnectionRunStep][oecrs] |Информирует сценарий о типе запуска экспорта (измененный или полный), секции, иерархии и ожидаемом размере страницы. |
| Типы |[Schema][schema] |Схема для экспортируемого пространства соединителя. |

Сценарий не должен возвращать выходные данные в конвейер.

**Экспорт данных**  
Служба синхронизации вызывает сценарий экспорта данных столько раз, сколько это необходимо для обработки всех операций экспорта в ожидании. Если количество операций экспорта в ожидании превышает размер страницы соединителя, скрипт экспорта данных может вызываться несколько раз (возможно, несколько раз для одного и того же объекта).

Сценарий экспорта данных принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |
| CSEntries |IList[CSEntryChange][csec] |Список всех объектов пространства соединителя с операциями экспорта в ожидании для обработки на этом этапе. |
| OpenExportConnectionRunStep |[OpenExportConnectionRunStep][oecrs] |Информирует сценарий о типе запуска экспорта (измененный или полный), секции, иерархии и ожидаемом размере страницы. |
| Типы |[Schema][schema] |Схема для экспортируемого пространства соединителя. |

Сценарий экспорта данных должен возвращать в конвейер объект [PutExportEntriesResults][peeres]. Этот объект не должен включать данные результатов для каждого экспортируемого соединителя, если не произойдет ошибка или изменение атрибута привязки. Например, чтобы вернуть в конвейер объект PutExportEntriesResults: `Write-Output (New-Object Microsoft.MetadirectoryServices.PutExportEntriesResults)`

**Окончание экспорта**  
По завершении экспорта выполняется сценарий окончания экспорта. Этот скрипт должен выполнять все необходимые задачи очистки (например, закрытие подключений к системам и реагирование на сбои).

Сценарий окончания экспорта принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |
| OpenExportConnectionRunStep |[OpenExportConnectionRunStep][oecrs] |Информирует сценарий о типе запуска экспорта (измененный или полный), секции, иерархии и ожидаемом размере страницы. |
| CloseExportConnectionRunStep |[CloseExportConnectionRunStep][cecrs] |Информирует сценарий о причине завершения экспорта. |

Сценарий не должен возвращать выходные данные в конвейер.

#### <a name="password-synchronization"></a>Синхронизация паролей
Соединители Windows PowerShell могут использоваться в качестве целевого объекта для изменения или сброса пароля.

Сценарий пароля принимает от соединителя указанные ниже параметры.

| ИМЯ | Тип данных | ОПИСАНИЕ |
| --- | --- | --- |
| ConfigParameters |[KeyedCollection][keyk] [строка, [ConfigParameter][cp]] |Таблица параметров конфигурации для соединителя. |
| Учетные данные |[PSCredential][pscred] |Содержит все учетные данные, введенные администратором на вкладке «Подключение». |
| Секция |[Секция][part] |Секция каталога, содержащая CSEntry. |
| CSEntry |[CSEntry][cse] |Запись пространства соединителя для объекта, который получил данные о смене или сбросе пароля. |
| OperationType |Строка |Указывает тип операции: сброс (**SetPassword**) или изменение (**ChangePassword**). |
| PasswordOptions |[PasswordOptions][pwdopt] |Флаги, определяющие предполагаемое поведение при сбросе пароля. Этот параметр доступен, только если для OperationType установлено значение **SetPassword**. |
| OldPassword |Строка |Содержит старый пароль объекта, необходимый для изменения пароля. Этот параметр доступен, только если для OperationType установлено значение **ChangePassword**. |
| NewPassword |Строка |Содержит новый пароль, который должен быть установлен сценарием. |

Сценарий пароля не должен возвращать результаты в конвейер Windows PowerShell. В случае ошибки в сценарии пароля сценарий должен вызывать одно из указанных ниже исключений, чтобы отправить сведения о проблеме в службу синхронизации.

* [PasswordPolicyViolationException][pwdex1] порождается, если пароль не соответствует политике паролей в подключенной системе.
* [PasswordIllFormedException][pwdex2] порождается, если пароль неприемлем для подключенной системы.
* [PasswordExtension][pwdex3] порождается при возникновении любых других ошибок в сценарии пароля.

## <a name="sample-connectors"></a>Образцы соединителей
Полный обзор доступных примеров соединителей представлен в статье [Windows PowerShell Connector for FIM 2010 R2 Sample Connector Collection][samp] (Коллекция примеров соединителей Windows PowerShell для FIM 2010 R2).

## <a name="other-notes"></a>Другие примечания
### <a name="additional-configuration-for-impersonation"></a>Дополнительные настройки для олицетворения
Предоставляются олицетворяемому пользователю с указанными ниже разрешениями на сервере службы синхронизации.

Доступ для чтения к следующим разделам реестра:

* HKEY_USERS\\[SynchronizationServiceServiceAccountSID]\Software\Microsoft\PowerShell
* HKEY_USERS\\[SynchronizationServiceServiceAccountSID]\Environment

Чтобы определить идентификатор безопасности (SID) учетной записи службы синхронизации, необходимо выполнить указанные ниже команды PowerShell.

```
$account = New-Object System.Security.Principal.NTAccount "<domain>\<username>"
$account.Translate([System.Security.Principal.SecurityIdentifier]).Value
```

Доступ для чтения к следующим папкам файловой системы:

* %ProgramFiles%\Microsoft Forefront Identity Manager\2010\Synchronization Service\Extensions;
* %ProgramFiles%\Microsoft Forefront Identity Manager\2010\Synchronization Service\ExtensionsCache;
* %ProgramFiles%\Microsoft Forefront Identity Manager\2010\Synchronization Service\MaData\\{ConnectorName}

Подставьте имя соединителя Windows PowerShell вместо заполнителя {ConnectorName}.

## <a name="troubleshooting"></a>Устранение неполадок
* Сведения о том, как включить ведение журнала для устранения неполадок соединителя, см. в статье [How to Enable ETW Tracing for Connectors](http://go.microsoft.com/fwlink/?LinkId=335731) (Включение трассировки событий Windows для соединителей).

<!--Reference style links - using these makes the source content way more readable than using inline links-->
[cpp]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.configparameterpage.aspx
[keyk]: https://msdn.microsoft.com/library/ms132438.aspx
[cp]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.configparameter.aspx
[pscred]: https://msdn.microsoft.com/library/system.management.automation.pscredential.aspx
[schema]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.schema.aspx
[schemaT]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.schematype.aspx
[schemaA]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.schemaattribute.aspx
[dnstyle]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.madistinguishednamestyle.aspx
[exportT]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.maexporttype.aspx
[DataNorm]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.manormalizations.aspx
[oconf]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.maobjectconfirmation.aspx
[dw]: https://msdn.microsoft.com/library/windows/desktop/aa378184.aspx
[part]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.partition.aspx
[hn]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.hierarchynode.aspx
[oicrs]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.openimportconnectionrunstep.aspx
[cecrs]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.closeexportconnectionrunstep.aspx
[oicres]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.openimportconnectionresults.aspx
[cecrs]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.closeexportconnectionrunstep.aspx
[cicres]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.closeimportconnectionresults.aspx
[oecrs]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.openexportconnectionrunstep.aspx
[irs]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.importrunstep.aspx
[cse]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.csentry.aspx
[csec]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.csentrychange.aspx
[peeres]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.putexportentriesresults.aspx
[pwdopt]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.passwordoptions.aspx
[pwdex1]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.passwordpolicyviolationexception.aspx
[pwdex2]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.passwordillformedexception.aspx
[pwdex3]: https://msdn.microsoft.com/library/windows/desktop/microsoft.metadirectoryservices.passwordextensionexception.aspx
[samp]: http://go.microsoft.com/fwlink/?LinkId=394291
