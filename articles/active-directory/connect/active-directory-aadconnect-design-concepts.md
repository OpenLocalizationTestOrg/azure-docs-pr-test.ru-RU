---
title: "Azure AD Connect: принципы проектирования | Документация Майкрософт"
description: "В этой статье описываются факторы, которые необходимо учитывать при проектировании реализации."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: 
ms.assetid: 4114a6c0-f96a-493c-be74-1153666ce6c9
ms.service: active-directory
ms.custom: azure-ad-connect
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Identity
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: f23443d438c95a784f655fb9a5f20dfcf37be189
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-design-concepts"></a><span data-ttu-id="b3cc6-103">Azure AD Connect: принципы проектирования</span><span class="sxs-lookup"><span data-stu-id="b3cc6-103">Azure AD Connect: Design concepts</span></span>
<span data-ttu-id="b3cc6-104">В этой статье приведено описание факторов, которые должны учитываться при проектировании реализации Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-104">The purpose of this topic is to describe areas that must be thought through during the implementation design of Azure AD Connect.</span></span> <span data-ttu-id="b3cc6-105">Здесь подробно рассмотрены некоторые вопросы, но часть из них вкратце рассмотрена в других статьях.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-105">This topic is a deep dive on certain areas and these concepts are briefly described in other topics as well.</span></span>

## <a name="sourceanchor"></a><span data-ttu-id="b3cc6-106">sourceAnchor</span><span class="sxs-lookup"><span data-stu-id="b3cc6-106">sourceAnchor</span></span>
<span data-ttu-id="b3cc6-107">Атрибут sourceAnchor определяется как *атрибут, который остается неизменным на протяжении всего времени существования объекта*.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-107">The sourceAnchor attribute is defined as *an attribute immutable during the lifetime of an object*.</span></span> <span data-ttu-id="b3cc6-108">Он однозначно определяет объект независимо от того, является ли он локальным или находится в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-108">It uniquely identifies an object as being the same object on-premises and in Azure AD.</span></span> <span data-ttu-id="b3cc6-109">Этот атрибут также называется **immutableId**. Оба этих имени взаимозаменяемы.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-109">The attribute is also called **immutableId** and the two names are used interchangeable.</span></span>

<span data-ttu-id="b3cc6-110">Слово "неизменяемый" является в этой статье ключевым. Оно означает, что значение атрибута не может быть изменено.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-110">The word immutable, that is "cannot be changed", is important to this topic.</span></span> <span data-ttu-id="b3cc6-111">Так как значение этого атрибута, если оно уже задано, нельзя изменить, важно выбрать такой подход к проектированию, который подойдет для вашей ситуации.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-111">Since this attribute’s value cannot be changed after it has been set, it is important to pick a design that supports your scenario.</span></span>

<span data-ttu-id="b3cc6-112">Данный атрибут используется в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-112">The attribute is used for the following scenarios:</span></span>

* <span data-ttu-id="b3cc6-113">При создании нового сервера синхронизации или его пересоздании после аварийного восстановления: в таком случае этот атрибут связывает существующие объекты в Azure AD с локальными объектами.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-113">When a new sync engine server is built, or rebuilt after a disaster recovery scenario, this attribute links existing objects in Azure AD with objects on-premises.</span></span>
* <span data-ttu-id="b3cc6-114">При смене модели, в которой используются только облачные удостоверения, на модель, в которой используются синхронизированные удостоверения: в таком случае этот атрибут позволяет жестко связывать существующие объекты в Azure AD с локальными объектами.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-114">If you move from a cloud-only identity to a synchronized identity model, then this attribute allows objects to "hard match" existing objects in Azure AD with on-premises objects.</span></span>
* <span data-ttu-id="b3cc6-115">При использовании федерации: в этом случае данный атрибут в сочетании с **userPrincipalName** используется в утверждении для уникальной идентификации пользователя.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-115">If you use federation, then this attribute together with the **userPrincipalName** is used in the claim to uniquely identify a user.</span></span>

<span data-ttu-id="b3cc6-116">В этой статье речь идет только об атрибуте sourceAnchor в контексте его значения для пользователей.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-116">This topic only talks about sourceAnchor as it relates to users.</span></span> <span data-ttu-id="b3cc6-117">Аналогичные правила действуют для всех типов объектов, но проблемы обычно возникают именно у пользователей.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-117">The same rules apply to all object types, but it is only for users this problem usually is a concern.</span></span>

### <a name="selecting-a-good-sourceanchor-attribute"></a><span data-ttu-id="b3cc6-118">Выбор значений атрибута sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-118">Selecting a good sourceAnchor attribute</span></span>
<span data-ttu-id="b3cc6-119">Значение атрибута должно соответствовать следующим правилам:</span><span class="sxs-lookup"><span data-stu-id="b3cc6-119">The attribute value must follow the following rules:</span></span>

* <span data-ttu-id="b3cc6-120">Его длина должна быть меньше 60 символов.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-120">Be less than 60 characters in length</span></span>
  * <span data-ttu-id="b3cc6-121">Символы, отличные от a–z, A–Z или 0–9, кодируются, и каждый из них считается как три символа.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-121">Characters not being a-z, A-Z, or 0-9 are encoded and counted as 3 characters</span></span>
* <span data-ttu-id="b3cc6-122">Оно не должно содержать специальные символы: &#92; !</span><span class="sxs-lookup"><span data-stu-id="b3cc6-122">Not contain a special character: &#92; !</span></span> <span data-ttu-id="b3cc6-123"># $ % & * + / = ?</span><span class="sxs-lookup"><span data-stu-id="b3cc6-123"># $ % & * + / = ?</span></span> <span data-ttu-id="b3cc6-124">^ &#96; { } | ~ < > ( ) ' ; : , [ ] " @ _</span><span class="sxs-lookup"><span data-stu-id="b3cc6-124">^ &#96; { } | ~ < > ( ) ' ; : , [ ] " @ _</span></span>
* <span data-ttu-id="b3cc6-125">Оно должно быть глобально уникальным.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-125">Must be globally unique</span></span>
* <span data-ttu-id="b3cc6-126">Значение должно относиться к строковому, целочисленному или двоичному типу.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-126">Must be either a string, integer, or binary</span></span>
* <span data-ttu-id="b3cc6-127">Значение не должно быть основано на имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-127">Should not be based on user's name, these changes</span></span>
* <span data-ttu-id="b3cc6-128">Значение не должно быть с учетом регистра и содержать значения, которые изменяются в зависимости от регистра.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-128">Should not be case-sensitive and avoid values that may vary by case</span></span>
* <span data-ttu-id="b3cc6-129">Значение должно присваиваться при создании объекта.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-129">Should be assigned when the object is created</span></span>

<span data-ttu-id="b3cc6-130">Если значение sourceAnchor не является строковым, служба Azure AD Connect шифрует его в формате Base64, чтобы исключить появление специальных символов.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-130">If the selected sourceAnchor is not of type string, then Azure AD Connect Base64Encode the attribute value to ensure no special characters appear.</span></span> <span data-ttu-id="b3cc6-131">Если вы используете сервер федерации, отличный от ADFS, убедитесь, что сервер также может кодировать атрибут в формате Base64.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-131">If you use another federation server than ADFS, make sure your server can also Base64Encode the attribute.</span></span>

<span data-ttu-id="b3cc6-132">Атрибут sourceAnchor чувствителен к регистру.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-132">The sourceAnchor attribute is case-sensitive.</span></span> <span data-ttu-id="b3cc6-133">JohnDoe и johndoe — это разные значения.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-133">A value of “JohnDoe” is not the same as “johndoe”.</span></span> <span data-ttu-id="b3cc6-134">При этом не стоит создавать два объекта, имена которых отличаются только регистром.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-134">But you should not have two different objects with only a difference in case.</span></span>

<span data-ttu-id="b3cc6-135">При наличии одного локального леса следует использовать атрибут **objectGUID**.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-135">If you have a single forest on-premises, then the attribute you should use is **objectGUID**.</span></span> <span data-ttu-id="b3cc6-136">Этот атрибут используется, если вы применяете стандартные параметры Azure AD Connect. Он также используется в DirSync.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-136">This is also the attribute used when you use express settings in Azure AD Connect and also the attribute used by DirSync.</span></span>

<span data-ttu-id="b3cc6-137">Если у вас есть несколько лесов и вы не перемещаете пользователей между ними или доменами, то и в этом случае мы рекомендуем использовать атрибут **objectGUID** .</span><span class="sxs-lookup"><span data-stu-id="b3cc6-137">If you have multiple forests and do not move users between forests and domains, then **objectGUID** is a good attribute to use even in this case.</span></span>

<span data-ttu-id="b3cc6-138">Если же вы перемещаете пользователей между лесами или доменами, вам необходимо найти такой атрибут, который либо никогда не изменяется, либо может перемещаться вместе с пользователями.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-138">If you move users between forests and domains, then you must find an attribute that does not change or can be moved with the users during the move.</span></span> <span data-ttu-id="b3cc6-139">Рекомендуется использовать синтетический атрибут.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-139">A recommended approach is to introduce a synthetic attribute.</span></span> <span data-ttu-id="b3cc6-140">Для этого подходит атрибут, который может содержать что-нибудь наподобие идентификатора GUID.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-140">An attribute that could hold something that looks like a GUID would be suitable.</span></span> <span data-ttu-id="b3cc6-141">При создании объекта создается новый идентификатор GUID, который присваивается пользователю.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-141">During object creation, a new GUID is created and stamped on the user.</span></span> <span data-ttu-id="b3cc6-142">На сервере подсистемы синхронизации можно создать настраиваемое правило синхронизации, которое будет создавать это значение на основе идентификатора **objectGUID** и обновлять выбранный атрибут в службе ADDS.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-142">A custom sync rule can be created in the sync engine server to create this value based on the **objectGUID** and update the selected attribute in ADDS.</span></span> <span data-ttu-id="b3cc6-143">При перемещении объекта убедитесь, что это значение также копируется.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-143">When you move the object, make sure to also copy the content of this value.</span></span>

<span data-ttu-id="b3cc6-144">Другой вариант — выбрать существующий атрибут, который никогда не изменяется.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-144">Another solution is to pick an existing attribute you know does not change.</span></span> <span data-ttu-id="b3cc6-145">Зачастую можно использовать атрибут **employeeID**.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-145">Commonly used attributes include **employeeID**.</span></span> <span data-ttu-id="b3cc6-146">Если значение атрибута содержит буквы, исключите вероятность изменения регистра (на верхний или нижний) в этом значении.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-146">If you consider an attribute that contains letters, make sure there is no chance the case (upper case vs. lower case) can change for the attribute's value.</span></span> <span data-ttu-id="b3cc6-147">Не используйте атрибуты, содержащие имя пользователя.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-147">Bad attributes that should not be used include those attributes with the name of the user.</span></span> <span data-ttu-id="b3cc6-148">В случае женитьбы, замужества или развода имя может измениться, что недопустимо для этого атрибута.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-148">In a marriage or divorce, the name is expected to change, which is not allowed for this attribute.</span></span> <span data-ttu-id="b3cc6-149">Это одна из причин того, почему мастер установки Azure AD Connect не позволяет выбирать такие атрибуты, как **userPrincipalName**, **mail** и **targetAddress**.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-149">This is also one reason why attributes such as **userPrincipalName**, **mail**, and **targetAddress** are not even possible to select in the Azure AD Connect installation wizard.</span></span> <span data-ttu-id="b3cc6-150">Эти атрибуты содержат также знак "@", что недопустимо для sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-150">Those attributes also contain the "@" character, which is not allowed in the sourceAnchor.</span></span>

### <a name="changing-the-sourceanchor-attribute"></a><span data-ttu-id="b3cc6-151">Изменение атрибута sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-151">Changing the sourceAnchor attribute</span></span>
<span data-ttu-id="b3cc6-152">Значение атрибута sourceAnchor нельзя изменить после создания объекта в Azure AD и синхронизации удостоверения.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-152">The sourceAnchor attribute value cannot be changed after the object has been created in Azure AD and the identity is synchronized.</span></span>

<span data-ttu-id="b3cc6-153">По этой причине в Azure AD Connect действуют следующие ограничения.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-153">For this reason, the following restrictions apply to Azure AD Connect:</span></span>

* <span data-ttu-id="b3cc6-154">Атрибут sourceAnchor можно задать только при первоначальной установке.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-154">The sourceAnchor attribute can only be set during initial installation.</span></span> <span data-ttu-id="b3cc6-155">При повторном запуске мастера установки этот параметр доступен только для чтения.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-155">If you rerun the installation wizard, this option is read-only.</span></span> <span data-ttu-id="b3cc6-156">Для изменения этого параметра потребуется удалить и повторно установить программу.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-156">If you need to change this setting, then you must uninstall and reinstall.</span></span>
* <span data-ttu-id="b3cc6-157">При установке другого сервера Azure AD Connect необходимо выбрать уже используемый атрибут sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-157">If you install another Azure AD Connect server, then you must select the same sourceAnchor attribute as previously used.</span></span> <span data-ttu-id="b3cc6-158">Если вы ранее использовали DirSync и переходите на Azure AD Connect, вам потребуется использовать **objectGUID** , так как этот атрибут использовался в DirSync.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-158">If you have earlier been using DirSync and move to Azure AD Connect, then you must use **objectGUID** since that is the attribute used by DirSync.</span></span>
* <span data-ttu-id="b3cc6-159">Если после экспорта объекта в Azure AD значение sourceAnchor изменится, синхронизация Azure AD Connect выдаст ошибку и вы больше не сможете изменять этот объект, пока не устраните проблему, восстановив прежнюю версию sourceAnchor в исходном каталоге.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-159">If the value for sourceAnchor is changed after the object has been exported to Azure AD, then Azure AD Connect sync throws an error and does not allow any more changes on that object before the issue has been fixed and the sourceAnchor is changed back in the source directory.</span></span>

## <a name="using-msds-consistencyguid-as-sourceanchor"></a><span data-ttu-id="b3cc6-160">Использование msDS-ConsistencyGuid в качестве sourceAnchor</span><span class="sxs-lookup"><span data-stu-id="b3cc6-160">Using msDS-ConsistencyGuid as sourceAnchor</span></span>
<span data-ttu-id="b3cc6-161">По умолчанию Azure AD Connect (версии 1.1.486.0 и более ранних версий) в качестве атрибута sourceAnchor использует идентификатор objectGUID.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-161">By default, Azure AD Connect (version 1.1.486.0 and older) uses objectGUID as the sourceAnchor attribute.</span></span> <span data-ttu-id="b3cc6-162">ObjectGUID создается системой.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-162">ObjectGUID is system-generated.</span></span> <span data-ttu-id="b3cc6-163">Его значение не указывается при создании локальных объектов AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-163">You cannot specify its value when creating on-premises AD objects.</span></span> <span data-ttu-id="b3cc6-164">Как описано в разделе [sourceAnchor](#sourceanchor), в некоторых сценариях необходимо указать значение sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-164">As explained in section [sourceAnchor](#sourceanchor), there are scenarios where you need to specify the sourceAnchor value.</span></span> <span data-ttu-id="b3cc6-165">Если к вам относятся эти сценарии, то в качестве атрибута sourceAnchor необходимо использовать настраиваемый атрибут AD (например msDS-ConsistencyGuid).</span><span class="sxs-lookup"><span data-stu-id="b3cc6-165">If the scenarios are applicable to you, you must use a configurable AD attribute (for example, msDS-ConsistencyGuid) as the sourceAnchor attribute.</span></span>

<span data-ttu-id="b3cc6-166">Azure AD Connect (версии 1.1.524.0 и более поздних версий) упрощает использование msDS-ConsistencyGuid в качестве атрибута sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-166">Azure AD Connect (version 1.1.524.0 and after) now facilitates the use of msDS-ConsistencyGuid as sourceAnchor attribute.</span></span> <span data-ttu-id="b3cc6-167">При использовании этой функции Azure AD Connect автоматически настраивает правила синхронизации для выполнения следующих действий:</span><span class="sxs-lookup"><span data-stu-id="b3cc6-167">When using this feature, Azure AD Connect automatically configures the synchronization rules to:</span></span>

1. <span data-ttu-id="b3cc6-168">Использование msDS-ConsistencyGuid в качестве атрибута sourceAnchor для объектов User.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-168">Use msDS-ConsistencyGuid as the sourceAnchor attribute for User objects.</span></span> <span data-ttu-id="b3cc6-169">Для других типов объектов используется ObjectGUID.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-169">ObjectGUID is used for other object types.</span></span>

2. <span data-ttu-id="b3cc6-170">Если для локального объекта User в AD не заполнен атрибут msDS-ConsistencyGuid, то Azure AD Connect записывает значение objectGUID обратно в атрибут msDS-ConsistencyGuid в локальном каталоге Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-170">For any given on-premises AD User object whose msDS-ConsistencyGuid attribute isn't populated, Azure AD Connect writes its objectGUID value back to the msDS-ConsistencyGuid attribute in on-premises Active Directory.</span></span> <span data-ttu-id="b3cc6-171">После заполнения атрибута msDS-ConsistencyGuid Azure AD Connect экспортирует объект в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-171">After the msDS-ConsistencyGuid attribute is populated, Azure AD Connect then exports the object to Azure AD.</span></span>

>[!NOTE]
> <span data-ttu-id="b3cc6-172">После того, как локальный объект AD импортируется в Azure AD Connect (то есть импортируется в пространство соединителя AD и проецируется в метавселенную), его значение sourceAnchor больше невозможно изменить.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-172">Once an on-premises AD object is imported into Azure AD Connect (that is, imported into the AD Connector Space and projected into the Metaverse), you cannot change its sourceAnchor value anymore.</span></span> <span data-ttu-id="b3cc6-173">Чтобы указать значение sourceAnchor для определенного локального объекта AD, настройте его атрибут msDS-ConsistencyGuid, прежде чем импортировать его в Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-173">To specify the sourceAnchor value for a given on-premises AD object, configure its msDS-ConsistencyGuid attribute before it is imported into Azure AD Connect.</span></span>

### <a name="permission-required"></a><span data-ttu-id="b3cc6-174">Требования к разрешениям</span><span class="sxs-lookup"><span data-stu-id="b3cc6-174">Permission required</span></span>
<span data-ttu-id="b3cc6-175">Для работы этой функции учетной записи AD DS, используемой для синхронизации с локальным каталогом Active Directory, необходимо предоставить разрешение на запись атрибута msDS-ConsistencyGuid в локальном каталоге Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-175">For this feature to work, the AD DS account used to synchronize with on-premises Active Directory must be granted write permission to the msDS-ConsistencyGuid attribute in on-premises Active Directory.</span></span>

### <a name="how-to-enable-the-consistencyguid-feature---new-installation"></a><span data-ttu-id="b3cc6-176">Включение функции ConsistencyGuid — новая установка</span><span class="sxs-lookup"><span data-stu-id="b3cc6-176">How to enable the ConsistencyGuid feature - New installation</span></span>
<span data-ttu-id="b3cc6-177">Вы можете включить использование ConsistencyGuid в качестве sourceAnchor во время новой установки.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-177">You can enable the use of ConsistencyGuid as sourceAnchor during new installation.</span></span> <span data-ttu-id="b3cc6-178">В этом разделе подробно описывается экспресс- и пользовательская установка.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-178">This section covers both Express and Custom installation in details.</span></span>

  >[!NOTE]
  > <span data-ttu-id="b3cc6-179">Только более поздние версии Azure AD Connect (1.1.524.0 и выше) поддерживают использование ConsistencyGuid в качестве sourceAnchor во время новой установки.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-179">Only newer versions of Azure AD Connect (1.1.524.0 and after) supports the use of ConsistencyGuid as sourceAnchor during new installation.</span></span>

### <a name="how-to-enable-the-consistencyguid-feature"></a><span data-ttu-id="b3cc6-180">Включение функции ConsistencyGuid</span><span class="sxs-lookup"><span data-stu-id="b3cc6-180">How to enable the ConsistencyGuid feature</span></span>
<span data-ttu-id="b3cc6-181">В настоящее время эту функцию можно включить только при новой установке Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-181">Currently, the feature can only be enabled during new Azure AD Connect installation only.</span></span>

#### <a name="express-installation"></a><span data-ttu-id="b3cc6-182">Экспресс-установка</span><span class="sxs-lookup"><span data-stu-id="b3cc6-182">Express Installation</span></span>
<span data-ttu-id="b3cc6-183">При установке Azure AD Connect в экспресс-режиме мастер Azure AD Connect автоматически определяет наиболее подходящий атрибут AD для использования в качестве атрибута sourceAnchor. При этом применяется следующая логика:</span><span class="sxs-lookup"><span data-stu-id="b3cc6-183">When installing Azure AD Connect with Express mode, the Azure AD Connect wizard automatically determines the most appropriate AD attribute to use as the sourceAnchor attribute using the following logic:</span></span>

* <span data-ttu-id="b3cc6-184">Во-первых, мастер Azure AD Connect запрашивает у клиента Azure AD получение атрибута AD, который использовался в качестве атрибута sourceAnchor при предыдущей установке Azure AD Connect (если использовался).</span><span class="sxs-lookup"><span data-stu-id="b3cc6-184">First, the Azure AD Connect wizard queries your Azure AD tenant to retrieve the AD attribute used as the sourceAnchor attribute in the previous Azure AD Connect installation (if any).</span></span> <span data-ttu-id="b3cc6-185">Если эти сведения доступны, то Azure AD Connect использует тот же атрибут AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-185">If this information is available, Azure AD Connect uses the same AD attribute.</span></span>

  >[!NOTE]
  > <span data-ttu-id="b3cc6-186">Только более поздние версии Azure AD Connect (1.1.524.0 и выше) хранят в клиенте Azure AD сведения об используемом во время установки атрибуте sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-186">Only newer versions of Azure AD Connect (1.1.524.0 and after) stores information in your Azure AD tenant about the sourceAnchor attribute used during installation.</span></span> <span data-ttu-id="b3cc6-187">Более ранние версии Azure AD Connect этого не делают.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-187">Older versions of Azure AD Connect do not.</span></span>

* <span data-ttu-id="b3cc6-188">Если сведения об используемом атрибуте sourceAnchor недоступны, мастер проверяет состояние атрибута msDS-ConsistencyGuid в локальном каталоге Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-188">If information about the sourceAnchor attribute used isn't available, the wizard checks the state of the msDS-ConsistencyGuid attribute in your on-premises Active Directory.</span></span> <span data-ttu-id="b3cc6-189">Если для какого-то объекта в каталоге атрибут не настроен, то мастер использует msDS-ConsistencyGuid в качестве атрибута sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-189">If the attribute isn't configured on any object in the directory, the wizard uses the msDS-ConsistencyGuid as the sourceAnchor attribute.</span></span> <span data-ttu-id="b3cc6-190">Если атрибут настроен в одном или нескольких объектах в каталоге, то мастер делает вывод, что он используется другими приложениями и не подходит в качестве атрибута sourceAnchor...</span><span class="sxs-lookup"><span data-stu-id="b3cc6-190">If the attribute is configured on one or more objects in the directory, the wizard concludes the attribute is being used by other applications and is not suitable as sourceAnchor attribute...</span></span>

* <span data-ttu-id="b3cc6-191">В этом случае мастер снова начинает использовать objectGUID в качестве атрибута sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-191">In which case, the wizard falls back to using objectGUID as the sourceAnchor attribute.</span></span>

* <span data-ttu-id="b3cc6-192">Когда атрибут sourceAnchor определен, мастер сохраняет сведения в клиенте Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-192">Once the sourceAnchor attribute is decided, the wizard stores the information in your Azure AD tenant.</span></span> <span data-ttu-id="b3cc6-193">Эти сведения будут использоваться при следующей установке Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-193">The information will be used by future installation of Azure AD Connect.</span></span>

<span data-ttu-id="b3cc6-194">По завершении экспресс-установки мастер сообщает, какой атрибут был выбран в качестве атрибута привязки к источнику.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-194">Once Express installation completes, the wizard informs you which attribute has been picked as the Source Anchor attribute.</span></span>

![Мастер сообщает атрибут AD, выбранный для sourceAnchor](./media/active-directory-aadconnect-design-concepts/consistencyGuid-01.png)

#### <a name="custom-installation"></a><span data-ttu-id="b3cc6-196">Выборочная установка</span><span class="sxs-lookup"><span data-stu-id="b3cc6-196">Custom installation</span></span>
<span data-ttu-id="b3cc6-197">При выборочной установке Azure AD Connect мастер Azure AD Connect предоставляет два варианта настройки атрибута sourceAnchor:</span><span class="sxs-lookup"><span data-stu-id="b3cc6-197">When installing Azure AD Connect with Custom mode, the Azure AD Connect wizard provides two options when configuring sourceAnchor attribute:</span></span>

![Выборочная установка: настройка sourceAnchor](./media/active-directory-aadconnect-design-concepts/consistencyGuid-02.png)

| <span data-ttu-id="b3cc6-199">Настройка</span><span class="sxs-lookup"><span data-stu-id="b3cc6-199">Setting</span></span> | <span data-ttu-id="b3cc6-200">Описание</span><span class="sxs-lookup"><span data-stu-id="b3cc6-200">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b3cc6-201">Параметр "Azure управляет привязкой к источнику"</span><span class="sxs-lookup"><span data-stu-id="b3cc6-201">Let Azure manage the source anchor for me</span></span> | <span data-ttu-id="b3cc6-202">Выберите этот параметр, если вы хотите, чтобы среда Azure AD выбирала этот атрибут автоматически.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-202">Select this option if you want Azure AD to pick the attribute for you.</span></span> <span data-ttu-id="b3cc6-203">Если выбрать этот параметр, то мастер Azure AD Connect применит [логику выбора атрибута sourceAnchor, использованную при экспресс-установке](#express-installation).</span><span class="sxs-lookup"><span data-stu-id="b3cc6-203">If you select this option, Azure AD Connect wizard applies the same [sourceAnchor attribute selection logic used during Express installation](#express-installation).</span></span> <span data-ttu-id="b3cc6-204">Как и при экспресс-установке, мастер сообщит, какой атрибут был выбран в качестве атрибута привязки к источнику после завершения выборочной установки.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-204">Similar to Express installation, the wizard informs you which attribute has been picked as the Source Anchor attribute after Custom installation completes.</span></span> |
| <span data-ttu-id="b3cc6-205">Определенный атрибут</span><span class="sxs-lookup"><span data-stu-id="b3cc6-205">A specific attribute</span></span> | <span data-ttu-id="b3cc6-206">Выберите этот параметр, если вы хотите указать имеющийся атрибут AD в качестве атрибута sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-206">Select this option if you wish to specify an existing AD attribute as the sourceAnchor attribute.</span></span> |

### <a name="how-to-enable-the-consistencyguid-feature---existing-deployment"></a><span data-ttu-id="b3cc6-207">Включение функции ConsistencyGuid — существующее развертывание</span><span class="sxs-lookup"><span data-stu-id="b3cc6-207">How to enable the ConsistencyGuid feature - Existing deployment</span></span>
<span data-ttu-id="b3cc6-208">Если у вас есть развертывание Azure AD Connect, которое использует objectGUID как атрибут привязки к источнику, вы можете переключиться на использование ConsistencyGuid.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-208">If you have an existing Azure AD Connect deployment which is using objectGUID as the Source Anchor attribute, you can switch it to using ConsistencyGuid instead.</span></span>

>[!NOTE]
> <span data-ttu-id="b3cc6-209">Только более поздние версии Azure AD Connect (1.1.552.0 и выше) поддерживают переключение с ObjectGuid на ConsistencyGuid в качестве атрибута привязки к источнику.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-209">Only newer versions of Azure AD Connect (1.1.552.0 and after) supports switching from ObjectGuid to ConsistencyGuid as the Source Anchor attribute.</span></span>

<span data-ttu-id="b3cc6-210">Переключение с objectGUID на ConsistencyGuid в качестве атрибута привязки к источнику:</span><span class="sxs-lookup"><span data-stu-id="b3cc6-210">To switch from objectGUID to ConsistencyGuid as the Source Anchor attribute:</span></span>

1. <span data-ttu-id="b3cc6-211">Запустите мастер Azure AD Connect и щелкните **Настроить**, чтобы перейти на экран задач.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-211">Start the Azure AD Connect wizard and click **Configure** to go to the Tasks screen.</span></span>

2. <span data-ttu-id="b3cc6-212">Выберите параметр задачи **Настроить привязку к источнику** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-212">Select the **Configure Source Anchor** task option and click **Next**.</span></span>

   ![Включение ConsistencyGuid для существующего развертывания — шаг 2](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeployment01.png)

3. <span data-ttu-id="b3cc6-214">Введите учетные данные администратора Azure AD и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-214">Enter your Azure AD Administrator credentials and click **Next**.</span></span>

4. <span data-ttu-id="b3cc6-215">Мастер Azure AD Connect анализирует состояние атрибута msDS-ConsistencyGuid в локальном каталоге Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-215">Azure AD Connect wizard analyzes the state of the msDS-ConsistencyGuid attribute in your on-premises Active Directory.</span></span> <span data-ttu-id="b3cc6-216">Если атрибут не настроен в каком-либо объекте в каталоге, Azure AD Connect считает, что никакие другие приложения сейчас его не используют и что его можно безопасно использовать как атрибут привязки к источнику.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-216">If the attribute isn't configured on any object in the directory, Azure AD Connect concludes that no other application is currently using the attribute and is safe to use it as the Source Anchor attribute.</span></span> <span data-ttu-id="b3cc6-217">Нажмите кнопку **Next** (Далее), чтобы продолжить.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-217">Click **Next** to continue.</span></span>

   ![Включение ConsistencyGuid для существующего развертывания — шаг 4](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeployment02.png)

5. <span data-ttu-id="b3cc6-219">На экране **Готовность к настройке** щелкните **Настроить**, чтобы внести изменения в конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-219">In the **Ready to Configure** screen, click **Configure** to make the configuration change.</span></span>

   ![Включение ConsistencyGuid для существующего развертывания — шаг 5](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeployment03.png)

6. <span data-ttu-id="b3cc6-221">По завершении конфигурации мастер указывает, что msDS-ConsistencyGuid сейчас используется как атрибут привязки к источнику.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-221">Once the configuration completes, the wizard indicates that msDS-ConsistencyGuid is now being used as the Source Anchor attribute.</span></span>

   ![Включение ConsistencyGuid для существующего развертывания — шаг 6](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeployment04.png)

<span data-ttu-id="b3cc6-223">Во время анализа (шаг 4), если атрибут настроен в одном объекте в каталоге или нескольких, то мастер делает вывод, что он используется другими приложениями и возвращает ошибку, как показано на снимке экрана ниже.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-223">During the analysis (step 4), if the attribute is configured on one or more objects in the directory, the wizard concludes the attribute is being used by another application and returns an error as illustrated in the diagram below.</span></span> <span data-ttu-id="b3cc6-224">Если вы уверены, что атрибут не используется существующими приложениями, то необходимо обратиться в службу поддержки для получения сведений об устранении этой ошибки.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-224">If you are certain that the attribute isn't used by existing applications, you need to contact Support for information on how to suppress the error.</span></span>

![Включение ConsistencyGuid для существующего развертывания — ошибка](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeploymenterror.png)

### <a name="impact-on-ad-fs-or-third-party-federation-configuration"></a><span data-ttu-id="b3cc6-226">Влияние на конфигурацию AD FS или федерацию сторонних поставщиков</span><span class="sxs-lookup"><span data-stu-id="b3cc6-226">Impact on AD FS or third-party federation configuration</span></span>
<span data-ttu-id="b3cc6-227">Если вы используете Azure AD Connect для управления локальным развертыванием AD FS, то Azure AD Connect автоматически обновляет правила утверждений для использования в качестве sourceAnchor того же атрибута AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-227">If you are using Azure AD Connect to manage on-premises AD FS deployment, the Azure AD Connect automatically updates the claim rules to use the same AD attribute as sourceAnchor.</span></span> <span data-ttu-id="b3cc6-228">Это гарантирует, что утверждение ImmutableID, созданное ADFS, будет согласовано со значениями sourceAnchor, экспортированными в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-228">This ensures that the ImmutableID claim generated by ADFS is consistent with the sourceAnchor values exported to Azure AD.</span></span>

<span data-ttu-id="b3cc6-229">Если вы управляете AD FS не из Azure AD Connect или используете для аутентификации сторонние серверы федерации, то необходимо вручную обновить правила утверждений, чтобы утверждение ImmutableID было согласовано со значениями, экспортированными в Azure AD, как описано в разделе [Изменение правил утверждений служб федерации Active Directory](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-federation-management#modclaims).</span><span class="sxs-lookup"><span data-stu-id="b3cc6-229">If you are managing AD FS outside of Azure AD Connect or you are using third-party federation servers for authentication, you must manually update the claim rules for ImmutableID claim to be consistent with the sourceAnchor values exported to Azure AD as described in article section [Modify AD FS claim rules](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-federation-management#modclaims).</span></span> <span data-ttu-id="b3cc6-230">По завершении установки мастер возвращает следующее предупреждение:</span><span class="sxs-lookup"><span data-stu-id="b3cc6-230">The wizard returns the following warning after installation completes:</span></span>

![Настройка сторонней федерации](./media/active-directory-aadconnect-design-concepts/consistencyGuid-03.png)

### <a name="adding-new-directories-to-existing-deployment"></a><span data-ttu-id="b3cc6-232">Добавление новых каталогов в существующее развертывание</span><span class="sxs-lookup"><span data-stu-id="b3cc6-232">Adding new directories to existing deployment</span></span>
<span data-ttu-id="b3cc6-233">Предположим, что вы развернули Azure AD Connect с включенной функцией ConsistencyGuid и теперь хотите добавить в развертывание другой каталог.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-233">Suppose you have deployed Azure AD Connect with the ConsistencyGuid feature enabled, and now you would like to add another directory to the deployment.</span></span> <span data-ttu-id="b3cc6-234">При попытке добавить каталог мастер Azure AD Connect проверяет состояние атрибута mSDS-ConsistencyGuid в каталоге.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-234">When you try to add the directory, Azure AD Connect wizard checks the state of the mSDS-ConsistencyGuid attribute in the directory.</span></span> <span data-ttu-id="b3cc6-235">Если атрибут настроен в одном или нескольких объектах в каталоге, то мастер делает вывод, что он используется другими приложениями и возвращает ошибку, как показано на снимке экрана ниже.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-235">If the attribute is configured on one or more objects in the directory, the wizard concludes the attribute is being used by other applications and returns an error as illustrated in the diagram below.</span></span> <span data-ttu-id="b3cc6-236">Если вы уверены, что атрибут не используется существующими приложениями, то необходимо обратиться в службу поддержки для получения сведений об устранении этой ошибки.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-236">If you are certain that the attribute isn't used by existing applications, you need to contact Support for information on how to suppress the error.</span></span>

![Добавление новых каталогов в существующее развертывание](./media/active-directory-aadconnect-design-concepts/consistencyGuid-04.png)

## <a name="azure-ad-sign-in"></a><span data-ttu-id="b3cc6-238">Вход в Azure AD</span><span class="sxs-lookup"><span data-stu-id="b3cc6-238">Azure AD sign-in</span></span>
<span data-ttu-id="b3cc6-239">При интеграции локального каталога с Azure AD важно понять, как параметры синхронизации могут повлиять на способ проверки подлинности, используемый пользователем.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-239">While integrating your on-premises directory with Azure AD, it is important to understand how the synchronization settings can affect the way user authenticates.</span></span> <span data-ttu-id="b3cc6-240">Для аутентификации пользователя служба Azure AD использует имя участника-пользователя (userPrincipalName).</span><span class="sxs-lookup"><span data-stu-id="b3cc6-240">Azure AD uses userPrincipalName (UPN) to authenticate the user.</span></span> <span data-ttu-id="b3cc6-241">Однако при синхронизации пользователей необходимо тщательно выбирать атрибут, который будет использоваться в качестве значения userPrincipalName.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-241">However, when you synchronize your users, you must choose the attribute to be used for value of userPrincipalName carefully.</span></span>

### <a name="choosing-the-attribute-for-userprincipalname"></a><span data-ttu-id="b3cc6-242">Выбор атрибута для userPrincipalName</span><span class="sxs-lookup"><span data-stu-id="b3cc6-242">Choosing the attribute for userPrincipalName</span></span>
<span data-ttu-id="b3cc6-243">При выборе атрибута, который будет использоваться в Azure в качестве значения UPN (имени участника-пользователя), следует убедиться в следующем.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-243">When you are selecting the attribute for providing the value of UPN to be used in Azure one should ensure</span></span>

* <span data-ttu-id="b3cc6-244">Значения атрибута соответствуют синтаксису имени участника-пользователя (RFC 822), т. е. формат должен быть таким: username@domain.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-244">The attribute values conform to the UPN syntax (RFC 822), that is it should be of the format username@domain</span></span>
* <span data-ttu-id="b3cc6-245">Суффикс в значениях соответствует одному из подтвержденных пользовательских доменов в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-245">The suffix in the values matches to one of the verified custom domains in Azure AD</span></span>

<span data-ttu-id="b3cc6-246">В стандартных параметрах предполагается, что для атрибута выбрано значение userPrincipalName.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-246">In express settings, the assumed choice for the attribute is userPrincipalName.</span></span> <span data-ttu-id="b3cc6-247">Если атрибут userPrincipalName не содержит значение, с помощью которого пользователи должны входить в Azure, выбирайте **выборочную установку**.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-247">If the userPrincipalName attribute does not contain the value you want your users to sign in to Azure, then you must choose **Custom Installation**.</span></span>

### <a name="custom-domain-state-and-upn"></a><span data-ttu-id="b3cc6-248">Состояние и имя участника-пользователя пользовательского домена</span><span class="sxs-lookup"><span data-stu-id="b3cc6-248">Custom domain state and UPN</span></span>
<span data-ttu-id="b3cc6-249">Важно убедиться, что для суффикса имени участника-пользователя используется подтвержденный домен.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-249">It is important to ensure that there is a verified domain for the UPN suffix.</span></span>

<span data-ttu-id="b3cc6-250">Джон (John) является пользователем в contoso.com.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-250">John is a user in contoso.com.</span></span> <span data-ttu-id="b3cc6-251">Вам нужно, чтобы после синхронизации пользователей с каталогом Azure AD azurecontoso.onmicrosoft.com Джон входил в Azure с помощью локального имени участника-пользователя john@contoso.com.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-251">You want John to use the on-premises UPN john@contoso.com to sign in to Azure after you have synced users to your Azure AD directory contoso.onmicrosoft.com.</span></span> <span data-ttu-id="b3cc6-252">Для этого вам нужно сначала добавить и подтвердить contoso.com как личный домен в службе Azure AD. Только после этого вы сможете синхронизировать пользователей.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-252">To do so, you need to add and verify contoso.com as a custom domain in Azure AD before you can start syncing the users.</span></span> <span data-ttu-id="b3cc6-253">Если суффикс имени участника-пользователя Джона (contoso.com) не соответствует подтвержденному домену в службе Azure AD, то Azure AD заменяет такой суффикс на contoso.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-253">If the UPN suffix of John, for example contoso.com, does not match a verified domain in Azure AD, then Azure AD replaces the UPN suffix with contoso.onmicrosoft.com.</span></span>

### <a name="non-routable-on-premises-domains-and-upn-for-azure-ad"></a><span data-ttu-id="b3cc6-254">Не поддерживающие маршрутизацию локальные домены и имена участников-пользователей для Azure AD</span><span class="sxs-lookup"><span data-stu-id="b3cc6-254">Non-routable on-premises domains and UPN for Azure AD</span></span>
<span data-ttu-id="b3cc6-255">В некоторых организациях используются домены, не поддерживающие маршрутизацию, например contoso.local, или простые одноуровневые домены наподобие contoso.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-255">Some organizations have non-routable domains, like contoso.local, or simple single label domains like contoso.</span></span> <span data-ttu-id="b3cc6-256">В службе Azure AD нельзя подтвердить не поддерживающий маршрутизацию домен.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-256">You are not able to verify a non-routable domain in Azure AD.</span></span> <span data-ttu-id="b3cc6-257">Служба Azure AD Connect может синхронизироваться только с подтвержденным доменом в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-257">Azure AD Connect can sync to only a verified domain in Azure AD.</span></span> <span data-ttu-id="b3cc6-258">При создании каталога Azure AD служба создает маршрутизируемый домен (например, contoso.onmicrosoft.com), который становится для Azure AD доменом по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-258">When you create an Azure AD directory, it creates a routable domain that becomes default domain for your Azure AD for example, contoso.onmicrosoft.com.</span></span> <span data-ttu-id="b3cc6-259">Поэтому в данной ситуации возникает необходимость подтвердить любой другой маршрутизируемый домен, на случай если вы не хотите синхронизироваться с доменом onmicrosoft.com по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-259">Therefore, it becomes necessary to verify any other routable domain in such a scenario in case you don't want to sync to the default onmicrosoft.com domain.</span></span>

<span data-ttu-id="b3cc6-260">Дополнительные сведения о добавлении и подтверждении доменов см. в статье [Добавление имени личного домена в Azure Active Directory](../active-directory-add-domain.md).</span><span class="sxs-lookup"><span data-stu-id="b3cc6-260">Read [Add your custom domain name to Azure Active Directory](../active-directory-add-domain.md) for more info on adding and verifying domains.</span></span>

<span data-ttu-id="b3cc6-261">Azure AD Connect определяет, когда используется не поддерживающая маршрутизацию доменная среда и соответствующим образом предупреждает, чтобы вы не продолжали, не изменив стандартные параметры.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-261">Azure AD Connect detects if you are running in a non-routable domain environment and would appropriately warn you from going ahead with express settings.</span></span> <span data-ttu-id="b3cc6-262">Если вы работаете в домене, который не поддерживает маршрутизацию, имена участников-пользователей, скорее всего, тоже имеют не поддерживающий маршрутизацию суффикс.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-262">If you are operating in a non-routable domain, then it is likely that the UPN of the users have non-routable suffixes too.</span></span> <span data-ttu-id="b3cc6-263">Например, если вы работаете в домене contoso.local, служба Azure AD Connect предлагает вместо стандартных параметров использовать настраиваемые.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-263">For example, if you are running under contoso.local, Azure AD Connect suggests you to use custom settings rather than using express settings.</span></span> <span data-ttu-id="b3cc6-264">С помощью настраиваемых параметров можно указать атрибут, который следует использовать в качестве имени участника-пользователя для входа в Azure после синхронизации пользователей с Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3cc6-264">Using custom settings, you are able to specify the attribute that should be used as UPN to sign in to Azure after the users are synced to Azure AD.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b3cc6-265">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b3cc6-265">Next steps</span></span>
<span data-ttu-id="b3cc6-266">Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="b3cc6-266">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
