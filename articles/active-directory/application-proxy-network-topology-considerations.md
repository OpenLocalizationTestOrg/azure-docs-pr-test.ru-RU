---
title: "вопросы по топологии aaaNetwork при использовании прокси приложения Azure Active Directory | Документы Microsoft"
description: "В этой статье рассматриваются аспекты топологии сети при использовании прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/28/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 9b8cdd2196efeb92a74e44dde6511f7d3091a968
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="network-topology-considerations-when-using-azure-active-directory-application-proxy"></a>Аспекты топологии сети при использовании прокси приложения Azure Active Directory

В этой статье рассматриваются аспекты топологии сети при использовании прокси приложения Azure Active Directory для публикации и удаленного доступа к приложениям.

## <a name="traffic-flow"></a>Поток трафика

При публикации приложения через прокси приложения Azure AD, трафик от приложений toohello пользователей hello проходит через три подключения:

1. Hello пользователь подключается toohello прокси приложения Azure AD общей конечной точки службы в Azure
2. прокси-служба приложения Hello подключается toohello соединитель прокси приложения
3. Соединитель прокси приложения Hello подключается toohello целевого приложения

![Схема, показывающая поток трафика от пользователей tootarget приложения](./media/application-proxy-network-topologies/application-proxy-three-hops.png)

## <a name="tenant-location-and-application-proxy-service"></a>Расположение клиента и службы прокси приложения

При подписке на клиенте Azure AD hello страны, указываемые определяется hello области клиента. При включении прокси приложения hello экземпляры службы прокси приложения для вашего клиента выбран или созданные hello же регионе, что клиент Azure AD или ближайший регион tooit hello.

Например если клиент Azure AD область является hello Европейского Союза, соединителях прокси приложения используйте экземпляров службы в центрах обработки данных Azure в hello Европа. При доступ пользователей к опубликованным приложениям, их трафик проходит через экземпляров службы прокси приложения hello в этом расположении.

## <a name="considerations-for-reducing-latency"></a>Рекомендации по уменьшению задержки

Любые решения прокси увеличивают задержку сетевого подключения. Независимо от того, какой прокси-сервера или виртуальную Частную сеть, выбираемое в качестве решения удаленного доступа он всегда содержит набор серверов, включение tooinside hello подключения к корпоративной сети.

Организации обычно размещают серверные конечные точки в сети периметра. С помощью прокси приложения Azure AD Однако трафик проходит через hello прокси-службы в облаке hello пока соединители hello находятся в корпоративной сети. Сеть периметра не требуется.

Hello далее разделах toohelp Дополнительные предложения, уменьшить задержки еще больше. 

### <a name="connector-placement"></a>Расположение соединителя

Прокси приложения выбирает расположение hello экземпляров в, в зависимости от расположения клиента. Тем не менее вы получаете toodecide где tooinstall hello соединителя, предоставляя hello toodefine hello задержки энергопотреблении сетевого трафика.

При настройке службы прокси приложения hello, попросите hello следующие вопросы:

* Где находится приложение hello
* Где находятся большинство пользователей, обращающихся к находится приложение hello?
* Где находится экземпляр прокси-сервера приложения hello
* У вас уже есть выделенного сетевого подключения tooAzure центрах обработки данных настройки, таких как Azure ExpressRoute или аналогичные VPN?

Соединитель Hello имеет toocommunicate с Azure и приложений (шаги 2 и 3 в диаграмме потока трафика hello), поэтому hello размещения задержки hello hello соединителя влияет на эти два соединения. При вычислении размещения hello hello соединителя, имейте в виду hello после точки.

* Если требуется toouse ограниченного делегирования Kerberos (KCD) для единого входа hello соединитель должен tooa прямой видимости центре обработки данных. Кроме того сервер соединителя hello должен toobe домену.  
* Если вы сомневаетесь, установите hello соединителя ближе toohello приложение.

### <a name="general-approach-toominimize-latency"></a>Общий подход toominimize задержки

Можно свести к минимуму задержки hello трафика конца в конец hello путем оптимизации для каждого сетевого подключения. Каждое подключение можно оптимизировать следующим образом:

* Снижение hello расстояние между двумя концами hello прыжка hello.
* Выбор правильного сетевого tootraverse hello. Например проходящий через частную сеть, а не hello общедоступный Интернет могут выполняться быстрее, из-за toodedicated ссылки.

Если у вас есть выделенный VPN или ExpressRoute связь между Azure и корпоративной сети, можно toouse.

## <a name="focus-your-optimization-strategy"></a>Направление стратегии оптимизации

Нет мало, это можно сделать toocontrol hello соединения между пользователями и hello прокси-сервер приложения службы. Пользователи могут подключаться к приложениям из домашней сети, кафе или другой страны. Вместо этого вы можете оптимизировать hello подключения из hello прокси-сервер приложения службы toohello соединителей прокси приложения toohello приложений. Рассмотрим внедрение hello следующие шаблоны в вашей среде.

### <a name="pattern-1-put-hello-connector-close-toohello-application"></a>Шаблон 1: Hello соединитель toohello закрыть приложение помещено

Место hello соединителя закрыть toohello целевого приложения в сети клиента hello. Эта конфигурация позволяет свести к минимуму шаг 3 из диаграммы топографии hello, так как соединитель hello и приложение закрыть. 

Если соединителя требуется контроллер домена toohello прямой видимости, этот шаблон является выгодно. Большая часть наших клиентов использует этот шаблон, так как он хорошо подходит для большинства сценариев. Этот шаблон может также быть совмещено с шаблон 2 toooptimize трафик между службой hello и соединитель hello.

### <a name="pattern-2-take-advantage-of-expressroute-with-public-peering"></a>Шаблон 2. Использование подключения ExpressRoute с общедоступным пирингом

При наличии настроены для общедоступного пиринга ExpressRoute hello более быстрое подключение ExpressRoute можно использовать для трафика между прокси-сервера приложений и соединителем hello. Соединитель Hello — по-прежнему в сети, toohello закрыть приложение.

### <a name="pattern-3-take-advantage-of-expressroute-with-private-peering"></a>Шаблон 3. Использование подключения ExpressRoute с частным пирингом

Если у вас есть выделенное подключение VPN или ExpressRoute с частным пирингом между Azure и корпоративной сетью, можно использовать другой вариант. В этой конфигурации обычно считается hello виртуальной сети в Azure как расширение hello корпоративной сети. Поэтому можно установить соединитель hello в центре обработки данных Azure hello и по-прежнему удовлетворять требованиям низкой задержкой hello подключения соединитель для приложения hello.

Задержка не увеличивается, так как трафик передается через выделенное подключение. Можно также получить улучшенные задержки соединителя службы прокси приложения, поскольку hello соединитель устанавливается в расположение клиента Azure AD закрыть tooyour центра обработки данных Azure.

![Схема, демонстрирующая установку соединителя в центре обработки данных Azure](./media/application-proxy-network-topologies/application-proxy-expressroute-private.png)

### <a name="other-approaches"></a>Другие подходы

Несмотря на то, что hello посвящена эта статья является расположение, можно также изменить размещение hello лучшие характеристики задержки hello приложения tooget.

Все больше организаций перемещают сети в размещенные среды. Это позволяет им tooplace свои приложения в среде сервера, который также является частью корпоративной сети и по-прежнему находиться в домене, hello. В этом случае hello шаблонов, описанных в предыдущих разделах hello может быть применен toohello новое расположение приложения. Если вы рассматриваете этот вариант, перейдите на страницу [Доменные службы Azure Active Directory](../active-directory-domain-services/active-directory-ds-overview.md).

Кроме того, рассмотрите возможность организации соединителях с помощью [группы соединителей](active-directory-application-proxy-connectors.md) tootarget приложений, которые находятся в разных местах и сетей. 

## <a name="common-use-cases"></a>Распространенные варианты использования

В этом разделе рассматриваются несколько распространенных сценариев. Предположим, что hello клиента Azure AD (и поэтому конечной точки службы прокси-сервера) находится в hello United States (США). Hello особенности, рассматриваемые в этих вариантов использования справедливы tooother регионах мира hello.

В этих сценариях мы называем соединения "прыжками" и присваиваем им номера:

- **Прыжков 1**: toohello пользователя прокси-сервера приложения службы
- **Прыжков 2**: соединитель прокси приложения toohello службы прокси приложения
- **Перескочить 3**: прокси приложения соединителя toohello целевого приложения 

### <a name="use-case-1"></a>Вариант использования 1

**Сценарий:** приложение hello находится в сети организации в hello (США), с пользователями в hello одного региона. Не ExpressRoute или VPN hello центра обработки данных Azure и существует hello корпоративной сети.

**Рекомендация:** шаблон выполните 1, описано в предыдущем разделе hello. Если необходимо уменьшить задержку, рассмотрите возможность создать подключение ExpressRoute.

Это простой шаблон. Оптимизировать прыжка 3, поместив соединителя hello рядом приложение hello. Это также естественным выбором, так как соединитель hello обычно устанавливается вместе с прямой видимости toohello приложение и toohello эксплуатации центра обработки данных tooperform ограниченное делегирование Kerberos.

![Схема, показывающая, что пользователи, прокси-сервера, соединитель и приложения, отображаются в hello нам](./media/application-proxy-network-topologies/application-proxy-pattern1.png)

### <a name="use-case-2"></a>Вариант использования 2

**Сценарий:** приложение hello находится в сети организации в hello (США), с пользователями, распределено глобально. Не ExpressRoute или VPN hello центра обработки данных Azure и существует hello корпоративной сети.

**Рекомендация:** шаблон выполните 1, описано в предыдущем разделе hello. 

Опять же hello шаблоном является toooptimize прыжка 3, расположения соединителя hello рядом приложение hello. Прыжок 3 невысока обычно, если это же в hello области. Тем не менее прыжок 1 может быть более дороги в зависимости от расположения пользователя hello, так как пользователями в пределах Здравствуй, мир! необходимо получить доступ к экземпляру прокси приложения hello в hello США. Следует отметить, что в случае глобального распределения пользователя любые решения прокси будет иметь сходные характеристики.

![Схема, показывающая, что пользователи будут распределены глобально, но hello прокси-сервера, соединитель и приложения находятся в hello нам](./media/application-proxy-network-topologies/application-proxy-pattern2.png)

### <a name="use-case-3"></a>Вариант использования 3

**Сценарий:** приложение hello находится в сети организации в hello нам. ExpressRoute с помощью открытого пиринга существует между Azure и hello корпоративной сети.

**Рекомендация:** выполните шаблонов 1 и 2, описано в предыдущем разделе hello.

Во-первых установите соединитель hello как возможные toohello приложения. Затем система hello автоматически использует ExpressRoute прыжок 2. 

Если ссылка ExpressRoute hello использует открытый пиринг, hello трафика между прокси-сервера hello и соединитель hello поверх этой связи. Задержка для прыжка 2 будет оптимизирована.

![Схема, показывающая ExpressRoute hello прокси-сервера и соединителя](./media/application-proxy-network-topologies/application-proxy-pattern3.png)

### <a name="use-case-4"></a>Вариант использования 4

**Сценарий:** приложение hello находится в сети организации в hello нам. ExpressRoute с частного пиринга существует между Azure и hello корпоративной сети.

**Рекомендация:** шаблон выполните 3, описано в предыдущем разделе hello.

Установите соединитель hello в hello центра обработки данных Azure, подключенной toohello корпоративной сети с помощью частного пиринга ExpressRoute. 

Соединитель Hello может размещаться в центре обработки данных Azure hello. Поскольку hello соединителя по-прежнему прямой видимости toohello приложений и центра обработки данных hello через частную сеть hello, остается оптимизированного прыжка 3. Кроме того, теперь оптимизирован и прыжок 2.

![Схема, показывающая соединителя hello в центре обработки данных Azure и ExpressRoute между соединитель hello и приложения](./media/application-proxy-network-topologies/application-proxy-pattern4.png)

### <a name="use-case-5"></a>Вариант использования 5

**Сценарий:** приложение hello находится в сети организации в hello Европа, с экземпляром прокси приложения hello и большинство пользователей hello нам.

**Рекомендация:** соединитель hello месте рядом приложение hello. Поскольку Американские пользователи обращаются экземпляр прокси-сервера приложений, который происходит toobe в hello же регионе прыжок 1 не слишком затратными. Прыжок 3 оптимизирован. Рассмотрите возможность использования ExpressRoute toooptimize прыжок 2. 

![Схема, показывающая пользователей и прокси-сервера в hello США, с соединителем hello и приложения в hello Европа](./media/application-proxy-network-topologies/application-proxy-pattern5b.png)

Также в этой ситуации можно применить еще один вариант. Если большинство пользователей в организации hello в hello нам, затем скорее всего, сети расширяет toohello нам также. Установите соединитель hello в hello США и используйте приложение toohello строки hello выделенной внутренней корпоративной сети в hello ЕС. Этот позволит оптимизировать прыжки 2 и 3.

![Схема, показывающая пользователей, прокси-сервер и соединитель в США, приложение в hello Европа hello](./media/application-proxy-network-topologies/application-proxy-pattern5c.png)

## <a name="next-steps"></a>Дальнейшие действия

- [Включение прокси приложения](active-directory-application-proxy-enable.md)
- [Включение единого входа](active-directory-application-proxy-sso-using-kcd.md)
- [Включение условного доступа](active-directory-application-proxy-conditional-access.md)
- [Устранение неполадок с прокси приложения](active-directory-application-proxy-troubleshoot.md)
