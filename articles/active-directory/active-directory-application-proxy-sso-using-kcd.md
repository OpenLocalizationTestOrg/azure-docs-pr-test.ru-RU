---
title: "aaaSingle входа с помощью прокси приложения | Документы Microsoft"
description: "Описывается, как tooprovide единый вход с помощью прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: ded0d9c9-45f6-47d7-bd0f-3f7fd99ab621
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017, it-pro
ms.openlocfilehash: 0047e834cd42e057a75ebc0c5dcf860734464a05
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="kerberos-constrained-delegation-for-single-sign-on-tooyour-apps-with-application-proxy"></a><span data-ttu-id="17f01-103">Ограниченное делегирование Kerberos для-tooyour приложений с помощью прокси приложения</span><span class="sxs-lookup"><span data-stu-id="17f01-103">Kerberos Constrained Delegation for single sign-on tooyour apps with Application Proxy</span></span>

<span data-ttu-id="17f01-104">Вы можете организовать поддержку единого входа для локальных приложений, опубликованных через прокси приложения и защищенных с использованием встроенной проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="17f01-104">You can provide single sign-on for on-premises applications published through Application Proxy that are secured with Integrated Windows Authentication.</span></span> <span data-ttu-id="17f01-105">Для доступа к таким приложениям нужен билет Kerberos.</span><span class="sxs-lookup"><span data-stu-id="17f01-105">These applications require a Kerberos ticket for access.</span></span> <span data-ttu-id="17f01-106">Прокси приложения использует ограниченное делегирование Kerberos (KCD) toosupport этих приложений.</span><span class="sxs-lookup"><span data-stu-id="17f01-106">Application Proxy uses Kerberos Constrained Delegation (KCD) toosupport these applications.</span></span> 

<span data-ttu-id="17f01-107">Вы можете включить-tooyour приложений с помощью встроенной проверки подлинности Windows (IWA), предоставляя разрешение соединителей прокси приложения в tooimpersonate пользователей Active Directory.</span><span class="sxs-lookup"><span data-stu-id="17f01-107">You can enable single sign-on tooyour applications using Integrated Windows Authentication (IWA) by giving Application Proxy connectors permission in Active Directory tooimpersonate users.</span></span> <span data-ttu-id="17f01-108">соединители Hello использовать это разрешение toosend и получать от их имени маркеры.</span><span class="sxs-lookup"><span data-stu-id="17f01-108">hello connectors use this permission toosend and receive tokens on their behalf.</span></span>

## <a name="how-single-sign-on-with-kcd-works"></a><span data-ttu-id="17f01-109">Принцип работы единого входа с применением KCD</span><span class="sxs-lookup"><span data-stu-id="17f01-109">How single sign-on with KCD works</span></span>
<span data-ttu-id="17f01-110">Схема иллюстрирует поток hello, когда пользователь пытается tooaccess к локальному приложению, которое использует IWA.</span><span class="sxs-lookup"><span data-stu-id="17f01-110">This diagram explains hello flow when a user attempts tooaccess an on-prem application that uses IWA.</span></span>

![Схема проверки подлинности Microsoft Azure AD](./media/active-directory-application-proxy-sso-using-kcd/AuthDiagram.png)

1. <span data-ttu-id="17f01-112">Hello пользователь вводит приложения hello URL-адрес tooaccess hello в локальной среде с помощью прокси приложения.</span><span class="sxs-lookup"><span data-stu-id="17f01-112">hello user enters hello URL tooaccess hello on-prem application through Application Proxy.</span></span>
2. <span data-ttu-id="17f01-113">Прокси приложения перенаправляет hello запроса tooAzure AD проверки подлинности службы toopreauthenticate.</span><span class="sxs-lookup"><span data-stu-id="17f01-113">Application Proxy redirects hello request tooAzure AD authentication services toopreauthenticate.</span></span> <span data-ttu-id="17f01-114">На этом этапе Azure AD применяет все применимые политики проверки подлинности и авторизации, например многофакторную проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="17f01-114">At this point, Azure AD applies any applicable authentication and authorization policies, such as multifactor authentication.</span></span> <span data-ttu-id="17f01-115">Если проверки hello пользователя Azure AD создает маркер и отправляет его toohello пользователя.</span><span class="sxs-lookup"><span data-stu-id="17f01-115">If hello user is validated, Azure AD creates a token and sends it toohello user.</span></span>
3. <span data-ttu-id="17f01-116">Hello пользователь передает маркер tooApplication hello прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="17f01-116">hello user passes hello token tooApplication Proxy.</span></span>
4. <span data-ttu-id="17f01-117">Прокси приложения проверяет токен hello и извлекает hello имя участника пользователя (UPN) из него, а затем отправляет hello запроса, hello имени участника-пользователя и имя участника службы (SPN) toohello соединитель через безопасный канал двойной проверкой hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-117">Application Proxy validates hello token and retrieves hello User Principal Name (UPN) from it, and then sends hello request, hello UPN, and hello Service Principal Name (SPN) toohello Connector through a dually authenticated secure channel.</span></span>
5. <span data-ttu-id="17f01-118">Hello соединитель выполняет согласование ограниченное делегирование Kerberos (KCD) с hello в локальной среде AD, обезличивает пользователя hello tooget приложении toohello маркера Kerberos.</span><span class="sxs-lookup"><span data-stu-id="17f01-118">hello Connector performs Kerberos Constrained Delegation (KCD) negotiation with hello on-prem AD, impersonating hello user tooget a Kerberos token toohello application.</span></span>
6. <span data-ttu-id="17f01-119">Active Directory отправляет маркер Kerberos hello для toohello приложения hello соединителя.</span><span class="sxs-lookup"><span data-stu-id="17f01-119">Active Directory sends hello Kerberos token for hello application toohello Connector.</span></span>
7. <span data-ttu-id="17f01-120">Hello соединитель отправляет hello исходного запроса toohello сервера приложений, с использованием маркера Kerberos hello, полученного из AD.</span><span class="sxs-lookup"><span data-stu-id="17f01-120">hello Connector sends hello original request toohello application server, using hello Kerberos token it received from AD.</span></span>
8. <span data-ttu-id="17f01-121">приложение Hello отправляет ответ hello toohello соединитель, который затем возвращается toohello прокси-сервера приложения службы и, наконец, toohello пользователя.</span><span class="sxs-lookup"><span data-stu-id="17f01-121">hello application sends hello response toohello Connector, which is then returned toohello Application Proxy service and finally toohello user.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="17f01-122">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="17f01-122">Prerequisites</span></span>
<span data-ttu-id="17f01-123">Перед началом работы с единого входа для приложений IWA, убедитесь, что среде готов с hello следующие параметры и конфигурации:</span><span class="sxs-lookup"><span data-stu-id="17f01-123">Before you get started with single sign-on for IWA applications, make sure your environment is ready with hello following settings and configurations:</span></span>

* <span data-ttu-id="17f01-124">Приложения, такие как SharePoint веб-приложениям, задаются toouse встроенную проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="17f01-124">Your apps, like SharePoint Web apps, are set toouse Integrated Windows Authentication.</span></span> <span data-ttu-id="17f01-125">Дополнительные сведения см. в статье [Включение поддержки протокола проверки подлинности Kerberos](https://technet.microsoft.com/library/dd759186.aspx) или (для SharePoint) в статье [Планирование проверки подлинности Kerberos в SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span><span class="sxs-lookup"><span data-stu-id="17f01-125">For more information, see [Enable Support for Kerberos Authentication](https://technet.microsoft.com/library/dd759186.aspx), or for SharePoint see [Plan for Kerberos authentication in SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span></span>
* <span data-ttu-id="17f01-126">Все приложения должны иметь [имена субъектов-служб](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span><span class="sxs-lookup"><span data-stu-id="17f01-126">All your apps have [Service Principal Names](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span></span>
* <span data-ttu-id="17f01-127">выполнение приветствие сервера Hello соединитель, а сервер hello приложение hello, присоединенных к домену и частью hello того же домена или доверяющих доменов.</span><span class="sxs-lookup"><span data-stu-id="17f01-127">hello server running hello Connector and hello server running hello app are domain joined and part of hello same domain or trusting domains.</span></span> <span data-ttu-id="17f01-128">Дополнительные сведения о присоединении к домену см. в разделе [присоединить компьютер tooa домена](https://technet.microsoft.com/library/dd807102.aspx).</span><span class="sxs-lookup"><span data-stu-id="17f01-128">For more information on domain join, see [Join a Computer tooa Domain](https://technet.microsoft.com/library/dd807102.aspx).</span></span>
* <span data-ttu-id="17f01-129">сервер Hello hello соединителя имеет атрибут TokenGroupsGlobalAndUniversal hello tooread доступ для пользователей.</span><span class="sxs-lookup"><span data-stu-id="17f01-129">hello server running hello Connector has access tooread hello TokenGroupsGlobalAndUniversal attribute for users.</span></span> <span data-ttu-id="17f01-130">Этот параметр по умолчанию может затронула среды hello усиления безопасности.</span><span class="sxs-lookup"><span data-stu-id="17f01-130">This default setting might have been impacted by security hardening hello environment.</span></span>

### <a name="configure-active-directory"></a><span data-ttu-id="17f01-131">Настройка Active Directory</span><span class="sxs-lookup"><span data-stu-id="17f01-131">Configure Active Directory</span></span>
<span data-ttu-id="17f01-132">зависит от конфигурации Active Directory Hello, в зависимости от ли ваш соединитель прокси приложения и приложения hello находятся в hello того же домена, или нет.</span><span class="sxs-lookup"><span data-stu-id="17f01-132">hello Active Directory configuration varies, depending on whether your Application Proxy connector and hello application server are in hello same domain or not.</span></span>

#### <a name="connector-and-application-server-in-hello-same-domain"></a><span data-ttu-id="17f01-133">Соединитель и сервера приложений в hello того же домена</span><span class="sxs-lookup"><span data-stu-id="17f01-133">Connector and application server in hello same domain</span></span>
1. <span data-ttu-id="17f01-134">В Active Directory перейдите слишком**средства** > **пользователи и компьютеры**.</span><span class="sxs-lookup"><span data-stu-id="17f01-134">In Active Directory, go too**Tools** > **Users and Computers**.</span></span>
2. <span data-ttu-id="17f01-135">Выберите сервер hello hello соединителя.</span><span class="sxs-lookup"><span data-stu-id="17f01-135">Select hello server running hello connector.</span></span>
3. <span data-ttu-id="17f01-136">Щелкните его правой кнопкой мыши и выберите **Свойства** > **Делегирование**.</span><span class="sxs-lookup"><span data-stu-id="17f01-136">Right-click and select **Properties** > **Delegation**.</span></span>
4. <span data-ttu-id="17f01-137">Выберите **доверять компьютеру делегирование только службы toospecified**.</span><span class="sxs-lookup"><span data-stu-id="17f01-137">Select **Trust this computer for delegation toospecified services only**.</span></span> 
5. <span data-ttu-id="17f01-138">В разделе **toowhich службы этой учетной записи может представлять делегированные учетные данные** добавьте значение hello hello удостоверение имени участника-службы сервера приложения hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-138">Under **Services toowhich this account can present delegated credentials** add hello value for hello SPN identity of hello application server.</span></span> <span data-ttu-id="17f01-139">Это позволяет пользователям tooimpersonate hello соединитель прокси приложения в AD для приложения hello, определенные в списке hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-139">This enables hello Application Proxy Connector tooimpersonate users in AD against hello applications defined in hello list.</span></span>

   ![Окно свойств соединителя SVR (снимок экрана)](./media/active-directory-application-proxy-sso-using-kcd/Properties.jpg)

#### <a name="connector-and-application-server-in-different-domains"></a><span data-ttu-id="17f01-141">Соединитель и сервер приложения находятся в разных доменах</span><span class="sxs-lookup"><span data-stu-id="17f01-141">Connector and application server in different domains</span></span>
1. <span data-ttu-id="17f01-142">Список предварительных требований для работы с ограниченным делегированием Kerberos в разных доменах см. в статье [Ограниченное делегирование Kerberos в разных доменах](https://technet.microsoft.com/library/hh831477.aspx).</span><span class="sxs-lookup"><span data-stu-id="17f01-142">For a list of prerequisites for working with KCD across domains, see [Kerberos Constrained Delegation across domains](https://technet.microsoft.com/library/hh831477.aspx).</span></span>
2. <span data-ttu-id="17f01-143">Используйте hello `principalsallowedtodelegateto` свойство hello соединитель сервера tooenable hello прокси приложения toodelegate для сервера соединителя hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-143">Use hello `principalsallowedtodelegateto` property on hello Connector server tooenable hello Application Proxy toodelegate for hello Connector server.</span></span> <span data-ttu-id="17f01-144">сервер приложений Hello `sharepointserviceaccount` и делегирование сервера hello `connectormachineaccount`.</span><span class="sxs-lookup"><span data-stu-id="17f01-144">hello application server is `sharepointserviceaccount` and hello delegating server is `connectormachineaccount`.</span></span> <span data-ttu-id="17f01-145">Следующий пример содержит код для Windows 2012 R2:</span><span class="sxs-lookup"><span data-stu-id="17f01-145">For Windows 2012 R2, use this code as an example:</span></span>

        $connector= Get-ADComputer -Identity connectormachineaccount -server dc.connectordomain.com

        Set-ADComputer -Identity sharepointserviceaccount -PrincipalsAllowedToDelegateToAccount $connector

        Get-ADComputer sharepointserviceaccount -Properties PrincipalsAllowedToDelegateToAccount

<span data-ttu-id="17f01-146">Sharepointserviceaccount может быть учетная запись компьютера сервера SPS hello или учетная запись службы, под которой hello SPS пула приложений.</span><span class="sxs-lookup"><span data-stu-id="17f01-146">Sharepointserviceaccount can be hello SPS machine account or a service account under which hello SPS app pool is running.</span></span>

## <a name="configure-single-sign-on"></a><span data-ttu-id="17f01-147">Настройка единого входа</span><span class="sxs-lookup"><span data-stu-id="17f01-147">Configure single sign-on</span></span> 
1. <span data-ttu-id="17f01-148">Опубликуйте приложение в соответствии с toohello инструкциям, описанным в [публикации приложений с помощью прокси приложения](application-proxy-publish-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="17f01-148">Publish your application according toohello instructions described in [Publish applications with Application Proxy](application-proxy-publish-azure-portal.md).</span></span> <span data-ttu-id="17f01-149">Убедитесь, что tooselect **Azure Active Directory** как hello **метод предварительной проверки подлинности**.</span><span class="sxs-lookup"><span data-stu-id="17f01-149">Make sure tooselect **Azure Active Directory** as hello **Preauthentication Method**.</span></span>
2. <span data-ttu-id="17f01-150">После появления приложения в списке hello корпоративных приложений, выберите его и нажмите кнопку **единого входа**.</span><span class="sxs-lookup"><span data-stu-id="17f01-150">After your application appears in hello list of enterprise applications, select it and click **Single sign-on**.</span></span>
3. <span data-ttu-id="17f01-151">Режим hello единого входа слишком**встроенная проверка подлинности Windows**.</span><span class="sxs-lookup"><span data-stu-id="17f01-151">Set hello single sign-on mode too**Integrated Windows Authentication**.</span></span>  
4. <span data-ttu-id="17f01-152">Введите hello **SPN внутреннего приложения** hello сервера приложений.</span><span class="sxs-lookup"><span data-stu-id="17f01-152">Enter hello **Internal Application SPN** of hello application server.</span></span> <span data-ttu-id="17f01-153">В этом примере hello имени участника-службы для нашего опубликованного приложения является http/www.contoso.com. Toobe потребностей этого имени участника-службы в списке hello соединителя hello toowhich службы может представлять делегированные учетные данные.</span><span class="sxs-lookup"><span data-stu-id="17f01-153">In this example, hello SPN for our published application is http/www.contoso.com. This SPN needs toobe in hello list of services toowhich hello connector can present delegated credentials.</span></span> 
5. <span data-ttu-id="17f01-154">Выберите hello **делегированы идентификатора имени входа** для hello toouse соединитель от имени пользователей.</span><span class="sxs-lookup"><span data-stu-id="17f01-154">Choose hello **Delegated Login Identity** for hello connector toouse on behalf of your users.</span></span> <span data-ttu-id="17f01-155">См. дополнительные сведения о [реализации единого входа в приложения с помощью прокси приложения](#Working-with-different-on-premises-and-cloud-identities).</span><span class="sxs-lookup"><span data-stu-id="17f01-155">For more information, see [Working with different on-premises and cloud identities](#Working-with-different-on-premises-and-cloud-identities)</span></span>

   ![Дополнительная настройка приложения](./media/active-directory-application-proxy-sso-using-kcd/cwap_auth2.png)  


## <a name="sso-for-non-windows-apps"></a><span data-ttu-id="17f01-157">Единый вход для приложений не на базе Windows</span><span class="sxs-lookup"><span data-stu-id="17f01-157">SSO for non-Windows apps</span></span>
<span data-ttu-id="17f01-158">Hello поток делегирование Kerberos в прокси приложения Azure AD начинается, когда Azure AD проверяет подлинность пользователя hello в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-158">hello Kerberos delegation flow in Azure AD Application Proxy starts when Azure AD authenticates hello user in hello cloud.</span></span> <span data-ttu-id="17f01-159">После hello запрос прибывает в локальной среде, hello прокси приложения Azure AD, соединитель выдает билет Kerberos от имени пользователя hello, взаимодействуя с hello локальной службы Active Directory.</span><span class="sxs-lookup"><span data-stu-id="17f01-159">Once hello request arrives on-premises, hello Azure AD Application Proxy connector issues a Kerberos ticket on behalf of hello user by interacting with hello local Active Directory.</span></span> <span data-ttu-id="17f01-160">Этот процесс является ссылка tooas ограниченное делегирование Kerberos (KCD).</span><span class="sxs-lookup"><span data-stu-id="17f01-160">This process is referred tooas Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="17f01-161">В hello следующей фазе отправляется запрос toohello внутреннее приложение с Этот билет Kerberos.</span><span class="sxs-lookup"><span data-stu-id="17f01-161">In hello next phase, a request is sent toohello backend application with this Kerberos ticket.</span></span> <span data-ttu-id="17f01-162">Существует несколько протоколов, которые определяют, каким образом toosend например запросы.</span><span class="sxs-lookup"><span data-stu-id="17f01-162">There are several protocols that define how toosend such requests.</span></span> <span data-ttu-id="17f01-163">Большинство серверов не на базе Windows ожидают механизм Negotiate/SPNego, который теперь поддерживается в прокси приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f01-163">Most non-Windows servers expect Negotiate/SPNego that is now supported on Azure AD Application Proxy.</span></span>

<span data-ttu-id="17f01-164">Дополнительные сведения о протоколе Kerberos см. в разделе [все требуется tooknow о ограниченное делегирование Kerberos (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span><span class="sxs-lookup"><span data-stu-id="17f01-164">For more information about Kerberos, see [All you want tooknow about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span></span>

<span data-ttu-id="17f01-165">Приложения других ОС, кроме Windows, вместо доменных адресов электронной почты обычно используют имена пользователей или имена учетных записей SAM.</span><span class="sxs-lookup"><span data-stu-id="17f01-165">Non-Windows apps typically user usernames or SAM account names instead of domain email addresses.</span></span> <span data-ttu-id="17f01-166">Такой ситуации применяется tooyour приложений, необходимо tooconfigure hello делегированы входа идентификатора поля tooconnect удостоверениями облака tooyour удостоверения приложения.</span><span class="sxs-lookup"><span data-stu-id="17f01-166">If that situation applies tooyour applications, you need tooconfigure hello delegated login identity field tooconnect your cloud identities tooyour application identities.</span></span> 

## <a name="working-with-different-on-premises-and-cloud-identities"></a><span data-ttu-id="17f01-167">Реализация единого входа в приложения с помощью прокси приложения</span><span class="sxs-lookup"><span data-stu-id="17f01-167">Working with different on-premises and cloud identities</span></span>
<span data-ttu-id="17f01-168">Прокси приложения предполагает, что пользователи точно hello удостоверением в hello облачных и локальных.</span><span class="sxs-lookup"><span data-stu-id="17f01-168">Application Proxy assumes that users have exactly hello same identity in hello cloud and on-premises.</span></span> <span data-ttu-id="17f01-169">Если это не так hello, можно можно по-прежнему использовать ограниченное делегирование Kerberos для единого входа.</span><span class="sxs-lookup"><span data-stu-id="17f01-169">If that's not hello case, you can can still use KCD for single sign-on.</span></span> <span data-ttu-id="17f01-170">Настройка **делегированы идентификатора имени входа** для каждого приложения, toospecify личных данных, следует использовать при выполнении единого входа.</span><span class="sxs-lookup"><span data-stu-id="17f01-170">Configure a **Delegated login identity** for each application toospecify which identity should be used when performing single sign-on.</span></span>  

<span data-ttu-id="17f01-171">Эта возможность позволяет во многих организациях, которые используют различные локальные и облачные удостоверения toohave единого входа из hello облачных tooon локальных приложений без необходимости пользователей hello tooenter разные имена пользователей и пароли.</span><span class="sxs-lookup"><span data-stu-id="17f01-171">This capability allows many organizations that have different on-premises and cloud identities toohave SSO from hello cloud tooon-premises apps without requiring hello users tooenter different usernames and passwords.</span></span> <span data-ttu-id="17f01-172">Сюда относятся следующие виды организаций:</span><span class="sxs-lookup"><span data-stu-id="17f01-172">This includes organizations that:</span></span>

* <span data-ttu-id="17f01-173">Внутренне имеют несколько доменов (joe@us.contoso.com, joe@eu.contoso.com) и отдельный домен в облаке hello (joe@contoso.com).</span><span class="sxs-lookup"><span data-stu-id="17f01-173">Have multiple domains internally (joe@us.contoso.com, joe@eu.contoso.com) and a single domain in hello cloud (joe@contoso.com).</span></span>
* <span data-ttu-id="17f01-174">Внутренне у немаршрутизируемый доменного имени (joe@contoso.usa) и юридические один в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-174">Have non-routable domain name internally (joe@contoso.usa) and a legal one in hello cloud.</span></span>
* <span data-ttu-id="17f01-175">организации, которые не используют внутренние доменные имена (joe);</span><span class="sxs-lookup"><span data-stu-id="17f01-175">Do not use domain names internally (joe)</span></span>
* <span data-ttu-id="17f01-176">Использование различных псевдонимов в локальной среде и в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-176">Use different aliases on-prem and in hello cloud.</span></span> <span data-ttu-id="17f01-177">Например, joe-johns@contoso.com и joej@contoso.com.</span><span class="sxs-lookup"><span data-stu-id="17f01-177">For example, joe-johns@contoso.com vs. joej@contoso.com</span></span>  

<span data-ttu-id="17f01-178">С помощью прокси приложения можно выбрать какие удостоверения toouse tooobtain hello билета Kerberos.</span><span class="sxs-lookup"><span data-stu-id="17f01-178">With Application Proxy, you can select which identity toouse tooobtain hello Kerberos ticket.</span></span> <span data-ttu-id="17f01-179">Этот параметр устанавливается в каждом отдельном приложении.</span><span class="sxs-lookup"><span data-stu-id="17f01-179">This setting is per application.</span></span> <span data-ttu-id="17f01-180">Некоторые из этих параметров подходят для систем, не поддерживающих значения в формате адреса электронной почты, другие предназначены для альтернативного входа в систему.</span><span class="sxs-lookup"><span data-stu-id="17f01-180">Some of these options are suitable for systems that do not accept email address format, others are designed for alternative login.</span></span>

![Снимок экрана параметра "Делегированное удостоверение для входа"](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_upn.png)

<span data-ttu-id="17f01-182">Если используется удостоверение делегированного входа, hello значение может не быть уникальным для всех hello доменов или леса в организации.</span><span class="sxs-lookup"><span data-stu-id="17f01-182">If delegated login identity is used, hello value might not be unique across all hello domains or forests in your organization.</span></span> <span data-ttu-id="17f01-183">Этой проблемы можно избежать, опубликовав приложения дважды с использованием двух разных групп соединителей.</span><span class="sxs-lookup"><span data-stu-id="17f01-183">You can avoid this issue by publishing these applications twice using two different Connector groups.</span></span> <span data-ttu-id="17f01-184">Поскольку каждое приложение имеет аудитории другого пользователя, можно соединить его соединители tooa другого домена.</span><span class="sxs-lookup"><span data-stu-id="17f01-184">Since each application has a different user audience, you can join its Connectors tooa different domain.</span></span>

### <a name="configure-sso-for-different-identities"></a><span data-ttu-id="17f01-185">Настройка единого входа для использования разных удостоверений</span><span class="sxs-lookup"><span data-stu-id="17f01-185">Configure SSO for different identities</span></span>
1. <span data-ttu-id="17f01-186">Настройте параметры Azure AD Connect, поэтому основное удостоверение hello hello адрес электронной почты (почта).</span><span class="sxs-lookup"><span data-stu-id="17f01-186">Configure Azure AD Connect settings so hello main identity is hello email address (mail).</span></span> <span data-ttu-id="17f01-187">Это можно сделать с частью hello настройки процесса, изменив hello **имя участника-пользователя** в параметры синхронизации hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-187">This is done as part of hello customize process, by changing hello **User Principal Name** field in hello sync settings.</span></span> <span data-ttu-id="17f01-188">Эти параметры определяют, каким образом пользователи вход tooOffice365 устройств Windows 10 и других приложений, использующих Azure AD в качестве хранилища своих удостоверений.</span><span class="sxs-lookup"><span data-stu-id="17f01-188">These settings also determine how users log in tooOffice365, Windows10 devices, and other applications that use Azure AD as their identity store.</span></span>  
   <span data-ttu-id="17f01-189">![Снимок экрана "Идентификация пользователей": раскрывающееся меню "Имя участника-пользователя"](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span><span class="sxs-lookup"><span data-stu-id="17f01-189">![Identifying users screenshot - User Principal Name dropdown](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span></span>  
2. <span data-ttu-id="17f01-190">В параметры конфигурации приложения hello приложения hello хотелось бы toomodify выберите hello **делегированы идентификатора имени входа** toobe используется:</span><span class="sxs-lookup"><span data-stu-id="17f01-190">In hello Application Configuration settings for hello application you would like toomodify, select hello **Delegated Login Identity** toobe used:</span></span>

   * <span data-ttu-id="17f01-191">имя участника-пользователя (например, joe@contoso.com);</span><span class="sxs-lookup"><span data-stu-id="17f01-191">User Principal Name (for example, joe@contoso.com)</span></span>
   * <span data-ttu-id="17f01-192">дополнительное имя участника-пользователя (например, joed@contoso.local);</span><span class="sxs-lookup"><span data-stu-id="17f01-192">Alternate User Principal Name (for example, joed@contoso.local)</span></span>
   * <span data-ttu-id="17f01-193">имя пользователя, входящее в имя участника-пользователя (например, joe);</span><span class="sxs-lookup"><span data-stu-id="17f01-193">Username part of User Principal Name (for example, joe)</span></span>
   * <span data-ttu-id="17f01-194">имя пользователя, входящее в дополнительное имя участника-пользователя (например, joed);</span><span class="sxs-lookup"><span data-stu-id="17f01-194">Username part of Alternate User Principal Name (for example, joed)</span></span>
   * <span data-ttu-id="17f01-195">(Зависит от конфигурации контроллера домена hello) имя учетной записи SAM в локальной среде</span><span class="sxs-lookup"><span data-stu-id="17f01-195">On-premises SAM account name (depends on hello domain controller configuration)</span></span>

### <a name="troubleshooting-sso-for-different-identities"></a><span data-ttu-id="17f01-196">Устранение неполадок единого входа для различных удостоверений</span><span class="sxs-lookup"><span data-stu-id="17f01-196">Troubleshooting SSO for different identities</span></span>
<span data-ttu-id="17f01-197">Если имеется ошибка в hello процесс единого входа, он отображается в журнал событий на компьютере соединителя hello как объясняется в [Устранение неполадок](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="17f01-197">If there is an error in hello SSO process, it appears in hello connector machine event log as explained in [Troubleshooting](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span></span>
<span data-ttu-id="17f01-198">Однако в некоторых случаях запрос hello успешной отправки toohello внутреннее приложение во время ответа приложения в различных HTTP-ответов.</span><span class="sxs-lookup"><span data-stu-id="17f01-198">But, in some cases, hello request is successfully sent toohello backend application while this application replies in various other HTTP responses.</span></span> <span data-ttu-id="17f01-199">Устранение неполадок в этих случаях необходимо начать с изучения номер события 24029 на компьютере соединителя hello в журнале событий сеанса прокси приложения hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-199">Troubleshooting these cases should start by examining event number 24029 on hello connector machine in hello Application Proxy session event log.</span></span> <span data-ttu-id="17f01-200">в поле «user» hello в сведения о событии hello появится Hello удостоверение пользователя, который был использован для делегирования.</span><span class="sxs-lookup"><span data-stu-id="17f01-200">hello user identity that was used for delegation appears in hello “user” field within hello event details.</span></span> <span data-ttu-id="17f01-201">Выберите tooturn журнала сеанса на **Отобразить аналитический и отладочный журналы** в меню "Вид" средство просмотра событий hello.</span><span class="sxs-lookup"><span data-stu-id="17f01-201">tooturn on session log, select **Show analytic and debug logs** in hello event viewer view menu.</span></span>

## <a name="next-steps"></a><span data-ttu-id="17f01-202">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="17f01-202">Next steps</span></span>

* [<span data-ttu-id="17f01-203">Как tooconfigure toouse приложения прокси приложения ограниченное делегирование Kerberos</span><span class="sxs-lookup"><span data-stu-id="17f01-203">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [<span data-ttu-id="17f01-204">Устранение неполадок с прокси приложения</span><span class="sxs-lookup"><span data-stu-id="17f01-204">Troubleshoot issues you're having with Application Proxy</span></span>](active-directory-application-proxy-troubleshoot.md)


<span data-ttu-id="17f01-205">Для получения hello последние новости и обновления, посетите hello [блога прокси приложения](http://blogs.technet.com/b/applicationproxyblog/)</span><span class="sxs-lookup"><span data-stu-id="17f01-205">For hello latest news and updates, check out hello [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span></span>

