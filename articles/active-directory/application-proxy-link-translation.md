---
title: "Преобразование ссылок и URL-адресов прокси приложения Azure AD | Документация Майкрософт"
description: "Основные сведения о соединителях прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/10/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 57218346d236b376d2227e0ffaea6c6dd5ebe855
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="redirect-hardcoded-links-for-apps-published-with-azure-ad-application-proxy"></a>Перенаправление встроенных ссылок для приложений, опубликованных с помощью прокси приложения Azure AD

С помощью прокси приложения Azure AD ваши локальные приложения доступны удаленным пользователям или пользователям со своими устройствами. Тем не менее, некоторые приложения были разработаны с помощью локальных ссылок, внедренных в HTML-код. Эти ссылки могут работать некорректно при использовании приложения удаленно. Если несколько локальных приложений указывают друг на друга, то пользователям требуется, чтобы ссылки продолжали работать, когда их нет в офисе. 

Чтобы гарантировать работу ссылок как внутри корпоративной сети, так и за ее пределами, лучше всего настроить внешние URL-адреса приложений таким образом, чтобы они совпадали с их внутренними URL-адресами. При настройке внешних URL-адресов используйте [личные домены](active-directory-application-proxy-custom-domains.md), чтобы вместо домена прокси приложения по умолчанию адреса содержали ваше корпоративное доменное имя.

Если в своем клиенте вы не можете использовать личные домены, то функция преобразования ссылок в прокси приложения будет поддерживать работу ссылок независимо от того, где находятся ваши пользователи. При наличии приложений, которые указывают непосредственно на внутренние конечные точки или порты, эти внутренние URL-адреса можно сопоставить с опубликованными внешними URL-адресами прокси приложения. Когда преобразование ссылок включено, прокси приложения выполняет поиск по HTML, CSS и выбирает теги JavaScript для опубликованных внутренних ссылок. Затем служба прокси приложения преобразует их, чтобы пользователи могли не прерывать работу.

>[!NOTE]
>Функция преобразования ссылок предназначена для клиентов, которые по какой-либо причине не могут использовать личные домены, имеющие те же внутренние и внешние URL-адреса в своих приложениях. Прежде чем включать эту функцию, проверьте, можете ли вы использовать [личные домены в прокси приложения Azure AD](active-directory-application-proxy-custom-domains.md).
>
>А если преобразование ссылок необходимо настроить в приложении SharePoint, то см. статью [Настройка альтернативных сопоставлений доступа для SharePoint 2013](https://technet.microsoft.com/library/cc263208.aspx), где описан другой подход к сопоставлению ссылок.

## <a name="how-link-translation-works"></a>Как работает преобразование ссылок

После проверки подлинности, когда прокси-сервер передает данные приложения пользователю, прокси приложения проверяет приложение на наличие встроенных ссылок и заменяет их соответствующими опубликованными внешними URL-адресами.

Прокси приложения предполагает, что приложения имеют кодировку UTF-8. Если это не так, то укажите тип кодировки в HTTP-заголовке ответа, например `Content-Type:text/html;charset=utf-8`.

### <a name="which-links-are-affected"></a>Какие ссылки будут затронуты

Функция преобразования ссылок ищет только ссылки, которые находятся в тегах кода в основной части приложения. Прокси приложения имеет отдельную функцию для преобразования файлов cookie и URL-адресов в заголовках. 

Существует два общих типа внутренних ссылок в локальных приложениях:

- **Относительные внутренние ссылки**, которые указывают на общедоступный ресурс в локальной структуре файлов, такой как `/claims/claims.html`. Эти ссылки автоматически работают в приложениях, которые опубликованы через прокси приложения, и продолжают работать с преобразованием или без него. 
- **Встроенные внутренние ссылки** на другие локальные приложения, такие как `http://expenses`, или опубликованные файлы, например `http://expenses/logo.jpg`. Функция преобразования ссылок работает со встроенными внутренними ссылками и изменяет их для указания на внешние URL-адреса, по которым могут пройти удаленные пользователи.

### <a name="how-do-apps-link-to-each-other"></a>Как приложения ссылаются друг на друга

Преобразование ссылок включено для каждого приложения, чтобы у вас был контроль над работой пользователя на уровне отдельных приложений. Включите преобразование ссылок для приложения, если необходимо, чтобы преобразовывались ссылки *из* этого приложения, а не ссылки *на* него. 

Например, предположим, имеется три приложения, которые опубликованы через прокси приложения и содержат ссылки друг на друга: "Преимущества", "Расходы" и "Путешествия". Имеется четвертое приложение, "Отзыв", которое не опубликовано через прокси приложения.

При включении преобразования ссылок для приложения "Преимущества" ссылки на "Расходы" и "Путешествия" перенаправляются на внешние URL-адреса этих приложений, но ссылка на "Отзывы" не перенаправляется, так как у нее нет внешнего URL-адреса. Ссылки из приложений "Расходы" и "Путешествия" обратно в "Преимущества" не работают из-за того, что для этих двух приложений не было включено преобразование.

![Ссылки из приложения "Преимущества" на другие приложения при включенном преобразовании ссылок](./media/application-proxy-link-translation/one_app.png)

### <a name="which-links-arent-translated"></a>Какие ссылки не преобразовываются

Для повышения производительности и безопасности некоторые ссылки не преобразовываются:

- Ссылки вне тегов кода. 
- Ссылки в формате, отличном от HTML, CSS или JavaScript. 
- Внутренние ссылки, открываемые из других программ. Ссылки, отправленные по электронной почте или через мгновенные сообщения либо включенные в другие документы. Пользователи должны знать, как переходить по внешним URL-адресам.

Если вам необходима поддержка одного из этих двух сценариев, то вместо преобразования ссылок используйте одинаковые внутренние и внешние URL-адреса.  

## <a name="enable-link-translation"></a>Включение преобразования ссылок

Приступить к работе с преобразованием ссылок очень просто:

1. Войдите на [портал Azure](https://portal.azure.com) с использованием учетной записи администратора.
2. Перейдите в **Azure Active Directory** > **Корпоративные приложения** > **Приложения** > приложение, которым необходимо управлять > **Прокси приложения**.
3. Переведите переключатель **Translate URLs in application body** (Преобразовывать URL-адреса в коде приложения) в состояние **Да**.

   ![Выберите "Да" для преобразования URL-адресов в коде приложения](./media/application-proxy-link-translation/select_yes.png).
4. Щелкните **Сохранить**, чтобы применить изменения.

Теперь, когда пользователи получают доступ к этому приложению, прокси будет автоматически проверять внутренние ссылки, которые были опубликованы через прокси приложения на вашем клиенте.

## <a name="send-feedback"></a>Отправка отзывов

Нам нужна ваша помощь, чтобы обеспечить работу функции во всех ваших приложениях. Мы поддерживаем поиск более 30 тегов в HTML и CSS, а также рассматриваем, в каких случаях поддерживать JavaScript. Если у вас есть пример созданных ссылок, которые не были преобразованы, отправьте фрагмент кода [сюда](mailto:aadapfeedback@microsoft.com). 

## <a name="next-steps"></a>Дальнейшие действия
[Работа с пользовательскими доменами в прокси приложения Azure AD](active-directory-application-proxy-custom-domains.md)

[Настройка альтернативных сопоставлений доступа для SharePoint 2013](https://technet.microsoft.com/library/cc263208.aspx)
