---
title: "Создайте пользовательские доступом на основе ролей системы управления и назначьте внутренних и внешних пользователей в Azure | Документы Microsoft"
description: "Назначение настраиваемых ролей RBAC, созданных с помощью PowerShell и интерфейса командной строки, внутренним и внешним пользователям."
services: active-directory
documentationcenter: 
author: andreicradu
manager: mtillman
editor: kgremban
ms.assetid: 
ms.service: active-directory
ms.devlang: 
ms.topic: article
ms.tgt_pltfrm: 
ms.workload: identity
ms.date: 12/06/2017
ms.author: a-crradu
ms.reviewer: skwan
ms.custom: it-pro
ms.openlocfilehash: b3b65812d453a9f7d93ee4381c4261e685a60376
ms.sourcegitcommit: e266df9f97d04acfc4a843770fadfd8edf4fa2b7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2017
---
# <a name="intro-on-role-based-access-control"></a>Общие сведения об управлении доступом на основе ролей

Управление доступом на основе ролей (RBAC) — это единственная функция на портале Azure, с помощью которой владельцы подписки могут назначать роли другим пользователям, что позволяет им управлять определенными областями действия ресурсов в среде.

RBAC предоставляет расширенные возможности управления безопасностью для больших организаций, а также малых и средних предприятий, работающих с внешними сотрудниками, поставщиками или фрилансерами, которым требуется доступ к определенным ресурсам в среде, а не к целой инфраструктуре или любым областям, связанным с выставлением счетов. Кроме того, RBAC обеспечивает гибкость владения подпиской Azure, управляемой с использованием учетной записи администратора (роль администратора службы на уровне подписки), и позволяет нескольким пользователям работать в рамках одной подписки, но без прав администратора. Что касается управления и выставления счетов, функция RBAC гарантирует эффективное использование времени, а также предоставляет полезные возможности управления средой Azure в разных сценариях.

## <a name="prerequisites"></a>Технические условия
Чтобы реализовать возможности RBAC в среде Azure, вам потребуется:

* автономная подписка Azure, назначенная пользователю как владельцу (роль подписки);
* роль владельца подписки Azure;
* доступ к [порталу Azure](https://portal.azure.com);
* поставщики ресурсов **Microsoft.Authorization**, зарегистрированные в подписке пользователя. Дополнительные сведения о регистрации поставщиков ресурсов см. в статье [Поставщики диспетчера ресурсов, регионы, версии API и схемы](../azure-resource-manager/resource-manager-supported-services.md).

> [!NOTE]
> Подписки Office 365 или лицензии Azure Active Directory (например: доступ к Azure Active Directory) подготовленного администратора Office 365, центру не подходят для с помощью RBAC.

## <a name="how-can-rbac-be-used"></a>Как можно использовать RBAC
RBAC можно применять в трех различных областях в Azure. Вот они (от самой высокой области действия до самой низкой):

* подписка (самый высокий уровень доступа);
* Группа ресурсов
* область действия ресурса (самый низкий уровень доступа с разрешениями на доступ к отдельной области действия ресурса Azure).

## <a name="assign-rbac-roles-at-the-subscription-scope"></a>Назначение ролей RBAC в области действия подписки
Существует два распространенных примера использования RBAC (но это еще не все):

* При работе с внешними пользователями организации, которые не являются частью клиента Azure Active Directory администратора и которым предоставляется доступ на управление определенными ресурсами или целой подпиской.
* При работе с пользователями в организации, которые являются частью клиента Azure Active Directory пользователя, но входят в разные команды или группы и им требуется доступ к целой подписке или определенным группам ресурсов (областям действия ресурсов) в среде.

## <a name="grant-access-at-a-subscription-level-for-a-user-outside-of-azure-active-directory"></a>Предоставление доступа на уровне подписки внешним пользователям Azure Active Directory
Роли RBAC можно назначать только **владельцам** подписки, поэтому администратор должен войти в систему, используя имя пользователя, которому заранее назначена эта роль, или имя пользователя, используемое при создании подписки Azure.

Войдите на портал Azure как администратор. Выберите "Подписки", а затем выберите необходимую подписку.
![Колонка подписки на портале Azure](./media/role-based-access-control-create-custom-roles-for-internal-external-users/0.png) По умолчанию администратору, который приобрел подписку Azure, назначается роль **администратора учетной записи**. Сведения о ролях подписки Azure см. в статье [Добавление или изменение ролей администратора Azure, управляющих подписками и службами](/billing/billing-add-change-azure-subscription-administrator.md).

В этом примере пользователь alflanigan@outlook.com является **владельцем** бесплатной пробной версии подписки в клиенте AAD (каталог Default tenant Azure (Клиент Azure по умолчанию)). Так как этот пользователь создал подписку Azure, используя начальную учетную запись Microsoft Outlook, после добавления других пользователей в этот клиент к их учетной записи будет добавляться следующее доменное имя (по умолчанию):  **@alflaniganuoutlook.onmicrosoft.com** . Новое доменное имя состоит из имени пользователя и доменного имени пользователя, создавшего клиент, а также расширения **.onmicrosoft.com**.
Кроме того, пользователи могут войти в систему, используя имя личного домена в клиенте. Для этого сначала необходимо добавить это имя в новый клиент, а затем проверить. Дополнительные сведения о проверке имени личного домена в клиенте Azure Active Directory см. в [этой статье](/active-directory/active-directory-add-domain).

В этом примере в каталоге Default tenant Azure (Клиент Azure по умолчанию) содержатся только пользователи с доменным именем @alflanigan.onmicrosoft.com.

После выбора подписки администратор должен щелкнуть **Управление доступом (IAM)** и выбрать **Добавить новую роль**.





![Функция "Управление доступом (IAM)" на портале Azure](./media/role-based-access-control-create-custom-roles-for-internal-external-users/1.png)





![Параметр "Добавить новую роль" в области "Управление доступом (IAM)" на портале Azure](./media/role-based-access-control-create-custom-roles-for-internal-external-users/2.png)

Далее необходимо выбрать роль RBAC и пользователя, которому ее нужно назначить. В раскрывающемся меню **Роль** для администратора отображаются только встроенные роли RBAC, доступные в Azure. Подробное описание каждой роли и их назначаемых областей см. в статье [Встроенные роли для управления доступом на основе ролей в Azure](role-based-access-built-in-roles.md).

Затем необходимо добавить адрес электронной почты внешнего пользователя. Этот внешний пользователь не должен отображаться в имеющемся клиенте. Приглашенные пользователи, а также все текущие пользователи с ролью RBAC в области действия подписки отображаются в области **"Подписки > Управление доступом (IAM)"**.





![Добавить разрешения в новую роль RBAC](./media/role-based-access-control-create-custom-roles-for-internal-external-users/3.png)





![Список ролей RBAC на уровне подписки](./media/role-based-access-control-create-custom-roles-for-internal-external-users/4.png)

Пользователя chessercarlton@gmail.com пригласили стать **владельцем** бесплатной пробной версии подписки. После отправки приглашения внешний пользователь получит письмо со ссылкой активации.
![Приглашение по электронной почте стать участником роли RBAC](./media/role-based-access-control-create-custom-roles-for-internal-external-users/5.png)

Новые внешние пользователи организации не имеют атрибутов в каталоге Default tenant Azure (Клиент Azure по умолчанию). Все атрибуты создаются после предоставления этому пользователю разрешений на запись в каталоге, который связан с подпиской с назначенной ролью.





![Сообщение с приглашением стать участником роли RBAC](./media/role-based-access-control-create-custom-roles-for-internal-external-users/6.png)

Показывает внешнего пользователя в клиент Azure Active Directory теперь как внешнего пользователя и это можно просмотреть на портале Azure.





![Колонка пользователя Azure Active Directory на портале Azure](./media/role-based-access-control-create-custom-roles-for-internal-external-users/7.png)



В **пользователей** представление, распознаваемое внешних пользователей по типу другой значок в портале Azure.

Тем не менее внешний пользователь с ролью **Владелец** или **Участник** в области действия **подписки** не имеет доступа к каталогу администратора, если это разрешение ему не предоставит **глобальный администратор**. В свойствах пользователя можно определить параметр **Тип пользователя**, который имеет два значения: **Участник** и **Гость**. Участник — это зарегистрированный в каталоге пользователь, а гость — это пользователь, приглашенный в каталог из внешнего источника. Дополнительные сведения см. в статье [Как администраторы Azure Active Directory могут добавить пользователей службы совместной работы B2B?](active-directory-b2b-admin-add-users.md).

> [!NOTE]
> Убедитесь, что после ввода учетных данных на портале внешний пользователь входит в нужный каталог. Тот же пользователь может иметь доступ к нескольким каталогам и может войти в любой из них, щелкнув имя пользователя в верхнем правом углу на портале Azure и выбрав в раскрывающемся списке нужный каталог.

Будучи гостем, внешний пользователь может управлять всеми ресурсами в подписке Azure, но не имеет доступа к каталогу.





![Доступ к каталогу Azure Active Directory на портале Azure ограничен](./media/role-based-access-control-create-custom-roles-for-internal-external-users/9.png)

Azure Active Directory и подписка Azure не имеют дочерних и родительских отношений, в отличие от других ресурсов Azure (например, виртуальные машины, виртуальные сети, веб-приложения, хранилище и т. д.), которые связаны с подпиской Azure. Создание этих ресурсов, выставление счетов за использование и управление ими выполняется в рамках подписки Azure, а сама подписка используется для управления доступом к каталогу Azure. Дополнительные сведения см. в статье [Связь между подписками Azure и службой Azure Active Directory](/active-directory/active-directory-how-subscriptions-associated-directory).

Из всех встроенных ролей RBAC только роли **Владелец** и **Участник** предлагают возможности полного доступа к управлению всеми ресурсами в среде. Разница между ними заключается в том, что участник не может создавать и удалять роли RBAC. Другие встроенные роли, например **Участник виртуальных машин**, обеспечивают доступ к управлению только теми ресурсами, которые указаны в названиях этих ролей, вне зависимости от **группы ресурсов**, используемой при их создании.

К пользователю с ролью **Участник виртуальных машин**, назначенной на уровне подписки, применяются следующие разрешения и ограничения:

* просматривать все виртуальные машины независимо от даты их развертывания и группы ресурсов, к которой они принадлежат;
* полный доступ к управлению виртуальными машинами в подписке;
* не может просматривать другие типы ресурсов в подписке;
* не может изменять параметры выставления счетов.

## <a name="assign-a-built-in-rbac-role-to-an-external-user"></a>Назначение встроенной роли RBAC внешним пользователям
Для оценки разных сценариев внешнему пользователю alflanigan@gmail.com назначили роль **Участник виртуальных машин**.




![Встроенная роль "Участник виртуальных машин"](./media/role-based-access-control-create-custom-roles-for-internal-external-users/11.png)

Внешний пользователь с этой встроенной ролью может просматривать только виртуальные машины и ресурсы Resource Manager, необходимые во время развертывания, а также управлять ими. Разработчиками предусмотрено эти ограниченные роли обеспечивают доступ только к их соответствующие ресурсы, созданные на портале Azure.



![Обзор роли "Участник виртуальных машин" на портале Azure](./media/role-based-access-control-create-custom-roles-for-internal-external-users/12.png)

## <a name="grant-access-at-a-subscription-level-for-a-user-in-the-same-directory"></a>Предоставление доступа на уровне подписки пользователям в том же каталоге
Этот процесс аналогичен добавлению внешнего пользователя и в отношении администратора, предоставляющего роль RBAC, и пользователя, которому эта роль назначается. Отличие заключается в том, что приглашенный пользователь не получит приглашение по электронной почте, так как после входа все области действия ресурсов в подписке будут доступны на панели мониторинга.

## <a name="assign-rbac-roles-at-the-resource-group-scope"></a>Назначение ролей RBAC в области действия группы ресурсов
Процесс назначения роли RBAC внешним и внутренним пользователям (в том же каталоге) в области действия **группы ресурсов** и на уровне подписки аналогичен. Пользователи с ролью RBAC могут просматривать в среде только группу ресурсов, к которой им предоставлен доступ, щелкнув значок **Группы ресурсов** на портале Azure.

## <a name="assign-rbac-roles-at-the-resource-scope"></a>Назначение ролей RBAC в области действия ресурсов
Процесс назначения роли RBAC в области действия ресурсов, на уровне подписки и на уровне группы ресурсов аналогичен. В обоих сценариях используется тот же рабочий процесс. Опять же, пользователи с ролью RBAC могут просматривать только те элементы, к которым им предоставлен доступ. Эти ресурсы отображаются на вкладке **Все ресурсы** или непосредственно на панели мониторинга.

Важный аспект, который следует учитывать при назначении роли RBAC на уровне группы ресурсов или на уровне ресурсов, — это то, что пользователи должны войти в нужный каталог.





![Вход в каталог на портале Azure](./media/role-based-access-control-create-custom-roles-for-internal-external-users/13.png)

## <a name="assign-rbac-roles-for-an-azure-active-directory-group"></a>Назначение ролей RBAC группе Azure Active Directory
Все сценарии с использованием ролей RBAC на трех различных уровнях в Azure обеспечивают права на развертывание, администрирование различных ресурсов и управление ими, не управляя личной подпиской. Независимо от того, назначена ли роль RBAC на уровне подписки, группы ресурсов или ресурса, все созданные пользователями ресурсы оплачиваются в рамках подписки Azure, к которой они имеют доступ. Таким образом, пользователи с правами администратора выставления счетов всей подписки Azure имеют полное представление о потреблении ресурсов, независимо от того, кто ими управляет.

В более крупных организациях роли RBAC можно таким же образом применять к группам Azure Active Directory, учитывая то, что администраторы хотят предоставлять доступ командам или целым отделам, а не отдельно каждому пользователю. Это позволяет эффективно использовать время, а также предоставляет полезные возможности управления. Чтобы проиллюстрировать этот момент, мы назначили одной из групп в клиенте роль **Участник** на уровне подписки.





![Добавление роли RBAC группе AAD](./media/role-based-access-control-create-custom-roles-for-internal-external-users/14.png)

Подготовка этих групп безопасности и управление ими выполняется только в Azure Active Directory.

## <a name="create-a-custom-rbac-role-to-open-support-requests-using-powershell"></a>Создание настраиваемой роли RBAC с разрешением на открытие запросов в службу поддержки с помощью PowerShell
Встроенные роли RBAC, доступные в Azure, предоставляют определенные уровни разрешений, исходя из доступных ресурсов в среде. Но если эти роли не соответствуют требованиям администратора, доступ можно ограничить еще больше, создав настраиваемые роли RBAC.

Создание настраиваемых ролей RBAC подразумевает изменение одной из встроенных ролей RBAC и ее возвращение в среду. Скачивание и отправка роли осуществляется с помощью PowerShell или интерфейса командной строки.

При создании настраиваемой роли, которая предоставляет доступ на уровне подписки, а также позволяет приглашенным пользователям открывать запросы в службу поддержки, важно учитывать предварительные требования.

В этом примере мы настроили встроенную роль **Читатель**, которая позволяет пользователям просматривать все области действия ресурсов, но не создавать или изменять их, и добавили в нее разрешение на открытие запросов в службу поддержки.

Первое действие при экспорте роли **Читатель** выполняется в среде PowerShell, запущенной с повышенным уровнем разрешений (от имени администратора).

```
Login-AzureRMAccount

Get-AzureRMRoleDefinition -Name "Reader"

Get-AzureRMRoleDefinition -Name "Reader" | ConvertTo-Json | Out-File C:\rbacrole2.json

```





![Снимок экрана PowerShell с ролью RBAC "Читатель"](./media/role-based-access-control-create-custom-roles-for-internal-external-users/15.png)

Затем необходимо извлечь шаблон JSON роли.





![Шаблон JSON настраиваемой роли RBAC "Читатель"](./media/role-based-access-control-create-custom-roles-for-internal-external-users/16.png)

Типичная роль RBAC состоит из трех основных разделов: **Actions**, **NotActions** и **AssignableScopes**.

В разделе **Actions** перечислены все разрешенные операции этой роли. Важно понимать, что каждое действие назначается из поставщика ресурсов. В этом случае для создания запросов в службу поддержки в списке должен находиться поставщик ресурсов **Microsoft.Support**.

Чтобы просмотреть все доступные и зарегистрированные в подписке поставщики ресурсов, можно использовать PowerShell.
```
Get-AzureRMResourceProvider

```
Кроме того, вы также можете проверить все доступные командлеты PowerShell для управления поставщиками ресурсов.
    ![Снимок экрана PowerShell для управления поставщиком ресурсов](./media/role-based-access-control-create-custom-roles-for-internal-external-users/17.png)

Чтобы ограничить все действия конкретной роли RBAC, поставщики ресурсов перечислены в разделе **NotActions**.
И наконец, роль RBAC обязательно должна содержать явные идентификаторы подписки, в которой она назначена. Идентификаторы подписки перечислены в разделе **AssignableScopes**. Если они не указаны, вы не сможете импортировать роль в подписку.

После создания и настройки роли RBAC их необходимо импортировать обратно в среду.

```
New-AzureRMRoleDefinition -InputFile "C:\rbacrole2.json"

```

В этом примере мы присвоили этой настраиваемой роли RBAC имя Reader support tickets access level. Пользователи с этой ролью могут просматривать все ресурсы в подписке, а также открывать запросы в службу поддержки.

> [!NOTE]
> Только две встроенные роли RBAC позволяют открывать запросы в службу поддержки: **Владелец** и **Участник**. Чтобы разрешить пользователю открывать запросы в службу поддержки, ему необходимо назначить роль RBAC только на уровне подписки, так как все эти запросы создаются на основе подписки Azure.

Мы назначили эту новую настраиваемую роль пользователю в том же каталоге.





![Снимок экрана настраиваемой роли RBAC, импортированной на портал Azure](./media/role-based-access-control-create-custom-roles-for-internal-external-users/18.png)





![Снимок экрана назначения импортированной настраиваемой роли RBAC пользователю в том же каталоге](./media/role-based-access-control-create-custom-roles-for-internal-external-users/19.png)





![Снимок экрана с разрешениями импортированной настраиваемой роли RBAC](./media/role-based-access-control-create-custom-roles-for-internal-external-users/20.png)

Примеры разрешений и ограничений настраиваемой роли RBAC (дополнительные сведения об ограничениях см. ниже):
* может создавать запросы в службу поддержки;
* не может создавать области действия ресурсов (например, виртуальная машина);
* не может создавать группы ресурсов.





![Снимок экрана настраиваемой роли RBAC, используемой для создания запросов в службу поддержки](./media/role-based-access-control-create-custom-roles-for-internal-external-users/21.png)





![Снимок экрана настраиваемой роли RBAC, которая не имеет разрешений на создание виртуальных машин](./media/role-based-access-control-create-custom-roles-for-internal-external-users/22.png)





![Снимок экрана настраиваемой роли RBAC, которая не имеет разрешений на создание групп ресурсов](./media/role-based-access-control-create-custom-roles-for-internal-external-users/23.png)

## <a name="create-a-custom-rbac-role-to-open-support-requests-using-azure-cli"></a>Создание настраиваемой роли RBAC с разрешением на открытие запросов в службу поддержки с помощью Azure CLI
На компьютерах Mac, на которых нет доступа к PowerShell, создать настраиваемую роль можно с помощью Azure CLI.

Процесс создания аналогичен. Единственное отличие заключается в том, что при использовании интерфейса командной строки вы не сможете скачать шаблон JSON, но его можно просмотреть.

В этом примере мы используем встроенную роль **Backup Reader** (Читатель резервных копий).

```

azure role show "backup reader" --json

```





![Снимок экрана интерфейса командной строки с ролью Backup Reader (Читатель резервных копий)](./media/role-based-access-control-create-custom-roles-for-internal-external-users/24.png)

Чтобы добавить разрешение на открытие запросов в службу поддержки, необходимо скопировать свойства в шаблоне JSON и изменить роль в Visual Studio, а затем добавить поставщик ресурсов **Microsoft.Support** в разделы **Actions**. При этом пользователю по-прежнему будет назначена роль читателя в резервных хранилищах. Кроме того, необходимо добавить идентификатор подписки, в которой эта роль будет назначена, в разделе **AssignableScopes**.

```

azure role create --inputfile <path>

```





![Снимок экрана интерфейса командной строки во время импорта настраиваемой роли RBAC](./media/role-based-access-control-create-custom-roles-for-internal-external-users/25.png)

Новая роль теперь доступна на портале Azure. Процесс назначения такой же, как и в предыдущих примерах.





![Снимок экрана портала Azure с настраиваемой ролью RBAC, созданной с помощью CLI 1.0](./media/role-based-access-control-create-custom-roles-for-internal-external-users/26.png)

По данным конференции Build 2017 служба Azure Cloud Shell теперь общедоступна. Azure Cloud Shell — это дополнение к интегрированной среде разработки и порталу Azure. Эта служба предоставляет браузерную оболочку, проходящую аутентификацию и размещенную в Azure. Ее можно установить на компьютере вместо интерфейса командной строки.





![Azure Cloud Shell](./media/role-based-access-control-create-custom-roles-for-internal-external-users/27.png)
