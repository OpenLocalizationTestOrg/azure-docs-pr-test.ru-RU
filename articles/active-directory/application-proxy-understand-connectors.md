---
title: "Сведения о соединителях прокси приложения Azure AD | Документация Майкрософт"
description: "Основные сведения о соединителях прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/03/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: c18d0a2bff654573e6e28a7cd7fad853b3a11346
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="understand-azure-ad-application-proxy-connectors"></a><span data-ttu-id="47771-103">Сведения о соединителях прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="47771-103">Understand Azure AD Application Proxy connectors</span></span>

<span data-ttu-id="47771-104">Соединители являются основой для работы прокси приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="47771-104">Connectors are what make Azure AD Application Proxy possible.</span></span> <span data-ttu-id="47771-105">Они просты в использовании, развертывании и обслуживании. К тому же они очень производительны.</span><span class="sxs-lookup"><span data-stu-id="47771-105">They are simple, easy to deploy and maintain, and super powerful.</span></span> <span data-ttu-id="47771-106">В этой статье объясняется, что такое соединители, как они работают, и приводится несколько рекомендаций по оптимизации развертывания.</span><span class="sxs-lookup"><span data-stu-id="47771-106">This article discusses what connectors are, how they work, and some suggestions for how to optimize your deployment.</span></span> 

## <a name="what-is-an-application-proxy-connector"></a><span data-ttu-id="47771-107">Что такое соединитель прокси приложения</span><span class="sxs-lookup"><span data-stu-id="47771-107">What is an Application Proxy connector</span></span>

<span data-ttu-id="47771-108">Соединители — это упрощенные агенты, которые размещены в локальной среде. Они помогают устанавливать исходящие подключения к прокси приложения службы.</span><span class="sxs-lookup"><span data-stu-id="47771-108">Connectors are lightweight agents that sit on-premises and facilitate the outbound connection to the Application Proxy service.</span></span> <span data-ttu-id="47771-109">Соединители необходимо установить на сервере Windows с доступом ко внутреннему приложению.</span><span class="sxs-lookup"><span data-stu-id="47771-109">Connectors must be installed on a Windows Server that has access to the backend application.</span></span> <span data-ttu-id="47771-110">Соединители можно организовать в группы соединителей, каждая из которых обрабатывает трафик определенных приложений.</span><span class="sxs-lookup"><span data-stu-id="47771-110">You can organize connectors into connector groups, with each group handling traffic to specific applications.</span></span> <span data-ttu-id="47771-111">Соединители распределяют нагрузку автоматически и могут помочь оптимизировать структуру сети.</span><span class="sxs-lookup"><span data-stu-id="47771-111">Connectors load-balance automatically, and can help to optimize your network structure.</span></span> 

## <a name="requirements-and-deployment"></a><span data-ttu-id="47771-112">Требования и развертывание</span><span class="sxs-lookup"><span data-stu-id="47771-112">Requirements and deployment</span></span>

<span data-ttu-id="47771-113">Чтобы успешно развернуть прокси приложения, необходим по крайней мере один соединитель, но мы рекомендуем использовать не меньше двух, чтобы повысить гибкость.</span><span class="sxs-lookup"><span data-stu-id="47771-113">To deploy Application Proxy successfully, you need at least one connector, but we recommend two or more for greater resiliency.</span></span> <span data-ttu-id="47771-114">Установите соединитель на компьютер Windows Server 2012 R2 или Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="47771-114">Install the connector on a Windows Server 2012 R2 or 2016 machine.</span></span> <span data-ttu-id="47771-115">Соединителю нужен доступ к службе прокси приложения, а также к локальным приложениям, которые вы публикуете.</span><span class="sxs-lookup"><span data-stu-id="47771-115">The connector needs to be able to communicate with the Application Proxy service as well as the on-premises applications that you publish.</span></span> 

<span data-ttu-id="47771-116">Дополнительные сведения о требованиях к сети для сервера соединителя см. в разделе [Начало работы с прокси приложения и установка соединителя](active-directory-application-proxy-enable.md).</span><span class="sxs-lookup"><span data-stu-id="47771-116">For more information about the network requirements for the connector server, see [Get started with Application Proxy and install a connector](active-directory-application-proxy-enable.md).</span></span>

## <a name="maintenance"></a><span data-ttu-id="47771-117">Обслуживание, </span><span class="sxs-lookup"><span data-stu-id="47771-117">Maintenance</span></span>
<span data-ttu-id="47771-118">Соединители и служба отвечают за выполнение задач, связанных с высоким уровнем доступности.</span><span class="sxs-lookup"><span data-stu-id="47771-118">The connectors and the service take care of all the high availability tasks.</span></span> <span data-ttu-id="47771-119">Их можно добавлять или удалять динамически.</span><span class="sxs-lookup"><span data-stu-id="47771-119">They can be added or removed dynamically.</span></span> <span data-ttu-id="47771-120">Когда поступает новый запрос, он перенаправляется на один из доступных соединителей.</span><span class="sxs-lookup"><span data-stu-id="47771-120">Each time a new request arrives it is routed to one of the connectors that is currently available.</span></span> <span data-ttu-id="47771-121">Если соединитель временно недоступен, он перестает реагировать на трафик.</span><span class="sxs-lookup"><span data-stu-id="47771-121">If a connector is temporarily not available, it doesn't respond to this traffic.</span></span>

<span data-ttu-id="47771-122">Соединители не поддерживают отслеживание состояния и не хранят данные конфигурации на компьютере.</span><span class="sxs-lookup"><span data-stu-id="47771-122">The connectors are stateless and have no configuration data on the machine.</span></span> <span data-ttu-id="47771-123">Единственные данные, которые они хранят, — это параметры подключения к службе и ее сертификат аутентификации.</span><span class="sxs-lookup"><span data-stu-id="47771-123">The only data they store is the settings for connecting the service and its authentication certificate.</span></span> <span data-ttu-id="47771-124">При подключении к службе соединители извлекают все необходимые данные конфигурации и обновляют их каждые несколько минут.</span><span class="sxs-lookup"><span data-stu-id="47771-124">When they connect to the service, they pull all the required configuration data and refresh it every couple of minutes.</span></span>

<span data-ttu-id="47771-125">Они также опрашивают сервер, чтобы узнать, появилась ли более новая версия соединителя.</span><span class="sxs-lookup"><span data-stu-id="47771-125">Connectors also poll the server to find out whether there is a newer version of the connector.</span></span> <span data-ttu-id="47771-126">Если такая версия будет найдена, соединители обновятся.</span><span class="sxs-lookup"><span data-stu-id="47771-126">If one is found, the connectors update themselves.</span></span>

<span data-ttu-id="47771-127">Соединители можно отслеживать с компьютера, на котором они выполняются, с помощью журнала событий и счетчиков производительности.</span><span class="sxs-lookup"><span data-stu-id="47771-127">You can monitor your connectors from the machine they are running on, using either the event log and performance counters.</span></span> <span data-ttu-id="47771-128">Их состояние можно также просмотреть на портале Azure, на странице прокси приложения.</span><span class="sxs-lookup"><span data-stu-id="47771-128">Or you can view their status from the Application Proxy page of the Azure portal:</span></span>

 ![Соединители прокси приложения Azure AD](./media/application-proxy-understand-connectors/app-proxy-connectors.png)

<span data-ttu-id="47771-130">Вам не требуется вручную удалять неиспользуемые соединители.</span><span class="sxs-lookup"><span data-stu-id="47771-130">You don't have to manually delete connectors that are unused.</span></span> <span data-ttu-id="47771-131">Выполняясь, соединитель остается активным, так как подключается к службе.</span><span class="sxs-lookup"><span data-stu-id="47771-131">When a connector is running, it remains active as it connects to the service.</span></span> <span data-ttu-id="47771-132">Неиспользуемые соединители помечаются как _неактивные_ и удаляются спустя 10 дней бездействия.</span><span class="sxs-lookup"><span data-stu-id="47771-132">Unused connectors are tagged as _inactive_ and are removed after 10 days of inactivity.</span></span> <span data-ttu-id="47771-133">Если вы хотите удалить соединитель, то удалите с сервера службу соединителя и службу средства обновления.</span><span class="sxs-lookup"><span data-stu-id="47771-133">If you do want to uninstall a connector, though, uninstall both the Connector service and the Updater service from the server.</span></span> <span data-ttu-id="47771-134">Перезагрузите компьютер, чтобы полностью удалить службу.</span><span class="sxs-lookup"><span data-stu-id="47771-134">Restart your computer to fully remove the service.</span></span>

## <a name="automatic-updates"></a><span data-ttu-id="47771-135">Автоматическое обновление</span><span class="sxs-lookup"><span data-stu-id="47771-135">Automatic updates</span></span>

<span data-ttu-id="47771-136">Azure AD обеспечивает автоматическое обновление всех развертываемых соединителей.</span><span class="sxs-lookup"><span data-stu-id="47771-136">Azure AD provides automatic updates for all the connectors that you deploy.</span></span> <span data-ttu-id="47771-137">Пока служба средства обновления соединителей прокси приложения работает, соединители будут обновляться автоматически.</span><span class="sxs-lookup"><span data-stu-id="47771-137">As long as the Application Proxy Connector Updater service is running, your connectors update automatically.</span></span> <span data-ttu-id="47771-138">Если служба обновления соединителей не отображается на сервере, для получения обновлений необходимо [переустановить соединитель](active-directory-application-proxy-enable.md).</span><span class="sxs-lookup"><span data-stu-id="47771-138">If you don’t see the Connector Updater service on your server, you need to [reinstall your connector](active-directory-application-proxy-enable.md) to get any updates.</span></span> 

<span data-ttu-id="47771-139">Если вы не хотите дожидаться, когда очередь дойдет до вашего соединителя, вы можете выполнить обновление вручную.</span><span class="sxs-lookup"><span data-stu-id="47771-139">If you don't want to wait for an automatic update to come to your connector, you can perform a manual upgrade.</span></span> <span data-ttu-id="47771-140">Перейдите на [страницу скачивания соединителя](https://download.msappproxy.net/subscription/d3c8b69d-6bf7-42be-a529-3fe9c2e70c90/connector/download) на сервере, где находится соединитель, и выберите команду **Скачать**.</span><span class="sxs-lookup"><span data-stu-id="47771-140">Go to the [connector download page](https://download.msappproxy.net/subscription/d3c8b69d-6bf7-42be-a529-3fe9c2e70c90/connector/download) on the server where your connector is located and select **Download**.</span></span> <span data-ttu-id="47771-141">Запустится обновление локального соединителя.</span><span class="sxs-lookup"><span data-stu-id="47771-141">This process kicks off an upgrade for the local connector.</span></span> 

<span data-ttu-id="47771-142">Если клиент имеет несколько соединителей, автоматическое обновление производится для каждого соединителя поочередно в каждой группе, что позволяет избежать простоев в среде.</span><span class="sxs-lookup"><span data-stu-id="47771-142">For tenants with multiple connectors, the automatic updates target one connector at a time in each group to prevent downtime in your environment.</span></span> 

<span data-ttu-id="47771-143">При обновлении соединителя могут возникать простои в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="47771-143">You may experience downtime when your connector updates if:</span></span>  
- <span data-ttu-id="47771-144">У вас только один соединитель.</span><span class="sxs-lookup"><span data-stu-id="47771-144">You only have one connector.</span></span> <span data-ttu-id="47771-145">Чтобы избежать такого простоя и обеспечить высокий уровень доступности, установите второй соединитель и [создайте группу соединителей](active-directory-application-proxy-connectors-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="47771-145">To avoid this downtime and improve high availability, we recommend you install a second connector and [create a connector group](active-directory-application-proxy-connectors-azure-portal.md).</span></span>  
- <span data-ttu-id="47771-146">Соединитель выполнял транзакцию в момент начала обновления.</span><span class="sxs-lookup"><span data-stu-id="47771-146">A connector was in the middle of a transaction when the update began.</span></span> <span data-ttu-id="47771-147">Хотя исходная транзакция утеряна, браузер должен автоматически повторить операцию. Вы также можете обновить страницу.</span><span class="sxs-lookup"><span data-stu-id="47771-147">Although the initial transaction is lost, your browser should automatically retry the operation or you can refresh your page.</span></span> <span data-ttu-id="47771-148">При повторном запросе трафик направляется на резервный соединитель.</span><span class="sxs-lookup"><span data-stu-id="47771-148">When the request is resent, the traffic is routed to a backup connector.</span></span>

## <a name="creating-connector-groups"></a><span data-ttu-id="47771-149">Создание групп соединителей</span><span class="sxs-lookup"><span data-stu-id="47771-149">Creating connector groups</span></span>

<span data-ttu-id="47771-150">Группы соединителей позволяют назначить определенные соединители для конкретных приложений.</span><span class="sxs-lookup"><span data-stu-id="47771-150">Connector groups enable you to assign specific connectors to serve specific applications.</span></span> <span data-ttu-id="47771-151">Несколько соединителей можно сгруппировать и назначить каждое приложение группе.</span><span class="sxs-lookup"><span data-stu-id="47771-151">You can group a number of connectors together, and then assign each application to a group.</span></span> 

<span data-ttu-id="47771-152">Группы соединителей упрощают управление крупными развертываниями.</span><span class="sxs-lookup"><span data-stu-id="47771-152">Connector groups make it easier to manage large deployments.</span></span> <span data-ttu-id="47771-153">Они также сокращают задержку для клиентов, приложения которых размещены в различных регионах, так как можно создать группы соединителей на основе расположения только для локальных приложений.</span><span class="sxs-lookup"><span data-stu-id="47771-153">They also improve latency for tenants that have applications hosted in different regions, because you can create location-based connector groups to serve only local applications.</span></span> 

<span data-ttu-id="47771-154">Дополнительные сведения о группах соединителей см. в статье [Публикация приложений в отдельных сетях и расположениях с помощью групп соединителей](active-directory-application-proxy-connectors-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="47771-154">To learn more about connector groups, see [Publish applications on separate networks and locations using connector groups](active-directory-application-proxy-connectors-azure-portal.md).</span></span>

## <a name="security-and-networking"></a><span data-ttu-id="47771-155">Безопасность и сеть</span><span class="sxs-lookup"><span data-stu-id="47771-155">Security and networking</span></span>

<span data-ttu-id="47771-156">Соединители можно устанавливать в любом месте в сети. Поэтому они могут отправлять запросы к службе прокси приложения.</span><span class="sxs-lookup"><span data-stu-id="47771-156">Connectors can be installed anywhere on the network that allows them to send requests to the Application Proxy service.</span></span> <span data-ttu-id="47771-157">Вам достаточно лишь обеспечить доступ к вашим приложениям с компьютера, на котором выполняется соединитель.</span><span class="sxs-lookup"><span data-stu-id="47771-157">What's important is that the computer running the connector also has access to your apps.</span></span> <span data-ttu-id="47771-158">Можно установить соединители в корпоративной сети или на виртуальной машине, работающей в облаке.</span><span class="sxs-lookup"><span data-stu-id="47771-158">You can install connectors inside of your corporate network or on a virtual machine that runs in the cloud.</span></span> <span data-ttu-id="47771-159">Соединители могут работать в сети периметра, но это необязательно, так как весь трафик является исходящим, поэтому сеть защищена.</span><span class="sxs-lookup"><span data-stu-id="47771-159">Connectors can run within a demilitarized zone (DMZ), but it's not necessary because all traffic is outbound so your network stays secure.</span></span>

<span data-ttu-id="47771-160">Соединители отправляют только исходящие запросы.</span><span class="sxs-lookup"><span data-stu-id="47771-160">Connectors only send outbound requests.</span></span> <span data-ttu-id="47771-161">Исходящий трафик отправляется в службу прокси приложения и в опубликованные приложения.</span><span class="sxs-lookup"><span data-stu-id="47771-161">The outbound traffic is sent to the Application Proxy service and to the published applications.</span></span> <span data-ttu-id="47771-162">Нет необходимости открывать входящие порты, так как после установления сеанса трафик передается в обе стороны.</span><span class="sxs-lookup"><span data-stu-id="47771-162">You don't have to open inbound ports because traffic flows both ways once a session is established.</span></span> <span data-ttu-id="47771-163">Нет необходимости настраивать распределение нагрузки между соединителями или прохождение входящего трафика через брандмауэры.</span><span class="sxs-lookup"><span data-stu-id="47771-163">You don't have to set up load balancing between the connectors or configure inbound access through your firewalls.</span></span> 

<span data-ttu-id="47771-164">Дополнительные сведения о настройке правил брандмауэра для исходящего трафика см. в статье [Работа с имеющимися локальными прокси-серверами](application-proxy-working-with-proxy-servers.md).</span><span class="sxs-lookup"><span data-stu-id="47771-164">For more information about configuring outbound firewall rules, see [Work with existing on-premises proxy servers](application-proxy-working-with-proxy-servers.md).</span></span>

<span data-ttu-id="47771-165">Воспользуйтесь [средством проверки портов соединителей прокси-службы приложения Azure AD](https://aadap-portcheck.connectorporttest.msappproxy.net/), чтобы проверить, сможет ли ваш соединитель подключиться к прокси-службе приложения.</span><span class="sxs-lookup"><span data-stu-id="47771-165">Use the [Azure AD Application Proxy Connector Ports Test Tool](https://aadap-portcheck.connectorporttest.msappproxy.net/) to verify that your connector can reach the Application Proxy service.</span></span> <span data-ttu-id="47771-166">Как минимум следует убедиться, что для региона Central US (Центральная часть США) и ближайшего к вам региона отображаются все зеленые флажки.</span><span class="sxs-lookup"><span data-stu-id="47771-166">At a minimum, make sure that the Central US region and the region closest to you have all green checkmarks.</span></span> <span data-ttu-id="47771-167">Учитывайте также, что большее число зеленых флажков означает большую устойчивость.</span><span class="sxs-lookup"><span data-stu-id="47771-167">Beyond that, more green checkmarks means greater resiliency.</span></span> 

## <a name="performance-and-scalability"></a><span data-ttu-id="47771-168">Производительность и масштабирование</span><span class="sxs-lookup"><span data-stu-id="47771-168">Performance and scalability</span></span>

<span data-ttu-id="47771-169">Для службы прокси приложения масштабирование выполняется прозрачно, но масштабирование соединителей может стать важным фактором.</span><span class="sxs-lookup"><span data-stu-id="47771-169">Scale for the Application Proxy service is transparent, but scale is a factor for connectors.</span></span> <span data-ttu-id="47771-170">Для обработки пикового трафика необходимо иметь достаточное количество соединителей.</span><span class="sxs-lookup"><span data-stu-id="47771-170">You need to have enough connectors to handle peak traffic.</span></span> <span data-ttu-id="47771-171">Настройка балансировки нагрузки не требуется, так как все соединители внутри группы соединителей автоматически распределяют нагрузку.</span><span class="sxs-lookup"><span data-stu-id="47771-171">However, you don't need to configure load balancing because all connectors within a connector group automatically load balance.</span></span>

<span data-ttu-id="47771-172">Соединители не поддерживают отслеживание состояния, поэтому для них не имеет значения количество пользователей или сеансов.</span><span class="sxs-lookup"><span data-stu-id="47771-172">Since connectors are stateless, they are not affected by the number of users or sessions.</span></span> <span data-ttu-id="47771-173">Но они зависят от количества запросов и объема полезных данных в этих запросах.</span><span class="sxs-lookup"><span data-stu-id="47771-173">Instead, they respond to the number of requests and their payload size.</span></span> <span data-ttu-id="47771-174">Обычный компьютер может обработать несколько тысяч запросов стандартного веб-трафика в секунду.</span><span class="sxs-lookup"><span data-stu-id="47771-174">With standard web traffic, an average machine can handle a couple thousand requests per second.</span></span> <span data-ttu-id="47771-175">Этот показатель зависит от точных характеристик компьютера.</span><span class="sxs-lookup"><span data-stu-id="47771-175">The specific capacity depends on the exact machine characteristics.</span></span> 

<span data-ttu-id="47771-176">Производительность соединителя связана с ЦП и сетью.</span><span class="sxs-lookup"><span data-stu-id="47771-176">The connector performance is bound by CPU and networking.</span></span> <span data-ttu-id="47771-177">Производительность ЦП важна при шифровании и расшифровке SSL, а сеть нужна, чтобы быстро подключаться к приложениям и веб-службе в Azure.</span><span class="sxs-lookup"><span data-stu-id="47771-177">CPU performance is needed for SSL encryption and decryption, while networking is important to get fast connectivity to the applications and the online service in Azure.</span></span>

<span data-ttu-id="47771-178">Память, напротив, меньше всего важна для соединителей.</span><span class="sxs-lookup"><span data-stu-id="47771-178">In contrast, memory is less of an issue for connectors.</span></span> <span data-ttu-id="47771-179">Веб-служба выполняет большую часть операций обработки и отвечает за весь трафик, не прошедший аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="47771-179">The online service takes care of much of the processing and all unauthenticated traffic.</span></span> <span data-ttu-id="47771-180">Все, что можно сделать в облаке, осуществляется в облаке.</span><span class="sxs-lookup"><span data-stu-id="47771-180">Everything that can be done in the cloud is done in the cloud.</span></span> 

<span data-ttu-id="47771-181">На производительность также влияет качество сетевого подключения между соединителями, которое определяется следующими факторами.</span><span class="sxs-lookup"><span data-stu-id="47771-181">Another factor that affects performance is the quality of the networking between the connectors, including:</span></span> 

* <span data-ttu-id="47771-182">**Веб-служба**. Медленные подключения или подключения с высокой задержкой к службе прокси приложения в Azure влияют производительность соединителя.</span><span class="sxs-lookup"><span data-stu-id="47771-182">**The online service**: Slow or high-latency connections to the Application Proxy service in Azure influence the connector performance.</span></span> <span data-ttu-id="47771-183">Чтобы обеспечить максимальную производительность, подключите свою организацию к Azure с помощью ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="47771-183">For the best performance, connect your organization to Azure with Express Route.</span></span> <span data-ttu-id="47771-184">Для других подключений вашей команде сетевых инженеров нужно отдельно обеспечивать эффективность подключений к Azure.</span><span class="sxs-lookup"><span data-stu-id="47771-184">Otherwise, have your networking team ensure that connections to Azure are handled as efficiently as possible.</span></span> 
* <span data-ttu-id="47771-185">**Внутренние приложения.** В некоторых случаях между соединителем и внутренними приложениями установлены дополнительные прокси-серверы, которые могут замедлять или нарушать подключения.</span><span class="sxs-lookup"><span data-stu-id="47771-185">**The backend applications**: In some cases, there are additional proxies between the connector and the backend applications that can slow or prevent connections.</span></span> <span data-ttu-id="47771-186">Чтобы устранить неполадки в этом случае, откройте браузер на сервере соединителя и повторите попытку получить доступ к приложению.</span><span class="sxs-lookup"><span data-stu-id="47771-186">To troubleshoot this scenario, open a browser from the connector server and try to access the application.</span></span> <span data-ttu-id="47771-187">Если соединители выполняются в Azure, а приложения расположены в локальной среде, качество работы может оказаться ниже, чем ожидают пользователи.</span><span class="sxs-lookup"><span data-stu-id="47771-187">If you run the connectors in Azure but the applications are on-premises, the experience might not be what your users expect.</span></span>
* <span data-ttu-id="47771-188">**Контроллеры домена.** Если соединители выполняют единый вход на основе ограниченного делегирования Kerberos, то сначала они обращаются к контроллерам домена, а затем отправляют запрос к серверной части.</span><span class="sxs-lookup"><span data-stu-id="47771-188">**The domain controllers**: If the connectors perform SSO using Kerberos Constrained Delegation, they contact the domain controllers before sending the request to the backend.</span></span> <span data-ttu-id="47771-189">Соединители содержат кэш билетов Kerberos, но в среде с высокой нагрузкой скорость реагирования контроллеров домена может снизить производительность.</span><span class="sxs-lookup"><span data-stu-id="47771-189">The connectors have a cache of Kerberos tickets, but in a busy environment the responsiveness of the domain controllers can affect performance.</span></span> <span data-ttu-id="47771-190">Такая проблема наиболее характерна для ситуации, когда соединители выполняются в Azure, но взаимодействуют с контроллерами домена в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="47771-190">This issue is more common for connectors that run in Azure but communicate with domain controllers that are on-premises.</span></span> 

<span data-ttu-id="47771-191">Дополнительные сведения об оптимизации сети см. в разделе [Аспекты топологии сети при использовании прокси приложения Azure Active Directory](application-proxy-network-topology-considerations.md).</span><span class="sxs-lookup"><span data-stu-id="47771-191">For more information about optimizing your network, see [Network topology considerations when using Azure Active Directory Application Proxy](application-proxy-network-topology-considerations.md).</span></span>

## <a name="domain-joining"></a><span data-ttu-id="47771-192">Присоединение к домену</span><span class="sxs-lookup"><span data-stu-id="47771-192">Domain joining</span></span>

<span data-ttu-id="47771-193">Соединители могут выполняться на компьютере, не присоединенном к домену.</span><span class="sxs-lookup"><span data-stu-id="47771-193">Connectors can run on a machine that is not domain-joined.</span></span> <span data-ttu-id="47771-194">Но если вам нужен единый вход (SSO) в приложения, использующих встроенную проверку подлинности Windows (IWA), компьютер должен быть присоединен к домену.</span><span class="sxs-lookup"><span data-stu-id="47771-194">However, if you want single sign-on (SSO) to applications that use Integrated Windows Authentication (IWA), you need a domain-joined machine.</span></span> <span data-ttu-id="47771-195">В этом случае компьютеры соединителя должны быть присоединены к домену, который может выполнить ограниченное делегирование [Kerberos](https://web.mit.edu/kerberos) от имени пользователей для опубликованных приложений.</span><span class="sxs-lookup"><span data-stu-id="47771-195">In this case, the connector machines must be joined to a domain that can perform [Kerberos](https://web.mit.edu/kerberos) Constrained Delegation on behalf of the users for the published applications.</span></span>

<span data-ttu-id="47771-196">Соединители можно также присоединять к доменам или лесам с частичным доверием либо к контроллерам домена только для чтения.</span><span class="sxs-lookup"><span data-stu-id="47771-196">Connectors can also be joined to domains or forests that have a partial trust, or to read-only domain controllers.</span></span>

## <a name="connector-deployments-on-hardened-environments"></a><span data-ttu-id="47771-197">Развертывание соединителей в средах с усиленной защитой</span><span class="sxs-lookup"><span data-stu-id="47771-197">Connector deployments on hardened environments</span></span>

<span data-ttu-id="47771-198">Развертывание соединителей обычно не вызывает сложностей и не требует дополнительной настройки.</span><span class="sxs-lookup"><span data-stu-id="47771-198">Usually, connector deployment is straightforward and requires no special configuration.</span></span> <span data-ttu-id="47771-199">Но для некоторых редких сценариев есть определенные условия.</span><span class="sxs-lookup"><span data-stu-id="47771-199">However, there are some unique conditions that should be considered:</span></span>

* <span data-ttu-id="47771-200">Если в организации используются ограничения на исходящий трафик, [откройте необходимые порты](active-directory-application-proxy-enable.md#open-your-ports).</span><span class="sxs-lookup"><span data-stu-id="47771-200">Organizations that limit the outbound traffic must [open required ports](active-directory-application-proxy-enable.md#open-your-ports).</span></span>
* <span data-ttu-id="47771-201">На FIPS-совместимых компьютерах может потребоваться изменить конфигурацию таким образом, чтобы процессы соединителя могли создать и сохранить сертификат.</span><span class="sxs-lookup"><span data-stu-id="47771-201">FIPS-compliant machines might be required to change their configuration to allow the connector processes to generate and store a certificate.</span></span>
* <span data-ttu-id="47771-202">Если в организации используется блокировка среды на основе процессов, создающих сетевые запросы, то для обеих служб соединителей нужно разрешить доступ ко всем требуемым портам и IP-адресам.</span><span class="sxs-lookup"><span data-stu-id="47771-202">Organizations that lock down their environment based on the processes that issue the networking requests have to make sure that both connector services are enabled to access all required ports and IPs.</span></span>
* <span data-ttu-id="47771-203">В некоторых случаях исходящие перенаправляющие прокси-серверы могут прервать двустороннюю проверку подлинности на основе сертификата и привести к сбою связи.</span><span class="sxs-lookup"><span data-stu-id="47771-203">In some cases, outbound forward proxies may break the two-way certificate authentication and cause the communication to fail.</span></span>

## <a name="connector-authentication"></a><span data-ttu-id="47771-204">Проверка подлинности соединителя</span><span class="sxs-lookup"><span data-stu-id="47771-204">Connector authentication</span></span>

<span data-ttu-id="47771-205">Чтобы предоставить доступ к защищенной службе, соединители должны пройти проверку подлинности в службе, а служба должна пройти проверку подлинности в соединителе.</span><span class="sxs-lookup"><span data-stu-id="47771-205">To provide a secure service, connectors have to authenticate toward the service, and the service has to authenticate toward the connector.</span></span> <span data-ttu-id="47771-206">Такая аутентификация выполняется с использованием сертификатов клиента и сервера, когда соединители инициируют подключение.</span><span class="sxs-lookup"><span data-stu-id="47771-206">This authentication is done using client and server certificates when the connectors initiate the connection.</span></span> <span data-ttu-id="47771-207">Таким образом имя пользователя и пароль администратора не хранятся на компьютере соединителя.</span><span class="sxs-lookup"><span data-stu-id="47771-207">This way the administrator’s username and password are not stored on the connector machine.</span></span>

<span data-ttu-id="47771-208">Используемые сертификаты уникальны для службы прокси приложения.</span><span class="sxs-lookup"><span data-stu-id="47771-208">The certificates used are specific to the Application Proxy service.</span></span> <span data-ttu-id="47771-209">Они создаются во время первоначальной регистрации, а затем соединители автоматически обновляют их каждые несколько месяцев.</span><span class="sxs-lookup"><span data-stu-id="47771-209">They get created during the initial registration and are automatically renewed by the connectors every couple of months.</span></span> 

<span data-ttu-id="47771-210">Если соединитель несколько месяцев не подключается к службе, возможно, его сертификаты устарели.</span><span class="sxs-lookup"><span data-stu-id="47771-210">If a connector is not connected to the service for several months, its certificates may be outdated.</span></span> <span data-ttu-id="47771-211">В этом случае следует удалить соединитель и установить его заново, чтобы запустить процесс регистрации.</span><span class="sxs-lookup"><span data-stu-id="47771-211">In this case, uninstall and reinstall the connector to trigger registration.</span></span> <span data-ttu-id="47771-212">Вы можете выполнить следующие команды PowerShell:</span><span class="sxs-lookup"><span data-stu-id="47771-212">You can run the following PowerShell commands:</span></span>

```
Import-module AppProxyPSModule
Register-AppProxyConnector
```

## <a name="under-the-hood"></a><span data-ttu-id="47771-213">Как все устроено</span><span class="sxs-lookup"><span data-stu-id="47771-213">Under the hood</span></span>

<span data-ttu-id="47771-214">Соединители основаны на прокси веб-приложения Windows Server, поэтому для них доступны почти такие же средства управления, включая журналы событий Windows</span><span class="sxs-lookup"><span data-stu-id="47771-214">Connectors are based on Windows Server Web Application Proxy, so they have most of the same management tools including Windows Event Logs</span></span>

 ![Управление журналами событий с помощью средства просмотра событий](./media/application-proxy-understand-connectors/event-view-window.png)

<span data-ttu-id="47771-216">и счетчики производительности Windows.</span><span class="sxs-lookup"><span data-stu-id="47771-216">and Windows performance counters.</span></span> 

 ![Добавление счетчиков в соединитель с помощью системного монитора](./media/application-proxy-understand-connectors/performance-monitor.png)

<span data-ttu-id="47771-218">Для соединителей настроены журнал администратора и журнал сеансов.</span><span class="sxs-lookup"><span data-stu-id="47771-218">The connectors have both admin and session logs.</span></span> <span data-ttu-id="47771-219">В журналах администратора регистрируются основные события и соответствующие ошибки.</span><span class="sxs-lookup"><span data-stu-id="47771-219">The admin logs include key events and their errors.</span></span> <span data-ttu-id="47771-220">В журналах сеансов содержатся все транзакции и подробные сведения об их обработке.</span><span class="sxs-lookup"><span data-stu-id="47771-220">The session logs include all the transactions and their processing details.</span></span> 

<span data-ttu-id="47771-221">Чтобы увидеть журналы, откройте средство просмотра событий и включите в нем параметр **Отобразить аналитический и отладочный журналы** в меню **Вид**.</span><span class="sxs-lookup"><span data-stu-id="47771-221">To see the logs, go to the Event Viewer, open the **View** menu, and enable **Show analytic and debug logs**.</span></span> <span data-ttu-id="47771-222">Затем включите в журналах сбор событий.</span><span class="sxs-lookup"><span data-stu-id="47771-222">Then, enable them to start collecting events.</span></span> <span data-ttu-id="47771-223">Эти журналы не отображаются в прокси-службе веб-приложения в Windows Server 2012 R2, так как соединители созданы на основе более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="47771-223">These logs do not appear in Web Application Proxy in Windows Server 2012 R2, as the connectors are based on a more recent version.</span></span>

<span data-ttu-id="47771-224">Состояние службы можно проверить в окне "Служба".</span><span class="sxs-lookup"><span data-stu-id="47771-224">You can examine the state of the service in the Services window.</span></span> <span data-ttu-id="47771-225">Соединитель состоит из двух служб Windows: собственно соединитель и служба обновления.</span><span class="sxs-lookup"><span data-stu-id="47771-225">The connector comprises two Windows Services: the actual connector, and the updater.</span></span> <span data-ttu-id="47771-226">Они должны работать постоянно.</span><span class="sxs-lookup"><span data-stu-id="47771-226">Both of them must run all the time.</span></span>

 ![Окно "Службы (локальные)" Azure AD](./media/application-proxy-understand-connectors/aad-connector-services.png)

## <a name="next-steps"></a><span data-ttu-id="47771-228">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="47771-228">Next steps</span></span>


* [<span data-ttu-id="47771-229">Публикация приложений в отдельных сетях и расположениях с помощью групп соединителей</span><span class="sxs-lookup"><span data-stu-id="47771-229">Publish applications on separate networks and locations using connector groups</span></span>](active-directory-application-proxy-connectors-azure-portal.md)
* [<span data-ttu-id="47771-230">Работа с имеющимися локальными прокси-серверами</span><span class="sxs-lookup"><span data-stu-id="47771-230">Work with existing on-premises proxy servers</span></span>](application-proxy-working-with-proxy-servers.md)
* [<span data-ttu-id="47771-231">Устранение неполадок и сообщения об ошибках прокси приложения</span><span class="sxs-lookup"><span data-stu-id="47771-231">Troubleshoot Application Proxy and connector errors</span></span>](active-directory-application-proxy-troubleshoot.md)
* [<span data-ttu-id="47771-232">Автоматическая установка соединителя прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="47771-232">How to silently install the Azure AD Application Proxy Connector</span></span>](active-directory-application-proxy-silent-installation.md)

