---
title: "приложения toocloud aaaManage доступ путем ограничения клиентов - Azure | Документы Microsoft"
description: "Как toomanage toouse ограничения клиента, какие пользователи могут получать доступ к приложениям на основании своего клиента Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: kgremban
ms.openlocfilehash: 6470fa217738b29104353ae17a2f53216f825c19
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-tenant-restrictions-toomanage-access-toosaas-cloud-applications"></a>Использовать ограничения клиента toomanage доступа tooSaaS облачных приложений

Крупных организациях, предназначенные для обеспечения безопасности требуется toomove toocloud служб, таких как Office 365, но требуется tooknow, своим пользователям доступ к только утвержденные ресурсы. В большинстве случаев компаний ограничивать доменные имена или IP-адреса, если им нужен доступ toomanage. Такой подход не работает в мире, в котором приложения SaaS размещены в общедоступном облаке, выполняющемся на общих доменных именах, таких как outlook.office.com и login.microsoftonline.com. Блокировка этих адресов будет информировать пользователей доступ к Outlook на веб-hello полностью, вместо ограничения их просто tooapproved удостоверений и ресурсы.

Запрос toothis решения Azure Active Directory — это компонент, называется ограничения клиента. Доступ клиента ограничения позволяет организациям toocontrol tooSaaS облачных приложений, на основе использования приложения hello клиента hello Azure AD для единого входа. Например может потребоваться приложений Office 365 организации tooyour tooallow доступ, предотвратить доступ tooother организаций экземпляров эти же приложения.  

Ограничения клиента дает организациям hello возможность toospecify hello список клиентов, что их пользователям разрешается tooaccess. Затем Azure AD предоставляет только клиенты toothese разрешен доступ.

Эта статья посвящена ограничения клиента для Office 365, но функция hello должны работать с любого облачного приложения SaaS, использующий протокол современную проверку подлинности в Azure AD для единого входа. При использовании приложений с помощью другой Azure AD для клиента из клиента hello, используемая для Office 365 SaaS, убедитесь, что всех необходимых разрешены клиентов. Дополнительные сведения об облачных приложений SaaS см. в разделе hello [Active Directory Marketplace](https://azure.microsoft.com/en-us/marketplace/active-directory/).

## <a name="how-it-works"></a>Принципы работы

Hello общее решение включает в себя hello следующие компоненты: 

1. **Azure AD** — Если hello `Restrict-Access-To-Tenants: <permitted tenant list>` — присутствует, Azure AD только выдающая маркеры безопасности для hello допускается клиентов. 

2. **Сервер прокси-сервера в локальную инфраструктуру** — устройство прокси-сервер, поддерживающий проверку SSL, настроенного tooinsert hello заголовок, содержащий список hello находиться клиентов в трафика, предназначенного для Azure AD. 

3. **Клиентское программное обеспечение** — ограничения toosupport клиента, клиентское программное обеспечение необходимо запросить токены непосредственно из Azure AD, чтобы трафик может быть перехвачен hello инфраструктуры прокси-сервера. Ограничение клиентов в настоящее время поддерживается браузерными приложениями Office 365 и клиентами Office при использовании современной аутентификации (например, OAuth 2.0). 

4. **Современная проверка подлинности** — облачные службы должны использовать toouse современная проверка подлинности клиента ограничения и блокировка доступа к tooall клиентов не допускается. Office 365 облачные службы должны быть настроенных toouse протоколы современная проверка подлинности по умолчанию. Hello последние сведения о поддержке современная проверка подлинности Office 365, чтение [современная проверка подлинности обновления Office 365](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/).

Привет, следующая схема иллюстрирует поток высокого уровня трафика hello. Проверку SSL требуется только на трафик tooAzure AD не toohello Office 365 облачные службы. Это различие важно, так как объем трафика hello для проверки подлинности tooAzure AD обычно гораздо меньше трафика тома tooSaaS приложений, таких как Exchange Online и SharePoint Online.

![Схема движения трафика при использовании ограничения клиентов](./media/active-directory-tenant-restrictions/traffic-flow.png)

## <a name="set-up-tenant-restrictions"></a>Настройка ограничения клиентов

Существует два tooget шаги работы с ограничениями клиента. Hello первым шагом является toomake том, что клиенты могут подключаться toohello вправо адреса. Hello второй — tooconfigure инфраструктуры прокси-сервера.

### <a name="urls-and-ip-addresses"></a>URL-адреса и IP-адреса

toouse ограничения клиента клиентов должен быть следующий URL-адреса Azure AD tooauthenticate toohello может tooconnect: login.microsoftonline.com, login.microsoft.com и login.windows.net. Кроме того, tooaccess Office 365, ваши клиенты также должен быть toohello может tooconnect полных доменных имен или URL-адреса и IP-адресов, определенных в [Office 365 URL-адреса и IP-адресов](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2). 

### <a name="proxy-configuration-and-requirements"></a>Конфигурация и требования прокси-сервера

Следующая конфигурация Hello является обязательным tooenable ограничения клиента посредством инфраструктуры прокси-сервера. В этом руководстве является универсальным, поэтому следует ссылаться tooyour прокси-сервера в документации поставщика для конкретной реализации действия.

#### <a name="prerequisites"></a>Предварительные требования

- Hello прокси-сервер должен быть перехвата SSL может tooperform вставки заголовка HTTP и назначения фильтра с использованием полных доменных имен или URL-адреса. 

- Клиенты должны доверять hello цепочки сертификатов, представленный hello прокси-сервер для подключения по протоколу SSL. Например если используются сертификаты из Внутренняя инфраструктура PKI, hello внутреннего выдающего сертификат корневого центра сертификации должна быть доверена.

- Этот компонент включен в подписки Office 365, но если требуется tooother toouse ограничения клиента toocontrol доступ приложений SaaS затем лицензий Azure AD Premium 1 требуются.

#### <a name="configuration"></a>Конфигурация

Для каждого входящего запроса toologin.microsoftonline.com, login.microsoft.com и login.windows.net вставки двух заголовки HTTP: *ограничить доступ для клиентов* и *ограничение доступа контекста*.

заголовки Hello должен включать hello следующие элементы: 
- Для *ограничить доступ для клиентов*, значение \<разрешен список клиента\>, которого является список с разделителями запятыми клиентов требуется tooaccess tooallow пользователей. Любой домен, зарегистрированный с клиентом может быть клиента используется tooidentify hello в этом списке. Например toopermit доступ клиентов tooboth Contoso и Fabrikam, Здравствуйте, как выглядит пары имя значение:`Restrict-Access-To-Tenants: contoso.onmicrosoft.com,fabrikam.onmicrosoft.com` 
- Для *ограничение доступа контекста*, значение идентификатора один каталог, объявление, какой клиент устанавливает ограничения клиента hello. Например toodeclare Contoso как клиент hello, задайте hello клиента ограничения политики пары имя/значение hello выглядит следующим образом.`Restrict-Access-Context: 456ff232-35l2-5h23-b3b3-3236w0826f3d`  

> [!TIP]
> Идентификатор каталога можно узнать в hello [портал Azure](https://portal.azure.com). Войдите в качестве администратора, выберите **Azure Active Directory** слева, затем выберите **Свойства**.

Если уже имеется в hello входящего запроса tooprevent пользователи вставлять собственные заголовка HTTP с клиентами, не утвержден, hello прокси-сервера должен tooreplace hello ограничить доступ для клиентов заголовок. 

Клиенты должны иметь принудительного toouse hello прокси для всех запросов toologin.microsoftonline.com login.microsoft.com и login.windows.net. Например если файлы PAC используется toodirect клиенты toouse hello прокси-сервера, конечные пользователи должны tooedit может быть отключен или не hello PAC файлы.

## <a name="hello-user-experience"></a>взаимодействие с пользователем Hello

В этом разделе показано взаимодействие hello для конечных пользователей и администраторов.

### <a name="end-user-experience"></a>Возможности для пользователей

Образец имени пользователя в сети Contoso hello, но пытается tooaccess hello Fabrikam экземпляр общего приложению SaaS как Outlook через Интернет. Если клиент не разрешено для этого экземпляра, Contoso hello пользователь видит hello следующие страницы:

![Страница "Доступ запрещен" для пользователей запрещенных клиентов](./media/active-directory-tenant-restrictions/end-user-denied.png)

### <a name="admin-experience"></a>Возможности для администраторов

Во время настройки ограничений клиента выполняются в инфраструктуре hello корпоративный прокси-сервер, администраторов может напрямую обращаться к отчеты ограничения клиента hello в hello портал Azure. сообщает о tooview hello, переход на страницу toohello Обзор Azure Active Directory, а затем в разделе «Другие возможности».

Здравствуйте, администратор для клиента hello указан как hello контекста Restricted-доступа клиента, можно использовать этот toosee отчета все входы заблокированное hello политики ограничения клиента, включая hello удостоверения используемый и идентификатор hello целевой каталог.

![Используйте попытки входа в Azure портала tooview ограничен hello](./media/active-directory-tenant-restrictions/portal-report.png)

Как и другие отчеты в hello портал Azure можно использовать фильтры toospecify hello область отчета. Можно настроить фильтр по конкретному пользователю, приложению, клиенту или интервалу времени.

## <a name="office-365-support"></a>Поддержка Office 365

Приложения Office 365, должны удовлетворять toofully поддержки двух критериев ограничения клиента.

1. Современная проверка подлинности поддерживает приветствия клиента
2. Современная проверка подлинности включена в качестве протокола проверки подлинности по умолчанию hello для hello облачной службы.

См. слишком[современная проверка подлинности Office 365 обновлены](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/) hello последние сведения, на какие Office клиентов в настоящее время поддерживает современные способы проверки подлинности. Эта страница также tooinstructions связи для включения современная проверка подлинности на конкретные Exchange Online и Скайп для бизнеса Online клиентов. Современная аутентификация уже включена по умолчанию в SharePoint Online.

Ограничения клиента в настоящее время поддерживается для приложений на основе браузера в Office 365 (hello SharePoint для портала Office, Yammer, сайты Outlook на hello Web и т. д.). Для толстых клиентов (Outlook, Skype для бизнеса, Word, Excel, PowerPoint и т. д.) ограничение клиентов может применяться только при использовании современной аутентификации.  

Outlook и Скайп для предприятия клиенты, поддерживающие современные способы проверки подлинности все еще может toouse традиционных протоколов для клиентов где современная проверка подлинности не включена, эффективно обход ограничения клиента. Для Outlook на Windows клиенты могут использовать ограничения tooimplement запретить пользователям добавлять профили tootheir учетные записи почты не утверждено. Например, в разделе hello [запретить добавление учетных записей Exchange нестандартный](http://gpsearch.azurewebsites.net/default.aspx?ref=1) параметр групповой политики. Для Outlook на платформах, отличных от Windows, и Skype для бизнеса на всех платформах полная поддержка ограничений клиентов на данный момент недоступна.

## <a name="testing"></a>Тестирование

Если вы хотите tootry ограничения клиента перед его внедрением для всей организации, можно двумя способами: с помощью инструмента Fiddler или пошагового внедрения параметры прокси-сервера подход на основе узла.

### <a name="fiddler-for-a-host-based-approach"></a>Использование Fiddler для подхода на основе узлов

Fiddler — это бесплатно веб-, прокси-сервером, можно использовать toocapture и изменить трафик HTTP/HTTPS, включая вставку заголовки HTTP отладки. tootest Fiddler tooconfigure ограничения клиента выполните следующие шаги hello.

1.  [Скачайте и установите Fiddler](http://www.telerik.com/fiddler).
2.  Настройка HTTPS-трафика toodecrypt Fiddler, для [Fiddler в справочной документации](http://docs.telerik.com/fiddler/Configure-Fiddler/Tasks/DecryptHTTPS).
3.  Настройка Fiddler tooinsert hello *ограничить доступ для клиентов* и *ограничение доступа контекста* заголовки с помощью настраиваемых правил:
  1. В средстве веб-отладчик Fiddler hello, выберите hello **правила** и выбрать пункт **настроить правила...** файл CustomRules tooopen hello.
  2. Добавьте следующие строки в начале hello hello hello *OnBeforeRequest* функции. Замените \<tenant domain\> доменом, зарегистрированным в вашем клиенте (например, contoso.onmicrosoft.com). Замените \<directory ID\> идентификатором GUID Azure AD своего клиента.

  ```
  if (oSession.HostnameIs("login.microsoftonline.com") || oSession.HostnameIs("login.microsoft.com") || oSession.HostnameIs("login.windows.net")){      oSession.oRequest["Restrict-Access-To-Tenants"] = "<tenant domain>";      oSession.oRequest["Restrict-Access-Context"] = "<directory ID>";}
  ```

  Если вам требуется tooallow нескольких клиентов, используйте имен клиента hello tooseparate запятая. Например:

  ```
  oSession.oRequest["Restrict-Access-To-Tenants"] = "contoso.onmicrosoft.com,fabrikam.onmicrosoft.com";
  ```

4. Сохраните и закройте файл CustomRules hello.

После настройки Fiddler, можно фиксировать трафик с переходом toohello **файл** , выберите в меню **запись трафика**.

### <a name="staged-rollout-of-proxy-settings"></a>Поэтапное развертывание параметров прокси-сервера

В зависимости от возможностей hello инфраструктуры прокси-сервера может быть развертывания может toostage hello параметры tooyour пользователей. Ниже приведено несколько общих способов, которые вы можете рассмотреть.

1.  PAC файлы toopoint тестирования пользователей tooa тестирования инфраструктуры прокси-сервера, следует используйте, даже если обычные пользователи по-прежнему инфраструктуры toouse hello производственного прокси-сервера.
2.  Некоторые прокси-серверы могут поддерживать различные конфигурации с использованием групп.

Конкретные сведения см. в документации сервера tooyour прокси-сервера.

## <a name="next-steps"></a>Дальнейшие действия

- Ознакомьтесь со статьей [Updated Office 365 modern authentication](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/) (Обновление поддержи современной аутентификации в Office 365).

- Просмотрите hello [Office 365 URL-адреса и IP-адресов](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2)
