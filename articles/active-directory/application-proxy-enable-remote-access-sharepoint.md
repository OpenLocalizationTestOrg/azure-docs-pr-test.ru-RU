---
title: "aaaEnable tooSharePoint удаленного доступа с помощью прокси приложения Azure AD | Документы Microsoft"
description: "Описываются основы hello о том, как toointegrate на локальном сервере SharePoint, с помощью прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/21/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 6ab413462fcaf387e150449df9c97505c4108bcf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="enable-remote-access-toosharepoint-with-azure-ad-application-proxy"></a>Включить tooSharePoint удаленного доступа с помощью прокси приложения Azure AD

В этой статье рассматриваются как toointegrate на локальном сервере SharePoint, с помощью прокси приложения Azure Active Directory (Azure AD).

tooenable tooSharePoint удаленного доступа с помощью прокси приложения Azure AD, выполните hello разделы в этой статье шаг за шагом.

## <a name="prerequisites"></a>Предварительные требования

В этой статье предполагается, что в вашей среде уже есть SharePoint 2013 или более поздней версии. Кроме того примите во внимание следующие предварительные требования hello.

* SharePoint имеет встроенную поддержку Kerberos. Таким образом пользователи получают доступ к внутренним сайтам удаленно через прокси приложения Azure AD можно считать toohave одну систему единого входа (SSO).

* Необходимо toomake несколько сервера SharePoint tooyour изменения конфигурации. Мы рекомендуем использовать промежуточную среду. Таким образом, можно сделать tooyour обновления сначала тестового сервера и затем упрощения цикла тестирования перед переходом в рабочую среду.

* Мы предполагаем, что уже настройки SSL для SharePoint, так как нам требуется SSL на hello опубликованные URL-адрес. Требуется toohave, протокол SSL включен на внутренний узел, что ссылки отправлено/правильно сопоставлены tooensure. Если вы еще не настроили SSL, см. инструкции в разделе [Настройка SSL для SharePoint 2013](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013). Кроме того убедитесь, что hello соединителя доверие hello сертификат компьютера, выдается. (hello сертификатов не требуются публично выдан toobe).

## <a name="step-1-set-up-single-sign-on-toosharepoint"></a>Шаг 1: Настройка tooSharePoint

Клиентам требуется возможности наиболее единого входа для приложений серверной части, сервер SharePoint, в этом случае hello. В этом распространенном сценарии Azure AD hello пользователя проходит проверку подлинности только один раз, так как они не будет предлагаться для проверки подлинности еще раз.

Для локальных приложений, в которых требуется проверка подлинности Windows можно добиться с помощью hello протокол проверки подлинности Kerberos и ограниченное делегирование Kerberos (KCD) называемую единого входа. Ограниченное делегирование Kerberos, если настроена, допускает tooobtain соединитель прокси приложения hello windows билет или токен для пользователя, даже если hello пользователь не вошел в систему tooWindows напрямую. toolearn Дополнительные сведения о проверки подлинности Kerberos, в разделе [Kerberos ограниченное делегирование Обзор](https://technet.microsoft.com/library/jj553400.aspx).

tooset копирование ограниченное делегирование Kerberos для сервера SharePoint, используйте процедуры hello в следующих разделах последовательных hello:

### <a name="ensure-that-sharepoint-is-running-under-a-service-account"></a>Проверка того, что сервер SharePoint запущен с использованием учетной записи службы

Сначала проверьте, что сервер SharePoint запущен с использованием определенной учетной записи службы, а не учетной записи локальной системы, локальной службы или сетевой службы. Для этого, чтобы можно было присоединить имена участника (SPN) службы tooa допустимую учетную запись. Имена участников-служб, как hello протокол Kerberos приведены различные службы. И будет необходимо hello учетной записи более поздней версии tooconfigure hello ограниченное делегирование Kerberos.

tooensure веб-узлы, работающие под учетной записью службы, определенные выполните следующие шаги hello.

1. Откройте hello **Центр администрирования SharePoint 2013** сайта.
2. Go слишком**безопасности** и выберите **Настройка учетных записей служб**.
3. Выберите **Пул веб-приложений — SharePoint — 80**. Hello параметры могут несколько отличаться на основе имени hello web пула или если hello веб-пул по умолчанию использует SSL.

  ![Параметры для настройки учетной записи службы](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-web-application.png)

4. Если **выберите учетную запись для этого компонента** — **локальной службы** или **сетевой службы**, требуется toocreate учетную запись. В противном случае завершения работы и можно переместить toohello следующего раздела.
5. Выберите **Регистрация новой управляемой учетной записи**. После создания учетной записи необходимо задать **пула веб-приложений** перед использованием hello учетной записи.

> [!NOTE]
Требуется toohave a ранее для создания учетной записи Azure AD для службы hello. Мы рекомендуем настроить автоматическую смену паролей. Дополнительные сведения о hello полный набор действий и устранение неполадок см. в разделе [Настройка автоматическая смена пароля в SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).

### <a name="configure-sharepoint-for-kerberos"></a>Настройка SharePoint для Kerberos

Использование проверки подлинности Kerberos tooperform единого входа toohello SharePoint server, и это работает только с использованием Kerberos.

tooconfigure сайта SharePoint, для проверки подлинности Kerberos.

1. Откройте hello **Центр администрирования SharePoint 2013** сайта.
2. Go слишком**управление приложениями**выберите **управление веб-приложениями**и выберите сайт SharePoint. В данном примере выберите **SharePoint — 80**.

  ![При выборе узла SharePoint hello](./media/application-proxy-remote-sharepoint/remote-sharepoint-manage-web-applications.png)

3. Нажмите кнопку **поставщики проверки подлинности** на панели инструментов hello.
4. В hello **поставщики проверки подлинности** щелкните **зоны по умолчанию** tooview hello параметры.
5. В hello **изменить проверку подлинности** диалогового окна поле, прокрутите вниз, пока не увидите **типы проверки подлинности утверждений** и убедитесь, что оба **включить проверку подлинности Windows** и  **Встроенная проверка подлинности Windows** выбраны.
6. Убедитесь, что в раскрывающемся списке hello, **согласование (Kerberos)** выбран.

  ![Диалоговое окно "Изменение параметров проверки подлинности"](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-edit-authentication.png)

7. Внизу hello hello **изменить проверку подлинности** диалоговое окно, нажмите кнопку **Сохранить**.

### <a name="set-a-service-principal-name-for-hello-sharepoint-service-account"></a>Задание имени субъекта-службы для учетной записи службы SharePoint hello

Перед настройкой hello ограниченное делегирование Kerberos необходимо tooidentify hello SharePoint службы запускается от имени учетной записи службы hello, который настроен. Для этого нужно задать имя субъекта-службы. Дополнительные сведения об именах субъектов-служб см. в [этом разделе](https://technet.microsoft.com/library/cc961723.aspx).

имеет следующий формат имени участника-службы Hello:

```
<service class>/<host>:<port>
```

В формате имени участника-службы hello:

* _класс службы_ — это уникальное имя для службы hello. Для SharePoint используется **HTTP**.

* _узел_ является полным доменным hello или NetBIOS-имя узла hello, hello службы выполняется на. Для сайта SharePoint этот текст может потребоваться URL-адрес сайта hello, в зависимости от версии hello служб IIS, которую вы используете для hello toobe.

* _port_ указывать необязательно.

Если полное доменное имя сервера SharePoint hello hello:

```
sharepoint.demo.o365identity.us
```

Затем hello имени участника-службы является:

```
HTTP/ sharepoint.demo.o365identity.us demo
```

Может также потребоваться tooset имена участников-служб для определенных сайтов на сервере. Дополнительные сведения см. в статье [Настройка проверки подлинности Kerberos](https://technet.microsoft.com/library/cc263449(v=office.12).aspx). Обратите особое внимание toohello раздел «Создать имена участника-службы для веб-приложений с использованием проверки подлинности Kerberos».

Простейший способ Hello tooset имена участников-служб — toofollow hello SPN форматы, которые могут уже присутствовать для веб-сайтов. Скопируйте эти tooregister имена участников-служб для учетной записи службы hello. toodo это:

1. Обзор узла toohello с hello имени участника-службы с другого компьютера.
 При hello соответствующий набор билетов Kerberos, кэшируется на компьютере hello. Эти билеты содержат hello hello целевого сайта, который просматривается в имя участника-службы.

2. Вы можете извлечь hello имени участника-службы для этого сайта, используя средство под названием [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html). В окно командной строки, на котором выполняется в hello контексте hello пользователя, доступ к которым осуществляется hello узла в обозревателе hello, запустите hello следующую команду:
```
Klist
```
Klist возвращает hello набор целевых имен участников-служб. В этом примере выделен hello значение — hello имени участника-службы, которые необходимы:

  ![Пример результатов Klist](./media/application-proxy-remote-sharepoint/remote-sharepoint-target-service.png)

4. Теперь, когда имеется hello имени участника-службы, необходимо убедиться, что он правильно настроен на hello учетной записи службы, настроенные для веб-приложения hello toomake. Выполните следующую команду из командной строки hello с правами администратора домена hello hello.

 ```
 setspn -S http/sharepoint.demo.o365identity.us demo\sp_svc
 ```

 Эта команда задает hello имени участника-службы для службы SharePoint hello учетной записи работает как _demo\sp_svc_.

 Замените _http/sharepoint.demo.o365identity.us_ с hello имени участника-службы для сервера и _demo\sp_svc_ с учетной записью службы hello в вашей среде. команды Setspn Hello ищет hello SPN, прежде чем его добавить. В этом случае может появиться ошибка **Повторяющееся значение имени субъекта-службы**. Если вы видите эту ошибку, убедитесь, что значение hello связано с учетной записью службы hello.

Вы можете проверить, hello добавления имени участника-службы, выполнив команду Setspn hello с hello -l. toolearn больше об этой команде см [Setspn](https://technet.microsoft.com/library/cc731241.aspx).

### <a name="ensure-that-hello-connector-is-set-as-a-trusted-delegate-toosharepoint"></a>Убедитесь, что этого соединителя hello назначен tooSharePoint доверенных делегата

Настройте ограниченное делегирование Kerberos hello таким образом, чтобы службы прокси приложения Azure AD hello можно делегировать toohello SharePoint пользователя удостоверения службы. Это делается путем включения соединитель прокси приложения hello tooretrieve билеты Kerberos для пользователей, которые прошли проверку подлинности в Azure AD. Затем этот сервер передает hello контекста toohello целевое приложение или SharePoint в этом случае.

hello tooconfigure ограниченное делегирование Kerberos, повторите hello следующие шаги для каждой машины соединителя:

1. Войдите в систему как tooa администратора домена контроллера домена, а затем откройте **Active Directory — пользователи и компьютеры**.
2. Найти hello, hello соединителя выполняется. В этом примере он имеет hello же SharePoint server.
3. Дважды щелкните компьютер hello и нажмите кнопку hello **делегирования** вкладки.
4. Убедитесь, что параметры делегирования hello заданы слишком**этот компьютер доверенный для делегирования toohello указано только службы**, а затем выберите **использовать любой протокол проверки подлинности**.

  ![Параметры делегирования](./media/application-proxy-remote-sharepoint/remote-sharepoint-delegation-box.png)

5. Нажмите кнопку hello **добавить** , выберите элемент **пользователей или компьютеров**и найдите учетную запись службы hello.

  ![Добавление hello имени участника-службы для учетной записи службы hello](./media/application-proxy-remote-sharepoint/remote-sharepoint-users-computers.png)

6. В списке приветствия имен участников-служб выберите hello, созданную вами ранее для учетной записи службы hello.
7. Нажмите кнопку **ОК**. Нажмите кнопку **ОК** попытку изменения toosave hello.

## <a name="step-2-enable-remote-access-toosharepoint"></a>Шаг 2: Включение tooSharePoint удаленного доступа

Теперь, когда вы включить SharePoint для Kerberos и настроить ограниченное делегирование Kerberos, вы готовы tooset копирование tooSharePoint. Затем из соединителя hello, вы можете опубликовать hello фермы SharePoint для удаленного доступа через прокси приложения Azure AD.

tooperform hello следующие действия, необходимо toobe членом hello роль глобального администратора в учетной записи Azure Active Directory вашей организации.

1. Войдите в toohello [портал Azure](https://manage.windowsazure.com) и найти клиента Azure AD.
2. Щелкните **Приложения**, а затем — **Добавить**.
3. Выберите **Публикация приложения, которое будет доступно за пределами вашей сети**. Если этот параметр не отображается, убедитесь, что у вас есть Azure AD Basic или настроить Premium в клиенте hello.
4. Завершите все параметры hello следующим образом:
 * **Имя**: любое значение, например **SharePoint**.
 * **Внутренний URL-адрес**: hello URL-адрес сайта SharePoint hello внутренне, такие как **https://SharePoint/**. В этом примере, убедитесь, что toouse **https**.
 * **Метод предварительной проверки подлинности:** выберите **Azure Active Directory**.

  ![Параметры для добавления приложения](./media/application-proxy-remote-sharepoint/remote-sharepoint-add-application.png)

5. После публикации приложения hello щелкните hello **Настройка** вкладки.
6. Прокрутите вниз параметр toohello **перевод веб-страницы в заголовках**. значение по умолчанию Hello — **Да**. Измените его слишком**нет**.

 SharePoint использует hello _заголовок узла_ toolook значение узла hello. Он также создает ссылки на его основе. конечным итогом Hello является toomake, убедитесь, что любая ссылка, которая приводит к возникновению ошибки SharePoint URL-адрес публикации, правильно ли установлен внешний URL-адрес toouse hello. Установка значения hello слишком**Да** также включает hello соединитель tooforward hello запроса toohello серверной части приложения. Однако можно присвоить значение hello слишком**нет** означает, что hello соединитель не будет отправлять имя внутреннего узла hello. Вместо этого соединителя hello отправляет заголовок узла hello, hello опубликованной внутреннего toohello URL-адрес приложения.

 Кроме того, tooensure SharePoint принимает этот URL-адрес, необходимо toocomplete один дополнительные конфигурации на сервере SharePoint hello. Вы сможете сделать, в следующем разделе hello.

7. Изменение **внутренний метод проверки подлинности** слишком**встроенная проверка подлинности Windows**. Если вашего клиента Azure AD использует имя участника-пользователя в облаке hello, отличается от hello имени участника-пользователя в локальной среде, не забывайте tooupdate **делегированы идентификатора имени входа** также.
8. Задать **SPN внутреннего приложения** toohello значение, которое было установлено ранее. Например, **http/sharepoint.demo.o365identity.us**.
9. Назначьте tooyour приложения hello конечным пользователям.

Приложение должно выглядеть примерно toohello следующий пример:

  ![Завершенное приложение](./media/application-proxy-remote-sharepoint/remote-sharepoint-internal-application-spn.png)

## <a name="step-3-ensure-that-sharepoint-knows-about-hello-external-url"></a>Шаг 3: Убедитесь, что SharePoint знает о hello внешний URL-адрес

Ваш последний шаг tooensure, SharePoint можно найти hello сайт на основании hello внешний URL-адрес, чтобы он будет отображать ссылок на основании этого внешний URL-адрес. Это делается путем настройки сопоставлений альтернативного доступа для сайта SharePoint hello.

1. Откройте hello **Центр администрирования SharePoint 2013** сайта.
2. В разделе **Параметры системы** выберите **Настройка сопоставлений альтернативного доступа**.

 При этом откроется hello **сопоставления для альтернативного доступа** поле.

  ![Окно "Сопоставления для альтернативного доступа"](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access1.png)

3. В hello раскрывающегося списка рядом с **коллекции альтернативного сопоставления доступа**выберите **изменить коллекцию альтернативных сопоставлений доступа**.
4. Выберите сайт, например **SharePoint — 80**.

  ![Выбор сайта](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access2.png)

5. Вы можете tooadd hello опубликованные URL-адрес как внутренний URL-адрес или общедоступный URL-адрес. Этот пример использует общедоступный URL-адрес как hello экстрасети.
6. Нажмите кнопку **изменить общедоступные URL-адреса** в hello **экстрасеть** пути, а затем введите hello путь для hello опубликованное приложение, как показано в предыдущем шаге hello. Например, **https://sharepoint-iddemo.msappproxy.net**.

  ![Введя путь hello](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access3.png)

7. Щелкните **Сохранить**.

 Теперь вы можете просматривать сайт SharePoint hello извне через прокси приложения Azure AD.

## <a name="next-steps"></a>Дальнейшие действия

- [Как tooprovide безопасный удаленный доступ tooon локальные приложения](active-directory-application-proxy-get-started.md)
- [Сведения о соединителях прокси приложения Azure AD](application-proxy-understand-connectors.md)
- [Публикация SharePoint 2016 и Office Online Server с помощью прокси приложения Azure AD](https://blogs.technet.microsoft.com/dawiese/2016/06/09/publishing-sharepoint-2016-and-office-online-server-with-azure-ad-application-proxy/)
