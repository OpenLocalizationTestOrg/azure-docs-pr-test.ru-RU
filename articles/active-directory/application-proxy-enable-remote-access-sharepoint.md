---
title: "aaaEnable tooSharePoint удаленного доступа с помощью прокси приложения Azure AD | Документы Microsoft"
description: "Описываются основы hello о том, как toointegrate на локальном сервере SharePoint, с помощью прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/21/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 6ab413462fcaf387e150449df9c97505c4108bcf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="enable-remote-access-toosharepoint-with-azure-ad-application-proxy"></a><span data-ttu-id="52d30-103">Включить tooSharePoint удаленного доступа с помощью прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="52d30-103">Enable remote access tooSharePoint with Azure AD Application Proxy</span></span>

<span data-ttu-id="52d30-104">В этой статье рассматриваются как toointegrate на локальном сервере SharePoint, с помощью прокси приложения Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="52d30-104">This article discusses how toointegrate an on-premises SharePoint server with Azure Active Directory (Azure AD) Application Proxy.</span></span>

<span data-ttu-id="52d30-105">tooenable tooSharePoint удаленного доступа с помощью прокси приложения Azure AD, выполните hello разделы в этой статье шаг за шагом.</span><span class="sxs-lookup"><span data-stu-id="52d30-105">tooenable remote access tooSharePoint with Azure AD Application Proxy, follow hello sections in this article step by step.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="52d30-106">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="52d30-106">Prerequisites</span></span>

<span data-ttu-id="52d30-107">В этой статье предполагается, что в вашей среде уже есть SharePoint 2013 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="52d30-107">This article assumes that you already have SharePoint 2013 or newer in your environment.</span></span> <span data-ttu-id="52d30-108">Кроме того примите во внимание следующие предварительные требования hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-108">In addition, consider hello following prerequisites:</span></span>

* <span data-ttu-id="52d30-109">SharePoint имеет встроенную поддержку Kerberos.</span><span class="sxs-lookup"><span data-stu-id="52d30-109">SharePoint includes native Kerberos support.</span></span> <span data-ttu-id="52d30-110">Таким образом пользователи получают доступ к внутренним сайтам удаленно через прокси приложения Azure AD можно считать toohave одну систему единого входа (SSO).</span><span class="sxs-lookup"><span data-stu-id="52d30-110">Therefore, users who are accessing internal sites remotely through Azure AD Application Proxy can assume toohave a single sign-on (SSO) experience.</span></span>

* <span data-ttu-id="52d30-111">Необходимо toomake несколько сервера SharePoint tooyour изменения конфигурации.</span><span class="sxs-lookup"><span data-stu-id="52d30-111">You need toomake a few configuration changes tooyour SharePoint server.</span></span> <span data-ttu-id="52d30-112">Мы рекомендуем использовать промежуточную среду.</span><span class="sxs-lookup"><span data-stu-id="52d30-112">We recommend using a staging environment.</span></span> <span data-ttu-id="52d30-113">Таким образом, можно сделать tooyour обновления сначала тестового сервера и затем упрощения цикла тестирования перед переходом в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="52d30-113">This way, you can make updates tooyour staging server first, and then facilitate a testing cycle before going into production.</span></span>

* <span data-ttu-id="52d30-114">Мы предполагаем, что уже настройки SSL для SharePoint, так как нам требуется SSL на hello опубликованные URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="52d30-114">We assume that you have already set up SSL for SharePoint, because we require SSL on hello published URL.</span></span> <span data-ttu-id="52d30-115">Требуется toohave, протокол SSL включен на внутренний узел, что ссылки отправлено/правильно сопоставлены tooensure.</span><span class="sxs-lookup"><span data-stu-id="52d30-115">You need toohave SSL enabled on your internal site, tooensure that links are sent/mapped correctly.</span></span> <span data-ttu-id="52d30-116">Если вы еще не настроили SSL, см. инструкции в разделе [Настройка SSL для SharePoint 2013](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013).</span><span class="sxs-lookup"><span data-stu-id="52d30-116">If you haven't configured SSL, see [Configure SSL for SharePoint 2013](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013) for instructions.</span></span> <span data-ttu-id="52d30-117">Кроме того убедитесь, что hello соединителя доверие hello сертификат компьютера, выдается.</span><span class="sxs-lookup"><span data-stu-id="52d30-117">Also, make sure that hello connector machine trusts hello certificate that you issue.</span></span> <span data-ttu-id="52d30-118">(hello сертификатов не требуются публично выдан toobe).</span><span class="sxs-lookup"><span data-stu-id="52d30-118">(hello certificate does not need toobe publicly issued.)</span></span>

## <a name="step-1-set-up-single-sign-on-toosharepoint"></a><span data-ttu-id="52d30-119">Шаг 1: Настройка tooSharePoint</span><span class="sxs-lookup"><span data-stu-id="52d30-119">Step 1: Set up single sign-on tooSharePoint</span></span>

<span data-ttu-id="52d30-120">Клиентам требуется возможности наиболее единого входа для приложений серверной части, сервер SharePoint, в этом случае hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-120">Our customers want hello best SSO experience for their back-end applications, SharePoint server in this case.</span></span> <span data-ttu-id="52d30-121">В этом распространенном сценарии Azure AD hello пользователя проходит проверку подлинности только один раз, так как они не будет предлагаться для проверки подлинности еще раз.</span><span class="sxs-lookup"><span data-stu-id="52d30-121">In this common Azure AD scenario, hello user is authenticated only once, because they will not be prompted for authentication again.</span></span>

<span data-ttu-id="52d30-122">Для локальных приложений, в которых требуется проверка подлинности Windows можно добиться с помощью hello протокол проверки подлинности Kerberos и ограниченное делегирование Kerberos (KCD) называемую единого входа.</span><span class="sxs-lookup"><span data-stu-id="52d30-122">For on-premises applications that require or use Windows authentication, you can achieve SSO by using hello Kerberos authentication protocol and a feature called Kerberos constrained delegation (KCD).</span></span> <span data-ttu-id="52d30-123">Ограниченное делегирование Kerberos, если настроена, допускает tooobtain соединитель прокси приложения hello windows билет или токен для пользователя, даже если hello пользователь не вошел в систему tooWindows напрямую.</span><span class="sxs-lookup"><span data-stu-id="52d30-123">KCD, when configured, allows hello Application Proxy connector tooobtain a windows ticket/token for a user, even if hello user hasn’t signed in tooWindows directly.</span></span> <span data-ttu-id="52d30-124">toolearn Дополнительные сведения о проверки подлинности Kerberos, в разделе [Kerberos ограниченное делегирование Обзор](https://technet.microsoft.com/library/jj553400.aspx).</span><span class="sxs-lookup"><span data-stu-id="52d30-124">toolearn more about KCD, see [Kerberos Constrained Delegation Overview](https://technet.microsoft.com/library/jj553400.aspx).</span></span>

<span data-ttu-id="52d30-125">tooset копирование ограниченное делегирование Kerberos для сервера SharePoint, используйте процедуры hello в следующих разделах последовательных hello:</span><span class="sxs-lookup"><span data-stu-id="52d30-125">tooset up KCD for a SharePoint server, use hello procedures in hello following sequential sections:</span></span>

### <a name="ensure-that-sharepoint-is-running-under-a-service-account"></a><span data-ttu-id="52d30-126">Проверка того, что сервер SharePoint запущен с использованием учетной записи службы</span><span class="sxs-lookup"><span data-stu-id="52d30-126">Ensure that SharePoint is running under a service account</span></span>

<span data-ttu-id="52d30-127">Сначала проверьте, что сервер SharePoint запущен с использованием определенной учетной записи службы, а не учетной записи локальной системы, локальной службы или сетевой службы.</span><span class="sxs-lookup"><span data-stu-id="52d30-127">First, make sure that SharePoint is running under a defined service account--not local system, local service, or network service.</span></span> <span data-ttu-id="52d30-128">Для этого, чтобы можно было присоединить имена участника (SPN) службы tooa допустимую учетную запись.</span><span class="sxs-lookup"><span data-stu-id="52d30-128">Do this so that you can attach service principal names (SPNs) tooa valid account.</span></span> <span data-ttu-id="52d30-129">Имена участников-служб, как hello протокол Kerberos приведены различные службы.</span><span class="sxs-lookup"><span data-stu-id="52d30-129">SPNs are how hello Kerberos protocol identifies different services.</span></span> <span data-ttu-id="52d30-130">И будет необходимо hello учетной записи более поздней версии tooconfigure hello ограниченное делегирование Kerberos.</span><span class="sxs-lookup"><span data-stu-id="52d30-130">And you will need hello account later tooconfigure hello KCD.</span></span>

<span data-ttu-id="52d30-131">tooensure веб-узлы, работающие под учетной записью службы, определенные выполните следующие шаги hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-131">tooensure that your sites are running under a defined service account, perform hello following steps:</span></span>

1. <span data-ttu-id="52d30-132">Откройте hello **Центр администрирования SharePoint 2013** сайта.</span><span class="sxs-lookup"><span data-stu-id="52d30-132">Open hello **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="52d30-133">Go слишком**безопасности** и выберите **Настройка учетных записей служб**.</span><span class="sxs-lookup"><span data-stu-id="52d30-133">Go too**Security** and select **Configure service accounts**.</span></span>
3. <span data-ttu-id="52d30-134">Выберите **Пул веб-приложений — SharePoint — 80**.</span><span class="sxs-lookup"><span data-stu-id="52d30-134">Select **Web Application Pool - SharePoint - 80**.</span></span> <span data-ttu-id="52d30-135">Hello параметры могут несколько отличаться на основе имени hello web пула или если hello веб-пул по умолчанию использует SSL.</span><span class="sxs-lookup"><span data-stu-id="52d30-135">hello options may be slightly different based on hello name of your web pool, or if hello web pool uses SSL by default.</span></span>

  ![Параметры для настройки учетной записи службы](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-web-application.png)

4. <span data-ttu-id="52d30-137">Если **выберите учетную запись для этого компонента** — **локальной службы** или **сетевой службы**, требуется toocreate учетную запись.</span><span class="sxs-lookup"><span data-stu-id="52d30-137">If **Select an account for this component** is **Local Service** or **Network Service**, you need toocreate an account.</span></span> <span data-ttu-id="52d30-138">В противном случае завершения работы и можно переместить toohello следующего раздела.</span><span class="sxs-lookup"><span data-stu-id="52d30-138">If not, you're finished and can move toohello next section.</span></span>
5. <span data-ttu-id="52d30-139">Выберите **Регистрация новой управляемой учетной записи**.</span><span class="sxs-lookup"><span data-stu-id="52d30-139">Select **Register new managed account**.</span></span> <span data-ttu-id="52d30-140">После создания учетной записи необходимо задать **пула веб-приложений** перед использованием hello учетной записи.</span><span class="sxs-lookup"><span data-stu-id="52d30-140">After your account is created, you must set **Web Application Pool** before you can use hello account.</span></span>

> [!NOTE]
<span data-ttu-id="52d30-141">Требуется toohave a ранее для создания учетной записи Azure AD для службы hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-141">You need toohave a previously created Azure AD account for hello service.</span></span> <span data-ttu-id="52d30-142">Мы рекомендуем настроить автоматическую смену паролей.</span><span class="sxs-lookup"><span data-stu-id="52d30-142">We suggest that you allow for an automatic password change.</span></span> <span data-ttu-id="52d30-143">Дополнительные сведения о hello полный набор действий и устранение неполадок см. в разделе [Настройка автоматическая смена пароля в SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).</span><span class="sxs-lookup"><span data-stu-id="52d30-143">For more information about hello full set of steps and troubleshooting issues, see [Configure automatic password change in SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).</span></span>

### <a name="configure-sharepoint-for-kerberos"></a><span data-ttu-id="52d30-144">Настройка SharePoint для Kerberos</span><span class="sxs-lookup"><span data-stu-id="52d30-144">Configure SharePoint for Kerberos</span></span>

<span data-ttu-id="52d30-145">Использование проверки подлинности Kerberos tooperform единого входа toohello SharePoint server, и это работает только с использованием Kerberos.</span><span class="sxs-lookup"><span data-stu-id="52d30-145">You use KCD tooperform single sign-on toohello SharePoint server, and this works only with Kerberos.</span></span>

<span data-ttu-id="52d30-146">tooconfigure сайта SharePoint, для проверки подлинности Kerberos.</span><span class="sxs-lookup"><span data-stu-id="52d30-146">tooconfigure your SharePoint site for Kerberos authentication:</span></span>

1. <span data-ttu-id="52d30-147">Откройте hello **Центр администрирования SharePoint 2013** сайта.</span><span class="sxs-lookup"><span data-stu-id="52d30-147">Open hello **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="52d30-148">Go слишком**управление приложениями**выберите **управление веб-приложениями**и выберите сайт SharePoint.</span><span class="sxs-lookup"><span data-stu-id="52d30-148">Go too**Application Management**, select **Manage web applications**, and select your SharePoint site.</span></span> <span data-ttu-id="52d30-149">В данном примере выберите **SharePoint — 80**.</span><span class="sxs-lookup"><span data-stu-id="52d30-149">In this example, it is **SharePoint - 80**.</span></span>

  ![При выборе узла SharePoint hello](./media/application-proxy-remote-sharepoint/remote-sharepoint-manage-web-applications.png)

3. <span data-ttu-id="52d30-151">Нажмите кнопку **поставщики проверки подлинности** на панели инструментов hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-151">Click **Authentication Providers** on hello toolbar.</span></span>
4. <span data-ttu-id="52d30-152">В hello **поставщики проверки подлинности** щелкните **зоны по умолчанию** tooview hello параметры.</span><span class="sxs-lookup"><span data-stu-id="52d30-152">In hello **Authentication Providers** box, click **Default Zone** tooview hello settings.</span></span>
5. <span data-ttu-id="52d30-153">В hello **изменить проверку подлинности** диалогового окна поле, прокрутите вниз, пока не увидите **типы проверки подлинности утверждений** и убедитесь, что оба **включить проверку подлинности Windows** и  **Встроенная проверка подлинности Windows** выбраны.</span><span class="sxs-lookup"><span data-stu-id="52d30-153">In hello **Edit Authentication** dialog box, scroll down until you see **Claims Authentication Types** and ensure that both **Enable Windows Authentication** and **Integrated Windows Authentication** are selected.</span></span>
6. <span data-ttu-id="52d30-154">Убедитесь, что в раскрывающемся списке hello, **согласование (Kerberos)** выбран.</span><span class="sxs-lookup"><span data-stu-id="52d30-154">In hello drop-down box, make sure that **Negotiate (Kerberos)** is selected.</span></span>

  ![Диалоговое окно "Изменение параметров проверки подлинности"](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-edit-authentication.png)

7. <span data-ttu-id="52d30-156">Внизу hello hello **изменить проверку подлинности** диалоговое окно, нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="52d30-156">At hello bottom of hello **Edit Authentication** dialog box, click **Save**.</span></span>

### <a name="set-a-service-principal-name-for-hello-sharepoint-service-account"></a><span data-ttu-id="52d30-157">Задание имени субъекта-службы для учетной записи службы SharePoint hello</span><span class="sxs-lookup"><span data-stu-id="52d30-157">Set a service principal name for hello SharePoint service account</span></span>

<span data-ttu-id="52d30-158">Перед настройкой hello ограниченное делегирование Kerberos необходимо tooidentify hello SharePoint службы запускается от имени учетной записи службы hello, который настроен.</span><span class="sxs-lookup"><span data-stu-id="52d30-158">Before you configure hello KCD, you need tooidentify hello SharePoint service running as hello service account that you've configured.</span></span> <span data-ttu-id="52d30-159">Для этого нужно задать имя субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="52d30-159">You do this by setting an SPN.</span></span> <span data-ttu-id="52d30-160">Дополнительные сведения об именах субъектов-служб см. в [этом разделе](https://technet.microsoft.com/library/cc961723.aspx).</span><span class="sxs-lookup"><span data-stu-id="52d30-160">For more information, see [Service Principal Names](https://technet.microsoft.com/library/cc961723.aspx).</span></span>

<span data-ttu-id="52d30-161">имеет следующий формат имени участника-службы Hello:</span><span class="sxs-lookup"><span data-stu-id="52d30-161">hello SPN format is:</span></span>

```
<service class>/<host>:<port>
```

<span data-ttu-id="52d30-162">В формате имени участника-службы hello:</span><span class="sxs-lookup"><span data-stu-id="52d30-162">In hello SPN format:</span></span>

* <span data-ttu-id="52d30-163">_класс службы_ — это уникальное имя для службы hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-163">_service class_ is a unique name for hello service.</span></span> <span data-ttu-id="52d30-164">Для SharePoint используется **HTTP**.</span><span class="sxs-lookup"><span data-stu-id="52d30-164">For SharePoint, you use **HTTP**.</span></span>

* <span data-ttu-id="52d30-165">_узел_ является полным доменным hello или NetBIOS-имя узла hello, hello службы выполняется на.</span><span class="sxs-lookup"><span data-stu-id="52d30-165">_host_ is hello fully qualified domain or NetBIOS name of hello host that hello service is running on.</span></span> <span data-ttu-id="52d30-166">Для сайта SharePoint этот текст может потребоваться URL-адрес сайта hello, в зависимости от версии hello служб IIS, которую вы используете для hello toobe.</span><span class="sxs-lookup"><span data-stu-id="52d30-166">For a SharePoint site, this text might need toobe hello URL of hello site, depending on hello version of IIS that you're using.</span></span>

* <span data-ttu-id="52d30-167">_port_ указывать необязательно.</span><span class="sxs-lookup"><span data-stu-id="52d30-167">_port_ is optional.</span></span>

<span data-ttu-id="52d30-168">Если полное доменное имя сервера SharePoint hello hello:</span><span class="sxs-lookup"><span data-stu-id="52d30-168">If hello FQDN of hello SharePoint server is:</span></span>

```
sharepoint.demo.o365identity.us
```

<span data-ttu-id="52d30-169">Затем hello имени участника-службы является:</span><span class="sxs-lookup"><span data-stu-id="52d30-169">Then hello SPN is:</span></span>

```
HTTP/ sharepoint.demo.o365identity.us demo
```

<span data-ttu-id="52d30-170">Может также потребоваться tooset имена участников-служб для определенных сайтов на сервере.</span><span class="sxs-lookup"><span data-stu-id="52d30-170">You might also need tooset SPNs for specific sites on your server.</span></span> <span data-ttu-id="52d30-171">Дополнительные сведения см. в статье [Настройка проверки подлинности Kerberos](https://technet.microsoft.com/library/cc263449(v=office.12).aspx).</span><span class="sxs-lookup"><span data-stu-id="52d30-171">For more information, see [Configure Kerberos authentication](https://technet.microsoft.com/library/cc263449(v=office.12).aspx).</span></span> <span data-ttu-id="52d30-172">Обратите особое внимание toohello раздел «Создать имена участника-службы для веб-приложений с использованием проверки подлинности Kerberos».</span><span class="sxs-lookup"><span data-stu-id="52d30-172">Pay close attention toohello section "Create Service Principal Names for your Web applications using Kerberos authentication."</span></span>

<span data-ttu-id="52d30-173">Простейший способ Hello tooset имена участников-служб — toofollow hello SPN форматы, которые могут уже присутствовать для веб-сайтов.</span><span class="sxs-lookup"><span data-stu-id="52d30-173">hello easiest way for you tooset SPNs is toofollow hello SPN formats that may already be present for your sites.</span></span> <span data-ttu-id="52d30-174">Скопируйте эти tooregister имена участников-служб для учетной записи службы hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-174">Copy those SPNs tooregister against hello service account.</span></span> <span data-ttu-id="52d30-175">toodo это:</span><span class="sxs-lookup"><span data-stu-id="52d30-175">toodo this:</span></span>

1. <span data-ttu-id="52d30-176">Обзор узла toohello с hello имени участника-службы с другого компьютера.</span><span class="sxs-lookup"><span data-stu-id="52d30-176">Browse toohello site with hello SPN from another machine.</span></span>
 <span data-ttu-id="52d30-177">При hello соответствующий набор билетов Kerberos, кэшируется на компьютере hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-177">When you do, hello relevant set of Kerberos tickets is cached on hello machine.</span></span> <span data-ttu-id="52d30-178">Эти билеты содержат hello hello целевого сайта, который просматривается в имя участника-службы.</span><span class="sxs-lookup"><span data-stu-id="52d30-178">These tickets contain hello SPN of hello target site that you browsed to.</span></span>

2. <span data-ttu-id="52d30-179">Вы можете извлечь hello имени участника-службы для этого сайта, используя средство под названием [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html).</span><span class="sxs-lookup"><span data-stu-id="52d30-179">You can pull hello SPN for that site by using a tool called [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html).</span></span> <span data-ttu-id="52d30-180">В окно командной строки, на котором выполняется в hello контексте hello пользователя, доступ к которым осуществляется hello узла в обозревателе hello, запустите hello следующую команду:</span><span class="sxs-lookup"><span data-stu-id="52d30-180">In a command window that's running in hello same context as hello user who accessed hello site in hello browser, run hello following command:</span></span>
```
Klist
```
<span data-ttu-id="52d30-181">Klist возвращает hello набор целевых имен участников-служб.</span><span class="sxs-lookup"><span data-stu-id="52d30-181">Klist then returns hello set of target SPNs.</span></span> <span data-ttu-id="52d30-182">В этом примере выделен hello значение — hello имени участника-службы, которые необходимы:</span><span class="sxs-lookup"><span data-stu-id="52d30-182">In this example, hello highlighted value is hello SPN that's needed:</span></span>

  ![Пример результатов Klist](./media/application-proxy-remote-sharepoint/remote-sharepoint-target-service.png)

4. <span data-ttu-id="52d30-184">Теперь, когда имеется hello имени участника-службы, необходимо убедиться, что он правильно настроен на hello учетной записи службы, настроенные для веб-приложения hello toomake.</span><span class="sxs-lookup"><span data-stu-id="52d30-184">Now that you have hello SPN, you need toomake sure that it's configured correctly on hello service account that you set up for hello web application earlier.</span></span> <span data-ttu-id="52d30-185">Выполните следующую команду из командной строки hello с правами администратора домена hello hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-185">Run hello following command from hello command prompt as an administrator of hello domain:</span></span>

 ```
 setspn -S http/sharepoint.demo.o365identity.us demo\sp_svc
 ```

 <span data-ttu-id="52d30-186">Эта команда задает hello имени участника-службы для службы SharePoint hello учетной записи работает как _demo\sp_svc_.</span><span class="sxs-lookup"><span data-stu-id="52d30-186">This command sets hello SPN for hello SharePoint service account running as _demo\sp_svc_.</span></span>

 <span data-ttu-id="52d30-187">Замените _http/sharepoint.demo.o365identity.us_ с hello имени участника-службы для сервера и _demo\sp_svc_ с учетной записью службы hello в вашей среде.</span><span class="sxs-lookup"><span data-stu-id="52d30-187">Replace _http/sharepoint.demo.o365identity.us_ with hello SPN for your server and _demo\sp_svc_ with hello service account in your environment.</span></span> <span data-ttu-id="52d30-188">команды Setspn Hello ищет hello SPN, прежде чем его добавить.</span><span class="sxs-lookup"><span data-stu-id="52d30-188">hello Setspn command searches for hello SPN before it adds it.</span></span> <span data-ttu-id="52d30-189">В этом случае может появиться ошибка **Повторяющееся значение имени субъекта-службы**.</span><span class="sxs-lookup"><span data-stu-id="52d30-189">In this case, you might see a **Duplicate SPN Value** error.</span></span> <span data-ttu-id="52d30-190">Если вы видите эту ошибку, убедитесь, что значение hello связано с учетной записью службы hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-190">If you see this error, make sure that hello value is associated with hello service account.</span></span>

<span data-ttu-id="52d30-191">Вы можете проверить, hello добавления имени участника-службы, выполнив команду Setspn hello с hello -l.</span><span class="sxs-lookup"><span data-stu-id="52d30-191">You can verify that hello SPN was added by running hello Setspn command with hello -l option.</span></span> <span data-ttu-id="52d30-192">toolearn больше об этой команде см [Setspn](https://technet.microsoft.com/library/cc731241.aspx).</span><span class="sxs-lookup"><span data-stu-id="52d30-192">toolearn more about this command, see [Setspn](https://technet.microsoft.com/library/cc731241.aspx).</span></span>

### <a name="ensure-that-hello-connector-is-set-as-a-trusted-delegate-toosharepoint"></a><span data-ttu-id="52d30-193">Убедитесь, что этого соединителя hello назначен tooSharePoint доверенных делегата</span><span class="sxs-lookup"><span data-stu-id="52d30-193">Ensure that hello connector is set as a trusted delegate tooSharePoint</span></span>

<span data-ttu-id="52d30-194">Настройте ограниченное делегирование Kerberos hello таким образом, чтобы службы прокси приложения Azure AD hello можно делегировать toohello SharePoint пользователя удостоверения службы.</span><span class="sxs-lookup"><span data-stu-id="52d30-194">Configure hello KCD so that hello Azure AD Application Proxy service can delegate user identities toohello SharePoint service.</span></span> <span data-ttu-id="52d30-195">Это делается путем включения соединитель прокси приложения hello tooretrieve билеты Kerberos для пользователей, которые прошли проверку подлинности в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="52d30-195">You do this by enabling hello Application Proxy connector tooretrieve Kerberos tickets for your users who have been authenticated in Azure AD.</span></span> <span data-ttu-id="52d30-196">Затем этот сервер передает hello контекста toohello целевое приложение или SharePoint в этом случае.</span><span class="sxs-lookup"><span data-stu-id="52d30-196">Then that server passes hello context toohello target application, or SharePoint in this case.</span></span>

<span data-ttu-id="52d30-197">hello tooconfigure ограниченное делегирование Kerberos, повторите hello следующие шаги для каждой машины соединителя:</span><span class="sxs-lookup"><span data-stu-id="52d30-197">tooconfigure hello KCD, repeat hello following steps for each connector machine:</span></span>

1. <span data-ttu-id="52d30-198">Войдите в систему как tooa администратора домена контроллера домена, а затем откройте **Active Directory — пользователи и компьютеры**.</span><span class="sxs-lookup"><span data-stu-id="52d30-198">Log in as a domain administrator tooa DC, and then open **Active Directory Users and Computers**.</span></span>
2. <span data-ttu-id="52d30-199">Найти hello, hello соединителя выполняется.</span><span class="sxs-lookup"><span data-stu-id="52d30-199">Find hello computer that hello connector is running on.</span></span> <span data-ttu-id="52d30-200">В этом примере он имеет hello же SharePoint server.</span><span class="sxs-lookup"><span data-stu-id="52d30-200">In this example, it's hello same SharePoint server.</span></span>
3. <span data-ttu-id="52d30-201">Дважды щелкните компьютер hello и нажмите кнопку hello **делегирования** вкладки.</span><span class="sxs-lookup"><span data-stu-id="52d30-201">Double-click hello computer, and then click hello **Delegation** tab.</span></span>
4. <span data-ttu-id="52d30-202">Убедитесь, что параметры делегирования hello заданы слишком**этот компьютер доверенный для делегирования toohello указано только службы**, а затем выберите **использовать любой протокол проверки подлинности**.</span><span class="sxs-lookup"><span data-stu-id="52d30-202">Ensure that hello delegation settings are set too**Trust this computer for delegation toohello specified services only**, and then select **Use any authentication protocol**.</span></span>

  ![Параметры делегирования](./media/application-proxy-remote-sharepoint/remote-sharepoint-delegation-box.png)

5. <span data-ttu-id="52d30-204">Нажмите кнопку hello **добавить** , выберите элемент **пользователей или компьютеров**и найдите учетную запись службы hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-204">Click hello **Add** button, click **Users or Computers**, and locate hello service account.</span></span>

  ![Добавление hello имени участника-службы для учетной записи службы hello](./media/application-proxy-remote-sharepoint/remote-sharepoint-users-computers.png)

6. <span data-ttu-id="52d30-206">В списке приветствия имен участников-служб выберите hello, созданную вами ранее для учетной записи службы hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-206">In hello list of SPNs, select hello one that you created earlier for hello service account.</span></span>
7. <span data-ttu-id="52d30-207">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="52d30-207">Click **OK**.</span></span> <span data-ttu-id="52d30-208">Нажмите кнопку **ОК** попытку изменения toosave hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-208">Click **OK** again toosave hello changes.</span></span>

## <a name="step-2-enable-remote-access-toosharepoint"></a><span data-ttu-id="52d30-209">Шаг 2: Включение tooSharePoint удаленного доступа</span><span class="sxs-lookup"><span data-stu-id="52d30-209">Step 2: Enable remote access tooSharePoint</span></span>

<span data-ttu-id="52d30-210">Теперь, когда вы включить SharePoint для Kerberos и настроить ограниченное делегирование Kerberos, вы готовы tooset копирование tooSharePoint.</span><span class="sxs-lookup"><span data-stu-id="52d30-210">Now that you’ve enabled SharePoint for Kerberos and configured KCD, you're ready tooset up single sign-on tooSharePoint.</span></span> <span data-ttu-id="52d30-211">Затем из соединителя hello, вы можете опубликовать hello фермы SharePoint для удаленного доступа через прокси приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="52d30-211">Then from hello connector, you can publish hello SharePoint farm for remote access through Azure AD Application Proxy.</span></span>

<span data-ttu-id="52d30-212">tooperform hello следующие действия, необходимо toobe членом hello роль глобального администратора в учетной записи Azure Active Directory вашей организации.</span><span class="sxs-lookup"><span data-stu-id="52d30-212">tooperform hello following steps, you need toobe a member of hello Global Administrator Role in your organization's Azure Active Directory account.</span></span>

1. <span data-ttu-id="52d30-213">Войдите в toohello [портал Azure](https://manage.windowsazure.com) и найти клиента Azure AD.</span><span class="sxs-lookup"><span data-stu-id="52d30-213">Sign in toohello [Azure portal](https://manage.windowsazure.com) and find your Azure AD tenant.</span></span>
2. <span data-ttu-id="52d30-214">Щелкните **Приложения**, а затем — **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="52d30-214">Click **Applications**, and then click **Add**.</span></span>
3. <span data-ttu-id="52d30-215">Выберите **Публикация приложения, которое будет доступно за пределами вашей сети**.</span><span class="sxs-lookup"><span data-stu-id="52d30-215">Select **Publish an application that will be accessible from outside your network**.</span></span> <span data-ttu-id="52d30-216">Если этот параметр не отображается, убедитесь, что у вас есть Azure AD Basic или настроить Premium в клиенте hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-216">If you don’t see this option, make sure that you have Azure AD Basic or Premium set up in hello tenant.</span></span>
4. <span data-ttu-id="52d30-217">Завершите все параметры hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="52d30-217">Complete each of hello options as follows:</span></span>
 * <span data-ttu-id="52d30-218">**Имя**: любое значение, например **SharePoint**.</span><span class="sxs-lookup"><span data-stu-id="52d30-218">**Name**: Use any value that you want--for example, **SharePoint**.</span></span>
 * <span data-ttu-id="52d30-219">**Внутренний URL-адрес**: hello URL-адрес сайта SharePoint hello внутренне, такие как **https://SharePoint/**.</span><span class="sxs-lookup"><span data-stu-id="52d30-219">**Internal URL**: This is hello URL of hello SharePoint site internally, such as **https://SharePoint/**.</span></span> <span data-ttu-id="52d30-220">В этом примере, убедитесь, что toouse **https**.</span><span class="sxs-lookup"><span data-stu-id="52d30-220">In this example, make sure toouse **https**.</span></span>
 * <span data-ttu-id="52d30-221">**Метод предварительной проверки подлинности:** выберите **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="52d30-221">**Preauthentication Method**: Select **Azure Active Directory**.</span></span>

  ![Параметры для добавления приложения](./media/application-proxy-remote-sharepoint/remote-sharepoint-add-application.png)

5. <span data-ttu-id="52d30-223">После публикации приложения hello щелкните hello **Настройка** вкладки.</span><span class="sxs-lookup"><span data-stu-id="52d30-223">After hello app is published, click hello **Configure** tab.</span></span>
6. <span data-ttu-id="52d30-224">Прокрутите вниз параметр toohello **перевод веб-страницы в заголовках**.</span><span class="sxs-lookup"><span data-stu-id="52d30-224">Scroll down toohello option **Translate URL in Headers**.</span></span> <span data-ttu-id="52d30-225">значение по умолчанию Hello — **Да**.</span><span class="sxs-lookup"><span data-stu-id="52d30-225">hello default value is **YES**.</span></span> <span data-ttu-id="52d30-226">Измените его слишком**нет**.</span><span class="sxs-lookup"><span data-stu-id="52d30-226">Change it too**NO**.</span></span>

 <span data-ttu-id="52d30-227">SharePoint использует hello _заголовок узла_ toolook значение узла hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-227">SharePoint uses hello _Host Header_ value toolook up hello site.</span></span> <span data-ttu-id="52d30-228">Он также создает ссылки на его основе.</span><span class="sxs-lookup"><span data-stu-id="52d30-228">It also generates links based on this value.</span></span> <span data-ttu-id="52d30-229">конечным итогом Hello является toomake, убедитесь, что любая ссылка, которая приводит к возникновению ошибки SharePoint URL-адрес публикации, правильно ли установлен внешний URL-адрес toouse hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-229">hello net effect is toomake sure that any link that SharePoint generates is a published URL that is correctly set toouse hello external URL.</span></span> <span data-ttu-id="52d30-230">Установка значения hello слишком**Да** также включает hello соединитель tooforward hello запроса toohello серверной части приложения.</span><span class="sxs-lookup"><span data-stu-id="52d30-230">Setting hello value too**YES** also enables hello connector tooforward hello request toohello back-end application.</span></span> <span data-ttu-id="52d30-231">Однако можно присвоить значение hello слишком**нет** означает, что hello соединитель не будет отправлять имя внутреннего узла hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-231">However, setting hello value too**NO** means that hello connector will not send hello internal host name.</span></span> <span data-ttu-id="52d30-232">Вместо этого соединителя hello отправляет заголовок узла hello, hello опубликованной внутреннего toohello URL-адрес приложения.</span><span class="sxs-lookup"><span data-stu-id="52d30-232">Instead, hello connector sends hello host header as hello published URL toohello back-end application.</span></span>

 <span data-ttu-id="52d30-233">Кроме того, tooensure SharePoint принимает этот URL-адрес, необходимо toocomplete один дополнительные конфигурации на сервере SharePoint hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-233">Also, tooensure that SharePoint accepts this URL, you need toocomplete one more configuration on hello SharePoint server.</span></span> <span data-ttu-id="52d30-234">Вы сможете сделать, в следующем разделе hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-234">You'll do that in hello next section.</span></span>

7. <span data-ttu-id="52d30-235">Изменение **внутренний метод проверки подлинности** слишком**встроенная проверка подлинности Windows**.</span><span class="sxs-lookup"><span data-stu-id="52d30-235">Change **Internal Authentication Method** too**Integrated Windows Authentication**.</span></span> <span data-ttu-id="52d30-236">Если вашего клиента Azure AD использует имя участника-пользователя в облаке hello, отличается от hello имени участника-пользователя в локальной среде, не забывайте tooupdate **делегированы идентификатора имени входа** также.</span><span class="sxs-lookup"><span data-stu-id="52d30-236">If your Azure AD tenant uses a UPN in hello cloud that's different from hello UPN on-premises, remember tooupdate **Delegated Login Identity** as well.</span></span>
8. <span data-ttu-id="52d30-237">Задать **SPN внутреннего приложения** toohello значение, которое было установлено ранее.</span><span class="sxs-lookup"><span data-stu-id="52d30-237">Set **Internal Application SPN** toohello value that you set earlier.</span></span> <span data-ttu-id="52d30-238">Например, **http/sharepoint.demo.o365identity.us**.</span><span class="sxs-lookup"><span data-stu-id="52d30-238">For example, use **http/sharepoint.demo.o365identity.us**.</span></span>
9. <span data-ttu-id="52d30-239">Назначьте tooyour приложения hello конечным пользователям.</span><span class="sxs-lookup"><span data-stu-id="52d30-239">Assign hello application tooyour target users.</span></span>

<span data-ttu-id="52d30-240">Приложение должно выглядеть примерно toohello следующий пример:</span><span class="sxs-lookup"><span data-stu-id="52d30-240">Your application should look similar toohello following example:</span></span>

  ![Завершенное приложение](./media/application-proxy-remote-sharepoint/remote-sharepoint-internal-application-spn.png)

## <a name="step-3-ensure-that-sharepoint-knows-about-hello-external-url"></a><span data-ttu-id="52d30-242">Шаг 3: Убедитесь, что SharePoint знает о hello внешний URL-адрес</span><span class="sxs-lookup"><span data-stu-id="52d30-242">Step 3: Ensure that SharePoint knows about hello external URL</span></span>

<span data-ttu-id="52d30-243">Ваш последний шаг tooensure, SharePoint можно найти hello сайт на основании hello внешний URL-адрес, чтобы он будет отображать ссылок на основании этого внешний URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="52d30-243">Your last step tooensure that SharePoint can find hello site based on hello external URL, so that it will render links based on that external URL.</span></span> <span data-ttu-id="52d30-244">Это делается путем настройки сопоставлений альтернативного доступа для сайта SharePoint hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-244">You do this by configuring alternate access mappings for hello SharePoint site.</span></span>

1. <span data-ttu-id="52d30-245">Откройте hello **Центр администрирования SharePoint 2013** сайта.</span><span class="sxs-lookup"><span data-stu-id="52d30-245">Open hello **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="52d30-246">В разделе **Параметры системы** выберите **Настройка сопоставлений альтернативного доступа**.</span><span class="sxs-lookup"><span data-stu-id="52d30-246">Under **System Settings**, select **Configure Alternate Access Mappings**.</span></span>

 <span data-ttu-id="52d30-247">При этом откроется hello **сопоставления для альтернативного доступа** поле.</span><span class="sxs-lookup"><span data-stu-id="52d30-247">This opens hello **Alternate Access Mappings** box.</span></span>

  ![Окно "Сопоставления для альтернативного доступа"](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access1.png)

3. <span data-ttu-id="52d30-249">В hello раскрывающегося списка рядом с **коллекции альтернативного сопоставления доступа**выберите **изменить коллекцию альтернативных сопоставлений доступа**.</span><span class="sxs-lookup"><span data-stu-id="52d30-249">In hello drop-down list beside **Alternate Access Mapping Collection**, select **Change Alternate Access Mapping Collection**.</span></span>
4. <span data-ttu-id="52d30-250">Выберите сайт, например **SharePoint — 80**.</span><span class="sxs-lookup"><span data-stu-id="52d30-250">Select your site--for example, **SharePoint - 80**.</span></span>

  ![Выбор сайта](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access2.png)

5. <span data-ttu-id="52d30-252">Вы можете tooadd hello опубликованные URL-адрес как внутренний URL-адрес или общедоступный URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="52d30-252">You can choose tooadd hello published URL as either an internal URL or a public URL.</span></span> <span data-ttu-id="52d30-253">Этот пример использует общедоступный URL-адрес как hello экстрасети.</span><span class="sxs-lookup"><span data-stu-id="52d30-253">This example uses a public URL as hello extranet.</span></span>
6. <span data-ttu-id="52d30-254">Нажмите кнопку **изменить общедоступные URL-адреса** в hello **экстрасеть** пути, а затем введите hello путь для hello опубликованное приложение, как показано в предыдущем шаге hello.</span><span class="sxs-lookup"><span data-stu-id="52d30-254">Click **Edit Public URLs** in hello **Extranet** path, and then enter hello path for hello published application, as in hello previous step.</span></span> <span data-ttu-id="52d30-255">Например, **https://sharepoint-iddemo.msappproxy.net**.</span><span class="sxs-lookup"><span data-stu-id="52d30-255">For example, enter **https://sharepoint-iddemo.msappproxy.net**.</span></span>

  ![Введя путь hello](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access3.png)

7. <span data-ttu-id="52d30-257">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="52d30-257">Click **Save**.</span></span>

 <span data-ttu-id="52d30-258">Теперь вы можете просматривать сайт SharePoint hello извне через прокси приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="52d30-258">You can now access hello SharePoint site externally via Azure AD Application Proxy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="52d30-259">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="52d30-259">Next steps</span></span>

- [<span data-ttu-id="52d30-260">Как tooprovide безопасный удаленный доступ tooon локальные приложения</span><span class="sxs-lookup"><span data-stu-id="52d30-260">How tooprovide secure remote access tooon-premises applications</span></span>](active-directory-application-proxy-get-started.md)
- [<span data-ttu-id="52d30-261">Сведения о соединителях прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="52d30-261">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-understand-connectors.md)
- [<span data-ttu-id="52d30-262">Публикация SharePoint 2016 и Office Online Server с помощью прокси приложения Azure AD</span><span class="sxs-lookup"><span data-stu-id="52d30-262">Publishing SharePoint 2016 and Office Online Server with Azure AD Application Proxy</span></span>](https://blogs.technet.microsoft.com/dawiese/2016/06/09/publishing-sharepoint-2016-and-office-online-server-with-azure-ad-application-proxy/)
