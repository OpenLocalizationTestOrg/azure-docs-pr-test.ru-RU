---
title: "изменения виртуальной машины aaaMonitor - сетки событий Azure и логика приложений | Документы Microsoft"
description: "Проверка наличия изменений конфигурации в виртуальных машинах с помощью службы \"Сетка событий Azure\" и Logic Apps."
keywords: "приложения логики, сетки событий, виртуальная машина, VM"
services: logic-apps
author: ecfan
manager: anneta
ms.assetid: 
ms.workload: logic-apps
ms.service: logic-apps
ms.topic: article
ms.date: 08/16/2017
ms.author: LADocs; estfan
ms.openlocfilehash: f0633e598be6e7880a310e6f8e64f6738cc692b3
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="monitor-virtual-machine-changes-with-azure-event-grid-and-logic-apps"></a>Отслеживание изменений виртуальной машины с помощью Azure Logic Apps и службы "Сетка событий Azure"

Можно запускать автоматический [рабочий процесс приложения логики](../logic-apps/logic-apps-what-are-logic-apps.md) при определенных событиях, которые происходят с ресурсами Azure или сторонними ресурсами. Эти ресурсы можно опубликовать эти события tooan [сетки Azure событий](../event-grid/overview.md). В свою очередь, сетка события hello помещает эти toosubscribers события, имеющие очереди, веб-привязок, или [концентраторов событий](../event-hubs/event-hubs-what-is-event-hubs.md) как конечные точки. В качестве подписчика логика приложения может ожидать эти события из сетки событий hello перед выполнением задачи tooperform - автоматические рабочие процессы без написания кода.

Например ниже приведены некоторые события, отправку toosubscribers через службу hello сетки событий Azure издателей.

* Создание, чтение, обновление или удаление ресурса. Например, можно отслеживать изменения, за которые может взиматься плата по подписке Azure и которые могут отразиться на вашем счете. 
* Добавление или удаление пользователя в подписке Azure.
* Ваше приложение выполняет определенное действие.
* В очереди появляется новое сообщение.

Данный учебник создает приложение логики, который отслеживает изменения tooa виртуальной машины и отправляет сообщения электронной почты об этих изменениях. При создании приложения логики с помощью подписки на события для ресурс Azure, из этого ресурса посредством логики приложения toohello сетки события потока событий. Hello учебнике демонстрируется создание этой логики приложения:

![Обзор: отслеживание виртуальной машины с помощью службы "Сетка событий" и приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/monitor-virtual-machine-event-grid-logic-app-overview.png)

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Создание приложения логики, отслеживающего события с помощью службы "Сетка событий".
> * Добавление условия, проверяющего наличие изменений виртуальной машины.
> * Отправка электронного сообщения при изменении виртуальной машины.

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись электронной почты [любого поставщика электронной почты, поддерживаемого Azure Logic Apps](../connectors/apis-list.md), например Office 365 Outlook, Outlook.com или Gmail, для отправки уведомлений. В этом руководстве используется Office 365 Outlook.

* [Виртуальная машина](https://azure.microsoft.com/services/virtual-machines). Создайте виртуальную машину, используя [сведения из документации по виртуальным машинам](https://docs.microsoft.com/azure/virtual-machines/), если вы еще не сделали этого. toomake hello виртуальной машины публикация событий, вы [не требуется что-либо еще toodo](../event-grid/overview.md).

## <a name="create-a-logic-app-that-monitors-events-from-an-event-grid"></a>Создание приложения логики, отслеживающего события с помощью службы "Сетка событий"

Во-первых создайте приложение логики и добавить триггер события сетки, который отслеживает hello группу ресурсов для виртуальной машины. 

1. Войдите в toohello [портал Azure](https://portal.azure.com). 

2. Hello верхнего левого угла главного меню Azure hello, выберите **New** > **интеграцию** > **приложения логики**.

   ![Создание приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/azure-portal-create-logic-app.png)

3. Создание приложения логики с hello параметры, указанные в следующей таблице hello:

   ![Ввод данных приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/create-logic-app-for-event-grid.png)

   | Настройка | Рекомендуемое значение | Описание | 
   | ------- | --------------- | ----------- | 
   | **Имя** | *{имя_вашего_приложения_логики}* | Укажите уникальное имя приложения логики. | 
   | **Подписка** | *{ваша_подписка_Azure}* | Выберите hello ту же подписку Azure для всех служб в этом учебнике. | 
   | **Группа ресурсов** | *{ваша_группа_ресурсов_Azure}* | Выберите hello для всех служб одну группу ресурсов Azure в этом учебнике. | 
   | **Расположение** | *{ваш_регион_Azure}* | Выберите hello же регионе для всех служб в этом учебнике. | 
   | | | 

4. Когда вы будете готовы, выберите **toodashboard ПИН-код**и выберите **создать**.

   Вы создали ресурс Azure для приложения логики. 
   После Azure развертывает приложение логики, hello логику приложения конструктор показывает шаблонов для распространенных шаблонов, вы можете начать работу быстрее.

   > [!NOTE] 
   > При выборе **toodashboard ПИН-код**, логика приложения автоматически открывается в конструкторе логики приложения. В противном случае вы можете вручную найти и открыть свое приложение логики.

5. Теперь выберите шаблон приложения логики. В разделе **Шаблоны** выберите **Пустое приложение логики**. Это позволит создать приложение логики с нуля.

   ![Выбор шаблона приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/choose-logic-app-template.png)

   Конструктор логику приложения Hello теперь отображается [ *соединители* ](../connectors/apis-list.md) и [ *триггеры* ](../logic-apps/logic-apps-what-are-logic-apps.md#logic-app-concepts) можно использовать toostart логику приложения и также действий что можно добавлять после tooperform запуск задач. Триггер — это событие, которое создает экземпляр приложения логики и запускает рабочий процесс приложения логики. 
   Логика приложения должна триггер как первый элемент hello.

6. В поле поиска hello введите «сетки событий» фильтра. Выберите триггер **Azure Event Grid - On a resource event** (Сетка событий Azure — для события ресурса).

   ![Выбор триггера "Azure Event Grid - On a resource event" (Сетка событий Azure — для события ресурса)](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-event-grid-trigger.png)

7. При появлении запроса выполните вход tooAzure сетки событий с учетными данными Azure.

   ![Вход с помощью учетных данных Azure](./media/monitor-virtual-machine-changes-event-grid-logic-app/sign-in-event-grid.png)

   > [!NOTE]
   > Если вы вошли с личной учетной записью Майкрософт, таких как @outlook.com или @hotmail.com, могут неправильно отображаться hello сетки событий триггера. Чтобы избежать этого, выберите [соединение с субъектом-службой](/azure-resource-manager/resource-group-create-service-principal-portal.md), или проверку подлинности от имени является членом hello Azure Active Directory, связанный с подпиской Azure, например, *имя пользователя* @emailoutlook.onmicrosoft.com.

8. Теперь подписаться событий toopublisher логику приложения. Предоставление сведений hello для подписки на событие, как указано в следующей таблице hello:

   ![Ввод сведений подписки на события](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-event-grid-trigger-details-generic.png)

   | Настройка | Рекомендуемое значение | Описание | 
   | ------- | --------------- | ----------- | 
   | **Подписка** | *{подписка_Azure_виртуальной_машины}* | Выберите подписку Azure издатель событий hello. В этом учебнике выберите hello подписки Azure для виртуальной машины. | 
   | **Тип ресурса** | Microsoft.Resources.resourceGroups | Выберите тип ресурса издатель событий hello. В этом учебнике выберите hello указанное значение, поэтому логика приложения отслеживает только группы ресурсов. | 
   | **Имя ресурса** | *{имя_группы_ресурсов_виртуальной_машины}* | Выберите имя ресурса hello издателя. В этом учебнике выберите имя группы ресурсов hello hello для виртуальной машины. | 
   | Чтобы настроить необязательные параметры, щелкните **Показать расширенные параметры**. | *{просмотрите описания}* | * **Prefix Filter** (Фильтр по префиксу): для этого руководства оставьте данный параметр пустым. поведение по умолчанию Hello соответствует всем значениям. Тем не менее можно указать строку префикса в качестве фильтра, например путь и параметр для определенного ресурса. <p>* **Suffix Filter** (Фильтр по суффиксу): для этого руководства оставьте данный параметр пустым. поведение по умолчанию Hello соответствует всем значениям. Тем не менее можно указать строку суффикса в качестве фильтра, например расширение имени файла, если вас интересуют только определенные типы файлов.<p>* **Имя подписки.** Укажите уникальное имя подписки на события. |
   | | | 

   Когда все будет готово, триггер службы "Сетка событий" должен выглядеть следующим образом:
   
   ![Сведения о примере триггера службы "Сетка событий"](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-event-grid-trigger-details.png)

9. Сохраните приложение логики. На панели инструментов конструктора hello, выберите **Сохранить**. toocollapse и скрыть сведения о действии в приложении логики, выберите действие hello заголовка.

   ![Сохранение приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-event-grid-save.png)

   При сохранении логики приложения с помощью триггера сетки событий Azure автоматически создает подписку на события для ресурса tooyour выбран логику приложения. Поэтому если hello ресурсов публикует сетки события toohello событий, этой сетки событий автоматически помещает hello событие tooyour логику приложения. Это событие запускает логику приложения, а затем создает и запускает экземпляр рабочего процесса hello, определяется в следующие шаги.

Логика приложения теперь динамической и tooevents из сетки событий Здравствуй прослушивает, но не выполняет никаких действий, пока вы не добавите рабочего процесса toohello действия. 

## <a name="add-a-condition-that-checks-for-virtual-machine-changes"></a>Добавление условия, которое проверяет наличие изменений виртуальной машины

toorun рабочего процесса логику приложения только в том случае, когда происходит определенное событие, добавьте условие проверки для виртуальной машины «» операций записи. Если это условие равно true, логику приложения отправляет вам сообщение электронной почты со сведениями о hello обновление виртуальной машины.

1. В конструкторе приложений логики в триггер сетки события hello, выберите **новый шаг** > **добавить условие**.

   ![Добавление логики приложения tooyour условие](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-event-grid-add-condition-step.png)

   Конструктор логику приложения Hello добавляет tooyour рабочего процесса пустой условие, включая действие toofollow пути, принимая во внимание вид hello условие равно true или false.

   ![Пустое условие](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-add-empty-condition.png)

2. В hello **условие** выберите **изменение в расширенном режиме**.
Введите следующее выражение:

   `@equals(triggerBody()?['data']['operationName'], 'Microsoft.Compute/virtualMachines/write')`

   Теперь условие выглядит как в следующем примере:

   ![Пустое условие](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-condition-expression.png)

   Это выражение проверяет hello событий `body` для `data` объекта там, где hello `operationName` свойство — hello `Microsoft.Compute/virtualMachines/write` операции. 
   Узнайте больше о [схеме событий службы "Сетка событий"](../event-grid/event-schema.md).

3. tooprovide Описание условия hello выберите hello **многоточие** (**...** ) на фигуре hello условие, а затем выберите **переименование**.

   > [!NOTE] 
   > Hello последующих примеров в этом учебнике также приводится описание действия в рабочем процессе приложения логики hello.

4. Теперь выберите **изменения в базовом режиме** , чтобы автоматически разрешает hello выражения, как показано:

   ![Условие приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-condition-1.png)

5. Сохраните приложение логики.

## <a name="send-email-when-your-virtual-machine-changes"></a>Отправка электронного сообщения при изменении виртуальной машины

Теперь добавьте [ *действия* ](../logic-apps/logic-apps-what-are-logic-apps.md#logic-app-concepts) , чтобы получить сообщение электронной почты, когда hello указанное условие истинно.

1. В условии hello **при значении true** выберите **добавить действие**.

   ![Добавление действия для условия со значением true](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-condition-2.png)

2. В поле поиска hello введите «email» фильтра. На основании вашего поставщика услуг электронной почты, найдите и выберите соответствующий соединитель hello. Выберите действие «отправить по электронной почте» hello, для соединителя. Например: 

   * Azure работать или рабочей учетной записи, выберите hello соединителя Office 365 Outlook. 
   * Для личных учетных записей Майкрософт выберите нужный вариант hello Outlook.com. 
   * Для учетных записей Gmail выберите соединитель Gmail hello. 

   Мы будем toocontinue с соединителем hello Office 365 Outlook. 
   Если вы используете другого поставщика, hello hello действия остаются одинаковыми, но пользовательского интерфейса может отличаться. 

   ![Выбор действия "отправить сообщение"](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-send-email.png)

3. Если нет подключения для вашего поставщика услуг электронной почты, войдите в учетную запись электронной почты tooyour в ответ на запрос проверки подлинности.

4. Содержатся сведения о hello электронной почты, как указано в следующей таблице hello:

   ![Пустое действие электронной почты](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-empty-email-action.png)

   > [!TIP]
   > tooselect из полей, доступных в рабочем процессе, щелкните в поле ввода таким образом, hello **динамическое содержимое** откроется список, или выберите **добавления динамического содержимого**. Дополнительные поля, выберите **увеличить** для каждого раздела в списке hello. tooclose hello **динамическое содержимое** выберите **добавления динамического содержимого**.

   | Настройка | Рекомендуемое значение | Описание | 
   | ------- | --------------- | ----------- | 
   | **To** | *{электронный_адрес_получателя}* |Введите адрес электронной почты получателя hello. Для тестировании можете использовать свой собственный адрес. | 
   | **Тема** | Обновленный ресурс: **Тема**| Введите тему электронного сообщения hello hello содержимого. В этом учебнике введите hello предлагаемый текст и выберите hello событий **субъекта** поля. Здесь вашей электронной почты субъекта включает имя hello hello обновить ресурс (виртуальная машина). | 
   | **Текст** | Группа ресурсов: **Раздел** <p>Тип события: **Тип события**<p>Идентификатор события: **Идентификатор**<p>Время: **Время события** | Введите текст сообщения hello hello содержимого. В этом учебнике введите hello предлагаемый текст и выберите hello событий **раздела**, **тип события**, **идентификатор**, и **время события** поля, чтобы ваш адрес электронной почты содержит имя группы ресурсов hello, тип события, отметки времени для события и идентификатор события для обновления hello. <p>tooadd пустые строки в содержимом, нажмите клавиши Shift + Ввод. | 
   | | | 

   > [!NOTE] 
   > Если выбрать поле, которое представляет массив, hello конструктор автоматически добавляет **для каждого** цикла вокруг hello действие, которое ссылается на массив hello. Таким образом приложение логики будет выполнять это действие для каждого элемента массива.

   Теперь действие отправки электронного сообщения может выглядеть следующим образом.

   ![Выберите tooinclude выходные данные в сообщении электронной почты](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-send-email-details.png)

   Готовое приложение логики может выглядеть следующим образом:

   ![Готовое приложение логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-completed.png)

5. Сохраните приложение логики. toocollapse» и «скрыть подробности каждого действия в приложении логики, щелкните заголовок действия hello.

   ![Сохранение приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-event-grid-save-completed.png)

   Логика приложения теперь является динамической, но ожидает изменений tooyour виртуальной машины, прежде чем начать. 
   tootest логику приложения, продолжена toohello следующего раздела.

## <a name="test-your-logic-app-workflow"></a>Проверка рабочего процесса приложения логики

1. toocheck, логика приложения получает hello указанные события, обновите виртуальную машину. 

   Например, можно изменить размер виртуальной машины в hello портал Azure или [изменить размер виртуальной Машины с помощью Azure PowerShell](../virtual-machines/windows/resize-vm.md). 

   Через несколько секунд вы должны получить электронное сообщение. Например:

   ![Электронное сообщение об обновлении виртуальной машины](./media/monitor-virtual-machine-changes-event-grid-logic-app/email.png)

2. выполняется tooreview hello и истории триггер для логики приложения, в меню приложения логики, выберите **Обзор**. tooview Дополнительные сведения о сеансе, выберите строку hello данного запуска.

   ![Журнал выполнения приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-run-history.png)

3. tooview hello входные и выходные данные для каждого шага, разверните нужных tooreview шаг hello. Эти сведения помогут вам диагностировать и устранить проблемы в приложении логики.
 
   ![Информация журнала выполнения приложения логики](./media/monitor-virtual-machine-changes-event-grid-logic-app/logic-app-run-history-details.png)

Поздравляем! Вы создали и запустили приложение логики, которое отслеживает события ресурса с помощью службы "Сетка событий" и отправляет вам электронные сообщения при возникновении этих событий. Вы также узнали, как можно легко создать рабочие процессы, позволяющие автоматизировать и интегрировать системы и облачные службы.

## <a name="clean-up-resources"></a>Очистка ресурсов

В этом руководстве используются ресурсы и выполняются действия, подлежащие оплате по подписке Azure. Поэтому после завершения учебника hello и проверку, убедитесь, отключить или удалить ресурсы, где вы не хотите tooincur расходов.

Вы можете остановить приложение логики, запускать и отправке сообщения электронной почты, не удаляя приложение hello. В меню приложения логики щелкните **Обзор**. На панели инструментов hello, выберите **отключить**.

![Отключение приложения логики.](./media/monitor-virtual-machine-changes-event-grid-logic-app/turn-off-disable-logic-app.png)

## <a name="faq"></a>Часто задаваемые вопросы

**Вопрос**. Какие другие задачи мониторинга виртуальных машин можно выполнять с помощью службы "Сетка событий" и приложений логики? </br>
**Ответ**. Можно отслеживать другие изменения в конфигурации, например:

* виртуальная машина получает права доступа RBAC (управление доступом на основе ролей);
* Tooa сетевой группы безопасности (NSG) для сетевого интерфейса (NIC) были внесены изменения.
* добавляются или удаляются диски виртуальной машины;
* Общедоступный IP-адрес назначается tooa виртуальной машины сетевого адаптера.

## <a name="next-steps"></a>Дальнейшие действия

* [Обзор службы Сетка событий Azure](../event-grid/overview.md)
* [Основные понятия службы "Сетка событий Azure"](../event-grid/concepts.md)
* [Создание и перенаправление пользовательского события со службой "Сетка событий Azure"](../event-grid/custom-event-quickstart.md)
* [Схема событий службы "Сетка событий Azure"](../event-grid/event-schema.md)
* [Azure Logic Apps](../logic-apps/logic-apps-what-are-logic-apps.md)
* [Настройка рабочего процесса с помощью встроенного шаблона или схемы для быстрого начала работы](../logic-apps/logic-apps-use-logic-app-templates.md)