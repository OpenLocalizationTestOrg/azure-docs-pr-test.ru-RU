---
title: "Как использовать соединитель MQ в Azure Logic Apps | Документация Майкрософт"
description: "Узнайте, как подключиться к локальному серверу или серверу Azure MQ из рабочего процесса приложения логики для просмотра, получения и отправки сообщений в WebSphere MQ."
services: logic-apps
author: valthom
manager: anneta
documentationcenter: 
editor: 
tags: connectors
ms.assetid: 
ms.service: logic-apps
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.date: 06/01/2017
ms.author: valthom; ladocs
ms.openlocfilehash: 9fb0258df3f45d121cda49d3b5c274bd9548c832
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="connect-to-an-ibm-mq-server-from-logic-apps-using-the-mq-connector"></a>Подключение к серверу IBM MQ из приложения логики с помощью соединителя MQ 

Соединитель с MQ (Microsoft) отправляет и получает сообщения, хранящиеся локально на сервере MQ или в Azure. Этот соединитель включает в себя клиент Microsoft MQ для взаимодействия с удаленным сервером IBM MQ по сети TCP/IP. Этот документ является базовым руководством для использования соединителя MQ. Мы рекомендуем начать с просмотра одного сообщения в очереди, и затем попробовать другие действия.    

Соединитель MQ позволяет выполнять перечисленные ниже действия. Триггеры отсутствуют.

-   Просматривать отдельные сообщения, не удаляя их с сервера IBM MQ.
-   Просматривать пакет сообщений, не удаляя сообщения с сервера IBM MQ.
-   Получать отдельные сообщения с сервера IBM MQ и удалять их с сервера.
-   Получать пакет сообщений с сервера IBM MQ и удалять сообщения с сервера.
-   Отправлять отдельные сообщения на сервер IBM MQ. 

## <a name="prerequisites"></a>Предварительные требования

* Если используется локальный сервер MQ, то [установите локальный шлюз данных](../logic-apps/logic-apps-gateway-install.md) на сервере в пределах сети. Если сервер MQ является общедоступным или доступным в пределах Azure, то установка шлюза данных не требуется, так как он не используется.

    > [!NOTE]
    > Чтобы функционировал соединитель MQ, на сервере, где установлен локальный шлюз данных, также должна быть установлена платформа .NET Framework 4.6.

* Создайте ресурс Azure для локального шлюза данных (см. статью [Доступ к локальным источникам данных из приложений логики с помощью локального шлюза данных](../logic-apps/logic-apps-gateway-connection.md)).

* Официально поддерживаемые версии IBM WebSphere MQ:
   * MQ 7.5
   * MQ 8.0

## <a name="create-a-logic-app"></a>Создайте приложение логики

1. На **начальной доске Azure** выберите **+** (знак плюс), **Интернет+мобильные устройства**, а затем — **Приложение логики**. 
2. Укажите **имя**, например MQTestApp, **подписку**, **группу ресурсов**, и **расположение** (используйте расположение, в котором настроено подключение к локальному шлюзу данных). Установите флажок **Закрепить на панели мониторинга** и нажмите кнопку **Создать**.  
![Создание приложения логики](media/connectors-create-api-mq/Create_Logic_App.png)

## <a name="add-a-trigger"></a>Добавление триггера

> [!NOTE]
> Соединитель MQ не содержит триггеров. Поэтому для запуска приложения логики используйте другой триггер, например **Повторение**. 

1. Откройте **конструктор Logic Apps** и в списке часто используемых триггеров выберите **Повторение**.
2. В триггере "Повторение" нажмите кнопку **Изменить**. 
3. В поле **Частота** выберите **День**, а в поле **Интервал** введите **7**. 

## <a name="browse-a-single-message"></a>Просмотр одного сообщения
1. Выберите **+ Новый шаг**, а затем — **Добавить действие**.
2. В поле поиска введите `mq`, а затем выберите **MQ - Browse message** (MQ — просмотр сообщения).  
![Просмотр сообщения](media/connectors-create-api-mq/Browse_message.png)

3. Если отсутствует подключение к MQ, то создайте его:  

    1. Выберите **Connect via on-premises data gateway** (Подключение через локальный шлюз данных) и введите свойства сервера MQ.  
    В поле **Сервер** укажите имя сервера MQ или введите IP-адрес, после него поставьте двоеточие, а затем укажите номер порта. 
    2. В раскрывающемся списке **Шлюз** перечислены все существующие подключения шлюза, которые были настроены. Выберите шлюз.
    3. По завершении нажмите кнопку **Создать**. Подключение выглядит примерно так:   
    ![Свойства подключения](media/connectors-create-api-mq/Connection_Properties.png)

4. В свойствах действия предоставляются следующие возможности:  

    * Используйте свойство **Очередь**, чтобы выбрать имя очереди, отличное от того, которое определено в подключении.
    * Используйте свойства **MessageId**, **CorrelationId**, **GroupId** и другие, чтобы найти сообщение на основе различных свойств сообщений MQ.
    * Задайте для свойства **IncludeInfo** значение **True**, чтобы включить в выходные данные дополнительные сведения о сообщении. Либо задайте значение **False**, чтобы не включать в выходные данные эти сведения.
    * Введите значение **времени ожидания**, чтобы определить, как долго ожидать получения сообщения в пустой очереди. Если это значение не задано, то извлекается первое сообщение в очереди, и, следовательно, время на ожидание сообщения не тратится.  
    ![Просмотр сообщения: свойства](media/connectors-create-api-mq/Browse_message_Props.png)

5. **Сохраните** изменения, а затем щелкните **Выполнить**, чтобы запустить приложение логики:  
![Сохранение и запуск](media/connectors-create-api-mq/Save_Run.png)

6. Через несколько секунд отображаются шаги выполнения, и можно посмотреть выходные данные. Щелкните зеленый флажок, чтобы просмотреть подобные сведения о каждом шаге. Выберите **Посмотреть необработанные выходные данные**, чтобы просмотреть дополнительные сведения о выходных данных.  
![Просмотр сообщения: выходные данные](media/connectors-create-api-mq/Browse_message_output.png)  

    Необработанные выходные данные:  
    ![Просмотр сообщения: необработанные выходные данные](media/connectors-create-api-mq/Browse_message_raw_output.png)

7. Если для свойства **IncludeInfo** задано значение true, то отобразятся следующие выходные данные:  
![Просмотр сообщения: IncludeInfo](media/connectors-create-api-mq/Browse_message_Include_Info.png)

## <a name="browse-multiple-messages"></a>Просмотр нескольких сообщений
Действие **Browse messages** (Просмотреть сообщения) имеет свойство **BatchSize** (Размер пакета). Оно указывает, сколько сообщений должно быть возвращено из очереди.  Если для свойства **BatchSize** значение не задано, то возвращаются все сообщения. Возвращаемые выходные данные представляют собой массив сообщений.

1. При добавлении действия **Browse messages** (Просмотреть сообщения) по умолчанию выбирается подключение, которое было настроено первым. Щелкните **Изменить подключение**, чтобы создать подключение или выбрать другое существующее подключение.

2. Выходные данные действия "Browse messages" (Просмотреть сообщения) имеют такой вид:  
![Просмотр сообщений: выходные данные](media/connectors-create-api-mq/Browse_messages_output.png)

## <a name="receive-a-single-message"></a>Получение одного сообщения
Действие **Получить сообщение** имеет такие входные и выходные данные, что и действие **Browse message** (Просмотреть сообщение). При использовании действия **Получить сообщение** это сообщение удаляется из очереди.

## <a name="receive-multiple-messages"></a>Получение нескольких сообщений
Действие **Получить сообщения** имеет такие входные и выходные данные, что и действие **Browse messages** (Просмотреть сообщения). При использовании действия **Получить сообщения** эти сообщения удаляются из очереди.

Если при выполнении действия просмотра или получения в очереди не будет сообщений, то действие завершится сбоем и отобразятся следующие выходные данные:  
![Ошибка MQ при отсутствии сообщений](media/connectors-create-api-mq/MQ_No_Msg_Error.png)

## <a name="send-a-message"></a>Отправка сообщения
1. При добавлении действия **Отправить сообщение** по умолчанию выбирается подключение, которое было настроено первым. Щелкните **Изменить подключение**, чтобы создать подключение или выбрать другое существующее подключение. Допустимые **типы сообщений**: **датаграмма**, **ответ** и **запрос**.  
![Свойства отправки сообщения](media/connectors-create-api-mq/Send_Msg_Props.png)

2. Выходные данные действия "Отправить сообщение" выглядят следующим образом:  
![Отправить сообщение: выходные данные](media/connectors-create-api-mq/Send_Msg_Output.png)

## <a name="connector-specific-details"></a>Сведения о соединителях

Информацию о существующих ограничениях, а также о триггерах и действиях, определенных в Swagger, см. в статье со [сведениями о соединителях](/connectors/mq/).

## <a name="next-steps"></a>Дальнейшие действия
[Создание приложения логики](../logic-apps/logic-apps-create-a-logic-app.md). Чтобы узнать, какие еще соединители доступны в Logic Apps, просмотрите [список интерфейсов API](apis-list.md).
