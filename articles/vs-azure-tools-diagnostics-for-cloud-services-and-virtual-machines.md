---
title: "aaaConfiguring диагностики для виртуальных машин и облачных служб Azure | Документы Microsoft"
description: "Описывает способ tooconfigure диагностической информации для отладки Azure облачной службы и виртуальные машины (ВМ) в Visual Studio."
services: visual-studio-online
documentationcenter: na
author: kraigb
manager: ghogen
editor: 
ms.assetid: e70cd7b4-6298-43aa-adea-6fd618414c26
ms.service: multiple
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: multiple
ms.date: 11/11/2016
ms.author: kraigb
ms.openlocfilehash: 74cdf49413d6d89a84195070dd9d817da2463373
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="configuring-diagnostics-for-azure-cloud-services-and-virtual-machines"></a>Настройка системы диагностики для облачных служб и виртуальных машин Azure
Если вам требуется tootroubleshoot Azure облачной службы или виртуальной машины Azure, можно настроить диагностики Azure проще с помощью Visual Studio. Диагностика Azure собирает системные данные и данные журналов hello виртуальных машин и экземпляров виртуальных машин, на которых работает облачная служба и передает эти данные в учетной записи хранения по своему усмотрению. В статье [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](app-service-web/web-sites-enable-diagnostic-log.md) собрана подробная информация о ведении журнала диагностики в Azure.

В этом разделе показано, как tooenable и настройки системы диагностики Azure в Visual Studio, до или после развертывания, а также на виртуальных машинах Azure. Здесь также показано, как типы hello tooselect toocollect сведения диагностики и сборе информации hello tooview после него.

Диагностика Azure можно настроить в hello следующих способов:

* Можно изменить параметры конфигурации диагностики через hello **конфигурация диагностики** диалоговое окно в Visual Studio. Hello параметры сохраняются в файле с именем diagnostics.wadcfgx (diagnostics.wadcfg в пакете Azure SDK 2.4 или более ранней версии). Кроме того можно непосредственно изменить файл конфигурации hello. Если необходимо вручную обновить файл hello, hello изменения конфигурации вступят hello эффект развертывании hello облачной службы tooAzure или служба выполнения hello в эмуляторе hello.
* Используйте **Cloud Explorer** или **обозревателя серверов** в параметрах Visual Studio toochange hello диагностики для работающей облачной службы или виртуальной машины.

## <a name="azure-26-diagnostics-changes"></a>Изменения в системе диагностики Azure версии 2.6
Для проектов Azure SDK 2.6 в Visual Studio были внесены следующие отличия hello. (Эти изменения также применяются toolater версии пакета Azure SDK).

* Hello локальный эмулятор теперь поддерживает систему диагностики. Это означает, что можно собирать данные диагностики и убедитесь, что приложение создает hello правильные трассировки во время разработки и тестирования в Visual Studio. Здравствуйте, строка подключения `UseDevelopmentStorage=true` включает сбор данных диагностики при запуске проекта облачной службы в Visual Studio с помощью эмулятора хранилища Azure hello. Все диагностические данные собираются в учетной записи хранения hello (хранилище разработки).
* Строка подключения учетной записи хранения диагностики Hello (Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString) еще раз сохраняется в файле конфигурации (cscfg) службы hello. Пакет SDK Azure 2.5 учетная запись хранения диагностики hello был указан в файле diagnostics.wadcfgx hello.

Существуют некоторые важные различия между как строка подключения hello работает в Azure SDK 2.4 и более ранних версий и как он работает в Azure SDK 2.6 и более поздних версий.

* В пакете Azure SDK 2.4 и более ранних версиях строка подключения hello используемый как среда выполнения hello tooget подключаемого модуля диагностики hello данных учетной записи хранения для передачи журналов диагностики.
* В пакете Azure SDK 2.6 и более поздних версиях строка подключения диагностики hello используется модулем Visual Studio tooconfigure hello диагностики hello сведения о соответствующих дисковых учетной записи во время публикации. Строка подключения Hello позволяет определить разных учетных записей хранения для различных конфигураций службы, Visual Studio будет использоваться при публикации. Тем не менее поскольку hello подключаемый модуль диагностики больше не доступен (после Azure SDK 2.5), cscfg-файле hello сам по себе не удается включить hello расширения диагностики. У вас tooenable hello расширение отдельно с помощью средств, таких как Visual Studio или PowerShell.
* toosimplify hello процесс настройки расширения системы диагностики hello с помощью PowerShell, hello выходные данные пакета Visual Studio также содержит hello открытый XML-ФАЙЛ конфигурации для модуля диагностики hello для каждой роли. Visual Studio использует hello диагностики данные строки подключения toopopulate hello хранилища учетной записи в открытой конфигурации hello. файлы общедоступной конфигурации Hello создаются в папке расширений hello и следовать шаблону hello PaaSDiagnostics. &lt;RoleName >. PubConfig.xml. Любые развертывания на основе PowerShell можно использовать этот шаблон toomap tooa каждой конфигурации роли.
* Hello строку подключения в cscfg-файле hello также используется hello [портал Azure](http://go.microsoft.com/fwlink/p/?LinkID=525040) tooaccess hello данные диагностики, поэтому она может отображаться в hello **мониторинг** требуется строка подключения hello вкладки. tooshow службы hello tooconfigure подробного мониторинга данных в портале hello.

## <a name="migrating-projects-tooazure-sdk-26-and-later"></a>Перенос проектов tooAzure SDK версии 2.6 и более поздних версий
При миграции из пакета Azure SDK 2.5 tooAzure SDK 2.6 или более поздней версии, если у вас есть учетная запись хранения диагностики, указанной в wadcfgx-файле hello, затем она останется там. преимущества tootake hello гибкость использования различных хранилища учетных записей для различных конфигураций хранилища, необходимо добавить проект tooyour строка подключения hello toomanually. При миграции проекта из пакета Azure SDK 2.4 или более ранних tooAzure SDK 2.6, затем hello диагностики сохраняются строки подключения. Тем не менее Обратите внимание, как строки подключения обрабатываются в пакете Azure SDK 2.6, указанное в предыдущем разделе hello изменения hello.

### <a name="how-visual-studio-determines-hello-diagnostics-storage-account"></a>Определение учетной записи хранения диагностики hello в Visual Studio
* Если строка подключения диагностики указана в cscfg-файле hello, Visual Studio использует его расширение диагностики hello tooconfigure при публикации, а также при создании XML-файлов общедоступной конфигурации hello во время упаковки.
* Если строка подключения диагностики указана в cscfg-файле hello, затем Visual Studio возвращается toousing hello указанную учетную запись хранения в hello .wadcfgx tooconfigure hello диагностики расширение файла при публикации и создания открытого hello XML-файлов конфигурации при упаковке.
* Строка подключения диагностики Hello в cscfg-файле hello имеет приоритет над hello учетной записи хранения в wadcfgx-файле hello. Если строка подключения диагностики указано в cscfg-файле hello, затем Visual Studio использует эти данные и игнорирует hello учетной записи хранения в wadcfgx-файле.

### <a name="what-does-hello-update-development-storage-connection-strings-checkbox-do"></a>Что does Здравствуйте, «Обновить строки подключения хранилища разработки...» "Обновлять строки подключения хранилища разработки..."?
Здравствуйте, флажок для **обновить строки подключения хранилища разработки для диагностики и кэширования учетные данные учетной записи хранения Microsoft Azure при публикации tooMicrosoft Azure** предоставляет удобный способ tooupdate любое Учетная запись строки подключения хранилища разработки с помощью учетной записи хранилища Azure hello, указанной во время публикации.

Например, предположим, этот флажок установлен, и строка подключения диагностики hello указывает `UseDevelopmentStorage=true`. При публикации проекта tooAzure hello, Visual Studio автоматически обновит строки подключения диагностики hello hello учетную запись хранилища, заданных в мастере публикации hello. Тем не менее если как строка подключения диагностики hello была указана реальная учетная запись хранения, то этой учетной записи будет использоваться вместо этого.

## <a name="diagnostics-functionality-differences-between-azure-sdk-24-and-earlier-and-azure-sdk-25-and-later"></a>Функциональные различия диагностики в Azure SDK между более ранними (до 2.4 включительно) и более поздними (с 2.5 включительно) версиями
Если вы осуществили обновление проекта Azure SDK 2.4 tooAzure SDK 2.5 или более поздней версии, следует иметь в виду hello после диагностики функциональные различия.

* **API конфигурации больше не используются.** Программная конфигурация диагностики доступна в пакете SDK для Azure 2.4 и более ранних версий, но в дальнейших выпусках, начиная с версии SDK для Azure 2.5, она не используется. Если конфигурация системы диагностики определена в коде, вам потребуется tooreconfigure эти параметры с нуля в hello перенесенном проекте для работы tookeep диагностики. файл конфигурации диагностики Hello для Azure SDK 2.4 — diagnostics.wadcfg, а diagnostics.wadcfgx Azure SDK 2.5 и более поздних версий.
* **Диагностика для приложений облачных служб можно задавать только на уровне роли hello, а не на уровне экземпляра hello.**
* **Каждый раз при развертывании приложения hello конфигурация системы диагностики обновляется** — это может вызвать проблемы с контролем четности, если изменить конфигурацию диагностики из обозревателя серверов и затем повторно развернуть приложение.
* **В пакете Azure SDK 2.5 и более поздних версиях аварийные дампы настраиваются в файле конфигурации диагностики hello не в коде** — Если аварийные дампы настроены в коде, потребуется toomanually передачи hello конфигурации из файла конфигурации toohello кода Поскольку hello аварийные дампы не перемещаются во время миграции hello tooAzure SDK 2.6.

## <a name="enable-diagnostics-in-cloud-service-projects-before-deploying-them"></a>Включение диагностики в проекте облачной службы перед его развертыванием
В Visual Studio можно выбрать toocollect данные диагностики для ролей, выполняющихся в Azure, при запуске службы hello в эмуляторе hello перед его развертыванием. Все параметры toodiagnostics изменения в Visual Studio сохраняются в файле конфигурации diagnostics.wadcfgx hello. Эти параметры конфигурации указывают учетную запись хранения hello, где сохраняются данные диагностики при развертывании облачной службы.

[!INCLUDE [cloud-services-wad-warning](../includes/cloud-services-wad-warning.md)]

### <a name="tooenable-diagnostics-in-visual-studio-before-deployment"></a>tooenable диагностики в Visual Studio перед развертыванием
1. Hello контекстного меню для интересующей вас роли hello, выберите **свойства**, а затем выберите hello **конфигурации** hello роли на вкладке **свойства** окна.
2. В hello **диагностики** статьи, убедитесь, что hello **включить диагностику** установлен флажок.
   
    ![Доступ к параметр Включить диагностику hello](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796660.png)
3. Выберите hello кнопку с многоточием (...) кнопку toospecify hello учетную запись хранения место hello диагностики данных toobe хранятся. учетной записи хранилища Hello выбранного будет hello расположение, где хранятся данные диагностики.
   
    ![Укажите toouse учетной записи хранилища hello](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796661.png)
4. В hello **Создание строки подключения хранилища** диалоговом окне укажите ли вы, чтобы tooconnect с помощью hello эмулятор хранилища Azure, подписка Azure или ручной ввод учетных данных.
   
    ![Диалоговое окно учетной записи хранения](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796662.png)
   
   * При выборе параметра эмулятор хранилища Microsoft Azure hello hello строка подключения имеет значение tooUseDevelopmentStorage = true.
   * Для варианта hello вашей подписки, вы можете hello подписки Azure, имя учетной записи toouse и hello. Можно выбрать, что управление учетными записями hello кнопку toomanage подписками Azure.
   * Если выбран вариант hello ручной ввод учетных данных, вы запрашиваемые tooenter hello имени и ключа учетной записи Azure, требуется toouse hello.
5. Выберите hello **Настройка** hello tooview кнопку **конфигурация диагностики** диалоговое окно. Каждая вкладка (кроме вкладок **Общие** и **Каталоги журналов**) соответствует определенному источнику диагностических данных, которые можно собирать. Вкладка по умолчанию Hello, **Общие**, предлагает hello следующие варианты сбора данных диагностики: **только ошибки**, **все сведения о**, и **пользовательский план** . Здравствуйте, параметр по умолчанию **только ошибки**, принимает hello наименьший объем хранилища, так как он не перемещает предупреждения и сообщения трассировки. Hello передач параметр сведения hello большая часть информации и, таким образом, hello самый дорогостоящий вариант с точки зрения хранилища.
   
    ![Включение и настройка диагностики Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758144.png)
6. Для этого примера выберите hello **пользовательский план** параметр для настройки данных hello.
7. Hello **Квота диска в МБ** определяет, сколько места требуется tooallocate в учетной записи хранилища для диагностических данных. Если требуется, можно изменить значение по умолчанию hello.
8. На каждой вкладке данных диагностики будет toocollect, выберите его **включить перемещение <log type>**  флажок. Например, если требуется, чтобы журналы приложения toocollect, выберите hello **включить перемещение журналов приложений** флажок на hello **журналы приложений** вкладки. Установите также все остальные параметры, необходимые для каждого типа диагностических данных. В разделе hello **настройки источников данных диагностики** далее в этом разделе сведения о конфигурации на каждой вкладке.
9. После включения сбора диагностических данных всех hello, необходимо выбрать hello **ОК** кнопки.
10. Теперь запустите проект облачной службы Azure в Visual Studio обычным образом. При использовании приложения hello данные журнала, которые вы включили сохраняется toohello учетной записи хранилища Azure, указываемой.

## <a name="enable-diagnostics-in-azure-virtual-machines"></a>Включение диагностики на виртуальных машинах Azure
В Visual Studio можно выбрать toocollect данные диагностики для виртуальных машин Azure.

### <a name="tooenable-diagnostics-in-azure-virtual-machines"></a>tooenable диагностики в виртуальных машинах Azure
1. В **обозревателя серверов**, выберите hello узла Azure, а затем подключите tooyour подписки Azure, если вы еще не подключены.
2. Разверните hello **виртуальные машины** узла. Вы можете создать новую виртуальную машину или выбрать уже существующую.
3. Hello контекстное меню для виртуальной машины hello интересующей вас выберите **Настройка**. Откроется диалоговое окно конфигурации виртуальной машины hello.
   
    ![Настройка виртуальной машины Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796663.png)
4. Если она еще не установлена, добавьте расширение диагностики Microsoft Monitoring Agent hello. Это расширение позволяет собирать данные диагностики для hello виртуальной машины Azure. В списке установленные расширения hello выберите меню выберите раскрывающийся список доступных расширений hello и выберите Диагностика Microsoft Monitoring Agent.
   
    ![Установка расширения виртуальной машины Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766024.png)
   
   > [!NOTE]
   > Для виртуальных машин существуют и другие диагностические расширения. Дополнительные сведения см. в статье «Расширения и компоненты виртуальных машин Azure».
   > 
   > 
5. Выберите hello **добавить** tooadd расширения hello и представление, нажмите кнопку его **конфигурация диагностики** диалоговое окно.
6. Выберите hello **Настройка** кнопку toospecify учетной записи хранилища, а затем выберите hello **ОК** кнопки.
   
    Каждая вкладка (кроме вкладок **Общие** и **Каталоги журналов**) соответствует определенному источнику диагностических данных, которые можно собирать.
   
    ![Включение и настройка диагностики Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758144.png)
   
    Вкладка по умолчанию Hello, **Общие**, предлагает hello следующие варианты сбора данных диагностики: **только ошибки**, **все сведения о**, и **пользовательский план** . Здравствуйте, параметр по умолчанию **только ошибки**, принимает hello наименьший объем хранилища, так как он не перемещает предупреждения и сообщения трассировки. Hello **все сведения о** передает параметр hello большая часть информации и, таким образом, hello вариант является наиболее затратным с точки зрения хранилища.
7. Для этого примера выберите hello **пользовательский план** параметр для настройки данных hello.
8. Hello **Квота диска в МБ** определяет, сколько места требуется tooallocate в учетной записи хранилища для диагностических данных. Если требуется, можно изменить значение по умолчанию hello.
9. На каждой вкладке данных диагностики будет toocollect, выберите его **включить перемещение <log type>**  флажок.
   
    Например, если требуется, чтобы журналы приложения toocollect, выберите hello **включить перемещение журналов приложений** флажок на hello **журналы приложений** вкладки. Установите также все остальные параметры, необходимые для каждого типа диагностических данных. В разделе hello **настройки источников данных диагностики** далее в этом разделе сведения о конфигурации на каждой вкладке.
10. После включения сбора диагностических данных всех hello, необходимо выбрать hello **ОК** кнопки.
11. Сохраните проект обновлен hello.
    
     Вы увидите сообщение hello **журнал действий Microsoft Azure** окно, в котором hello виртуальной машины была обновлена.

## <a name="configure-diagnostics-data-sources"></a>Настройка источников диагностических данных
После включения сбора данных диагностики можно уточнить источники данных требуется toocollect и какие сведения собираются. Hello ниже приведен список вкладок hello **конфигурация диагностики** диалоговое окно и означает, что каждый параметр конфигурации.

### <a name="application-logs"></a>Журналы приложений
**Application logs** содержатся диагностические данные, созданные веб-приложениями. Журналы приложений toocapture, установите hello **включить перемещение журналов приложений** флажок. Можно увеличить или уменьшить hello количество минут при передаче журналов приложений hello tooyour учетной записи хранения, изменив hello **период передачи (мин)** значение. Можно также изменить hello объем информации, записываемой в журнал hello, задав значение уровня журнала hello. Например, вы можете **Verbose** tooget Дополнительные сведения или выберите **критическое** toocapture только критические ошибки. При наличии специальный поставщик диагностики, журналы приложений выдает их можно записать, добавив toohello GUID поставщика hello **GUID поставщика** поле.

  ![Журналы приложений](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758145.png)

  Дополнительную информацию о диагностических журналах см. в статье [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](app-service-web/web-sites-enable-diagnostic-log.md).

### <a name="windows-event-logs"></a>Журналы событий Windows
Toocapture журналы событий Windows, установите hello **включить передачу журналов событий Windows** флажок. Можно увеличить или уменьшить hello количество минут при передаче журналов событий hello tooyour учетной записи хранения, изменив hello **период передачи (мин)** значение. Установите флажки hello для hello типов событий, которые должны tootrack.

  ![журналы событий;](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796664.png)

Если вы используете Azure SDK 2.6 или более поздней версии и toospecify пользовательский источник данных, введите его в hello  **<Data source name>**  текст и затем выберите hello **добавить** Далее tooit кнопки. источник данных Hello добавляется файл diagnostics.cfcfg toohello.

Если вы используете Azure SDK 2.5 и toospecify пользовательский источник данных, его можно добавить toohello `WindowsEventLog` hello diagnostics.wadcfgx файла, как следующий пример hello.

```
<WindowsEventLog scheduledTransferPeriod="PT1M">
   <DataSource name="Application!*" />
   <DataSource name="CustomDataSource!*" />
</WindowsEventLog>
```
### <a name="performance-counters"></a>Счетчики производительности
Сведения о счетчиках производительности помогут вам найти проблемы в системе и оптимизировать производительность системы и приложений. Дополнительные сведения см. в статье [Создание и использование счетчиков производительности в приложении Azure](https://msdn.microsoft.com/library/azure/hh411542.aspx). Счетчики производительности toocapture, установите hello **включить передачу счетчиков производительности** флажок. Можно увеличить или уменьшить hello количество минут при передаче журналов событий hello tooyour учетной записи хранения, изменив hello **период передачи (мин)** значение. Флажки hello для hello счетчики производительности, которые должны tootrack.

  ![Счетчики производительности](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758147.png)

tootrack счетчик производительности, который отсутствует в списке, введите его с помощью предложенного синтаксиса hello, а затем выберите hello **добавить** кнопки. Hello операционной системы на виртуальной машине hello определяет, какие счетчики производительности можно отслеживать. Дополнительные сведения о синтаксисе см. в статье [Specifying a Counter Path](https://msdn.microsoft.com/library/windows/desktop/aa373193.aspx) (Указание пути к счетчику).

### <a name="infrastructure-logs"></a>Журналы инфраструктуры
Журналы инфраструктуры toocapture, которые содержат сведения о hello инфраструктуры диагностики Azure, модуле RemoteAccess hello и hello модуль RemoteForwarder, установите hello **включить передачу журналов инфраструктуры**флажок. Можно увеличить или уменьшить количество минут при передаче журналов hello в hello tooyour учетной записи хранения, изменив значение hello период передачи (мин).

  ![Журналы инфраструктуры диагностики](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758148.png)

  Дополнительные сведения см. в статье [Сбор данных журнала с помощью системы диагностики Azure](https://msdn.microsoft.com/library/azure/gg433048.aspx).

### <a name="log-directories"></a>Каталоги журналов
Каталоги журналов toocapture, которые содержат данные, собранные из каталогов журналов для запросов служб Internet Information Services (IIS), неудачных запросов или выбранных папок, установите hello **включить передачу каталогов журналов**флажок. Можно увеличить или уменьшить количество минут при передаче журналов hello в hello tooyour учетной записи хранения, изменив hello **период передачи (мин)** значение.

Можно выбрать поля hello hello журнал можно toocollect, такие как **журналы IIS** и **не удалось запросить** журналы. Предоставляются имена контейнеров хранилища по умолчанию, но при необходимости можно изменить имена hello.

Кроме того, вы можете собирать журналы из любой папки. Просто укажите путь hello в hello **журнал из абсолютного каталога** статьи, а затем выберите hello **добавить каталог** кнопки. Hello журналы будут записаны toohello указан контейнеров.

  ![Каталоги журналов](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796665.png)

### <a name="etw-logs"></a>Журналы трассировки событий Windows
Если вы используете [трассировки событий Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803\(v=vs.85\).aspx) (ETW) и журналы трассировки событий Windows toocapture, выберите hello **включить передачу журналов трассировки событий Windows** флажок. Можно увеличить или уменьшить количество минут при передаче журналов hello в hello tooyour учетной записи хранения, изменив hello **период передачи (мин)** значение.

Hello события записываются из источников событий и манифестов событий, указанных вами. toospecify источник событий, введите имя в hello **источников событий** статьи, а затем выберите hello **добавить источник событий** кнопки. Аналогичным образом, можно указать манифест события в hello **манифестов событий** статьи, а затем выберите hello **добавить манифест события** кнопки.

  ![Журналы трассировки событий Windows](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766025.png)

  Hello ETW framework поддерживается в ASP.NET через классы в hello [System.Diagnostics.aspx] (пространство имен https://msdn.microsoft.com/library/system.diagnostics (v=vs.110). пространство имен Microsoft.WindowsAzure.Diagnostics Hello, который наследуется от и расширяет стандарт [System.Diagnostics.aspx] (классы https://msdn.microsoft.com/library/system.diagnostics (v=vs.110), включает использование hello () [System.Diagnostics.aspx] https://MSDN.Microsoft.com/library/System.Diagnostics (v=vs.110) как платформу ведения журналов в среде Azure hello. Дополнительные сведения см. в статьях [Управление ведением журналов и трассировкой в Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) и [Включение диагностики в облачных службах и виртуальных машинах Azure](cloud-services/cloud-services-dotnet-diagnostics.md).

### <a name="crash-dumps"></a>Аварийные дампы
Toocapture сведения о после сбоя экземпляра роли, установите hello **включить передачу аварийных дампов** флажок. Поскольку ASP.NET обрабатывает большинство исключений, обычно это полезно только для рабочих ролей. Можно увеличить или уменьшить процент hello хранилища пространства выделено toohello аварийных дампов, изменив hello **Квота каталога (%)** значение. Можно изменить контейнер хранилища hello, где хранятся аварийные дампы hello, и можно выбрать, следует ли использовать toocapture **полного** или **Mini** дампа.

Отслеживаемые процессы Hello перечислены. Установите hello флажки для нужных toocapture процессов hello. tooadd другого процесса toohello списка, введите имя процесса hello и нажмите кнопку hello **добавить процесс** кнопки.

  ![Аварийные дампы](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766026.png)

  Дополнительные сведения см. в статьях [Управление ведением журналов и трассировкой в Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) и [Microsoft Azure Diagnostics Part 4: Custom Logging Components and Azure Diagnostics 1.3 Changes](http://justazure.com/microsoft-azure-diagnostics-part-4-custom-logging-components-azure-diagnostics-1-3-changes/) (Система диагностики Microsoft Azure, часть 4. Настраиваемые компоненты ведения журналов и изменения в системе диагностики Azure 1.3).

## <a name="view-hello-diagnostics-data"></a>Просмотр данных диагностики hello
После того как собраны данные диагностики hello для облачной службы или виртуальной машины, можно просмотреть его.

### <a name="tooview-cloud-service-diagnostics-data"></a>tooview данных диагностики облачной службы
1. Разверните и запустите облачную службу обычным образом.
2. Hello диагностические данные можно просмотреть в отчет, создаваемый Visual Studio или таблиц в учетной записи. Откройте tooview hello данных в отчете, **Cloud Explorer** или **обозревателя серверов**, откройте контекстное меню hello hello узла интересующей вас роли hello и нажмите кнопку **Просмотр диагностических данных** .
   
    ![Просмотреть данные диагностики](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC748912.png)
   
    Отображается отчет, показывающий hello доступных данных.
   
    ![Отчет о системе диагностики Microsoft Azure в Visual Studio](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796666.png)
   
    Если hello самых последних данных не отображается, может потребоваться toowait для tooelapse периода передачи hello.
   
    Выберите hello **обновление** связь данных hello tooimmediately обновления, или выберите интервал в hello **автообновления** раскрывающегося списка поле toohave hello автоматического обновления данных. данные об ошибках tooexport hello, выберите hello **Экспорт tooCSV** toocreate кнопку CSV-файл, можно открыть в электронной таблице.
   
    В **Cloud Explorer** или **обозревателя серверов**, откройте hello учетной записи хранилища, связанной с развертыванием hello.
3. Откройте таблицы диагностики hello в окне просмотра таблицы hello, а затем просмотрите собранные данные hello. Для просмотра пользовательских журналов и журналов служб IIS вы можете открыть контейнер больших двоичных объектов. Просмотрев hello в следующей таблице, можно найти hello таблиц или BLOB-контейнер, содержащий данные hello интересующей вас. Кроме toohello данные для этого файла журнала, hello записи таблицы содержат EventTickCount, DeploymentId, Role и RoleInstance toohelp, необходимо указать, какая виртуальная машина и роль создаваемая hello данных и когда. 
   
   | Диагностические данные | Описание | Расположение |
   | --- | --- | --- |
   | Журналы приложений |Журналы, создаваемые в коде путем вызова методов класса System.Diagnostics.Trace hello. |WADLogsTable |
   | журналы событий; |Эти данные являются из журналов событий Windows hello на виртуальных машинах hello. В этих журналах хранит информацию ОС Windows, но приложения и службы также использовать их tooreport ошибки и сведений. |WADWindowsEventLogsTable |
   | Счетчики производительности |Можно собирать данные любого счетчика производительности, который доступен на виртуальной машине hello. Hello операционная система предоставляет счетчики производительности, предоставляющие всевозможные статистические данные, например памяти использования и время процессора. |WADPerformanceCountersTable |
   | Журналы инфраструктуры |Эти журналы формируются самой инфраструктурой диагностики hello. |WADDiagnosticInfrastructureLogsTable |
   | Журналы IIS |В эти журналы записываются веб-запросы. Если в облачную службу приходит очень много запросов, эти журналы могут быть довольно длинными, поэтому собирать и хранить их следует только при необходимости. |Можно найти журналы неудачных запросов в hello BLOB-контейнере wad-iis-failedreqlogs пути для этого развертывания, роли и экземпляра. Полные журналы вы найдете в папке wad-iis-logfiles. Было сделано записей для каждого файла в таблицу WADDirectories hello. |
   | Аварийные дампы |Эта информация содержит двоичные образы процесса облачной службы (обычно рабочей роли). |Контейнер больших двоичных объектов wad-crush-dumps |
   | Файлы пользовательских журналов |Настроенные вами журналы. |Можно указать в расположение кода hello пользовательские файлы журналов в учетной записи. например указать для них пользовательский контейнер больших двоичных объектов. |
4. При усечении данных любого типа можно попробовать возрастания hello буфера для этого типа данных или сокращение hello интервал между передачами данных из учетной записи хранения tooyour виртуальной машины hello.
5. (необязательно) Удаляйте данные из хранилища hello учетной записи иногда tooreduce общих затрат на хранение.
6. При выполнении полного развертывания файл hello diagnostics.cscfg (wadcfgx для пакета Azure SDK 2.5) обновляется в Azure, и облачная служба принимает все конфигурации диагностики tooyour изменения. Если вместо этого вы, обновление существующего развертывания, в Azure не обновляется hello cscfg-файле. Параметры диагностики по-прежнему можно изменить, выполнив указанные ниже действия hello в следующем разделе hello. Дополнительные сведения о полном развертывании и обновлении существующего развертывания см. в статье [Мастер публикации приложений Azure](vs-azure-tools-publish-azure-application-wizard.md).

### <a name="tooview-virtual-machine-diagnostics-data"></a>данные диагностики tooview виртуальной машины
1. Hello контекстное меню для hello виртуальной машины выберите **Просмотр данных диагностики**.
   
    ![Просмотр диагностических данных на виртуальной машине Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766027.png)
   
    При этом откроется hello **Сводка по диагностике** окна.
   
    ![Сводка по диагностическим данным виртуальной машины](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796667.png)  
   
    Если hello самых последних данных не отображается, может потребоваться toowait для tooelapse периода передачи hello.
   
    Выберите hello **обновление** связь данных hello tooimmediately обновления, или выберите интервал в hello **автообновления** раскрывающегося списка поле toohave hello автоматического обновления данных. данные об ошибках tooexport hello, выберите hello **Экспорт tooCSV** toocreate кнопку CSV-файл, можно открыть в электронной таблице.

## <a name="configure-cloud-service-diagnostics-after-deployment"></a>Настройка диагностики облачной службы после развертывания
Если выполняется анализ проблемы с облачной службой, уже выполняется, может потребоваться toocollect данные, которые не были указаны перед изначально развернутое приложение hello роли. В этом случае можно сначала toocollect эти данные с помощью параметров hello в обозревателе серверов. Можно настроить диагностику для одного экземпляра или все экземпляры hello в роли, нужно открыть диалоговое окно конфигурации диагностики hello hello контекстном меню для hello экземпляра или роли hello. При настройке узла роли Привет, вносимые изменения применяются tooall экземпляров. При настройке узла экземпляра Привет, вносимые изменения применяются только toothat экземпляр.

### <a name="tooconfigure-diagnostics-for-a-running-cloud-service"></a>tooconfigure диагностики для работающей облачной службы
1. В обозревателе серверов разверните hello **облачные службы** узел, а затем разверните узлы toolocate hello роли или экземпляра, что требуется tooinvestigate или оба.
   
    ![Настройка системы диагностики](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC748913.png)
2. Hello контекстного меню для узла экземпляра или роли, выберите **обновить параметры диагностики**и выберите параметры диагностики, которые должны toocollect hello.
   
    Сведения о параметрах конфигурации hello см. в разделе **настройки источников данных диагностики** в этом разделе. Сведения о как tooview hello диагностических данных см. в разделе **Просмотр данных диагностики hello** в этом разделе.
   
    Когда вы изменяете настройки сбора данных в **обозревателе сервера**, эти изменения остаются в силе до следующего полного развертывания облачной службы. При использовании параметров публикации по умолчанию hello hello изменения не перезаписываются, с момента публикации по умолчанию hello задается tooupdate hello существующего развертывания, вместо выполнения полного повторного развертывания. убедиться, что параметры hello toomake были сброшены во время развертывания, последовательно выберите toohello **Дополнительные параметры** на вкладке мастера публикации hello и очистить hello **обновление развертывания** флажок. При повторном развертывании этот флажок снят, параметры hello возвращаются toothose в файле .wadcfgx (или .wadcfg) hello, как задается с помощью редактора свойств hello для роли hello. При обновлении развертывания Azure сохраняет старые параметры hello.

## <a name="troubleshoot-azure-cloud-service-issues"></a>Устранение неполадок облачной службы Azure
При возникновении проблем с проектами облачных служб, таких как роли, которая возвращает находится в состоянии «занято», повторяющемся цикле или вызывает ошибку внутреннего сервера, существуют средства и методы можно использовать toodiagnose и устранить эти проблемы. Конкретные примеры стандартных проблем и решений, а также общие сведения о концепции hello и средства, используемые toodiagnose и исправления таких ошибок см. в разделе [Azure диагностические данные PaaS](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).

## <a name="q--a"></a>Вопросы и ответы
**Что такое размер буфера hello и размер должен быть его?**

На каждом экземпляре виртуальной машины квоты ограничивают объем диагностических данных могут храниться в локальной файловой системе hello. Кроме того, вы определяете размер буфера для каждого доступного типа диагностических данных. Этот буфер выполняет роль индивидуальной квоты для соответствующего типа данных. Проверив hello внизу диалоговое окно «hello», можно определить hello общей квоты и hello объем памяти, который остается. Если задать буферы большего размера или большее количество типов данных, можно превысить общую квоту hello. Вы можете изменить hello общей квоты, изменив файл конфигурации diagnostics.wadcfg/.wadcfgx hello. данные хранятся на диагностики Hello hello же файловой данных приложения, поэтому если приложение использует много места на диске, не рекомендуется увеличивать hello общей квоты диагностики.

**Что такое период передачи hello, и как долго он должен быть?**

период передачи Hello — hello количество времени, которое проходит между записью данных. После каждого периода передачи данные перемещаются из hello локальной файловой системе на виртуальной машине tootables вашей учетной записи хранилища. Если hello объем собранных данных превышает квоту hello до окончания периода передачи hello, старые данные удаляются. Период передачи hello toodecrease может возникнуть, если потери данных из-за данных превышает размер буфера hello или hello общей квоты.

**Время какого часового пояса, hello отметки времени в?**

Hello отметках времени указывается в местном часовом поясе hello hello центра обработки данных, на котором размещена облачной службы. Hello следующие три столбца отметки времени в таблицах журнала hello используются.

* **PreciseTimeStamp** значение является меткой времени трассировки событий Windows hello hello событий. То есть hello время hello событие регистрируется из клиента hello.
* **Отметка времени** PreciseTimeStamp округляется вниз toohello границы частоты передачи. Таким образом Если частота передачи — 5 минут до события hello время 00:17:12, отметка времени будет 00:15:00.
* **Отметка времени** временной метке hello, на какие hello сущность была создана в таблице Azure hello.

**Как снизить затраты на сбор диагностической информации?**

Hello параметры по умолчанию (**уровень ведения журнала** значение слишком**ошибка** и **период передачи** значение слишком**1 минута**), разработанные toominimize затрат. Затраты будут выше, если сбор дополнительных данных диагностики или уменьшить период передачи hello. Не собирать больше данных, чем требуется и не забывайте toodisable сбора данных, когда она больше не нужна. Можно всегда включить его снова, даже во время выполнения, как показано в предыдущем разделе hello.

**Как собирать журналы неудачных запросов службы IIS?**

По умолчанию службы IIS не собирают журналы неудачных запросов. Вы можете настроить IIS toocollect их при редактировании hello файл web.config для веб-роли.

**Я не получаю сведения о трассировке от методов RoleEntryPoint, например OnStart. Что не так?**

Hello методы RoleEntryPoint вызываются в контексте WAIISHost.exe, не IIS hello. Таким образом hello сведения о конфигурации в файле web.config, который обычно включает трассировку не применяется. tooresolve эту проблему, добавьте файл .config tooyour веб-проект роли и имя hello файл toomatch hello выходной сборке, содержащей код RoleEntryPoint hello. В проект веб-роли по умолчанию для hello hello hello config-файл будет называться WAIISHost.exe.config. Затем добавьте следующие строки toothis файл hello:

```
<system.diagnostics>
  <trace>
      <listeners>
          <add name “AzureDiagnostics” type=”Microsoft.WindowsAzure.Diagnostics.DiagnosticMonitorTraceListener”>
              <filter type=”” />
          </add>
      </listeners>
  </trace>
</system.diagnostics>
```

Теперь в hello **свойства** окна, набор hello **скопируйте каталог tooOutput** свойство слишком**всегда Копировать**.

## <a name="next-steps"></a>Дальнейшие действия
toolearn Дополнительные сведения о Диагностика и ведение журнала в Azure, в разделе [включение диагностики в облачных службах Azure и виртуальных машин](cloud-services/cloud-services-dotnet-diagnostics.md) и [включить ведение журнала диагностики для веб-приложений в службе приложений Azure](app-service-web/web-sites-enable-diagnostic-log.md).

