---
title: "Настройка системы диагностики для облачных служб и виртуальных машин Azure | Документация Майкрософт"
description: "Из этой статьи вы узнаете, как в Visual Studio настроить сбор диагностической информации для отладки облачных служб и виртуальных машин Azure."
services: visual-studio-online
documentationcenter: na
author: kraigb
manager: ghogen
editor: 
ms.assetid: e70cd7b4-6298-43aa-adea-6fd618414c26
ms.service: multiple
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: multiple
ms.date: 11/11/2016
ms.author: kraigb
ms.openlocfilehash: 2516c0eb8ce470577731db9b844d5b9038465477
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="configuring-diagnostics-for-azure-cloud-services-and-virtual-machines"></a><span data-ttu-id="18d12-103">Настройка системы диагностики для облачных служб и виртуальных машин Azure</span><span class="sxs-lookup"><span data-stu-id="18d12-103">Configuring Diagnostics for Azure Cloud Services and Virtual Machines</span></span>
<span data-ttu-id="18d12-104">Чтобы устранять неполадки в облачных службах или виртуальных машинах Azure, в Visual Studio можно быстро настроить систему диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-104">When you need to troubleshoot an Azure cloud service or Azure virtual machine, you can configure Azure diagnostics more easily by using Visual Studio.</span></span> <span data-ttu-id="18d12-105">Система диагностики Azure собирает системные данные и журналы, поступающие от виртуальных машин и экземпляров виртуальных машин, на которых работает ваша облачная служба. Затем она передает эти данные в указанную вами учетную запись хранения.</span><span class="sxs-lookup"><span data-stu-id="18d12-105">Azure diagnostics captures system data and logging data on the virtual machines and virtual machine instances that run your cloud service and transfers that data into a storage account of your choice.</span></span> <span data-ttu-id="18d12-106">В статье [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](app-service-web/web-sites-enable-diagnostic-log.md) собрана подробная информация о ведении журнала диагностики в Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-106">See [Enable diagnostics logging for web apps in Azure App Service](app-service-web/web-sites-enable-diagnostic-log.md) for more information about diagnostics logging in Azure.</span></span>

<span data-ttu-id="18d12-107">В этом разделе мы продемонстрируем, как включить и настроить систему диагностики Azure в Visual Studio до или после развертывания и как выполнить то же самое на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-107">This topic shows you how to enable and configure Azure diagnostics in Visual Studio, both before and after deployment, as well as in Azure virtual machines.</span></span> <span data-ttu-id="18d12-108">В статье мы также расскажем, как правильно выбирать типы собираемых диагностических данных и просматривать собранную информацию.</span><span class="sxs-lookup"><span data-stu-id="18d12-108">It also shows you how to select the types of diagnostics information to collect and how to view the information after it's collected.</span></span>

<span data-ttu-id="18d12-109">Настроить систему диагностики Azure можно двумя способами.</span><span class="sxs-lookup"><span data-stu-id="18d12-109">You can configure Azure Diagnostics in the following ways:</span></span>

* <span data-ttu-id="18d12-110">Изменить конфигурации системы диагностики через диалоговое окно **Конфигурация диагностики** в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="18d12-110">You can change diagnostics configuration settings through the **Diagnostics Configuration** dialog box in Visual Studio.</span></span> <span data-ttu-id="18d12-111">Параметры сохраняются в файл с именем diagnostics.wadcfgx (diagnostics.wadcfg в Azure SDK до версии 2.4 включительно).</span><span class="sxs-lookup"><span data-stu-id="18d12-111">The settings are saved in a file called diagnostics.wadcfgx (diagnostics.wadcfg in Azure SDK 2.4 or earlier).</span></span> <span data-ttu-id="18d12-112">Также вы можете напрямую изменить файл конфигурации.</span><span class="sxs-lookup"><span data-stu-id="18d12-112">Alternatively, you can directly modify the configuration file.</span></span> <span data-ttu-id="18d12-113">Если вы измените файл вручную, изменения конфигурации вступят в силу после следующего развертывания облачной службы в Azure или следующего запуска службы в эмуляторе.</span><span class="sxs-lookup"><span data-stu-id="18d12-113">If you manually update the file, the configuration changes will take effect the next time you deploy the cloud service to Azure or run the service in the emulator.</span></span>
* <span data-ttu-id="18d12-114">Изменить параметры диагностики для работающей облачной службы или виртуальной машины можно с помощью **Cloud Explorer** или **обозревателя сервера** в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="18d12-114">Use **Cloud Explorer** or **Server Explorer** in Visual Studio to change the diagnostics settings for a running cloud service or virtual machine.</span></span>

## <a name="azure-26-diagnostics-changes"></a><span data-ttu-id="18d12-115">Изменения в системе диагностики Azure версии 2.6</span><span class="sxs-lookup"><span data-stu-id="18d12-115">Azure 2.6 diagnostics changes</span></span>
<span data-ttu-id="18d12-116">Для проектов, созданных в Visual Studio с помощью пакета Azure SDK 2.6, были внесены следующие изменения.</span><span class="sxs-lookup"><span data-stu-id="18d12-116">For Azure SDK 2.6 projects in Visual Studio, the following changes were made.</span></span> <span data-ttu-id="18d12-117">(Эти изменения действуют и в более поздних версиях Azure SDK.)</span><span class="sxs-lookup"><span data-stu-id="18d12-117">(These changes also apply to later versions of Azure SDK.)</span></span>

* <span data-ttu-id="18d12-118">Локальный эмулятор теперь поддерживает систему диагностики.</span><span class="sxs-lookup"><span data-stu-id="18d12-118">The local emulator now supports diagnostics.</span></span> <span data-ttu-id="18d12-119">Это означает, что на этапе разработки и тестирования в Visual Studio вы можете собирать диагностические данные. Это позволит вам убедиться, что приложение создает правильные трассировки.</span><span class="sxs-lookup"><span data-stu-id="18d12-119">This means you can collect diagnostics data and ensure your application is creating the right traces while you're developing and testing in Visual Studio.</span></span> <span data-ttu-id="18d12-120">При запуске проекта облачной службы в Visual Studio строка подключения `UseDevelopmentStorage=true` включает сбор диагностических данных с помощью эмулятора хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-120">The connection string `UseDevelopmentStorage=true` enables diagnostics data collection while you're running your cloud service project in Visual Studio by using the Azure storage emulator.</span></span> <span data-ttu-id="18d12-121">Все диагностические данные собираются в учетную запись хранения (хранилище для разработки).</span><span class="sxs-lookup"><span data-stu-id="18d12-121">All diagnostics data is collected in the (Development Storage) storage account.</span></span>
* <span data-ttu-id="18d12-122">Строка подключения к учетной записи хранения диагностической информации (Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString) также хранится в файле конфигурации (CSCFG) службы.</span><span class="sxs-lookup"><span data-stu-id="18d12-122">The diagnostics storage account connection string (Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString) is stored once again in the service configuration (.cscfg) file.</span></span> <span data-ttu-id="18d12-123">В пакете Azure SDK версии 2.5 учетная запись хранения диагностических данных указывается в файле diagnostics.wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="18d12-123">In Azure SDK 2.5 the diagnostics storage account was specified in the diagnostics.wadcfgx file.</span></span>

<span data-ttu-id="18d12-124">Существуют важные различия между работой строки подключения в старых версиях пакета Azure SDK (до версии 2.4 включительно) и более новых (начиная с версии 2.6).</span><span class="sxs-lookup"><span data-stu-id="18d12-124">There are some notable differences between how the connection string worked in Azure SDK 2.4 and earlier and how it works in Azure SDK 2.6 and later.</span></span>

* <span data-ttu-id="18d12-125">В Azure SDK 2.4 и более ранних версиях строка подключения использовалась как среда выполнения подключаемого модуля диагностики, который получал из нее параметры учетной записи хранения для передачи журналов диагностики.</span><span class="sxs-lookup"><span data-stu-id="18d12-125">In Azure SDK 2.4 and earlier, the connection string was used as a runtime by the diagnostics plugin to get the storage account information for transferring diagnostics logs.</span></span>
* <span data-ttu-id="18d12-126">В Azure SDK 2.6 и более поздних версиях Visual Studio использует строку подключения диагностики для настройки учетной записи хранения в расширении диагностики во время публикации.</span><span class="sxs-lookup"><span data-stu-id="18d12-126">In Azure SDK 2.6 and later, the diagnostics connection string is used by Visual Studio to configure the diagnostics extension with the appropriate storage account information during publishing.</span></span> <span data-ttu-id="18d12-127">Строка подключения позволяет вам указать разные учетные записи хранения для различных конфигураций службы. Visual Studio будет использовать их во время публикации.</span><span class="sxs-lookup"><span data-stu-id="18d12-127">The connection string lets you define different storage accounts for different service configurations that Visual Studio will use when publishing.</span></span> <span data-ttu-id="18d12-128">Но подключаемый модуль диагностики больше не доступен (в пакетах Azure SDK, начиная с версии 2.5), поэтому сам CSCFG-файл уже не может включить расширение диагностики.</span><span class="sxs-lookup"><span data-stu-id="18d12-128">However, because the diagnostics plugin is no longer available (after Azure SDK 2.5), the .cscfg file by itself can't enable the Diagnostics Extension.</span></span> <span data-ttu-id="18d12-129">Его нужно включать отдельно с помощью таких средств, как Visual Studio или PowerShell.</span><span class="sxs-lookup"><span data-stu-id="18d12-129">You have to enable the extension separately through tools such as Visual Studio or PowerShell.</span></span>
* <span data-ttu-id="18d12-130">Выходные данные пакета Visual Studio содержат, среди прочего, общедоступный XML-файл конфигурации расширения диагностики для каждой роли. Это позволяет упростить процесс настройки расширения с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="18d12-130">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML for the diagnostics extension for each role.</span></span> <span data-ttu-id="18d12-131">С помощью строки подключения диагностики Visual Studio получает из общедоступной конфигурации данные учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="18d12-131">Visual Studio uses the diagnostics connection string to populate the storage account information present in the public configuration.</span></span> <span data-ttu-id="18d12-132">Общедоступные файлы конфигураций создаются в папке Extensions с именами в формате PaaSDiagnostics.&lt;имя_роли>.PubConfig.xml.</span><span class="sxs-lookup"><span data-stu-id="18d12-132">The public config files are created in the Extensions folder and follow the pattern PaaSDiagnostics.&lt;RoleName>.PubConfig.xml.</span></span> <span data-ttu-id="18d12-133">Все развертывания с использованием PowerShell могут использовать этот шаблон имени для сопоставления каждой конфигурации с ролью.</span><span class="sxs-lookup"><span data-stu-id="18d12-133">Any PowerShell based deployments can use this pattern to map each configuration to a Role.</span></span>
* <span data-ttu-id="18d12-134">Строка подключения из CSCFG-файла также используется на [портале Azure](http://go.microsoft.com/fwlink/p/?LinkID=525040) для доступа к диагностическим данным, которые затем отображаются на вкладке **Мониторинг** . Строка подключения позволяет настроить в службе отображение на портале подробных данных мониторинга.</span><span class="sxs-lookup"><span data-stu-id="18d12-134">The connection string in the .cscfg file is also used by the [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040) to access the diagnostics data so it can appear in the **Monitoring** tab. The connection string is needed to configure the service to show verbose monitoring data in the portal.</span></span>

## <a name="migrating-projects-to-azure-sdk-26-and-later"></a><span data-ttu-id="18d12-135">Перенос проектов на Azure SDK версии 2.6 и выше</span><span class="sxs-lookup"><span data-stu-id="18d12-135">Migrating projects to Azure SDK 2.6 and later</span></span>
<span data-ttu-id="18d12-136">Когда проект переносится с Azure SDK 2.5 на Azure SDK 2.6 или более новую версию, данные учетной записи хранения диагностической информации, указанные в WADCFGX-файле, сохраняются.</span><span class="sxs-lookup"><span data-stu-id="18d12-136">When migrating from Azure SDK 2.5 to Azure SDK 2.6 or later, if you had a diagnostics storage account specified in the .wadcfgx file, then it will stay there.</span></span> <span data-ttu-id="18d12-137">Чтобы воспользоваться преимуществами гибкости использования различных учетных записей хранения для разных конфигураций хранилища, необходимо вручную добавить строку подключения в проект.</span><span class="sxs-lookup"><span data-stu-id="18d12-137">To take advantage of the flexibility of using different storage accounts for different storage configurations, you'll have to manually add the connection string to your project.</span></span> <span data-ttu-id="18d12-138">Если при переносе проекта на основе пакета SDK для Azure 2.4 или более ранней версии на пакет SDK для Azure 2.6 строки подключения системы диагностики сохраняются.</span><span class="sxs-lookup"><span data-stu-id="18d12-138">If you're migrating a project from Azure SDK 2.4 or earlier to Azure SDK 2.6, then the diagnostics connection strings are preserved.</span></span> <span data-ttu-id="18d12-139">Однако не забывайте, что в Azure SDK 2.6 строки подключения используются иначе (см. предыдущий раздел).</span><span class="sxs-lookup"><span data-stu-id="18d12-139">However, please note the changes in how connection strings are treated in Azure SDK 2.6 as specified in the previous section.</span></span>

### <a name="how-visual-studio-determines-the-diagnostics-storage-account"></a><span data-ttu-id="18d12-140">Определение учетной записи хранения диагностических данных в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="18d12-140">How Visual Studio determines the diagnostics storage account</span></span>
* <span data-ttu-id="18d12-141">Если в CSCFG-файле указана строка подключения диагностики, Visual Studio использует ее для настройки расширения диагностики во время публикации, а также при создании общедоступных XML-файлов конфигурации на этапе упаковки.</span><span class="sxs-lookup"><span data-stu-id="18d12-141">If a diagnostics connection string is specified in the .cscfg file, Visual Studio uses it to configure the diagnostics extension when publishing, and when generating the public configuration xml files during packaging.</span></span>
* <span data-ttu-id="18d12-142">Если в CSCFG-файле строка подключения диагностики не указана, Visual Studio использует для этих же целей учетную запись хранения, указанную в WADCFGX-файле.</span><span class="sxs-lookup"><span data-stu-id="18d12-142">If no diagnostics connection string is specified in the .cscfg file, then Visual Studio falls back to using the storage account specified in the .wadcfgx file to configure the diagnostics extension when publishing, and generating the public configuration xml files when packaging.</span></span>
* <span data-ttu-id="18d12-143">Строка подключения диагностики в CSCFG-файле имеет более высокий приоритет, чем учетная запись хранения в WADCFGX-файле.</span><span class="sxs-lookup"><span data-stu-id="18d12-143">The diagnostics connection string in the .cscfg file takes precedence over the storage account in the .wadcfgx file.</span></span> <span data-ttu-id="18d12-144">Если в CSCFG-файле присутствует строка подключения диагностики, Visual Studio использует именно ее, игнорируя учетную запись хранения в WADCFGX-файле.</span><span class="sxs-lookup"><span data-stu-id="18d12-144">If a diagnostics connection string is specified in the .cscfg file, then Visual Studio uses that and ignores the storage account in .wadcfgx.</span></span>

### <a name="what-does-the-update-development-storage-connection-strings-checkbox-do"></a><span data-ttu-id="18d12-145">Что позволяет сделать флажок</span><span class="sxs-lookup"><span data-stu-id="18d12-145">What does the "Update development storage connection strings…"</span></span> <span data-ttu-id="18d12-146">"Обновлять строки подключения хранилища разработки..."?</span><span class="sxs-lookup"><span data-stu-id="18d12-146">checkbox do?</span></span>
<span data-ttu-id="18d12-147">Флажок **Обновлять строки подключения хранилища разработки для диагностики и кэширования, используя учетную запись хранения Microsoft Azure, при публикации в Microsoft Azure** позволяет быстро заменить строку подключения хранилища для разработки учетной записью хранения Azure, указанной во время публикации.</span><span class="sxs-lookup"><span data-stu-id="18d12-147">The checkbox for **Update development storage connection strings for Diagnostics and Caching with Microsoft Azure storage account credentials when publishing to Microsoft Azure** gives you a convenient way to update any development storage account connection strings with the Azure storage account specified during publishing.</span></span>

<span data-ttu-id="18d12-148">Предположим, вы установили этот флажок, а в строке подключения диагностики указан параметр `UseDevelopmentStorage=true`.</span><span class="sxs-lookup"><span data-stu-id="18d12-148">For example, suppose you select this checkbox and the diagnostics connection string specifies `UseDevelopmentStorage=true`.</span></span> <span data-ttu-id="18d12-149">Когда вы будете публиковать проект в Azure, Visual Studio автоматически заменит строки подключения диагностики учетной записью хранения, которую вы указали в мастере публикации.</span><span class="sxs-lookup"><span data-stu-id="18d12-149">When you publish the project to Azure, Visual Studio will automatically update the diagnostics connection string with the storage account you specified in the Publish wizard.</span></span> <span data-ttu-id="18d12-150">Но если в строке подключения диагностики указана реальная учетная запись хранения, будет использоваться именно она.</span><span class="sxs-lookup"><span data-stu-id="18d12-150">However, if a real storage account was specified as the diagnostics connection string, then that account is used instead.</span></span>

## <a name="diagnostics-functionality-differences-between-azure-sdk-24-and-earlier-and-azure-sdk-25-and-later"></a><span data-ttu-id="18d12-151">Функциональные различия диагностики в Azure SDK между более ранними (до 2.4 включительно) и более поздними (с 2.5 включительно) версиями</span><span class="sxs-lookup"><span data-stu-id="18d12-151">Diagnostics functionality differences between Azure SDK 2.4 and earlier and Azure SDK 2.5 and later</span></span>
<span data-ttu-id="18d12-152">Обновляя свой проект с Azure SDK 2.4 на Azure SDK 2.5 и выше, помните о следующих функциональных различиях.</span><span class="sxs-lookup"><span data-stu-id="18d12-152">If you're upgrading your project from Azure SDK 2.4 to Azure SDK 2.5 or later, you should bear in mind the following diagnostics functionality differences.</span></span>

* <span data-ttu-id="18d12-153">**API конфигурации больше не используются.** Программная конфигурация диагностики доступна в пакете SDK для Azure 2.4 и более ранних версий, но в дальнейших выпусках, начиная с версии SDK для Azure 2.5, она не используется.</span><span class="sxs-lookup"><span data-stu-id="18d12-153">**Configuration APIs are deprecated** – Programmatic configuration of diagnostics is available in Azure SDK 2.4 or earlier versions, but is deprecated in Azure SDK 2.5 and later.</span></span> <span data-ttu-id="18d12-154">Если конфигурация диагностики в вашем проекте определена в коде, после переноса проекта на более новую версию SDK все нужно настроить заново, иначе диагностика работать не будет.</span><span class="sxs-lookup"><span data-stu-id="18d12-154">If your diagnostics configuration is currently defined in code, you'll need to reconfigure those settings from scratch in the migrated project in order for diagnostics to keep working.</span></span> <span data-ttu-id="18d12-155">Azure SDK 2.4 используется файл конфигурации диагностики diagnostics.wadcfg, а Azure SDK 2.5 и более поздние версии — diagnostics.wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="18d12-155">The diagnostics configuration file for Azure SDK 2.4 is diagnostics.wadcfg, and diagnostics.wadcfgx for Azure SDK 2.5 and later.</span></span>
* <span data-ttu-id="18d12-156">**Диагностику для приложений облачной службы можно настроить только на уровне роли, а не на уровне экземпляра.**</span><span class="sxs-lookup"><span data-stu-id="18d12-156">**Diagnostics for cloud service applications can only be configured at the role level, not at the instance level.**</span></span>
* <span data-ttu-id="18d12-157">**Конфигурация диагностики обновляется при каждом развертывании приложения.** Если изменить конфигурацию диагностики в обозревателе сервера и повторно развернуть приложение, могут возникнуть проблемы с контролем четности.</span><span class="sxs-lookup"><span data-stu-id="18d12-157">**Every time you deploy your app, the diagnostics configuration is updated** – This can cause parity issues if you change your diagnostics configuration from Server Explorer and then redeploy your app.</span></span>
* <span data-ttu-id="18d12-158">**В пакете SDK для Azure 2.5 и более поздних версиях аварийные дампы настраиваются в файле конфигурации диагностики, а не в коде.** Если вы настроили аварийные дампы в коде проекта, следует вручную перенести параметры из кода в файл конфигурации, так как при переходе на пакет SDK для Azure 2.6 аварийные дампы не переносятся.</span><span class="sxs-lookup"><span data-stu-id="18d12-158">**In Azure SDK 2.5 and later, crash dumps are configured in the diagnostics configuration file, not in code** – If you have crash dumps configured in code, you'll have to manually transfer the configuration from code to the configuration file, because the crash dumps aren't transferred during the migration to Azure SDK 2.6.</span></span>

## <a name="enable-diagnostics-in-cloud-service-projects-before-deploying-them"></a><span data-ttu-id="18d12-159">Включение диагностики в проекте облачной службы перед его развертыванием</span><span class="sxs-lookup"><span data-stu-id="18d12-159">Enable diagnostics in cloud service projects before deploying them</span></span>
<span data-ttu-id="18d12-160">В Visual Studio при запуске службы в эмуляторе перед ее развертыванием можно настроить сбор диагностических данных для ролей, выполняемых в Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-160">In Visual Studio, you can choose to collect diagnostics data for roles that run in Azure, when you run the service in the emulator before deploying it.</span></span> <span data-ttu-id="18d12-161">Все изменения параметров диагностики в Visual Studio сохраняются в файл конфигурации diagnostics.wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="18d12-161">All changes to diagnostics settings in Visual Studio are saved in the diagnostics.wadcfgx configuration file.</span></span> <span data-ttu-id="18d12-162">Эти параметры конфигурации определяют учетную запись хранения, в которую сохраняются диагностические данные после развертывания облачной службы.</span><span class="sxs-lookup"><span data-stu-id="18d12-162">These configuration settings specify the storage account where diagnostics data is saved when you deploy your cloud service.</span></span>

[!INCLUDE [cloud-services-wad-warning](../includes/cloud-services-wad-warning.md)]

### <a name="to-enable-diagnostics-in-visual-studio-before-deployment"></a><span data-ttu-id="18d12-163">Включение диагностики в Visual Studio перед развертыванием</span><span class="sxs-lookup"><span data-stu-id="18d12-163">To enable diagnostics in Visual Studio before deployment</span></span>
1. <span data-ttu-id="18d12-164">В контекстном меню интересующей вас роли выберите пункт **Свойства** и в окне **Свойства** перейдите на вкладку **Конфигурация**.</span><span class="sxs-lookup"><span data-stu-id="18d12-164">On the shortcut menu for the role that interests you, choose **Properties**, and then choose the **Configuration** tab in the role’s **Properties** window.</span></span>
2. <span data-ttu-id="18d12-165">В разделе **Диагностика** установите флажок **Включить диагностику**.</span><span class="sxs-lookup"><span data-stu-id="18d12-165">In the **Diagnostics** section, make sure that the **Enable Diagnostics** check box is selected.</span></span>
   
    ![Доступ к параметру "Включить диагностику"](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796660.png)
3. <span data-ttu-id="18d12-167">Нажмите кнопку с многоточием (...), чтобы указать учетную запись хранения для хранения данных диагностики.</span><span class="sxs-lookup"><span data-stu-id="18d12-167">Choose the ellipsis (…) button to specify the storage account where you want the diagnostics data to be stored.</span></span> <span data-ttu-id="18d12-168">Выбранная учетная запись хранения и будет расположением для хранения данных диагностики.</span><span class="sxs-lookup"><span data-stu-id="18d12-168">The storage account you choose will be the location where diagnostics data is stored.</span></span>
   
    ![Выбор учетной записи хранения](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796661.png)
4. <span data-ttu-id="18d12-170">В диалоговом окне **Создание строки подключения хранилища** укажите способ подключения: эмулятор хранения Azure, подписка Azure или вручную введенные учетные данные.</span><span class="sxs-lookup"><span data-stu-id="18d12-170">In the **Create Storage Connection String** dialog box, specify whether you want to connect using the Azure Storage Emulator, an Azure subscription, or manually entered credentials.</span></span>
   
    ![Диалоговое окно учетной записи хранения](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796662.png)
   
   * <span data-ttu-id="18d12-172">Если вы выберете эмулятор хранения Microsoft Azure, строка подключения будет иметь вид UseDevelopmentStorage=true.</span><span class="sxs-lookup"><span data-stu-id="18d12-172">If you choose the Microsoft Azure Storage Emulator option, the connection string is set to UseDevelopmentStorage=true.</span></span>
   * <span data-ttu-id="18d12-173">Если вы выберете вариант с подпиской, то сможете выбрать нужную подписку Azure и имя учетной записи.</span><span class="sxs-lookup"><span data-stu-id="18d12-173">If you choose the Your subscription option, you can choose the Azure subscription you want to use and the account name.</span></span> <span data-ttu-id="18d12-174">Чтобы управлять подписками Azure, нажмите кнопку "Управление учетными записями".</span><span class="sxs-lookup"><span data-stu-id="18d12-174">You can choose the Manage Accounts button to manage your Azure subscriptions.</span></span>
   * <span data-ttu-id="18d12-175">Если вы выберете вариант ручного ввода учетных данных, вам будет предложено ввести имя и ключ учетной записи Azure, которую вы хотите использовать.</span><span class="sxs-lookup"><span data-stu-id="18d12-175">If you choose the Manually entered credentials option, you're prompted to enter the name and key of the Azure account you want to use.</span></span>
5. <span data-ttu-id="18d12-176">Нажмите кнопку **Настройка**, чтобы открыть диалоговое окно **Конфигурация диагностики**.</span><span class="sxs-lookup"><span data-stu-id="18d12-176">Choose the **Configure** button to view the **Diagnostics configuration** dialog box.</span></span> <span data-ttu-id="18d12-177">Каждая вкладка (кроме вкладок **Общие** и **Каталоги журналов**) соответствует определенному источнику диагностических данных, которые можно собирать.</span><span class="sxs-lookup"><span data-stu-id="18d12-177">Each tab (except for **General** and **Log Directories**) represents a diagnostic data source that you can collect.</span></span> <span data-ttu-id="18d12-178">По умолчанию открывается вкладка **Общие**, где вы можете выбрать следующие режимы сбора диагностических данных: **Только ошибки**, **Все сведения** и **Пользовательский план**.</span><span class="sxs-lookup"><span data-stu-id="18d12-178">The default tab, **General**, offers you the following diagnostics data collection options: **Errors only**, **All information**, and **Custom plan**.</span></span> <span data-ttu-id="18d12-179">По умолчанию установлен режим **Только ошибки**, для которого требуется наименьший объем хранилища, поскольку в этом режиме предупреждения и сообщения трассировки не передаются.</span><span class="sxs-lookup"><span data-stu-id="18d12-179">The default option, **Errors only**, takes the least amount of storage because it doesn’t transfer warnings or tracing messages.</span></span> <span data-ttu-id="18d12-180">В режиме «Все сведения» передается больше всего информации; это самый затратный по объему хранения вариант.</span><span class="sxs-lookup"><span data-stu-id="18d12-180">The All information option transfers the most information and is, therefore, the most expensive option in terms of storage.</span></span>
   
    ![Включение и настройка диагностики Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758144.png)
6. <span data-ttu-id="18d12-182">В нашем примере мы выберем режим **Пользовательский план** , в котором вы можете настроить параметры сбора данных.</span><span class="sxs-lookup"><span data-stu-id="18d12-182">For this example, select the **Custom plan** option so you can customize the data collected.</span></span>
7. <span data-ttu-id="18d12-183">В поле **Квота диска в МБ** вы указываете, сколько хотите выделить места для диагностических данных в своей учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="18d12-183">The **Disk Quota in MB** box specifies how much space you want to allocate in your storage account for diagnostics data.</span></span> <span data-ttu-id="18d12-184">Значение по умолчанию можно изменять.</span><span class="sxs-lookup"><span data-stu-id="18d12-184">You can change the default value if you want.</span></span>
8. <span data-ttu-id="18d12-185">На каждой вкладке, которая содержит нужные вам диагностические данные, установите флажок **Включить передачу <log type>**.</span><span class="sxs-lookup"><span data-stu-id="18d12-185">On each tab of diagnostics data you want to collect, select its **Enable Transfer of <log type>** check box.</span></span> <span data-ttu-id="18d12-186">Например, если вы хотите собирать журналы приложений, установите флажок **Включить передачу журналов приложения** на вкладке **Журналы приложений**. Установите также все остальные параметры, необходимые для каждого типа диагностических данных.</span><span class="sxs-lookup"><span data-stu-id="18d12-186">For example, if you want to collect application logs, select the **Enable transfer of Application Logs** check box on the **Application Logs** tab. Also, specify any other information required by each diagnostics data type.</span></span> <span data-ttu-id="18d12-187">Далее в этой статье есть раздел **Настройка источников диагностических данных** , в котором собрана информация о параметрах на каждой вкладке.</span><span class="sxs-lookup"><span data-stu-id="18d12-187">See the section **Configure diagnostics data sources** later in this topic for configuration information on each tab.</span></span>
9. <span data-ttu-id="18d12-188">Настроив все нужные параметры сбора диагностических данных, нажмите кнопку **ОК** .</span><span class="sxs-lookup"><span data-stu-id="18d12-188">After you’ve enabled collection of all the diagnostics data you want, choose the **OK** button.</span></span>
10. <span data-ttu-id="18d12-189">Теперь запустите проект облачной службы Azure в Visual Studio обычным образом.</span><span class="sxs-lookup"><span data-stu-id="18d12-189">Run your Azure cloud service project in Visual Studio as usual.</span></span> <span data-ttu-id="18d12-190">В процессе использования приложения вся информация, сбор который вы включили, будет сохраняться в указанной учетной запись хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-190">As you use your application, the log information that you enabled is saved to the Azure storage account you specified.</span></span>

## <a name="enable-diagnostics-in-azure-virtual-machines"></a><span data-ttu-id="18d12-191">Включение диагностики на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="18d12-191">Enable diagnostics in Azure virtual machines</span></span>
<span data-ttu-id="18d12-192">В Visual Studio вы можете включить сбор диагностических данных для виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-192">In Visual Studio, you can choose to collect diagnostics data for Azure virtual machines.</span></span>

### <a name="to-enable-diagnostics-in-azure-virtual-machines"></a><span data-ttu-id="18d12-193">Включение диагностики для виртуальных машин Azure</span><span class="sxs-lookup"><span data-stu-id="18d12-193">To enable diagnostics in Azure virtual machines</span></span>
1. <span data-ttu-id="18d12-194">В **обозревателе сервера**выберите узел Azure и подключитесь к подписке Azure (если это еще не сделано).</span><span class="sxs-lookup"><span data-stu-id="18d12-194">In **Server Explorer**, choose the Azure node and then connect to your Azure subscription, if you're not already connected.</span></span>
2. <span data-ttu-id="18d12-195">Разверните узел **Виртуальные машины** .</span><span class="sxs-lookup"><span data-stu-id="18d12-195">Expand the **Virtual Machines** node.</span></span> <span data-ttu-id="18d12-196">Вы можете создать новую виртуальную машину или выбрать уже существующую.</span><span class="sxs-lookup"><span data-stu-id="18d12-196">You can create a new virtual machine, or select one that's already there.</span></span>
3. <span data-ttu-id="18d12-197">В контекстном меню нужной виртуальной машины выберите пункт **Настроить**.</span><span class="sxs-lookup"><span data-stu-id="18d12-197">On the shortcut menu for the virtual machine that interests you, choose **Configure**.</span></span> <span data-ttu-id="18d12-198">Откроется диалоговое окно конфигурации виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="18d12-198">This shows the virtual machine configuration dialog box.</span></span>
   
    ![Настройка виртуальной машины Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796663.png)
4. <span data-ttu-id="18d12-200">Добавьте расширение Microsoft Monitoring Agent Diagnostics, если оно еще не установлено.</span><span class="sxs-lookup"><span data-stu-id="18d12-200">If it's not already installed, add the Microsoft Monitoring Agent Diagnostics extension.</span></span> <span data-ttu-id="18d12-201">Это расширение позволяет собирать диагностические данные для виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-201">This extension lets you gather diagnostics data for the Azure virtual machine.</span></span> <span data-ttu-id="18d12-202">В списке установленных расширений выберите в раскрывающемся меню «Выбрать допустимое расширение» пункт Microsoft Monitoring Agent Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="18d12-202">In the Installed Extensions list, choose the Select an available extension drop-down menu and then choose Microsoft Monitoring Agent Diagnostics.</span></span>
   
    ![Установка расширения виртуальной машины Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766024.png)
   
   > [!NOTE]
   > <span data-ttu-id="18d12-204">Для виртуальных машин существуют и другие диагностические расширения.</span><span class="sxs-lookup"><span data-stu-id="18d12-204">Other diagnostics extensions are available for your virtual machines.</span></span> <span data-ttu-id="18d12-205">Дополнительные сведения см. в статье «Расширения и компоненты виртуальных машин Azure».</span><span class="sxs-lookup"><span data-stu-id="18d12-205">For more information, see Azure VM Extensions and Features.</span></span>
   > 
   > 
5. <span data-ttu-id="18d12-206">Нажмите кнопку **Добавить**, чтобы добавить расширение, и изучите информацию в диалоговом окне **Конфигурация диагностики**.</span><span class="sxs-lookup"><span data-stu-id="18d12-206">Choose the **Add** button to add the extension and view its **Diagnostics configuration** dialog box.</span></span>
6. <span data-ttu-id="18d12-207">Нажмите кнопку **Настроить**, укажите учетную запись хранения и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="18d12-207">Choose the **Configure** button to specify a storage account and then choose the **OK** button.</span></span>
   
    <span data-ttu-id="18d12-208">Каждая вкладка (кроме вкладок **Общие** и **Каталоги журналов**) соответствует определенному источнику диагностических данных, которые можно собирать.</span><span class="sxs-lookup"><span data-stu-id="18d12-208">Each tab (except for **General** and **Log Directories**) represents a diagnostic data source that you can collect.</span></span>
   
    ![Включение и настройка диагностики Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758144.png)
   
    <span data-ttu-id="18d12-210">По умолчанию открывается вкладка **Общие**, где вы можете выбрать следующие режимы сбора диагностических данных: **Только ошибки**, **Все сведения** и **Пользовательский план**.</span><span class="sxs-lookup"><span data-stu-id="18d12-210">The default tab, **General**, offers you the following diagnostics data collection options: **Errors only**, **All information**, and **Custom plan**.</span></span> <span data-ttu-id="18d12-211">По умолчанию установлен режим **Только ошибки**, для которого требуется наименьший объем хранилища, поскольку в этом режиме предупреждения и сообщения трассировки не передаются.</span><span class="sxs-lookup"><span data-stu-id="18d12-211">The default option, **Errors only**, takes the least amount of storage because it doesn’t transfer warnings or tracing messages.</span></span> <span data-ttu-id="18d12-212">В режиме **Все сведения** передается больше всего информации; это самый затратный по объему хранения вариант.</span><span class="sxs-lookup"><span data-stu-id="18d12-212">The **All information** option transfers the most information and is, therefore, the most expensive option in terms of storage.</span></span>
7. <span data-ttu-id="18d12-213">В нашем примере мы выберем режим **Пользовательский план** , в котором вы можете настроить параметры сбора данных.</span><span class="sxs-lookup"><span data-stu-id="18d12-213">For this example, select the **Custom plan** option so you can customize the data collected.</span></span>
8. <span data-ttu-id="18d12-214">В поле **Квота диска в МБ** вы указываете, сколько хотите выделить места для диагностических данных в своей учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="18d12-214">The **Disk Quota in MB** box specifies how much space you want to allocate in your storage account for diagnostics data.</span></span> <span data-ttu-id="18d12-215">Значение по умолчанию можно изменять.</span><span class="sxs-lookup"><span data-stu-id="18d12-215">You can change the default value if you want.</span></span>
9. <span data-ttu-id="18d12-216">На каждой вкладке, которая содержит нужные вам диагностические данные, установите флажок **Включить передачу <log type>**.</span><span class="sxs-lookup"><span data-stu-id="18d12-216">On each tab of diagnostics data you want to collect, select its **Enable Transfer of <log type>** check box.</span></span>
   
    <span data-ttu-id="18d12-217">Например, если вы хотите собирать журналы приложений, установите флажок **Включить передачу журналов приложения** на вкладке **Журналы приложений**. Установите также все остальные параметры, необходимые для каждого типа диагностических данных.</span><span class="sxs-lookup"><span data-stu-id="18d12-217">For example, if you want to collect application logs, select the **Enable transfer of Application Logs** check box on the **Application Logs** tab. Also, specify any other information required by each diagnostics data type.</span></span> <span data-ttu-id="18d12-218">Далее в этой статье есть раздел **Настройка источников диагностических данных** , в котором собрана информация о параметрах на каждой вкладке.</span><span class="sxs-lookup"><span data-stu-id="18d12-218">See the section **Configure diagnostics data sources** later in this topic for configuration information on each tab.</span></span>
10. <span data-ttu-id="18d12-219">Настроив все нужные параметры сбора диагностических данных, нажмите кнопку **ОК** .</span><span class="sxs-lookup"><span data-stu-id="18d12-219">After you’ve enabled collection of all the diagnostics data you want, choose the **OK** button.</span></span>
11. <span data-ttu-id="18d12-220">Сохраните обновленный проект.</span><span class="sxs-lookup"><span data-stu-id="18d12-220">Save the updated project.</span></span>
    
     <span data-ttu-id="18d12-221">В окне **Журнал действий Microsoft Azure** вы увидите сообщение о выполненном обновлении виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="18d12-221">You'll see a message in the **Microsoft Azure Activity Log** window that the virtual machine has been updated.</span></span>

## <a name="configure-diagnostics-data-sources"></a><span data-ttu-id="18d12-222">Настройка источников диагностических данных</span><span class="sxs-lookup"><span data-stu-id="18d12-222">Configure diagnostics data sources</span></span>
<span data-ttu-id="18d12-223">Включив сбор диагностических данных, вы можете указать нужные вам источники данных и выбрать конкретную информацию, которую желаете собирать.</span><span class="sxs-lookup"><span data-stu-id="18d12-223">After you enable diagnostics data collection, you can choose exactly what data sources you want to collect and what information is collected.</span></span> <span data-ttu-id="18d12-224">Ниже приведен список вкладок в диалоговом окне **Конфигурация диагностики** и описание каждого параметра.</span><span class="sxs-lookup"><span data-stu-id="18d12-224">The following is a list of tabs in the **Diagnostics configuration** dialog box and what each configuration option means.</span></span>

### <a name="application-logs"></a><span data-ttu-id="18d12-225">Журналы приложений</span><span class="sxs-lookup"><span data-stu-id="18d12-225">Application logs</span></span>
<span data-ttu-id="18d12-226">**Application logs** содержатся диагностические данные, созданные веб-приложениями.</span><span class="sxs-lookup"><span data-stu-id="18d12-226">**Application logs** contain diagnostics information produced by a web application.</span></span> <span data-ttu-id="18d12-227">Если вы хотите собирать журналы приложений, установите флажок **Включить передачу журналов приложения** .</span><span class="sxs-lookup"><span data-stu-id="18d12-227">If you want to capture application logs, select the **Enable transfer of Application Logs** check box.</span></span> <span data-ttu-id="18d12-228">Чтобы увеличить или уменьшить количество минут, через которое журналы приложений будут передаваться в учетную запись хранения, измените значение параметра **Период передачи (мин)** .</span><span class="sxs-lookup"><span data-stu-id="18d12-228">You can increase or decrease the number of minutes when the application logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span> <span data-ttu-id="18d12-229">Также вы можете изменить объем сведений, сохраняемых в журнале, установив уровень ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="18d12-229">You can also change the amount of information captured in the log by setting the Log level value.</span></span> <span data-ttu-id="18d12-230">Например, выбрав уровень **Подробный**, вы будете получать подробные сведения, а выбрав уровень **Критические** — только критические ошибки.</span><span class="sxs-lookup"><span data-stu-id="18d12-230">For example, you can choose **Verbose** to get more information or choose **Critical** to capture only critical errors.</span></span> <span data-ttu-id="18d12-231">Если существует определенный провайдер диагностических данных, создающий журналы приложений, вы можете настроить сбор этих журналов, добавив идентификатор поставщика в поле **GUID поставщика** .</span><span class="sxs-lookup"><span data-stu-id="18d12-231">If you have a specific diagnostics provider that emits application logs, you can capture them by adding the provider’s GUID to the **Provider GUID** box.</span></span>

  ![Журналы приложений](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758145.png)

  <span data-ttu-id="18d12-233">Дополнительную информацию о диагностических журналах см. в статье [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](app-service-web/web-sites-enable-diagnostic-log.md).</span><span class="sxs-lookup"><span data-stu-id="18d12-233">See [Enable diagnostics logging for web apps in Azure App Service](app-service-web/web-sites-enable-diagnostic-log.md) for more information about application logs.</span></span>

### <a name="windows-event-logs"></a><span data-ttu-id="18d12-234">Журналы событий Windows</span><span class="sxs-lookup"><span data-stu-id="18d12-234">Windows event logs</span></span>
<span data-ttu-id="18d12-235">Если вы хотите собирать журналы событий Windows, установите флажок **Включить перемещение журналов событий Windows** .</span><span class="sxs-lookup"><span data-stu-id="18d12-235">If you want to capture Windows event logs, select the **Enable transfer of Windows Event Logs** check box.</span></span> <span data-ttu-id="18d12-236">Чтобы увеличить или уменьшить количество минут, через которое журналы событий будут передаваться в учетную запись хранения, измените значение параметра **Период передачи (мин)** .</span><span class="sxs-lookup"><span data-stu-id="18d12-236">You can increase or decrease the number of minutes when the event logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span> <span data-ttu-id="18d12-237">Установите флажки для тех типов событий, которые хотите отслеживать.</span><span class="sxs-lookup"><span data-stu-id="18d12-237">Select the check boxes for the types of events that you want to track.</span></span>

  ![Журналы событий](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796664.png)

<span data-ttu-id="18d12-239">Если вы используете пакет SDK для Azure 2.6 (или более позднюю версию) и хотите указать пользовательский источник данных, введите его в текстовое поле **<Data source name>**, а затем нажмите рядом с ним кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="18d12-239">If you're using Azure SDK 2.6 or later and want to specify a custom data source, enter it in the **<Data source name>** text box and then choose the **Add** button next to it.</span></span> <span data-ttu-id="18d12-240">Источник данных добавляется в файл diagnostics.cfcfg.</span><span class="sxs-lookup"><span data-stu-id="18d12-240">The data source is added to the diagnostics.cfcfg file.</span></span>

<span data-ttu-id="18d12-241">Если вы используете Azure SDK 2.5 и хотите указать пользовательский источник данных, вы можете добавить его в файл diagnostics.wadcfgx в раздел `WindowsEventLog` , как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="18d12-241">If you're using Azure SDK 2.5 and want to specify a custom data source, you can add it to the `WindowsEventLog` section of the diagnostics.wadcfgx file, such as in the following example.</span></span>

```
<WindowsEventLog scheduledTransferPeriod="PT1M">
   <DataSource name="Application!*" />
   <DataSource name="CustomDataSource!*" />
</WindowsEventLog>
```
### <a name="performance-counters"></a><span data-ttu-id="18d12-242">Счетчики производительности</span><span class="sxs-lookup"><span data-stu-id="18d12-242">Performance counters</span></span>
<span data-ttu-id="18d12-243">Сведения о счетчиках производительности помогут вам найти проблемы в системе и оптимизировать производительность системы и приложений.</span><span class="sxs-lookup"><span data-stu-id="18d12-243">Performance counter information can help you locate system bottlenecks and fine-tune system and application performance.</span></span> <span data-ttu-id="18d12-244">Дополнительные сведения см. в статье [Создание и использование счетчиков производительности в приложении Azure](https://msdn.microsoft.com/library/azure/hh411542.aspx).</span><span class="sxs-lookup"><span data-stu-id="18d12-244">See [Create and Use Performance Counters in an Azure Application](https://msdn.microsoft.com/library/azure/hh411542.aspx) for more information.</span></span> <span data-ttu-id="18d12-245">Если вы хотите сохранять данные счетчиков производительности, установите флажок **Включить перемещение счетчиков производительности**.</span><span class="sxs-lookup"><span data-stu-id="18d12-245">If you want to capture performance counters, select the **Enable transfer of Performance Counters** check box.</span></span> <span data-ttu-id="18d12-246">Чтобы увеличить или уменьшить количество минут, через которое журналы событий будут передаваться в учетную запись хранения, измените значение параметра **Период передачи (мин)** .</span><span class="sxs-lookup"><span data-stu-id="18d12-246">You can increase or decrease the number of minutes when the event logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span> <span data-ttu-id="18d12-247">Установите флажки для тех счетчиков, которые хотите отслеживать.</span><span class="sxs-lookup"><span data-stu-id="18d12-247">Select the check boxes for the performance counters that you want to track.</span></span>

  ![Счетчики производительности](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758147.png)

<span data-ttu-id="18d12-249">Чтобы отслеживать счетчик производительности, который отсутствует в списке, введите его имя, используя предложенный синтаксис, и нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="18d12-249">To track a performance counter that isn’t listed, enter it by using the suggested syntax and then choose the **Add** button.</span></span> <span data-ttu-id="18d12-250">Список счетчиков производительности, которые можно отслеживать, зависит от операционной системы на виртуальной машине. Дополнительные сведения о синтаксисе см. в статье [Specifying a Counter Path](https://msdn.microsoft.com/library/windows/desktop/aa373193.aspx) (Указание пути к счетчику).</span><span class="sxs-lookup"><span data-stu-id="18d12-250">The operating system on the virtual machine determines which performance counters you can track. For more information about syntax, see [Specifying a Counter Path](https://msdn.microsoft.com/library/windows/desktop/aa373193.aspx).</span></span>

### <a name="infrastructure-logs"></a><span data-ttu-id="18d12-251">Журналы инфраструктуры</span><span class="sxs-lookup"><span data-stu-id="18d12-251">Infrastructure logs</span></span>
<span data-ttu-id="18d12-252">Журналы инфраструктуры содержат сведения об инфраструктуре диагностики Azure и модулях RemoteAccess и RemoteForwarder. Если вы хотите собирать эти данные, установите флажок **Включить передачу журналов инфраструктуры**.</span><span class="sxs-lookup"><span data-stu-id="18d12-252">If you want to capture infrastructure logs, which contain information about the Azure diagnostic infrastructure, the RemoteAccess module, and the RemoteForwarder module, select the **Enable transfer of Infrastructure Logs** check box.</span></span> <span data-ttu-id="18d12-253">Чтобы увеличить или уменьшить количество минут, через которое журналы будут передаваться в учетную запись хранения, измените значение параметра «Период передачи (мин)».</span><span class="sxs-lookup"><span data-stu-id="18d12-253">You can increase or decrease the number of minutes when the logs are transferred to your storage account by changing the Transfer Period (min) value.</span></span>

  ![Журналы инфраструктуры диагностики](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758148.png)

  <span data-ttu-id="18d12-255">Дополнительные сведения см. в статье [Сбор данных журнала с помощью системы диагностики Azure](https://msdn.microsoft.com/library/azure/gg433048.aspx).</span><span class="sxs-lookup"><span data-stu-id="18d12-255">See [Collect Logging Data by Using Azure Diagnostics](https://msdn.microsoft.com/library/azure/gg433048.aspx) for more information.</span></span>

### <a name="log-directories"></a><span data-ttu-id="18d12-256">Каталоги журналов</span><span class="sxs-lookup"><span data-stu-id="18d12-256">Log directories</span></span>
<span data-ttu-id="18d12-257">В каталоги журналов собираются данные из выбранных вами папок, а также из каталогов, в которых хранятся журналы запросов к службам IIS и журналы неудачно завершенных запросов. Если вы хотите собирать эти данные, установите флажок **Включить перемещение каталогов журналов**.</span><span class="sxs-lookup"><span data-stu-id="18d12-257">If you want to capture log directories, which contain data collected from log directories for Internet Information Services (IIS) requests, failed requests, or folders that you choose, select the **Enable transfer of Log Directories** check box.</span></span> <span data-ttu-id="18d12-258">Чтобы увеличить или уменьшить количество минут, через которое журналы будут передаваться в учетную запись хранения, измените значение параметра **Период передачи (мин)** .</span><span class="sxs-lookup"><span data-stu-id="18d12-258">You can increase or decrease the number of minutes when the logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span>

<span data-ttu-id="18d12-259">С помощью флажков выберите те журналы, которые хотите собирать, например **журналы IIS** и журналы **неудачно завершенных запросов**.</span><span class="sxs-lookup"><span data-stu-id="18d12-259">You can select the boxes of the logs you want to collect, such as **IIS Logs** and **Failed Request** Logs.</span></span> <span data-ttu-id="18d12-260">Имена контейнеров хранилища задаются автоматически, но при желании вы можете их изменить.</span><span class="sxs-lookup"><span data-stu-id="18d12-260">Default storage container names are provided, but you can change the names if you want.</span></span>

<span data-ttu-id="18d12-261">Кроме того, вы можете собирать журналы из любой папки.</span><span class="sxs-lookup"><span data-stu-id="18d12-261">Also, you can capture logs from any folder.</span></span> <span data-ttu-id="18d12-262">Для этого укажите путь к ней в разделе **Журнал из абсолютного каталога** и нажмите кнопку **Добавить каталог**.</span><span class="sxs-lookup"><span data-stu-id="18d12-262">Just specify the path in the **Log from Absolute Directory** section and then choose the **Add Directory** button.</span></span> <span data-ttu-id="18d12-263">Журналы будут сохраняться в указанные контейнеры.</span><span class="sxs-lookup"><span data-stu-id="18d12-263">The logs will be captured to the specified containers.</span></span>

  ![Каталоги журналов](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796665.png)

### <a name="etw-logs"></a><span data-ttu-id="18d12-265">Журналы трассировки событий Windows</span><span class="sxs-lookup"><span data-stu-id="18d12-265">ETW logs</span></span>
<span data-ttu-id="18d12-266">Если вы используете [трассировку событий для Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803\(v=vs.85\).aspx) (ETW) и хотите собирать журналы ETW, установите флажок **Включить перемещение журналов трассировки событий Windows**.</span><span class="sxs-lookup"><span data-stu-id="18d12-266">If you use [Event Tracing for Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803\(v=vs.85\).aspx) (ETW) and want to capture ETW logs, select the **Enable transfer of ETW Logs** check box.</span></span> <span data-ttu-id="18d12-267">Чтобы увеличить или уменьшить количество минут, через которое журналы будут передаваться в учетную запись хранения, измените значение параметра **Период передачи (мин)** .</span><span class="sxs-lookup"><span data-stu-id="18d12-267">You can increase or decrease the number of minutes when the logs are transferred to your storage account by changing the **Transfer Period (min)** value.</span></span>

<span data-ttu-id="18d12-268">События записываются из указанных вами источников событий и манифестов событий.</span><span class="sxs-lookup"><span data-stu-id="18d12-268">The events are captured from event sources and event manifests that you specify.</span></span> <span data-ttu-id="18d12-269">Чтобы указать источник событий, введите его имя в разделе **Источники событий**, а затем нажмите кнопку **Добавить источник событий**.</span><span class="sxs-lookup"><span data-stu-id="18d12-269">To specify an event source, enter a name in the **Event Sources** section and then choose the **Add Event Source** button.</span></span> <span data-ttu-id="18d12-270">Аналогичным образом вы можете указать манифест событий в разделе **Манифесты событий** и нажать кнопку **Добавить манифест событий**.</span><span class="sxs-lookup"><span data-stu-id="18d12-270">Similarly, you can specify an event manifest in the **Event Manifests** section and then choose the **Add Event Manifest** button.</span></span>

  ![Журналы трассировки событий Windows](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766025.png)

  <span data-ttu-id="18d12-272">ASP.NET поддерживает структуру ETW с использованием классов в пространстве имен [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110).</span><span class="sxs-lookup"><span data-stu-id="18d12-272">The ETW framework is supported in ASP.NET through classes in the [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110) namespace.</span></span> <span data-ttu-id="18d12-273">Пространство имен Microsoft.WindowsAzure.Diagnostics, которое наследует и расширяет стандартные классы [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110), позволяет использовать [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110) как платформу ведения журналов в среде Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-273">The Microsoft.WindowsAzure.Diagnostics namespace, which inherits from and extends standard [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110) classes, enables the use of [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110) as a logging framework in the Azure environment.</span></span> <span data-ttu-id="18d12-274">Дополнительные сведения см. в статьях [Управление ведением журналов и трассировкой в Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) и [Включение диагностики в облачных службах и виртуальных машинах Azure](cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="18d12-274">For more information, see [Take Control of Logging and Tracing in Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) and [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](cloud-services/cloud-services-dotnet-diagnostics.md).</span></span>

### <a name="crash-dumps"></a><span data-ttu-id="18d12-275">Аварийные дампы</span><span class="sxs-lookup"><span data-stu-id="18d12-275">Crash dumps</span></span>
<span data-ttu-id="18d12-276">Если вы хотите собирать сведения об аварийном завершении работы экземпляра роли, установите флажок **Включить перемещение аварийных дампов** .</span><span class="sxs-lookup"><span data-stu-id="18d12-276">If you want to capture information about when a role instance crashes, select the **Enable transfer of Crash Dumps** check box.</span></span> <span data-ttu-id="18d12-277">Поскольку ASP.NET обрабатывает большинство исключений, обычно это полезно только для рабочих ролей. Чтобы увеличить или уменьшить процент выделяемого под аварийные дампы места в хранилище, измените значение параметра **Квота каталога (%)**.</span><span class="sxs-lookup"><span data-stu-id="18d12-277">(Because ASP.NET handles most exceptions, this is generally useful only for worker roles.) You can increase or decrease the percentage of storage space devoted to the crash dumps by changing the **Directory Quota (%)** value.</span></span> <span data-ttu-id="18d12-278">Вы можете изменить контейнер хранения аварийных дампов, а также выбрать, какой дамп нужно сохранять: **полный** или **мини**.</span><span class="sxs-lookup"><span data-stu-id="18d12-278">You can change the storage container where the crash dumps are stored, and you can select whether you want to capture a **Full** or **Mini** dump.</span></span>

<span data-ttu-id="18d12-279">В списке указаны все отслеживаемые процессы.</span><span class="sxs-lookup"><span data-stu-id="18d12-279">The processes currently being tracked are listed.</span></span> <span data-ttu-id="18d12-280">Установите флажки для тех процессов, данные о которых вы хотите собирать.</span><span class="sxs-lookup"><span data-stu-id="18d12-280">Select the check boxes for the processes that you want to capture.</span></span> <span data-ttu-id="18d12-281">Чтобы добавить в список другой процесс, введите имя процесса и нажмите кнопку **Добавить процесс** .</span><span class="sxs-lookup"><span data-stu-id="18d12-281">To add another process to the list, enter the process name and then choose the **Add Process** button.</span></span>

  ![Аварийные дампы](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766026.png)

  <span data-ttu-id="18d12-283">Дополнительные сведения см. в статьях [Управление ведением журналов и трассировкой в Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) и [Microsoft Azure Diagnostics Part 4: Custom Logging Components and Azure Diagnostics 1.3 Changes](http://justazure.com/microsoft-azure-diagnostics-part-4-custom-logging-components-azure-diagnostics-1-3-changes/) (Система диагностики Microsoft Azure, часть 4. Настраиваемые компоненты ведения журналов и изменения в системе диагностики Azure 1.3).</span><span class="sxs-lookup"><span data-stu-id="18d12-283">See [Take Control of Logging and Tracing in Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) and [Microsoft Azure Diagnostics Part 4: Custom Logging Components and Azure Diagnostics 1.3 Changes](http://justazure.com/microsoft-azure-diagnostics-part-4-custom-logging-components-azure-diagnostics-1-3-changes/) for more information.</span></span>

## <a name="view-the-diagnostics-data"></a><span data-ttu-id="18d12-284">Просмотр диагностических данных</span><span class="sxs-lookup"><span data-stu-id="18d12-284">View the diagnostics data</span></span>
<span data-ttu-id="18d12-285">Собранные диагностические данные для облачной службы или виртуальной машины можно просматривать.</span><span class="sxs-lookup"><span data-stu-id="18d12-285">After you’ve collected the diagnostics data for a cloud service or a virtual machine, you can view it.</span></span>

### <a name="to-view-cloud-service-diagnostics-data"></a><span data-ttu-id="18d12-286">Просмотр диагностических данных облачной службы</span><span class="sxs-lookup"><span data-stu-id="18d12-286">To view cloud service diagnostics data</span></span>
1. <span data-ttu-id="18d12-287">Разверните и запустите облачную службу обычным образом.</span><span class="sxs-lookup"><span data-stu-id="18d12-287">Deploy your cloud service as usual and then run it.</span></span>
2. <span data-ttu-id="18d12-288">Диагностические данные можно просмотреть в виде отчета, который создает Visual Studio, или в виде таблиц в учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="18d12-288">You can view the diagnostics data in either a report that Visual Studio generates or tables in your storage account.</span></span> <span data-ttu-id="18d12-289">Чтобы просмотреть данные в отчете, откройте **Cloud Explorer** или **обозреватель сервера**, затем откройте контекстное меню интересующего вас узла и выберите **View Diagnostic Data** (Просмотреть диагностические данные).</span><span class="sxs-lookup"><span data-stu-id="18d12-289">To view the data in a report, open **Cloud Explorer** or **Server Explorer**, open the shortcut menu of the node for the role that interests you, and then choose **View Diagnostic Data**.</span></span>
   
    ![Просмотреть данные диагностики](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC748912.png)
   
    <span data-ttu-id="18d12-291">Появится отчет по имеющимся данным.</span><span class="sxs-lookup"><span data-stu-id="18d12-291">A report that shows the available data appears.</span></span>
   
    ![Отчет о системе диагностики Microsoft Azure в Visual Studio](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796666.png)
   
    <span data-ttu-id="18d12-293">Если в нем не содержатся самые свежие данные, вам следует дождаться завершения очередного периода передачи.</span><span class="sxs-lookup"><span data-stu-id="18d12-293">If the most recent data doesn't appear, you might have to wait for the transfer period to elapse.</span></span>
   
    <span data-ttu-id="18d12-294">Для немедленного обновления данных щелкните ссылку **Обновить**. Вы можете также выбрать интервал автоматического обновления данных из раскрывающегося списка **Автообновление**.</span><span class="sxs-lookup"><span data-stu-id="18d12-294">Choose the **Refresh** link to immediately update the data, or choose an interval in the **Auto-Refresh** dropdown list box to have the data updated automatically.</span></span> <span data-ttu-id="18d12-295">Чтобы экспортировать данные об ошибках, нажмите кнопку **Экспорт в CSV**. Будет создан CSV-файл, который вы сможете открыть в виде электронной таблицы.</span><span class="sxs-lookup"><span data-stu-id="18d12-295">To export the error data, choose the **Export to CSV** button to create a comma-separated value file you can open in a spreadsheet.</span></span>
   
    <span data-ttu-id="18d12-296">В **Cloud Explorer** или **обозревателе сервера** откройте учетную запись хранения, связанную с развертыванием.</span><span class="sxs-lookup"><span data-stu-id="18d12-296">In **Cloud Explorer** or **Server Explorer**, open the storage account that's associated with the deployment.</span></span>
3. <span data-ttu-id="18d12-297">Откройте диагностические таблицы в средстве просмотра таблиц и изучите собранные данные.</span><span class="sxs-lookup"><span data-stu-id="18d12-297">Open the diagnostics tables in the table viewer, and then review the data that you collected.</span></span> <span data-ttu-id="18d12-298">Для просмотра пользовательских журналов и журналов служб IIS вы можете открыть контейнер больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="18d12-298">For IIS logs and custom logs, you can open a blob container.</span></span> <span data-ttu-id="18d12-299">В следующей таблице вы найдете имена таблиц или контейнеров больших двоичных объектов, которые содержат нужные данные.</span><span class="sxs-lookup"><span data-stu-id="18d12-299">By reviewing the following table, you can find the table or blob container that contains the data that interests you.</span></span> <span data-ttu-id="18d12-300">В дополнение к данным соответствующего журнала таблицы содержат поля EventTickCount, DeploymentId, Role и RoleInstance. Они помогут вам понять, какая виртуальная машина и роль создали эти данные, а также когда эти данные были созданы.</span><span class="sxs-lookup"><span data-stu-id="18d12-300">In addition to the data for that log file, the table entries contain EventTickCount, DeploymentId, Role, and RoleInstance to help you identify what virtual machine and role generated the data and when.</span></span> 
   
   | <span data-ttu-id="18d12-301">Диагностические данные</span><span class="sxs-lookup"><span data-stu-id="18d12-301">Diagnostic data</span></span> | <span data-ttu-id="18d12-302">Описание</span><span class="sxs-lookup"><span data-stu-id="18d12-302">Description</span></span> | <span data-ttu-id="18d12-303">Расположение</span><span class="sxs-lookup"><span data-stu-id="18d12-303">Location</span></span> |
   | --- | --- | --- |
   | <span data-ttu-id="18d12-304">Журналы приложений</span><span class="sxs-lookup"><span data-stu-id="18d12-304">Application Logs</span></span> |<span data-ttu-id="18d12-305">Журналы, которые ваш код создает при вызове класса System.Diagnostics.Trace.</span><span class="sxs-lookup"><span data-stu-id="18d12-305">Logs that your code generates by calling methods of the System.Diagnostics.Trace class.</span></span> |<span data-ttu-id="18d12-306">WADLogsTable</span><span class="sxs-lookup"><span data-stu-id="18d12-306">WADLogsTable</span></span> |
   | <span data-ttu-id="18d12-307">Журналы событий</span><span class="sxs-lookup"><span data-stu-id="18d12-307">Event Logs</span></span> |<span data-ttu-id="18d12-308">Эти данные собираются из журналов событий Windows на виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="18d12-308">This data is from the Windows event logs on the virtual machines.</span></span> <span data-ttu-id="18d12-309">В этих журналах хранится информация ОС Windows, но приложения и службы также могут записывать в них ошибки или данные.</span><span class="sxs-lookup"><span data-stu-id="18d12-309">Windows stores information in these logs, but applications and services also use them to report errors or log information.</span></span> |<span data-ttu-id="18d12-310">WADWindowsEventLogsTable</span><span class="sxs-lookup"><span data-stu-id="18d12-310">WADWindowsEventLogsTable</span></span> |
   | <span data-ttu-id="18d12-311">Счетчики производительности</span><span class="sxs-lookup"><span data-stu-id="18d12-311">Performance Counters</span></span> |<span data-ttu-id="18d12-312">Вы можете собирать данные с любого счетчика производительности, который доступен на вашей виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="18d12-312">You can collect data on any performance counter that’s available on the virtual machine.</span></span> <span data-ttu-id="18d12-313">Операционная система предоставляет различные счетчики, которые позволяют изучать всевозможную статистику, например использование памяти и загруженность процессора.</span><span class="sxs-lookup"><span data-stu-id="18d12-313">The operating system provides performance counters, which include many statistics such as memory usage and processor time.</span></span> |<span data-ttu-id="18d12-314">WADPerformanceCountersTable</span><span class="sxs-lookup"><span data-stu-id="18d12-314">WADPerformanceCountersTable</span></span> |
   | <span data-ttu-id="18d12-315">Журналы инфраструктуры</span><span class="sxs-lookup"><span data-stu-id="18d12-315">Infrastructure Logs</span></span> |<span data-ttu-id="18d12-316">Эти журналы создает сама инфраструктура диагностики.</span><span class="sxs-lookup"><span data-stu-id="18d12-316">These logs are generated from the diagnostics infrastructure itself.</span></span> |<span data-ttu-id="18d12-317">WADDiagnosticInfrastructureLogsTable</span><span class="sxs-lookup"><span data-stu-id="18d12-317">WADDiagnosticInfrastructureLogsTable</span></span> |
   | <span data-ttu-id="18d12-318">Журналы IIS</span><span class="sxs-lookup"><span data-stu-id="18d12-318">IIS Logs</span></span> |<span data-ttu-id="18d12-319">В эти журналы записываются веб-запросы.</span><span class="sxs-lookup"><span data-stu-id="18d12-319">These logs record web requests.</span></span> <span data-ttu-id="18d12-320">Если в облачную службу приходит очень много запросов, эти журналы могут быть довольно длинными, поэтому собирать и хранить их следует только при необходимости.</span><span class="sxs-lookup"><span data-stu-id="18d12-320">If your cloud service gets a significant amount of traffic, these logs can be quite lengthy, so you should collect and store this data only when you need it.</span></span> |<span data-ttu-id="18d12-321">Журналы неудачных запросов можно найти в контейнере больших двоичных объектов в папке wad-iis-failedreqlogs, расположенной в каталоге конкретного развертывания, роли и экземпляра.</span><span class="sxs-lookup"><span data-stu-id="18d12-321">You can find failed-request logs in the blob container under wad-iis-failedreqlogs under a path for that deployment, role, and instance.</span></span> <span data-ttu-id="18d12-322">Полные журналы вы найдете в папке wad-iis-logfiles.</span><span class="sxs-lookup"><span data-stu-id="18d12-322">You can find complete logs under wad-iis-logfiles.</span></span> <span data-ttu-id="18d12-323">В таблицу WADDirectories вносятся записи для каждого файла.</span><span class="sxs-lookup"><span data-stu-id="18d12-323">Entries for each file are made in the WADDirectories table.</span></span> |
   | <span data-ttu-id="18d12-324">Аварийные дампы</span><span class="sxs-lookup"><span data-stu-id="18d12-324">Crash dumps</span></span> |<span data-ttu-id="18d12-325">Эта информация содержит двоичные образы процесса облачной службы (обычно рабочей роли).</span><span class="sxs-lookup"><span data-stu-id="18d12-325">This information provides binary images of your cloud service’s process (typically a worker role).</span></span> |<span data-ttu-id="18d12-326">Контейнер больших двоичных объектов wad-crush-dumps</span><span class="sxs-lookup"><span data-stu-id="18d12-326">wad-crush-dumps blob container</span></span> |
   | <span data-ttu-id="18d12-327">Файлы пользовательских журналов</span><span class="sxs-lookup"><span data-stu-id="18d12-327">Custom log files</span></span> |<span data-ttu-id="18d12-328">Настроенные вами журналы.</span><span class="sxs-lookup"><span data-stu-id="18d12-328">Logs of data that you predefined.</span></span> |<span data-ttu-id="18d12-329">Вы можете в коде задать расположение файлов пользовательских журналов в своей учетной записи хранения,</span><span class="sxs-lookup"><span data-stu-id="18d12-329">You can specify in code the location of custom log files in your storage account.</span></span> <span data-ttu-id="18d12-330">например указать для них пользовательский контейнер больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="18d12-330">For example, you can specify a custom blob container.</span></span> |
4. <span data-ttu-id="18d12-331">Если данные любого типа усекаются, вы можете попробовать увеличить размер буфера для этого типа данных или уменьшить интервал между передачами данных из виртуальной машины в учетную запись хранения.</span><span class="sxs-lookup"><span data-stu-id="18d12-331">If data of any type is truncated, you can try increasing the buffer for that data type or shortening the interval between transfers of data from the virtual machine to your storage account.</span></span>
5. <span data-ttu-id="18d12-332">Время от времени удаляйте данные из учетной записи хранения, чтобы снизить общие затраты на хранение. Удалять данные не обязательно.</span><span class="sxs-lookup"><span data-stu-id="18d12-332">(optional) Purge data from the storage account occasionally to reduce overall storage costs.</span></span>
6. <span data-ttu-id="18d12-333">Когда вы выполняете полное развертывание, Azure обновляет файл diagnostics.cscfg (diagnostics.wadcfgx в Azure SDK 2.5) и облачная служба принимает все изменения, внесенные в конфигурацию диагностики.</span><span class="sxs-lookup"><span data-stu-id="18d12-333">When you do a full deployment, the diagnostics.cscfg file (.wadcfgx for Azure SDK 2.5) is updated in Azure, and your cloud service picks up any changes to your diagnostics configuration.</span></span> <span data-ttu-id="18d12-334">Если же вы обновляете существующее развертывание, Azure не обновляет CSCFG-файл.</span><span class="sxs-lookup"><span data-stu-id="18d12-334">If you, instead, update an existing deployment, the .cscfg file isn’t updated in Azure.</span></span> <span data-ttu-id="18d12-335">Но вы и в этом случае можете изменить конфигурацию диагностики, выполнив действия, описанные в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="18d12-335">You can still change diagnostics settings, though, by following the steps in the next section.</span></span> <span data-ttu-id="18d12-336">Дополнительные сведения о полном развертывании и обновлении существующего развертывания см. в статье [Мастер публикации приложений Azure](vs-azure-tools-publish-azure-application-wizard.md).</span><span class="sxs-lookup"><span data-stu-id="18d12-336">For more information about performing a full deployment and updating an existing deployment, see [Publish Azure Application Wizard](vs-azure-tools-publish-azure-application-wizard.md).</span></span>

### <a name="to-view-virtual-machine-diagnostics-data"></a><span data-ttu-id="18d12-337">Просмотр диагностических данных виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="18d12-337">To view virtual machine diagnostics data</span></span>
1. <span data-ttu-id="18d12-338">Выберите в контекстном меню виртуальной машины пункт **Просмотреть данные диагностики**.</span><span class="sxs-lookup"><span data-stu-id="18d12-338">On the shortcut menu for the virtual machine, choose **View Diagnostics Data**.</span></span>
   
    ![Просмотр диагностических данных на виртуальной машине Azure](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766027.png)
   
    <span data-ttu-id="18d12-340">Откроется диалоговое окно **Сводка диагностики** .</span><span class="sxs-lookup"><span data-stu-id="18d12-340">This opens the **Diagnostics summary** window.</span></span>
   
    ![Сводка по диагностическим данным виртуальной машины](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796667.png)  
   
    <span data-ttu-id="18d12-342">Если в нем не содержатся самые свежие данные, вам следует дождаться завершения очередного периода передачи.</span><span class="sxs-lookup"><span data-stu-id="18d12-342">If the most recent data doesn't appear, you might have to wait for the transfer period to elapse.</span></span>
   
    <span data-ttu-id="18d12-343">Для немедленного обновления данных щелкните ссылку **Обновить**. Вы можете также выбрать интервал автоматического обновления данных из раскрывающегося списка **Автообновление**.</span><span class="sxs-lookup"><span data-stu-id="18d12-343">Choose the **Refresh** link to immediately update the data, or choose an interval in the **Auto-Refresh** dropdown list box to have the data updated automatically.</span></span> <span data-ttu-id="18d12-344">Чтобы экспортировать данные об ошибках, нажмите кнопку **Экспорт в CSV**. Будет создан CSV-файл, который вы сможете открыть в виде электронной таблицы.</span><span class="sxs-lookup"><span data-stu-id="18d12-344">To export the error data, choose the **Export to CSV** button to create a comma-separated value file you can open in a spreadsheet.</span></span>

## <a name="configure-cloud-service-diagnostics-after-deployment"></a><span data-ttu-id="18d12-345">Настройка диагностики облачной службы после развертывания</span><span class="sxs-lookup"><span data-stu-id="18d12-345">Configure cloud service diagnostics after deployment</span></span>
<span data-ttu-id="18d12-346">Если вы изучаете проблему, возникшую в уже запущенной облачной службе, вам могут потребоваться новые данные, которые не были указаны перед первоначальным развертыванием этой роли.</span><span class="sxs-lookup"><span data-stu-id="18d12-346">If you're investigating a problem with a cloud service that already running, you might want to collect data that you didn't specify before you originally deployed the role.</span></span> <span data-ttu-id="18d12-347">В этом случае вы можете начать сбор новых данных, изменив настройки в обозревателе сервера.</span><span class="sxs-lookup"><span data-stu-id="18d12-347">In this case, you can start to collect that data by using the settings in Server Explorer.</span></span> <span data-ttu-id="18d12-348">Вы можете настроить диагностику для одного или всех экземпляров роли. В первом случае следует открыть диалоговое окно настройки диагностики из контекстного меню для экземпляра, а во втором — для роли.</span><span class="sxs-lookup"><span data-stu-id="18d12-348">You can configure diagnostics for either a single instance or all the instances in a role, depending on whether you open the Diagnostics Configuration dialog box from the shortcut menu for the instance or the role.</span></span> <span data-ttu-id="18d12-349">Если вы изменяете настройки в узле роли, все вносимые изменения применяются ко всем экземплярам.</span><span class="sxs-lookup"><span data-stu-id="18d12-349">If you configure the role node, any changes apply to all instances.</span></span> <span data-ttu-id="18d12-350">Если вы изменяете настройки в узле экземпляра, все вносимые изменения применяются только к этому экземпляру.</span><span class="sxs-lookup"><span data-stu-id="18d12-350">If you configure the instance node, any changes apply to that instance only.</span></span>

### <a name="to-configure-diagnostics-for-a-running-cloud-service"></a><span data-ttu-id="18d12-351">Настройка диагностики для работающей облачной службы</span><span class="sxs-lookup"><span data-stu-id="18d12-351">To configure diagnostics for a running cloud service</span></span>
1. <span data-ttu-id="18d12-352">В обозревателе сервера разверните узел **Облачные службы** , затем разверните в нем нужные узлы, чтобы найти анализируемую роль или экземпляр (или и то, и другое).</span><span class="sxs-lookup"><span data-stu-id="18d12-352">In Server Explorer, expand the **Cloud Services** node, and then expand nodes to locate the role or instance that you want to investigate or both.</span></span>
   
    ![Настройка системы диагностики](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC748913.png)
2. <span data-ttu-id="18d12-354">В контекстном меню узла экземпляра или роли выберите пункт **Обновить параметры диагностики**, а затем выберите параметры диагностики, которые желаете собирать.</span><span class="sxs-lookup"><span data-stu-id="18d12-354">On the shortcut menu for an instance node or a role node, choose **Update Diagnostics Settings**, and then choose the diagnostic settings that you want to collect.</span></span>
   
    <span data-ttu-id="18d12-355">Сведения о параметрах конфигурации см. в разделе **Настройка источников диагностических данных** в этой статье.</span><span class="sxs-lookup"><span data-stu-id="18d12-355">For information about the configuration settings, see **Configure diagnostics data sources** in this topic.</span></span> <span data-ttu-id="18d12-356">Информацию о просмотре диагностических данных см. в разделе **Просмотр диагностических данных** в этой статье.</span><span class="sxs-lookup"><span data-stu-id="18d12-356">For information about how to view the diagnostics data, see **View the diagnostics data** in this topic.</span></span>
   
    <span data-ttu-id="18d12-357">Когда вы изменяете настройки сбора данных в **обозревателе сервера**, эти изменения остаются в силе до следующего полного развертывания облачной службы.</span><span class="sxs-lookup"><span data-stu-id="18d12-357">If you change data collection in **Server Explorer**, these changes remain in effect until you fully redeploy your cloud service.</span></span> <span data-ttu-id="18d12-358">Если вы используете стандартные параметры публикации, внесенные изменения сохранятся, так как по умолчанию при публикации выполняется обновление существующего развертывания, а не полное повторное развертывание.</span><span class="sxs-lookup"><span data-stu-id="18d12-358">If you use the default publish settings, the changes are not overwritten, since the default publish setting is to update the existing deployment, rather than do a full redeployment.</span></span> <span data-ttu-id="18d12-359">Чтобы очистить эти настройки во время развертывания, перейдите в мастере публикации на вкладку **Дополнительные параметры** и снимите флажок **Обновление развертывания**.</span><span class="sxs-lookup"><span data-stu-id="18d12-359">To make sure the settings clear at deployment time, go to the **Advanced Settings** tab in the Publish wizard and clear the **Deployment update** checkbox.</span></span> <span data-ttu-id="18d12-360">При повторном развертывании со снятым флажком параметры снова принимают значения, заданные для роли в WADCFGX- или WADCFG-файле через редактор свойств.</span><span class="sxs-lookup"><span data-stu-id="18d12-360">When you redeploy with that checkbox cleared, the settings revert to those in the .wadcfgx (or .wadcfg) file as set through the Properties editor for the role.</span></span> <span data-ttu-id="18d12-361">Если вы обновляете развертывание, Azure сохраняет старые настройки.</span><span class="sxs-lookup"><span data-stu-id="18d12-361">If you update your deployment, Azure keeps the old settings.</span></span>

## <a name="troubleshoot-azure-cloud-service-issues"></a><span data-ttu-id="18d12-362">Устранение неполадок облачной службы Azure</span><span class="sxs-lookup"><span data-stu-id="18d12-362">Troubleshoot Azure cloud service issues</span></span>
<span data-ttu-id="18d12-363">Если вы столкнетесь с проблемами в проектах облачных служб (например, роль «зависает» в состоянии «занято», постоянно перезапускается или выдает внутреннюю ошибку сервера), вы можете использовать несколько инструментов и методов для диагностики и устранения этих проблем.</span><span class="sxs-lookup"><span data-stu-id="18d12-363">If you experience problems with your cloud service projects, such as a role that gets stuck in a "busy" status, repeatedly recycles, or throws an internal server error, there are tools and techniques you can use to diagnose and fix these problems.</span></span> <span data-ttu-id="18d12-364">Конкретные примеры распространенных проблем и решений, а также общие сведения о концепциях и инструментах диагностики и устранения ошибок вы найдете в блоге [Данные диагностики для вычислительных сред Microsoft Azure PaaS](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span><span class="sxs-lookup"><span data-stu-id="18d12-364">For specific examples of common problems and solutions, as well as an overview of the concepts and tools used to diagnose and fix such errors, see [Azure PaaS Compute Diagnostics Data](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span></span>

## <a name="q--a"></a><span data-ttu-id="18d12-365">Вопросы и ответы</span><span class="sxs-lookup"><span data-stu-id="18d12-365">Q & A</span></span>
<span data-ttu-id="18d12-366">**Что такое размер буфера и каким он должен быть?**</span><span class="sxs-lookup"><span data-stu-id="18d12-366">**What is the buffer size, and how large should it be?**</span></span>

<span data-ttu-id="18d12-367">Для каждого экземпляра виртуальной машины существуют квоты, которые ограничивают объем хранения диагностических данных в локальной файловой системе.</span><span class="sxs-lookup"><span data-stu-id="18d12-367">On each virtual machine instance, quotas limit how much diagnostic data can be stored on the local file system.</span></span> <span data-ttu-id="18d12-368">Кроме того, вы определяете размер буфера для каждого доступного типа диагностических данных.</span><span class="sxs-lookup"><span data-stu-id="18d12-368">In addition, you specify a buffer size for each type of diagnostic data that's available.</span></span> <span data-ttu-id="18d12-369">Этот буфер выполняет роль индивидуальной квоты для соответствующего типа данных.</span><span class="sxs-lookup"><span data-stu-id="18d12-369">This buffer size acts like an individual quota for that type of data.</span></span> <span data-ttu-id="18d12-370">В нижней части диалогового окна вы можете найти общую квоту и объем свободной памяти.</span><span class="sxs-lookup"><span data-stu-id="18d12-370">By checking the bottom of the dialog box, you can determine the overall quota and the amount of memory that remains.</span></span> <span data-ttu-id="18d12-371">Если вы укажете большие размеры буферов или большее количество типов данных, можно превысить общую квоту.</span><span class="sxs-lookup"><span data-stu-id="18d12-371">If you specify larger buffers or more types of data, you'll approach the overall quota.</span></span> <span data-ttu-id="18d12-372">Общую квоту вы можете изменить, отредактировав файл конфигурации diagnostics.wadcfg (или diagnostics.wadcfgx).</span><span class="sxs-lookup"><span data-stu-id="18d12-372">You can change the overall quota by modifying the diagnostics.wadcfg/.wadcfgx configuration file.</span></span> <span data-ttu-id="18d12-373">Диагностические данные хранятся в той же файловой системе, что и данные приложения, поэтому не следует увеличивать общую квоту для диагностики, если приложение использует много места на диске.</span><span class="sxs-lookup"><span data-stu-id="18d12-373">The diagnostics data is stored on the same filesystem as your application’s data, so if your application uses a lot of disk space, you shouldn’t increase the overall diagnostics quota.</span></span>

<span data-ttu-id="18d12-374">**Что такое период передачи и каким он должен быть?**</span><span class="sxs-lookup"><span data-stu-id="18d12-374">**What is the transfer period, and how long should it be?**</span></span>

<span data-ttu-id="18d12-375">Период передачи определяет количество времени между последовательными сборами данных.</span><span class="sxs-lookup"><span data-stu-id="18d12-375">The transfer period is the amount of time that elapses between data captures.</span></span> <span data-ttu-id="18d12-376">По окончании каждого периода передачи система диагностики перемещает данные из локальной файловой системы виртуальной машины в таблицы в вашей учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="18d12-376">After each transfer period, data is moved from the local filesystem on a virtual machine to tables in your storage account.</span></span> <span data-ttu-id="18d12-377">Если до окончания периода передачи объем собираемых данных превысит квоту, старые данные удаляются.</span><span class="sxs-lookup"><span data-stu-id="18d12-377">If the amount of data that's collected exceeds the quota before the end of a transfer period, older data is discarded.</span></span> <span data-ttu-id="18d12-378">Если вы теряете данные из-за превышения размера буфера или общей квоты, советуем уменьшить период передачи.</span><span class="sxs-lookup"><span data-stu-id="18d12-378">You might want to decrease the transfer period if you're losing data because your data exceeds the buffer size or the overall quota.</span></span>

<span data-ttu-id="18d12-379">**Какой часовой пояс используется для отметок времени?**</span><span class="sxs-lookup"><span data-stu-id="18d12-379">**What time zone are the time stamps in?**</span></span>

<span data-ttu-id="18d12-380">В отметках времени указан локальный часовой пояс того центра обработки данных, в котором размещена ваша облачная служба.</span><span class="sxs-lookup"><span data-stu-id="18d12-380">The time stamps are in the local time zone of the data center that hosts your cloud service.</span></span> <span data-ttu-id="18d12-381">В таблицах журналов есть такие три столбца отметки времени:</span><span class="sxs-lookup"><span data-stu-id="18d12-381">The following three timestamp columns in the log tables are used.</span></span>

* <span data-ttu-id="18d12-382">**PreciseTimeStamp** — отметка времени событий ETW.</span><span class="sxs-lookup"><span data-stu-id="18d12-382">**PreciseTimeStamp** is the ETW timestamp of the event.</span></span> <span data-ttu-id="18d12-383">Это время регистрации события клиентом.</span><span class="sxs-lookup"><span data-stu-id="18d12-383">That is, the time the event is logged from the client.</span></span>
* <span data-ttu-id="18d12-384">**TIMESTAMP** представляет собой PreciseTimeStamp с округлением до ближайшей границы периода передачи.</span><span class="sxs-lookup"><span data-stu-id="18d12-384">**TIMESTAMP** is PreciseTimeStamp rounded down to the upload frequency boundary.</span></span> <span data-ttu-id="18d12-385">Например, если вы используете период передачи 5 минут, а событие регистрируется в 00:17:12, в поле TIMETAMP будет установлено значение 00:15:00.</span><span class="sxs-lookup"><span data-stu-id="18d12-385">So, if your upload frequency is 5 minutes and the event time 00:17:12, TIMESTAMP will be 00:15:00.</span></span>
* <span data-ttu-id="18d12-386">**Timestamp** — это отметка времени создания записи в таблице Azure.</span><span class="sxs-lookup"><span data-stu-id="18d12-386">**Timestamp** is the timestamp at which the entity was created in the Azure table.</span></span>

<span data-ttu-id="18d12-387">**Как снизить затраты на сбор диагностической информации?**</span><span class="sxs-lookup"><span data-stu-id="18d12-387">**How do I manage costs when collecting diagnostic information?**</span></span>

<span data-ttu-id="18d12-388">По умолчанию выбраны значения параметров (**Уровень ведения журнала** имеет значение **Ошибка**, а **Период передачи** имеет значение **1 минута**), которые обеспечивают минимальные затраты.</span><span class="sxs-lookup"><span data-stu-id="18d12-388">The default settings (**Log level** set to **Error** and **Transfer period** set to **1 minute**) are designed to minimize cost.</span></span> <span data-ttu-id="18d12-389">Затраты на вычисления увеличиваются, если вы собираете больше диагностических данных или уменьшаете период передачи.</span><span class="sxs-lookup"><span data-stu-id="18d12-389">Your compute costs will increase if you collect more diagnostic data or decrease the transfer period.</span></span> <span data-ttu-id="18d12-390">Не следует собирать больше данных, чем вам действительно нужно. Также не забудьте отключить сбор данных, когда это вам не нужно.</span><span class="sxs-lookup"><span data-stu-id="18d12-390">Don’t collect more data than you need, and don’t forget to disable data collection when you no longer need it.</span></span> <span data-ttu-id="18d12-391">Вы всегда можете включить эту функцию снова, даже во время выполнения, как показано в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="18d12-391">You can always enable it again, even at runtime, as shown in the previous section.</span></span>

<span data-ttu-id="18d12-392">**Как собирать журналы неудачных запросов службы IIS?**</span><span class="sxs-lookup"><span data-stu-id="18d12-392">**How do I collect failed-request logs from IIS?**</span></span>

<span data-ttu-id="18d12-393">По умолчанию службы IIS не собирают журналы неудачных запросов.</span><span class="sxs-lookup"><span data-stu-id="18d12-393">By default, IIS doesn’t collect failed-request logs.</span></span> <span data-ttu-id="18d12-394">Чтобы настроить сбор этих данных в службах IIS, измените файл web.config для веб-роли.</span><span class="sxs-lookup"><span data-stu-id="18d12-394">You can configure IIS to collect them if you edit the web.config file for your web role.</span></span>

<span data-ttu-id="18d12-395">**Я не получаю сведения о трассировке от методов RoleEntryPoint, например OnStart. Что не так?**</span><span class="sxs-lookup"><span data-stu-id="18d12-395">**I’m not getting trace information from RoleEntryPoint methods like OnStart. What’s wrong?**</span></span>

<span data-ttu-id="18d12-396">Методы RoleEntryPoint вызываются в контексте WAIISHost.exe, а не IIS.</span><span class="sxs-lookup"><span data-stu-id="18d12-396">The methods of RoleEntryPoint are called in the context of WAIISHost.exe, not IIS.</span></span> <span data-ttu-id="18d12-397">Таким образом, к ним не применяются настройки конфигурации из файла web.config, который обычно включает трассировку.</span><span class="sxs-lookup"><span data-stu-id="18d12-397">Therefore, the configuration information in web.config that normally enables tracing doesn’t apply.</span></span> <span data-ttu-id="18d12-398">Чтобы устранить эту проблему, добавьте в проект веб-роли CONFIG-файл с именем, которое соответствует имени выходной сборки, в которой размещен код RoleEntryPoint.</span><span class="sxs-lookup"><span data-stu-id="18d12-398">To resolve this issue, add a .config file to your web role project, and name the file to match the output assembly that contains the RoleEntryPoint code.</span></span> <span data-ttu-id="18d12-399">В проекте веб-роли по умолчанию этот файл должен называться WAIISHost.exe.config. Добавьте в этот файл следующие строки.</span><span class="sxs-lookup"><span data-stu-id="18d12-399">In the default web role project, the name of the .config file would be WAIISHost.exe.config. Then add the following lines to this file:</span></span>

```
<system.diagnostics>
  <trace>
      <listeners>
          <add name “AzureDiagnostics” type=”Microsoft.WindowsAzure.Diagnostics.DiagnosticMonitorTraceListener”>
              <filter type=”” />
          </add>
      </listeners>
  </trace>
</system.diagnostics>
```

<span data-ttu-id="18d12-400">Теперь в окне **Свойства** задайте для свойства **Копировать в выходной каталог** значение **Всегда копировать**.</span><span class="sxs-lookup"><span data-stu-id="18d12-400">Now, in the **Properties** window, set the **Copy to Output Directory** property to **Copy always**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="18d12-401">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="18d12-401">Next steps</span></span>
<span data-ttu-id="18d12-402">Дополнительные сведения о ведении журналов диагностики в Azure см. в статьях [Включение диагностики в облачных службах и виртуальных машинах Azure](cloud-services/cloud-services-dotnet-diagnostics.md) и [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](app-service-web/web-sites-enable-diagnostic-log.md).</span><span class="sxs-lookup"><span data-stu-id="18d12-402">To learn more about diagnostics logging in Azure, see [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](cloud-services/cloud-services-dotnet-diagnostics.md) and [Enable diagnostics logging for web apps in Azure App Service](app-service-web/web-sites-enable-diagnostic-log.md).</span></span>

