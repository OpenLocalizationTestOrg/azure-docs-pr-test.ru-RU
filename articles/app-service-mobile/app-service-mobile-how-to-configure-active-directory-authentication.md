---
title: "Настройка проверки подлинности Azure Active Directory для приложения служб приложений"
description: "Узнайте, как настроить проверку подлинности Azure Active Directory для приложения служб приложений."
author: mattchenderson
services: app-service
documentationcenter: 
manager: syntaxc4
editor: 
ms.assetid: 6ec6a46c-bce4-47aa-b8a3-e133baef22eb
ms.service: app-service-mobile
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 10/01/2016
ms.author: mahender
ms.openlocfilehash: fe007fa8640d5641f29dc88f8f3a8ca52a1ca8ae
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="how-to-configure-your-app-service-application-to-use-azure-active-directory-login"></a><span data-ttu-id="3f778-103">Настройка приложения службы приложений для использования службы входа Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="3f778-103">How to configure your App Service application to use Azure Active Directory login</span></span>
[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

<span data-ttu-id="3f778-104">В этом разделе показано, как настроить службы приложений Azure для использования Azure Active Directory в качестве поставщика проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="3f778-104">This topic shows you how to configure Azure App Services to use Azure Active Directory as an authentication provider.</span></span>

## <span data-ttu-id="3f778-105"><a name="express"> </a>Настройка Azure Active Directory с помощью стандартных параметров</span><span class="sxs-lookup"><span data-stu-id="3f778-105"><a name="express"> </a>Configure Azure Active Directory using express settings</span></span>
1. <span data-ttu-id="3f778-106">На [портал Azure]перейдите к своему приложению.</span><span class="sxs-lookup"><span data-stu-id="3f778-106">In the [Azure portal], navigate to your application.</span></span> <span data-ttu-id="3f778-107">Щелкните **Параметры**, а затем — **Аутентификация или авторизация**.</span><span class="sxs-lookup"><span data-stu-id="3f778-107">Click **Settings**, and then **Authentication/Authorization**.</span></span>
2. <span data-ttu-id="3f778-108">Если функция аутентификации или авторизации не включена, установите переключатель в положение **Вкл**.</span><span class="sxs-lookup"><span data-stu-id="3f778-108">If the Authentication / Authorization feature is not enabled, turn the switch to **On**.</span></span>
3. <span data-ttu-id="3f778-109">Щелкните **Azure Active Directory**, а затем в разделе **Режим управления** выберите **Экспресс**.</span><span class="sxs-lookup"><span data-stu-id="3f778-109">Click **Azure Active Directory**, and then click **Express** under **Management Mode**.</span></span>
4. <span data-ttu-id="3f778-110">Нажмите кнопку **ОК** , чтобы зарегистрировать приложение в Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="3f778-110">Click **OK** to register the application in Azure Active Directory.</span></span> <span data-ttu-id="3f778-111">При этом будет создана новая регистрация.</span><span class="sxs-lookup"><span data-stu-id="3f778-111">This will create a new registration.</span></span> <span data-ttu-id="3f778-112">Чтобы выбрать имеющуюся регистрацию, щелкните **Выбрать существующее приложение** и найдите имя ранее созданной регистрации в вашем клиенте.</span><span class="sxs-lookup"><span data-stu-id="3f778-112">If you want to choose an existing registration instead, click **Select an existing app** and then search for the name of a previously created registration within your tenant.</span></span>
   <span data-ttu-id="3f778-113">Щелкните регистрацию, чтобы ее выбрать, и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="3f778-113">Click the registration to select it and click **OK**.</span></span> <span data-ttu-id="3f778-114">Затем нажмите кнопку **ОК** в колонке параметров Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="3f778-114">Then click **OK** on the Azure Active Directory settings blade.</span></span>
   
   ![][0]
   
   <span data-ttu-id="3f778-115">По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API.</span><span class="sxs-lookup"><span data-stu-id="3f778-115">By default, App Service provides authentication but does not restrict authorized access to your site content and APIs.</span></span> <span data-ttu-id="3f778-116">Авторизация пользователей должна быть включена в код приложения.</span><span class="sxs-lookup"><span data-stu-id="3f778-116">You must authorize users in your app code.</span></span>
5. <span data-ttu-id="3f778-117">(Необязательно.) Чтобы предоставить доступ к сайту только пользователям, прошедшим проверку подлинности в Azure Active Directory, установите для параметра **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** значение **Войти с использованием Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="3f778-117">(Optional) To restrict access to your site to only users authenticated by Azure Active Directory, set **Action to take when request is not authenticated** to **Log in with Azure Active Directory**.</span></span> <span data-ttu-id="3f778-118">В этом случае все запросы, не прошедшие проверку подлинности, направляются для проверки подлинности с помощью Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="3f778-118">This requires that all requests be authenticated, and all unauthenticated requests are redirected to Azure Active Directory for authentication.</span></span>
6. <span data-ttu-id="3f778-119">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="3f778-119">Click **Save**.</span></span>

<span data-ttu-id="3f778-120">Теперь вы можете использовать Azure Active Directory для проверки подлинности в приложении.</span><span class="sxs-lookup"><span data-stu-id="3f778-120">You are now ready to use Azure Active Directory for authentication in your app.</span></span>

## <span data-ttu-id="3f778-121"><a name="advanced"> </a>(Альтернативный способ) Ручная настройка расширенных параметров Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="3f778-121"><a name="advanced"> </a>(Alternative method) Manually configure Azure Active Directory with advanced settings</span></span>
<span data-ttu-id="3f778-122">Можно также указать параметры конфигурации вручную.</span><span class="sxs-lookup"><span data-stu-id="3f778-122">You can also choose to provide configuration settings manually.</span></span> <span data-ttu-id="3f778-123">Этот способ рекомендуется, если клиент AAD, который вы хотите использовать, отличается от клиента, с которого вы выполняете вход в Azure.</span><span class="sxs-lookup"><span data-stu-id="3f778-123">This is the preferred solution if the AAD tenant you wish to use is different from the tenant with which you sign into Azure.</span></span> <span data-ttu-id="3f778-124">Чтобы выполнить настройку, сначала необходимо создать регистрацию в Azure Active Directory, а затем предоставить некоторые сведения о регистрации службе приложений.</span><span class="sxs-lookup"><span data-stu-id="3f778-124">To complete the configuration, you must first create a registration in Azure Active Directory, and then you must provide some of the registration details to App Service.</span></span>

### <span data-ttu-id="3f778-125"><a name="register"> </a>Регистрация приложения в Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="3f778-125"><a name="register"> </a>Register your application with Azure Active Directory</span></span>
1. <span data-ttu-id="3f778-126">Войдите на [портал Azure]и перейдите к своему приложению.</span><span class="sxs-lookup"><span data-stu-id="3f778-126">Log on to the [Azure portal], and navigate to your application.</span></span> <span data-ttu-id="3f778-127">Скопируйте свой **URL-адрес**.</span><span class="sxs-lookup"><span data-stu-id="3f778-127">Copy your **URL**.</span></span> <span data-ttu-id="3f778-128">Он будет использоваться для настройки приложения Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="3f778-128">You will use this to configure your Azure Active Directory app.</span></span>
2. <span data-ttu-id="3f778-129">Войдите на [классический портал Azure] и перейдите в раздел **Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="3f778-129">Sign in to the [Azure classic portal] and navigate to **Active Directory**.</span></span>
   
    ![][2]
3. <span data-ttu-id="3f778-130">Выберите свой каталог, а затем откройте вкладку **Приложения** в верхней части окна.</span><span class="sxs-lookup"><span data-stu-id="3f778-130">Select your directory, and then select the **Applications** tab at the top.</span></span> <span data-ttu-id="3f778-131">Щелкните **Добавить** в нижней части окна, чтобы зарегистрировать новое приложение.</span><span class="sxs-lookup"><span data-stu-id="3f778-131">Click **ADD** at the bottom to create a new app registration.</span></span>
4. <span data-ttu-id="3f778-132">Выберите команду **Добавить приложение, разрабатываемое моей организацией**.</span><span class="sxs-lookup"><span data-stu-id="3f778-132">Click **Add an application my organization is developing**.</span></span>
5. <span data-ttu-id="3f778-133">В мастере добавления приложения введите **имя** приложения и выберите тип **Веб-приложение и/или веб-API**.</span><span class="sxs-lookup"><span data-stu-id="3f778-133">In the Add Application Wizard, enter a **Name** for your application and click the  **Web Application And/Or Web API** type.</span></span> <span data-ttu-id="3f778-134">Затем щелкните "Далее".</span><span class="sxs-lookup"><span data-stu-id="3f778-134">Then click to continue.</span></span>
6. <span data-ttu-id="3f778-135">В поле **URL-адрес входа** вставьте скопированный ранее URL-адрес приложения.</span><span class="sxs-lookup"><span data-stu-id="3f778-135">In the **SIGN-ON URL** box, paste the application URL you copied earlier.</span></span> <span data-ttu-id="3f778-136">Введите этот же URL-адрес в поле **URI кода приложения** .</span><span class="sxs-lookup"><span data-stu-id="3f778-136">Enter that same URL in the **App ID URI** box.</span></span> <span data-ttu-id="3f778-137">Затем щелкните "Далее".</span><span class="sxs-lookup"><span data-stu-id="3f778-137">Then click to continue.</span></span>
7. <span data-ttu-id="3f778-138">После добавления приложения щелкните вкладку **Настройка** .</span><span class="sxs-lookup"><span data-stu-id="3f778-138">Once the application has been added, click the **Configure** tab.</span></span> <span data-ttu-id="3f778-139">Измените **URL-адрес ответа** в разделе **Единый вход** на URL-адрес вашего приложения, дополненный путем */.auth/login/aad/callback*.</span><span class="sxs-lookup"><span data-stu-id="3f778-139">Edit the **Reply URL** under **Single Sign-on** to be the URL of your application appended with the path, */.auth/login/aad/callback*.</span></span> <span data-ttu-id="3f778-140">Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`.</span><span class="sxs-lookup"><span data-stu-id="3f778-140">For example, `https://contoso.azurewebsites.net/.auth/login/aad/callback`.</span></span> <span data-ttu-id="3f778-141">Убедитесь, что используете схему HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3f778-141">Make sure that you are using the HTTPS scheme.</span></span>
   
    ![][3]
8. <span data-ttu-id="3f778-142">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="3f778-142">Click **Save**.</span></span> <span data-ttu-id="3f778-143">Затем скопируйте **идентификатор клиента** для приложения.</span><span class="sxs-lookup"><span data-stu-id="3f778-143">Then copy the **Client ID** for the app.</span></span> <span data-ttu-id="3f778-144">Вы настроите его позднее.</span><span class="sxs-lookup"><span data-stu-id="3f778-144">You will configure your application to use this later.</span></span>
9. <span data-ttu-id="3f778-145">На нижней панели команд щелкните **Просмотр конечных точек**, скопируйте URL-адрес **документа метаданных федерации** и скачайте документ или откройте его в браузере.</span><span class="sxs-lookup"><span data-stu-id="3f778-145">In the bottom command bar, click **View Endpoints**, and then copy the **Federation Metadata Document** URL and download that document or navigate to it in a browser.</span></span>
10. <span data-ttu-id="3f778-146">В корневом элементе **EntityDescriptor** должен быть указан атрибут **entityID** в формате `https://sts.windows.net/`, за которым следует идентификатор GUID вашего клиента (идентификатор клиента).</span><span class="sxs-lookup"><span data-stu-id="3f778-146">Within the root **EntityDescriptor** element, there should be an **entityID** attribute of the form `https://sts.windows.net/` followed by a GUID specific to your tenant (called a "tenant ID").</span></span> <span data-ttu-id="3f778-147">Скопируйте это значение — оно будет использоваться в качестве вашего **URL-адреса издателя**.</span><span class="sxs-lookup"><span data-stu-id="3f778-147">Copy this value - it will serve as your **Issuer URL**.</span></span> <span data-ttu-id="3f778-148">Вы настроите его позднее.</span><span class="sxs-lookup"><span data-stu-id="3f778-148">You will configure your application to use this later.</span></span>

### <span data-ttu-id="3f778-149"><a name="secrets"> </a>Добавление сведений об Azure Active Directory в приложение</span><span class="sxs-lookup"><span data-stu-id="3f778-149"><a name="secrets"> </a>Add Azure Active Directory information to your application</span></span>
1. <span data-ttu-id="3f778-150">Снова вернитесь на [портал Azure]и перейдите к своему приложению.</span><span class="sxs-lookup"><span data-stu-id="3f778-150">Back in the [Azure portal], navigate to your application.</span></span> <span data-ttu-id="3f778-151">Щелкните **Параметры**, а затем — **Аутентификация или авторизация**.</span><span class="sxs-lookup"><span data-stu-id="3f778-151">Click **Settings**, and then **Authentication/Authorization**.</span></span>
2. <span data-ttu-id="3f778-152">Если функция аутентификации или авторизации не включена, установите переключатель в положение **Вкл**.</span><span class="sxs-lookup"><span data-stu-id="3f778-152">If the Authentication/Authorization feature is not enabled, turn the switch to **On**.</span></span>
3. <span data-ttu-id="3f778-153">Щелкните **Azure Active Directory**, а затем в разделе **Режим управления** выберите **Дополнительно**.</span><span class="sxs-lookup"><span data-stu-id="3f778-153">Click **Azure Active Directory**, and then click **Advanced** under **Management Mode**.</span></span> <span data-ttu-id="3f778-154">Вставьте значения идентификатора клиента и URL-адреса издателя, полученные ранее.</span><span class="sxs-lookup"><span data-stu-id="3f778-154">Paste in the Client ID and Issuer URL value which you obtained previously.</span></span> <span data-ttu-id="3f778-155">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="3f778-155">Then click **OK**.</span></span>
   
   ![][1]
   
   <span data-ttu-id="3f778-156">По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API.</span><span class="sxs-lookup"><span data-stu-id="3f778-156">By default, App Service provides authentication but does not restrict authorized access to your site content and APIs.</span></span> <span data-ttu-id="3f778-157">Авторизация пользователей должна быть включена в код приложения.</span><span class="sxs-lookup"><span data-stu-id="3f778-157">You must authorize users in your app code.</span></span>
4. <span data-ttu-id="3f778-158">(Необязательно.) Чтобы предоставить доступ к сайту только пользователям, прошедшим проверку подлинности в Azure Active Directory, установите для параметра **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** значение **Войти с использованием Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="3f778-158">(Optional) To restrict access to your site to only users authenticated by Azure Active Directory, set **Action to take when request is not authenticated** to **Log in with Azure Active Directory**.</span></span> <span data-ttu-id="3f778-159">В этом случае все запросы, не прошедшие проверку подлинности, направляются для проверки подлинности с помощью Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="3f778-159">This requires that all requests be authenticated, and all unauthenticated requests are redirected to Azure Active Directory for authentication.</span></span>
5. <span data-ttu-id="3f778-160">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="3f778-160">Click **Save**.</span></span>

<span data-ttu-id="3f778-161">Теперь вы можете использовать Azure Active Directory для проверки подлинности в приложении.</span><span class="sxs-lookup"><span data-stu-id="3f778-161">You are now ready to use Azure Active Directory for authentication in your app.</span></span>

## <a name="optional-configure-a-native-client-application"></a><span data-ttu-id="3f778-162">(Необязательно.) Настройка собственного клиентского приложения</span><span class="sxs-lookup"><span data-stu-id="3f778-162">(Optional) Configure a native client application</span></span>
<span data-ttu-id="3f778-163">Azure Active Directory также позволяет регистрировать собственные клиенты, что обеспечивает больший контроль над сопоставлением разрешений.</span><span class="sxs-lookup"><span data-stu-id="3f778-163">Azure Active Directory also allows you to register native clients, which provides greater control over permissions mapping.</span></span> <span data-ttu-id="3f778-164">Это необходимо, если вы хотите выполнять вход с помощью библиотеки, например **библиотеки аутентификации Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="3f778-164">You need this if you wish to perform logins using a library such as the **Active Directory Authentication Library**.</span></span>

1. <span data-ttu-id="3f778-165">Перейдите в раздел **Active Directory** на [классический портал Azure].</span><span class="sxs-lookup"><span data-stu-id="3f778-165">Navigate to **Active Directory** in the [Azure classic portal].</span></span>
2. <span data-ttu-id="3f778-166">Выберите свой каталог, а затем откройте вкладку **Приложения** в верхней части окна.</span><span class="sxs-lookup"><span data-stu-id="3f778-166">Select your directory, and then select the **Applications** tab at the top.</span></span> <span data-ttu-id="3f778-167">Щелкните **Добавить** в нижней части окна, чтобы зарегистрировать новое приложение.</span><span class="sxs-lookup"><span data-stu-id="3f778-167">Click **ADD** at the bottom to create a new app registration.</span></span>
3. <span data-ttu-id="3f778-168">Выберите команду **Добавить приложение, разрабатываемое моей организацией**.</span><span class="sxs-lookup"><span data-stu-id="3f778-168">Click **Add an application my organization is developing**.</span></span>
4. <span data-ttu-id="3f778-169">В мастере добавления приложения введите **имя** приложения и выберите тип **Собственное клиентское приложение**.</span><span class="sxs-lookup"><span data-stu-id="3f778-169">In the Add Application Wizard, enter a **Name** for your application and click the  **Native Client Application** type.</span></span> <span data-ttu-id="3f778-170">Затем щелкните "Далее".</span><span class="sxs-lookup"><span data-stu-id="3f778-170">Then click to continue.</span></span>
5. <span data-ttu-id="3f778-171">В поле **URI перенаправления** введите конечную точку */.auth/login/done* веб-сайта в формате HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3f778-171">In the **Redirect URI** box, enter your site's */.auth/login/done* endpoint, using the HTTPS scheme.</span></span> <span data-ttu-id="3f778-172">Это значение должно быть похоже на *https://contoso.azurewebsites.net/.auth/login/done*.</span><span class="sxs-lookup"><span data-stu-id="3f778-172">This value should be similar to *https://contoso.azurewebsites.net/.auth/login/done*.</span></span> <span data-ttu-id="3f778-173">При создании приложения Windows в качестве URI используйте [идентификатор безопасности пакета](app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) .</span><span class="sxs-lookup"><span data-stu-id="3f778-173">If creating a Windows application, instead use the [package SID](app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) as the URI.</span></span>
6. <span data-ttu-id="3f778-174">После добавления собственного приложения щелкните вкладку **Настройка** .</span><span class="sxs-lookup"><span data-stu-id="3f778-174">Once the native application has been added, click the **Configure** tab.</span></span> <span data-ttu-id="3f778-175">Найдите **идентификатор клиента** и запишите его.</span><span class="sxs-lookup"><span data-stu-id="3f778-175">Find the **Client ID** and make a note of this value.</span></span>
7. <span data-ttu-id="3f778-176">Прокрутите страницу вниз до раздела **Разрешения для других приложений** и щелкните **Добавить приложение**.</span><span class="sxs-lookup"><span data-stu-id="3f778-176">Scroll the page down to the **Permissions to other applications** section and click **Add application**.</span></span>
8. <span data-ttu-id="3f778-177">Найдите ранее зарегистрированное веб-приложение и щелкните значок со знаком плюс.</span><span class="sxs-lookup"><span data-stu-id="3f778-177">Search for the web application that you registered earlier and click the plus icon.</span></span> <span data-ttu-id="3f778-178">Затем установите флажок, чтобы закрыть диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="3f778-178">Then click the check to close the dialog.</span></span> <span data-ttu-id="3f778-179">Если веб-приложение не удается найти, перейдите к его регистрации и добавьте новый URL-адрес ответа (например, версию HTTP текущего URL-адреса), нажмите кнопку "Сохранить", а затем повторите эти шаги. Приложение должно появиться в списке.</span><span class="sxs-lookup"><span data-stu-id="3f778-179">If the web application cannot be found, navigate to its registration and add a new reply URL (e.g., the HTTP version of your current URL), click save, and then repeat these steps - the application should show up in the list.</span></span>
9. <span data-ttu-id="3f778-180">Для только что добавленной записи откройте раскрывающийся список **Делегированные разрешения** и выберите пункт **Access (appName)** (Доступ к (имя_приложения)).</span><span class="sxs-lookup"><span data-stu-id="3f778-180">On the new entry you just added, open the **Delegated Permissions** dropdown and select **Access (appName)**.</span></span> <span data-ttu-id="3f778-181">Нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="3f778-181">Then click **Save**.</span></span>

<span data-ttu-id="3f778-182">Теперь вы настроили собственное клиентское приложение, у которого есть доступ к вашему приложению службы приложений.</span><span class="sxs-lookup"><span data-stu-id="3f778-182">You have now configured a native client application which can access your App Service application.</span></span>

## <span data-ttu-id="3f778-183"><a name="related-content"> </a>Связанная информация</span><span class="sxs-lookup"><span data-stu-id="3f778-183"><a name="related-content"> </a>Related Content</span></span>
[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- Images. -->

[0]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/mobile-app-aad-express-settings.png
[1]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/mobile-app-aad-advanced-settings.png
[2]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-navigate-aad.png
[3]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-configure.png

<!-- URLs. -->

<span data-ttu-id="3f778-184">[портал Azure]: https://portal.azure.com/</span><span class="sxs-lookup"><span data-stu-id="3f778-184">[Azure portal]: https://portal.azure.com/</span></span>
<span data-ttu-id="3f778-185">[классический портал Azure]: https://manage.windowsazure.com/</span><span class="sxs-lookup"><span data-stu-id="3f778-185">[Azure classic portal]: https://manage.windowsazure.com/</span></span>
[alternative method]:#advanced
