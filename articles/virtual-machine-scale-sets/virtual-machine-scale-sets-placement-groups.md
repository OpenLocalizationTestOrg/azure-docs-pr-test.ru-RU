---
title: "Работа с крупными масштабируемыми наборами виртуальных машин Azure | Документация Майкрософт"
description: "Сведения об использовании крупных масштабируемых наборов виртуальных машин Azure"
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 76ac7fd7-2e05-4762-88ca-3b499e87906e
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 2/7/2017
ms.author: guybo
ms.openlocfilehash: 9e9eae1623e55c1c05e97aa0b836819ce5dc16f9
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="working-with-large-virtual-machine-scale-sets"></a><span data-ttu-id="7354a-103">Работа с крупными масштабируемыми наборами виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="7354a-103">Working with large virtual machine scale sets</span></span>
<span data-ttu-id="7354a-104">Теперь вы можете создавать [масштабируемые наборы виртуальных машин](/azure/virtual-machine-scale-sets/) Azure, включающие до 1000 виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7354a-104">You can now create Azure [virtual machine scale sets](/azure/virtual-machine-scale-sets/) with a capacity of up to 1,000 VMs.</span></span> <span data-ttu-id="7354a-105">В этом документе под _крупным масштабируемым набором виртуальных машин_ подразумевается масштабируемый набор, в который можно добавить более 100 виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7354a-105">In this document, a _large virtual machine scale set_ is defined as a scale set capable of scaling to greater than 100 VMs.</span></span> <span data-ttu-id="7354a-106">Эта возможность задается с помощью свойства масштабируемого набора (_singlePlacementGroup=False_).</span><span class="sxs-lookup"><span data-stu-id="7354a-106">This capability is set by a scale set property (_singlePlacementGroup=False_).</span></span> 

<span data-ttu-id="7354a-107">Поведение некоторых компонентов, например балансировки нагрузки и доменов сбоя, в крупных масштабируемых наборах отличается по сравнению со стандартными масштабируемыми наборами.</span><span class="sxs-lookup"><span data-stu-id="7354a-107">Certain aspects of large scale sets, such as load balancing and fault domains behave differently to a standard scale set.</span></span> <span data-ttu-id="7354a-108">В этом документе рассматриваются особенности крупных масштабируемых наборов и приведены сведения, которые необходимо знать, чтобы успешно использовать эти наборы в приложениях.</span><span class="sxs-lookup"><span data-stu-id="7354a-108">This document explains the characteristics of large scale sets, and describes what you need to know to successfully use them in your applications.</span></span> 

<span data-ttu-id="7354a-109">Распространенный метод развертывания облачной инфраструктуры в крупных масштабах — создать набор _единиц масштабирования_, например путем создания нескольких масштабируемых наборов виртуальных машин в нескольких виртуальных сетях и учетных записях хранения.</span><span class="sxs-lookup"><span data-stu-id="7354a-109">A common approach for deploying cloud infrastructure at large scale is to create a set of _scale units_, for example by creating multiple VMs scale sets across multiple VNETs and storage accounts.</span></span> <span data-ttu-id="7354a-110">Этот метод обеспечивает более удобное управление, чем при использовании отдельных виртуальных машин. Кроме того, несколько единиц масштабирования полезны для многих приложений, особенно тех, которым требуются другие наращиваемые компоненты, например несколько виртуальных сетей и конечных точек.</span><span class="sxs-lookup"><span data-stu-id="7354a-110">This approach provides easier management compared to single VMs, and multiple scale units are useful for many applications, particularly those that require other stackable components like multiple virtual networks and endpoints.</span></span> <span data-ttu-id="7354a-111">Однако если приложению требуется один большой кластер, проще развернуть один масштабируемый набор, включающий до 1000 виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7354a-111">If your application requires a single large cluster however, it can be more straightforward to deploy a single scale set of up to 1,000 VMs.</span></span> <span data-ttu-id="7354a-112">К примерам сценариев относятся централизованные развертывания больших данных или сетки вычислений, требующие простого управления крупным пулом рабочих узлов.</span><span class="sxs-lookup"><span data-stu-id="7354a-112">Example scenarios include centralized big data deployments, or compute grids requiring simple management of a large pool of worker nodes.</span></span> <span data-ttu-id="7354a-113">При использовании [подключенных дисков с данными](virtual-machine-scale-sets-attached-disks.md) крупные масштабируемые наборы позволяют развернуть масштабируемую инфраструктуру, включающую несколько тысяч ядер и петабайты пространства для хранения, в рамках одной операции.</span><span class="sxs-lookup"><span data-stu-id="7354a-113">Combined with VM scale set [attached data disks](virtual-machine-scale-sets-attached-disks.md), large scale sets enable you to deploy a scalable infrastructure consisting of thousands of cores and petabytes of storage, as a single operation.</span></span>

## <a name="placement-groups"></a><span data-ttu-id="7354a-114">Группы размещения</span><span class="sxs-lookup"><span data-stu-id="7354a-114">Placement groups</span></span> 
<span data-ttu-id="7354a-115">Главное в _крупном_ масштабируемом наборе не число виртуальных машин, а число содержащихся в нем _групп размещения_.</span><span class="sxs-lookup"><span data-stu-id="7354a-115">What makes a _large_ scale set special is not the number of VMs, but the number of _placement groups_ it contains.</span></span> <span data-ttu-id="7354a-116">Группа размещения — это конструкция, подобная группе доступности Azure, с собственными доменами сбоя и доменами обновления.</span><span class="sxs-lookup"><span data-stu-id="7354a-116">A placement group is a construct similar to an Azure availability set, with its own fault domains and upgrade domains.</span></span> <span data-ttu-id="7354a-117">По умолчанию масштабируемый набор содержит одну группу размещения максимум со 100 виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="7354a-117">By default, a scale set consists of a single placement group with a maximum size of 100 VMs.</span></span> <span data-ttu-id="7354a-118">Если для свойства _singlePlacementGroup_ масштабируемого набора задано значение _false_, масштабируемый набор может состоять из нескольких групп размещения и содержать от 0 до 1000 виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7354a-118">If a scale set property called _singlePlacementGroup_ is set to _false_, the scale set can be composed of multiple placement groups and has a range of 0-1,000 VMs.</span></span> <span data-ttu-id="7354a-119">Если задано значение _true_ (по умолчанию), масштабируемый набор состоит из одной группы размещения и может содержать от 0 до 100 виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7354a-119">When set to the default value of _true_, a scale set is composed of a single placement group, and has a range of 0-100 VMs.</span></span>

## <a name="checklist-for-using-large-scale-sets"></a><span data-ttu-id="7354a-120">Контрольный список для использования крупных масштабируемых наборов</span><span class="sxs-lookup"><span data-stu-id="7354a-120">Checklist for using large scale sets</span></span>
<span data-ttu-id="7354a-121">Чтобы определить, целесообразно ли использовать для приложения крупные масштабируемые наборы, рассмотрите следующие требования:</span><span class="sxs-lookup"><span data-stu-id="7354a-121">To decide whether your application can make effective use of large scale sets, consider the following requirements:</span></span>

- <span data-ttu-id="7354a-122">Крупные масштабируемые наборы необходимо создавать с управляемыми дисками Azure.</span><span class="sxs-lookup"><span data-stu-id="7354a-122">Large scale sets require Azure Managed Disks.</span></span> <span data-ttu-id="7354a-123">В противном случае для них требуется несколько учетных записей хранения (по одной на каждые 20 виртуальных машин).</span><span class="sxs-lookup"><span data-stu-id="7354a-123">Scale sets that are not created with Managed Disks require multiple storage accounts (one for every 20 VMs).</span></span> <span data-ttu-id="7354a-124">Крупные масштабируемые наборы предназначены для работы исключительно с управляемыми дисками. Это позволяет снизить расходы на управление хранилищем и избежать риска достичь ограничений подписки для учетных записей хранения.</span><span class="sxs-lookup"><span data-stu-id="7354a-124">Large scale sets are designed to work exclusively with Managed Disks to reduce your storage management overhead, and to avoid the risk of running into subscription limits for storage accounts.</span></span> <span data-ttu-id="7354a-125">Если не использовать управляемые диски, масштабируемый набор ограничивается 100 виртуальными машинами.</span><span class="sxs-lookup"><span data-stu-id="7354a-125">If you do not use Managed Disks, your scale set is limited to 100 VMs.</span></span>
- <span data-ttu-id="7354a-126">Масштабируемые наборы, созданные на основе образов Azure Marketplace, можно масштабировать до 1000 виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7354a-126">Scale sets created from Azure Marketplace images can scale up to 1,000 VMs.</span></span>
- <span data-ttu-id="7354a-127">Масштабируемые наборы, созданные на основе пользовательских образов (образов виртуальных машин, которые вы создаете и передаете самостоятельно), в настоящее время можно масштабировать до 100 виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7354a-127">Scale sets created from custom images (VM images you create and upload yourself) can currently scale up to 100 VMs.</span></span>
- <span data-ttu-id="7354a-128">Для масштабируемых наборов, состоящих из нескольких групп размещения, пока не поддерживается балансировка нагрузки уровня 4 с помощью Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="7354a-128">Layer-4 load balancing with the Azure Load Balancer is not yet supported for scale sets composed of multiple placement groups.</span></span> <span data-ttu-id="7354a-129">Если вам необходимо использовать Azure Load Balancer, масштабируемый набор должен быть настроен для использования одной группы размещения, что является настройкой по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="7354a-129">If you need to use the Azure Load Balancer make sure the scale set is configured to use a single placement group, which is the default setting.</span></span>
- <span data-ttu-id="7354a-130">Балансировка нагрузки уровня 7 с использованием шлюза приложений Azure не поддерживается для всех масштабируемых наборов.</span><span class="sxs-lookup"><span data-stu-id="7354a-130">Layer-7 load balancing with the Azure Application Gateway is supported for all scale sets.</span></span>
- <span data-ttu-id="7354a-131">Масштабируемый набор определяется с одной подсетью, поэтому она должна иметь достаточное адресное пространство для необходимого числа виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7354a-131">A scale set is defined with a single subnet - make sure your subnet has an address space large enough for all the VMs you need.</span></span> <span data-ttu-id="7354a-132">По умолчанию масштабируемый набор выполняет избыточную подготовку (создает дополнительные виртуальные машины, плата за которые не взимается, во время развертывания или при масштабировании) для повышения надежности и производительности развертывания.</span><span class="sxs-lookup"><span data-stu-id="7354a-132">By default a scale set overprovisions (creates extra VMs at deployment time or when scaling out, which you are not charged for) to improve deployment reliability and performance.</span></span> <span data-ttu-id="7354a-133">Настройте адресное пространство так, чтобы оно было на 20 % больше, чем количество виртуальных машин, которые планируете развернуть.</span><span class="sxs-lookup"><span data-stu-id="7354a-133">Allow for an address space 20% greater than the number of VMs you plan to scale to.</span></span>
- <span data-ttu-id="7354a-134">Если вы планируете развернуть много виртуальных машин, может потребоваться увеличить квоту для вычислительных ядер.</span><span class="sxs-lookup"><span data-stu-id="7354a-134">If you are planning to deploy many VMs, your Compute core quota limits may need to be increased.</span></span>
- <span data-ttu-id="7354a-135">Домены сбоя и домены обновления согласованы только в пределах группы размещения.</span><span class="sxs-lookup"><span data-stu-id="7354a-135">Fault domains and upgrade domains are only consistent within a placement group.</span></span> <span data-ttu-id="7354a-136">Эта архитектура не влияет на общую доступность масштабируемого набора, потому что виртуальные машины равномерно распределяются между отдельным физическим оборудованием. Однако это означает, что если необходимо гарантировать размещение двух виртуальных машин на разном оборудовании, они должны находиться в разных доменах сбоя в одной группе размещения.</span><span class="sxs-lookup"><span data-stu-id="7354a-136">This architecture does not change the overall availability of a scale set, as VMs are evenly distributed across distinct physical hardware, but it does means that if you need to guarantee two VMs are on different hardware, make sure they are in different fault domains in the same placement group.</span></span> <span data-ttu-id="7354a-137">Идентификатор домена сбоя и группы размещения можно просмотреть в _представлении экземпляра_ виртуальной машины масштабируемого набора.</span><span class="sxs-lookup"><span data-stu-id="7354a-137">Fault domain and placement group ID are shown in the _instance view_ of a scale set VM.</span></span> <span data-ttu-id="7354a-138">Представление экземпляра виртуальной машины масштабируемого набора доступно в [обозревателе ресурсов Azure](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="7354a-138">You can view the instance view of a scale set VM in the [Azure Resource Explorer](https://resources.azure.com/).</span></span>


## <a name="creating-a-large-scale-set"></a><span data-ttu-id="7354a-139">Создание крупного масштабируемого набора</span><span class="sxs-lookup"><span data-stu-id="7354a-139">Creating a large scale set</span></span>
<span data-ttu-id="7354a-140">При создании масштабируемого набора на портале Azure можно разрешить использование нескольких групп размещения. Для этого в колонке _Основные сведения_ нужно задать для параметра _Limit to a single placement group_ (Ограничить до одной группы размещения) значение _Нет_.</span><span class="sxs-lookup"><span data-stu-id="7354a-140">When you create a scale set in the Azure portal, you can allow it to scale to multiple placement groups by setting the _Limit to a single placement group_ option to _False_ in the _Basics_ blade.</span></span> <span data-ttu-id="7354a-141">Задав для этого параметра значение _Нет_, для _числа экземпляров_ можно задать до 1000.</span><span class="sxs-lookup"><span data-stu-id="7354a-141">With this option set to _False_, you can specify an _Instance count_ value of up to 1,000.</span></span>

![](./media/virtual-machine-scale-sets-placement-groups/portal-large-scale.png)

<span data-ttu-id="7354a-142">Крупный масштабируемый набор виртуальных машин можно создать с помощью команды [Azure CLI](https://github.com/Azure/azure-cli) _az vmss create_.</span><span class="sxs-lookup"><span data-stu-id="7354a-142">You can create a large VM scale set using the [Azure CLI](https://github.com/Azure/azure-cli) _az vmss create_ command.</span></span> <span data-ttu-id="7354a-143">Эта команда задает интеллектуальные значения по умолчанию, такие как размер подсети, на основе аргумента _instance-count_:</span><span class="sxs-lookup"><span data-stu-id="7354a-143">This command sets intelligent defaults such as subnet size based on the _instance-count_ argument:</span></span>

```bash
az group create -l southcentralus -n biginfra
az vmss create -g biginfra -n bigvmss --image ubuntults --instance-count 1000
```
<span data-ttu-id="7354a-144">Обратите внимание, что команда _vmss create_ задаст определенные значения конфигурации по умолчанию, если их не указать.</span><span class="sxs-lookup"><span data-stu-id="7354a-144">Note that the _vmss create_ command defaults certain configuration values if you do not specify them.</span></span> <span data-ttu-id="7354a-145">Чтобы узнать, какие параметры можно переопределить, используйте следующую команду:</span><span class="sxs-lookup"><span data-stu-id="7354a-145">To see the available options that you can override, try:</span></span>
```bash
az vmss create --help
```

<span data-ttu-id="7354a-146">Если для создания крупного масштабируемого набора используется шаблон Azure Resource Manager, он должен создавать масштабируемый набор на основе управляемых дисков Azure.</span><span class="sxs-lookup"><span data-stu-id="7354a-146">If you are creating a large scale set by composing an Azure Resource Manager template, make sure the template creates a scale set based on Azure Managed Disks.</span></span> <span data-ttu-id="7354a-147">Вы можете задать для свойства _singlePlacementGroup_ значение _false_ в разделе _properties_ ресурса _Microsoft.Compute/virtualMAchineScaleSets_.</span><span class="sxs-lookup"><span data-stu-id="7354a-147">You can set the _singlePlacementGroup_ property to _false_ in the _properties_ section of the _Microsoft.Compute/virtualMAchineScaleSets_ resource.</span></span> <span data-ttu-id="7354a-148">В следующем фрагменте JSON показано начало шаблона масштабируемого набора, включая параметры "capacity": 1000 и _"singlePlacementGroup": false_:</span><span class="sxs-lookup"><span data-stu-id="7354a-148">The following JSON fragment shows the beginning of a scale set template, including the 1,000 VM capacity and the _"singlePlacementGroup" : false_ setting:</span></span>
```json
{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "location": "australiaeast",
  "name": "bigvmss",
  "sku": {
    "name": "Standard_DS1_v2",
    "tier": "Standard",
    "capacity": 1000
  },
  "properties": {
    "singlePlacementGroup": false,
    "upgradePolicy": {
      "mode": "Automatic"
    }
```
<span data-ttu-id="7354a-149">Полный пример шаблона масштабируемого набора см. по адресу [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span><span class="sxs-lookup"><span data-stu-id="7354a-149">For a complete example of a large scale set template, refer to [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span></span>

## <a name="converting-an-existing-scale-set-to-span-multiple-placement-groups"></a><span data-ttu-id="7354a-150">Преобразование существующего масштабируемого набора для поддержки нескольких групп размещения</span><span class="sxs-lookup"><span data-stu-id="7354a-150">Converting an existing scale set to span multiple placement groups</span></span>
<span data-ttu-id="7354a-151">Чтобы существующий масштабируемый набор виртуальных машин мог масштабироваться до более 100 виртуальных машин, необходимо задать для свойства _singplePlacementGroup_ значение _false_ в модели масштабируемого набора.</span><span class="sxs-lookup"><span data-stu-id="7354a-151">To make an existing VM scale set capable of scaling to more than 100 VMs, you need to change the _singplePlacementGroup_ property to _false_ in the scale set model.</span></span> <span data-ttu-id="7354a-152">Вы можете попробовать изменить это свойство в [обозревателе ресурсов Azure](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="7354a-152">You can test changing this property with the [Azure Resource Explorer](https://resources.azure.com/).</span></span> <span data-ttu-id="7354a-153">Найдите существующий масштабируемый набор, выберите _Изменить_ и измените свойство _singlePlacementGroup_.</span><span class="sxs-lookup"><span data-stu-id="7354a-153">Find an existing scale set, select _Edit_ and change the _singlePlacementGroup_ property.</span></span> <span data-ttu-id="7354a-154">Если вы не видите это свойство, возможно, вы открыли масштабируемый набор в более старой версии Microsoft.Compute API.</span><span class="sxs-lookup"><span data-stu-id="7354a-154">If you do not see this property, you may be viewing the scale set with an older version of the Microsoft.Compute API.</span></span>

>[!NOTE] 
<span data-ttu-id="7354a-155">Масштабируемый набор с поддержкой одной группы размещения (по умолчанию) можно преобразовать в масштабируемый набор с поддержкой нескольких групп размещения, но не наоборот.</span><span class="sxs-lookup"><span data-stu-id="7354a-155">You can change a scale set from supporting a single placement group only (the default behavior) to a supporting multiple placement groups, but you cannot convert the other way around.</span></span> <span data-ttu-id="7354a-156">Поэтому прежде чем выполнять преобразование, разберитесь со свойствами крупных масштабируемых наборов.</span><span class="sxs-lookup"><span data-stu-id="7354a-156">Therefore make sure you understand the properties of large scale sets before converting.</span></span> <span data-ttu-id="7354a-157">В частности, убедитесь, что вам не нужна балансировка нагрузки уровня 4 с помощью Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="7354a-157">In particular, make sure you do not need layer-4 load balancing with the Azure Load Balancer.</span></span>


