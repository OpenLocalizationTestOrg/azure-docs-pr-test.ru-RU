---
title: "Общие сведения о наборах масштабирования виртуальных машин aaaAzure | Документы Microsoft"
description: "Сведения о масштабируемых наборах виртуальных машин Azure."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 76ac7fd7-2e05-4762-88ca-3b499e87906e
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 07/03/2017
ms.author: guybo
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 788b2d1636e0bf4ef3fbf94aed9b3303c5fafa82
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="what-are-virtual-machine-scale-sets-in-azure"></a>Общие сведения о масштабируемых наборах виртуальных машин в Azure
Наборы масштабирования виртуальных машин являются ресурсом вычислений Azure можно использовать toodeploy и управление набором идентичные виртуальные машины. Hello со всех виртуальных машин настроены одинаково, наборы масштабирования true автомасштабирования спроектированный toosupport, и без предварительной подготовки виртуальных машин не требуются. В этом случае проще toobuild крупномасштабных служб, предназначенных для больших вычислений, большие наборы данных и контейнерах рабочих нагрузок.

Для приложений, требующих tooscale вычислительные ресурсы, извлечение и возврат масштабирования операций неявно распределяется среди доменов сбоя и обновления. Задает дополнительные tooscale введение, описаны в toohello [объявления блог Azure](https://azure.microsoft.com/blog/azure-virtual-machine-scale-sets-ga/).

Дополнительные сведения о масштабируемых наборах см. в этих видео:

* [Марк Руссинович (Mark Russinovich) рассказывает о масштабируемых наборах Azure.](https://channel9.msdn.com/Blogs/Regular-IT-Guy/Mark-Russinovich-Talks-Azure-Scale-Sets/)  
* [Масштабируемые наборы виртуальных машин с Гаем Бауэрманом (Guy Bowerman).](https://channel9.msdn.com/Shows/Cloud+Cover/Episode-191-Virtual-Machine-Scale-Sets-with-Guy-Bowerman)

## <a name="creating-and-managing-scale-sets"></a>Создание масштабируемых наборов и управление ими
Можно создать в hello наборе масштабирования [портал Azure](https://portal.azure.com) , выбрав **новый** и введя **шкалы** на панели поиска hello. **Набор масштабирования виртуальной машины** отображается в результатах hello. После этого можно заполнить toocustomize hello необходимые поля и развернуть набора масштабирования. Также имеется tooset параметры автомасштабирования основные правила на основе использования ЦП в портале hello.

Масштабируемые наборы можно определять и развертывать с помощью шаблонов JSON и интерфейсов [REST API](https://msdn.microsoft.com/library/mt589023.aspx) так же, как и отдельные виртуальные машины Azure Resource Manager. Поэтому можно использовать любые стандартные методы развертывания Azure Resource Manager. Дополнительную информацию о шаблонах см. в статье [Создание шаблонов диспетчера ресурсов Azure](../azure-resource-manager/resource-group-authoring-templates.md).

Задает набор шаблонов пример для масштабирования виртуальных машин в hello можно найти [репозитории GitHub быстрый запуск Azure шаблоны](https://github.com/Azure/azure-quickstart-templates). (Поиск шаблонов с **vmss** в заголовок hello.)

Примеры шаблонов краткое руководство hello, кнопки «Развернуть tooAzure» hello readme для каждой функции портала развертывания шаблона toohello ссылки. Масштаб hello toodeploy установить, нажмите кнопку "hello" и затем заполните все параметры, требуемые на портале hello. 

## <a name="scaling-a-scale-set-out-and-in"></a>Уменьшение или увеличение масштаба масштабируемого набора
Вы можете изменить емкость hello шкалы, установите в hello портал Azure, щелкнув hello **масштабирование** раздела **параметры**. 

емкость набора масштабирования toochange hello в командной строке, используйте hello **шкалы** в [Azure CLI](https://github.com/Azure/azure-cli). Например использование этой команды tooset шкалы набор tooa размером 10 виртуальных машин:

```bash
az vmss scale -g resourcegroupname -n scalesetname --new-capacity 10 
```

tooset hello число виртуальных машин на шкале устанавливается с помощью PowerShell, используйте hello **AzureRmVmss обновление** команды:

```PowerShell
$vmss = Get-AzureRmVmss -ResourceGroupName resourcegroupname -VMScaleSetName scalesetname  
$vmss.Sku.Capacity = 10
Update-AzureRmVmss -ResourceGroupName resourcegroupname -Name scalesetname -VirtualMachineScaleSet $vmss
```

tooincrease или уменьшении hello количество виртуальных машин на шкале задания с помощью шаблона Azure Resource Manager, изменения hello **емкость** шаблона hello свойство и повторного развертывания. Этой простоты позволяет легко toointegrate наборы масштабирования с автомасштабирования Azure или toowrite собственный пользовательский уровень масштабирования, если вам требуется пользовательский масштаб события toodefine Автомасштабирование Azure не поддерживает. 

При повторном емкости hello toochange шаблона диспетчера ресурсов Azure можно определить гораздо меньше, шаблон, включающий только hello **SKU** свойство пакет с hello обновлены емкости. [Ниже приведен пример](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing).

## <a name="autoscale"></a>Autoscale

Набор масштабирования можно дополнительно настроить параметры автоматического масштабирования при его создании в hello портал Azure. Затем можно увеличивается или уменьшается в зависимости от использования Средняя нагрузка на ЦП Hello число виртуальных машин. 

Многие hello масштабировать набор шаблонов hello [быстрый запуск Azure шаблоны](https://github.com/Azure/azure-quickstart-templates) определения параметров автоматического масштабирования. Можно также добавить существующий набор масштабирования tooan параметры автоматического масштабирования. Например этот сценарий Azure PowerShell добавляет набор масштабирования на основе ЦП автомасштабирования tooa:

```PowerShell

$subid = "yoursubscriptionid"
$rgname = "yourresourcegroup"
$vmssname = "yourscalesetname"
$location = "yourlocation" # e.g. southcentralus

$rule1 = New-AzureRmAutoscaleRule -MetricName "Percentage CPU" -MetricResourceId /subscriptions/$subid/resourceGroups/$rgname/providers/Microsoft.Compute/virtualMachineScaleSets/$vmssname -Operator GreaterThan -MetricStatistic Average -Threshold 60 -TimeGrain 00:01:00 -TimeWindow 00:05:00 -ScaleActionCooldown 00:05:00 -ScaleActionDirection Increase -ScaleActionValue 1
$rule2 = New-AzureRmAutoscaleRule -MetricName "Percentage CPU" -MetricResourceId /subscriptions/$subid/resourceGroups/$rgname/providers/Microsoft.Compute/virtualMachineScaleSets/$vmssname -Operator LessThan -MetricStatistic Average -Threshold 30 -TimeGrain 00:01:00 -TimeWindow 00:05:00 -ScaleActionCooldown 00:05:00 -ScaleActionDirection Decrease -ScaleActionValue 1
$profile1 = New-AzureRmAutoscaleProfile -DefaultCapacity 2 -MaximumCapacity 10 -MinimumCapacity 2 -Rules $rule1,$rule2 -Name "autoprofile1"
Add-AzureRmAutoscaleSetting -Location $location -Name "autosetting1" -ResourceGroup $rgname -TargetResourceId /subscriptions/$subid/resourceGroups/$rgname/providers/Microsoft.Compute/virtualMachineScaleSets/$vmssname -AutoscaleProfiles $profile1
```

В можно найти список tooscale допустимым метрики на [поддерживаемых метрик с помощью монитора Azure](../monitoring-and-diagnostics/monitoring-supported-metrics.md) под заголовком «Microsoft.Compute/virtualMachineScaleSets.» hello Дополнительные параметры автоматического масштабирования также доступны, включая Автомасштабирование на основе расписания и с помощью веб-перехватчиков toointegrate с системами предупреждения.

## <a name="monitoring-your-scale-set"></a>Мониторинг масштабируемого набора
Hello [портал Azure](https://portal.azure.com) шкалы списки задает и показывает их свойства. портал Hello также поддерживает операции управления. Вы можете их выполнять и в масштабируемых наборах, и на отдельных виртуальных машинах в наборе. портал Hello также предоставляет граф использования настраиваемых ресурсов. 

Если необходимо toosee или изменить hello базового определения JSON ресурс Azure, можно также использовать [обозревателя ресурсов Azure](https://resources.azure.com). Наборы масштабирования подходят под hello поставщика ресурсов Microsoft.Compute Azure. С этого сайта их можно будет увидеть, развернув hello ссылкам:

**Подписки** > **ваша подписка** > **resourceGroups** > **поставщики** > **Microsoft.Compute** > **virtualMachineScaleSets** > **ваш масштабируемый набор** и т. д.

## <a name="scale-set-scenarios"></a>Сценарии масштабируемого набора
В этом разделе перечислены стандартные сценарии с участием масштабируемых наборов. Эти сценарии используются в некоторых службах Azure более высокого уровня (таких как пакетная служба, Service Fabric и Служба контейнеров).

* **Использовать RDP или SSH tooconnect tooscale экземпляров**: внутри виртуальной сети создается набор масштабирования и отдельных виртуальных машин в наборе масштабирования hello не выделяются общих IP-адресов по умолчанию. Эта политика позволяет избежать расходов hello и расходов на управление выделение отдельных общедоступный IP-адрес адресов tooall hello узлов сетки вычислений. Если требуется направить внешних соединений tooscale набора виртуальных машин, можно настроить масштаб набор tooautomatically assign открытый IP адресов toonew виртуальных машин. В качестве альтернативы можно подключить tooVMs от других ресурсов в виртуальной сети, можно выделить общие IP-адреса, например, подсистемы балансировки нагрузки и автономных виртуальных машин. 
* **Подключиться с помощью правила преобразования сетевых адресов tooVMs**: создать общедоступный IP-адрес, назначьте его tooa балансировки нагрузки и определите пул NAT входящего трафика. Эти действия сопоставление портов на hello IP-адрес tooa порт на виртуальной Машине в наборе масштабирования hello. Например:
  
  | Источник | Исходный порт | Место назначения | Конечный порт |
  | --- | --- | --- | --- |
  |  Общедоступный IP-адрес |Порт 50000 |vmss\_0 |Порт 22 |
  |  Общедоступный IP-адрес |Порт 50001 |vmss\_1 |Порт 22 |
  |  Общедоступный IP-адрес |Порт 50002 |vmss\_2 |Порт 22 |
  
   В [в этом примере](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat), правил NAT являются определенных tooenable tooevery подключения SSH виртуальной Машины в наборе масштабирования, с помощью одного общедоступный IP-адрес решения.
  
   [В этом примере](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat) hello же с помощью удаленного рабочего СТОЛА и Windows.
* **Подключиться с помощью «jumpbox» tooVMs**: при создании набора масштабирования и автономной виртуальной Машины в hello же виртуальной сети, hello автономной виртуальной Машины и hello набор масштабирования виртуальной Машины могут подключаться tooone другой с использованием их внутренние IP-адреса, в соответствии с определением hello виртуальный сеть или подсеть. Если создать общедоступный IP-адрес и назначьте его toohello автономной виртуальной Машины, можно использовать RDP или SSH tooconnect toohello автономной виртуальной Машины. Затем можно соединить из набора, масштабирования tooyour машин экземпляров. На этом этапе вы могли заметить, что простой масштабируемый набор надежнее, чем автономная виртуальная машина с общедоступным IP-адресом, сконфигурированная по умолчанию.
  
   Например, [этот шаблон](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox) развертывает простой масштабируемый набор с использованием отдельной виртуальной машины. 
* **Набор экземпляров tooscale балансировки нагрузки**: Если требуется toodeliver рабочих tooa вычислительного кластера виртуальных машин по принципу циклического можно настроить балансировки нагрузки Azure с помощью правил балансировки нагрузки уровня 4 соответствующим образом. Можно определить зонды порты tooverify, приложение выполняется с помощью проверки связи с заданным протоколом, интервал и пути запроса. [Шлюз приложений Azure](https://azure.microsoft.com/services/application-gateway/) также поддерживает наборы масштабирования, 7-й уровень и более сложные сценарии балансировки нагрузки.
  
   [В этом примере](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-ubuntu-web-ssl) создает набор масштабирования, который запускает веб-серверов Apache, который использует нагрузки подсистемы балансировки нагрузки toobalance hello, получающий каждой виртуальной Машины. (Посмотрите тип ресурса Microsoft.Network/loadBalancers hello и параметров масштабирования виртуальных и extensionProfile в virtualMachineScaleSet.)

   [В примере Linux](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-ubuntu-app-gateway) и [Windows](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-app-gateway) используется шлюз приложений.  

* **Развертывание масштабируемого набора в качестве вычислительного кластера в диспетчере кластеров PaaS.** Иногда масштабируемые наборы называют рабочими ролями следующего поколения. Хотя допустимое описание его риск hello путаницу шкалы набора функций с компонентами облачных служб Azure. В этом смысле масштабируемые наборы предоставляют настоящую рабочую роль или рабочий ресурс. Они являются обобщенным вычислительным ресурсом, независимым от платформ и сред выполнения, который можно настроить и интегрировать с IaaS Azure Resource Manager.
  
   Рабочая роль облачных служб ограничена с точки зрения поддержки платформ и сред выполнения (только для образов платформы Windows). Но она также включает такие службы, как переключение виртуального IP-адреса, настраиваемые параметры обновления и определенные параметры развертывания для приложения или среды выполнения. Они либо *еще* недоступны в масштабируемых наборах, либо предоставляются другими службами PaaS более высокого уровня, например Azure Service Fabric. Масштабируемые наборы можно рассматривать как инфраструктуру, поддерживающую PaaS. Такие решения PaaS, как [Service Fabric](https://azure.microsoft.com/services/service-fabric/), созданы на основе этой инфраструктуры.
  
   В [примере использования](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-dcos) с таким подходом [Служба контейнеров Azure](https://azure.microsoft.com/services/container-service/) развертывает кластер на основе масштабируемых наборов с оркестратором контейнеров.

## <a name="scale-set-performance-and-scale-guidance"></a>Рекомендации по производительности и масштабированию набора
* Поддерживает набор масштабирования вверх too1 000 виртуальных машин. При создании и отправке пользовательских образов виртуальных Машин, hello ограничение равно 100. Рекомендации по использованию больших масштабируемых наборов виртуальных машин см. в [этой статье](virtual-machine-scale-sets-placement-groups.md).
* У вас toopre-создать наборы масштабирования toouse учетных записей хранилища Azure. Поддержка наборов масштабирования Azure управляемых дисках, которые устранения проблем с производительностью о hello количество дисков, на учетную запись хранения. Дополнительные сведения см. в статье [Масштабируемые наборы виртуальных машин Azure и управляемые диски](virtual-machine-scale-sets-managed-disks.md).
* Чтобы сократить время подготовки виртуальной машины, сделать этот процесс более прогнозируемым и улучшить производительность ввода-вывода, мы советуем использовать хранилище Azure класса Premium, а не службу хранилища Azure.
* Основная Квота Hello в регионе hello, в котором выполняется развертывание ограничивает hello число виртуальных машин, можно создать. Может потребоваться tooincrease поддержки toocontact квоту вычислений, даже при наличии высокого уровня ограничение на число ядер для использования облачных служб Azure сегодня. tooquery вашей квоты, выполните следующую команду Azure CLI: `azure vm list-usage`. или команды PowerShell `Get-AzureRmVMUsage`.

## <a name="frequently-asked-questions-for-scale-sets"></a>Часто задаваемые вопросы о масштабируемых наборах
**Вопрос.** Сколько виртуальных машин может входить в масштабируемый набор?

**Ответ.** Набор масштабирования может иметь 0 too1, 000 виртуальных машин на основе платформы образов, или 0 too100 виртуальных машин на основе пользовательских образов. 

**Вопрос.** Поддерживаются ли диски данных в масштабируемых наборах?

**Ответ.** Да. Набор масштабирования можно определить конфигурацию дисков данных, которая применяется tooall виртуальные машины в наборе hello. Дополнительные сведения см. в статье [Масштабируемые наборы ВМ Azure и подключенные диски данных](virtual-machine-scale-sets-attached-disks.md). Ниже перечислены другие варианты хранения данных.

* Файлы Azure (общие диски SMB).
* Диск операционной системы.
* временный диск (локальный, не поддерживаемый хранилищем Azure);
* Служба данных Azure (например, таблицы Azure, большие двоичные объекты Azure).
* внешняя служба данных (например, удаленная база данных).

**Вопрос.** Какие регионы Azure поддерживают масштабируемые наборы?

**Ответ.** Все регионы Azure поддерживают масштабируемые наборы.

**Вопрос.** Как создать масштабируемый набор с помощью пользовательского образа?

**Ответ.** Создайте управляемый диск на основе VHD-файла пользовательского образа и добавьте ссылку на него в шаблоне масштабируемого набора. [Ниже приведен пример](https://github.com/chagarw/MDPP/tree/master/101-vmss-custom-os).

**Вопрос.** Если уменьшить емкость набора my масштабирования из 20 too15, в которой будут удалены виртуальные машины?

**Ответ.** Виртуальные машины, удаляются из набора равномерно между доменами обновления и доступности toomaximize домены сбоя шкалы hello. Виртуальные машины с hello сначала удалить наибольший идентификаторы.

**Вопрос.** Что делать, если затем увеличить емкость hello в 15 too18?

**Ответ.** Если увеличить емкость too18 создаются три новые виртуальные машины. Каждый раз, идентификатор экземпляра виртуальной Машины hello увеличивается hello и предыдущее наибольшее значение (например, 20, 21, 22). Виртуальные машины распределяются между доменами сбоя и обновления.

**Вопрос.** Можно ли указать последовательность выполнения при использовании нескольких расширений в масштабируемом наборе?

**Ответ.** Не напрямую, но для расширения customScript hello сценарий может ожидать другого toofinish расширения. Дополнительные сведения можно получить на расширения виртуализации в записи блога hello [расширения виртуализации в набора масштабирования виртуальных Машин Azure](https://msftstack.wordpress.com/2016/05/12/extension-sequencing-in-azure-vm-scale-sets/).

**Вопрос.** Работают ли масштабируемые наборы с группами доступности Azure?

**Ответ.** Да. Масштабируемый набор является неявной группой доступности с 5 доменами сбоя и 5 доменами обновления. Масштаб наборов более чем 100 виртуальных машин, находящихся в нескольких *размещения группы*, являющихся наборами доступности эквивалентные toomultiple. Дополнительные сведения о группах размещения см. в статье [Работа с крупными масштабируемыми наборами виртуальных машин](virtual-machine-scale-sets-placement-groups.md). Группы доступности виртуальных машин могут существовать в hello же виртуальной сети, что набор масштабирования виртуальных машин. Общая конфигурация представляет собой узел элемента управления tooput виртуальных машин (которым часто требуется уникальный конфигурации) в группе доступности набор и поместить узлы данных в наборе масштабирования hello.

Можно найти дополнительные ответы tooquestions о масштабе задает в hello [масштабирования виртуальной машины Azure задает часто задаваемые вопросы о](virtual-machine-scale-sets-faq.md).
