---
title: "Автомасштабирование aaaTroubleshoot с наборы масштабирования виртуальных машин | Документы Microsoft"
description: "Устранение неполадок при автомасштабировании масштабируемых наборов виртуальных машин. Типичные проблемы, возникшие понять и каким образом tooresolve их."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: 4c9a70992348d87fb43646421a90a027bf400a17
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="3d00e-104">Устранение неполадок при автомасштабировании масштабируемых наборов виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="3d00e-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="3d00e-105">**Проблема** — вы создали инфраструктуру автоматическое масштабирование в диспетчере ресурсов Azure с помощью набора масштабирования виртуальных Машин — например, при развертывании шаблона следующим образом: https://github.com/Azure/azure-quickstart-templates/tree/master/201- vmss-bottle автомасштабирования — у вас есть определенные правила масштабирования и работает отлично, за исключением того, независимо от того, какая нагрузка поместить hello виртуальные машины, но не автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="3d00e-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on hello VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="3d00e-106">Действия по устранению неполадок</span><span class="sxs-lookup"><span data-stu-id="3d00e-106">Troubleshooting steps</span></span>
<span data-ttu-id="3d00e-107">Некоторые действия tooconsider включают:</span><span class="sxs-lookup"><span data-stu-id="3d00e-107">Some things tooconsider include:</span></span>

* <span data-ttu-id="3d00e-108">Сколько ядер у каждой виртуальной Машины и загружаются каждое ядро? выше шаблон быстрый запуск Azure пример Hello имеет do_work.php сценарий, который загружает одного ядра.</span><span class="sxs-lookup"><span data-stu-id="3d00e-108">How many cores does each VM have, and are you loading each core? hello example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="3d00e-109">Если вы используете виртуальную Машину, больше, чем одном ядре размер виртуальной Машины как Standard_A1 или D1, то потребуется toorun этой загрузки несколько раз.</span><span class="sxs-lookup"><span data-stu-id="3d00e-109">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need toorun this load multiple times.</span></span> <span data-ttu-id="3d00e-110">Узнать количество ядер в виртуальных машинах вам поможет статья [Размеры виртуальных машин в Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="3d00e-110">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="3d00e-111">Сколько виртуальных машин в hello набора масштабирования виртуальных Машин, делает работу с каждого из них?</span><span class="sxs-lookup"><span data-stu-id="3d00e-111">How many VMs in hello VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="3d00e-112">Событие для горизонтального масштабирования только происходить, когда hello среднее число ЦП по **все** hello виртуальные машины в наборе масштабирования превышает hello пороговое значение, со временем hello внутренней определить в правилах автоматического масштабирования hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-112">A scale out event will only take place when hello average CPU across **all** hello VMs in a scale set exceeds hello threshold value, over hello time internal defined in hello autoscale rules.</span></span>
* <span data-ttu-id="3d00e-113">Возможно, вы пропустили события масштабирования?</span><span class="sxs-lookup"><span data-stu-id="3d00e-113">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="3d00e-114">Убедитесь, что журналы аудита hello в hello портала Azure для масштабирования события.</span><span class="sxs-lookup"><span data-stu-id="3d00e-114">Check hello audit logs in hello Azure portal for scale events.</span></span> <span data-ttu-id="3d00e-115">Возможно, вы пропустили произошедшее увеличение или уменьшение масштаба.</span><span class="sxs-lookup"><span data-stu-id="3d00e-115">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="3d00e-116">Можно отфильтровать элементы, введя в соответствующее поле запрос "Масштаб".</span><span class="sxs-lookup"><span data-stu-id="3d00e-116">You can filter by “Scale”..</span></span>
  
    ![Журналы аудита][audit]
* <span data-ttu-id="3d00e-118">Отличаются ли пороговые значения для увеличения и уменьшения масштаба?</span><span class="sxs-lookup"><span data-stu-id="3d00e-118">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="3d00e-119">Предположим, что установить tooscale правило, если средняя загрузка ЦП больше 50% за 5 минут и tooscale в при средняя загрузка ЦП составляет менее 50%.</span><span class="sxs-lookup"><span data-stu-id="3d00e-119">Suppose you set a rule tooscale out when average CPU is greater than 50% over 5 minutes, and tooscale in when average CPU is less than 50%.</span></span> <span data-ttu-id="3d00e-120">Это приведет к «flapping» проблему при ЦП закрыть toothis порог, hello постоянно увеличение и уменьшение масштаба действия размер набора hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-120">This would cause a “flapping” problem when CPU usage is close toothis threshold, with scale actions constantly increasing and decreasing hello size of hello set.</span></span> <span data-ttu-id="3d00e-121">По этой причине hello автомасштабирования служба пытается tooprevent «неустойчивый», которой могут проявляться в виде не масштабируется.</span><span class="sxs-lookup"><span data-stu-id="3d00e-121">Because of this, hello autoscale service tries tooprevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="3d00e-122">Поэтому убедитесь, что горизонтального масштабирования и масштабирования в пороговые значения, существенно различающихся tooallow место между масштабирования.</span><span class="sxs-lookup"><span data-stu-id="3d00e-122">Therefore make sure your scale-out and scale-in thresholds are sufficiently different tooallow some space in between scaling.</span></span>
* <span data-ttu-id="3d00e-123">Вы сами написали шаблон JSON?</span><span class="sxs-lookup"><span data-stu-id="3d00e-123">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="3d00e-124">Это легко toomake ошибок, таким образом запуска с использованием шаблона, например друг над которой подтверждается toowork hello и внести небольшие добавочные изменения.</span><span class="sxs-lookup"><span data-stu-id="3d00e-124">It is easy toomake mistakes, so start with a template like hello one above which is proven toowork, and make small incremental changes.</span></span> 
* <span data-ttu-id="3d00e-125">Можете ли вы выполнить увеличение или уменьшение масштаба вручную?</span><span class="sxs-lookup"><span data-stu-id="3d00e-125">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="3d00e-126">Попробуйте вручную повторного развертывания hello ресурсов набора масштабирования виртуальных Машин с разных «объем» параметр toochange hello количеством виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="3d00e-126">Try redeploying hello VM Scale Set resource with a different “capacity” setting toochange hello number of VMs manually.</span></span> <span data-ttu-id="3d00e-127">Пример шаблона toodo, это здесь: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing — необходимо убедиться, что он имеет hello toomake шаблона hello tooedit же размер машины, как с помощью набора масштабирования.</span><span class="sxs-lookup"><span data-stu-id="3d00e-127">An example template toodo this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need tooedit hello template toomake sure it has hello same machine size as your Scale Set is using.</span></span> <span data-ttu-id="3d00e-128">Если успешно hello число виртуальных машин можно изменить вручную, затем известно, что проблема hello является изолированной tooautoscale.</span><span class="sxs-lookup"><span data-stu-id="3d00e-128">If you can successfully change hello number of VMs manually, then you know hello problem is isolated tooautoscale.</span></span>
* <span data-ttu-id="3d00e-129">Проверьте вашей Microsoft.Compute/virtualMachineScaleSet и ресурсов с помощью Microsoft.Insights в hello [обозревателя ресурсов Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="3d00e-129">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in hello [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="3d00e-130">Это незаменимый Устранение неполадок средства, в котором отображается состояние ресурсов Azure Resource Manager "hello".</span><span class="sxs-lookup"><span data-stu-id="3d00e-130">This is an indispensable troubleshooting tool which shows you hello state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="3d00e-131">Щелкните подписку и посмотрите на hello устраняются группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="3d00e-131">Click on your subscription and look at hello Resource Group you are troubleshooting.</span></span> <span data-ttu-id="3d00e-132">При использовании поставщика ресурсов вычислений hello рассмотрим hello набора масштабирования виртуальных Машин вы создали и проверьте hello представление экземпляра, в котором отображается hello состояние развертывания.</span><span class="sxs-lookup"><span data-stu-id="3d00e-132">Under hello Compute resource provider look at hello VM Scale Set you created and check hello Instance View, which shows you hello state of a deployment.</span></span> <span data-ttu-id="3d00e-133">Также следует проверьте представление экземпляра hello виртуальных машин в hello набора масштабирования виртуальных Машин.</span><span class="sxs-lookup"><span data-stu-id="3d00e-133">Also check hello instance view of VMs in hello VM Scale Set.</span></span> <span data-ttu-id="3d00e-134">Затем перейдите к поставщику ресурсов помощью Microsoft.Insights hello и убедитесь, что хорошо выглядят правил автомасштабирования hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-134">Then go into hello Microsoft.Insights resource provider and check hello autoscale rules look good.</span></span>
* <span data-ttu-id="3d00e-135">Работа hello диагностического расширения и отправке данных о производительности?</span><span class="sxs-lookup"><span data-stu-id="3d00e-135">Is hello Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="3d00e-136">**Обновление:** Azure автоматически не улучшенные toouse узел на основе метрик конвейера, который больше не требует установки toobe расширения диагностики.</span><span class="sxs-lookup"><span data-stu-id="3d00e-136">**Update:** Azure autoscale has been enhanced toouse a host based metrics pipeline which no longer requires a diagnostics extension toobe installed.</span></span> <span data-ttu-id="3d00e-137">Это означает, что hello Далее несколько абзацев больше не применяются при создании автоматического масштабирования приложения, использующего новый конвейер hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-137">This means hello next few paragraphs no longer apply if you create an autoscaling application using hello new pipeline.</span></span> <span data-ttu-id="3d00e-138">Является примером шаблоны Azure, которым были преобразованный toouse hello узла конвейера: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="3d00e-138">An example of Azure templates which have been converted toouse hello host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="3d00e-139">С помощью показателей на основе узла для автоматического масштабирования является наиболее подходящим для hello следующих причин:</span><span class="sxs-lookup"><span data-stu-id="3d00e-139">Using host based metrics for autoscale is better for hello following reasons:</span></span>
  
  * <span data-ttu-id="3d00e-140">Меньшее число частей как расширения диагностики не должны toobe установлен.</span><span class="sxs-lookup"><span data-stu-id="3d00e-140">Fewer moving parts as no diagnostics extensions need toobe installed.</span></span>
  * <span data-ttu-id="3d00e-141">Простые шаблоны.</span><span class="sxs-lookup"><span data-stu-id="3d00e-141">Simpler templates.</span></span> <span data-ttu-id="3d00e-142">Просто добавьте существующие шкалы правила автомасштабирования tooan аналитики набора шаблонов.</span><span class="sxs-lookup"><span data-stu-id="3d00e-142">Just add insights autoscale rules tooan existing scale set template.</span></span>
  * <span data-ttu-id="3d00e-143">Более надежная система отчетов и ускоренный запуск новых виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="3d00e-143">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="3d00e-144">Hello только причин можно с помощью диагностического расширения tookeep бы случай памяти диагностики отчеты или масштабирование.</span><span class="sxs-lookup"><span data-stu-id="3d00e-144">hello only reasons you might want tookeep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="3d00e-145">Метрики на основе узла не позволяют формировать отчеты о памяти.</span><span class="sxs-lookup"><span data-stu-id="3d00e-145">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="3d00e-146">С учетом только выполните hello оставшейся части этой статьи, если по-прежнему используется диагностического расширения для вашего автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="3d00e-146">With that in mind, only follow hello rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="3d00e-147">Автомасштабирование диспетчера ресурсов Azure можно работать (но больше не нужно) с помощью расширения ВМ, вызывается hello расширения диагностики.</span><span class="sxs-lookup"><span data-stu-id="3d00e-147">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called hello Diagnostics Extension.</span></span> <span data-ttu-id="3d00e-148">Он создает учетную запись хранилища производительности данных tooa, задаются в шаблоне hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-148">It emits performance data tooa storage account you define in hello template.</span></span> <span data-ttu-id="3d00e-149">Эти данные объединяются службой мониторинга Azure hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-149">This data is then aggregated by hello Azure Monitor service.</span></span>
    
    <span data-ttu-id="3d00e-150">Если hello службе аналитики не могут считывать данные из hello виртуальных машин, он должен toosend вам сообщение электронной почты — например если виртуальные машины hello, поэтому проверьте свою электронную почту (hello был указан при создании hello учетная запись Azure).</span><span class="sxs-lookup"><span data-stu-id="3d00e-150">If hello Insights service can’t read data from hello VMs, it is supposed toosend you an email – for example if hello VMs were down, so check your email (hello one you specified when creating hello Azure account).</span></span>
    
    <span data-ttu-id="3d00e-151">Можно также перейти, просматривать данные hello самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="3d00e-151">You can also go and look at hello data yourself.</span></span> <span data-ttu-id="3d00e-152">Рассмотрим hello учетной записи хранилища Azure с помощью обозревателя облака.</span><span class="sxs-lookup"><span data-stu-id="3d00e-152">Look at hello Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="3d00e-153">Например, с помощью hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), войдите и выберите hello подписки Azure, вы используете и hello имя на которые ссылается hello определения расширения диагностики в вашем развертывании учетная запись хранения диагностики шаблон...</span><span class="sxs-lookup"><span data-stu-id="3d00e-153">For example using hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick hello Azure subscription you’re using, and hello Diagnostics storage account name referenced in hello Diagnostics extension definition in your deployment template..</span></span>
    
    ![Cloud Explorer][explorer]
    
    <span data-ttu-id="3d00e-155">Здесь вы увидите множество таблиц хранения hello данные из каждой виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="3d00e-155">Here you will see a bunch of tables where hello data from each VM is being stored.</span></span> <span data-ttu-id="3d00e-156">Принимая Linux и hello метрики ЦП в качестве примера, взгляните на самой последней строки hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-156">Taking Linux and hello CPU metric as an example, look at hello most recent rows.</span></span> <span data-ttu-id="3d00e-157">обозревателе облако Hello Visual Studio поддерживает язык запросов, поэтому можно выполнить запрос наподобие «Timestamp gt datetime'2016-02-02T21:20:00Z "» toomake убедиться, что получить самые последние события hello (предполагается время представлено в формате UTC).</span><span class="sxs-lookup"><span data-stu-id="3d00e-157">hello Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” toomake sure you get hello most recent events (assume time is in UTC).</span></span> <span data-ttu-id="3d00e-158">Hello данные, отображаемые в существует соответствуют toohello масштабировать правила, которые вы настроили?</span><span class="sxs-lookup"><span data-stu-id="3d00e-158">Does hello data you see in there correspond toohello scale rules you set up?</span></span> <span data-ttu-id="3d00e-159">В следующем примере hello hello ЦП для машины 20 работы too100% увеличение объема hello последние 5 минут...</span><span class="sxs-lookup"><span data-stu-id="3d00e-159">In hello example below, hello CPU for machine 20 started increasing too100% over hello last 5 minutes..</span></span>
    
    ![Таблицы хранилища][tables]
    
    <span data-ttu-id="3d00e-161">Если hello данных отсутствует, затем он означает, что hello связана с диагностического расширения hello в hello виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="3d00e-161">If hello data is not there, then it implies hello problem is with hello diagnostic extension running in hello VMs.</span></span> <span data-ttu-id="3d00e-162">Если данные hello существует, это означает, что либо проблема на правила масштабирования или со службой аналитики hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-162">If hello data is there, it implies there is either a problem with your scale rules, or with hello Insights service.</span></span> <span data-ttu-id="3d00e-163">Проверьте [состояние Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="3d00e-163">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="3d00e-164">После стали шаги выполнения этого действия, если вы по-прежнему возникают проблемы автоматического масштабирования можно попробовать форумах hello [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), или [переполнение стека](http://stackoverflow.com/questions/tagged/azure), или журнала поддержки по телефону.</span><span class="sxs-lookup"><span data-stu-id="3d00e-164">Once you’ve been through these steps, if you are still having autoscale problems you could try hello forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="3d00e-165">Быть шаблон подготовленного tooshare hello и представление данных о производительности hello.</span><span class="sxs-lookup"><span data-stu-id="3d00e-165">Be prepared tooshare hello template and a view of hello performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png
