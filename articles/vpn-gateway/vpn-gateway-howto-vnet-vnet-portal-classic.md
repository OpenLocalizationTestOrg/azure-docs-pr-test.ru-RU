---
title: "Создание подключения между виртуальными сетями. Классический портал Azure | Документация Майкрософт"
description: "Как tooconnect Azure виртуальных сетей вместе с помощью PowerShell и hello классический портал Azure."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-service-management
ms.assetid: 
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/02/2017
ms.author: cherylmc
ms.openlocfilehash: f29c3c091d049ff96cf59f4c28ab86a100bcb5fc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="configure-a-vnet-to-vnet-connection-classic"></a>Настройка подключения между виртуальными сетями (классическая модель)

[!INCLUDE [deployment models](../../includes/vpn-gateway-classic-deployment-model-include.md)]

В этой статье показано, как toocreate шлюза VPN-подключение между виртуальными сетями. Hello виртуальные сети могут находиться в Здравствуйте, или же в разных регионах, и из hello таким же или разных подписках. Hello действия в этой статье относятся toohello классической модели развертывания и hello портал Azure. Можно также создать этой конфигурации с помощью средства развертывания или модель развертывания, выбрав другой вариант из hello после списка.

> [!div class="op_single_selector"]
> * [Портал Azure](vpn-gateway-howto-vnet-vnet-resource-manager-portal.md)
> * [PowerShell](vpn-gateway-vnet-vnet-rm-ps.md)
> * [Интерфейс командной строки Azure](vpn-gateway-howto-vnet-vnet-cli.md)
> * [Портал Azure (классический)](vpn-gateway-howto-vnet-vnet-portal-classic.md)
> * [Подключение с использованием разных моделей развертывания — портал Azure](vpn-gateway-connect-different-deployment-models-portal.md)
> * [Подключение с использованием разных моделей развертывания — PowerShell](vpn-gateway-connect-different-deployment-models-powershell.md)
>
>

![Виртуальная сеть tooVNet схема подключения](./media/vpn-gateway-howto-vnet-vnet-portal-classic/v2vclassic.png)

## <a name="about-vnet-to-vnet-connections"></a>О подключениях "виртуальная сеть — виртуальная сеть"

Подключение виртуальной сети tooanother виртуальной сети (VNet-VNet) в hello классической модели развертывания с помощью шлюза VPN — примерно tooconnecting локального сайта виртуальной сети tooan расположения. Оба типа подключения используйте tooprovide шлюза VPN защищенный туннель, с помощью IPsec/IKE.

Hello подключении виртуальных сетей могут находиться в разных подписках и разных регионах. Можно объединять связи tooVNet виртуальной сети с многосайтовыми конфигурациями. Это позволяет настраивать топологии сети, совмещающие распределенные подключения с подключениями между виртуальными сетями.

![Виртуальная сеть tooVNet подключений](./media/vpn-gateway-howto-vnet-vnet-portal-classic/aboutconnections.png)

### <a name="why"></a>Зачем нужна связь между виртуальными сетями?

Вы можете tooconnect виртуальных сетей для hello следующих причин:

* **Межрегиональная географическая избыточность и географическое присутствие**

  * Вы можете настроить собственную георепликацию или синхронизацию с безопасной связью без прохождения трафика через конечные точки с выходом в Интернет.
  * С помощью Azure Load Balancer и технологий кластеризации корпорации Майкрософт или сторонних производителей можно настроить высокодоступную рабочую нагрузку с геоизбыточностью в нескольких регионах Azure. Важный пример — tooset копии SQL Always On с группами доступности, распределение по нескольким регионам Azure.
* **Региональные многоуровневые приложения с четкой границей изоляции**

  * В пределах hello же регионе, можно настроить многоуровневые приложения с помощью нескольких виртуальных сетей, связанных друг с другом сильной изоляцией и защищенной связью между уровнями.
* **Обмен данными между подписками и организациями в Azure**

  * Если у вас есть несколько подписок Azure, то вы можете безопасно связывать рабочие нагрузки из разных подписок между виртуальными сетями.
  * Благодаря технологии защищенных сетей VPN в Azure для предприятий или поставщиков услуг возможен обмен данными между организациями.

Дополнительные сведения о подключениях к виртуальной сети для виртуальной сети см. в разделе [VNet-VNet вопросы](#faq) конце hello в этой статье.

### <a name="before-you-begin"></a>Перед началом работы

Перед началом этого упражнения, загрузите и установите последнюю версию hello hello командлеты PowerShell Azure службы управления (SM). Дополнительные сведения см. в разделе [как tooinstall и настройка Azure PowerShell](/powershell/azure/overview). Мы используем hello портал для большинства hello действия, но необходимо использовать PowerShell toocreate hello подключения между hello виртуальных сетей. Не удается создать hello подключений, с помощью портала Azure hello.

## <a name="plan"></a>Шаг 1. Планирование диапазонов IP-адресов

Это важные toodecide hello диапазоны, вы сможете использовать tooconfigure виртуальных сетей. Для этой конфигурации необходимо убедиться, что ни один из диапазонов виртуальной сети перекрываются друг с другом или с любыми hello локальных сетей, которым они подключены.

Hello следующей таблице показан пример того, как toodefine своих сетей Vnet. Диапазоны hello используются только в качестве примера. Запишите диапазоны hello для виртуальных сетей. Эти сведения будут необходимы для выполнения последующих действий.

**Пример**

| Виртуальная сеть | Пространство адресов | Регион | Подключается toolocal сетевой сайт |
|:--- |:--- |:--- |:--- |
| TestVNet1 |TestVNet1<br>(10.11.0.0/16)<br>(10.12.0.0/16) |Восток США |VNet4Local<br>(10.41.0.0/16)<br>(10.42.0.0/16) |
| TestVNet4 |TestVNet4<br>(10.41.0.0/16)<br>(10.42.0.0/16) |Запад США |VNet1Local<br>(10.11.0.0/16)<br>(10.12.0.0/16) |

## <a name="vnetvalues"></a>Шаг 2 — Создание виртуальных сетей hello

Создать две виртуальные сети в hello [портал Azure](https://portal.azure.com). Hello шаги toocreate классических виртуальных сетей, см. в разделе [Создание классической виртуальной сети](../virtual-network/virtual-networks-create-vnet-classic-pportal.md). 

При использовании портала toocreate hello классической виртуальной сети, необходимо перейти toohello колонки виртуальной сети, используя hello, выполнив действия, в противном случае параметр hello toocreate классической виртуальной сети не отображается:

1. Нажмите кнопку hello '+' tooopen hello колонки «Создать».
2. Введите в поле «Поиск hello marketplace» hello, «Виртуальной сети». Если вместо этого выберите сеть виртуальной сети "->", вы не будете toocreate параметр hello классической виртуальной сети.
3. Найдите «Виртуальной сети» из вернул список hello и щелкните его колонки виртуальной сети tooopen hello. 
4. В колонке hello виртуальной сети выберите «Классический» toocreate классической виртуальной сети. 

При использовании в данной статье в качестве упражнения можно использовать следующие примеры значений hello:

**Значения для TestVNet1**

Имя: TestVNet1<br>
Адресное пространство: 10.11.0.0/16, 10.12.0.0/16 (необязательно)<br>
Имя подсети: по умолчанию<br>
Диапазон адресов подсети: 10.11.0.1/24<br>
Группа ресурсов: ClassicRG<br>
Расположение: восточная часть США<br>
Подсеть шлюза: 10.11.1.0/27

**Значения для TestVNet4**

Имя: TestVNet4<br>
Адресное пространство: 10.41.0.0/16, 10.42.0.0/16 (необязательно)<br>
Имя подсети: по умолчанию<br>
Диапазон адресов подсети: 10.41.0.1/24<br>
Группа ресурсов: ClassicRG<br>
Расположение: Запад США<br>
Подсеть шлюза: 10.41.1.0/27

**При создании виртуальных сетей, имейте в виду hello следующие параметры:**

* **Адресные пространства виртуальной сети** — на странице приветствия адресные пространства виртуальной сети, укажите диапазон адресов hello, чтобы получить toouse виртуальной сети. Это hello динамические IP-адреса, которые будут назначены toohello виртуальных машин и экземпляров ролей в развертывании toothis виртуальной сети.<br>адрес Hello пробелы при выборе не должны перекрываться hello адресные пространства для перечисленных hello других виртуальных сетях или локальной расположений, которые эта виртуальная сеть будет подключаться к.

* **Расположение** — при создании виртуальную сеть можно связать с расположением Azure (регионом). Например следует toobe tooyour виртуальной сети, физически расположены на Западе США развернуты виртуальные машины, выберите это расположение. Невозможно изменить расположение hello, связанный с виртуальной сети после его создания.

**После создании виртуальных сетей, можно добавить hello следующие параметры:**

* **Адресное пространство** — дополнительное адресное пространство не является обязательным для этой конфигурации, но можно добавить дополнительное адресное пространство после создания hello виртуальной сети.

* **Подсети** — дополнительные подсети не обязательны для этой конфигурации, но может потребоваться toohave виртуальные машины в подсети, отдельной от экземпляров ролей.

* **DNS-серверы** — введите имя DNS-сервера hello и IP-адрес. Этот параметр не приводит к созданию DNS-сервера. Оно позволяет toospecify hello DNS-серверов требуется toouse для разрешения имен для этой виртуальной сети.

В этом разделе настройте тип подключения hello hello локального узла и создать шлюз hello.

## <a name="localsite"></a>Шаг 3 — Настройка hello локального сайта

Azure использует hello параметры, указанные в каждом toodetermine сайта локальной сети, как tooroute трафика между hello виртуальных сетей. Каждой виртуальной сети должен указывать соответствующие toohello локальную сеть, которую требуется tooroute трафика. Можно определить hello имя сайта локальной сети tooeach toorefer toouse. Это наиболее toouse что-нибудь описательное.

Например TestVNet1 подключается tooa сайта локальной сети, созданный с именем «VNet4Local». Параметры Hello VNet4Local TestVNet4 содержат префиксы адресов hello.

Hello локального сайта для каждой виртуальной сети является hello другой виртуальной сети. Следующие примеры значений Hello используются для нашей конфигурации:

| Виртуальная сеть | Пространство адресов | Регион | Подключается toolocal сетевой сайт |
|:--- |:--- |:--- |:--- |
| TestVNet1 |TestVNet1<br>(10.11.0.0/16)<br>(10.12.0.0/16) |Восток США |VNet4Local<br>(10.41.0.0/16)<br>(10.42.0.0/16) |
| TestVNet4 |TestVNet4<br>(10.41.0.0/16)<br>(10.42.0.0/16) |Запад США |VNet1Local<br>(10.11.0.0/16)<br>(10.12.0.0/16) |

1. Найдите TestVNet1 в hello портал Azure. В hello **VPN-подключений** раздел hello колонка, щелкните **шлюза**.

    ![Нет шлюза](./media/vpn-gateway-howto-vnet-vnet-portal-classic/nogateway.png)
2. На hello **нового VPN-подключения** выберите **сайт-сайт**.
3. Нажмите кнопку **локального сайта** tooopen hello локального сайта страницы и настройки параметров hello.
4. На hello **локального сайта** страницы, введите имя локального сайта. В нашем примере мы имя локального сайта hello «VNet4Local».
5. Для **IP-адреса VPN-шлюза** можно использовать любой необходимый вам IP-адрес, при условии, что он введен в правильном формате. Как правило для VPN-устройства используется hello фактический внешний IP-адрес. Однако для классического конфигурации виртуальной сети для виртуальной сети, использовать hello общедоступный IP-адрес, назначенный toohello шлюз для виртуальной сети. Учитывая, что вы еще не создали hello шлюз виртуальной сети, можно указать любой допустимый общедоступный IP-адрес как заполнитель.<br>Не оставляйте это поле пустым, так как оно является обязательным для данной конфигурации. Позже вернитесь к этим параметрам и настроить их hello соответствующей виртуальной сети шлюза IP-адресов, как только Azure его сгенерирует.
6. Для **адресное пространство клиента**, используйте hello адресное пространство hello другой виртуальной сети. См. Пример планирования tooyour. Нажмите кнопку **ОК** toosave параметров и возвращаемого назад toohello **нового VPN-подключения** колонку.

    ![локальный сайт](./media/vpn-gateway-howto-vnet-vnet-portal-classic/localsite.png)

## <a name="gw"></a>Шаг 4 — Создание шлюза виртуальной сети hello

В каждой виртуальной сети должен использоваться шлюз. Здравствуйте, маршруты шлюза виртуальной сети и шифрование трафика.

1. На hello **нового VPN-подключения** колонки, выберите hello флажок **немедленно создать шлюз**.
2. Щелкните **Подсеть, размер, маршрут**. На hello **настройки шлюза** колонка, щелкните **подсети**.
3. Имя подсети шлюза Hello заполняется автоматически с требуемым именем hello «GatewaySubnet». Hello **диапазона адресов** содержит hello IP-адресов, выделяемых toohello VPN-шлюз служб. В некоторых конфигурациях разрешить /29, но наиболее toouse подсеть шлюза/28 или /27 tooaccommodate будущих конфигураций, которые может потребоваться несколько IP-адресов для службы шлюза hello. В нашем примере параметров используется подсеть шлюза 10.11.1.0/27. Настроить hello адресное пространство, а затем нажмите кнопку **ОК**.
4. Настройка hello **размер шлюза**. Этот параметр определяет toohello [номер SKU шлюза](vpn-gateway-about-vpn-gateway-settings.md#gwsku).
5. Настройка hello **типа маршрутизации**. Здравствуйте тип маршрутизации для этой конфигурации, должна быть **динамическое**. Нельзя изменить тип маршрутизации hello позже, не разделять hello шлюз и создайте новую.
6. Нажмите кнопку **ОК**.
7. На hello **нового VPN-подключения** колонка, щелкните **ОК** toobegin Создание шлюза виртуальной сети hello. Создание шлюза часто занимает 45 минут или более, в зависимости от выбранного шлюза hello SKU.

## <a name="vnet4settings"></a>Шаг 5. Настройка параметров TestVNet4

Повторите шаги hello слишком[создать локальный узел](#localsite) и [создать шлюз виртуальной сети hello](#gw) tooconfigure TestVNet4, подставив hello значения по мере необходимости. Если вы выполняете в качестве упражнения, использовать hello [примеры значений](#vnetvalues).

## <a name="updatelocal"></a>Шаг 6. обновление hello локальных сайтов

После создания шлюзов виртуальной сети для обеих виртуальных сетей необходимо скорректировать локальных сайтов hello **IP-адрес шлюза VPN** значения.

|Имя виртуальной сети|Подключенный сайт|IP-адрес шлюза|
|:--- |:--- |:--- |
|TestVNet1|VNet4Local|IP-адрес VPN-шлюза для TestVNet4|
|TestVNet4|VNet1Local|IP-адрес VPN-шлюза для TestVNet1|

### <a name="part-1---get-hello-virtual-network-gateway-public-ip-address"></a>Часть 1 — Get hello виртуальной сети шлюза общедоступный IP-адрес

1. Найдите виртуальной сети в hello портал Azure.
2. Нажмите кнопку tooopen hello виртуальной сети **Обзор** колонку. В колонке hello в **VPN-подключений**, можно просмотреть hello IP-адрес для шлюза виртуальной сети.

  ![Общедоступный IP-адрес](./media/vpn-gateway-howto-vnet-vnet-portal-classic/publicIP.png)
3. Скопируйте hello IP-адрес. Используется в следующем разделе hello.
4. Повторите эти шаги для TestVNet4.

### <a name="part-2---modify-hello-local-sites"></a>Часть 2 — изменить hello локальных сайтов

1. Найдите виртуальной сети в hello портал Azure.
2. На hello виртуальной сети **Обзор** колонка, щелкните hello локального сайта.

  ![Созданный локальный сайт](./media/vpn-gateway-howto-vnet-vnet-portal-classic/local.png)
3. На hello **для межсайтовых подключений VPN** колонка, щелкните имя локального сайта hello, которые должны toomodify hello.

  ![Открытие локального сайта](./media/vpn-gateway-howto-vnet-vnet-portal-classic/openlocal.png)
4. Нажмите кнопку hello **локального сайта** нужных toomodify.

  ![изменение сайта](./media/vpn-gateway-howto-vnet-vnet-portal-classic/connections.png)
5. Обновление hello **IP-адрес шлюза VPN** и нажмите кнопку **ОК** toosave hello параметры.

  ![IP-адрес шлюза](./media/vpn-gateway-howto-vnet-vnet-portal-classic/gwupdate.png)
6. Здравствуйте, закройте другие модули.
7. Повторите эти шаги для TestVNet4.

## <a name="getvalues"></a>Шаг 7. Получение значения из файла конфигурации сети hello

При создании классического виртуальных сетей в hello портал Azure hello имя, которое можно просмотреть не hello полное имя, используемое для PowerShell. Например, виртуальную сеть, которая отображается с именем toobe **TestVNet1** портале hello, возможно, гораздо более длинное имя файла конфигурации сети hello. Hello имя может выглядеть примерно так: **ClassicRG TestVNet1 группы**. При создании подключения. Это важно toouse hello значения, отображаемые в файл конфигурации сети hello.

В hello, выполнив действия вы будете подключаться tooyour учетная запись Azure и загрузки и просматривать hello сетевой конфигурации файла tooobtain hello значения, которые необходимы для подключения.

1. Загрузите и установите последнюю версию hello hello командлеты PowerShell Azure службы управления (SM). Дополнительные сведения см. в разделе [как tooinstall и настройка Azure PowerShell](/powershell/azure/overview).

2. Откройте консоль PowerShell с повышенными правами и подключите tooyour учетную запись. Используйте следующий пример toohelp подключении hello.

  ```powershell
  Login-AzureRmAccount
  ```

  Проверьте hello подписки для учетной записи hello.

  ```powershell
  Get-AzureRmSubscription
  ```

  При наличии нескольких подписок выберите подписку hello, что требуется toouse.

  ```powershell
  Select-AzureRmSubscription -SubscriptionName "Replace_with_your_subscription_name"
  ```

  Затем используйте следующий командлет tooadd hello tooPowerShell вашей подписки Azure для hello классической модели развертывания.

  ```powershell
  Add-AzureAccount
  ```
3. Экспортировать и просмотреть файл конфигурации сети hello. Создайте каталог на компьютере, а затем экспортировать каталог toohello файла конфигурации сети hello. В этом примере файл конфигурации сети hello экспортируется слишком**C:\AzureNet**.

  ```powershell
  Get-AzureVNetConfig -ExportToFile C:\AzureNet\NetworkConfig.xml
  ```
4. Откройте файл hello с именами текстовый редактор и представление hello для виртуальных сетей и узлов. Они будут hello имя, используемое при создании подключений.<br>Имена виртуальных сетей перечислены как **VirtualNetworkSite name =**.<br>Имена сайтов перечислены как **LocalNetworkSiteRef name =**.

## <a name="createconnections"></a>Шаг 8 — Создание hello шлюза VPN-подключений

После выполнения всех предыдущих шагов hello, можно установить предварительные общие ключи IPsec/IKE hello и создать подключение hello. Для этого набора действий используется только PowerShell. Подключения VNet-VNet для hello классической модели развертывания нельзя настроить в hello портал Azure.

В примерах hello Обратите внимание, что hello общего ключа является точно hello таким же. всегда должна соответствовать Hello общего ключа. Быть убедиться, что tooreplace значениями hello в этих примерах на hello точные имена для виртуальных сетей и сайтов локальной сети.

1. Создание подключения tooTestVNet4 TestVNet1 hello.

  ```powershell
  Set-AzureVNetGatewayKey -VNetName 'Group ClassicRG TestVNet1' `
  -LocalNetworkSiteName '17BE5E2C_VNet4Local' -SharedKey A1b2C3D4
  ```
2. Создание подключения tooTestVNet1 TestVNet4 hello.

  ```powershell
  Set-AzureVNetGatewayKey -VNetName 'Group ClassicRG TestVNet4' `
  -LocalNetworkSiteName 'F7F7BFC7_VNet1Local' -SharedKey A1b2C3D4
  ```
3. Дождитесь подключения tooinitialize hello. Инициализирован hello, hello состояние после «Успех».

  ```
  Error          :
  HttpStatusCode : OK
  Id             :
  Status         : Successful
  RequestId      :
  StatusCode     : OK
  ```

## <a name="faq"></a>Рекомендации по работе с подключением типа "виртуальная сеть — виртуальная сеть" для классических виртуальных сетей
* Hello виртуальные сети могут находиться в hello же или разных подписках.
* Hello виртуальные сети могут находиться в hello тот же или другой Azure регионах (расположениях).
* Облачная служба или конечная точка балансировки нагрузки не может распространяться на виртуальные сети, даже если они соединены друг с другом.
* Для подключения нескольких виртуальных сетей друг к другу не требуются VPN-устройства.
* Подключения между виртуальными сетями поддерживает подключение виртуальных сетей Azure. Не поддерживает подключать виртуальные машины или облачные службы, которые не являются развертывать tooa виртуальной сети.
* Для подключения "виртуальная сеть — виртуальная сеть" требуются шлюзы с динамической маршрутизацией. Шлюзы Azure со статической маршрутизацией не поддерживаются.
* Подключение к виртуальной сети можно использовать одновременно с многосайтовыми VPN-подключениями. Не более 10 VPN-туннелей для VPN-шлюза виртуальной сети, подключение tooeither другими виртуальными сетями или сайтами локальной.
* Здравствуйте, адресные пространства виртуальных сетей hello и локальных сайтов локальной сети не должны перекрываться. Пересекающиеся адресные пространства вызовут hello создания виртуальных сетей или отправки toofail файлов конфигурации netcfg.
* Избыточные туннели между парой виртуальных сетей не поддерживаются.
* Все Туннели VPN для hello виртуальной сети, включая VPN P2S, совместно использовать hello доступной пропускной способности для VPN-шлюз hello и hello же SLA времени непрерывной работы шлюза VPN в Azure.
* Виртуальная сеть — сеть проходит через hello Azure магистрали.

## <a name="next-steps"></a>Дальнейшие действия
Проверьте подключения. Дополнительные сведения см. в статье [Проверка подключения VPN-шлюза](vpn-gateway-verify-connection-resource-manager.md).
