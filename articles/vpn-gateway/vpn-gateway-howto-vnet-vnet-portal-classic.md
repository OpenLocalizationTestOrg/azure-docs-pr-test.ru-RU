---
title: "Создание подключения между виртуальными сетями. Классический портал Azure | Документация Майкрософт"
description: "Узнайте, как подключить между собой виртуальные сети Azure, используя PowerShell и классический портал Azure."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-service-management
ms.assetid: 
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/02/2017
ms.author: cherylmc
ms.openlocfilehash: 77097d59077cd8e199acdb5dc0d8427369565eea
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="configure-a-vnet-to-vnet-connection-classic"></a><span data-ttu-id="bf36b-103">Настройка подключения между виртуальными сетями (классическая модель)</span><span class="sxs-lookup"><span data-stu-id="bf36b-103">Configure a VNet-to-VNet connection (classic)</span></span>

[!INCLUDE [deployment models](../../includes/vpn-gateway-classic-deployment-model-include.md)]

<span data-ttu-id="bf36b-104">В этой статье показано, как создать подключение VPN-шлюза между виртуальными сетями.</span><span class="sxs-lookup"><span data-stu-id="bf36b-104">This article shows you how to create a VPN gateway connection between virtual networks.</span></span> <span data-ttu-id="bf36b-105">Виртуальные сети могут относиться к одному или разным регионам и к одной или разным подпискам.</span><span class="sxs-lookup"><span data-stu-id="bf36b-105">The virtual networks can be in the same or different regions, and from the same or different subscriptions.</span></span> <span data-ttu-id="bf36b-106">Приведенные в этой статье инструкции относятся к классической модели развертывания и порталу Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-106">The steps in this article apply to the classic deployment model and the Azure portal.</span></span> <span data-ttu-id="bf36b-107">Эту конфигурацию также можно создать с помощью разных средств или моделей развертывания, выбрав вариант из следующего списка:</span><span class="sxs-lookup"><span data-stu-id="bf36b-107">You can also create this configuration using a different deployment tool or deployment model by selecting a different option from the following list:</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="bf36b-108">Портал Azure</span><span class="sxs-lookup"><span data-stu-id="bf36b-108">Azure portal</span></span>](vpn-gateway-howto-vnet-vnet-resource-manager-portal.md)
> * [<span data-ttu-id="bf36b-109">PowerShell</span><span class="sxs-lookup"><span data-stu-id="bf36b-109">PowerShell</span></span>](vpn-gateway-vnet-vnet-rm-ps.md)
> * [<span data-ttu-id="bf36b-110">Интерфейс командной строки Azure</span><span class="sxs-lookup"><span data-stu-id="bf36b-110">Azure CLI</span></span>](vpn-gateway-howto-vnet-vnet-cli.md)
> * [<span data-ttu-id="bf36b-111">Портал Azure (классический)</span><span class="sxs-lookup"><span data-stu-id="bf36b-111">Azure portal (classic)</span></span>](vpn-gateway-howto-vnet-vnet-portal-classic.md)
> * [<span data-ttu-id="bf36b-112">Подключение с использованием разных моделей развертывания — портал Azure</span><span class="sxs-lookup"><span data-stu-id="bf36b-112">Connect different deployment models - Azure portal</span></span>](vpn-gateway-connect-different-deployment-models-portal.md)
> * [<span data-ttu-id="bf36b-113">Подключение с использованием разных моделей развертывания — PowerShell</span><span class="sxs-lookup"><span data-stu-id="bf36b-113">Connect different deployment models - PowerShell</span></span>](vpn-gateway-connect-different-deployment-models-powershell.md)
>
>

![Схема подключения между виртуальными сетями](./media/vpn-gateway-howto-vnet-vnet-portal-classic/v2vclassic.png)

## <a name="about-vnet-to-vnet-connections"></a><span data-ttu-id="bf36b-115">О подключениях "виртуальная сеть — виртуальная сеть"</span><span class="sxs-lookup"><span data-stu-id="bf36b-115">About VNet-to-VNet connections</span></span>

<span data-ttu-id="bf36b-116">Подключение типа "виртуальная сеть — виртуальная сеть" в классической модели развертывания через VPN-шлюз похоже на подключение виртуальной сети к локальному сайту.</span><span class="sxs-lookup"><span data-stu-id="bf36b-116">Connecting a virtual network to another virtual network (VNet-to-VNet) in the classic deployment model using a VPN gateway is similar to connecting a virtual network to an on-premises site location.</span></span> <span data-ttu-id="bf36b-117">В обоих типах подключений используется VPN-шлюз для создания защищенного туннеля, использующего IPsec/IKE.</span><span class="sxs-lookup"><span data-stu-id="bf36b-117">Both connectivity types use a VPN gateway to provide a secure tunnel using IPsec/IKE.</span></span>

<span data-ttu-id="bf36b-118">Подключаемые виртуальные сети могут иметь разные подписки в разных регионах.</span><span class="sxs-lookup"><span data-stu-id="bf36b-118">The VNets you connect can be in different subscriptions and different regions.</span></span> <span data-ttu-id="bf36b-119">Можно комбинировать подключение "виртуальная сеть — виртуальная сеть" с многосайтовыми конфигурациями.</span><span class="sxs-lookup"><span data-stu-id="bf36b-119">You can combine VNet to VNet communication with multi-site configurations.</span></span> <span data-ttu-id="bf36b-120">Это позволяет настраивать топологии сети, совмещающие распределенные подключения с подключениями между виртуальными сетями.</span><span class="sxs-lookup"><span data-stu-id="bf36b-120">This lets you establish network topologies that combine cross-premises connectivity with inter-virtual network connectivity.</span></span>

![Подключения типа "виртуальная сеть — виртуальная сеть"](./media/vpn-gateway-howto-vnet-vnet-portal-classic/aboutconnections.png)

### <span data-ttu-id="bf36b-122"><a name="why"></a>Зачем нужна связь между виртуальными сетями?</span><span class="sxs-lookup"><span data-stu-id="bf36b-122"><a name="why"></a>Why connect virtual networks?</span></span>

<span data-ttu-id="bf36b-123">Вам может потребоваться подключить виртуальные сети по следующим причинам.</span><span class="sxs-lookup"><span data-stu-id="bf36b-123">You may want to connect virtual networks for the following reasons:</span></span>

* <span data-ttu-id="bf36b-124">**Межрегиональная географическая избыточность и географическое присутствие**</span><span class="sxs-lookup"><span data-stu-id="bf36b-124">**Cross region geo-redundancy and geo-presence**</span></span>

  * <span data-ttu-id="bf36b-125">Вы можете настроить собственную георепликацию или синхронизацию с безопасной связью без прохождения трафика через конечные точки с выходом в Интернет.</span><span class="sxs-lookup"><span data-stu-id="bf36b-125">You can set up your own geo-replication or synchronization with secure connectivity without going over Internet-facing endpoints.</span></span>
  * <span data-ttu-id="bf36b-126">С помощью Azure Load Balancer и технологий кластеризации корпорации Майкрософт или сторонних производителей можно настроить высокодоступную рабочую нагрузку с геоизбыточностью в нескольких регионах Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-126">With Azure Load Balancer and Microsoft or third-party clustering technology, you can set up highly available workload with geo-redundancy across multiple Azure regions.</span></span> <span data-ttu-id="bf36b-127">Одним из важных примеров является настройка SQL Always On с группами доступности, распределенными между несколькими регионами Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-127">One important example is to set up SQL Always On with Availability Groups spreading across multiple Azure regions.</span></span>
* <span data-ttu-id="bf36b-128">**Региональные многоуровневые приложения с четкой границей изоляции**</span><span class="sxs-lookup"><span data-stu-id="bf36b-128">**Regional multi-tier applications with strong isolation boundary**</span></span>

  * <span data-ttu-id="bf36b-129">В одном регионе можно настроить многоуровневые приложения с использованием нескольких связанных друг с другом виртуальных сетей с сильной изоляцией и защищенной связью между уровнями.</span><span class="sxs-lookup"><span data-stu-id="bf36b-129">Within the same region, you can set up multi-tier applications with multiple VNets connected together with strong isolation and secure inter-tier communication.</span></span>
* <span data-ttu-id="bf36b-130">**Обмен данными между подписками и организациями в Azure**</span><span class="sxs-lookup"><span data-stu-id="bf36b-130">**Cross subscription, inter-organization communication in Azure**</span></span>

  * <span data-ttu-id="bf36b-131">Если у вас есть несколько подписок Azure, то вы можете безопасно связывать рабочие нагрузки из разных подписок между виртуальными сетями.</span><span class="sxs-lookup"><span data-stu-id="bf36b-131">If you have multiple Azure subscriptions, you can connect workloads from different subscriptions together securely between virtual networks.</span></span>
  * <span data-ttu-id="bf36b-132">Благодаря технологии защищенных сетей VPN в Azure для предприятий или поставщиков услуг возможен обмен данными между организациями.</span><span class="sxs-lookup"><span data-stu-id="bf36b-132">For enterprises or service providers, you can enable cross-organization communication with secure VPN technology within Azure.</span></span>

<span data-ttu-id="bf36b-133">См. дополнительные сведения в разделе с [часто задаваемыми вопросами о подключениях типа "виртуальная сеть — виртуальная сеть"](#faq) в конце этой статьи.</span><span class="sxs-lookup"><span data-stu-id="bf36b-133">For more information about VNet-to-VNet connections, see [VNet-to-VNet considerations](#faq) at the end of this article.</span></span>

### <a name="before-you-begin"></a><span data-ttu-id="bf36b-134">Перед началом работы</span><span class="sxs-lookup"><span data-stu-id="bf36b-134">Before you begin</span></span>

<span data-ttu-id="bf36b-135">Перед началом упражнения скачайте и установите последнюю версию командлетов PowerShell для управления службами Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-135">Before beginning this exercise, download and install the latest version of the Azure Service Management (SM) PowerShell cmdlets.</span></span> <span data-ttu-id="bf36b-136">Дополнительные сведения см. в статье [Установка и настройка Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="bf36b-136">For more information, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span> <span data-ttu-id="bf36b-137">Мы используем портал для большинства операций, но для создания подключений между виртуальными сетями нужно использовать PowerShell.</span><span class="sxs-lookup"><span data-stu-id="bf36b-137">We use the portal for most of the steps, but you must use PowerShell to create the connections between the VNets.</span></span> <span data-ttu-id="bf36b-138">Создать соединения с помощью портала Azure невозможно.</span><span class="sxs-lookup"><span data-stu-id="bf36b-138">You can't create the connections using the Azure portal.</span></span>

## <span data-ttu-id="bf36b-139"><a name="plan"></a>Шаг 1. Планирование диапазонов IP-адресов</span><span class="sxs-lookup"><span data-stu-id="bf36b-139"><a name="plan"></a>Step 1 - Plan your IP address ranges</span></span>

<span data-ttu-id="bf36b-140">Важно определить диапазоны адресов, которые будут использоваться при настройке виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="bf36b-140">It’s important to decide the ranges that you’ll use to configure your virtual networks.</span></span> <span data-ttu-id="bf36b-141">При настройке необходимо убедиться в том, что никакие из диапазонов виртуальных сетей или диапазонов локальных сетей, к которым они подключены, никак не перекрываются между собой.</span><span class="sxs-lookup"><span data-stu-id="bf36b-141">For this configuration, you must make sure that none of your VNet ranges overlap with each other, or with any of the local networks that they connect to.</span></span>

<span data-ttu-id="bf36b-142">В таблице ниже показан пример определения виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="bf36b-142">The following table shows an example of how to define your VNets.</span></span> <span data-ttu-id="bf36b-143">Используйте указанные диапазоны только в качестве примера.</span><span class="sxs-lookup"><span data-stu-id="bf36b-143">Use the ranges as a guideline only.</span></span> <span data-ttu-id="bf36b-144">Запишите диапазоны для своих виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="bf36b-144">Write down the ranges for your virtual networks.</span></span> <span data-ttu-id="bf36b-145">Эти сведения будут необходимы для выполнения последующих действий.</span><span class="sxs-lookup"><span data-stu-id="bf36b-145">You need this information for later steps.</span></span>

<span data-ttu-id="bf36b-146">**Пример**</span><span class="sxs-lookup"><span data-stu-id="bf36b-146">**Example**</span></span>

| <span data-ttu-id="bf36b-147">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="bf36b-147">Virtual Network</span></span> | <span data-ttu-id="bf36b-148">Пространство адресов</span><span class="sxs-lookup"><span data-stu-id="bf36b-148">Address Space</span></span> | <span data-ttu-id="bf36b-149">Регион</span><span class="sxs-lookup"><span data-stu-id="bf36b-149">Region</span></span> | <span data-ttu-id="bf36b-150">Подключается к сайту локальной сети</span><span class="sxs-lookup"><span data-stu-id="bf36b-150">Connects to local network site</span></span> |
|:--- |:--- |:--- |:--- |
| <span data-ttu-id="bf36b-151">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="bf36b-151">TestVNet1</span></span> |<span data-ttu-id="bf36b-152">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="bf36b-152">TestVNet1</span></span><br><span data-ttu-id="bf36b-153">(10.11.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-153">(10.11.0.0/16)</span></span><br><span data-ttu-id="bf36b-154">(10.12.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-154">(10.12.0.0/16)</span></span> |<span data-ttu-id="bf36b-155">Восток США</span><span class="sxs-lookup"><span data-stu-id="bf36b-155">East US</span></span> |<span data-ttu-id="bf36b-156">VNet4Local</span><span class="sxs-lookup"><span data-stu-id="bf36b-156">VNet4Local</span></span><br><span data-ttu-id="bf36b-157">(10.41.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-157">(10.41.0.0/16)</span></span><br><span data-ttu-id="bf36b-158">(10.42.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-158">(10.42.0.0/16)</span></span> |
| <span data-ttu-id="bf36b-159">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="bf36b-159">TestVNet4</span></span> |<span data-ttu-id="bf36b-160">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="bf36b-160">TestVNet4</span></span><br><span data-ttu-id="bf36b-161">(10.41.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-161">(10.41.0.0/16)</span></span><br><span data-ttu-id="bf36b-162">(10.42.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-162">(10.42.0.0/16)</span></span> |<span data-ttu-id="bf36b-163">Запад США</span><span class="sxs-lookup"><span data-stu-id="bf36b-163">West US</span></span> |<span data-ttu-id="bf36b-164">VNet1Local</span><span class="sxs-lookup"><span data-stu-id="bf36b-164">VNet1Local</span></span><br><span data-ttu-id="bf36b-165">(10.11.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-165">(10.11.0.0/16)</span></span><br><span data-ttu-id="bf36b-166">(10.12.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-166">(10.12.0.0/16)</span></span> |

## <span data-ttu-id="bf36b-167"><a name="vnetvalues"></a>Шаг 2. Создание виртуальных сетей</span><span class="sxs-lookup"><span data-stu-id="bf36b-167"><a name="vnetvalues"></a>Step 2 - Create the virtual networks</span></span>

<span data-ttu-id="bf36b-168">Создайте две виртуальные сети на [портале Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="bf36b-168">Create two virtual networks in the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="bf36b-169">Инструкции по созданию классических виртуальных сетей см. в [этой статье](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="bf36b-169">For the steps to create classic virtual networks, see [Create a classic virtual network](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span></span> 

<span data-ttu-id="bf36b-170">Если вы создаете классическую виртуальную сеть с помощью портала, открывайте колонку виртуальной сети с помощью приведенных ниже инструкций. В противном случае команда создания классической виртуальной сети не отобразится.</span><span class="sxs-lookup"><span data-stu-id="bf36b-170">When using the portal to create a classic virtual network, you must navigate to the virtual network blade by using the following steps, otherwise the option to create a classic virtual network does not appear:</span></span>

1. <span data-ttu-id="bf36b-171">Нажмите кнопку "+", чтобы открыть колонку "Создать".</span><span class="sxs-lookup"><span data-stu-id="bf36b-171">Click the '+' to open the 'New' blade.</span></span>
2. <span data-ttu-id="bf36b-172">В поле "Поиск по Marketplace" введите запрос "Виртуальная сеть".</span><span class="sxs-lookup"><span data-stu-id="bf36b-172">In the 'Search the marketplace' field, type 'Virtual Network'.</span></span> <span data-ttu-id="bf36b-173">Если вместо этого вы выберете "Сети" -> "Виртуальная сеть", команда создания классической виртуальной сети не отобразится.</span><span class="sxs-lookup"><span data-stu-id="bf36b-173">If you instead, select Networking -> Virtual Network, you will not get the option to create a classic VNet.</span></span>
3. <span data-ttu-id="bf36b-174">Найдите в результатах поиска запись "Виртуальная сеть" и щелкните ее. Откроется колонка "Виртуальная сеть".</span><span class="sxs-lookup"><span data-stu-id="bf36b-174">Locate 'Virtual Network' from the returned list and click it to open the Virtual Network blade.</span></span> 
4. <span data-ttu-id="bf36b-175">В колонке виртуальной сети выберите "Классическая", чтобы создать классическую виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="bf36b-175">On the virtual network blade, select 'Classic' to create a classic VNet.</span></span> 

<span data-ttu-id="bf36b-176">Если вы используете эту статью в качестве упражнения, можно воспользоваться следующими примерами значений.</span><span class="sxs-lookup"><span data-stu-id="bf36b-176">If you are using this article as an exercise, you can use the following example values:</span></span>

<span data-ttu-id="bf36b-177">**Значения для TestVNet1**</span><span class="sxs-lookup"><span data-stu-id="bf36b-177">**Values for TestVNet1**</span></span>

<span data-ttu-id="bf36b-178">Имя: TestVNet1</span><span class="sxs-lookup"><span data-stu-id="bf36b-178">Name: TestVNet1</span></span><br>
<span data-ttu-id="bf36b-179">Адресное пространство: 10.11.0.0/16, 10.12.0.0/16 (необязательно)</span><span class="sxs-lookup"><span data-stu-id="bf36b-179">Address space: 10.11.0.0/16, 10.12.0.0/16 (optional)</span></span><br>
<span data-ttu-id="bf36b-180">Имя подсети: по умолчанию</span><span class="sxs-lookup"><span data-stu-id="bf36b-180">Subnet name: default</span></span><br>
<span data-ttu-id="bf36b-181">Диапазон адресов подсети: 10.11.0.1/24</span><span class="sxs-lookup"><span data-stu-id="bf36b-181">Subnet address range: 10.11.0.1/24</span></span><br>
<span data-ttu-id="bf36b-182">Группа ресурсов: ClassicRG</span><span class="sxs-lookup"><span data-stu-id="bf36b-182">Resource group: ClassicRG</span></span><br>
<span data-ttu-id="bf36b-183">Расположение: восточная часть США</span><span class="sxs-lookup"><span data-stu-id="bf36b-183">Location: East US</span></span><br>
<span data-ttu-id="bf36b-184">Подсеть шлюза: 10.11.1.0/27</span><span class="sxs-lookup"><span data-stu-id="bf36b-184">GatewaySubnet: 10.11.1.0/27</span></span>

<span data-ttu-id="bf36b-185">**Значения для TestVNet4**</span><span class="sxs-lookup"><span data-stu-id="bf36b-185">**Values for TestVNet4**</span></span>

<span data-ttu-id="bf36b-186">Имя: TestVNet4</span><span class="sxs-lookup"><span data-stu-id="bf36b-186">Name: TestVNet4</span></span><br>
<span data-ttu-id="bf36b-187">Адресное пространство: 10.41.0.0/16, 10.42.0.0/16 (необязательно)</span><span class="sxs-lookup"><span data-stu-id="bf36b-187">Address space: 10.41.0.0/16, 10.42.0.0/16 (optional)</span></span><br>
<span data-ttu-id="bf36b-188">Имя подсети: по умолчанию</span><span class="sxs-lookup"><span data-stu-id="bf36b-188">Subnet name: default</span></span><br>
<span data-ttu-id="bf36b-189">Диапазон адресов подсети: 10.41.0.1/24</span><span class="sxs-lookup"><span data-stu-id="bf36b-189">Subnet address range: 10.41.0.1/24</span></span><br>
<span data-ttu-id="bf36b-190">Группа ресурсов: ClassicRG</span><span class="sxs-lookup"><span data-stu-id="bf36b-190">Resource group: ClassicRG</span></span><br>
<span data-ttu-id="bf36b-191">Расположение: Запад США</span><span class="sxs-lookup"><span data-stu-id="bf36b-191">Location: West US</span></span><br>
<span data-ttu-id="bf36b-192">Подсеть шлюза: 10.41.1.0/27</span><span class="sxs-lookup"><span data-stu-id="bf36b-192">GatewaySubnet: 10.41.1.0/27</span></span>

<span data-ttu-id="bf36b-193">**При создании виртуальных сетей необходимо учитывать следующие параметры:**</span><span class="sxs-lookup"><span data-stu-id="bf36b-193">**When creating your VNets, keep in mind the following settings:**</span></span>

* <span data-ttu-id="bf36b-194">**Адресное пространство виртуальной сети.** На странице "Адресное пространство виртуальной сети" укажите диапазон адресов, который вы хотите использовать для виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-194">**Virtual Network Address Spaces** – On the Virtual Network Address Spaces page, specify the address range that you want to use for your virtual network.</span></span> <span data-ttu-id="bf36b-195">Это динамические IP-адреса, которые будут назначаться виртуальным машинам и другим экземплярам ролей, развертываемым в этой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-195">These are the dynamic IP addresses that will be assigned to the VMs and other role instances that you deploy to this virtual network.</span></span><br><span data-ttu-id="bf36b-196">Выбранные адресные пространства не должны пересекаться с адресными пространствами других виртуальных сетей или локальных расположений, к которым будет подключена виртуальная сеть.</span><span class="sxs-lookup"><span data-stu-id="bf36b-196">The address spaces you select cannot overlap with the address spaces for any of the other VNets or on-premises locations that this VNet will connect to.</span></span>

* <span data-ttu-id="bf36b-197">**Расположение** — при создании виртуальную сеть можно связать с расположением Azure (регионом).</span><span class="sxs-lookup"><span data-stu-id="bf36b-197">**Location** – When you create a virtual network, you associate it with an Azure location (region).</span></span> <span data-ttu-id="bf36b-198">Например, если вы хотите, чтобы ваши виртуальные машины разворачивались в виртуальной сети, которая физически расположена в западной части США, выберите это расположение.</span><span class="sxs-lookup"><span data-stu-id="bf36b-198">For example, if you want your VMs that are deployed to your virtual network to be physically located in West US, select that location.</span></span> <span data-ttu-id="bf36b-199">Нельзя изменить расположение, связанное с виртуальной сетью, после ее создания.</span><span class="sxs-lookup"><span data-stu-id="bf36b-199">You can’t change the location associated with your virtual network after you create it.</span></span>

<span data-ttu-id="bf36b-200">**После создания виртуальных сетей можно добавить следующие параметры:**</span><span class="sxs-lookup"><span data-stu-id="bf36b-200">**After creating your VNets, you can add the following settings:**</span></span>

* <span data-ttu-id="bf36b-201">**Адресное пространство.** Дополнительное адресное пространство не является обязательным для этой конфигурации, но его можно добавить после создания виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-201">**Address space** – Additional address space is not required for this configuration, but you can add additional address space after creating the VNet.</span></span>

* <span data-ttu-id="bf36b-202">**Подсети.** Дополнительные подсети не требуются для этой конфигурации, но вам может понадобиться разместить виртуальные машины в подсети отдельно от других экземпляров ролей.</span><span class="sxs-lookup"><span data-stu-id="bf36b-202">**Subnets** – Additional subnets are not required for this configuration, but you might want to have your VMs in a subnet that is separate from your other role instances.</span></span>

* <span data-ttu-id="bf36b-203">**DNS-серверы.** Введите имя и IP-адрес DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="bf36b-203">**DNS servers** – Enter the DNS server name and IP address.</span></span> <span data-ttu-id="bf36b-204">Этот параметр не приводит к созданию DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="bf36b-204">This setting does not create a DNS server.</span></span> <span data-ttu-id="bf36b-205">Он позволяет указать DNS-сервер, который вы хотите использовать для разрешения имен в этой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-205">It allows you to specify the DNS servers that you want to use for name resolution for this virtual network.</span></span>

<span data-ttu-id="bf36b-206">В этом разделе рассматривается настройка типа соединения и локального сайта, а также создание шлюза.</span><span class="sxs-lookup"><span data-stu-id="bf36b-206">In this section, you configure the connection type, the local site, and create the gateway.</span></span>

## <span data-ttu-id="bf36b-207"><a name="localsite"></a>Шаг 3. Настройка локального сайта</span><span class="sxs-lookup"><span data-stu-id="bf36b-207"><a name="localsite"></a>Step 3 - Configure the local site</span></span>

<span data-ttu-id="bf36b-208">С помощью параметров, заданных в каждом сайте локальной сети, Azure определяет способ маршрутизации трафика между виртуальными сетями.</span><span class="sxs-lookup"><span data-stu-id="bf36b-208">Azure uses the settings specified in each local network site to determine how to route traffic between the VNets.</span></span> <span data-ttu-id="bf36b-209">Каждая виртуальная сеть должна указывать на соответствующую локальную сеть, в которую будет выполняться маршрутизация трафика.</span><span class="sxs-lookup"><span data-stu-id="bf36b-209">Each VNet must point to the respective local network that you want to route traffic to.</span></span> <span data-ttu-id="bf36b-210">Укажите имена, которые будут использоваться для ссылки на каждый из сайтов локальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-210">You determine the name you want to use to refer to each local network site.</span></span> <span data-ttu-id="bf36b-211">Лучше всего использовать описательные имена.</span><span class="sxs-lookup"><span data-stu-id="bf36b-211">It's best to use something descriptive.</span></span>

<span data-ttu-id="bf36b-212">Например, сеть TestVNet1 подключается к созданному вами сайту локальной сети с именем VNet4Local.</span><span class="sxs-lookup"><span data-stu-id="bf36b-212">For example, TestVNet1 connects to a local network site that you create named 'VNet4Local'.</span></span> <span data-ttu-id="bf36b-213">Параметры VNet4Local содержат префиксы адресов TestVNet4.</span><span class="sxs-lookup"><span data-stu-id="bf36b-213">The settings for VNet4Local contain the address prefixes for TestVNet4.</span></span>

<span data-ttu-id="bf36b-214">Локальным сайтом каждой виртуальной сети является другая виртуальная сеть.</span><span class="sxs-lookup"><span data-stu-id="bf36b-214">The local site for each VNet is the other VNet.</span></span> <span data-ttu-id="bf36b-215">Для этой конфигурации используются следующие примеры значений:</span><span class="sxs-lookup"><span data-stu-id="bf36b-215">The following example values are used for our configuration:</span></span>

| <span data-ttu-id="bf36b-216">Виртуальная сеть</span><span class="sxs-lookup"><span data-stu-id="bf36b-216">Virtual Network</span></span> | <span data-ttu-id="bf36b-217">Пространство адресов</span><span class="sxs-lookup"><span data-stu-id="bf36b-217">Address Space</span></span> | <span data-ttu-id="bf36b-218">Регион</span><span class="sxs-lookup"><span data-stu-id="bf36b-218">Region</span></span> | <span data-ttu-id="bf36b-219">Подключается к сайту локальной сети</span><span class="sxs-lookup"><span data-stu-id="bf36b-219">Connects to local network site</span></span> |
|:--- |:--- |:--- |:--- |
| <span data-ttu-id="bf36b-220">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="bf36b-220">TestVNet1</span></span> |<span data-ttu-id="bf36b-221">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="bf36b-221">TestVNet1</span></span><br><span data-ttu-id="bf36b-222">(10.11.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-222">(10.11.0.0/16)</span></span><br><span data-ttu-id="bf36b-223">(10.12.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-223">(10.12.0.0/16)</span></span> |<span data-ttu-id="bf36b-224">Восток США</span><span class="sxs-lookup"><span data-stu-id="bf36b-224">East US</span></span> |<span data-ttu-id="bf36b-225">VNet4Local</span><span class="sxs-lookup"><span data-stu-id="bf36b-225">VNet4Local</span></span><br><span data-ttu-id="bf36b-226">(10.41.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-226">(10.41.0.0/16)</span></span><br><span data-ttu-id="bf36b-227">(10.42.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-227">(10.42.0.0/16)</span></span> |
| <span data-ttu-id="bf36b-228">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="bf36b-228">TestVNet4</span></span> |<span data-ttu-id="bf36b-229">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="bf36b-229">TestVNet4</span></span><br><span data-ttu-id="bf36b-230">(10.41.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-230">(10.41.0.0/16)</span></span><br><span data-ttu-id="bf36b-231">(10.42.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-231">(10.42.0.0/16)</span></span> |<span data-ttu-id="bf36b-232">Запад США</span><span class="sxs-lookup"><span data-stu-id="bf36b-232">West US</span></span> |<span data-ttu-id="bf36b-233">VNet1Local</span><span class="sxs-lookup"><span data-stu-id="bf36b-233">VNet1Local</span></span><br><span data-ttu-id="bf36b-234">(10.11.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-234">(10.11.0.0/16)</span></span><br><span data-ttu-id="bf36b-235">(10.12.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="bf36b-235">(10.12.0.0/16)</span></span> |

1. <span data-ttu-id="bf36b-236">Найдите TestVNet1 на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-236">Locate TestVNet1 in the Azure portal.</span></span> <span data-ttu-id="bf36b-237">В разделе колонки **VPN-подключения** щелкните **Шлюз**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-237">In the **VPN connections** section of the blade, click **Gateway**.</span></span>

    ![Нет шлюза](./media/vpn-gateway-howto-vnet-vnet-portal-classic/nogateway.png)
2. <span data-ttu-id="bf36b-239">На странице **Новое VPN-подключение** выберите **Сеть — сеть**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-239">On the **New VPN Connection** page, select **Site-to-Site**.</span></span>
3. <span data-ttu-id="bf36b-240">Щелкните **Локальный сайт**, чтобы открыть страницу "Локальный сайт" и настроить параметры.</span><span class="sxs-lookup"><span data-stu-id="bf36b-240">Click **Local site** to open the Local site page and configure the settings.</span></span>
4. <span data-ttu-id="bf36b-241">На странице **Локальный сайт** укажите имя локального сайта.</span><span class="sxs-lookup"><span data-stu-id="bf36b-241">On the **Local site** page, name your local site.</span></span> <span data-ttu-id="bf36b-242">В нашем примере имя локального сайта VNet4Local.</span><span class="sxs-lookup"><span data-stu-id="bf36b-242">In our example, we name the local site 'VNet4Local'.</span></span>
5. <span data-ttu-id="bf36b-243">Для **IP-адреса VPN-шлюза** можно использовать любой необходимый вам IP-адрес, при условии, что он введен в правильном формате.</span><span class="sxs-lookup"><span data-stu-id="bf36b-243">For **VPN gateway IP address**, you can use any IP address that you want, as long as it's in a valid format.</span></span> <span data-ttu-id="bf36b-244">Как правило, для VPN-устройства используется фактический внешний IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="bf36b-244">Typically, you’d use the actual external IP address for a VPN device.</span></span> <span data-ttu-id="bf36b-245">Но для конфигурации "виртуальная сеть — виртуальная сеть" используется общедоступный IP-адрес, назначенный шлюзу для вашей виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-245">But, for a classic VNet-to-VNet configuration, you use the public IP address that is assigned to the gateway for your VNet.</span></span> <span data-ttu-id="bf36b-246">Так как вы еще не создали шлюз виртуальной сети, укажите любой допустимый общедоступный IP-адрес в качестве заполнителя.</span><span class="sxs-lookup"><span data-stu-id="bf36b-246">Given that you’ve not yet created the virtual network gateway, you specify any valid public IP address as a placeholder.</span></span><br><span data-ttu-id="bf36b-247">Не оставляйте это поле пустым, так как оно является обязательным для данной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="bf36b-247">Don't leave this blank - it's not optional for this configuration.</span></span> <span data-ttu-id="bf36b-248">Позже вы вернетесь к этим параметрам и введете соответствующий IP-адрес шлюза виртуальной сети, после того, как Azure создаст его.</span><span class="sxs-lookup"><span data-stu-id="bf36b-248">In a later step, you go back into these settings and configure them with the corresponding virtual network gateway IP addresses once Azure generates it.</span></span>
6. <span data-ttu-id="bf36b-249">Для **адресного пространства клиента** используйте пространство адресов другой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-249">For **Client Address Space**, use the address space of the other VNet.</span></span> <span data-ttu-id="bf36b-250">Просмотрите пример планирования.</span><span class="sxs-lookup"><span data-stu-id="bf36b-250">Refer to your planning example.</span></span> <span data-ttu-id="bf36b-251">Щелкните **ОК**, чтобы сохранить параметры и вернуться к колонке **Новое VPN-подключение**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-251">Click **OK** to save your settings and return back to the **New VPN Connection** blade.</span></span>

    ![локальный сайт](./media/vpn-gateway-howto-vnet-vnet-portal-classic/localsite.png)

## <span data-ttu-id="bf36b-253"><a name="gw"></a>Шаг 4. Создание шлюза виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="bf36b-253"><a name="gw"></a>Step 4 - Create the virtual network gateway</span></span>

<span data-ttu-id="bf36b-254">В каждой виртуальной сети должен использоваться шлюз.</span><span class="sxs-lookup"><span data-stu-id="bf36b-254">Each virtual network must have a virtual network gateway.</span></span> <span data-ttu-id="bf36b-255">Шлюз виртуальной сети направляет и шифрует трафик.</span><span class="sxs-lookup"><span data-stu-id="bf36b-255">The virtual network gateway routes and encrypts traffic.</span></span>

1. <span data-ttu-id="bf36b-256">В колонке **Новое VPN-подключение** установите флажок **Немедленно создать шлюз**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-256">On the **New VPN Connection** blade, select the checkbox **Create gateway immediately**.</span></span>
2. <span data-ttu-id="bf36b-257">Щелкните **Подсеть, размер, маршрут**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-257">Click **Subnet, size and routing type**.</span></span> <span data-ttu-id="bf36b-258">В колонке **Настройка шлюза** щелкните **Подсеть**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-258">On the **Gateway configuration** blade, click **Subnet**.</span></span>
3. <span data-ttu-id="bf36b-259">Имя подсети шлюза будет заполнено автоматически с требуемым именем GatewaySubnet.</span><span class="sxs-lookup"><span data-stu-id="bf36b-259">The gateway subnet name is filled in automatically with the required name 'GatewaySubnet'.</span></span> <span data-ttu-id="bf36b-260">**Диапазон адресов** содержит IP-адреса, выделенные для служб VPN-шлюза.</span><span class="sxs-lookup"><span data-stu-id="bf36b-260">The **Address range** contains the IP addresses that are allocated to the VPN gateway services.</span></span> <span data-ttu-id="bf36b-261">Некоторые конфигурации разрешают подсеть шлюза размера /29, но мы рекомендуем использовать /28 или /27 с учетом будущих конфигураций, которые могут потребовать дополнительных IP-адресов для служб шлюза.</span><span class="sxs-lookup"><span data-stu-id="bf36b-261">Some configurations allow a gateway subnet of /29, but it's best to use a /28 or /27 to accommodate future configurations that may require more IP addresses for the gateway services.</span></span> <span data-ttu-id="bf36b-262">В нашем примере параметров используется подсеть шлюза 10.11.1.0/27.</span><span class="sxs-lookup"><span data-stu-id="bf36b-262">In our example settings, we use 10.11.1.0/27.</span></span> <span data-ttu-id="bf36b-263">Настройте адресное пространство, а затем щелкните **ОК**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-263">Adjust the address space, then click **OK**.</span></span>
4. <span data-ttu-id="bf36b-264">Настройте **размер шлюза**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-264">Configure the **Gateway Size**.</span></span> <span data-ttu-id="bf36b-265">Этот параметр относится к [SKU шлюза](vpn-gateway-about-vpn-gateway-settings.md#gwsku).</span><span class="sxs-lookup"><span data-stu-id="bf36b-265">This setting refers to the [Gateway SKU](vpn-gateway-about-vpn-gateway-settings.md#gwsku).</span></span>
5. <span data-ttu-id="bf36b-266">Настройте **тип маршрутизации**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-266">Configure the **Routing Type**.</span></span> <span data-ttu-id="bf36b-267">Тип маршрутизации для этой конфигурации должен содержать значение **Динамическая**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-267">The routing type for this configuration must be **Dynamic**.</span></span> <span data-ttu-id="bf36b-268">Вы не сможете изменить тип маршрутизации позже, пока шлюз не будет удален и создан.</span><span class="sxs-lookup"><span data-stu-id="bf36b-268">You can't change the routing type later unless you tear down the gateway and create a new one.</span></span>
6. <span data-ttu-id="bf36b-269">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-269">Click **OK**.</span></span>
7. <span data-ttu-id="bf36b-270">В колонке **Новое VPN-подключение** щелкните **ОК**, чтобы приступить к созданию шлюза виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-270">On the **New VPN Connection** blade, click **OK** to begin creating the virtual network gateway.</span></span> <span data-ttu-id="bf36b-271">Создание шлюза часто занимает 45 минут и более, в зависимости от выбранного SKU шлюза.</span><span class="sxs-lookup"><span data-stu-id="bf36b-271">Creating a gateway can often take 45 minutes or more, depending on the selected gateway SKU.</span></span>

## <span data-ttu-id="bf36b-272"><a name="vnet4settings"></a>Шаг 5. Настройка параметров TestVNet4</span><span class="sxs-lookup"><span data-stu-id="bf36b-272"><a name="vnet4settings"></a>Step 5 - Configure TestVNet4 settings</span></span>

<span data-ttu-id="bf36b-273">Повторите шаги, чтобы [создать локальный сайт](#localsite) и [шлюз виртуальной сети](#gw) для настройки TestVNet4, при необходимости заменив значения.</span><span class="sxs-lookup"><span data-stu-id="bf36b-273">Repeat the steps to [Create a local site](#localsite) and [Create the virtual network gateway](#gw) to configure TestVNet4, substituting the values when necessary.</span></span> <span data-ttu-id="bf36b-274">При выполнении этих шагов в качестве упражнения используйте [примеры значений](#vnetvalues).</span><span class="sxs-lookup"><span data-stu-id="bf36b-274">If you are doing this as an exercise, use the [Example values](#vnetvalues).</span></span>

## <span data-ttu-id="bf36b-275"><a name="updatelocal"></a>Шаг 6. Обновление локальных сайтов</span><span class="sxs-lookup"><span data-stu-id="bf36b-275"><a name="updatelocal"></a>Step 6 - Update the local sites</span></span>

<span data-ttu-id="bf36b-276">После создания шлюзов виртуальной сети для обеих виртуальных сетей следует настроить локальные сайты для значений **IP-адреса VPN-шлюза**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-276">After your virtual network gateways have been created for both VNets, you must adjust the local sites **VPN gateway IP address** values.</span></span>

|<span data-ttu-id="bf36b-277">Имя виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="bf36b-277">VNet name</span></span>|<span data-ttu-id="bf36b-278">Подключенный сайт</span><span class="sxs-lookup"><span data-stu-id="bf36b-278">Connected site</span></span>|<span data-ttu-id="bf36b-279">IP-адрес шлюза</span><span class="sxs-lookup"><span data-stu-id="bf36b-279">Gateway IP address</span></span>|
|:--- |:--- |:--- |
|<span data-ttu-id="bf36b-280">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="bf36b-280">TestVNet1</span></span>|<span data-ttu-id="bf36b-281">VNet4Local</span><span class="sxs-lookup"><span data-stu-id="bf36b-281">VNet4Local</span></span>|<span data-ttu-id="bf36b-282">IP-адрес VPN-шлюза для TestVNet4</span><span class="sxs-lookup"><span data-stu-id="bf36b-282">VPN gateway IP address for TestVNet4</span></span>|
|<span data-ttu-id="bf36b-283">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="bf36b-283">TestVNet4</span></span>|<span data-ttu-id="bf36b-284">VNet1Local</span><span class="sxs-lookup"><span data-stu-id="bf36b-284">VNet1Local</span></span>|<span data-ttu-id="bf36b-285">IP-адрес VPN-шлюза для TestVNet1</span><span class="sxs-lookup"><span data-stu-id="bf36b-285">VPN gateway IP address for TestVNet1</span></span>|

### <a name="part-1---get-the-virtual-network-gateway-public-ip-address"></a><span data-ttu-id="bf36b-286">Часть 1. Получение общедоступного IP-адреса шлюза виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="bf36b-286">Part 1 - Get the virtual network gateway public IP address</span></span>

1. <span data-ttu-id="bf36b-287">Найдите виртуальную сеть на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-287">Locate your virtual network in the Azure portal.</span></span>
2. <span data-ttu-id="bf36b-288">Щелкните, чтобы открыть колонку виртуальной сети **Обзор**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-288">Click to open the VNet **Overview** blade.</span></span> <span data-ttu-id="bf36b-289">В колонке **VPN-подключения** можно просмотреть IP-адрес шлюза виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-289">On the blade, in **VPN connections**, you can view the IP address for your virtual network gateway.</span></span>

  ![Общедоступный IP-адрес](./media/vpn-gateway-howto-vnet-vnet-portal-classic/publicIP.png)
3. <span data-ttu-id="bf36b-291">Скопируйте IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="bf36b-291">Copy the IP address.</span></span> <span data-ttu-id="bf36b-292">Он понадобится в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="bf36b-292">You will use it in the next section.</span></span>
4. <span data-ttu-id="bf36b-293">Повторите эти шаги для TestVNet4.</span><span class="sxs-lookup"><span data-stu-id="bf36b-293">Repeat these steps for TestVNet4</span></span>

### <a name="part-2---modify-the-local-sites"></a><span data-ttu-id="bf36b-294">Часть 2. Изменение локальных сайтов</span><span class="sxs-lookup"><span data-stu-id="bf36b-294">Part 2 - Modify the local sites</span></span>

1. <span data-ttu-id="bf36b-295">Найдите виртуальную сеть на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-295">Locate your virtual network in the Azure portal.</span></span>
2. <span data-ttu-id="bf36b-296">В колонке виртуальной сети **Обзор** щелкните локальный сайт.</span><span class="sxs-lookup"><span data-stu-id="bf36b-296">On the VNet **Overview** blade, click the local site.</span></span>

  ![Созданный локальный сайт](./media/vpn-gateway-howto-vnet-vnet-portal-classic/local.png)
3. <span data-ttu-id="bf36b-298">В колонке **VPN-подключения типа "сеть —сеть"** щелкните имя локального сайта, который требуется изменить.</span><span class="sxs-lookup"><span data-stu-id="bf36b-298">On the **Site-to-Site VPN Connections** blade, click the name of the local site that you want to modify.</span></span>

  ![Открытие локального сайта](./media/vpn-gateway-howto-vnet-vnet-portal-classic/openlocal.png)
4. <span data-ttu-id="bf36b-300">Щелкните **локальный сайт**, который необходимо изменить.</span><span class="sxs-lookup"><span data-stu-id="bf36b-300">Click the **Local site** that you want to modify.</span></span>

  ![изменение сайта](./media/vpn-gateway-howto-vnet-vnet-portal-classic/connections.png)
5. <span data-ttu-id="bf36b-302">Обновите **IP-адрес VPN-шлюза** и щелкните **ОК** для сохранения настроек.</span><span class="sxs-lookup"><span data-stu-id="bf36b-302">Update the **VPN gateway IP address** and click **OK** to save the settings.</span></span>

  ![IP-адрес шлюза](./media/vpn-gateway-howto-vnet-vnet-portal-classic/gwupdate.png)
6. <span data-ttu-id="bf36b-304">Закройте другие колонки.</span><span class="sxs-lookup"><span data-stu-id="bf36b-304">Close the other blades.</span></span>
7. <span data-ttu-id="bf36b-305">Повторите эти шаги для TestVNet4.</span><span class="sxs-lookup"><span data-stu-id="bf36b-305">Repeat these steps for TestVNet4.</span></span>

## <span data-ttu-id="bf36b-306"><a name="getvalues"></a>Шаг 7. Получение значений из файла конфигурации сети</span><span class="sxs-lookup"><span data-stu-id="bf36b-306"><a name="getvalues"></a>Step 7 - Retrieve values from the network configuration file</span></span>

<span data-ttu-id="bf36b-307">При создании классических виртуальных сетей на портале Azure имя, которое вы просматриваете, не является полным именем, используемым для PowerShell.</span><span class="sxs-lookup"><span data-stu-id="bf36b-307">When you create classic VNets in the Azure portal, the name that you view is not the full name that you use for PowerShell.</span></span> <span data-ttu-id="bf36b-308">Например, если виртуальная сеть отображается на портале с именем **TestVNet1**, то в файле конфигурации сети ее имя может быть гораздо длиннее.</span><span class="sxs-lookup"><span data-stu-id="bf36b-308">For example, a VNet that appears to be named **TestVNet1** in the portal, may have a much longer name in the network configuration file.</span></span> <span data-ttu-id="bf36b-309">Это имя может выглядеть примерно следующим образом: **Group ClassicRG TestVNet1**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-309">The name might look something like: **Group ClassicRG TestVNet1**.</span></span> <span data-ttu-id="bf36b-310">При создании подключений важно использовать значения, приведенные в файле конфигурации сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-310">When you create your connections, it's important to use the values that you see in the network configuration file.</span></span>

<span data-ttu-id="bf36b-311">Выполняя следующие действия, вы подключитесь к учетной записи Azure, а также скачаете и просмотрите файл конфигурации сети для получения значений, необходимых для подключений.</span><span class="sxs-lookup"><span data-stu-id="bf36b-311">In the following steps, you will connect to your Azure account and download and view the network configuration file to obtain the values that are required for your connections.</span></span>

1. <span data-ttu-id="bf36b-312">Скачайте и установите последнюю версию командлетов PowerShell для управления службами Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-312">Download and install the latest version of the Azure Service Management (SM) PowerShell cmdlets.</span></span> <span data-ttu-id="bf36b-313">Дополнительные сведения см. в статье [Установка и настройка Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="bf36b-313">For more information, see [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>

2. <span data-ttu-id="bf36b-314">Откройте консоль PowerShell с повышенными правами и подключитесь к своей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="bf36b-314">Open your PowerShell console with elevated rights and connect to your account.</span></span> <span data-ttu-id="bf36b-315">Для подключения используйте следующий пример кода:</span><span class="sxs-lookup"><span data-stu-id="bf36b-315">Use the following example to help you connect:</span></span>

  ```powershell
  Login-AzureRmAccount
  ```

  <span data-ttu-id="bf36b-316">Просмотрите подписки учетной записи.</span><span class="sxs-lookup"><span data-stu-id="bf36b-316">Check the subscriptions for the account.</span></span>

  ```powershell
  Get-AzureRmSubscription
  ```

  <span data-ttu-id="bf36b-317">При наличии нескольких подписок выберите подписку, которую вы хотите использовать.</span><span class="sxs-lookup"><span data-stu-id="bf36b-317">If you have more than one subscription, select the subscription that you want to use.</span></span>

  ```powershell
  Select-AzureRmSubscription -SubscriptionName "Replace_with_your_subscription_name"
  ```

  <span data-ttu-id="bf36b-318">Затем воспользуйтесь следующим командлетом, чтобы добавить подписку Azure в PowerShell для классической модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="bf36b-318">Next, use the following cmdlet to add your Azure subscription to PowerShell for the classic deployment model.</span></span>

  ```powershell
  Add-AzureAccount
  ```
3. <span data-ttu-id="bf36b-319">Экспортируйте и просмотрите файл конфигурации сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-319">Export and view the network configuration file.</span></span> <span data-ttu-id="bf36b-320">Создайте каталог на компьютере, а затем экспортируйте в него файл конфигурации сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-320">Create a directory on your computer and then export the network configuration file to the directory.</span></span> <span data-ttu-id="bf36b-321">В этом примере файл конфигурации сети экспортируется в каталог **C:\AzureNet**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-321">In this example, the network configuration file is exported to **C:\AzureNet**.</span></span>

  ```powershell
  Get-AzureVNetConfig -ExportToFile C:\AzureNet\NetworkConfig.xml
  ```
4. <span data-ttu-id="bf36b-322">Откройте файл в текстовом редакторе и просмотрите имена для виртуальных сетей и сайтов.</span><span class="sxs-lookup"><span data-stu-id="bf36b-322">Open the file with a text editor and view the names for your VNets and sites.</span></span> <span data-ttu-id="bf36b-323">Это будут имена, использующиеся при создании подключений.</span><span class="sxs-lookup"><span data-stu-id="bf36b-323">These will be the name you use when you create your connections.</span></span><br><span data-ttu-id="bf36b-324">Имена виртуальных сетей перечислены как **VirtualNetworkSite name =**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-324">VNet names are listed as **VirtualNetworkSite name =**</span></span><br><span data-ttu-id="bf36b-325">Имена сайтов перечислены как **LocalNetworkSiteRef name =**.</span><span class="sxs-lookup"><span data-stu-id="bf36b-325">Site names are listed as **LocalNetworkSiteRef name =**</span></span>

## <span data-ttu-id="bf36b-326"><a name="createconnections"></a>Шаг 8. Создание подключений VPN-шлюза</span><span class="sxs-lookup"><span data-stu-id="bf36b-326"><a name="createconnections"></a>Step 8 - Create the VPN gateway connections</span></span>

<span data-ttu-id="bf36b-327">После завершения всех предыдущих шагов можно задать общие ключи IPsec/IKE и создать подключение.</span><span class="sxs-lookup"><span data-stu-id="bf36b-327">When all the previous steps have been completed, you can set the IPsec/IKE pre-shared keys and create the connection.</span></span> <span data-ttu-id="bf36b-328">Для этого набора действий используется только PowerShell.</span><span class="sxs-lookup"><span data-stu-id="bf36b-328">This set of steps uses PowerShell.</span></span> <span data-ttu-id="bf36b-329">Подключения типа "виртуальная сеть — виртуальная сеть" для классической модели развертывания невозможно настроить на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-329">VNet-to-VNet connections for the classic deployment model cannot be configured in the Azure portal.</span></span>

<span data-ttu-id="bf36b-330">Обратите внимание, что в приведенных ниже примерах общий ключ совпадает.</span><span class="sxs-lookup"><span data-stu-id="bf36b-330">In the examples, notice that the shared key is exactly the same.</span></span> <span data-ttu-id="bf36b-331">Общий ключ всегда должен совпадать.</span><span class="sxs-lookup"><span data-stu-id="bf36b-331">The shared key must always match.</span></span> <span data-ttu-id="bf36b-332">Обязательно замените значения в этих примерах на точные имена для виртуальных сетей и сайтов локальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-332">Be sure to replace the values in these examples with the exact names for your VNets and Local Network Sites.</span></span>

1. <span data-ttu-id="bf36b-333">Создайте подключение между TestVNet1 и TestVNet4.</span><span class="sxs-lookup"><span data-stu-id="bf36b-333">Create the TestVNet1 to TestVNet4 connection.</span></span>

  ```powershell
  Set-AzureVNetGatewayKey -VNetName 'Group ClassicRG TestVNet1' `
  -LocalNetworkSiteName '17BE5E2C_VNet4Local' -SharedKey A1b2C3D4
  ```
2. <span data-ttu-id="bf36b-334">Создайте подключение между TestVNet4 и TestVNet1.</span><span class="sxs-lookup"><span data-stu-id="bf36b-334">Create the TestVNet4 to TestVNet1 connection.</span></span>

  ```powershell
  Set-AzureVNetGatewayKey -VNetName 'Group ClassicRG TestVNet4' `
  -LocalNetworkSiteName 'F7F7BFC7_VNet1Local' -SharedKey A1b2C3D4
  ```
3. <span data-ttu-id="bf36b-335">Ожидание подключений для инициализации.</span><span class="sxs-lookup"><span data-stu-id="bf36b-335">Wait for the connections to initialize.</span></span> <span data-ttu-id="bf36b-336">После инициализации шлюза для состояния будет установлено значение "Успешно".</span><span class="sxs-lookup"><span data-stu-id="bf36b-336">Once the gateway has initialized, the Status is 'Successful'.</span></span>

  ```
  Error          :
  HttpStatusCode : OK
  Id             :
  Status         : Successful
  RequestId      :
  StatusCode     : OK
  ```

## <span data-ttu-id="bf36b-337"><a name="faq"></a>Рекомендации по работе с подключением типа "виртуальная сеть — виртуальная сеть" для классических виртуальных сетей</span><span class="sxs-lookup"><span data-stu-id="bf36b-337"><a name="faq"></a>VNet-to-VNet considerations for classic VNets</span></span>
* <span data-ttu-id="bf36b-338">Виртуальные сети могут быть в одной или разных подписках.</span><span class="sxs-lookup"><span data-stu-id="bf36b-338">The virtual networks can be in the same or different subscriptions.</span></span>
* <span data-ttu-id="bf36b-339">Виртуальные сети могут быть в одном или разных регионах (расположениях) Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-339">The virtual networks can be in the same or different Azure regions (locations).</span></span>
* <span data-ttu-id="bf36b-340">Облачная служба или конечная точка балансировки нагрузки не может распространяться на виртуальные сети, даже если они соединены друг с другом.</span><span class="sxs-lookup"><span data-stu-id="bf36b-340">A cloud service or a load balancing endpoint can't span across virtual networks, even if they are connected together.</span></span>
* <span data-ttu-id="bf36b-341">Для подключения нескольких виртуальных сетей друг к другу не требуются VPN-устройства.</span><span class="sxs-lookup"><span data-stu-id="bf36b-341">Connecting multiple virtual networks together doesn't require any VPN devices.</span></span>
* <span data-ttu-id="bf36b-342">Подключения между виртуальными сетями поддерживает подключение виртуальных сетей Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-342">VNet-to-VNet supports connecting Azure Virtual Networks.</span></span> <span data-ttu-id="bf36b-343">Не поддерживается подключение виртуальных машин или облачных служб, не развернутых в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="bf36b-343">It does not support connecting virtual machines or cloud services that are not deployed to a virtual network.</span></span>
* <span data-ttu-id="bf36b-344">Для подключения "виртуальная сеть — виртуальная сеть" требуются шлюзы с динамической маршрутизацией.</span><span class="sxs-lookup"><span data-stu-id="bf36b-344">VNet-to-VNet requires dynamic routing gateways.</span></span> <span data-ttu-id="bf36b-345">Шлюзы Azure со статической маршрутизацией не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="bf36b-345">Azure static routing gateways are not supported.</span></span>
* <span data-ttu-id="bf36b-346">Подключение к виртуальной сети можно использовать одновременно с многосайтовыми VPN-подключениями.</span><span class="sxs-lookup"><span data-stu-id="bf36b-346">Virtual network connectivity can be used simultaneously with multi-site VPNs.</span></span> <span data-ttu-id="bf36b-347">Можно использовать до 10 туннелей VPN для подключения VPN-шлюза виртуальной сети к другим виртуальным сетям или локальным сайтам.</span><span class="sxs-lookup"><span data-stu-id="bf36b-347">There is a maximum of 10 VPN tunnels for a virtual network VPN gateway connecting to either other virtual networks, or on-premises sites.</span></span>
* <span data-ttu-id="bf36b-348">Адресные пространства виртуальных сетей и местных сайтов локальных сетей не должны перекрываться.</span><span class="sxs-lookup"><span data-stu-id="bf36b-348">The address spaces of the virtual networks and on-premises local network sites must not overlap.</span></span> <span data-ttu-id="bf36b-349">Перекрытие адресных пространств приведет к сбою при создании виртуальных сетей или отправке файлов конфигурации netcfg.</span><span class="sxs-lookup"><span data-stu-id="bf36b-349">Overlapping address spaces will cause the creation of virtual networks or uploading netcfg configuration files to fail.</span></span>
* <span data-ttu-id="bf36b-350">Избыточные туннели между парой виртуальных сетей не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="bf36b-350">Redundant tunnels between a pair of virtual networks are not supported.</span></span>
* <span data-ttu-id="bf36b-351">Все туннели VPN виртуальной сети, включая VPN-подключения типа "точка — сеть", совместно используют доступную пропускную способность VPN-шлюза Azure и регулируются одним соглашением об уровне обслуживания, определяющим время работы VPN-шлюзов в Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-351">All VPN tunnels for the VNet, including P2S VPNs, share the available bandwidth for the VPN gateway, and the same VPN gateway uptime SLA in Azure.</span></span>
* <span data-ttu-id="bf36b-352">Трафик между виртуальными сетями проходит через магистральную сеть Azure.</span><span class="sxs-lookup"><span data-stu-id="bf36b-352">VNet-to-VNet traffic travels across the Azure backbone.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bf36b-353">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="bf36b-353">Next steps</span></span>
<span data-ttu-id="bf36b-354">Проверьте подключения.</span><span class="sxs-lookup"><span data-stu-id="bf36b-354">Verify your connections.</span></span> <span data-ttu-id="bf36b-355">Дополнительные сведения см. в статье [Проверка подключения VPN-шлюза](vpn-gateway-verify-connection-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="bf36b-355">See [Verify a VPN Gateway connection](vpn-gateway-verify-connection-resource-manager.md).</span></span>
