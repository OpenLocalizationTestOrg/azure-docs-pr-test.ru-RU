---
title: "Планирование и проектирование распределенных подключений: VPN-шлюз Azure | Документация Майкрософт"
description: "Сведения о планировании и проектировании VPN-шлюза для подключений между организациями и между виртуальными сетями, а также гибридных подключений"
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-service-management,azure-resource-manager
ms.assetid: d5aaab83-4e74-4484-8bf0-cc465811e757
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/27/2017
ms.author: cherylmc
ms.openlocfilehash: 0ebc3ef4a64432e993dd6ed69766bb64544fe433
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="planning-and-design-for-vpn-gateway"></a>Планирование и проектирование VPN-шлюза

Планирование и проектирование конфигураций распределенных подключений и подключений между виртуальными сетями может быть очень простым или достаточно сложным в зависимости от потребностей сети. В этой статье рассматриваются основные вопросы планирования и проектирования.

## <a name="planning"></a>Планирование

### <a name="compare"></a>Возможности распределенного подключения

Если вам требуется безопасное подключение локальных сайтов к виртуальной сети, доступны три варианта: подключение типа "сеть — сеть", подключение типа "точка — сеть" и канал ExpressRoute. Сравните различные доступные варианты подключений между организациями. На выбор влияют различные факторы, в том числе следующие.

* Какая пропускная способность требуется для решения?
* Вы хотите обмениваться данными через общедоступный Интернет по безопасному VPN-подключению или через частное подключение?
* У вас есть общедоступный IP-адрес, который можно использовать?
* Вы планируете использовать VPN-устройство? Если да, является ли оно совместимым?
* Вы подключаете лишь несколько компьютеров или требуется постоянное подключения для сайта?
* Какой тип VPN-шлюза необходим для решения, которое вы хотите создать?
* Какой номер SKU шлюза следует использовать?

### <a name="planningtable"></a>Таблица планирования

Приведенная ниже таблица поможет вам подобрать наилучший вариант подключения для решения.

[!INCLUDE [vpn-gateway-cross-premises](../../includes/vpn-gateway-cross-premises-include.md)]

### <a name="gwsku"></a>SKU шлюзов

[!INCLUDE [vpn-gateway-table-gwtype-aggtput](../../includes/vpn-gateway-table-gwtype-aggtput-include.md)]

### <a name="wf"></a>Рабочий процесс

Ниже приведен стандартный рабочий процесс для настройки облачных подключений.

1. Спроектируйте и спланируйте топологию подключений и составьте список адресных пространств для всех сетей, которые необходимо подключить.
2. Создайте виртуальную сеть Azure. 
3. Создайте VPN-шлюз для виртуальной сети.
4. Создайте и настройте подключения к локальным сетям или другим виртуальным сетям (при необходимости).
5. Создайте и настройте подключение "точка — сеть" для VPN-шлюза Azure (при необходимости).

## <a name="design"></a>Проектирование
### <a name="topologies"></a>Топологии подключений

Начните с просмотра схем в статье о [Основные сведения о VPN-шлюзах Azure](vpn-gateway-about-vpngateways.md) . В этой статье содержатся базовые схемы, а также описаны модели развертывания для каждой топологии и доступные инструменты развертывания, которыми можно воспользоваться для развертывания конфигурации.

### <a name="designbasics"></a>Основы проектирования

В следующих разделах представлены основные сведения о VPN-шлюзе. 

#### <a name="servicelimits"></a>Ограничения сетевых служб

Прокрутите таблицы для просмотра [ограничений сетевых служб](../azure-subscription-service-limits.md#networking-limits). Эти ограничения могут повлиять на проектирование.

#### <a name="subnets"></a>О подсетях

При создании подключений необходимо определить диапазоны адресов подсетей. Нельзя, чтобы они перекрывались. Перекрывающаяся подсеть — это подсеть, в которой одна виртуальная сеть или локальное расположение находится в том же адресном пространстве, что и другое расположение. Это значит, что ваши сетевые инженеры должны выделить для ваших локальных сетей диапазон, который будет использоваться для подсетей и пространства IP-адресов Azure. Это адресное пространство не должно использоваться в локальной сети.

Перекрытие подсетей также следует предотвратить при работе с подключениями между виртуальными сетями. Если подсети перекрываются и какой-либо IP-адрес существует в виртуальных сетях отправки и назначения, то создать подключение между виртуальными сетями не удастся. Azure не сможет перенаправить данные в другую виртуальную сеть, так как адрес назначения является частью виртуальной сети отправки.

Для работы VPN-шлюзов требуется специальная подсеть, которая называется подсетью шлюза. Чтобы подсети шлюзов работали надлежащим образом, каждую из них нужно назвать GatewaySubnet. Убедитесь, что для подсети шлюза не используется другое имя. Кроме того, не следует развертывать в ней виртуальные машины или что-либо другое. Ознакомьтесь с [подсетями шлюза](vpn-gateway-about-vpn-gateway-settings.md#gwsub).

#### <a name="local"></a>О локальных сетевых шлюзах

Обычно термин "шлюз локальной сети" означает локальное расположение. В классической модели развертывания локальный сетевой шлюз называется сайтом локальной сети. При настройке локального сетевого шлюза для него нужно задать имя, общедоступный IP-адрес локального VPN-устройства и префиксы адресов, принадлежащих к локальному расположению. Azure проверяет наличие сетевого трафика по префиксам адресов назначения, учитывает конфигурацию, указанную для локального сетевого шлюза, и соответствующим образом направляет пакеты. При необходимости эти префиксы адресов можно изменить. Дополнительные сведения см. в статье [Шлюзы локальной сети](vpn-gateway-about-vpn-gateway-settings.md#lng).

#### <a name="gwtype"></a>О типах шлюзов

Для топологии чрезвычайно важен правильный выбор типа шлюза. Шлюз не будет работать надлежащим образом, если выбран неправильный тип. По типу шлюза определяется, как подключается шлюз. Это обязательный параметр конфигурации для модели развертывания с помощью Resource Manager.

Существуют такие типы шлюзов:

* Vpn
* ExpressRoute

#### <a name="connectiontype"></a>О типах подключений

Для каждой конфигурации необходим конкретный тип подключения. Существуют такие типы подключения:

* IPsec
* Vnet2Vnet
* ExpressRoute
* VPNClient

#### <a name="vpntype"></a>О типах VPN

Для каждой конфигурации нужен определенный тип VPN. Если необходимо совместить две конфигурации, например создать подключения типа "сеть — сеть" и "точка — сеть" в одной виртуальной сети, нужно указать тип VPN, который отвечает требованиям обоих подключений.

[!INCLUDE [vpn-gateway-vpntype](../../includes/vpn-gateway-vpntype-include.md)]

В приведенных ниже таблицах приведены типы VPN и соответствующие конфигурации подключений. Тип VPN для шлюза должен соответствовать конфигурации, которую требуется создать. 

[!INCLUDE [vpn-gateway-table-vpntype](../../includes/vpn-gateway-table-vpntype-include.md)]

### <a name="devices"></a>VPN-устройства для подключений типа "сеть — сеть"

Независимо от модели развертывания для настройки подключения типа "сеть — сеть" необходимы следующие элементы:

* VPN-устройство, совместимое с VPN-шлюзами Azure;
* общедоступный IP-адрес IPv4, который находится в пределах NAT.

Необходимо иметь опыт настройки VPN-устройства или возможность обратиться к специалисту, который может настроить устройство для вас.

[!INCLUDE [vpn-gateway-configure-vpn-device-rm](../../includes/vpn-gateway-configure-vpn-device-rm-include.md)]

### <a name="forcedtunnel"></a>Вариант маршрутизации с принудительным туннелированием

Принудительное туннелирование можно настроить для большинства конфигураций. Оно позволяет перенаправлять или "принудительно направлять" весь Интернет-трафик обратно в локальное расположение через VPN типа "сеть — сеть" для проверки и аудита. Это критически важное требование безопасности, имеющееся в большинстве корпоративных ИТ-политик. 

Без принудительного туннелирования Интернет-трафик из виртуальных машин в Azure будет всегда поступать из инфраструктуры сети Azure непосредственно в Интернет, без возможности его проверки или аудита. Неавторизованный доступ в Интернет может привести к раскрытию информации или другим нарушениям безопасности.

Подключение с принудительным туннелированием можно настроить в обеих моделях развертывания с помощью разных средств. Дополнительные сведения см. в разделе [Настройка принудительного туннелирования](vpn-gateway-forced-tunneling-rm.md).

**Схема принудительного туннелирования**

![Схема принудительного туннелирования VPN-шлюза Azure](./media/vpn-gateway-plan-design/forced-tunneling-diagram.png)

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о проектировании см. в статьях [VPN-шлюз: вопросы и ответы](vpn-gateway-vpn-faq.md) и [Шлюзы VPN](vpn-gateway-about-vpngateways.md).

Дополнительные сведения о конкретных параметрах шлюза см. в разделе [Сведения о параметрах VPN-шлюза](vpn-gateway-about-vpn-gateway-settings.md).