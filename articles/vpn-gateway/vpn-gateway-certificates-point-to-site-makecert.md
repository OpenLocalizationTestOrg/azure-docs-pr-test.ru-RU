---
title: "Создание и экспорт сертификатов для подключений типа \"точка — сеть\" в Azure с помощью MakeCert | Документация Майкрософт"
description: "В этой статье приведены инструкции по созданию самозаверяющего корневого сертификата, экспорту открытого ключа и созданию сертификатов клиента с помощью MakeCert."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/09/2017
ms.author: cherylmc
ms.openlocfilehash: 4c51edac3b1cdafae8f9543bd0e3133b6a050f73
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="generate-and-export-certificates-for-point-to-site-connections-using-makecert"></a><span data-ttu-id="2063f-103">Создание и экспорт сертификатов для подключений типа "точка — сеть" с помощью MakeCert</span><span class="sxs-lookup"><span data-stu-id="2063f-103">Generate and export certificates for Point-to-Site connections using MakeCert</span></span>

<span data-ttu-id="2063f-104">Для аутентификации подключений типа "точка — сеть" используются сертификаты.</span><span class="sxs-lookup"><span data-stu-id="2063f-104">Point-to-Site connections use certificates to authenticate.</span></span> <span data-ttu-id="2063f-105">Эта статья поможет создать самозаверяющий корневой сертификат, а также сертификаты клиента с помощью MakeCert.</span><span class="sxs-lookup"><span data-stu-id="2063f-105">This article shows you how to create a self-signed root certificate and generate client certificates using MakeCert.</span></span> <span data-ttu-id="2063f-106">Чтобы ознакомится с инструкциями по настройке подключения "точка — сеть", например как передать корневые сертификаты, выберите одну из статей в следующем списке:</span><span class="sxs-lookup"><span data-stu-id="2063f-106">If you are looking for Point-to-Site configuration steps, such as how to upload root certificates, select one of the 'Configure Point-to-Site' articles from the following list:</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="2063f-107">Создание самозаверяющих сертификатов с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="2063f-107">Create self-signed certificates - PowerShell</span></span>](vpn-gateway-certificates-point-to-site.md)
> * [<span data-ttu-id="2063f-108">Создание и экспорт сертификатов для подключений типа "точка — сеть" с помощью MakeCert</span><span class="sxs-lookup"><span data-stu-id="2063f-108">Create self-signed certificates - MakeCert</span></span>](vpn-gateway-certificates-point-to-site-makecert.md)
> * [<span data-ttu-id="2063f-109">Настройка подключения "точка — сеть" модели Resource Manager на портале Azure</span><span class="sxs-lookup"><span data-stu-id="2063f-109">Configure Point-to-Site - Resource Manager - Azure portal</span></span>](vpn-gateway-howto-point-to-site-resource-manager-portal.md)
> * [<span data-ttu-id="2063f-110">Настройка подключения "точка-сеть" — Resource Manager — PowerShell</span><span class="sxs-lookup"><span data-stu-id="2063f-110">Configure Point-to-Site - Resource Manager - PowerShell</span></span>](vpn-gateway-howto-point-to-site-rm-ps.md)
> * [<span data-ttu-id="2063f-111">Настройка подключения "точка —сеть" классической модели на портале Azure</span><span class="sxs-lookup"><span data-stu-id="2063f-111">Configure Point-to-Site - Classic - Azure portal</span></span>](vpn-gateway-howto-point-to-site-classic-azure-portal.md)
> 
> 

<span data-ttu-id="2063f-112">Хотя для создания сертификатов мы рекомендуем использовать сведения статьи [Создание и экспорт сертификатов для подключений типа "точка — сеть" с помощью PowerShell](vpn-gateway-certificates-point-to-site.md), мы предоставили инструкции по MakeCert в качестве необязательного метода.</span><span class="sxs-lookup"><span data-stu-id="2063f-112">While we recommend using the [Windows 10 PowerShell steps](vpn-gateway-certificates-point-to-site.md) to create your certificates, we provide these MakeCert instructions as an optional method.</span></span> <span data-ttu-id="2063f-113">Сертификаты, созданные с помощью другого метода, можно установить [на любой поддерживаемой клиентской операционной системе](vpn-gateway-howto-point-to-site-resource-manager-portal.md#faq).</span><span class="sxs-lookup"><span data-stu-id="2063f-113">The certificates that you generate using either method can be installed on [any supported client operating system](vpn-gateway-howto-point-to-site-resource-manager-portal.md#faq).</span></span> <span data-ttu-id="2063f-114">Однако MakeCert имеет такие ограничения:</span><span class="sxs-lookup"><span data-stu-id="2063f-114">However, MakeCert has the following limitation:</span></span>

* <span data-ttu-id="2063f-115">Мы не рекомендуем использовать MakeCert.</span><span class="sxs-lookup"><span data-stu-id="2063f-115">MakeCert is deprecated.</span></span> <span data-ttu-id="2063f-116">Это значит, что средство может быть удалено в любой момент.</span><span class="sxs-lookup"><span data-stu-id="2063f-116">This means that this tool could be removed at any point.</span></span> <span data-ttu-id="2063f-117">Если MakeCert больше недоступен, это никак не повлияет на сертификаты, созданные с помощью этого средства.</span><span class="sxs-lookup"><span data-stu-id="2063f-117">Any certificates that you already generated using MakeCert won't be affected when MakeCert is no longer available.</span></span> <span data-ttu-id="2063f-118">MakeCert используется только для создания сертификатов, а не как механизм проверки.</span><span class="sxs-lookup"><span data-stu-id="2063f-118">MakeCert is only used to generate the certificates, not as a validating mechanism.</span></span>

## <span data-ttu-id="2063f-119"><a name="rootcert"></a>Создание самозаверяющего корневого сертификата</span><span class="sxs-lookup"><span data-stu-id="2063f-119"><a name="rootcert"></a>Create a self-signed root certificate</span></span>

<span data-ttu-id="2063f-120">Ниже приведены инструкции по созданию самозаверяющего сертификата с помощью MakeCert.</span><span class="sxs-lookup"><span data-stu-id="2063f-120">The following steps show you how to create a self-signed certificate using MakeCert.</span></span> <span data-ttu-id="2063f-121">Они не зависят от модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="2063f-121">These steps are not deployment-model specific.</span></span> <span data-ttu-id="2063f-122">Они подходят как для модели с использованием диспетчера ресурсов, так и для классической модели.</span><span class="sxs-lookup"><span data-stu-id="2063f-122">They are valid for both Resource Manager and classic.</span></span>

1. <span data-ttu-id="2063f-123">Скачайте и установите [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="2063f-123">Download and install [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx).</span></span>
2. <span data-ttu-id="2063f-124">После установки служебную программу makecert.exe обычно можно найти по такому пути: C:\Program Files (x86)\Windows Kits\10\bin\<arch>.</span><span class="sxs-lookup"><span data-stu-id="2063f-124">After installation, you can typically find the makecert.exe utility under this path: 'C:\Program Files (x86)\Windows Kits\10\bin\<arch>'.</span></span> <span data-ttu-id="2063f-125">Однако возможно, что она была установлена в другое место.</span><span class="sxs-lookup"><span data-stu-id="2063f-125">Although, it's possible that it was installed to another location.</span></span> <span data-ttu-id="2063f-126">Откройте командную строку от имени администратора и перейдите в расположение служебной программы MakeCert.</span><span class="sxs-lookup"><span data-stu-id="2063f-126">Open a command prompt as administrator and navigate to the location of the MakeCert utility.</span></span> <span data-ttu-id="2063f-127">Вы можете использовать следующий пример, чтобы указать правильное расположение:</span><span class="sxs-lookup"><span data-stu-id="2063f-127">You can use the following example, adjusting for the proper location:</span></span>

  ```cmd
  cd C:\Program Files (x86)\Windows Kits\10\bin\x64
  ```
3. <span data-ttu-id="2063f-128">Создайте и установите сертификат в личном хранилище сертификатов на компьютере.</span><span class="sxs-lookup"><span data-stu-id="2063f-128">Create and install a certificate in the Personal certificate store on your computer.</span></span> <span data-ttu-id="2063f-129">В следующем примере создается соответствующий *CER-файл* , передаваемый в Azure при настройке подключений типа "точка — сеть".</span><span class="sxs-lookup"><span data-stu-id="2063f-129">The following example creates a corresponding *.cer* file that you upload to Azure when configuring P2S.</span></span> <span data-ttu-id="2063f-130">Замените P2SRootCert и P2SRootCert.cer именем, которое необходимо использовать для сертификата.</span><span class="sxs-lookup"><span data-stu-id="2063f-130">Replace 'P2SRootCert' and 'P2SRootCert.cer' with the name that you want to use for the certificate.</span></span> <span data-ttu-id="2063f-131">Сертификат расположен в хранилище сертификатов: Certificates — <текущий_пользователь>\Personal\Certificates.</span><span class="sxs-lookup"><span data-stu-id="2063f-131">The certificate is located in your 'Certificates - Current User\Personal\Certificates'.</span></span>

  ```cmd
  makecert -sky exchange -r -n "CN=P2SRootCert" -pe -a sha256 -len 2048 -ss My
  ```

## <span data-ttu-id="2063f-132"><a name="cer"></a>Экспорт открытого ключа (CER)</span><span class="sxs-lookup"><span data-stu-id="2063f-132"><a name="cer"></a>Export the public key (.cer)</span></span>

[!INCLUDE [Export public key](../../includes/vpn-gateway-certificates-export-public-key-include.md)]

<span data-ttu-id="2063f-133">Файл exported.cer необходимо отправить в Azure.</span><span class="sxs-lookup"><span data-stu-id="2063f-133">The exported.cer file must be uploaded to Azure.</span></span> <span data-ttu-id="2063f-134">Дополнительные сведения см. в разделе [Подготовка CER-файла корневого сертификата к передаче](vpn-gateway-howto-point-to-site-resource-manager-portal.md#uploadfile).</span><span class="sxs-lookup"><span data-stu-id="2063f-134">For instructions, see [Configure a Point-to-Site connection](vpn-gateway-howto-point-to-site-resource-manager-portal.md#uploadfile).</span></span> <span data-ttu-id="2063f-135">Чтобы добавить дополнительные доверенные корневые сертификаты, ознакомьтесь с [разделом](vpn-gateway-howto-point-to-site-resource-manager-portal.md#add) этой статьи.</span><span class="sxs-lookup"><span data-stu-id="2063f-135">To add an additional trusted root certificate, see [this section](vpn-gateway-howto-point-to-site-resource-manager-portal.md#add) of the article.</span></span>

### <a name="export-the-self-signed-certificate-and-private-key-to-store-it-optional"></a><span data-ttu-id="2063f-136">Экспорт самозаверяющего сертификата и закрытого ключа для его сохранения (необязательно)</span><span class="sxs-lookup"><span data-stu-id="2063f-136">Export the self-signed certificate and private key to store it (optional)</span></span>

<span data-ttu-id="2063f-137">Может возникнуть необходимость экспортировать самозаверяющий корневой сертификат и сохранить его в надежном месте.</span><span class="sxs-lookup"><span data-stu-id="2063f-137">You may want to export the self-signed root certificate and store it safely.</span></span> <span data-ttu-id="2063f-138">При необходимости позднее можно будет установить его на другом компьютере и создать дополнительные сертификаты клиента или экспортировать другой CER-файл.</span><span class="sxs-lookup"><span data-stu-id="2063f-138">If need be, you can later install it on another computer and generate more client certificates, or export another .cer file.</span></span> <span data-ttu-id="2063f-139">Чтобы экспортировать самозаверяющий корневой сертификат в формате PFX, выберите корневой сертификат и выполните те же действия, что описаны в разделе [Экспорт сертификата клиента](#clientexport).</span><span class="sxs-lookup"><span data-stu-id="2063f-139">To export the self-signed root certificate as a .pfx, select the root certificate and use the same steps as described in [Export a client certificate](#clientexport).</span></span>

## <a name="create-and-install-client-certificates"></a><span data-ttu-id="2063f-140">Создание и установка сертификатов клиента</span><span class="sxs-lookup"><span data-stu-id="2063f-140">Create and install client certificates</span></span>

<span data-ttu-id="2063f-141">Не устанавливайте самозаверяющий сертификат непосредственно на клиентский компьютер.</span><span class="sxs-lookup"><span data-stu-id="2063f-141">You don't install the self-signed certificate directly on the client computer.</span></span> <span data-ttu-id="2063f-142">Нужно создать сертификат клиента из самозаверяющего сертификата.</span><span class="sxs-lookup"><span data-stu-id="2063f-142">You need to generate a client certificate from the self-signed certificate.</span></span> <span data-ttu-id="2063f-143">Затем его следует экспортировать и установить на клиентском компьютере.</span><span class="sxs-lookup"><span data-stu-id="2063f-143">You then export and install the client certificate to the client computer.</span></span> <span data-ttu-id="2063f-144">Приведенные ниже инструкции не зависят от модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="2063f-144">The following steps are not deployment-model specific.</span></span> <span data-ttu-id="2063f-145">Они подходят как для модели с использованием диспетчера ресурсов, так и для классической модели.</span><span class="sxs-lookup"><span data-stu-id="2063f-145">They are valid for both Resource Manager and classic.</span></span>

### <span data-ttu-id="2063f-146"><a name="clientcert"></a>Создание сертификата клиента</span><span class="sxs-lookup"><span data-stu-id="2063f-146"><a name="clientcert"></a>Generate a client certificate</span></span>

<span data-ttu-id="2063f-147">На каждом клиентском компьютере, который подключается к виртуальной сети с помощью подключения типа "точка —сеть", должен быть установлен сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="2063f-147">Each client computer that connects to a VNet using Point-to-Site must have a client certificate installed.</span></span> <span data-ttu-id="2063f-148">Вы можете создать сертификат клиента из самозаверяющего корневого сертификата, а затем экспортировать и установить его.</span><span class="sxs-lookup"><span data-stu-id="2063f-148">You generate a client certificate from the self-signed root certificate, and then export and install the client certificate.</span></span> <span data-ttu-id="2063f-149">Если сертификат клиента не установлен, произойдет сбой аутентификации.</span><span class="sxs-lookup"><span data-stu-id="2063f-149">If the client certificate is not installed, authentication fails.</span></span> 

<span data-ttu-id="2063f-150">Ниже описан способ создания сертификата клиента из самозаверяющего корневого сертификата.</span><span class="sxs-lookup"><span data-stu-id="2063f-150">The following steps walk you through generating a client certificate from a self-signed root certificate.</span></span> <span data-ttu-id="2063f-151">Из одного корневого сертификата можно создать несколько сертификатов клиента.</span><span class="sxs-lookup"><span data-stu-id="2063f-151">You may generate multiple client certificates from the same root certificate.</span></span> <span data-ttu-id="2063f-152">При создании сертификатов клиента с помощью приведенных ниже инструкций сертификат клиента автоматически устанавливается на компьютер, который использовался для его создания.</span><span class="sxs-lookup"><span data-stu-id="2063f-152">When you generate client certificates using the steps below, the client certificate is automatically installed on the computer that you used to generate the certificate.</span></span> <span data-ttu-id="2063f-153">Если вы хотите установить сертификат клиента на другой клиентский компьютер, его можно экспортировать.</span><span class="sxs-lookup"><span data-stu-id="2063f-153">If you want to install a client certificate on another client computer, you can export the certificate.</span></span>
 
1. <span data-ttu-id="2063f-154">На компьютере, на котором вы создали самозаверяющий сертификат, откройте командную строку от имени администратора.</span><span class="sxs-lookup"><span data-stu-id="2063f-154">On the same computer that you used to create the self-signed certificate, open a command prompt as administrator.</span></span>
2. <span data-ttu-id="2063f-155">Измените и запустите пример, чтобы создать сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="2063f-155">Modify and run the sample to generate a client certificate.</span></span>
  * <span data-ttu-id="2063f-156">Замените *P2SRootCert* именем самозаверяющего корня, из которого создается сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="2063f-156">Change *"P2SRootCert"* to the name of the self-signed root that you are generating the client certificate from.</span></span> <span data-ttu-id="2063f-157">Убедитесь, что вы используете имя корневого сертификата. Это значение "CN =", которое было указано при создании самозаверяющего корневого сертификата.</span><span class="sxs-lookup"><span data-stu-id="2063f-157">Make sure you are using the name of the root certificate, which is whatever the 'CN=' value was that you specified when you created the self-signed root.</span></span>
  * <span data-ttu-id="2063f-158">Замените *P2SChildCert* именем, которое следует использовать для создаваемого сертификата клиента.</span><span class="sxs-lookup"><span data-stu-id="2063f-158">Change *P2SChildCert* to the name you want to generate a client certificate to be.</span></span>

  <span data-ttu-id="2063f-159">Если выполнить приведенную ниже команду без изменений, в ваше хранилище личных сертификатов будет добавлен сертификат клиента с именем P2SChildcert, созданный из корневого сертификата P2SRootCert.</span><span class="sxs-lookup"><span data-stu-id="2063f-159">If you run the following example without modifying it, the result is a client certificate named P2SChildcert in your Personal certificate store that was generated from root certificate P2SRootCert.</span></span>

  ```cmd
  makecert.exe -n "CN=P2SChildCert" -pe -sky exchange -m 96 -ss My -in "P2SRootCert" -is my -a sha256
  ```

### <span data-ttu-id="2063f-160"><a name="clientexport"></a>Экспорт сертификата клиента</span><span class="sxs-lookup"><span data-stu-id="2063f-160"><a name="clientexport"></a>Export a client certificate</span></span>

[!INCLUDE [Export client certificate](../../includes/vpn-gateway-certificates-export-client-cert-include.md)]

### <span data-ttu-id="2063f-161"><a name="install"></a>Установка экспортированного сертификата клиента</span><span class="sxs-lookup"><span data-stu-id="2063f-161"><a name="install"></a>Install an exported client certificate</span></span>

[!INCLUDE [Install client certificate](../../includes/vpn-gateway-certificates-install-client-cert-include.md)]

## <a name="next-steps"></a><span data-ttu-id="2063f-162">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="2063f-162">Next steps</span></span>

<span data-ttu-id="2063f-163">Продолжайте настраивать параметры конфигурации типа "точка-сеть".</span><span class="sxs-lookup"><span data-stu-id="2063f-163">Continue with your Point-to-Site configuration.</span></span> 

* <span data-ttu-id="2063f-164">Инструкции для модели развертывания с помощью **Resource Manager** см. в статье [Настройка подключения типа "точка — сеть" к виртуальной сети с помощью портала Azure](vpn-gateway-howto-point-to-site-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="2063f-164">For **Resource Manager** deployment model steps, see [Configure a Point-to-Site connection to a VNet](vpn-gateway-howto-point-to-site-resource-manager-portal.md).</span></span>
* <span data-ttu-id="2063f-165">Инструкции для **классической** модели развертывания см. в статье [Настройка подключения типа "точка — сеть" к виртуальной сети с помощью портала Azure (классическая модель)](vpn-gateway-howto-point-to-site-classic-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="2063f-165">For **classic** deployment model steps, see [Configure a Point-to-Site VPN connection to a VNet (classic)](vpn-gateway-howto-point-to-site-classic-azure-portal.md).</span></span>
