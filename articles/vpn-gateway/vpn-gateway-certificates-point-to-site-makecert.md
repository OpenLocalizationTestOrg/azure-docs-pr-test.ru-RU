---
title: "Создание и экспорт сертификатов для подключений типа \"точка — сеть\" в Azure с помощью MakeCert | Документация Майкрософт"
description: "В этой статье содержатся действия toocreate самозаверяющий корневой сертификат, экспортируйте открытый ключ hello и создания сертификатов клиента с помощью средства MakeCert."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/09/2017
ms.author: cherylmc
ms.openlocfilehash: 0b795ccf74f1f97fbd3de8a0dc339f9cb0b48183
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="generate-and-export-certificates-for-point-to-site-connections-using-makecert"></a><span data-ttu-id="c7554-103">Создание и экспорт сертификатов для подключений типа "точка — сеть" с помощью MakeCert</span><span class="sxs-lookup"><span data-stu-id="c7554-103">Generate and export certificates for Point-to-Site connections using MakeCert</span></span>

<span data-ttu-id="c7554-104">Точка-сеть соединения используют tooauthenticate сертификаты.</span><span class="sxs-lookup"><span data-stu-id="c7554-104">Point-to-Site connections use certificates tooauthenticate.</span></span> <span data-ttu-id="c7554-105">В этой статье показано, как toocreate a самозаверяющий корневой сертификат и создания сертификатов клиента с помощью средства MakeCert.</span><span class="sxs-lookup"><span data-stu-id="c7554-105">This article shows you how toocreate a self-signed root certificate and generate client certificates using MakeCert.</span></span> <span data-ttu-id="c7554-106">Если вам нужны дополнительные действия по настройке точки сайтами, таких как как список tooupload корневые сертификаты, выберите один из статей hello "Настройка точка-сеть" из hello следующие:</span><span class="sxs-lookup"><span data-stu-id="c7554-106">If you are looking for Point-to-Site configuration steps, such as how tooupload root certificates, select one of hello 'Configure Point-to-Site' articles from hello following list:</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="c7554-107">Создание самозаверяющих сертификатов с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="c7554-107">Create self-signed certificates - PowerShell</span></span>](vpn-gateway-certificates-point-to-site.md)
> * [<span data-ttu-id="c7554-108">Создание и экспорт сертификатов для подключений типа "точка — сеть" с помощью MakeCert</span><span class="sxs-lookup"><span data-stu-id="c7554-108">Create self-signed certificates - MakeCert</span></span>](vpn-gateway-certificates-point-to-site-makecert.md)
> * [<span data-ttu-id="c7554-109">Настройка подключения "точка — сеть" модели Resource Manager на портале Azure</span><span class="sxs-lookup"><span data-stu-id="c7554-109">Configure Point-to-Site - Resource Manager - Azure portal</span></span>](vpn-gateway-howto-point-to-site-resource-manager-portal.md)
> * [<span data-ttu-id="c7554-110">Настройка подключения "точка-сеть" — Resource Manager — PowerShell</span><span class="sxs-lookup"><span data-stu-id="c7554-110">Configure Point-to-Site - Resource Manager - PowerShell</span></span>](vpn-gateway-howto-point-to-site-rm-ps.md)
> * [<span data-ttu-id="c7554-111">Настройка подключения "точка —сеть" классической модели на портале Azure</span><span class="sxs-lookup"><span data-stu-id="c7554-111">Configure Point-to-Site - Classic - Azure portal</span></span>](vpn-gateway-howto-point-to-site-classic-azure-portal.md)
> 
> 

<span data-ttu-id="c7554-112">Хотя мы рекомендуем использовать hello [действия Windows 10 PowerShell](vpn-gateway-certificates-point-to-site.md) toocreate сертификаты, мы предоставляем эти инструкции MakeCert необязательный метод.</span><span class="sxs-lookup"><span data-stu-id="c7554-112">While we recommend using hello [Windows 10 PowerShell steps](vpn-gateway-certificates-point-to-site.md) toocreate your certificates, we provide these MakeCert instructions as an optional method.</span></span> <span data-ttu-id="c7554-113">Hello сертификаты, создаваемые с помощью любого метода, которые можно установить на [любых поддерживаемых клиентских операционных систем](vpn-gateway-howto-point-to-site-resource-manager-portal.md#faq).</span><span class="sxs-lookup"><span data-stu-id="c7554-113">hello certificates that you generate using either method can be installed on [any supported client operating system](vpn-gateway-howto-point-to-site-resource-manager-portal.md#faq).</span></span> <span data-ttu-id="c7554-114">Однако MakeCert имеет следующие ограничения hello.</span><span class="sxs-lookup"><span data-stu-id="c7554-114">However, MakeCert has hello following limitation:</span></span>

* <span data-ttu-id="c7554-115">Мы не рекомендуем использовать MakeCert.</span><span class="sxs-lookup"><span data-stu-id="c7554-115">MakeCert is deprecated.</span></span> <span data-ttu-id="c7554-116">Это значит, что средство может быть удалено в любой момент.</span><span class="sxs-lookup"><span data-stu-id="c7554-116">This means that this tool could be removed at any point.</span></span> <span data-ttu-id="c7554-117">Если MakeCert больше недоступен, это никак не повлияет на сертификаты, созданные с помощью этого средства.</span><span class="sxs-lookup"><span data-stu-id="c7554-117">Any certificates that you already generated using MakeCert won't be affected when MakeCert is no longer available.</span></span> <span data-ttu-id="c7554-118">MakeCert не только сертификаты используется toogenerate hello как механизм проверки.</span><span class="sxs-lookup"><span data-stu-id="c7554-118">MakeCert is only used toogenerate hello certificates, not as a validating mechanism.</span></span>

## <span data-ttu-id="c7554-119"><a name="rootcert"></a>Создание самозаверяющего корневого сертификата</span><span class="sxs-lookup"><span data-stu-id="c7554-119"><a name="rootcert"></a>Create a self-signed root certificate</span></span>

<span data-ttu-id="c7554-120">Привет, следующие шаги показывают, как toocreate a самозаверяющий сертификат с помощью средства MakeCert.</span><span class="sxs-lookup"><span data-stu-id="c7554-120">hello following steps show you how toocreate a self-signed certificate using MakeCert.</span></span> <span data-ttu-id="c7554-121">Они не зависят от модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="c7554-121">These steps are not deployment-model specific.</span></span> <span data-ttu-id="c7554-122">Они подходят как для модели с использованием диспетчера ресурсов, так и для классической модели.</span><span class="sxs-lookup"><span data-stu-id="c7554-122">They are valid for both Resource Manager and classic.</span></span>

1. <span data-ttu-id="c7554-123">Скачайте и установите [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="c7554-123">Download and install [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx).</span></span>
2. <span data-ttu-id="c7554-124">После установки, обычно можно найти служебной программы makecert.exe hello в этом пути: "C:\Program Files (x86) \Windows Kits\10\bin\<arch >".</span><span class="sxs-lookup"><span data-stu-id="c7554-124">After installation, you can typically find hello makecert.exe utility under this path: 'C:\Program Files (x86)\Windows Kits\10\bin\<arch>'.</span></span> <span data-ttu-id="c7554-125">Однако это возможно, было установленных tooanother расположение.</span><span class="sxs-lookup"><span data-stu-id="c7554-125">Although, it's possible that it was installed tooanother location.</span></span> <span data-ttu-id="c7554-126">Откройте командную строку от имени администратора и перейдите в расположение toohello hello программа MakeCert.</span><span class="sxs-lookup"><span data-stu-id="c7554-126">Open a command prompt as administrator and navigate toohello location of hello MakeCert utility.</span></span> <span data-ttu-id="c7554-127">Можно использовать hello следующий пример, настраивая для соответствующего местоположения hello.</span><span class="sxs-lookup"><span data-stu-id="c7554-127">You can use hello following example, adjusting for hello proper location:</span></span>

  ```cmd
  cd C:\Program Files (x86)\Windows Kits\10\bin\x64
  ```
3. <span data-ttu-id="c7554-128">Создайте и установите сертификат в хранилище личных сертификатов hello на вашем компьютере.</span><span class="sxs-lookup"><span data-stu-id="c7554-128">Create and install a certificate in hello Personal certificate store on your computer.</span></span> <span data-ttu-id="c7554-129">Hello следующий пример создает соответствующий *.cer* отправить tooAzure при настройке P2S файла.</span><span class="sxs-lookup"><span data-stu-id="c7554-129">hello following example creates a corresponding *.cer* file that you upload tooAzure when configuring P2S.</span></span> <span data-ttu-id="c7554-130">Замените имя hello требуется toouse для сертификата hello «P2SRootCert» и «P2SRootCert.cer».</span><span class="sxs-lookup"><span data-stu-id="c7554-130">Replace 'P2SRootCert' and 'P2SRootCert.cer' with hello name that you want toouse for hello certificate.</span></span> <span data-ttu-id="c7554-131">Hello сертификат находится в «Сертификаты — текущий пользователь\личные\сертификаты».</span><span class="sxs-lookup"><span data-stu-id="c7554-131">hello certificate is located in your 'Certificates - Current User\Personal\Certificates'.</span></span>

  ```cmd
  makecert -sky exchange -r -n "CN=P2SRootCert" -pe -a sha256 -len 2048 -ss My
  ```

## <span data-ttu-id="c7554-132"><a name="cer"></a>Экспорт hello открытого ключа (CER)</span><span class="sxs-lookup"><span data-stu-id="c7554-132"><a name="cer"></a>Export hello public key (.cer)</span></span>

[!INCLUDE [Export public key](../../includes/vpn-gateway-certificates-export-public-key-include.md)]

<span data-ttu-id="c7554-133">Hello exported.cer файл должен быть загруженного tooAzure.</span><span class="sxs-lookup"><span data-stu-id="c7554-133">hello exported.cer file must be uploaded tooAzure.</span></span> <span data-ttu-id="c7554-134">Дополнительные сведения см. в разделе [Подготовка CER-файла корневого сертификата к передаче](vpn-gateway-howto-point-to-site-resource-manager-portal.md#uploadfile).</span><span class="sxs-lookup"><span data-stu-id="c7554-134">For instructions, see [Configure a Point-to-Site connection](vpn-gateway-howto-point-to-site-resource-manager-portal.md#uploadfile).</span></span> <span data-ttu-id="c7554-135">tooadd дополнительных доверенный корневой сертификат в разделе [в этом разделе](vpn-gateway-howto-point-to-site-resource-manager-portal.md#add) hello статьи.</span><span class="sxs-lookup"><span data-stu-id="c7554-135">tooadd an additional trusted root certificate, see [this section](vpn-gateway-howto-point-to-site-resource-manager-portal.md#add) of hello article.</span></span>

### <a name="export-hello-self-signed-certificate-and-private-key-toostore-it-optional"></a><span data-ttu-id="c7554-136">Экспортировать hello самозаверяющего сертификата и закрытого ключа toostore его (необязательно)</span><span class="sxs-lookup"><span data-stu-id="c7554-136">Export hello self-signed certificate and private key toostore it (optional)</span></span>

<span data-ttu-id="c7554-137">Вы можете tooexport hello самозаверяющий корневой сертификат и безопасно хранить.</span><span class="sxs-lookup"><span data-stu-id="c7554-137">You may want tooexport hello self-signed root certificate and store it safely.</span></span> <span data-ttu-id="c7554-138">При необходимости позднее можно будет установить его на другом компьютере и создать дополнительные сертификаты клиента или экспортировать другой CER-файл.</span><span class="sxs-lookup"><span data-stu-id="c7554-138">If need be, you can later install it on another computer and generate more client certificates, or export another .cer file.</span></span> <span data-ttu-id="c7554-139">tooexport hello самозаверяющий корневой сертификат как PFX-файл, выберите hello корневой сертификат или использовать hello же действия, как описано в [Экспорт сертификата клиента](#clientexport).</span><span class="sxs-lookup"><span data-stu-id="c7554-139">tooexport hello self-signed root certificate as a .pfx, select hello root certificate and use hello same steps as described in [Export a client certificate](#clientexport).</span></span>

## <a name="create-and-install-client-certificates"></a><span data-ttu-id="c7554-140">Создание и установка сертификатов клиента</span><span class="sxs-lookup"><span data-stu-id="c7554-140">Create and install client certificates</span></span>

<span data-ttu-id="c7554-141">Не устанавливайте самозаверяющий сертификат hello непосредственно на клиентском компьютере hello.</span><span class="sxs-lookup"><span data-stu-id="c7554-141">You don't install hello self-signed certificate directly on hello client computer.</span></span> <span data-ttu-id="c7554-142">Необходимо toogenerate сертификат клиента из hello самозаверяющий сертификат.</span><span class="sxs-lookup"><span data-stu-id="c7554-142">You need toogenerate a client certificate from hello self-signed certificate.</span></span> <span data-ttu-id="c7554-143">Вы затем экспортировать и установите hello клиентского сертификата toohello клиентском компьютере.</span><span class="sxs-lookup"><span data-stu-id="c7554-143">You then export and install hello client certificate toohello client computer.</span></span> <span data-ttu-id="c7554-144">следующие шаги Hello не зависят от модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="c7554-144">hello following steps are not deployment-model specific.</span></span> <span data-ttu-id="c7554-145">Они подходят как для модели с использованием диспетчера ресурсов, так и для классической модели.</span><span class="sxs-lookup"><span data-stu-id="c7554-145">They are valid for both Resource Manager and classic.</span></span>

### <span data-ttu-id="c7554-146"><a name="clientcert"></a>Создание сертификата клиента</span><span class="sxs-lookup"><span data-stu-id="c7554-146"><a name="clientcert"></a>Generate a client certificate</span></span>

<span data-ttu-id="c7554-147">Каждый клиентский компьютер, который подключается tooa виртуальной сети с помощью точка-сайт должен иметь установленный сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="c7554-147">Each client computer that connects tooa VNet using Point-to-Site must have a client certificate installed.</span></span> <span data-ttu-id="c7554-148">Создайте сертификат клиента из hello самозаверяющий корневой сертификат и затем экспортировать и установите сертификат клиента hello.</span><span class="sxs-lookup"><span data-stu-id="c7554-148">You generate a client certificate from hello self-signed root certificate, and then export and install hello client certificate.</span></span> <span data-ttu-id="c7554-149">Если сертификат клиента hello не установлен, не пройдет проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="c7554-149">If hello client certificate is not installed, authentication fails.</span></span> 

<span data-ttu-id="c7554-150">Hello следующие шаги описывают создание клиентский сертификат из самозаверяющего корневого сертификата.</span><span class="sxs-lookup"><span data-stu-id="c7554-150">hello following steps walk you through generating a client certificate from a self-signed root certificate.</span></span> <span data-ttu-id="c7554-151">Можно создать несколько сертификатов из hello выдачи корневых сертификатов.</span><span class="sxs-lookup"><span data-stu-id="c7554-151">You may generate multiple client certificates from hello same root certificate.</span></span> <span data-ttu-id="c7554-152">При создании клиентских сертификатов, используя приведенные ниже действия hello hello сертификат клиента автоматически устанавливается на компьютере hello использования сертификата toogenerate hello.</span><span class="sxs-lookup"><span data-stu-id="c7554-152">When you generate client certificates using hello steps below, hello client certificate is automatically installed on hello computer that you used toogenerate hello certificate.</span></span> <span data-ttu-id="c7554-153">Если требуется tooinstall сертификата клиента на другой компьютер, можно экспортировать сертификат hello.</span><span class="sxs-lookup"><span data-stu-id="c7554-153">If you want tooinstall a client certificate on another client computer, you can export hello certificate.</span></span>
 
1. <span data-ttu-id="c7554-154">На hello же компьютере, что вы использовали toocreate hello самоподписанный сертификат, откройте командную строку от имени администратора.</span><span class="sxs-lookup"><span data-stu-id="c7554-154">On hello same computer that you used toocreate hello self-signed certificate, open a command prompt as administrator.</span></span>
2. <span data-ttu-id="c7554-155">Изменения и запуска образца toogenerate hello сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="c7554-155">Modify and run hello sample toogenerate a client certificate.</span></span>
  * <span data-ttu-id="c7554-156">Изменение *«P2SRootCert»* toohello имя, для которого создается hello клиентский сертификат из самозаверяющего корневого hello.</span><span class="sxs-lookup"><span data-stu-id="c7554-156">Change *"P2SRootCert"* toohello name of hello self-signed root that you are generating hello client certificate from.</span></span> <span data-ttu-id="c7554-157">Убедитесь, что вы используете имя hello hello корневой сертификат, который является любой hello "CN =" значение было указано при создании самозаверяющего корневого hello.</span><span class="sxs-lookup"><span data-stu-id="c7554-157">Make sure you are using hello name of hello root certificate, which is whatever hello 'CN=' value was that you specified when you created hello self-signed root.</span></span>
  * <span data-ttu-id="c7554-158">Изменение *P2SChildCert* toohello имя, которое будет toogenerate toobe сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="c7554-158">Change *P2SChildCert* toohello name you want toogenerate a client certificate toobe.</span></span>

  <span data-ttu-id="c7554-159">При запуске hello следующий пример без изменения его результат hello — сертификат клиента с именем P2SChildcert в хранилище личных сертификатов, который был создан из корневого сертификата P2SRootCert.</span><span class="sxs-lookup"><span data-stu-id="c7554-159">If you run hello following example without modifying it, hello result is a client certificate named P2SChildcert in your Personal certificate store that was generated from root certificate P2SRootCert.</span></span>

  ```cmd
  makecert.exe -n "CN=P2SChildCert" -pe -sky exchange -m 96 -ss My -in "P2SRootCert" -is my -a sha256
  ```

### <span data-ttu-id="c7554-160"><a name="clientexport"></a>Экспорт сертификата клиента</span><span class="sxs-lookup"><span data-stu-id="c7554-160"><a name="clientexport"></a>Export a client certificate</span></span>

[!INCLUDE [Export client certificate](../../includes/vpn-gateway-certificates-export-client-cert-include.md)]

### <span data-ttu-id="c7554-161"><a name="install"></a>Установка экспортированного сертификата клиента</span><span class="sxs-lookup"><span data-stu-id="c7554-161"><a name="install"></a>Install an exported client certificate</span></span>

[!INCLUDE [Install client certificate](../../includes/vpn-gateway-certificates-install-client-cert-include.md)]

## <a name="next-steps"></a><span data-ttu-id="c7554-162">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c7554-162">Next steps</span></span>

<span data-ttu-id="c7554-163">Продолжайте настраивать параметры конфигурации типа "точка-сеть".</span><span class="sxs-lookup"><span data-stu-id="c7554-163">Continue with your Point-to-Site configuration.</span></span> 

* <span data-ttu-id="c7554-164">Для **диспетчера ресурсов** модели шагов развертывания см. в разделе [Настройка tooa подключение точка-сайт виртуальной сети](vpn-gateway-howto-point-to-site-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="c7554-164">For **Resource Manager** deployment model steps, see [Configure a Point-to-Site connection tooa VNet](vpn-gateway-howto-point-to-site-resource-manager-portal.md).</span></span>
* <span data-ttu-id="c7554-165">Для **классический** модели шагов развертывания см. в разделе [Настройка tooa подключение точка-сеть VPN виртуальной сети (классические)](vpn-gateway-howto-point-to-site-classic-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="c7554-165">For **classic** deployment model steps, see [Configure a Point-to-Site VPN connection tooa VNet (classic)](vpn-gateway-howto-point-to-site-classic-azure-portal.md).</span></span>
