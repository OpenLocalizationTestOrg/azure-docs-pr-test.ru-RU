---
title: "Размещение нескольких сайтов с помощью шлюза приложений Azure | Документация Майкрософт"
description: "Эта страница содержит инструкции по настройке с помощью портала Azure существующего шлюза приложений Azure для размещения нескольких веб-приложений в одном шлюзе."
documentationcenter: na
services: application-gateway
author: davidmu1
manager: timlt
editor: tysonn
ms.assetid: 95f892f6-fa27-47ee-b980-7abf4f2c66a9
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/23/2017
ms.author: davidmu
ms.openlocfilehash: 28a7fcb3e08a9c4b6a27e9fbc8d3ebae309adc62
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="configure-an-existing-application-gateway-for-hosting-multiple-web-applications"></a>Настройка шлюза приложений для размещения нескольких веб-приложений

> [!div class="op_single_selector"]
> * [Портал Azure](application-gateway-create-multisite-portal.md)
> * [PowerShell и диспетчер ресурсов Azure](application-gateway-create-multisite-azureresourcemanager-powershell.md)
> 
> 

Размещение нескольких сайтов позволяет развернуть в одном шлюзе приложений не одно, а несколько веб-приложений. Чтобы определить, какой прослушиватель должен принимать трафик, шлюз приложений проверяет наличие заголовка узла во входящем HTTP-запросе. Затем прослушиватель направляет трафик в соответствующий внутренний пул согласно определениям правил шлюза. В веб-приложениях с поддержкой протокола SSL шлюз приложений использует расширение SNI (указание имени сервера) для выбора соответствующего прослушивателя веб-трафика. Как правило, размещение нескольких сайтов используется для балансировки нагрузки запросов к разным веб-доменам между различными внутренними пулами серверов. Подобным образом в одном шлюзе приложений можно разместить несколько поддоменов одного корневого домена.

## <a name="scenario"></a>Сценарий

В следующем примере шлюз приложений обслуживает трафик сайтов contoso.com и fabrikam.com с помощью двух внутренних пулов серверов: contoso и fabrikam. Аналогичную конфигурацию можно использовать для размещения таких поддоменов, как app.contoso.com и blog.contoso.com.

![сценарий с несколькими сайтами][multisite]

## <a name="before-you-begin"></a>Перед началом работы

Этот сценарий добавляет поддержку нескольких сайтов для существующего шлюза приложений. Для выполнения этого сценария потребуется шлюз приложений, который можно настроить. Изучите статью [Создание шлюза приложений с помощью портала](application-gateway-create-gateway-portal.md), чтобы узнать о создании базового шлюза приложений на портале.

Выполните следующие действия, чтобы обновить конфигурацию шлюза приложений.

1. Создание пулов серверной части для каждого узла.
2. Создание прослушивателя для каждого сайта, который поддерживает шлюз приложений.
3. Создание правил для сопоставления каждого прослушивателя с соответствующей серверной частью.

## <a name="requirements"></a>Требования

* **Внутренний пул серверов**. Список IP-адресов внутренних серверов. Указанные IP-адреса должны относиться к подсети виртуальной сети либо представлять собой общедоступные или виртуальные IP-адреса. Можно также использовать полное доменное имя.
* **Параметры внутреннего пула серверов**. Каждый пул имеет такие параметры, как порт, протокол и сходство на основе файлов cookie. Эти параметры привязываются к пулу и применяются ко всем серверам в этом пуле.
* **Интерфейсный порт**. Общедоступный порт, открытый в шлюзе приложений. Трафик поступает на этот порт, а затем перенаправляется на один из тыловых серверов.
* **Прослушиватель**. У прослушивателя есть интерфейсный порт, протокол (Http или Https — с учетом регистра) и имя SSL-сертификата (в случае настройки разгрузки SSL). Для шлюзов приложений с поддержкой нескольких сайтов также добавляются имя узла и индикаторы SNI.
* **Правило**. Правило связывает прослушиватель и внутренний пул серверов, а также определяет, в какой внутренний пул серверов следует направлять трафик, поступающий на определенный прослушиватель. Правила обрабатываются в том порядке, в котором они указаны, а трафик направляется через первое подходящее правило независимо от точности. Например, если для одного порта имеется правило с базовым прослушивателем и правило с многосайтовым прослушивателем, для обеспечения правильной работы правило с многосайтовым прослушивателем должно быть указано перед правилом с базовым прослушивателем. 
* **Сертификаты:** каждый прослушиватель должен иметь уникальный сертификат. В этом примере мы создаем 2 прослушивателя для поддержки нескольких сайтов. Для них нужно создать два сертификата PFX и пароли для них.

## <a name="create-back-end-pools-for-each-site"></a>Создание пулов серверной части для каждого узла

Требуется отдельный внутренний пул для каждого сайта, который поддерживает шлюз приложений. В данном случае создаются 2 пула: один для contoso11.com и второй для fabrikam11.com.

### <a name="step-1"></a>Шаг 1.

На портале Azure (https://portal.azure.com) перейдите к существующему шлюзу приложений. Выберите **Пулы серверной части** и нажмите кнопку **Добавить**

![Добавление пулов серверной части][7]

### <a name="step-2"></a>Шаг 2

Заполните сведения для пула серверной части **pool1**, добавив IP-адреса или полные доменные имена серверов, и нажмите кнопку **ОК**

![Параметры пула серверной части pool1][8]

### <a name="step-3"></a>Шаг 3.

В колонке пулов серверной части нажмите кнопку **Добавить**, чтобы создать дополнительный пул серверной части **pool2**. Внесите для него IP-адреса или полные доменные имена серверов и нажмите кнопку **ОК**

![Параметры пула серверной части pool2][9]

## <a name="create-listeners-for-each-back-end"></a>Создание прослушивателей для каждой серверной части

Шлюз приложений использует заголовки узлов HTTP 1.1 для размещения нескольких веб-сайтов на одном общедоступном IP-адресе и порте. Базовые прослушиватели, создаваемые на портале, не содержат этого свойства.

### <a name="step-1"></a>Шаг 1

Щелкните **Прослушиватели** для существующего шлюза приложений, затем выберите **Многосайтовый**, чтобы добавить первый прослушиватель.

![Колонка обзора прослушивателей][1]

### <a name="step-2"></a>Шаг 2

Заполните сведения о прослушивателе. В этом примере мы настраиваем оконечную точку SSL, поэтому создайте внешний порт. Отправьте PFX-файл сертификата, который будет использоваться для оконечной точки SSL. Эта колонка отличается от колонки стандартного базового прослушивателя только наличием имени узла.

![Колонка свойств прослушивателя][2]

### <a name="step-3"></a>Шаг 3.

Щелкните **Многосайтовый** и создайте второй прослушиватель для второго сайта, как описано в предыдущем шаге. Для второго прослушивателя необходимо использовать другой сертификат. Эта колонка отличается от колонки стандартного базового прослушивателя только наличием имени узла. Введите сведения о прослушивателе и нажмите **ОК**.

![Колонка свойств прослушивателя][3]

> [!NOTE]
> Создание на портале Azure прослушивателей для шлюза приложений — довольно длительный процесс, и создание двух прослушивателей в нашем примере может занять много времени. По завершении процесса прослушиватели будут отображены на портале, как показано на следующем изображении:

![Обзор прослушивателей][4]

## <a name="create-rules-to-map-listeners-to-backend-pools"></a>Создание правил для сопоставления прослушивателей с пулами серверной части

### <a name="step-1"></a>Шаг 1

На портале Azure (https://portal.azure.com) перейдите к существующему шлюзу приложений. Выберите **Правила**, затем выберите существующее правило по умолчанию **rule1** и нажмите кнопку **Изменить**.

### <a name="step-2"></a>Шаг 2

Заполните колонку правил, как показано на следующем изображении. Для этого выберите первый прослушиватель и первый пул, затем щелкните **Сохранить**.

![Изменение существующего правила][6]

### <a name="step-3"></a>Шаг 3.

Щелкните **Basic rule** (Базовое правило), чтобы создать второе правило. Заполните форму для второго прослушивателя и второго пула серверной части, затем щелкните **ОК** для сохранения.

![Колонка добавления базового правила][10]

На этом завершается настройка существующего шлюза приложений с поддержкой нескольких сайтов на портале Azure.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как защитить веб-сайты с помощью [брандмауэра веб-приложения шлюза приложений](application-gateway-webapplicationfirewall-overview.md).

<!--Image references-->
[1]: ./media/application-gateway-create-multisite-portal/figure1.png
[2]: ./media/application-gateway-create-multisite-portal/figure2.png
[3]: ./media/application-gateway-create-multisite-portal/figure3.png
[4]: ./media/application-gateway-create-multisite-portal/figure4.png
[5]: ./media/application-gateway-create-multisite-portal/figure5.png
[6]: ./media/application-gateway-create-multisite-portal/figure6.png
[7]: ./media/application-gateway-create-multisite-portal/figure7.png
[8]: ./media/application-gateway-create-multisite-portal/figure8.png
[9]: ./media/application-gateway-create-multisite-portal/figure9.png
[10]: ./media/application-gateway-create-multisite-portal/figure10.png
[multisite]: ./media/application-gateway-create-multisite-portal/multisite.png
