---
title: "ошибки aaaTroubleshoot Azure шлюза неверное использование шлюза приложений (502) | Документы Microsoft"
description: "Узнайте, как ошибки tootroubleshoot 502 шлюза приложения"
services: application-gateway
documentationcenter: na
author: amitsriva
manager: rossort
editor: 
tags: azure-resource-manager
ms.assetid: 1d431ead-d318-47d8-b3ad-9c69f7e08813
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/09/2017
ms.author: amsriva
ms.openlocfilehash: a50f736ac157256a53f6fbe3a208f0c11dd58f4f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-bad-gateway-errors-in-application-gateway"></a>Устранение ошибок "Недопустимый шлюз" в шлюзе приложений

Узнайте, как получение ошибки (502) Недопустимый шлюз tootroubleshoot при использовании шлюза приложений.

## <a name="overview"></a>Обзор

После настройки шлюза приложения, одна из ошибок hello, которыми может столкнуться пользователь — «ошибка сервера: 502 - веб-сервер получил недопустимый ответ играя роль шлюза или прокси-сервер». Эта ошибка может возникать из-за следующих toohello основных причин:

* [серверный пул шлюза приложений Azure не настроен или пуст](#empty-backendaddresspool);
* Ни одна из виртуальных машин hello и экземпляры в [набора масштабирования виртуальных Машин находятся в работоспособном состоянии](#unhealthy-instances-in-backendaddresspool).
* Виртуальные машины или экземпляров набора масштабирования виртуальных Машин серверной части, [пробы работоспособности по умолчанию не отвечает toohello](#problems-with-default-health-probe.md).
* недопустимая или неправильная [конфигурация пользовательских проб работоспособности](#problems-with-custom-health-probe.md);
* [истекло время запроса или при его обработке возникли проблемы с подключением](#request-time-out).

## <a name="empty-backendaddresspool"></a>Пустой серверный пул адресов

### <a name="cause"></a>Причина:

Если hello шлюз приложений содержит никакие ВМ или набора масштабирования виртуальных Машин настроены в пул адресов серверной части hello, он не может направить любой запрос клиента и вызывает ошибку Недопустимый шлюз.

### <a name="solution"></a>Решение

Убедитесь, что пул адресов серверной части hello не является пустым. Это можно сделать с помощью PowerShell, интерфейса командной строки или на портале.

```powershell
Get-AzureRmApplicationGateway -Name "SampleGateway" -ResourceGroupName "ExampleResourceGroup"
```

Hello выходные данные предшествующей командлет hello должен содержать пул адресов серверной части пустым. В примере ниже возвращаются два пула, в которых для серверных виртуальных машин указано полное доменное имя или IP-адрес. Здравствуйте, состояние подготовки hello BackendAddressPool должен быть «успешно».

BackendAddressPoolsText:

```json
[{
    "BackendAddresses": [{
        "ipAddress": "10.0.0.10",
        "ipAddress": "10.0.0.11"
    }],
    "BackendIpConfigurations": [],
    "ProvisioningState": "Succeeded",
    "Name": "Pool01",
    "Etag": "W/\"00000000-0000-0000-0000-000000000000\"",
    "Id": "/subscriptions/<subscription id>/resourceGroups/<resource group name>/providers/Microsoft.Network/applicationGateways/<application gateway name>/backendAddressPools/pool01"
}, {
    "BackendAddresses": [{
        "Fqdn": "xyx.cloudapp.net",
        "Fqdn": "abc.cloudapp.net"
    }],
    "BackendIpConfigurations": [],
    "ProvisioningState": "Succeeded",
    "Name": "Pool02",
    "Etag": "W/\"00000000-0000-0000-0000-000000000000\"",
    "Id": "/subscriptions/<subscription id>/resourceGroups/<resource group name>/providers/Microsoft.Network/applicationGateways/<application gateway name>/backendAddressPools/pool02"
}]
```

## <a name="unhealthy-instances-in-backendaddresspool"></a>Неработоспособные экземпляры в серверном пуле адресов

### <a name="cause"></a>Причина:

Если все экземпляры hello BackendAddressPool находятся в неработоспособном состоянии, шлюз приложений не будет содержать любой запрос пользователя tooroute серверной части для. Это может быть случай hello при внутреннем экземпляры находятся в работоспособном состоянии, но не развернутое приложение hello требуется.

### <a name="solution"></a>Решение

Убедитесь, что экземпляры hello находятся в работоспособном состоянии, и приложение hello настроена правильно. Флажок, если экземпляры внутренней hello ping может toorespond tooa из другой виртуальной Машине в hello одной виртуальной сети. Если общедоступная конечная точка, убедитесь в наличии обслуживания веб-приложения браузера toohello запроса.

## <a name="problems-with-default-health-probe"></a>Проблемы со стандартной пробой работоспособности

### <a name="cause"></a>Причина:

также можно часто, hello пробы работоспособности по умолчанию индикаторы ошибки 502 — не удается tooreach ВМ серверной части. При подготовке экземпляра шлюза приложения tooeach проверки работоспособности по умолчанию BackendAddressPool автоматически настраивается с помощью свойств hello BackendHttpSetting. Пользователь не входные данные tooset необходимые проверки. В частности, при настройке правила балансировки нагрузки создается связь между параметром BackendHttpSetting и серверным пулом адресов. Проба по умолчанию настраивается для каждого из этих сопоставлений и экземпляр tooeach периодических работоспособности проверки соединений в hello BackendAddressPool на hello порт, указанный в элементе BackendHttpSetting hello инициирует шлюз приложений. Ниже перечислены значения hello, связанные с пробы работоспособности по умолчанию hello.

| Свойства проверки | Значение | Описание |
| --- | --- | --- |
| URL-адрес проверки |http://127.0.0.1/ |URL-адрес |
| Интервал |30 |Интервал проверки в секундах |
| Время ожидания |30 |Время ожидания проверки в секундах |
| Пороговое значение сбоя |3 |Количество повторных попыток проверки. Hello внутренний сервер помечен после количество сбоев проверки последовательных hello достигает неработоспособности порога hello. |

### <a name="solution"></a>Решение

* Убедитесь, что стандартный сайт настроен и ожидает передачи данных по адресу 127.0.0.1.
* Если BackendHttpSetting указывает порт, отличный от 80, сайт по умолчанию hello должно быть настроенный toolisten этого порта.
* Hello toohttp://127.0.0.1:port вызов вернет код результата HTTP 200. Это должно быть возвращено в течение времени ожидания 30 секунд hello.
* Убедитесь, что открыт порт настроен и что не существует правил брандмауэра или группы безопасности сети Azure, которая Блокировать входящий и исходящий трафик через порт hello настроен.
* При использовании Azure классические виртуальные машины или облачной службы с полным доменным ИМЕНЕМ или общедоступный IP-адрес, убедитесь в соответствующих hello [конечная точка](../virtual-machines/windows/classic/setup-endpoints.md?toc=%2fazure%2fapplication-gateway%2ftoc.json) открыт.
* Если hello виртуальной Машины настраивается посредством Azure Resource Manager и находится за пределами виртуальной сети, где развернут шлюз приложения, hello [группы безопасности сети](../virtual-network/virtual-networks-nsg.md) должен быть настроен доступ tooallow на hello требуемого порта.

## <a name="problems-with-custom-health-probe"></a>Проблемы с пользовательскими пробами работоспособности

### <a name="cause"></a>Причина:

Зонды работоспособности пользовательского позволяют гибко по умолчанию toohello проверки поведения. При использовании пользовательских зондов, прежде чем помечать hello внутреннем пуле экземпляр неработоспособен пользователей можно настроить интервал отправки проб hello, hello URL-адрес и путь tootest и сколько неудачных откликов tooaccept. добавлены следующие дополнительные свойства Hello.

| Свойства проверки | Описание |
| --- | --- |
| Имя |Имя пробы hello. Это имя уже используется toorefer toohello проверки в серверной части параметров HTTP. |
| Протокол |Использовать протокол проверки toosend hello. зонд Hello использует протокол hello, заданного в настройках HTTP hello серверной части |
| Узел |Зонд hello toosend имя узла. Применяется только тогда, когда в шлюзе приложений настроено многосайтовое подключение. (То есть указывается не имя узла виртуальной машины.) |
| Путь |Относительный путь проверки hello. Hello допустимый путь начинается с «/». зонд Hello отправляется слишком\<протокола\>://\<узла\>:\<порт\>\<путь\> |
| Интервал |Интервал проверки в секундах. Это hello временной интервал между двумя последовательными зонды. |
| Время ожидания |Время ожидания проверки в секундах. Если допустимый ответ не получен в течение этого времени ожидания, пробы hello отмечен как непройденный. |
| Пороговое значение сбоя |Количество повторных попыток проверки. Hello внутренний сервер помечен после количество сбоев проверки последовательных hello достигает неработоспособности порога hello. |

### <a name="solution"></a>Решение

Проверьте, приветствия настраиваемый проверки работоспособности настроена правильно как hello предшествующей таблице. Кроме того toohello выше устранения неполадок, проверьте следующие hello:

* Убедитесь, что пробы hello правильно указано согласно hello [руководство](application-gateway-create-probe-ps.md).
* Если шлюз приложение настраивается для одного узла, по умолчанию hello узла имя должно указываться как "127.0.0.1», если в противном случае настроена в пользовательский зонд.
* Убедитесь, что toohttp вызова: / /\<узла\>:\<порт\>\<путь\> возвращает код результата HTTP 200.
* Убедитесь, что интервал, время ожидания и UnhealtyThreshold в допустимых пределах hello.
* Если проверки с помощью HTTPS, убедитесь, что этого внутреннего сервера hello не требует SNI путем настройки сертификата fallback на самом сервере hello серверной части. 
* Убедитесь, что интервал времени ожидания и UnhealtyThreshold в допустимых пределах hello.

## <a name="request-time-out"></a>Время ожидания запроса

### <a name="cause"></a>Причина:

При получении запроса пользователя шлюз приложений применяет запрос toohello hello настроены правила и направляет его tooa пула серверной части экземпляра. Он ожидает можно настроить интервал времени отклика от экземпляра hello серверной части. По умолчанию этот интервал составляет **30 секунд**. Если шлюз приложений не получает отклик от серверного приложения в течение этого времени, для пользовательского запроса отображается ошибка 502.

### <a name="solution"></a>Решение

Шлюз приложений позволяет пользователям tooconfigure этого параметра с помощью BackendHttpSetting, которой может быть, а затем применить toodifferent пулы. Для разных серверных пулов параметр BackendHttpSetting и время ожидания запроса можно настроить по-разному.

```powershell
    New-AzureRmApplicationGatewayBackendHttpSettings -Name 'Setting01' -Port 80 -Protocol Http -CookieBasedAffinity Enabled -RequestTimeout 60
```

## <a name="next-steps"></a>Дальнейшие действия

Если hello описанные выше шаги не решат проблему hello, откройте [обращение в службу поддержки](https://azure.microsoft.com/support/options/).

