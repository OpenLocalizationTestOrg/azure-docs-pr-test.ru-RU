---
title: "Обзор мониторинга работоспособности для шлюза приложений Azure | Документация Майкрософт"
description: "Дополнительные сведения о возможностях мониторинга для шлюза приложений Azure"
services: application-gateway
documentationcenter: na
author: georgewallace
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 7eeba328-bb2d-4d3e-bdac-7552e7900b7f
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/14/2016
ms.author: gwallace
ms.openlocfilehash: 899115d213e626f17e58c2e5f01313f760f9e7f4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="application-gateway-health-monitoring-overview"></a><span data-ttu-id="d34b8-103">Обзор мониторинга работоспособности шлюза приложений</span><span class="sxs-lookup"><span data-stu-id="d34b8-103">Application Gateway health monitoring overview</span></span>

<span data-ttu-id="d34b8-104">Шлюз приложений Azure по умолчанию отслеживает работоспособность всех ресурсов в своем пуле внутренних серверов и автоматически удаляет из пула все ресурсы, признанные неработоспособными.</span><span class="sxs-lookup"><span data-stu-id="d34b8-104">Azure Application Gateway by default monitors the health of all resources in its back-end pool and automatically removes any resource considered unhealthy from the pool.</span></span> <span data-ttu-id="d34b8-105">Шлюз приложений продолжает отслеживать неисправные экземпляры и добавляет их в пул внутренних серверов, как только они становятся доступными и начинают отвечать на проверку работоспособности.</span><span class="sxs-lookup"><span data-stu-id="d34b8-105">Application Gateway continues to monitor the unhealthy instances and adds them back to the healthy back-end pool once they become available and respond to health probes.</span></span> <span data-ttu-id="d34b8-106">Шлюз приложений отправляет пробы работоспособности с помощью порта, который задан в параметрах HTTP серверной части.</span><span class="sxs-lookup"><span data-stu-id="d34b8-106">Application gateway sends the health probes with the same port that is defined in the back-end HTTP settings.</span></span> <span data-ttu-id="d34b8-107">Благодаря этой конфигурации проверка тестирует тот же порт, с помощью которого клиенты подключаются к внутренней части.</span><span class="sxs-lookup"><span data-stu-id="d34b8-107">This configuration ensures that the probe is testing the same port that customers would be using to connect to the backend.</span></span>

![пример проверки работоспособности шлюза приложений][1]

<span data-ttu-id="d34b8-109">Помимо проверки работоспособности по умолчанию проверку также можно настроить в соответствии с требованиями приложения.</span><span class="sxs-lookup"><span data-stu-id="d34b8-109">In addition to using default health probe monitoring, you can also customize the health probe to suit your application's requirements.</span></span> <span data-ttu-id="d34b8-110">В этой статье рассматривается как проверка работоспособности по умолчанию, так и пользовательская проверка работоспособности.</span><span class="sxs-lookup"><span data-stu-id="d34b8-110">In this article, both default and custom health probes are covered.</span></span>

> [!NOTE]
> <span data-ttu-id="d34b8-111">Если в подсети шлюза приложений есть группа безопасности сети, то в этой подсети необходимо открыть диапазон портов 65503–65534 для входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="d34b8-111">If there is an NSG on Application Gateway subnet, port ranges 65503-65534 should be opened on the Application Gateway subnet for Inbound traffic.</span></span> <span data-ttu-id="d34b8-112">Эти порты требуются для работы API работоспособности серверной части.</span><span class="sxs-lookup"><span data-stu-id="d34b8-112">These ports are required for the backend health API to work.</span></span>

## <a name="default-health-probe"></a><span data-ttu-id="d34b8-113">Проверка работоспособности по умолчанию</span><span class="sxs-lookup"><span data-stu-id="d34b8-113">Default health probe</span></span>

<span data-ttu-id="d34b8-114">Если ни одной из пользовательских проверок работоспособности не настроено, шлюз приложений автоматически настраивает проверку работоспособности по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="d34b8-114">An application gateway automatically configures a default health probe when you don't set up any custom probe configuration.</span></span> <span data-ttu-id="d34b8-115">Мониторинг осуществляется путем выполнения HTTP-запроса к IP-адресам пула внутренних серверов.</span><span class="sxs-lookup"><span data-stu-id="d34b8-115">The monitoring behavior works by making an HTTP request to the IP addresses configured for the back-end pool.</span></span> <span data-ttu-id="d34b8-116">Если выполняется стандартная проба и параметры HTTP серверной части настроены так, что используется протокол HTTPS, проба использует этот же протокол и для проверки работоспособности серверных систем.</span><span class="sxs-lookup"><span data-stu-id="d34b8-116">For default probes if the backend http settings are configured for HTTPS, the probe uses HTTPS as well to test health of the backends.</span></span>

<span data-ttu-id="d34b8-117">Пример. Вы настроили шлюз приложений, так что внутренние серверы A, B и C используются для получения сетевого трафика HTTP на порт 80.</span><span class="sxs-lookup"><span data-stu-id="d34b8-117">For example: You configure your application gateway to use back-end servers A, B, and C to receive HTTP network traffic on port 80.</span></span> <span data-ttu-id="d34b8-118">По умолчанию мониторинг работоспособности осуществляет проверку трех серверов каждые 30 секунд и ожидает получения HTTP-ответа, подтверждающего работоспособность.</span><span class="sxs-lookup"><span data-stu-id="d34b8-118">The default health monitoring tests the three servers every 30 seconds for a healthy HTTP response.</span></span> <span data-ttu-id="d34b8-119">HTTP-ответ, подтверждающий работоспособность, имеет [код состояния](https://msdn.microsoft.com/library/aa287675.aspx) от 200 до 399.</span><span class="sxs-lookup"><span data-stu-id="d34b8-119">A healthy HTTP response has a [status code](https://msdn.microsoft.com/library/aa287675.aspx) between 200 and 399.</span></span>

<span data-ttu-id="d34b8-120">Если проверка работоспособности по умолчанию для сервера А завершается неудачно, шлюз приложений удаляет его из внутреннего пула и сетевой трафик перестает поступать на этот сервер.</span><span class="sxs-lookup"><span data-stu-id="d34b8-120">If the default probe check fails for server A, the application gateway removes it from its back-end pool, and network traffic stops flowing to this server.</span></span> <span data-ttu-id="d34b8-121">Проверка работоспособности по умолчанию по-прежнему продолжает проверять сервер A каждые 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="d34b8-121">The default probe still continues to check for server A every 30 seconds.</span></span> <span data-ttu-id="d34b8-122">Когда сервер A успешно отвечает на запрос проверки работоспособности по умолчанию, он возвращается в пул внутренних серверов, и передача трафика на этот сервер возобновляется.</span><span class="sxs-lookup"><span data-stu-id="d34b8-122">When server A responds successfully to one request from a default health probe, it is added back as healthy to the back-end pool, and traffic starts flowing to the server again.</span></span>

### <a name="default-health-probe-settings"></a><span data-ttu-id="d34b8-123">Параметры проверки работоспособности по умолчанию</span><span class="sxs-lookup"><span data-stu-id="d34b8-123">Default health probe settings</span></span>

| <span data-ttu-id="d34b8-124">Свойства проверки</span><span class="sxs-lookup"><span data-stu-id="d34b8-124">Probe property</span></span> | <span data-ttu-id="d34b8-125">Значение</span><span class="sxs-lookup"><span data-stu-id="d34b8-125">Value</span></span> | <span data-ttu-id="d34b8-126">Описание</span><span class="sxs-lookup"><span data-stu-id="d34b8-126">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d34b8-127">URL-адрес проверки</span><span class="sxs-lookup"><span data-stu-id="d34b8-127">Probe URL</span></span> |<span data-ttu-id="d34b8-128">http://127.0.0.1:\<порт\>/</span><span class="sxs-lookup"><span data-stu-id="d34b8-128">http://127.0.0.1:\<port\>/</span></span> |<span data-ttu-id="d34b8-129">URL-адрес</span><span class="sxs-lookup"><span data-stu-id="d34b8-129">URL path</span></span> |
| <span data-ttu-id="d34b8-130">Интервал</span><span class="sxs-lookup"><span data-stu-id="d34b8-130">Interval</span></span> |<span data-ttu-id="d34b8-131">30</span><span class="sxs-lookup"><span data-stu-id="d34b8-131">30</span></span> |<span data-ttu-id="d34b8-132">Интервал проверки в секундах</span><span class="sxs-lookup"><span data-stu-id="d34b8-132">Probe interval in seconds</span></span> |
| <span data-ttu-id="d34b8-133">Время ожидания</span><span class="sxs-lookup"><span data-stu-id="d34b8-133">Time-out</span></span> |<span data-ttu-id="d34b8-134">30</span><span class="sxs-lookup"><span data-stu-id="d34b8-134">30</span></span> |<span data-ttu-id="d34b8-135">Время ожидания проверки в секундах</span><span class="sxs-lookup"><span data-stu-id="d34b8-135">Probe time-out in seconds</span></span> |
| <span data-ttu-id="d34b8-136">Пороговое значение сбоя</span><span class="sxs-lookup"><span data-stu-id="d34b8-136">Unhealthy threshold</span></span> |<span data-ttu-id="d34b8-137">3</span><span class="sxs-lookup"><span data-stu-id="d34b8-137">3</span></span> |<span data-ttu-id="d34b8-138">Количество повторных попыток проверки.</span><span class="sxs-lookup"><span data-stu-id="d34b8-138">Probe retry count.</span></span> <span data-ttu-id="d34b8-139">Сервер внутреннего пула считается неисправным, когда количество повторных неудачных попыток проверки достигает порогового значения сбоя.</span><span class="sxs-lookup"><span data-stu-id="d34b8-139">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span></span> |

> [!NOTE]
> <span data-ttu-id="d34b8-140">Порт совпадает с портом, указанным в параметрах HTTP серверной части.</span><span class="sxs-lookup"><span data-stu-id="d34b8-140">The port is the same port as the back-end HTTP settings.</span></span>

<span data-ttu-id="d34b8-141">Для определения состояния работоспособности проба по умолчанию использует только http://127.0.0.1:\<порт\>.</span><span class="sxs-lookup"><span data-stu-id="d34b8-141">The default probe looks only at http://127.0.0.1:\<port\> to determine health status.</span></span> <span data-ttu-id="d34b8-142">Если необходимо настроить проверку работоспособности для перехода на настраиваемый URL-адрес или изменить любые другие параметры, используйте пользовательскую проверку работоспособности, как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="d34b8-142">If you need to configure the health probe to go to a custom URL or modify any other settings, you must use custom probes as described in the following steps:</span></span>

## <a name="custom-health-probe"></a><span data-ttu-id="d34b8-143">Пользовательская проверка работоспособности</span><span class="sxs-lookup"><span data-stu-id="d34b8-143">Custom health probe</span></span>

<span data-ttu-id="d34b8-144">Пользовательская проверка работоспособности позволяет добиться более детального контроля над мониторингом работоспособности.</span><span class="sxs-lookup"><span data-stu-id="d34b8-144">Custom probes allow you to have a more granular control over the health monitoring.</span></span> <span data-ttu-id="d34b8-145">При использовании пользовательской проверки можно настроить интервал проверки, URL-адрес и путь проверки, а также количество неудачных попыток проверки, после которых экземпляр пула внутренних серверов должен считаться неработоспособным.</span><span class="sxs-lookup"><span data-stu-id="d34b8-145">When using custom probes, you can configure the probe interval, the URL and path to test, and how many failed responses to accept before marking the back-end pool instance as unhealthy.</span></span>

### <a name="custom-health-probe-settings"></a><span data-ttu-id="d34b8-146">Параметры пользовательской проверки работоспособности</span><span class="sxs-lookup"><span data-stu-id="d34b8-146">Custom health probe settings</span></span>

<span data-ttu-id="d34b8-147">В следующей таблице приведены описания свойств из пользовательской пробы работоспособности.</span><span class="sxs-lookup"><span data-stu-id="d34b8-147">The following table provides definitions for the properties of a custom health probe.</span></span>

| <span data-ttu-id="d34b8-148">Свойства проверки</span><span class="sxs-lookup"><span data-stu-id="d34b8-148">Probe property</span></span> | <span data-ttu-id="d34b8-149">Описание</span><span class="sxs-lookup"><span data-stu-id="d34b8-149">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d34b8-150">Name (Имя)</span><span class="sxs-lookup"><span data-stu-id="d34b8-150">Name</span></span> |<span data-ttu-id="d34b8-151">Имя проверки.</span><span class="sxs-lookup"><span data-stu-id="d34b8-151">Name of the probe.</span></span> <span data-ttu-id="d34b8-152">Это имя используется для указания проверки в параметрах HTTP внутреннего сервера</span><span class="sxs-lookup"><span data-stu-id="d34b8-152">This name is used to refer to the probe in back-end HTTP settings.</span></span> |
| <span data-ttu-id="d34b8-153">Протокол</span><span class="sxs-lookup"><span data-stu-id="d34b8-153">Protocol</span></span> |<span data-ttu-id="d34b8-154">Протокол, используемый для проверки.</span><span class="sxs-lookup"><span data-stu-id="d34b8-154">Protocol used to send the probe.</span></span> <span data-ttu-id="d34b8-155">Проба использует протокол, определенный в параметрах HTTP серверной части.</span><span class="sxs-lookup"><span data-stu-id="d34b8-155">The probe uses the protocol defined in the back-end HTTP settings</span></span> |
| <span data-ttu-id="d34b8-156">Узел</span><span class="sxs-lookup"><span data-stu-id="d34b8-156">Host</span></span> |<span data-ttu-id="d34b8-157">Имя узла для проверки.</span><span class="sxs-lookup"><span data-stu-id="d34b8-157">Host name to send the probe.</span></span> <span data-ttu-id="d34b8-158">Применяется только в случае, когда в шлюзе приложений настроено многосайтовое подключение. В противном случае используется значение 127.0.0.1.</span><span class="sxs-lookup"><span data-stu-id="d34b8-158">Applicable only when multi-site is configured on Application Gateway, otherwise use '127.0.0.1'.</span></span> <span data-ttu-id="d34b8-159">Это значение отличается от имени узла виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="d34b8-159">This value is different from VM host name.</span></span> |
| <span data-ttu-id="d34b8-160">Путь</span><span class="sxs-lookup"><span data-stu-id="d34b8-160">Path</span></span> |<span data-ttu-id="d34b8-161">Относительный путь проверки.</span><span class="sxs-lookup"><span data-stu-id="d34b8-161">Relative path of the probe.</span></span> <span data-ttu-id="d34b8-162">Путь должен начинаться с "/".</span><span class="sxs-lookup"><span data-stu-id="d34b8-162">The valid path starts from '/'.</span></span> |
| <span data-ttu-id="d34b8-163">Интервал</span><span class="sxs-lookup"><span data-stu-id="d34b8-163">Interval</span></span> |<span data-ttu-id="d34b8-164">Интервал проверки в секундах.</span><span class="sxs-lookup"><span data-stu-id="d34b8-164">Probe interval in seconds.</span></span> <span data-ttu-id="d34b8-165">Это значение означает интервал времени между двумя последовательными проверками.</span><span class="sxs-lookup"><span data-stu-id="d34b8-165">This value is the time interval between two consecutive probes.</span></span> |
| <span data-ttu-id="d34b8-166">Время ожидания</span><span class="sxs-lookup"><span data-stu-id="d34b8-166">Time-out</span></span> |<span data-ttu-id="d34b8-167">Время ожидания проверки в секундах.</span><span class="sxs-lookup"><span data-stu-id="d34b8-167">Probe time-out in seconds.</span></span> <span data-ttu-id="d34b8-168">Если ответ о работоспособности не получен в течение этого времени ожидания, то проба считается неудачной.</span><span class="sxs-lookup"><span data-stu-id="d34b8-168">If a valid response is not received within this time-out period, the probe is marked as failed.</span></span>  |
| <span data-ttu-id="d34b8-169">Пороговое значение сбоя</span><span class="sxs-lookup"><span data-stu-id="d34b8-169">Unhealthy threshold</span></span> |<span data-ttu-id="d34b8-170">Количество повторных попыток проверки.</span><span class="sxs-lookup"><span data-stu-id="d34b8-170">Probe retry count.</span></span> <span data-ttu-id="d34b8-171">Сервер внутреннего пула считается неисправным, когда количество повторных неудачных попыток проверки достигает порогового значения сбоя.</span><span class="sxs-lookup"><span data-stu-id="d34b8-171">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span></span> |

> [!IMPORTANT]
> <span data-ttu-id="d34b8-172">если шлюз приложений настроен для одного сайта, нужно указать стандартное имя узла 127.0.0.1, если только другое имя не задано в пользовательской пробе;</span><span class="sxs-lookup"><span data-stu-id="d34b8-172">If Application Gateway is configured for a single site, by default the Host name should be specified as '127.0.0.1', unless otherwise configured in custom probe.</span></span>
> <span data-ttu-id="d34b8-173">Для справки пользовательская проба отправляется по адресу \<протокол\>://\<узел\>:\<порт\>\<путь\>.</span><span class="sxs-lookup"><span data-stu-id="d34b8-173">For reference a custom probe is sent to \<protocol\>://\<host\>:\<port\>\<path\>.</span></span> <span data-ttu-id="d34b8-174">Используемый порт совпадает с портом, указанным в параметрах HTTP серверной части.</span><span class="sxs-lookup"><span data-stu-id="d34b8-174">The port used will be the same port as defined in the back-end HTTP settings.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d34b8-175">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="d34b8-175">Next steps</span></span>
<span data-ttu-id="d34b8-176">Ознакомившись со сведениями о мониторинге работоспособности шлюза приложений, можно настроить [пользовательскую проверку работоспособности](application-gateway-create-probe-portal.md) на портале Azure либо [пользовательскую проверку работоспособности](application-gateway-create-probe-ps.md) с использованием модели развертывания PowerShell или Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="d34b8-176">After learning about Application Gateway health monitoring, you can configure a [custom health probe](application-gateway-create-probe-portal.md) in the Azure portal or a [custom health probe](application-gateway-create-probe-ps.md) using PowerShell and the Azure Resource Manager deployment model.</span></span>

[1]: ./media/application-gateway-probe-overview/appgatewayprobe.png
