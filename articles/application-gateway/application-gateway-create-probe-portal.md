---
title: "Создание пользовательской пробы для шлюза приложений Azure с помощью портала Azure | Документация Майкрософт"
description: "Узнайте, как создать пользовательскую пробу для шлюза приложений с помощью портала."
services: application-gateway
documentationcenter: na
author: georgewallace
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 33fd5564-43a7-4c54-a9ec-b1235f661f97
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/26/2017
ms.author: gwallace
ms.openlocfilehash: 65e9bba4ce9ac41ae2a9a8c3fa7f661165fc1403
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="create-a-custom-probe-for-application-gateway-by-using-the-portal"></a><span data-ttu-id="f284b-103">Создание пользовательской пробы для шлюза приложений с помощью портала</span><span class="sxs-lookup"><span data-stu-id="f284b-103">Create a custom probe for Application Gateway by using the portal</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="f284b-104">Портал Azure</span><span class="sxs-lookup"><span data-stu-id="f284b-104">Azure portal</span></span>](application-gateway-create-probe-portal.md)
> * [<span data-ttu-id="f284b-105">PowerShell и диспетчер ресурсов Azure</span><span class="sxs-lookup"><span data-stu-id="f284b-105">Azure Resource Manager PowerShell</span></span>](application-gateway-create-probe-ps.md)
> * [<span data-ttu-id="f284b-106">Классическая модель — Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="f284b-106">Azure Classic PowerShell</span></span>](application-gateway-create-probe-classic-ps.md)

<span data-ttu-id="f284b-107">Следуя инструкциям этой статьи вы добавите пользовательскую пробу в имеющийся шлюз приложений с помощью портала Azure.</span><span class="sxs-lookup"><span data-stu-id="f284b-107">In this article, you add a custom probe to an existing application gateway through the Azure portal.</span></span> <span data-ttu-id="f284b-108">Пользовательские пробы полезны в приложениях с конкретной страницей проверки работоспособности или приложениях, не предоставляющих успешный ответ веб-приложению по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f284b-108">Custom probes are useful for applications that have a specific health check page or for applications that do not provide a successful response on the default web application.</span></span>

## <a name="before-you-begin"></a><span data-ttu-id="f284b-109">Перед началом работы</span><span class="sxs-lookup"><span data-stu-id="f284b-109">Before you begin</span></span>

<span data-ttu-id="f284b-110">Если у вас нет шлюза приложений, ознакомьтесь с [этой статьей](application-gateway-create-gateway-portal.md), чтобы создать его.</span><span class="sxs-lookup"><span data-stu-id="f284b-110">If you do not already have an application gateway, visit [Create an Application Gateway](application-gateway-create-gateway-portal.md) to create an application gateway to work with.</span></span>

## <span data-ttu-id="f284b-111"><a name="createprobe"></a>Создание пробы</span><span class="sxs-lookup"><span data-stu-id="f284b-111"><a name="createprobe"></a>Create the probe</span></span>

<span data-ttu-id="f284b-112">На портале пробы настраиваются в два этапа.</span><span class="sxs-lookup"><span data-stu-id="f284b-112">Probes are configured in a two-step process through the portal.</span></span> <span data-ttu-id="f284b-113">Сначала нужно создать пробу.</span><span class="sxs-lookup"><span data-stu-id="f284b-113">The first step is to create the probe.</span></span> <span data-ttu-id="f284b-114">Затем следует добавить ее в параметры протокола HTTP серверной части приложения шлюза.</span><span class="sxs-lookup"><span data-stu-id="f284b-114">In the second step, you add the probe to the backend http settings of the application gateway.</span></span>

1. <span data-ttu-id="f284b-115">Войдите на [портал Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="f284b-115">Log in to the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="f284b-116">Если у вас нет учетной записи, вы можете зарегистрироваться для получения [бесплатной пробной версии на один месяц](https://azure.microsoft.com/free).</span><span class="sxs-lookup"><span data-stu-id="f284b-116">If you don't already have an account, you can sign up for a [free one-month trial](https://azure.microsoft.com/free)</span></span>

1. <span data-ttu-id="f284b-117">На портале Azure в области "Избранное" щелкните "Все ресурсы".</span><span class="sxs-lookup"><span data-stu-id="f284b-117">In the Azure portal Favorites pane, click All resources.</span></span> <span data-ttu-id="f284b-118">Выберите шлюз приложений в колонке "Все ресурсы".</span><span class="sxs-lookup"><span data-stu-id="f284b-118">Click the application gateway in the All resources blade.</span></span> <span data-ttu-id="f284b-119">Если выбранная подписка имеет несколько ресурсов, в поле "Фильтровать по имени..." введите partners.contoso.net,</span><span class="sxs-lookup"><span data-stu-id="f284b-119">If the subscription you selected already has several resources in it, you can enter partners.contoso.net in the Filter by name…</span></span> <span data-ttu-id="f284b-120">чтобы быстро получить доступ к необходимому шлюзу приложений.</span><span class="sxs-lookup"><span data-stu-id="f284b-120">box to easily access the application gateway.</span></span>

1. <span data-ttu-id="f284b-121">Щелкните **Пробы** и нажмите кнопку **Добавить**, чтобы добавить новую пробу.</span><span class="sxs-lookup"><span data-stu-id="f284b-121">Click **Probes** and click the **Add** button to add a probe.</span></span>

  ![Колонка добавления пробы с заполненной информацией][1]

1. <span data-ttu-id="f284b-123">В колонке **Добавление зонда работоспособности** введите необходимые сведения о пробе, затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="f284b-123">On the **Add health probe** blade, fill out the required information for the probe, and when complete click **OK**.</span></span>

  |<span data-ttu-id="f284b-124">**Параметр**</span><span class="sxs-lookup"><span data-stu-id="f284b-124">**Setting**</span></span> | <span data-ttu-id="f284b-125">**Значение**</span><span class="sxs-lookup"><span data-stu-id="f284b-125">**Value**</span></span> | <span data-ttu-id="f284b-126">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="f284b-126">**Details**</span></span>|
  |---|---|---|
  |<span data-ttu-id="f284b-127">**Имя**</span><span class="sxs-lookup"><span data-stu-id="f284b-127">**Name**</span></span>|<span data-ttu-id="f284b-128">customProbe</span><span class="sxs-lookup"><span data-stu-id="f284b-128">customProbe</span></span>|<span data-ttu-id="f284b-129">Понятное имя пробы, которое отображается на портале.</span><span class="sxs-lookup"><span data-stu-id="f284b-129">This value is a friendly name to the probe that is accessible in the portal.</span></span>|
  |<span data-ttu-id="f284b-130">**Протокол**</span><span class="sxs-lookup"><span data-stu-id="f284b-130">**Protocol**</span></span>|<span data-ttu-id="f284b-131">HTTP или HTTPS</span><span class="sxs-lookup"><span data-stu-id="f284b-131">HTTP or HTTPS</span></span> | <span data-ttu-id="f284b-132">Протокол, используемый пробой работоспособности.</span><span class="sxs-lookup"><span data-stu-id="f284b-132">The protocol that the health probe uses.</span></span>|
  |<span data-ttu-id="f284b-133">**Host**</span><span class="sxs-lookup"><span data-stu-id="f284b-133">**Host**</span></span>|<span data-ttu-id="f284b-134">Например,</span><span class="sxs-lookup"><span data-stu-id="f284b-134">i.e</span></span> <span data-ttu-id="f284b-135">contoso.com</span><span class="sxs-lookup"><span data-stu-id="f284b-135">contoso.com</span></span>|<span data-ttu-id="f284b-136">Имя узла, используемое для пробы.</span><span class="sxs-lookup"><span data-stu-id="f284b-136">This value is the host name that is used for the probe.</span></span> <span data-ttu-id="f284b-137">Применяется только в случае, когда в шлюзе приложений настроено многосайтовое подключение. В противном случае используется значение 127.0.0.1.</span><span class="sxs-lookup"><span data-stu-id="f284b-137">Applicable only when multi-site is configured on Application Gateway, otherwise use '127.0.0.1'.</span></span> <span data-ttu-id="f284b-138">Это значение отличается от имени узла виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="f284b-138">This value is different from the VM host name.</span></span>|
  |<span data-ttu-id="f284b-139">**Путь**</span><span class="sxs-lookup"><span data-stu-id="f284b-139">**Path**</span></span>|<span data-ttu-id="f284b-140">/ или другой путь</span><span class="sxs-lookup"><span data-stu-id="f284b-140">/ or another path</span></span>|<span data-ttu-id="f284b-141">Остальная часть полного URL-адреса пользовательской пробы.</span><span class="sxs-lookup"><span data-stu-id="f284b-141">The remainder of the full url for the custom probe.</span></span> <span data-ttu-id="f284b-142">Путь должен начинаться с /.</span><span class="sxs-lookup"><span data-stu-id="f284b-142">A valid path starts with '/'.</span></span> <span data-ttu-id="f284b-143">Для пути по умолчанию http://contoso.com используется /.</span><span class="sxs-lookup"><span data-stu-id="f284b-143">For the default path of http://contoso.com just use '/'</span></span> |
  |<span data-ttu-id="f284b-144">**Интервал (с)**</span><span class="sxs-lookup"><span data-stu-id="f284b-144">**Interval (secs)**</span></span>|<span data-ttu-id="f284b-145">30</span><span class="sxs-lookup"><span data-stu-id="f284b-145">30</span></span>|<span data-ttu-id="f284b-146">Интервал между выполнением проб работоспособности.</span><span class="sxs-lookup"><span data-stu-id="f284b-146">How often the probe is run to check for health.</span></span> <span data-ttu-id="f284b-147">Не рекомендуется задавать значение менее 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="f284b-147">It is not recommended to set the lower than 30 seconds.</span></span>|
  |<span data-ttu-id="f284b-148">**Время ожидания (с)**</span><span class="sxs-lookup"><span data-stu-id="f284b-148">**Timeout (secs)**</span></span>|<span data-ttu-id="f284b-149">30</span><span class="sxs-lookup"><span data-stu-id="f284b-149">30</span></span>|<span data-ttu-id="f284b-150">Время ожидания пробы.</span><span class="sxs-lookup"><span data-stu-id="f284b-150">The amount of time the probe waits before timing out.</span></span> <span data-ttu-id="f284b-151">Интервал времени ожидания должен быть достаточно большим для выполнения HTTP-вызова, чтобы обеспечить доступность страницы с данными о работоспособности внутреннего сервера.</span><span class="sxs-lookup"><span data-stu-id="f284b-151">The timeout interval needs to be high enough that an http call can be made to ensure the backend health page is available.</span></span>|
  |<span data-ttu-id="f284b-152">**Пороговое значение сбоя**</span><span class="sxs-lookup"><span data-stu-id="f284b-152">**Unhealthy threshold**</span></span>|<span data-ttu-id="f284b-153">3</span><span class="sxs-lookup"><span data-stu-id="f284b-153">3</span></span>|<span data-ttu-id="f284b-154">Число неудачных попыток, после которых состояние считается неработоспособным.</span><span class="sxs-lookup"><span data-stu-id="f284b-154">Number of failed attempts to be considered unhealthy.</span></span> <span data-ttu-id="f284b-155">Пороговое значение 0 означает, что при сбое проверки работоспособности серверная часть немедленно будет определена как неработоспособная.</span><span class="sxs-lookup"><span data-stu-id="f284b-155">A threshold of 0 means that if a health check fails the back-end is determined unhealthy immediately.</span></span>|

  > [!IMPORTANT]
  > <span data-ttu-id="f284b-156">Имя узла не является именем сервера.</span><span class="sxs-lookup"><span data-stu-id="f284b-156">The host name is not the same as server name.</span></span> <span data-ttu-id="f284b-157">Это имя виртуального узла, который выполняется на сервере приложений.</span><span class="sxs-lookup"><span data-stu-id="f284b-157">This value is the name of the virtual host running on the application server.</span></span> <span data-ttu-id="f284b-158">Проба отправляется по адресу http://(имя_узла):(порт_из_параметров_HTTP)/urlPath.</span><span class="sxs-lookup"><span data-stu-id="f284b-158">The probe is sent to http://(host name):(port from httpsetting)/urlPath</span></span>

## <a name="add-probe-to-the-gateway"></a><span data-ttu-id="f284b-159">Добавление пробы в шлюз</span><span class="sxs-lookup"><span data-stu-id="f284b-159">Add probe to the gateway</span></span>

<span data-ttu-id="f284b-160">После создания пробы пора добавить ее в шлюз.</span><span class="sxs-lookup"><span data-stu-id="f284b-160">Now that the probe has been created, it is time to add it to the gateway.</span></span> <span data-ttu-id="f284b-161">Настройки пробы задаются в параметрах протокола HTTP серверной части приложения шлюза.</span><span class="sxs-lookup"><span data-stu-id="f284b-161">Probe settings are set on the backend http settings of the application gateway.</span></span>

1. <span data-ttu-id="f284b-162">Щелкните **Настройки HTTP** для шлюза приложения и откройте колонку конфигурации, выбрав текущие параметры HTTP серверной части в окне.</span><span class="sxs-lookup"><span data-stu-id="f284b-162">Click **HTTP settings** on the application gateway, to bring up the configuration blade click the current backend http settings listed in the window.</span></span>

  ![Окно параметров HTTPS][2]

1. <span data-ttu-id="f284b-164">В колонке параметров **appGatewayBackEndHttpSettings** установите флажок **Использовать пользовательский зонд** и выберите пробу, созданную в разделе [Создание пробы](#createprobe), в раскрывающемся списке **Пользовательский зонд**.</span><span class="sxs-lookup"><span data-stu-id="f284b-164">On the **appGatewayBackEndHttpSettings** settings blade, check the **Use custom probe** checkbox and choose the probe created in the [Create the probe](#createprobe) section on the **Custom probe** drop-down..</span></span>
<span data-ttu-id="f284b-165">По завершении нажмите кнопку **Сохранить**, и параметры будут применены.</span><span class="sxs-lookup"><span data-stu-id="f284b-165">When complete, click **Save** and the settings are applied.</span></span>

<span data-ttu-id="f284b-166">Проба по умолчанию проверяет доступ по умолчанию к веб-приложению.</span><span class="sxs-lookup"><span data-stu-id="f284b-166">The default probe checks the default access to the web application.</span></span> <span data-ttu-id="f284b-167">После создания пользовательской пробы шлюз приложений использует определенный пользовательский путь для мониторинга работоспособности внутренних серверов.</span><span class="sxs-lookup"><span data-stu-id="f284b-167">Now that a custom probe has been created, the application gateway uses the custom path defined to monitor health for the backend servers.</span></span> <span data-ttu-id="f284b-168">На основе определенных критериев шлюз приложений проверяет путь, указанный в пробе.</span><span class="sxs-lookup"><span data-stu-id="f284b-168">Based on the criteria that was defined, the application gateway checks the path specified in the probe.</span></span> <span data-ttu-id="f284b-169">Если вызов по адресу "узел:порт/путь" не возвращает ответ состояния "HTTP 200–399", то по достижении порогового значения неработоспособности сервер выводится из ротации.</span><span class="sxs-lookup"><span data-stu-id="f284b-169">If the call to host:Port/path does not return an HTTP 200-399 status response, the server is taken out of rotation after the unhealthy threshold is reached.</span></span> <span data-ttu-id="f284b-170">Выполнение проб неработоспособного экземпляра продолжается, чтобы определить, когда она снова станет работоспособен.</span><span class="sxs-lookup"><span data-stu-id="f284b-170">Probing continues on the unhealthy instance to determine when it becomes healthy again.</span></span> <span data-ttu-id="f284b-171">После добавления экземпляра обратно в пул работоспособных серверов трафик снова начинает поступать к нему, и выполнение проб этого экземпляра продолжается в обычном режиме с указанным пользователем интервалом.</span><span class="sxs-lookup"><span data-stu-id="f284b-171">Once the instance is added back to healthy server pool, traffic begins flowing to it again and probing to the instance continues at user specified interval as normal.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f284b-172">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="f284b-172">Next steps</span></span>

<span data-ttu-id="f284b-173">Сведения по настройке разгрузки SSL с использованием шлюза приложений Azure см. в статье [Настройка шлюза приложений для разгрузки SSL с помощью портала](application-gateway-ssl-portal.md)</span><span class="sxs-lookup"><span data-stu-id="f284b-173">To learn how to configure SSL Offloading with Azure Application Gateway, see [Configure SSL Offload](application-gateway-ssl-portal.md)</span></span>

[1]: ./media/application-gateway-create-probe-portal/figure1.png
[2]: ./media/application-gateway-create-probe-portal/figure2.png

