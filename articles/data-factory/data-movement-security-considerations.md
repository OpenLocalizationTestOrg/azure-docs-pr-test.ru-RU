---
title: "Вопросы безопасности в фабрике данных Azure | Документация Майкрософт"
description: "Описывается базовая инфраструктура безопасности, используемая службами перемещения данных в фабрике данных Azure для защиты информации."
services: data-factory
documentationcenter: 
author: nabhishek
manager: jhubbard
editor: spelluru
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/15/2018
ms.author: abnarain
ms.openlocfilehash: 8bd5ae2aac23b18aeb3ef44692f448b50b7e3d44
ms.sourcegitcommit: 9cc3d9b9c36e4c973dd9c9028361af1ec5d29910
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2018
---
# <a name="azure-data-factory---security-considerations-for-data-movement"></a>Вопросы безопасности при перемещении данных в фабрике данных Azure
> [!div class="op_single_selector" title1="Select the version of Data Factory service you are using:"]
> * [Версия 1 — общедоступная](v1/data-factory-data-movement-security-considerations.md)
> * [Версия 2 — предварительная](data-movement-security-considerations.md)

В этой статье описывается базовая инфраструктура безопасности, используемая службами перемещения данных в фабрике данных Azure для защиты данных. Ресурсы управления фабрики данных Azure созданы на основе инфраструктуры безопасности Azure и используют все возможные меры безопасности, предлагаемые Azure.

> [!NOTE]
> Эта статья относится к версии 2 фабрики данных, которая в настоящее время доступна в предварительной версии. Если вы используете общедоступную версию 1 службы фабрики данных, см. статью [рекомендации по безопасному перемещению данных в фабрике данных версии 1](v1/data-factory-data-movement-security-considerations.md).

С помощью фабрики данных можно создать один или несколько [конвейеров](concepts-pipelines-activities.md)данных. Конвейеры — это логические группы действий, которые вместе отвечают за выполнение задачи. Эти конвейеры реализуются в регионе, где была создана фабрика данных. 

Хотя фабрика данных доступна только в **восточной части США**, **восточной части США 2** и **Западной Европе** (предварительная версия 2), служба перемещения данных доступна [глобально в нескольких регионах](concepts-integration-runtime.md#azure-ir). Служба фабрики данных обеспечивает постоянный географический регион для данных, если вы явно не укажите ей использовать альтернативный регион в случае, если служба перемещения данных еще не развернута в этом регионе. 

Сама фабрика данных Azure не хранит никакие данные, за исключением учетных данных связанной службы для облачных хранилищ данных, зашифрованных с помощью сертификатов. Она предоставляет возможность создавать управляемые данными рабочие процессы для обработки данных с помощью [служб вычислений](compute-linked-services.md) в других регионах или локальной среде и оркестрации перемещения данных между [поддерживаемыми хранилищами](copy-activity-overview.md#supported-data-stores-and-formats). Кроме того, с помощью фабрики данных можно отслеживать рабочие процессы и управлять ими, используя пакеты SDK и Azure Monitor.

Перемещение данных с помощью фабрики данных Azure было **сертифицировано** для:
-   [HIPAA/HITECH](https://www.microsoft.com/en-us/trustcenter/Compliance/HIPAA); 
-   [ISO/IEC 27001](https://www.microsoft.com/en-us/trustcenter/Compliance/ISO-IEC-27001);  
-   [ISO/IEC 27018](https://www.microsoft.com/en-us/trustcenter/Compliance/ISO-IEC-27018);
-   [CSA STAR](https://www.microsoft.com/en-us/trustcenter/Compliance/CSA-STAR-Certification).

Если вас интересует, как Azure обеспечивает соответствие требованиям и защищает собственную инфраструктуру, посетите [центр управления безопасностью Майкрософт](https://www.microsoft.com/TrustCenter/default.aspx). 

В этой статье мы рассмотрим вопросы безопасности в следующих двух сценариях перемещения данных: 

- **Облачный сценарий**, в котором источник и приемник являются общедоступными через Интернет. Эти источники данных включают управляемые службы облачного хранения, например служба хранилища Azure, хранилище данных SQL Azure, база данных SQL Azure, Azure Data Lake Store, Amazon S3, Amazon Redshift, службы SaaS (Salesforce) и такие веб-протоколы, как FTP и OData. Полный список поддерживаемых источников данных можно найти [здесь](copy-activity-overview.md#supported-data-stores-and-formats).
- **Гибридный сценарий**, в котором источник или приемник находятся за брандмауэром или внутри локальной корпоративной сети. Либо хранилище данных находится в частной или виртуальной сети (чаще всего это актуально для источника), а также не является общедоступным. Этот сценарий также охватывает серверы базы данных, расположенные на виртуальных машинах.

## <a name="cloud-scenarios"></a>Облачные сценарии
###<a name="securing-data-store-credentials"></a>Защита учетных данных хранилища данных
- Храните зашифрованные учетные данные в управляемом хранилище фабрики данных Azure.

   Фабрика данных Azure защищает учетные данные хранилища данных, выполняя их **шифрование** с помощью **сертификатов, управляемых Майкрософт**. Эти сертификаты меняются каждые **два года**. Изменения включают продление сертификата и перемещение учетных данных. Зашифрованные учетные данные безопасно хранятся в **службе хранилища Azure, которая контролируется службами управления фабрики данных Azure**. Дополнительные сведения о безопасности службы хранилища Azure см. [здесь](../security/security-storage-overview.md).
- Хранение учетных данных в Azure Key Vault 

   Теперь можно хранить учетные данные хранилища данных в [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) и предоставлять их фабрике данных Azure во время выполнения действия. Дополнительные сведения см. в статье [Хранение учетных данных в Azure Key Vault](store-credentials-in-key-vault.md).

   > [!NOTE]
   > В настоящее время только [соединитель Dynamics](connector-dynamics-crm-office-365.md) поддерживает эту функцию. 

### <a name="data-encryption-in-transit"></a>Шифрование данных при передаче
Если облачное хранилище данных поддерживает протоколы HTTPS или TLS, то передача всех данных между службами перемещения данных в фабрике данных и облачным хранилищем данных выполняется через эти защищенные каналы.

> [!NOTE]
> Во время передачи данных в базу данных и из нее все подключения к **базе данных SQL Azure** и **хранилищу данных SQL Azure** должны быть зашифрованы (с помощью SSL или TLS). Во время разработки конвейера с помощью JSON добавьте свойство **encryption** и задайте для него в **строке подключения** значение **true**. Для службы **хранилища Azure** вы можете использовать в строке подключения протокол **HTTPS**.

### <a name="data-encryption-at-rest"></a>Шифрование неактивных данных
Некоторые хранилища данных поддерживают шифрование неактивных данных. Мы советуем включить механизм шифрования данных для этих хранилищ данных. 

#### <a name="azure-sql-data-warehouse"></a>Хранилище данных SQL Azure
Прозрачное шифрование данных хранилища данных SQL Azure помогает защититься от вредоносных атак благодаря шифрованию и расшифровке неактивных данных в реальном времени. Этот процесс является прозрачным для клиента. Дополнительные сведения см. в статье [Защита базы данных в хранилище данных SQL](../sql-data-warehouse/sql-data-warehouse-overview-manage-security.md).

#### <a name="azure-sql-database"></a>Базы данных SQL Azure
База данных SQL Azure также поддерживает прозрачное шифрование данных, которое помогает защититься от угрозы вредоносных атак за счет шифрования и расшифровки данных в реальном времени, не внося изменения в само приложение. Этот процесс является прозрачным для клиента. Дополнительные сведения см. в статье [Transparent Data Encryption with Azure SQL Database](/sql/relational-databases/security/encryption/transparent-data-encryption-with-azure-sql-database) (Прозрачное шифрование данных в базе данных SQL Azure). 

#### <a name="azure-data-lake-store"></a>Хранилище озера данных Azure
В Azure Data Lake Store можно также включить шифрование данных, хранящихся в учетной записи. При включении Data Lake Store автоматически шифрует данные перед сохранением и расшифровывает их до извлечения. Таким образом данные полностью прозрачны для клиента, который получает к ним доступ. Дополнительные сведения см. в статье [Обеспечение безопасности в хранилище озера данных Azure](../data-lake-store/data-lake-store-security-overview.md). 

#### <a name="azure-blob-storage-and-azure-table-storage"></a>Хранилище BLOB-объектов Azure и хранилище таблиц Azure
Хранилище BLOB-объектов Azure и хранилище таблиц Azure поддерживают функцию шифрования службы хранилища, которая автоматически шифрует данные перед их сохранением в хранилище и расшифровывает их до извлечения. Дополнительные сведения см. в статье [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](../storage/common/storage-service-encryption.md).

#### <a name="amazon-s3"></a>Amazon S3
Amazon S3 поддерживает шифрование неактивных данных для сервера и клиента. Дополнительные сведения см. в документации [Protecting Data Using Encryption](http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingEncryption.html) (Защита данных с помощью шифрования). Сейчас фабрика данных не поддерживает Amazon S3 в виртуальном частном облаке.

#### <a name="amazon-redshift"></a>Amazon Redshift
Amazon Redshift поддерживает шифрование неактивных данных кластера. Дополнительные сведения см. в документации [Amazon Redshift Database Encryption](http://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html) (Шифрование базы данных Amazon Redshift). Сейчас фабрика данных не поддерживает Amazon Redshift в виртуальном частном облаке. 

#### <a name="salesforce"></a>Salesforce
SalesForce поддерживает шифрование Shield Platform Encryption, которое позволяет зашифровать все файлы, вложения и настраиваемые поля. Дополнительные сведения см. в статье [Understanding the Web Server OAuth Authentication Flow](https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/intro_understanding_web_server_oauth_flow.htm) (Основные сведения о потоке проверки подлинности OAuth веб-сервера).  

## <a name="hybrid-scenarios-using-self-hosted-integration-runtime"></a>Гибридные сценарии (с использованием локальной среды выполнения интеграции)
Для реализации гибридных сценариев необходимо установить локальную среду выполнения интеграции в локальной сети, виртуальной сети (Azure) или виртуальном частном облаке (Amazon). У локальной среды выполнения интеграции должен быть доступ к локальным хранилищам данных. Узнайте больше о [локальной среде выполнения интеграции](create-self-hosted-integration-runtime.md). 

![Каналы локальной среды выполнения интеграции](media/data-movement-security-considerations/data-management-gateway-channels.png)

**Канал команд** обеспечивает взаимодействие между службами перемещения данных в фабрике данных и локальной среде выполнения интеграции. Этот коммуникационный канал содержит сведения, связанные с действиями. Канал данных используется для передачи данных между локальными хранилищами данных и облачными хранилищами.    

### <a name="on-premises-data-store-credentials"></a>Учетные данные локального хранилища данных
Учетные данные для локальных хранилищ данных всегда шифруются и сохраняются. Они могут храниться локально, на компьютере локальной среды выполнения интеграции, или в управляемом хранилище фабрики данных Azure (как учетные данные облачного хранилища). 

1. Вы можете **хранить учетные данные локально**. Чтобы зашифровать и сохранить учетные данные в локальной среде выполнения интеграции, выполните инструкции по [шифрованию учетных данных в локальной среде выполнения интеграции](encrypt-credentials-self-hosted-integration-runtime.md). Этот вариант поддерживают все соединители. Локальная среда выполнения интеграции использует [DPAPI](https://msdn.microsoft.com/library/ms995355.aspx) Windows для шифрования конфиденциальных данных и учетных данных. 

   Используйте командлет **New-AzureRmDataFactoryV2LinkedServiceEncryptedCredential** для шифрования учетных данных связанной службы и конфиденциальных данных в связанной службе. Затем можно использовать возвращаемое значение JSON (с элементом **EncryptedCredential** в **connectionString**) для создания связанной службы с помощью командлета **Set-AzureRmDataFactoryV2LinkedSevrice**.  

2. Если не использовать командлет **New-AzureRmDataFactoryV2LinkedServiceEncryptedCredential**, как описано на предыдущем шаге, а вместо этого выполнить командлет **Set-AzureRmDataFactoryV2LinkedSevrice** с JSON-файлом, содержащим строки подключения и учетные данные, связанная служба будет **зашифрована и сохранена в управляемом хранилище фабрики данных Azure**. Конфиденциальная информация по-прежнему шифруется сертификатом, и этими сертификатами управляет корпорация Майкрософт.



#### <a name="ports-used-during-encrypting-linked-service-on-self-hosted-integration-runtime"></a>Порты, используемые при шифровании связанной службы в локальной среде выполнения интеграции
По умолчанию PowerShell использует порт **8050** на компьютере локальной среды выполнения интеграции для обеспечения безопасной связи. При необходимости этот порт можно изменить.  

![HTTPS-порт для шлюза](media/data-movement-security-considerations/https-port-for-gateway.png)

 


### <a name="encryption-in-transit"></a>Шифрование при передаче
Все передачи данных выполняются через защищенный канал **HTTPS** и **TLS через TCP**, чтобы предотвратить атаки "злоумышленник в середине" во время взаимодействия со службами Azure.

Вы также можете использовать [VPN-подключение IPSec](../vpn-gateway/vpn-gateway-about-vpn-devices.md) или [Express Route](../expressroute/expressroute-introduction.md), чтобы в дальнейшем обеспечить безопасность коммуникационного канала между локальной сетью и Azure.

Виртуальная сеть — это логическое представление сети в облаке. Вы можете подключить локальную сеть к виртуальной сети Azure (VNet), настроив VPN-подключение IPSec типа "сеть — сеть" или Express Route (частный пиринг).     

В таблице ниже представлены общие рекомендации для настройки локальной среды выполнения интеграции и сети на основе различных комбинаций исходного и целевого расположений для гибридного перемещения данных.

| Источник      | Место назначения                              | Конфигурация сети                    | Настройка среды выполнения интеграции                |
| ----------- | ---------------------------------------- | ---------------------------------------- | ---------------------------------------- |
| Локальная система | Виртуальные машины и облачные службы, развернутые в виртуальных сетях | VPN-подключение IPSec (типа "точка — сеть" или "сеть — сеть") | Вы можете установить локальную среду выполнения интеграции на локальной виртуальной машине или виртуальной машине Azure в виртуальной сети. |
| Локальная система | Виртуальные машины и облачные службы, развернутые в виртуальных сетях | ExpressRoute (частный пиринг)           | Вы можете установить локальную среду выполнения интеграции на локальной виртуальной машине или виртуальной машине Azure, размещенной в виртуальной сети. |
| Локальная система | Службы на базе Azure, у которых есть общедоступная конечная точка | ExpressRoute (общедоступный пиринг)            | Локальная среда выполнения интеграции должна быть установлена локально. |

На рисунках ниже показано использование локальной среды выполнения интеграции для перемещения данных между локальной базой данных и службами Azure с помощью ExpressRoute и VPN-подключения IPSec (с помощью виртуальной сети).

**ExpressRoute:**

![Использование ExpressRoute со шлюзом](media/data-movement-security-considerations/express-route-for-gateway.png) 

**VPN-подключение IPSec:**

![VPN-подключение IPSec со шлюзом](media/data-movement-security-considerations/ipsec-vpn-for-gateway.png)

### <a name="firewall-configurations-and-whitelisting-ip-address-self-hosted-integration-runtime"></a>Параметры конфигурации брандмауэра и добавление IP-адреса (локальной среды выполнения интеграции) в список разрешений

#### <a name="firewall-requirements-for-on-premisesprivate-network"></a>Требования к брандмауэру для локальной или частной сети  
На предприятии **корпоративный брандмауэр** работает на центральном маршрутизаторе организации. **Брандмауэр Windows** работает как управляющая программа на локальном компьютере, на котором установлена локальная среда выполнения интеграции. 

В таблице ниже представлены **исходящий порт** и требования к домену для **корпоративного брандмауэра**.

| Имена доменов                  | Исходящие порты | ОПИСАНИЕ                              |
| ----------------------------- | -------------- | ---------------------------------------- |
| `*.servicebus.windows.net`    | 443, 80        | Требуется локальной среде выполнения интеграции для подключения к службам перемещения данных в фабрике данных. |
| `*.core.windows.net`          | 443            | Используется локальной средой выполнения интеграции для подключения к учетной записи хранения Azure при помощи функции [промежуточного копирования](copy-activity-performance.md#staged-copy). |
| `*.frontend.clouddatahub.net` | 443            | Требуется локальной среде выполнения интеграции для подключения к службе фабрики данных Azure. |
| `*.database.windows.net`      | 1433           | (Необязательно.) Требуется, если местом назначения является база данных SQL Azure или хранилище данных SQL Azure. Используйте функцию промежуточного копирования, чтобы копировать данные в базу данных SQL Azure или хранилище данных SQL Azure без необходимости открывать порт 1433. |
| `*.azuredatalakestore.net`    | 443            | (Необязательно.) Требуется, если местом назначения является Azure Data Lake Store. |

> [!NOTE] 
> Вам может потребоваться управлять портами или создать утвержденный список доменов на уровне корпоративного брандмауэра в соответствии с определенными источниками данных. В этой таблице в качестве примеров используются база данных SQL Azure, хранилище данных SQL Azure и Azure Data Lake Store.   

В следующей таблице представлены требования к **входящему порту** для **брандмауэра Windows**.

| Входящие порты | ОПИСАНИЕ                              |
| ------------- | ---------------------------------------- |
| 8050 (TCP)    | Требуется для командлета PowerShell Encryption, как описано в процедуре [шифрования учетных данных в локальной среде выполнения интеграции](encrypt-credentials-self-hosted-integration-runtime.md), или для приложения диспетчера учетных данных, чтобы обеспечить безопасную настройку учетных данных для локальных хранилищ данных в локальной среде выполнения интеграции. |

![Требования к порту шлюза](media\data-movement-security-considerations/gateway-port-requirements.png) 

#### <a name="ip-configurationswhitelisting-in-data-store"></a>IP-конфигурации и добавление в список разрешений в хранилище данных
Некоторые хранилища данных в облаке также требуют, чтобы IP-адрес компьютера, который получает к ним доступ, был добавлен в список разрешенных. IP-адрес компьютера локальной среды выполнения интеграции должен быть добавлен в список разрешений и корректно настроен в брандмауэре.

Ниже перечислены облачные хранилища данных, которым необходим разрешенный IP-адрес компьютера локальной среды выполнения интеграции. Некоторым из них по умолчанию это может не требоваться. 

- [база данных SQL Azure;](../sql-database/sql-database-firewall-configure.md) 
- [Хранилище данных Azure SQL](../sql-data-warehouse/sql-data-warehouse-get-started-provision.md)
- [Хранилище озера данных Azure](../data-lake-store/data-lake-store-secure-data.md#set-ip-address-range-for-data-access)
- [База данных Azure Cosmos](../cosmos-db/firewall-support.md)
- [Amazon Redshift](http://docs.aws.amazon.com/redshift/latest/gsg/rs-gsg-authorize-cluster-access.html) 

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Вопрос**. Может ли локальная среда выполнения интеграции совместно использоваться разными фабриками данных?
**Ответ**. В настоящее время эта функция не поддерживается. Но мы работаем над этим.

**Вопрос**. Каковы требования к портам для работы локальной среды выполнения интеграции?
**Ответ**. Локальная среда выполнения интеграции устанавливает HTTP-подключения к общедоступному Интернету. Для установки этих подключений для локальной среды выполнения интеграции должны быть открыты **исходящие порты 443 и 80**. Откройте **входящий порт 8050** только на уровне компьютера (не на уровне корпоративного брандмауэра) для диспетчера учетных данных. Если база данных SQL Azure или хранилище данных SQL Azure используются в качестве исходного или целевого объектов, тогда вам также необходимо открыть порт **1433**. Дополнительные сведения см. в разделе [о параметрах конфигурации брандмауэра и утвержденном списке IP-адресов](#firewall-configurations-and-whitelisting-ip-address-of gateway). 


## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о производительности действия копирования см. в [руководстве о производительности действия копирования и его настройке](copy-activity-performance.md).

 
