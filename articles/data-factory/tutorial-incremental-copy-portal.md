---
title: "Добавочное копирование таблицы с помощью фабрики данных Azure | Документация Майкрософт"
description: "В этом руководстве вы создадите конвейер фабрики данных Azure, который пошагово копирует данные из базы данных SQL Azure в хранилище BLOB-объектов Azure."
services: data-factory
documentationcenter: 
author: sharonlo101
manager: jhubbard
editor: spelluru
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/11/2018
ms.author: shlo
ms.openlocfilehash: ff26d3ae159320f8c726b37eb0c68e6c5f2c2cc3
ms.sourcegitcommit: 9cc3d9b9c36e4c973dd9c9028361af1ec5d29910
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2018
---
# <a name="incrementally-load-data-from-an-azure-sql-database-to-azure-blob-storage"></a>Пошаговая загрузка данных из базы данных SQL Azure в хранилище BLOB-объектов Azure
В этом руководстве вы создадите фабрику данных Azure с конвейером, который загружает разностные данные из таблицы в базе данных SQL Azure в хранилище BLOB-объектов Azure. 


> [!NOTE]
> Эта статья относится к версии 2 фабрики данных Azure, которая в настоящее время доступна в предварительной версии. Если вы используете общедоступную версию 1 службы фабрики данных, ознакомьтесь с [документацией по фабрике данных версии 1](v1/data-factory-copy-data-from-azure-blob-storage-to-sql-database.md).


В этом руководстве вы выполните следующие шаги:

> [!div class="checklist"]
> * Подготовите хранилище данных для хранения значений предела.
> * Создадите фабрику данных.
> * создание связанных служб. 
> * Создание наборов данных источника, приемника и предела.
> * Создали конвейер.
> * Запустили конвейер.
> * Выполнение мониторинга выполнения конвейера. 
> * Просмотр результатов
> * Добавление новых данных в источник.
> * Повторный запуск конвейера.
> * Отслеживание второго запуска конвейера.
> * Просмотр результатов второго запуска.


## <a name="overview"></a>Обзор
Ниже приведена общая схема решения. 

![Пошаговая загрузка данных](media\tutorial-Incremental-copy-portal\incrementally-load.png)

Ниже приведены важные действия для создания этого решения. 

1. **Выберите столбец для предела.**
    Выберите один столбец в исходном хранилище данных, который можно использовать для создания среза новых или обновленных записей при каждом запуске. Как правило, данные в этом выбранном столбце (например, последнее_время_изменения или идентификатор) продолжают увеличиваться по мере создания или обновления строк. В качестве предела используется максимальное значение в этом столбце.

2. **Подготовьте хранилище данных для хранения значений предела.** В этом руководстве вы сохраните значение предела в базе данных SQL.
    
3. **Создайте конвейер, используя следующий рабочий процесс**: 
    
    Конвейер в этом решении содержит следующие действия:
  
    * Создайте два действия поиска. Используйте первое действие поиска для получения последнего значения предела, а второе для получения нового значения предела. Эти значения передаются в действие копирования. 
    * Создайте действие копирования, копирующее строки из исходного хранилища данных со значениями столбцов предела, которые выше значений старого предела и меньше значений нового. Затем оно копирует разностные данные из исходного хранилища данных в хранилище BLOB-объектов в качестве нового файла. 
    * Создайте действие хранимой процедуры, которое обновляет значение предела для конвейера при последующем выполнении. 


Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

## <a name="prerequisites"></a>предварительным требованиям
* **База данных SQL Azure**. Используйте базу данных как исходное хранилище данных. Если у вас нет базы данных SQL, создайте ее, следуя указаниям в статье [Создание базы данных SQL Azure на портале Azure](../sql-database/sql-database-get-started-portal.md).
* **Хранилище Azure.** В этом руководстве в качестве приемника будет использоваться хранилище BLOB-объектов. Если у вас нет учетной записи хранения, создайте ее, следуя действиям в разделе [Создание учетной записи хранения](../storage/common/storage-create-storage-account.md#create-a-storage-account). Создайте контейнер с именем adftutorial. 

### <a name="create-a-data-source-table-in-your-sql-database"></a>Создание таблицы источника данных в базе данных SQL
1. Откройте среду SQL Server Management Studio. В **обозревателе сервера** щелкните правой кнопкой мыши базу данных и выберите **Создать запрос**.

2. Выполните указанную ниже команду SQL для базы данных SQL, чтобы создать таблицу с именем `data_source_table` в качестве хранилища источника данных. 
    
    ```sql
    create table data_source_table
    (
        PersonID int,
        Name varchar(255),
        LastModifytime datetime
    );

    INSERT INTO data_source_table
    (PersonID, Name, LastModifytime)
    VALUES
    (1, 'aaaa','9/1/2017 12:56:00 AM'),
    (2, 'bbbb','9/2/2017 5:23:00 AM'),
    (3, 'cccc','9/3/2017 2:36:00 AM'),
    (4, 'dddd','9/4/2017 3:21:00 AM'),
    (5, 'eeee','9/5/2017 8:06:00 AM');
    ```
    В этом руководстве в качестве столбца предела мы будем использовать LastModifytime. В следующей таблице показаны данные в хранилище источника данных.

    ```
    PersonID | Name | LastModifytime
    -------- | ---- | --------------
    1 | aaaa | 2017-09-01 00:56:00.000
    2 | bbbb | 2017-09-02 05:23:00.000
    3 | cccc | 2017-09-03 02:36:00.000
    4 | dddd | 2017-09-04 03:21:00.000
    5 | eeee | 2017-09-05 08:06:00.000
    ```

### <a name="create-another-table-in-your-sql-database-to-store-the-high-watermark-value"></a>Создание дополнительной таблицы в базе данных SQL для хранения значения верхнего предела
1. Выполните указанную ниже команду SQL для базы данных SQL, чтобы создать таблицу с именем `watermarktable` для хранения значения предела.  
    
    ```sql
    create table watermarktable
    (
    
    TableName varchar(255),
    WatermarkValue datetime,
    );
    ```
2. Задайте значение по умолчанию верхнего предела, используя имя таблицы исходного хранилища данных. В этом руководстве используется таблица с именем data_source_table.

    ```sql
    INSERT INTO watermarktable
    VALUES ('data_source_table','1/1/2010 12:00:00 AM')    
    ```
3. Просмотрите данные в таблице `watermarktable`.
    
    ```sql
    Select * from watermarktable
    ```
    Выходные данные: 

    ```
    TableName  | WatermarkValue
    ----------  | --------------
    data_source_table | 2010-01-01 00:00:00.000
    ```

### <a name="create-a-stored-procedure-in-your-sql-database"></a>Создание хранимой процедуры в базе данных SQL 

Выполните указанную ниже команду, чтобы создать хранимую процедуру в базе данных SQL.

```sql
CREATE PROCEDURE sp_write_watermark @LastModifiedtime datetime, @TableName varchar(50)
AS

BEGIN
    
    UPDATE watermarktable
    SET [WatermarkValue] = @LastModifiedtime 
WHERE [TableName] = @TableName
    
END
```

## <a name="create-a-data-factory"></a>Создание фабрики данных

1. В меню слева щелкните **Создать**, выберите **Данные+аналитика** и щелкните **Фабрика данных**. 
   
   ![Создать -> Фабрика данных](./media/tutorial-incremental-copy-portal/new-azure-data-factory-menu.png)
2. На странице **Новая фабрика данных** введите **ADFIncCopyTutorialDF** в поле **Имя**. 
      
     ![Страница "Новая фабрика данных"](./media/tutorial-incremental-copy-portal/new-azure-data-factory.png)
 
   Имя фабрики данных Azure должно быть **глобально уникальным**. Если вы увидите красный восклицательный знак с указанным ниже текстом ошибки, введите другое имя фабрики данных (например, ваше_имя_ADFIncCopyTutorialDF) и попробуйте создать фабрику данных снова. Ознакомьтесь со статьей [Фабрика данных Azure — правила именования](naming-rules.md), чтобы узнать правила именования для артефактов службы "Фабрика данных".
  
       `Data factory name "ADFIncCopyTutorialDF" is not available`
3. Выберите **подписку** Azure, в рамках которой вы хотите создать фабрику данных. 
4. Для **группы ресурсов** выполните одно из следующих действий.
     
      - Выберите **Использовать существующую**и укажите существующую группу ресурсов в раскрывающемся списке. 
      - Выберите **Создать новую**и укажите имя группы ресурсов.   
         
        Сведения о группах ресурсов см. в статье, где описывается [использование групп ресурсов для управления ресурсами Azure](../azure-resource-manager/resource-group-overview.md).  
4. Выберите **V2 (Preview)** (V2 (предварительная версия)) для **версии**.
5. Укажите **расположение** фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных (служба хранилища Azure, база данных SQL Azure и т. д.) и вычисления (HDInsight и т. д.), используемые фабрикой данных, могут располагаться в других регионах.
6. Кроме того, установите флажок **Закрепить на панели мониторинга**.     
7. Нажмите кнопку **Создать**.      
8. На панели мониторинга вы увидите приведенный ниже элемент с состоянием **Deploying data factory** (Развертывание фабрики данных). 

    ![Элемент Deploying data factory (Развертывание фабрики данных)](media/tutorial-incremental-copy-portal/deploying-data-factory.png)
9. Когда завершится создание, откроется страница **Фабрика данных**, как показано на рисунке ниже.
   
   ![Домашняя страница фабрики данных](./media/tutorial-incremental-copy-portal/data-factory-home-page.png)
10. Щелкните плитку **Создание и мониторинг**, чтобы открыть на отдельной вкладке пользовательский интерфейс фабрики данных Azure.

## <a name="create-a-pipeline"></a>Создание конвейера
В этом руководстве вы создадите конвейер с двумя действиями поиска, одним действием копирования и одним действием хранимой процедуры, связанными в одном конвейере. 

1. На странице **Начало работы** в пользовательском интерфейсе фабрики данных щелкните плитку **Создать конвейер**. 

   ![Страница "Начало работы" в пользовательском интерфейсе фабрики данных](./media/tutorial-incremental-copy-portal/get-started-page.png)    
3. На странице **Общие** в окне **Свойства** введите имя **IncrementalCopyPipeline**. 

   ![Имя конвейера](./media/tutorial-incremental-copy-portal/pipeline-name.png)
4. Теперь добавьте первое действие поиска, которое получает старое значение нижнего предела. На панели **Действия** разверните элемент **База данных SQL** и перетащите действие **Поиск** в область конструктора конвейера. Введите для нового действия имя **LookupOldWaterMarkActivity**.

   ![Первое действие поиска — имя](./media/tutorial-incremental-copy-portal/first-lookup-name.png)
5. Перейдите на вкладку **Параметры** и щелкните **+ Создать** в области **Source Dataset** (Исходный набор данных). На этом шаге вы создадите набор данных для представления данных в таблице **watermarktable**. В этой таблице содержится старый нижний предел, который использовался в предыдущей операции копирования. 

   ![Меню создания набора данных — старый нижний предел](./media/tutorial-incremental-copy-portal/new-dataset-old-watermark.png)
6. В окне **Новый набор данных** выберите **База данных SQL Microsoft Azure** и щелкните **Готово**. Откроется новая вкладка для этого набора данных. 

   ![Выбор Базы данных SQL Azure](./media/tutorial-incremental-copy-portal/select-azure-sql-database-old-watermark.png)
7. В окне свойств набора данных введите **WatermarkDataset** в поле **Имя**.

   ![Набор данных для нижнего предела — имя](./media/tutorial-incremental-copy-portal/watermark-dataset-name.png)
8. Перейдите на вкладку **Подключение** и щелкните **+ Создать**, чтобы создать подключение (связанную службу) к базе данных Azure SQL. 

   ![Кнопка создания связанной службы](./media/tutorial-incremental-copy-portal/watermark-dataset-new-connection-button.png)
9. В окне **New Linked Service** (Новая связанная служба) выполните следующие действия:

    1. Введите **AzureSqlDatabaseLinkedService** в поле **Имя**. 
    2. Выберите нужный сервер Azure SQL в списке **Имя сервера**.
    3. Введите **имя пользователя** для доступа к серверу Azure SQL. 
    4. Введите **пароль** для этого пользователя. 
    5. Чтобы проверить подключение к базе данных Azure SQL, нажмите кнопку **Проверить подключение**.
    6. Выберите команду **Сохранить**.
    7. На вкладке **Подключения** убедитесь, что выбрано значение **AzureSqlDatabaseLinkedService** в списке **Связанная служба**.
       
        ![Окно новой связанной службы](./media/tutorial-incremental-copy-portal/azure-sql-linked-service-settings.png)
10. Выберите **[dbo].[watermarktable]** в списке **Таблица**. Если вы хотите просмотреть данные в таблице, нажмите кнопку **Просмотр данных**.

    ![Набор данных для нижнего предела — настройки подключения](./media/tutorial-incremental-copy-portal/watermark-dataset-connection-settings.png)
11. Перейдите в редактор конвейера, щелкнув вкладку конвейера вверху или имя конвейера в представлении в виде дерева слева. В окне свойств для действия **Поиск**, убедитесь, что в поле **Source Dataset** (Исходный набор данных) выбран вариант **WatermarkDataset**. 

    ![Конвейер — набор данных для старого нижнего предела](./media/tutorial-incremental-copy-portal/pipeline-old-watermark-dataset-selected.png)
12. На панели элементов **Действия** разверните раздел **Базы данных SQL** и перетащите еще одно действие **Поиск** в область конструктора конвейера, затем назовите его  **LookupNewWaterMarkActivity** на вкладке **Общие** окна свойств. Это действие поиска получает новое значение нижнего предела из таблицы, где хранятся исходные данные для копирования в приемник. 

    ![Второе действие поиска — имя](./media/tutorial-incremental-copy-portal/second-lookup-activity-name.png)
13. В окне свойств второго действия **Поиск** перейдите на вкладку **Параметры** и нажмите кнопку **Создать**. Здесь вы создаете набор данных, который будет указывать на исходную таблицу с новым значением нижнего предела (максимального значения LastModifyTime). 

    ![Второе действие поиска — новый набор данных](./media/tutorial-incremental-copy-portal/second-lookup-activity-settings-new-button.png)
14. В окне **Новый набор данных** выберите **База данных SQL Microsoft Azure** и щелкните **Готово**. Откроется новая вкладка для этого набора данных. Также набор данных появится в представлении в виде дерева. 
15. На вкладке **Общие** окна свойств введите значение **SourceDataset** в поле **Имя**. 

    ![Исходный набор данных — имя](./media/tutorial-incremental-copy-portal/source-dataset-name.png)
16. Перейдите на вкладку **Подключения** и выполните следующие действия: 

    1. Выберите **AzureSqlDatabaseLinkedService** в списке **Связанная служба**.
    2. Выберите **[dbo].[ data_source_table]** в списке "Таблица". Запрос для этого набора данных вы создадите позднее в этом руководстве. Этот запрос будет более приоритетным, чем указанная на этом шаге таблица. 

        ![Второе действие поиска — новый набор данных](./media/tutorial-incremental-copy-portal/source-dataset-connection.png)
17. Перейдите в редактор конвейера, щелкнув вкладку конвейера вверху или имя конвейера в представлении в виде дерева слева. В окне свойств для действия **Поиск**, убедитесь, что в поле **Исходный набор данных** выбран вариант **SourceDataset**. 
18. Выберите **Запрос** в поле **Использовать запрос** и введите следующий запрос, который выбирает максимальное значение **LastModifytime** из таблицы **data_source_table**. Если вы не укажете этот запрос, набор данных вернет все строки из таблицы, имя которой вы указали в определении набора данных (data_source_table).

    ```sql
    select MAX(LastModifytime) as NewWatermarkvalue from data_source_table
    ```

    ![Второе действие поиска — запрос](./media/tutorial-incremental-copy-portal/query-for-new-watermark.png)
19. В панели элементов **Действия** разверните **Потоки данных** и перетащите действие **Копирование** из этой панели элементов, а затем присвойте ему имя **IncrementalCopyActivity**. 

    ![Действие копирования — имя](./media/tutorial-incremental-copy-portal/copy-activity-name.png)
20. **Соедините оба действия поиска с действием копирования**, перетащив **зеленую кнопку** от действия поиска к действию копирования. Когда цвет границы для действия копирования изменится на синий, отпустите кнопку мыши. 

    ![Подключение действия поиска к действию копирования](./media/tutorial-incremental-copy-portal/connection-lookups-to-copy.png)
21. Выберите действие **Копирование** и проверьте свойства этого действия в окне **Свойства**. 

    ![Свойства действия копирования](./media/tutorial-incremental-copy-portal/back-to-copy-activity-properties.png)
22. Откройте вкладку **Источник** в окне **Свойства** и выполните здесь следующие действия.

    1. Выберите **SourceDataset** в поле **Source Dataset** (Исходный набор данных). 
    2. Выберите **Запрос** в поле **Использовать запрос**. 
    3. Введите следующий запрос SQL в поле **Запрос**. 

        ```sql
        select * from data_source_table where LastModifytime > '@{activity('LookupOldWaterMarkActivity').output.firstRow.WatermarkValue}' and LastModifytime <= '@{activity('LookupNewWaterMarkActivity').output.firstRow.NewWatermarkvalue}'
        ```
    
        ![Действие копирования — источник](./media/tutorial-incremental-copy-portal/copy-activity-source.png)
23. Перейдите на вкладку **Приемник** и нажмите кнопку **+ Создать** в поле **Sink Dataset** (Целевой набор данных). 

    ![Кнопка "Создать набор данных"](./media/tutorial-incremental-copy-portal/new-sink-dataset-button.png)
24. В этом руководстве в качестве целевого хранилища данных используется хранилище BLOB-объектов Azure. Поэтому выберите здесь **Хранилище BLOB-объектов** и нажмите кнопку **Готово** в окне **Новый набор данных**. 

    ![Выбор хранилища BLOB-объектов Azure](./media/tutorial-incremental-copy-portal/select-azure-blob-storage.png)
25. На вкладке **Общие** окна свойств набора данных введите **SinkDataset** в поле **Имя**. 

    ![Целевой набор данных — имя](./media/tutorial-incremental-copy-portal/sink-dataset-name.png)
26. Перейдите на вкладку **Подключение** и нажмите кнопку **+ Создать** На этом шаге вы создадите подключение (связанную службу) для **хранилища BLOB-объектов Azure**.

    ![Целевой набор данных — новое подключение](./media/tutorial-incremental-copy-portal/sink-dataset-new-connection.png)
26. В окне **New Linked Service** (Новая связанная служба) выполните следующие действия: 

    1. Введите **AzureStorageLinkedService** в поле **имени**. 
    2. Выберите учетную запись хранения в списке **Storage account name** (Имя учетной записи хранения).
    3. Выберите команду **Сохранить**. 

        ![Связанная служба хранилища Azure — параметры](./media/tutorial-incremental-copy-portal/azure-storage-linked-service-settings.png)
27. На вкладке **Подключение** выполните следующие действия:

    1. Убедитесь, что значение **AzureStorageLinkedService** выбрано в списке **Связанная служба**. 
    2. В качестве имени **папки** в поле **Путь к файлу** введите значение **adftutorial/incrementalcopy**. Здесь **adftutorial** обозначает имя контейнера больших двоичных объектов, а **incrementalcopy** — имя папки в нем. В этом фрагменте кода предполагается, что у вас есть контейнер BLOB-объектов с именем adftutorial в хранилище BLOB-объектов. Создайте контейнер (если его еще нет) или присвойте ему имя имеющегося контейнера. Фабрика данных Azure автоматически создает целевую папку **incrementalcopy**, если она еще не существует. Можно также нажать кнопку **Обзор** рядом с полем **Путь к файлу**, чтобы перейти к нужной папке в контейнере больших двоичных объектов. .RunId, '.txt')`.
    3. В качестве **имени файла** в поле **Путь к файлу** введите значение `@CONCAT('Incremental-', pipeline().RunId, '.txt')`. Это выражение динамически создает имя файла. Каждый запуск конвейера имеет уникальный идентификатор. Действие копирования использует этот идентификатор запуска при создании имени файла. 

        ![Целевой набор данных — настройки подключения](./media/tutorial-incremental-copy-portal/sink-dataset-connection-settings.png)
28. Перейдите в редактор **конвейера**, щелкнув вкладку конвейера вверху или имя конвейера в представлении в виде дерева слева. 
29. На панели элементов **Действия** разверните **База данных SQL**, затем перетащите действие **Хранимая процедура** с панели элементов **Действия** в область конструктора конвейера. **Соедините** результаты действия **Копирование**, обозначенные зеленым цветом, с действием **Хранимая процедура**. 
    
    ![Действие копирования — источник](./media/tutorial-incremental-copy-portal/connect-copy-to-stored-procedure-activity.png)
24. Выберите **действие хранимой процедуры** в конструкторе конвейера и замените его имя значением **StoredProceduretoWriteWatermarkActivity**. 

    ![Действие хранимой процедуры — имя](./media/tutorial-incremental-copy-portal/stored-procedure-activity-name.png)
25. Перейдите на вкладку **Учетная запись SQL** и выберите *AzureSqlDatabaseLinkedService** в списке **Связанная служба**. 

    ![Действие хранимой процедуры — учетная запись SQL](./media/tutorial-incremental-copy-portal/sp-activity-sql-account-settings.png)
26. Перейдите на вкладку **Хранимая процедура** и выполните здесь следующие действия: 

    1. Введите **sp_write_watermark** в поле **Имя хранимой процедуры**. 
    2. Чтобы указать значения для параметров хранимой процедуры, нажмите кнопку **+ Создать** в разделе **Параметры хранимой процедуры** и введите следующие значения. 

        | ИМЯ | type | Значение | 
        | ---- | ---- | ----- | 
        | LastModifiedtime | Datetime | @{activity('LookupNewWaterMarkActivity').output.firstRow.NewWatermarkvalue} |
        | TableName | Строка | @{activity('LookupOldWaterMarkActivity').output.firstRow.TableName} |

    ![Действие хранимой процедуры — параметры хранимой процедуры](./media/tutorial-incremental-copy-portal/sproc-activity-stored-procedure-settings.png)
27. Чтобы проверить настройки конвейера, нажмите кнопку **Проверить** на панели инструментов. Убедитесь, что проверка завершается без ошибок. Чтобы закрыть окно **отчета о проверке конвейера**, нажмите кнопку ">>".   

    ![Проверка конвейера](./media/tutorial-incremental-copy-portal/validate-pipeline.png)
28. Опубликуйте сущности (связанные службы, наборы данных и конвейеры) в службе фабрики данных Azure, нажав кнопку **Опубликовать**. Дождитесь сообщения об успешном завершении публикации. 

    ![Кнопка "Опубликовать"](./media/tutorial-incremental-copy-portal/publish-button.png)

## <a name="trigger-a-pipeline-run"></a>Активация выполнения конвейера
Щелкните **Триггер** на панели инструментов, а затем нажмите кнопку **Trigger Now** (Запустить сейчас). 

![Кнопка "Запустить сейчас"](./media/tutorial-incremental-copy-portal/trigger-now.png)

## <a name="monitor-the-pipeline-run"></a>Выполнили мониторинг конвейера.

1. Перейдите на вкладку **Мониторинг** слева. Здесь вы увидите, что конвейер запущен вручную. Нажмите кнопку **Обновить**, чтобы обновить этот список. 
    
    ![Запуски конвейера](./media/tutorial-incremental-copy-portal/pipeline-runs.png)
2. Чтобы просмотреть запуски действий, связанные с этим запуском конвейера, щелкните первую ссылку (**View Activity Runs**, Просмотр запусков действий) в столбце **Действия**. Вы можете вернуться к предыдущему представлению, щелкнув **Конвейеры** вверху страницы. Нажмите кнопку **Обновить**, чтобы обновить этот список.

    ![Выполнение действия](./media/tutorial-incremental-copy-portal/activity-runs.png)

## <a name="review-the-results"></a>Просмотр результатов
1. Подключитесь к учетной записи хранения Azure с помощью специальных средств, например [Обозревателя службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/). Убедитесь, что целевой файл создан в папке **incrementalcopy** в контейнере **adftutorial**.

    ![Первый целевой файл](./media/tutorial-incremental-copy-portal/first-output-file.png)
2. Откройте целевой файл и убедитесь, что все данные скопированы из таблицы **data_source_table** в файл большого двоичного объекта. 

    ```
    1,aaaa,2017-09-01 00:56:00.0000000
    2,bbbb,2017-09-02 05:23:00.0000000
    3,cccc,2017-09-03 02:36:00.0000000
    4,dddd,2017-09-04 03:21:00.0000000
    5,eeee,2017-09-05 08:06:00.0000000
    ```
3. Проверьте последнее значение из `watermarktable`. Вы увидите, что значение предела было обновлено.

    ```sql
    Select * from watermarktable
    ```
    
    Результат выглядит так:
 
    | TableName | WatermarkValue |
    | --------- | -------------- |
    | data_source_table | 2017-09-05    8:06:00.000 | 

## <a name="add-more-data-to-source"></a>Добавление новых данных в источник

Добавьте новые данные в базу данных SQL (хранилище источника данных).

```sql
INSERT INTO data_source_table
VALUES (6, 'newdata','9/6/2017 2:23:00 AM')

INSERT INTO data_source_table
VALUES (7, 'newdata','9/7/2017 9:01:00 AM')
``` 

Обновленные данные в базе данных SQL выглядят следующим образом:

```
PersonID | Name | LastModifytime
-------- | ---- | --------------
1 | aaaa | 2017-09-01 00:56:00.000
2 | bbbb | 2017-09-02 05:23:00.000
3 | cccc | 2017-09-03 02:36:00.000
4 | dddd | 2017-09-04 03:21:00.000
5 | eeee | 2017-09-05 08:06:00.000
6 | newdata | 2017-09-06 02:23:00.000
7 | newdata | 2017-09-07 09:01:00.000
```


## <a name="trigger-another-pipeline-run"></a>Запуск второго конвейера
1. Перейдите на вкладку **Правка**. Щелкните конвейер в представлении в виде дерева, если он еще не открыт в конструкторе. 

    ![Кнопка "Запустить сейчас"](./media/tutorial-incremental-copy-portal/edit-tab.png)
2. Щелкните **Триггер** на панели инструментов, а затем нажмите кнопку **Trigger Now** (Запустить сейчас). 

    ![Кнопка "Запустить сейчас"](./media/tutorial-incremental-copy-portal/trigger-now.png)

## <a name="monitor-the-second-pipeline-run"></a>Отслеживание второго запуска конвейера.

1. Перейдите на вкладку **Мониторинг** слева. Здесь вы увидите, что конвейер запущен вручную. Нажмите кнопку **Обновить**, чтобы обновить этот список. 
    
    ![Запуски конвейера](./media/tutorial-incremental-copy-portal/pipeline-runs-2.png)
2. Чтобы просмотреть запуски действий, связанные с этим запуском конвейера, щелкните первую ссылку (**View Activity Runs**, Просмотр запусков действий) в столбце **Действия**. Вы можете вернуться к предыдущему представлению, щелкнув **Конвейеры** вверху страницы. Нажмите кнопку **Обновить**, чтобы обновить этот список.

    ![Выполнение действия](./media/tutorial-incremental-copy-portal/activity-runs-2.png)

## <a name="verify-the-second-output"></a>Проверка второго выходного файла

1. В хранилище BLOB-объектов вы увидите, что был создан другой файл. В этом руководстве новый файл имеет имя `Incremental-<GUID>.txt`. Открыв этот файл, вы увидите записи двух строк.

    ```
    6,newdata,2017-09-06 02:23:00.0000000
    7,newdata,2017-09-07 09:01:00.0000000    
    ```
2. Проверьте последнее значение из `watermarktable`. Вы увидите, что значение предела было обновлено снова.

    ```sql
    Select * from watermarktable
    ```
    Пример выходных данных: 
    
    | TableName | WatermarkValue |
    | --------- | --------------- |
    | data_source_table | 2017-09-07 09:01:00.000 |


     
## <a name="next-steps"></a>Дополнительная информация
В этом руководстве вы выполнили следующие шаги: 

> [!div class="checklist"]
> * Подготовите хранилище данных для хранения значений предела.
> * Создадите фабрику данных.
> * создание связанных служб. 
> * Создание наборов данных источника, приемника и предела.
> * Создали конвейер.
> * Запустили конвейер.
> * Выполнение мониторинга выполнения конвейера. 
> * Просмотр результатов
> * Добавление новых данных в источник.
> * Повторный запуск конвейера.
> * Отслеживание второго запуска конвейера.
> * Просмотр результатов второго запуска.

В этом руководстве с помощью конвейера мы скопировали данные из одной таблицы в базе данных SQL в хранилище BLOB-объектов. Перейдите к следующему руководству, чтобы узнать о копировании данных из нескольких таблиц в локальной базе данных SQL Server в базу данных SQL. 

> [!div class="nextstepaction"]
>[Добавочная загрузка данных из нескольких таблиц в SQL Server в базу данных SQL Azure](tutorial-incremental-copy-multiple-tables-portal.md)



