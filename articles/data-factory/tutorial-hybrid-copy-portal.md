---
title: "Копирование данных из базы данных SQL Server в хранилище BLOB-объектов с помощью фабрики данных Azure | Документация Майкрософт"
description: "Узнайте, как копировать данные из локального хранилища данных в облако Azure с помощью локальной среды выполнения интеграции в фабрике данных Azure."
services: data-factory
documentationcenter: 
author: linda33wj
manager: jhubbard
editor: spelluru
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/11/2018
ms.author: jingwang
ms.openlocfilehash: 64cd758e2f40ff2b18abbff1194a7e57389d8a54
ms.sourcegitcommit: 5ac112c0950d406251551d5fd66806dc22a63b01
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2018
---
# <a name="tutorial-copy-data-from-an-on-premises-sql-server-database-to-azure-blob-storage"></a>Руководство. Копирование данных из локальной базы данных SQL Server в хранилище BLOB-объектов Azure
В этом руководстве вы создадите конвейер фабрики данных, в котором данные из локальной базы данных SQL Server копируются в хранилище BLOB-объектов Azure, с помощью пользовательского интерфейса службы "Фабрика данных Azure". Вы создадите и будете использовать локальную среду выполнения интеграции, которая перемещает данные между локальным и облачным хранилищами данных. 

> [!NOTE]
> Эта статья относится к версии 2 фабрики данных Azure, которая в настоящее время доступна в предварительной версии. Если вы используете общедоступную версию 1 службы фабрики данных, ознакомьтесь с [документацией по фабрике данных версии 1](v1/data-factory-copy-data-from-azure-blob-storage-to-sql-database.md).
> 
> Эта статья не содержит подробный обзор службы фабрики данных. Дополнительную информацию см. в статье [Общие сведения о службе фабрики данных Azure, службе интеграции данных в облаке](introduction.md). 

Вот какие шаги выполняются в этом учебнике:

> [!div class="checklist"]
> * Создадите фабрику данных.
> * Создайте локальную среду выполнения интеграции.
> * Создадите SQL Server и связанные службы Azure. 
> * Создадите SQL Server и наборы данных больших двоичных объектов Azure.
> * Создадите конвейер с действием копирования для перемещения данных.
> * Запуск конвейера.
> * Выполнение мониторинга выполнения конвейера.

## <a name="prerequisites"></a>предварительным требованиям
### <a name="azure-subscription"></a>Подписка Azure.
Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.

### <a name="azure-roles"></a>Роли Azure
Чтобы создать экземпляры фабрики данных, нужно назначить учетной записи пользователя, используемой для входа в Azure, роль *участника*, *владельца* либо *администратора* подписки Azure. 

Чтобы просмотреть имеющиеся разрешения в подписке, на портале Azure выберите "Имя пользователя" в правом верхнем углу и выберите **Разрешения**. Если у вас есть доступ к нескольким подпискам, выберите соответствующую подписку. Примеры инструкций по назначению пользователю роли см. в статье [о добавлении ролей](../billing/billing-add-change-azure-subscription-administrator.md).

### <a name="sql-server-2014-2016-and-2017"></a>SQL Server 2014, 2016 и 2017
В этом руководстве используйте локальную базу данных SQL Server в качестве *исходного* хранилища данных. Конвейер фабрики данных, созданный в рамках этого руководства, копирует данные из этой локальной базы данных SQL Server (источника) в хранилище BLOB-объектов Azure (приемник). Затем создайте таблицу с именем **emp** в базе данных SQL Server и вставьте в нее несколько примеров записей. 

1. Запустите среду SQL Server Management Studio. Если она еще не установлена на вашем компьютере, скачайте ее со страницы [Скачивание SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms). 

2. Подключитесь к экземпляру SQL Server с помощью учетных данных. 

3. Создайте пример базы данных. В представлении в виде дерева щелкните правой кнопкой мыши элемент **Базы данных** и выберите пункт **Новая база данных**. 
 
4. В окне **Новая база данных** введите имя базы данных и нажмите кнопку **ОК**. 

5. Чтобы создать таблицу **emp** и вставить в нее примеры данных, запустите приведенный ниже скрипт запроса к базе данных:

   ```
    CREATE TABLE dbo.emp
    (
        ID int IDENTITY(1,1) NOT NULL,
        FirstName varchar(50),
        LastName varchar(50)
    )
    GO
    
    INSERT INTO emp (FirstName, LastName) VALUES ('John', 'Doe')
    INSERT INTO emp (FirstName, LastName) VALUES ('Jane', 'Doe')
    GO
   ```

6. В представлении в виде дерева щелкните правой кнопкой мыши созданную базу данных и выберите пункт **Новый запрос**.

### <a name="azure-storage-account"></a>Учетная запись хранения Azure
В этом руководстве используйте учетную запись хранения Azure общего назначения (хранилища BLOB-объектов Azure) в качестве целевого (принимающего) хранилища данных. Если у вас нет учетной записи хранения Azure общего назначения, см. инструкции по [созданию учетной записи хранения](../storage/common/storage-create-storage-account.md#create-a-storage-account). Конвейер фабрики данных, созданный в рамках этого руководства, копирует данные из локальной базы данных SQL Server (источника) в это хранилище BLOB-объектов Azure (приемник). 

#### <a name="get-storage-account-name-and-account-key"></a>Получение имени и ключа учетной записи хранения
В этом руководстве вы будете использовать имя и ключ своей учетной записи хранения Azure. Выполнив следующие действия, получите имя и ключ учетной записи хранения: 

1. Войдите на [портал Azure](https://portal.azure.com), используя имя пользователя и пароль Azure. 

2. В левой области выберите **Больше служб**, отфильтруйте содержимое по ключевому слову **хранение**, а затем выберите **Учетные записи хранения**.

    ![Поиск учетной записи хранения](media/tutorial-hybrid-copy-powershell/search-storage-account.png)

3. В списке учетных записей хранения найдите с помощью фильтра свою учетную запись хранения (при необходимости), а затем выберите эту учетную запись. 

4. В окне **Учетная запись хранения** выберите параметр **Ключи доступа**.

    ![Получение имени и ключа учетной записи хранения](media/tutorial-hybrid-copy-powershell/storage-account-name-key.png)

5. Скопируйте значения полей **Имя учетной записи хранения** и **key1**. Затем вставьте их в Блокнот или другой редактор для дальнейшего использования в руководстве. 

#### <a name="create-the-adftutorial-container"></a>Создание контейнера adftutorial 
В этом разделе вы создадите контейнер больших двоичных объектов с именем **adftutorial** в хранилище BLOB-объектов Azure. 

1. В окне **Учетная запись хранения** перейдите на вкладку **Обзор** и выберите **Blobs** (Большие двоичные объекты). 

    ![Выбор параметра "BLOB-объекты"](media/tutorial-hybrid-copy-powershell/select-blobs.png)

2. В окне **Служба BLOB-объектов** выберите **Контейнер**. 

    ![Кнопка добавления контейнера](media/tutorial-hybrid-copy-powershell/add-container-button.png)

3. В окне **Новый контейнер** в поле **Имя** введите **adftutorial**, а затем нажмите кнопку **ОК**. 

    ![Ввод имени контейнера](media/tutorial-hybrid-copy-powershell/new-container-dialog.png)

4. В списке контейнеров выберите **adftutorial**.  

    ![Выбор контейнера](media/tutorial-hybrid-copy-powershell/seelct-adftutorial-container.png)

5. Не закрывайте окно **контейнера** **adftutorial**. Она понадобится для проверки выходных данных в конце этого руководства. Фабрика данных автоматически создает выходную папку в этом контейнере, поэтому ее не нужно создавать.

    ![Окно контейнера](media/tutorial-hybrid-copy-powershell/container-page.png)


## <a name="create-a-data-factory"></a>Создание фабрики данных
На этом этапе вы создадите фабрику данных и запустите пользовательский интерфейс службы "Фабрика данных Azure" для создания конвейера в фабрике данных. 

1. В меню слева щелкните **Создать**, выберите **Данные+аналитика** и щелкните **Фабрика данных**. 
   
   ![Создать -> Фабрика данных](./media/tutorial-hybrid-copy-portal/new-azure-data-factory-menu.png)
2. На странице **Новая фабрика данных** введите **ADFTutorialDataFactory** в поле **Имя**. 
      
     ![Страница "Новая фабрика данных"](./media/tutorial-hybrid-copy-portal/new-azure-data-factory.png)
 
   Имя фабрики данных Azure должно быть **глобально уникальным**. Если вы увидите следующую ошибку для поля имени, введите другое имя фабрики данных (например, ваше_имя_ADFTutorialBulkCopyDF). Ознакомьтесь со статьей [Фабрика данных Azure — правила именования](naming-rules.md), чтобы узнать правила именования для артефактов службы "Фабрика данных".
  
     ![Страница "Новая фабрика данных"](./media/tutorial-hybrid-copy-portal/name-not-available-error.png)
3. Выберите **подписку** Azure, в рамках которой вы хотите создать фабрику данных. 
4. Для **группы ресурсов** выполните одно из следующих действий.
     
      - Выберите **Использовать существующую**и укажите существующую группу ресурсов в раскрывающемся списке. 
      - Выберите **Создать новую**и укажите имя группы ресурсов.   
         
        Сведения о группах ресурсов см. в статье, где описывается [использование групп ресурсов для управления ресурсами Azure](../azure-resource-manager/resource-group-overview.md).  
4. Выберите **V2 (Preview)** (V2 (предварительная версия)) для **версии**.
5. Укажите **расположение** фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных (служба хранилища Azure, база данных SQL Azure и т. д.) и вычисления (HDInsight и т. д.), используемые фабрикой данных, могут располагаться в других регионах.
6. Кроме того, установите флажок **Закрепить на панели мониторинга**.     
7. Нажмите кнопку **Создать**.      
8. На панели мониторинга вы увидите приведенный ниже элемент с состоянием **Deploying data factory** (Развертывание фабрики данных). 

    ![Элемент Deploying data factory (Развертывание фабрики данных)](media/tutorial-hybrid-copy-portal/deploying-data-factory.png)
9. Когда завершится создание, откроется страница **Фабрика данных**, как показано на рисунке ниже.
   
   ![Домашняя страница фабрики данных](./media/tutorial-hybrid-copy-portal/data-factory-home-page.png)
10. Щелкните плитку **Создание и мониторинг**, чтобы открыть пользовательский интерфейс службы "Фабрика данных" на отдельной вкладке. 


## <a name="create-a-pipeline"></a>Создание конвейера

1. На странице **Начало работы** щелкните **Create pipeline** (Создать конвейер). Будет автоматически создан конвейер. Конвейер отобразится в представлении в виде дерева и откроется в редакторе. 

   ![Страница "Начало работы"](./media/tutorial-hybrid-copy-portal/get-started-page.png)
2. Откройте вкладку **Общие** в нижней части окна **Свойства** и введите значение **SQLServerToBlobPipeline** в поле **Имя**.

   ![Имя конвейера](./media/tutorial-hybrid-copy-portal/pipeline-name.png)
2. На панели элементов **Действия** разверните **Поток данных** и перетащите действие **Копирование** в область конструктора конвейера. Задайте этому действию имя **CopySqlServerToAzureBlobActivity**.

   ![Имя действия](./media/tutorial-hybrid-copy-portal/copy-activity-name.png)
3. В окне свойств откройте вкладку **Источник** и щелкните **+ Создать**.

   ![Кнопка создания исходного набора данных](./media/tutorial-hybrid-copy-portal/source-dataset-new-button.png)
4. В окне **Новый набор данных** выполните поиск по строке **SQL Server**, выберите **SQL Server** и щелкните **Готово**. Появится новая вкладка с именем **SqlServerTable1**. Кроме того, набор данных **SqlServerTable1** появится слева в представлении в виде дерева. 

   ![Выбор SQL Server](./media/tutorial-hybrid-copy-portal/select-sql-server.png)
5. На вкладке **Общие** в окне свойств введите значение **SqlServerDataset** в поле **Имя**.
    
   ![Исходный набор данных — имя](./media/tutorial-hybrid-copy-portal/source-dataset-name.png)
6. Откройте вкладку **Подключения** и щелкните **+ Создать** На этом этапе вы создадите подключение к исходному хранилищу данных (база данных SQL Server). 

   ![Исходный набор данных — кнопка создания подключения](./media/tutorial-hybrid-copy-portal/source-connection-new-button.png)
7. В окне **New Linked Service** (Новая связанная служба) щелкните **Создание среды выполнения интеграции**. В этом разделе вы создадите локальную среду выполнения интеграции и свяжете ее с локальным компьютером, на котором находится база данных SQL Server. Локальная среда выполнения интеграции — это компонент, который копирует данные из базы данных SQL Server на компьютере в хранилище BLOB-объектов Azure. 

   ![Создание среды выполнения интеграции](./media/tutorial-hybrid-copy-portal/new-integration-runtime-button.png)
8. В окне **Integration Runtime Setup** (Настройка среды выполнения интеграции) выберите **Частная сеть** и нажмите кнопку **Далее**. 

   ![Выбор частной сети](./media/tutorial-hybrid-copy-portal/select-private-network.png)
9. Укажите имя среды выполнения интеграции и нажмите кнопку **Далее**.  
    
   ![Среда выполнения интеграции — имя](./media/tutorial-hybrid-copy-portal/integration-runtime-name.png)
10. Щелкните элемент **Click here to launch the express setup for this computer** (Щелкните здесь, чтобы запустить экспресс-установку для этого компьютера) в разделе **Option 1: Express setup** (Вариант 1. Экспресс-установка). 

   ![Ссылка экспресс-установки](./media/tutorial-hybrid-copy-portal/click-exress-setup.png)
11. В окне **Экспресс-установка Integration Runtime (Self-hosted)** щелкните **Закрыть**. 

   ![Настройка среды выполнения интеграции — успешное завершение](./media/tutorial-hybrid-copy-portal/integration-runtime-setup-successful.png)
12. В окне веб-браузера **Integration Runtime Setup** (Настройка среды выполнения интеграции) нажмите кнопку **Готово**. 

   ![Настройка среды выполнения интеграции — завершение](./media/tutorial-hybrid-copy-portal/click-finish-integration-runtime-setup.png)
13. В окне **New Linked Service** (Новая связанная служба) выполните следующие действия:

    1. Введите **SqlServerLinkedService** в поле **Имя**.
    2. Убедитесь, что созданная ранее локальная среда выполнения интеграции отображается в области **Connect via integration runtime** (Подключиться при помощи среды выполнения интеграции).
    3. Введите имя сервера SQL Server в поле **Имя сервера**. 
    4. Укажите имя базы данных, которая содержит таблицу **emp**, в поле **Имя базы данных**. 
    5. Выберите нужный **тип аутентификации**, который будет использоваться в службе "Фабрика данных "для подключения к базе данных SQL Server. 
    6. Введите **имя пользователя** и **пароль**. Если в имени учетной записи пользователя или имени сервера необходимо использовать символ обратной косой черты (\\), добавьте escape-символ (\\). Например, *mydomain\\\\myuser*. 
    7. Щелкните **Проверка подключения**. Это позволит проверить подключение службы"Фабрика данных" к базе данных SQL Server при помощи созданной в этом процессе локальной среды выполнения интеграции. 
    8. Чтобы сохранить связанную службу, щелкните **Сохранить**.

       ![Связанная служба SQL Server — параметры](./media/tutorial-hybrid-copy-portal/sql-server-linked-service-settings.png)
14. Теперь вы снова увидите окно с исходным набором данных. На вкладке **Подключения** в окне **Свойства** выполните следующие действия: 

    1. Убедитесь, что выбрано значение **SqlServerLinkedService** в поле **Связанная служба**. 
    2. Выберите **[dbo].[emp]** в списке **Таблица**.

        ![Исходный набор данных — сведения о подключении](./media/tutorial-hybrid-copy-portal/source-dataset-connection.png)
15. Откройте вкладку с конвейером SQLServerToBlobPipeline или щелкните элемент **SQLServerToBlobPipeline** в представлении в виде дерева. 

    ![Вкладка конвейера](./media/tutorial-hybrid-copy-portal/pipeliene-tab.png)
16. Откройте вкладку **Приемник** в окне **Свойства** и щелкните **+ Создать**. 

    ![Целевой набор данных — кнопка "Создать"](./media/tutorial-hybrid-copy-portal/sink-dataset-new-button.png)
17. В окне **Новый набор данных** выберите **Хранилище BLOB-объектов Azure** и щелкните **Готово**. Откроется новая вкладка для этого набора данных. Кроме того, набор данных появится в представлении в виде дерева. 

    ![Выбор хранилища BLOB-объектов Azure](./media/tutorial-hybrid-copy-portal/select-azure-blob-storage.png)
18. Введите **AzureBlobDataset** в поле **Имя**.

    ![Целевой набор данных — имя](./media/tutorial-hybrid-copy-portal/sink-dataset-name.png)
19. Откройте вкладку **Подключение** в окне **Свойства** и щелкните **+ Создать** для **связанной службы**. 

    ![Связанная служба — кнопка "Создать"](./media/tutorial-hybrid-copy-portal/new-storage-linked-service-button.png)
20. В окне **New Linked Service** (Новая связанная служба) выполните следующие действия:

    1. Введите **AzureStorageLinkedService** в поле **Имя**.
    2. В поле **Имя учетной записи хранения** выберите нужную учетную запись хранения. 
    3. Проверьте подключение к учетной записи хранения Azure, щелкнув **Проверка подключения**.
    4. Выберите команду **Сохранить**.

        ![Связанная служба хранилища Azure — параметры](./media/tutorial-hybrid-copy-portal/azure-storage-linked-service-settings.png) 
21.  Теперь снова отобразится окно с целевым набором данных. На вкладке **Подключение** выполните следующие действия: 

        1. Убедитесь, что значение **AzureStorageLinkedService** выбрано в списке **Связанная служба**.
        2. Введите значение **adftutorial/incrementalcopy** в качестве имени **папки** в поле **Путь к файлу**. Если указанной папки выходных данных нет в контейнере adftutorial, она будет автоматически создана в службе "Фабрика данных".
        3. Введите `@CONCAT(pipeline().RunId, '.txt')` в качестве **имени файла** в поле **Путь к файлу**.

            ![Целевой набор данных — подключение](./media/tutorial-hybrid-copy-portal/sink-dataset-connection.png)
22. Перейдите на вкладку с открытым конвейером или щелкните **конвейер** в **представлении в виде дерева**. Убедитесь, что в списке **Sink Dataset** (Целевой набор данных) выбрано значение **AzureBlobDataset**. 

    ![Выбранный целевой набор данных ](./media/tutorial-hybrid-copy-portal/sink-dataset-selected.png)
23. Чтобы проверить параметры конвейера, щелкните "Проверка" на панели инструментов для этого конвейера. Закройте **отчет о проверке конвейера**, щелкнув значок **X** в правом углу. 

    ![Проверка конвейера](./media/tutorial-hybrid-copy-portal/validate-pipeline.png)
1. Опубликуйте созданные сущности в службе "Фабрика данных Azure", щелкнув **Опубликовать**.

    ![Кнопка "Опубликовать"](./media/tutorial-hybrid-copy-portal/publish-button.png)
24. Дождитесь всплывающего сообщения **Публикация выполнена**. Чтобы проверить состояние публикации, щелкните ссылку **Показать уведомления** слева. Закройте окно уведомлений, щелкнув значок **X**. 

    ![Публикация выполнена](./media/tutorial-hybrid-copy-portal/publishing-succeeded.png)
    

## <a name="trigger-a-pipeline-run"></a>Запуск выполнения конвейера
Щелкните **Триггер** на панели инструментов конвейера и выберите **Trigger Now** (Запустить сейчас).

![Запустить сейчас](./media/tutorial-hybrid-copy-portal/trigger-now.png)

## <a name="monitor-the-pipeline-run"></a>Выполнили мониторинг конвейера.

1. Перейдите на вкладку **Мониторинг**. Отобразится конвейер, который вы запускали вручную на предыдущем этапе. 

    ![Запуски конвейера](./media/tutorial-hybrid-copy-portal/pipeline-runs.png)
2. Чтобы просмотреть сведения о выполнении действий, связанных с этим запуском конвейера, щелкните ссылку **View Activity Runs** (Просмотр сведений о выполнении действий) в столбце **Действия**. Здесь отображаются сведения об единственном выполнении действия, так как в конвейере определено только одно действие. Чтобы просмотреть сведения об операции копирования, щелкните ссылку **Сведения** (значок очков) в столбце **Действия**. Чтобы вернуться в режим просмотра запусков конвейера, щелкните ссылку **Конвейеры** вверху.

    ![Выполнение действия](./media/tutorial-hybrid-copy-portal/activity-runs.png)

## <a name="verify-the-output"></a>Проверка выходных данных
Конвейер автоматически создает выходную папку с именем *fromonprem* в контейнере больших двоичных объектов `adftutorial`. Убедитесь, что вы видите в выходной папке файл *dbo.emp.txt*. 

1. В окне контейнера **adftutorial** на портале Azure нажмите кнопку **Обновить**, чтобы появилась входная папка.

    ![Входная папка создана](media/tutorial-hybrid-copy-portal/fromonprem-folder.png)
2. В списке папок выберите `fromonprem`. 
3. Убедитесь, что отображается файл `dbo.emp.txt`.

    ![Выходной файл](media/tutorial-hybrid-copy-portal/fromonprem-file.png)


## <a name="next-steps"></a>Дополнительная информация
В этом примере конвейер копирует данные из одного расположения в другое в хранилище BLOB-объектов Azure. Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Создадите фабрику данных.
> * Создайте локальную среду выполнения интеграции.
> * Создадите SQL Server и связанные службы Azure. 
> * Создадите SQL Server и наборы данных больших двоичных объектов Azure.
> * Создадите конвейер с действием копирования для перемещения данных.
> * Запуск конвейера.
> * Выполнение мониторинга выполнения конвейера.

Список хранилищ данных, поддерживаемых фабрикой данных, см. в разделе [Поддерживаемые хранилища данных и форматы](copy-activity-overview.md#supported-data-stores-and-formats).

Чтобы узнать о копировании данных в пакетном режиме из источника в место назначения, перейдите к следующему руководству:

> [!div class="nextstepaction"]
>[Копирование нескольких таблиц в пакетном режиме с помощью фабрики данных Azure](tutorial-bulk-copy-portal.md)
