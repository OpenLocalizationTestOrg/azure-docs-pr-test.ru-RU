---
title: "Конвейеры и действия в фабрике данных Azure | Документация Майкрософт"
description: "Узнайте о конвейерах и действиях в фабрике данных Azure."
services: data-factory
documentationcenter: 
author: sharonlo101
manager: jhubbard
editor: spelluru
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/22/2018
ms.author: shlo
ms.openlocfilehash: f5384b4fa0a1baaafd8b2dbf3ed4d7776f4d80ea
ms.sourcegitcommit: 9cc3d9b9c36e4c973dd9c9028361af1ec5d29910
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2018
---
# <a name="pipelines-and-activities-in-azure-data-factory"></a>Конвейеры и действия в фабрике данных Azure 
> [!div class="op_single_selector" title1="Select the version of Data Factory service you are using:"]
> * [Версия 1 — общедоступная](v1/data-factory-create-pipelines.md)
> * [Версия 2 — предварительная](concepts-pipelines-activities.md)

В этой статье вы ознакомитесь с принципом работы конвейеров и действий в фабрике данных Azure и узнаете, как с их помощью создавать комплексные рабочие процессы, управляемые данными, для сценариев перемещения и обработки данных.

> [!NOTE]
> Эта статья относится к версии 2 фабрики данных, которая в настоящее время доступна в предварительной версии. Если вы используете общедоступную версию 1 службы фабрики данных, см. статью [Конвейеры и действия в фабрике данных Azure](v1/data-factory-create-pipelines.md).
> 
> Предполагается, что вы уже изучили [общие сведения о фабрике данных Azure](introduction.md) и [краткое руководство](quickstart-create-data-factory-powershell.md).

## <a name="overview"></a>Обзор
Фабрика данных может иметь один или несколько конвейеров. Конвейеры — это логические группы действий, которые вместе отвечают за выполнение задачи. Например, в конвейере может содержаться набор действий, которые принимают и очищают данные журнала, а затем запускают задания Spark в кластере HDInsight для анализа данных журнала. Преимуществом является то, что конвейер позволяет управлять группами действий, а не каждым отдельным действием. Например, вы можете развернуть конвейер и запланировать его работу, а не выполнять действия отдельно.  

Действия в конвейере определяют операции с данными. Например, действие копирования позволяет скопировать данные из локальной базы данных SQL Server в хранилище BLOB-объектов Azure. Затем можно использовать действие Hive для запуска сценария Hive в кластере Azure HDInsight, чтобы обработать данные из хранилища BLOB-объектов и получить выходные данные. Наконец, используйте второе действие копирования, чтобы скопировать выходные данные в хранилище данных SQL Azure, на основе которого строятся решения по отчетам бизнес-аналитики.

Фабрика данных поддерживает три типа действий: [действия перемещения данных](copy-activity-overview.md), [действия преобразования данных](transform-data.md) и [действия управления](control-flow-web-activity.md). У каждого действия может быть несколько входных [наборов данных](concepts-datasets-linked-services.md) или же ни одного, и каждое действие может производить один или несколько выходных [наборов данных](concepts-datasets-linked-services.md). На следующей схеме показана связь между конвейером, действием и набором данных в фабрике данных:

![Связь между набором данных, действием и конвейером](media/concepts-pipelines-activities/relationship-between-dataset-pipeline-activity.png)

Входной набор данных представляет входные данные для действия в конвейере, а выходной набор данных — выходные данные для действия. Наборы данных представляют данные в разных хранилищах, например в таблицах, файлах, папках и документах. Созданные наборы данных можно использовать для действий в конвейере. Например, можно указать входной или выходной набор данных для действия HDInsightHive или действия копирования. Дополнительные сведения о наборах данных см. в статье [Наборы данных в фабрике данных Azure](concepts-datasets-linked-services.md).

## <a name="data-movement-activities"></a>Действия перемещения данных
Действие копирования в фабрике данных копирует данные из хранилища-источника в хранилище-приемник. Фабрика данных поддерживает хранилища данных, перечисленные в таблице в этом разделе. Данные из любого источника можно записывать в любой приемник. Щелкните название хранилища, чтобы узнать, как скопировать данные из него или в него.

[!INCLUDE [data-factory-v2-supported-data-stores](../../includes/data-factory-v2-supported-data-stores.md)]

Дополнительные сведения см. в статье [Действие копирования в фабрике данных Azure](copy-activity-overview.md).

## <a name="data-transformation-activities"></a>Действия преобразования данных
Фабрика данных Azure поддерживает указанные ниже действия преобразования, которые вы можете добавлять в конвейеры как по отдельности, так и в связи с другим действием.

Действия по преобразованию данных | Вычислительная среда
---------------------------- | -------------------
[Hive](transform-data-using-hadoop-hive.md) | HDInsight [Hadoop]
[Pig](transform-data-using-hadoop-pig.md) | HDInsight [Hadoop]
[MapReduce](transform-data-using-hadoop-map-reduce.md) | HDInsight [Hadoop]
[Потоковая передача Hadoop](transform-data-using-hadoop-streaming.md) | HDInsight [Hadoop]
[Spark](transform-data-using-spark.md) | HDInsight [Hadoop]
[Действия машинного обучения: выполнение пакета и обновление ресурса](transform-data-using-machine-learning.md) | Azure
[Хранимая процедура](transform-data-using-stored-procedure.md) | Azure SQL, хранилище данных Azure SQL или SQL Server
[U-SQL](transform-data-using-data-lake-analytics.md) | Аналитика озера данных Azure

Дополнительные сведения см. в статье [Преобразование данных в фабрике данных Azure](transform-data.md). 

## <a name="control-activities"></a>Действия управления
Поддерживаются следующие действия потока управления:

Действие управления | ОПИСАНИЕ
---------------- | -----------
[Действие выполнения конвейера](control-flow-execute-pipeline-activity.md) | Действие выполнения конвейера позволяет конвейеру фабрики данных вызвать другой конвейер.
[Действие ForEach](control-flow-for-each-activity.md) | Действие ForEach определяет повторяющийся поток управления в конвейере. Это действие используется для выполнения итерации коллекции и выполняет указанные в цикле действия. Реализация цикла этого действия аналогична структуре цикла Foreach на языках программирования.
[Веб-действие](control-flow-web-activity.md) | Веб-действие можно использовать для вызова из конвейера фабрики данных пользовательской конечной точки REST. Вы можете передать наборы данных и связанные службы, которые будет использовать это действие и к которым оно будет обращаться. 
[Действие поиска](control-flow-lookup-activity.md) | Действие поиска можно использовать для считывания или поиска записи, имени таблицы и значения из внешних источников. На эти выходные данные можно затем ссылаться в последующих действиях. 
[Действие получения метаданных](control-flow-get-metadata-activity.md) | Действие GetMetadata можно использовать для получения метаданных любых данных в фабрике данных Azure. 
[Действие Until](control-flow-until-activity.md) | Реализует цикл Do Until, который аналогичен циклической структуре Do-Until в языках программирования. Оно выполняет набор действий в цикле, пока условие, связанное с действием, не получит значение true. Можно указать значение времени ожидания для действия until в фабрике данных.
[Действие условия If](control-flow-if-condition-activity.md) | Это действие можно использовать для создания ветви на основе условия, результатом расчета которого является значение True или False. Действие условия If предоставляет те же функциональные возможности, что и инструкция if в языках программирования. Оно определяет набор действий, если условие принимает значение `true`, и другой набор действий, если условие принимает значение `false`.
[Действие ожидания](control-flow-wait-activity.md) | Если в конвейере используется действие Wait, он приостанавливает обработку на указанный период, прежде чем возобновить выполнение последующих действий. 

## <a name="pipeline-json"></a>Конвейер JSON
Вот, как конвейер определяется в формате JSON: 

```json
{
    "name": "PipelineName",
    "properties": 
    {
        "description": "pipeline description",
        "activities":
        [
        ],
        "parameters": {
         }
    }
}
```

Тег | ОПИСАНИЕ | type | Обязательно
--- | ----------- | ---- | --------
name | Имя конвейера. Укажите имя, представляющее действие, которое выполняет конвейер. <br/><ul><li>Максимальное количество знаков: 260.</li><li>Должно начинаться с буквы, цифры или символа подчеркивания (_).</li><li>• Следующие знаки не допускаются: ".", "+", "?", "/", "<", ">", "*", "%", "&", ":", "\".</li></ul> | Строка | Yes
description | Укажите текст, описывающий, для чего используется конвейер. | Строка | Нет 
Действия | В разделе **activities** можно определить одно или несколько действий. Дополнительные сведения об элементе JSON действий см. в разделе [JSON действия](#activity-json). | Массив, | Yes
parameters | В разделе **Параметры** может быть задан один или несколько параметров, определенных в конвейере, которые делают конвейер гибким для повторного использования. | список | Нет 

## <a name="activity-json"></a>Действие JSON
В разделе **activities** можно определить одно или несколько действий. Существует два основных типа действий: действия выполнения и действия управления.

### <a name="execution-activities"></a>Действия выполнения
Действия выполнения включают в себя действия [перемещения данных](#data-movement-activities) и [преобразования данных](#data-transformation-activities). Они имеют следующую структуру верхнего уровня:

```json
{
    "name": "Execution Activity Name",
    "description": "description", 
    "type": "<ActivityType>",
    "typeProperties":
    {
    },
    "linkedServiceName": "MyLinkedService",
    "policy":
    {
    },
    "dependsOn":
    {
    }
}
```

В приведенной ниже таблице описаны свойства, используемые в определениях JSON действия:

Тег | ОПИСАНИЕ | Обязательно
--- | ----------- | ---------
name | Имя действия. Укажите имя, представляющее операцию, которую выполняет действие. <br/><ul><li>Максимальное количество знаков: 260.</li><li>Должно начинаться с буквы, цифры или символа подчеркивания (_).</li><li>Следующие знаки не допускаются: ".", "+", "?", "/", "<", ">", "*", "%", "&", ":", "\". | Yes</li></ul>
description | Текст, описывающий, для чего используется действие | Yes
Тип | Тип действия. Разные типы действий описаны в разделах, посвященных [действиям перемещения данных](#data-movement-activities), [действиям преобразования данных](#data-transformation-activities) и [действиям управления](#control-activities). | Yes
linkedServiceName | Имя связанной службы, используемой действием.<br/><br/>Для действия может потребоваться указать службу, связанную с обязательной вычислительной средой. | Да, для действия HDInsight, действия пакетной оценки показателей службы "Машинное обучение Azure" и действия хранимой процедуры. <br/><br/>Нет — для всех остальных
typeProperties | Свойства в разделе typeProperties зависят от каждого типа действия. Чтобы просмотреть свойства типа для действия, щелкните ссылки на действие в предыдущем разделе. | Нет 
policy | Политики, которые влияют на поведение во время выполнения действия. Это свойство включает время ожидания и поведение повтора. Если для этого свойства не задано значение, используются значения по умолчанию. Дополнительные сведения см. в разделе [Политика действий](#activity-policy). | Нет 
Свойство dependsOn | Это свойство используется для определения зависимостей между последующими и предыдущими действиями. Дополнительные сведения см. в разделе [Зависимости действий](#activity-dependency). | Нет 

### <a name="activity-policy"></a>Политика действий
Политики влияют на поведение действия во время его выполнения, предоставляя возможность настройки параметров. Они доступны только для действий выполнения. 

### <a name="activity-policy-json-definition"></a>Определение JSON политики действия

```json
{
    "name": "MyPipelineName",
    "properties": {
      "activities": [
        {
          "name": "MyCopyBlobtoSqlActivity"
          "type": "Copy",
          "typeProperties": {
            ...
          },
         "policy": {
            "timeout": "00:10:00",
            "retry": 1,
            "retryIntervalInSeconds": 60
         }
        }
      ],
        "parameters": {
           ...
        }
    }
}
```
Имя JSON | ОПИСАНИЕ | Допустимые значения | Обязательно
--------- | ----------- | -------------- | --------
timeout | Указывает время ожидания для выполнения действия. | Timespan | Нет. Время ожидания по умолчанию — 7 дней.
retry | Максимальное количество повторных попыток | Целое число  | Нет. Значение по умолчанию — 0.
retryIntervalInSeconds | Задержка между повторными попытками (в секундах) | Целое число  | Нет. По умолчанию это 20 секунд.

### <a name="control-activity"></a>Действие управления
Действие управления имеет следующую структуру верхнего уровня:

```json
{
    "name": "Control Activity Name",
    "description": "description", 
    "type": "<ActivityType>",
    "typeProperties":
    {
    },
    "dependsOn":
    {
    }
}
```

Тег | ОПИСАНИЕ | Обязательно
--- | ----------- | --------
name | Имя действия. Укажите имя, представляющее операцию, которую выполняет действие.<br/><ul><li>Максимальное количество знаков: 260.</li><li>Должно начинаться с буквы, цифры или символа подчеркивания (_).</li><li>Следующие знаки не допускаются: ".", "+", "?", "/", "<", ">", "*", "%", "&", ":", "\". | Yes</li><ul> 
description | Текст, описывающий, для чего используется действие | Yes
Тип | Тип действия. Разные типы действий описаны в разделах, посвященных [действиям перемещения данных](#data-movement-activities), [действиям преобразования данных](#data-transformation-activities) и [действиям управления](#control-activities). | Yes
typeProperties | Свойства в разделе typeProperties зависят от каждого типа действия. Чтобы просмотреть свойства типа для действия, щелкните ссылки на действие в предыдущем разделе. | Нет 
Свойство dependsOn | Это свойство используется для определения зависимостей между последующими и предыдущими действиями. Дополнительные сведения см. в разделе [Зависимости действий](#activity-dependency). | Нет 

### <a name="activity-dependency"></a>Зависимость действий
Зависимость действий определяет зависимость между последующими и предыдущими действиями, а также то, следует ли продолжать выполнение следующей задачи. Действие может зависеть от одного или нескольких предыдущих действий с разными условиями зависимости. 

Различные условия зависимости: "Выполнено", "Сбой", "Пропущено", "Завершено".

Например, если в конвейере есть действие A -> действие B, возможны различные сценарии:

- Действие B имеет условие зависимости от действия А с условием **Выполнено**: действие B выполняется, только если действие А имеет конечное состояние "Выполнено".
- Действие B имеет условие зависимости от действия А с условием **Сбой**: действие B выполняется, только если действие А имеет конечное состояние "Сбой".
- Действие Б имеет условие зависимости от действия А с условием **Завершено**: действие B выполняется, если действие А имеет конечное состояние "Выполнено" или "Сбой".
- Действие Б имеет условие зависимости от действия А с условием **Пропущено**: действие B выполняется, если действие А имеет конечное состояние "Пропущено". Конечное состояние "Пропущено" происходит в таком сценарии: действие X -> действие Y -> действие Z, где каждое действие выполняется, только если предыдущее действие завершается успешно. При сбое действия X действие Y имеет состояние "Пропущено", так как оно никогда не выполнится. Аналогичным образом действие Z находится в состоянии "Пропущено".

#### <a name="example-activity-2-depends-on-the-activity-1-succeeding"></a>Пример. Действие 2 зависит от успешного завершения действия 1

```json
{
    "name": "PipelineName",
    "properties": 
    {
        "description": "pipeline description",
        "activities": [
         {
            "name": "MyFirstActivity",
            "type": "Copy",
            "typeProperties": {
            },
            "linkedServiceName": {
            }
        },
        {
            "name": "MySecondActivity",
            "type": "Copy",
            "typeProperties": {
            },
            "linkedServiceName": {
            },
            "dependsOn": [
            {
                "activity": "MyFirstActivity",
                "dependencyConditions": [
                    "Succeeded"
                ]
            }
          ]
        }
      ],
      "parameters": {
       }
    }
}

```

## <a name="sample-copy-pipeline"></a>Пример конвейера копирования
В следующем примере конвейера содержится одно действие типа **Copy** in the **действий** . В этом примере [действие копирования](copy-activity-overview.md) копирует данные из хранилища BLOB-объектов Azure в базу данных SQL Azure.

```json
{
  "name": "CopyPipeline",
  "properties": {
    "description": "Copy data from a blob to Azure SQL table",
    "activities": [
      {
        "name": "CopyFromBlobToSQL",
        "type": "Copy",
        "inputs": [
          {
            "name": "InputDataset"
          }
        ],
        "outputs": [
          {
            "name": "OutputDataset"
          }
        ],
        "typeProperties": {
          "source": {
            "type": "BlobSource"
          },
          "sink": {
            "type": "SqlSink",
            "writeBatchSize": 10000,
            "writeBatchTimeout": "60:00:00"
          }
        },
        "policy": {
          "retry": 2,
          "timeout": "01:00:00"
        }
      }
    ]
  }
} 
```
Обратите внимание на следующие моменты.

- В разделе действий доступно только одно действие, параметр **type** которого имеет значение **Copy**.
- Для этого действия параметру input присвоено значение **InputDataset**, а параметру output — значение **OutputDataset**. Сведения об определении наборов данных в JSON см. в статье [Наборы данных](concepts-datasets-linked-services.md).
- В разделе **typeProperties** в качестве типа источника указано **BlobSource**, а в качестве типа приемника — **SqlSink**. В разделе [Действия перемещения данных](#data-movement-activities) щелкните хранилище данных, которое хотите использовать как источник или приемник, чтобы подробнее узнать о перемещении данных из этого хранилища или в него.

Полное пошаговое руководство по созданию этого конвейера см. в статье [Создание фабрики данных и конвейера с помощью PowerShell](quickstart-create-data-factory-powershell.md).

## <a name="sample-transformation-pipeline"></a>Пример конвейера преобразования
В следующем примере конвейера содержится одно действие типа **HDInsightHive** in the **действий** . В этом примере [действие HDInsight Hive](transform-data-using-hadoop-hive.md) преобразовывает данные из хранилища BLOB-объектов Azure, запуская файл сценария Hive в кластере Azure HDInsight Hadoop.

```json
{
    "name": "TransformPipeline",
    "properties": {
        "description": "My first Azure Data Factory pipeline",
        "activities": [
            {
                "type": "HDInsightHive",
                "typeProperties": {
                    "scriptPath": "adfgetstarted/script/partitionweblogs.hql",
                    "scriptLinkedService": "AzureStorageLinkedService",
                    "defines": {
                        "inputtable": "wasb://adfgetstarted@<storageaccountname>.blob.core.windows.net/inputdata",
                        "partitionedtable": "wasb://adfgetstarted@<storageaccountname>.blob.core.windows.net/partitioneddata"
                    }
                },
                "inputs": [
                    {
                        "name": "AzureBlobInput"
                    }
                ],
                "outputs": [
                    {
                        "name": "AzureBlobOutput"
                    }
                ],
                "policy": {
                    "retry": 3
                },
                "name": "RunSampleHiveActivity",
                "linkedServiceName": "HDInsightOnDemandLinkedService"
            }
        ]
    }
}
```
Обратите внимание на следующие моменты.

- В разделе activities есть только одно действие, параметр **type** которого имеет значение **HDInsightHive**.
- Файл сценария Hive, **partitionweblogs.hql**, хранится в учетной записи хранения Azure (указывается с помощью свойства scriptLinkedService, имеющего значение AzureStorageLinkedService) в папке script в контейнере `adfgetstarted`.
- Раздел `defines` используется, чтобы указать параметры среды выполнения, передаваемые скрипту Hive в качестве значений конфигурации Hive (например, `{hiveconf:inputtable}`, $`${hiveconf:partitionedtable}`).

Разделы **typeProperties** для каждого действия преобразования отличаются. Для получения дополнительных сведений о свойствах типа, поддерживаемых для действия преобразования, щелкните такое действие в таблице [Действия по преобразованию данных](#data-transformation-activities).

Полное пошаговое руководство по созданию этого конвейера см. в статье [Преобразование данных в облаке с помощью действия Spark в фабрике данных Azure](tutorial-transform-data-spark-powershell.md). 

## <a name="multiple-activities-in-a-pipeline"></a>Несколько действий в конвейере
В двух предыдущих примерах конвейеров присутствует только одно действие. Конвейер может содержать сразу несколько действий. Действия могут выполняться параллельно при наличии нескольких действий в конвейере и последующих действий, которые не зависят от предыдущих. 

Два действия можно соединить с помощью [зависимости действий](#activity-dependency), определяющей зависимость последующих действий от предыдущих, а также то, следует ли продолжать выполнение следующей задачи. Действие может защищать одно или больше предыдущих действий с разными условиями зависимости. 

## <a name="scheduling-pipelines"></a>Планирование конвейеров
Конвейеры планируются триггерами. Существуют различные типы триггеров (триггер планировщика, позволяющий запускать конвейеры по расписанию, а также ручной триггер, который запускает конвейеры по требованию). Дополнительные сведения см. в статье [Pipeline execution and triggers in Azure Data Factory](concepts-pipeline-execution-triggers.md) (Выполнение конвейера и триггеры в фабрике данных Azure). 

Чтобы триггер выполнял конвейер, включите в определении триггера ссылку на нужный конвейер. Конвейеры и триггеры имеют связь n-m. Один триггер может запускать несколько конвейеров, и несколько триггеров могут запускать один конвейер. После определения триггера необходимо активировать его, чтобы он начал запуск конвейера. Дополнительные сведения см. в статье [Pipeline execution and triggers in Azure Data Factory](concepts-pipeline-execution-triggers.md) (Выполнение конвейера и триггеры в фабрике данных Azure). 

Например, предположим, что имеется триггер планировщика "Триггер A", который должен запустить конвейер MyCopyPipeline. Определите триггер, как показано в следующем примере:

### <a name="trigger-a-definition"></a>Определение триггера А

```json
{
  "name": "TriggerA",
  "properties": {
    "type": "ScheduleTrigger",
    "typeProperties": {
      ...
      }
    },
    "pipeline": {
      "pipelineReference": {
        "type": "PipelineReference",
        "referenceName": "MyCopyPipeline"
      },
      "parameters": {
        "copySourceName": "FileSource"
      }
    }
  }
}
```



## <a name="next-steps"></a>Дополнительная информация
Пошаговые инструкции по созданию конвейеров с помощью действий приведены в следующих руководствах: 

- [Создание фабрики данных и конвейера с помощью PowerShell](quickstart-create-data-factory-powershell.md)
- [Учебник. Создание первого конвейера для преобразования данных с помощью кластера Hadoop](tutorial-transform-data-spark-powershell.md)
