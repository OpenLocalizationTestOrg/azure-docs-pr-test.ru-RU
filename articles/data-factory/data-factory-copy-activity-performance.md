---
title: "Действие aaaCopy производительности и руководство по настройке | Документы Microsoft"
description: "Дополнительные сведения о ключевых факторов, влияющих на производительность hello перемещения данных в фабрике данных Azure, при использовании действия копирования."
services: data-factory
documentationcenter: 
author: linda33wj
manager: jhubbard
editor: monicar
ms.assetid: 4b9a6a4f-8cf5-4e0a-a06f-8133a2b7bc58
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/10/2017
ms.author: jingwang
ms.openlocfilehash: b0fb5a76c34752d07e8ddfffbb799a05fb5d6be6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="copy-activity-performance-and-tuning-guide"></a>Руководство по настройке производительности действия копирования
Действие копирования фабрики данных Azure — первоклассное безопасное, надежное и высокопроизводительное решение для загрузки данных. Он позволяет toocopy десятков терабайт данных ежедневно между целый ряд облачных и локальных хранилищ данных. Производительность загрузки данных практически мгновенное является tooensure ключа, можно сосредоточиться на проблему «больших данных» core hello: построение решениями углубленной аналитики и получение подробные с данными.

Azure предоставляет набор корпоративного уровня решения хранилищ данных хранения и обработки данных, и действие копирования предлагает высокой степенью оптимизации данных загрузке легко tooconfigure и настройки. Ниже перечислены возможности отдельного действия копирования.

* Загрузка данных в **хранилище данных SQL Azure** со скоростью **1,2 Гбит/с**. Пошаговое руководство и пример использования см. в статье [Загрузка 1 ТБ в хранилище данных SQL Azure с помощью фабрики данных Azure [мастер копирования] менее чем за 15 минут](data-factory-load-sql-data-warehouse.md).
* Загрузка данных в **хранилище BLOB-объектов Azure** на скорости **1,0 Гбит/с**.
* Загрузка данных в **Azure Data Lake Store** на скорости **1,0 Гбит/с**.

Содержание статьи

* [Показатели производительности ссылка](#performance-reference) для поддерживаемых источника и приемника toohelp данных сохраняет плана проекта.
* Функции, которые может значительно повысить Здравствуйте, копируемых в различных сценариях, включая [облако единицы перемещения данных](#cloud-data-movement-units), [параллельных копирования](#parallel-copy), и [промежуточное копирования](#staged-copy);
* [Руководство по настройке производительности](#performance-tuning-steps) на как tootune hello производительности и hello ключевые факторы, которые могут повлиять на копирование производительности.

> [!NOTE]
> Если вам в целом не знакомо действие копирования, перед чтением этой статьи ознакомьтесь со статьей [Перемещение данных с помощью действия копирования](data-factory-data-movement-activities.md) .
>

## <a name="performance-reference"></a>Базовые показатели производительности

Как ссылка приведенной ниже таблице номер hello копирования пропускную способность в Мбит/с для заданного источника и приемника пары внутреннего тестирования hello. Для сравнения также демонстрируется, как разные параметры [облачных единиц перемещения данных](#cloud-data-movement-units) или [масштабируемости шлюза управления данными](data-factory-data-management-gateway-high-availability-scalability.md) (несколько узлов шлюза) могут помочь определить производительность копирования.

![Матрица производительности](./media/data-factory-copy-activity-performance/CopyPerfRef.png)


**Toonote точек:**
* Пропускная способность вычисляется с помощью hello следующую формулу: [размер данных, считанных из источника] / [Действие копирования длительность выполнения].
* Hello производительности ссылочные номера в таблице hello оценивались с помощью [TPC-H](http://www.tpc.org/tpch/) набора данных при выполнении действия по одной копии.
* В хранилищах данных Azure hello источник и приемник имеют в hello же регионе Azure.
* Для гибридное копирование между локальными и облачными хранилищами данных, каждый узел шлюза была запущена на компьютере, который был отдельно от hello локальных данных в хранилище ниже спецификации. Одно действие выполнялось на шлюзе, операция копирования hello использовать лишь малую часть ЦП, памяти и пропускной способности сети hello тестовый компьютер. Подробнее см.в разделе [Рекомендации относительно шлюза управления данными](#considerations-for-data-management-gateway).
    <table>
    <tr>
        <td>ЦП</td>
        <td>Intel Xeon E5-2660 v2, 32 ядра с частотой 2,20 ГГц</td>
    </tr>
    <tr>
        <td>Память</td>
        <td>128 ГБ</td>
    </tr>
    <tr>
        <td>Сеть</td>
        <td>Веб-интерфейс: 10 Гбит/с; интерфейс интрасети: 40 Гбит/с</td>
    </tr>
    </table>


> [!TIP]
> Можно добиться более высокую пропускную способность за счет использования перемещения единицы дополнительные данные (DMUs) чем hello максимальное DMUs по умолчанию которого — 32 для запуска действия копирования облака в облако. Например, используя 100 DMU, можно достичь скорости копирования данных из большого двоичного объекта Azure в Azure Data Lake Store до **1 Гбит/с**. . В разделе hello [облако единицы перемещения данных](#cloud-data-movement-units) раздел для получения сведений об этой функции и hello поддерживается сценария. Обратитесь к [поддержки Azure](https://azure.microsoft.com/support/) toorequest дополнительные DMUs.

## <a name="parallel-copy"></a>Параллельное копирование
Можно считывать данные из hello источника или записи данных назначения toohello **параллельно в рамках выполнения операции копирования**. Эта функция повышает пропускную способность hello операции копирования и сокращает время hello toomove данных.

Этот параметр отличается от hello **параллелизма** свойство в определении действия hello. Hello **параллелизма** свойство определяет количество hello **параллельных операций копирования выполняется** tooprocess данные из другого действия windows (1 AM too2 AM, AM too3 2 часа НОЧИ, я 3 AM too4 и так далее). Это эффективно в случаях значительной загрузки. возможность параллельная копия Hello применяется tooa **единый при выполнении действия**.

Рассмотрим пример сценария: В следующем примере hello несколько фрагментов из hello последние должны toobe обработки. Фабрика данных запускает экземпляр действия копирования (выполнение действия) для каждого среза.

* срез данных Hello из окна первого действия hello (1 AM too2 AM) == > выполняться действие 1
* срез данных Hello из второе окно действие hello (2 часа НОЧИ too3 AM) == > выполняться действие 2
* срез данных Hello из второе окно действие hello (3 часа НОЧИ too4 AM) == > выполняться действие 3

И т. д.

В этом примере, когда hello **параллелизма** значение too2, **выполняться действие 1** и **выполняться действие 2** скопировать данные из двух действий windows **параллельно**  производительность перемещения данных tooimprove. Тем не менее если несколько файлов, связанные с 1 при выполнении действия, служба перемещения данных hello копирует файлы из одного файла toohello источника назначения hello одновременно.

### <a name="cloud-data-movement-units"></a>Облачные единицы перемещения данных
Объект **блока перемещения данных облака (помощью утилиты DMU)** — это мера, представляющая масштаб hello (сочетание Процессора, памяти и выделения ресурсов сети) единое целое в фабрике данных. Эта мера используется для операции копирования из облака в облако, но не для гибридного копирования.

По умолчанию фабрика данных использует tooperform помощью утилиты DMU одной облачной при выполнении одной копии действия. toooverride это значение по умолчанию, укажите значение для hello **cloudDataMovementUnits** свойства следующим образом. Сведения об уровне hello прироста производительности, можно получить при настройке большее число единиц для определенной копии источника и приемника см. в разделе hello [Справочник по производительности](#performance-reference).

```json
"activities":[  
    {
        "name": "Sample copy activity",
        "description": "",
        "type": "Copy",
        "inputs": [{ "name": "InputDataset" }],
        "outputs": [{ "name": "OutputDataset" }],
        "typeProperties": {
            "source": {
                "type": "BlobSource",
            },
            "sink": {
                "type": "AzureDataLakeStoreSink"
            },
            "cloudDataMovementUnits": 32
        }
    }
]
```
Hello **допустимые значения** для hello **cloudDataMovementUnits** свойства являются 1 (по умолчанию), 2, 4, 8, 16, 32. Hello **фактическое число облака DMUs** , операция копирования hello используется во время выполнения будет равно tooor меньше, чем значение hello настроена, в зависимости от шаблона данных.

> [!NOTE]
> Если вам требуется больше облачных единиц перемещения данных, чтобы повысить пропускную способность, обратитесь в [службу поддержки Azure](https://azure.microsoft.com/support/). Установка 8 и более поздней версии в настоящее время работает, только если вы **скопировать несколько файлов из SFTP FTP и облачным S3 и облачным tooBlob больших двоичных объектов хранилища или хранилища Озера данных/Amazon хранилища или хранилища Озера данных и Azure базы данных SQL**.
>

### <a name="parallelcopies"></a>parallelCopies
Можно использовать hello **parallelCopies** свойство tooindicate hello параллелизма, которые должны toouse действие копирования. Это свойство можно считать hello максимальное число потоков внутри действия копирования, который может читать из источника или записи хранилищ данных приемник tooyour параллельно.

Для каждого выполнения действия копирования фабрики данных определяет hello число используемых параллельных копирует toouse toocopy данные из хранилища данных источника hello и toohello целевое хранилище данных. количество параллельных копии, которые она использует по умолчанию Hello зависит от типа hello источника и приемника, который вы используете.  

| Источник и приемник | Число параллельных копий по умолчанию, определенное службой |
| --- | --- |
| Копирование данных из одного файлового хранилища данных в другое (хранилище BLOB-объектов, Data Lake Store, Amazon S3, локальная файловая система, локальная файловая система HDFS). |От 1 до 32. Зависит от размера hello файлов hello и hello число единиц перемещения данных облака (DMUs) используется toocopy данные между двумя хранилищами данных облака или hello физическую конфигурацию hello компьютер шлюза для копирования гибридное (toocopy данных tooor из локального хранилища данных ). |
| Скопировать данные из **tooAzure хранилище таблиц хранения любого источника данных** |4. |
| Все прочие сочетания источника и приемника |1 |

Как правило, поведение по умолчанию hello, последняя будет предоставлять hello лучшей пропускной способности. Однако toocontrol hello загрузки на компьютерах, на которых размещены хранилищ данных или производительность копирования tootune, можно выбрать значение по умолчанию hello toooverride и укажите значение для hello **parallelCopies** свойство. Hello значение должно быть в диапазоне от 1 до 32 (включительно для обоих). Во время выполнения, для повышения производительности рекомендуется hello действие копирования используется значение, которое меньше или равно toohello заданное значение.

```json
"activities":[  
    {
        "name": "Sample copy activity",
        "description": "",
        "type": "Copy",
        "inputs": [{ "name": "InputDataset" }],
        "outputs": [{ "name": "OutputDataset" }],
        "typeProperties": {
            "source": {
                "type": "BlobSource",
            },
            "sink": {
                "type": "AzureDataLakeStoreSink"
            },
            "parallelCopies": 8
        }
    }
]
```
Toonote точек:

* При копировании данных между хранилищами на основе файлов, hello **parallelCopies** определить hello параллелизм на уровне файла hello. Фрагментация Hello в одном файле может произойти под автоматически и прозрачно и разработан toouse hello наиболее подходящего размера фрагментов заданного исходного хранилища данных введите в параллельных и ортогональных tooparallelCopies tooload данные. Фактическое число параллельных копий hello перемещения данных службы, используются для операции копирования hello во время выполнения не больше, чем hello количество файлов, которые у вас есть Hello. Если режим копирования hello **mergeFile**, действие копирования не могут воспользоваться преимуществами параллелизма на уровне файла.
* Если указать значение для hello **parallelCopies** свойство, рассмотрите возможность hello увеличение нагрузки на источника и приемника хранилища данных и toogateway, если это гибридное копирование. Это происходит, особенно если у вас есть несколько действий или параллельных запусках hello те же действия, выполняемые для hello одно хранилище данных. Если хранилище данных hello или шлюз перегружен с нагрузкой hello, уменьшить hello **parallelCopies** значение toorelieve hello нагрузки.
* При копировании данных из хранилищ, которые не являются файловых toostores, основаны на файлах, служба перемещения данных hello игнорирует hello **parallelCopies** свойство. В этом случае параллелизм не применяется, даже если задан соответствующий параметр.

> [!NOTE]
> Необходимо использовать hello toouse 1.11 или более поздней версии шлюза управления данными **parallelCopies** компонентов, при этом гибридное копирование.
>
>

toobetter эти два свойства и использовать tooenhance пропускная способность перемещения данных см. в разделе hello [образцы вариантов использования](#case-study-use-parallel-copy). Не требуется tooconfigure **parallelCopies** tootake преимуществами поведение по умолчанию hello. Если вы зададите для свойства **parallelCopies** невысокое значение, несколько облачных единиц перемещения данных не будут использоваться полностью.  

### <a name="billing-impact"></a>Принцип выставления счетов
Он имеет **важные** tooremember, назначается цена на основании hello общее время операции копирования hello. Если задание копирования используется один час tootake с единицей одно облако, а теперь занимает 15 минут с единицами четыре облака, hello общей спецификации остается практически hello таким же. Допустим, используются четыре облачные единицы. Hello первого устройства облака тратит 10 минут, hello второй, 10 минут hello третий за 5 минут и hello четвертую 5 минут, в один при выполнении действия копирования. Взимается плата для hello общее копии (перемещение данных) времени, которое составляет 10 + 10 + 5 + 5 = 30 минут. Использование свойства **parallelCopies** не влияет на выставление счетов.

## <a name="staged-copy"></a>промежуточное копирование
При копировании данных из хранилища данных источника данных хранилища tooa приемник, вы можете toouse хранилища BLOB-объектов как промежуточные промежуточного хранилища. Промежуточная особенно полезна в следующих случаях hello:

1. **Вы хотите tooingest данные из различных хранилищ данных в хранилище данных SQL через PolyBase**. Хранилище данных SQL использует PolyBase в качестве механизма высокой пропускной способностью tooload большой объем данных в хранилище данных SQL. Однако hello источник данных должен быть в хранилище больших двоичных объектов, и он должен соответствовать дополнительные критерии. При загрузке данных не из хранилища BLOB-объектов можно активировать копирование через промежуточное хранилище BLOB-объектов. В этом случае фабрики данных выполняет преобразования tooensure hello необходимых данных, соответствие требованиям hello объекта PolyBase. Затем он выполняет PolyBase tooload данных в хранилище данных SQL. Дополнительные сведения см. в разделе [PolyBase используйте tooload данных в хранилище данных SQL Azure](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse). Пошаговое руководство и пример использования см. в статье [Загрузка 1 ТБ в хранилище данных SQL Azure с помощью фабрики данных Azure [мастер копирования] менее чем за 15 минут](data-factory-load-sql-data-warehouse.md).
2. **Иногда это занимает немного времени tooperform перенос гибридных данных (то есть toocopy между к локальному хранилищу данных и хранилищем данных облака) через медленное сетевое подключение**. tooimprove производительности, можно сжать hello локальные данные, чтобы он меньше времени хранения toomove toohello промежуточных данных в облаке hello. Затем можно распаковать данные hello в hello промежуточного хранилища перед их загрузкой в хранилище данных назначения hello.
3. **Вы не хотите tooopen порты, отличный от порта 80 и порт 443 в брандмауэре, из-за корпоративным ИТ-политикам**. Например при копировании данных из приемник локальной tooan хранилище данных базы данных SQL Azure или приемника хранилища данных SQL Azure, необходимо tooactivate исходящие соединения TCP через порт 1433 для брандмауэра Windows hello и корпоративного брандмауэра. В этом сценарии воспользоваться преимуществами hello toofirst копирования данных tooa большой двоичный объект хранения промежуточного экземпляр шлюза, через HTTP или HTTPS через порт 443. Затем нужно Загрузите данные hello в базе данных SQL или хранилище данных SQL из промежуточного хранения больших двоичных объектов. В этом потоке не требуется tooenable порт 1433.

### <a name="how-staged-copy-works"></a>Принцип промежуточного копирования
При активации hello промежуточных компонентов первый hello данные копируются из промежуточного хранения хранилища данных хранилища toohello hello источника данных (Используйте собственный). Далее hello данные копируются из hello промежуточного хранения хранилища данных приемник toohello хранилища данных. Фабрика данных автоматически управляет поток двухэтапное hello. Фабрика данных также удаляет временные данные из промежуточного хранения, после завершения перемещения данных hello hello.

В случае копирования hello облака (источник и приемник данных хранилища — в облаке hello) шлюз не используется. Hello служба фабрики данных выполняет операции копирования hello.

![Промежуточное копирование: облачный сценарий](media/data-factory-copy-activity-performance/staged-copy-cloud-scenario.png)

В случае копирования гибридного hello (источник — локальные и приемник находящийся в облаке hello) шлюза hello перемещает данные из источника данных hello хранения tooa промежуточного хранения хранилища данных. Служба фабрики данных перемещает данные из промежуточных данных hello хранилище toohello приемник данных. Копирование данных из хранилища tooan облачных данных локального хранилища данных через промежуточное хранение также поддерживается с потоком hello в обратном направлении.

![Промежуточное копирование: гибридный сценарий](media/data-factory-copy-activity-performance/staged-copy-hybrid-scenario.png)

При активации перемещения данных с использованием промежуточного хранилища, можно указать, следует ли toobe данных hello, сжимаются перед перемещением данных из источника hello хранилище tooan промежуточной или промежуточного хранения хранилища данных и затем распаковать перед перемещением данных из промежуточной или промежуточного хранилища toohello приемник данных хранилища данных.

Сейчас промежуточное хранение при копировании данных между двумя локальными хранилищами не поддерживается. Скоро ожидается toobe этот параметр доступен.

### <a name="configuration"></a>Конфигурация
Настройка hello **enableStaging** параметр в действии копирования toospecify требуется toobe данных hello промежуточного хранения в хранилище BLOB-объектов перед их загрузкой в целевое хранилище данных. При задании **enableStaging** tooTRUE, необходимо указать hello дополнительные свойства, перечисленные в следующей таблице hello. Если у вас нет, необходимо также toocreate хранилища Azure или хранилища общей службы доступа к связанной подписи для промежуточного хранения.

| Свойство | Описание | Значение по умолчанию | Обязательно |
| --- | --- | --- | --- |
| **enableStaging** |Укажите, следует ли toocopy данных через промежуточный промежуточного хранилища. |Ложь |Нет |
| **linkedServiceName (имя связанной службы)** |Укажите имя hello [AzureStorage](data-factory-azure-blob-connector.md#azure-storage-linked-service) или [AzureStorageSas](data-factory-azure-blob-connector.md#azure-storage-sas-linked-service) связанной службы, который ссылается экземпляр toohello хранилища, использовать как промежуточные промежуточного хранилища. <br/><br/> Хранилища нельзя использовать с данным tooload подпись общего доступа в хранилище данных SQL через PolyBase. Его можно использовать в других случаях. |Недоступно |Да, когда **enableStaging** задано tooTRUE |
| **path** |Укажите hello путь к хранилищу больших двоичных объектов, вы должны toocontain hello промежуточного хранения данных. Если путь не предоставляется, hello служба создает контейнер toostore временных данных. <br/><br/> Укажите путь только в том случае, если использовать хранилище с помощью подписанного URL-адреса, или требуется toobe временные данные в определенном месте. |Недоступно |Нет |
| **enableCompression** |Указывает, должны ли сжиматься данные, прежде чем он станет скопированный toohello назначения. Этот параметр уменьшает hello объем передаваемых данных. |Ложь |Нет |

Ниже приведен пример определения действия копирования со свойствами hello, описанных в предшествующей таблице hello:

```json
"activities":[  
{
    "name": "Sample copy activity",
    "type": "Copy",
    "inputs": [{ "name": "OnpremisesSQLServerInput" }],
    "outputs": [{ "name": "AzureSQLDBOutput" }],
    "typeProperties": {
        "source": {
            "type": "SqlSource",
        },
        "sink": {
            "type": "SqlSink"
        },
        "enableStaging": true,
        "stagingSettings": {
            "linkedServiceName": "MyStagingBlob",
            "path": "stagingcontainer/path",
            "enableCompression": true
        }
    }
}
]
```

### <a name="billing-impact"></a>Принцип выставления счетов
Взимаемая плата зависит от длительности и типа копирования.

* При использовании промежуточных во время копирования облака (копирование данных из хранилища данных облачных данных хранилища tooanother облака), взимается плата hello [сумма длительность копирования на шаге 1 и 2] x [облака копирования цена].
* При использовании промежуточных во время копирования гибридного (копирование данных из локального хранилища tooa облачных данных хранилища данных), назначается цена [длительность копирования гибридного] x [гибридного копирования цена] + [cloud копирования длительность] x [облака копирования цена].

## <a name="performance-tuning-steps"></a>Этапы настройки производительности
Рекомендуется использовать, выполните следующие действия, tootune hello производительность службы фабрики данных с действием копирования.

1. **Определите базовые показатели**. Во время стадии разработки hello теста конвейер с помощью действия копирования к образец репрезентативных данных. Можно использовать hello фабрики данных [Фрагментирование модели](data-factory-scheduling-and-execution.md) toolimit hello объем данных, работать с.

   Сбор данных времени выполнения и характеристики производительности с помощью hello **мониторинг и приложение для управления**. На домашней странице фабрики данных выберите **Monitor & Manage** (Мониторинг и управление). В древовидном представлении hello выберите hello **выходной набор данных**. В hello **действия Windows** выберите hello при выполнении действия копирования. **Действие Windows** перечислены длительность действия копирования hello и размер hello данные, копируемые hello. пропускная способность Hello, перечисленных в **действия окно обозревателя**. toolearn Дополнительные сведения о приложение hello. в разделе [монитора и управление ими конвейеров фабрики данных Azure с помощью hello мониторинг и приложение для управления](data-factory-monitor-manage-app.md).

   ![СВЕДЕНИЯ О ВЫПОЛНЕННОМ ДЕЙСТВИИ](./media/data-factory-copy-activity-performance/mmapp-activity-run-details.png)

   Далее в статье hello, можно сравнить hello производительности и конфигурации для вашего сценария tooCopy действия [Справочник по производительности](#performance-reference) из наших тестов.
2. **Выполните диагностику состояния производительности и оптимизируйте ее.**Если наблюдаемая производительность не соответствует вашим ожиданиям, необходимо определить ее узкие места. Если hello производительности, которые вы заметили не соответствует ожиданиям, вы должны tooidentify узких мест. Затем оптимизировать производительность tooremove или снизить влияние hello узких мест. Полное описание диагностики производительности выходит за рамки данной статьи hello, но ниже приведены некоторые общие рекомендации:

   * Функции для повышения производительности:
     * [Параллельное копирование](#parallel-copy)
     * [Облачные единицы перемещения данных](#cloud-data-movement-units)
     * [Промежуточное копирование](#staged-copy)
     * [Масштабируемость шлюза управления данными](data-factory-data-management-gateway-high-availability-scalability.md)
   * [Шлюз управления данными](#considerations-for-data-management-gateway)
   * [Источник](#considerations-for-the-source)
   * [Приемник](#considerations-for-the-sink)
   * [Сериализация или десериализация](#considerations-for-serialization-and-deserialization)
   * [Сжатие](#considerations-for-compression)
   * [Сопоставление столбцов](#considerations-for-column-mapping)
   * [Дополнительные рекомендации](#other-considerations)
3. **Развернуть весь набор данных hello конфигурации tooyour**. Если вас устраивают результаты выполнения hello и производительности, можно разворачивать определения hello и конвейера активного периода toocover весь набор данных.

## <a name="considerations-for-data-management-gateway"></a>Рекомендации относительно шлюза управления данными
**Установка шлюза**: рекомендуется использовать выделенный компьютер toohost шлюз управления данными. См. [Рекомендации относительно шлюза управления данными](data-factory-data-management-gateway.md#considerations-for-using-gateway).  

**Мониторинг шлюза и вверх/масштабирования**: один логический шлюз с одного или нескольких узлов шлюза может обслуживать несколько действие копирования будет выполняться в hello одновременную одновременно. Снимок практически в режиме реального времени использования ресурсов (ЦП, памяти, network(in/out), т. д.) можно просмотреть на компьютере шлюза, а hello количество одновременно выполняемых заданий, выполняющиеся тесты и ограничение в hello портала Azure см. также [монитор шлюза на портале hello](data-factory-data-management-gateway.md#monitor-gateway-in-the-portal). При наличии большого объема должны на перенос гибридных данных с большим количеством параллельных копирования запуске действия или с большими объемами данных toocopy рассмотрим слишком[вертикальное и горизонтальное масштабирование шлюза](data-factory-data-management-gateway-high-availability-scalability.md#scale-considerations) так, чтобы toobetter использовать ресурс или Скопируйте дополнительные tooempower ресурсов tooprovision. 

## <a name="considerations-for-hello-source"></a>Рекомендации для источника hello
### <a name="general"></a>Общие сведения
Убедитесь, что с других рабочих нагрузок, работающих на или для нее не перегружен, hello базового хранилища данных.

Хранилища данных Microsoft, см. [контроля и настройки разделы](#performance-reference) , которые toodata конкретных хранилищ и помогают понять данных хранения характеристики производительности, снизить время ответа и максимального увеличения пропускной способности.

При копировании данных из tooSQL хранилища больших двоичных объектов хранилища данных, рассмотрите возможность использования **PolyBase** tooboost производительности. В разделе [PolyBase используйте tooload данных в хранилище данных SQL Azure](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse) подробные сведения. Пошаговое руководство и пример использования см. в статье [Загрузка 1 ТБ в хранилище данных SQL Azure с помощью фабрики данных Azure [мастер копирования] менее чем за 15 минут](data-factory-load-sql-data-warehouse.md).

### <a name="file-based-data-stores"></a>Файловые хранилища данных
*(Хранилище BLOB-объектов, Data Lake Store, Amazon S3, локальные файловые системы и локальная файловая система HDFS.)*

* **Средний размер файла и их количество**. Действие копирования передает данные в пофайловом режиме. С помощью того же количества данных toobe перемещен hello hello общую пропускную способность меньше, если hello данных состоит из множества небольших файлов, а не несколько больших файлов, из-за toohello начальной загрузки этапа для каждого файла. Таким образом Если это возможно, объединяйте небольшие файлы в больших файлов toogain более высокую пропускную способность.
* **Формат и сжатие файлов**: производительность tooimprove несколько способов, в разделе hello [рекомендации для сериализации и десериализации](#considerations-for-serialization-and-deserialization) и [рекомендации для сжатия](#considerations-for-compression) разделы.
* Для hello **в локальной файловой системе** сценарий, в котором **шлюз управления данными** — hello обязательно, см. [рекомендации для шлюза управления данными](#considerations-for-data-management-gateway) раздела.

### <a name="relational-data-stores"></a>Реляционные хранилища данных
*(База данных SQL, хранилище данных SQL, Amazon Redshift, базы данных SQL Server, а также базы данных Oracle, MySQL, DB2, Teradata, Sybase и PostgreSQL.)*

* **Шаблон данных.**Схема таблицы влияет на пропускную способность копирования. Большой размер строки обеспечивает лучшую производительность, чем размер небольших строк, toocopy hello того же количества данных. Hello причина-выполнение hello базы данных можно получить более эффективно меньшее число пакетов данных, которые содержат меньше строк.
* **Запрос или хранимую процедуру**: оптимизировать логику hello hello запроса или хранимой процедуры, укажите в источнике toofetch hello действие копирования данных более эффективно.
* Для **локальных реляционных баз данных**, таких как SQL Server и Oracle, который необходимо использовать hello **шлюз управления данными**, разделе hello [рекомендации для шлюза управления данными](#considerations-on-data-management-gateway) раздела.

## <a name="considerations-for-hello-sink"></a>Рекомендации для приемника hello
### <a name="general"></a>Общие сведения
Убедитесь, что с других рабочих нагрузок, работающих на или для нее не перегружен, hello базового хранилища данных.

Хранилища данных Microsoft, см. в разделе слишком[контроля и настройки разделы](#performance-reference) , относятся к определенной toodata магазинов. Эти разделы помогут вам понять характеристики производительности хранилища данных и как время отклика toominimize и максимально увеличить пропускную способность.

При копировании данных из **хранилище больших двоичных объектов** слишком**хранилище данных SQL**, рассмотрите возможность использования **PolyBase** tooboost производительности. В разделе [PolyBase используйте tooload данных в хранилище данных SQL Azure](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse) подробные сведения. Пошаговое руководство и пример использования см. в статье [Загрузка 1 ТБ в хранилище данных SQL Azure с помощью фабрики данных Azure [мастер копирования] менее чем за 15 минут](data-factory-load-sql-data-warehouse.md).

### <a name="file-based-data-stores"></a>Файловые хранилища данных
*(Хранилище BLOB-объектов, Data Lake Store, Amazon S3, локальные файловые системы и локальная файловая система HDFS.)*

* **Скопируйте поведение**: при копировании данных из хранилища различных файловых данных действие копирования имеет три параметра через hello **copyBehavior** свойство. сохранение иерархии, преобразование в плоскую структуру или объединение файлов. Сохраняя или сведение иерархии имеет почти или совсем не снижение производительности, но слияние файлов приводит tooincrease издержек на производительность.
* **Формат и сжатие файлов**: hello см. в разделе [рекомендации для сериализации и десериализации](#considerations-for-serialization-and-deserialization) и [рекомендации для сжатия](#considerations-for-compression) разделы для нескольких способов tooimprove производительности .
* **Хранилище BLOB-объектов.**В настоящее время оптимизация передачи данных и пропускной способности поддерживается только для блочных BLOB-объектов.
* Для **локальных файловых систем** сценарии, требующие использования hello **шлюз управления данными**, разделе hello [рекомендации для шлюза управления данными](#considerations-for-data-management-gateway) раздела.

### <a name="relational-data-stores"></a>Реляционные хранилища данных
*(База данных SQL, хранилище данных SQL, базы данных SQL Server и базы данных Oracle.)*

* **Скопируйте поведение**: в зависимости от свойств hello, заданные для **sqlSink**, действие копирования записывает данные toohello целевой базы данных различными способами.
  * По умолчанию служба перемещения данных hello использует данные tooinsert hello API-интерфейса массового копирования в append режима, предоставляющего hello наилучшей производительности.
  * При настройке хранимой процедуры в приемник hello hello базы данных применяет одну строку hello данных во время, а не как Массовая загрузка. Это существенно снижает производительность. Если набор данных велик, если применимо, необходимо рассмотреть вопрос перехода toousing hello **sqlWriterCleanupScript** свойство.
  * При настройке hello **sqlWriterCleanupScript** запуска свойство для каждого действия копирования, hello службы триггеров hello скрипта и воспользуйтесь tooinsert hello hello API-интерфейса массового копирования данных. Например всю таблицу toooverwrite hello hello последние данные, можно указать toofirst сценария удалить все записи, прежде чем массовой загрузки hello новые данные из источника hello.
* **Шаблон данных и размер пакета**.
  * Схема таблицы влияет на пропускную способность копирования. toocopy Здравствуйте того же количества данных, большой размер строки дает более высокую производительность, чем размер небольших строк hello базы данных можно более эффективно фиксировать меньшее число пакетов данных.
  * Действие копирования вставляет данные в виде последовательности пакетов. Можно задать hello количество строк в пакете с помощью hello **writeBatchSize** свойство. Если данные содержат небольших строк, можно задать hello **writeBatchSize** свойство с более высоким значением toobenefit с низкими издержками пакета и более высокую пропускную способность. Если размер строки hello данных имеет большой размер, будьте внимательны, при увеличении **writeBatchSize**. Высокое значение счетчика может стать причиной сбоя копирования tooa вызвана перегрузка hello базы данных.
* Для **локальных реляционных баз данных** , такие как SQL Server и Oracle, который необходимо использовать hello **шлюз управления данными**, разделе hello [рекомендации для шлюза управления данными](#considerations-for-data-management-gateway) раздела.

### <a name="nosql-stores"></a>Хранилища NoSQL
*(Хранилище таблиц и Azure Cosmos DB.)*

* Для **хранилища таблиц**:
  * **Раздел**: запись toointerleaved секции данных значительно снижает производительность. Сортировку ключ секции исходных данных, чтобы данные hello эффективно вставляются в одну секцию после другого или настроить hello логику toowrite hello tooa одну секцию данных.
* Для **Azure Cosmos DB**:
  * **Размер пакета**: hello **writeBatchSize** свойство задает hello число параллельных запросов службы toocreate toohello Azure Cosmos DB документов. Можно ожидать более высокую производительность при увеличении **writeBatchSize** , так как несколько параллельных запросов отправляются tooAzure Cosmos DB. Тем не менее, наблюдать за регулирования при написании tooAzure Cosmos DB (сообщение об ошибке hello — запроса «скорость большой»). Различных факторов можно вызвать регулирования количества запросов, включая размер документа hello количеством терминов в документах hello и hello политика индексирования целевой коллекции. tooachieve копирования пропускную способность, рассмотрите возможность использования более коллекции, например, S3.

## <a name="considerations-for-serialization-and-deserialization"></a>Рекомендации по сериализации и десериализации
Сериализация и десериализация могут произойти, если входной или выходной набор данных представляет собой файл. Дополнительные сведения о форматах файлов, поддерживаемых действием копирования, см. в статье [Форматы файлов и сжатия данных, поддерживаемые фабрикой данных Azure](data-factory-supported-file-and-compression-formats.md).

**Режим копирования.**

* При копировании файлов между файловыми хранилищами данных:
  * Если входные и выходные наборы данных, которые имеют hello таким же или нет настроек формата файла, служба перемещения данных hello выполняет двоичного копирования, без сериализации и десериализации. Вы увидите выше пропускную способность по сравнению toohello сценарии, в какие hello источника и приемника параметры формата файла отличаются друг от друга.
  * При входных данных, а также выходные данные наборы данных как в текстовом формате и кодирование hello только тип отличается служба перемещения данных hello только выполняет преобразование кодировки. Он не выполняет сериализацию, и десериализации, который вызывает некоторые издержки производительности по сравнению tooa двоичного копирования.
  * Если входные и выходные наборы данных оба имеют разные форматы файлов или различных конфигураций, таких как разделители, hello службы перемещения данных десериализует toostream источника данных, преобразования и выполнить его сериализацию в формат вывода hello, обозначенной. Результатом операции является гораздо большее значение производительности по сравнению tooother сценариев.
* При копировании файлов из хранилища данных не на основе файла (например, из tooa реляционное хранилище файлового хранилища), hello сериализации или десериализации шаг является обязательным. Этот шаг существенно снижает производительность.

**Формат файла**: выберите формат файла hello может повлиять на производительность копирования. К примеру, Avro — это компактный двоичный формат, в котором хранятся метаданные с данными. Он имеет широко поддерживает экосистему hello Hadoop для обработки и выполнения запросов. Тем не менее Avro стоит дороже, для сериализации и десериализации, какие результаты в нижнем копирования пропускной способности по сравнению tootext формат. Выберите нужный вариант формата файла в поток обработки комплексный hello. Начать с hello какие формы данные хранятся в, источник хранилищ данных или toobe, извлеченные из внешних систем; Привет лучший формат для хранения, аналитической обработки и запросов; и в каком формате должны быть экспортированы данные hello в витринах данных для средств создания отчетов и визуализаций. Иногда формат файла, который не является оптимальным для чтения и записи, производительности может быть хорошим выбором, если учесть hello в целом аналитических процесса.

## <a name="considerations-for-compression"></a>Рекомендации по сжатию
Если входной или выходной набор данных — это файл, можно задать действие копирования tooperform упаковку или распаковку как он записывает toohello назначения данных. Использование сжатия — это компромисс между количеством операций ввода-вывода и потреблением ЦП, Сжатие данных hello в дополнительных затрат на вычислительные ресурсы. Однако взамен уменьшается количество сетевых операций ввода-вывода и используемый объем хранилища. В зависимости от данных это может повысить общую пропускную способность копирования.

**Кодек.**Действие копирования поддерживает такие типы сжатия: GZIP, BZIP2 и DEFLATE. Все три типа можно использовать для обработки в Azure HDInsight. Каждый кодек сжатия имеет свои преимущества. Например bzip2 hello наименьшее копирования, пропускной способности, но получить наилучшую производительность запросов Hive hello с bzip2 потому, что данные можно разбить на обработку. Вариант gzip наиболее балансировки hello и используется чаще всего hello. Выберите hello кодека, который лучше всего подходит для вашего сценария начала до конца.

**Уровень.**Для каждого кодека сжатия можно выбрать один из двух параметров — самое быстрое сжатие или оптимальное сжатие. Hello быстрым сжатых параметр сжимает hello данные как можно скорее, даже если hello получившийся файл оптимально не сжимаются. Hello оптимально сжатых параметр проводит больше времени на сжатие и дает минимальный объем данных. Вы можете протестировать toosee обоих параметров, который обеспечивает лучшую общую производительность в случае.

**Следует учитывать**: toocopy большой объем данных к локальному хранилищу и облачных hello, рассмотрите возможность использования хранилища промежуточные больших двоичных объектов с использованием сжатия. С помощью промежуточного хранилища полезно в том случае, если hello пропускной способности сети организации и службами Azure является ограничивающим фактором hello, и нужно hello входной набор данных и выходные данные обоих toobe в несжатом виде. В частности, можно разбить одно действие копирования на два действия: Hello первого копирования действие копирование из промежуточной tooan источника hello или промежуточной большого двоичного объекта в сжатом виде. второе действие копирования Hello hello сжатые данные копируются из промежуточного хранения и извлекает хотя он записывает toohello приемника.

## <a name="considerations-for-column-mapping"></a>Рекомендации по сопоставлению столбцов
Можно задать hello **columnMappings** свойство в действии копирования toomap все или часть hello входные столбцы toohello выходных столбцов. После hello службы перемещения данных считывает hello данные из источника hello, ему tooperform сопоставление столбцов с данными hello до записи приемник toohello данных hello. Эта дополнительная обработка снижает пропускную способность копирования.

Если запрашиваемый хранилище данных источника, например, если это реляционное хранилище, например базы данных SQL или SQL Server, или в том случае, если это хранилище NoSQL, таких как хранилище таблиц или Cosmos базу данных Azure, распределенного запроса передает hello фильтрации столбцов и изменение порядка toohello логику **запроса**  свойство вместо использования сопоставления столбцов. Таким образом, проекции hello происходит во время служба перемещения данных hello читает хранилище данных из источника данных hello, там, где это гораздо более эффективно.

## <a name="other-considerations"></a>Дополнительные рекомендации
Если hello размер данных, toocopy велико, можно настроить бизнес-логики toofurther секции hello данных с помощью hello Фрагментирование механизм в фабрике данных. Затем запланируйте действие копирования toorun чаще запуска размер данных hello tooreduce для каждой операции копирования.

Быть осторожны hello количество наборов данных и копирования действия, требующие toohello tooconnector фабрики данных и те же данные хранить в hello же время. Много параллельных копирования заданий могут регулирования хранилища данных и привести toodegraded производительности, скопируйте задания внутренних повторов, а в некоторых случаях ошибок выполнения.

## <a name="sample-scenario-copy-from-an-on-premises-sql-server-tooblob-storage"></a>Пример: копирование из локального хранилища tooBlob SQL Server
**Сценарий**: конвейера построен данных toocopy из локального хранилища tooBlob SQL Server в формате CSV. toomake быстрее Здравствуйте задание копирования, должны ли сжиматься hello CSV-файлы в формат bzip2.

**Анализ и тестирования**: hello пропускной способности действие копирования — меньше 2 Мбит/с, являющейся гораздо медленнее, чем тест производительности hello.

**Анализ производительности и настройка**: tootroubleshoot Здравствуйте, проблема с производительностью, давайте взглянем на как hello данных обрабатываются и перемещаются.

1. **Чтение данных**: шлюз открывает соединение tooSQL сервера и отправляет hello запроса. SQL Server отвечает, отправляя hello tooGateway потока данных через интрасеть hello.
2. **Сериализации и сжатия данных**: шлюза сериализует формат tooCSV потока данных hello и сжимает hello потока bzip2 tooa данных.
3. **Запись данных**: шлюз отправляет tooBlob hello bzip2 потоковое хранение через Интернет hello.

Как видите, hello данных, обрабатываются и перемещаются в последовательном режиме потоковой передачи: SQL Server > LAN > шлюза > глобальной сети > хранилище больших двоичных объектов. **Hello общую производительность управляются минимальная пропускная способность hello через конвейер hello**.

![Поток данных](./media/data-factory-copy-activity-performance/case-study-pic-1.png)

Один или несколько следующих факторов hello может привести к hello узким местом производительности:

* **Источник.**SQL Server отличается низкой пропускной способностью из-за высокой нагрузки.
* **Шлюз управления данными.**
  * **LAN**: шлюз находится далеко от компьютера SQL Server hello и имеет низкой пропускной способностью.
  * **Шлюз**: шлюза достигло его tooperform hello нагрузки ограничения, следующие операции:
    * **Сериализация**: сериализация tooCSV потока данных hello имеет формат медленно пропускной способности.
    * **Сжатие.**Выбран кодек медленного сжатия (например, BZIP2 со скоростью 2,8 Мбит/с и процессором Core i7).
  * **WAN**: недостаточно hello пропускную способность между корпоративной сетью hello и служб Azure (например, T1 = 1,544 Кбит/с; T2 = 6,312 Кбит/с).
* **Приемник.**Хранилище BLOB-объектов имеет низкую пропускную способность. (Этот сценарий маловероятный, так как соглашение об уровне обслуживания гарантирует не менее 60 Мбит/с.)

В этом случае bzip2 сжатие данных может замедляя hello весь конвейер. Переключение кодек сжатия gzip tooa может облегчить это узкое место.

## <a name="sample-scenarios-use-parallel-copy"></a>Примеры сценариев. Использование параллельного копирования
**Сценарий I:** скопируйте 1000 1 МБ файлы из хранилища tooBlob hello в локальной файловой системы.

**Анализ и настройка производительности**: например, при установке шлюза на двухъядерном компьютере, фабрики данных использует 16 параллельных копии toomove файлы из хранилища tooBlob hello файловой системы одновременно. Это приведет к высокой пропускной способности. Также можно явно указать количество параллельных копий hello. При копировании множества небольших файлов одновременные операции копирования значительно увеличивают пропускную способность за счет более эффективного использования ресурсов.

![Сценарий 1](./media/data-factory-copy-activity-performance/scenario-1.png)

**Сценарий II**: скопируйте 20 больших двоичных объектов 500 МБ из хранилища больших двоичных объектов tooData аналитика хранилища озера, а затем настроить производительность.

**Анализ и настройка производительности**: В этом случае фабрики данных копирует hello данные из хранилища Озера tooData хранилища больших двоичных объектов с помощью одной копии (**parallelCopies** задать too1) и единицы измерения для перемещения данных одного облака. Hello пропускной способности вы заметили будет закрыть toothat, описанные в hello [производительности справочном разделе](#performance-reference).   

![Сценарий 2](./media/data-factory-copy-activity-performance/scenario-2.png)

**Сценарий III.**Размер отдельного файла превышает десятки мегабайтов, и общий объем достаточно велик.

**Анализ и включение производительности**: увеличение **parallelCopies** не обеспечить лучшую производительность для копирования из-за ограничения ресурсов hello объекта с помощью утилиты DMU одного облака. Вместо этого следует указать дополнительные облака DMUs tooget перемещение данных tooperform hello дополнительные ресурсы. Не указать значение для hello **parallelCopies** свойство. Фабрика данных обрабатывает hello параллелизма. В этом случае, если задать **cloudDataMovementUnits** происходит четыре раза too4, пропускную способность, по вашему запросу.

![Сценарий 3](./media/data-factory-copy-activity-performance/scenario-3.png)

## <a name="reference"></a>Справочные материалы
Ниже приведены настройки ссылки для некоторых hello поддерживается хранилищ данных и наблюдения за производительностью.

* Служба хранилища Azure (включая хранилище BLOB-объектов и таблиц): [Целевые показатели масштабируемости и производительности службы хранилища Azure](../storage/common/storage-scalability-targets.md) и [Производительность хранилища Microsoft Azure и контрольный список масштабируемости](../storage/common/storage-performance-checklist.md).
* База данных SQL Azure: Вы можете [наблюдения за производительностью hello](../sql-database/sql-database-single-database-monitor.md) и проверки процентного единицы (DTU) транзакции базы данных hello
* Хранилище данных SQL Azure: его использование измеряется в единицах использования хранилища данных (DWU). См. статью [Управление вычислительными ресурсами в хранилище данных SQL Azure (обзор)](../sql-data-warehouse/sql-data-warehouse-manage-compute-overview.md).
* Azure Cosmos DB: [Прекращение использования уровней производительности S1, S2 и S3 в DocumentDB](../documentdb/documentdb-performance-levels.md).
* Локальный SQL Server: [Мониторинг и настройка производительности](https://msdn.microsoft.com/library/ms189081.aspx)
* Локальный файловый сервер: [Performance tuning for file servers](https://msdn.microsoft.com/library/dn567661.aspx)
