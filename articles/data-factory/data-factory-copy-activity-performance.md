---
title: "Действие aaaCopy производительности и руководство по настройке | Документы Microsoft"
description: "Дополнительные сведения о ключевых факторов, влияющих на производительность hello перемещения данных в фабрике данных Azure, при использовании действия копирования."
services: data-factory
documentationcenter: 
author: linda33wj
manager: jhubbard
editor: monicar
ms.assetid: 4b9a6a4f-8cf5-4e0a-a06f-8133a2b7bc58
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/10/2017
ms.author: jingwang
ms.openlocfilehash: b0fb5a76c34752d07e8ddfffbb799a05fb5d6be6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="copy-activity-performance-and-tuning-guide"></a><span data-ttu-id="3cf97-103">Руководство по настройке производительности действия копирования</span><span class="sxs-lookup"><span data-stu-id="3cf97-103">Copy Activity performance and tuning guide</span></span>
<span data-ttu-id="3cf97-104">Действие копирования фабрики данных Azure — первоклассное безопасное, надежное и высокопроизводительное решение для загрузки данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-104">Azure Data Factory Copy Activity delivers a first-class secure, reliable, and high-performance data loading solution.</span></span> <span data-ttu-id="3cf97-105">Он позволяет toocopy десятков терабайт данных ежедневно между целый ряд облачных и локальных хранилищ данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-105">It enables you toocopy tens of terabytes of data every day across a rich variety of cloud and on-premises data stores.</span></span> <span data-ttu-id="3cf97-106">Производительность загрузки данных практически мгновенное является tooensure ключа, можно сосредоточиться на проблему «больших данных» core hello: построение решениями углубленной аналитики и получение подробные с данными.</span><span class="sxs-lookup"><span data-stu-id="3cf97-106">Blazing-fast data loading performance is key tooensure you can focus on hello core “big data” problem: building advanced analytics solutions and getting deep insights from all that data.</span></span>

<span data-ttu-id="3cf97-107">Azure предоставляет набор корпоративного уровня решения хранилищ данных хранения и обработки данных, и действие копирования предлагает высокой степенью оптимизации данных загрузке легко tooconfigure и настройки.</span><span class="sxs-lookup"><span data-stu-id="3cf97-107">Azure provides a set of enterprise-grade data storage and data warehouse solutions, and Copy Activity offers a highly optimized data loading experience that is easy tooconfigure and set up.</span></span> <span data-ttu-id="3cf97-108">Ниже перечислены возможности отдельного действия копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-108">With just a single copy activity, you can achieve:</span></span>

* <span data-ttu-id="3cf97-109">Загрузка данных в **хранилище данных SQL Azure** со скоростью **1,2 Гбит/с**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-109">Loading data into **Azure SQL Data Warehouse** at **1.2 GBps**.</span></span> <span data-ttu-id="3cf97-110">Пошаговое руководство и пример использования см. в статье [Загрузка 1 ТБ в хранилище данных SQL Azure с помощью фабрики данных Azure [мастер копирования] менее чем за 15 минут](data-factory-load-sql-data-warehouse.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-110">For a walkthrough with a use case, see [Load 1 TB into Azure SQL Data Warehouse under 15 minutes with Azure Data Factory](data-factory-load-sql-data-warehouse.md).</span></span>
* <span data-ttu-id="3cf97-111">Загрузка данных в **хранилище BLOB-объектов Azure** на скорости **1,0 Гбит/с**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-111">Loading data into **Azure Blob storage** at **1.0 GBps**</span></span>
* <span data-ttu-id="3cf97-112">Загрузка данных в **Azure Data Lake Store** на скорости **1,0 Гбит/с**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-112">Loading data into **Azure Data Lake Store** at **1.0 GBps**</span></span>

<span data-ttu-id="3cf97-113">Содержание статьи</span><span class="sxs-lookup"><span data-stu-id="3cf97-113">This article describes:</span></span>

* <span data-ttu-id="3cf97-114">[Показатели производительности ссылка](#performance-reference) для поддерживаемых источника и приемника toohelp данных сохраняет плана проекта.</span><span class="sxs-lookup"><span data-stu-id="3cf97-114">[Performance reference numbers](#performance-reference) for supported source and sink data stores toohelp you plan your project;</span></span>
* <span data-ttu-id="3cf97-115">Функции, которые может значительно повысить Здравствуйте, копируемых в различных сценариях, включая [облако единицы перемещения данных](#cloud-data-movement-units), [параллельных копирования](#parallel-copy), и [промежуточное копирования](#staged-copy);</span><span class="sxs-lookup"><span data-stu-id="3cf97-115">Features that can boost hello copy throughput in different scenarios, including [cloud data movement units](#cloud-data-movement-units), [parallel copy](#parallel-copy), and [staged Copy](#staged-copy);</span></span>
* <span data-ttu-id="3cf97-116">[Руководство по настройке производительности](#performance-tuning-steps) на как tootune hello производительности и hello ключевые факторы, которые могут повлиять на копирование производительности.</span><span class="sxs-lookup"><span data-stu-id="3cf97-116">[Performance tuning guidance](#performance-tuning-steps) on how tootune hello performance and hello key factors that can impact copy performance.</span></span>

> [!NOTE]
> <span data-ttu-id="3cf97-117">Если вам в целом не знакомо действие копирования, перед чтением этой статьи ознакомьтесь со статьей [Перемещение данных с помощью действия копирования](data-factory-data-movement-activities.md) .</span><span class="sxs-lookup"><span data-stu-id="3cf97-117">If you are not familiar with Copy Activity in general, see [Move data by using Copy Activity](data-factory-data-movement-activities.md) before reading this article.</span></span>
>

## <a name="performance-reference"></a><span data-ttu-id="3cf97-118">Базовые показатели производительности</span><span class="sxs-lookup"><span data-stu-id="3cf97-118">Performance reference</span></span>

<span data-ttu-id="3cf97-119">Как ссылка приведенной ниже таблице номер hello копирования пропускную способность в Мбит/с для заданного источника и приемника пары внутреннего тестирования hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-119">As a reference, below table shows hello copy throughput number in MBps for hello given source and sink pairs based on in-house testing.</span></span> <span data-ttu-id="3cf97-120">Для сравнения также демонстрируется, как разные параметры [облачных единиц перемещения данных](#cloud-data-movement-units) или [масштабируемости шлюза управления данными](data-factory-data-management-gateway-high-availability-scalability.md) (несколько узлов шлюза) могут помочь определить производительность копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-120">For comparison, it also demonstrates how different settings of [cloud data movement units](#cloud-data-movement-units) or [Data Management Gateway scalability](data-factory-data-management-gateway-high-availability-scalability.md) (multiple gateway nodes) can help on copy performance.</span></span>

![Матрица производительности](./media/data-factory-copy-activity-performance/CopyPerfRef.png)


<span data-ttu-id="3cf97-122">**Toonote точек:**</span><span class="sxs-lookup"><span data-stu-id="3cf97-122">**Points toonote:**</span></span>
* <span data-ttu-id="3cf97-123">Пропускная способность вычисляется с помощью hello следующую формулу: [размер данных, считанных из источника] / [Действие копирования длительность выполнения].</span><span class="sxs-lookup"><span data-stu-id="3cf97-123">Throughput is calculated by using hello following formula: [size of data read from source]/[Copy Activity run duration].</span></span>
* <span data-ttu-id="3cf97-124">Hello производительности ссылочные номера в таблице hello оценивались с помощью [TPC-H](http://www.tpc.org/tpch/) набора данных при выполнении действия по одной копии.</span><span class="sxs-lookup"><span data-stu-id="3cf97-124">hello performance reference numbers in hello table were measured using [TPC-H](http://www.tpc.org/tpch/) data set in a single copy activity run.</span></span>
* <span data-ttu-id="3cf97-125">В хранилищах данных Azure hello источник и приемник имеют в hello же регионе Azure.</span><span class="sxs-lookup"><span data-stu-id="3cf97-125">In Azure data stores, hello source and sink are in hello same Azure region.</span></span>
* <span data-ttu-id="3cf97-126">Для гибридное копирование между локальными и облачными хранилищами данных, каждый узел шлюза была запущена на компьютере, который был отдельно от hello локальных данных в хранилище ниже спецификации.</span><span class="sxs-lookup"><span data-stu-id="3cf97-126">For hybrid copy between on-premises and cloud data stores, each gateway node was running on a machine that was separate from hello on-premises data store with below specification.</span></span> <span data-ttu-id="3cf97-127">Одно действие выполнялось на шлюзе, операция копирования hello использовать лишь малую часть ЦП, памяти и пропускной способности сети hello тестовый компьютер.</span><span class="sxs-lookup"><span data-stu-id="3cf97-127">When a single activity was running on gateway, hello copy operation consumed only a small portion of hello test machine's CPU, memory, or network bandwidth.</span></span> <span data-ttu-id="3cf97-128">Подробнее см.в разделе [Рекомендации относительно шлюза управления данными](#considerations-for-data-management-gateway).</span><span class="sxs-lookup"><span data-stu-id="3cf97-128">Learn more from [consideration for Data Management Gateway](#considerations-for-data-management-gateway).</span></span>
    <table>
    <tr>
        <td><span data-ttu-id="3cf97-129">ЦП</span><span class="sxs-lookup"><span data-stu-id="3cf97-129">CPU</span></span></td>
        <td><span data-ttu-id="3cf97-130">Intel Xeon E5-2660 v2, 32 ядра с частотой 2,20 ГГц</span><span class="sxs-lookup"><span data-stu-id="3cf97-130">32 cores 2.20 GHz Intel Xeon E5-2660 v2</span></span></td>
    </tr>
    <tr>
        <td><span data-ttu-id="3cf97-131">Память</span><span class="sxs-lookup"><span data-stu-id="3cf97-131">Memory</span></span></td>
        <td><span data-ttu-id="3cf97-132">128 ГБ</span><span class="sxs-lookup"><span data-stu-id="3cf97-132">128 GB</span></span></td>
    </tr>
    <tr>
        <td><span data-ttu-id="3cf97-133">Сеть</span><span class="sxs-lookup"><span data-stu-id="3cf97-133">Network</span></span></td>
        <td><span data-ttu-id="3cf97-134">Веб-интерфейс: 10 Гбит/с; интерфейс интрасети: 40 Гбит/с</span><span class="sxs-lookup"><span data-stu-id="3cf97-134">Internet interface: 10 Gbps; intranet interface: 40 Gbps</span></span></td>
    </tr>
    </table>


> [!TIP]
> <span data-ttu-id="3cf97-135">Можно добиться более высокую пропускную способность за счет использования перемещения единицы дополнительные данные (DMUs) чем hello максимальное DMUs по умолчанию которого — 32 для запуска действия копирования облака в облако.</span><span class="sxs-lookup"><span data-stu-id="3cf97-135">You can achieve higher throughput by leveraging more data movement units (DMUs) than hello default maximum DMUs, which is 32 for a cloud-to-cloud copy activity run.</span></span> <span data-ttu-id="3cf97-136">Например, используя 100 DMU, можно достичь скорости копирования данных из большого двоичного объекта Azure в Azure Data Lake Store до **1 Гбит/с**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-136">For example, with 100 DMUs, you can achieve copying data from Azure Blob into Azure Data Lake Store at **1.0GBps**.</span></span> <span data-ttu-id="3cf97-137">. В разделе hello [облако единицы перемещения данных](#cloud-data-movement-units) раздел для получения сведений об этой функции и hello поддерживается сценария.</span><span class="sxs-lookup"><span data-stu-id="3cf97-137">See hello [Cloud data movement units](#cloud-data-movement-units) section for details about this feature and hello supported scenario.</span></span> <span data-ttu-id="3cf97-138">Обратитесь к [поддержки Azure](https://azure.microsoft.com/support/) toorequest дополнительные DMUs.</span><span class="sxs-lookup"><span data-stu-id="3cf97-138">Contact [Azure support](https://azure.microsoft.com/support/) toorequest more DMUs.</span></span>

## <a name="parallel-copy"></a><span data-ttu-id="3cf97-139">Параллельное копирование</span><span class="sxs-lookup"><span data-stu-id="3cf97-139">Parallel copy</span></span>
<span data-ttu-id="3cf97-140">Можно считывать данные из hello источника или записи данных назначения toohello **параллельно в рамках выполнения операции копирования**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-140">You can read data from hello source or write data toohello destination **in parallel within a Copy Activity run**.</span></span> <span data-ttu-id="3cf97-141">Эта функция повышает пропускную способность hello операции копирования и сокращает время hello toomove данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-141">This feature enhances hello throughput of a copy operation and reduces hello time it takes toomove data.</span></span>

<span data-ttu-id="3cf97-142">Этот параметр отличается от hello **параллелизма** свойство в определении действия hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-142">This setting is different from hello **concurrency** property in hello activity definition.</span></span> <span data-ttu-id="3cf97-143">Hello **параллелизма** свойство определяет количество hello **параллельных операций копирования выполняется** tooprocess данные из другого действия windows (1 AM too2 AM, AM too3 2 часа НОЧИ, я 3 AM too4 и так далее).</span><span class="sxs-lookup"><span data-stu-id="3cf97-143">hello **concurrency** property determines hello number of **concurrent Copy Activity runs** tooprocess data from different activity windows (1 AM too2 AM, 2 AM too3 AM, 3 AM too4 AM, and so on).</span></span> <span data-ttu-id="3cf97-144">Это эффективно в случаях значительной загрузки.</span><span class="sxs-lookup"><span data-stu-id="3cf97-144">This capability is helpful when you perform a historical load.</span></span> <span data-ttu-id="3cf97-145">возможность параллельная копия Hello применяется tooa **единый при выполнении действия**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-145">hello parallel copy capability applies tooa **single activity run**.</span></span>

<span data-ttu-id="3cf97-146">Рассмотрим пример сценария:</span><span class="sxs-lookup"><span data-stu-id="3cf97-146">Let's look at a sample scenario.</span></span> <span data-ttu-id="3cf97-147">В следующем примере hello несколько фрагментов из hello последние должны toobe обработки.</span><span class="sxs-lookup"><span data-stu-id="3cf97-147">In hello following example, multiple slices from hello past need toobe processed.</span></span> <span data-ttu-id="3cf97-148">Фабрика данных запускает экземпляр действия копирования (выполнение действия) для каждого среза.</span><span class="sxs-lookup"><span data-stu-id="3cf97-148">Data Factory runs an instance of Copy Activity (an activity run) for each slice:</span></span>

* <span data-ttu-id="3cf97-149">срез данных Hello из окна первого действия hello (1 AM too2 AM) == > выполняться действие 1</span><span class="sxs-lookup"><span data-stu-id="3cf97-149">hello data slice from hello first activity window (1 AM too2 AM) ==> Activity run 1</span></span>
* <span data-ttu-id="3cf97-150">срез данных Hello из второе окно действие hello (2 часа НОЧИ too3 AM) == > выполняться действие 2</span><span class="sxs-lookup"><span data-stu-id="3cf97-150">hello data slice from hello second activity window (2 AM too3 AM) ==> Activity run 2</span></span>
* <span data-ttu-id="3cf97-151">срез данных Hello из второе окно действие hello (3 часа НОЧИ too4 AM) == > выполняться действие 3</span><span class="sxs-lookup"><span data-stu-id="3cf97-151">hello data slice from hello second activity window (3 AM too4 AM) ==> Activity run 3</span></span>

<span data-ttu-id="3cf97-152">И т. д.</span><span class="sxs-lookup"><span data-stu-id="3cf97-152">And so on.</span></span>

<span data-ttu-id="3cf97-153">В этом примере, когда hello **параллелизма** значение too2, **выполняться действие 1** и **выполняться действие 2** скопировать данные из двух действий windows **параллельно**  производительность перемещения данных tooimprove.</span><span class="sxs-lookup"><span data-stu-id="3cf97-153">In this example, when hello **concurrency** value is set too2, **Activity run 1** and **Activity run 2** copy data from two activity windows **concurrently** tooimprove data movement performance.</span></span> <span data-ttu-id="3cf97-154">Тем не менее если несколько файлов, связанные с 1 при выполнении действия, служба перемещения данных hello копирует файлы из одного файла toohello источника назначения hello одновременно.</span><span class="sxs-lookup"><span data-stu-id="3cf97-154">However, if multiple files are associated with Activity run 1, hello data movement service copies files from hello source toohello destination one file at a time.</span></span>

### <a name="cloud-data-movement-units"></a><span data-ttu-id="3cf97-155">Облачные единицы перемещения данных</span><span class="sxs-lookup"><span data-stu-id="3cf97-155">Cloud data movement units</span></span>
<span data-ttu-id="3cf97-156">Объект **блока перемещения данных облака (помощью утилиты DMU)** — это мера, представляющая масштаб hello (сочетание Процессора, памяти и выделения ресурсов сети) единое целое в фабрике данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-156">A **cloud data movement unit (DMU)** is a measure that represents hello power (a combination of CPU, memory, and network resource allocation) of a single unit in Data Factory.</span></span> <span data-ttu-id="3cf97-157">Эта мера используется для операции копирования из облака в облако, но не для гибридного копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-157">A DMU might be used in a cloud-to-cloud copy operation, but not in a hybrid copy.</span></span>

<span data-ttu-id="3cf97-158">По умолчанию фабрика данных использует tooperform помощью утилиты DMU одной облачной при выполнении одной копии действия.</span><span class="sxs-lookup"><span data-stu-id="3cf97-158">By default, Data Factory uses a single cloud DMU tooperform a single Copy Activity run.</span></span> <span data-ttu-id="3cf97-159">toooverride это значение по умолчанию, укажите значение для hello **cloudDataMovementUnits** свойства следующим образом.</span><span class="sxs-lookup"><span data-stu-id="3cf97-159">toooverride this default, specify a value for hello **cloudDataMovementUnits** property as follows.</span></span> <span data-ttu-id="3cf97-160">Сведения об уровне hello прироста производительности, можно получить при настройке большее число единиц для определенной копии источника и приемника см. в разделе hello [Справочник по производительности](#performance-reference).</span><span class="sxs-lookup"><span data-stu-id="3cf97-160">For information about hello level of performance gain you might get when you configure more units for a specific copy source and sink, see hello [performance reference](#performance-reference).</span></span>

```json
"activities":[  
    {
        "name": "Sample copy activity",
        "description": "",
        "type": "Copy",
        "inputs": [{ "name": "InputDataset" }],
        "outputs": [{ "name": "OutputDataset" }],
        "typeProperties": {
            "source": {
                "type": "BlobSource",
            },
            "sink": {
                "type": "AzureDataLakeStoreSink"
            },
            "cloudDataMovementUnits": 32
        }
    }
]
```
<span data-ttu-id="3cf97-161">Hello **допустимые значения** для hello **cloudDataMovementUnits** свойства являются 1 (по умолчанию), 2, 4, 8, 16, 32.</span><span class="sxs-lookup"><span data-stu-id="3cf97-161">hello **allowed values** for hello **cloudDataMovementUnits** property are 1 (default), 2, 4, 8, 16, 32.</span></span> <span data-ttu-id="3cf97-162">Hello **фактическое число облака DMUs** , операция копирования hello используется во время выполнения будет равно tooor меньше, чем значение hello настроена, в зависимости от шаблона данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-162">hello **actual number of cloud DMUs** that hello copy operation uses at run time is equal tooor less than hello configured value, depending on your data pattern.</span></span>

> [!NOTE]
> <span data-ttu-id="3cf97-163">Если вам требуется больше облачных единиц перемещения данных, чтобы повысить пропускную способность, обратитесь в [службу поддержки Azure](https://azure.microsoft.com/support/).</span><span class="sxs-lookup"><span data-stu-id="3cf97-163">If you need more cloud DMUs for a higher throughput, contact [Azure support](https://azure.microsoft.com/support/).</span></span> <span data-ttu-id="3cf97-164">Установка 8 и более поздней версии в настоящее время работает, только если вы **скопировать несколько файлов из SFTP FTP и облачным S3 и облачным tooBlob больших двоичных объектов хранилища или хранилища Озера данных/Amazon хранилища или хранилища Озера данных и Azure базы данных SQL**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-164">Setting of 8 and above currently works only when you **copy multiple files from Blob storage/Data Lake Store/Amazon S3/cloud FTP/cloud SFTP tooBlob storage/Data Lake Store/Azure SQL Database**.</span></span>
>

### <a name="parallelcopies"></a><span data-ttu-id="3cf97-165">parallelCopies</span><span class="sxs-lookup"><span data-stu-id="3cf97-165">parallelCopies</span></span>
<span data-ttu-id="3cf97-166">Можно использовать hello **parallelCopies** свойство tooindicate hello параллелизма, которые должны toouse действие копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-166">You can use hello **parallelCopies** property tooindicate hello parallelism that you want Copy Activity toouse.</span></span> <span data-ttu-id="3cf97-167">Это свойство можно считать hello максимальное число потоков внутри действия копирования, который может читать из источника или записи хранилищ данных приемник tooyour параллельно.</span><span class="sxs-lookup"><span data-stu-id="3cf97-167">You can think of this property as hello maximum number of threads within Copy Activity that can read from your source or write tooyour sink data stores in parallel.</span></span>

<span data-ttu-id="3cf97-168">Для каждого выполнения действия копирования фабрики данных определяет hello число используемых параллельных копирует toouse toocopy данные из хранилища данных источника hello и toohello целевое хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-168">For each Copy Activity run, Data Factory determines hello number of parallel copies toouse toocopy data from hello source data store and toohello destination data store.</span></span> <span data-ttu-id="3cf97-169">количество параллельных копии, которые она использует по умолчанию Hello зависит от типа hello источника и приемника, который вы используете.</span><span class="sxs-lookup"><span data-stu-id="3cf97-169">hello default number of parallel copies that it uses depends on hello type of source and sink that you are using.</span></span>  

| <span data-ttu-id="3cf97-170">Источник и приемник</span><span class="sxs-lookup"><span data-stu-id="3cf97-170">Source and sink</span></span> | <span data-ttu-id="3cf97-171">Число параллельных копий по умолчанию, определенное службой</span><span class="sxs-lookup"><span data-stu-id="3cf97-171">Default parallel copy count determined by service</span></span> |
| --- | --- |
| <span data-ttu-id="3cf97-172">Копирование данных из одного файлового хранилища данных в другое (хранилище BLOB-объектов, Data Lake Store, Amazon S3, локальная файловая система, локальная файловая система HDFS).</span><span class="sxs-lookup"><span data-stu-id="3cf97-172">Copy data between file-based stores (Blob storage; Data Lake Store; Amazon S3; an on-premises file system; an on-premises HDFS)</span></span> |<span data-ttu-id="3cf97-173">От 1 до 32.</span><span class="sxs-lookup"><span data-stu-id="3cf97-173">Between 1 and 32.</span></span> <span data-ttu-id="3cf97-174">Зависит от размера hello файлов hello и hello число единиц перемещения данных облака (DMUs) используется toocopy данные между двумя хранилищами данных облака или hello физическую конфигурацию hello компьютер шлюза для копирования гибридное (toocopy данных tooor из локального хранилища данных ).</span><span class="sxs-lookup"><span data-stu-id="3cf97-174">Depends on hello size of hello files and hello number of cloud data movement units (DMUs) used toocopy data between two cloud data stores, or hello physical configuration of hello Gateway machine used for a hybrid copy (toocopy data tooor from an on-premises data store).</span></span> |
| <span data-ttu-id="3cf97-175">Скопировать данные из **tooAzure хранилище таблиц хранения любого источника данных**</span><span class="sxs-lookup"><span data-stu-id="3cf97-175">Copy data from **any source data store tooAzure Table storage**</span></span> |<span data-ttu-id="3cf97-176">4.</span><span class="sxs-lookup"><span data-stu-id="3cf97-176">4</span></span> |
| <span data-ttu-id="3cf97-177">Все прочие сочетания источника и приемника</span><span class="sxs-lookup"><span data-stu-id="3cf97-177">All other source and sink pairs</span></span> |<span data-ttu-id="3cf97-178">1</span><span class="sxs-lookup"><span data-stu-id="3cf97-178">1</span></span> |

<span data-ttu-id="3cf97-179">Как правило, поведение по умолчанию hello, последняя будет предоставлять hello лучшей пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="3cf97-179">Usually, hello default behavior should give you hello best throughput.</span></span> <span data-ttu-id="3cf97-180">Однако toocontrol hello загрузки на компьютерах, на которых размещены хранилищ данных или производительность копирования tootune, можно выбрать значение по умолчанию hello toooverride и укажите значение для hello **parallelCopies** свойство.</span><span class="sxs-lookup"><span data-stu-id="3cf97-180">However, toocontrol hello load on machines that host your data stores, or tootune copy performance, you may choose toooverride hello default value and specify a value for hello **parallelCopies** property.</span></span> <span data-ttu-id="3cf97-181">Hello значение должно быть в диапазоне от 1 до 32 (включительно для обоих).</span><span class="sxs-lookup"><span data-stu-id="3cf97-181">hello value must be between 1 and 32 (both inclusive).</span></span> <span data-ttu-id="3cf97-182">Во время выполнения, для повышения производительности рекомендуется hello действие копирования используется значение, которое меньше или равно toohello заданное значение.</span><span class="sxs-lookup"><span data-stu-id="3cf97-182">At run time, for hello best performance, Copy Activity uses a value that is less than or equal toohello value that you set.</span></span>

```json
"activities":[  
    {
        "name": "Sample copy activity",
        "description": "",
        "type": "Copy",
        "inputs": [{ "name": "InputDataset" }],
        "outputs": [{ "name": "OutputDataset" }],
        "typeProperties": {
            "source": {
                "type": "BlobSource",
            },
            "sink": {
                "type": "AzureDataLakeStoreSink"
            },
            "parallelCopies": 8
        }
    }
]
```
<span data-ttu-id="3cf97-183">Toonote точек:</span><span class="sxs-lookup"><span data-stu-id="3cf97-183">Points toonote:</span></span>

* <span data-ttu-id="3cf97-184">При копировании данных между хранилищами на основе файлов, hello **parallelCopies** определить hello параллелизм на уровне файла hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-184">When you copy data between file-based stores, hello **parallelCopies** determine hello parallelism at hello file level.</span></span> <span data-ttu-id="3cf97-185">Фрагментация Hello в одном файле может произойти под автоматически и прозрачно и разработан toouse hello наиболее подходящего размера фрагментов заданного исходного хранилища данных введите в параллельных и ортогональных tooparallelCopies tooload данные.</span><span class="sxs-lookup"><span data-stu-id="3cf97-185">hello chunking within a single file would happen underneath automatically and transparently, and it's designed toouse hello best suitable chunk size for a given source data store type tooload data in parallel and orthogonal tooparallelCopies.</span></span> <span data-ttu-id="3cf97-186">Фактическое число параллельных копий hello перемещения данных службы, используются для операции копирования hello во время выполнения не больше, чем hello количество файлов, которые у вас есть Hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-186">hello actual number of parallel copies hello data movement service uses for hello copy operation at run time is no more than hello number of files you have.</span></span> <span data-ttu-id="3cf97-187">Если режим копирования hello **mergeFile**, действие копирования не могут воспользоваться преимуществами параллелизма на уровне файла.</span><span class="sxs-lookup"><span data-stu-id="3cf97-187">If hello copy behavior is **mergeFile**, Copy Activity cannot take advantage of file-level parallelism.</span></span>
* <span data-ttu-id="3cf97-188">Если указать значение для hello **parallelCopies** свойство, рассмотрите возможность hello увеличение нагрузки на источника и приемника хранилища данных и toogateway, если это гибридное копирование.</span><span class="sxs-lookup"><span data-stu-id="3cf97-188">When you specify a value for hello **parallelCopies** property, consider hello load increase on your source and sink data stores, and toogateway if it is a hybrid copy.</span></span> <span data-ttu-id="3cf97-189">Это происходит, особенно если у вас есть несколько действий или параллельных запусках hello те же действия, выполняемые для hello одно хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-189">This happens especially when you have multiple activities or concurrent runs of hello same activities that run against hello same data store.</span></span> <span data-ttu-id="3cf97-190">Если хранилище данных hello или шлюз перегружен с нагрузкой hello, уменьшить hello **parallelCopies** значение toorelieve hello нагрузки.</span><span class="sxs-lookup"><span data-stu-id="3cf97-190">If you notice that either hello data store or Gateway is overwhelmed with hello load, decrease hello **parallelCopies** value toorelieve hello load.</span></span>
* <span data-ttu-id="3cf97-191">При копировании данных из хранилищ, которые не являются файловых toostores, основаны на файлах, служба перемещения данных hello игнорирует hello **parallelCopies** свойство.</span><span class="sxs-lookup"><span data-stu-id="3cf97-191">When you copy data from stores that are not file-based toostores that are file-based, hello data movement service ignores hello **parallelCopies** property.</span></span> <span data-ttu-id="3cf97-192">В этом случае параллелизм не применяется, даже если задан соответствующий параметр.</span><span class="sxs-lookup"><span data-stu-id="3cf97-192">Even if parallelism is specified, it's not applied in this case.</span></span>

> [!NOTE]
> <span data-ttu-id="3cf97-193">Необходимо использовать hello toouse 1.11 или более поздней версии шлюза управления данными **parallelCopies** компонентов, при этом гибридное копирование.</span><span class="sxs-lookup"><span data-stu-id="3cf97-193">You must use Data Management Gateway version 1.11 or later toouse hello **parallelCopies** feature when you do a hybrid copy.</span></span>
>
>

<span data-ttu-id="3cf97-194">toobetter эти два свойства и использовать tooenhance пропускная способность перемещения данных см. в разделе hello [образцы вариантов использования](#case-study-use-parallel-copy).</span><span class="sxs-lookup"><span data-stu-id="3cf97-194">toobetter use these two properties, and tooenhance your data movement throughput, see hello [sample use cases](#case-study-use-parallel-copy).</span></span> <span data-ttu-id="3cf97-195">Не требуется tooconfigure **parallelCopies** tootake преимуществами поведение по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-195">You don't need tooconfigure **parallelCopies** tootake advantage of hello default behavior.</span></span> <span data-ttu-id="3cf97-196">Если вы зададите для свойства **parallelCopies** невысокое значение, несколько облачных единиц перемещения данных не будут использоваться полностью.</span><span class="sxs-lookup"><span data-stu-id="3cf97-196">If you do configure and **parallelCopies** is too small, multiple cloud DMUs might not be fully utilized.</span></span>  

### <a name="billing-impact"></a><span data-ttu-id="3cf97-197">Принцип выставления счетов</span><span class="sxs-lookup"><span data-stu-id="3cf97-197">Billing impact</span></span>
<span data-ttu-id="3cf97-198">Он имеет **важные** tooremember, назначается цена на основании hello общее время операции копирования hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-198">It's **important** tooremember that you are charged based on hello total time of hello copy operation.</span></span> <span data-ttu-id="3cf97-199">Если задание копирования используется один час tootake с единицей одно облако, а теперь занимает 15 минут с единицами четыре облака, hello общей спецификации остается практически hello таким же.</span><span class="sxs-lookup"><span data-stu-id="3cf97-199">If a copy job used tootake one hour with one cloud unit and now it takes 15 minutes with four cloud units, hello overall bill remains almost hello same.</span></span> <span data-ttu-id="3cf97-200">Допустим, используются четыре облачные единицы.</span><span class="sxs-lookup"><span data-stu-id="3cf97-200">For example, you use four cloud units.</span></span> <span data-ttu-id="3cf97-201">Hello первого устройства облака тратит 10 минут, hello второй, 10 минут hello третий за 5 минут и hello четвертую 5 минут, в один при выполнении действия копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-201">hello first cloud unit spends 10 minutes, hello second one, 10 minutes, hello third one, 5 minutes, and hello fourth one, 5 minutes, all in one Copy Activity run.</span></span> <span data-ttu-id="3cf97-202">Взимается плата для hello общее копии (перемещение данных) времени, которое составляет 10 + 10 + 5 + 5 = 30 минут.</span><span class="sxs-lookup"><span data-stu-id="3cf97-202">You are charged for hello total copy (data movement) time, which is 10 + 10 + 5 + 5 = 30 minutes.</span></span> <span data-ttu-id="3cf97-203">Использование свойства **parallelCopies** не влияет на выставление счетов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-203">Using **parallelCopies** does not affect billing.</span></span>

## <a name="staged-copy"></a><span data-ttu-id="3cf97-204">промежуточное копирование</span><span class="sxs-lookup"><span data-stu-id="3cf97-204">Staged copy</span></span>
<span data-ttu-id="3cf97-205">При копировании данных из хранилища данных источника данных хранилища tooa приемник, вы можете toouse хранилища BLOB-объектов как промежуточные промежуточного хранилища.</span><span class="sxs-lookup"><span data-stu-id="3cf97-205">When you copy data from a source data store tooa sink data store, you might choose toouse Blob storage as an interim staging store.</span></span> <span data-ttu-id="3cf97-206">Промежуточная особенно полезна в следующих случаях hello:</span><span class="sxs-lookup"><span data-stu-id="3cf97-206">Staging is especially useful in hello following cases:</span></span>

1. <span data-ttu-id="3cf97-207">**Вы хотите tooingest данные из различных хранилищ данных в хранилище данных SQL через PolyBase**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-207">**You want tooingest data from various data stores into SQL Data Warehouse via PolyBase**.</span></span> <span data-ttu-id="3cf97-208">Хранилище данных SQL использует PolyBase в качестве механизма высокой пропускной способностью tooload большой объем данных в хранилище данных SQL.</span><span class="sxs-lookup"><span data-stu-id="3cf97-208">SQL Data Warehouse uses PolyBase as a high-throughput mechanism tooload a large amount of data into SQL Data Warehouse.</span></span> <span data-ttu-id="3cf97-209">Однако hello источник данных должен быть в хранилище больших двоичных объектов, и он должен соответствовать дополнительные критерии.</span><span class="sxs-lookup"><span data-stu-id="3cf97-209">However, hello source data must be in Blob storage, and it must meet additional criteria.</span></span> <span data-ttu-id="3cf97-210">При загрузке данных не из хранилища BLOB-объектов можно активировать копирование через промежуточное хранилище BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-210">When you load data from a data store other than Blob storage, you can activate data copying via interim staging Blob storage.</span></span> <span data-ttu-id="3cf97-211">В этом случае фабрики данных выполняет преобразования tooensure hello необходимых данных, соответствие требованиям hello объекта PolyBase.</span><span class="sxs-lookup"><span data-stu-id="3cf97-211">In that case, Data Factory performs hello required data transformations tooensure that it meets hello requirements of PolyBase.</span></span> <span data-ttu-id="3cf97-212">Затем он выполняет PolyBase tooload данных в хранилище данных SQL.</span><span class="sxs-lookup"><span data-stu-id="3cf97-212">Then it uses PolyBase tooload data into SQL Data Warehouse.</span></span> <span data-ttu-id="3cf97-213">Дополнительные сведения см. в разделе [PolyBase используйте tooload данных в хранилище данных SQL Azure](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse).</span><span class="sxs-lookup"><span data-stu-id="3cf97-213">For more details, see [Use PolyBase tooload data into Azure SQL Data Warehouse](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse).</span></span> <span data-ttu-id="3cf97-214">Пошаговое руководство и пример использования см. в статье [Загрузка 1 ТБ в хранилище данных SQL Azure с помощью фабрики данных Azure [мастер копирования] менее чем за 15 минут](data-factory-load-sql-data-warehouse.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-214">For a walkthrough with a use case, see [Load 1 TB into Azure SQL Data Warehouse under 15 minutes with Azure Data Factory](data-factory-load-sql-data-warehouse.md).</span></span>
2. <span data-ttu-id="3cf97-215">**Иногда это занимает немного времени tooperform перенос гибридных данных (то есть toocopy между к локальному хранилищу данных и хранилищем данных облака) через медленное сетевое подключение**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-215">**Sometimes it takes a while tooperform a hybrid data movement (that is, toocopy between an on-premises data store and a cloud data store) over a slow network connection**.</span></span> <span data-ttu-id="3cf97-216">tooimprove производительности, можно сжать hello локальные данные, чтобы он меньше времени хранения toomove toohello промежуточных данных в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-216">tooimprove performance, you can compress hello data on-premises so that it takes less time toomove data toohello staging data store in hello cloud.</span></span> <span data-ttu-id="3cf97-217">Затем можно распаковать данные hello в hello промежуточного хранилища перед их загрузкой в хранилище данных назначения hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-217">Then you can decompress hello data in hello staging store before you load it into hello destination data store.</span></span>
3. <span data-ttu-id="3cf97-218">**Вы не хотите tooopen порты, отличный от порта 80 и порт 443 в брандмауэре, из-за корпоративным ИТ-политикам**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-218">**You don't want tooopen ports other than port 80 and port 443 in your firewall, because of corporate IT policies**.</span></span> <span data-ttu-id="3cf97-219">Например при копировании данных из приемник локальной tooan хранилище данных базы данных SQL Azure или приемника хранилища данных SQL Azure, необходимо tooactivate исходящие соединения TCP через порт 1433 для брандмауэра Windows hello и корпоративного брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="3cf97-219">For example, when you copy data from an on-premises data store tooan Azure SQL Database sink or an Azure SQL Data Warehouse sink, you need tooactivate outbound TCP communication on port 1433 for both hello Windows firewall and your corporate firewall.</span></span> <span data-ttu-id="3cf97-220">В этом сценарии воспользоваться преимуществами hello toofirst копирования данных tooa большой двоичный объект хранения промежуточного экземпляр шлюза, через HTTP или HTTPS через порт 443.</span><span class="sxs-lookup"><span data-stu-id="3cf97-220">In this scenario, take advantage of hello gateway toofirst copy data tooa Blob storage staging instance over HTTP or HTTPS on port 443.</span></span> <span data-ttu-id="3cf97-221">Затем нужно Загрузите данные hello в базе данных SQL или хранилище данных SQL из промежуточного хранения больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-221">Then, load hello data into SQL Database or SQL Data Warehouse from Blob storage staging.</span></span> <span data-ttu-id="3cf97-222">В этом потоке не требуется tooenable порт 1433.</span><span class="sxs-lookup"><span data-stu-id="3cf97-222">In this flow, you don't need tooenable port 1433.</span></span>

### <a name="how-staged-copy-works"></a><span data-ttu-id="3cf97-223">Принцип промежуточного копирования</span><span class="sxs-lookup"><span data-stu-id="3cf97-223">How staged copy works</span></span>
<span data-ttu-id="3cf97-224">При активации hello промежуточных компонентов первый hello данные копируются из промежуточного хранения хранилища данных хранилища toohello hello источника данных (Используйте собственный).</span><span class="sxs-lookup"><span data-stu-id="3cf97-224">When you activate hello staging feature, first hello data is copied from hello source data store toohello staging data store (bring your own).</span></span> <span data-ttu-id="3cf97-225">Далее hello данные копируются из hello промежуточного хранения хранилища данных приемник toohello хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-225">Next, hello data is copied from hello staging data store toohello sink data store.</span></span> <span data-ttu-id="3cf97-226">Фабрика данных автоматически управляет поток двухэтапное hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-226">Data Factory automatically manages hello two-stage flow for you.</span></span> <span data-ttu-id="3cf97-227">Фабрика данных также удаляет временные данные из промежуточного хранения, после завершения перемещения данных hello hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-227">Data Factory also cleans up temporary data from hello staging storage after hello data movement is complete.</span></span>

<span data-ttu-id="3cf97-228">В случае копирования hello облака (источник и приемник данных хранилища — в облаке hello) шлюз не используется.</span><span class="sxs-lookup"><span data-stu-id="3cf97-228">In hello cloud copy scenario (both source and sink data stores are in hello cloud), gateway is not used.</span></span> <span data-ttu-id="3cf97-229">Hello служба фабрики данных выполняет операции копирования hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-229">hello Data Factory service performs hello copy operations.</span></span>

![Промежуточное копирование: облачный сценарий](media/data-factory-copy-activity-performance/staged-copy-cloud-scenario.png)

<span data-ttu-id="3cf97-231">В случае копирования гибридного hello (источник — локальные и приемник находящийся в облаке hello) шлюза hello перемещает данные из источника данных hello хранения tooa промежуточного хранения хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-231">In hello hybrid copy scenario (source is on-premises and sink is in hello cloud), hello gateway moves data from hello source data store tooa staging data store.</span></span> <span data-ttu-id="3cf97-232">Служба фабрики данных перемещает данные из промежуточных данных hello хранилище toohello приемник данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-232">Data Factory service moves data from hello staging data store toohello sink data store.</span></span> <span data-ttu-id="3cf97-233">Копирование данных из хранилища tooan облачных данных локального хранилища данных через промежуточное хранение также поддерживается с потоком hello в обратном направлении.</span><span class="sxs-lookup"><span data-stu-id="3cf97-233">Copying data from a cloud data store tooan on-premises data store via staging also is supported with hello reversed flow.</span></span>

![Промежуточное копирование: гибридный сценарий](media/data-factory-copy-activity-performance/staged-copy-hybrid-scenario.png)

<span data-ttu-id="3cf97-235">При активации перемещения данных с использованием промежуточного хранилища, можно указать, следует ли toobe данных hello, сжимаются перед перемещением данных из источника hello хранилище tooan промежуточной или промежуточного хранения хранилища данных и затем распаковать перед перемещением данных из промежуточной или промежуточного хранилища toohello приемник данных хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-235">When you activate data movement by using a staging store, you can specify whether you want hello data toobe compressed before moving data from hello source data store tooan interim or staging data store, and then decompressed before moving data from an interim or staging data store toohello sink data store.</span></span>

<span data-ttu-id="3cf97-236">Сейчас промежуточное хранение при копировании данных между двумя локальными хранилищами не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="3cf97-236">Currently, you can't copy data between two on-premises data stores by using a staging store.</span></span> <span data-ttu-id="3cf97-237">Скоро ожидается toobe этот параметр доступен.</span><span class="sxs-lookup"><span data-stu-id="3cf97-237">We expect this option toobe available soon.</span></span>

### <a name="configuration"></a><span data-ttu-id="3cf97-238">Конфигурация</span><span class="sxs-lookup"><span data-stu-id="3cf97-238">Configuration</span></span>
<span data-ttu-id="3cf97-239">Настройка hello **enableStaging** параметр в действии копирования toospecify требуется toobe данных hello промежуточного хранения в хранилище BLOB-объектов перед их загрузкой в целевое хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-239">Configure hello **enableStaging** setting in Copy Activity toospecify whether you want hello data toobe staged in Blob storage before you load it into a destination data store.</span></span> <span data-ttu-id="3cf97-240">При задании **enableStaging** tooTRUE, необходимо указать hello дополнительные свойства, перечисленные в следующей таблице hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-240">When you set **enableStaging** tooTRUE, specify hello additional properties listed in hello next table.</span></span> <span data-ttu-id="3cf97-241">Если у вас нет, необходимо также toocreate хранилища Azure или хранилища общей службы доступа к связанной подписи для промежуточного хранения.</span><span class="sxs-lookup"><span data-stu-id="3cf97-241">If you don’t have one, you also need toocreate an Azure Storage or Storage shared access signature-linked service for staging.</span></span>

| <span data-ttu-id="3cf97-242">Свойство</span><span class="sxs-lookup"><span data-stu-id="3cf97-242">Property</span></span> | <span data-ttu-id="3cf97-243">Описание</span><span class="sxs-lookup"><span data-stu-id="3cf97-243">Description</span></span> | <span data-ttu-id="3cf97-244">Значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="3cf97-244">Default value</span></span> | <span data-ttu-id="3cf97-245">Обязательно</span><span class="sxs-lookup"><span data-stu-id="3cf97-245">Required</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="3cf97-246">**enableStaging**</span><span class="sxs-lookup"><span data-stu-id="3cf97-246">**enableStaging**</span></span> |<span data-ttu-id="3cf97-247">Укажите, следует ли toocopy данных через промежуточный промежуточного хранилища.</span><span class="sxs-lookup"><span data-stu-id="3cf97-247">Specify whether you want toocopy data via an interim staging store.</span></span> |<span data-ttu-id="3cf97-248">Ложь</span><span class="sxs-lookup"><span data-stu-id="3cf97-248">False</span></span> |<span data-ttu-id="3cf97-249">Нет</span><span class="sxs-lookup"><span data-stu-id="3cf97-249">No</span></span> |
| <span data-ttu-id="3cf97-250">**linkedServiceName (имя связанной службы)**</span><span class="sxs-lookup"><span data-stu-id="3cf97-250">**linkedServiceName**</span></span> |<span data-ttu-id="3cf97-251">Укажите имя hello [AzureStorage](data-factory-azure-blob-connector.md#azure-storage-linked-service) или [AzureStorageSas](data-factory-azure-blob-connector.md#azure-storage-sas-linked-service) связанной службы, который ссылается экземпляр toohello хранилища, использовать как промежуточные промежуточного хранилища.</span><span class="sxs-lookup"><span data-stu-id="3cf97-251">Specify hello name of an [AzureStorage](data-factory-azure-blob-connector.md#azure-storage-linked-service) or [AzureStorageSas](data-factory-azure-blob-connector.md#azure-storage-sas-linked-service) linked service, which refers toohello instance of Storage that you use as an interim staging store.</span></span> <br/><br/> <span data-ttu-id="3cf97-252">Хранилища нельзя использовать с данным tooload подпись общего доступа в хранилище данных SQL через PolyBase.</span><span class="sxs-lookup"><span data-stu-id="3cf97-252">You cannot use Storage with a shared access signature tooload data into SQL Data Warehouse via PolyBase.</span></span> <span data-ttu-id="3cf97-253">Его можно использовать в других случаях.</span><span class="sxs-lookup"><span data-stu-id="3cf97-253">You can use it in all other scenarios.</span></span> |<span data-ttu-id="3cf97-254">Недоступно</span><span class="sxs-lookup"><span data-stu-id="3cf97-254">N/A</span></span> |<span data-ttu-id="3cf97-255">Да, когда **enableStaging** задано tooTRUE</span><span class="sxs-lookup"><span data-stu-id="3cf97-255">Yes, when **enableStaging** is set tooTRUE</span></span> |
| <span data-ttu-id="3cf97-256">**path**</span><span class="sxs-lookup"><span data-stu-id="3cf97-256">**path**</span></span> |<span data-ttu-id="3cf97-257">Укажите hello путь к хранилищу больших двоичных объектов, вы должны toocontain hello промежуточного хранения данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-257">Specify hello Blob storage path that you want toocontain hello staged data.</span></span> <span data-ttu-id="3cf97-258">Если путь не предоставляется, hello служба создает контейнер toostore временных данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-258">If you do not provide a path, hello service creates a container toostore temporary data.</span></span> <br/><br/> <span data-ttu-id="3cf97-259">Укажите путь только в том случае, если использовать хранилище с помощью подписанного URL-адреса, или требуется toobe временные данные в определенном месте.</span><span class="sxs-lookup"><span data-stu-id="3cf97-259">Specify a path only if you use Storage with a shared access signature, or you require temporary data toobe in a specific location.</span></span> |<span data-ttu-id="3cf97-260">Недоступно</span><span class="sxs-lookup"><span data-stu-id="3cf97-260">N/A</span></span> |<span data-ttu-id="3cf97-261">Нет</span><span class="sxs-lookup"><span data-stu-id="3cf97-261">No</span></span> |
| <span data-ttu-id="3cf97-262">**enableCompression**</span><span class="sxs-lookup"><span data-stu-id="3cf97-262">**enableCompression**</span></span> |<span data-ttu-id="3cf97-263">Указывает, должны ли сжиматься данные, прежде чем он станет скопированный toohello назначения.</span><span class="sxs-lookup"><span data-stu-id="3cf97-263">Specifies whether data should be compressed before it is copied toohello destination.</span></span> <span data-ttu-id="3cf97-264">Этот параметр уменьшает hello объем передаваемых данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-264">This setting reduces hello volume of data being transferred.</span></span> |<span data-ttu-id="3cf97-265">Ложь</span><span class="sxs-lookup"><span data-stu-id="3cf97-265">False</span></span> |<span data-ttu-id="3cf97-266">Нет</span><span class="sxs-lookup"><span data-stu-id="3cf97-266">No</span></span> |

<span data-ttu-id="3cf97-267">Ниже приведен пример определения действия копирования со свойствами hello, описанных в предшествующей таблице hello:</span><span class="sxs-lookup"><span data-stu-id="3cf97-267">Here's a sample definition of Copy Activity with hello properties that are described in hello preceding table:</span></span>

```json
"activities":[  
{
    "name": "Sample copy activity",
    "type": "Copy",
    "inputs": [{ "name": "OnpremisesSQLServerInput" }],
    "outputs": [{ "name": "AzureSQLDBOutput" }],
    "typeProperties": {
        "source": {
            "type": "SqlSource",
        },
        "sink": {
            "type": "SqlSink"
        },
        "enableStaging": true,
        "stagingSettings": {
            "linkedServiceName": "MyStagingBlob",
            "path": "stagingcontainer/path",
            "enableCompression": true
        }
    }
}
]
```

### <a name="billing-impact"></a><span data-ttu-id="3cf97-268">Принцип выставления счетов</span><span class="sxs-lookup"><span data-stu-id="3cf97-268">Billing impact</span></span>
<span data-ttu-id="3cf97-269">Взимаемая плата зависит от длительности и типа копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-269">You are charged based on two steps: copy duration and copy type.</span></span>

* <span data-ttu-id="3cf97-270">При использовании промежуточных во время копирования облака (копирование данных из хранилища данных облачных данных хранилища tooanother облака), взимается плата hello [сумма длительность копирования на шаге 1 и 2] x [облака копирования цена].</span><span class="sxs-lookup"><span data-stu-id="3cf97-270">When you use staging during a cloud copy (copying data from a cloud data store tooanother cloud data store), you are charged hello [sum of copy duration for step 1 and step 2] x [cloud copy unit price].</span></span>
* <span data-ttu-id="3cf97-271">При использовании промежуточных во время копирования гибридного (копирование данных из локального хранилища tooa облачных данных хранилища данных), назначается цена [длительность копирования гибридного] x [гибридного копирования цена] + [cloud копирования длительность] x [облака копирования цена].</span><span class="sxs-lookup"><span data-stu-id="3cf97-271">When you use staging during a hybrid copy (copying data from an on-premises data store tooa cloud data store), you are charged for [hybrid copy duration] x [hybrid copy unit price] + [cloud copy duration] x [cloud copy unit price].</span></span>

## <a name="performance-tuning-steps"></a><span data-ttu-id="3cf97-272">Этапы настройки производительности</span><span class="sxs-lookup"><span data-stu-id="3cf97-272">Performance tuning steps</span></span>
<span data-ttu-id="3cf97-273">Рекомендуется использовать, выполните следующие действия, tootune hello производительность службы фабрики данных с действием копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-273">We suggest that you take these steps tootune hello performance of your Data Factory service with Copy Activity:</span></span>

1. <span data-ttu-id="3cf97-274">**Определите базовые показатели**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-274">**Establish a baseline**.</span></span> <span data-ttu-id="3cf97-275">Во время стадии разработки hello теста конвейер с помощью действия копирования к образец репрезентативных данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-275">During hello development phase, test your pipeline by using Copy Activity against a representative data sample.</span></span> <span data-ttu-id="3cf97-276">Можно использовать hello фабрики данных [Фрагментирование модели](data-factory-scheduling-and-execution.md) toolimit hello объем данных, работать с.</span><span class="sxs-lookup"><span data-stu-id="3cf97-276">You can use hello Data Factory [slicing model](data-factory-scheduling-and-execution.md) toolimit hello amount of data you work with.</span></span>

   <span data-ttu-id="3cf97-277">Сбор данных времени выполнения и характеристики производительности с помощью hello **мониторинг и приложение для управления**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-277">Collect execution time and performance characteristics by using hello **Monitoring and Management App**.</span></span> <span data-ttu-id="3cf97-278">На домашней странице фабрики данных выберите **Monitor & Manage** (Мониторинг и управление).</span><span class="sxs-lookup"><span data-stu-id="3cf97-278">Choose **Monitor & Manage** on your Data Factory home page.</span></span> <span data-ttu-id="3cf97-279">В древовидном представлении hello выберите hello **выходной набор данных**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-279">In hello tree view, choose hello **output dataset**.</span></span> <span data-ttu-id="3cf97-280">В hello **действия Windows** выберите hello при выполнении действия копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-280">In hello **Activity Windows** list, choose hello Copy Activity run.</span></span> <span data-ttu-id="3cf97-281">**Действие Windows** перечислены длительность действия копирования hello и размер hello данные, копируемые hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-281">**Activity Windows** lists hello Copy Activity duration and hello size of hello data that's copied.</span></span> <span data-ttu-id="3cf97-282">пропускная способность Hello, перечисленных в **действия окно обозревателя**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-282">hello throughput is listed in **Activity Window Explorer**.</span></span> <span data-ttu-id="3cf97-283">toolearn Дополнительные сведения о приложение hello. в разделе [монитора и управление ими конвейеров фабрики данных Azure с помощью hello мониторинг и приложение для управления](data-factory-monitor-manage-app.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-283">toolearn more about hello app, see [Monitor and manage Azure Data Factory pipelines by using hello Monitoring and Management App](data-factory-monitor-manage-app.md).</span></span>

   ![СВЕДЕНИЯ О ВЫПОЛНЕННОМ ДЕЙСТВИИ](./media/data-factory-copy-activity-performance/mmapp-activity-run-details.png)

   <span data-ttu-id="3cf97-285">Далее в статье hello, можно сравнить hello производительности и конфигурации для вашего сценария tooCopy действия [Справочник по производительности](#performance-reference) из наших тестов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-285">Later in hello article, you can compare hello performance and configuration of your scenario tooCopy Activity’s [performance reference](#performance-reference) from our tests.</span></span>
2. <span data-ttu-id="3cf97-286">**Выполните диагностику состояния производительности и оптимизируйте ее.**Если наблюдаемая производительность не соответствует вашим ожиданиям, необходимо определить ее узкие места.</span><span class="sxs-lookup"><span data-stu-id="3cf97-286">**Diagnose and optimize performance**.</span></span> <span data-ttu-id="3cf97-287">Если hello производительности, которые вы заметили не соответствует ожиданиям, вы должны tooidentify узких мест.</span><span class="sxs-lookup"><span data-stu-id="3cf97-287">If hello performance you observe doesn't meet your expectations, you need tooidentify performance bottlenecks.</span></span> <span data-ttu-id="3cf97-288">Затем оптимизировать производительность tooremove или снизить влияние hello узких мест.</span><span class="sxs-lookup"><span data-stu-id="3cf97-288">Then, optimize performance tooremove or reduce hello effect of bottlenecks.</span></span> <span data-ttu-id="3cf97-289">Полное описание диагностики производительности выходит за рамки данной статьи hello, но ниже приведены некоторые общие рекомендации:</span><span class="sxs-lookup"><span data-stu-id="3cf97-289">A full description of performance diagnosis is beyond hello scope of this article, but here are some common considerations:</span></span>

   * <span data-ttu-id="3cf97-290">Функции для повышения производительности:</span><span class="sxs-lookup"><span data-stu-id="3cf97-290">Performance features:</span></span>
     * [<span data-ttu-id="3cf97-291">Параллельное копирование</span><span class="sxs-lookup"><span data-stu-id="3cf97-291">Parallel copy</span></span>](#parallel-copy)
     * [<span data-ttu-id="3cf97-292">Облачные единицы перемещения данных</span><span class="sxs-lookup"><span data-stu-id="3cf97-292">Cloud data movement units</span></span>](#cloud-data-movement-units)
     * [<span data-ttu-id="3cf97-293">Промежуточное копирование</span><span class="sxs-lookup"><span data-stu-id="3cf97-293">Staged copy</span></span>](#staged-copy)
     * [<span data-ttu-id="3cf97-294">Масштабируемость шлюза управления данными</span><span class="sxs-lookup"><span data-stu-id="3cf97-294">Data Management Gateway scalability</span></span>](data-factory-data-management-gateway-high-availability-scalability.md)
   * [<span data-ttu-id="3cf97-295">Шлюз управления данными</span><span class="sxs-lookup"><span data-stu-id="3cf97-295">Data Management Gateway</span></span>](#considerations-for-data-management-gateway)
   * [<span data-ttu-id="3cf97-296">Источник</span><span class="sxs-lookup"><span data-stu-id="3cf97-296">Source</span></span>](#considerations-for-the-source)
   * [<span data-ttu-id="3cf97-297">Приемник</span><span class="sxs-lookup"><span data-stu-id="3cf97-297">Sink</span></span>](#considerations-for-the-sink)
   * [<span data-ttu-id="3cf97-298">Сериализация или десериализация</span><span class="sxs-lookup"><span data-stu-id="3cf97-298">Serialization and deserialization</span></span>](#considerations-for-serialization-and-deserialization)
   * [<span data-ttu-id="3cf97-299">Сжатие</span><span class="sxs-lookup"><span data-stu-id="3cf97-299">Compression</span></span>](#considerations-for-compression)
   * [<span data-ttu-id="3cf97-300">Сопоставление столбцов</span><span class="sxs-lookup"><span data-stu-id="3cf97-300">Column mapping</span></span>](#considerations-for-column-mapping)
   * [<span data-ttu-id="3cf97-301">Дополнительные рекомендации</span><span class="sxs-lookup"><span data-stu-id="3cf97-301">Other considerations</span></span>](#other-considerations)
3. <span data-ttu-id="3cf97-302">**Развернуть весь набор данных hello конфигурации tooyour**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-302">**Expand hello configuration tooyour entire data set**.</span></span> <span data-ttu-id="3cf97-303">Если вас устраивают результаты выполнения hello и производительности, можно разворачивать определения hello и конвейера активного периода toocover весь набор данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-303">When you're satisfied with hello execution results and performance, you can expand hello definition and pipeline active period toocover your entire data set.</span></span>

## <a name="considerations-for-data-management-gateway"></a><span data-ttu-id="3cf97-304">Рекомендации относительно шлюза управления данными</span><span class="sxs-lookup"><span data-stu-id="3cf97-304">Considerations for Data Management Gateway</span></span>
<span data-ttu-id="3cf97-305">**Установка шлюза**: рекомендуется использовать выделенный компьютер toohost шлюз управления данными.</span><span class="sxs-lookup"><span data-stu-id="3cf97-305">**Gateway setup**: We recommend that you use a dedicated machine toohost Data Management Gateway.</span></span> <span data-ttu-id="3cf97-306">См. [Рекомендации относительно шлюза управления данными](data-factory-data-management-gateway.md#considerations-for-using-gateway).</span><span class="sxs-lookup"><span data-stu-id="3cf97-306">See [Considerations for using Data Management Gateway](data-factory-data-management-gateway.md#considerations-for-using-gateway).</span></span>  

<span data-ttu-id="3cf97-307">**Мониторинг шлюза и вверх/масштабирования**: один логический шлюз с одного или нескольких узлов шлюза может обслуживать несколько действие копирования будет выполняться в hello одновременную одновременно.</span><span class="sxs-lookup"><span data-stu-id="3cf97-307">**Gateway monitoring and scale-up/out**: A single logical gateway with one or more gateway nodes can serve multiple Copy Activity runs at hello same time concurrently.</span></span> <span data-ttu-id="3cf97-308">Снимок практически в режиме реального времени использования ресурсов (ЦП, памяти, network(in/out), т. д.) можно просмотреть на компьютере шлюза, а hello количество одновременно выполняемых заданий, выполняющиеся тесты и ограничение в hello портала Azure см. также [монитор шлюза на портале hello](data-factory-data-management-gateway.md#monitor-gateway-in-the-portal).</span><span class="sxs-lookup"><span data-stu-id="3cf97-308">You can view near-real time snapshot of resource utilization (CPU, memory, network(in/out), etc.) on a gateway machine as well as hello number of concurrent jobs running versus limit in hello Azure portal, see [Monitor gateway in hello portal](data-factory-data-management-gateway.md#monitor-gateway-in-the-portal).</span></span> <span data-ttu-id="3cf97-309">При наличии большого объема должны на перенос гибридных данных с большим количеством параллельных копирования запуске действия или с большими объемами данных toocopy рассмотрим слишком[вертикальное и горизонтальное масштабирование шлюза](data-factory-data-management-gateway-high-availability-scalability.md#scale-considerations) так, чтобы toobetter использовать ресурс или Скопируйте дополнительные tooempower ресурсов tooprovision.</span><span class="sxs-lookup"><span data-stu-id="3cf97-309">If you have heavy need on hybrid data movement either with large number of concurrent copy activity runs or with large volume of data toocopy, consider too[scale up or scale out gateway](data-factory-data-management-gateway-high-availability-scalability.md#scale-considerations) so as toobetter utilize your resource or tooprovision more resource tooempower copy.</span></span> 

## <a name="considerations-for-hello-source"></a><span data-ttu-id="3cf97-310">Рекомендации для источника hello</span><span class="sxs-lookup"><span data-stu-id="3cf97-310">Considerations for hello source</span></span>
### <a name="general"></a><span data-ttu-id="3cf97-311">Общие сведения</span><span class="sxs-lookup"><span data-stu-id="3cf97-311">General</span></span>
<span data-ttu-id="3cf97-312">Убедитесь, что с других рабочих нагрузок, работающих на или для нее не перегружен, hello базового хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-312">Be sure that hello underlying data store is not overwhelmed by other workloads that are running on or against it.</span></span>

<span data-ttu-id="3cf97-313">Хранилища данных Microsoft, см. [контроля и настройки разделы](#performance-reference) , которые toodata конкретных хранилищ и помогают понять данных хранения характеристики производительности, снизить время ответа и максимального увеличения пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="3cf97-313">For Microsoft data stores, see [monitoring and tuning topics](#performance-reference) that are specific toodata stores, and help you understand data store performance characteristics, minimize response times, and maximize throughput.</span></span>

<span data-ttu-id="3cf97-314">При копировании данных из tooSQL хранилища больших двоичных объектов хранилища данных, рассмотрите возможность использования **PolyBase** tooboost производительности.</span><span class="sxs-lookup"><span data-stu-id="3cf97-314">If you copy data from Blob storage tooSQL Data Warehouse, consider using **PolyBase** tooboost performance.</span></span> <span data-ttu-id="3cf97-315">В разделе [PolyBase используйте tooload данных в хранилище данных SQL Azure](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse) подробные сведения.</span><span class="sxs-lookup"><span data-stu-id="3cf97-315">See [Use PolyBase tooload data into Azure SQL Data Warehouse](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse) for details.</span></span> <span data-ttu-id="3cf97-316">Пошаговое руководство и пример использования см. в статье [Загрузка 1 ТБ в хранилище данных SQL Azure с помощью фабрики данных Azure [мастер копирования] менее чем за 15 минут](data-factory-load-sql-data-warehouse.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-316">For a walkthrough with a use case, see [Load 1 TB into Azure SQL Data Warehouse under 15 minutes with Azure Data Factory](data-factory-load-sql-data-warehouse.md).</span></span>

### <a name="file-based-data-stores"></a><span data-ttu-id="3cf97-317">Файловые хранилища данных</span><span class="sxs-lookup"><span data-stu-id="3cf97-317">File-based data stores</span></span>
<span data-ttu-id="3cf97-318">*(Хранилище BLOB-объектов, Data Lake Store, Amazon S3, локальные файловые системы и локальная файловая система HDFS.)*</span><span class="sxs-lookup"><span data-stu-id="3cf97-318">*(Includes Blob storage, Data Lake Store, Amazon S3, on-premises file systems, and on-premises HDFS)*</span></span>

* <span data-ttu-id="3cf97-319">**Средний размер файла и их количество**. Действие копирования передает данные в пофайловом режиме.</span><span class="sxs-lookup"><span data-stu-id="3cf97-319">**Average file size and file count**: Copy Activity transfers data one file at a time.</span></span> <span data-ttu-id="3cf97-320">С помощью того же количества данных toobe перемещен hello hello общую пропускную способность меньше, если hello данных состоит из множества небольших файлов, а не несколько больших файлов, из-за toohello начальной загрузки этапа для каждого файла.</span><span class="sxs-lookup"><span data-stu-id="3cf97-320">With hello same amount of data toobe moved, hello overall throughput is lower if hello data consists of many small files rather than a few large files due toohello bootstrap phase for each file.</span></span> <span data-ttu-id="3cf97-321">Таким образом Если это возможно, объединяйте небольшие файлы в больших файлов toogain более высокую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-321">Therefore, if possible, combine small files into larger files toogain higher throughput.</span></span>
* <span data-ttu-id="3cf97-322">**Формат и сжатие файлов**: производительность tooimprove несколько способов, в разделе hello [рекомендации для сериализации и десериализации](#considerations-for-serialization-and-deserialization) и [рекомендации для сжатия](#considerations-for-compression) разделы.</span><span class="sxs-lookup"><span data-stu-id="3cf97-322">**File format and compression**: For more ways tooimprove performance, see hello [Considerations for serialization and deserialization](#considerations-for-serialization-and-deserialization) and [Considerations for compression](#considerations-for-compression) sections.</span></span>
* <span data-ttu-id="3cf97-323">Для hello **в локальной файловой системе** сценарий, в котором **шлюз управления данными** — hello обязательно, см. [рекомендации для шлюза управления данными](#considerations-for-data-management-gateway) раздела.</span><span class="sxs-lookup"><span data-stu-id="3cf97-323">For hello **on-premises file system** scenario, in which **Data Management Gateway** is required, see hello [Considerations for Data Management Gateway](#considerations-for-data-management-gateway) section.</span></span>

### <a name="relational-data-stores"></a><span data-ttu-id="3cf97-324">Реляционные хранилища данных</span><span class="sxs-lookup"><span data-stu-id="3cf97-324">Relational data stores</span></span>
<span data-ttu-id="3cf97-325">*(База данных SQL, хранилище данных SQL, Amazon Redshift, базы данных SQL Server, а также базы данных Oracle, MySQL, DB2, Teradata, Sybase и PostgreSQL.)*</span><span class="sxs-lookup"><span data-stu-id="3cf97-325">*(Includes SQL Database; SQL Data Warehouse; Amazon Redshift; SQL Server databases; and Oracle, MySQL, DB2, Teradata, Sybase, and PostgreSQL databases, etc.)*</span></span>

* <span data-ttu-id="3cf97-326">**Шаблон данных.**Схема таблицы влияет на пропускную способность копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-326">**Data pattern**: Your table schema affects copy throughput.</span></span> <span data-ttu-id="3cf97-327">Большой размер строки обеспечивает лучшую производительность, чем размер небольших строк, toocopy hello того же количества данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-327">A large row size gives you a better performance than small row size, toocopy hello same amount of data.</span></span> <span data-ttu-id="3cf97-328">Hello причина-выполнение hello базы данных можно получить более эффективно меньшее число пакетов данных, которые содержат меньше строк.</span><span class="sxs-lookup"><span data-stu-id="3cf97-328">hello reason is that hello database can more efficiently retrieve fewer batches of data that contain fewer rows.</span></span>
* <span data-ttu-id="3cf97-329">**Запрос или хранимую процедуру**: оптимизировать логику hello hello запроса или хранимой процедуры, укажите в источнике toofetch hello действие копирования данных более эффективно.</span><span class="sxs-lookup"><span data-stu-id="3cf97-329">**Query or stored procedure**: Optimize hello logic of hello query or stored procedure you specify in hello Copy Activity source toofetch data more efficiently.</span></span>
* <span data-ttu-id="3cf97-330">Для **локальных реляционных баз данных**, таких как SQL Server и Oracle, который необходимо использовать hello **шлюз управления данными**, разделе hello [рекомендации для шлюза управления данными](#considerations-on-data-management-gateway) раздела.</span><span class="sxs-lookup"><span data-stu-id="3cf97-330">For **on-premises relational databases**, such as SQL Server and Oracle, which require hello use of **Data Management Gateway**, see hello [Considerations for Data Management Gateway](#considerations-on-data-management-gateway) section.</span></span>

## <a name="considerations-for-hello-sink"></a><span data-ttu-id="3cf97-331">Рекомендации для приемника hello</span><span class="sxs-lookup"><span data-stu-id="3cf97-331">Considerations for hello sink</span></span>
### <a name="general"></a><span data-ttu-id="3cf97-332">Общие сведения</span><span class="sxs-lookup"><span data-stu-id="3cf97-332">General</span></span>
<span data-ttu-id="3cf97-333">Убедитесь, что с других рабочих нагрузок, работающих на или для нее не перегружен, hello базового хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-333">Be sure that hello underlying data store is not overwhelmed by other workloads that are running on or against it.</span></span>

<span data-ttu-id="3cf97-334">Хранилища данных Microsoft, см. в разделе слишком[контроля и настройки разделы](#performance-reference) , относятся к определенной toodata магазинов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-334">For Microsoft data stores, refer too[monitoring and tuning topics](#performance-reference) that are specific toodata stores.</span></span> <span data-ttu-id="3cf97-335">Эти разделы помогут вам понять характеристики производительности хранилища данных и как время отклика toominimize и максимально увеличить пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-335">These topics can help you understand data store performance characteristics and how toominimize response times and maximize throughput.</span></span>

<span data-ttu-id="3cf97-336">При копировании данных из **хранилище больших двоичных объектов** слишком**хранилище данных SQL**, рассмотрите возможность использования **PolyBase** tooboost производительности.</span><span class="sxs-lookup"><span data-stu-id="3cf97-336">If you are copying data from **Blob storage** too**SQL Data Warehouse**, consider using **PolyBase** tooboost performance.</span></span> <span data-ttu-id="3cf97-337">В разделе [PolyBase используйте tooload данных в хранилище данных SQL Azure](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse) подробные сведения.</span><span class="sxs-lookup"><span data-stu-id="3cf97-337">See [Use PolyBase tooload data into Azure SQL Data Warehouse](data-factory-azure-sql-data-warehouse-connector.md#use-polybase-to-load-data-into-azure-sql-data-warehouse) for details.</span></span> <span data-ttu-id="3cf97-338">Пошаговое руководство и пример использования см. в статье [Загрузка 1 ТБ в хранилище данных SQL Azure с помощью фабрики данных Azure [мастер копирования] менее чем за 15 минут](data-factory-load-sql-data-warehouse.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-338">For a walkthrough with a use case, see [Load 1 TB into Azure SQL Data Warehouse under 15 minutes with Azure Data Factory](data-factory-load-sql-data-warehouse.md).</span></span>

### <a name="file-based-data-stores"></a><span data-ttu-id="3cf97-339">Файловые хранилища данных</span><span class="sxs-lookup"><span data-stu-id="3cf97-339">File-based data stores</span></span>
<span data-ttu-id="3cf97-340">*(Хранилище BLOB-объектов, Data Lake Store, Amazon S3, локальные файловые системы и локальная файловая система HDFS.)*</span><span class="sxs-lookup"><span data-stu-id="3cf97-340">*(Includes Blob storage, Data Lake Store, Amazon S3, on-premises file systems, and on-premises HDFS)*</span></span>

* <span data-ttu-id="3cf97-341">**Скопируйте поведение**: при копировании данных из хранилища различных файловых данных действие копирования имеет три параметра через hello **copyBehavior** свойство.</span><span class="sxs-lookup"><span data-stu-id="3cf97-341">**Copy behavior**: If you copy data from a different file-based data store, Copy Activity has three options via hello **copyBehavior** property.</span></span> <span data-ttu-id="3cf97-342">сохранение иерархии, преобразование в плоскую структуру или объединение файлов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-342">It preserves hierarchy, flattens hierarchy, or merges files.</span></span> <span data-ttu-id="3cf97-343">Сохраняя или сведение иерархии имеет почти или совсем не снижение производительности, но слияние файлов приводит tooincrease издержек на производительность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-343">Either preserving or flattening hierarchy has little or no performance overhead, but merging files causes performance overhead tooincrease.</span></span>
* <span data-ttu-id="3cf97-344">**Формат и сжатие файлов**: hello см. в разделе [рекомендации для сериализации и десериализации](#considerations-for-serialization-and-deserialization) и [рекомендации для сжатия](#considerations-for-compression) разделы для нескольких способов tooimprove производительности .</span><span class="sxs-lookup"><span data-stu-id="3cf97-344">**File format and compression**: See hello [Considerations for serialization and deserialization](#considerations-for-serialization-and-deserialization) and [Considerations for compression](#considerations-for-compression) sections for more ways tooimprove performance.</span></span>
* <span data-ttu-id="3cf97-345">**Хранилище BLOB-объектов.**В настоящее время оптимизация передачи данных и пропускной способности поддерживается только для блочных BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-345">**Blob storage**: Currently, Blob storage supports only block blobs for optimized data transfer and throughput.</span></span>
* <span data-ttu-id="3cf97-346">Для **локальных файловых систем** сценарии, требующие использования hello **шлюз управления данными**, разделе hello [рекомендации для шлюза управления данными](#considerations-for-data-management-gateway) раздела.</span><span class="sxs-lookup"><span data-stu-id="3cf97-346">For **on-premises file systems** scenarios that require hello use of **Data Management Gateway**, see hello [Considerations for Data Management Gateway](#considerations-for-data-management-gateway) section.</span></span>

### <a name="relational-data-stores"></a><span data-ttu-id="3cf97-347">Реляционные хранилища данных</span><span class="sxs-lookup"><span data-stu-id="3cf97-347">Relational data stores</span></span>
<span data-ttu-id="3cf97-348">*(База данных SQL, хранилище данных SQL, базы данных SQL Server и базы данных Oracle.)*</span><span class="sxs-lookup"><span data-stu-id="3cf97-348">*(Includes SQL Database, SQL Data Warehouse, SQL Server databases, and Oracle databases)*</span></span>

* <span data-ttu-id="3cf97-349">**Скопируйте поведение**: в зависимости от свойств hello, заданные для **sqlSink**, действие копирования записывает данные toohello целевой базы данных различными способами.</span><span class="sxs-lookup"><span data-stu-id="3cf97-349">**Copy behavior**: Depending on hello properties you've set for **sqlSink**, Copy Activity writes data toohello destination database in different ways.</span></span>
  * <span data-ttu-id="3cf97-350">По умолчанию служба перемещения данных hello использует данные tooinsert hello API-интерфейса массового копирования в append режима, предоставляющего hello наилучшей производительности.</span><span class="sxs-lookup"><span data-stu-id="3cf97-350">By default, hello data movement service uses hello Bulk Copy API tooinsert data in append mode, which provides hello best performance.</span></span>
  * <span data-ttu-id="3cf97-351">При настройке хранимой процедуры в приемник hello hello базы данных применяет одну строку hello данных во время, а не как Массовая загрузка.</span><span class="sxs-lookup"><span data-stu-id="3cf97-351">If you configure a stored procedure in hello sink, hello database applies hello data one row at a time instead of as a bulk load.</span></span> <span data-ttu-id="3cf97-352">Это существенно снижает производительность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-352">Performance drops significantly.</span></span> <span data-ttu-id="3cf97-353">Если набор данных велик, если применимо, необходимо рассмотреть вопрос перехода toousing hello **sqlWriterCleanupScript** свойство.</span><span class="sxs-lookup"><span data-stu-id="3cf97-353">If your data set is large, when applicable, consider switching toousing hello **sqlWriterCleanupScript** property.</span></span>
  * <span data-ttu-id="3cf97-354">При настройке hello **sqlWriterCleanupScript** запуска свойство для каждого действия копирования, hello службы триггеров hello скрипта и воспользуйтесь tooinsert hello hello API-интерфейса массового копирования данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-354">If you configure hello **sqlWriterCleanupScript** property for each Copy Activity run, hello service triggers hello script, and then you use hello Bulk Copy API tooinsert hello data.</span></span> <span data-ttu-id="3cf97-355">Например всю таблицу toooverwrite hello hello последние данные, можно указать toofirst сценария удалить все записи, прежде чем массовой загрузки hello новые данные из источника hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-355">For example, toooverwrite hello entire table with hello latest data, you can specify a script toofirst delete all records before bulk-loading hello new data from hello source.</span></span>
* <span data-ttu-id="3cf97-356">**Шаблон данных и размер пакета**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-356">**Data pattern and batch size**:</span></span>
  * <span data-ttu-id="3cf97-357">Схема таблицы влияет на пропускную способность копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-357">Your table schema affects copy throughput.</span></span> <span data-ttu-id="3cf97-358">toocopy Здравствуйте того же количества данных, большой размер строки дает более высокую производительность, чем размер небольших строк hello базы данных можно более эффективно фиксировать меньшее число пакетов данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-358">toocopy hello same amount of data, a large row size gives you better performance than a small row size because hello database can more efficiently commit fewer batches of data.</span></span>
  * <span data-ttu-id="3cf97-359">Действие копирования вставляет данные в виде последовательности пакетов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-359">Copy Activity inserts data in a series of batches.</span></span> <span data-ttu-id="3cf97-360">Можно задать hello количество строк в пакете с помощью hello **writeBatchSize** свойство.</span><span class="sxs-lookup"><span data-stu-id="3cf97-360">You can set hello number of rows in a batch by using hello **writeBatchSize** property.</span></span> <span data-ttu-id="3cf97-361">Если данные содержат небольших строк, можно задать hello **writeBatchSize** свойство с более высоким значением toobenefit с низкими издержками пакета и более высокую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-361">If your data has small rows, you can set hello **writeBatchSize** property with a higher value toobenefit from lower batch overhead and higher throughput.</span></span> <span data-ttu-id="3cf97-362">Если размер строки hello данных имеет большой размер, будьте внимательны, при увеличении **writeBatchSize**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-362">If hello row size of your data is large, be careful when you increase **writeBatchSize**.</span></span> <span data-ttu-id="3cf97-363">Высокое значение счетчика может стать причиной сбоя копирования tooa вызвана перегрузка hello базы данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-363">A high value might lead tooa copy failure caused by overloading hello database.</span></span>
* <span data-ttu-id="3cf97-364">Для **локальных реляционных баз данных** , такие как SQL Server и Oracle, который необходимо использовать hello **шлюз управления данными**, разделе hello [рекомендации для шлюза управления данными](#considerations-for-data-management-gateway) раздела.</span><span class="sxs-lookup"><span data-stu-id="3cf97-364">For **on-premises relational databases** like SQL Server and Oracle, which require hello use of **Data Management Gateway**, see hello [Considerations for Data Management Gateway](#considerations-for-data-management-gateway) section.</span></span>

### <a name="nosql-stores"></a><span data-ttu-id="3cf97-365">Хранилища NoSQL</span><span class="sxs-lookup"><span data-stu-id="3cf97-365">NoSQL stores</span></span>
<span data-ttu-id="3cf97-366">*(Хранилище таблиц и Azure Cosmos DB.)*</span><span class="sxs-lookup"><span data-stu-id="3cf97-366">*(Includes Table storage and Azure Cosmos DB )*</span></span>

* <span data-ttu-id="3cf97-367">Для **хранилища таблиц**:</span><span class="sxs-lookup"><span data-stu-id="3cf97-367">For **Table storage**:</span></span>
  * <span data-ttu-id="3cf97-368">**Раздел**: запись toointerleaved секции данных значительно снижает производительность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-368">**Partition**: Writing data toointerleaved partitions dramatically degrades performance.</span></span> <span data-ttu-id="3cf97-369">Сортировку ключ секции исходных данных, чтобы данные hello эффективно вставляются в одну секцию после другого или настроить hello логику toowrite hello tooa одну секцию данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-369">Sort your source data by partition key so that hello data is inserted efficiently into one partition after another, or adjust hello logic toowrite hello data tooa single partition.</span></span>
* <span data-ttu-id="3cf97-370">Для **Azure Cosmos DB**:</span><span class="sxs-lookup"><span data-stu-id="3cf97-370">For **Azure Cosmos DB**:</span></span>
  * <span data-ttu-id="3cf97-371">**Размер пакета**: hello **writeBatchSize** свойство задает hello число параллельных запросов службы toocreate toohello Azure Cosmos DB документов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-371">**Batch size**: hello **writeBatchSize** property sets hello number of parallel requests toohello Azure Cosmos DB service toocreate documents.</span></span> <span data-ttu-id="3cf97-372">Можно ожидать более высокую производительность при увеличении **writeBatchSize** , так как несколько параллельных запросов отправляются tooAzure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="3cf97-372">You can expect better performance when you increase **writeBatchSize** because more parallel requests are sent tooAzure Cosmos DB.</span></span> <span data-ttu-id="3cf97-373">Тем не менее, наблюдать за регулирования при написании tooAzure Cosmos DB (сообщение об ошибке hello — запроса «скорость большой»).</span><span class="sxs-lookup"><span data-stu-id="3cf97-373">However, watch for throttling when you write tooAzure Cosmos DB (hello error message is "Request rate is large").</span></span> <span data-ttu-id="3cf97-374">Различных факторов можно вызвать регулирования количества запросов, включая размер документа hello количеством терминов в документах hello и hello политика индексирования целевой коллекции.</span><span class="sxs-lookup"><span data-stu-id="3cf97-374">Various factors can cause throttling, including document size, hello number of terms in hello documents, and hello target collection's indexing policy.</span></span> <span data-ttu-id="3cf97-375">tooachieve копирования пропускную способность, рассмотрите возможность использования более коллекции, например, S3.</span><span class="sxs-lookup"><span data-stu-id="3cf97-375">tooachieve higher copy throughput, consider using a better collection, for example, S3.</span></span>

## <a name="considerations-for-serialization-and-deserialization"></a><span data-ttu-id="3cf97-376">Рекомендации по сериализации и десериализации</span><span class="sxs-lookup"><span data-stu-id="3cf97-376">Considerations for serialization and deserialization</span></span>
<span data-ttu-id="3cf97-377">Сериализация и десериализация могут произойти, если входной или выходной набор данных представляет собой файл.</span><span class="sxs-lookup"><span data-stu-id="3cf97-377">Serialization and deserialization can occur when your input data set or output data set is a file.</span></span> <span data-ttu-id="3cf97-378">Дополнительные сведения о форматах файлов, поддерживаемых действием копирования, см. в статье [Форматы файлов и сжатия данных, поддерживаемые фабрикой данных Azure](data-factory-supported-file-and-compression-formats.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-378">See [Supported file and compression formats](data-factory-supported-file-and-compression-formats.md) with details on supported file formats by Copy Activity.</span></span>

<span data-ttu-id="3cf97-379">**Режим копирования.**</span><span class="sxs-lookup"><span data-stu-id="3cf97-379">**Copy behavior**:</span></span>

* <span data-ttu-id="3cf97-380">При копировании файлов между файловыми хранилищами данных:</span><span class="sxs-lookup"><span data-stu-id="3cf97-380">Copying files between file-based data stores:</span></span>
  * <span data-ttu-id="3cf97-381">Если входные и выходные наборы данных, которые имеют hello таким же или нет настроек формата файла, служба перемещения данных hello выполняет двоичного копирования, без сериализации и десериализации.</span><span class="sxs-lookup"><span data-stu-id="3cf97-381">When input and output data sets both have hello same or no file format settings, hello data movement service executes a binary copy without any serialization or deserialization.</span></span> <span data-ttu-id="3cf97-382">Вы увидите выше пропускную способность по сравнению toohello сценарии, в какие hello источника и приемника параметры формата файла отличаются друг от друга.</span><span class="sxs-lookup"><span data-stu-id="3cf97-382">You see a higher throughput compared toohello scenario, in which hello source and sink file format settings are different from each other.</span></span>
  * <span data-ttu-id="3cf97-383">При входных данных, а также выходные данные наборы данных как в текстовом формате и кодирование hello только тип отличается служба перемещения данных hello только выполняет преобразование кодировки.</span><span class="sxs-lookup"><span data-stu-id="3cf97-383">When input and output data sets both are in text format and only hello encoding type is different, hello data movement service only does encoding conversion.</span></span> <span data-ttu-id="3cf97-384">Он не выполняет сериализацию, и десериализации, который вызывает некоторые издержки производительности по сравнению tooa двоичного копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-384">It doesn't do any serialization and deserialization, which causes some performance overhead compared tooa binary copy.</span></span>
  * <span data-ttu-id="3cf97-385">Если входные и выходные наборы данных оба имеют разные форматы файлов или различных конфигураций, таких как разделители, hello службы перемещения данных десериализует toostream источника данных, преобразования и выполнить его сериализацию в формат вывода hello, обозначенной.</span><span class="sxs-lookup"><span data-stu-id="3cf97-385">When input and output data sets both have different file formats or different configurations, like delimiters, hello data movement service deserializes source data toostream, transform, and then serialize it into hello output format you indicated.</span></span> <span data-ttu-id="3cf97-386">Результатом операции является гораздо большее значение производительности по сравнению tooother сценариев.</span><span class="sxs-lookup"><span data-stu-id="3cf97-386">This operation results in a much more significant performance overhead compared tooother scenarios.</span></span>
* <span data-ttu-id="3cf97-387">При копировании файлов из хранилища данных не на основе файла (например, из tooa реляционное хранилище файлового хранилища), hello сериализации или десериализации шаг является обязательным.</span><span class="sxs-lookup"><span data-stu-id="3cf97-387">When you copy files to/from a data store that is not file-based (for example, from a file-based store tooa relational store), hello serialization or deserialization step is required.</span></span> <span data-ttu-id="3cf97-388">Этот шаг существенно снижает производительность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-388">This step results in significant performance overhead.</span></span>

<span data-ttu-id="3cf97-389">**Формат файла**: выберите формат файла hello может повлиять на производительность копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-389">**File format**: hello file format you choose might affect copy performance.</span></span> <span data-ttu-id="3cf97-390">К примеру, Avro — это компактный двоичный формат, в котором хранятся метаданные с данными.</span><span class="sxs-lookup"><span data-stu-id="3cf97-390">For example, Avro is a compact binary format that stores metadata with data.</span></span> <span data-ttu-id="3cf97-391">Он имеет широко поддерживает экосистему hello Hadoop для обработки и выполнения запросов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-391">It has broad support in hello Hadoop ecosystem for processing and querying.</span></span> <span data-ttu-id="3cf97-392">Тем не менее Avro стоит дороже, для сериализации и десериализации, какие результаты в нижнем копирования пропускной способности по сравнению tootext формат.</span><span class="sxs-lookup"><span data-stu-id="3cf97-392">However, Avro is more expensive for serialization and deserialization, which results in lower copy throughput compared tootext format.</span></span> <span data-ttu-id="3cf97-393">Выберите нужный вариант формата файла в поток обработки комплексный hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-393">Make your choice of file format throughout hello processing flow holistically.</span></span> <span data-ttu-id="3cf97-394">Начать с hello какие формы данные хранятся в, источник хранилищ данных или toobe, извлеченные из внешних систем; Привет лучший формат для хранения, аналитической обработки и запросов; и в каком формате должны быть экспортированы данные hello в витринах данных для средств создания отчетов и визуализаций.</span><span class="sxs-lookup"><span data-stu-id="3cf97-394">Start with what form hello data is stored in, source data stores or toobe extracted from external systems; hello best format for storage, analytical processing, and querying; and in what format hello data should be exported into data marts for reporting and visualization tools.</span></span> <span data-ttu-id="3cf97-395">Иногда формат файла, который не является оптимальным для чтения и записи, производительности может быть хорошим выбором, если учесть hello в целом аналитических процесса.</span><span class="sxs-lookup"><span data-stu-id="3cf97-395">Sometimes a file format that is suboptimal for read and write performance might be a good choice when you consider hello overall analytical process.</span></span>

## <a name="considerations-for-compression"></a><span data-ttu-id="3cf97-396">Рекомендации по сжатию</span><span class="sxs-lookup"><span data-stu-id="3cf97-396">Considerations for compression</span></span>
<span data-ttu-id="3cf97-397">Если входной или выходной набор данных — это файл, можно задать действие копирования tooperform упаковку или распаковку как он записывает toohello назначения данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-397">When your input or output data set is a file, you can set Copy Activity tooperform compression or decompression as it writes data toohello destination.</span></span> <span data-ttu-id="3cf97-398">Использование сжатия — это компромисс между количеством операций ввода-вывода и потреблением ЦП,</span><span class="sxs-lookup"><span data-stu-id="3cf97-398">When you choose compression, you make a tradeoff between input/output (I/O) and CPU.</span></span> <span data-ttu-id="3cf97-399">Сжатие данных hello в дополнительных затрат на вычислительные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="3cf97-399">Compressing hello data costs extra in compute resources.</span></span> <span data-ttu-id="3cf97-400">Однако взамен уменьшается количество сетевых операций ввода-вывода и используемый объем хранилища.</span><span class="sxs-lookup"><span data-stu-id="3cf97-400">But in return, it reduces network I/O and storage.</span></span> <span data-ttu-id="3cf97-401">В зависимости от данных это может повысить общую пропускную способность копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-401">Depending on your data, you may see a boost in overall copy throughput.</span></span>

<span data-ttu-id="3cf97-402">**Кодек.**Действие копирования поддерживает такие типы сжатия: GZIP, BZIP2 и DEFLATE.</span><span class="sxs-lookup"><span data-stu-id="3cf97-402">**Codec**: Copy Activity supports gzip, bzip2, and Deflate compression types.</span></span> <span data-ttu-id="3cf97-403">Все три типа можно использовать для обработки в Azure HDInsight.</span><span class="sxs-lookup"><span data-stu-id="3cf97-403">Azure HDInsight can consume all three types for processing.</span></span> <span data-ttu-id="3cf97-404">Каждый кодек сжатия имеет свои преимущества.</span><span class="sxs-lookup"><span data-stu-id="3cf97-404">Each compression codec has advantages.</span></span> <span data-ttu-id="3cf97-405">Например bzip2 hello наименьшее копирования, пропускной способности, но получить наилучшую производительность запросов Hive hello с bzip2 потому, что данные можно разбить на обработку.</span><span class="sxs-lookup"><span data-stu-id="3cf97-405">For example, bzip2 has hello lowest copy throughput, but you get hello best Hive query performance with bzip2 because you can split it for processing.</span></span> <span data-ttu-id="3cf97-406">Вариант gzip наиболее балансировки hello и используется чаще всего hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-406">Gzip is hello most balanced option, and it is used hello most often.</span></span> <span data-ttu-id="3cf97-407">Выберите hello кодека, который лучше всего подходит для вашего сценария начала до конца.</span><span class="sxs-lookup"><span data-stu-id="3cf97-407">Choose hello codec that best suits your end-to-end scenario.</span></span>

<span data-ttu-id="3cf97-408">**Уровень.**Для каждого кодека сжатия можно выбрать один из двух параметров — самое быстрое сжатие или оптимальное сжатие.</span><span class="sxs-lookup"><span data-stu-id="3cf97-408">**Level**: You can choose from two options for each compression codec: fastest compressed and optimally compressed.</span></span> <span data-ttu-id="3cf97-409">Hello быстрым сжатых параметр сжимает hello данные как можно скорее, даже если hello получившийся файл оптимально не сжимаются.</span><span class="sxs-lookup"><span data-stu-id="3cf97-409">hello fastest compressed option compresses hello data as quickly as possible, even if hello resulting file is not optimally compressed.</span></span> <span data-ttu-id="3cf97-410">Hello оптимально сжатых параметр проводит больше времени на сжатие и дает минимальный объем данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-410">hello optimally compressed option spends more time on compression and yields a minimal amount of data.</span></span> <span data-ttu-id="3cf97-411">Вы можете протестировать toosee обоих параметров, который обеспечивает лучшую общую производительность в случае.</span><span class="sxs-lookup"><span data-stu-id="3cf97-411">You can test both options toosee which provides better overall performance in your case.</span></span>

<span data-ttu-id="3cf97-412">**Следует учитывать**: toocopy большой объем данных к локальному хранилищу и облачных hello, рассмотрите возможность использования хранилища промежуточные больших двоичных объектов с использованием сжатия.</span><span class="sxs-lookup"><span data-stu-id="3cf97-412">**A consideration**: toocopy a large amount of data between an on-premises store and hello cloud, consider using interim blob storage with compression.</span></span> <span data-ttu-id="3cf97-413">С помощью промежуточного хранилища полезно в том случае, если hello пропускной способности сети организации и службами Azure является ограничивающим фактором hello, и нужно hello входной набор данных и выходные данные обоих toobe в несжатом виде.</span><span class="sxs-lookup"><span data-stu-id="3cf97-413">Using interim storage is helpful when hello bandwidth of your corporate network and your Azure services is hello limiting factor, and you want hello input data set and output data set both toobe in uncompressed form.</span></span> <span data-ttu-id="3cf97-414">В частности, можно разбить одно действие копирования на два действия:</span><span class="sxs-lookup"><span data-stu-id="3cf97-414">More specifically, you can break a single copy activity into two copy activities.</span></span> <span data-ttu-id="3cf97-415">Hello первого копирования действие копирование из промежуточной tooan источника hello или промежуточной большого двоичного объекта в сжатом виде.</span><span class="sxs-lookup"><span data-stu-id="3cf97-415">hello first copy activity copies from hello source tooan interim or staging blob in compressed form.</span></span> <span data-ttu-id="3cf97-416">второе действие копирования Hello hello сжатые данные копируются из промежуточного хранения и извлекает хотя он записывает toohello приемника.</span><span class="sxs-lookup"><span data-stu-id="3cf97-416">hello second copy activity copies hello compressed data from staging, and then decompresses while it writes toohello sink.</span></span>

## <a name="considerations-for-column-mapping"></a><span data-ttu-id="3cf97-417">Рекомендации по сопоставлению столбцов</span><span class="sxs-lookup"><span data-stu-id="3cf97-417">Considerations for column mapping</span></span>
<span data-ttu-id="3cf97-418">Можно задать hello **columnMappings** свойство в действии копирования toomap все или часть hello входные столбцы toohello выходных столбцов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-418">You can set hello **columnMappings** property in Copy Activity toomap all or a subset of hello input columns toohello output columns.</span></span> <span data-ttu-id="3cf97-419">После hello службы перемещения данных считывает hello данные из источника hello, ему tooperform сопоставление столбцов с данными hello до записи приемник toohello данных hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-419">After hello data movement service reads hello data from hello source, it needs tooperform column mapping on hello data before it writes hello data toohello sink.</span></span> <span data-ttu-id="3cf97-420">Эта дополнительная обработка снижает пропускную способность копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-420">This extra processing reduces copy throughput.</span></span>

<span data-ttu-id="3cf97-421">Если запрашиваемый хранилище данных источника, например, если это реляционное хранилище, например базы данных SQL или SQL Server, или в том случае, если это хранилище NoSQL, таких как хранилище таблиц или Cosmos базу данных Azure, распределенного запроса передает hello фильтрации столбцов и изменение порядка toohello логику **запроса**  свойство вместо использования сопоставления столбцов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-421">If your source data store is queryable, for example, if it's a relational store like SQL Database or SQL Server, or if it's a NoSQL store like Table storage or Azure Cosmos DB, consider pushing hello column filtering and reordering logic toohello **query** property instead of using column mapping.</span></span> <span data-ttu-id="3cf97-422">Таким образом, проекции hello происходит во время служба перемещения данных hello читает хранилище данных из источника данных hello, там, где это гораздо более эффективно.</span><span class="sxs-lookup"><span data-stu-id="3cf97-422">This way, hello projection occurs while hello data movement service reads data from hello source data store, where it is much more efficient.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="3cf97-423">Дополнительные рекомендации</span><span class="sxs-lookup"><span data-stu-id="3cf97-423">Other considerations</span></span>
<span data-ttu-id="3cf97-424">Если hello размер данных, toocopy велико, можно настроить бизнес-логики toofurther секции hello данных с помощью hello Фрагментирование механизм в фабрике данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-424">If hello size of data you want toocopy is large, you can adjust your business logic toofurther partition hello data using hello slicing mechanism in Data Factory.</span></span> <span data-ttu-id="3cf97-425">Затем запланируйте действие копирования toorun чаще запуска размер данных hello tooreduce для каждой операции копирования.</span><span class="sxs-lookup"><span data-stu-id="3cf97-425">Then, schedule Copy Activity toorun more frequently tooreduce hello data size for each Copy Activity run.</span></span>

<span data-ttu-id="3cf97-426">Быть осторожны hello количество наборов данных и копирования действия, требующие toohello tooconnector фабрики данных и те же данные хранить в hello же время.</span><span class="sxs-lookup"><span data-stu-id="3cf97-426">Be cautious about hello number of data sets and copy activities requiring Data Factory tooconnector toohello same data store at hello same time.</span></span> <span data-ttu-id="3cf97-427">Много параллельных копирования заданий могут регулирования хранилища данных и привести toodegraded производительности, скопируйте задания внутренних повторов, а в некоторых случаях ошибок выполнения.</span><span class="sxs-lookup"><span data-stu-id="3cf97-427">Many concurrent copy jobs might throttle a data store and lead toodegraded performance, copy job internal retries, and in some cases, execution failures.</span></span>

## <a name="sample-scenario-copy-from-an-on-premises-sql-server-tooblob-storage"></a><span data-ttu-id="3cf97-428">Пример: копирование из локального хранилища tooBlob SQL Server</span><span class="sxs-lookup"><span data-stu-id="3cf97-428">Sample scenario: Copy from an on-premises SQL Server tooBlob storage</span></span>
<span data-ttu-id="3cf97-429">**Сценарий**: конвейера построен данных toocopy из локального хранилища tooBlob SQL Server в формате CSV.</span><span class="sxs-lookup"><span data-stu-id="3cf97-429">**Scenario**: A pipeline is built toocopy data from an on-premises SQL Server tooBlob storage in CSV format.</span></span> <span data-ttu-id="3cf97-430">toomake быстрее Здравствуйте задание копирования, должны ли сжиматься hello CSV-файлы в формат bzip2.</span><span class="sxs-lookup"><span data-stu-id="3cf97-430">toomake hello copy job faster, hello CSV files should be compressed into bzip2 format.</span></span>

<span data-ttu-id="3cf97-431">**Анализ и тестирования**: hello пропускной способности действие копирования — меньше 2 Мбит/с, являющейся гораздо медленнее, чем тест производительности hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-431">**Test and analysis**: hello throughput of Copy Activity is less than 2 MBps, which is much slower than hello performance benchmark.</span></span>

<span data-ttu-id="3cf97-432">**Анализ производительности и настройка**: tootroubleshoot Здравствуйте, проблема с производительностью, давайте взглянем на как hello данных обрабатываются и перемещаются.</span><span class="sxs-lookup"><span data-stu-id="3cf97-432">**Performance analysis and tuning**: tootroubleshoot hello performance issue, let’s look at how hello data is processed and moved.</span></span>

1. <span data-ttu-id="3cf97-433">**Чтение данных**: шлюз открывает соединение tooSQL сервера и отправляет hello запроса.</span><span class="sxs-lookup"><span data-stu-id="3cf97-433">**Read data**: Gateway opens a connection tooSQL Server and sends hello query.</span></span> <span data-ttu-id="3cf97-434">SQL Server отвечает, отправляя hello tooGateway потока данных через интрасеть hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-434">SQL Server responds by sending hello data stream tooGateway via hello intranet.</span></span>
2. <span data-ttu-id="3cf97-435">**Сериализации и сжатия данных**: шлюза сериализует формат tooCSV потока данных hello и сжимает hello потока bzip2 tooa данных.</span><span class="sxs-lookup"><span data-stu-id="3cf97-435">**Serialize and compress data**: Gateway serializes hello data stream tooCSV format, and compresses hello data tooa bzip2 stream.</span></span>
3. <span data-ttu-id="3cf97-436">**Запись данных**: шлюз отправляет tooBlob hello bzip2 потоковое хранение через Интернет hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-436">**Write data**: Gateway uploads hello bzip2 stream tooBlob storage via hello Internet.</span></span>

<span data-ttu-id="3cf97-437">Как видите, hello данных, обрабатываются и перемещаются в последовательном режиме потоковой передачи: SQL Server > LAN > шлюза > глобальной сети > хранилище больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-437">As you can see, hello data is being processed and moved in a streaming sequential manner: SQL Server > LAN > Gateway > WAN > Blob storage.</span></span> <span data-ttu-id="3cf97-438">**Hello общую производительность управляются минимальная пропускная способность hello через конвейер hello**.</span><span class="sxs-lookup"><span data-stu-id="3cf97-438">**hello overall performance is gated by hello minimum throughput across hello pipeline**.</span></span>

![Поток данных](./media/data-factory-copy-activity-performance/case-study-pic-1.png)

<span data-ttu-id="3cf97-440">Один или несколько следующих факторов hello может привести к hello узким местом производительности:</span><span class="sxs-lookup"><span data-stu-id="3cf97-440">One or more of hello following factors might cause hello performance bottleneck:</span></span>

* <span data-ttu-id="3cf97-441">**Источник.**SQL Server отличается низкой пропускной способностью из-за высокой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="3cf97-441">**Source**: SQL Server itself has low throughput because of heavy loads.</span></span>
* <span data-ttu-id="3cf97-442">**Шлюз управления данными.**</span><span class="sxs-lookup"><span data-stu-id="3cf97-442">**Data Management Gateway**:</span></span>
  * <span data-ttu-id="3cf97-443">**LAN**: шлюз находится далеко от компьютера SQL Server hello и имеет низкой пропускной способностью.</span><span class="sxs-lookup"><span data-stu-id="3cf97-443">**LAN**: Gateway is located far from hello SQL Server machine and has a low-bandwidth connection.</span></span>
  * <span data-ttu-id="3cf97-444">**Шлюз**: шлюза достигло его tooperform hello нагрузки ограничения, следующие операции:</span><span class="sxs-lookup"><span data-stu-id="3cf97-444">**Gateway**: Gateway has reached its load limitations tooperform hello following operations:</span></span>
    * <span data-ttu-id="3cf97-445">**Сериализация**: сериализация tooCSV потока данных hello имеет формат медленно пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="3cf97-445">**Serialization**: Serializing hello data stream tooCSV format has slow throughput.</span></span>
    * <span data-ttu-id="3cf97-446">**Сжатие.**Выбран кодек медленного сжатия (например, BZIP2 со скоростью 2,8 Мбит/с и процессором Core i7).</span><span class="sxs-lookup"><span data-stu-id="3cf97-446">**Compression**: You chose a slow compression codec (for example, bzip2, which is 2.8 MBps with Core i7).</span></span>
  * <span data-ttu-id="3cf97-447">**WAN**: недостаточно hello пропускную способность между корпоративной сетью hello и служб Azure (например, T1 = 1,544 Кбит/с; T2 = 6,312 Кбит/с).</span><span class="sxs-lookup"><span data-stu-id="3cf97-447">**WAN**: hello bandwidth between hello corporate network and your Azure services is low (for example, T1 = 1,544 kbps; T2 = 6,312 kbps).</span></span>
* <span data-ttu-id="3cf97-448">**Приемник.**Хранилище BLOB-объектов имеет низкую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-448">**Sink**: Blob storage has low throughput.</span></span> <span data-ttu-id="3cf97-449">(Этот сценарий маловероятный, так как соглашение об уровне обслуживания гарантирует не менее 60 Мбит/с.)</span><span class="sxs-lookup"><span data-stu-id="3cf97-449">(This scenario is unlikely because its SLA guarantees a minimum of 60 MBps.)</span></span>

<span data-ttu-id="3cf97-450">В этом случае bzip2 сжатие данных может замедляя hello весь конвейер.</span><span class="sxs-lookup"><span data-stu-id="3cf97-450">In this case, bzip2 data compression might be slowing down hello entire pipeline.</span></span> <span data-ttu-id="3cf97-451">Переключение кодек сжатия gzip tooa может облегчить это узкое место.</span><span class="sxs-lookup"><span data-stu-id="3cf97-451">Switching tooa gzip compression codec might ease this bottleneck.</span></span>

## <a name="sample-scenarios-use-parallel-copy"></a><span data-ttu-id="3cf97-452">Примеры сценариев. Использование параллельного копирования</span><span class="sxs-lookup"><span data-stu-id="3cf97-452">Sample scenarios: Use parallel copy</span></span>
<span data-ttu-id="3cf97-453">**Сценарий I:** скопируйте 1000 1 МБ файлы из хранилища tooBlob hello в локальной файловой системы.</span><span class="sxs-lookup"><span data-stu-id="3cf97-453">**Scenario I:** Copy 1,000 1-MB files from hello on-premises file system tooBlob storage.</span></span>

<span data-ttu-id="3cf97-454">**Анализ и настройка производительности**: например, при установке шлюза на двухъядерном компьютере, фабрики данных использует 16 параллельных копии toomove файлы из хранилища tooBlob hello файловой системы одновременно.</span><span class="sxs-lookup"><span data-stu-id="3cf97-454">**Analysis and performance tuning**: For an example, if you have installed gateway on a quad core machine, Data Factory uses 16 parallel copies toomove files from hello file system tooBlob storage concurrently.</span></span> <span data-ttu-id="3cf97-455">Это приведет к высокой пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="3cf97-455">This parallel execution should result in high throughput.</span></span> <span data-ttu-id="3cf97-456">Также можно явно указать количество параллельных копий hello.</span><span class="sxs-lookup"><span data-stu-id="3cf97-456">You also can explicitly specify hello parallel copies count.</span></span> <span data-ttu-id="3cf97-457">При копировании множества небольших файлов одновременные операции копирования значительно увеличивают пропускную способность за счет более эффективного использования ресурсов.</span><span class="sxs-lookup"><span data-stu-id="3cf97-457">When you copy many small files, parallel copies dramatically help throughput by using resources more effectively.</span></span>

![Сценарий 1](./media/data-factory-copy-activity-performance/scenario-1.png)

<span data-ttu-id="3cf97-459">**Сценарий II**: скопируйте 20 больших двоичных объектов 500 МБ из хранилища больших двоичных объектов tooData аналитика хранилища озера, а затем настроить производительность.</span><span class="sxs-lookup"><span data-stu-id="3cf97-459">**Scenario II**: Copy 20 blobs of 500 MB each from Blob storage tooData Lake Store Analytics, and then tune performance.</span></span>

<span data-ttu-id="3cf97-460">**Анализ и настройка производительности**: В этом случае фабрики данных копирует hello данные из хранилища Озера tooData хранилища больших двоичных объектов с помощью одной копии (**parallelCopies** задать too1) и единицы измерения для перемещения данных одного облака.</span><span class="sxs-lookup"><span data-stu-id="3cf97-460">**Analysis and performance tuning**: In this scenario, Data Factory copies hello data from Blob storage tooData Lake Store by using single-copy (**parallelCopies** set too1) and single-cloud data movement units.</span></span> <span data-ttu-id="3cf97-461">Hello пропускной способности вы заметили будет закрыть toothat, описанные в hello [производительности справочном разделе](#performance-reference).</span><span class="sxs-lookup"><span data-stu-id="3cf97-461">hello throughput you observe will be close toothat described in hello [performance reference section](#performance-reference).</span></span>   

![Сценарий 2](./media/data-factory-copy-activity-performance/scenario-2.png)

<span data-ttu-id="3cf97-463">**Сценарий III.**Размер отдельного файла превышает десятки мегабайтов, и общий объем достаточно велик.</span><span class="sxs-lookup"><span data-stu-id="3cf97-463">**Scenario III**: Individual file size is greater than dozens of MBs and total volume is large.</span></span>

<span data-ttu-id="3cf97-464">**Анализ и включение производительности**: увеличение **parallelCopies** не обеспечить лучшую производительность для копирования из-за ограничения ресурсов hello объекта с помощью утилиты DMU одного облака.</span><span class="sxs-lookup"><span data-stu-id="3cf97-464">**Analysis and performance turning**: Increasing **parallelCopies** doesn't result in better copy performance because of hello resource limitations of a single-cloud DMU.</span></span> <span data-ttu-id="3cf97-465">Вместо этого следует указать дополнительные облака DMUs tooget перемещение данных tooperform hello дополнительные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="3cf97-465">Instead, you should specify more cloud DMUs tooget more resources tooperform hello data movement.</span></span> <span data-ttu-id="3cf97-466">Не указать значение для hello **parallelCopies** свойство.</span><span class="sxs-lookup"><span data-stu-id="3cf97-466">Do not specify a value for hello **parallelCopies** property.</span></span> <span data-ttu-id="3cf97-467">Фабрика данных обрабатывает hello параллелизма.</span><span class="sxs-lookup"><span data-stu-id="3cf97-467">Data Factory handles hello parallelism for you.</span></span> <span data-ttu-id="3cf97-468">В этом случае, если задать **cloudDataMovementUnits** происходит четыре раза too4, пропускную способность, по вашему запросу.</span><span class="sxs-lookup"><span data-stu-id="3cf97-468">In this case, if you set **cloudDataMovementUnits** too4, a throughput of about four times occurs.</span></span>

![Сценарий 3](./media/data-factory-copy-activity-performance/scenario-3.png)

## <a name="reference"></a><span data-ttu-id="3cf97-470">Справочные материалы</span><span class="sxs-lookup"><span data-stu-id="3cf97-470">Reference</span></span>
<span data-ttu-id="3cf97-471">Ниже приведены настройки ссылки для некоторых hello поддерживается хранилищ данных и наблюдения за производительностью.</span><span class="sxs-lookup"><span data-stu-id="3cf97-471">Here are performance monitoring and tuning references for some of hello supported data stores:</span></span>

* <span data-ttu-id="3cf97-472">Служба хранилища Azure (включая хранилище BLOB-объектов и таблиц): [Целевые показатели масштабируемости и производительности службы хранилища Azure](../storage/common/storage-scalability-targets.md) и [Производительность хранилища Microsoft Azure и контрольный список масштабируемости](../storage/common/storage-performance-checklist.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-472">Azure Storage (including Blob storage and Table storage): [Azure Storage scalability targets](../storage/common/storage-scalability-targets.md) and [Azure Storage performance and scalability checklist](../storage/common/storage-performance-checklist.md)</span></span>
* <span data-ttu-id="3cf97-473">База данных SQL Azure: Вы можете [наблюдения за производительностью hello](../sql-database/sql-database-single-database-monitor.md) и проверки процентного единицы (DTU) транзакции базы данных hello</span><span class="sxs-lookup"><span data-stu-id="3cf97-473">Azure SQL Database: You can [monitor hello performance](../sql-database/sql-database-single-database-monitor.md) and check hello database transaction unit (DTU) percentage</span></span>
* <span data-ttu-id="3cf97-474">Хранилище данных SQL Azure: его использование измеряется в единицах использования хранилища данных (DWU). См. статью [Управление вычислительными ресурсами в хранилище данных SQL Azure (обзор)](../sql-data-warehouse/sql-data-warehouse-manage-compute-overview.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-474">Azure SQL Data Warehouse: Its capability is measured in data warehouse units (DWUs); see [Manage compute power in Azure SQL Data Warehouse (Overview)](../sql-data-warehouse/sql-data-warehouse-manage-compute-overview.md)</span></span>
* <span data-ttu-id="3cf97-475">Azure Cosmos DB: [Прекращение использования уровней производительности S1, S2 и S3 в DocumentDB](../documentdb/documentdb-performance-levels.md).</span><span class="sxs-lookup"><span data-stu-id="3cf97-475">Azure Cosmos DB: [Performance levels in Azure Cosmos DB](../documentdb/documentdb-performance-levels.md)</span></span>
* <span data-ttu-id="3cf97-476">Локальный SQL Server: [Мониторинг и настройка производительности](https://msdn.microsoft.com/library/ms189081.aspx)</span><span class="sxs-lookup"><span data-stu-id="3cf97-476">On-premises SQL Server: [Monitor and tune for performance](https://msdn.microsoft.com/library/ms189081.aspx)</span></span>
* <span data-ttu-id="3cf97-477">Локальный файловый сервер: [Performance tuning for file servers](https://msdn.microsoft.com/library/dn567661.aspx)</span><span class="sxs-lookup"><span data-stu-id="3cf97-477">On-premises file server: [Performance tuning for file servers](https://msdn.microsoft.com/library/dn567661.aspx)</span></span>
