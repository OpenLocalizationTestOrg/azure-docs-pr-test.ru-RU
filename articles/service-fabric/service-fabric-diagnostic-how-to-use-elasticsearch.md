---
title: "aaaUsing Elasticsearch как магазин трассировки приложения Service Fabric | Документы Microsoft"
description: "Описывает способ использования приложения Service Fabric Elasticsearch и Kibana toostore, индекса и поиск по трассировок приложения (журнал)"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: b5977c54e69319e3caa376e44a02f971b66a3254
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="25462-103">Использование ElasticSearch в качестве хранилища данных трассировки приложения Service Fabric</span><span class="sxs-lookup"><span data-stu-id="25462-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="25462-104">Введение</span><span class="sxs-lookup"><span data-stu-id="25462-104">Introduction</span></span>
<span data-ttu-id="25462-105">В этой статье описывается, как приложения [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) используют **ElasticSearch** и **Kibana** для хранения данных трассировки приложений, индексирования и поиска.</span><span class="sxs-lookup"><span data-stu-id="25462-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="25462-106">[ElasticSearch](https://www.elastic.co/guide/index.html) — это распределенная и масштабируемая система с открытым кодом, предназначенная для поиска и анализа данных в режиме реального времени. Она хорошо подходит для описанной здесь задачи.</span><span class="sxs-lookup"><span data-stu-id="25462-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="25462-107">Ее можно установить на виртуальные машины Windows или Linux, запущенные в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="25462-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="25462-108">ElasticSearch может эффективно обрабатывать *структурированные* трассировки, созданные с помощью таких технологий, как **трассировка событий Windows (ETW)**.</span><span class="sxs-lookup"><span data-stu-id="25462-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="25462-109">Трассировка событий Windows используется служба среды выполнения toosource диагностических сведений о структуре (трассировки).</span><span class="sxs-lookup"><span data-stu-id="25462-109">ETW is used by Service Fabric runtime toosource diagnostic information (traces).</span></span> <span data-ttu-id="25462-110">Он является hello слишком рекомендуется метод toosource приложения Service Fabric для их диагностические сведения.</span><span class="sxs-lookup"><span data-stu-id="25462-110">It is hello recommended method for Service Fabric applications toosource their diagnostic information, too.</span></span> <span data-ttu-id="25462-111">С помощью hello тот же механизм позволяет корреляцию между трассировками предоставленный среды выполнения и предоставляемую приложением и облегчает Устранение неполадок.</span><span class="sxs-lookup"><span data-stu-id="25462-111">Using hello same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="25462-112">Service Fabric шаблоны проектов в Visual Studio включают API ведения журнала (в зависимости от hello .NET **EventSource** класса), создает трассировки событий Windows по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="25462-112">Service Fabric project templates in Visual Studio include a logging API (based on hello .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="25462-113">Общие сведения о трассировке приложений Service Fabric с помощью ETW см. в разделе [Мониторинг и диагностика состояния служб в локальной среде разработки](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="25462-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="25462-114">Для hello трассировки tooshow вверх в Elasticsearch они должны toobe перенаправляться на узлах кластера Service Fabric hello в режиме реального времени (пока приложение hello) и отправляются в конечную точку tooan Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="25462-114">For hello traces tooshow up in Elasticsearch, they need toobe captured at hello Service Fabric cluster nodes in real time (while hello application is running) and sent tooan Elasticsearch endpoint.</span></span> <span data-ttu-id="25462-115">Есть два основных способа записи данных трассировки.</span><span class="sxs-lookup"><span data-stu-id="25462-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="25462-116">**Внутрипроцессная запись данных трассировки.**</span><span class="sxs-lookup"><span data-stu-id="25462-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="25462-117">приложения Hello, или более точно, процесс службы отвечает за отправку hello диагностических данных toohello трассировки хранилища (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="25462-117">hello application, or more precisely, service process, is responsible for sending out hello diagnostic data toohello trace store (Elasticsearch).</span></span>
* <span data-ttu-id="25462-118">**Внепроцессная запись данных трассировки.**</span><span class="sxs-lookup"><span data-stu-id="25462-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="25462-119">Отдельный агент захватывать трассировку из процесса hello службы или процессы и отправки их в хранилище toohello трассировки.</span><span class="sxs-lookup"><span data-stu-id="25462-119">A separate agent is capturing traces from hello service process or processes and sending them toohello trace store.</span></span>

<span data-ttu-id="25462-120">Ниже описаны как tooset копирование Elasticsearch в Azure, рассматриваются преимущества hello и недостатки для обоих параметров захвата и объясняется, как tooconfigure Service Fabric службы tooElasticsearch toosend данных.</span><span class="sxs-lookup"><span data-stu-id="25462-120">Below, we describe how tooset up Elasticsearch on Azure, discuss hello pros and cons for both capture options, and explain how tooconfigure a Service Fabric service toosend data tooElasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="25462-121">Настройка ElasticSearch в Azure</span><span class="sxs-lookup"><span data-stu-id="25462-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="25462-122">Hello наиболее простым способом tooset hello Elasticsearch службы в Azure выполняется с помощью [ **шаблоны Azure Resource Manager**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="25462-122">hello most straightforward way tooset up hello Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="25462-123">Полнофункциональный [шаблон быстрого запуска диспетчера ресурсов Azure для ElasticSearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) можно получить из репозитория шаблонов быстрого запуска Azure.</span><span class="sxs-lookup"><span data-stu-id="25462-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="25462-124">В этом шаблоне используются отдельные учетные записи хранения для единиц масштабирования (групп узлов).</span><span class="sxs-lookup"><span data-stu-id="25462-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="25462-125">Он также может подготовить отдельные узлы клиента и сервера с различными конфигурациями и различным количеством подключенных дисков данных.</span><span class="sxs-lookup"><span data-stu-id="25462-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="25462-126">Здесь мы используем другой шаблон, с именем **ES MultiNode** из hello [хранилища Azure средства диагностики](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="25462-126">Here, we use another template, called **ES-MultiNode** from hello [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="25462-127">Этот шаблон является проще toouse и создает кластер Elasticsearch защищен обычной проверки подлинности HTTP.</span><span class="sxs-lookup"><span data-stu-id="25462-127">This template is easier toouse, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="25462-128">Прежде чем продолжить, загрузите репозитория hello из GitHub tooyour машины (путем клонирования репозитория hello или загрузка ZIP-файл).</span><span class="sxs-lookup"><span data-stu-id="25462-128">Before you proceed, download hello repository from GitHub tooyour machine (by either cloning hello repository or downloading a zip file).</span></span> <span data-ttu-id="25462-129">Hello ES MultiNode шаблона находится в папке hello с hello таким же именем.</span><span class="sxs-lookup"><span data-stu-id="25462-129">hello ES-MultiNode template is located in hello folder with hello same name.</span></span>

### <a name="prepare-a-machine-toorun-elasticsearch-installation-scripts"></a><span data-ttu-id="25462-130">Подготовка toorun машины Elasticsearch сценарии установки</span><span class="sxs-lookup"><span data-stu-id="25462-130">Prepare a machine toorun Elasticsearch installation scripts</span></span>
<span data-ttu-id="25462-131">Hello шаблона hello ES MultiNode toouse простым способом — через указанный сценарий Azure PowerShell с именем `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="25462-131">hello easiest way toouse hello ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="25462-132">toouse этот сценарий, необходимо tooinstall модули PowerShell и инструмент, который называется **openssl**.</span><span class="sxs-lookup"><span data-stu-id="25462-132">toouse this script, you need tooinstall PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="25462-133">последний Hello необходим для создания SSH-ключ, который можно использовать tooadminister кластера Elasticsearch удаленно.</span><span class="sxs-lookup"><span data-stu-id="25462-133">hello latter is needed for creating an SSH key that can be used tooadminister your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="25462-134">`CreateElasticSearchCluster`скрипт предназначен для удобства использования с шаблоном hello ES MultiNode с компьютером Windows.</span><span class="sxs-lookup"><span data-stu-id="25462-134">`CreateElasticSearchCluster` script is designed for ease of use with hello ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="25462-135">Это шаблон hello возможных toouse на компьютере не под управлением Windows, но в этом сценарии выходит за рамки данной статьи hello.</span><span class="sxs-lookup"><span data-stu-id="25462-135">It is possible toouse hello template on a non-Windows machine, but that scenario is beyond hello scope of this article.</span></span>

1. <span data-ttu-id="25462-136">Установите [**модули Azure PowerShell**](http://aka.ms/webpi-azps) (если они еще не установлены).</span><span class="sxs-lookup"><span data-stu-id="25462-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="25462-137">При появлении запроса щелкните **Запуск**, а затем — **Установить**.</span><span class="sxs-lookup"><span data-stu-id="25462-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="25462-138">Требуется Azure PowerShell 1.3 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="25462-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="25462-139">Hello **openssl** средство включено в распределение hello [ **Git для Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="25462-139">hello **openssl** tool is included in hello distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="25462-140">Установите [Git для Windows](http://www.git-scm.com/downloads) , если вы этого еще не сделали.</span><span class="sxs-lookup"><span data-stu-id="25462-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="25462-141">(параметры установки по умолчанию hello корректны.)</span><span class="sxs-lookup"><span data-stu-id="25462-141">(hello default installation options are OK.)</span></span>
3. <span data-ttu-id="25462-142">Предположим, что Git установлен, но не включены в системном пути hello, откройте окно Microsoft Azure PowerShell и выполните hello, следующие команды:</span><span class="sxs-lookup"><span data-stu-id="25462-142">Assuming that Git has been installed but not included in hello system path, open a Microsoft Azure PowerShell window and run hello following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="25462-143">Замените hello `<Git installation folder>` с расположением hello Git на компьютере; по умолчанию hello — **«C:\Program Files\Git»**.</span><span class="sxs-lookup"><span data-stu-id="25462-143">Replace hello `<Git installation folder>` with hello Git location on your machine; hello default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="25462-144">Обратите внимание, hello символ точки с запятой в начале hello hello первого пути.</span><span class="sxs-lookup"><span data-stu-id="25462-144">Note hello semicolon character at hello beginning of hello first path.</span></span>
4. <span data-ttu-id="25462-145">Убедитесь, что вы вошли на tooAzure (через [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) командлета) и выбранных hello подписка, которая используется toocreate кластера эластичной поиска.</span><span class="sxs-lookup"><span data-stu-id="25462-145">Ensure that you are logged on tooAzure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected hello subscription that should be used toocreate your Elastic Search cluster.</span></span> <span data-ttu-id="25462-146">Проверить, правильно ли выбрана подписка, можно с помощью командлетов `Get-AzureRmContext` и `Get-AzureRmSubscription`.</span><span class="sxs-lookup"><span data-stu-id="25462-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="25462-147">Если вы еще не сделали этого, измените hello в папку текущего каталога toohello ES MultiNode.</span><span class="sxs-lookup"><span data-stu-id="25462-147">If you haven't done so already, change hello current directory toohello ES-MultiNode folder.</span></span>

### <a name="run-hello-createelasticsearchcluster-script"></a><span data-ttu-id="25462-148">Запустите сценарий CreateElasticSearchCluster hello</span><span class="sxs-lookup"><span data-stu-id="25462-148">Run hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="25462-149">Перед запуском сценария Привет открыть hello `azuredeploy-parameters.json` файл и проверьте либо указать значения для параметров сценария hello.</span><span class="sxs-lookup"><span data-stu-id="25462-149">Before you run hello script, open hello `azuredeploy-parameters.json` file and verify or provide values for hello script parameters.</span></span> <span data-ttu-id="25462-150">предоставляются следующие параметры Hello.</span><span class="sxs-lookup"><span data-stu-id="25462-150">hello following parameters are provided:</span></span>

| <span data-ttu-id="25462-151">Имя параметра</span><span class="sxs-lookup"><span data-stu-id="25462-151">Parameter Name</span></span> | <span data-ttu-id="25462-152">Описание</span><span class="sxs-lookup"><span data-stu-id="25462-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="25462-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="25462-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="25462-154">Имя Hello, используемые toocreate hello публично видимых DNS-имя кластера эластичной поиска hello (путем добавления toohello указано доменное имя для hello регион Azure).</span><span class="sxs-lookup"><span data-stu-id="25462-154">hello name that is used toocreate hello publicly visible DNS name for hello Elastic Search cluster (by appending hello Azure region domain toohello provided name).</span></span> <span data-ttu-id="25462-155">Например если значение этого параметра — «myBigCluster» и hello выбранный регион Azure находится Запад США, hello результирующее имя DNS для кластера hello — myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="25462-155">For example, if this parameter value is "myBigCluster" and hello chosen Azure region is West US, hello resulting DNS name for hello cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="25462-156">Это имя также служит в качестве корневое имя для многих артефактов, связанных с кластером hello эластичной поиска, такие как имена узлов данных.</span><span class="sxs-lookup"><span data-stu-id="25462-156">This name also serves as a root name for many artifacts associated with hello Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="25462-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="25462-157">adminUsername</span></span> |<span data-ttu-id="25462-158">Имя Hello hello учетной записи администратора по управлению кластером эластичной поиска hello (автоматически создаются соответствующие ключи SSH).</span><span class="sxs-lookup"><span data-stu-id="25462-158">hello name of hello administrator account for managing hello Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="25462-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="25462-159">dataNodeCount</span></span> |<span data-ttu-id="25462-160">количество узлов в кластере эластичной поиска hello Hello.</span><span class="sxs-lookup"><span data-stu-id="25462-160">hello number of nodes in hello Elastic Search cluster.</span></span> <span data-ttu-id="25462-161">Текущая версия скрипта hello Hello не различает узлы данных и запросов; все узлы воспроизвести обеих ролей.</span><span class="sxs-lookup"><span data-stu-id="25462-161">hello current version of hello script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="25462-162">Узлы too3 значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="25462-162">Defaults too3 nodes.</span></span> |
| <span data-ttu-id="25462-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="25462-163">dataDiskSize</span></span> |<span data-ttu-id="25462-164">размер Hello дисков данных (в ГБ), выделяемый для каждого узла данных.</span><span class="sxs-lookup"><span data-stu-id="25462-164">hello size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="25462-165">Каждый узел получает 4 дисков данных, специально выделенном tooElastic службы поиска.</span><span class="sxs-lookup"><span data-stu-id="25462-165">Each node receives 4 data disks, exclusively dedicated tooElastic Search service.</span></span> |
| <span data-ttu-id="25462-166">region</span><span class="sxs-lookup"><span data-stu-id="25462-166">region</span></span> |<span data-ttu-id="25462-167">Имя Hello регион Azure, где следует разместить hello эластичной поиска кластера.</span><span class="sxs-lookup"><span data-stu-id="25462-167">hello name of Azure region where hello Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="25462-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="25462-168">esUserName</span></span> |<span data-ttu-id="25462-169">Hello имя пользователя hello, настроить кластера tooES toohave доступа (тема tooHTTP обычной проверки подлинности).</span><span class="sxs-lookup"><span data-stu-id="25462-169">hello user name of hello user that is configured toohave access tooES cluster (subject tooHTTP basic authentication).</span></span> <span data-ttu-id="25462-170">Hello пароль не является частью файла параметров и должно быть обеспечено при `CreateElasticSearchCluster` запуске сценария.</span><span class="sxs-lookup"><span data-stu-id="25462-170">hello password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="25462-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="25462-171">vmSizeDataNodes</span></span> |<span data-ttu-id="25462-172">Hello Azure размер виртуальной машины для узлов кластера эластичной поиска.</span><span class="sxs-lookup"><span data-stu-id="25462-172">hello Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="25462-173">TooStandard_D2 значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="25462-173">Defaults tooStandard_D2.</span></span> |

<span data-ttu-id="25462-174">Теперь все готово toorun hello скрипта.</span><span class="sxs-lookup"><span data-stu-id="25462-174">Now you are ready toorun hello script.</span></span> <span data-ttu-id="25462-175">Проблема hello следующую команду:</span><span class="sxs-lookup"><span data-stu-id="25462-175">Issue hello following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="25462-176">где:</span><span class="sxs-lookup"><span data-stu-id="25462-176">where</span></span> 

| <span data-ttu-id="25462-177">Имя параметра скрипта</span><span class="sxs-lookup"><span data-stu-id="25462-177">Script Parameter Name</span></span> | <span data-ttu-id="25462-178">Описание</span><span class="sxs-lookup"><span data-stu-id="25462-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="25462-179">Имя группы ресурсов Azure hello, который будет содержать все ресурсы кластера эластичной поиска Hello.</span><span class="sxs-lookup"><span data-stu-id="25462-179">hello name of hello Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="25462-180">Имя Hello hello регион Azure, которой должен быть создан hello эластичной поиска кластера.</span><span class="sxs-lookup"><span data-stu-id="25462-180">hello name of hello Azure region where hello Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="25462-181">Hello пароль для пользователя эластичной поиска hello.</span><span class="sxs-lookup"><span data-stu-id="25462-181">hello password for hello Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="25462-182">При появлении исключения NullReferenceException из командлета hello AzureResourceGroup теста, вы забыли toolog на tooAzure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="25462-182">If you get a NullReferenceException from hello Test-AzureResourceGroup cmdlet, you have forgotten toolog on tooAzure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="25462-183">Если появляется сообщение об ошибке из выполнения сценария hello и определить, что hello ошибка вызвана значение параметра неправильный шаблон, исправьте файл параметров hello и снова запустите скрипт hello с именем группы ресурсов, отличной.</span><span class="sxs-lookup"><span data-stu-id="25462-183">If you get an error from running hello script and you determine that hello error was caused by a wrong template parameter value, correct hello parameter file and run hello script again with a different resource group name.</span></span> <span data-ttu-id="25462-184">Кроме того, можно использовать повторно hello одинаковые имена групп ресурсов и иметь hello скрипт очистки hello старого, добавив hello `-RemoveExistingResourceGroup` вызов сценария toohello параметра.</span><span class="sxs-lookup"><span data-stu-id="25462-184">You can also reuse hello same resource group name and have hello script clean up hello old one by adding hello `-RemoveExistingResourceGroup` parameter toohello script invocation.</span></span>

### <a name="result-of-running-hello-createelasticsearchcluster-script"></a><span data-ttu-id="25462-185">Результат выполнения сценария CreateElasticSearchCluster hello</span><span class="sxs-lookup"><span data-stu-id="25462-185">Result of running hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="25462-186">После запуска hello `CreateElasticSearchCluster` скрипта, будут созданы следующие основные артефакты hello.</span><span class="sxs-lookup"><span data-stu-id="25462-186">After you run hello `CreateElasticSearchCluster` script, hello following main artifacts will be created.</span></span> <span data-ttu-id="25462-187">В этом примере предполагается, что «myBigCluster» используется в качестве значения hello hello `dnsNameForLoadBalancerIP` параметр и этого hello региона, где была создана hello кластера является Запад США.</span><span class="sxs-lookup"><span data-stu-id="25462-187">For this example we assume that you have used "myBigCluster" as hello value of hello `dnsNameForLoadBalancerIP` parameter and that hello region where you created hello cluster is West US.</span></span>

| <span data-ttu-id="25462-188">Артефакт</span><span class="sxs-lookup"><span data-stu-id="25462-188">Artifact</span></span> | <span data-ttu-id="25462-189">Имя, расположение и примечания</span><span class="sxs-lookup"><span data-stu-id="25462-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="25462-190">Ключ SSH для удаленного администрирования</span><span class="sxs-lookup"><span data-stu-id="25462-190">SSH key for remote administration</span></span> |<span data-ttu-id="25462-191">файл myBigCluster.key (в каталоге hello, из которого hello CreateElasticSearchCluster была запущена).</span><span class="sxs-lookup"><span data-stu-id="25462-191">myBigCluster.key file (in hello directory from which hello CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="25462-192">Данный файл ключа может быть узел администрирования используется tooconnect toohello и (через узел администрирования hello) toodata узлов в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="25462-192">This key file can be used tooconnect toohello admin node and (through hello admin node) toodata nodes in hello cluster.</span></span> |
| <span data-ttu-id="25462-193">Узел администрирования</span><span class="sxs-lookup"><span data-stu-id="25462-193">Admin node</span></span> |<span data-ttu-id="25462-194">myBigCluster-admin.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="25462-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="25462-195">Выделенной виртуальной Машины для удаленного администрирования кластера Elasticsearch--hello только один из них обеспечивает внешних соединений по протоколу SSH.</span><span class="sxs-lookup"><span data-stu-id="25462-195">A dedicated VM for remote Elasticsearch cluster administration--hello only one that allows external SSH connections.</span></span> <span data-ttu-id="25462-196">Он выполняется на hello же виртуальной сети, что все узлы кластера Elasticsearch hello, но он не не запускайте все службы Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="25462-196">It runs on hello same virtual network as all hello Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="25462-197">Узлы данных</span><span class="sxs-lookup"><span data-stu-id="25462-197">Data nodes</span></span> |<span data-ttu-id="25462-198">myBigCluster1–</span><span class="sxs-lookup"><span data-stu-id="25462-198">myBigCluster1 …</span></span> <span data-ttu-id="25462-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="25462-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="25462-200">Узлы данных, на которых работают службы ElasticSearch и Kibana.</span><span class="sxs-lookup"><span data-stu-id="25462-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="25462-201">Вы можете подключиться через SSH tooeach узла, но только через узел администрирования hello.</span><span class="sxs-lookup"><span data-stu-id="25462-201">You can connect via SSH tooeach node, but only via hello admin node.</span></span> |
| <span data-ttu-id="25462-202">Кластер Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="25462-202">Elasticsearch cluster</span></span> |<span data-ttu-id="25462-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="25462-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="25462-204">Hello основную конечную точку для кластера Elasticsearch hello (Примечание hello /es суффикс).</span><span class="sxs-lookup"><span data-stu-id="25462-204">hello primary endpoint for hello Elasticsearch cluster (note hello /es suffix).</span></span> <span data-ttu-id="25462-205">Используется обычная проверка подлинности HTTP (hello учетные данные были hello указанных параметров esUserName/esPassword шаблона hello ES MultiNode).</span><span class="sxs-lookup"><span data-stu-id="25462-205">It is protected by basic HTTP authentication (hello credentials were hello specified esUserName/esPassword parameters of hello ES-MultiNode template).</span></span> <span data-ttu-id="25462-206">кластер Hello также имеет hello head подключаемый модуль установлен (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) для администрирования базового кластера.</span><span class="sxs-lookup"><span data-stu-id="25462-206">hello cluster has also hello head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="25462-207">Служба Kibana</span><span class="sxs-lookup"><span data-stu-id="25462-207">Kibana service</span></span> |<span data-ttu-id="25462-208">http://myBigCluster.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="25462-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="25462-209">Hello Kibana службы, Настройка tooshow данных из hello создания кластера Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="25462-209">hello Kibana service is set up tooshow data from hello created Elasticsearch cluster.</span></span> <span data-ttu-id="25462-210">Он защищен hello же учетные данные проверки подлинности как hello кластера сам.</span><span class="sxs-lookup"><span data-stu-id="25462-210">It is protected by hello same authentication credentials as hello cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="25462-211">Внутрипроцессная и внепроцессная запись данных трассировки</span><span class="sxs-lookup"><span data-stu-id="25462-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="25462-212">В введение hello упоминалось два основных способа сбора диагностических данных: в процессе и out of process.</span><span class="sxs-lookup"><span data-stu-id="25462-212">In hello introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="25462-213">Каждый имеет свои преимущества и недостатки.</span><span class="sxs-lookup"><span data-stu-id="25462-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="25462-214">Преимущества hello **процесс записи трассировки** включают:</span><span class="sxs-lookup"><span data-stu-id="25462-214">Advantages of hello **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="25462-215">*Простая настройка и развертывание.*</span><span class="sxs-lookup"><span data-stu-id="25462-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="25462-216">Конфигурация Hello сбора диагностических данных — просто частью конфигурации приложения hello.</span><span class="sxs-lookup"><span data-stu-id="25462-216">hello configuration of diagnostic data collection is just part of hello application configuration.</span></span> <span data-ttu-id="25462-217">Это легко tooalways оставить его «синхронизировано» с hello остальной части приложения hello.</span><span class="sxs-lookup"><span data-stu-id="25462-217">It is easy tooalways keep it "in sync" with hello rest of hello application.</span></span>
   * <span data-ttu-id="25462-218">Настройка каждого приложения или службы также является несложной задачей.</span><span class="sxs-lookup"><span data-stu-id="25462-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="25462-219">Захват трассировки out of process обычно требуется отдельное развертывание и конфигурация диагностики агента hello, лишние административную задачу и потенциальный источник ошибок.</span><span class="sxs-lookup"><span data-stu-id="25462-219">Out-of-process trace capturing usually requires a separate deployment and configuration of hello diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="25462-220">Технология определенного агента Hello часто позволяет только один экземпляр агента hello на каждую виртуальную машину (узел).</span><span class="sxs-lookup"><span data-stu-id="25462-220">hello particular agent technology often allows only one instance of hello agent per virtual machine (node).</span></span> <span data-ttu-id="25462-221">Это означает этой конфигурации для hello коллекцию конфигурации диагностики hello является общим для всех приложений и служб, работающих на этом узле.</span><span class="sxs-lookup"><span data-stu-id="25462-221">This means that configuration for hello collection of hello diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="25462-222">*Гибкость*</span><span class="sxs-lookup"><span data-stu-id="25462-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="25462-223">Hello приложение может отправлять данные hello везде, где он должен toogo, при условии, что имеется клиентская библиотека, которая поддерживает hello целевые системы хранения данных.</span><span class="sxs-lookup"><span data-stu-id="25462-223">hello application can send hello data wherever it needs toogo, as long as there is a client library that supports hello targeted data storage system.</span></span> <span data-ttu-id="25462-224">При необходимости можно добавлять новые приемники.</span><span class="sxs-lookup"><span data-stu-id="25462-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="25462-225">Можно реализовать сложные правила сбора, фильтрации и статистической обработки данных.</span><span class="sxs-lookup"><span data-stu-id="25462-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="25462-226">Захват трассировки out of process часто ограничивается hello данных приемников, которые поддерживает агент hello.</span><span class="sxs-lookup"><span data-stu-id="25462-226">An out-of-process trace capturing is often limited by hello data sinks that hello agent supports.</span></span> <span data-ttu-id="25462-227">Некоторые агенты являются расширяемыми.</span><span class="sxs-lookup"><span data-stu-id="25462-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="25462-228">*Доступ к данным приложения toointernal и контекстом*</span><span class="sxs-lookup"><span data-stu-id="25462-228">*Access toointernal application data and context*</span></span>
   
   * <span data-ttu-id="25462-229">Hello диагностики подсистемы, выполняющиеся внутри процесса hello приложения или службы можно легко дополнить hello трассировок с помощью контекстных сведений.</span><span class="sxs-lookup"><span data-stu-id="25462-229">hello diagnostic subsystem running inside hello application/service process can easily augment hello traces with contextual information.</span></span>
   * <span data-ttu-id="25462-230">В подходе out of process hello hello данных должны отправляться агента tooan через механизм межпроцессного взаимодействия например трассировки событий Windows.</span><span class="sxs-lookup"><span data-stu-id="25462-230">In hello out-of-process approach, hello data must be sent tooan agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="25462-231">Однако при таком механизме могут возникнуть дополнительные ограничения.</span><span class="sxs-lookup"><span data-stu-id="25462-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="25462-232">Преимущества hello **захват трассировки out of process** включают:</span><span class="sxs-lookup"><span data-stu-id="25462-232">Advantages of hello **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="25462-233">*Здравствуйте, приложение hello toomonitor возможности и сбор аварийных дампов*</span><span class="sxs-lookup"><span data-stu-id="25462-233">*hello ability toomonitor hello application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="25462-234">Захват в процесс трассировки может быть неудачной, если приложение hello сбоя toostart или аварийно завершает работу.</span><span class="sxs-lookup"><span data-stu-id="25462-234">In-process trace capturing may be unsuccessful if hello application fails toostart or crashes.</span></span> <span data-ttu-id="25462-235">Независимый агент имеет гораздо больше шансов собрать важные сведения для устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="25462-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="25462-236">*Зрелость, надежность и высокая производительность*</span><span class="sxs-lookup"><span data-stu-id="25462-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="25462-237">Поставщик платформы (например, агент диагностики Microsoft Azure), разработанный агент был toorigorous субъекта, тестирования и усиление Битва.</span><span class="sxs-lookup"><span data-stu-id="25462-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject toorigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="25462-238">В процессе трассировки записи необходимо соблюдать осторожность tooensure действие hello передачи диагностических данных из процесса приложения не мешать основных задач приложения hello или вызвать проблемы синхронизации или производительности.</span><span class="sxs-lookup"><span data-stu-id="25462-238">With in-process trace capturing, care must be taken tooensure that hello activity of sending diagnostic data from an application process does not interfere with hello application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="25462-239">Независимо друг от друга агента является менее подвержены возникновению проблем toothese и специально разработанные toolimit его воздействие на систему hello.</span><span class="sxs-lookup"><span data-stu-id="25462-239">An independently running agent is less prone toothese issues and is specifically designed toolimit its impact on hello system.</span></span>

<span data-ttu-id="25462-240">Это возможно toocombine и преимущества обоих подходов.</span><span class="sxs-lookup"><span data-stu-id="25462-240">It is possible toocombine and benefit from both approaches.</span></span> <span data-ttu-id="25462-241">На самом деле бывает hello наилучшим решением для многих приложений.</span><span class="sxs-lookup"><span data-stu-id="25462-241">Indeed, it might be hello best solution for many applications.</span></span>

<span data-ttu-id="25462-242">Здесь мы используем hello **Microsoft.Diagnostic.Listeners библиотеки** и hello в процессе трассировки сбор данных toosend из кластера Service Fabric приложения tooan Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="25462-242">Here, we use hello **Microsoft.Diagnostic.Listeners library** and hello in-process trace capturing toosend data from a Service Fabric application tooan Elasticsearch cluster.</span></span>

## <a name="use-hello-listeners-library-toosend-diagnostic-data-tooelasticsearch"></a><span data-ttu-id="25462-243">Используйте hello прослушиватели библиотеки toosend диагностических данных tooElasticsearch</span><span class="sxs-lookup"><span data-stu-id="25462-243">Use hello Listeners library toosend diagnostic data tooElasticsearch</span></span>
<span data-ttu-id="25462-244">Библиотека Microsoft.Diagnostic.Listeners Hello является частью PartyCluster образец приложения Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="25462-244">hello Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="25462-245">toouse его:</span><span class="sxs-lookup"><span data-stu-id="25462-245">toouse it:</span></span>

1. <span data-ttu-id="25462-246">Загрузить [PartyCluster образец hello](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) из GitHub.</span><span class="sxs-lookup"><span data-stu-id="25462-246">Download [hello PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="25462-247">Копировать из hello PartyCluster directory toohello решения папки образца приложения hello, который должен toosend hello данных tooElasticsearch hello Microsoft.Diagnostics.Listeners и Microsoft.Diagnostics.Listeners.Fabric проекты (всей папки) .</span><span class="sxs-lookup"><span data-stu-id="25462-247">Copy hello Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from hello PartyCluster sample directory toohello solution folder of hello application that is supposed toosend hello data tooElasticsearch.</span></span>
3. <span data-ttu-id="25462-248">Откройте решение целевой hello, щелкните правой кнопкой мыши узел решения hello в hello в обозревателе решений и выберите **Добавление существующего проекта**.</span><span class="sxs-lookup"><span data-stu-id="25462-248">Open hello target solution, right-click hello solution node in hello Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="25462-249">Добавьте проект toohello hello Microsoft.Diagnostics.Listeners решение.</span><span class="sxs-lookup"><span data-stu-id="25462-249">Add hello Microsoft.Diagnostics.Listeners project toohello solution.</span></span> <span data-ttu-id="25462-250">Повторите эти шаги hello же hello Microsoft.Diagnostics.Listeners.Fabric проекта.</span><span class="sxs-lookup"><span data-stu-id="25462-250">Repeat hello same for hello Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="25462-251">Добавьте ссылку на проект из службы проекты toohello двух добавленных проектов.</span><span class="sxs-lookup"><span data-stu-id="25462-251">Add a project reference from your service project(s) toohello two added projects.</span></span> <span data-ttu-id="25462-252">(Microsoft.Diagnostics.EventListeners и Microsoft.Diagnostics.EventListeners.Fabric должен ссылаться каждой службы, который должен tooElasticsearch toosend данных).</span><span class="sxs-lookup"><span data-stu-id="25462-252">(Each service that is supposed toosend data tooElasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Проект ссылается на tooMicrosoft.Diagnostics.EventListeners и Microsoft.Diagnostics.EventListeners.Fabric библиотеки][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="25462-254">Общедоступная версия Service Fabric и пакет Microsoft.Diagnostics.Tracing NuGet</span><span class="sxs-lookup"><span data-stu-id="25462-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="25462-255">Приложения, основанные на общедоступной версии Service Fabric (версия 2.0.135 от 31 марта 2016 года), нацелены на платформу **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="25462-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="25462-256">Эта версия предназначена hello самую новую версию hello поддерживается Azure во время hello hello Общедоступной версии .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="25462-256">This version is hello highest version of hello .NET Framework supported by Azure at hello time of hello GA release.</span></span> <span data-ttu-id="25462-257">К сожалению эта версия hello framework отсутствуют некоторые EventListener API, требуется библиотека Microsoft.Diagnostics.Listeners hello.</span><span class="sxs-lookup"><span data-stu-id="25462-257">Unfortunately, this version of hello framework lacks certain EventListener APIs that hello Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="25462-258">Поскольку EventSource (hello компонент, являющийся основой hello ведения журнала интерфейсы API в приложениях структуры) и EventListener тесно связаны, каждый проект, использующий библиотеку Microsoft.Diagnostics.Listeners hello необходимо использовать альтернативной реализации EventSource.</span><span class="sxs-lookup"><span data-stu-id="25462-258">Because EventSource (hello component that forms hello basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses hello Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="25462-259">Эта реализация обеспечивается hello **пакет Microsoft.Diagnostics.Tracing Nuget**, разработанный корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="25462-259">This implementation is provided by hello **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="25462-260">пакет Hello полной обратной совместимостью с EventSource включаются в hello framework, поэтому изменять код не должно возникать необходимости отличные от имен, на которую указывает ссылка.</span><span class="sxs-lookup"><span data-stu-id="25462-260">hello package is fully backward-compatible with EventSource included in hello framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="25462-261">toostart с помощью реализации Microsoft.Diagnostics.Tracing hello класса EventSource hello, выполните следующие действия для каждого проекта службы, который должен tooElasticsearch toosend данных:</span><span class="sxs-lookup"><span data-stu-id="25462-261">toostart using hello Microsoft.Diagnostics.Tracing implementation of hello EventSource class, follow these steps for each service project that needs toosend data tooElasticsearch:</span></span>

1. <span data-ttu-id="25462-262">Правой кнопкой мыши проект службы hello и выберите **управление пакетами Nuget**.</span><span class="sxs-lookup"><span data-stu-id="25462-262">Right-click on hello service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="25462-263">Переключение источника пакета toohello nuget.org (если он не установлен) и выполните поиск «**Microsoft.Diagnostics.Tracing**».</span><span class="sxs-lookup"><span data-stu-id="25462-263">Switch toohello nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="25462-264">Установка hello `Microsoft.Diagnostics.Tracing.EventSource` пакет (и его зависимости).</span><span class="sxs-lookup"><span data-stu-id="25462-264">Install hello `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="25462-265">Откройте hello **ServiceEventSource.cs** или **ActorEventSource.cs** в проекте службы и замените hello `using System.Diagnostics.Tracing` директив поверх hello файл с hello `using Microsoft.Diagnostics.Tracing` директивы.</span><span class="sxs-lookup"><span data-stu-id="25462-265">Open hello **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace hello `using System.Diagnostics.Tracing` directive on top of hello file with hello `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="25462-266">Эти действия не будет требоваться один раз hello **.NET Framework 4.6** поддерживается в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="25462-266">These steps will not be necessary once hello **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="25462-267">Создание и настройка экземпляра прослушивателя ElasticSearch</span><span class="sxs-lookup"><span data-stu-id="25462-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="25462-268">Hello последним шагом для отправки tooElasticsearch диагностических данных является toocreate экземпляр `ElasticSearchListener` и настройте его с данными подключения Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="25462-268">hello final step for sending diagnostic data tooElasticsearch is toocreate an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="25462-269">прослушиватель Hello автоматически захватывает всех событий, вызванных через EventSource классов, определенных в проекте службы hello.</span><span class="sxs-lookup"><span data-stu-id="25462-269">hello listener automatically captures all events raised via EventSource classes defined in hello service project.</span></span> <span data-ttu-id="25462-270">Ему toobe активности во время существования hello службы hello, наиболее hello размещать toocreate, где находится hello код инициализации службы.</span><span class="sxs-lookup"><span data-stu-id="25462-270">It needs toobe alive during hello lifetime of hello service, so hello best place toocreate it is in hello service initialization code.</span></span> <span data-ttu-id="25462-271">Код инициализации hello для службы без отслеживания состояния может выглядеть после hello необходимые изменения (указано дополнения в комментарии, начиная с `****`):</span><span class="sxs-lookup"><span data-stu-id="25462-271">Here is how hello initialization code for a stateless service could look after hello necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add hello following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is hello entry point of hello service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // hello ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name tooa .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of hello class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that hello ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="25462-272">Данные подключения Elasticsearch должны быть помещены в отдельный раздел в файле конфигурации службы hello (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="25462-272">Elasticsearch connection data should be put in a separate section in hello service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="25462-273">Имя Hello hello раздела должно соответствовать toohello значению, переданному в toohello `FabricConfigurationProvider` конструктор, например:</span><span class="sxs-lookup"><span data-stu-id="25462-273">hello name of hello section must correspond toohello value passed toohello `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="25462-274">Здравствуйте, значения `serviceUri`, `userName` и `password` параметров соответствуют адрес конечной точки кластера Elasticsearch toohello, Elasticsearch имя пользователя и пароль, соответственно.</span><span class="sxs-lookup"><span data-stu-id="25462-274">hello values of `serviceUri`, `userName` and `password` parameters correspond toohello Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="25462-275">`indexNamePrefix`— префикс hello Elasticsearch индексов; Библиотека Microsoft.Diagnostics.Listeners Hello ежедневно создает новый индекс для своих данных.</span><span class="sxs-lookup"><span data-stu-id="25462-275">`indexNamePrefix` is hello prefix for Elasticsearch indexes; hello Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="25462-276">Проверка</span><span class="sxs-lookup"><span data-stu-id="25462-276">Verification</span></span>
<span data-ttu-id="25462-277">Вот и все!</span><span class="sxs-lookup"><span data-stu-id="25462-277">That's it!</span></span> <span data-ttu-id="25462-278">Теперь при запуске службы hello начинается отправка трассировок toohello Elasticsearch службы, указанной в конфигурации hello.</span><span class="sxs-lookup"><span data-stu-id="25462-278">Now, whenever hello service is run, it starts sending traces toohello Elasticsearch service specified in hello configuration.</span></span> <span data-ttu-id="25462-279">Это можно проверить, открывающей hello Kibana пользовательского интерфейса, связанного с hello целевого экземпляра Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="25462-279">You can verify this by opening hello Kibana UI associated with hello target Elasticsearch instance.</span></span> <span data-ttu-id="25462-280">В нашем примере адрес страницы приветствия — http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="25462-280">In our example, hello page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="25462-281">Убедитесь, что индексы с префиксом имени hello, выбранные для hello `ElasticSearchListener` экземпляр действительно были создается и заполняется данными.</span><span class="sxs-lookup"><span data-stu-id="25462-281">Check that indexes with hello name prefix chosen for hello `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Отображение событий приложения PartyCluster в службе Kibana][2]

## <a name="next-steps"></a><span data-ttu-id="25462-283">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="25462-283">Next steps</span></span>
* [<span data-ttu-id="25462-284">Дополнительные сведения о диагностике и мониторинге службы Service Fabric</span><span class="sxs-lookup"><span data-stu-id="25462-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
