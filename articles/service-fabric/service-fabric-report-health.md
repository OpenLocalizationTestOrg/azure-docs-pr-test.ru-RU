---
title: "aaaAdd пользовательские отчеты о работоспособности Service Fabric | Документы Microsoft"
description: "Описывает, как отчеты о работоспособности пользовательских toosend tooAzure Service Fabric работоспособные сущности. Здесь собраны рекомендации по разработке и реализации качественных отчетов о работоспособности."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 12c9f664e2a457b4e1e8f340873ca60ebcefb097
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="5adcf-104">Добавление настраиваемых отчетов о работоспособности Service Fabric</span><span class="sxs-lookup"><span data-stu-id="5adcf-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="5adcf-105">Представляет Azure Service Fabric [модель работоспособности](service-fabric-health-introduction.md) tooflag неработоспособное кластера и условия приложения для конкретных объектов.</span><span class="sxs-lookup"><span data-stu-id="5adcf-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed tooflag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="5adcf-106">использует модель работоспособности Hello **работоспособности "создатели отчетов"** (компоненты системы и watchdogs).</span><span class="sxs-lookup"><span data-stu-id="5adcf-106">hello health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="5adcf-107">Задача Hello — простой и быстрой диагностики и восстановления.</span><span class="sxs-lookup"><span data-stu-id="5adcf-107">hello goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="5adcf-108">Записи с помощью службы должны заранее toothink о работоспособности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-108">Service writers need toothink upfront about health.</span></span> <span data-ttu-id="5adcf-109">Любое условие, которое может повлиять на работоспособность должны создаваться отчеты, особенно в том случае, если он может помочь флаг проблемы закройте toohello корневой.</span><span class="sxs-lookup"><span data-stu-id="5adcf-109">Any condition that can impact health should be reported on, especially if it can help flag problems close toohello root.</span></span> <span data-ttu-id="5adcf-110">сведения о работоспособности Hello можно сэкономить время и усилия на изучении и отладки.</span><span class="sxs-lookup"><span data-stu-id="5adcf-110">hello health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="5adcf-111">Hello полезность снят особенно после hello службы работает в масштабе в облаке hello (частный или Azure).</span><span class="sxs-lookup"><span data-stu-id="5adcf-111">hello usefulness is especially clear once hello service is up and running at scale in hello cloud (private or Azure).</span></span>

<span data-ttu-id="5adcf-112">монитор "создатели отчетов" Hello Service Fabric определенные условия, представляющие интерес.</span><span class="sxs-lookup"><span data-stu-id="5adcf-112">hello Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="5adcf-113">Они сообщают об этих условиях на основе своего локального представления.</span><span class="sxs-lookup"><span data-stu-id="5adcf-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="5adcf-114">Hello [базе данных health store](service-fabric-health-introduction.md#health-store) собирает данные о работоспособности отправленных все toodetermine "создатели отчетов" ли сущностей глобально работоспособны.</span><span class="sxs-lookup"><span data-stu-id="5adcf-114">hello [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters toodetermine whether entities are globally healthy.</span></span> <span data-ttu-id="5adcf-115">модель Hello является предполагаемым toobe toouse широкий, гибкий и простой.</span><span class="sxs-lookup"><span data-stu-id="5adcf-115">hello model is intended toobe rich, flexible, and easy toouse.</span></span> <span data-ttu-id="5adcf-116">качество Hello hello отчетов о работоспособности определяет точность hello hello представление работоспособности кластера hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-116">hello quality of hello health reports determines hello accuracy of hello health view of hello cluster.</span></span> <span data-ttu-id="5adcf-117">Ложные положительные результаты, которые неправильно отображают проблемы работоспособности, могут отрицательно повлиять на обновления или другие службы, использующие данные о работоспособности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="5adcf-118">В качестве примеров можно вспомнить службы восстановления и механизмы предупреждений.</span><span class="sxs-lookup"><span data-stu-id="5adcf-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="5adcf-119">Таким образом, особое внимание — необходимые tooprovide отчеты, отображающие условия интересуют hello лучшего из возможных путей.</span><span class="sxs-lookup"><span data-stu-id="5adcf-119">Therefore, some thought is needed tooprovide reports that capture conditions of interest in hello best possible way.</span></span>

<span data-ttu-id="5adcf-120">toodesign и реализуйте работоспособности reporting watchdogs компоненты и система должна:</span><span class="sxs-lookup"><span data-stu-id="5adcf-120">toodesign and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="5adcf-121">Определите условие hello интересующих их, hello, как он осуществляет мониторинг и hello степени влияет на функциональные возможности кластера или приложение hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-121">Define hello condition they are interested in, hello way it is monitored, and hello impact on hello cluster or application functionality.</span></span> <span data-ttu-id="5adcf-122">На основе этих сведений, выберите hello отчета свойства и состояния работоспособности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-122">Based on this information, decide on hello health report property and health state.</span></span>
* <span data-ttu-id="5adcf-123">Определить hello [сущности](service-fabric-health-introduction.md#health-entities-and-hierarchy) что hello отчета применяется.</span><span class="sxs-lookup"><span data-stu-id="5adcf-123">Determine hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that hello report applies to.</span></span>
* <span data-ttu-id="5adcf-124">Определить, где выполняется hello reporting, изнутри hello службы или из внутреннего или внешнего наблюдения.</span><span class="sxs-lookup"><span data-stu-id="5adcf-124">Determine where hello reporting is done, from within hello service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="5adcf-125">Определите средства формирования отчетов для используемого источника tooidentify hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-125">Define a source used tooidentify hello reporter.</span></span>
* <span data-ttu-id="5adcf-126">Выберите стратегию создания отчетов — периодическую или на основе переходов.</span><span class="sxs-lookup"><span data-stu-id="5adcf-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="5adcf-127">в том числе периодически, как она требует более простой код и менее подвержены возникновению tooerrors рекомендуемые Hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-127">hello recommended way is periodically, as it requires simpler code and is less prone tooerrors.</span></span>
* <span data-ttu-id="5adcf-128">Определите продолжительность отчетов hello неработоспособное условия должны оставаться в базе данных health store hello и о том, как должна быть удалена.</span><span class="sxs-lookup"><span data-stu-id="5adcf-128">Determine how long hello report for unhealthy conditions should stay in hello health store and how it should be cleared.</span></span> <span data-ttu-id="5adcf-129">Используя эту информацию, решите, поведение во время toolive и удалить на истечение срока действия отчета hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-129">Using this information, decide hello report's time toolive and remove-on-expiration behavior.</span></span>

<span data-ttu-id="5adcf-130">Как упоминалось выше, отчет могут создавать следующие компоненты.</span><span class="sxs-lookup"><span data-stu-id="5adcf-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="5adcf-131">Hello мониторинг реплики службы Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="5adcf-131">hello monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="5adcf-132">Внутренние устройства наблюдения, развернутые как служба Service Fabric (например, служба без отслеживания состояния Service Fabric, которая проверяет условия и формирует отчеты).</span><span class="sxs-lookup"><span data-stu-id="5adcf-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="5adcf-133">Hello watchdogs могут быть развернуты все узлы или непотоковой toohello отслеживаться службой.</span><span class="sxs-lookup"><span data-stu-id="5adcf-133">hello watchdogs can be deployed an all nodes or can be affinitized toohello monitored service.</span></span>
* <span data-ttu-id="5adcf-134">Внутренняя watchdogs, выполняются на узлах Service Fabric hello, но *не* реализован в виде служб Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="5adcf-134">Internal watchdogs that run on hello Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="5adcf-135">Внешние watchdogs этого ресурса hello выборки из *за пределами* кластера Service Fabric hello (например, службы мониторинга как Gomez).</span><span class="sxs-lookup"><span data-stu-id="5adcf-135">External watchdogs that probe hello resource from *outside* hello Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="5adcf-136">В стандартной hello кластера hello заполняется работоспособности отчеты, отправляемые компонентами системы hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-136">Out of hello box, hello cluster is populated with health reports sent by hello system components.</span></span> <span data-ttu-id="5adcf-137">Подробнее об этом читайте в статье [Использование отчетов о работоспособности системы для устранения неполадок](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="5adcf-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="5adcf-138">Hello пользовательские отчеты должны быть отправлены [работоспособные сущности](service-fabric-health-introduction.md#health-entities-and-hierarchy) , уже созданных системой hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-138">hello user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by hello system.</span></span>
> 
> 

<span data-ttu-id="5adcf-139">Один раз hello конструктора отчетов работоспособности снят, можно легко отправить отчеты о работоспособности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-139">Once hello health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="5adcf-140">Можно использовать [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport работоспособности, если кластер hello не [безопасного](service-fabric-cluster-security.md) или если hello клиента Fabric имеет права администратора.</span><span class="sxs-lookup"><span data-stu-id="5adcf-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport health if hello cluster is not [secure](service-fabric-cluster-security.md) or if hello fabric client has admin privileges.</span></span> <span data-ttu-id="5adcf-141">Отчеты можно сделать с помощью hello API, с помощью [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), с помощью PowerShell или через REST.</span><span class="sxs-lookup"><span data-stu-id="5adcf-141">Reporting can be done through hello API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="5adcf-142">Повысить производительность можно с помощью настройки пакетных отчетов.</span><span class="sxs-lookup"><span data-stu-id="5adcf-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="5adcf-143">Отчет о работоспособности является синхронным, и он представляет hello рабочих проверки на стороне клиента hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-143">Report health is synchronous, and it represents only hello validation work on hello client side.</span></span> <span data-ttu-id="5adcf-144">Hello факт, что отчет hello принимается hello работоспособности клиента или hello `Partition` или `CodePackageActivationContext` объектов не означает, что применяется в хранилище hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-144">hello fact that hello report is accepted by hello health client or hello `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in hello store.</span></span> <span data-ttu-id="5adcf-145">Он будет отправлен асинхронно и, возможно, объединен с другими отчетами.</span><span class="sxs-lookup"><span data-stu-id="5adcf-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="5adcf-146">Обработка на сервере hello Hello может привести к сбою: hello порядковый номер может быть устаревшим, hello сущности, на какие hello должен применяться отчет был удален, и т. д.</span><span class="sxs-lookup"><span data-stu-id="5adcf-146">hello processing on hello server may still fail: hello sequence number could be stale, hello entity on which hello report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="5adcf-147">Клиент работоспособности</span><span class="sxs-lookup"><span data-stu-id="5adcf-147">Health client</span></span>
<span data-ttu-id="5adcf-148">отчеты о работоспособности Hello отправляются хранилища работоспособности toohello через клиент работоспособности, который находится внутри клиента Fabric hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-148">hello health reports are sent toohello health store through a health client, which lives inside hello fabric client.</span></span> <span data-ttu-id="5adcf-149">можно настроить следующие параметры hello Hello работоспособности клиента:</span><span class="sxs-lookup"><span data-stu-id="5adcf-149">hello health client can be configured with hello following settings:</span></span>

* <span data-ttu-id="5adcf-150">**HealthReportSendInterval**: hello задержки между hello время hello отчетов — добавлены toohello клиента и hello время, отправкой toohello базе данных health store.</span><span class="sxs-lookup"><span data-stu-id="5adcf-150">**HealthReportSendInterval**: hello delay between hello time hello report is added toohello client and hello time it is sent toohello health store.</span></span> <span data-ttu-id="5adcf-151">Отчеты, используемые toobatch в одно сообщение, а не отправки одного сообщения для каждого отчета.</span><span class="sxs-lookup"><span data-stu-id="5adcf-151">Used toobatch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="5adcf-152">Hello Пакетная обработка позволяет повысить производительность.</span><span class="sxs-lookup"><span data-stu-id="5adcf-152">hello batching improves performance.</span></span> <span data-ttu-id="5adcf-153">Значение по умолчанию — 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="5adcf-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="5adcf-154">**HealthReportRetrySendInterval**: интервал приветствия, на какие hello работоспособности клиент повторно отправляет накопленный работоспособности сообщает toohello базе данных health store.</span><span class="sxs-lookup"><span data-stu-id="5adcf-154">**HealthReportRetrySendInterval**: hello interval at which hello health client resends accumulated health reports toohello health store.</span></span> <span data-ttu-id="5adcf-155">Значение по умолчанию — 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="5adcf-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="5adcf-156">**HealthOperationTimeout**: hello времени ожидания для сообщения отчетов отправляются toohello базе данных health store.</span><span class="sxs-lookup"><span data-stu-id="5adcf-156">**HealthOperationTimeout**: hello timeout period for a report message sent toohello health store.</span></span> <span data-ttu-id="5adcf-157">Если истечения времени ожидания сообщения, hello работоспособности клиент пытается выполнить ее до хранилища работоспособности hello подтверждает обработки отчета hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-157">If a message times out, hello health client retries it until hello health store confirms that hello report has been processed.</span></span> <span data-ttu-id="5adcf-158">Значение по умолчанию — две минуты.</span><span class="sxs-lookup"><span data-stu-id="5adcf-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="5adcf-159">Когда отчеты hello, объединяются в пакеты, hello клиента Fabric должно поддерживать их существование для по крайней мере hello tooensure HealthReportSendInterval, они отправляются.</span><span class="sxs-lookup"><span data-stu-id="5adcf-159">When hello reports are batched, hello fabric client must be kept alive for at least hello HealthReportSendInterval tooensure that they are sent.</span></span> <span data-ttu-id="5adcf-160">Если сообщение hello теряется или базе данных health store hello применить их невозможно из-за ошибки tootransient, клиента Fabric hello следует хранить в активном состоянии дольше toogive его tooretry вероятность.</span><span class="sxs-lookup"><span data-stu-id="5adcf-160">If hello message is lost or hello health store cannot apply them due tootransient errors, hello fabric client must be kept alive longer toogive it a chance tooretry.</span></span>
> 
> 

<span data-ttu-id="5adcf-161">Hello буферизации на клиенте hello принимает уникальность hello hello отчетов во внимание.</span><span class="sxs-lookup"><span data-stu-id="5adcf-161">hello buffering on hello client takes hello uniqueness of hello reports into consideration.</span></span> <span data-ttu-id="5adcf-162">Например, если определенный поврежденных средства формирования отчетов отчет 100 отчеты в секунду на hello же свойство hello одной сущности, hello отчеты заменяются hello последней версии.</span><span class="sxs-lookup"><span data-stu-id="5adcf-162">For example, if a particular bad reporter is reporting 100 reports per second on hello same property of hello same entity, hello reports are replaced with hello last version.</span></span> <span data-ttu-id="5adcf-163">В очереди hello клиента существует не более одного такого отчета.</span><span class="sxs-lookup"><span data-stu-id="5adcf-163">At most one such report exists in hello client queue.</span></span> <span data-ttu-id="5adcf-164">Если пакетная обработка настроена, hello количество отчетов отправлено хранилища работоспособности toohello только по одному на интервал отправки.</span><span class="sxs-lookup"><span data-stu-id="5adcf-164">If batching is configured, hello number of reports sent toohello health store is just one per send interval.</span></span> <span data-ttu-id="5adcf-165">Этот отчет является hello последний добавленный отчет, который отражает состояние последней hello объекта hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-165">This report is hello last added report, which reflects hello most current state of hello entity.</span></span>
<span data-ttu-id="5adcf-166">Укажите параметры конфигурации при `FabricClient` создается путем передачи [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) с hello требуемого значения для операций, связанных с работоспособностью.</span><span class="sxs-lookup"><span data-stu-id="5adcf-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with hello desired values for health-related entries.</span></span>

<span data-ttu-id="5adcf-167">Hello следующий пример создает клиент, структуры и указывает, должны быть отправлены hello отчетов при добавлении.</span><span class="sxs-lookup"><span data-stu-id="5adcf-167">hello following example creates a fabric client and specifies that hello reports should be sent when they are added.</span></span> <span data-ttu-id="5adcf-168">Если при повторных попытках возникают ошибки или превышено время ожидания, попытки повторяются каждые 40 секунд.</span><span class="sxs-lookup"><span data-stu-id="5adcf-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="5adcf-169">Рекомендуется оставлять hello структуры по умолчанию параметры клиента, которые задают `HealthReportSendInterval` too30 секунд.</span><span class="sxs-lookup"><span data-stu-id="5adcf-169">We recommend keeping hello default fabric client settings, which set `HealthReportSendInterval` too30 seconds.</span></span> <span data-ttu-id="5adcf-170">Этот параметр обеспечивает оптимальную производительность из-за toobatching.</span><span class="sxs-lookup"><span data-stu-id="5adcf-170">This setting ensures optimal performance due toobatching.</span></span> <span data-ttu-id="5adcf-171">Для критических отчетов, которые должны отправляться как можно быстрее, используйте `HealthReportSendOptions` с флагом Immediate, имеющим значение `true`, в API [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth).</span><span class="sxs-lookup"><span data-stu-id="5adcf-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="5adcf-172">Немедленное отчеты обойти hello интервал пакетов.</span><span class="sxs-lookup"><span data-stu-id="5adcf-172">Immediate reports bypass hello batching interval.</span></span> <span data-ttu-id="5adcf-173">Этот флаг следует использовать с осторожностью; Мы хотим tootake преимуществами hello работоспособности клиента пакетную обработку, когда это возможно.</span><span class="sxs-lookup"><span data-stu-id="5adcf-173">Use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span> <span data-ttu-id="5adcf-174">Немедленно отправить удобно использовать при закрытии клиента Fabric hello (например, процесс hello определил недопустимое состояние и должен tooshut вниз tooprevent побочные эффекты).</span><span class="sxs-lookup"><span data-stu-id="5adcf-174">Immediate send is also useful when hello fabric client is closing (for example, hello process has determined invalid state and needs tooshut down tooprevent side effects).</span></span> <span data-ttu-id="5adcf-175">Это гарантирует усилия отправка отчетов hello накапливаются.</span><span class="sxs-lookup"><span data-stu-id="5adcf-175">It ensures a best-effort send of hello accumulated reports.</span></span> <span data-ttu-id="5adcf-176">При добавлении одного отчета с помощью интерпретации флага hello работоспособности клиента пакетов все отчеты hello накапливаются с момента последней отправки.</span><span class="sxs-lookup"><span data-stu-id="5adcf-176">When one report is added with Immediate flag, hello health client batches all hello accumulated reports since last send.</span></span>

<span data-ttu-id="5adcf-177">При создании кластера tooa подключения через PowerShell, можно указать одинаковые параметры.</span><span class="sxs-lookup"><span data-stu-id="5adcf-177">Same parameters can be specified when a connection tooa cluster is created through PowerShell.</span></span> <span data-ttu-id="5adcf-178">Следующий пример Hello начинает tooa соединения локального кластера:</span><span class="sxs-lookup"><span data-stu-id="5adcf-178">hello following example starts a connection tooa local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="5adcf-179">Аналогичным образом tooAPI, отчеты можно отправлять с помощью `-Immediate` переключения toobe, отправляются немедленно, независимо от того, hello `HealthReportSendInterval` значение.</span><span class="sxs-lookup"><span data-stu-id="5adcf-179">Similarly tooAPI, reports can be sent using `-Immediate` switch toobe sent immediately, regardless of hello `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="5adcf-180">REST hello отчеты отправляются toohello Service Fabric шлюз, который имеет клиент внутренние структуры.</span><span class="sxs-lookup"><span data-stu-id="5adcf-180">For REST, hello reports are sent toohello Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="5adcf-181">По умолчанию этот клиент подключен toosend настроенные отчеты каждые 30 секунд в пакетном режиме.</span><span class="sxs-lookup"><span data-stu-id="5adcf-181">By default, this client is configured toosend reports batched every 30 seconds.</span></span> <span data-ttu-id="5adcf-182">Можно изменить интервал пакетов hello с параметром конфигурации кластера hello `HttpGatewayHealthReportSendInterval` на `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="5adcf-182">You can change hello batch interval with hello cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="5adcf-183">Как уже упоминалось, лучшим вариантом является toosend hello отчеты с `Immediate` значение true.</span><span class="sxs-lookup"><span data-stu-id="5adcf-183">As mentioned, a better option is toosend hello reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="5adcf-184">не может сообщить, tooensure, неавторизованные службы работоспособности на основе сущностей hello в кластере hello, настройте hello server tooaccept запросы только от клиентов, защищенных.</span><span class="sxs-lookup"><span data-stu-id="5adcf-184">tooensure that unauthorized services can't report health against hello entities in hello cluster, configure hello server tooaccept requests only from secured clients.</span></span> <span data-ttu-id="5adcf-185">Hello `FabricClient` использоваться для создания отчетов необходимо иметь с включенной безопасностью может toocommunicate toobe с кластером hello (например, при использовании проверки подлинности Kerberos или сертификат).</span><span class="sxs-lookup"><span data-stu-id="5adcf-185">hello `FabricClient` used for reporting must have security enabled toobe able toocommunicate with hello cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="5adcf-186">Ознакомьтесь с дополнительными сведениями о [безопасности кластера](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="5adcf-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="5adcf-187">Создание отчета из служб с низким уровнем привилегий</span><span class="sxs-lookup"><span data-stu-id="5adcf-187">Report from within low privilege services</span></span>
<span data-ttu-id="5adcf-188">Если нет кластера toohello доступа администратора для служб Service Fabric, вы можете сообщить работоспособности на сущностях из текущего контекста hello через `Partition` или `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="5adcf-188">If Service Fabric services do not have admin access toohello cluster, you can report health on entities from hello current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="5adcf-189">Для служб без отслеживания состояния, используйте [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport на текущий экземпляр службы hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport on hello current service instance.</span></span>
* <span data-ttu-id="5adcf-190">Для служб с отслеживанием состояния, используйте [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport на текущей реплики.</span><span class="sxs-lookup"><span data-stu-id="5adcf-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport on current replica.</span></span>
* <span data-ttu-id="5adcf-191">Используйте [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport hello текущего раздела сущности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport on hello current partition entity.</span></span>
* <span data-ttu-id="5adcf-192">Используйте [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport для текущего приложения.</span><span class="sxs-lookup"><span data-stu-id="5adcf-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport on current application.</span></span>
* <span data-ttu-id="5adcf-193">Используйте [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport на hello текущее приложение, развернутое на hello текущего узла.</span><span class="sxs-lookup"><span data-stu-id="5adcf-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport on hello current application deployed on hello current node.</span></span>
* <span data-ttu-id="5adcf-194">Используйте [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport на пакеты обновления для приложения hello, развернутого на текущем узле hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport on a service package for hello application deployed on hello current node.</span></span>

> [!NOTE]
> <span data-ttu-id="5adcf-195">На внутреннем уровне hello `Partition` и hello `CodePackageActivationContext` хранения работоспособности клиента, с параметрами по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="5adcf-195">Internally, hello `Partition` and hello `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="5adcf-196">Как описано для hello [работоспособности клиента](service-fabric-report-health.md#health-client), отчеты пакеты и отправляются по таймеру.</span><span class="sxs-lookup"><span data-stu-id="5adcf-196">As explained for hello [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="5adcf-197">объекты Hello должна быть сохранена alive toohave отчета hello toosend вероятность.</span><span class="sxs-lookup"><span data-stu-id="5adcf-197">hello objects should be kept alive toohave a chance toosend hello report.</span></span>
> 
> 

<span data-ttu-id="5adcf-198">Можно указать `HealthReportSendOptions` при отправке отчетов с помощью интерфейсов API работоспособности `Partition` и `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="5adcf-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="5adcf-199">При наличии критических отчетов, которые должны отправляться как можно быстрее, используйте `HealthReportSendOptions` с флагом Immediate, имеющим значение `true`.</span><span class="sxs-lookup"><span data-stu-id="5adcf-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="5adcf-200">Немедленное отчеты обойти hello пакетной обработки интервала hello внутренней работоспособности клиента.</span><span class="sxs-lookup"><span data-stu-id="5adcf-200">Immediate reports bypass hello batching interval of hello internal health client.</span></span> <span data-ttu-id="5adcf-201">Как упоминалось ранее, используйте этот флаг с осторожностью; Мы хотим tootake преимуществами hello работоспособности клиента пакетную обработку, когда это возможно.</span><span class="sxs-lookup"><span data-stu-id="5adcf-201">As mentioned before, use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="5adcf-202">Создание отчета о работоспособности</span><span class="sxs-lookup"><span data-stu-id="5adcf-202">Design health reporting</span></span>
<span data-ttu-id="5adcf-203">Hello первым шагом создания отчетов высокого качества определение hello условия, которые могут повлиять на работоспособность hello hello службы.</span><span class="sxs-lookup"><span data-stu-id="5adcf-203">hello first step in generating high-quality reports is identifying hello conditions that can impact hello health of hello service.</span></span> <span data-ttu-id="5adcf-204">Любое условие, которые могут помочь флаг проблем в службе hello или кластера, при запуске--или даже лучше, прежде чем произойдет ошибка потенциально может сохранить Миллиарды долларов.</span><span class="sxs-lookup"><span data-stu-id="5adcf-204">Any condition that can help flag problems in hello service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="5adcf-205">обеспечивает следующие преимущества Hello меньше время простоя, меньше часов ночи, затраченное на анализ и исправление проблемы и более поздней версии клиентской удовлетворенности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-205">hello benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="5adcf-206">После определения условий hello контрольного записи должны toofigure out hello toomonitor лучший способ их для баланс между издержками и полезности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-206">Once hello conditions are identified, watchdog writers need toofigure out hello best way toomonitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="5adcf-207">Например, рассмотрим службу, которая выполняет сложные вычисления, используя некоторые временные файлы в общей папке.</span><span class="sxs-lookup"><span data-stu-id="5adcf-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="5adcf-208">Контрольный может отслеживать tooensure hello общего ресурса, что диске будет достаточно.</span><span class="sxs-lookup"><span data-stu-id="5adcf-208">A watchdog could monitor hello share tooensure that enough space is available.</span></span> <span data-ttu-id="5adcf-209">Оно может отслеживать уведомления об изменении файла или каталога.</span><span class="sxs-lookup"><span data-stu-id="5adcf-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="5adcf-210">Он может выдать предупреждение, если достигнуто пороговое значение переднего плана или сообщения об ошибке, если общий ресурс hello заполнен.</span><span class="sxs-lookup"><span data-stu-id="5adcf-210">It could report a warning if an upfront threshold is reached, and report an error if hello share is full.</span></span> <span data-ttu-id="5adcf-211">На предупреждение, системы восстановления удалось запустить очистки старых файлов в общей папке hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-211">On a warning, a repair system could start cleaning up older files on hello share.</span></span> <span data-ttu-id="5adcf-212">При возникновении ошибки в системе восстановления может переместить hello службы реплики tooanother узел.</span><span class="sxs-lookup"><span data-stu-id="5adcf-212">On an error, a repair system could move hello service replica tooanother node.</span></span> <span data-ttu-id="5adcf-213">Обратите внимание на то, как hello условие состояния описаны с точки зрения работоспособности: hello состояние hello условие, которое можно считать работоспособное (ОК) или неработоспособном (предупреждение или ошибка).</span><span class="sxs-lookup"><span data-stu-id="5adcf-213">Note how hello condition states are described in terms of health: hello state of hello condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="5adcf-214">После установки сведения мониторинга hello записи контрольного должен toofigure out как tooimplement hello наблюдения.</span><span class="sxs-lookup"><span data-stu-id="5adcf-214">Once hello monitoring details are set, a watchdog writer needs toofigure out how tooimplement hello watchdog.</span></span> <span data-ttu-id="5adcf-215">Можно определить условия hello из службы hello, hello контрольного может ли часть саму службу hello отслеживаться.</span><span class="sxs-lookup"><span data-stu-id="5adcf-215">If hello conditions can be determined from within hello service, hello watchdog can be part of hello monitored service itself.</span></span> <span data-ttu-id="5adcf-216">Например код службы hello Проверьте использование общей папки hello и сообщала каждый раз, он пытается toowrite файл.</span><span class="sxs-lookup"><span data-stu-id="5adcf-216">For example, hello service code can check hello share usage, and then report every time it tries toowrite a file.</span></span> <span data-ttu-id="5adcf-217">Hello преимуществом такого подхода является reporting простой.</span><span class="sxs-lookup"><span data-stu-id="5adcf-217">hello advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="5adcf-218">Будьте внимательны ошибок контрольного tooprevent из ущерба hello функциональные возможности службы.</span><span class="sxs-lookup"><span data-stu-id="5adcf-218">Care must be taken tooprevent watchdog bugs from impacting hello service functionality.</span></span>

<span data-ttu-id="5adcf-219">Отчетов в отслеживаемых hello службы не всегда параметр.</span><span class="sxs-lookup"><span data-stu-id="5adcf-219">Reporting from within hello monitored service is not always an option.</span></span> <span data-ttu-id="5adcf-220">Контрольный hello службы может быть условий может toodetect hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-220">A watchdog within hello service may not be able toodetect hello conditions.</span></span> <span data-ttu-id="5adcf-221">Он не может иметь hello логику определения и данных toomake hello сообщений.</span><span class="sxs-lookup"><span data-stu-id="5adcf-221">It may not have hello logic or data toomake hello determination.</span></span> <span data-ttu-id="5adcf-222">Возможно, мониторинг состояния hello издержки Hello высокого уровня.</span><span class="sxs-lookup"><span data-stu-id="5adcf-222">hello overhead of monitoring hello conditions may be high.</span></span> <span data-ttu-id="5adcf-223">Hello условия также может не быть tooa определенной службой, но вместо влияют на взаимодействие между службами.</span><span class="sxs-lookup"><span data-stu-id="5adcf-223">hello conditions also may not be specific tooa service, but instead affect interactions between services.</span></span> <span data-ttu-id="5adcf-224">Другой вариант — watchdogs toohave в кластере hello в виде отдельных процессов.</span><span class="sxs-lookup"><span data-stu-id="5adcf-224">Another option is toohave watchdogs in hello cluster as separate processes.</span></span> <span data-ttu-id="5adcf-225">Hello watchdogs отслеживать условия hello и отчет, не затрагивая hello основных службы каким-либо образом.</span><span class="sxs-lookup"><span data-stu-id="5adcf-225">hello watchdogs monitor hello conditions and report, without affecting hello main services in any way.</span></span> <span data-ttu-id="5adcf-226">Например, эти watchdogs может быть реализован как службы без сохранения состояния в hello того же приложения, которые развернуты на всех узлах или hello разным узлам как служба hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-226">For example, these watchdogs could be implemented as stateless services in hello same application, deployed on all nodes or on hello same nodes as hello service.</span></span>

<span data-ttu-id="5adcf-227">В некоторых случаях контрольного, работающих в кластере hello не предлагается либо.</span><span class="sxs-lookup"><span data-stu-id="5adcf-227">Sometimes, a watchdog running in hello cluster is not an option either.</span></span> <span data-ttu-id="5adcf-228">Если условие hello мониторинг доступности hello или функциональные возможности службы hello как его видят пользователи, это наиболее watchdogs toohave hello в hello же поместить как клиенты hello пользователя.</span><span class="sxs-lookup"><span data-stu-id="5adcf-228">If hello monitored condition is hello availability or functionality of hello service as users see it, it's best toohave hello watchdogs in hello same place as hello user clients.</span></span> <span data-ttu-id="5adcf-229">Нет, можно проверить операции hello в hello их вызова того же пользователей.</span><span class="sxs-lookup"><span data-stu-id="5adcf-229">There, they can test hello operations in hello same way users call them.</span></span> <span data-ttu-id="5adcf-230">Например может иметь контрольного, находится за пределами кластера hello, выдает запросы службы toohello и проверка задержки hello и правильности hello результата.</span><span class="sxs-lookup"><span data-stu-id="5adcf-230">For example, you can have a watchdog that lives outside hello cluster, issues requests toohello service, and checks hello latency and correctness of hello result.</span></span> <span data-ttu-id="5adcf-231">(Например, запрос к службе калькулятора: возвращает ли 2 + 2 результат 4 в разумные сроки?)</span><span class="sxs-lookup"><span data-stu-id="5adcf-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="5adcf-232">После сведения контрольного hello быть завершен, необходимо принять решение по идентификатор источника, который однозначно идентифицирует его.</span><span class="sxs-lookup"><span data-stu-id="5adcf-232">Once hello watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="5adcf-233">Если несколько watchdogs hello того же типа живущих в hello кластера, они должны отчетов для различных объектов или, если они сообщают о hello же сущности, используйте идентификатор другого источника или свойства.</span><span class="sxs-lookup"><span data-stu-id="5adcf-233">If multiple watchdogs of hello same type are living in hello cluster, they must report on different entities, or, if they report on hello same entity, use different source ID or property.</span></span> <span data-ttu-id="5adcf-234">Убедитесь, что свойства или идентификаторы источника отличаются.</span><span class="sxs-lookup"><span data-stu-id="5adcf-234">This way, their reports can coexist.</span></span> <span data-ttu-id="5adcf-235">Свойство Hello hello отчет о работоспособности должен отражать hello отслеживаемых условие.</span><span class="sxs-lookup"><span data-stu-id="5adcf-235">hello property of hello health report should capture hello monitored condition.</span></span> <span data-ttu-id="5adcf-236">(В приведенном выше примере hello, может быть свойство hello **ShareSize**.) Если несколько отчетов применить toohello же условие, hello свойство должно содержать некоторые динамические данные, позволяющие toocoexist отчеты.</span><span class="sxs-lookup"><span data-stu-id="5adcf-236">(For hello example above, hello property could be **ShareSize**.) If multiple reports apply toohello same condition, hello property should contain some dynamic information that allows reports toocoexist.</span></span> <span data-ttu-id="5adcf-237">Например, если несколько общих папок необходимо отслеживать toobe, hello именем свойства может быть **ShareSize sharename**.</span><span class="sxs-lookup"><span data-stu-id="5adcf-237">For example, if multiple shares need toobe monitored, hello property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="5adcf-238">Сделать *не* сведения о состоянии tookeep hello работоспособности хранилища.</span><span class="sxs-lookup"><span data-stu-id="5adcf-238">Do *not* use hello health store tookeep status information.</span></span> <span data-ttu-id="5adcf-239">Только сведения, относящиеся к работоспособности должна быть зарегистрирована как работоспособности этот сведения влияние hello работоспособности для ознакомления сущности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-239">Only health-related information should be reported as health, as this information impacts hello health evaluation of an entity.</span></span> <span data-ttu-id="5adcf-240">базе данных health store Hello не была разработана общего назначения хранилища.</span><span class="sxs-lookup"><span data-stu-id="5adcf-240">hello health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="5adcf-241">В нем tooaggregate логика оценки работоспособности всех данных в состояние работоспособности hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-241">It uses health evaluation logic tooaggregate all data into hello health state.</span></span> <span data-ttu-id="5adcf-242">Отправка сведений, несвязанные toohealth (например, сообщают о состоянии с состоянием работоспособности ОК) не влияет hello суммарный состояние работоспособности, но он может отрицательно сказываться на производительности hello hello базе данных health store.</span><span class="sxs-lookup"><span data-stu-id="5adcf-242">Sending information unrelated toohealth (like reporting status with a health state of OK) doesn't impact hello aggregated health state, but it can negatively affect hello performance of hello health store.</span></span>
> 
> 

<span data-ttu-id="5adcf-243">Следующий вопрос Hello включен tooreport какие сущности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-243">hello next decision point is which entity tooreport on.</span></span> <span data-ttu-id="5adcf-244">Большую часть времени приветствия, условия hello четко idetifies hello сущности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-244">Most of hello time, hello condition clearly idetifies hello entity.</span></span> <span data-ttu-id="5adcf-245">Выберите сущность hello с лучшие возможности гранулярности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-245">Choose hello entity with best possible granularity.</span></span> <span data-ttu-id="5adcf-246">Если условие влияет на все реплики в секции, сообщите hello секции, не в службе hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-246">If a condition impacts all replicas in a partition, report on hello partition, not on hello service.</span></span> <span data-ttu-id="5adcf-247">Хотя бывают и патологические случаи, когда принять решение сложно.</span><span class="sxs-lookup"><span data-stu-id="5adcf-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="5adcf-248">Если условие hello оказывает влияние на сущности, например реплики, но hello желания является условие hello toohave отмеченные дольше, чем hello длительность существования реплика должна быть зарегистрирована в разделе hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-248">If hello condition impacts an entity, such as a replica, but hello desire is toohave hello condition flagged for more than hello duration of replica life, then it should be reported on hello partition.</span></span> <span data-ttu-id="5adcf-249">В противном случае при удалении реплики hello hello работоспособности хранилища удаляет все отчеты.</span><span class="sxs-lookup"><span data-stu-id="5adcf-249">Otherwise, when hello replica is deleted, hello health store cleans up all its reports.</span></span> <span data-ttu-id="5adcf-250">Модули записи контрольного нужно решить, время существования hello сущности hello и hello отчета.</span><span class="sxs-lookup"><span data-stu-id="5adcf-250">Watchdog writers must think about hello lifetimes of hello entity and hello report.</span></span> <span data-ttu-id="5adcf-251">Должно быть понятно, когда отчет нужно удалять из хранилища (например, когда теряет актуальность ошибка, зафиксированная для сущности).</span><span class="sxs-lookup"><span data-stu-id="5adcf-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="5adcf-252">Давайте рассмотрим пример, в котором составляет точек hello описанный.</span><span class="sxs-lookup"><span data-stu-id="5adcf-252">Let's look at an example that puts together hello points I described.</span></span> <span data-ttu-id="5adcf-253">У нас есть приложение Service Fabric, которое состоит из главной службы с отслеживанием состояния и дополнительных служб без отслеживания состояния, развернутых на всех узлах (один тип дополнительной службы для одного типа задачи).</span><span class="sxs-lookup"><span data-stu-id="5adcf-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="5adcf-254">Образец Hello имеет очередь обработка, которая содержит toobe команды, выполняемой баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="5adcf-254">hello master has a processing queue that contains commands toobe executed by secondaries.</span></span> <span data-ttu-id="5adcf-255">базы данных-получатели Hello выполнение hello входящие запросы и отправить назад подтверждение сигналы.</span><span class="sxs-lookup"><span data-stu-id="5adcf-255">hello secondaries execute hello incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="5adcf-256">Одно условие, может отслеживаться — hello длина очереди master обработки hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-256">One condition that could be monitored is hello length of hello master processing queue.</span></span> <span data-ttu-id="5adcf-257">Если длина hello главной очереди достигает порога, создается предупреждение.</span><span class="sxs-lookup"><span data-stu-id="5adcf-257">If hello master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="5adcf-258">Hello предупреждение означает, что hello баз данных-получателей не может обрабатывать hello нагрузку.</span><span class="sxs-lookup"><span data-stu-id="5adcf-258">hello warning indicates that hello secondaries can't handle hello load.</span></span> <span data-ttu-id="5adcf-259">Если очередь hello достигает hello максимальную длину и команды, будут удалены, сообщение об ошибке, как hello службы невозможно восстановить.</span><span class="sxs-lookup"><span data-stu-id="5adcf-259">If hello queue reaches hello maximum length and commands are dropped, an error is reported, as hello service can't recover.</span></span> <span data-ttu-id="5adcf-260">Hello отчеты могут быть в свойстве hello **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="5adcf-260">hello reports can be on hello property **QueueStatus**.</span></span> <span data-ttu-id="5adcf-261">Hello контрольного находится внутри службы hello и отправляются периодически hello master первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="5adcf-261">hello watchdog lives inside hello service, and it's sent periodically on hello master primary replica.</span></span> <span data-ttu-id="5adcf-262">время Hello toolive две минуты, и отправляются периодически каждые 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="5adcf-262">hello time toolive is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="5adcf-263">Если основной hello выходит из строя, hello отчетов удаляются автоматически из хранилища.</span><span class="sxs-lookup"><span data-stu-id="5adcf-263">If hello primary goes down, hello report is cleaned up automatically from store.</span></span> <span data-ttu-id="5adcf-264">Если реплики службы hello работает, но он заблокирован или возникли другие проблемы hello истечения срока действия отчета в базе данных health store hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-264">If hello service replica is up, but it is deadlocked or having other issues, hello report expires in hello health store.</span></span> <span data-ttu-id="5adcf-265">В этом случае при обнаружении ошибки оценивается hello сущности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-265">In this case, hello entity is evaluated at error.</span></span>

<span data-ttu-id="5adcf-266">Другое условие, которое можно отслеживать, — время выполнения задачи.</span><span class="sxs-lookup"><span data-stu-id="5adcf-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="5adcf-267">Hello master распределяет задачи toohello баз данных-получателей на основании типа задачи hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-267">hello master distributes tasks toohello secondaries based on hello task type.</span></span> <span data-ttu-id="5adcf-268">В зависимости от структуры hello образец hello может выполнять опрос hello баз данных-получателей для состояния задачи.</span><span class="sxs-lookup"><span data-stu-id="5adcf-268">Depending on hello design, hello master could poll hello secondaries for task status.</span></span> <span data-ttu-id="5adcf-269">Он может также подождать сигналы назад подтверждение toosend баз данных-получателей когда они создаются.</span><span class="sxs-lookup"><span data-stu-id="5adcf-269">It could also wait for secondaries toosend back acknowledgement signals when they are done.</span></span> <span data-ttu-id="5adcf-270">В случае второй hello Будьте внимательны toodetect ситуациях, где теряются кристалле баз данных-получателей или сообщений.</span><span class="sxs-lookup"><span data-stu-id="5adcf-270">In hello second case, care must be taken toodetect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="5adcf-271">Один параметр предназначен для hello master toosend toohello запрос проверки связи же получателя, который отправляет обратно его состояние.</span><span class="sxs-lookup"><span data-stu-id="5adcf-271">One option is for hello master toosend a ping request toohello same secondary, which sends back its status.</span></span> <span data-ttu-id="5adcf-272">Если состояние не получено, образец hello считает его сбоя и планирует новую задачу hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-272">If no status is received, hello master considers it a failure and reschedules hello task.</span></span> <span data-ttu-id="5adcf-273">Это поведение предполагается, что задачи hello идемпотентными.</span><span class="sxs-lookup"><span data-stu-id="5adcf-273">This behavior assumes that hello tasks are idempotent.</span></span>

<span data-ttu-id="5adcf-274">условие Hello отслеживаемых могут быть переведены как предупреждение, если задачу hello не выполняется в определенное время (**t1**, например 10 минут).</span><span class="sxs-lookup"><span data-stu-id="5adcf-274">hello monitored condition can be translated as a warning if hello task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="5adcf-275">Если задача hello не завершена в момент (**t2**, например 20 минут), могут быть переведены условие hello отслеживается как ошибка.</span><span class="sxs-lookup"><span data-stu-id="5adcf-275">If hello task is not completed in time (**t2**, for example 20 minutes), hello monitored condition can be translated as Error.</span></span> <span data-ttu-id="5adcf-276">Отчеты можно отправлять несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="5adcf-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="5adcf-277">Hello master первичная реплика периодически сообщает сама по себе.</span><span class="sxs-lookup"><span data-stu-id="5adcf-277">hello master primary replica reports on itself periodically.</span></span> <span data-ttu-id="5adcf-278">Может иметь одно свойство для всех задач, ожидающих в очереди hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-278">You can have one property for all pending tasks in hello queue.</span></span> <span data-ttu-id="5adcf-279">Если хотя бы одной задачи занимает больше времени, hello отчета о состоянии свойства hello **PendingTasks** предупреждение или ошибка соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="5adcf-279">If at least one task takes longer, hello report status on hello property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="5adcf-280">Если нет ожидающих задач или всех задач начала выполнение, находится в работоспособном состоянии hello отчета.</span><span class="sxs-lookup"><span data-stu-id="5adcf-280">If there are no pending tasks or all tasks started execution, hello report status is OK.</span></span> <span data-ttu-id="5adcf-281">задачи Hello являются постоянными.</span><span class="sxs-lookup"><span data-stu-id="5adcf-281">hello tasks are persistent.</span></span> <span data-ttu-id="5adcf-282">Если основной hello выходит из строя, основной hello новые можно продолжить tooreport должным образом.</span><span class="sxs-lookup"><span data-stu-id="5adcf-282">If hello primary goes down, hello newly promoted primary can continue tooreport properly.</span></span>
* <span data-ttu-id="5adcf-283">Другой процесс наблюдения (в облаке hello или внешний) проверяет задачи hello (из за пределами, на основе результат задачи hello требуемого) toosee, если они выполняются.</span><span class="sxs-lookup"><span data-stu-id="5adcf-283">Another watchdog process (in hello cloud or external) checks hello tasks (from outside, based on hello desired task result) toosee if they are completed.</span></span> <span data-ttu-id="5adcf-284">Если они не влияют на hello пороговые значения, отчет отправляется на основной службы hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-284">If they do not respect hello thresholds, a report is sent on hello master service.</span></span> <span data-ttu-id="5adcf-285">Отчет также отправляется на каждой задачи, включает идентификатор задачи hello, таких как **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="5adcf-285">A report is also sent on each task that includes hello task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="5adcf-286">Отчеты должны отправляться только о неработоспособных состояниях.</span><span class="sxs-lookup"><span data-stu-id="5adcf-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="5adcf-287">Задать время toolive tooa несколько минут и пометьте удалены после истечения срока их действия очистки tooensure toobe отчеты hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-287">Set time toolive tooa few minutes, and mark hello reports toobe removed when they expire tooensure cleanup.</span></span>
* <span data-ttu-id="5adcf-288">Hello получателей, выполняющего задачи сообщает, когда занимает больше времени, чем ожидаемое toorun его.</span><span class="sxs-lookup"><span data-stu-id="5adcf-288">hello secondary that is executing a task reports when it takes longer than expected toorun it.</span></span> <span data-ttu-id="5adcf-289">Он выводит на экземпляр службы hello в свойстве hello **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="5adcf-289">It reports on hello service instance on hello property **PendingTasks**.</span></span> <span data-ttu-id="5adcf-290">отчет Hello выявляет hello экземпляр службы, который связан с проблемами, но он не перехватывает hello ситуации, где экземпляр hello выходит из строя.</span><span class="sxs-lookup"><span data-stu-id="5adcf-290">hello report pinpoints hello service instance that has issues, but it doesn't capture hello situation where hello instance dies.</span></span> <span data-ttu-id="5adcf-291">отчеты Hello очищаются затем.</span><span class="sxs-lookup"><span data-stu-id="5adcf-291">hello reports are cleaned up then.</span></span> <span data-ttu-id="5adcf-292">Он может сообщить о служба вторичного hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-292">It could report on hello secondary service.</span></span> <span data-ttu-id="5adcf-293">Если hello получателей выполнит задачу hello, вторичном экземпляре hello очищает hello отчетов из хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-293">If hello secondary completes hello task, hello secondary instance clears hello report from hello store.</span></span> <span data-ttu-id="5adcf-294">Hello отчета без записи hello случаев, когда сообщение hello подтверждения теряется и hello не закончена с точки зрения образец hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-294">hello report doesn't capture hello situation where hello acknowledgement message is lost and hello task is not finished from hello master's point of view.</span></span>

<span data-ttu-id="5adcf-295">Однако hello отчетов выполняется в описанных выше случаев hello, hello отчетов записываются в работоспособности приложения при оценке работоспособности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-295">However hello reporting is done in hello cases described above, hello reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="5adcf-296">Периодические отчеты и отчеты на основе переходов</span><span class="sxs-lookup"><span data-stu-id="5adcf-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="5adcf-297">С помощью отчетов модель работоспособности hello, watchdogs отчеты можно отправлять периодически или переходов.</span><span class="sxs-lookup"><span data-stu-id="5adcf-297">By using hello health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="5adcf-298">Hello рекомендуемые способ контрольного reporting — это периодически, так как код hello — гораздо более простой и менее подвержены возникновению tooerrors.</span><span class="sxs-lookup"><span data-stu-id="5adcf-298">hello recommended way for watchdog reporting is periodically, because hello code is much simpler and less prone tooerrors.</span></span> <span data-ttu-id="5adcf-299">Hello watchdogs должны стремиться toobe сложнее, чем tooavoid возможных ошибок, вызывающих неправильные отчеты.</span><span class="sxs-lookup"><span data-stu-id="5adcf-299">hello watchdogs must strive toobe as simple as possible tooavoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="5adcf-300">Неправильный отчет о *неработоспособности* влияет на оценку работоспособности и на сценарии, основанные на работоспособности, в частности обновления.</span><span class="sxs-lookup"><span data-stu-id="5adcf-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="5adcf-301">Неверный *работоспособное* отчеты скрыть проблемы в кластере hello, что не требуется.</span><span class="sxs-lookup"><span data-stu-id="5adcf-301">Incorrect *healthy* reports hide issues in hello cluster, which is not desired.</span></span>

<span data-ttu-id="5adcf-302">Для периодической отчетности контрольного hello может осуществляться с таймером.</span><span class="sxs-lookup"><span data-stu-id="5adcf-302">For periodic reporting, hello watchdog can be implemented with a timer.</span></span> <span data-ttu-id="5adcf-303">На обратный вызов таймера контрольного hello можно проверять состояние hello и отправки отчетов на основе текущего состояния hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-303">On a timer callback, hello watchdog can check hello state and send a report based on hello current state.</span></span> <span data-ttu-id="5adcf-304">Нет toosee без необходимости какой отчет был отправлен ранее или сделайте Оптимизация с точки зрения системы обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="5adcf-304">There is no need toosee which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="5adcf-305">Hello работоспособности клиента имеет пакетной обработки логики toohelp с производительностью.</span><span class="sxs-lookup"><span data-stu-id="5adcf-305">hello health client has batching logic toohelp with performance.</span></span> <span data-ttu-id="5adcf-306">Хотя hello работоспособности клиента остается активным, он пытается выполнить сбойные внутренне до hello отчета подтвердит его получение хранилища работоспособности hello или контрольного hello создает новую отчет с hello же сущности, свойства и источник.</span><span class="sxs-lookup"><span data-stu-id="5adcf-306">While hello health client is kept alive, it retries internally until hello report is acknowledged by hello health store or hello watchdog generates a newer report with hello same entity, property, and source.</span></span>

<span data-ttu-id="5adcf-307">Отчеты о переходах требуют тщательной обработки состояния.</span><span class="sxs-lookup"><span data-stu-id="5adcf-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="5adcf-308">Hello контрольного отслеживает некоторые условия и возвращает только при изменении условий hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-308">hello watchdog monitors some conditions and reports only when hello conditions change.</span></span> <span data-ttu-id="5adcf-309">Hello вверх ногами такого подхода — необходимые отчеты меньше.</span><span class="sxs-lookup"><span data-stu-id="5adcf-309">hello upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="5adcf-310">Hello недостатком такого подхода является сложной логики hello контрольного hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-310">hello downside is that hello logic of hello watchdog is complex.</span></span> <span data-ttu-id="5adcf-311">Hello контрольного необходимо поддерживать hello условия или отчеты hello, чтобы их можно было проверяемого toodetermine изменения состояния.</span><span class="sxs-lookup"><span data-stu-id="5adcf-311">hello watchdog must maintain hello conditions or hello reports, so that they can be inspected toodetermine state changes.</span></span> <span data-ttu-id="5adcf-312">При отработке отказа необходимо соблюдать осторожность с отчетами добавлен, но еще не отправлено toohello базе данных health store.</span><span class="sxs-lookup"><span data-stu-id="5adcf-312">On failover, care must be taken with reports added, but not yet sent toohello health store.</span></span> <span data-ttu-id="5adcf-313">Hello порядковый номер должен быть постоянно возрастающим.</span><span class="sxs-lookup"><span data-stu-id="5adcf-313">hello sequence number must be ever-increasing.</span></span> <span data-ttu-id="5adcf-314">В противном случае отчеты hello отклоняются как устаревшие.</span><span class="sxs-lookup"><span data-stu-id="5adcf-314">If not, hello reports are rejected as stale.</span></span> <span data-ttu-id="5adcf-315">В редких случаях hello, где возникающей потери данных может потребоваться синхронизации между состоянием hello отслеживания hello и состояния hello hello работоспособности хранилища.</span><span class="sxs-lookup"><span data-stu-id="5adcf-315">In hello rare cases where data loss is incurred, synchronization may be needed between hello state of hello reporter and hello state of hello health store.</span></span>

<span data-ttu-id="5adcf-316">Отчеты на основе переходов имеют смысл, когда служба сообщает данные о своем состоянии с помощью `Partition` или `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="5adcf-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="5adcf-317">Когда hello локального объекта (реплики или развернутый пакет службы / развернутого приложения) — удалена, все отчеты, также удаляются.</span><span class="sxs-lookup"><span data-stu-id="5adcf-317">When hello local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="5adcf-318">Это Автоматическая очистка снижает потребность в hello синхронизации средства формирования отчетов и базе данных health store.</span><span class="sxs-lookup"><span data-stu-id="5adcf-318">This automatic cleanup relaxes hello need for synchronization between reporter and health store.</span></span> <span data-ttu-id="5adcf-319">Если для родительского раздела или родительского приложения hello отчет, необходимо соблюдать осторожность в отчетах устаревших tooavoid отработки отказа в базе данных health store hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-319">If hello report is for parent partition or parent application, care must be taken on failover tooavoid stale reports in hello health store.</span></span> <span data-ttu-id="5adcf-320">Логика должны быть добавлены правильное состояние toomaintain hello и очистить hello отчетов из хранилища, когда они больше не нужны.</span><span class="sxs-lookup"><span data-stu-id="5adcf-320">Logic must be added toomaintain hello correct state and clear hello report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="5adcf-321">Реализация отчетов о работоспособности</span><span class="sxs-lookup"><span data-stu-id="5adcf-321">Implement health reporting</span></span>
<span data-ttu-id="5adcf-322">После hello сведения о сущности и отчет не установлены, отправки отчетов о работоспособности можно сделать с помощью hello API, PowerShell или REST.</span><span class="sxs-lookup"><span data-stu-id="5adcf-322">Once hello entity and report details are clear, sending health reports can be done through hello API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="5adcf-323">API</span><span class="sxs-lookup"><span data-stu-id="5adcf-323">API</span></span>
<span data-ttu-id="5adcf-324">tooreport через hello API необходимо toocreate тип сущности работоспособности отчетов конкретного toohello нужные им tooreport на.</span><span class="sxs-lookup"><span data-stu-id="5adcf-324">tooreport through hello API, you need toocreate a health report specific toohello entity type they want tooreport on.</span></span> <span data-ttu-id="5adcf-325">Присвойте hello отчетов tooa работоспособности клиента.</span><span class="sxs-lookup"><span data-stu-id="5adcf-325">Give hello report tooa health client.</span></span> <span data-ttu-id="5adcf-326">Можно также создать сведения о работоспособности и передать его toocorrect методы отчета на `Partition` или `CodePackageActivationContext` tooreport на текущей сущности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-326">Alternatively, create a health information and pass it toocorrect reporting methods on `Partition` or `CodePackageActivationContext` tooreport on current entities.</span></span>

<span data-ttu-id="5adcf-327">Hello пример периодических отчетов из контрольного внутри кластера hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-327">hello following example shows periodic reporting from a watchdog within hello cluster.</span></span> <span data-ttu-id="5adcf-328">Hello контрольного проверяет ли внешний ресурс может осуществляться в узле.</span><span class="sxs-lookup"><span data-stu-id="5adcf-328">hello watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="5adcf-329">манифест службы приложения hello Затребован Hello ресурсов.</span><span class="sxs-lookup"><span data-stu-id="5adcf-329">hello resource is needed by a service manifest within hello application.</span></span> <span data-ttu-id="5adcf-330">В случае недоступности ресурсов hello hello другие службы внутри приложения hello может продолжать функционировать должным образом.</span><span class="sxs-lookup"><span data-stu-id="5adcf-330">If hello resource is unavailable, hello other services within hello application can still function properly.</span></span> <span data-ttu-id="5adcf-331">Таким образом hello отправки отчета в сущности пакета hello развернуты службы каждые 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="5adcf-331">Therefore, hello report is sent on hello deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether hello resource can be accessed from hello node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as hello connectivity is needed by hello specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, hello report is already queued on hello health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until hello report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="5adcf-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="5adcf-332">PowerShell</span></span>
<span data-ttu-id="5adcf-333">Отправляйте отчеты о работоспособности с помощью команды **Send-ServiceFabric*EntityType*HealthReport**.</span><span class="sxs-lookup"><span data-stu-id="5adcf-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="5adcf-334">Hello пример периодических отчетов по значениям ЦП на узле.</span><span class="sxs-lookup"><span data-stu-id="5adcf-334">hello following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="5adcf-335">Hello отчеты должны отправляться каждые 30 секунд и имеют время toolive две минуты.</span><span class="sxs-lookup"><span data-stu-id="5adcf-335">hello reports should be sent every 30 seconds, and they have a time toolive of two minutes.</span></span> <span data-ttu-id="5adcf-336">Если истечения срока их действия, формирования hello имеет проблемы, поэтому узел hello вычисляется при обнаружении ошибки.</span><span class="sxs-lookup"><span data-stu-id="5adcf-336">If they expire, hello reporter has issues, so hello node is evaluated at error.</span></span> <span data-ttu-id="5adcf-337">Если hello ЦП превышает пороговое значение, hello отчет имеет состояние предупреждения.</span><span class="sxs-lookup"><span data-stu-id="5adcf-337">When hello CPU is above a threshold, hello report has a health state of warning.</span></span> <span data-ttu-id="5adcf-338">Если hello ЦП остается выше порогового значения дольше времени настройки hello, оно будет отмечено как ошибку.</span><span class="sxs-lookup"><span data-stu-id="5adcf-338">When hello CPU remains above a threshold for more than hello configured time, it's reported as an error.</span></span> <span data-ttu-id="5adcf-339">В противном случае hello создателя отчетов отправляет состояние работоспособности ОК.</span><span class="sxs-lookup"><span data-stu-id="5adcf-339">Otherwise, hello reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="5adcf-340">Hello следующий пример отображает временных предупреждение на реплике.</span><span class="sxs-lookup"><span data-stu-id="5adcf-340">hello following example reports a transient warning on a replica.</span></span> <span data-ttu-id="5adcf-341">Он сначала получает идентификатор секции hello и затем hello идентификатор реплики службы hello, которую нужно получить.</span><span class="sxs-lookup"><span data-stu-id="5adcf-341">It first gets hello partition ID and then hello replica ID for hello service it is interested in.</span></span> <span data-ttu-id="5adcf-342">После этого он отправляет отчет из **PowershellWatcher** в свойстве hello **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="5adcf-342">It then sends a report from **PowershellWatcher** on hello property **ResourceDependency**.</span></span> <span data-ttu-id="5adcf-343">Hello отчета представляет интерес только двух минут, и он удаляется из хранилища hello автоматически.</span><span class="sxs-lookup"><span data-stu-id="5adcf-343">hello report is of interest for only two minutes, and it is removed from hello store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="5adcf-344">REST</span><span class="sxs-lookup"><span data-stu-id="5adcf-344">REST</span></span>
<span data-ttu-id="5adcf-345">Отправьте отчеты о работоспособности с помощью REST с запросами POST, которые go toohello требуемого сущностей и в описание отчета работоспособности hello текст hello.</span><span class="sxs-lookup"><span data-stu-id="5adcf-345">Send health reports using REST with POST requests that go toohello desired entity and have in hello body hello health report description.</span></span> <span data-ttu-id="5adcf-346">Например, в разделе как REST toosend [отчеты о работоспособности кластера](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) или [службы отчетов о работоспособности](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="5adcf-346">For example, see how toosend REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="5adcf-347">Поддерживаются все сущности.</span><span class="sxs-lookup"><span data-stu-id="5adcf-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5adcf-348">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="5adcf-348">Next steps</span></span>
<span data-ttu-id="5adcf-349">На основании данных работоспособности hello записи службы и Администраторы кластеров или приложение можно представить способов tooconsume hello сведения.</span><span class="sxs-lookup"><span data-stu-id="5adcf-349">Based on hello health data, service writers and cluster/application administrators can think of ways tooconsume hello information.</span></span> <span data-ttu-id="5adcf-350">Например их можно настроить предупреждения, основанные на серьезные проблемы работоспособности состояния toocatch, прежде чем они спровоцировать сбоев.</span><span class="sxs-lookup"><span data-stu-id="5adcf-350">For example, they can set up alerts based on health status toocatch severe issues before they provoke outages.</span></span> <span data-ttu-id="5adcf-351">Администраторы могут также настроить восстановление системы toofix автоматически.</span><span class="sxs-lookup"><span data-stu-id="5adcf-351">Administrators can also set up repair systems toofix issues automatically.</span></span>

[<span data-ttu-id="5adcf-352">Введение tooService работоспособность структуры мониторинг</span><span class="sxs-lookup"><span data-stu-id="5adcf-352">Introduction tooService Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="5adcf-353">Просмотр отчетов о работоспособности Service Fabric</span><span class="sxs-lookup"><span data-stu-id="5adcf-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="5adcf-354">Как tooreport и проверки службы работоспособности</span><span class="sxs-lookup"><span data-stu-id="5adcf-354">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="5adcf-355">Использование отчетов о работоспособности системы для устранения неполадок</span><span class="sxs-lookup"><span data-stu-id="5adcf-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="5adcf-356">Мониторинг и диагностика состояния служб в локальной среде разработки</span><span class="sxs-lookup"><span data-stu-id="5adcf-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="5adcf-357">Обновление приложения Service Fabric</span><span class="sxs-lookup"><span data-stu-id="5adcf-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

