---
title: "Подготовка к развертыванию изолированного кластера Azure Service Fabric | Документация Майкрософт"
description: "Документация по подготовке среды и созданию конфигурации кластера, с которой следует ознакомиться перед развертыванием кластера, предназначенным для обработки производственной рабочей нагрузки."
services: service-fabric
documentationcenter: .net
author: maburlik
manager: timlt
editor: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 1/17/2017
ms.author: maburlik;chackdan
ms.openlocfilehash: f332193f9a53260173a1010b8bf9f08726bea427
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
<a id="preparemachines"></a>

## <a name="plan-and-prepare-your-service-fabric-standalone-cluster-deployment"></a><span data-ttu-id="752a4-103">Планирование и подготовка развертывания изолированного кластера Service Fabric</span><span class="sxs-lookup"><span data-stu-id="752a4-103">Plan and prepare your Service Fabric standalone cluster deployment</span></span>
<span data-ttu-id="752a4-104">Перед созданием кластера выполните следующее.</span><span class="sxs-lookup"><span data-stu-id="752a4-104">Perform the following steps before you create your cluster.</span></span>

### <a name="step-1-plan-your-cluster-infrastructure"></a><span data-ttu-id="752a4-105">Шаг 1. Планирование инфраструктуры кластера</span><span class="sxs-lookup"><span data-stu-id="752a4-105">Step 1: Plan your cluster infrastructure</span></span>
<span data-ttu-id="752a4-106">Вы собираетесь создать кластер Service Fabric на принадлежащих вам компьютерах, поэтому вам нужно решить, к каким сбоям должен быть устойчив кластер.</span><span class="sxs-lookup"><span data-stu-id="752a4-106">You are about to create a Service Fabric cluster on machines you own, so you can decide what kinds of failures you want the cluster to survive.</span></span> <span data-ttu-id="752a4-107">Например, нужны ли отдельные линии электропитания или подключения к Интернету для этих компьютеров?</span><span class="sxs-lookup"><span data-stu-id="752a4-107">For example, do you need separate power lines or Internet connections supplied to these machines?</span></span> <span data-ttu-id="752a4-108">Кроме того, следует также учитывать физическую безопасность этих компьютеров.</span><span class="sxs-lookup"><span data-stu-id="752a4-108">In addition, consider the physical security of these machines.</span></span> <span data-ttu-id="752a4-109">Где находятся компьютеры и кому необходим доступ к ним?</span><span class="sxs-lookup"><span data-stu-id="752a4-109">Where are the machines located and who needs access to them?</span></span> <span data-ttu-id="752a4-110">После принятия этих решений вы можете логически сопоставить компьютеры с различными доменами сбоя (см. шаг 4).</span><span class="sxs-lookup"><span data-stu-id="752a4-110">After you make these decisions, you can logically map the machines to the various fault domains (see Step 4).</span></span> <span data-ttu-id="752a4-111">Планирование инфраструктуры для рабочих кластеров требует больше усилий, чем для тестовых кластеров.</span><span class="sxs-lookup"><span data-stu-id="752a4-111">The infrastructure planning for production clusters is more involved than for test clusters.</span></span>

### <a name="step-2-prepare-the-machines-to-meet-the-prerequisites"></a><span data-ttu-id="752a4-112">Шаг 2. Подготовка компьютеров для соблюдения предварительных требований</span><span class="sxs-lookup"><span data-stu-id="752a4-112">Step 2: Prepare the machines to meet the prerequisites</span></span>
<span data-ttu-id="752a4-113">Предварительные требования к каждому компьютеру, который требуется добавить в кластер.</span><span class="sxs-lookup"><span data-stu-id="752a4-113">Prerequisites for each machine that you want to add to the cluster:</span></span>

* <span data-ttu-id="752a4-114">Рекомендуется наличие не менее 16 ГБ памяти.</span><span class="sxs-lookup"><span data-stu-id="752a4-114">A minimum of 16 GB of RAM is recommended.</span></span>
* <span data-ttu-id="752a4-115">Рекомендуется наличие не менее 40 ГБ свободного дискового пространства.</span><span class="sxs-lookup"><span data-stu-id="752a4-115">A minimum of 40 of GB available disk space is recommended.</span></span>
* <span data-ttu-id="752a4-116">Рекомендуется наличие ЦП с 4 ядрами и более.</span><span class="sxs-lookup"><span data-stu-id="752a4-116">A 4 core or greater CPU is recommended.</span></span>
* <span data-ttu-id="752a4-117">Подключение к защищенной сети или сетям для всех компьютеров.</span><span class="sxs-lookup"><span data-stu-id="752a4-117">Connectivity to a secure network or networks for all machines.</span></span>
* <span data-ttu-id="752a4-118">Windows Server 2012 R2 или Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="752a4-118">Windows Server 2012 R2 or Windows Server 2016.</span></span> 
* <span data-ttu-id="752a4-119">Полностью установленная платформа [.NET Framework 4.5.1 или более поздней версии](https://www.microsoft.com/download/details.aspx?id=40773).</span><span class="sxs-lookup"><span data-stu-id="752a4-119">[.NET Framework 4.5.1 or higher](https://www.microsoft.com/download/details.aspx?id=40773), full install.</span></span>
* <span data-ttu-id="752a4-120">[Windows PowerShell 3.0](https://msdn.microsoft.com/powershell/scripting/setup/installing-windows-powershell).</span><span class="sxs-lookup"><span data-stu-id="752a4-120">[Windows PowerShell 3.0](https://msdn.microsoft.com/powershell/scripting/setup/installing-windows-powershell).</span></span>
* <span data-ttu-id="752a4-121">На всех компьютерах должна быть запущена [служба RemoteRegistry](https://technet.microsoft.com/library/cc754820) .</span><span class="sxs-lookup"><span data-stu-id="752a4-121">The [RemoteRegistry service](https://technet.microsoft.com/library/cc754820) should be running on all the machines.</span></span>

<span data-ttu-id="752a4-122">У администратора кластера, который развертывает и настраивает кластер, должны быть [привилегии администратора](https://social.technet.microsoft.com/wiki/contents/articles/13436.windows-server-2012-how-to-add-an-account-to-a-local-administrator-group.aspx) на всех компьютерах.</span><span class="sxs-lookup"><span data-stu-id="752a4-122">The cluster administrator deploying and configuring the cluster must have [administrator privileges](https://social.technet.microsoft.com/wiki/contents/articles/13436.windows-server-2012-how-to-add-an-account-to-a-local-administrator-group.aspx) on each of the machines.</span></span> <span data-ttu-id="752a4-123">Пакет Service Fabric нельзя установить на контроллере домена.</span><span class="sxs-lookup"><span data-stu-id="752a4-123">You cannot install Service Fabric on a domain controller.</span></span>

### <a name="step-3-determine-the-initial-cluster-size"></a><span data-ttu-id="752a4-124">Шаг 3. Определение исходного размера кластера</span><span class="sxs-lookup"><span data-stu-id="752a4-124">Step 3: Determine the initial cluster size</span></span>
<span data-ttu-id="752a4-125">Каждый узел в изолированном кластере Service Fabric является членом кластера, и на нем развернута среда выполнения Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="752a4-125">Each node in a standalone Service Fabric cluster has the Service Fabric runtime deployed and is a member of the cluster.</span></span> <span data-ttu-id="752a4-126">В типичном рабочем развертывании используется один узел на экземпляр ОС (физический или виртуальный).</span><span class="sxs-lookup"><span data-stu-id="752a4-126">In a typical production deployment, there is one node per OS instance (physical or virtual).</span></span> <span data-ttu-id="752a4-127">Размер кластера определяется бизнес-потребностями.</span><span class="sxs-lookup"><span data-stu-id="752a4-127">The cluster size is determined by your business needs.</span></span> <span data-ttu-id="752a4-128">Тем не менее минимальная конфигурация кластера состоит из трех узлов (компьютеров или виртуальных машин).</span><span class="sxs-lookup"><span data-stu-id="752a4-128">However, you must have a minimum cluster size of three nodes (machines or virtual machines).</span></span>
<span data-ttu-id="752a4-129">В целях разработки на одном компьютере можно настроить более одного узла.</span><span class="sxs-lookup"><span data-stu-id="752a4-129">For development purposes, you can have more than one node on a given machine.</span></span> <span data-ttu-id="752a4-130">В рабочей среде Service Fabric поддерживает только один узел на физический компьютер или виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="752a4-130">In a production environment, Service Fabric supports only one node per physical or virtual machine.</span></span>

### <a name="step-4-determine-the-number-of-fault-domains-and-upgrade-domains"></a><span data-ttu-id="752a4-131">Шаг 4. Определение количества доменов сбоя и доменов обновления</span><span class="sxs-lookup"><span data-stu-id="752a4-131">Step 4: Determine the number of fault domains and upgrade domains</span></span>
<span data-ttu-id="752a4-132">*Домен сбоя* — это физическая единица сбоя, непосредственно связанная с физической инфраструктурой в центрах обработки данных.</span><span class="sxs-lookup"><span data-stu-id="752a4-132">A *fault domain* (FD) is a physical unit of failure and is directly related to the physical infrastructure in the data centers.</span></span> <span data-ttu-id="752a4-133">Домен сбоя состоит из аппаратных компонентов (компьютеры, коммутаторы, сеть и многое другое), совместно использующих единую точку отказа.</span><span class="sxs-lookup"><span data-stu-id="752a4-133">A fault domain consists of hardware components (computers, switches, networks, and more) that share a single point of failure.</span></span> <span data-ttu-id="752a4-134">Хотя нет однозначного соответствия между доменами сбоя и стойками, грубо говоря, каждую стойку можно считать доменом сбоя.</span><span class="sxs-lookup"><span data-stu-id="752a4-134">Although there is no 1:1 mapping between fault domains and racks, loosely speaking, each rack can be considered a fault domain.</span></span> <span data-ttu-id="752a4-135">При выборе узлов в кластере мы настоятельно рекомендуем распределить узлы по крайней мере на три домена сбоя.</span><span class="sxs-lookup"><span data-stu-id="752a4-135">When considering the nodes in your cluster, we strongly recommend that the nodes be distributed among at least three fault domains.</span></span>

<span data-ttu-id="752a4-136">При указании доменов сбоя в файле ClusterConfig.json можно выбрать имя для каждого из них.</span><span class="sxs-lookup"><span data-stu-id="752a4-136">When you specify FDs in ClusterConfig.json, you can choose the name for each FD.</span></span> <span data-ttu-id="752a4-137">Service Fabric поддерживает иерархические домены сбоя, поэтому в них можно отразить имеющуюся топологию инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="752a4-137">Service Fabric supports hierarchical FDs, so you can reflect your infrastructure topology in them.</span></span>  <span data-ttu-id="752a4-138">Например, допускаются следующие домены сбоя.</span><span class="sxs-lookup"><span data-stu-id="752a4-138">For example, the following FDs are valid:</span></span>

* <span data-ttu-id="752a4-139">"faultDomain": "fd:/Room1/Rack1/Machine1"</span><span class="sxs-lookup"><span data-stu-id="752a4-139">"faultDomain": "fd:/Room1/Rack1/Machine1"</span></span>
* <span data-ttu-id="752a4-140">"faultDomain": "fd:/FD1"</span><span class="sxs-lookup"><span data-stu-id="752a4-140">"faultDomain": "fd:/FD1"</span></span>
* <span data-ttu-id="752a4-141">"faultDomain": "fd:/Room1/Rack1/PDU1/M1"</span><span class="sxs-lookup"><span data-stu-id="752a4-141">"faultDomain": "fd:/Room1/Rack1/PDU1/M1"</span></span>

<span data-ttu-id="752a4-142">*Домен обновления* — это логическая единица узлов.</span><span class="sxs-lookup"><span data-stu-id="752a4-142">An *upgrade domain* (UD) is a logical unit of nodes.</span></span> <span data-ttu-id="752a4-143">Во время обновления под управлением Service Fabric (обновления приложения или кластера) все узлы в домене обновления отключаются, а узлы в других доменах обновления остаются доступными для обслуживания запросов.</span><span class="sxs-lookup"><span data-stu-id="752a4-143">During Service Fabric orchestrated upgrades (either an application upgrade or a cluster upgrade), all nodes in a UD are taken down to perform the upgrade while nodes in other UDs remain available to serve requests.</span></span> <span data-ttu-id="752a4-144">Обновления встроенного ПО, выполняемые на компьютерах, не связаны с работой доменов обновления, поэтому их необходимо выполнять на компьютерах по очереди.</span><span class="sxs-lookup"><span data-stu-id="752a4-144">The firmware upgrades you perform on your machines do not honor UDs, so you must do them one machine at a time.</span></span>

<span data-ttu-id="752a4-145">Проще всего рассматривать эти понятия, считая домен сбоя единицей незапланированного сбоя, а домен обновления — единицей планового обслуживания.</span><span class="sxs-lookup"><span data-stu-id="752a4-145">The simplest way to think about these concepts is to consider FDs as the unit of unplanned failure and UDs as the unit of planned maintenance.</span></span>

<span data-ttu-id="752a4-146">При указании доменов обновления в файле ClusterConfig.json можно выбрать имя для каждого из них.</span><span class="sxs-lookup"><span data-stu-id="752a4-146">When you specify UDs in ClusterConfig.json, you can choose the name for each UD.</span></span> <span data-ttu-id="752a4-147">Например, допускаются следующие имена:</span><span class="sxs-lookup"><span data-stu-id="752a4-147">For example, the following names are valid:</span></span>

* <span data-ttu-id="752a4-148">"upgradeDomain": "UD0"</span><span class="sxs-lookup"><span data-stu-id="752a4-148">"upgradeDomain": "UD0"</span></span>
* <span data-ttu-id="752a4-149">"upgradeDomain": "UD1A"</span><span class="sxs-lookup"><span data-stu-id="752a4-149">"upgradeDomain": "UD1A"</span></span>
* <span data-ttu-id="752a4-150">"upgradeDomain": "DomainRed"</span><span class="sxs-lookup"><span data-stu-id="752a4-150">"upgradeDomain": "DomainRed"</span></span>
* <span data-ttu-id="752a4-151">"upgradeDomain": "Blue"</span><span class="sxs-lookup"><span data-stu-id="752a4-151">"upgradeDomain": "Blue"</span></span>

<span data-ttu-id="752a4-152">Дополнительные сведения о доменах обновления и доменах сбоя см. в статье [Описание кластера Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="752a4-152">For more detailed information on upgrade domains and fault domains, see [Describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>

### <a name="step-5-download-the-service-fabric-standalone-package-for-windows-server"></a><span data-ttu-id="752a4-153">Шаг 5. Скачивание изолированного пакета Service Fabric для Windows Server</span><span class="sxs-lookup"><span data-stu-id="752a4-153">Step 5: Download the Service Fabric standalone package for Windows Server</span></span>
<span data-ttu-id="752a4-154">[Скачайте изолированный пакет Service Fabric для Windows Server](http://go.microsoft.com/fwlink/?LinkId=730690) и извлеките его содержимое на компьютер развертывания, который не является частью кластера, или на один из компьютеров, которые будут частью кластера.</span><span class="sxs-lookup"><span data-stu-id="752a4-154">[Download Link - Service Fabric Standalone Package - Windows Server](http://go.microsoft.com/fwlink/?LinkId=730690) and unzip the package, either to a deployment machine that is not part of the cluster, or to one of the machines that will be a part of your cluster.</span></span>

### <a name="step-6-modify-cluster-configuration"></a><span data-ttu-id="752a4-155">Шаг 6. Изменение конфигурации кластера</span><span class="sxs-lookup"><span data-stu-id="752a4-155">Step 6: Modify cluster configuration</span></span>
<span data-ttu-id="752a4-156">Чтобы создать изолированный кластер, для него необходимо создать файл конфигурации ClusterConfig.json, описывающий характеристики кластера.</span><span class="sxs-lookup"><span data-stu-id="752a4-156">To create a standalone cluster you have to create a standalone cluster configuration ClusterConfig.json file, which describes the specification of the cluster.</span></span> <span data-ttu-id="752a4-157">Можно создать этот файл на основе шаблонов, доступных по ссылке ниже.</span><span class="sxs-lookup"><span data-stu-id="752a4-157">You can base the configuration file on the templates found at the below link.</span></span> <br><span data-ttu-id="752a4-158">
[Конфигурации изолированного кластера](https://github.com/Azure-Samples/service-fabric-dotnet-standalone-cluster-configuration/tree/master/Samples)</span><span class="sxs-lookup"><span data-stu-id="752a4-158">
[Standalone Cluster Configurations](https://github.com/Azure-Samples/service-fabric-dotnet-standalone-cluster-configuration/tree/master/Samples)</span></span>

<span data-ttu-id="752a4-159">Сведения о разделах в этом файле см. в статье [Параметры конфигурации для автономного кластера Windows](service-fabric-cluster-manifest.md).</span><span class="sxs-lookup"><span data-stu-id="752a4-159">For details on the sections in this file, see [Configuration settings for standalone Windows cluster](service-fabric-cluster-manifest.md).</span></span>

<span data-ttu-id="752a4-160">Откройте один из файлов ClusterConfig.json из скачанного пакета и настройте следующие параметры.</span><span class="sxs-lookup"><span data-stu-id="752a4-160">Open one of the ClusterConfig.json files from the package you downloaded and modify the following settings:</span></span>
| <span data-ttu-id="752a4-161">**Параметр конфигурации**</span><span class="sxs-lookup"><span data-stu-id="752a4-161">**Configuration Setting**</span></span> | <span data-ttu-id="752a4-162">**Описание**</span><span class="sxs-lookup"><span data-stu-id="752a4-162">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="752a4-163">**NodeTypes**</span><span class="sxs-lookup"><span data-stu-id="752a4-163">**NodeTypes**</span></span> |<span data-ttu-id="752a4-164">Типы узлов позволяют разделить узлы кластера на различные группы.</span><span class="sxs-lookup"><span data-stu-id="752a4-164">Node types allow you to separate your cluster nodes into various groups.</span></span> <span data-ttu-id="752a4-165">У кластера должен быть по крайней мере один NodeType.</span><span class="sxs-lookup"><span data-stu-id="752a4-165">A cluster must have at least one NodeType.</span></span> <span data-ttu-id="752a4-166">Все узлы в группе имеют следующие общие характеристики.</span><span class="sxs-lookup"><span data-stu-id="752a4-166">All nodes in a group have the following common characteristics:</span></span> <br> <span data-ttu-id="752a4-167">**Name** — имя типа узла.</span><span class="sxs-lookup"><span data-stu-id="752a4-167">**Name** - This is the node type name.</span></span> <br><span data-ttu-id="752a4-168">**Endpoint ports** — различные именованные конечные точки (порты), связанные с этим типом узла.</span><span class="sxs-lookup"><span data-stu-id="752a4-168">**Endpoint Ports** - These are various named end points (ports) that are associated with this node type.</span></span> <span data-ttu-id="752a4-169">Вы можете использовать любой номер порта, который не конфликтует с другими компонентами в этом манифесте и не используется другим приложением на компьютере или виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="752a4-169">You can use any port number that you wish, as long as they do not conflict with anything else in this manifest and are not already in use by any other application running on the machine/VM.</span></span> <br> <span data-ttu-id="752a4-170">**Placement Properties** — свойства для типа узла, с помощью которых задаются ограничения на размещение системных или своих служб.</span><span class="sxs-lookup"><span data-stu-id="752a4-170">**Placement Properties** - These describe properties for this node type that you use as placement constraints for the system services or your services.</span></span> <span data-ttu-id="752a4-171">Эти свойства представляют собой определяемые пользователем пары "ключ-значение", которые содержат дополнительные метаданные для заданного узла.</span><span class="sxs-lookup"><span data-stu-id="752a4-171">These properties are user-defined key/value pairs that provide extra meta data for a given node.</span></span> <span data-ttu-id="752a4-172">К свойствам узла относится, например, наличие у него жесткого диска или видеоадаптера, количество шпинделей в его жестком диске, число ядер и другие физические качества.</span><span class="sxs-lookup"><span data-stu-id="752a4-172">Examples of node properties would be whether the node has a hard drive or graphics card, the number of spindles in its hard drive, cores, and other physical properties.</span></span> <br> <span data-ttu-id="752a4-173">**Capacities** — емкость узла определяет имя и величину конкретного ресурса, доступного для использования на определенном узле.</span><span class="sxs-lookup"><span data-stu-id="752a4-173">**Capacities** - Node capacities define the name and amount of a particular resource that a particular node has available for consumption.</span></span> <span data-ttu-id="752a4-174">Например, для узла может быть определена емкость для метрики MemoryInMb и выделено 2048 МБ памяти, доступной по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="752a4-174">For example, a node may define that it has capacity for a metric called “MemoryInMb” and that it has 2048 MB available by default.</span></span> <span data-ttu-id="752a4-175">Емкости используются во время выполнения, чтобы гарантировать, что службы, которым требуется определенный объем ресурсов, будут размещены на узлах, обладающих такими ресурсами.</span><span class="sxs-lookup"><span data-stu-id="752a4-175">These capacities are used at runtime to ensure that services that require particular amounts of resources are placed on the nodes that have those resources available in the required amounts.</span></span><br><span data-ttu-id="752a4-176">**IsPrimary** — при наличии нескольких определенных типов узлов убедитесь, что только один из них назначен первичным (это свойство имеет значение *true*) и на нем выполняются системные службы.</span><span class="sxs-lookup"><span data-stu-id="752a4-176">**IsPrimary** - If you have more than one NodeType defined ensure that only one is set to primary with the value *true*, which is where the system services run.</span></span> <span data-ttu-id="752a4-177">Узлам всех остальных типов необходимо присвоить значение *false*.</span><span class="sxs-lookup"><span data-stu-id="752a4-177">All other node types should be set to the value *false*</span></span> |
| <span data-ttu-id="752a4-178">**Nodes**</span><span class="sxs-lookup"><span data-stu-id="752a4-178">**Nodes**</span></span> |<span data-ttu-id="752a4-179">Сведения о каждом узле, который является частью кластера (тип узла, имя узла, IP-адрес, домен сбоя и домен обновления узла).</span><span class="sxs-lookup"><span data-stu-id="752a4-179">These are the details for each of the nodes that are part of the cluster (node type, node name, IP address, fault domain, and upgrade domain of the node).</span></span> <span data-ttu-id="752a4-180">В этом разделе необходимо перечислить компьютеры, на основе которых вы хотите создать кластер, и их IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="752a4-180">The machines you want the cluster to be created on need to be listed here with their IP addresses.</span></span> <br> <span data-ttu-id="752a4-181">Если использовать одинаковые IP-адреса для всех узлов, будет создан универсальный кластер, который можно использовать для тестирования.</span><span class="sxs-lookup"><span data-stu-id="752a4-181">If you use the same IP address for all the nodes, then a one-box cluster is created, which you can use for testing purposes.</span></span> <span data-ttu-id="752a4-182">Не используйте универсальные кластеры для развертывания рабочих нагрузок в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="752a4-182">Do not use One-box clusters for deploying production workloads.</span></span> |

<span data-ttu-id="752a4-183">После настройки всех параметров конфигурации кластера в среде эту конфигурацию можно протестировать в среде кластера (шаг 7).</span><span class="sxs-lookup"><span data-stu-id="752a4-183">After the cluster configuration has had all settings configured to the environment, it can be tested against the cluster environment (step 7).</span></span>

<a id="environmentsetup"></a>

### <a name="step-7-environment-setup"></a><span data-ttu-id="752a4-184">Шаг 7.</span><span class="sxs-lookup"><span data-stu-id="752a4-184">Step 7.</span></span> <span data-ttu-id="752a4-185">Настройка среды</span><span class="sxs-lookup"><span data-stu-id="752a4-185">Environment setup</span></span>

<span data-ttu-id="752a4-186">Когда администратор кластера настраивает изолированный кластер Service Fabric, ему необходимо настроить среду, чтобы выполнить приведенные ниже условия.</span><span class="sxs-lookup"><span data-stu-id="752a4-186">When a cluster administrator configures a Service Fabric standalone cluster, the environment is needs to be set up with the following criteria:</span></span> <br>
1. <span data-ttu-id="752a4-187">У пользователя, создающего кластер, должны быть привилегии безопасности уровня администратора для всех компьютеров, которые указаны в качестве узлов в файле конфигурации кластера.</span><span class="sxs-lookup"><span data-stu-id="752a4-187">The user creating the cluster should have administrator-level security privileges to all machines that are listed as nodes in the cluster configuration file.</span></span>
2. <span data-ttu-id="752a4-188">На компьютере, с которого создается кластер, а также на каждом компьютере узла кластера требуется выполнить следующее.</span><span class="sxs-lookup"><span data-stu-id="752a4-188">Machine from which the cluster is created, as well as each cluster node machine must:</span></span>
* <span data-ttu-id="752a4-189">Удалите пакет SDK для Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="752a4-189">Have Service Fabric SDK uninstalled</span></span>
* <span data-ttu-id="752a4-190">Удалите среду выполнения Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="752a4-190">Have Service Fabric runtime uninstalled</span></span> 
* <span data-ttu-id="752a4-191">Включите службу брандмауэра Windows (mpssvc).</span><span class="sxs-lookup"><span data-stu-id="752a4-191">Have the Windows Firewall service (mpssvc) enabled</span></span>
* <span data-ttu-id="752a4-192">Включите службу удаленного управления реестром (remoteregistry).</span><span class="sxs-lookup"><span data-stu-id="752a4-192">Have the Remote Registry Service (remoteregistry) enabled</span></span>
* <span data-ttu-id="752a4-193">Включите общий доступ к файлам (SMB).</span><span class="sxs-lookup"><span data-stu-id="752a4-193">Have file sharing (SMB) enabled</span></span>
* <span data-ttu-id="752a4-194">Откройте необходимые порты в соответствии с конфигурацией портов кластера.</span><span class="sxs-lookup"><span data-stu-id="752a4-194">Have necessary ports opened, based on cluster configuration ports</span></span>
* <span data-ttu-id="752a4-195">Откройте необходимые порты для Windows SMB и службы удаленного управления реестром: 135, 137, 138, 139 и 445.</span><span class="sxs-lookup"><span data-stu-id="752a4-195">Have necessary ports opened for Windows SMB and Remote Registry service: 135, 137, 138, 139, and 445</span></span>
* <span data-ttu-id="752a4-196">Установите сетевые подключения между ними.</span><span class="sxs-lookup"><span data-stu-id="752a4-196">Have network connectivity to one another</span></span>
3. <span data-ttu-id="752a4-197">Ни один из компьютеров узлов кластера не должен быть контроллером домена.</span><span class="sxs-lookup"><span data-stu-id="752a4-197">None of the cluster node machines should be a Domain Controller.</span></span>
4. <span data-ttu-id="752a4-198">Если развертывается безопасный кластер, проверьте, установлены и настроены ли обязательные компоненты системы безопасности в соответствии с конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="752a4-198">If the cluster to be deployed is a secure cluster, validate the necessary security prerequisites are in place, and are configured correctly against the configuration.</span></span>
5. <span data-ttu-id="752a4-199">Если компьютеры в составе кластера не имеют доступ к Интернету, задайте в конфигурации кластера следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="752a4-199">If the cluster machines are not internet-accessible, set the following in the cluster configuration:</span></span>
* <span data-ttu-id="752a4-200">Отключите телеметрию: в разделе *properties* задайте параметр *"enableTelemetry": false*.</span><span class="sxs-lookup"><span data-stu-id="752a4-200">Disable telemetry:   Under *properties* set   *"enableTelemetry": false*</span></span>
* <span data-ttu-id="752a4-201">Отключите автоматическое скачивание версий Service Fabric и уведомления о том, что приближается окончание срока поддержки текущей версии кластера: в разделе *properties* задайте параметр *"fabricClusterAutoupgradeEnabled": false*.</span><span class="sxs-lookup"><span data-stu-id="752a4-201">Disable automatic Fabric version downloading & notifications that the current cluster version is nearing end of support:   Under *properties* set   *"fabricClusterAutoupgradeEnabled": false*</span></span>
* <span data-ttu-id="752a4-202">В качестве альтернативы, если интернет-доступ к сети ограничен доменами из белого списка, перечисленные ниже домены необходимы для автоматического обновления:   go.microsoft.com   download.microsoft.com</span><span class="sxs-lookup"><span data-stu-id="752a4-202">Alternatively if network internet access is limited to white-listed domains, the domains below are required for automatic upgrade:   go.microsoft.com   download.microsoft.com</span></span>

6. <span data-ttu-id="752a4-203">Установите соответствующие исключения при проверке антивирусной программой для Service Fabric:</span><span class="sxs-lookup"><span data-stu-id="752a4-203">Set appropriate Service Fabric antivirus exclusions:</span></span>

| <span data-ttu-id="752a4-204">**Исключаемые при проверке антивирусной программой каталоги**</span><span class="sxs-lookup"><span data-stu-id="752a4-204">**Antivirus Excluded directories**</span></span> |
| --- |
| <span data-ttu-id="752a4-205">Program Files\Microsoft Service Fabric</span><span class="sxs-lookup"><span data-stu-id="752a4-205">Program Files\Microsoft Service Fabric</span></span> |
| <span data-ttu-id="752a4-206">FabricDataRoot (из конфигурации кластера)</span><span class="sxs-lookup"><span data-stu-id="752a4-206">FabricDataRoot (from cluster configuration)</span></span> |
| <span data-ttu-id="752a4-207">FabricLogRoot (из конфигурации кластера)</span><span class="sxs-lookup"><span data-stu-id="752a4-207">FabricLogRoot (from cluster configuration)</span></span> |

| <span data-ttu-id="752a4-208">**Исключаемые при проверке антивирусной программой процессы**</span><span class="sxs-lookup"><span data-stu-id="752a4-208">**Antivirus Excluded processes**</span></span> |
| --- |
| <span data-ttu-id="752a4-209">Fabric.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-209">Fabric.exe</span></span> |
| <span data-ttu-id="752a4-210">FabricHost.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-210">FabricHost.exe</span></span> |
| <span data-ttu-id="752a4-211">FabricInstallerService.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-211">FabricInstallerService.exe</span></span> |
| <span data-ttu-id="752a4-212">FabricSetup.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-212">FabricSetup.exe</span></span> |
| <span data-ttu-id="752a4-213">FabricDeployer.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-213">FabricDeployer.exe</span></span> |
| <span data-ttu-id="752a4-214">ImageBuilder.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-214">ImageBuilder.exe</span></span> |
| <span data-ttu-id="752a4-215">FabricGateway.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-215">FabricGateway.exe</span></span> |
| <span data-ttu-id="752a4-216">FabricDCA.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-216">FabricDCA.exe</span></span> |
| <span data-ttu-id="752a4-217">FabricFAS.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-217">FabricFAS.exe</span></span> |
| <span data-ttu-id="752a4-218">FabricUOS.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-218">FabricUOS.exe</span></span> |
| <span data-ttu-id="752a4-219">FabricRM.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-219">FabricRM.exe</span></span> |
| <span data-ttu-id="752a4-220">FileStoreService.exe</span><span class="sxs-lookup"><span data-stu-id="752a4-220">FileStoreService.exe</span></span> |

### <a name="step-8-validate-environment-using-testconfiguration-script"></a><span data-ttu-id="752a4-221">Шаг 8.</span><span class="sxs-lookup"><span data-stu-id="752a4-221">Step 8.</span></span> <span data-ttu-id="752a4-222">Проверка среды с помощью сценария TestConfiguration</span><span class="sxs-lookup"><span data-stu-id="752a4-222">Validate environment using TestConfiguration script</span></span>
<span data-ttu-id="752a4-223">Сценарий TestConfiguration.ps1 можно найти в изолированном пакете.</span><span class="sxs-lookup"><span data-stu-id="752a4-223">The TestConfiguration.ps1 script can be found in the standalone package.</span></span> <span data-ttu-id="752a4-224">Он используется как анализатор соответствия рекомендациям и позволяет проверить некоторые описанные выше условия. Его следует использовать для проверки работоспособности развертывания кластера в конкретной среде.</span><span class="sxs-lookup"><span data-stu-id="752a4-224">It is used as a Best Practices Analyzer to validate some of the criteria above and should be used as a sanity check to validate whether a cluster can be deployed on a given environment.</span></span> <span data-ttu-id="752a4-225">В случае любого сбоя обратитесь к списку в подразделе [Настройка среды](service-fabric-cluster-standalone-deployment-preparation.md), чтобы устранить неполадки.</span><span class="sxs-lookup"><span data-stu-id="752a4-225">If there is any failure, refer to the list under [Environment Setup](service-fabric-cluster-standalone-deployment-preparation.md) for troubleshooting.</span></span> 

<span data-ttu-id="752a4-226">Этот сценарий может выполняться на любом компьютере, у которого есть доступ администратора ко всем компьютерам, перечисленным в качестве узлов в файле конфигурации кластера.</span><span class="sxs-lookup"><span data-stu-id="752a4-226">This script can be run on any machine that has administrator access to all the machines that are listed as nodes in the cluster configuration file.</span></span> <span data-ttu-id="752a4-227">Компьютер, на котором выполняется этот сценарий, может и не входить в кластер.</span><span class="sxs-lookup"><span data-stu-id="752a4-227">The machine that this script is run on does not have to be part of the cluster.</span></span>

```powershell
PS C:\temp\Microsoft.Azure.ServiceFabric.WindowsServer> .\TestConfiguration.ps1 -ClusterConfigFilePath .\ClusterConfig.Unsecure.DevCluster.json
Trace folder already exists. Traces will be written to existing trace folder: C:\temp\Microsoft.Azure.ServiceFabric.WindowsServer\DeploymentTraces
Running Best Practices Analyzer...
Best Practices Analyzer completed successfully.


LocalAdminPrivilege        : True
IsJsonValid                : True
IsCabValid                 : True
RequiredPortsOpen          : True
RemoteRegistryAvailable    : True
FirewallAvailable          : True
RpcCheckPassed             : True
NoConflictingInstallations : True
FabricInstallable          : True
Passed                     : True
```

<span data-ttu-id="752a4-228">В настоящее время данный модуль тестирования конфигурации не проверяет конфигурацию безопасности, поэтому ее нужно проверить отдельно.</span><span class="sxs-lookup"><span data-stu-id="752a4-228">Currently this configuration testing module does not validate the security configuration so this has to be done independently.</span></span>  

> [!NOTE]
> <span data-ttu-id="752a4-229">Мы постоянно вносим улучшения для повышения надежности модуля. Поэтому, если вы обнаружили сбои в работе модуля TestConfiguration или полагаете, что в нем чего-то не хватает, сообщите нам через [поддерживаемые каналы](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-support).</span><span class="sxs-lookup"><span data-stu-id="752a4-229">We are continually making improvements to make this module more robust, so if there is a faulty or missing case which you believe isn't currently caught by TestConfiguration, please let us know through our [support channels](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-support).</span></span>   
> 
> 

## <a name="next-steps"></a><span data-ttu-id="752a4-230">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="752a4-230">Next steps</span></span>
* [<span data-ttu-id="752a4-231">Создание изолированного кластера под управлением Windows Server</span><span class="sxs-lookup"><span data-stu-id="752a4-231">Create a standalone cluster running on Windows Server</span></span>](service-fabric-cluster-creation-for-windows-server.md)
