---
title: "Описание кластера диспетчера ресурсов aaaCluster | Документы Microsoft"
description: "Описание кластера Service Fabric, указав доменов сбоя, домены обновления, свойства узла и узла емкости hello диспетчер ресурсов кластера."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 55f8ab37-9399-4c9a-9e6c-d2d859de6766
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: f2822075976bd54402af5ad56991b5b360dfb1d8
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="describing-a-service-fabric-cluster"></a><span data-ttu-id="0bbef-103">Описание кластера Service Fabric</span><span class="sxs-lookup"><span data-stu-id="0bbef-103">Describing a service fabric cluster</span></span>
<span data-ttu-id="0bbef-104">Диспетчер ресурсов кластера Service Fabric Hello предоставляет несколько механизмов для описания кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-104">hello Service Fabric Cluster Resource Manager provides several mechanisms for describing a cluster.</span></span> <span data-ttu-id="0bbef-105">Во время выполнения hello диспетчер ресурсов кластера использует этот сведения tooensure высокий уровень доступности hello служб, работающих в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-105">During runtime, hello Cluster Resource Manager uses this information tooensure high availability of hello services running in hello cluster.</span></span> <span data-ttu-id="0bbef-106">Во время применения этих важных правил, также выполняется попытка toooptimize потребления ресурсов hello в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-106">While enforcing these important rules, it also attempts toooptimize hello resource consumption within hello cluster.</span></span>

## <a name="key-concepts"></a><span data-ttu-id="0bbef-107">Основные понятия</span><span class="sxs-lookup"><span data-stu-id="0bbef-107">Key concepts</span></span>
<span data-ttu-id="0bbef-108">Диспетчер ресурсов кластера Hello поддерживает несколько функций, которые описывают кластера:</span><span class="sxs-lookup"><span data-stu-id="0bbef-108">hello Cluster Resource Manager supports several features that describe a cluster:</span></span>

* <span data-ttu-id="0bbef-109">Домены сбоя</span><span class="sxs-lookup"><span data-stu-id="0bbef-109">Fault Domains</span></span>
* <span data-ttu-id="0bbef-110">Домены обновления</span><span class="sxs-lookup"><span data-stu-id="0bbef-110">Upgrade Domains</span></span>
* <span data-ttu-id="0bbef-111">Свойства узла</span><span class="sxs-lookup"><span data-stu-id="0bbef-111">Node Properties</span></span>
* <span data-ttu-id="0bbef-112">Емкость узла</span><span class="sxs-lookup"><span data-stu-id="0bbef-112">Node Capacities</span></span>

## <a name="fault-domains"></a><span data-ttu-id="0bbef-113">Домены сбоя</span><span class="sxs-lookup"><span data-stu-id="0bbef-113">Fault domains</span></span>
<span data-ttu-id="0bbef-114">Домен сбоя — это любая область координированного сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-114">A Fault Domain is any area of coordinated failure.</span></span> <span data-ttu-id="0bbef-115">Один компьютер входит в домен сбоя (поскольку она может завершиться ошибкой в его собственный по различным причинам из power питания сбоев toodrive сбоев toobad Сетевых микропрограммного обеспечения).</span><span class="sxs-lookup"><span data-stu-id="0bbef-115">A single machine is a Fault Domain (since it can fail on its own for various reasons, from power supply failures toodrive failures toobad NIC firmware).</span></span> <span data-ttu-id="0bbef-116">Компьютеры, подключенных toohello же коммутатор Ethernet находятся в одном домене, hello как — это компьютеры, совместного использования одного источника питания, или в одном месте.</span><span class="sxs-lookup"><span data-stu-id="0bbef-116">Machines connected toohello same Ethernet switch are in hello same Fault Domain, as are machines sharing a single source of power or in a single location.</span></span> <span data-ttu-id="0bbef-117">Так как это естественное для toooverlap сбои оборудования, домены сбоя по своей природе иерархических и представляются в виде URI в Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0bbef-117">Since it's natural for hardware faults toooverlap, Fault Domains are inherently hierarchal and are represented as URIs in Service Fabric.</span></span>

<span data-ttu-id="0bbef-118">Очень важно, что домены сбоя правильно настроены так, как это toosafely месте служб использует Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0bbef-118">It is important that Fault Domains are set up correctly since Service Fabric uses this information toosafely place services.</span></span> <span data-ttu-id="0bbef-119">Service Fabric не хочет tooplace служб таким образом, что потери hello домен сбоя (по причине hello сбоя одного из компонентов) вызывает toogo службы вниз.</span><span class="sxs-lookup"><span data-stu-id="0bbef-119">Service Fabric doesn't want tooplace services such that hello loss of a Fault Domain (caused by hello failure of some component) causes a service toogo down.</span></span> <span data-ttu-id="0bbef-120">В hello среды Azure Service Fabric использует hello домен сбоя сведения, предоставляемые toocorrectly среды hello настройте hello узлов в кластере hello от вашего имени.</span><span class="sxs-lookup"><span data-stu-id="0bbef-120">In hello Azure environment Service Fabric uses hello Fault Domain information provided by hello environment toocorrectly configure hello nodes in hello cluster on your behalf.</span></span> <span data-ttu-id="0bbef-121">Настроена для автономной службы структуры, домены сбоя определяются во время hello hello кластера</span><span class="sxs-lookup"><span data-stu-id="0bbef-121">For Service Fabric Standalone, Fault Domains are defined at hello time that hello cluster is set up</span></span> 

> [!WARNING]
> <span data-ttu-id="0bbef-122">Очень важно, что hello сведения домен сбоя, если tooService структуры является точным.</span><span class="sxs-lookup"><span data-stu-id="0bbef-122">It is important that hello Fault Domain information provided tooService Fabric is accurate.</span></span> <span data-ttu-id="0bbef-123">Например, предположим, что узлы кластера Service Fabric выполняются на 10 виртуальных машинах, работающих на пяти физических узлах.</span><span class="sxs-lookup"><span data-stu-id="0bbef-123">For example, let's say that your Service Fabric cluster's nodes are running inside 10 virtual machines, running on five physical hosts.</span></span> <span data-ttu-id="0bbef-124">В этом случае, даже если используется 10 виртуальных машин, имеется только 5 разных (верхнего уровня) доменов сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-124">In this case, even though there are 10 virtual machines, there's only 5 different (top level) fault domains.</span></span> <span data-ttu-id="0bbef-125">Совместное использование hello вызывает на одном физическом узле виртуальных машин tooshare hello же корневой домен сбоя, поскольку hello взаимодействие с виртуальными машинами координируемой сбой в случае их физического узла.</span><span class="sxs-lookup"><span data-stu-id="0bbef-125">Sharing hello same physical host causes VMs tooshare hello same root fault domain, since hello VMs experience coordinated failure if their physical host fails.</span></span>  
>
> <span data-ttu-id="0bbef-126">Поскольку Service Fabric ожидает hello домен сбоя узла не toochange.</span><span class="sxs-lookup"><span data-stu-id="0bbef-126">Since Service Fabric expects hello Fault Domain of a node not toochange.</span></span> <span data-ttu-id="0bbef-127">Другие механизмы обеспечения высокого уровня доступности hello виртуальных машин, такие как [виртуальных машин высокой НАДЕЖНОСТИ](https://technet.microsoft.com/en-us/library/cc967323.aspx), используйте прозрачный миграция виртуальных машин с одного узла tooanother.</span><span class="sxs-lookup"><span data-stu-id="0bbef-127">Other mechanisms of ensuring high availability of hello VMs, such as [HA-VMs](https://technet.microsoft.com/en-us/library/cc967323.aspx), use transparent migration of VMs from one host tooanother.</span></span> <span data-ttu-id="0bbef-128">Эти механизмы не перенастроить или уведомлять hello выполнение кода внутри hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="0bbef-128">These mechanisms do not reconfigure or notify hello running code inside hello VM.</span></span> <span data-ttu-id="0bbef-129">Следовательно, использующие их среды **не подходят** для выполнения кластеров Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0bbef-129">As such, they are **not supported** as environments for running Service Fabric clusters.</span></span> <span data-ttu-id="0bbef-130">Service Fabric должен быть принят на работу технологии только высокого уровня доступности hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-130">Service Fabric should be hello only high-availability technology employed.</span></span> <span data-ttu-id="0bbef-131">Необходимости в таких механизмах, как динамическая миграция виртуальных машин, сети SAN или прочие, нет.</span><span class="sxs-lookup"><span data-stu-id="0bbef-131">Mechanisms like live VM migration, SANs, or others are not necessary.</span></span> <span data-ttu-id="0bbef-132">При использовании совместно с Service Fabric эти механизмы _снижают_ доступность и надежность приложений, так как повышают сложность, добавляют централизованные источники сбоев и используют стратегии обеспечения надежности и доступности, которые конфликтуют с механизмами Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0bbef-132">If used in conjunction with Service Fabric, these mechanisms _reduce_ application availability and reliability because they introduce additional complexity, add centralized sources of failure, and utilize reliability and availability strategies that conflict with those in Service Fabric.</span></span> 
>
>

<span data-ttu-id="0bbef-133">В следующем рисунке hello мы цвета все сущности hello, задействованных tooFault доменов и список всех hello разным доменам сбоя, привести.</span><span class="sxs-lookup"><span data-stu-id="0bbef-133">In hello graphic below we color all hello entities that contribute tooFault Domains and list all hello different Fault Domains that result.</span></span> <span data-ttu-id="0bbef-134">В этом примере у нас есть центры обработки данных (DC), стойки (R) и колонки (B).</span><span class="sxs-lookup"><span data-stu-id="0bbef-134">In this example, we have datacenters ("DC"), racks ("R"), and blades ("B").</span></span> <span data-ttu-id="0bbef-135">Можно представить при каждой колонки содержит более одной виртуальной машины, возможно, существуют еще один уровень в иерархии домен сбоя hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-135">Conceivably, if each blade holds more than one virtual machine, there could be another layer in hello Fault Domain hierarchy.</span></span>

<span data-ttu-id="0bbef-136"><center>
![Узлы, организованные через домены сбоя][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="0bbef-136"><center>
![Nodes organized via Fault Domains][Image1]
</center></span></span>

<span data-ttu-id="0bbef-137">Во время выполнения диспетчер ресурсов кластера Service Fabric hello считает, что домены сбоя hello в кластере hello и планов макеты.</span><span class="sxs-lookup"><span data-stu-id="0bbef-137">During runtime, hello Service Fabric Cluster Resource Manager considers hello Fault Domains in hello cluster and plans layouts.</span></span> <span data-ttu-id="0bbef-138">Здравствуйте реплики с отслеживанием состояния или без сохранения состояния экземпляры для данной службы будут распределены, поэтому они находятся в отдельных доменах сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-138">hello stateful replicas or stateless instances for a given service are distributed so they are in separate Fault Domains.</span></span> <span data-ttu-id="0bbef-139">Распространение hello службы в доменах сбоя гарантирует, что hello доступность службы hello не подвергаются опасности при сбое домен сбоя на любом уровне иерархии hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-139">Distributing hello service across fault domains ensures hello availability of hello service is not compromised when a Fault Domain fails at any level of hello hierarchy.</span></span>

<span data-ttu-id="0bbef-140">Диспетчер ресурсов кластера Service Fabric не проверяет, сколько уровней в иерархии домен сбоя hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-140">Service Fabric’s Cluster Resource Manager doesn’t care how many layers there are in hello Fault Domain hierarchy.</span></span> <span data-ttu-id="0bbef-141">Тем не менее он пробует tooensure потери hello любой одной части иерархии hello не оказать влияние на службы, работающие в нем.</span><span class="sxs-lookup"><span data-stu-id="0bbef-141">However, it tries tooensure that hello loss of any one portion of hello hierarchy doesn’t impact services running in it.</span></span> 

<span data-ttu-id="0bbef-142">Рекомендуется при наличии hello одинаковое число узлов на каждом уровне глубины в hello иерархии домен сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-142">It is best if there are hello same number of nodes at each level of depth in hello Fault Domain hierarchy.</span></span> <span data-ttu-id="0bbef-143">Если hello домены сбоя «дерево» является несбалансированной в кластере, это затрудняет для hello диспетчер ресурсов кластера toofigure out hello наиболее размещения служб.</span><span class="sxs-lookup"><span data-stu-id="0bbef-143">If hello “tree” of Fault Domains is unbalanced in your cluster, it makes it harder for hello Cluster Resource Manager toofigure out hello best allocation of services.</span></span> <span data-ttu-id="0bbef-144">Несбалансированных макеты домены сбоя означает, что hello потери некоторых доменов hello влияние доступность служб больше, чем другие домены.</span><span class="sxs-lookup"><span data-stu-id="0bbef-144">Imbalanced Fault Domains layouts mean that hello loss of some domains impact hello availability of services more than other domains.</span></span> <span data-ttu-id="0bbef-145">В результате hello диспетчер ресурсов кластера защита от разрыва между две цели: ему toouse hello машин в домене «большой», поместив в них служб, и ему tooplace службами из других доменов, чтобы потери hello домена не вызывает проблем.</span><span class="sxs-lookup"><span data-stu-id="0bbef-145">As a result, hello Cluster Resource Manager is torn between two goals: It wants toouse hello machines in that “heavy” domain by placing services on them, and it wants tooplace services in other domains so that hello loss of a domain doesn’t cause problems.</span></span> 

<span data-ttu-id="0bbef-146">Как выглядят несбалансированные домены?</span><span class="sxs-lookup"><span data-stu-id="0bbef-146">What do imbalanced domains look like?</span></span> <span data-ttu-id="0bbef-147">В следующей схеме hello показано два различными макетами кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-147">In hello diagram below, we show two different cluster layouts.</span></span> <span data-ttu-id="0bbef-148">В первом примере hello узлы hello распределяются равномерно между hello домены сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-148">In hello first example, hello nodes are distributed evenly across hello Fault Domains.</span></span> <span data-ttu-id="0bbef-149">В втором примере hello один домен сбоя имеет много больше узлов, чем hello другие домены сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-149">In hello second example, one Fault Domain has many more nodes than hello other Fault Domains.</span></span> 

<span data-ttu-id="0bbef-150"><center>
![Две различные структуры кластеров][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="0bbef-150"><center>
![Two different cluster layouts][Image2]
</center></span></span>

<span data-ttu-id="0bbef-151">В Azure Выбор hello, из которых домен сбоя содержит узел осуществляется автоматически.</span><span class="sxs-lookup"><span data-stu-id="0bbef-151">In Azure, hello choice of which Fault Domain contains a node is managed for you.</span></span> <span data-ttu-id="0bbef-152">Тем не менее в зависимости от числа hello узлы, которые можно подготовить можно по-прежнему завершить с доменами отказоустойчивости с помощью нескольких узлов в них, чем другие.</span><span class="sxs-lookup"><span data-stu-id="0bbef-152">However, depending on hello number of nodes that you provision you can still end up with Fault Domains with more nodes in them than others.</span></span> <span data-ttu-id="0bbef-153">Например предположим, имеется пять домены сбоя в кластере hello, но подготовить семь узлов для данного типа.</span><span class="sxs-lookup"><span data-stu-id="0bbef-153">For example, say you have five Fault Domains in hello cluster but provision seven nodes for a given NodeType.</span></span> <span data-ttu-id="0bbef-154">В этом случае hello сначала в двух доменах отказоустойчивости оказаться больше узлов.</span><span class="sxs-lookup"><span data-stu-id="0bbef-154">In this case, hello first two Fault Domains end up with more nodes.</span></span> <span data-ttu-id="0bbef-155">Если продолжить toodeploy дополнительные NodeTypes только несколько экземпляров усугубляется проблема hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-155">If you continue toodeploy more NodeTypes with only a couple instances, hello problem gets worse.</span></span> <span data-ttu-id="0bbef-156">По этой причине рекомендуется, hello количество узлов в каждом типе узла делится на количество доменов сбоя hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-156">For this reason it's recommended that hello number of nodes in each node type is a multiple of hello number of Fault Domains.</span></span>

## <a name="upgrade-domains"></a><span data-ttu-id="0bbef-157">Домены обновления</span><span class="sxs-lookup"><span data-stu-id="0bbef-157">Upgrade domains</span></span>
<span data-ttu-id="0bbef-158">Домены обновления являются другой функцией, которая помогает hello диспетчер ресурсов кластера Service Fabric анализа структуры hello hello кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-158">Upgrade Domains are another feature that helps hello Service Fabric Cluster Resource Manager understand hello layout of hello cluster.</span></span> <span data-ttu-id="0bbef-159">Домены обновления определяют наборы узлов, которые будут обновлены в hello то же время.</span><span class="sxs-lookup"><span data-stu-id="0bbef-159">Upgrade Domains define sets of nodes that are upgraded at hello same time.</span></span> <span data-ttu-id="0bbef-160">Обновление доменов справки hello диспетчер ресурсов кластера понять и координировать операции управления, такие как обновления.</span><span class="sxs-lookup"><span data-stu-id="0bbef-160">Upgrade Domains help hello Cluster Resource Manager understand and orchestrate management operations like upgrades.</span></span>

<span data-ttu-id="0bbef-161">Домены обновления очень похожи на домены сбоя, но имеют ряд ключевых отличий.</span><span class="sxs-lookup"><span data-stu-id="0bbef-161">Upgrade Domains are a lot like Fault Domains, but with a couple key differences.</span></span> <span data-ttu-id="0bbef-162">Домены сбоя определяются областями согласованных сбоев оборудования.</span><span class="sxs-lookup"><span data-stu-id="0bbef-162">First, areas of coordinated hardware failures define Fault Domains.</span></span> <span data-ttu-id="0bbef-163">Домены обновления, на hello другой стороны, определяются политикой.</span><span class="sxs-lookup"><span data-stu-id="0bbef-163">Upgrade Domains, on hello other hand, are defined by policy.</span></span> <span data-ttu-id="0bbef-164">Вы получаете toodecide, сколько требуется, вместо его диктовку средой hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-164">You get toodecide how many you want, rather than it being dictated by hello environment.</span></span> <span data-ttu-id="0bbef-165">Можно создать любое количество доменов обновления, как и узлов.</span><span class="sxs-lookup"><span data-stu-id="0bbef-165">You could have as many Upgrade Domains as you do nodes.</span></span> <span data-ttu-id="0bbef-166">Еще одно различие между доменами сбоя и доменами обновления заключается в том, что домены обновления не являются иерархическими.</span><span class="sxs-lookup"><span data-stu-id="0bbef-166">Another difference between Fault Domains and Upgrade Domains is that Upgrade Domains are not hierarchical.</span></span> <span data-ttu-id="0bbef-167">Вместо этого они больше напоминают простой тег.</span><span class="sxs-lookup"><span data-stu-id="0bbef-167">Instead, they are more like a simple tag.</span></span> 

<span data-ttu-id="0bbef-168">Hello следующей схеме показаны три домены обновления распределяются в трех доменах сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-168">hello following diagram shows three Upgrade Domains are striped across three Fault Domains.</span></span> <span data-ttu-id="0bbef-169">На ней также представлено одно возможное размещение трех разных реплик службы с отслеживанием состояния, где каждая из них находится в разных доменах сбоя и обновления.</span><span class="sxs-lookup"><span data-stu-id="0bbef-169">It also shows one possible placement for three different replicas of a stateful service, where each ends up in different Fault and Upgrade Domains.</span></span> <span data-ttu-id="0bbef-170">Такое размещение позволяет hello потери домен сбоя в середине hello обновление службы и еще одну копию кода hello и данных.</span><span class="sxs-lookup"><span data-stu-id="0bbef-170">This placement allows hello loss of a Fault Domain while in hello middle of a service upgrade and still have one copy of hello code and data.</span></span>  

<span data-ttu-id="0bbef-171"><center>
![Размещение с доменами сбоя и обновления][Image3]
</center></span><span class="sxs-lookup"><span data-stu-id="0bbef-171"><center>
![Placement With Fault and Upgrade Domains][Image3]
</center></span></span>

<span data-ttu-id="0bbef-172">Есть свои преимущества и недостатки toohaving большое число доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="0bbef-172">There are pros and cons toohaving large numbers of Upgrade Domains.</span></span> <span data-ttu-id="0bbef-173">Дополнительные домены обновления означает более детального каждый шаг обновления hello и таким образом влияет на меньшее число узлов или служб.</span><span class="sxs-lookup"><span data-stu-id="0bbef-173">More Upgrade Domains means each step of hello upgrade is more granular and therefore affects a smaller number of nodes or services.</span></span> <span data-ttu-id="0bbef-174">В результате меньше службы имеют toomove во время внесения меньше обработки в системе hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-174">As a result, fewer services have toomove at a time, introducing less churn into hello system.</span></span> <span data-ttu-id="0bbef-175">Это обычно tooimprove надежности, поскольку меньше службы hello затронуты любые проблемы, появившиеся во время обновления hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-175">This tends tooimprove reliability, since less of hello service is impacted by any issue introduced during hello upgrade.</span></span> <span data-ttu-id="0bbef-176">Дополнительные домены обновления также означает, что требуется меньше буферную на другие узлы toohandle hello влияние hello обновить.</span><span class="sxs-lookup"><span data-stu-id="0bbef-176">More Upgrade Domains also means that you need less available buffer on other nodes toohandle hello impact of hello upgrade.</span></span> <span data-ttu-id="0bbef-177">Например если имеется пять домены обновления hello узлов в каждом обработки примерно 20% от трафика.</span><span class="sxs-lookup"><span data-stu-id="0bbef-177">For example, if you have five Upgrade Domains, hello nodes in each are handling roughly 20% of your traffic.</span></span> <span data-ttu-id="0bbef-178">Если требуется tootake работу этого домена обновления для обновления этой нагрузки обычно требуется toogo в любом месте.</span><span class="sxs-lookup"><span data-stu-id="0bbef-178">If you need tootake down that Upgrade Domain for an upgrade, that load usually needs toogo somewhere.</span></span> <span data-ttu-id="0bbef-179">Так как у вас есть четыре остальные домены обновления, они должны иметь место для 5% hello всего трафика.</span><span class="sxs-lookup"><span data-stu-id="0bbef-179">Since you have four remaining Upgrade Domains, each must have room for about 5% of hello total traffic.</span></span> <span data-ttu-id="0bbef-180">Дополнительные домены обновления означает, что требуется меньше буфера на узлах кластера hello hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-180">More Upgrade Domains means you need less buffer on hello nodes in hello cluster.</span></span> <span data-ttu-id="0bbef-181">Например, предположим, что у вас имеется не 5, а 10 доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="0bbef-181">For example, consider if you had 10 Upgrade Domains instead.</span></span> <span data-ttu-id="0bbef-182">В этом случае каждый UD только происходит обработка около 10% от общего трафика hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-182">In that case, each UD would only be handling about 10% of hello total traffic.</span></span> <span data-ttu-id="0bbef-183">При этапы обновления через hello кластер каждый домен будет достаточно места toohave около 1.1% hello всего трафика.</span><span class="sxs-lookup"><span data-stu-id="0bbef-183">When an upgrade steps through hello cluster, each domain would only need toohave room for about 1.1% of hello total traffic.</span></span> <span data-ttu-id="0bbef-184">Дополнительные домены обновления обычно позволяют toorun к узлам на более высокую степень использования, поскольку требуется меньше зарезервированный объем ресурсов.</span><span class="sxs-lookup"><span data-stu-id="0bbef-184">More Upgrade Domains generally allow you toorun your nodes at higher utilization, since you need less reserved capacity.</span></span> <span data-ttu-id="0bbef-185">Hello то же верно для доменов сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-185">hello same is true for Fault Domains.</span></span>  

<span data-ttu-id="0bbef-186">Недостатком Hello иметь множество доменов обновления — обновления, как правило tootake больше времени.</span><span class="sxs-lookup"><span data-stu-id="0bbef-186">hello downside of having many Upgrade Domains is that upgrades tend tootake longer.</span></span> <span data-ttu-id="0bbef-187">Service Fabric ожидает на короткое время после завершения обновления домена и выполняет проверку до начала tooupgrade hello следующее.</span><span class="sxs-lookup"><span data-stu-id="0bbef-187">Service Fabric waits a short period of time after an Upgrade Domain is completed and performs checks before starting tooupgrade hello next one.</span></span> <span data-ttu-id="0bbef-188">Эти задержки включить обнаружение проблем, представленных hello обновления для продолжения обновления hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-188">These delays enable detecting issues introduced by hello upgrade before hello upgrade proceeds.</span></span> <span data-ttu-id="0bbef-189">компромисс Hello является допустимым, поскольку он предотвращает неправильный изменения влияют на слишком большую часть hello службы одновременно.</span><span class="sxs-lookup"><span data-stu-id="0bbef-189">hello tradeoff is acceptable because it prevents bad changes from affecting too much of hello service at a time.</span></span>

<span data-ttu-id="0bbef-190">Слишком малое количество доменов обновления имеет множество отрицательных побочных эффектов: пока каждый отдельный домен обновления недоступен и обновляется, значительная часть общей емкости ресурсов недоступна.</span><span class="sxs-lookup"><span data-stu-id="0bbef-190">Too few Upgrade Domains has many negative side effects – while each individual Upgrade Domain is down and being upgraded a large portion of your overall capacity is unavailable.</span></span> <span data-ttu-id="0bbef-191">Например, при наличии только трех доменов обновления вы одновременно отключаете примерно треть общих ресурсов службы или кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-191">For example, if you only have three Upgrade Domains you are taking down about 1/3 of your overall service or cluster capacity at a time.</span></span> <span data-ttu-id="0bbef-192">Наличие слишком много ресурсов службы работу сразу не нежелательно, так как у вас есть toohave достаточную мощность в hello остальная часть рабочей нагрузки кластера toohandle hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-192">Having so much of your service down at once isn’t desirable since you have toohave enough capacity in hello rest of your cluster toohandle hello workload.</span></span> <span data-ttu-id="0bbef-193">Наличие этого буфера означает, что во время обычной работы данные узлы будут менее загружены, чем они были бы в противном случае.</span><span class="sxs-lookup"><span data-stu-id="0bbef-193">Maintaining that buffer means that during normal operation those nodes are less loaded than they would be otherwise.</span></span> <span data-ttu-id="0bbef-194">Это увеличивает hello стоимость выполнения службы.</span><span class="sxs-lookup"><span data-stu-id="0bbef-194">This increases hello cost of running your service.</span></span>

<span data-ttu-id="0bbef-195">Нет не реальных ограничение toohello общее число ошибок или домены обновления в среде, а также ограничения на том, как они перекрываются.</span><span class="sxs-lookup"><span data-stu-id="0bbef-195">There’s no real limit toohello total number of fault or Upgrade Domains in an environment, or constraints on how they overlap.</span></span> <span data-ttu-id="0bbef-196">С другой стороны, существует несколько общих шаблонов:</span><span class="sxs-lookup"><span data-stu-id="0bbef-196">That said, there are several common patterns:</span></span>

- <span data-ttu-id="0bbef-197">соотношение 1:1 (каждый домен сбоя сопоставляется с доменом обновления);</span><span class="sxs-lookup"><span data-stu-id="0bbef-197">Fault Domains and Upgrade Domains mapped 1:1</span></span>
- <span data-ttu-id="0bbef-198">один домен обновления на узел (экземпляр физической или виртуальной ОС);</span><span class="sxs-lookup"><span data-stu-id="0bbef-198">One Upgrade Domain per Node (physical or virtual OS instance)</span></span>
- <span data-ttu-id="0bbef-199">Модель «чередующиеся» или «Матрица», где hello домены сбоя и обновления формируют матрицу с машинами обычно работающих вниз диагонали hello</span><span class="sxs-lookup"><span data-stu-id="0bbef-199">A “striped” or “matrix” model where hello Fault Domains and Upgrade Domains form a matrix with machines usually running down hello diagonals</span></span>

<span data-ttu-id="0bbef-200"><center>
![Структуры доменов сбоя и обновления][Image4]
</center></span><span class="sxs-lookup"><span data-stu-id="0bbef-200"><center>
![Fault and Upgrade Domain Layouts][Image4]
</center></span></span>

<span data-ttu-id="0bbef-201">Что не лучший ответ какие toochoose макета, каждый имеет некоторые преимущества и недостатки.</span><span class="sxs-lookup"><span data-stu-id="0bbef-201">There’s no best answer which layout toochoose, each has some pros and cons.</span></span> <span data-ttu-id="0bbef-202">Например модель 1FD:1UD hello — простой tooset вверх.</span><span class="sxs-lookup"><span data-stu-id="0bbef-202">For example, hello 1FD:1UD model is simple tooset up.</span></span> <span data-ttu-id="0bbef-203">Hello 1 домен обновления каждого узла модели является наиболее какие сотрудники, используемый для.</span><span class="sxs-lookup"><span data-stu-id="0bbef-203">hello 1 Upgrade Domain per Node model is most like what people are used to.</span></span> <span data-ttu-id="0bbef-204">Во время обновления все узлы обновляются независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="0bbef-204">During upgrades each node is updated independently.</span></span> <span data-ttu-id="0bbef-205">Это аналогично toohow небольших наборов машин обновлены вручную в прошлом hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-205">This is similar toohow small sets of machines were upgraded manually in hello past.</span></span> 

<span data-ttu-id="0bbef-206">наиболее распространенные модель Hello — hello FD/UD матрицы, где hello сбоя и доменам обновления форму таблицы и узлы располагаются начиная вдоль hello по диагонали.</span><span class="sxs-lookup"><span data-stu-id="0bbef-206">hello most common model is hello FD/UD matrix, where hello FDs and UDs form a table and nodes are placed starting along hello diagonal.</span></span> <span data-ttu-id="0bbef-207">Это модель hello, используется по умолчанию в Service Fabric кластеров в Azure.</span><span class="sxs-lookup"><span data-stu-id="0bbef-207">This is hello model used by default in Service Fabric clusters in Azure.</span></span> <span data-ttu-id="0bbef-208">Для кластеров с узлами много все завершает выглядит шаблон плотную матрицу hello выше.</span><span class="sxs-lookup"><span data-stu-id="0bbef-208">For clusters with many nodes everything ends up looking like hello dense matrix pattern above.</span></span>

## <a name="fault-and-upgrade-domain-constraints-and-resulting-behavior"></a><span data-ttu-id="0bbef-209">Ограничения доменов сбоя и обновления и соответствующее поведение</span><span class="sxs-lookup"><span data-stu-id="0bbef-209">Fault and Upgrade Domain constraints and resulting behavior</span></span>
<span data-ttu-id="0bbef-210">Диспетчер ресурсов кластера Hello обрабатывает hello желания tookeep службы равномерно распределяется по доменам сбоя и обновления как ограничение.</span><span class="sxs-lookup"><span data-stu-id="0bbef-210">hello Cluster Resource Manager treats hello desire tookeep a service balanced across fault and Upgrade Domains as a constraint.</span></span> <span data-ttu-id="0bbef-211">Дополнительные сведения об ограничениях см. в [этой статье](service-fabric-cluster-resource-manager-management-integration.md).</span><span class="sxs-lookup"><span data-stu-id="0bbef-211">You can find out more about constraints in [this article](service-fabric-cluster-resource-manager-management-integration.md).</span></span> <span data-ttu-id="0bbef-212">Здравствуйте ограничения состояния сбоя и доменов обновления:» для данного служебного раздела никогда не следует различие *больше единицы* hello число объектов службы (службы без отслеживания состояния экземпляры или реплики службы с отслеживанием состояния) между двумя доменами.»</span><span class="sxs-lookup"><span data-stu-id="0bbef-212">hello Fault and Upgrade Domain constraints state: "For a given service partition there should never be a difference *greater than one* in hello number of service objects (stateless service instances or stateful service replicas) between two domains."</span></span> <span data-ttu-id="0bbef-213">Это предотвращает определенные перемещения или упорядочения, которые нарушают данное ограничение.</span><span class="sxs-lookup"><span data-stu-id="0bbef-213">This prevents certain moves or arrangements that violate this constraint.</span></span>

<span data-ttu-id="0bbef-214">Давайте рассмотрим один пример.</span><span class="sxs-lookup"><span data-stu-id="0bbef-214">Let's look at one example.</span></span> <span data-ttu-id="0bbef-215">Предположим, что у нас есть кластер с шестью узлами (У), на котором настроено пять доменов сбоя (ДС) и пять доменов обновления (ДО).</span><span class="sxs-lookup"><span data-stu-id="0bbef-215">Let's say that we have a cluster with six nodes, configured with five Fault Domains and five Upgrade Domains.</span></span>

|  | <span data-ttu-id="0bbef-216">ДС0</span><span class="sxs-lookup"><span data-stu-id="0bbef-216">FD0</span></span> | <span data-ttu-id="0bbef-217">ДС1</span><span class="sxs-lookup"><span data-stu-id="0bbef-217">FD1</span></span> | <span data-ttu-id="0bbef-218">ДС2</span><span class="sxs-lookup"><span data-stu-id="0bbef-218">FD2</span></span> | <span data-ttu-id="0bbef-219">ДС3</span><span class="sxs-lookup"><span data-stu-id="0bbef-219">FD3</span></span> | <span data-ttu-id="0bbef-220">ДС4</span><span class="sxs-lookup"><span data-stu-id="0bbef-220">FD4</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="0bbef-221">**ДО0**</span><span class="sxs-lookup"><span data-stu-id="0bbef-221">**UD0**</span></span> |<span data-ttu-id="0bbef-222">У1</span><span class="sxs-lookup"><span data-stu-id="0bbef-222">N1</span></span> | | | | |
| <span data-ttu-id="0bbef-223">**ДО1**</span><span class="sxs-lookup"><span data-stu-id="0bbef-223">**UD1**</span></span> |<span data-ttu-id="0bbef-224">У6</span><span class="sxs-lookup"><span data-stu-id="0bbef-224">N6</span></span> |<span data-ttu-id="0bbef-225">У2</span><span class="sxs-lookup"><span data-stu-id="0bbef-225">N2</span></span> | | | |
| <span data-ttu-id="0bbef-226">**ДО2**</span><span class="sxs-lookup"><span data-stu-id="0bbef-226">**UD2**</span></span> | | |<span data-ttu-id="0bbef-227">У3</span><span class="sxs-lookup"><span data-stu-id="0bbef-227">N3</span></span> | | |
| <span data-ttu-id="0bbef-228">**ДО3**</span><span class="sxs-lookup"><span data-stu-id="0bbef-228">**UD3**</span></span> | | | |<span data-ttu-id="0bbef-229">У4</span><span class="sxs-lookup"><span data-stu-id="0bbef-229">N4</span></span> | |
| <span data-ttu-id="0bbef-230">**ДО4**</span><span class="sxs-lookup"><span data-stu-id="0bbef-230">**UD4**</span></span> | | | | |<span data-ttu-id="0bbef-231">У5</span><span class="sxs-lookup"><span data-stu-id="0bbef-231">N5</span></span> |

<span data-ttu-id="0bbef-232">Теперь предположим, что мы создаем службу, для которой TargetReplicaSetSize (или InstanceCount для службы без отслеживания состояния) имеет значение 5.</span><span class="sxs-lookup"><span data-stu-id="0bbef-232">Now let's say that we create a service with a TargetReplicaSetSize (or, for a stateless service an InstanceCount) of five.</span></span> <span data-ttu-id="0bbef-233">Hello реплик поступить в N1 N5.</span><span class="sxs-lookup"><span data-stu-id="0bbef-233">hello replicas land on N1-N5.</span></span> <span data-ttu-id="0bbef-234">Узел У6 фактически никогда не используется, вне зависимости от количества создаваемых служб.</span><span class="sxs-lookup"><span data-stu-id="0bbef-234">In fact, N6 is never used no matter how many services like this you create.</span></span> <span data-ttu-id="0bbef-235">Но почему?</span><span class="sxs-lookup"><span data-stu-id="0bbef-235">But why?</span></span> <span data-ttu-id="0bbef-236">Давайте рассмотрим hello разница между текущим макетом hello и что произойдет, если вы выбрали N6.</span><span class="sxs-lookup"><span data-stu-id="0bbef-236">Let's look at hello difference between hello current layout and what would happen if N6 is chosen.</span></span>

<span data-ttu-id="0bbef-237">Вот макета hello мы получили и hello допустимое количество реплик на сбоя и доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="0bbef-237">Here's hello layout we got and hello total number of replicas per Fault and Upgrade Domain:</span></span>

|  | <span data-ttu-id="0bbef-238">ДС0</span><span class="sxs-lookup"><span data-stu-id="0bbef-238">FD0</span></span> | <span data-ttu-id="0bbef-239">ДС1</span><span class="sxs-lookup"><span data-stu-id="0bbef-239">FD1</span></span> | <span data-ttu-id="0bbef-240">ДС2</span><span class="sxs-lookup"><span data-stu-id="0bbef-240">FD2</span></span> | <span data-ttu-id="0bbef-241">ДС3</span><span class="sxs-lookup"><span data-stu-id="0bbef-241">FD3</span></span> | <span data-ttu-id="0bbef-242">ДС4</span><span class="sxs-lookup"><span data-stu-id="0bbef-242">FD4</span></span> | <span data-ttu-id="0bbef-243">Всего ДО</span><span class="sxs-lookup"><span data-stu-id="0bbef-243">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="0bbef-244">**ДО0**</span><span class="sxs-lookup"><span data-stu-id="0bbef-244">**UD0**</span></span> |<span data-ttu-id="0bbef-245">Р1</span><span class="sxs-lookup"><span data-stu-id="0bbef-245">R1</span></span> | | | | |<span data-ttu-id="0bbef-246">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-246">1</span></span> |
| <span data-ttu-id="0bbef-247">**ДО1**</span><span class="sxs-lookup"><span data-stu-id="0bbef-247">**UD1**</span></span> | |<span data-ttu-id="0bbef-248">Р2</span><span class="sxs-lookup"><span data-stu-id="0bbef-248">R2</span></span> | | | |<span data-ttu-id="0bbef-249">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-249">1</span></span> |
| <span data-ttu-id="0bbef-250">**ДО2**</span><span class="sxs-lookup"><span data-stu-id="0bbef-250">**UD2**</span></span> | | |<span data-ttu-id="0bbef-251">Р3</span><span class="sxs-lookup"><span data-stu-id="0bbef-251">R3</span></span> | | |<span data-ttu-id="0bbef-252">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-252">1</span></span> |
| <span data-ttu-id="0bbef-253">**ДО3**</span><span class="sxs-lookup"><span data-stu-id="0bbef-253">**UD3**</span></span> | | | |<span data-ttu-id="0bbef-254">Р4</span><span class="sxs-lookup"><span data-stu-id="0bbef-254">R4</span></span> | |<span data-ttu-id="0bbef-255">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-255">1</span></span> |
| <span data-ttu-id="0bbef-256">**ДО4**</span><span class="sxs-lookup"><span data-stu-id="0bbef-256">**UD4**</span></span> | | | | |<span data-ttu-id="0bbef-257">Р5</span><span class="sxs-lookup"><span data-stu-id="0bbef-257">R5</span></span> |<span data-ttu-id="0bbef-258">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-258">1</span></span> |
| <span data-ttu-id="0bbef-259">**Всего ДС**</span><span class="sxs-lookup"><span data-stu-id="0bbef-259">**FDTotal**</span></span> |<span data-ttu-id="0bbef-260">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-260">1</span></span> |<span data-ttu-id="0bbef-261">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-261">1</span></span> |<span data-ttu-id="0bbef-262">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-262">1</span></span> |<span data-ttu-id="0bbef-263">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-263">1</span></span> |<span data-ttu-id="0bbef-264">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-264">1</span></span> |- |

<span data-ttu-id="0bbef-265">Эта структура сбалансирована в плане распределения узлов на домен сбоя и домен обновления,</span><span class="sxs-lookup"><span data-stu-id="0bbef-265">This layout is balanced in terms of nodes per Fault Domain and Upgrade Domain.</span></span> <span data-ttu-id="0bbef-266">Он также сбалансирована с точки зрения hello число реплик на сбоя и доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="0bbef-266">It is also balanced in terms of hello number of replicas per Fault and Upgrade Domain.</span></span> <span data-ttu-id="0bbef-267">Каждый домен имеет hello одинаковом количестве узлов и hello одинаковое количество реплик.</span><span class="sxs-lookup"><span data-stu-id="0bbef-267">Each domain has hello same number of nodes and hello same number of replicas.</span></span>

<span data-ttu-id="0bbef-268">Теперь давайте посмотрим, что произошло бы, если бы вместо У2 мы использовали У6.</span><span class="sxs-lookup"><span data-stu-id="0bbef-268">Now, let's look at what would happen if we'd used N6 instead of N2.</span></span> <span data-ttu-id="0bbef-269">Как бы реплик hello распространяться затем?</span><span class="sxs-lookup"><span data-stu-id="0bbef-269">How would hello replicas be distributed then?</span></span>

|  | <span data-ttu-id="0bbef-270">ДС0</span><span class="sxs-lookup"><span data-stu-id="0bbef-270">FD0</span></span> | <span data-ttu-id="0bbef-271">ДС1</span><span class="sxs-lookup"><span data-stu-id="0bbef-271">FD1</span></span> | <span data-ttu-id="0bbef-272">ДС2</span><span class="sxs-lookup"><span data-stu-id="0bbef-272">FD2</span></span> | <span data-ttu-id="0bbef-273">ДС3</span><span class="sxs-lookup"><span data-stu-id="0bbef-273">FD3</span></span> | <span data-ttu-id="0bbef-274">ДС4</span><span class="sxs-lookup"><span data-stu-id="0bbef-274">FD4</span></span> | <span data-ttu-id="0bbef-275">Всего ДО</span><span class="sxs-lookup"><span data-stu-id="0bbef-275">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="0bbef-276">**ДО0**</span><span class="sxs-lookup"><span data-stu-id="0bbef-276">**UD0**</span></span> |<span data-ttu-id="0bbef-277">Р1</span><span class="sxs-lookup"><span data-stu-id="0bbef-277">R1</span></span> | | | | |<span data-ttu-id="0bbef-278">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-278">1</span></span> |
| <span data-ttu-id="0bbef-279">**ДО1**</span><span class="sxs-lookup"><span data-stu-id="0bbef-279">**UD1**</span></span> |<span data-ttu-id="0bbef-280">Р5</span><span class="sxs-lookup"><span data-stu-id="0bbef-280">R5</span></span> | | | | |<span data-ttu-id="0bbef-281">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-281">1</span></span> |
| <span data-ttu-id="0bbef-282">**ДО2**</span><span class="sxs-lookup"><span data-stu-id="0bbef-282">**UD2**</span></span> | | |<span data-ttu-id="0bbef-283">Р2</span><span class="sxs-lookup"><span data-stu-id="0bbef-283">R2</span></span> | | |<span data-ttu-id="0bbef-284">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-284">1</span></span> |
| <span data-ttu-id="0bbef-285">**ДО3**</span><span class="sxs-lookup"><span data-stu-id="0bbef-285">**UD3**</span></span> | | | |<span data-ttu-id="0bbef-286">Р3</span><span class="sxs-lookup"><span data-stu-id="0bbef-286">R3</span></span> | |<span data-ttu-id="0bbef-287">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-287">1</span></span> |
| <span data-ttu-id="0bbef-288">**ДО4**</span><span class="sxs-lookup"><span data-stu-id="0bbef-288">**UD4**</span></span> | | | | |<span data-ttu-id="0bbef-289">Р4</span><span class="sxs-lookup"><span data-stu-id="0bbef-289">R4</span></span> |<span data-ttu-id="0bbef-290">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-290">1</span></span> |
| <span data-ttu-id="0bbef-291">**Всего ДС**</span><span class="sxs-lookup"><span data-stu-id="0bbef-291">**FDTotal**</span></span> |<span data-ttu-id="0bbef-292">2</span><span class="sxs-lookup"><span data-stu-id="0bbef-292">2</span></span> |<span data-ttu-id="0bbef-293">0</span><span class="sxs-lookup"><span data-stu-id="0bbef-293">0</span></span> |<span data-ttu-id="0bbef-294">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-294">1</span></span> |<span data-ttu-id="0bbef-295">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-295">1</span></span> |<span data-ttu-id="0bbef-296">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-296">1</span></span> |- |

<span data-ttu-id="0bbef-297">Этот макет приводит к нарушению нашей определение hello ограничение домен сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-297">This layout violates our definition for hello Fault Domain constraint.</span></span> <span data-ttu-id="0bbef-298">FD0 имеет две реплики, а FD1 имеет нулевое, позволяя hello различие между FD0 и FD1 всего два.</span><span class="sxs-lookup"><span data-stu-id="0bbef-298">FD0 has two replicas, while FD1 has zero, making hello difference between FD0 and FD1 a total of two.</span></span> <span data-ttu-id="0bbef-299">Такой подход не позволяет Hello диспетчер ресурсов кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-299">hello Cluster Resource Manager does not allow this arrangement.</span></span> <span data-ttu-id="0bbef-300">Аналогично, если бы мы выбрали узлы У2 и У6 (вместо У1 и У2), то получили бы следующее.</span><span class="sxs-lookup"><span data-stu-id="0bbef-300">Similarly if we picked N2 and N6 (instead of N1 and N2) we'd get:</span></span>

|  | <span data-ttu-id="0bbef-301">ДС0</span><span class="sxs-lookup"><span data-stu-id="0bbef-301">FD0</span></span> | <span data-ttu-id="0bbef-302">ДС1</span><span class="sxs-lookup"><span data-stu-id="0bbef-302">FD1</span></span> | <span data-ttu-id="0bbef-303">ДС2</span><span class="sxs-lookup"><span data-stu-id="0bbef-303">FD2</span></span> | <span data-ttu-id="0bbef-304">ДС3</span><span class="sxs-lookup"><span data-stu-id="0bbef-304">FD3</span></span> | <span data-ttu-id="0bbef-305">ДС4</span><span class="sxs-lookup"><span data-stu-id="0bbef-305">FD4</span></span> | <span data-ttu-id="0bbef-306">Всего ДО</span><span class="sxs-lookup"><span data-stu-id="0bbef-306">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="0bbef-307">**ДО0**</span><span class="sxs-lookup"><span data-stu-id="0bbef-307">**UD0**</span></span> | | | | | |<span data-ttu-id="0bbef-308">0</span><span class="sxs-lookup"><span data-stu-id="0bbef-308">0</span></span> |
| <span data-ttu-id="0bbef-309">**ДО1**</span><span class="sxs-lookup"><span data-stu-id="0bbef-309">**UD1**</span></span> |<span data-ttu-id="0bbef-310">Р5</span><span class="sxs-lookup"><span data-stu-id="0bbef-310">R5</span></span> |<span data-ttu-id="0bbef-311">Р1</span><span class="sxs-lookup"><span data-stu-id="0bbef-311">R1</span></span> | | | |<span data-ttu-id="0bbef-312">2</span><span class="sxs-lookup"><span data-stu-id="0bbef-312">2</span></span> |
| <span data-ttu-id="0bbef-313">**ДО2**</span><span class="sxs-lookup"><span data-stu-id="0bbef-313">**UD2**</span></span> | | |<span data-ttu-id="0bbef-314">Р2</span><span class="sxs-lookup"><span data-stu-id="0bbef-314">R2</span></span> | | |<span data-ttu-id="0bbef-315">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-315">1</span></span> |
| <span data-ttu-id="0bbef-316">**ДО3**</span><span class="sxs-lookup"><span data-stu-id="0bbef-316">**UD3**</span></span> | | | |<span data-ttu-id="0bbef-317">Р3</span><span class="sxs-lookup"><span data-stu-id="0bbef-317">R3</span></span> | |<span data-ttu-id="0bbef-318">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-318">1</span></span> |
| <span data-ttu-id="0bbef-319">**ДО4**</span><span class="sxs-lookup"><span data-stu-id="0bbef-319">**UD4**</span></span> | | | | |<span data-ttu-id="0bbef-320">Р4</span><span class="sxs-lookup"><span data-stu-id="0bbef-320">R4</span></span> |<span data-ttu-id="0bbef-321">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-321">1</span></span> |
| <span data-ttu-id="0bbef-322">**Всего ДС**</span><span class="sxs-lookup"><span data-stu-id="0bbef-322">**FDTotal**</span></span> |<span data-ttu-id="0bbef-323">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-323">1</span></span> |<span data-ttu-id="0bbef-324">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-324">1</span></span> |<span data-ttu-id="0bbef-325">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-325">1</span></span> |<span data-ttu-id="0bbef-326">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-326">1</span></span> |<span data-ttu-id="0bbef-327">1</span><span class="sxs-lookup"><span data-stu-id="0bbef-327">1</span></span> |- |

<span data-ttu-id="0bbef-328">Эта структура сбалансирована с точки зрения доменов сбоя.</span><span class="sxs-lookup"><span data-stu-id="0bbef-328">This layout is balanced in terms of Fault Domains.</span></span> <span data-ttu-id="0bbef-329">Однако теперь он нарушил hello ограничений доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="0bbef-329">However, now it's violating hello Upgrade Domain constraint.</span></span> <span data-ttu-id="0bbef-330">Причина этого в том, что у ДО0 ноль реплик, а у ДО1 их две.</span><span class="sxs-lookup"><span data-stu-id="0bbef-330">This is because UD0 has zero replicas while UD1 has two.</span></span> <span data-ttu-id="0bbef-331">Таким образом этот макет также является недопустимым и не быть получены по hello диспетчер ресурсов кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-331">Therefore, this layout is also invalid and won't be picked by hello Cluster Resource Manager.</span></span> 

## <a name="configuring-fault-and-upgrade-domains"></a><span data-ttu-id="0bbef-332">Настройка доменов сбоя и обновления</span><span class="sxs-lookup"><span data-stu-id="0bbef-332">Configuring fault and Upgrade Domains</span></span>
<span data-ttu-id="0bbef-333">Определение доменов сбоя и обновления выполняется автоматически в размещенных в Azure развертываниях Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0bbef-333">Defining Fault Domains and Upgrade Domains is done automatically in Azure hosted Service Fabric deployments.</span></span> <span data-ttu-id="0bbef-334">Service Fabric и использование сведений о среде hello из Azure.</span><span class="sxs-lookup"><span data-stu-id="0bbef-334">Service Fabric picks up and uses hello environment information from Azure.</span></span>

<span data-ttu-id="0bbef-335">Если требуется создаете свой кластер (или toorun определенной топологии в разработке), можно предоставить сведения о домене сбоя и доменов обновления hello самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="0bbef-335">If you’re creating your own cluster (or want toorun a particular topology in development), you can provide hello Fault Domain and Upgrade Domain information yourself.</span></span> <span data-ttu-id="0bbef-336">В этом примере мы определяем кластер локальной разработки из девяти узлов, охватывающий три центра обработки данных (каждый с тремя стойками).</span><span class="sxs-lookup"><span data-stu-id="0bbef-336">In this example, we define a nine node local development cluster that spans three “datacenters” (each with three racks).</span></span> <span data-ttu-id="0bbef-337">Этот кластер также имеет три домена обновления, чередующиеся с этими тремя центрами обработки данных.</span><span class="sxs-lookup"><span data-stu-id="0bbef-337">This cluster also has three Upgrade Domains striped across those three datacenters.</span></span> <span data-ttu-id="0bbef-338">Пример конфигурации hello используется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0bbef-338">An example of hello configuration is below:</span></span> 

<span data-ttu-id="0bbef-339">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="0bbef-339">ClusterManifest.xml</span></span>

```xml
  <Infrastructure>
    <!-- IsScaleMin indicates that this cluster runs on one-box /one single server -->
    <WindowsServer IsScaleMin="true">
      <NodeList>
        <Node NodeName="Node01" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType01" FaultDomain="fd:/DC01/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node02" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType02" FaultDomain="fd:/DC01/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node03" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType03" FaultDomain="fd:/DC01/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node04" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType04" FaultDomain="fd:/DC02/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node05" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType05" FaultDomain="fd:/DC02/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node06" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType06" FaultDomain="fd:/DC02/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node07" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType07" FaultDomain="fd:/DC03/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node08" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType08" FaultDomain="fd:/DC03/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node09" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType09" FaultDomain="fd:/DC03/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
      </NodeList>
    </WindowsServer>
  </Infrastructure>
```

<span data-ttu-id="0bbef-340">Использование ClusterConfig.json для автономных развертываний</span><span class="sxs-lookup"><span data-stu-id="0bbef-340">via ClusterConfig.json for Standalone deployments</span></span>

```json
"nodes": [
  {
    "nodeName": "vm1",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm2",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm3",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm4",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm5",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm6",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm7",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm8",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm9",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD3"
  }
],
```

> [!NOTE]
> <span data-ttu-id="0bbef-341">При определении кластеров с помощью Azure Resource Manager домены сбоя и домены обновления назначаются платформой Azure.</span><span class="sxs-lookup"><span data-stu-id="0bbef-341">When defining clusters via Azure Resource Manager, Fault Domains and Upgrade Domains are assigned by Azure.</span></span> <span data-ttu-id="0bbef-342">Таким образом hello определения типов узлов и наборы масштабирования виртуальной машины в шаблон диспетчера ресурсов Azure не включает домен сбоя и доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="0bbef-342">Therefore, hello definition of your Node Types and Virtual Machine Scale Sets in your Azure Resource Manager template does not include Fault Domain or Upgrade Domain information.</span></span>
>

## <a name="node-properties-and-placement-constraints"></a><span data-ttu-id="0bbef-343">Свойства узлов и ограничения размещения</span><span class="sxs-lookup"><span data-stu-id="0bbef-343">Node properties and placement constraints</span></span>
<span data-ttu-id="0bbef-344">Иногда (на самом деле, большую часть времени hello) ты tooensure toowant выполнения некоторых рабочих нагрузок только для определенных типов узлов в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-344">Sometimes (in fact, most of hello time) you’re going toowant tooensure that certain workloads run only on certain types of nodes in hello cluster.</span></span> <span data-ttu-id="0bbef-345">Например, для одних рабочих нагрузок могут требоваться графические процессоры или накопители SSD, а для других — нет.</span><span class="sxs-lookup"><span data-stu-id="0bbef-345">For example, some workload may require GPUs or SSDs while others may not.</span></span> <span data-ttu-id="0bbef-346">Хорошим примером того, предназначенных для рабочих нагрузок tooparticular оборудования является практически в каждой n уровневая архитектура здесь.</span><span class="sxs-lookup"><span data-stu-id="0bbef-346">A great example of targeting hardware tooparticular workloads is almost every n-tier architecture out there.</span></span> <span data-ttu-id="0bbef-347">Некоторые машин служат hello переднего плана или API, обслуживающий части приложения hello и клиенты без поддержки toohello или hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="0bbef-347">Certain machines serve as hello front end or API serving side of hello application and are exposed toohello clients or hello internet.</span></span> <span data-ttu-id="0bbef-348">Различных компьютерах, часто с различных аппаратных ресурсов, обработки работы hello hello вычислений и хранения слоев.</span><span class="sxs-lookup"><span data-stu-id="0bbef-348">Different machines, often with different hardware resources, handle hello work of hello compute or storage layers.</span></span> <span data-ttu-id="0bbef-349">Это обычно _не_ tooclients вызывающим объектам прямой доступ или hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="0bbef-349">These are usually _not_ directly exposed tooclients or hello internet.</span></span> <span data-ttu-id="0bbef-350">Service Fabric ожидает, что существуют случаи, где одни рабочие нагрузки должны toorun на конкретной аппаратной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="0bbef-350">Service Fabric expects that there are cases where particular workloads need toorun on particular hardware configurations.</span></span> <span data-ttu-id="0bbef-351">Например:</span><span class="sxs-lookup"><span data-stu-id="0bbef-351">For example:</span></span>

* <span data-ttu-id="0bbef-352">существующее n-уровневое приложение быстро перемещено в среду Service Fabric;</span><span class="sxs-lookup"><span data-stu-id="0bbef-352">an existing n-tier application has been “lifted and shifted” into a Service Fabric environment</span></span>
* <span data-ttu-id="0bbef-353">Рабочая нагрузка хочет toorun на оборудования для повышения производительности, масштаба или изоляции соображениям безопасности</span><span class="sxs-lookup"><span data-stu-id="0bbef-353">a workload wants toorun on specific hardware for performance, scale, or security isolation reasons</span></span>
* <span data-ttu-id="0bbef-354">рабочая нагрузка должна быть изолирована от других рабочих нагрузок по соображениям политики или потребления ресурсов.</span><span class="sxs-lookup"><span data-stu-id="0bbef-354">A workload should be isolated from other workloads for policy or resource consumption reasons</span></span>

<span data-ttu-id="0bbef-355">Службы эти элементы конфигурации, toosupport структуры имеет первого класса понятие тегов, которые может быть применен toonodes.</span><span class="sxs-lookup"><span data-stu-id="0bbef-355">toosupport these sorts of configurations, Service Fabric has a first class notion of tags that can be applied toonodes.</span></span> <span data-ttu-id="0bbef-356">Эти теги называются **свойствами узла**.</span><span class="sxs-lookup"><span data-stu-id="0bbef-356">These tags are called **node properties**.</span></span> <span data-ttu-id="0bbef-357">**Ограничения размещения** являются инструкций hello присоединенного tooindividual служб, выделенных для одного или нескольких свойств узла.</span><span class="sxs-lookup"><span data-stu-id="0bbef-357">**Placement constraints** are hello statements attached tooindividual services that select for one or more node properties.</span></span> <span data-ttu-id="0bbef-358">Ограничения размещения определяют, где должны запускаться службы.</span><span class="sxs-lookup"><span data-stu-id="0bbef-358">Placement constraints define where services should run.</span></span> <span data-ttu-id="0bbef-359">расширяемый набор ограничений Hello - каждая пара ключ значение может работать.</span><span class="sxs-lookup"><span data-stu-id="0bbef-359">hello set of constraints is extensible - any key/value pair can work.</span></span> 

<span data-ttu-id="0bbef-360"><center>
![Разные рабочие нагрузки структуры кластера][Image5]
</center></span><span class="sxs-lookup"><span data-stu-id="0bbef-360"><center>
![Cluster Layout Different Workloads][Image5]
</center></span></span>

### <a name="built-in-node-properties"></a><span data-ttu-id="0bbef-361">Встроенные свойства узла</span><span class="sxs-lookup"><span data-stu-id="0bbef-361">Built in node properties</span></span>
<span data-ttu-id="0bbef-362">Service Fabric определяет некоторые свойства узла по умолчанию, которые могут использоваться автоматически без необходимости toodefine пользователя hello их.</span><span class="sxs-lookup"><span data-stu-id="0bbef-362">Service Fabric defines some default node properties that can be used automatically without hello user having toodefine them.</span></span> <span data-ttu-id="0bbef-363">свойства по умолчанию Hello, определенные в каждом узле представляют hello **NodeType** и hello **NodeName**.</span><span class="sxs-lookup"><span data-stu-id="0bbef-363">hello default properties defined at each node are hello **NodeType** and hello **NodeName**.</span></span> <span data-ttu-id="0bbef-364">Например, ограничение на размещение можно записать в таком виде: `"(NodeType == NodeType03)"`.</span><span class="sxs-lookup"><span data-stu-id="0bbef-364">So for example you could write a placement constraint as `"(NodeType == NodeType03)"`.</span></span> <span data-ttu-id="0bbef-365">Обычно мы нашли NodeType toobe одним из наиболее часто используемых hello свойств.</span><span class="sxs-lookup"><span data-stu-id="0bbef-365">Generally we have found NodeType toobe one of hello most commonly used properties.</span></span> <span data-ttu-id="0bbef-366">Это удобно, так как оно точно соответствует типу компьютера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-366">It is useful since it corresponds 1:1 with a type of a machine.</span></span> <span data-ttu-id="0bbef-367">Каждый тип машины соответствует tooa тип рабочей нагрузки в традиционных n уровневого приложения.</span><span class="sxs-lookup"><span data-stu-id="0bbef-367">Each type of machine corresponds tooa type of workload in a traditional n-tier application.</span></span>

<span data-ttu-id="0bbef-368"><center>
![Ограничения на размещение и свойства узлов][Image6]
</center></span><span class="sxs-lookup"><span data-stu-id="0bbef-368"><center>
![Placement Constraints and Node Properties][Image6]
</center></span></span>

## <a name="placement-constraint-and-node-property-syntax"></a><span data-ttu-id="0bbef-369">Синтаксис ограничений размещения и свойств узлов</span><span class="sxs-lookup"><span data-stu-id="0bbef-369">Placement Constraint and Node Property Syntax</span></span> 
<span data-ttu-id="0bbef-370">значение Hello в hello узла может быть строкой, bool, или длинное со знаком.</span><span class="sxs-lookup"><span data-stu-id="0bbef-370">hello value specified in hello node property can be a string, bool, or signed long.</span></span> <span data-ttu-id="0bbef-371">оператор Hello hello службы называется расположение *ограничение* , так как он ограничивает, где можно запустить службу hello в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-371">hello statement at hello service is called a placement *constraint* since it constrains where hello service can run in hello cluster.</span></span> <span data-ttu-id="0bbef-372">Hello ограничение может быть любое логическое инструкцию, которая работает hello свойствами другой узел в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-372">hello constraint can be any Boolean statement that operates on hello different node properties in hello cluster.</span></span> <span data-ttu-id="0bbef-373">Допустимые селекторы Hello в эти логические операторы являются:</span><span class="sxs-lookup"><span data-stu-id="0bbef-373">hello valid selectors in these boolean statements are:</span></span>

1) <span data-ttu-id="0bbef-374">Условные проверки для создания определенных операторов:</span><span class="sxs-lookup"><span data-stu-id="0bbef-374">conditional checks for creating particular statements</span></span>

| <span data-ttu-id="0bbef-375">Инструкция</span><span class="sxs-lookup"><span data-stu-id="0bbef-375">Statement</span></span> | <span data-ttu-id="0bbef-376">Синтаксис</span><span class="sxs-lookup"><span data-stu-id="0bbef-376">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="0bbef-377">"равно"</span><span class="sxs-lookup"><span data-stu-id="0bbef-377">"equal to"</span></span> | <span data-ttu-id="0bbef-378">"=="</span><span class="sxs-lookup"><span data-stu-id="0bbef-378">"=="</span></span> |
| <span data-ttu-id="0bbef-379">"не равно"</span><span class="sxs-lookup"><span data-stu-id="0bbef-379">"not equal to"</span></span> | <span data-ttu-id="0bbef-380">"!="</span><span class="sxs-lookup"><span data-stu-id="0bbef-380">"!="</span></span> |
| <span data-ttu-id="0bbef-381">"больше"</span><span class="sxs-lookup"><span data-stu-id="0bbef-381">"greater than"</span></span> | <span data-ttu-id="0bbef-382">">"</span><span class="sxs-lookup"><span data-stu-id="0bbef-382">">"</span></span> |
| <span data-ttu-id="0bbef-383">"больше или равно"</span><span class="sxs-lookup"><span data-stu-id="0bbef-383">"greater than or equal to"</span></span> | <span data-ttu-id="0bbef-384">">="</span><span class="sxs-lookup"><span data-stu-id="0bbef-384">">="</span></span> |
| <span data-ttu-id="0bbef-385">"меньше"</span><span class="sxs-lookup"><span data-stu-id="0bbef-385">"less than"</span></span> | <span data-ttu-id="0bbef-386">"<"</span><span class="sxs-lookup"><span data-stu-id="0bbef-386">"<"</span></span> |
| <span data-ttu-id="0bbef-387">"меньше или равно"</span><span class="sxs-lookup"><span data-stu-id="0bbef-387">"less than or equal to"</span></span> | <span data-ttu-id="0bbef-388">"<="</span><span class="sxs-lookup"><span data-stu-id="0bbef-388">"<="</span></span> |

2) <span data-ttu-id="0bbef-389">Логические операторы для группирования и логических операций:</span><span class="sxs-lookup"><span data-stu-id="0bbef-389">boolean statements for grouping and logical operations</span></span>

| <span data-ttu-id="0bbef-390">Инструкция</span><span class="sxs-lookup"><span data-stu-id="0bbef-390">Statement</span></span> | <span data-ttu-id="0bbef-391">Синтаксис</span><span class="sxs-lookup"><span data-stu-id="0bbef-391">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="0bbef-392">"и"</span><span class="sxs-lookup"><span data-stu-id="0bbef-392">"and"</span></span> | <span data-ttu-id="0bbef-393">"&&"</span><span class="sxs-lookup"><span data-stu-id="0bbef-393">"&&"</span></span> |
| <span data-ttu-id="0bbef-394">"или"</span><span class="sxs-lookup"><span data-stu-id="0bbef-394">"or"</span></span> | <span data-ttu-id="0bbef-395">"&#124;&#124;"</span><span class="sxs-lookup"><span data-stu-id="0bbef-395">"&#124;&#124;"</span></span> |
| <span data-ttu-id="0bbef-396">"не"</span><span class="sxs-lookup"><span data-stu-id="0bbef-396">"not"</span></span> | <span data-ttu-id="0bbef-397">"!"</span><span class="sxs-lookup"><span data-stu-id="0bbef-397">"!"</span></span> |
| <span data-ttu-id="0bbef-398">"группа как отдельный оператор"</span><span class="sxs-lookup"><span data-stu-id="0bbef-398">"group as single statement"</span></span> | <span data-ttu-id="0bbef-399">"()"</span><span class="sxs-lookup"><span data-stu-id="0bbef-399">"()"</span></span> |

<span data-ttu-id="0bbef-400">Ниже приведено несколько примеров основных операторов ограничения.</span><span class="sxs-lookup"><span data-stu-id="0bbef-400">Here are some examples of basic constraint statements.</span></span>

  * `"Value >= 5"`
  * `"NodeColor != green"`
  * `"((OneProperty < 100) || ((AnotherProperty == false) && (OneProperty >= 100)))"`

<span data-ttu-id="0bbef-401">Только узлы, где hello в целом размещения ограничение результатом выполнения инструкции является слишком «True» можно использовать службу hello, примененное к нему.</span><span class="sxs-lookup"><span data-stu-id="0bbef-401">Only nodes where hello overall placement constraint statement evaluates too“True” can have hello service placed on it.</span></span> <span data-ttu-id="0bbef-402">Узлы без определенного свойства не совпадают с какими-либо ограничениями на размещение, содержащими это свойство.</span><span class="sxs-lookup"><span data-stu-id="0bbef-402">Nodes that do not have a property defined do not match any placement constraint containing that property.</span></span>

<span data-ttu-id="0bbef-403">Предположим, что hello следующий узлом, свойства, определенные для типа данного узла:</span><span class="sxs-lookup"><span data-stu-id="0bbef-403">Let’s say that hello following node properties were defined for a given node type:</span></span>

<span data-ttu-id="0bbef-404">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="0bbef-404">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType01">
      <PlacementProperties>
        <Property Name="HasSSD" Value="true"/>
        <Property Name="NodeColor" Value="green"/>
        <Property Name="SomeProperty" Value="5"/>
      </PlacementProperties>
    </NodeType>
```

<span data-ttu-id="0bbef-405">Для автономных развертываний используется ClusterConfig.json, а для размещенных в Azure кластеров — Template.json.</span><span class="sxs-lookup"><span data-stu-id="0bbef-405">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

> [!NOTE]
> <span data-ttu-id="0bbef-406">В вашей узел hello шаблона диспетчера ресурсов Azure типа обычно является параметризованным.</span><span class="sxs-lookup"><span data-stu-id="0bbef-406">In your Azure Resource Manager template hello node type is usually parameterized.</span></span> <span data-ttu-id="0bbef-407">Он будет иметь вид "[parameters('vmNodeType1Name')]", а не "NodeType01".</span><span class="sxs-lookup"><span data-stu-id="0bbef-407">It would look like "[parameters('vmNodeType1Name')]" rather than "NodeType01".</span></span>
>

```json
"nodeTypes": [
    {
        "name": "NodeType01",
        "placementProperties": {
            "HasSSD": "true",
            "NodeColor": "green",
            "SomeProperty": "5"
        },
    }
],
```

<span data-ttu-id="0bbef-408">Вы можете создать *ограничения* на размещение службы следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0bbef-408">You can create service placement *constraints* for a service like as follows:</span></span>

<span data-ttu-id="0bbef-409">C#</span><span class="sxs-lookup"><span data-stu-id="0bbef-409">C#</span></span>

```csharp
FabricClient fabricClient = new FabricClient();
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
serviceDescription.PlacementConstraints = "(HasSSD == true && SomeProperty >= 4)";
// add other required servicedescription fields
//...
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="0bbef-410">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="0bbef-410">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceType -Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton -PlacementConstraint "HasSSD == true && SomeProperty >= 4"
```

<span data-ttu-id="0bbef-411">Если все узлы NodeType01 являются допустимыми, можно также выбрать узел типа с ограничением hello "(NodeType == NodeType01)».</span><span class="sxs-lookup"><span data-stu-id="0bbef-411">If all nodes of NodeType01 are valid, you can also select that node type with hello constraint "(NodeType == NodeType01)".</span></span>

<span data-ttu-id="0bbef-412">Одна из hello интересного о ограничений размещения службы — что они могут изменяться динамически во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="0bbef-412">One of hello cool things about a service’s placement constraints is that they can be updated dynamically during runtime.</span></span> <span data-ttu-id="0bbef-413">Поэтому если требуется, можно перемещать службы в кластере hello, добавлять и удалять требования и т. д. Гарантирует, что hello служба остается копии и доступной даже когда эти типы изменений, становятся занимается Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0bbef-413">So if you need to, you can move a service around in hello cluster, add and remove requirements, etc. Service Fabric takes care of ensuring that hello service stays up and available even when these types of changes are made.</span></span>

<span data-ttu-id="0bbef-414">C#:</span><span class="sxs-lookup"><span data-stu-id="0bbef-414">C#:</span></span>

```csharp
StatefulServiceUpdateDescription updateDescription = new StatefulServiceUpdateDescription();
updateDescription.PlacementConstraints = "NodeType == NodeType01";
await fabricClient.ServiceManager.UpdateServiceAsync(new Uri("fabric:/app/service"), updateDescription);
```

<span data-ttu-id="0bbef-415">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="0bbef-415">Powershell:</span></span>

```posh
Update-ServiceFabricService -Stateful -ServiceName $serviceName -PlacementConstraints "NodeType == NodeType01"
```

<span data-ttu-id="0bbef-416">Ограничения размещения задаются для каждого отдельного именованного экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="0bbef-416">Placement constraints are specified for every different named service instance.</span></span> <span data-ttu-id="0bbef-417">Обновления всегда выполняются hello объекта (перезаписать) ранее заданного.</span><span class="sxs-lookup"><span data-stu-id="0bbef-417">Updates always take hello place of (overwrite) what was previously specified.</span></span>

<span data-ttu-id="0bbef-418">определения кластера Hello определяет свойства hello на узле.</span><span class="sxs-lookup"><span data-stu-id="0bbef-418">hello cluster definition defines hello properties on a node.</span></span> <span data-ttu-id="0bbef-419">Чтобы изменить свойства узла, требуется обновить конфигурацию кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-419">Changing a node's properties requires a cluster configuration upgrade.</span></span> <span data-ttu-id="0bbef-420">Обновление свойства узла требуется ее новые свойства tooreport toorestart каждого соответствующего узла.</span><span class="sxs-lookup"><span data-stu-id="0bbef-420">Upgrading a node's properties requires each affected node toorestart tooreport its new properties.</span></span> <span data-ttu-id="0bbef-421">Этими последовательными обновлениям управляет Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0bbef-421">These rolling upgrades are managed by Service Fabric.</span></span>

## <a name="describing-and-managing-cluster-resources"></a><span data-ttu-id="0bbef-422">Описание кластерных ресурсов и управление ими</span><span class="sxs-lookup"><span data-stu-id="0bbef-422">Describing and Managing Cluster Resources</span></span>
<span data-ttu-id="0bbef-423">Одним из наиболее важных заданий из любой orchestrator — toohelp hello управления потреблением ресурсов в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-423">One of hello most important jobs of any orchestrator is toohelp manage resource consumption in hello cluster.</span></span> <span data-ttu-id="0bbef-424">Управление кластерными ресурсами связано с несколькими аспектами.</span><span class="sxs-lookup"><span data-stu-id="0bbef-424">Managing cluster resources can mean a couple of different things.</span></span> <span data-ttu-id="0bbef-425">Во-первых, необходимо гарантировать, что компьютеры не будут перегружены.</span><span class="sxs-lookup"><span data-stu-id="0bbef-425">First, there's ensuring that machines are not overloaded.</span></span> <span data-ttu-id="0bbef-426">То есть нужно сделать так, чтобы на компьютерах не было запущено больше служб, чем они могут обрабатывать.</span><span class="sxs-lookup"><span data-stu-id="0bbef-426">This means making sure that machines aren't running more services than they can handle.</span></span> <span data-ttu-id="0bbef-427">Во-вторых нет балансировки и оптимизации, являющийся toorunning критические службы эффективно.</span><span class="sxs-lookup"><span data-stu-id="0bbef-427">Second, there's balancing and optimization which is critical toorunning services efficiently.</span></span> <span data-ttu-id="0bbef-428">Стоимость предложения услуг конфиденциальные или производительности не может разрешить некоторые узлы toobe горячей другие являются холодного.</span><span class="sxs-lookup"><span data-stu-id="0bbef-428">Cost effective or performance sensitive service offerings can't allow some nodes toobe hot while others are cold.</span></span> <span data-ttu-id="0bbef-429">Горячий узлы привести tooresource конфликтов и снижению производительности и новых узлов представляют пустой тратой ресурсов и стоимости.</span><span class="sxs-lookup"><span data-stu-id="0bbef-429">Hot nodes lead tooresource contention and poor performance, and cold nodes represent wasted resources and increased costs.</span></span> 

<span data-ttu-id="0bbef-430">В Service Fabric ресурсы представлены в виде метрик (`Metrics`).</span><span class="sxs-lookup"><span data-stu-id="0bbef-430">Service Fabric represents resources as `Metrics`.</span></span> <span data-ttu-id="0bbef-431">Показатели, логических или физических ресурсов, что требуется toodescribe tooService структуры.</span><span class="sxs-lookup"><span data-stu-id="0bbef-431">Metrics are any logical or physical resource that you want toodescribe tooService Fabric.</span></span> <span data-ttu-id="0bbef-432">Метриками, например, являются атрибуты WorkQueueDepth или MemoryInMb.</span><span class="sxs-lookup"><span data-stu-id="0bbef-432">Examples of metrics are things like “WorkQueueDepth” or “MemoryInMb”.</span></span> <span data-ttu-id="0bbef-433">Сведения о hello физические ресурсы, которые могут управлять Service Fabric на узлах. в разделе [управление ресурсами](service-fabric-resource-governance.md).</span><span class="sxs-lookup"><span data-stu-id="0bbef-433">For information about hello physical resources that Service Fabric can govern on nodes, see [resource governance](service-fabric-resource-governance.md).</span></span> <span data-ttu-id="0bbef-434">Дополнительные сведения о настройке пользовательских метрик см. в [этой статье](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="0bbef-434">For information on configuring custom metrics and their uses, see [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

<span data-ttu-id="0bbef-435">Метрики отличаются от ограничений на размещение и свойств узлов.</span><span class="sxs-lookup"><span data-stu-id="0bbef-435">Metrics are different from placements constraints and node properties.</span></span> <span data-ttu-id="0bbef-436">Свойства узла являются статические дескрипторы сами по себе узлы hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-436">Node properties are static descriptors of hello nodes themselves.</span></span> <span data-ttu-id="0bbef-437">Метрики описывают ресурсы на этих узлах, которые потребляются службами, запускаемыми на узле.</span><span class="sxs-lookup"><span data-stu-id="0bbef-437">Metrics describe resources that nodes have and that services consume when they are run on a node.</span></span> <span data-ttu-id="0bbef-438">Свойство узла может быть «HasSSD» и может быть установлена tootrue или false.</span><span class="sxs-lookup"><span data-stu-id="0bbef-438">A node property could be "HasSSD" and could be set tootrue or false.</span></span> <span data-ttu-id="0bbef-439">Hello объем доступного места на SSD, и о том, сколько используется службами бы метрики, как «DriveSpaceInMb».</span><span class="sxs-lookup"><span data-stu-id="0bbef-439">hello amount of space available on that SSD and how much is consumed by services would be a metric like “DriveSpaceInMb”.</span></span> 

<span data-ttu-id="0bbef-440">Это важные toonote, так же, как для свойства узла и ограничения размещения hello диспетчер ресурсов кластера Service Fabric не понять, какие имена hello среднее значение метрики hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-440">It is important toonote that just like for placement constraints and node properties, hello Service Fabric Cluster Resource Manager doesn't understand what hello names of hello metrics mean.</span></span> <span data-ttu-id="0bbef-441">Имена метрик — это просто строки.</span><span class="sxs-lookup"><span data-stu-id="0bbef-441">Metric names are just strings.</span></span> <span data-ttu-id="0bbef-442">Это единицы toodeclare рекомендаций в составе имена метрик hello, создаваемые при может быть неоднозначным.</span><span class="sxs-lookup"><span data-stu-id="0bbef-442">It is a good practice toodeclare units as a part of hello metric names that you create when it could be ambiguous.</span></span>

## <a name="capacity"></a><span data-ttu-id="0bbef-443">Capacity</span><span class="sxs-lookup"><span data-stu-id="0bbef-443">Capacity</span></span>
<span data-ttu-id="0bbef-444">При отключении *балансировки* всех ресурсов диспетчер кластерных ресурсов Service Fabric по-прежнему будет следить за тем, чтобы емкость ни одного узла не была превышена.</span><span class="sxs-lookup"><span data-stu-id="0bbef-444">If you turned off all resource *balancing*, Service Fabric’s Cluster Resource Manager would still ensure that no node ended up over its capacity.</span></span> <span data-ttu-id="0bbef-445">Управление переполнения емкости возможна в том случае, если кластер hello не хватает свободного места или рабочей нагрузки hello больше, чем любой узел.</span><span class="sxs-lookup"><span data-stu-id="0bbef-445">Managing capacity overruns is possible unless hello cluster is too full or hello workload is larger than any node.</span></span> <span data-ttu-id="0bbef-446">Емкость — другой *ограничение* , hello диспетчер ресурсов кластера использует toounderstand объем ресурсов узел имеет.</span><span class="sxs-lookup"><span data-stu-id="0bbef-446">Capacity is another *constraint* that hello Cluster Resource Manager uses toounderstand how much of a resource a node has.</span></span> <span data-ttu-id="0bbef-447">Осталось емкости также отслеживаются для hello кластер в целом.</span><span class="sxs-lookup"><span data-stu-id="0bbef-447">Remaining capacity is also tracked for hello cluster as a whole.</span></span> <span data-ttu-id="0bbef-448">Показатели выражаются hello емкость и использование hello на уровне службы hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-448">Both hello capacity and hello consumption at hello service level are expressed in terms of metrics.</span></span> <span data-ttu-id="0bbef-449">Например hello показатель может быть «ClientConnections» и определенного узла, возможно, емкость для «ClientConnections» 32768 типа.</span><span class="sxs-lookup"><span data-stu-id="0bbef-449">So for example, hello metric might be "ClientConnections" and a given Node may have a capacity for "ClientConnections" of 32768.</span></span> <span data-ttu-id="0bbef-450">Другие узлы могут иметь другие ограничения, некоторые службы, на который узел может сказать его в данный момент 32256 hello показателя «ClientConnections».</span><span class="sxs-lookup"><span data-stu-id="0bbef-450">Other nodes can have other limits Some service running on that node can say it is currently consuming 32256 of hello metric "ClientConnections".</span></span>

<span data-ttu-id="0bbef-451">Во время выполнения диспетчер ресурсов кластера hello отслеживает оставшееся пространство в кластере hello и на узлах.</span><span class="sxs-lookup"><span data-stu-id="0bbef-451">During runtime, hello Cluster Resource Manager tracks remaining capacity in hello cluster and on nodes.</span></span> <span data-ttu-id="0bbef-452">В порядке tootrack емкости hello диспетчер ресурсов кластера вычитает использования каждой службы из узла емкости, где выполняется служба hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-452">In order tootrack capacity hello Cluster Resource Manager subtracts each service's usage from node's capacity where hello service runs.</span></span> <span data-ttu-id="0bbef-453">С этой информацией hello диспетчер ресурсов кластера Service Fabric можно выяснить, где tooplace или переместите реплики, чтобы узлы не выходят емкости.</span><span class="sxs-lookup"><span data-stu-id="0bbef-453">With this information, hello Service Fabric Cluster Resource Manager can figure out where tooplace or move replicas so that nodes don’t go over capacity.</span></span>

<span data-ttu-id="0bbef-454"><center>
![Узлы и емкость кластера][Image7]
</center></span><span class="sxs-lookup"><span data-stu-id="0bbef-454"><center>
![Cluster nodes and capacity][Image7]
</center></span></span>

<span data-ttu-id="0bbef-455">C#:</span><span class="sxs-lookup"><span data-stu-id="0bbef-455">C#:</span></span>

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
ServiceLoadMetricDescription metric = new ServiceLoadMetricDescription();
metric.Name = "ClientConnections";
metric.PrimaryDefaultLoad = 1024;
metric.SecondaryDefaultLoad = 0;
metric.Weight = ServiceLoadMetricWeight.High;
serviceDescription.Metrics.Add(metric);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="0bbef-456">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="0bbef-456">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ClientConnections,High,1024,0)
```

<span data-ttu-id="0bbef-457">Вы можете увидеть производственные мощности, определенных в манифесте кластера hello:</span><span class="sxs-lookup"><span data-stu-id="0bbef-457">You can see capacities defined in hello cluster manifest:</span></span>

<span data-ttu-id="0bbef-458">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="0bbef-458">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType03">
      <Capacities>
        <Capacity Name="ClientConnections" Value="65536"/>
      </Capacities>
    </NodeType>
```

<span data-ttu-id="0bbef-459">Для автономных развертываний используется ClusterConfig.json, а для размещенных в Azure кластеров — Template.json.</span><span class="sxs-lookup"><span data-stu-id="0bbef-459">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

```json
"nodeTypes": [
    {
        "name": "NodeType03",
        "capacities": {
            "ClientConnections": "65536",
        }
    }
],
```

<span data-ttu-id="0bbef-460">Нередко нагрузка службы динамически изменяется.</span><span class="sxs-lookup"><span data-stu-id="0bbef-460">Commonly a service’s load changes dynamically.</span></span> <span data-ttu-id="0bbef-461">Предположим, что реплика загрузку «ClientConnections» изменено с 1024 too2048, но узел hello работала на затем было всего 512 оставшейся для этой метрики емкости.</span><span class="sxs-lookup"><span data-stu-id="0bbef-461">Say that a replica's load of "ClientConnections" changed from 1024 too2048, but hello node it was running on then only had 512 capacity remaining for that metric.</span></span> <span data-ttu-id="0bbef-462">В этом случае расположение, где в данный момент находится реплика или экземпляр, станет недопустимым, так как на этом узле недостаточно места.</span><span class="sxs-lookup"><span data-stu-id="0bbef-462">Now that replica or instance's placement is invalid, since there's not enough room on that node.</span></span> <span data-ttu-id="0bbef-463">Hello диспетчер ресурсов кластера имеет tookick в и вернуть узел hello обратно ниже емкости.</span><span class="sxs-lookup"><span data-stu-id="0bbef-463">hello Cluster Resource Manager has tookick in and get hello node back below capacity.</span></span> <span data-ttu-id="0bbef-464">Он уменьшает нагрузку на узел hello, через емкости путем перемещения одного или нескольких реплик hello или экземпляров с узлов tooother этого узла.</span><span class="sxs-lookup"><span data-stu-id="0bbef-464">It reduces load on hello node that is over capacity by moving one or more of hello replicas or instances from that node tooother nodes.</span></span> <span data-ttu-id="0bbef-465">При перемещении реплик, hello диспетчер ресурсов кластера пытается toominimize hello стоимости тех перемещений.</span><span class="sxs-lookup"><span data-stu-id="0bbef-465">When moving replicas, hello Cluster Resource Manager tries toominimize hello cost of those movements.</span></span> <span data-ttu-id="0bbef-466">Стоимость перемещения рассматривается в [в этой статье](service-fabric-cluster-resource-manager-movement-cost.md) более о hello диспетчер ресурсов кластера перераспределения стратегии и правила описываются [здесь](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="0bbef-466">Movement cost is discussed in [this article](service-fabric-cluster-resource-manager-movement-cost.md) and more about hello Cluster Resource Manager's rebalancing strategies and rules is described [here](service-fabric-cluster-resource-manager-metrics.md).</span></span>

## <a name="cluster-capacity"></a><span data-ttu-id="0bbef-467">Емкость кластера</span><span class="sxs-lookup"><span data-stu-id="0bbef-467">Cluster capacity</span></span>
<span data-ttu-id="0bbef-468">Так как hello hello keep диспетчер ресурсов кластера Service Fabric общего кластера слишком заполнением?</span><span class="sxs-lookup"><span data-stu-id="0bbef-468">So how does hello Service Fabric Cluster Resource Manager keep hello overall cluster from being too full?</span></span> <span data-ttu-id="0bbef-469">Что ж, ввиду динамического характера нагрузки он мало что может сделать.</span><span class="sxs-lookup"><span data-stu-id="0bbef-469">Well, with dynamic load there’s not a lot it can do.</span></span> <span data-ttu-id="0bbef-470">Службы могут иметь свои пик нагрузки независимо от действия, производимые hello диспетчер ресурсов кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-470">Services can have their load spike independently of actions taken by hello Cluster Resource Manager.</span></span> <span data-ttu-id="0bbef-471">В результате кластер с большим резервом сегодня может оказаться довольно маломощным при повышении нагрузки завтра.</span><span class="sxs-lookup"><span data-stu-id="0bbef-471">As a result, your cluster with plenty of headroom today may be underpowered when you become famous tomorrow.</span></span> <span data-ttu-id="0bbef-472">С другой стороны, существует несколько элементов управления, помещенного в tooprevent проблем.</span><span class="sxs-lookup"><span data-stu-id="0bbef-472">That said, there are some controls that are baked in tooprevent problems.</span></span> <span data-ttu-id="0bbef-473">Hello первое, что мы можем сделать это запретить создание новых рабочих нагрузок, приведет к полной toobecome кластера hello hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-473">hello first thing we can do is prevent hello creation of new workloads that would cause hello cluster toobecome full.</span></span>

<span data-ttu-id="0bbef-474">Предположим, вы создаете службу без отслеживания состояния, с которой связана некоторая нагрузка.</span><span class="sxs-lookup"><span data-stu-id="0bbef-474">Say that you create a stateless service and it has some load associated with it.</span></span> <span data-ttu-id="0bbef-475">Предположим, что служба hello интересуют метрики «DiskSpaceInMb» hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-475">Let’s say that hello service cares about hello "DiskSpaceInMb" metric.</span></span> <span data-ttu-id="0bbef-476">Предположим также, что это будет tooconsume пять единиц «DiskSpaceInMb» для каждого экземпляра службы hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-476">Let's also say that it is going tooconsume five units of "DiskSpaceInMb" for every instance of hello service.</span></span> <span data-ttu-id="0bbef-477">Вы хотите toocreate три экземпляра службы hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-477">You want toocreate three instances of hello service.</span></span> <span data-ttu-id="0bbef-478">Отлично!</span><span class="sxs-lookup"><span data-stu-id="0bbef-478">Great!</span></span> <span data-ttu-id="0bbef-479">Что означает необходимость 15 единиц «DiskSpaceInMb» toobe представить в кластере hello в порядке нам tooeven быть может toocreate экземпляры этих служб.</span><span class="sxs-lookup"><span data-stu-id="0bbef-479">So that means that we need 15 units of "DiskSpaceInMb" toobe present in hello cluster in order for us tooeven be able toocreate these service instances.</span></span> <span data-ttu-id="0bbef-480">Hello диспетчер ресурсов кластера постоянно вычисляет hello мощность и расход каждой метрики, чтобы можно было определить hello оставшееся пространство в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-480">hello Cluster Resource Manager continually calculates hello capacity and consumption of each metric so it can determine hello remaining capacity in hello cluster.</span></span> <span data-ttu-id="0bbef-481">Если не хватает места, hello hello отклоняет диспетчер ресурсов кластера создать вызова службы.</span><span class="sxs-lookup"><span data-stu-id="0bbef-481">If there isn't enough space, hello Cluster Resource Manager rejects hello create service call.</span></span>

<span data-ttu-id="0bbef-482">Поскольку требования hello только то, что существует доступны 15 единиц, это пространство может быть распределен несколькими различными способами.</span><span class="sxs-lookup"><span data-stu-id="0bbef-482">Since hello requirement is only that there be 15 units available, this space could be allocated many different ways.</span></span> <span data-ttu-id="0bbef-483">Например, это может быть одна оставшаяся единица емкости на 15 различных узлах или три оставшиеся единицы емкости на 5 разных узлах.</span><span class="sxs-lookup"><span data-stu-id="0bbef-483">For example, there could be one remaining unit of capacity on 15 different nodes, or three remaining units of capacity on five different nodes.</span></span> <span data-ttu-id="0bbef-484">Если hello диспетчер ресурсов кластера можно изменить порядок вещи, поэтому доступно пять единиц на трех узлах, он помещает hello службы.</span><span class="sxs-lookup"><span data-stu-id="0bbef-484">If hello Cluster Resource Manager can rearrange things so there's five units available on three nodes, it places hello service.</span></span> <span data-ttu-id="0bbef-485">Расположения кластера hello обычно возможна, если почти заполнена hello кластера или для какой-либо причине нельзя объединять существующие службы hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-485">Rearranging hello cluster is usually possible unless hello cluster is almost full or hello existing services can't be consolidated for some reason.</span></span>

## <a name="buffered-capacity"></a><span data-ttu-id="0bbef-486">Емкость буфера</span><span class="sxs-lookup"><span data-stu-id="0bbef-486">Buffered Capacity</span></span>
<span data-ttu-id="0bbef-487">Буферизованный емкость — еще одна функция hello диспетчер ресурсов кластера.</span><span class="sxs-lookup"><span data-stu-id="0bbef-487">Buffered capacity is another feature of hello Cluster Resource Manager.</span></span> <span data-ttu-id="0bbef-488">Он позволяет резервирование некоторой части hello общую емкость узла.</span><span class="sxs-lookup"><span data-stu-id="0bbef-488">It allows reservation of some portion of hello overall node capacity.</span></span> <span data-ttu-id="0bbef-489">Этот буфер емкости — только используемые tooplace служб во время обновления и сбоев узлов.</span><span class="sxs-lookup"><span data-stu-id="0bbef-489">This capacity buffer is only used tooplace services during upgrades and node failures.</span></span> <span data-ttu-id="0bbef-490">Буферизованная мощность указывается глобально для каждой метрики для всех узлов.</span><span class="sxs-lookup"><span data-stu-id="0bbef-490">Buffered Capacity is specified globally per metric for all nodes.</span></span> <span data-ttu-id="0bbef-491">hello защищены емкости Выбираемое значение Hello зависит от числа hello доменам сбоя и обновления в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="0bbef-491">hello value you pick for hello reserved capacity is a function of hello number of Fault and Upgrade Domains you have in hello cluster.</span></span> <span data-ttu-id="0bbef-492">Большее количество доменов сбоя и обновления означает, что можно выбрать меньшее значение зарезервированной емкости.</span><span class="sxs-lookup"><span data-stu-id="0bbef-492">More Fault and Upgrade Domains means that you can pick a lower number for your buffered capacity.</span></span> <span data-ttu-id="0bbef-493">Если у вас есть несколько доменов, можно ожидать меньшее количество toobe вашего кластера недоступен во время обновления и сбои.</span><span class="sxs-lookup"><span data-stu-id="0bbef-493">If you have more domains, you can expect smaller amounts of your cluster toobe unavailable during upgrades and failures.</span></span> <span data-ttu-id="0bbef-494">Указание емкости буфер имеет смысл только при наличии заданного hello емкость узла для метрики.</span><span class="sxs-lookup"><span data-stu-id="0bbef-494">Specifying Buffered Capacity only makes sense if you have also specified hello node capacity for a metric.</span></span>

<span data-ttu-id="0bbef-495">Ниже приведен пример как toospecify буферизованный емкости:</span><span class="sxs-lookup"><span data-stu-id="0bbef-495">Here's an example of how toospecify buffered capacity:</span></span>

<span data-ttu-id="0bbef-496">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="0bbef-496">ClusterManifest.xml</span></span>

```xml
        <Section Name="NodeBufferPercentage">
            <Parameter Name="SomeMetric" Value="0.15" />
            <Parameter Name="SomeOtherMetric" Value="0.20" />
        </Section>
```

<span data-ttu-id="0bbef-497">Для автономных развертываний используется ClusterConfig.json, а для размещенных в Azure кластеров — Template.json.</span><span class="sxs-lookup"><span data-stu-id="0bbef-497">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "NodeBufferPercentage",
    "parameters": [
      {
          "name": "SomeMetric",
          "value": "0.15"
      },
      {
          "name": "SomeOtherMetric",
          "value": "0.20"
      }
    ]
  }
]
```

<span data-ttu-id="0bbef-498">происходит сбой создания Hello новые службы, когда hello кластер находится вне буферизованный емкости для метрики.</span><span class="sxs-lookup"><span data-stu-id="0bbef-498">hello creation of new services fails when hello cluster is out of buffered capacity for a metric.</span></span> <span data-ttu-id="0bbef-499">Предотвращение создания hello новый буфер hello toopreserve служб предотвращает обновления и сбои не toogo узлов по емкости.</span><span class="sxs-lookup"><span data-stu-id="0bbef-499">Preventing hello creation of new services toopreserve hello buffer ensures that upgrades and failures don’t cause nodes toogo over capacity.</span></span> <span data-ttu-id="0bbef-500">Емкость буфера указывать необязательно, но мы советуем добавить ее во всех кластерах, определяющих емкость для метрики.</span><span class="sxs-lookup"><span data-stu-id="0bbef-500">Buffered capacity is optional but is recommended in any cluster that defines a capacity for a metric.</span></span>

<span data-ttu-id="0bbef-501">Hello диспетчер ресурсов кластера предоставляет эти сведения для загрузки.</span><span class="sxs-lookup"><span data-stu-id="0bbef-501">hello Cluster Resource Manager exposes this load information.</span></span> <span data-ttu-id="0bbef-502">Для каждой метрики эти сведения содержат:</span><span class="sxs-lookup"><span data-stu-id="0bbef-502">For each metric, this information includes:</span></span> 
  - <span data-ttu-id="0bbef-503">параметры вместимости буферизировать Hello</span><span class="sxs-lookup"><span data-stu-id="0bbef-503">hello buffered capacity settings</span></span>
  - <span data-ttu-id="0bbef-504">Общая емкость Hello</span><span class="sxs-lookup"><span data-stu-id="0bbef-504">hello total capacity</span></span>
  - <span data-ttu-id="0bbef-505">текущего потребления Hello</span><span class="sxs-lookup"><span data-stu-id="0bbef-505">hello current consumption</span></span>
  - <span data-ttu-id="0bbef-506">является ли каждая метрика сбалансированной;</span><span class="sxs-lookup"><span data-stu-id="0bbef-506">whether each metric is considered balanced or not</span></span>
  - <span data-ttu-id="0bbef-507">статистические данные о hello стандартное отклонение</span><span class="sxs-lookup"><span data-stu-id="0bbef-507">statistics about hello standard deviation</span></span>
  - <span data-ttu-id="0bbef-508">Hello узлы, имеющие hello большинство и как минимум нагрузки</span><span class="sxs-lookup"><span data-stu-id="0bbef-508">hello nodes which have hello most and least load</span></span>  
  
<span data-ttu-id="0bbef-509">Ниже приведен пример таких выходных данных.</span><span class="sxs-lookup"><span data-stu-id="0bbef-509">Below we see an example of that output:</span></span>

```posh
PS C:\Users\user> Get-ServiceFabricClusterLoadInformation
LastBalancingStartTimeUtc : 9/1/2016 12:54:59 AM
LastBalancingEndTimeUtc   : 9/1/2016 12:54:59 AM
LoadMetricInformation     :
                            LoadMetricName        : Metric1
                            IsBalancedBefore      : False
                            IsBalancedAfter       : False
                            DeviationBefore       : 0.192450089729875
                            DeviationAfter        : 0.192450089729875
                            BalancingThreshold    : 1
                            Action                : NoActionNeeded
                            ActivityThreshold     : 0
                            ClusterCapacity       : 189
                            ClusterLoad           : 45
                            ClusterRemainingCapacity : 144
                            NodeBufferPercentage  : 10
                            ClusterBufferedCapacity : 170
                            ClusterRemainingBufferedCapacity : 125
                            ClusterCapacityViolation : False
                            MinNodeLoadValue      : 0
                            MinNodeLoadNodeId     : 3ea71e8e01f4b0999b121abcbf27d74d
                            MaxNodeLoadValue      : 15
                            MaxNodeLoadNodeId     : 2cc648b6770be1bc9824fa995d5b68b1
```

## <a name="next-steps"></a><span data-ttu-id="0bbef-510">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="0bbef-510">Next steps</span></span>
* <span data-ttu-id="0bbef-511">Сведения о hello архитектуры и обмена информацией внутри hello диспетчер ресурсов кластера, извлечь [в данной статье](service-fabric-cluster-resource-manager-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="0bbef-511">For information on hello architecture and information flow within hello Cluster Resource Manager, check out [this article ](service-fabric-cluster-resource-manager-architecture.md)</span></span>
* <span data-ttu-id="0bbef-512">Определение метрики дефрагментации является одним из способов tooconsolidate нагрузки на узлах, а не его рассредоточения. toolearn как tooconfigure дефрагментации см. в слишком[в данной статье](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="0bbef-512">Defining Defragmentation Metrics is one way tooconsolidate load on nodes instead of spreading it out. toolearn how tooconfigure defragmentation, refer too[this article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span></span>
* <span data-ttu-id="0bbef-513">Начать с начала hello и [получить введение toohello диспетчер ресурсов кластера Service Fabric](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="0bbef-513">Start from hello beginning and [get an Introduction toohello Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
* <span data-ttu-id="0bbef-514">toofind out о управляет hello диспетчер ресурсов кластера и балансировку нагрузки в кластере hello Извлеките hello статьи на [балансировки нагрузки](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="0bbef-514">toofind out about how hello Cluster Resource Manager manages and balances load in hello cluster, check out hello article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-domains.png
[Image2]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-uneven-fault-domain-layout.png
[Image3]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domains-with-placement.png
[Image4]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domain-layout-strategies.png
[Image5]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-layout-different-workloads.png
[Image6]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-placement-constraints-node-properties.png
[Image7]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-nodes-and-capacity.png
