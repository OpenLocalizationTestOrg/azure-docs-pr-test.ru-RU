---
title: "aaaBalance кластера Azure Service Fabric | Документы Microsoft"
description: "Введение toobalancing кластера с hello диспетчер ресурсов кластера Service Fabric."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 030b1465-6616-4c0b-8bc7-24ed47d054c0
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 5f7ad2f5cf4cfb3751a860f5293b03d2d5266d99
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="balancing-your-service-fabric-cluster"></a>Балансировка кластера Service Fabric
Hello диспетчер ресурсов кластера Service Fabric поддерживает динамическое загрузки изменений, tooadditions отклик или удаления узлов или служб. Он также автоматически исправляет нарушения ограничений и заранее балансировку hello кластера. Но как часто выполняются эти действия и что их инициирует?

Существует три разных категории работы, hello, которое выполняет диспетчер ресурсов кластера. К ним относятся:

1. Размещение: на этом этапе происходит размещение отсутствующих метрик с отслеживанием состояния или без. Размещаются как новые службы, так и реплики с отслеживанием состояния или экземпляры без отслеживания состояния, которые вызвали сбой. Тут выполняется удаление реплик и экземпляров.
2. Проверяет ограничения — этот этап проверяет, а также исправляет нарушения ограничений размещения различных hello (правила) в системе hello. Примеры правил — это средства, предотвращающие избыточное использование ресурсов узлов, обеспечивающие соблюдение ограничений на размещение службы и т. п.
3. Балансировка — этот этап проверяет toosee при перераспределения необходимости в зависимости от настройки hello требуемого уровня сальдо для различных показателей. В этом случае он пытается toofind упорядочение в hello кластера то есть несколько взаимосвязанных.

## <a name="configuring-cluster-resource-manager-timers"></a>Настройка таймеров диспетчера кластерных ресурсов
Первый набор элементов управления в балансировки Hello представляют собой набор таймеров. Таймеров управляют как часто hello диспетчер ресурсов кластера проверяет кластера hello и выполняет действия по исправлению.

Каждый из этих различных типов диспетчер ресурсов кластера можно внести исправления приветствия управляется другой таймер, который управляет частотой его. При каждом таймеров hello расписанию. По умолчанию hello диспетчера ресурсов:

* проверяет состояние и применяет обновления (например, записывает, что узел не работает) каждые 1/10 секунды;
* Устанавливает флаг Проверка размещения hello 
* Устанавливает флаг проверки ограничения hello каждую секунду
* Задает hello балансировки флаг каждые пять секунд.

Ниже приведены примеры hello конфигурации, управляющие таймеров.

ClusterManifest.xml:

``` xml
        <Section Name="PlacementAndLoadBalancing">
            <Parameter Name="PLBRefreshGap" Value="0.1" />
            <Parameter Name="MinPlacementInterval" Value="1.0" />
            <Parameter Name="MinConstraintCheckInterval" Value="1.0" />
            <Parameter Name="MinLoadBalancingInterval" Value="5.0" />
        </Section>
```

Для автономных развертываний используется ClusterConfig.json, а для размещенных в Azure кластеров — Template.json.

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "PLBRefreshGap",
          "value": "0.10"
      },
      {
          "name": "MinPlacementInterval",
          "value": "1.0"
      },
      {
          "name": "MinConstraintCheckInterval",
          "value": "1.0"
      },
      {
          "name": "MinLoadBalancingInterval",
          "value": "5.0"
      }
    ]
  }
]
```

Сегодня hello диспетчер ресурсов кластера выполняет только одно из этих действий одновременно, последовательно. Именно поэтому мы ссылаться таймеры toothese как «минимальный интервалы» и получить действия при таймеры hello ходить «флаги параметр» hello. Например диспетчер ресурсов кластера берет на себя ожидающие приветствия запрашивает toocreate службы перед hello кластера балансировки. Как видите, интервал времени по умолчанию hello, указанные hello диспетчер ресурсов кластера сканирует ничего его потребности toodo часто. Обычно это означает, что hello набор изменений, внесенных на каждом шаге мал. Часто внесения небольших изменений позволяет hello toobe диспетчер ресурсов кластера отвечать на запросы при кластера hello произойдет следующее. Hello таймеры по умолчанию предоставляют некоторые пакетной обработки поскольку многие hello же типы событий, как правило, toooccur одновременно. 

Например, когда происходит сбой узлов, то может выполняться одновременная обработка доменов сбоя целиком. Все эти ошибки регистрируются во время hello следующее состояние обновления после hello *PLBRefreshGap*. исправления Hello определяются в ходе hello после размещения, проверки ограничений и балансировка запусков. По умолчанию hello диспетчер ресурсов кластера не сканирования часы изменений в кластере hello и попытке tooaddress все изменения за один раз. Это может привести к toobursts высок.

Hello диспетчер ресурсов кластера необходимо также toodetermine некоторые дополнительные сведения, если кластер hello несбалансированных. Для этого используются два других элемента конфигурации: *пороговые значения балансировки* и *пороговые значения активности*.

## <a name="balancing-thresholds"></a>Пороговые значения балансировки
Пороговое значение балансировки может hello главного элемента управления для запуска перераспределения. Hello балансировки пороговое значение метрики — _отношение_. Если hello нагрузки для метрики на hello наиболее загружен узел, деленное hello интенсивность нагрузки на hello бы загрузить узел превышает эта метрика *BalancingThreshold*, то hello кластера не сбалансирована. В результате балансировки — триггеру hello Далее время hello проверку диспетчер ресурсов кластера. Hello *MinLoadBalancingInterval* таймера определяет, как часто hello диспетчер ресурсов кластера должна проверять при необходимости перераспределения. Проверка не означает, что что-то действительно произойдет. 

Пороговые значения балансировки определяются на основе метрики как часть определения кластера hello. Дополнительные сведения о метриках см. в [этой статье](service-fabric-cluster-resource-manager-metrics.md).

ClusterManifest.xml

```xml
    <Section Name="MetricBalancingThresholds">
      <Parameter Name="MetricName1" Value="2"/>
      <Parameter Name="MetricName2" Value="3.5"/>
    </Section>
```

Для автономных развертываний используется ClusterConfig.json, а для размещенных в Azure кластеров — Template.json.

```json
"fabricSettings": [
  {
    "name": "MetricBalancingThresholds",
    "parameters": [
      {
          "name": "MetricName1",
          "value": "2"
      },
      {
          "name": "MetricName2",
          "value": "3.5"
      }
    ]
  }
]
```

<center>
![Пример порогового значения балансировки][Image1]
</center>

В этом примере каждая служба использует одну единицу определенной метрики. В примере hello top hello максимальной нагрузки на узле, равно 5, а hello минимальное значение — два. Предположим, что hello балансировки пороговое значение для этой метрики, равно трем. Так как отношение hello в кластере hello 5/2 = 2.5, которое меньше, чем hello указало балансировки порогового значения трех, hello кластера сбалансирован. Без балансировки срабатывает, когда проверяет hello диспетчер ресурсов кластера.

В примере hello нижней hello максимальной нагрузки на узле равно 10, пока hello минимальное значение — 2, приведет к соотношение пяти. Пять больше указанного порога балансировки hello из трех для этой метрики. В результате балансировки выполнения будет запланированных Далее hello время балансировки активируется таймера. В подобной ситуации некоторые нагрузки — обычно распределенных tooNode3. Так как диспетчер ресурсов кластера Service Fabric hello не использует жадном подход, повышению нагрузки может быть распределенных tooNode2. 

<center>
![Действия в примере порогового значения балансировки][Image2]
</center>

> [!NOTE]
> Для управления нагрузкой в кластере применяются две разные стратегии балансировки. стратегии по умолчанию Hello, hello использует диспетчер ресурсов кластера представляет собой toodistribute нагрузку между узлами кластера hello hello. Hello других стратегией является [дефрагментации](service-fabric-cluster-resource-manager-defragmentation-metrics.md). Дефрагментация выполняется во время hello же балансировки запуска. Hello стратегии балансировки и дефрагментация может использоваться для различных показателей hello одного кластера. У службы могут быть метрики балансировки и дефрагментации. Для метрик дефрагментации hello доля hello загружает в триггерах кластера hello перераспределения, когда это _ниже_ hello балансировки пороговое значение. 
>

Получение ниже hello балансировки пороговое значение является задача. Пороговые значения балансировки — всего лишь *триггеры*. При балансировку запусков, hello диспетчер ресурсов кластера определяет какие улучшения, его можно сделать, если таковые имеются. Сам по себе запуск балансировки не означает, что что-либо будет перемещено. Иногда hello кластер — toocorrect сбалансирована, но слишком ограничением. Кроме того, улучшения hello требуют перемещений, которые являются слишком [дорогостоящих](service-fabric-cluster-resource-manager-movement-cost.md)).

## <a name="activity-thresholds"></a>пороговые значения активности
Иногда, несмотря на то, что узлы являются относительно несбалансированных, hello *общее* объем нагрузки в кластере hello невелик. отсутствие Hello нагрузки может быть временной dip, или тем, что кластер hello новый и просто начало начальной загрузки. В любом случае вы можете не toospend время hello кластера балансировки, так как имеется небольшая toobe прибыли. Hello кластера был изменен балансировки, следует потратить сети и вычислений без внесения все большие объекты toomove ресурсов *абсолютный* различие. Перемещает tooavoid ненужные, уже есть элемент управления называется пороговые значения действий. Пороговые значения действий позволяет toospecify некоторые абсолютный нижняя граница для действия. Если узел не превышает это пороговое значение, балансировки не срабатывает, даже если hello балансировки порога.

Предположим, что для этой метрики задано пороговое значение балансировки, равное 3. Также предположим, что пороговое значение активности равно 1536. В первом случае hello хотя несбалансированных каждого hello hello кластера балансировки пороговое значение не является действие пороговое значение не соответствует требованиям узла, поэтому ничего не происходит. В примере hello нижней Node1 превышает пороговое значение действие hello. Поскольку оба hello пороговое значение для балансировки и hello действия пороговое значение для показателя hello превышены, балансировки запланирован. В качестве примера рассмотрим следующие схемы hello. 

<center>
![Пример порогового значения активности][Image3]
</center>

Как и в пороговые значения балансировки пороговые значения действий, определенных на метрики через hello определения кластера:

ClusterManifest.xml

``` xml
    <Section Name="MetricActivityThresholds">
      <Parameter Name="Memory" Value="1536"/>
    </Section>
```

Для автономных развертываний используется ClusterConfig.json, а для размещенных в Azure кластеров — Template.json.

```json
"fabricSettings": [
  {
    "name": "MetricActivityThresholds",
    "parameters": [
      {
          "name": "Memory",
          "value": "1536"
      }
    ]
  }
]
```

Пороговые значения балансировки нагрузки и действия имеют связанные tooa конкретную метрику - балансировки запускается только в том случае, если оба hello балансировки пороговое значение и действие порогового значения для hello одинаковую метрику.

## <a name="balancing-services-together"></a>Одновременная балансировка служб
Является несбалансированных hello кластера или не является решением всего кластера. Тем не менее здесь очень способом hello перемещается реплик отдельные службы и экземпляры вокруг. Звучит разумно, не правда ли? Если вертикально памяти на одном узле tooit может вызывать несколько реплик или экземпляров. Исправление hello дисбаланс может потребоваться перемещение любой из реплики с отслеживанием состояния hello или экземпляры без сохранения состояния, в которых используется несбалансированных метрика hello.

Время от времени, что службы, которой не сам несбалансированных возвращает перемещен (Вспомните обсуждение hello локальных и глобальных весовые коэффициенты, которые ранее). Почему же служба перемещается, если все ее метрики сбалансированы? Рассмотрим пример.

- Возьмем для примера четыре службы: Service1, Service2, Service3 и Service4. 
- Служба Service1 передает метрики Metric1 и Metric2. 
- Служба Service2 передает метрики Metric2 и Metric3. 
- Служба Service3 передает метрики Metric3 и Metric4.
- Служба Service4 передает метрику Metric99. 

Понимаете, к чему все это ведет? Это же цепочка! Мы имеем дело не с четырьмя независимыми службами, а с тремя связанными службами и одной отдельной службой.

<center>
![Одновременная балансировка служб][Image4]
</center>

Из-за этой цепочке существует вероятность, что дисбаланс метрик 1-4 может привести к реплики или экземпляры, принадлежащие tooservices toomove 1 – 3 вокруг. Кроме того, нам известно, что дисбаланс в метрике Metric1, Metric2 или Metric3 не вызовет перемещения в службе Service4. Бы без точки после перемещения реплик hello или экземпляры, принадлежащие tooService4 вокруг может ничего не абсолютно tooimpact баланс hello метрик 1-3.

Диспетчер ресурсов кластера Hello автоматически решает, какие службы связаны. Добавление, удаление или изменение hello метрики для службы могут повлиять на их связи. Например между двумя выполнениями балансировки Service2 было обновленные tooremove Metric2. Это приводит к разрыву цепочки hello между Service1 и Service2. В этом случае две группы связанных служб превратятся в три.

<center>
![Одновременная балансировка служб][Image5]
</center>

## <a name="next-steps"></a>Дальнейшие действия
* Показатели, как hello диспетчера ресурсов кластера Service Fabric управляет потребления и мощность в кластере hello. Дополнительные сведения о метриках toolearn как tooconfigure, извлечение и возврат [в данной статье](service-fabric-cluster-resource-manager-metrics.md)
* Стоимость перемещения — один из способов передачи сигналов toohello диспетчер ресурсов кластера, что некоторые службы являются toomove дороже, чем другие. Дополнительные сведения о стоимость перемещения ссылаться слишком[в данной статье](service-fabric-cluster-resource-manager-movement-cost.md)
* Hello диспетчер ресурсов кластера имеет несколько регулирования, которые можно настроить tooslow вниз обработки в кластере hello. Обычно они не требуется, но при необходимости узнать о регулировках можно [здесь](service-fabric-cluster-resource-manager-advanced-throttling.md)

[Image1]:./media/service-fabric-cluster-resource-manager-balancing/cluster-resrouce-manager-balancing-thresholds.png
[Image2]:./media/service-fabric-cluster-resource-manager-balancing/cluster-resource-manager-balancing-threshold-triggered-results.png
[Image3]:./media/service-fabric-cluster-resource-manager-balancing/cluster-resource-manager-activity-thresholds.png
[Image4]:./media/service-fabric-cluster-resource-manager-balancing/cluster-resource-manager-balancing-services-together1.png
[Image5]:./media/service-fabric-cluster-resource-manager-balancing/cluster-resource-manager-balancing-services-together2.png
