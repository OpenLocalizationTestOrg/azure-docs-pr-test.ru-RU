---
title: "Дополнительные разделы об обновлении приложений | Документация Майкрософт"
description: "В этой статье рассматриваются некоторые дополнительные темы, относящиеся к обновлению приложения Service Fabric."
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: timlt
editor: 
ms.assetid: e29585ff-e96f-46f4-a07f-6682bbe63281
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar;chackdan
ms.openlocfilehash: 8d3b922f3d50b645ac9db2cc879a319df1262e0a
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="service-fabric-application-upgrade-advanced-topics"></a>Обновление приложений Service Fabric: дополнительные разделы
## <a name="adding-or-removing-services-during-an-application-upgrade"></a>Добавление или удаление служб во время обновления приложения
Если в приложение, которое уже развернуто и опубликовано как обновление, добавляется новая служба, то она добавляется в развернутое приложение Подобные обновления не влияет на какие-либо службы, которые уже были частью приложения.  Однако чтобы активировать новую службу, требуется запустить экземпляр службы, который был добавлен. Запуск следует выполнить с помощью командлета `New-ServiceFabricService` .

В процессе обновления службы также могут быть удалены из приложения. Но в этом случае перед продолжением обновления все текущие экземпляры удаляемой службы должны быть остановлены (с помощью командлета `Remove-ServiceFabricService` ).

## <a name="manual-upgrade-mode"></a>Ручной режим обновления
> [!NOTE]
> Неотслеживаемый ручной режим должен использоваться только для сбойных или отложенных обновлений. Отслеживаемый режим рекомендуется для использования с приложениями Service Fabric.
>
>

Service Fabric обеспечивает применение нескольких режимов обновления для поддержки кластеров разработки и рабочих кластеров. Выбранные варианты развертывания для разных сред могут отличаться.

Отслеживаемое последовательное обновление приложений — наиболее распространенный тип обновления, используемого в рабочей среде. При определении политики обновления структура служб обеспечивает работоспособность приложения перед продолжением обновления.

 Администратор приложения может использовать режим ручного последовательного обновления приложений для обеспечения полного контроля над ходом процесса обновления для различных доменов обновления. Этот режим удобен, когда необходима настраиваемая или сложная политика оценки работоспособности или осуществляется нестандартное обновление (например, приложение уже потеряло некоторые данные).

Наконец, автоматизированное последовательное обновление полезно для сред разработки или тестирования, что обеспечивает быстрый цикл итераций во время разработки службы.

## <a name="change-to-manual-upgrade-mode"></a>Переключение в ручной режим обновления
**Ручной.** Остановите обновление приложения на текущем домене обновления и измените режим обновления на Unmonitored Manual (Неотслеживаемый ручной). Администратору необходимо вручную вызвать команду **MoveNextApplicationUpgradeDomainAsync**, чтобы продолжить обновление, или запустить откат, начав новое обновление. После того как обновление перейдет в ручной режим, оно остается в нем до тех пор, пока не будет запущено новое обновление. Команда **GetApplicationUpgradeProgressAsync** возвращает FABRIC\_APPLICATION\_UPGRADE\_STATE\_ROLLING\_FORWARD\_PENDING.

## <a name="upgrade-with-a-diff-package"></a>Обновление при помощи пакета diff
Приложение структуры служб может обновляться путем подготовки полного самостоятельного пакета приложения. Приложение может также быть обновлено путем использования пакета diff, который содержит только обновленные файлы приложения и манифеста приложения , а также файлы манифеста служб.

Полный пакет приложений содержит все необходимые файлы для запуска и выполнения приложения структуры служб. Пакет diff содержит только файлы, которые изменились между последним выделением приложения и текущим обновлением, плюс полные файлы манифеста приложения и служб. Если в макете сборки не удается найти ссылку, указанную в манифесте приложения или манифесте служб, то будет предпринята попытка найти ее в хранилище образов.

Для первичной установки приложений в кластер необходимы полные пакеты приложений. При последующих обновлениях может использоваться либо полный пакет обновлений, либо пакет diff.

Случаи, в которых использование пакета diff является оптимальным.

* Пакет diff предпочтительно применять тогда, когда используется объемный пакет приложения, который ссылается на несколько файлов манифеста службы или на несколько пакетов кода, пакетов конфигурации или пакетов данных.
* Использование пакета diff является предпочтительным в случае, если система развертывания формирует структуру сборки напрямую в ходе создания сборки приложения. В этом случае, хотя в самом коде ничего не изменилось, новые сборки будут обладать другой контрольной суммой. Использование полного пакета приложения потребует обновления версии всех пакетов кода. При использовании пакета diff вы предоставляете только измененные файлы и файлы манифеста, версия которых изменилась.

При обновлении приложения с помощью Visual Studio пакет diff публикуется автоматически. Чтобы создать пакет diff вручную, необходимо обновить манифест приложения и манифесты служб, но только измененные пакеты должны быть включены в финальный пакет приложения.

К примеру, начнем со следующего приложения (номера версий приведены для простоты понимания):

```text
app1           1.0.0
  service1     1.0.0
    code       1.0.0
    config     1.0.0
  service2     1.0.0
    code       1.0.0
    config     1.0.0
```

Предположим, что необходимо обновить только код пакета service1, использующего пакет diff, с помощью PowerShell. Теперь обновленное приложение имеет приведенную ниже структуру папок.

```text
app1           2.0.0      <-- new version
  service1     2.0.0      <-- new version
    code       2.0.0      <-- new version
    config     1.0.0
  service2     1.0.0
    code       1.0.0
    config     1.0.0
```

В этом случае вы обновляете манифест приложения до версии 2.0.0 и манифест службы для service1 для отражения обновления пакета кода. Структура папок для пакета приложения будет выглядеть следующим образом.

```text
app1/
  service1/
    code/
```

## <a name="next-steps"></a>Дальнейшие действия
[Руководство по обновлению приложений Service Fabric с помощью Visual Studio](service-fabric-application-upgrade-tutorial.md) поможет вам выполнить поэтапное обновление приложения с помощью Visual Studio.

[Обновление приложения с помощью PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) поможет вам выполнить обновление приложения с помощью PowerShell.

Управление обновлениями приложения осуществляется с помощью [параметров обновления](service-fabric-application-upgrade-parameters.md).

Узнайте, как использовать [сериализацию данных](service-fabric-application-upgrade-data-serialization.md), чтобы обеспечить совместимость обновлений приложения.

Сведения об устранении распространенных проблем при обновлении приложений см. в статье [Устранение неполадок при обновлениях приложений](service-fabric-application-upgrade-troubleshooting.md).
