---
title: "aaaUpgrade кластера с Azure Service Fabric | Документы Microsoft"
description: "Обновите hello Service Fabric код или конфигурацию, которая запускает кластера Service Fabric, в том числе Установка режима обновления кластера, обновление сертификатов, добавление портов приложений, выполнив исправлений ОС и т. д. Чего можно ожидать, при выполнении обновления hello?"
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 15190ace-31ed-491f-a54b-b5ff61e718db
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 8/10/2017
ms.author: chackdan
ms.openlocfilehash: 94ac3833ec0810f79de06ecb50f254028fa90408
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-an-azure-service-fabric-cluster"></a>Обновление кластера Azure Service Fabric
> [!div class="op_single_selector"]
> * [Кластер Azure](service-fabric-cluster-upgrade.md)
> * [Автономный кластер](service-fabric-cluster-upgrade-windows-server.md)
> 
> 

Для любой современной системы разработки для возможность обновления — долгосрочный успех tooachieving ключа продукта. Кластер Service Fabric Azure представляет собой ресурс, который принадлежит вам, но частично управляется корпорацией Майкрософт. В этой статье содержатся сведения о компонентах, управляемых автоматически, и о том, что можно настроить самостоятельно.

## <a name="controlling-hello-fabric-version-that-runs-on-your-cluster"></a>Управление версии структуры hello, работающей в кластере
Можно задать автоматическое коммутирующей tooreceive кластера обновления как их выпуска корпорацией Майкрософт или выбрать поддерживаемые структуры требуемой версии вашей toobe кластера на.

Это можно сделать, Настройка конфигурации кластера «параметра upgradeMode» hello на портале hello или с помощью диспетчера ресурсов во время создания hello или позднее, динамической кластера 

> [!NOTE]
> Убедитесь, что tookeep кластера под управлением версии поддерживаемых структуры всегда. Как и когда мы объявления hello выпуска новой версии службы структуры для окончания поддержки после менее 60 дней с даты помечается hello предыдущей версии. Hello новые выпуски hello анонсируются [блоге группы разработчиков структуры службы hello](https://blogs.msdn.microsoft.com/azureservicefabric/). Новый выпуск Hello становится доступной toochoose. 
> 
> 

14 дней срока действия предыдущего toohello выпуска hello кластер работает, создается событие работоспособности, помещает кластера в состоянии работоспособности предупреждения. Hello кластер остается в состоянии предупреждения до обновления версии поддерживаемых структуры tooa.

### <a name="setting-hello-upgrade-mode-via-portal"></a>Установка режима обновления hello через портал
Можно задать tooautomatic кластера hello или вручную при создании кластера hello.

![Create_Manualmode][Create_Manualmode]

Можно задать tooautomatic кластера hello или вручную в динамической кластера, с помощью hello управление средой. 

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-portal"></a>Обновление tooa новой версии в кластере, который установлен режим tooManual через портал.
tooupgrade tooa новой версии, все, что нужно toodo — выберите из раскрывающегося списка hello доступная версия hello и сохранения. Обновление Fabric Hello возвращает запущена автоматически. Hello политики работоспособности кластера (сочетание состояние работоспособности узла и всех hello приложений, работающих в кластере hello работоспособности hello) принятых tooduring hello обновления.

Если политики работоспособности кластера hello не выполняются, выполняется откат обновления hello. Прокрутите вниз tooread этот документ больше о том, как tooset эти пользовательские работоспособности политики. 

После устранения проблемы hello, приводящие к hello отката необходимо tooinitiate hello обновление еще раз, по следующей hello же шаги, как и раньше.

![Manage_Automaticmode][Manage_Automaticmode]

### <a name="setting-hello-upgrade-mode-via-a-resource-manager-template"></a>Установка режима обновления hello через шаблона диспетчера ресурсов
Добавьте определение ресурсов Microsoft.ServiceFabric/clusters toohello конфигурации «параметра upgradeMode» Здравствуйте, и набор tooone «clusterCodeVersion» hello объекта hello поддерживается версии структуры, как показано ниже, а затем развернуть шаблон hello. Допустимые значения параметра «upgradeMode» Hello, «Вручную» или «Автоматически»

![ARMUpgradeMode][ARMUpgradeMode]

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-a-resource-manager-template"></a>Обновление tooa новой версии в кластере, который задается режим tooManual через шаблона диспетчера ресурсов.
Если hello кластер находится в ручном режиме, новая версия tooa tooupgrade изменить поддерживаемая версия tooa clusterCodeVersion «hello» и разверните его. Hello развертывания шаблона hello, запускается для обновления Fabric hello возвращает запущена автоматически. Hello политики работоспособности кластера (сочетание состояние работоспособности узла и всех hello приложений, работающих в кластере hello работоспособности hello) принятых tooduring hello обновления.

Если политики работоспособности кластера hello не выполняются, выполняется откат обновления hello. Прокрутите вниз tooread этот документ больше о том, как tooset эти пользовательские работоспособности политики. 

После устранения проблемы hello, приводящие к hello отката необходимо tooinitiate hello обновление еще раз, по следующей hello же шаги, как и раньше.

### <a name="get-list-of-all-available-version-for-all-environments-for-a-given-subscription"></a>Получение списка всех доступных версий для всех сред в указанной подписке
Запустите hello следующую команду, а вы должны получить аналогичные toothis выходных данных.

Параметр supportExpiryUtc сообщает, когда истекает или истек срок действия текущей версии. Hello последний выпуск не имеет допустимой датой — он имеет значение «9999-12-31T23:59:59.9999999», только что это означает, что дата окончания срока действия hello еще не задано.

```REST
GET https://<endpoint>/subscriptions/{{subscriptionId}}/providers/Microsoft.ServiceFabric/locations/{{location}}/clusterVersions?api-version=2016-09-01

Example: https://management.azure.com/subscriptions/1857f442-3bce-4b96-ad95-627f76437a67/providers/Microsoft.ServiceFabric/locations/eastus/clusterVersions?api-version=2016-09-01

Output:
{
                  "value": [
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/5.0.1427.9490",
                      "name": "5.0.1427.9490",
                      "type": "Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.0.1427.9490",
                        "supportExpiryUtc": "2016-11-26T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.0.1427.9490",
                      "name": "5.1.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.1.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.4.1427.9490",
                      "name": "4.4.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "4.4.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Linux"
                      }
                    }
                  ]
                }


```

## <a name="fabric-upgrade-behavior-when-hello-cluster-upgrade-mode-is-automatic"></a>Поведения обновления структуры при — «Авто» кластера hello режим обновления
Корпорация Майкрософт поддерживает hello структуры кода и конфигурации, который работает в кластере Azure. Программное обеспечение toohello автоматические обновления отслеживаемых мы выполнения по мере необходимости. Эти обновления могут затрагивать код, конфигурацию или и то, и другое. убедиться, что приложение несет влияния ни минимальное влияние из-за обновления toothese toomake, мы обновления hello в hello следующие этапы:

### <a name="phase-1-an-upgrade-is-performed-by-using-all-cluster-health-policies"></a>Этап 1. Выполнение обновления с помощью всех политик работоспособности кластера
На этом этапе обновления hello продолжения один домен обновления одновременно, и приложения hello, которые были запущены в кластере hello по-прежнему toorun без простоев. Hello политики работоспособности кластера (сочетание состояние работоспособности узла и всех hello приложений, работающих в кластере hello работоспособности hello) принятых tooduring hello обновления.

Если политики работоспособности кластера hello не выполняются, выполняется откат обновления hello. Затем toohello владельца подписки hello отправляется сообщение электронной почты. сообщение Hello содержит hello следующую информацию:

* Уведомление, что мы должны были tooroll обратно обновления кластера.
* Рекомендуемые действия по решению проблемы, при их наличии.
* Hello количество дней (n), пока мы выполним этап 2.

Мы пытаемся hello tooexecute же обновление еще несколько раз в случае, если не удалось выполнить какие-либо обновления в целях инфраструктуры. После hello n дней электронной почты hello hello даты было отправлено, продолжить изучение tooPhase 2.

В случае соответствия политики работоспособности кластера hello hello обновление считается успешным и помечен как завершенный. На этом этапе может произойти во время обновления начальной hello, или любого обновления повторы hello. В случае успешного выполнения сообщение с подтверждением не отправляется. Это tooavoid передачу вы слишком много сообщений электронной почты — получение электронной почты следует рассматривать как toonormal исключение. Ожидается, что большинство toosucceed обновления кластера hello без негативного влияния на доступность приложения.

### <a name="phase-2-an-upgrade-is-performed-by-using-default-health-policies-only"></a>Этап 2. Выполнение обновления с помощью только политик работоспособности по умолчанию
политики работоспособности Hello на этом этапе устанавливаются таким образом, что hello число приложений, которые были в работоспособном состоянии, в начале hello hello обновления остается одинаковым для hello длительность процесса обновления hello hello. Как и этап 1 обновления hello этап 2 продолжения один домен обновления одновременно, и приложения hello, которые были запущены в кластере hello по-прежнему toorun без простоев. политики работоспособности кластера Hello (сочетание состояние работоспособности узла и всех hello приложений, работающих в кластере hello работоспособности hello) являются выполняем toofor hello период обновления hello.

Если политики работоспособности кластера hello фактически не выполняются, выполняется откат обновления hello. Затем toohello владельца подписки hello отправляется сообщение электронной почты. сообщение Hello содержит hello следующую информацию:

* Уведомление, что мы должны были tooroll обратно обновления кластера.
* Рекомендуемые действия по решению проблемы, при их наличии.
* Hello количество дней (n), пока мы выполним этап 3.

Мы пытаемся hello tooexecute же обновление еще несколько раз в случае, если не удалось выполнить какие-либо обновления в целях инфраструктуры. За несколько дней до назначенного срока владельцу подписки отправляется сообщение с напоминанием. После hello n дней электронной почты hello hello даты было отправлено, продолжить изучение tooPhase 3. Hello сообщения электронной почты, которое можно отправить на этапе 2 должен воспринимать серьезно и корректирующие действия следует предпринять.

В случае соответствия политики работоспособности кластера hello hello обновление считается успешным и помечен как завершенный. На этом этапе может произойти во время обновления начальной hello, или любого обновления повторы hello. В случае успешного выполнения сообщение с подтверждением не отправляется.

### <a name="phase-3-an-upgrade-is-performed-by-using-aggressive-health-policies"></a>Этап 3. Выполнение обновления с помощью жестких политик работоспособности кластера
Эти политики работоспособности на этом этапе специально предназначенные для завершения обновления hello, а не работоспособность приложения hello hello. Этот этап очень редко применяется для обновления кластера. Кластер возвращает toothis этап, существует ли велика вероятность того, что приложение переходит в неработоспособное и/или потерей доступности.

Аналогичные toohello другие два этапа обновления этап 3 продолжить один домен обновления одновременно.

Если политики работоспособности кластера hello не выполняются, выполняется откат обновления hello. Мы пытаемся hello tooexecute же обновление еще несколько раз в случае, если не удалось выполнить какие-либо обновления в целях инфраструктуры. После этого кластера hello закрепления, чтобы он больше не будет получать поддержку и обновления.

Сообщение электронной почты с этой информацией отправляется toohello владелец подписки, вместе с hello корректирующие действия. Все кластеры tooget не ожидается в состояние, где сбой этап 3.

В случае соответствия политики работоспособности кластера hello hello обновление считается успешным и помечен как завершенный. На этом этапе может произойти во время обновления начальной hello, или любого обновления повторы hello. В случае успешного выполнения сообщение с подтверждением не отправляется.

## <a name="cluster-configurations-that-you-control"></a>Управляемая пользователем конфигурация кластера
В дополнение к этому tooset hello toohello возможности кластера обновление в режиме, вот hello конфигурации, которые можно изменить в кластере динамической.

### <a name="certificates"></a>Сертификаты
Можно добавить новые или удалить сертификаты для кластера hello и клиента через портал hello легко. См. слишком[подробные сведения](service-fabric-cluster-security-update-certs-azure.md)

![Снимок экрана, показывающий отпечатки сертификата в hello портал Azure.][CertificateUpgrade]

### <a name="application-ports"></a>Порты приложения
Порты, приложение можно изменить, изменив свойства ресурса hello балансировки нагрузки, связанные с типом узла hello. Вы можете использовать портал hello или PowerShell диспетчера ресурсов можно использовать напрямую.

новый порт на всех виртуальных машинах в тип узла tooopen hello следующие:

1. Добавьте новые проверки toohello соответствующие подсистемы балансировки нагрузки.
   
    При развертывании кластера с помощью портала hello hello подсистемы балансировки нагрузки с именем «Балансировки Нагрузки — имя группы ресурсов hello-NodeTypename», один для каждого типа узла. Поскольку имена подсистемы балансировки нагрузки hello являются уникальными только в пределах группы ресурсов, рекомендуется при поиске их в определенной группе ресурсов.
   
    ![Снимок экрана, показывающий, добавление tooa пробы Подсистема балансировки загрузки в портал hello.][AddingProbes]
2. Добавьте новое правило toohello балансировки нагрузки.
   
    Добавьте новый toohello правило с таким же Подсистема балансировки нагрузки с помощью проверки hello, созданную в предыдущем шаге hello.
   
    ![Добавление нового правила балансировки нагрузки tooa hello портала.][AddingLBRules]

### <a name="placement-properties"></a>Свойства размещения
Для каждого типа узла hello можно добавить пользовательские свойства размещения, которые должны toouse в приложениях. NodeType — это свойство по умолчанию, которое можно использовать без его явного добавления.

> [!NOTE]
> Дополнительные сведения по использованию hello ограничения размещения, свойства узла, и как toodefine, ознакомьтесь с toohello раздела «Размещения ограничения и свойства узла» hello диспетчер ресурсов кластера Service Fabric документа по [описанием вашего кластера ](service-fabric-cluster-resource-manager-cluster-description.md).
> 
> 

### <a name="capacity-metrics"></a>Метрики емкости
Для каждого типа узла hello можно добавить пользовательские метрики емкости требуется toouse в tooreport нагрузки приложений. Сведения о hello использования нагрузки tooreport метрики емкости см toohello диспетчер ресурсов кластера Service Fabric документы на [описанием ваш кластер](service-fabric-cluster-resource-manager-cluster-description.md) и [метрики и нагрузки](service-fabric-cluster-resource-manager-metrics.md).

### <a name="fabric-upgrade-settings---health-polices"></a>Параметры обновления Service Fabric — политики работоспособности
Вы можете указать пользовательские политики работоспособности для обновления Service Fabric. Если ваш tooAutomatic кластера были установлены обновления структуры, эти политики получить примененных toohello этап 1 hello структуры автоматического обновления.
Если установки кластера для структуры вручную обновления, а затем эти политики применяются каждый раз, выберите новую версию, активируя tookick системы hello off обновление fabric hello в кластере. Если не переопределить политики hello, используются значения по умолчанию hello.

Можно указать политики работоспособности пользовательских hello или просмотрите текущие параметры hello в колонке «обновление fabric» hello, выбрав hello, дополнительные параметры обновления. Просмотрите следующий рисунок по hello. 

![Управление пользовательскими политиками работоспособности][HealthPolices]

### <a name="customize-fabric-settings-for-your-cluster"></a>Настройка параметров Service Fabric для кластера
См. слишком[параметры структуры структуры кластера службы](service-fabric-cluster-fabric-settings.md) и как их настроить.

### <a name="os-patches-on-hello-vms-that-make-up-hello-cluster"></a>Исправлений ОС на виртуальные машины, входящие в состав кластера hello hello
См. слишком[приложения Orchestration исправление](service-fabric-patch-orchestration-application.md) которого можно развернуть на исправления tooinstall вашего кластера из центра обновления Windows направленные способом, хронометраж hello службы, доступные всем hello. 

### <a name="os-upgrades-on-hello-vms-that-make-up-hello-cluster"></a>Обновления операционной системы на виртуальные машины, входящие в состав кластера hello hello
При обновлении hello образ ОС на виртуальных машинах hello hello кластера возможно только одна виртуальная машина одновременно. За это обновление отвечаете вы: в настоящее время автоматизация этой функции отсутствует.

## <a name="next-steps"></a>Дальнейшие действия
* Узнайте, как toocustomize некоторые hello [структуры кластера структуры параметры службы](service-fabric-cluster-fabric-settings.md)
* Узнайте, каким образом слишком[масштабирования кластера](service-fabric-cluster-scale-up-down.md)
* Узнайте об [обновлениях приложений](service-fabric-application-upgrade.md)

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade2.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes2.PNG
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png
[HealthPolices]: ./media/service-fabric-cluster-upgrade/Manage_AutomodeWadvSettings.PNG
[ARMUpgradeMode]: ./media/service-fabric-cluster-upgrade/ARMUpgradeMode.PNG
[Create_Manualmode]: ./media/service-fabric-cluster-upgrade/Create_Manualmode.PNG
[Manage_Automaticmode]: ./media/service-fabric-cluster-upgrade/Manage_Automaticmode.PNG
