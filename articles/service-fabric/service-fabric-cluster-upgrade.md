---
title: "aaaUpgrade кластера с Azure Service Fabric | Документы Microsoft"
description: "Обновите hello Service Fabric код или конфигурацию, которая запускает кластера Service Fabric, в том числе Установка режима обновления кластера, обновление сертификатов, добавление портов приложений, выполнив исправлений ОС и т. д. Чего можно ожидать, при выполнении обновления hello?"
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 15190ace-31ed-491f-a54b-b5ff61e718db
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 8/10/2017
ms.author: chackdan
ms.openlocfilehash: 94ac3833ec0810f79de06ecb50f254028fa90408
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-an-azure-service-fabric-cluster"></a><span data-ttu-id="b8d13-104">Обновление кластера Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="b8d13-104">Upgrade an Azure Service Fabric cluster</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="b8d13-105">Кластер Azure</span><span class="sxs-lookup"><span data-stu-id="b8d13-105">Azure Cluster</span></span>](service-fabric-cluster-upgrade.md)
> * [<span data-ttu-id="b8d13-106">Автономный кластер</span><span class="sxs-lookup"><span data-stu-id="b8d13-106">Standalone Cluster</span></span>](service-fabric-cluster-upgrade-windows-server.md)
> 
> 

<span data-ttu-id="b8d13-107">Для любой современной системы разработки для возможность обновления — долгосрочный успех tooachieving ключа продукта.</span><span class="sxs-lookup"><span data-stu-id="b8d13-107">For any modern system, designing for upgradability is key tooachieving long-term success of your product.</span></span> <span data-ttu-id="b8d13-108">Кластер Service Fabric Azure представляет собой ресурс, который принадлежит вам, но частично управляется корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="b8d13-108">An Azure Service Fabric cluster is a resource that you own, but is partly managed by Microsoft.</span></span> <span data-ttu-id="b8d13-109">В этой статье содержатся сведения о компонентах, управляемых автоматически, и о том, что можно настроить самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="b8d13-109">This article describes what is managed automatically and what you can configure yourself.</span></span>

## <a name="controlling-hello-fabric-version-that-runs-on-your-cluster"></a><span data-ttu-id="b8d13-110">Управление версии структуры hello, работающей в кластере</span><span class="sxs-lookup"><span data-stu-id="b8d13-110">Controlling hello fabric version that runs on your Cluster</span></span>
<span data-ttu-id="b8d13-111">Можно задать автоматическое коммутирующей tooreceive кластера обновления как их выпуска корпорацией Майкрософт или выбрать поддерживаемые структуры требуемой версии вашей toobe кластера на.</span><span class="sxs-lookup"><span data-stu-id="b8d13-111">You can set your cluster tooreceive automatic fabric upgrades as they are released by Microsoft or you can select a supported fabric version you want your cluster toobe on.</span></span>

<span data-ttu-id="b8d13-112">Это можно сделать, Настройка конфигурации кластера «параметра upgradeMode» hello на портале hello или с помощью диспетчера ресурсов во время создания hello или позднее, динамической кластера</span><span class="sxs-lookup"><span data-stu-id="b8d13-112">You do this by setting hello "upgradeMode" cluster configuration on hello portal or using Resource Manager at hello time of creation or later on a live cluster</span></span> 

> [!NOTE]
> <span data-ttu-id="b8d13-113">Убедитесь, что tookeep кластера под управлением версии поддерживаемых структуры всегда.</span><span class="sxs-lookup"><span data-stu-id="b8d13-113">Make sure tookeep your cluster running a supported fabric version always.</span></span> <span data-ttu-id="b8d13-114">Как и когда мы объявления hello выпуска новой версии службы структуры для окончания поддержки после менее 60 дней с даты помечается hello предыдущей версии.</span><span class="sxs-lookup"><span data-stu-id="b8d13-114">As and when we announce hello release of a new version of service fabric, hello previous version is marked for end of support after a minimum of 60 days from that date.</span></span> <span data-ttu-id="b8d13-115">Hello новые выпуски hello анонсируются [блоге группы разработчиков структуры службы hello](https://blogs.msdn.microsoft.com/azureservicefabric/).</span><span class="sxs-lookup"><span data-stu-id="b8d13-115">hello  hello new releases are announced [on hello service fabric team blog](https://blogs.msdn.microsoft.com/azureservicefabric/).</span></span> <span data-ttu-id="b8d13-116">Новый выпуск Hello становится доступной toochoose.</span><span class="sxs-lookup"><span data-stu-id="b8d13-116">hello new release is available toochoose then.</span></span> 
> 
> 

<span data-ttu-id="b8d13-117">14 дней срока действия предыдущего toohello выпуска hello кластер работает, создается событие работоспособности, помещает кластера в состоянии работоспособности предупреждения.</span><span class="sxs-lookup"><span data-stu-id="b8d13-117">14 days prior toohello expiry of hello release your cluster is running, a health event is generated that puts your cluster into a warning health state.</span></span> <span data-ttu-id="b8d13-118">Hello кластер остается в состоянии предупреждения до обновления версии поддерживаемых структуры tooa.</span><span class="sxs-lookup"><span data-stu-id="b8d13-118">hello cluster remains in a warning state until you upgrade tooa supported fabric version.</span></span>

### <a name="setting-hello-upgrade-mode-via-portal"></a><span data-ttu-id="b8d13-119">Установка режима обновления hello через портал</span><span class="sxs-lookup"><span data-stu-id="b8d13-119">Setting hello upgrade mode via portal</span></span>
<span data-ttu-id="b8d13-120">Можно задать tooautomatic кластера hello или вручную при создании кластера hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-120">You can set hello cluster tooautomatic or manual when you are creating hello cluster.</span></span>

![Create_Manualmode][Create_Manualmode]

<span data-ttu-id="b8d13-122">Можно задать tooautomatic кластера hello или вручную в динамической кластера, с помощью hello управление средой.</span><span class="sxs-lookup"><span data-stu-id="b8d13-122">You can set hello cluster tooautomatic or manual when on a live cluster, using hello manage experience.</span></span> 

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-portal"></a><span data-ttu-id="b8d13-123">Обновление tooa новой версии в кластере, который установлен режим tooManual через портал.</span><span class="sxs-lookup"><span data-stu-id="b8d13-123">Upgrading tooa new version on a cluster that is set tooManual mode via portal.</span></span>
<span data-ttu-id="b8d13-124">tooupgrade tooa новой версии, все, что нужно toodo — выберите из раскрывающегося списка hello доступная версия hello и сохранения.</span><span class="sxs-lookup"><span data-stu-id="b8d13-124">tooupgrade tooa new version, all you need toodo is select hello available version from hello dropdown and save.</span></span> <span data-ttu-id="b8d13-125">Обновление Fabric Hello возвращает запущена автоматически.</span><span class="sxs-lookup"><span data-stu-id="b8d13-125">hello Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="b8d13-126">Hello политики работоспособности кластера (сочетание состояние работоспособности узла и всех hello приложений, работающих в кластере hello работоспособности hello) принятых tooduring hello обновления.</span><span class="sxs-lookup"><span data-stu-id="b8d13-126">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="b8d13-127">Если политики работоспособности кластера hello не выполняются, выполняется откат обновления hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-127">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="b8d13-128">Прокрутите вниз tooread этот документ больше о том, как tooset эти пользовательские работоспособности политики.</span><span class="sxs-lookup"><span data-stu-id="b8d13-128">Scroll down this document tooread more on how tooset those custom health policies.</span></span> 

<span data-ttu-id="b8d13-129">После устранения проблемы hello, приводящие к hello отката необходимо tooinitiate hello обновление еще раз, по следующей hello же шаги, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="b8d13-129">Once you have fixed hello issues that resulted in hello rollback, you need tooinitiate hello upgrade again, by following hello same steps as before.</span></span>

![Manage_Automaticmode][Manage_Automaticmode]

### <a name="setting-hello-upgrade-mode-via-a-resource-manager-template"></a><span data-ttu-id="b8d13-131">Установка режима обновления hello через шаблона диспетчера ресурсов</span><span class="sxs-lookup"><span data-stu-id="b8d13-131">Setting hello upgrade mode via a Resource Manager template</span></span>
<span data-ttu-id="b8d13-132">Добавьте определение ресурсов Microsoft.ServiceFabric/clusters toohello конфигурации «параметра upgradeMode» Здравствуйте, и набор tooone «clusterCodeVersion» hello объекта hello поддерживается версии структуры, как показано ниже, а затем развернуть шаблон hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-132">Add hello "upgradeMode" configuration toohello Microsoft.ServiceFabric/clusters resource definition and set hello "clusterCodeVersion" tooone of hello supported fabric versions as shown below and then deploy hello template.</span></span> <span data-ttu-id="b8d13-133">Допустимые значения параметра «upgradeMode» Hello, «Вручную» или «Автоматически»</span><span class="sxs-lookup"><span data-stu-id="b8d13-133">hello valid values for "upgradeMode" are "Manual" or "Automatic"</span></span>

![ARMUpgradeMode][ARMUpgradeMode]

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-a-resource-manager-template"></a><span data-ttu-id="b8d13-135">Обновление tooa новой версии в кластере, который задается режим tooManual через шаблона диспетчера ресурсов.</span><span class="sxs-lookup"><span data-stu-id="b8d13-135">Upgrading tooa new version on a cluster that is set tooManual mode via a Resource Manager template.</span></span>
<span data-ttu-id="b8d13-136">Если hello кластер находится в ручном режиме, новая версия tooa tooupgrade изменить поддерживаемая версия tooa clusterCodeVersion «hello» и разверните его.</span><span class="sxs-lookup"><span data-stu-id="b8d13-136">When hello cluster is in Manual mode, tooupgrade tooa new version, change hello "clusterCodeVersion" tooa supported version and deploy it.</span></span> <span data-ttu-id="b8d13-137">Hello развертывания шаблона hello, запускается для обновления Fabric hello возвращает запущена автоматически.</span><span class="sxs-lookup"><span data-stu-id="b8d13-137">hello deployment of hello template, kicks of hello Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="b8d13-138">Hello политики работоспособности кластера (сочетание состояние работоспособности узла и всех hello приложений, работающих в кластере hello работоспособности hello) принятых tooduring hello обновления.</span><span class="sxs-lookup"><span data-stu-id="b8d13-138">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="b8d13-139">Если политики работоспособности кластера hello не выполняются, выполняется откат обновления hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-139">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="b8d13-140">Прокрутите вниз tooread этот документ больше о том, как tooset эти пользовательские работоспособности политики.</span><span class="sxs-lookup"><span data-stu-id="b8d13-140">Scroll down this document tooread more on how tooset those custom health policies.</span></span> 

<span data-ttu-id="b8d13-141">После устранения проблемы hello, приводящие к hello отката необходимо tooinitiate hello обновление еще раз, по следующей hello же шаги, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="b8d13-141">Once you have fixed hello issues that resulted in hello rollback, you need tooinitiate hello upgrade again, by following hello same steps as before.</span></span>

### <a name="get-list-of-all-available-version-for-all-environments-for-a-given-subscription"></a><span data-ttu-id="b8d13-142">Получение списка всех доступных версий для всех сред в указанной подписке</span><span class="sxs-lookup"><span data-stu-id="b8d13-142">Get list of all available version for all environments for a given subscription</span></span>
<span data-ttu-id="b8d13-143">Запустите hello следующую команду, а вы должны получить аналогичные toothis выходных данных.</span><span class="sxs-lookup"><span data-stu-id="b8d13-143">Run hello following command, and you should get an output similar toothis.</span></span>

<span data-ttu-id="b8d13-144">Параметр supportExpiryUtc сообщает, когда истекает или истек срок действия текущей версии.</span><span class="sxs-lookup"><span data-stu-id="b8d13-144">"supportExpiryUtc" tells your when a given release is expiring or has expired.</span></span> <span data-ttu-id="b8d13-145">Hello последний выпуск не имеет допустимой датой — он имеет значение «9999-12-31T23:59:59.9999999», только что это означает, что дата окончания срока действия hello еще не задано.</span><span class="sxs-lookup"><span data-stu-id="b8d13-145">hello latest release does not have a valid date - it has a value of "9999-12-31T23:59:59.9999999", which just means that hello expiry date is not yet set.</span></span>

```REST
GET https://<endpoint>/subscriptions/{{subscriptionId}}/providers/Microsoft.ServiceFabric/locations/{{location}}/clusterVersions?api-version=2016-09-01

Example: https://management.azure.com/subscriptions/1857f442-3bce-4b96-ad95-627f76437a67/providers/Microsoft.ServiceFabric/locations/eastus/clusterVersions?api-version=2016-09-01

Output:
{
                  "value": [
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/5.0.1427.9490",
                      "name": "5.0.1427.9490",
                      "type": "Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.0.1427.9490",
                        "supportExpiryUtc": "2016-11-26T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.0.1427.9490",
                      "name": "5.1.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.1.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.4.1427.9490",
                      "name": "4.4.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "4.4.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Linux"
                      }
                    }
                  ]
                }


```

## <a name="fabric-upgrade-behavior-when-hello-cluster-upgrade-mode-is-automatic"></a><span data-ttu-id="b8d13-146">Поведения обновления структуры при — «Авто» кластера hello режим обновления</span><span class="sxs-lookup"><span data-stu-id="b8d13-146">Fabric upgrade behavior when hello cluster Upgrade Mode is Automatic</span></span>
<span data-ttu-id="b8d13-147">Корпорация Майкрософт поддерживает hello структуры кода и конфигурации, который работает в кластере Azure.</span><span class="sxs-lookup"><span data-stu-id="b8d13-147">Microsoft maintains hello fabric code and configuration that runs in an Azure cluster.</span></span> <span data-ttu-id="b8d13-148">Программное обеспечение toohello автоматические обновления отслеживаемых мы выполнения по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="b8d13-148">We perform automatic monitored upgrades toohello software on an as-needed basis.</span></span> <span data-ttu-id="b8d13-149">Эти обновления могут затрагивать код, конфигурацию или и то, и другое.</span><span class="sxs-lookup"><span data-stu-id="b8d13-149">These upgrades could be code, configuration, or both.</span></span> <span data-ttu-id="b8d13-150">убедиться, что приложение несет влияния ни минимальное влияние из-за обновления toothese toomake, мы обновления hello в hello следующие этапы:</span><span class="sxs-lookup"><span data-stu-id="b8d13-150">toomake sure that your application suffers no impact or minimal impact due toothese upgrades, we perform hello upgrades in hello following phases:</span></span>

### <a name="phase-1-an-upgrade-is-performed-by-using-all-cluster-health-policies"></a><span data-ttu-id="b8d13-151">Этап 1. Выполнение обновления с помощью всех политик работоспособности кластера</span><span class="sxs-lookup"><span data-stu-id="b8d13-151">Phase 1: An upgrade is performed by using all cluster health policies</span></span>
<span data-ttu-id="b8d13-152">На этом этапе обновления hello продолжения один домен обновления одновременно, и приложения hello, которые были запущены в кластере hello по-прежнему toorun без простоев.</span><span class="sxs-lookup"><span data-stu-id="b8d13-152">During this phase, hello upgrades proceed one upgrade domain at a time, and hello applications that were running in hello cluster continue toorun without any downtime.</span></span> <span data-ttu-id="b8d13-153">Hello политики работоспособности кластера (сочетание состояние работоспособности узла и всех hello приложений, работающих в кластере hello работоспособности hello) принятых tooduring hello обновления.</span><span class="sxs-lookup"><span data-stu-id="b8d13-153">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="b8d13-154">Если политики работоспособности кластера hello не выполняются, выполняется откат обновления hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-154">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="b8d13-155">Затем toohello владельца подписки hello отправляется сообщение электронной почты.</span><span class="sxs-lookup"><span data-stu-id="b8d13-155">Then an email is sent toohello owner of hello subscription.</span></span> <span data-ttu-id="b8d13-156">сообщение Hello содержит hello следующую информацию:</span><span class="sxs-lookup"><span data-stu-id="b8d13-156">hello email contains hello following information:</span></span>

* <span data-ttu-id="b8d13-157">Уведомление, что мы должны были tooroll обратно обновления кластера.</span><span class="sxs-lookup"><span data-stu-id="b8d13-157">Notification that we had tooroll back a cluster upgrade.</span></span>
* <span data-ttu-id="b8d13-158">Рекомендуемые действия по решению проблемы, при их наличии.</span><span class="sxs-lookup"><span data-stu-id="b8d13-158">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="b8d13-159">Hello количество дней (n), пока мы выполним этап 2.</span><span class="sxs-lookup"><span data-stu-id="b8d13-159">hello number of days (n) until we execute Phase 2.</span></span>

<span data-ttu-id="b8d13-160">Мы пытаемся hello tooexecute же обновление еще несколько раз в случае, если не удалось выполнить какие-либо обновления в целях инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="b8d13-160">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="b8d13-161">После hello n дней электронной почты hello hello даты было отправлено, продолжить изучение tooPhase 2.</span><span class="sxs-lookup"><span data-stu-id="b8d13-161">After hello n days from hello date hello email was sent, we proceed tooPhase 2.</span></span>

<span data-ttu-id="b8d13-162">В случае соответствия политики работоспособности кластера hello hello обновление считается успешным и помечен как завершенный.</span><span class="sxs-lookup"><span data-stu-id="b8d13-162">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="b8d13-163">На этом этапе может произойти во время обновления начальной hello, или любого обновления повторы hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-163">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="b8d13-164">В случае успешного выполнения сообщение с подтверждением не отправляется.</span><span class="sxs-lookup"><span data-stu-id="b8d13-164">There is no email confirmation of a successful run.</span></span> <span data-ttu-id="b8d13-165">Это tooavoid передачу вы слишком много сообщений электронной почты — получение электронной почты следует рассматривать как toonormal исключение.</span><span class="sxs-lookup"><span data-stu-id="b8d13-165">This is tooavoid sending you too many emails--receiving an email should be seen as an exception toonormal.</span></span> <span data-ttu-id="b8d13-166">Ожидается, что большинство toosucceed обновления кластера hello без негативного влияния на доступность приложения.</span><span class="sxs-lookup"><span data-stu-id="b8d13-166">We expect most of hello cluster upgrades toosucceed without impacting your application availability.</span></span>

### <a name="phase-2-an-upgrade-is-performed-by-using-default-health-policies-only"></a><span data-ttu-id="b8d13-167">Этап 2. Выполнение обновления с помощью только политик работоспособности по умолчанию</span><span class="sxs-lookup"><span data-stu-id="b8d13-167">Phase 2: An upgrade is performed by using default health policies only</span></span>
<span data-ttu-id="b8d13-168">политики работоспособности Hello на этом этапе устанавливаются таким образом, что hello число приложений, которые были в работоспособном состоянии, в начале hello hello обновления остается одинаковым для hello длительность процесса обновления hello hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-168">hello health policies in this phase are set in such a way that hello number of applications that were healthy at hello beginning of hello upgrade remains hello same for hello duration of hello upgrade process.</span></span> <span data-ttu-id="b8d13-169">Как и этап 1 обновления hello этап 2 продолжения один домен обновления одновременно, и приложения hello, которые были запущены в кластере hello по-прежнему toorun без простоев.</span><span class="sxs-lookup"><span data-stu-id="b8d13-169">As in Phase 1, hello Phase 2 upgrades proceed one upgrade domain at a time, and hello applications that were running in hello cluster continue toorun without any downtime.</span></span> <span data-ttu-id="b8d13-170">политики работоспособности кластера Hello (сочетание состояние работоспособности узла и всех hello приложений, работающих в кластере hello работоспособности hello) являются выполняем toofor hello период обновления hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-170">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered toofor hello duration of hello upgrade.</span></span>

<span data-ttu-id="b8d13-171">Если политики работоспособности кластера hello фактически не выполняются, выполняется откат обновления hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-171">If hello cluster health policies in effect are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="b8d13-172">Затем toohello владельца подписки hello отправляется сообщение электронной почты.</span><span class="sxs-lookup"><span data-stu-id="b8d13-172">Then an email is sent toohello owner of hello subscription.</span></span> <span data-ttu-id="b8d13-173">сообщение Hello содержит hello следующую информацию:</span><span class="sxs-lookup"><span data-stu-id="b8d13-173">hello email contains hello following information:</span></span>

* <span data-ttu-id="b8d13-174">Уведомление, что мы должны были tooroll обратно обновления кластера.</span><span class="sxs-lookup"><span data-stu-id="b8d13-174">Notification that we had tooroll back a cluster upgrade.</span></span>
* <span data-ttu-id="b8d13-175">Рекомендуемые действия по решению проблемы, при их наличии.</span><span class="sxs-lookup"><span data-stu-id="b8d13-175">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="b8d13-176">Hello количество дней (n), пока мы выполним этап 3.</span><span class="sxs-lookup"><span data-stu-id="b8d13-176">hello number of days (n) until we execute Phase 3.</span></span>

<span data-ttu-id="b8d13-177">Мы пытаемся hello tooexecute же обновление еще несколько раз в случае, если не удалось выполнить какие-либо обновления в целях инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="b8d13-177">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="b8d13-178">За несколько дней до назначенного срока владельцу подписки отправляется сообщение с напоминанием.</span><span class="sxs-lookup"><span data-stu-id="b8d13-178">A reminder email is sent a couple of days before n days are up.</span></span> <span data-ttu-id="b8d13-179">После hello n дней электронной почты hello hello даты было отправлено, продолжить изучение tooPhase 3.</span><span class="sxs-lookup"><span data-stu-id="b8d13-179">After hello n days from hello date hello email was sent, we proceed tooPhase 3.</span></span> <span data-ttu-id="b8d13-180">Hello сообщения электронной почты, которое можно отправить на этапе 2 должен воспринимать серьезно и корректирующие действия следует предпринять.</span><span class="sxs-lookup"><span data-stu-id="b8d13-180">hello emails we send you in Phase 2 must be taken seriously and remedial actions must be taken.</span></span>

<span data-ttu-id="b8d13-181">В случае соответствия политики работоспособности кластера hello hello обновление считается успешным и помечен как завершенный.</span><span class="sxs-lookup"><span data-stu-id="b8d13-181">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="b8d13-182">На этом этапе может произойти во время обновления начальной hello, или любого обновления повторы hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-182">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="b8d13-183">В случае успешного выполнения сообщение с подтверждением не отправляется.</span><span class="sxs-lookup"><span data-stu-id="b8d13-183">There is no email confirmation of a successful run.</span></span>

### <a name="phase-3-an-upgrade-is-performed-by-using-aggressive-health-policies"></a><span data-ttu-id="b8d13-184">Этап 3. Выполнение обновления с помощью жестких политик работоспособности кластера</span><span class="sxs-lookup"><span data-stu-id="b8d13-184">Phase 3: An upgrade is performed by using aggressive health policies</span></span>
<span data-ttu-id="b8d13-185">Эти политики работоспособности на этом этапе специально предназначенные для завершения обновления hello, а не работоспособность приложения hello hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-185">These health policies in this phase are geared towards completion of hello upgrade rather than hello health of hello applications.</span></span> <span data-ttu-id="b8d13-186">Этот этап очень редко применяется для обновления кластера.</span><span class="sxs-lookup"><span data-stu-id="b8d13-186">Very few cluster upgrades end up in this phase.</span></span> <span data-ttu-id="b8d13-187">Кластер возвращает toothis этап, существует ли велика вероятность того, что приложение переходит в неработоспособное и/или потерей доступности.</span><span class="sxs-lookup"><span data-stu-id="b8d13-187">If your cluster gets toothis phase, there is a good chance that your application becomes unhealthy and/or lose availability.</span></span>

<span data-ttu-id="b8d13-188">Аналогичные toohello другие два этапа обновления этап 3 продолжить один домен обновления одновременно.</span><span class="sxs-lookup"><span data-stu-id="b8d13-188">Similar toohello other two phases, Phase 3 upgrades proceed one upgrade domain at a time.</span></span>

<span data-ttu-id="b8d13-189">Если политики работоспособности кластера hello не выполняются, выполняется откат обновления hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-189">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="b8d13-190">Мы пытаемся hello tooexecute же обновление еще несколько раз в случае, если не удалось выполнить какие-либо обновления в целях инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="b8d13-190">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="b8d13-191">После этого кластера hello закрепления, чтобы он больше не будет получать поддержку и обновления.</span><span class="sxs-lookup"><span data-stu-id="b8d13-191">After that, hello cluster is pinned, so that it will no longer receive support and/or upgrades.</span></span>

<span data-ttu-id="b8d13-192">Сообщение электронной почты с этой информацией отправляется toohello владелец подписки, вместе с hello корректирующие действия.</span><span class="sxs-lookup"><span data-stu-id="b8d13-192">An email with this information is sent toohello subscription owner, along with hello remedial actions.</span></span> <span data-ttu-id="b8d13-193">Все кластеры tooget не ожидается в состояние, где сбой этап 3.</span><span class="sxs-lookup"><span data-stu-id="b8d13-193">We do not expect any clusters tooget into a state where Phase 3 has failed.</span></span>

<span data-ttu-id="b8d13-194">В случае соответствия политики работоспособности кластера hello hello обновление считается успешным и помечен как завершенный.</span><span class="sxs-lookup"><span data-stu-id="b8d13-194">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="b8d13-195">На этом этапе может произойти во время обновления начальной hello, или любого обновления повторы hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-195">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="b8d13-196">В случае успешного выполнения сообщение с подтверждением не отправляется.</span><span class="sxs-lookup"><span data-stu-id="b8d13-196">There is no email confirmation of a successful run.</span></span>

## <a name="cluster-configurations-that-you-control"></a><span data-ttu-id="b8d13-197">Управляемая пользователем конфигурация кластера</span><span class="sxs-lookup"><span data-stu-id="b8d13-197">Cluster configurations that you control</span></span>
<span data-ttu-id="b8d13-198">В дополнение к этому tooset hello toohello возможности кластера обновление в режиме, вот hello конфигурации, которые можно изменить в кластере динамической.</span><span class="sxs-lookup"><span data-stu-id="b8d13-198">In addition toohello ability tooset hello cluster upgrade mode, Here are hello configurations that you can change on a live cluster.</span></span>

### <a name="certificates"></a><span data-ttu-id="b8d13-199">Сертификаты</span><span class="sxs-lookup"><span data-stu-id="b8d13-199">Certificates</span></span>
<span data-ttu-id="b8d13-200">Можно добавить новые или удалить сертификаты для кластера hello и клиента через портал hello легко.</span><span class="sxs-lookup"><span data-stu-id="b8d13-200">You can add new or delete certificates for hello cluster and client via hello portal easily.</span></span> <span data-ttu-id="b8d13-201">См. слишком[подробные сведения](service-fabric-cluster-security-update-certs-azure.md)</span><span class="sxs-lookup"><span data-stu-id="b8d13-201">Refer too[this document for detailed instructions](service-fabric-cluster-security-update-certs-azure.md)</span></span>

![Снимок экрана, показывающий отпечатки сертификата в hello портал Azure.][CertificateUpgrade]

### <a name="application-ports"></a><span data-ttu-id="b8d13-203">Порты приложения</span><span class="sxs-lookup"><span data-stu-id="b8d13-203">Application ports</span></span>
<span data-ttu-id="b8d13-204">Порты, приложение можно изменить, изменив свойства ресурса hello балансировки нагрузки, связанные с типом узла hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-204">You can change application ports by changing hello Load Balancer resource properties that are associated with hello node type.</span></span> <span data-ttu-id="b8d13-205">Вы можете использовать портал hello или PowerShell диспетчера ресурсов можно использовать напрямую.</span><span class="sxs-lookup"><span data-stu-id="b8d13-205">You can use hello portal, or you can use Resource Manager PowerShell directly.</span></span>

<span data-ttu-id="b8d13-206">новый порт на всех виртуальных машинах в тип узла tooopen hello следующие:</span><span class="sxs-lookup"><span data-stu-id="b8d13-206">tooopen a new port on all VMs in a node type, do hello following:</span></span>

1. <span data-ttu-id="b8d13-207">Добавьте новые проверки toohello соответствующие подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="b8d13-207">Add a new probe toohello appropriate load balancer.</span></span>
   
    <span data-ttu-id="b8d13-208">При развертывании кластера с помощью портала hello hello подсистемы балансировки нагрузки с именем «Балансировки Нагрузки — имя группы ресурсов hello-NodeTypename», один для каждого типа узла.</span><span class="sxs-lookup"><span data-stu-id="b8d13-208">If you deployed your cluster by using hello portal, hello load balancers are named "LB-name of hello Resource group-NodeTypename", one for each node type.</span></span> <span data-ttu-id="b8d13-209">Поскольку имена подсистемы балансировки нагрузки hello являются уникальными только в пределах группы ресурсов, рекомендуется при поиске их в определенной группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="b8d13-209">Since hello load balancer names are unique only within a resource group, it is best if you search for them under a specific resource group.</span></span>
   
    ![Снимок экрана, показывающий, добавление tooa пробы Подсистема балансировки загрузки в портал hello.][AddingProbes]
2. <span data-ttu-id="b8d13-211">Добавьте новое правило toohello балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="b8d13-211">Add a new rule toohello load balancer.</span></span>
   
    <span data-ttu-id="b8d13-212">Добавьте новый toohello правило с таким же Подсистема балансировки нагрузки с помощью проверки hello, созданную в предыдущем шаге hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-212">Add a new rule toohello same load balancer by using hello probe that you created in hello previous step.</span></span>
   
    ![Добавление нового правила балансировки нагрузки tooa hello портала.][AddingLBRules]

### <a name="placement-properties"></a><span data-ttu-id="b8d13-214">Свойства размещения</span><span class="sxs-lookup"><span data-stu-id="b8d13-214">Placement properties</span></span>
<span data-ttu-id="b8d13-215">Для каждого типа узла hello можно добавить пользовательские свойства размещения, которые должны toouse в приложениях.</span><span class="sxs-lookup"><span data-stu-id="b8d13-215">For each of hello node types, you can add custom placement properties that you want toouse in your applications.</span></span> <span data-ttu-id="b8d13-216">NodeType — это свойство по умолчанию, которое можно использовать без его явного добавления.</span><span class="sxs-lookup"><span data-stu-id="b8d13-216">NodeType is a default property that you can use without adding it explicitly.</span></span>

> [!NOTE]
> <span data-ttu-id="b8d13-217">Дополнительные сведения по использованию hello ограничения размещения, свойства узла, и как toodefine, ознакомьтесь с toohello раздела «Размещения ограничения и свойства узла» hello диспетчер ресурсов кластера Service Fabric документа по [описанием вашего кластера ](service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="b8d13-217">For details on hello use of placement constraints, node properties, and how toodefine them, refer toohello section "Placement Constraints and Node Properties" in hello Service Fabric Cluster Resource Manager Document on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>
> 
> 

### <a name="capacity-metrics"></a><span data-ttu-id="b8d13-218">Метрики емкости</span><span class="sxs-lookup"><span data-stu-id="b8d13-218">Capacity metrics</span></span>
<span data-ttu-id="b8d13-219">Для каждого типа узла hello можно добавить пользовательские метрики емкости требуется toouse в tooreport нагрузки приложений.</span><span class="sxs-lookup"><span data-stu-id="b8d13-219">For each of hello node types, you can add custom capacity metrics that you want toouse in your applications tooreport load.</span></span> <span data-ttu-id="b8d13-220">Сведения о hello использования нагрузки tooreport метрики емкости см toohello диспетчер ресурсов кластера Service Fabric документы на [описанием ваш кластер](service-fabric-cluster-resource-manager-cluster-description.md) и [метрики и нагрузки](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="b8d13-220">For details on hello use of capacity metrics tooreport load, refer toohello Service Fabric Cluster Resource Manager Documents on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md) and [Metrics and Load](service-fabric-cluster-resource-manager-metrics.md).</span></span>

### <a name="fabric-upgrade-settings---health-polices"></a><span data-ttu-id="b8d13-221">Параметры обновления Service Fabric — политики работоспособности</span><span class="sxs-lookup"><span data-stu-id="b8d13-221">Fabric upgrade settings - Health polices</span></span>
<span data-ttu-id="b8d13-222">Вы можете указать пользовательские политики работоспособности для обновления Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="b8d13-222">You can specify custom health polices for fabric upgrade.</span></span> <span data-ttu-id="b8d13-223">Если ваш tooAutomatic кластера были установлены обновления структуры, эти политики получить примененных toohello этап 1 hello структуры автоматического обновления.</span><span class="sxs-lookup"><span data-stu-id="b8d13-223">If you have set your cluster tooAutomatic fabric upgrades, then these policies get applied toohello Phase-1 of hello automatic fabric upgrades.</span></span>
<span data-ttu-id="b8d13-224">Если установки кластера для структуры вручную обновления, а затем эти политики применяются каждый раз, выберите новую версию, активируя tookick системы hello off обновление fabric hello в кластере.</span><span class="sxs-lookup"><span data-stu-id="b8d13-224">If you have set your cluster for Manual fabric upgrades, then these policies get applied each time you select a new version triggering hello system tookick off hello fabric upgrade in your cluster.</span></span> <span data-ttu-id="b8d13-225">Если не переопределить политики hello, используются значения по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-225">If you do not override hello policies, hello defaults are used.</span></span>

<span data-ttu-id="b8d13-226">Можно указать политики работоспособности пользовательских hello или просмотрите текущие параметры hello в колонке «обновление fabric» hello, выбрав hello, дополнительные параметры обновления.</span><span class="sxs-lookup"><span data-stu-id="b8d13-226">You can specify hello custom health policies or review hello current settings under hello "fabric upgrade" blade, by selecting hello advanced upgrade settings.</span></span> <span data-ttu-id="b8d13-227">Просмотрите следующий рисунок по hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-227">Review hello following picture on how to.</span></span> 

![Управление пользовательскими политиками работоспособности][HealthPolices]

### <a name="customize-fabric-settings-for-your-cluster"></a><span data-ttu-id="b8d13-229">Настройка параметров Service Fabric для кластера</span><span class="sxs-lookup"><span data-stu-id="b8d13-229">Customize Fabric settings for your cluster</span></span>
<span data-ttu-id="b8d13-230">См. слишком[параметры структуры структуры кластера службы](service-fabric-cluster-fabric-settings.md) и как их настроить.</span><span class="sxs-lookup"><span data-stu-id="b8d13-230">Refer too[service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md) on what and how you can customize them.</span></span>

### <a name="os-patches-on-hello-vms-that-make-up-hello-cluster"></a><span data-ttu-id="b8d13-231">Исправлений ОС на виртуальные машины, входящие в состав кластера hello hello</span><span class="sxs-lookup"><span data-stu-id="b8d13-231">OS patches on hello VMs that make up hello cluster</span></span>
<span data-ttu-id="b8d13-232">См. слишком[приложения Orchestration исправление](service-fabric-patch-orchestration-application.md) которого можно развернуть на исправления tooinstall вашего кластера из центра обновления Windows направленные способом, хронометраж hello службы, доступные всем hello.</span><span class="sxs-lookup"><span data-stu-id="b8d13-232">Refer too[Patch Orchestration Application](service-fabric-patch-orchestration-application.md) which can be deployed on your cluster tooinstall patches from Windows Update in an orchestrated manner, keeping hello services available all hello time.</span></span> 

### <a name="os-upgrades-on-hello-vms-that-make-up-hello-cluster"></a><span data-ttu-id="b8d13-233">Обновления операционной системы на виртуальные машины, входящие в состав кластера hello hello</span><span class="sxs-lookup"><span data-stu-id="b8d13-233">OS upgrades on hello VMs that make up hello cluster</span></span>
<span data-ttu-id="b8d13-234">При обновлении hello образ ОС на виртуальных машинах hello hello кластера возможно только одна виртуальная машина одновременно.</span><span class="sxs-lookup"><span data-stu-id="b8d13-234">If you must upgrade hello OS image on hello virtual machines of hello cluster, you must do it one VM at a time.</span></span> <span data-ttu-id="b8d13-235">За это обновление отвечаете вы: в настоящее время автоматизация этой функции отсутствует.</span><span class="sxs-lookup"><span data-stu-id="b8d13-235">You are responsible for this upgrade--there is currently no automation for this.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b8d13-236">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b8d13-236">Next steps</span></span>
* <span data-ttu-id="b8d13-237">Узнайте, как toocustomize некоторые hello [структуры кластера структуры параметры службы](service-fabric-cluster-fabric-settings.md)</span><span class="sxs-lookup"><span data-stu-id="b8d13-237">Learn how toocustomize some of hello [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md)</span></span>
* <span data-ttu-id="b8d13-238">Узнайте, каким образом слишком[масштабирования кластера](service-fabric-cluster-scale-up-down.md)</span><span class="sxs-lookup"><span data-stu-id="b8d13-238">Learn how too[scale your cluster in and out](service-fabric-cluster-scale-up-down.md)</span></span>
* <span data-ttu-id="b8d13-239">Узнайте об [обновлениях приложений](service-fabric-application-upgrade.md)</span><span class="sxs-lookup"><span data-stu-id="b8d13-239">Learn about [application upgrades](service-fabric-application-upgrade.md)</span></span>

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade2.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes2.PNG
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png
[HealthPolices]: ./media/service-fabric-cluster-upgrade/Manage_AutomodeWadvSettings.PNG
[ARMUpgradeMode]: ./media/service-fabric-cluster-upgrade/ARMUpgradeMode.PNG
[Create_Manualmode]: ./media/service-fabric-cluster-upgrade/Create_Manualmode.PNG
[Manage_Automaticmode]: ./media/service-fabric-cluster-upgrade/Manage_Automaticmode.PNG
