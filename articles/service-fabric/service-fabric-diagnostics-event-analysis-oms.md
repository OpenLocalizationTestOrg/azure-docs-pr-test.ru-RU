---
title: "Анализ событий Azure Service Fabric с помощью OMS | Документы Майкрософт"
description: "Ознакомьтесь со сведениями о визуализации и анализе событий с использованием OMS для мониторинга и диагностики кластеров Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/26/2017
ms.author: dekapur
ms.openlocfilehash: f52988f2a67f2cafe93a7e0a358c599658d068b2
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="event-analysis-and-visualization-with-oms"></a>Анализ и визуализация событий с помощью OMS

Operations Management Suite (OMS) — это набор служб управления, которые помогают в мониторинге и диагностике приложений и служб, размещенных в облаке. Более подробные сведения о наборе OMS и его возможностях см. в статье [Что такое Operations Management Suite (OMS)?](../operations-management-suite/operations-management-suite-overview.md)

## <a name="log-analytics-and-the-oms-workspace"></a>Служба Log Analytics и рабочая область OMS

Служба Log Analytics собирает данные из управляемых ресурсов, включая таблицу или агент службы хранилища Azure, и сохраняет их в центральном репозитории. Эти данные далее могут использоваться для анализа, оповещения, визуализации или последующего экспорта. Log Analytics поддерживает события, данные производительности, а также любые иные пользовательские данные.

Если набор OMS настроен, вы получаете доступ к определенной *рабочей области OMS*, из которой данные можно запрашивать и визуализировать на панелях мониторинга.

После получения данных службой Log Analytics можно применять ряд *решений для управления* из состава набора OMS для отслеживания входящих данных. Эти решения оптимизированы для нескольких сценариев. К ним относятся *Аналитика Service Fabric* и *Контейнеры* — два наиболее важных решения для диагностики и мониторинга кластеров Service Fabric. Есть и другие решения, достойные рассмотрения. Кроме того, OMS позволяет создавать пользовательские решения, о чем можно больше узнать [здесь](../operations-management-suite/operations-management-suite-solutions.md). Каждое решение, которое вы выбираете для использования применительно к кластеру, настраивается в одной рабочей области OMS вместе с Log Analytics. Рабочие области обеспечивают использование пользовательских панелей мониторинга, визуализацию данных и изменение данных, которые необходимо собирать, обрабатывать и анализировать.

## <a name="setting-up-an-oms-workspace-with-the-service-fabric-solution"></a>Настройка рабочей области OMS с решением Service Fabric

Рекомендуется включить решение Service Fabric в рабочую область OMS, так как оно предоставляет полезную панель мониторинга, на которой показаны различные входящие каналы журналов от уровней платформы и приложений, а также возможность запрашивать данные из определенных журналов Service Fabric. Так выглядит сравнительно простое решение Service Fabric с одним приложением, развернутым в кластере:

![Решение OMS Service Fabric](media/service-fabric-diagnostics-event-analysis-oms/service-fabric-solution.png)

Существует два способа подготовки и настройки рабочей области OMS: с помощью шаблона Resource Manager или напрямую из Azure Marketplace. Первый способ применяется при развертывании кластера, а второй — при наличии развернутого кластера с включенной диагностикой.

### <a name="deploying-oms-using-a-resource-management-template"></a>Развертывание OMS с помощью шаблона Resource Management

Это действие производится на этапе создания кластера. При развертывании кластера с помощью шаблона Resource Manager шаблон может также создать рабочую область OMS, добавить в нее решение Service Fabric и настроить ее для чтения данных из соответствующих таблиц службы хранилища.

>[!NOTE]
>Для этого должна быть включена диагностика. Таким образом обеспечивается наличие таблиц службы хранилища Azure, из которых OMS и Log Analytics считывают данные.

[Здесь](https://azure.microsoft.com/resources/templates/service-fabric-oms/) можно найти пример шаблона, который выполняет описанные выше действия и который вы можете использовать и изменять согласно требованиям. Если вам нужна дополнительная гибкость, есть и другие шаблоны, которые предоставляют различные возможности в зависимости от этапа настройки рабочей области OMS. Их можно найти на странице [шаблонов Service Fabric и OMS](https://azure.microsoft.com/resources/templates/?term=service+fabric+OMS).

### <a name="deploying-oms-using-through-azure-marketplace"></a>Развертывание OMS посредством Azure Marketplace

Если вы предпочитаете добавить рабочую область OMS после развертывания кластера, перейдите в Azure Marketplace и выполните поиск по запросу *Аналитика Service Fabric*. В результатах должен быть только один ресурс в категории "Мониторинг и управление", который показан ниже:

![Аналитика Service Fabric OMS в Marketplace](media/service-fabric-diagnostics-event-analysis-oms/service-fabric-analytics.png)

При нажатии кнопки **Создать** появится запрос на указание рабочей области OMS. Щелкните **Выберите рабочую область**, а затем — **Создать рабочую область**. Укажите необходимые записи. Единственным требованием является совпадение подписки для кластера Service Fabric и рабочей области OMS. После проверки записей рабочая область OMS будет развернута через несколько минут. По завершении развертывания создание колонки решения Service Fabric останется открытым. Убедитесь в том, что в поле *Рабочая область OMS* указана та же рабочая область, и нажмите кнопку **Создать** внизу, чтобы добавить решение Service Fabric в рабочую область.

## <a name="using-the-oms-agent"></a>Использование агента OMS

В качестве решений для статистической обработки рекомендуется использовать EventFlow и WAD, так как они обеспечивают более модульный подход к диагностике и мониторингу. Например, если необходимо изменить выходные данные из EventFlow, изменение фактического инструментирования не потребуется. Нужно будет всего лишь внести небольшое изменение в файл конфигурации. Однако если вы решите инвестировать в использование набора OMS и захотите применять его для анализа событий (это необязательно должна быть единственная используемая платформа; более вероятно, что это будет одна из платформ), мы рекомендуем ознакомиться с настройкой [агента OMS](../log-analytics/log-analytics-windows-agents.md). При развертывании контейнеров в кластер используйте агент OMS, как описано ниже.

Соответствующий процесс сравнительно прост, так как необходимо всего лишь добавить агент в качестве расширения масштабируемого набора виртуальных машин в шаблон Resource Manager и установить его на каждом узле. Пример шаблона Resource Manager, развертывающего рабочую область OMS с решением Service Fabric (как описано выше) и добавляющего агент в узлы, можно найти для кластеров [Windows](https://github.com/ChackDan/Service-Fabric/tree/master/ARM%20Templates/SF%20OMS%20Samples/Windows) или [Linux](https://github.com/ChackDan/Service-Fabric/tree/master/ARM%20Templates/SF%20OMS%20Samples/Linux).

Ниже перечислены преимущества такого подхода.

* Более подробные данные счетчиков производительности и метрик.
* Простота настройки данных, собираемых из кластера, и внесение изменений в них без повторного развертывания приложений или кластера, так как изменение параметров агента может осуществляться из рабочей области OMS, причем агент сбрасывается автоматически. Чтобы настроить агент OMS для выбора конкретных счетчиков производительности, откройте рабочую область **Главная > Параметры > Данные > Счетчики производительности Windows** и выберите данные, которые следует собирать.
* Данные отображаются быстрее, чем при сохранении перед сбором OMS и службой Log Analytics.
* Отслеживать контейнеры гораздо проще, так как имеется возможность сбора журналов (stdout, stderror) и статистики (метрик производительности на уровнях контейнеров и узлов) для контейнеров Docker.

Основным фактором, который следует учитывать, является то, что агент развертывается в кластере вместе с приложениями, что немного сказывается на их производительности.

## <a name="monitoring-containers"></a>Отслеживание контейнеров

При развертывании контейнеров в кластере Service Fabric рекомендуется установить в кластере агент OMS и добавить решение "Контейнеры" в рабочую область OMS, чтобы обеспечить мониторинг и диагностику. Вот как выглядит решение "Контейнеры" в рабочей области:

![Основная панель мониторинга OMS](./media/service-fabric-diagnostics-event-analysis-oms/oms-containers-dashboard.png)

Агент обеспечивает сбор нескольких журналов, относящихся к контейнерам, которые могут запрашиваться в OMS или использоваться для визуализации показателей эффективности. Собираются следующие типы журналов.

* ContainerInventory — отображает информацию о местонахождении контейнера, имени и образах.
* ContainerImageInventory — информация о развернутых образах, в том числе их идентификаторы или размеры.
* ContainerLog — журналы конкретных ошибок, журналы Docker (StdOut и т. д.) и другие записи.
* ContainerServiceLog — выполнявшиеся команды управляющей программы Docker.
* Perf — счетчики производительности контейнера, в том числе ЦП, память, сетевой трафик, операции ввода и вывода на диске и пользовательские метрики с компьютеров узла.

В этой статье рассматриваются шаги, необходимые для настройки мониторинга контейнера в кластере. Дополнительные сведения о решении OMS "Контейнеры" см. в [документации](../log-analytics/log-analytics-containers.md) по решению.

Чтобы настроить решение "Контейнеры" в рабочей области, необходимо развернуть агент OMS в узлах кластера, выполнив описанные выше действия. Когда кластер будет готов, разверните в нем контейнер. Не забывайте, что при первом запуске образ контейнера развертывается в кластер. Скачивание образа занимает несколько минут (в зависимости от его размера).

В Azure Marketplace найдите *Решение мониторинга контейнеров* и создайте требуемый результат **решения мониторинга контейнеров** в категории "Мониторинг и управление".

![Добавление решения "Контейнеры"](./media/service-fabric-diagnostics-event-analysis-oms/containers-solution.png)

На этапе создания решение запрашивает рабочую область OMS. Выберите рабочую область, которую вы создали во время развертывания. На этом шаге решение "Контейнеры" добавляется в рабочую область OMS и автоматически определяется агентом OMS, который развернут с помощью шаблона. Агент начнет сбор данных по процессам контейнеров в кластере, и менее чем через 15 минут вы увидите, что в решении появились данные, как показано на изображении панели мониторинга выше.


## <a name="next-steps"></a>Дальнейшие действия

Изучите перечисленные ниже средства и параметры OMS, чтобы настроить рабочую область в соответствии с вашими потребностями.

* Для локальных кластеров OMS предлагает шлюз (прокси-сервер переадресации HTTP), который можно использовать для отправки данных в OMS. Дополнительные сведения см. в разделе [Подключения компьютеров к OMS с помощью шлюза OMS без доступа к Интернету](../log-analytics/log-analytics-oms-gateway.md).
* Настройте OMS, чтобы настроить [автоматические оповещения](../log-analytics/log-analytics-alerts.md), которые помогают выполнять обнаружение и диагностику.
* Ознакомьтесь с функциями [поиска по журналам и запросов к журналам](../log-analytics/log-analytics-log-searches.md), которые являются частью решения Log Analytics.