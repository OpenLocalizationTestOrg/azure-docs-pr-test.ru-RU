---
title: "aaaService диспетчер ресурсов кластера структуры - сходства | Документы Microsoft"
description: "Общие сведения о настройке сходства для служб Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 678073e1-d08d-46c4-a811-826e70aba6c4
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 7dc9b6d9c18d9d615d39cff7de9d7cba1c040474
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="configuring-and-using-service-affinity-in-service-fabric"></a>Настройка и использование сходства служб в Service Fabric
Сопоставление — это элемент управления, предоставленные главным образом toohelp простота hello, передача больших монолитные приложений в облаке и микрослужбами Здравствуй, мир. Он также используется для оптимизации по улучшению производительности hello служб, несмотря на то, что это может иметь побочные эффекты.

Предположим, что перевод приложение большего размера или пакет, который просто не было разработано с микрослужбами в виду, tooService структуры (или любой распределенной среде). Это вполне распространенный сценарий перехода. Начинается с устранением всего приложения hello в среду hello, упаковки и убедиться, что его бесперебойной. Затем вы запустите разбить его на разных служб меньшего размера, что все говорить tooeach других.

Со временем может оказаться, что приложение hello возникают некоторые проблемы. Hello проблемы обычно относятся к одной из этих категорий:

1. Компонент X монолитные приложение hello имел зависимость недокументированные компонента Y, и только вы включили этих компонентов по отдельным службам. Поскольку теперь эти службы работают на разных узлах в кластере hello, они работают.
2. Эти компоненты взаимодействуют через (локальные именованные каналы | общей памяти | файлы на диске) и действительно нужен toobe может toowrite tooa общих локальных ресурсов для повышения производительности в данный момент. Возможно, позже эта жесткая зависимость будет устранена.
3. Все работает, но оказывается, что эти два компонента выдают слишком много данных или слишком чувствительны к уровню производительности. С их переносом в отдельные службы общая производительность приложения резко упала или увеличилась задержка. В результате hello всего приложения, не отвечают требованиям.

В таких случаях мы не требуется toolose нашей работе рефакторинга и не хотите монолита toogo toohello назад. Hello последнего условия даже могут требоваться plain в целях оптимизации. Тем не менее пока мы естественным образом переработки hello компонентов toowork как службы (или пока мы можем решить ожидаемой производительности hello иным способом) мы будем tooneed некоторое ощущение местоположению.

Какие toodo? Попробуйте включить сходство.

## <a name="how-tooconfigure-affinity"></a>Как tooconfigure сходства
tooset копирование affinity определить связь между двумя различными службами. Это все равно, что указать одной службе на другую и сказать: "Эта служба может работать только тогда, когда та служба работает". Иногда мы называем tooaffinity иерархическое отношение, (где вы указываете дочерних hello в родительской hello). Сопоставление гарантирует, что реплики hello или экземпляры одной службы размещаются на hello же узлы, у другой службы.

```csharp
ServiceCorrelationDescription affinityDescription = new ServiceCorrelationDescription();
affinityDescription.Scheme = ServiceCorrelationScheme.Affinity;
affinityDescription.ServiceName = new Uri("fabric:/otherApplication/parentService");
serviceDescription.Correlations.Add(affinityDescription);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

> [!NOTE]
> Дочерняя служба может участвовать только в одном отношении сходства. При желании hello дочерних toobe родственных tootwo родительской службы за один раз у вас есть несколько вариантов:
> - Обратной связи hello (имеют parentService1 и parentService2 точки hello текущей дочерние службы), или
> - Сделать одним из родительских элементов hello концентратор по соглашению и иметь точки этой службы все службы. 
>
> Привет, возникающие в режима работы размещения в кластере hello следует hello же.
>

## <a name="different-affinity-options"></a>Различные параметры сходства
Сопоставление представляет одна из нескольких возможных схем корреляции, которая имеет два различных режима. наиболее распространенные режим Hello сходства —, называемый NonAlignedAffinity. В NonAlignedAffinity, hello реплики или экземпляры hello различных служб, помещаются в hello же узлы. Hello другой режим — AlignedAffinity. Он применяется только для служб с отслеживанием состояния. Настройка сопоставления toohave выравниваются службы гарантирует, что hello в источниках этих служб размещаются на два с отслеживанием состояния hello разным узлам в другом. Она вызывает каждая пара баз данных-получателей для этих служб toobe обмена hello же узлы. Это также возможно (хотя реже) tooconfigure NonAlignedAffinity для служб с отслеживанием состояния. Для NonAlignedAffinity разным узлам hello hello разных реплик hello, который будет выполняться две службы с отслеживанием состояния, но их в источниках могут помещаться на разных узлах.

<center>
![Режимы сопоставления и их воздействие][Image1]
</center>

### <a name="best-effort-desired-state"></a>Требуемое состояние не гарантируется
Отношение сходства является не гарантируется. Он не предоставляет hello же гарантии выровненное размещение или надежности, работающих в hello выполняет же исполняемый процесс. службы Hello в отношении сходства — существенно различается сущности, которые может завершиться ошибкой, поэтому перемещать их независимо друг от друга. Отношение сходства также может нарушаться, хотя и временно. Например ограничения емкости может означать только некоторые из объектов службы hello в связь hello помещается на заданном узле. В таких случаях несмотря на то, что выполняется связь, он не может быть применена из-за toohello другими ограничениями. Если это возможно toodo таким образом, нарушение hello, автоматически исправляется позже.

### <a name="chains-vs-stars"></a>Цепочки и звезды
Сегодня hello диспетчер ресурсов кластера не может toomodel последовательности сходство связей. Это означает, что служба, которая является дочерней в одном отношении сопоставления, не может быть родительской в другом. Если требуется toomodel этот тип связи, в результате имеют toomodel его как звездочку, а не в цепочку. toomove из звезда цепочки tooa, нижних дочерних hello вместо этого будет порождены toohello первый дочерний родительский. В зависимости от упорядочения hello служб возможно toodo это несколько раз. Если служба не естественным родительским, возможно, toocreate, служит в качестве заполнителя. В зависимости от требований, можно также toolook в [групп приложений](service-fabric-cluster-resource-manager-application-groups.md).

<center>
![Цепочки и Звезды в контексте сходство связей hello][Image2]
</center>

Другой toonote вещь о сходство связей на сегодняшний день является, они являются направленными. Это означает, что это правило территориальной hello применяет только что hello дочерние размещается а родительского hello. Он не убедитесь, что родительской hello находится с дочерним hello. Также важно toonote, hello связь не может быть модель идеально подходит или мгновенно установлено принудительно, поскольку разных служб с разных жизненные циклы и может завершиться ошибкой и переместить независимо друг от друга. Например предположим, что родительский hello внезапно при сбое узла tooanother, так как произошел сбой. Hello диспетчер ресурсов кластера и диспетчера отказоустойчивости дескриптор hello отработки отказа во-первых, так как в настоящий момент служб hello, согласованное и доступных hello приоритет. После завершения отработки отказа hello hello сходства связь нарушена, но диспетчер ресурсов кластера полагает, что все прекрасно, пока он замечает, что дочерние hello приветствия не расположен hello родительского элемента. Такие проверки выполняются периодически. Дополнительные сведения о как hello диспетчер ресурсов кластера вычисляет ограничения недоступны в [в этой статье](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), и [этого класса,](service-fabric-cluster-resource-manager-balancing.md) Подробнее о как tooconfigure hello периодичностью, на котором эти ограничения, Оценка.   


### <a name="partitioning-support"></a>Поддержка секционирования
Hello заключительную toonotice о сопоставлении — что сходство связей не поддерживаются, где секционируется родительского hello. Возможно, со временем секционированные родительские службы будут поддерживаться, но на данный момент эта возможность отсутствует.

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о настройке служб см. в разделе [Настройка параметров Cluster Resource Manager для служб Service Fabric](service-fabric-cluster-resource-manager-configure-services.md).
- toolimit служб tooa небольшой набор компьютеров или статистической обработки нагрузки hello служб, используйте [групп приложений](service-fabric-cluster-resource-manager-application-groups.md)

[Image1]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resrouce-manager-affinity-modes.png
[Image2]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resource-manager-chains-vs-stars.png