---
title: "aaaGuidelines & рекомендации для надежного коллекций в Azure Service Fabric | Документы Microsoft"
description: "Правила и рекомендации по использованию надежных коллекций Service Fabric"
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: bcdbc9d013bc044e06c43761e7f515c7e4bf340c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a>Инструкции и рекомендации для надежных коллекций в Azure Service Fabric
В этом разделе приведены инструкции по использованию надежных коллекций и диспетчера надежных состояний. Цель Hello — пользователи toohelp избежать распространенных ошибок.

Hello правила организованы в виде простым рекомендациям, префикс hello условия *сделать*, *попробуйте*, *Избегайте* и *не*.

* Не изменяйте объекты пользовательского типа, возвращаемые операциями чтения (например, `TryPeekAsync` или `TryGetValueAsync`). Надежные коллекций, как параллельных коллекций возвращают toohello ссылаться на объекты, а не на копию.
* Сделать глубокую копию hello, возвращенный объект пользовательского типа, перед внесением изменений. Поскольку структур и встроенные типы передачи по значению, toodo глубокой копией на них не обязательно.
* Не используйте `TimeSpan.MaxValue` для времени ожидания. Время ожидания должно быть используется toodetect взаимоблокировок.
* Не используйте транзакцию после того, как она была зафиксирована, прервана или удалена.
* Не следует использовать перечисление за пределами области транзакции hello, которой он был создан.
* Не создавайте транзакцию в операторе `using` другой транзакции, так как это может привести к возникновению взаимоблокировки.
* Убедитесь, что реализация `IComparable<TKey>` правильна. Hello система не выполняет зависимостей `IComparable<TKey>` для слияния контрольных точек и строк.
* Использовать блокировки обновления, при чтении элемента с намерением tooupdate его tooprevent класс взаимоблокировок.
* Ниже 80 КБ, рассмотрите возможность сохранения элементов (например, TKey + TValue для надежного словаря): лучше меньшего размера hello. Это уменьшает объем hello кучи для массивных объектов использования, а также дисковых и сетевых операций ввода-ВЫВОДА. Часто это уменьшает репликации повторяющиеся данные, когда обновляется только один небольшую часть значение hello. Общий способ tooachieve надежного словаря это toobreak строк в toomultiple строк.
* Рассмотрите возможность использования резервного копирования и восстановления функциональности toohave аварийного восстановления.
* Использовать одну сущность операции и операции с несколькими сущностями (например `GetCountAsync`, `CreateEnumerableAsync`) в hello одной транзакции из-за toohello различных уровней изоляции.
* Обработайте исключение InvalidOperationException. Пользовательские транзакции может быть прервана системой hello по ряду причин. Например при изменении его роль из источника hello надежного диспетчер состояния или если долго выполняющаяся транзакция блокирует усечение журнала транзакций hello. В таких случаях пользователь может получить исключение InvalidOperationException, указывающее на то, что его транзакция уже завершена. При условии, что, hello завершение транзакции hello не был запрошен пользователем hello, лучшим способом toohandle это исключение является toodispose hello транзакции, проверьте: возможно, было сообщено hello токен отмены (или была изменена роль hello hello реплики) и в случае необходимости Создайте новую транзакцию и повторите попытку.  

Ниже приведены некоторые вещи tookeep в виду.

* время ожидания по умолчанию Hello — четыре секунды для всех hello надежные API-интерфейсов коллекции. Большинству пользователей следует использовать время ожидания по умолчанию hello.
* Hello токен отмены по умолчанию — `CancellationToken.None` в все надежные API-интерфейсы коллекций.
* Здравствуйте, параметр типа ключа (*TKey*) для надежной словаря должны правильно реализовывать `GetHashCode()` и `Equals()`. Ключи должны быть неизменяемыми.
* tooachieve высокого уровня доступности для hello надежного коллекций каждой службы и должны быть по крайней мере целевой минимальный размер 3 реплику.
* Операций чтения на вторичных hello может считывать версии, которые не зафиксированы кворума.
  Это означает, что версия данных, считываемая из отдельной базы данных-получателя, может быть ложно увеличена.
  Чтение из базы данных-источника всегда стабильно и не может вызывать ложное увеличение номера версии.

### <a name="next-steps"></a>Дальнейшие действия
* [Работа с Reliable Collections](service-fabric-work-with-reliable-collections.md)
* [Транзакции и блокировки](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [Внутренние компоненты Reliable State Manager и Reliable Collections](service-fabric-reliable-services-reliable-collections-internals.md)
* Управление данными
  * [Резервное копирование и восстановление](service-fabric-reliable-services-backup-restore.md)
  * [Notifications](service-fabric-reliable-services-notifications.md)
  * [Влияние сериализации данных на обновление приложений](service-fabric-application-upgrade-data-serialization.md)
  * [Конфигурация диспетчера надежных состояний](service-fabric-reliable-services-configuration.md)
* Прочее
  * [Краткое руководство по надежным службам Reliable Services](service-fabric-reliable-services-quick-start.md)
  * [Справочник разработчика по надежным коллекциям](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)
