---
title: "aaaGuidelines & рекомендации для надежного коллекций в Azure Service Fabric | Документы Microsoft"
description: "Правила и рекомендации по использованию надежных коллекций Service Fabric"
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: bcdbc9d013bc044e06c43761e7f515c7e4bf340c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="a21b6-103">Инструкции и рекомендации для надежных коллекций в Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="a21b6-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="a21b6-104">В этом разделе приведены инструкции по использованию надежных коллекций и диспетчера надежных состояний.</span><span class="sxs-lookup"><span data-stu-id="a21b6-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="a21b6-105">Цель Hello — пользователи toohelp избежать распространенных ошибок.</span><span class="sxs-lookup"><span data-stu-id="a21b6-105">hello goal is toohelp users avoid common pitfalls.</span></span>

<span data-ttu-id="a21b6-106">Hello правила организованы в виде простым рекомендациям, префикс hello условия *сделать*, *попробуйте*, *Избегайте* и *не*.</span><span class="sxs-lookup"><span data-stu-id="a21b6-106">hello guidelines are organized as simple recommendations prefixed with hello terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="a21b6-107">Не изменяйте объекты пользовательского типа, возвращаемые операциями чтения (например, `TryPeekAsync` или `TryGetValueAsync`).</span><span class="sxs-lookup"><span data-stu-id="a21b6-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="a21b6-108">Надежные коллекций, как параллельных коллекций возвращают toohello ссылаться на объекты, а не на копию.</span><span class="sxs-lookup"><span data-stu-id="a21b6-108">Reliable Collections, just like Concurrent Collections, return a reference toohello objects and not a copy.</span></span>
* <span data-ttu-id="a21b6-109">Сделать глубокую копию hello, возвращенный объект пользовательского типа, перед внесением изменений.</span><span class="sxs-lookup"><span data-stu-id="a21b6-109">Do deep copy hello returned object of a custom type before modifying it.</span></span> <span data-ttu-id="a21b6-110">Поскольку структур и встроенные типы передачи по значению, toodo глубокой копией на них не обязательно.</span><span class="sxs-lookup"><span data-stu-id="a21b6-110">Since structs and built-in types are pass-by-value, you do not need toodo a deep copy on them.</span></span>
* <span data-ttu-id="a21b6-111">Не используйте `TimeSpan.MaxValue` для времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="a21b6-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="a21b6-112">Время ожидания должно быть используется toodetect взаимоблокировок.</span><span class="sxs-lookup"><span data-stu-id="a21b6-112">Time-outs should be used toodetect deadlocks.</span></span>
* <span data-ttu-id="a21b6-113">Не используйте транзакцию после того, как она была зафиксирована, прервана или удалена.</span><span class="sxs-lookup"><span data-stu-id="a21b6-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="a21b6-114">Не следует использовать перечисление за пределами области транзакции hello, которой он был создан.</span><span class="sxs-lookup"><span data-stu-id="a21b6-114">Do not use an enumeration outside of hello transaction scope it was created in.</span></span>
* <span data-ttu-id="a21b6-115">Не создавайте транзакцию в операторе `using` другой транзакции, так как это может привести к возникновению взаимоблокировки.</span><span class="sxs-lookup"><span data-stu-id="a21b6-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="a21b6-116">Убедитесь, что реализация `IComparable<TKey>` правильна.</span><span class="sxs-lookup"><span data-stu-id="a21b6-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="a21b6-117">Hello система не выполняет зависимостей `IComparable<TKey>` для слияния контрольных точек и строк.</span><span class="sxs-lookup"><span data-stu-id="a21b6-117">hello system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="a21b6-118">Использовать блокировки обновления, при чтении элемента с намерением tooupdate его tooprevent класс взаимоблокировок.</span><span class="sxs-lookup"><span data-stu-id="a21b6-118">Do use Update lock when reading an item with an intention tooupdate it tooprevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="a21b6-119">Ниже 80 КБ, рассмотрите возможность сохранения элементов (например, TKey + TValue для надежного словаря): лучше меньшего размера hello.</span><span class="sxs-lookup"><span data-stu-id="a21b6-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller hello better.</span></span> <span data-ttu-id="a21b6-120">Это уменьшает объем hello кучи для массивных объектов использования, а также дисковых и сетевых операций ввода-ВЫВОДА.</span><span class="sxs-lookup"><span data-stu-id="a21b6-120">This reduces hello amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="a21b6-121">Часто это уменьшает репликации повторяющиеся данные, когда обновляется только один небольшую часть значение hello.</span><span class="sxs-lookup"><span data-stu-id="a21b6-121">Often, it reduces replicating duplicate data when only one small part of hello value is being updated.</span></span> <span data-ttu-id="a21b6-122">Общий способ tooachieve надежного словаря это toobreak строк в toomultiple строк.</span><span class="sxs-lookup"><span data-stu-id="a21b6-122">Common way tooachieve this in Reliable Dictionary, is toobreak your rows in toomultiple rows.</span></span>
* <span data-ttu-id="a21b6-123">Рассмотрите возможность использования резервного копирования и восстановления функциональности toohave аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="a21b6-123">Consider using backup and restore functionality toohave disaster recovery.</span></span>
* <span data-ttu-id="a21b6-124">Использовать одну сущность операции и операции с несколькими сущностями (например `GetCountAsync`, `CreateEnumerableAsync`) в hello одной транзакции из-за toohello различных уровней изоляции.</span><span class="sxs-lookup"><span data-stu-id="a21b6-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in hello same transaction due toohello different isolation levels.</span></span>
* <span data-ttu-id="a21b6-125">Обработайте исключение InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="a21b6-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="a21b6-126">Пользовательские транзакции может быть прервана системой hello по ряду причин.</span><span class="sxs-lookup"><span data-stu-id="a21b6-126">User transactions can be aborted by hello system for variety of reasons.</span></span> <span data-ttu-id="a21b6-127">Например при изменении его роль из источника hello надежного диспетчер состояния или если долго выполняющаяся транзакция блокирует усечение журнала транзакций hello.</span><span class="sxs-lookup"><span data-stu-id="a21b6-127">For example, when hello Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of hello transactional log.</span></span> <span data-ttu-id="a21b6-128">В таких случаях пользователь может получить исключение InvalidOperationException, указывающее на то, что его транзакция уже завершена.</span><span class="sxs-lookup"><span data-stu-id="a21b6-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="a21b6-129">При условии, что, hello завершение транзакции hello не был запрошен пользователем hello, лучшим способом toohandle это исключение является toodispose hello транзакции, проверьте: возможно, было сообщено hello токен отмены (или была изменена роль hello hello реплики) и в случае необходимости Создайте новую транзакцию и повторите попытку.</span><span class="sxs-lookup"><span data-stu-id="a21b6-129">Assuming, hello termination of hello transaction was not requested by hello user, best way toohandle this exception is toodispose hello transaction, check if hello cancellation token has been signaled (or hello role of hello replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="a21b6-130">Ниже приведены некоторые вещи tookeep в виду.</span><span class="sxs-lookup"><span data-stu-id="a21b6-130">Here are some things tookeep in mind:</span></span>

* <span data-ttu-id="a21b6-131">время ожидания по умолчанию Hello — четыре секунды для всех hello надежные API-интерфейсов коллекции.</span><span class="sxs-lookup"><span data-stu-id="a21b6-131">hello default time-out is four seconds for all hello Reliable Collection APIs.</span></span> <span data-ttu-id="a21b6-132">Большинству пользователей следует использовать время ожидания по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="a21b6-132">Most users should use hello default time-out.</span></span>
* <span data-ttu-id="a21b6-133">Hello токен отмены по умолчанию — `CancellationToken.None` в все надежные API-интерфейсы коллекций.</span><span class="sxs-lookup"><span data-stu-id="a21b6-133">hello default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="a21b6-134">Здравствуйте, параметр типа ключа (*TKey*) для надежной словаря должны правильно реализовывать `GetHashCode()` и `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="a21b6-134">hello key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="a21b6-135">Ключи должны быть неизменяемыми.</span><span class="sxs-lookup"><span data-stu-id="a21b6-135">Keys must be immutable.</span></span>
* <span data-ttu-id="a21b6-136">tooachieve высокого уровня доступности для hello надежного коллекций каждой службы и должны быть по крайней мере целевой минимальный размер 3 реплику.</span><span class="sxs-lookup"><span data-stu-id="a21b6-136">tooachieve high availability for hello Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="a21b6-137">Операций чтения на вторичных hello может считывать версии, которые не зафиксированы кворума.</span><span class="sxs-lookup"><span data-stu-id="a21b6-137">Read operations on hello secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="a21b6-138">Это означает, что версия данных, считываемая из отдельной базы данных-получателя, может быть ложно увеличена.</span><span class="sxs-lookup"><span data-stu-id="a21b6-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="a21b6-139">Чтение из базы данных-источника всегда стабильно и не может вызывать ложное увеличение номера версии.</span><span class="sxs-lookup"><span data-stu-id="a21b6-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="a21b6-140">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a21b6-140">Next steps</span></span>
* [<span data-ttu-id="a21b6-141">Работа с Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="a21b6-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="a21b6-142">Транзакции и блокировки</span><span class="sxs-lookup"><span data-stu-id="a21b6-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="a21b6-143">Внутренние компоненты Reliable State Manager и Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="a21b6-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="a21b6-144">Управление данными</span><span class="sxs-lookup"><span data-stu-id="a21b6-144">Managing Data</span></span>
  * [<span data-ttu-id="a21b6-145">Резервное копирование и восстановление</span><span class="sxs-lookup"><span data-stu-id="a21b6-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="a21b6-146">Notifications</span><span class="sxs-lookup"><span data-stu-id="a21b6-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="a21b6-147">Влияние сериализации данных на обновление приложений</span><span class="sxs-lookup"><span data-stu-id="a21b6-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="a21b6-148">Конфигурация диспетчера надежных состояний</span><span class="sxs-lookup"><span data-stu-id="a21b6-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="a21b6-149">Прочее</span><span class="sxs-lookup"><span data-stu-id="a21b6-149">Others</span></span>
  * [<span data-ttu-id="a21b6-150">Краткое руководство по надежным службам Reliable Services</span><span class="sxs-lookup"><span data-stu-id="a21b6-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="a21b6-151">Справочник разработчика по надежным коллекциям</span><span class="sxs-lookup"><span data-stu-id="a21b6-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)
