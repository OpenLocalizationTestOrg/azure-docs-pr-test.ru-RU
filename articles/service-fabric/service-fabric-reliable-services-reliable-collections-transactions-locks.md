---
title: "aaaTransactions и режимов блокировки в Azure Service Fabric надежного коллекций | Документы Microsoft"
description: "Транзакции и блокировка диспетчера надежных состояний и надежных коллекций Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 340e029aa98f43ad6e46b48f687dad01f9d96f69
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a>Транзакции и режимы блокировки в надежных коллекциях Azure Service Fabric

## <a name="transaction"></a>транзакция:
Транзакция — это последовательность операций, выполняемых в одной логической единице работы.
Транзакция должна обладать следующими свойствами ACID hello. (см.: https://technet.microsoft.com/en-us/library/ms190612).
* **Атомарность**. Транзакция должна быть атомарной единицей работы. Другими словами, должны выполняться либо все ее изменения данных, либо ни одно из них.
* **Согласованность**. По завершении транзакция должна оставить все данные в согласованном состоянии. Все внутренние структуры данных должны быть правильными в конце hello hello транзакции.
* **Изоляция**: изменения, произведенные в параллельных транзакций должны быть изолированы от hello изменения, сделанные другими параллельно выполняемыми транзакциями. Hello уровня изоляции, используемого для операции в пределах ITransaction определяется hello IReliableState выполнение операции hello.
* **Устойчивость**: после завершения транзакции, его влияние занимают постоянное место в системе hello. Hello изменения сохраняются даже в случае hello сбоя системы.

### <a name="isolation-levels"></a>Уровни изоляции
Уровень изоляции определяет степень hello toowhich hello транзакция должна быть изолирована от изменений, внесенных другими транзакциями.
Надежные коллекции поддерживают два уровня изоляции:

* **REPEATABLE Read**: Указывает, что инструкции не могут считывать данные, которые были изменены, но еще не зафиксированы другими транзакциями, и что другие транзакции не могут изменять данные, считанные текущей транзакцией hello до текущего hello Завершает транзакцию. Дополнительные сведения см. в статье [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).
* **Моментальный снимок**: Указывает, что данные, считанные любой инструкцией транзакции является транзакционно согласованной версии hello hello данных, существовавших в начале hello hello транзакции.
  Hello транзакция распознает только те изменения данных, которые были зафиксированы до начала hello hello транзакции.
  Изменения данных, произведенных другими транзакциями после начала текущей транзакции hello hello не являются видимыми toostatements выполнения текущей транзакции hello.
  Hello действует, как если бы hello получения инструкциями в транзакции моментального снимка зафиксированных hello данных они имели на момент начала hello hello транзакции.
  Моментальные снимки согласованы между надежными коллекциями.
  Дополнительные сведения см. в статье [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).

Надежные коллекции автоматически выбираться hello toouse уровня изоляции для данной операции чтения в зависимости от операции hello и роль hello hello реплики во время hello создания транзакции.
Ниже приведен hello таблицы, которая описывает изоляции значения по умолчанию уровне словаря надежного и очередь операций.

| Операция \ Роль | Первичная | Вторичная |
| --- |:--- |:--- |
| Операция чтения одной сущности |Повторяющаяся операция чтения |Снимок |
| Перечисление, подсчет |Снимок |Снимок |

> [!NOTE]
> Распространенные примеры операций с одной сущностью: `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.
> 

Hello надежного словаря и hello надежные очереди поддерживает ваш записывает чтения.
Другими словами, любой записи в транзакции видны tooa следующие читается, принадлежит toohello одной транзакции.

## <a name="locks"></a>Блокировки
В списке надежных коллекции всех транзакций реализуйте строгие двухфазной блокировки: hello блокировки, он получил до завершения транзакции hello прерывания или фиксации транзакции не освобождает.

Надежный словарь использует блокировку уровня строки для всех операций с одной сущностью.
Надежная очередь поступается параллелизмом ради строгого соблюдения транзакционного свойства FIFO.
Надежная очередь использует блокировки уровня операции, позволяя одновременно выполнять одну транзакцию с `TryPeekAsync` и (или) `TryDequeueAsync` и одну транзакцию с `EnqueueAsync`.
Обратите внимание на то что toopreserve FIFO, если `TryPeekAsync` или `TryDequeueAsync` когда-либо обнаруживает, что hello надежного очередь пуста, также блокируется `EnqueueAsync`.

Операции записи всегда используют монопольные блокировки.
Для операций чтения hello блокировки зависит от ряд факторов.
В операциях чтения, выполняемых с уровнем изоляции "Снимок", блокировки не используются.
В повторяющихся операциях чтения используются совмещаемые блокировки (по умолчанию).
Однако для любой операции чтения, поддерживающем Repeatable Read, hello пользователь может запросить для блокировки обновления вместо hello совмещаемой блокировки.
Блокировка обновления — блокировки асимметричного используемых tooprevent распространенной формы взаимоблокировки, которая возникает, когда несколько транзакции блокируют ресурсы для потенциальных обновления на более позднее время.

Матрица совместимости блокировок Hello можно найти в следующей таблице hello:

| Запрос \ Предоставлено | Без блокировки | Совмещаемая блокировка | Блокировка изменений | Монопольная блокировка |
| --- |:--- |:--- |:--- |:--- |
| Совмещаемая блокировка |Нет конфликтов |Нет конфликтов |Конфликт |Конфликт |
| Блокировка изменений |Нет конфликтов |Нет конфликтов |Конфликт |Конфликт |
| Монопольная блокировка |Нет конфликтов |Конфликт |Конфликт |Конфликт |

Аргумент тайм-аута в hello надежные API-интерфейсы коллекций используется для обнаружения взаимоблокировок.
Например две транзакции (T1 и T2) пытаетесь tooread и обновите K1.
Существует возможность их toodeadlock, так как они в конечном итоге Здравствуйте, имеющих общие блокировки.
В этом случае одного или нескольких операций hello выдаст ошибку времени ожидания.

Ситуация с взаимоблокировкой является хорошим примером того, как блокировка изменений может предотвратить возникновение взаимоблокировки.

## <a name="next-steps"></a>Дальнейшие действия
* [Работа с Reliable Collections](service-fabric-work-with-reliable-collections.md)
* [Уведомления Reliable Services](service-fabric-reliable-services-notifications.md)
* [Архивация и восстановление (аварийное восстановление) надежных служб](service-fabric-reliable-services-backup-restore.md)
* [Конфигурация диспетчера надежных состояний](service-fabric-reliable-services-configuration.md)
* [Справочник разработчика по надежным коллекциям](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

