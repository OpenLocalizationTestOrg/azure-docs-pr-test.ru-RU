---
title: "Архитектура диспетчера ресурсов | Документация Майкрософт"
description: "Общие сведения об архитектуре диспетчера кластерных ресурсов Service Fabric."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 6c4421f9-834b-450c-939f-1cb4ff456b9b
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 565c20637fa93ed92bb6c52e585a4b70bdeb6f8c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="cluster-resource-manager-architecture-overview"></a><span data-ttu-id="9fccf-103">Общие сведения об архитектуре диспетчера кластерных ресурсов</span><span class="sxs-lookup"><span data-stu-id="9fccf-103">Cluster resource manager architecture overview</span></span>
<span data-ttu-id="9fccf-104">Диспетчер кластерных ресурсов Service Fabric — это центральная служба, которая работает в кластере.</span><span class="sxs-lookup"><span data-stu-id="9fccf-104">The Service Fabric Cluster Resource Manager is a central service that runs in the cluster.</span></span> <span data-ttu-id="9fccf-105">Он управляет требуемым состоянием служб в кластере, в частности потреблением ресурсов и правилами размещения.</span><span class="sxs-lookup"><span data-stu-id="9fccf-105">It manages the desired state of the services in the cluster, particularly with respect to resource consumption and any placement rules.</span></span> 

<span data-ttu-id="9fccf-106">Для управления ресурсами в кластере диспетчеру кластерных ресурсов Service Fabric нужна определенная информация:</span><span class="sxs-lookup"><span data-stu-id="9fccf-106">To manage the resources in your cluster, the Service Fabric Cluster Resource Manager must have several pieces of information:</span></span>

- <span data-ttu-id="9fccf-107">какие службы в настоящее время существуют;</span><span class="sxs-lookup"><span data-stu-id="9fccf-107">Which services currently exist</span></span>
- <span data-ttu-id="9fccf-108">текущее (или стандартное) потребление ресурсов каждой службой;</span><span class="sxs-lookup"><span data-stu-id="9fccf-108">Each service's current (or default) resource consumption</span></span> 
- <span data-ttu-id="9fccf-109">оставшаяся емкость кластера;</span><span class="sxs-lookup"><span data-stu-id="9fccf-109">The remaining cluster capacity</span></span> 
- <span data-ttu-id="9fccf-110">емкость узлов в кластере;</span><span class="sxs-lookup"><span data-stu-id="9fccf-110">The capacity of the nodes in the cluster</span></span> 
- <span data-ttu-id="9fccf-111">объем ресурсов, потребляемых на каждом узле.</span><span class="sxs-lookup"><span data-stu-id="9fccf-111">The amount of resources consumed on each node</span></span>

<span data-ttu-id="9fccf-112">В разное время одна и та же служба может использовать разный объем ресурсов, при этом службы обычно зависят от нескольких типов ресурсов.</span><span class="sxs-lookup"><span data-stu-id="9fccf-112">The resource consumption of a given service can change over time, and services usually care about more than one type of resource.</span></span> <span data-ttu-id="9fccf-113">В разных службах могут учитываться как реальные физические, так и логические ресурсы.</span><span class="sxs-lookup"><span data-stu-id="9fccf-113">Across different services, there may be both real physical and physical resources being measured.</span></span> <span data-ttu-id="9fccf-114">Например, службы контролируют такие физические показатели, как потребление памяти и места на диске.</span><span class="sxs-lookup"><span data-stu-id="9fccf-114">Services may track physical metrics like memory and disk consumption.</span></span> <span data-ttu-id="9fccf-115">Но еще чаще их интересуют логические метрики, например WorkQueueDepth (Длина очереди заданий) или TotalRequests (Общее количество запросов).</span><span class="sxs-lookup"><span data-stu-id="9fccf-115">More commonly, services may care about logical metrics - things like "WorkQueueDepth" or "TotalRequests".</span></span> <span data-ttu-id="9fccf-116">Логические и физические метрики могут использоваться в одном и том же кластере.</span><span class="sxs-lookup"><span data-stu-id="9fccf-116">Both logical and physical metrics can be used in the same cluster.</span></span> <span data-ttu-id="9fccf-117">Метрики могут совместно использоваться для нескольких служб или относиться к конкретной службе.</span><span class="sxs-lookup"><span data-stu-id="9fccf-117">Metrics can be shared across many services or be specific to a particular service.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="9fccf-118">Дополнительные рекомендации</span><span class="sxs-lookup"><span data-stu-id="9fccf-118">Other considerations</span></span>
<span data-ttu-id="9fccf-119">Службы и приложения могут создавать не те же люди, которые управляют кластером (владельцы и операторы). Если же это один человек, то он выступает здесь в разных ролях.</span><span class="sxs-lookup"><span data-stu-id="9fccf-119">The owners and operators of the cluster can be different from the service and application authors, or at a minimum are the same people wearing different hats.</span></span> <span data-ttu-id="9fccf-120">При разработке приложения вам известно, что для него требуется.</span><span class="sxs-lookup"><span data-stu-id="9fccf-120">When you develop your application you know a few things about what it requires.</span></span> <span data-ttu-id="9fccf-121">Вы оцениваете ресурсы, которые оно будет использовать, и определяете, как следует развернуть различные службы.</span><span class="sxs-lookup"><span data-stu-id="9fccf-121">You have an estimate of the resources it will consume and how different services should be deployed.</span></span> <span data-ttu-id="9fccf-122">Например, уровень веб-приложений должен выполняться на узлах с доступом к Интернету, а службы базы данных — нет.</span><span class="sxs-lookup"><span data-stu-id="9fccf-122">For example, the web tier needs to run on nodes exposed to the Internet, while the database services should not.</span></span> <span data-ttu-id="9fccf-123">Еще один пример: веб-службы, вероятнее всего, ограничиваются ресурсами ЦП и сети, тогда как службы уровня данных больше зависят от потребления памяти и емкости дисков.</span><span class="sxs-lookup"><span data-stu-id="9fccf-123">As another example, the web services are probably constrained by CPU and network, while the data tier services care more about memory and disk consumption.</span></span> <span data-ttu-id="9fccf-124">Но у сотрудника, который должен реагировать на инцидент на объекте, на котором работает эта служба, или который управляет обновлением этой службы, будут совсем другие приоритеты, и ему нужны другие инструменты.</span><span class="sxs-lookup"><span data-stu-id="9fccf-124">However, the person handling a live-site incident for that service in production, or who is managing an upgrade to the service has a different job to do, and requires different tools.</span></span> 

<span data-ttu-id="9fccf-125">Кластер и службы являются динамическими:</span><span class="sxs-lookup"><span data-stu-id="9fccf-125">Both the cluster and services are dynamic:</span></span>

- <span data-ttu-id="9fccf-126">количество узлов в кластере может увеличиваться и уменьшаться;</span><span class="sxs-lookup"><span data-stu-id="9fccf-126">The number of nodes in the cluster can grow and shrink</span></span>
- <span data-ttu-id="9fccf-127">могут добавляться и исчезать узлы различных размеров и типов;</span><span class="sxs-lookup"><span data-stu-id="9fccf-127">Nodes of different sizes and types can come and go</span></span>
- <span data-ttu-id="9fccf-128">службы могут создаваться и перемещаться, а также для них могут меняться потребности в выделяемых ресурсах и правила размещения;</span><span class="sxs-lookup"><span data-stu-id="9fccf-128">Services can be created, removed, and change their desired resource allocations and placement rules</span></span>
- <span data-ttu-id="9fccf-129">кластер может обновляться и подвергаться другим операциям управления (от уровня приложения до уровня инфраструктуры).</span><span class="sxs-lookup"><span data-stu-id="9fccf-129">Upgrades or other management operations can roll through the cluster at the application on infrastructure levels</span></span>
- <span data-ttu-id="9fccf-130">Сбои могут происходить в любое время.</span><span class="sxs-lookup"><span data-stu-id="9fccf-130">Failures can happen at any time.</span></span>

## <a name="cluster-resource-manager-components-and-data-flow"></a><span data-ttu-id="9fccf-131">Компоненты и поток данных диспетчера кластерных ресурсов</span><span class="sxs-lookup"><span data-stu-id="9fccf-131">Cluster resource manager components and data flow</span></span>
<span data-ttu-id="9fccf-132">Диспетчер кластерных ресурсов должен отслеживать потребности каждой службы и потребление ресурсов каждым объектом службы, входящим в эти службы.</span><span class="sxs-lookup"><span data-stu-id="9fccf-132">The Cluster Resource Manager has to track the requirements of each service and the consumption of resources by each service object within those services.</span></span> <span data-ttu-id="9fccf-133">Диспетчер кластерных ресурсов разделен на две независимых части: агенты, которые выполняются на каждом узле, и отказоустойчивая служба.</span><span class="sxs-lookup"><span data-stu-id="9fccf-133">The Cluster Resource Manager has two conceptual parts: agents that run on each node and a fault-tolerant service.</span></span> <span data-ttu-id="9fccf-134">Агенты на каждом узле отслеживают информацию о нагрузке от служб, агрегируют ее и периодически передают в отчетах.</span><span class="sxs-lookup"><span data-stu-id="9fccf-134">The agents on each node track load reports from services, aggregate them, and periodically report them.</span></span> <span data-ttu-id="9fccf-135">Служба диспетчера кластерных ресурсов собирает все данные от локальных агентов и выполняет определенные действия в зависимости от текущей конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9fccf-135">The Cluster Resource Manager service aggregates all the information from the local agents and reacts based on its current configuration.</span></span>

<span data-ttu-id="9fccf-136">Посмотрите на схему ниже.</span><span class="sxs-lookup"><span data-stu-id="9fccf-136">Let’s look at the following diagram:</span></span>

<span data-ttu-id="9fccf-137"><center>
![Архитектура балансировщика ресурсов][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="9fccf-137"><center>
![Resource Balancer Architecture][Image1]
</center></span></span>

<span data-ttu-id="9fccf-138">Во время выполнения могут произойти разные изменения.</span><span class="sxs-lookup"><span data-stu-id="9fccf-138">During runtime, there are many changes that could happen.</span></span> <span data-ttu-id="9fccf-139">Например, изменяется объем ресурсов, потребляемых службами, некоторые службы прекращают работу, отдельные узлы добавляются к кластеру или удаляются из него.</span><span class="sxs-lookup"><span data-stu-id="9fccf-139">For example, let’s say the amount of resources some services consume changes, some services fail, and some nodes join and leave the cluster.</span></span> <span data-ttu-id="9fccf-140">Все изменения на узле собираются и периодически отправляются в службу диспетчера кластерных ресурсов (1,2), где они собираются снова, анализируются и сохраняются.</span><span class="sxs-lookup"><span data-stu-id="9fccf-140">All the changes on a node are aggregated and periodically sent to the Cluster Resource Manager service (1,2) where they are aggregated again, analyzed, and stored.</span></span> <span data-ttu-id="9fccf-141">Каждые несколько секунд эта служба просматривает все изменения и определяет, нужно ли выполнять какие-либо действия (3).</span><span class="sxs-lookup"><span data-stu-id="9fccf-141">Every few seconds that service looks at the changes and determines if any actions are necessary (3).</span></span> <span data-ttu-id="9fccf-142">Например, она может определить, что в кластер добавлены пустые узлы.</span><span class="sxs-lookup"><span data-stu-id="9fccf-142">For example, it could notice that some empty nodes have been added to the cluster.</span></span> <span data-ttu-id="9fccf-143">В этом случае она решит переместить некоторые службы на эти узлы.</span><span class="sxs-lookup"><span data-stu-id="9fccf-143">As a result, it decides to move some services to those nodes.</span></span> <span data-ttu-id="9fccf-144">Также диспетчер кластерных ресурсов может зафиксировать, что один из узлов перегружен или одна из служб не работает (либо была удалена), то есть освободила некоторые ресурсы.</span><span class="sxs-lookup"><span data-stu-id="9fccf-144">The Cluster Resource Manager could also notice that a particular node is overloaded, or that certain services have failed or been deleted, freeing up resources elsewhere.</span></span>

<span data-ttu-id="9fccf-145">Посмотрите на следующую схему, которая показывает, что происходит далее.</span><span class="sxs-lookup"><span data-stu-id="9fccf-145">Let’s look at the following diagram and see what happens next.</span></span> <span data-ttu-id="9fccf-146">Предположим, диспетчер кластерных ресурсов определяет, что необходимы изменения.</span><span class="sxs-lookup"><span data-stu-id="9fccf-146">Let’s say that the Cluster Resource Manager determines that changes are necessary.</span></span> <span data-ttu-id="9fccf-147">Он вносит необходимые изменения по согласованию с другими службами (в частности с диспетчером отработки отказов).</span><span class="sxs-lookup"><span data-stu-id="9fccf-147">It coordinates with other system services (in particular the Failover Manager) to make the necessary changes.</span></span> <span data-ttu-id="9fccf-148">На соответствующие узлы отправляются необходимые команды (4).</span><span class="sxs-lookup"><span data-stu-id="9fccf-148">Then the necessary commands are sent to the appropriate nodes (4).</span></span> <span data-ttu-id="9fccf-149">Предположим, диспетчер ресурсов заметил, что узел Node5 перегружен, и решил перенести службу B с узла Node5 на узел Node4.</span><span class="sxs-lookup"><span data-stu-id="9fccf-149">For example, let's say the Resource Manager noticed that Node5 was overloaded, and so decided to move service B from Node5 to Node4.</span></span> <span data-ttu-id="9fccf-150">После перенастройки (5) кластер выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9fccf-150">At the end of the reconfiguration (5), the cluster looks like this:</span></span>

<span data-ttu-id="9fccf-151"><center>
![Архитектура балансировщика ресурсов][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="9fccf-151"><center>
![Resource Balancer Architecture][Image2]
</center></span></span>

## <a name="next-steps"></a><span data-ttu-id="9fccf-152">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="9fccf-152">Next steps</span></span>
- <span data-ttu-id="9fccf-153">Диспетчер кластерных ресурсов предоставляет много параметров для описания кластера.</span><span class="sxs-lookup"><span data-stu-id="9fccf-153">The Cluster Resource Manager has many options for describing the cluster.</span></span> <span data-ttu-id="9fccf-154">Дополнительные сведения об этих параметрах см. в статье с [описанием кластера Service Fabric](./service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="9fccf-154">To find out more about them, check out this article on [describing a Service Fabric cluster](./service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
- <span data-ttu-id="9fccf-155">Основная задача диспетчера кластерных ресурсов — перераспределение нагрузки кластера и применение правил размещения.</span><span class="sxs-lookup"><span data-stu-id="9fccf-155">The Cluster Resource Manager's primary duties are rebalancing the cluster and enforcing placement rules.</span></span> <span data-ttu-id="9fccf-156">Дополнительные сведения о настройке этих функций см. в разделе [Балансировка кластера Service Fabric](./service-fabric-cluster-resource-manager-balancing.md).</span><span class="sxs-lookup"><span data-stu-id="9fccf-156">For more information on configuring these behaviors, see [balancing your Service Fabric cluster](./service-fabric-cluster-resource-manager-balancing.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-architecture/Service-Fabric-Resource-Manager-Architecture-Activity-1.png
[Image2]:./media/service-fabric-cluster-resource-manager-architecture/Service-Fabric-Resource-Manager-Architecture-Activity-2.png
