---
title: "aaaDefragmentation метрик в Azure Service Fabric | Документы Microsoft"
description: "Общие сведения об использовании дефрагментации или упаковки в качестве стратегии для метрик в кластере Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: e5ebfae5-c8f7-4d6c-9173-3e22a9730552
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: d09045a6cf196d2771f1a0794637f4579d3eb96b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="defragmentation-of-metrics-and-load-in-service-fabric"></a><span data-ttu-id="3b9fe-103">Дефрагментация метрик и нагрузки в Service Fabric</span><span class="sxs-lookup"><span data-stu-id="3b9fe-103">Defragmentation of metrics and load in Service Fabric</span></span>
<span data-ttu-id="3b9fe-104">стратегию по умолчанию Hello Service Fabric диспетчер ресурсов кластера управления метрики нагрузки в кластере hello — toodistribute hello load.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-104">hello Service Fabric Cluster Resource Manager's default strategy for managing load metrics in hello cluster is toodistribute hello load.</span></span> <span data-ttu-id="3b9fe-105">Обеспечение узлы равномерно используются позволяет избежать горячие и холодные перегруженные участки, ведущих tooboth конфликтов и нерационально используемого ресурсы.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-105">Ensuring that nodes are evenly utilized avoids hot and cold spots that lead tooboth contention and wasted resources.</span></span> <span data-ttu-id="3b9fe-106">Распределения рабочей нагрузки в кластере hello также является наиболее безопасным с точки зрения оставшимся сбои, поскольку гарантирует, что ошибка не убрать значительная часть заданной рабочей нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-106">Distributing workloads in hello cluster is also hello safest in terms of surviving failures since it ensures that a failure doesn’t take out a large percentage of a given workload.</span></span> 

<span data-ttu-id="3b9fe-107">Диспетчер ресурсов кластера Service Fabric Hello поддержку другую стратегию управления загрузки, который является дефрагментации.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-107">hello Service Fabric Cluster Resource Manager does support a different strategy for managing load, which is defragmentation.</span></span> <span data-ttu-id="3b9fe-108">Дефрагментация означает, что вместо использования hello toodistribute метрики в кластере hello, он размещается.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-108">Defragmentation means that instead of trying toodistribute hello utilization of a metric across hello cluster, it is consolidated.</span></span> <span data-ttu-id="3b9fe-109">Консолидация является просто инверсии балансировки стратегии — вместо сводя к минимуму среднее стандартное отклонение hello метрики нагрузки по умолчанию hello, hello диспетчер ресурсов кластера пытается tooincrease его.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-109">Consolidation is just an inversion of hello default balancing strategy – instead of minimizing hello average standard deviation of metric load, hello Cluster Resource Manager tries tooincrease it.</span></span>

## <a name="when-toouse-defragmentation"></a><span data-ttu-id="3b9fe-110">При дефрагментации toouse</span><span class="sxs-lookup"><span data-stu-id="3b9fe-110">When toouse defragmentation</span></span>
<span data-ttu-id="3b9fe-111">Распределение нагрузки в кластере hello использует некоторые ресурсы hello на каждом узле.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-111">Distributing load in hello cluster consumes some of hello resources on each node.</span></span> <span data-ttu-id="3b9fe-112">Некоторые рабочие нагрузки создают огромные службы, потребляющие почти все или все ресурсы узла.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-112">Some workloads create services that are exceptionally large and consume most or all of a node.</span></span> <span data-ttu-id="3b9fe-113">В таких случаях это возможно, что при наличии больших рабочих нагрузок начало создания, что недостаточно места на любой узел toorun их.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-113">In these cases, it's possible that when there are large workloads getting created that there isn't enough space on any node toorun them.</span></span> <span data-ttu-id="3b9fe-114">Больших рабочих нагрузок, не являются проблемой в Service Fabric; в этих случаях hello диспетчер ресурсов кластера определяет, что требуется tooreorganize hello кластера toomake дискового пространства для этого большой рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-114">Large workloads aren't a problem in Service Fabric; in these cases hello Cluster Resource Manager determines that it needs tooreorganize hello cluster toomake room for this large workload.</span></span> <span data-ttu-id="3b9fe-115">Однако в hello временем рабочая нагрузка, имеет toobe toowait, назначенные в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-115">However, in hello meantime that workload has toowait toobe scheduled in hello cluster.</span></span>

<span data-ttu-id="3b9fe-116">Если имеется много служб и состояние toomove вокруг, он может занять долгое время большой рабочей нагрузки toobe hello, помещаются в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-116">If there are many services and state toomove around, then it could take a long time for hello large workload toobe placed in hello cluster.</span></span> <span data-ttu-id="3b9fe-117">Это скорее всего, если другие рабочие нагрузки в кластере hello также большие и поэтому можете tooreorganize больше времени.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-117">This is more likely if other workloads in hello cluster are also large and so take longer tooreorganize.</span></span> <span data-ttu-id="3b9fe-118">группы Service Fabric Hello измеряется время создания в имитаций этого сценария.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-118">hello Service Fabric team measured creation times in simulations of this scenario.</span></span> <span data-ttu-id="3b9fe-119">Мы обнаружили, что создание больших служб занимает гораздо больше времени, когда использование кластера находится в пределах 30–50 %.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-119">We found that creating large services took much longer as soon as cluster utilization got above between 30% and 50%.</span></span> <span data-ttu-id="3b9fe-120">toohandle этом сценарии мы представили дефрагментации как стратегии балансировки.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-120">toohandle this scenario, we introduced defragmentation as a balancing strategy.</span></span> <span data-ttu-id="3b9fe-121">Мы обнаружили, что для больших рабочих нагрузок, особенно таких положением важные дефрагментации действительно помогли новых рабочих нагрузок и время создания получить планировать в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-121">We found that for large workloads, especially ones where creation time was important, defragmentation really helped those new workloads get scheduled in hello cluster.</span></span>

<span data-ttu-id="3b9fe-122">Вы можете настроить hello toohave дефрагментации метрики нагрузки hello toocondense tooproactively диспетчер ресурсов кластера повторите служб hello в меньшее количество узлов.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-122">You can configure defragmentation metrics toohave hello Cluster Resource Manager tooproactively try toocondense hello load of hello services into fewer nodes.</span></span> <span data-ttu-id="3b9fe-123">Это позволяет гарантировать, что почти всегда есть возможность для больших служб без реорганизации hello кластера.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-123">This helps ensure that there is almost always room for large services without reorganizing hello cluster.</span></span> <span data-ttu-id="3b9fe-124">Отсутствие tooreorganize hello кластера позволяет быстро создание больших рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-124">Not having tooreorganize hello cluster allows creating large workloads quickly.</span></span>

<span data-ttu-id="3b9fe-125">Для большинства клиентов дефрагментация не требуется.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-125">Most people don’t need defragmentation.</span></span> <span data-ttu-id="3b9fe-126">Службы обычно невелико, поэтому нет жестких toofind места для их в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-126">Services are usually be small, so it’s not hard toofind room for them in hello cluster.</span></span> <span data-ttu-id="3b9fe-127">Когда реорганизация возможна, она происходит быстро, так как большинство служб — небольшого размера, и они могут быть перемещены быстро и параллельно.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-127">When reorganization is possible, it goes quickly, again because most services are small and can be moved quickly and in parallel.</span></span> <span data-ttu-id="3b9fe-128">Если вы большой служб и необходимости быстро создавать затем hello стратегии дефрагментации то, для вас.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-128">However, if you have large services and need them created quickly then hello defragmentation strategy is for you.</span></span> <span data-ttu-id="3b9fe-129">Мы обсудим достоинства и недостатки hello рядом применения дефрагментации.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-129">We'll discuss hello tradeoffs of using defragmentation next.</span></span> 

## <a name="defragmentation-tradeoffs"></a><span data-ttu-id="3b9fe-130">Достоинства и недостатки дефрагментации</span><span class="sxs-lookup"><span data-stu-id="3b9fe-130">Defragmentation tradeoffs</span></span>
<span data-ttu-id="3b9fe-131">Дефрагментация может усугубить последствия сбоев, так как на узле, на котором произошел сбой, выполняется больше служб.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-131">Defragmentation can increase impactfulness of failures, since more services are running on nodes that fail.</span></span> <span data-ttu-id="3b9fe-132">Дефрагментацию можно также увеличить затраты, так как ресурсы в кластере hello, должен храниться в резерве, Ожидание создания hello больших рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-132">Defragmentation can also increase costs, since resources in hello cluster must be held in reserve, waiting for hello creation of large workloads.</span></span>

<span data-ttu-id="3b9fe-133">Hello следующей схеме представлены визуальное представление из двух кластеров, состояния и которого не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-133">hello following diagram gives a visual representation of two clusters, one that is defragmented and one that is not.</span></span> 

<span data-ttu-id="3b9fe-134"><center>
![Сравнение методов балансировки и дефрагментации кластеров][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="3b9fe-134"><center>
![Comparing Balanced and Defragmented Clusters][Image1]
</center></span></span>

<span data-ttu-id="3b9fe-135">В случае балансировки hello рассмотрите возможность hello число перемещений, которые были бы необходимые tooplace объектов hello наибольшее службы.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-135">In hello balanced case, consider hello number of movements that would be necessary tooplace one of hello largest service objects.</span></span> <span data-ttu-id="3b9fe-136">В кластере дефрагментированного hello hello большой рабочей нагрузки может быть размещен на узлах четырех или пяти без необходимости toowait для любой другой toomove служб.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-136">In hello defragmented cluster, hello large workload could be placed on nodes four or five without having toowait for any other services toomove.</span></span>

## <a name="defragmentation-pros-and-cons"></a><span data-ttu-id="3b9fe-137">Преимущества и недостатки дефрагментации</span><span class="sxs-lookup"><span data-stu-id="3b9fe-137">Defragmentation pros and cons</span></span>
<span data-ttu-id="3b9fe-138">О каких компромиссах идет речь?</span><span class="sxs-lookup"><span data-stu-id="3b9fe-138">So what are those other conceptual tradeoffs?</span></span> <span data-ttu-id="3b9fe-139">Ниже приведен список быстрого toothink вещей о:</span><span class="sxs-lookup"><span data-stu-id="3b9fe-139">Here’s a quick table of things toothink about:</span></span>

| <span data-ttu-id="3b9fe-140">Плюсы дефрагментации</span><span class="sxs-lookup"><span data-stu-id="3b9fe-140">Defragmentation Pros</span></span> | <span data-ttu-id="3b9fe-141">Минусы дефрагментации</span><span class="sxs-lookup"><span data-stu-id="3b9fe-141">Defragmentation Cons</span></span> |
| --- | --- |
| <span data-ttu-id="3b9fe-142">Позволяет ускорить создание больших служб</span><span class="sxs-lookup"><span data-stu-id="3b9fe-142">Allows faster creation of large services</span></span> |<span data-ttu-id="3b9fe-143">Концентрирует нагрузку на меньшем числе узлов, увеличивая, таким образом, конкуренцию за ресурсы</span><span class="sxs-lookup"><span data-stu-id="3b9fe-143">Concentrates load onto fewer nodes, increasing contention</span></span> |
| <span data-ttu-id="3b9fe-144">Позволяет уменьшить перемещения данных в процессе создания</span><span class="sxs-lookup"><span data-stu-id="3b9fe-144">Enables lower data movement during creation</span></span> |<span data-ttu-id="3b9fe-145">Сбои могут затронуть больше служб и вызвать более серьезные последствия</span><span class="sxs-lookup"><span data-stu-id="3b9fe-145">Failures can impact more services and cause more churn</span></span> |
| <span data-ttu-id="3b9fe-146">Обеспечивает подробное описание требований и оптимальное использование пространства</span><span class="sxs-lookup"><span data-stu-id="3b9fe-146">Allows rich description of requirements and reclamation of space</span></span> |<span data-ttu-id="3b9fe-147">Более сложная общая настройка управления ресурсами</span><span class="sxs-lookup"><span data-stu-id="3b9fe-147">More complex overall Resource Management configuration</span></span> |

<span data-ttu-id="3b9fe-148">Вы можете сочетать дефрагментированного и обычных метрики в hello одного кластера.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-148">You can mix defragmented and normal metrics in hello same cluster.</span></span> <span data-ttu-id="3b9fe-149">Hello диспетчер ресурсов кластера пытается tooconsolidate hello дефрагментации метрики настолько, насколько возможно, при котором hello другим пользователям.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-149">hello Cluster Resource Manager tries tooconsolidate hello defragmentation metrics as much as possible while spreading out hello others.</span></span> <span data-ttu-id="3b9fe-150">результаты Hello смешивание дефрагментации и балансировки стратегии зависит от нескольких факторов, включая:</span><span class="sxs-lookup"><span data-stu-id="3b9fe-150">hello results of mixing defragmentation and balancing strategies depends on several factors, including:</span></span>
  - <span data-ttu-id="3b9fe-151">число Hello балансировки метрик и hello число метрик дефрагментации</span><span class="sxs-lookup"><span data-stu-id="3b9fe-151">hello number of balancing metrics vs. hello number of defragmentation metrics</span></span>
  - <span data-ttu-id="3b9fe-152">использует ли какие-либо службы метрики обоих типов;</span><span class="sxs-lookup"><span data-stu-id="3b9fe-152">Whether any service uses both types of metrics</span></span> 
  - <span data-ttu-id="3b9fe-153">Hello метрической системы весов</span><span class="sxs-lookup"><span data-stu-id="3b9fe-153">hello metric weights</span></span>
  - <span data-ttu-id="3b9fe-154">текущая нагрузка метрик.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-154">current metric loads</span></span>
  
<span data-ttu-id="3b9fe-155">Эксперименты является обязательным toodetermine hello точную настройку, необходимую.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-155">Experimentation is required toodetermine hello exact configuration necessary.</span></span> <span data-ttu-id="3b9fe-156">Мы рекомендуем тщательно измерить рабочие нагрузки, прежде чем включать метрики дефрагментации в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-156">We recommend thorough measurement of your workloads before you enable defragmentation metrics in production.</span></span> <span data-ttu-id="3b9fe-157">Это особенно важно при совместном использовании дефрагментации и балансировки показателей hello одной службы.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-157">This is especially true when mixing defragmentation and balanced metrics within hello same service.</span></span> 

## <a name="configuring-defragmentation-metrics"></a><span data-ttu-id="3b9fe-158">Настройка метрик для дефрагментации</span><span class="sxs-lookup"><span data-stu-id="3b9fe-158">Configuring defragmentation metrics</span></span>
<span data-ttu-id="3b9fe-159">Настройка метрик дефрагментации является глобальной принятия решений в кластере hello и отдельных метрики могут быть выбраны для дефрагментации.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-159">Configuring defragmentation metrics is a global decision in hello cluster, and individual metrics can be selected for defragmentation.</span></span> <span data-ttu-id="3b9fe-160">Следующие фрагменты кода конфигурации Hello показывают, как tooconfigure метрики для дефрагментации.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-160">hello following config snippets show how tooconfigure metrics for defragmentation.</span></span> <span data-ttu-id="3b9fe-161">В этом случае «Metric1» настраивается как метрикой дефрагментации «Metric2» будет продолжено toobe обычно сбалансированы.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-161">In this case, "Metric1" is configured as a defragmentation metric, while "Metric2" will continue toobe balanced normally.</span></span> 

<span data-ttu-id="3b9fe-162">ClusterManifest.xml:</span><span class="sxs-lookup"><span data-stu-id="3b9fe-162">ClusterManifest.xml:</span></span>

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Metric1" Value="true" />
    <Parameter Name="Metric2" Value="false" />
</Section>
```

<span data-ttu-id="3b9fe-163">Для автономных развертываний используется ClusterConfig.json, а для размещенных в Azure кластеров — Template.json.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-163">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "DefragmentationMetrics",
    "parameters": [
      {
          "name": "Metric1",
          "value": "true"
      },
      {
          "name": "Metric2",
          "value": "false"
      }
    ]
  }
]
```


## <a name="next-steps"></a><span data-ttu-id="3b9fe-164">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="3b9fe-164">Next steps</span></span>
- <span data-ttu-id="3b9fe-165">Hello диспетчер ресурсов кластера имеет параметры man для описания кластера hello.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-165">hello Cluster Resource Manager has man options for describing hello cluster.</span></span> <span data-ttu-id="3b9fe-166">toofind подробные сведения о них, извлеките в этой статье на [описания кластера Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="3b9fe-166">toofind out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
- <span data-ttu-id="3b9fe-167">Показатели, как hello диспетчера ресурсов кластера Service Fabric управляет потребления и мощность в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="3b9fe-167">Metrics are how hello Service Fabric Cluster Resource Manger manages consumption and capacity in hello cluster.</span></span> <span data-ttu-id="3b9fe-168">Дополнительные сведения о метриках toolearn как tooconfigure, извлечение и возврат [в данной статье](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="3b9fe-168">toolearn more about metrics and how tooconfigure them, check out [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-defragmentation-metrics/balancing-defrag-compared.png
