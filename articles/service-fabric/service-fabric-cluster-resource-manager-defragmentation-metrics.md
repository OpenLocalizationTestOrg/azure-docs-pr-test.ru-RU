---
title: "aaaDefragmentation метрик в Azure Service Fabric | Документы Microsoft"
description: "Общие сведения об использовании дефрагментации или упаковки в качестве стратегии для метрик в кластере Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: e5ebfae5-c8f7-4d6c-9173-3e22a9730552
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: d09045a6cf196d2771f1a0794637f4579d3eb96b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="defragmentation-of-metrics-and-load-in-service-fabric"></a>Дефрагментация метрик и нагрузки в Service Fabric
стратегию по умолчанию Hello Service Fabric диспетчер ресурсов кластера управления метрики нагрузки в кластере hello — toodistribute hello load. Обеспечение узлы равномерно используются позволяет избежать горячие и холодные перегруженные участки, ведущих tooboth конфликтов и нерационально используемого ресурсы. Распределения рабочей нагрузки в кластере hello также является наиболее безопасным с точки зрения оставшимся сбои, поскольку гарантирует, что ошибка не убрать значительная часть заданной рабочей нагрузки hello. 

Диспетчер ресурсов кластера Service Fabric Hello поддержку другую стратегию управления загрузки, который является дефрагментации. Дефрагментация означает, что вместо использования hello toodistribute метрики в кластере hello, он размещается. Консолидация является просто инверсии балансировки стратегии — вместо сводя к минимуму среднее стандартное отклонение hello метрики нагрузки по умолчанию hello, hello диспетчер ресурсов кластера пытается tooincrease его.

## <a name="when-toouse-defragmentation"></a>При дефрагментации toouse
Распределение нагрузки в кластере hello использует некоторые ресурсы hello на каждом узле. Некоторые рабочие нагрузки создают огромные службы, потребляющие почти все или все ресурсы узла. В таких случаях это возможно, что при наличии больших рабочих нагрузок начало создания, что недостаточно места на любой узел toorun их. Больших рабочих нагрузок, не являются проблемой в Service Fabric; в этих случаях hello диспетчер ресурсов кластера определяет, что требуется tooreorganize hello кластера toomake дискового пространства для этого большой рабочей нагрузки. Однако в hello временем рабочая нагрузка, имеет toobe toowait, назначенные в кластере hello.

Если имеется много служб и состояние toomove вокруг, он может занять долгое время большой рабочей нагрузки toobe hello, помещаются в кластере hello. Это скорее всего, если другие рабочие нагрузки в кластере hello также большие и поэтому можете tooreorganize больше времени. группы Service Fabric Hello измеряется время создания в имитаций этого сценария. Мы обнаружили, что создание больших служб занимает гораздо больше времени, когда использование кластера находится в пределах 30–50 %. toohandle этом сценарии мы представили дефрагментации как стратегии балансировки. Мы обнаружили, что для больших рабочих нагрузок, особенно таких положением важные дефрагментации действительно помогли новых рабочих нагрузок и время создания получить планировать в кластере hello.

Вы можете настроить hello toohave дефрагментации метрики нагрузки hello toocondense tooproactively диспетчер ресурсов кластера повторите служб hello в меньшее количество узлов. Это позволяет гарантировать, что почти всегда есть возможность для больших служб без реорганизации hello кластера. Отсутствие tooreorganize hello кластера позволяет быстро создание больших рабочих нагрузок.

Для большинства клиентов дефрагментация не требуется. Службы обычно невелико, поэтому нет жестких toofind места для их в кластере hello. Когда реорганизация возможна, она происходит быстро, так как большинство служб — небольшого размера, и они могут быть перемещены быстро и параллельно. Если вы большой служб и необходимости быстро создавать затем hello стратегии дефрагментации то, для вас. Мы обсудим достоинства и недостатки hello рядом применения дефрагментации. 

## <a name="defragmentation-tradeoffs"></a>Достоинства и недостатки дефрагментации
Дефрагментация может усугубить последствия сбоев, так как на узле, на котором произошел сбой, выполняется больше служб. Дефрагментацию можно также увеличить затраты, так как ресурсы в кластере hello, должен храниться в резерве, Ожидание создания hello больших рабочих нагрузок.

Hello следующей схеме представлены визуальное представление из двух кластеров, состояния и которого не поддерживается. 

<center>
![Сравнение методов балансировки и дефрагментации кластеров][Image1]
</center>

В случае балансировки hello рассмотрите возможность hello число перемещений, которые были бы необходимые tooplace объектов hello наибольшее службы. В кластере дефрагментированного hello hello большой рабочей нагрузки может быть размещен на узлах четырех или пяти без необходимости toowait для любой другой toomove служб.

## <a name="defragmentation-pros-and-cons"></a>Преимущества и недостатки дефрагментации
О каких компромиссах идет речь? Ниже приведен список быстрого toothink вещей о:

| Плюсы дефрагментации | Минусы дефрагментации |
| --- | --- |
| Позволяет ускорить создание больших служб |Концентрирует нагрузку на меньшем числе узлов, увеличивая, таким образом, конкуренцию за ресурсы |
| Позволяет уменьшить перемещения данных в процессе создания |Сбои могут затронуть больше служб и вызвать более серьезные последствия |
| Обеспечивает подробное описание требований и оптимальное использование пространства |Более сложная общая настройка управления ресурсами |

Вы можете сочетать дефрагментированного и обычных метрики в hello одного кластера. Hello диспетчер ресурсов кластера пытается tooconsolidate hello дефрагментации метрики настолько, насколько возможно, при котором hello другим пользователям. результаты Hello смешивание дефрагментации и балансировки стратегии зависит от нескольких факторов, включая:
  - число Hello балансировки метрик и hello число метрик дефрагментации
  - использует ли какие-либо службы метрики обоих типов; 
  - Hello метрической системы весов
  - текущая нагрузка метрик.
  
Эксперименты является обязательным toodetermine hello точную настройку, необходимую. Мы рекомендуем тщательно измерить рабочие нагрузки, прежде чем включать метрики дефрагментации в рабочей среде. Это особенно важно при совместном использовании дефрагментации и балансировки показателей hello одной службы. 

## <a name="configuring-defragmentation-metrics"></a>Настройка метрик для дефрагментации
Настройка метрик дефрагментации является глобальной принятия решений в кластере hello и отдельных метрики могут быть выбраны для дефрагментации. Следующие фрагменты кода конфигурации Hello показывают, как tooconfigure метрики для дефрагментации. В этом случае «Metric1» настраивается как метрикой дефрагментации «Metric2» будет продолжено toobe обычно сбалансированы. 

ClusterManifest.xml:

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Metric1" Value="true" />
    <Parameter Name="Metric2" Value="false" />
</Section>
```

Для автономных развертываний используется ClusterConfig.json, а для размещенных в Azure кластеров — Template.json.

```json
"fabricSettings": [
  {
    "name": "DefragmentationMetrics",
    "parameters": [
      {
          "name": "Metric1",
          "value": "true"
      },
      {
          "name": "Metric2",
          "value": "false"
      }
    ]
  }
]
```


## <a name="next-steps"></a>Дальнейшие действия
- Hello диспетчер ресурсов кластера имеет параметры man для описания кластера hello. toofind подробные сведения о них, извлеките в этой статье на [описания кластера Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)
- Показатели, как hello диспетчера ресурсов кластера Service Fabric управляет потребления и мощность в кластере hello. Дополнительные сведения о метриках toolearn как tooconfigure, извлечение и возврат [в данной статье](service-fabric-cluster-resource-manager-metrics.md)

[Image1]:./media/service-fabric-cluster-resource-manager-defragmentation-metrics/balancing-defrag-compared.png
