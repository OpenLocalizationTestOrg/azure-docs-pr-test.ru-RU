---
title: "Наблюдение за aaaHealth в Service Fabric | Документы Microsoft"
description: "Введение toohello Azure Service Fabric наблюдения за работоспособностью модель, которая обеспечивает наблюдение за hello кластера, приложениями и службами."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 1d979210-b1eb-4022-be24-799fd9d8e003
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 904f36374ca6ca7e4caa1d43c92584e7e4c50087
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="introduction-tooservice-fabric-health-monitoring"></a>Мониторинг работоспособности введение tooService структуры
В платформе Azure Service Fabric используется модель работоспособности c широкими и гибкими возможностями оценки работоспособности и создания отчетов, модель Hello компонент обеспечивает наблюдение за рядом реального времени hello состояния служб кластеров hello и hello в нем. Вы можете легко получать сведения о работоспособности и устранять потенциальные проблемы, прежде чем они приведут к серьезным перебоям в работе. В обычной модели hello службы отправлять отчеты на основе своих локальных представлений и сведения, статистическая обработка tooprovide кластера общего уровня представления.

Компоненты Service Fabric используют этот tooreport модели работоспособности широкие возможности их текущее состояние. Можно использовать hello же работоспособности tooreport механизм из приложений. Приложив усилия к созданию качественного механизма, генерирующего отчеты о состоянии работоспособности компонентов среды, вы сможете более эффективно обнаруживать и исправлять проблемы в своих приложениях.

Hello следующие Microsoft Virtual Academy видео также описывает модель работоспособности Service Fabric hello и как она используется:<center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965">
<img src="./media/service-fabric-health-introduction/HealthIntroVid.png" WIDTH="360" HEIGHT="244">
</a></center>

> [!NOTE]
> Мы запустили hello работоспособности подсистемы tooaddress потребность в отслеживаемых обновлений. Service Fabric предоставляет отслеживаемых обновлений приложений и кластером, обеспечивающими полной доступности, не время простоя и минимальными toono вмешательства пользователя. Эти цели hello обновления проверяется состояние на основе tooachieve настроили обновления политики. Обновление может быть продолжено только в том случае, если соблюдены требуемые пороги работоспособности. В противном случае обновления hello либо откатывается автоматически или приостановлена Администраторы toogive вероятность toofix hello проблемы. toolearn Дополнительные сведения о обновлений приложений. в разделе [в этой статье](service-fabric-application-upgrade.md).
> 
> 

## <a name="health-store"></a>Хранилище данных о работоспособности
хранилище работоспособности Hello ведет здоровья сведения о сущностях в кластере hello для облегчения поиска и оценки. Оно реализовано Service Fabric постоянное службы с отслеживанием состояния tooensure высокой доступности и масштабируемости. Hello хранилища работоспособности является частью hello **fabric: / System** приложения, который при hello кластер работает и запущены.

## <a name="health-entities-and-hierarchy"></a>Сущности и иерархия работоспособности
работоспособные сущности Hello организованы в логические иерархию, которая захватывает взаимодействия и зависимости между различными организациями. базе данных health store Hello автоматически строит работоспособные сущности и иерархии, основанной на отчеты, полученные от компонентов Service Fabric.

работоспособные сущности Hello зеркало hello Service Fabric сущностей. (Например, **сущность работоспособности приложения** соответствует экземпляр приложения развернуто в кластере hello, тогда как **сущности работоспособности узла** соответствует узле кластера Service Fabric.) захватывает иерархии работоспособности hello взаимодействие между Hello hello системными объектами и он является основой hello для оценки работоспособности Дополнительно. Дополнительные сведения о ключевых понятиях Service Fabric см. в статье [Технический обзор Service Fabric](service-fabric-technical-overview.md). Дополнительные сведения о приложениях см. в статье [Модель приложения Service Fabric](service-fabric-application-model.md).

Hello работоспособные сущности и иерархии позволяют hello toobe кластеров и приложения эффективно сообщила, отладки и отслеживать. Модель работоспособности Hello обеспечивает точный, *детальные* представление работоспособности hello hello множество различных перемещения в кластере hello.

![Сущности работоспособности.][1]
работоспособные сущности Hello, организованные в иерархию, в зависимости от родительско дочерних отношений.

[1]: ./media/service-fabric-health-introduction/servicefabric-health-hierarchy.png

Hello работоспособности сущности являются:

* **Cluster**(кластер). Представляет hello работоспособности кластера Service Fabric. Отчеты о работоспособности кластера описаны условия, которые влияют на весь кластер hello. Эти условия действуют несколько сущностей в кластере hello или самого кластера hello. В зависимости от состояния hello hello отслеживания не может сузить проблемы hello вниз tooone или больше дочерних элементов неработоспособен. Примеры: hello мозг кластера hello разбиения из-за проблемы toonetwork секционирования или связи.
* **Node**(узел). Представляет hello работоспособности Service Fabric узла. Отчеты о работоспособности узла описаны условия, которые влияют на функциональность узел hello. Как правило, они влияют на все сущности hello развернут, запущенными на нем. Примеры: узлу не хватает места на диске (памяти, подключений или других свойств уровня компьютера) или узел не работает. узел сущности Hello определяется по имени узла hello (string).
* **Application**(приложение). Представляет hello работоспособность приложения, работающий в кластере hello. Отчеты о работоспособности приложения, описывающие условия, которые влияют на hello общей работоспособности приложения hello. Они не может быть сужается tooindividual дочерних элементов (службы или развернутых приложений). Примеры hello конца в конец взаимодействия между различными службами приложения hello. Сущность приложения Hello определяется по имени приложения hello (URI).
* **Служба**. Представляет hello работоспособности службы, запущенных в кластере hello. Отчеты о работоспособности службы, описания условий, которые влияют на hello общую работоспособность службы hello. Hello отслеживания не может сузить hello проблема tooan неработоспособное секции или реплики. Пример: конфигурация службы (например, порт или внешняя общая папка), которая является причиной проблем во всех разделах. сущности службы Hello определяется по имени службы hello (URI).
* **Partition**(раздел). Представляет состояние работоспособности hello раздела службы. Отчеты о работоспособности раздела описаны условия, которые влияют на Привет всем наборе реплик. Примеры, когда hello число реплик, которые меньше число целевых объектов и секции при потере кворума. сущность раздела Hello определяется параметрами секции hello идентификатор (GUID).
* **Replica**(реплика). Представляет hello работоспособности реплики службы с отслеживанием состояния или экземпляра службы без отслеживания состояния. Hello реплика является наименьшей единицей hello, которые watchdogs и компоненты системы могут включать в отчет для приложения. Для служб с отслеживанием состояния например первичной реплики, не может реплицировать toosecondaries операций и медленной репликации. Кроме того, экземпляр службы без сохранения состояния может отправлять отчет, если заканчиваются ресурсы или возникают проблемы с подключением. сущности реплики Hello идентифицируется hello идентификатор (GUID) и hello реплики или экземпляра идентификатор секции (long).
* **DeployedApplication**(развернутое приложение). Представляет hello работоспособности *приложения, работающего на узле*. Отчеты о работоспособности развернутого приложения описание условий toohello конкретного приложения на узле hello, который не может уменьшать tooservice пакетам, развернутым в hello того же узла. Примеры ошибок, когда не удается загрузить пакет приложения на этом узле и проблемы при настройке субъекты безопасности приложения на узле hello. приложение Hello развернут определяется по имени приложения (URI) и имя узла (string).
* **DeployedServicePackage**(развернутый пакет службы). Представляет hello работоспособности пакета службы, работающая на узле в кластере hello. Он описывает пакет службы tooa определенных условий, не затрагивающих hello другие пакеты обновления на hello того же узла для hello того же приложения. Примеры кода пакета в пакет службы hello не может быть запущен и пакет конфигурации, которую невозможно прочитать. пакет службы развернуты Hello определяется по имени приложения (URI), имя узла (string), имя манифеста службы (string) и код активации пакета службы (string).

Гранулярность Hello модель работоспособности hello позволяет легко toodetect и исправить проблемы. Например, если служба не отвечает, возможна tooreport, hello экземпляра приложения находится в неисправном состоянии. Создавать отчеты на том, что уровень не является лучшим вариантом, однако из-за проблемы hello может не влияет на работу всех служб hello этого приложения. Hello отчета может примененных toohello неработоспособности службы tooa конкретного дочернего раздела, если раздел toothat указывает Дополнительные сведения. Hello данных автоматически делает доступными через иерархию hello и Неработоспособная раздел станет видимым на уровне службы и приложения. Объединение помогает toopinpoint и более быстрому решению hello причину проблемы hello.

Hello работоспособности иерархия состоит из родительско дочерних отношений. Кластер состоит из узлов и приложений. Приложения включают службы и развернутые приложения. В развернутые приложения входят развернутые пакеты служб. Службы состоят из разделов, а каждый раздел включает одну или несколько реплик. Между узлами и развернутыми сущностями существует особая связь. Узел неработоспособен, сообщаемые его полномочия системного компонента, hello Failover Manager service влияет на hello развертывания приложений, пакетов служб и реплик, которые развернуты на нем.

Иерархия работоспособности Hello представляет hello последнее состояние системы hello на основании hello последние отчеты о работоспособности, который является почти в реальном времени информацию.
Внутренние и внешние watchdogs может включать в отчет hello же сущности на основе логику приложения или пользовательских условий триггера. Пользовательские отчеты сосуществовать с hello отчетов системы.

Планирование tooinvest в том, как tooreport и отправки ответа toohealth во время hello конструктора больших облачной службы. Это предварительные investement делает hello службы проще toodebug, мониторинга и работать.

## <a name="health-states"></a>Состояния работоспособности
Service Fabric использует три toodescribe состояния работоспособности, является ли сущность находится в работоспособном состоянии или не: "ОК", предупреждения и ошибки. Любой отчет, отправленные toohello базе данных health store необходимо указать один из этих состояний. Результат оценки работоспособности Hello имеет одно из этих состояний.

Здравствуйте, возможно [состояния работоспособности](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate) являются:

* **OK**. Hello сущность работоспособна. Известных проблем с сущностью или ее дочерними элементами (если таковые есть) не выявлено.
* **Предупреждение**. Hello сущность имеет некоторые проблемы, но он по-прежнему может работать неправильно. Например, возникли задержки, но они еще не вызывают проблем в работе. В некоторых случаях hello условие предупреждения может устранить найденные ошибки без внешнего вмешательства. В этих случаях отчеты о работоспособности повышают информированность и обеспечивают представление о том, что происходит. В других случаях hello условие предупреждения может ухудшить в серьезные проблемы без вмешательства пользователя.
* **Ошибка**. сущности Hello не является рабочим. Действие следует выполнить toofix hello состояние сущности hello, так как он не сможет работать правильно.
* **Неизвестно**. Hello сущность не существует в базе данных health store hello. Этот результат можно получить из hello распределенных запросов, объединить результаты из нескольких компонентов. Например, запрос списка узла get hello отправляется слишком**FailoverManager**, **ClusterManager**, и **HealthManager**; вернуть приложение запроса списка становится слишком **ClusterManager** и **HealthManager**. В этих запросах объединяются результаты, полученные от нескольких компонентов системы. Если другой компонент системы возвращает сущность, которая отсутствует в базе данных health store, hello результаты слияния имеет неизвестное состояние работоспособности. Сущность не находится в хранилище, так как отчеты о работоспособности еще не были обработаны или hello объекта был очищен после удаления.

## <a name="health-policies"></a>Политики работоспособности
Hello работоспособности хранилища применяет toodetermine политики работоспособности, как сущность работоспособна на основе отчетов и его дочерних элементов.

> [!NOTE]
> Политики работоспособности можно указать в манифесте кластера hello (для оценки работоспособности кластер и узел) или в манифесте приложения hello (для оценки приложений и любые его дочерние элементы). Запросы на оценку работоспособности также можно включать в пользовательские политики оценки работоспособности (политики, которые применяются только в ходе определенной оценки).
> 
> 

По умолчанию Service Fabric применяется строгие правила (все компоненты должны быть исправны) иерархическую связь родитель потомок hello. Если хотя бы один из дочерних элементов hello одного события неработоспособности, родительский hello считается неработоспособным.

### <a name="cluster-health-policy"></a>Политика работоспособности кластера
Hello [политика работоспособности кластера](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy) — работоспособности кластера используется tooevaluate hello состояния и узел состояния работоспособности. можно определить политику Hello в манифесте кластера hello. Если он отсутствует, используется политика по умолчанию hello (ноль отклонения сбоев).
политика работоспособности кластера Hello содержит:

* [ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror). Указывает, является ли tootreat предупреждение отчеты о работоспособности как ошибки во время оценки работоспособности. По умолчанию: false.
* [MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications). Указывает максимальный процент отклонения hello приложений, которые могут иметь неработоспособное считался hello кластера по ошибке.
* [MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes). Указывает максимальный процент отклонения hello узлов, которые могут быть неработоспособное считался hello кластера по ошибке. В больших кластеров некоторые узлы всегда являются вниз или out для ремонта, поэтому этот процент должен быть настроенный tootolerate.
* [ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap). Hello работоспособности политики сопоставление типов можно использовать во время типов специальные приложения toodescribe оценки работоспособности кластера. По умолчанию все приложения помещаются в пул и оцениваются с помощью MaxPercentUnhealthyApplications. Некоторые типы приложений следует обрабатывать так, они могут быть взяты из глобального пула hello. Вместо этого они вычисляются для hello процентные показатели, связанные с их имя типа приложения hello-карте. Например, в кластере существуют тысячи приложений различных типов и несколько экземпляров управляющих приложений особого типа. приложения управления Hello никогда не должны быть в ошибке. Можно указать глобальный tootolerate % too20 MaxPercentUnhealthyApplications ошибками, но для hello тип приложения «ControlApplicationType» задайте hello MaxPercentUnhealthyApplications too0. Таким образом, если некоторые hello многие приложения находятся в неработоспособном состоянии, но ниже глобального процента неработоспособное hello, hello кластера будет вычислено tooWarning. Состояние "Предупреждение" не влияет на обновление кластера или другие операции мониторинга, вызванные состоянием "Ошибка". Однако хотя бы один элемент управления приложения в ошибки могут привести к невозможности кластера неработоспособен, который вызывает откат или приостанавливает hello обновление кластера, в зависимости от конфигурации обновления hello.
  Для hello приложения типов, определенных в карте hello все экземпляры приложения будут убраны из hello глобальный пул приложений. Они вычисляются на основе общего числа hello приложения типа приложения hello, с помощью hello сопоставление определенных MaxPercentUnhealthyApplications из hello. Все остальные hello приложения hello остаются в глобальный пул hello и оцениваются с MaxPercentUnhealthyApplications.

Привет, в следующем примере показан фрагмент кода из манифеста кластера. toodefine записей в hello сопоставление типов, префикс hello именем параметра «ApplicationTypeMaxPercentUnhealthyApplications-», за которым следует имя типа приложения hello.

```xml
<FabricSettings>
  <Section Name="HealthManager/ClusterHealthPolicy">
    <Parameter Name="ConsiderWarningAsError" Value="False" />
    <Parameter Name="MaxPercentUnhealthyApplications" Value="20" />
    <Parameter Name="MaxPercentUnhealthyNodes" Value="20" />
    <Parameter Name="ApplicationTypeMaxPercentUnhealthyApplications-ControlApplicationType" Value="0" />
  </Section>
</FabricSettings>
```

### <a name="application-health-policy"></a>Политика работоспособности приложения
Hello [политика работоспособности приложения](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy) описывает, как можно сделать hello вычисления статистической обработки событий и дочерних состояний для приложений и их дочерние элементы. Это может быть определено в манифесте приложения hello, **ApplicationManifest.xml**, в пакет приложения hello. Если политики не заданы, Service Fabric предполагается сущности hello неработоспособен, если у него есть, либо дочерний отчет о работоспособности на состояние работоспособности hello предупреждения или ошибки.
Ниже перечислены настраиваемые политики Hello.

* [ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx). Указывает, является ли tootreat предупреждение отчеты о работоспособности как ошибки во время оценки работоспособности. По умолчанию: false.
* [MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications). Указывает процент hello максимальное допустимое развернутых приложений, которые могут быть неработоспособное считался приложения hello по ошибке. Это процентное значение вычисляется путем деления hello число развернутых приложений за hello число узлов, которые приложения hello развернутых в настоящее время на кластере hello. Вычисление Hello округляет tootolerate один сбой на небольшом количестве узлов. Значение в процентах по умолчанию: ноль.
* [DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy). Указывает hello политика по умолчанию службы тип работоспособности, который заменяет hello политики работоспособности по умолчанию для всех типов служб в приложение hello.
* [ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap). Обеспечивает сопоставление политики работоспособности службы для каждого типа службы. Эти политики замените политик работоспособности тип службы по умолчанию hello для каждой службы указанного типа. Например если приложение имеет тип службы без сохранения состояния шлюза и типа службы с отслеживанием состояния ядра, hello политики работоспособности для их оценки можно настроить по-разному. При указании политики каждого типа службы, можно получить более детальный контроль работоспособности hello hello службы.

### <a name="service-type-health-policy"></a>Политика работоспособности типа службы
Hello [тип политики работоспособности службы](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy) определяет, как tooevaluate и статистическое выражение hello служб и hello дочерних элементов службы. политика Hello содержит:

* [MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice). Указывает процент hello максимальное допустимое неработоспособных разделов, прежде чем служба считается неработоспособным. Значение в процентах по умолчанию: ноль.
* [MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition). Указывает процент неработоспособных реплик hello максимальное допустимое перед секции считается неработоспособным. Значение в процентах по умолчанию: ноль.
* [MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices). Указывает максимальное допустимое hello процент неработоспособных служб перед приложения hello считается неработоспособным. Значение в процентах по умолчанию: ноль.

Следующий пример Hello представлен фрагмент из манифеста приложения.

```xml
    <Policies>
        <HealthPolicy ConsiderWarningAsError="true" MaxPercentUnhealthyDeployedApplications="20">
            <DefaultServiceTypeHealthPolicy
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="10"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="FrontEndServiceType"
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="20"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="BackEndServiceType"
                   MaxPercentUnhealthyServices="20"
                   MaxPercentUnhealthyPartitionsPerService="0"
                   MaxPercentUnhealthyReplicasPerPartition="0">
            </ServiceTypeHealthPolicy>
        </HealthPolicy>
    </Policies>
```

## <a name="health-evaluation"></a>Оценка работоспособности
Пользователи или автоматизированные службы могут оценивать работоспособность любых сущностей в любой момент времени. tooevaluate работоспособности сущности, статистические функции хранилища работоспособности hello работоспособности всех отчетов по сущности hello и оценивает все его дочерние элементы (если применимо). Hello работоспособности статистического алгоритма использует политики работоспособности, определяющие, как отчеты о работоспособности tooevaluate и как состояния работоспособности дочерних tooaggregate (если применимо).

### <a name="health-report-aggregation"></a>Агрегирование отчетов о работоспособности
Для каждой сущности в системе может существовать несколько отчетов, отправляемых из разных источников (системных компонентов или модулей наблюдения) и сформированных по разным правилам. использует статистическую Hello hello политики работоспособности, связанные, в частности hello члена ConsiderWarningAsError приложения или политика работоспособности кластера. Указывает ConsiderWarningAsError как tooevaluate предупреждения.

Hello общее состояние работоспособности инициируется hello *наихудшее* отчеты о работоспособности hello сущности. Если имеется хотя бы одна ошибка отчета о работоспособности, hello общее состояние работоспособности является ошибкой.

![Агрегирование отчетов о работоспособности с состоянием Error.][2]

Сущность оценки работоспособности, в отношении которой регистрируется один или несколько отчетов об ошибках, получает состояние "Ошибка". Hello то же верно для отчета о работоспособности истекшим сроком действия, независимо от их состояния работоспособности.

[2]: ./media/service-fabric-health-introduction/servicefabric-health-report-eval-error.png

Если нет отчеты об ошибках и одно или несколько предупреждений, hello общее состояние работоспособности — предупреждение или ошибку, в зависимости от флага политики ConsiderWarningAsError hello.

![Схема агрегирования отчетов о работоспособности, включающая отчет с состоянием Warning и флаг ConsiderWarningAsError со значением False.][3]

Работоспособность сводного отчета с отчетом предупреждение ConsiderWarningAsError набора toofalse (по умолчанию).

[3]: ./media/service-fabric-health-introduction/servicefabric-health-report-eval-warning.png

### <a name="child-health-aggregation"></a>Агрегирование данных о работоспособности дочерних элементов
Hello общее состояние работоспособности сущности отражает состояния работоспособности дочерних hello (если применимо). Статистическая обработка дочерних состояний работоспособности Hello алгоритм использует hello работоспособности политики, применимые на основе типа сущности hello.

![Агрегирование данных о работоспособности дочерних элементов.][4]

Агрегирование состояний дочерних элементов на основе политик работоспособности.

[4]: ./media/service-fabric-health-introduction/servicefabric-health-hierarchy-eval.png

После вычисления всех дочерних элементов hello хранилища работоспособности hello статистически обрабатывает их состояния работоспособности, основанные на процентах максимальное hello настроить неработоспособное дочерних элементов. Это процентное значение берется из hello политики на основе типа сущности и дочерних hello.

* Если все дочерние элементы имеют ОК состояния, состояние работоспособности дочерних статистическая обработка hello — ОК.
* Если дочерние элементы OK и состояния предупреждения работоспособность дочерних суммарный hello в состоянии предупреждения.
* При наличии дочерних элементов с состояния ошибки, которые не влияют на hello максимальный разрешенный процент неработоспособное дочерних элементов, hello общее состояние работоспособности является ошибкой.
* Если hello дочерние элементы с hello относительно состояний ошибки максимальный разрешенный процент неработоспособное дочерних hello общее состояние работоспособности — предупреждение.

## <a name="health-reporting"></a>Создание отчетов о работоспособности
Создавать отчеты для сущностей Service Fabric могут системные компоненты, приложения Service Fabric, а также внутренние и внешние модули мониторинга. сделать "создатели отчетов" Hello *локального* решения hello работоспособности отслеживаемых hello сущностей, на основе условий hello, они представляют собой наблюдения. Они не должны toolook в любом глобальное состояние или статистической обработки данных. Hello требуемого поведение — toohave простой "создатели отчетов" и сложный организмам, требующих какие сведения toosend toolook во многих tooinfer вещи.

toosend работоспособности toohello работоспособности хранилища данных отслеживания должен tooidentify hello затронутых сущности и создания отчета о работоспособности. toosend hello отчетов, используйте hello [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API-интерфейсы API, предоставляемым hello отчет о работоспособности `Partition` или `CodePackageActivationContext` объектов, командлеты PowerShell или REST.

### <a name="health-reports"></a>Отчеты о работоспособности
Hello [отчеты о работоспособности](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport) для каждой сущности hello в кластере hello содержат hello следующую информацию:

* **SourceId**. Строка, однозначно определяющее hello-формирования события работоспособности hello.
* **Entity identifier**. Определяет сущности hello, где применяется hello отчета. Он зависит от hello [тип сущности](service-fabric-health-introduction.md#health-entities-and-hierarchy):
  
  * Cluster. Отсутствует.
  * Node. Имя узла (строка).
  * приложение. Имя приложения (URI). Представляет имя экземпляра приложения hello, развернутым в кластере hello hello.
  * Service. Имя службы (URI). Представляет имя экземпляра службы hello, развернутым в кластере hello hello.
  * Partition. Идентификатор раздела (GUID). Представляет уникальный идентификатор секции hello.
  * Replica. Идентификатор реплики службы с отслеживанием состояния Hello или идентификатор экземпляра службы без отслеживания состояния hello (INT64).
  * DeployedApplication. Имя приложения (URI) и имя узла (строка).
  * DeployedServicePackage. Имя приложения (URI), имя узла (строка) и имя манифеста службы (строка).
* **Property**. Объект *строка* (фиксированный перечисления), позволяющий hello отслеживания работоспособности hello toocategorize событий для конкретного свойства сущности hello. Например формирования A можно отчетов работоспособности hello hello Node01 свойства «Хранилище» и формирования B можно отчетов работоспособности hello hello Node01 свойства «Подключения». В базе данных health store hello эти отчеты обрабатываются как события работоспособности отдельных для hello Node01 сущности.
* **Описание**. Строка, которая позволяет tooprovide отслеживания подробных сведений о событие работоспособности hello. **Идентификатор SourceId**, **свойство**, и **HealthState** полностью должно описывать hello отчета. Описание Hello Добавление восприятия сведения об отчете hello. текст Hello упрощает для администраторов и пользователей toounderstand hello отчет о работоспособности.
* **HealthState**. [Перечисления](service-fabric-health-introduction.md#health-states) , описывающее состояние работоспособности hello hello отчета. Hello приняты следующие значения: OK, предупреждения и ошибки.
* **TimeToLive**. Значение типа timespan, указывающее, сколько времени отчета о работоспособности hello является допустимым. В сочетании с **RemoveWhenExpired**, он позволяет hello базе данных health store знать, как tooevaluate истек срок действия события. По умолчанию бесконечное значение hello и навсегда hello отчета является допустимым.
* **RemoveWhenExpired**(кластер). Логическое значение. Если задать tootrue, hello работоспособности с истекшим сроком действия отчета автоматически удаляется из хранилища работоспособности hello и hello отчета не влияет оценки работоспособности сущности. При отчетов hello действителен в течение указанного периода только время и формирования отчетов hello не требуется tooexplicitly ее необходимо очистить. Также использовал toodelete отчеты из хранилища hello работоспособности (например, контрольного меняется и перестает отправлять отчеты с предыдущего источника и свойства). Он может отправить отчет, содержащий краткое TimeToLive вместе с RemoveWhenExpired tooclear копирование любого предыдущего состояния работоспособности магазине hello. Если значение hello toofalse, hello отчета с истекшим сроком действия рассматривается как ошибка оценки работоспособности hello. значение false Hello сигналы toohello базе данных health store источника hello периодически следует сообщать о данном свойстве. Если это не так, то необходимо быть сбоях в контрольного hello. Hello контрольного работоспособности фиксируется при рассмотрении hello событий как ошибку.
* **SequenceNumber**. Положительное целое число, который должен toobe увеличивающихся, он представляет порядок hello hello отчеты. Он используется hello работоспособности хранилища toodetect устаревших отчетов, которые были получены из-за задержки сети или других проблем с задержкой. Отчет будет отклонен, если hello порядковый номер меньше или равно hello номер последнего применения toohello для одной сущности, источник и свойства. Если не указан порядковый номер hello создается автоматически. Это необходимые tooput в hello порядковый номер, только в том случае, если отчеты о переходов между состояниями. В этом случае hello источник должен tooremember какие отчеты его отправки и хранения hello сведений для восстановления при отработке отказа.

Эти четыре параметра (SourceId, Entity Identifier, Property и HealthState) являются обязательными для всех отчетов. Идентификатор SourceId строка Hello не допускается toostart с префиксом hello»**системы.**», которой должна быть зарезервирована для системы отчетов. Для hello одной сущности имеется только один отчет для hello того же источника и свойства. Здравствуйте, несколько отчетов для одного источника и переопределения свойств друг с другом на hello работоспособности на стороне клиента (если они являются пакетными) или на стороне хранилища работоспособности hello. Замена Hello основан на последовательности чисел. новые отчеты (с большими порядковыми номерами) замените старые отчеты.

### <a name="health-events"></a>События работоспособности
На внутреннем уровне hello работоспособности хранилище поддерживает [события работоспособности](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent), содержащих все hello сведения из отчетов hello и дополнительных метаданных. Hello метаданные включают время hello hello отчет передан toohello работоспособности клиента и hello раз, когда он был изменен на стороне сервера hello. события работоспособности Hello возвращаемые [запросов о работоспособности](service-fabric-view-entities-aggregated-health.md#health-queries).

Hello добавлены метаданных содержит:

* **SourceUtcTimestamp**. отчет о hello Hello времени указано toohello работоспособности клиента (время по Гринвичу).
* **LastModifiedUtcTimestamp**. отчет hello Hello времени последнего изменения на стороне сервера hello (время по Гринвичу).
* **IsExpired**. Значение флага tooindicate ли отчет hello истечения срока действия при выполнении запроса hello хранилищем работоспособности hello. Срок действия события может истечь, только если флаг RemoveWhenExpired имеет значение False. В противном случае событие hello не возвращаются запросом и удаляется из хранилища hello.
* **LastOkTransitionAt**, **LastWarningTransitionAt**, **LastErrorTransitionAt**. Здравствуйте, время последнего переходов ОК или предупреждениями. Эти поля присвойте hello журнал hello переходы состояний работоспособности для событий hello.

Hello состояния перехода поля могут использоваться оптимизированное оповещения и сведения о событиях состояния «журнала». Возможные сценарии их использования.

* Генерирование предупреждения, если свойство находится в состоянии Warning или Error более X минут. Проверка условия hello в течение заданного времени позволяет избежать оповещения на временные условия. Например, предупреждение, если состояние работоспособности hello предупреждение более чем на пять минут могут быть переведены в (HealthState == предупреждение и теперь - LastWarningTransitionTime > 5 минут).
* Предупреждение, только на условия, которые были изменены в hello последнего X минут. Если отчет уже был при обнаружении ошибки перед hello указанного времени, может быть пропущено, так как он уже получил сигнал ранее.
* Если состояние свойства меняется с "Warning" на "Error" и обратно, можно определить, как долго сохраняется неработоспособность (т. е. состояние, отличное от "ОК"). Например, предупреждение, если более чем на пять минут не было работоспособное hello свойства могут быть переведены в (HealthState! = Ok и теперь - LastOkTransitionTime > 5 минут).

## <a name="example-report-and-evaluate-application-health"></a>Пример: отправка отчетов и оценка работоспособности приложения
Hello пример отправляет отчет о работоспособности с помощью PowerShell по приложения hello **fabric: / WordCount** из источника hello **MyWatchdog**. отчет о работоспособности Hello содержит сведения о свойстве работоспособности hello «доступность» в состоянии работоспособности ошибки с бесконечной TimeToLive. Затем запрашивается работоспособности приложения hello, возвращающий статистическая обработка ошибки состояния работоспособности и hello сообщила о работоспособности событий в списке hello событиями состояния.

```powershell
PS C:\> Send-ServiceFabricApplicationHealthReport –ApplicationName fabric:/WordCount –SourceId "MyWatchdog" –HealthProperty "Availability" –HealthState Error

PS C:\> Get-ServiceFabricApplicationHealth fabric:/WordCount -ExcludeHealthStatistics


ApplicationName                 : fabric:/WordCount
AggregatedHealthState           : Error
UnhealthyEvaluations            :
                                  Error event: SourceId='MyWatchdog', Property='Availability'.

ServiceHealthStates             :
                                  ServiceName           : fabric:/WordCount/WordCountService
                                  AggregatedHealthState : Error

                                  ServiceName           : fabric:/WordCount/WordCountWebService
                                  AggregatedHealthState : Ok

DeployedApplicationHealthStates :
                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_0
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_2
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_3
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_4
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_1
                                  AggregatedHealthState : Ok

HealthEvents                    :
                                  SourceId              : System.CM
                                  Property              : State
                                  HealthState           : Ok
                                  SequenceNumber        : 360
                                  SentAt                : 3/22/2016 7:56:53 PM
                                  ReceivedAt            : 3/22/2016 7:56:53 PM
                                  TTL                   : Infinite
                                  Description           : Application has been created.
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Error->Ok = 3/22/2016 7:56:53 PM, LastWarning = 1/1/0001 12:00:00 AM

                                  SourceId              : MyWatchdog
                                  Property              : Availability
                                  HealthState           : Error
                                  SequenceNumber        : 131032204762818013
                                  SentAt                : 3/23/2016 3:27:56 PM
                                  ReceivedAt            : 3/23/2016 3:27:56 PM
                                  TTL                   : Infinite
                                  Description           :
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Ok->Error = 3/23/2016 3:27:56 PM, LastWarning = 1/1/0001 12:00:00 AM
```

## <a name="health-model-usage"></a>Использование модели работоспособности
Модель работоспособности Hello позволяет облачных служб и hello базовой платформы tooscale Service Fabric, поскольку мониторинга и работоспособности решения расположены на разных мониторах hello в кластере hello.
Другие системы имеют централизованного службой на уровне кластера hello, который выполняет синтаксический анализ всех hello *потенциально* полезной информации, генерируемой служб. Такой подход затрудняет масштабирование, Он также не дает им toocollect toohelp идентифицировать проблемы и потенциальные проблемы как основной причины закрытия toohello максимально сведения.

Модель работоспособности Hello активно используется для наблюдения и диагностики, а также для оценки работоспособности кластера и приложения и для отслеживаемых обновлений. Другие службы использовать tooperform данных автоматическое восстановление работоспособности, построить журнал работоспособности кластера и выдавать предупреждения при определенных условиях.

## <a name="next-steps"></a>Дальнейшие действия
[Просмотр отчетов о работоспособности Service Fabric](service-fabric-view-entities-aggregated-health.md)

[Использование отчетов о работоспособности системы для устранения неполадок](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[Как tooreport и проверки службы работоспособности](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[Добавление настраиваемых отчетов о работоспособности Service Fabric](service-fabric-report-health.md)

[Мониторинг и диагностика состояния служб в локальной среде разработки](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[Обновление приложения Service Fabric](service-fabric-application-upgrade.md)

