---
title: "Анализ событий Azure Service Fabric с помощью Application Insights | Документы Майкрософт"
description: "Ознакомьтесь со сведениями о визуализации и анализе событий с использованием Application Insights для мониторинга и диагностики кластеров Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/26/2017
ms.author: dekapur
ms.openlocfilehash: 4085a607b800f4f4f155cdc266bc203b0858fd7c
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="event-analysis-and-visualization-with-application-insights"></a><span data-ttu-id="ae008-103">Анализ и визуализация событий с помощью Application Insights</span><span class="sxs-lookup"><span data-stu-id="ae008-103">Event analysis and visualization with Application Insights</span></span>

<span data-ttu-id="ae008-104">Azure Application Insights — это расширяемая платформа для отслеживания и диагностики приложений.</span><span class="sxs-lookup"><span data-stu-id="ae008-104">Azure Application Insights is an extensible platform for application monitoring and diagnostics.</span></span> <span data-ttu-id="ae008-105">Она включает в себя эффективное средство аналитики и запросов, настраиваемую панель мониторинга, визуализации и дополнительные параметры, включая автоматическое оповещение.</span><span class="sxs-lookup"><span data-stu-id="ae008-105">It includes a powerful analytics and querying tool, customizable dashboard and visualizations, and further options including automated alerting.</span></span> <span data-ttu-id="ae008-106">Это рекомендуемая платформа для отслеживания и диагностики приложений и служб Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="ae008-106">It is the recommended platform for monitoring and diagnostics for Service Fabric applications and services.</span></span>

## <a name="setting-up-application-insights"></a><span data-ttu-id="ae008-107">Настройка Application Insights</span><span class="sxs-lookup"><span data-stu-id="ae008-107">Setting up Application Insights</span></span>

### <a name="creating-an-ai-resource"></a><span data-ttu-id="ae008-108">Создание ресурса Application Insights</span><span class="sxs-lookup"><span data-stu-id="ae008-108">Creating an AI Resource</span></span>

<span data-ttu-id="ae008-109">Чтобы создать ресурс Application Insights, перейдите в Azure Marketplace и выполните поиск по запросу "Application Insights".</span><span class="sxs-lookup"><span data-stu-id="ae008-109">To create an AI resource, head over to the Azure Marketplace, and search for "Application Insights".</span></span> <span data-ttu-id="ae008-110">Требуемое решение должно быть первым в списке результатов (в категории "Интернет и мобильные устройства").</span><span class="sxs-lookup"><span data-stu-id="ae008-110">It should show up as the first solution (it is under category "Web + Mobile").</span></span> <span data-ttu-id="ae008-111">Нажмите кнопку **Создать** справа (убедитесь в том, что путь соответствует приведенной ниже иллюстрации).</span><span class="sxs-lookup"><span data-stu-id="ae008-111">Click **Create** when you are looking at the right resource (confirm that your path matches the image below).</span></span>

![Новый ресурс Application Insights](media/service-fabric-diagnostics-event-analysis-appinsights/create-new-ai-resource.png)

<span data-ttu-id="ae008-113">Для правильной подготовки ресурсов необходимо указать некоторые сведения.</span><span class="sxs-lookup"><span data-stu-id="ae008-113">You will need to fill out some information to provision the resource correctly.</span></span> <span data-ttu-id="ae008-114">В поле *Тип приложения* выберите значение "Веб-приложение ASP.NET", если вы будете использовать какую-либо из моделей программирования Service Fabric или публиковать приложение .NET в кластере.</span><span class="sxs-lookup"><span data-stu-id="ae008-114">In the *Application Type* field, use "ASP.NET web application" if you will be using any of Service Fabric's programming models or publishing a .NET application to the cluster.</span></span> <span data-ttu-id="ae008-115">Выберите значение "Общее", если вы будете развертывать гостевые исполняемые файлы и контейнеры.</span><span class="sxs-lookup"><span data-stu-id="ae008-115">Use "General" if you will be deploying guest executables and containers.</span></span> <span data-ttu-id="ae008-116">Как правило, по умолчанию следует использовать значение "Веб-приложение ASP.NET", чтобы параметры оставались доступными в будущем.</span><span class="sxs-lookup"><span data-stu-id="ae008-116">In general, default to using "ASP.NET web application" to keep your options open in the future.</span></span> <span data-ttu-id="ae008-117">Имя может быть любым на ваш выбор, а группу ресурсов и подписку можно изменить после развертывания ресурса.</span><span class="sxs-lookup"><span data-stu-id="ae008-117">The name is up to your preference, and both the resource group and subscription are changeable post-deployment of the resource.</span></span> <span data-ttu-id="ae008-118">Рекомендуется, чтоб ресурс Application Insights входил в ту же группу ресурсов , что и кластер.</span><span class="sxs-lookup"><span data-stu-id="ae008-118">We recommend that your AI resource is in the same resource group as your cluster.</span></span> <span data-ttu-id="ae008-119">Если вам требуются дополнительные сведения, ознакомьтесь с разделом [Создание ресурса Application Insights](../application-insights/app-insights-create-new-resource.md).</span><span class="sxs-lookup"><span data-stu-id="ae008-119">If you need more information, please see [Create an Application Insights resource](../application-insights/app-insights-create-new-resource.md)</span></span>

<span data-ttu-id="ae008-120">Для настройки Application Insights с помощью средства статистической обработки событий требуется ключ инструментирования Application Insights.</span><span class="sxs-lookup"><span data-stu-id="ae008-120">You need the AI Instrumentation Key to configure AI with your event aggregation tool.</span></span> <span data-ttu-id="ae008-121">После настройки ресурса Application Insights (занимает несколько минут после проверки развертывания) перейдите к нему и найдите раздел **Свойства** на левой панели навигации.</span><span class="sxs-lookup"><span data-stu-id="ae008-121">Once your AI resource is set up (takes a few minutes after the deployment is validated), navigate to it and find the **Properties** section on the left navigation bar.</span></span> <span data-ttu-id="ae008-122">Откроется новая колонка с *ключом инструментирования*.</span><span class="sxs-lookup"><span data-stu-id="ae008-122">A new blade will open up that shows an *INSTRUMENTATION KEY*.</span></span> <span data-ttu-id="ae008-123">Если необходимо изменить подписку или группу ресурсов, это также можно сделать здесь.</span><span class="sxs-lookup"><span data-stu-id="ae008-123">If you need to change the subscription or resource group of the resource, it can be done here as well.</span></span>

### <a name="configuring-ai-with-wad"></a><span data-ttu-id="ae008-124">Настройка Application Insights с помощью WAD</span><span class="sxs-lookup"><span data-stu-id="ae008-124">Configuring AI with WAD</span></span>

<span data-ttu-id="ae008-125">Существуют два основных способа отправки данных из WAD в Azure Application Insights, для обеспечения которой необходимо добавить приемник Application Insights в конфигурацию WAD, как описано в [этой статье](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span><span class="sxs-lookup"><span data-stu-id="ae008-125">There are two primary ways to send data from WAD to Azure AI, which is achieved by adding an AI sink to the WAD configuration, as detailed in [this article](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span></span>

#### <a name="add-an-ai-instrumentation-key-when-creating-a-cluster-in-azure-portal"></a><span data-ttu-id="ae008-126">Добавление ключа инструментирования Application Insights при создании кластера на портале Azure</span><span class="sxs-lookup"><span data-stu-id="ae008-126">Add an AI Instrumentation Key when creating a cluster in Azure portal</span></span>

![Добавление AIKey](media/service-fabric-diagnostics-event-analysis-appinsights/azure-enable-diagnostics.png)

<span data-ttu-id="ae008-128">Если при создании кластера диагностика включена, появляется дополнительное поле для ввода ключа инструментирования Application Insights.</span><span class="sxs-lookup"><span data-stu-id="ae008-128">When creating a cluster, if Diagnostics is turned "On", an optional field to enter an Application Insights Instrumentation key will show.</span></span> <span data-ttu-id="ae008-129">Если вставить в него ключ инструментирования Application Insights, приемник Application Insights будет автоматически настроен в шаблоне Resource Manager, используемом для развертывания кластера.</span><span class="sxs-lookup"><span data-stu-id="ae008-129">If you paste your AI IKey here, the AI sink will be automatically configured for you in the Resource Manager template that is used to deploy your cluster.</span></span>

#### <a name="add-the-ai-sink-to-the-resource-manager-template"></a><span data-ttu-id="ae008-130">Добавление приемника Application Insights в шаблон Resource Manager</span><span class="sxs-lookup"><span data-stu-id="ae008-130">Add the AI Sink to the Resource Manager template</span></span>

<span data-ttu-id="ae008-131">В разделе WadCfg шаблона Resource Manager добавьте приемник, внеся два указанных ниже изменения.</span><span class="sxs-lookup"><span data-stu-id="ae008-131">In the "WadCfg" of the Resource Manager template, add a "Sink" by including the following two changes:</span></span>

1. <span data-ttu-id="ae008-132">Добавьте конфигурацию приемника.</span><span class="sxs-lookup"><span data-stu-id="ae008-132">Add the sink configuration:</span></span>

    ```json
    "SinksConfig": {
        "Sink": [
            {
                "name": "applicationInsights",
                "ApplicationInsights": "***ADD INSTRUMENTATION KEY HERE***"
            }
        ]
    }

    ```

2. <span data-ttu-id="ae008-133">Включите приемник в DiagnosticMonitorConfiguration, добавив в подраздел DiagnosticMonitorConfiguration раздела WadCfg следующую строку:</span><span class="sxs-lookup"><span data-stu-id="ae008-133">Include the Sink in the DiagnosticMonitorConfiguration by adding the following line in "DiagnosticMonitorConfiguration" of the "WadCfg":</span></span>

    ```json
    "sinks": "applicationInsights"
    ```

<span data-ttu-id="ae008-134">В обоих приведенных выше фрагментах кода имя applicationInsights использовалось для указания приемника.</span><span class="sxs-lookup"><span data-stu-id="ae008-134">In both the code snippets above, the name "applicationInsights" was used to describe the sink.</span></span> <span data-ttu-id="ae008-135">Это не является обязательным. Если имя приемника включено в элемент sinks, именем может быть любая строка.</span><span class="sxs-lookup"><span data-stu-id="ae008-135">This is not a requirement and as long as the name of the sink is included in "sinks", you can set the name to any string.</span></span>

<span data-ttu-id="ae008-136">В настоящее время журналы кластера отображаются в средстве просмотра журналов Application Insights как трассировки.</span><span class="sxs-lookup"><span data-stu-id="ae008-136">Currently, logs from the cluster will show up as traces in AI's log viewer.</span></span> <span data-ttu-id="ae008-137">Так как большинство трассировок, поступающих с платформы, имеют уровень "Информационный", можно также изменить конфигурацию приемника так, чтобы отправлялись журналы только типа "Критический" или "Ошибка".</span><span class="sxs-lookup"><span data-stu-id="ae008-137">Since most of the traces coming from the platform are of level "Informational", you can also consider changing the sink configuration to only send logs of type "Critical" or "Error".</span></span> <span data-ttu-id="ae008-138">Для этого в приемник можно добавить каналы, как показано в [этой статье](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span><span class="sxs-lookup"><span data-stu-id="ae008-138">This can be done by adding "Channels" to your sink, as demonstrated in [this article](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span></span>

>[!NOTE]
><span data-ttu-id="ae008-139">При использовании неправильного ключа инструментирования Application Insights на портале или в шаблоне Resource Manager его необходимо поменять вручную, а затем обновить или повторно развернуть кластер.</span><span class="sxs-lookup"><span data-stu-id="ae008-139">If you use an incorrect AI IKey either in portal or in your Resource Manager template, you will have to manually change the key and update the cluster / redeploy it.</span></span> 

### <a name="configuring-ai-with-eventflow"></a><span data-ttu-id="ae008-140">Настройка Application Insights с помощью EventFlow</span><span class="sxs-lookup"><span data-stu-id="ae008-140">Configuring AI with EventFlow</span></span>

<span data-ttu-id="ae008-141">Если для статистической обработки событий используется EventFlow, импортируйте пакет NuGet `Microsoft.Diagnostics.EventFlow.Output.ApplicationInsights`.</span><span class="sxs-lookup"><span data-stu-id="ae008-141">If you are using EventFlow to aggregate events, make sure to import the `Microsoft.Diagnostics.EventFlow.Output.ApplicationInsights`NuGet package.</span></span> <span data-ttu-id="ae008-142">В раздел *outputs* файла *eventFlowConfig.json* необходимо включить следующий код:</span><span class="sxs-lookup"><span data-stu-id="ae008-142">The following has to be included in the *outputs* section of the *eventFlowConfig.json*:</span></span>

```json
"outputs": [
    {
        "type": "ApplicationInsights",
        // (replace the following value with your AI resource's instrumentation key)
        "instrumentationKey": "00000000-0000-0000-0000-000000000000"
    }
]
```

<span data-ttu-id="ae008-143">Обязательно внесите необходимые изменения в фильтры, а также включите все остальные входные данные (с соответствующими пакетами NuGet).</span><span class="sxs-lookup"><span data-stu-id="ae008-143">Make sure to make the required changes in your filters, as well as include any other inputs (along with their respective NuGet packages).</span></span>

## <a name="aisdk"></a><span data-ttu-id="ae008-144">AI.SDK</span><span class="sxs-lookup"><span data-stu-id="ae008-144">AI.SDK</span></span>

<span data-ttu-id="ae008-145">Как правило, в качестве решений для статистической обработки рекомендуется использовать EventFlow и WAD, так как они обеспечивают более модульный подход к диагностике и мониторингу, то есть если вы хотите изменить выходные данные EventFlow, изменять инструментирование не требуется. Достаточно внести простое изменение в файл конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ae008-145">It is generally recommended to use EventFlow and WAD as aggregation solutions, because they allow for a more modular approach to diagnostics and monitoring, i.e. if you want to change your outputs from EventFlow, it requires no change to your actual instrumentation, just a simple modification to your config file.</span></span> <span data-ttu-id="ae008-146">Однако если вы решите инвестировать в использование Application Insights и, скорее всего, не будете переходить на другую платформу, рассмотрите возможность применения нового пакета SDK для Application Insights с целью статистической обработки событий и отправки их в Application Insights.</span><span class="sxs-lookup"><span data-stu-id="ae008-146">If, however, you decide to invest in using Application Insights and are not likely to change to a different platform, you should look into using AI's new SDK for aggregating events and sending them to AI.</span></span> <span data-ttu-id="ae008-147">Таким образом, вам больше не придется настраивать EventFlow для отправки данных в Application Insights. Вместо этого вы установите пакет NuGet Service Fabric для Application Insights.</span><span class="sxs-lookup"><span data-stu-id="ae008-147">This means that you will no longer have to configure EventFlow to send your data to AI, but instead will install the ApplicationInsight's Service Fabric NuGet package.</span></span> <span data-ttu-id="ae008-148">Подробные сведения о пакете можно найти [здесь](https://github.com/Microsoft/ApplicationInsights-ServiceFabric).</span><span class="sxs-lookup"><span data-stu-id="ae008-148">Details on the package can be found [here](https://github.com/Microsoft/ApplicationInsights-ServiceFabric).</span></span>

<span data-ttu-id="ae008-149">На странице [Поддержка микрослужб и контейнеров в Application Insights](https://azure.microsoft.com/app-insights-microservices/) описываются некоторые новые возможности, над которыми ведется работа (в настоящее время они доступны в виде бета-версии) и которые расширяют набор встроенных параметров мониторинга в Application Insights.</span><span class="sxs-lookup"><span data-stu-id="ae008-149">[Application Insights support for Microservices and Containers](https://azure.microsoft.com/app-insights-microservices/) shows you some of the new features that are being worked on (currently still in beta), which allow you to have richer out-of-the-box monitoring options with AI.</span></span> <span data-ttu-id="ae008-150">Они включают в себя отслеживание зависимостей (используется при построении карты AppMap для всех служб и приложений в кластере и взаимосвязей между ними), а также улучшенное сопоставление трассировок, поступающих из служб (помогает выявлять проблемы в рабочем процессе приложения или службы).</span><span class="sxs-lookup"><span data-stu-id="ae008-150">These include dependency tracking (used in building an AppMap of all your services and applications in a cluster and the communication between them), and better correlation of traces coming from your services (helps in better pinpointing an issue in the workflow of an app or service).</span></span>

<span data-ttu-id="ae008-151">Если вы ведете разработку на .NET, скорее всего, будете использовать какие-либо модели программирования Service Fabric и хотите применять Application Insights в качестве платформы для визуализации и анализа данных событий и журналов, мы рекомендуем схему SDK для Application Insights в качестве рабочего процесса мониторинга и диагностики.</span><span class="sxs-lookup"><span data-stu-id="ae008-151">If you are developing in .NET and will likely be using some of Service Fabric's programming models, and are willing to use AI as your platform for visualizing and analyzing event and log data, then we recommend that you go via the AI SDK route as your monitoring and diagnostics workflow.</span></span> <span data-ttu-id="ae008-152">Чтобы приступить к использованию Application Insights для сбора и отображения журналов, ознакомьтесь с [этой](../application-insights/app-insights-asp-net-more.md) и [этой](../application-insights/app-insights-asp-net-trace-logs.md) статьями.</span><span class="sxs-lookup"><span data-stu-id="ae008-152">Read [this](../application-insights/app-insights-asp-net-more.md) and [this](../application-insights/app-insights-asp-net-trace-logs.md) to get started with using AI to collect and display your logs.</span></span>

## <a name="navigating-the-ai-resource-in-azure-portal"></a><span data-ttu-id="ae008-153">Навигация по ресурсу Application Insights на портале Azure</span><span class="sxs-lookup"><span data-stu-id="ae008-153">Navigating the AI resource in Azure portal</span></span>

<span data-ttu-id="ae008-154">После настройки Application Insights для вывода событий и журналов данные должны начать отображаться в ресурсе Application Insights через несколько минут.</span><span class="sxs-lookup"><span data-stu-id="ae008-154">Once you have configured AI as an output for your events and logs, information should start to show up in your AI resource in a few minutes.</span></span> <span data-ttu-id="ae008-155">Перейдите к ресурсу Application Insights. Должна открыться панель мониторинга ресурса Application Insights.</span><span class="sxs-lookup"><span data-stu-id="ae008-155">Navigate to the AI resource, which will take you to the AI resource dashboard.</span></span> <span data-ttu-id="ae008-156">На панели задач Application Insights щелкните **Поиск**, чтобы просмотреть последние полученные трассировки и при необходимости отфильтровать их.</span><span class="sxs-lookup"><span data-stu-id="ae008-156">Click **Search** in the AI taskbar to see the latest traces that it has received, and to be able to filter through them.</span></span>

<span data-ttu-id="ae008-157">*Обозреватель метрик* — это полезное средство для создания пользовательских панелей мониторинга на основе метрик, которые могут предоставляться приложениями, службами и кластером.</span><span class="sxs-lookup"><span data-stu-id="ae008-157">*Metrics Explorer* is a useful tool for creating custom dashboards based on metrics that your applications, services, and cluster may be reporting.</span></span> <span data-ttu-id="ae008-158">Сведения о настройке диаграмм на основе собираемых данных см. в статье [Исследование метрик в Application Insights](../application-insights/app-insights-metrics-explorer.md).</span><span class="sxs-lookup"><span data-stu-id="ae008-158">See [Exploring Metrics in Application Insights](../application-insights/app-insights-metrics-explorer.md) to set up a few charts for yourself based on the data you are collecting.</span></span>

<span data-ttu-id="ae008-159">Если щелкнуть **Аналитика**, откроется портал аналитики Application Insights, на котором доступно больше возможностей по запросу событий и трассировок.</span><span class="sxs-lookup"><span data-stu-id="ae008-159">Clicking **Analytics** will take you to the Application Insights Analytics portal, where you can query events and traces with greater scope and optionality.</span></span> <span data-ttu-id="ae008-160">Дополнительные сведения см. в статье [Аналитика в Application Insights](../application-insights/app-insights-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="ae008-160">Read more about this at [Analytics in Application Insights](../application-insights/app-insights-analytics.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="ae008-161">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ae008-161">Next steps</span></span>

* <span data-ttu-id="ae008-162">[Настройте оповещения в Application Insights](../application-insights/app-insights-alerts.md), чтобы узнавать об изменениях в производительности или характере использования.</span><span class="sxs-lookup"><span data-stu-id="ae008-162">[Set up Alerts in AI](../application-insights/app-insights-alerts.md) to be notified about changes in performance or usage</span></span>
* <span data-ttu-id="ae008-163">[Интеллектуальное обнаружение в Application Insights](../application-insights/app-insights-proactive-diagnostics.md) осуществляет упреждающий анализ данных телеметрии, отправляемых в Application Insights, и предупреждает о потенциальных проблемах с производительностью.</span><span class="sxs-lookup"><span data-stu-id="ae008-163">[Smart Detection in Application Insights](../application-insights/app-insights-proactive-diagnostics.md) performs a proactive analysis of the telemetry being sent to AI to warn you of potential performance problems</span></span>