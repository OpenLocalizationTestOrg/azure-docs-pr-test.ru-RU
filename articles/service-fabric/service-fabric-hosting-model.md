---
title: "Модель размещения Azure Service Fabric | Документация Майкрософт"
description: "В этой статье описывается связь между репликами (или экземплярами) развернутой службы Service Fabric и процессом размещения службы."
services: service-fabric
documentationcenter: .net
author: harahma
manager: timlt
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/15/2017
ms.author: harahma
ms.openlocfilehash: ca7092a06a9ffce8383ca8bc9f70ce312cdf9de4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="service-fabric-hosting-model"></a><span data-ttu-id="26d3b-103">Модель размещения Service Fabric</span><span class="sxs-lookup"><span data-stu-id="26d3b-103">Service Fabric hosting model</span></span>
<span data-ttu-id="26d3b-104">В этой статье представлен обзор моделей размещения приложений, предоставленных Service Fabric, и приведены различия между моделями **с общим** и **монопольным процессом**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-104">This article provides an overview of application hosting models provided by Service Fabric, and describes the differences between the **Shared Process** and **Exclusive Process** models.</span></span> <span data-ttu-id="26d3b-105">Здесь также описывается, как развернутое приложение выглядит на узле Service Fabric, и рассматриваются связи между репликами (или экземплярами) службы и процессом размещения служб.</span><span class="sxs-lookup"><span data-stu-id="26d3b-105">It describes how a deployed application looks on a Service Fabric node and relationship between replicas (or instances) of the service and the service-host process.</span></span>

<span data-ttu-id="26d3b-106">Прежде чем продолжить, убедитесь, что вы знакомы с [моделированием приложения Service Fabric][a1] и понимаете различные понятия и отношения между ними.</span><span class="sxs-lookup"><span data-stu-id="26d3b-106">Before proceeding further, make sure that you are familiar with [Service Fabric Application Model][a1] and understand various concepts and relation among them.</span></span> 

> [!NOTE]
> <span data-ttu-id="26d3b-107">Если явно не указано иное, для простоты в этой статье:</span><span class="sxs-lookup"><span data-stu-id="26d3b-107">In this article, for simplicity, unless explicitly mentioned:</span></span>
>
> - <span data-ttu-id="26d3b-108">все случаи использования слова *реплика* относятся к реплике службы с отслеживанием состояния или экземпляру службы без отслеживания состояния;</span><span class="sxs-lookup"><span data-stu-id="26d3b-108">All uses of word *replica* refers to both a replica of a stateful service or an instance of a statless service.</span></span>
> - <span data-ttu-id="26d3b-109">*CodePackage* считается эквивалентом процесса *ServiceHost*, который регистрирует *ServiceType* и размещает реплики служб этого *ServiceType*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-109">*CodePackage* is treated equivalent to *ServiceHost* process that registers a *ServiceType* and hosts replicas of services of that *ServiceType*.</span></span>
>

<span data-ttu-id="26d3b-110">Чтобы понять модель размещения, давайте подробно рассмотрим пример.</span><span class="sxs-lookup"><span data-stu-id="26d3b-110">To understand the hosting model, let us walk through an example.</span></span> <span data-ttu-id="26d3b-111">Допустим, у нас есть *тип приложения* MyAppType, который имеет *тип службы* MyServiceType, предоставляемый *пакетом службы* MyServicePackage, который имеет *пакет кода* MyCodePackage, регистрирующий при запуске *тип службы* MyServiceType.</span><span class="sxs-lookup"><span data-stu-id="26d3b-111">Let us say, we have an *ApplicationType* 'MyAppType' which has a *ServiceType* 'MyServiceType' which is provided by *ServicePackage* 'MyServicePackage' which has a *CodePackage* 'MyCodePackage' which registers *ServiceType* 'MyServiceType' when it runs.</span></span>

<span data-ttu-id="26d3b-112">Допустим, у нас есть кластер из 3 узлов и мы создаем *приложение* **fabric:/App1** типа MyAppType.</span><span class="sxs-lookup"><span data-stu-id="26d3b-112">Let's say we have a 3 node cluster and we create an *application* **fabric:/App1** of type 'MyAppType'.</span></span> <span data-ttu-id="26d3b-113">Внутри этого *приложения* **fabric:/App1** мы создаем службу **fabric:/App1/ServiceA** типа MyServiceType, которая имеет 2 раздела (например, **P1** & **P2**) с 3 репликами на каждый.</span><span class="sxs-lookup"><span data-stu-id="26d3b-113">Inside this *application* **fabric:/App1** we create a service **fabric:/App1/ServiceA** of type 'MyServiceType' which has 2 partitions (say **P1** & **P2**) and 3 replicas per partition.</span></span> <span data-ttu-id="26d3b-114">На следующей схеме показано представление этого приложения, развернутого на узле.</span><span class="sxs-lookup"><span data-stu-id="26d3b-114">The following diagram shows the view of this application as it ends up deployed on a node.</span></span>

<span data-ttu-id="26d3b-115"><center>
![Представление узла развернутого приложения][node-view-one]
</center></span><span class="sxs-lookup"><span data-stu-id="26d3b-115"><center>
![Node view of deployed application][node-view-one]
</center></span></span>

<span data-ttu-id="26d3b-116">Service Fabric активирует MyServicePackage, который запустил MyCodePackage, где размещаются реплики из обоих разделов, т. е. **P1** & **P2**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-116">Service Fabric activated 'MyServicePackage' which started 'MyCodePackage' which is hosting replicas from both the partitions i.e. **P1** & **P2**.</span></span> <span data-ttu-id="26d3b-117">Обратите внимание, что все узлы в кластере будут иметь одинаковое представление, так как мы выбрали число реплик на раздел равное числу узлов в кластере.</span><span class="sxs-lookup"><span data-stu-id="26d3b-117">Note that all the nodes in the cluster will have same view since we chose number of replicas per partition equal to number of nodes in the cluster.</span></span> <span data-ttu-id="26d3b-118">Давайте создадим другую службу **fabric:/App1/ServiceB** в приложении **fabric:/App1**, которая имеет 1 раздел (например, **P3**) с 3 репликами.</span><span class="sxs-lookup"><span data-stu-id="26d3b-118">Let's create another service **fabric:/App1/ServiceB** in application **fabric:/App1** which has 1 partition (say **P3**) and 3 replicas per partition.</span></span> <span data-ttu-id="26d3b-119">На следующей схеме показано новое представление узла.</span><span class="sxs-lookup"><span data-stu-id="26d3b-119">Following diagram shows the new view on the node:</span></span>

<span data-ttu-id="26d3b-120"><center>
![Представление узла развернутого приложения][node-view-two]
</center></span><span class="sxs-lookup"><span data-stu-id="26d3b-120"><center>
![Node view of deployed application][node-view-two]
</center></span></span>

<span data-ttu-id="26d3b-121">Как мы видим, Service Fabric поместил новую реплику раздела **P3** службы **fabric:/App1/ServiceB** в существующую активацию MyServicePackage.</span><span class="sxs-lookup"><span data-stu-id="26d3b-121">As we can see Service Fabric placed the new replica for partition **P3** of service **fabric:/App1/ServiceB** in the existing activation of 'MyServicePackage'.</span></span> <span data-ttu-id="26d3b-122">Теперь создадим другое *приложение* **fabric:/App2** типа MyAppType, а внутри **fabric:/App2** создадим службу **fabric:/App2/ServiceA**, которая имеет 2 раздела (например, **P4** & **P5**) с 3 репликами на каждый.</span><span class="sxs-lookup"><span data-stu-id="26d3b-122">Now lets create another *application* **fabric:/App2** of type 'MyAppType' and inside **fabric:/App2** create service **fabric:/App2/ServiceA** which has 2 partitions (say **P4** & **P5**) and 3 replicas per partition.</span></span> <span data-ttu-id="26d3b-123">На следующих схемах показано новое представление узла:</span><span class="sxs-lookup"><span data-stu-id="26d3b-123">Following diagrams shows the new node view:</span></span>

<span data-ttu-id="26d3b-124"><center>
![Представление узла развернутого приложения][node-view-three]
</center></span><span class="sxs-lookup"><span data-stu-id="26d3b-124"><center>
![Node view of deployed application][node-view-three]
</center></span></span>

<span data-ttu-id="26d3b-125">На этот раз Service Fabric активировал новую копию MyServicePackage, которая запускает новую копию MyCodePackage, а реплики из обоих разделов службы **fabric:/App2/ServiceA** (т. е. **P4** & **P5**) размещаются в этой новой копии MyCodePackage.</span><span class="sxs-lookup"><span data-stu-id="26d3b-125">This time Service Fabric has activated a new copy of 'MyServicePackage' which starts a new copy of 'MyCodePackage' and replicas from both partitions of service **fabric:/App2/ServiceA** (i.e. **P4** & **P5**) are placed in this new copy 'MyCodePackage'.</span></span>

## <a name="shared-process-model"></a><span data-ttu-id="26d3b-126">Модель с общим процессом</span><span class="sxs-lookup"><span data-stu-id="26d3b-126">Shared process model</span></span>
<span data-ttu-id="26d3b-127">Выше была описана модель размещения по умолчанию, предоставляемая службой Service Fabric, которая называется моделью **с общим процессом**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-127">What we saw above is the default hosting model provided by Service Fabric and is referred to as **Shared Process** model.</span></span> <span data-ttu-id="26d3b-128">В этой модели для заданного *приложения* активируется только одна копия заданного *ServicePackage* на *узле* (которая запускает все содержащиеся в ней пакеты *CodePackage*), а все реплики всех служб заданного *ServiceType* размещаются в *CodePackage*, который регистрирует *ServiceType*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-128">In this model, for a given *application*, only one copy of a given *ServicePackage* is activated on a *Node* (which starts all the *CodePackages* contained in it) and all the replicas of all services of a given  *ServiceType* are placed in the *CodePackage* that registers that *ServiceType*.</span></span> <span data-ttu-id="26d3b-129">Другими словами, все реплики всех служб заданного *ServiceType* совместно используют один процесс.</span><span class="sxs-lookup"><span data-stu-id="26d3b-129">In other words, all the replicas of all services of a given *ServiceType* share the same process.</span></span>

## <a name="exclusive-process-model"></a><span data-ttu-id="26d3b-130">Модель с монопольным процессом</span><span class="sxs-lookup"><span data-stu-id="26d3b-130">Exclusive process model</span></span>
<span data-ttu-id="26d3b-131">Другой моделью размещения, представляемой Service Fabric, является модель с **монопольным процессом**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-131">The other hosting model provided by Service Fabric is **Exclusive Process** model.</span></span> <span data-ttu-id="26d3b-132">В этой модели на заданном *узле* для размещения каждой реплики Service Fabric активирует новую копию *ServicePackage* (которая запускает все содержащиеся в ней пакеты *CodePackage*), а реплика размещается в *CodePackage*, который регистрирует *ServiceType* службы, к которой принадлежит реплика.</span><span class="sxs-lookup"><span data-stu-id="26d3b-132">In this model, on a given *Node*, for placing each replica, Service Fabric activates a new copy of *ServicePackage* (which starts all the *CodePackages* contained in it) and replica is placed in the *CodePackage* that registered the *ServiceType* of the service to which replica belongs.</span></span> <span data-ttu-id="26d3b-133">Другими словами, каждая реплика находится в отдельном выделенном процессе.</span><span class="sxs-lookup"><span data-stu-id="26d3b-133">In other words, each replica lives in its own dedicated process.</span></span> 

<span data-ttu-id="26d3b-134">Эта модель поддерживается в Service Fabric, начиная с версии 5.6.</span><span class="sxs-lookup"><span data-stu-id="26d3b-134">This model is supported starting version 5.6 of Service Fabric.</span></span> <span data-ttu-id="26d3b-135">Модель с **монопольным процессом** можно выбрать во время создания службы (с помощью [PowerShell][p1], [REST][r1] или [FabricClient][c1]), указав для параметра **ServicePackageActivationMode** значение ExclusiveProcess.</span><span class="sxs-lookup"><span data-stu-id="26d3b-135">**Exclusive Process** model can be chosen at the time of creating the service (using [PowerShell][p1], [REST][r1] or [FabricClient][c1]) by specifying **ServicePackageActivationMode** as 'ExclusiveProcess'.</span></span>

```powershell
PS C:\>New-ServiceFabricService -ApplicationName "fabric:/App1" -ServiceName "fabric:/App1/ServiceA" -ServiceTypeName "MyServiceType" -Stateless -PartitionSchemeSingleton -InstanceCount -1 -ServicePackageActivationMode "ExclusiveProcess"
```

```csharp
var serviceDescription = new StatelessServiceDescription
{
    ApplicationName = new Uri("fabric:/App1"),
    ServiceName = new Uri("fabric:/App1/ServiceA"),
    ServiceTypeName = "MyServiceType",
    PartitionSchemeDescription = new SingletonPartitionSchemeDescription(),
    InstanceCount = -1,
    ServicePackageActivationMode = ServicePackageActivationMode.ExclusiveProcess
};

var fabricClient = new FabricClient(clusterEndpoints);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="26d3b-136">Если в манифесте приложения указана служба по умолчанию, можно выбрать модель с **монопольным процессом**, указав атрибут **ServicePackageActivationMode**, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="26d3b-136">If you have a default service in your application manifest, you can choose **Exclusive Process** model by specifying **ServicePackageActivationMode** attribute as shown below:</span></span>

```xml
<DefaultServices>
  <Service Name="MyService" ServicePackageActivationMode="ExclusiveProcess">
    <StatelessService ServiceTypeName="MyServiceType" InstanceCount="1">
      <SingletonPartition/>
    </StatelessService>
  </Service>
</DefaultServices>
```
<span data-ttu-id="26d3b-137">Далее создадим другую службу **fabric:/App1/ServiceC** в приложении **fabric:/App1**, которая имеет 2 раздела (например, **P6** & **P7**) с 3 репликами на каждый со значением параметра **ServicePackageActivationMode** равным ExclusiveProcess.</span><span class="sxs-lookup"><span data-stu-id="26d3b-137">Continuing with our example above, lets create another service **fabric:/App1/ServiceC** in application **fabric:/App1** which has 2 partitions (say **P6** & **P7**) and 3 replicas per partition with **ServicePackageActivationMode** set to 'ExclusiveProcess'.</span></span> <span data-ttu-id="26d3b-138">На следующей схеме показано новое представление узла.</span><span class="sxs-lookup"><span data-stu-id="26d3b-138">Following diagram shows new view on the node:</span></span>

<span data-ttu-id="26d3b-139"><center>
![Представление узла развернутого приложения][node-view-four]
</center></span><span class="sxs-lookup"><span data-stu-id="26d3b-139"><center>
![Node view of deployed application][node-view-four]
</center></span></span>

<span data-ttu-id="26d3b-140">Как видите, Service Fabric активировал две новые копии MyServicePackage (по одной на каждую реплику из раздела **P6** & **P7**) и разместил каждую реплику в выделенную копию *CodePackage*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-140">As you can see, Service Fabric activated two new copies of 'MyServicePackage' (one for each replica from partition **P6** & **P7**) and placed each replica in its dedicated copy of *CodePackage*.</span></span> <span data-ttu-id="26d3b-141">Также следует помнить, что при использовании модели с **монопольным процессом** для заданного *приложения* на *узле* могут быть активны несколько копий заданного *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-141">Another thing to note here is, when **Exclusive Process** model is used, for a given *application*, multiple copies of a given *ServicePackage* can be active on a *Node*.</span></span> <span data-ttu-id="26d3b-142">В предыдущем примере мы видим, что для **fabric:/App1** активны три копии MyServicePackage.</span><span class="sxs-lookup"><span data-stu-id="26d3b-142">In above example, we see that three copies of 'MyServicePackage' are active for **fabric:/App1**.</span></span> <span data-ttu-id="26d3b-143">Каждая из этих активных копий MyServicePackage имеет связанный с ней **ServicePackageAtivationId**, который определяет эту копию в *приложении* **fabric:/App1**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-143">Each of these active copies of 'MyServicePackage' has a **ServicePackageAtivationId** associated with it which identifies that copy within *application* **fabric:/App1**.</span></span>

<span data-ttu-id="26d3b-144">Если для *приложения* (например, **fabric:/App2** в предыдущем примере) используется только модель с **общим процессом**, на *узле* будет только один активный экземпляр *ServicePackage*, а значение **ServicePackageAtivationId** для этой активации *ServicePackage* будет соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="26d3b-144">When only **Shared Process** model is used for an *application*, like **fabric:/App2** in above example, there is only one active copy of *ServicePackage* on a *Node* and **ServicePackageAtivationId** for this activation of *ServicePackage* is 'empty string'.</span></span>

> [!NOTE]
>- <span data-ttu-id="26d3b-145">Модель размещения с **общим процессом** используется, когда для параметра **ServicePackageActivationMode** задано значение **SharedProcess**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-145">**Shared Process** hosting model corresponds to **ServicePackageAtivationMode** equal **SharedProcess**.</span></span> <span data-ttu-id="26d3b-146">Это модель размещения по умолчанию, поэтому во время создания службы необходимо указать значение **ServicePackageActivationMode**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-146">This is the default hosting model and **ServicePackageAtivationMode** need not be specified at the time of creating the service.</span></span>
>
>- <span data-ttu-id="26d3b-147">Модель размещения с **монопольным процессом** используется, когда для параметра **ServicePackageActivationMode** явно задано значение **ExclusiveProcess** во время создания службы.</span><span class="sxs-lookup"><span data-stu-id="26d3b-147">**Exclusive Process** hosting model corresponds to **ServicePackageAtivationMode** equal **ExclusiveProcess** and need to be explicitly specified at the time of creating the service.</span></span> 
>
>- <span data-ttu-id="26d3b-148">Модель размещения службы можно узнать, запросив [описание службы][p2], где нужно просмотреть значение **ServicePackageActivationMode**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-148">Hosting model of a service can be known by querying the [service description][p2] and looking at value of **ServicePackageAtivationMode**.</span></span>
>
>

## <a name="working-with-deployed-service-package"></a><span data-ttu-id="26d3b-149">Работа с развернутым пакетом службы</span><span class="sxs-lookup"><span data-stu-id="26d3b-149">Working with deployed service package</span></span>
<span data-ttu-id="26d3b-150">Активная копия *ServicePackage* на узле называется [развернутым пакетом службы][p3].</span><span class="sxs-lookup"><span data-stu-id="26d3b-150">An active copy of a *ServicePackage* on a node is referred as [deployed service package][p3].</span></span> <span data-ttu-id="26d3b-151">Как упоминалось выше, когда для создания служб используется модель с **монопольным процессом**, для заданного *приложения* можно развернуть несколько пакетов служб одного *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-151">As previously mentioned above, when **Exclusive Process** model is used for creating services, for a given *application*, there could be multiple deployed service packages for the same *ServicePackage*.</span></span> <span data-ttu-id="26d3b-152">Во время выполнения операций, относящихся к развернутому пакету службы (например, [отправки сведений о работоспособности развернутого пакета службы][p4] или при [перезапуске пакета кода развернутого пакета службы][p5]), необходимо предоставить значение **ServicePackageActivationId** для идентификации конкретного развернутого пакета службы.</span><span class="sxs-lookup"><span data-stu-id="26d3b-152">While performing operations specific to deployed service package like [reporting health of a deployed service package][p4] or [restarting code package of a deployed service package][p5] etc., **ServicePackageActivationId** needs to be provided to identify a specific deployed service package.</span></span>

 <span data-ttu-id="26d3b-153">**ServicePackageActivationId** развернутого пакета службы можно получить, запросив список [развернутых пакетов служб][p3] на узле.</span><span class="sxs-lookup"><span data-stu-id="26d3b-153">**ServicePackageActivationId** of a deployed service package can be obtained by querying the list of [deployed service packages][p3] on a node.</span></span> <span data-ttu-id="26d3b-154">При запросе [типов развернутых служб][p6], [развернутых реплик][p7] и [развернутых пакетов кода][p8] на узле результат запроса также содержит значение **ServicePackageActivationId** родительского развернутого пакета службы.</span><span class="sxs-lookup"><span data-stu-id="26d3b-154">When querying [deployed service types][p6], [deployed replicas][p7] and [deployed code packages][p8] on a node, the query result also contains the **ServicePackageActivationId** of parent deployed service package.</span></span>

> [!NOTE]
>- <span data-ttu-id="26d3b-155">В модели размещения с **общим процессом** на заданном *узле* заданного *приложения* активируется только одна копия *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-155">Under **Shared Process** hosting model, on a given *node*, for a given *application*, only one copy of a *ServicePackage* is activated.</span></span> <span data-ttu-id="26d3b-156">При этом параметр **ServicePackageActivationId** соответствует *пустой строке*, и его необходимо указать при выполнении операций, связанных с развернутым пакетом службы.</span><span class="sxs-lookup"><span data-stu-id="26d3b-156">It has **ServicePackageActivationId** equal to *empty string* and need not be specified while performing deployed service package related operations.</span></span> 
>
> - <span data-ttu-id="26d3b-157">В модели размещения с **монопольным процессом** на заданном *узле* заданного *приложения* активируется одна или несколько копий *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-157">Under **Exclusive Process** hosting model, on a given *node*, for a given *application*, one or more copies of a *ServicePackage* can be active.</span></span> <span data-ttu-id="26d3b-158">Каждая активация имеет *непустое* значение **ServicePackageActivationId**, которое необходимо указать при выполнении операций, связанных с развернутым пакетом службы.</span><span class="sxs-lookup"><span data-stu-id="26d3b-158">Each activation has a *non-empty* **ServicePackageActivationId** and needs to be specified while performing deployed service package related operations.</span></span> 
>
> - <span data-ttu-id="26d3b-159">Если значение **ServicePackageActivationId** опущено, по умолчанию используется пустая строка.</span><span class="sxs-lookup"><span data-stu-id="26d3b-159">If **ServicePackageActivationId** is ommited it defaults to 'empty string'.</span></span> <span data-ttu-id="26d3b-160">При наличии развернутого пакета службы, который был активирован с помощью модели с **общим процессом**, операция будет выполняться с ним. В противном случае операция завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="26d3b-160">If a deployed service package that was activated under **Shared Process** model is present, then operation will be performed on it, otherwise the operation will fail.</span></span>
>
> - <span data-ttu-id="26d3b-161">Не рекомендуется выполнять один запрос и кэшировать значение **ServicePackageActivationId**, так как оно создается динамически и может изменяться по различным причинам.</span><span class="sxs-lookup"><span data-stu-id="26d3b-161">It is not recommended to query once and cache **ServicePackageActivationId** as it is dynamically generated and can change for various reasons.</span></span> <span data-ttu-id="26d3b-162">Перед выполнением операции, для которой требуется значение **ServicePackageActivationId**, сначала следует запросить список [развернутых пакетов служб][p3] на узле, а затем использовать значение *ServicePackageActivationId** из результата запроса для выполнения исходной операции.</span><span class="sxs-lookup"><span data-stu-id="26d3b-162">Before performing an operation that needs **ServicePackageActivationId**, you should first query the list of [deployed service packages][p3] on a node and then use *ServicePackageActivationId** from query result to perform the original operation.</span></span>
>
>

## <a name="guest-executable-and-container-applications"></a><span data-ttu-id="26d3b-163">Гостевые исполняемые приложения и приложения-контейнеры</span><span class="sxs-lookup"><span data-stu-id="26d3b-163">Guest executable and container applications</span></span>
<span data-ttu-id="26d3b-164">Service Fabric рассматривает [гостевые исполняемые приложения][a2] и [приложения-контейнеры][a3] в качестве служб без отслеживания состояния, которые являются самодостаточными, т. е. для них в *ServiceHost* (в процессе или контейнере) нет среды выполнения Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="26d3b-164">Service Fabric treats [Guest executable][a2] and [container][a3] applications as statless services which are self-contained i.e. there is no Service Fabric runtime in *ServiceHost* (a process or container).</span></span> <span data-ttu-id="26d3b-165">Так как эти службы являются самодостаточными, для этих служб число реплик на *ServiceHost* неприменимо.</span><span class="sxs-lookup"><span data-stu-id="26d3b-165">Since these services are self-contained, number of replicas per *ServiceHost* is not applicable for these services.</span></span> <span data-ttu-id="26d3b-166">Самая распространенная конфигурация, которая используется с этими службами, — один раздел со значением [InstanceCount][c2] равным -1 (т. е. с одной копией кода службы на каждом узле кластера).</span><span class="sxs-lookup"><span data-stu-id="26d3b-166">The most common configuration used with these services is single-partition with [InstanceCount][c2] equal to -1 (i.e. one copy of the service code running on each node of cluster).</span></span> 

<span data-ttu-id="26d3b-167">Значением **ServicePackageActivationMode** по умолчанию для этих служб является **SharedProcess**. В этом случае для заданного *приложения* Service Fabric активирует только одну копию *ServicePackage* на *узле*. Это означает, что на *узле* будет выполняться только одна копия кода службы.</span><span class="sxs-lookup"><span data-stu-id="26d3b-167">The default **ServicePackageActivationMode** for these services is **SharedProcess** in which case Service Fabric only activates one copy of *ServicePackage* on a *Node* for a given *application* which means only one copy of service code will run a *Node*.</span></span> <span data-ttu-id="26d3b-168">Если на *узле* требуется запустить несколько копий кода службы при создании нескольких служб (от *Service1* до *ServiceN*) *ServiceType* (указанного в *ServiceManifest*) или если служба имеет несколько разделов, во время создания службы для параметра **ServicePackageActivationMode** необходимо задать значение **ExclusiveProcess**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-168">If you want multiple copies of your service code to run on a *Node* when you create multiple services (*Service1* to *ServiceN*) of *ServiceType* (specified in *ServiceManifest*) or when your service is multi-partitioned, you should specify **ServicePackageActivationMode** as **ExclusiveProcess** at the time of creating the service.</span></span>

## <a name="changing-hosting-model-of-an-existing-service"></a><span data-ttu-id="26d3b-169">Изменение модели размещения существующей службы</span><span class="sxs-lookup"><span data-stu-id="26d3b-169">Changing hosting model of an existing service</span></span>
<span data-ttu-id="26d3b-170">Изменение модели размещения существующей службы с модели с **общим процессом** на модель с **монопольным процессом** и наоборот путем установки новой версии или обновления (или в спецификации службы по умолчанию в манифесте приложения) в настоящее время не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="26d3b-170">Changing hosting model of an existing service from **Shared Process** to **Exclusive Process** and vice-versa through upgrade or update mechanism (or in default service specification in application manifest) is currently not supported.</span></span> <span data-ttu-id="26d3b-171">Поддержка этой функции будет реализована в будущих версиях.</span><span class="sxs-lookup"><span data-stu-id="26d3b-171">Support for this feature will come in future versions.</span></span>

## <a name="choosing-between-shared-process-and-exclusive-process-model"></a><span data-ttu-id="26d3b-172">Выбор между моделями с общим и монопольным процессом</span><span class="sxs-lookup"><span data-stu-id="26d3b-172">Choosing between shared process and exclusive process model</span></span>
<span data-ttu-id="26d3b-173">Обе эти модели размещения имеют свои преимущества и недостатки, которые необходимо взвесить, чтобы понять, какая из них лучше всего соответствует требованиям.</span><span class="sxs-lookup"><span data-stu-id="26d3b-173">Both these hosting models have its pros and cons and user needs to evaluate which one fits their requirements best.</span></span> <span data-ttu-id="26d3b-174">Модель с **общим процессом** обеспечивает более эффективное использование ресурсов операционной системы, так как создается меньшее число процессов, несколько реплик в одном процессе могут совместно использовать порты и т. д. Тем не менее, если в одной из реплик возникает ошибка, при которой ей придется отключить узел службы, это затронет все реплики в одном процессе.</span><span class="sxs-lookup"><span data-stu-id="26d3b-174">**Shared Process** model enables better utilization of OS resources because fewer processes are spawned, multiple replicas in the same process can share ports, etc. However, if one of the replicas hits an error where it needs to bring down the service host, it will impact all other replicas in same process.</span></span>

 <span data-ttu-id="26d3b-175">Модель с **монопольным процессом** обеспечивает лучшую изоляцию каждой реплики в своем собственном процессе. Таким образом, некорректно работающая реплика не влияет на другие реплики.</span><span class="sxs-lookup"><span data-stu-id="26d3b-175">**Exclusive Process** model provides better isolation with every replica in its own process and a misbehaving replica will not impact other replicas.</span></span> <span data-ttu-id="26d3b-176">Это подходит для тех случаев, когда протокол связи не поддерживает совместное использование порта.</span><span class="sxs-lookup"><span data-stu-id="26d3b-176">It comes in handy for cases where port sharing is not supported by the communication protocol.</span></span> <span data-ttu-id="26d3b-177">Эта модель обеспечивает возможность управления ресурсами на уровне реплики.</span><span class="sxs-lookup"><span data-stu-id="26d3b-177">It facilitates the ability to apply resource governance at replica level.</span></span> <span data-ttu-id="26d3b-178">С другой стороны, **монопольный процесс** потребляет больше ресурсов ОС, так как для каждой реплики на узле создается один процесс.</span><span class="sxs-lookup"><span data-stu-id="26d3b-178">On the other hand, **Exclusive Process** will consume more OS resources as it spawns one process for each replica on the node.</span></span>

## <a name="exclusive-process-model-and-application-model-considerations"></a><span data-ttu-id="26d3b-179">Рекомендации по модели с монопольным процессом и модели приложения</span><span class="sxs-lookup"><span data-stu-id="26d3b-179">Exclusive process model and application model considerations</span></span>
<span data-ttu-id="26d3b-180">Для моделирования приложений в Service Fabric рекомендуется иметь один *ServiceType* для каждого *ServicePackage*, так как эта модель хорошо подходит для большинства приложений.</span><span class="sxs-lookup"><span data-stu-id="26d3b-180">The recommended way to model your application in Service Fabric is to keep one *ServiceType* per *ServicePackage* and this model works well for most of the applications.</span></span> 

<span data-ttu-id="26d3b-181">Тем не менее в особых случаях, когда использование одного *ServiceType* для каждого *ServicePackage* может быть нежелательно, Service Fabric позволяет иметь несколько *ServiceType* для каждого *ServicePackage* (также один *CodePackage* может зарегистрировать несколько *ServiceType*).</span><span class="sxs-lookup"><span data-stu-id="26d3b-181">However, to enable special scenarios where one *ServiceType* per *ServicePackage* may not be desirable, functionally, Service Fabric allows to have more than one *ServiceType* per *ServicePackage* (and one *CodePackage* can register more than one *ServiceType*).</span></span> <span data-ttu-id="26d3b-182">Ниже приведены некоторые сценарии, в которых можно использовать эти конфигурации:</span><span class="sxs-lookup"><span data-stu-id="26d3b-182">Following are some of the scenarios where these configurations can be useful:</span></span>

- <span data-ttu-id="26d3b-183">Необходимо оптимизировать использование ресурсов ОС за счет запуска меньшего числа процессов с более высокой плотностью реплик для каждого из них.</span><span class="sxs-lookup"><span data-stu-id="26d3b-183">You want to optimize OS resource utilization by spawning fewer processes and having higher replica density per process.</span></span>
- <span data-ttu-id="26d3b-184">Реплики различных ServiceType должны совместно использовать некоторые общие данные с высоким потреблением памяти или затратами на инициализацию.</span><span class="sxs-lookup"><span data-stu-id="26d3b-184">Replicas from different ServiceTypes need to share some common data that has a high initialization or memory cost.</span></span>
- <span data-ttu-id="26d3b-185">У вас есть предложение с бесплатной службой, и вы хотите установить ограничение на использование ресурсов путем размещения всех реплик службы в один процесс.</span><span class="sxs-lookup"><span data-stu-id="26d3b-185">You have a free service offering and you want to put a limit on resource utilization by putting all replicas of the service in same process.</span></span>

<span data-ttu-id="26d3b-186">Модель размещения с **монопольным процессом** не согласуется с моделью приложения, которая имеет несколько типов *ServiceType* для каждого *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-186">**Exclusive Process** hosting model is not coherent with application model having multiple *ServiceTypes* per *ServicePackage*.</span></span> <span data-ttu-id="26d3b-187">Это обусловлено тем, что использование нескольких типов *ServiceType* для каждого *ServicePackage* предназначено, чтобы повысить уровень совместного использования ресурсов между репликами и обеспечить более высокую плотность реплик в каждом процессе.</span><span class="sxs-lookup"><span data-stu-id="26d3b-187">This is because multiple *ServiceTypes* per *ServicePackage* is designed to achieve higher resource sharing among replicas and enables higher replica density per process.</span></span> <span data-ttu-id="26d3b-188">Это кардинально отличается от той задачи, для которой предназначена модель с **монопольным процессом**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-188">This is contrary to what **Exclusive Process** model is designed to achieve.</span></span>

<span data-ttu-id="26d3b-189">Рассмотрим случай использования нескольких типов *ServiceType* для каждого *ServicePackage*, при котором каждый *ServiceType* регистрируется с помощью разных *CodePackage*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-189">Consider the case of multiple *ServiceTypes* per *ServicePackage* with different *CodePackage* registering each *ServiceType*.</span></span> <span data-ttu-id="26d3b-190">Предположим, у нас есть *ServicePackage* MultiTypeServicePackage, который содержит два пакета *CodePackage*:</span><span class="sxs-lookup"><span data-stu-id="26d3b-190">Let's say we have a *ServicePackage* 'MultiTypeServicePackge' which has two *CodePackages*:</span></span>

- <span data-ttu-id="26d3b-191">MyCodePackageA, который регистрирует *тип службы* MyServiceTypeA.</span><span class="sxs-lookup"><span data-stu-id="26d3b-191">'MyCodePackageA' which registers *ServiceType* 'MyServiceTypeA'.</span></span>
- <span data-ttu-id="26d3b-192">MyCodePackageB, который регистрирует *тип службы* MyServiceTypeB.</span><span class="sxs-lookup"><span data-stu-id="26d3b-192">'MyCodePackageB' which registers *ServiceType* 'MyServiceTypeB'.</span></span>

<span data-ttu-id="26d3b-193">Теперь создадим *приложение* **fabric:/SpecialApp** и внутри **fabric:/SpecialApp** создадим две следующие службы с помощью модели с **монопольным процессом**:</span><span class="sxs-lookup"><span data-stu-id="26d3b-193">Now, lets say, we create an *application* **fabric:/SpecialApp** and inside **fabric:/SpecialApp** we create following two services with **Exclusive Process** model:</span></span>

- <span data-ttu-id="26d3b-194">Служба **fabric:/SpecialApp/ServiceA** типа MyServiceTypeA с 2 разделами (например, **P1** и **P2**) и 3 репликами на каждый раздел.</span><span class="sxs-lookup"><span data-stu-id="26d3b-194">Service **fabric:/SpecialApp/ServiceA** of type 'MyServiceTypeA' with two partitions (say **P1** and **P2**) and 3 replicas per partition.</span></span>
- <span data-ttu-id="26d3b-195">Служба **fabric:/SpecialApp/ServiceB** типа MyServiceTypeB с 2 разделами (например, **P3** и **P4**) и 3 репликами на каждый раздел.</span><span class="sxs-lookup"><span data-stu-id="26d3b-195">Service **fabric:/SpecialApp/ServiceB** of type 'MyServiceTypeB' with two partitions (say **P3** and **P4**) and 3 replicas per partition.</span></span>

<span data-ttu-id="26d3b-196">На заданном узле обе службы будут иметь две реплики.</span><span class="sxs-lookup"><span data-stu-id="26d3b-196">On a given node, both the services will have two replicas each.</span></span> <span data-ttu-id="26d3b-197">Так как для создания служб мы использовали модель с **монопольным процессом**, для каждой реплики Service Fabric активирует новую копию MyServicePackge.</span><span class="sxs-lookup"><span data-stu-id="26d3b-197">Since we used **Exclusive Process** model to create the services, Service Fabric will activate a new copy of 'MyServicePackge' for each replica.</span></span> <span data-ttu-id="26d3b-198">Каждая активация MultiTypeServicePackge запускает копию MyCodePackageA и MyCodePackageB.</span><span class="sxs-lookup"><span data-stu-id="26d3b-198">Each activation of 'MultiTypeServicePackge' will start a copy of 'MyCodePackageA' and 'MyCodePackageB'.</span></span> <span data-ttu-id="26d3b-199">Однако только в одной из копий (MyCodePackageA или MyCodePackageB) будет размещена реплика, для которой был активирован MultiTypeServicePackage.</span><span class="sxs-lookup"><span data-stu-id="26d3b-199">However, only one of 'MyCodePackageA' or 'MyCodePackageB' will host the replica for which 'MultiTypeServicePackge' was activated.</span></span> <span data-ttu-id="26d3b-200">На следующей схеме показано представление узла:</span><span class="sxs-lookup"><span data-stu-id="26d3b-200">Following diagram shows the node view:</span></span>

<span data-ttu-id="26d3b-201"><center>
![Представление узла развернутого приложения][node-view-five]
</center></span><span class="sxs-lookup"><span data-stu-id="26d3b-201"><center>
![Node view of deployed application][node-view-five]
</center></span></span>

 <span data-ttu-id="26d3b-202">Как вы видите, в активации MultiTypeServicePackage для реплики раздела **P1** службы **fabric:/SpecialApp/ServiceA** в MyCodePackageA размещается реплика, а MyCodePackageB просто запущен и работает.</span><span class="sxs-lookup"><span data-stu-id="26d3b-202">As we can see, in the activation of 'MultiTypeServicePackge' for replica of partition **P1** of service **fabric:/SpecialApp/ServiceA**, 'MyCodePackageA' is hosting the replica and 'MyCodePackageB' is just up and running.</span></span> <span data-ttu-id="26d3b-203">Аналогичным образом в активации MultiTypeServicePackage для реплики раздела **P3** службы **fabric:/SpecialApp/ServiceB** в MyCodePackageA размещается реплика, а MyCodePackageA просто запущен и работает и т. д.</span><span class="sxs-lookup"><span data-stu-id="26d3b-203">Similarly, in activation of 'MultiTypeServicePackge' for replica of partition **P3** of service **fabric:/SpecialApp/ServiceB**, 'MyCodePackageB' is hosting the replica and 'MyCodePackageA' is just up and running and so on.</span></span> <span data-ttu-id="26d3b-204">Таким образом, чем больше количество пакетов *CodePackage* (регистрирующих различные типы *ServiceType*) для каждого *ServicePackage*, тем выше будет избыточное использование ресурсов.</span><span class="sxs-lookup"><span data-stu-id="26d3b-204">Hence, more the number of *CodePackages* (registering different *ServiceTypes*) per *ServicePackage*, higher will be redundant resource usage.</span></span> 
 
 <span data-ttu-id="26d3b-205">С другой стороны, если мы создадим службы **fabric:/SpecialApp/ServiceA** и **fabric:/SpecialApp/ServiceB** с помощью модели с **общим процессом**, Service Fabric активирует только одну копию MultiTypeServicePackage для *приложения* **fabric:/SpecialApp** (как рассматривалось ранее).</span><span class="sxs-lookup"><span data-stu-id="26d3b-205">On the other hand if we create services **fabric:/SpecialApp/ServiceA** and **fabric:/SpecialApp/ServiceB** with **Shared Process** model, Service Fabric will activate only one copy of 'MultiTypeServicePackge' for *application* **fabric:/SpecialApp** (as we saw previously).</span></span> <span data-ttu-id="26d3b-206">В MyCodePackageA разместятся все реплики службы **fabric:/SpecialApp/ServiceA** (точнее любой службы типа MyServiceTypeA), а в MyCodePackageB разместятся все реплики службы **fabric:/SpecialApp/ServiceB** (точнее любой службы типа MyServiceTypeB).</span><span class="sxs-lookup"><span data-stu-id="26d3b-206">'MyCodePackageA' will host all replicas for service **fabric:/SpecialApp/ServiceA** (or of any service of type 'MyServiceTypeA' to be more precise) and 'MyCodePackageB' will host all replicas for service **fabric:/SpecialApp/ServiceB** (or of any service of type 'MyServiceTypeB' to be more precise).</span></span> <span data-ttu-id="26d3b-207">На следующей схеме показано представление узла в такой конфигурации:</span><span class="sxs-lookup"><span data-stu-id="26d3b-207">Following diagram shows the node view in this setting:</span></span> 

<span data-ttu-id="26d3b-208"><center>
![Представление узла развернутого приложения][node-view-six]
</center></span><span class="sxs-lookup"><span data-stu-id="26d3b-208"><center>
![Node view of deployed application][node-view-six]
</center></span></span>

<span data-ttu-id="26d3b-209">Из приведенного выше примера можно сделать вывод, что если MyCodePackageA регистрирует оба типа MyServiceTypeA и MyServiceTypeB, но пакет MyCodePackageB отсутствует, избыточный *CodePackage* выполняться не будет.</span><span class="sxs-lookup"><span data-stu-id="26d3b-209">In the above example, you might think if 'MyCodePackageA' registers both 'MyServiceTypeA' and 'MyServiceTypeB' and there is no 'MyCodePackageB', then there will be no redundant *CodePackage* running.</span></span> <span data-ttu-id="26d3b-210">Это верно, но, как упоминалось ранее, эта модель приложения не согласуется с моделью размещения с **монопольным процессом**.</span><span class="sxs-lookup"><span data-stu-id="26d3b-210">This is correct, however, as mentioned previously, this application model does not align with **Exclusive Process** hosting model.</span></span> <span data-ttu-id="26d3b-211">Если задача в том, чтобы разместить каждую реплику в свой собственный выделенный процесс, тогда регистрация обоих типов *ServiceType* из одного *CodePackage* не требуется. Будет проще поместить каждый *ServiceType* в свой собственный *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="26d3b-211">If goal is to put each replica in its own dedicated process then registering both *ServiceTypes* from same *CodePackage* is not needed and putting each *ServiceType* in its own *ServicePacakge* is a more natural choice.</span></span>

## <a name="next-steps"></a><span data-ttu-id="26d3b-212">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="26d3b-212">Next steps</span></span>
<span data-ttu-id="26d3b-213">[Создайте пакет приложения][a4] и подготовьте его к развертыванию.</span><span class="sxs-lookup"><span data-stu-id="26d3b-213">[Package an application][a4] and get it ready to deploy.</span></span>

<span data-ttu-id="26d3b-214">В статье [Развертывание и удаление приложений с помощью PowerShell][a5] вы узнаете, как управлять экземплярами приложений с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="26d3b-214">[Deploy and remove applications][a5] describes how to use PowerShell to manage application instances.</span></span>

<!--Image references-->
[node-view-one]: ./media/service-fabric-hosting-model/node-view-one.png
[node-view-two]: ./media/service-fabric-hosting-model/node-view-two.png
[node-view-three]: ./media/service-fabric-hosting-model/node-view-three.png
[node-view-four]: ./media/service-fabric-hosting-model/node-view-four.png
[node-view-five]: ./media/service-fabric-hosting-model/node-view-five.png
[node-view-six]: ./media/service-fabric-hosting-model/node-view-six.png

<!--Link references--In actual articles, you only need a single period before the slash-->
[a1]: service-fabric-application-model.md
[a2]: service-fabric-deploy-existing-app.md
[a3]: service-fabric-containers-overview.md
[a4]: service-fabric-package-apps.md
[a5]: service-fabric-deploy-remove-applications.md

[r1]: https://docs.microsoft.com/rest/api/servicefabric/sfclient-api-createservice

[c1]: https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.servicemanagementclient.createserviceasync
[c2]: https://docs.microsoft.com/dotnet/api/system.fabric.description.statelessservicedescription.instancecount

[p1]: https://docs.microsoft.com/powershell/servicefabric/vlatest/new-servicefabricservice
[p2]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricservicedescription
[p3]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricdeployedservicePackage
[p4]: https://docs.microsoft.com/powershell/servicefabric/vlatest/send-servicefabricdeployedservicepackagehealthreport
[p5]: https://docs.microsoft.com/powershell/servicefabric/vlatest/restart-servicefabricdeployedcodepackage
[p6]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricdeployedservicetype
[p7]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricdeployedreplica
[p8]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricdeployedcodepackage