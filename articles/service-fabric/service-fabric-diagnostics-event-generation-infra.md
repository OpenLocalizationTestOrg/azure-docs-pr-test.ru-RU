---
title: "Наблюдение за службами структуры платформы уровень aaaAzure | Документы Microsoft"
description: "Дополнительные сведения о событиях уровня платформы журналов использования и toomonitor диагностики Azure Service Fabric кластеров."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/24/2017
ms.author: dekapur
ms.openlocfilehash: f8fb1c8b546e05c517ae12c91906acc04cd6eaa6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="platform-level-event-and-log-generation"></a>Создание событий и журналов на уровне платформы

## <a name="monitoring-hello-cluster"></a>Мониторинг кластера hello

Это важные toomonitor на toodetermine уровня платформы hello ли оборудование и кластер работает должным образом. Хотя Service Fabric можно сохранить приложений, выполняющихся во время сбоя оборудования, но по-прежнему нужна toodiagnose ли происходит ошибка в приложении или в инфраструктуре hello. Необходимо также отслеживать плана toobetter кластеры емкости, помощь в принятии решений об о добавлении или удалении оборудования.

Service Fabric предоставляет пять различных журнала каналы out-of box создаваемый hello следующие события:

* Операционный канал: общие операции, выполняемые Service Fabric и hello кластера, включая события для узла, возникающие, выполняется развертывание нового приложения или SF обновление отката и т. д.
* Операционный канал (подробные сведения): отчеты о работоспособности и решения о балансировке нагрузки.
* Канал данных & обмен сообщениями: критический журналы и события, создаваемые в обмена сообщениями (в настоящее время только hello ReverseProxy), а также путь к данным (надежного обмена модели)
* Канал данных & обмен сообщениями - подробные: verbose канал, содержащий все журналы некритические hello из данных и обмена сообщениями в кластере hello (этот канал имеет очень большое количество событий)   
* [События Reliable Services](service-fabric-reliable-services-diagnostics.md): определенные события модели программирования.
* [События надежных субъектов](service-fabric-reliable-actors-diagnostics.md): определенные события модели программирования и счетчики производительности.
* Поддержка журналов: системные журналы, созданные только toobe Service Fabric, нам используемый, когда поддержка

Эти различные каналы рассматривается большая часть hello платформы уровня ведения журнала, рекомендуется использовать. tooimprove платформы уровень ведения журнала, рассмотрите возможность приобретения лучше основные сведения о модели определения работоспособности hello и добавление отчеты о работоспособности пользовательские и добавление пользовательских **счетчики производительности** toobuild влияние в режиме реального времени представление о hello службы и приложения на кластере hello.

### <a name="azure-service-fabric-health-and-load-reporting"></a>Отчеты о работоспособности и нагрузке Azure Service Fabric

В Service Fabric используется собственная модель работоспособности, которая подробно описана в следующих статьях.
- [Мониторинг работоспособности введение tooService структуры](service-fabric-health-introduction.md)
- [Проверка работоспособности службы и оповещение о проблемах](service-fabric-diagnostics-how-to-report-and-check-service-health.md)
- [Добавление настраиваемых отчетов о работоспособности Service Fabric](service-fabric-report-health.md)
- [Просмотр отчетов о работоспособности Service Fabric](service-fabric-view-entities-aggregated-health.md)

Мониторинг работоспособности — критическое toomultiple аспектов работы службы. Отслеживать работоспособность особенно важно, когда Service Fabric выполняет обновление именованного приложения. После каждого домена обновления службы hello обновляется и является доступной tooyour клиентов, домен обновления hello прошла проверку работоспособности до развертывания hello перемещения toohello следующий домен обновления. Если состояние работоспособности не может иметь в виду hello развертывания выполняется откат, так, чтобы приложение hello известных, хорошее состояние. Несмотря на то, что некоторые могут быть подвержены перед hello службы будет выполнен откат, большинство пользователей не столкнуться с проблемой. Кроме того разрешение происходит относительно быстро и без необходимости toowait для действия из отдела оператора. Здравствуйте, дополнительные проверки работоспособности, которые встроены в коде hello более устойчивым, служба становится toodeployment проблемы.

Другим аспектом службы работоспособности сообщает метрики из службы hello. Метрики в Service Fabric важны, поскольку они являются используется toobalance использование ресурсов. Метрики также служат признаком работоспособности системы. Допустим, вы используете приложение с несколькими службами, в котором каждый экземпляр передает метрику количества запросов в секунду (RPS). Если одна служба использует больше ресурсов, чем другая служба, Service Fabric перемещает экземпляры службы вокруг кластера hello использования даже ресурсов toomaintain tootry. Использование ресурсов подробно описано в статье [Управление потреблением ресурсов и нагрузкой в Service Fabric с помощью метрик](service-fabric-cluster-resource-manager-metrics.md).

Также метрики дают представление об эффективности службы. Со временем можно использовать toocheck метрики, работающий в ожидаемом hello службы. Например если трендов показывают, что в 9: 00 в понедельник утром hello среднее RPS равно 1000, то вы можете настроить отчет о работоспособности, предупреждающее, если hello RPS меньше 500 или выше 1500. Все может быть вполне нормально, но может иметь смысл toobe вид, убедиться, что своим клиентам правильную работу. Службу можно определить набор показателей, могут быть отправлены в целях проверки работоспособности, но не влияет на hello балансировку ресурсов кластера hello. toodo toozero вес метрики hello, этот набор. Рекомендуется запустить все показатели с весом 0 и не увеличивают вес hello, пока не убедитесь, что вы понимаете, как вес метрики hello влияет на балансировку ресурсов для кластера.

> [!TIP]
> Не используйте много метрик с ненулевым весом. Это может быть трудно toounderstand, почему экземпляры службы перемещаются балансировки. Нескольких метрик вполне достаточно.

Все сведения, можно указать hello работоспособности и производительности приложения является кандидатом для отчетов, метрики и работоспособности. Счетчик производительности ЦП может показать, как используется узел, но он не даст информации о работоспособности определенной службы, так как на одном узле может быть запущено несколько служб. Однако показатели, такие как RPS, обработка, элементов и все задержка запроса можно указать hello работоспособности определенной службы.

работоспособность tooreport аналогичные toothis используйте код:

  ```csharp
    if (!result.HasValue)
    {
        HealthInformation healthInformation = new HealthInformation("ServiceCode", "StateDictionary", HealthState.Error);
        this.Partition.ReportInstanceHealth(healthInformation);
    }
  ```

tooreport метрики, используйте аналогичные toothis кода:

  ```csharp
    this.Partition.ReportLoad(new List<LoadMetric> { new LoadMetric("MemoryInMb", 1234), new LoadMetric("metric1", 42) });
  ```

### <a name="service-fabric-support-logs"></a>Журналы поддержки Service Fabric

Если вам требуется toocontact технической поддержки Майкрософт для получения справки с кластером Azure Service Fabric, журналы поддержки почти всегда требуются. Если кластер размещен в Azure, эти журналы автоматически настраиваются в процессе создания кластера, а затем собираются. Hello журналы хранятся в выделенную учетную запись хранилища в группе ресурсов кластера. Учетная запись хранения Hello не фиксированным именем, но в учетной записи hello, видно, что контейнеры больших двоичных объектов и таблиц с именами, начинающимися с *структуры*. Сведения о настройке сбора журналов для автономного кластера см. в статьях [Создание изолированного кластера под управлением Windows Server](service-fabric-cluster-creation-for-windows-server.md) и [Параметры конфигурации для автономного кластера Windows](service-fabric-cluster-manifest.md). Для автономных экземплярах Service Fabric hello журналы должны отправляться tooa локальной общей папки. Вы являетесь **необходимые** toohave эти журналы для поддержки, но они не являются предполагаемого toobe может использоваться кем-либо за пределами группы поддержки клиентов Майкрософт hello.

## <a name="enabling-diagnostics-for-a-cluster"></a>Включение диагностики для кластера

В порядке преимуществами tootake эти журналы настоятельно рекомендуется, во время создания кластера «Диагностика» была включена. Включив диагностику, при развертывании кластера hello диагностики Windows Azure — может tooacknowledge hello рабочее, надежные службы и службы Reliable Actor каналы и hello данные хранилища, как описано далее в [статистической обработки событий с Диагностика Azure](service-fabric-diagnostics-event-aggregation-wad.md).

Как показано выше, также имеется дополнительное поле tooadd ключ инструментирования приложений аналитики (AI). При выборе toouse AI для любого анализа событий (Подробнее об этом [анализ событий с помощью Application Insights](service-fabric-diagnostics-event-analysis-appinsights.md)), здесь включают hello AppInsights ресурсов instrumentationKey (GUID).


Если вы собираетесь toodeploy контейнеры tooyour кластера, включите toopick WAD копирование docker stats, добавив этот tooyour «DiagnosticMonitorConfiguration WadCfg >»:

```json
"DockerSources": {
    "Stats": {
        "enabled": true,
        "sampleRate": "PT1M"
    }
},

```

## <a name="measuring-performance"></a>Измерение производительности

Измерение производительности кластера поможет вам понять, как она будет toohandle нагрузочных тестов и диск решения для масштабирования кластера (Дополнительные сведения о масштабировании кластера [в Azure](service-fabric-cluster-scale-up-down.md), или [локальной](service-fabric-cluster-windows-server-add-remove-nodes.md)). Данные производительности также удобно при сравнении tooactions вы или приложений и служб может занимать, при анализе журналов в hello будущих. 

Список toocollect счетчики производительности при использовании Service Fabric см. в разделе [счетчиков производительности в Service Fabric](service-fabric-diagnostics-event-generation-perf.md)

Ниже приведены два простых способа настройки сбора данных производительности для кластера:

* С помощью агента: hello предпочтительный способ сбора производительности на машине, поскольку агенты обычно в списке метрик производительности, можно собирать, и он является сравнительно легко hello метриках toochoose требуется toocollect, или изменить их . Узнайте, как [как tooconfigure hello OMS для Service Fabric](service-fabric-diagnostics-event-analysis-oms.md) и [Настройка агента OMS Windows hello](../log-analytics/log-analytics-windows-agents.md) toolearn статьи о hello OMS agent, где один такой мониторинга агент, может toopick вверх данные о производительности для виртуальных машин кластера и развернутых контейнеров.

* Настройка производительности toowrite диагностики счетчики tooa таблицы: для кластеров в Azure, это означает изменение toopick конфигурации диагностики Azure hello копирование hello соответствующие счетчики производительности из hello виртуальных машин в кластере, а также разрешают toopick вверх Если планируется развертывание все контейнеры docker Статистика. Сведения о настройке [счетчиков производительности в WAD](service-fabric-diagnostics-event-aggregation-wad.md) в Service Fabric tooset копирование сбор данных счетчика производительности.

## <a name="next-steps"></a>Дальнейшие действия

Журналы и события должны toobe статистическую обработку, прежде чем передавать их tooany платформа анализа. Узнайте, как [EventFlow](service-fabric-diagnostics-event-aggregation-eventflow.md) и [WAD](service-fabric-diagnostics-event-aggregation-wad.md) toobetter понять hello рекомендуемые параметры.
