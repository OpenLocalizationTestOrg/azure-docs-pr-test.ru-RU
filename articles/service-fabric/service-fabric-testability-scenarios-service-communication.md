---
title: "Возможности тестирования: взаимодействие между службами | Документация Майкрософт"
description: "Взаимодействие между службами — критически важная точка интеграции приложения Service Fabric. В этой статье обсуждаются вопросы разработки и методы тестирования."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 4a8f941c1e8e641384a9ee3a1149dabaaf9983cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="2bef2-104">Сценарии тестирования платформы Service Fabric: обмен данными между службами</span><span class="sxs-lookup"><span data-stu-id="2bef2-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="2bef2-105">Микрослужбы и стили сервисноориентированной архитектуры естественным образом развертываются на платформе Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="2bef2-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="2bef2-106">В этих типов архитектуры распределенной разделенной микрослужбу приложений обычно состоят из нескольких служб, требующих tootalk tooeach других.</span><span class="sxs-lookup"><span data-stu-id="2bef2-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need tootalk tooeach other.</span></span> <span data-ttu-id="2bef2-107">В простых случаях даже hello обычно имеют по крайней мере без сохранения состояния веб-службы и службы хранилища данных с отслеживанием состояния, которые должны toocommunicate.</span><span class="sxs-lookup"><span data-stu-id="2bef2-107">In even hello simplest cases, you generally have at least a stateless web service and a stateful data storage service that need toocommunicate.</span></span>

<span data-ttu-id="2bef2-108">Взаимодействие службы для службы является точкой критических интеграции приложения, так как каждая служба предоставляет удаленной службы tooother API.</span><span class="sxs-lookup"><span data-stu-id="2bef2-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API tooother services.</span></span> <span data-ttu-id="2bef2-109">Работа с набором границ API, включающая ввод-вывод данных, обычно требует тщательного подхода с интенсивным тестированием и проверкой.</span><span class="sxs-lookup"><span data-stu-id="2bef2-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="2bef2-110">Существует множество toomake вопросы эти границы служб соединены друг с другом в распределенной системе.</span><span class="sxs-lookup"><span data-stu-id="2bef2-110">There are numerous considerations toomake when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="2bef2-111">*Транспортный протокол*.</span><span class="sxs-lookup"><span data-stu-id="2bef2-111">*Transport protocol*.</span></span> <span data-ttu-id="2bef2-112">Вы будете использовать протокол HTTP для улучшения взаимодействия или пользовательский двоичный протокол, чтобы обеспечить максимальную пропускную способность?</span><span class="sxs-lookup"><span data-stu-id="2bef2-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="2bef2-113">*Обработка ошибок*.</span><span class="sxs-lookup"><span data-stu-id="2bef2-113">*Error handling*.</span></span> <span data-ttu-id="2bef2-114">Как будут обрабатываться постоянные и временные ошибки?</span><span class="sxs-lookup"><span data-stu-id="2bef2-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="2bef2-115">Что произойдет, когда служба перемещается tooa другой узел?</span><span class="sxs-lookup"><span data-stu-id="2bef2-115">What will happen when a service moves tooa different node?</span></span>
* <span data-ttu-id="2bef2-116">*Время ожидания и задержка*.</span><span class="sxs-lookup"><span data-stu-id="2bef2-116">*Timeouts and latency*.</span></span> <span data-ttu-id="2bef2-117">В многоуровневых приложениях как каждый уровень службы обрабатывающий задержек за счет hello стека и toohello пользователя?</span><span class="sxs-lookup"><span data-stu-id="2bef2-117">In multitiered applications, how will each service layer handle latency through hello stack and toohello user?</span></span>

<span data-ttu-id="2bef2-118">Использовании компоненты связи hello встроенная учетная запись службы, предоставляемые службами Service Fabric, так и построения собственного тестирование hello взаимодействие служб является tooensuring критические гибкости в приложении.</span><span class="sxs-lookup"><span data-stu-id="2bef2-118">Whether you use one of hello built-in service communication components provided by Service Fabric or you build your own, testing hello interactions between your services is critical tooensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-toomove"></a><span data-ttu-id="2bef2-119">Подготовка для службы toomove</span><span class="sxs-lookup"><span data-stu-id="2bef2-119">Prepare for services toomove</span></span>
<span data-ttu-id="2bef2-120">Со временем экземпляры служб могут перемещаться,</span><span class="sxs-lookup"><span data-stu-id="2bef2-120">Service instances may move around over time.</span></span> <span data-ttu-id="2bef2-121">особенно если они настроены с использованием метрик нагрузки для оптимальной балансировки ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2bef2-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="2bef2-122">Service Fabric перемещает их доступность toomaximize экземпляров вашей службы во время обновления, переход на другой ресурс, масштабирования и других ситуациях, которые выполняются в течение времени существования hello распределенной системе.</span><span class="sxs-lookup"><span data-stu-id="2bef2-122">Service Fabric moves your service instances toomaximize their availability even during upgrades, failovers, scale-out, and other situations that occur over hello lifetime of a distributed system.</span></span>

<span data-ttu-id="2bef2-123">Перемещать службы в кластере hello, клиентские компьютеры и другие службы будет два сценария подготовленного toohandle говорит tooa службы:</span><span class="sxs-lookup"><span data-stu-id="2bef2-123">As services move around in hello cluster, your clients and other services should be prepared toohandle two scenarios when they talk tooa service:</span></span>

* <span data-ttu-id="2bef2-124">Hello реплики службы экземпляра или раздел был перемещен с момента последнего говорили tooit hello.</span><span class="sxs-lookup"><span data-stu-id="2bef2-124">hello service instance or partition replica has moved since hello last time you talked tooit.</span></span> <span data-ttu-id="2bef2-125">Это обычный часть жизненного цикла службы и его необходимо toohappen ожидаемое время жизни приложения hello.</span><span class="sxs-lookup"><span data-stu-id="2bef2-125">This is a normal part of a service lifecycle, and it should be expected toohappen during hello lifetime of your application.</span></span>
* <span data-ttu-id="2bef2-126">Hello реплики службы экземпляра или раздел находится в hello процесс перехода.</span><span class="sxs-lookup"><span data-stu-id="2bef2-126">hello service instance or partition replica is in hello process of moving.</span></span> <span data-ttu-id="2bef2-127">Несмотря на то, что в Service Fabric отработки отказа службы с одного узла tooanother происходит очень быстро, может возникнуть задержка доступности при медленных toostart hello компонента связи службы.</span><span class="sxs-lookup"><span data-stu-id="2bef2-127">Although failover of a service from one node tooanother occurs very quickly in Service Fabric, there may be a delay in availability if hello communication component of your service is slow toostart.</span></span>

<span data-ttu-id="2bef2-128">Для бесперебойной работы системы важно правильно обрабатывать такие сценарии.</span><span class="sxs-lookup"><span data-stu-id="2bef2-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="2bef2-129">toodo таким образом, следует помнить, что:</span><span class="sxs-lookup"><span data-stu-id="2bef2-129">toodo so, keep in mind that:</span></span>

* <span data-ttu-id="2bef2-130">Каждая служба, может быть подключенным toohas *адрес* , прослушивающих (например, HTTP или WebSockets).</span><span class="sxs-lookup"><span data-stu-id="2bef2-130">Every service that can be connected toohas an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="2bef2-131">При перемещении экземпляра или раздела службы меняется адрес соответствующей конечной точки</span><span class="sxs-lookup"><span data-stu-id="2bef2-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="2bef2-132">(Он перемещает tooa другой узел с другой IP-адрес). При использовании встроенного соединения компонентов hello, они будут обрабатывать повторно разрешение адресов службы для вас.</span><span class="sxs-lookup"><span data-stu-id="2bef2-132">(It moves tooa different node with a different IP address.) If you're using hello built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="2bef2-133">Могут существовать временному увеличению задержки службы при запуске экземпляра службы hello слушателя его еще раз.</span><span class="sxs-lookup"><span data-stu-id="2bef2-133">There may be a temporary increase in service latency as hello service instance starts up its listener again.</span></span> <span data-ttu-id="2bef2-134">Это зависит от того, насколько быстро службы hello открывает прослушиватель hello после перемещения hello экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="2bef2-134">This depends on how quickly hello service opens hello listener after hello service instance is moved.</span></span>
* <span data-ttu-id="2bef2-135">Все существующие подключения должны toobe закрыт и открыт повторно после открытия службы hello на новый узел.</span><span class="sxs-lookup"><span data-stu-id="2bef2-135">Any existing connections need toobe closed and reopened after hello service opens on a new node.</span></span> <span data-ttu-id="2bef2-136">Перезагрузка или завершение работы узла корректное экономит время toobe существующих подключений, корректно завершить работу.</span><span class="sxs-lookup"><span data-stu-id="2bef2-136">A graceful node shutdown or restart allows time for existing connections toobe shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="2bef2-137">Тестирование. Перемещение экземпляров службы</span><span class="sxs-lookup"><span data-stu-id="2bef2-137">Test it: Move service instances</span></span>
<span data-ttu-id="2bef2-138">С помощью средств тестирования Service Fabric, вы можете создавать сценарии тестирования tootest таких ситуациях различными способами:</span><span class="sxs-lookup"><span data-stu-id="2bef2-138">By using Service Fabric's testability tools, you can author a test scenario tootest these situations in different ways:</span></span>

1. <span data-ttu-id="2bef2-139">Переместите первичную реплику службы с отслеживанием состояния.</span><span class="sxs-lookup"><span data-stu-id="2bef2-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="2bef2-140">Hello первичной реплики раздела с отслеживанием состояния службы могут перемещаться по любой причине.</span><span class="sxs-lookup"><span data-stu-id="2bef2-140">hello primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="2bef2-141">Используйте этот tootarget hello первичная реплика toosee определенной секции, как переместить toohello реагирование на них вашей службы очень контролируемым образом.</span><span class="sxs-lookup"><span data-stu-id="2bef2-141">Use this tootarget hello primary replica of a specific partition toosee how your services react toohello move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="2bef2-142">Остановите работу узла.</span><span class="sxs-lookup"><span data-stu-id="2bef2-142">Stop a node.</span></span>
   
    <span data-ttu-id="2bef2-143">Когда узел остановлен, Service Fabric перемещает все hello службы экземпляров или секции, которые были на этот узел tooone из hello другие доступные узлы в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="2bef2-143">When a node is stopped, Service Fabric moves all of hello service instances or partitions that were on that node tooone of hello other available nodes in hello cluster.</span></span> <span data-ttu-id="2bef2-144">С помощью этой ситуации, когда узел выходит из кластера, и все экземпляры службы hello и реплик на этом узле требуется toomove tootest.</span><span class="sxs-lookup"><span data-stu-id="2bef2-144">Use this tootest a situation where a node is lost from your cluster and all of hello service instances and replicas on that node have toomove.</span></span>
   
    <span data-ttu-id="2bef2-145">Можно остановить узел с помощью hello PowerShell **Stop ServiceFabricNode** командлета:</span><span class="sxs-lookup"><span data-stu-id="2bef2-145">You can stop a node by using hello PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="2bef2-146">Поддержание доступности службы</span><span class="sxs-lookup"><span data-stu-id="2bef2-146">Maintain service availability</span></span>
<span data-ttu-id="2bef2-147">Платформа Service Fabric — спроектированный tooprovide высокий уровень доступности служб.</span><span class="sxs-lookup"><span data-stu-id="2bef2-147">As a platform, Service Fabric is designed tooprovide high availability of your services.</span></span> <span data-ttu-id="2bef2-148">Но в исключительных случаях проблемы с базовой инфраструктурой все еще могут привести к недоступности.</span><span class="sxs-lookup"><span data-stu-id="2bef2-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="2bef2-149">Он оказался слишком важные tootest в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="2bef2-149">It is important tootest for these scenarios, too.</span></span>

<span data-ttu-id="2bef2-150">С отслеживанием состояния службы используют состояние системы, основанный на кворуме tooreplicate для обеспечения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="2bef2-150">Stateful services use a quorum-based system tooreplicate state for high availability.</span></span> <span data-ttu-id="2bef2-151">Это означает, что реплики должна операций записи доступны tooperform toobe.</span><span class="sxs-lookup"><span data-stu-id="2bef2-151">This means that a quorum of replicas needs toobe available tooperform write operations.</span></span> <span data-ttu-id="2bef2-152">В редких случаях, например при масштабном сбое оборудования, кворум реплик может быть недоступен.</span><span class="sxs-lookup"><span data-stu-id="2bef2-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="2bef2-153">В таких случаях может tooperform операции записи не будет, но будет по-прежнему может tooperform операций чтения.</span><span class="sxs-lookup"><span data-stu-id="2bef2-153">In these cases, you will not be able tooperform write operations, but you will still be able tooperform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="2bef2-154">Тестирование. Недоступность операции записи</span><span class="sxs-lookup"><span data-stu-id="2bef2-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="2bef2-155">С помощью средств тестирования hello в Service Fabric, может вводить ошибки, который вызывает потери кворума, в качестве теста.</span><span class="sxs-lookup"><span data-stu-id="2bef2-155">By using hello testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="2bef2-156">Несмотря на то, что этот сценарий является редко, очень важно, что клиенты и службы, зависящие от служб с отслеживанием состояния подготовлены toohandle ситуациях, где они не могут вносить записи tooit запросов.</span><span class="sxs-lookup"><span data-stu-id="2bef2-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared toohandle situations where they cannot make write requests tooit.</span></span> <span data-ttu-id="2bef2-157">Также важно, самой службы с отслеживанием состояния hello известно об этой возможности и может правильно взаимодействовать его toocallers.</span><span class="sxs-lookup"><span data-stu-id="2bef2-157">It is also important that hello stateful service itself is aware of this possibility and can gracefully communicate it toocallers.</span></span>

<span data-ttu-id="2bef2-158">Потери кворума можно вызвать с помощью hello PowerShell **Invoke ServiceFabricPartitionQuorumLoss** командлета:</span><span class="sxs-lookup"><span data-stu-id="2bef2-158">You can induce quorum loss by using hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="2bef2-159">В этом примере задается `QuorumLossMode` слишком`QuorumReplicas` tooindicate, мы хотим tooinduce потери кворума, не снимая всех реплик.</span><span class="sxs-lookup"><span data-stu-id="2bef2-159">In this example, we set `QuorumLossMode` too`QuorumReplicas` tooindicate that we want tooinduce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="2bef2-160">Таким образом выполнение операций чтения по-прежнему возможно.</span><span class="sxs-lookup"><span data-stu-id="2bef2-160">This way, read operations are still possible.</span></span> <span data-ttu-id="2bef2-161">tootest сценарий, где весь раздел недоступен, можно задать для этого ключа слишком`AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="2bef2-161">tootest a scenario where an entire partition is unavailable, you can set this switch too`AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2bef2-162">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="2bef2-162">Next steps</span></span>
[<span data-ttu-id="2bef2-163">Дополнительные сведения о действиях, доступных благодаря подсистеме тестирования</span><span class="sxs-lookup"><span data-stu-id="2bef2-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="2bef2-164">Дополнительные сведения о сценариях подсистемы тестирования</span><span class="sxs-lookup"><span data-stu-id="2bef2-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)

