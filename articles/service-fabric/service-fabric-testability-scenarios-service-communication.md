---
title: "Возможности тестирования: взаимодействие между службами | Документация Майкрософт"
description: "Взаимодействие между службами — критически важная точка интеграции приложения Service Fabric. В этой статье обсуждаются вопросы разработки и методы тестирования."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 4a8f941c1e8e641384a9ee3a1149dabaaf9983cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a>Сценарии тестирования платформы Service Fabric: обмен данными между службами
Микрослужбы и стили сервисноориентированной архитектуры естественным образом развертываются на платформе Azure Service Fabric. В этих типов архитектуры распределенной разделенной микрослужбу приложений обычно состоят из нескольких служб, требующих tootalk tooeach других. В простых случаях даже hello обычно имеют по крайней мере без сохранения состояния веб-службы и службы хранилища данных с отслеживанием состояния, которые должны toocommunicate.

Взаимодействие службы для службы является точкой критических интеграции приложения, так как каждая служба предоставляет удаленной службы tooother API. Работа с набором границ API, включающая ввод-вывод данных, обычно требует тщательного подхода с интенсивным тестированием и проверкой.

Существует множество toomake вопросы эти границы служб соединены друг с другом в распределенной системе.

* *Транспортный протокол*. Вы будете использовать протокол HTTP для улучшения взаимодействия или пользовательский двоичный протокол, чтобы обеспечить максимальную пропускную способность?
* *Обработка ошибок*. Как будут обрабатываться постоянные и временные ошибки? Что произойдет, когда служба перемещается tooa другой узел?
* *Время ожидания и задержка*. В многоуровневых приложениях как каждый уровень службы обрабатывающий задержек за счет hello стека и toohello пользователя?

Использовании компоненты связи hello встроенная учетная запись службы, предоставляемые службами Service Fabric, так и построения собственного тестирование hello взаимодействие служб является tooensuring критические гибкости в приложении.

## <a name="prepare-for-services-toomove"></a>Подготовка для службы toomove
Со временем экземпляры служб могут перемещаться, особенно если они настроены с использованием метрик нагрузки для оптимальной балансировки ресурсов. Service Fabric перемещает их доступность toomaximize экземпляров вашей службы во время обновления, переход на другой ресурс, масштабирования и других ситуациях, которые выполняются в течение времени существования hello распределенной системе.

Перемещать службы в кластере hello, клиентские компьютеры и другие службы будет два сценария подготовленного toohandle говорит tooa службы:

* Hello реплики службы экземпляра или раздел был перемещен с момента последнего говорили tooit hello. Это обычный часть жизненного цикла службы и его необходимо toohappen ожидаемое время жизни приложения hello.
* Hello реплики службы экземпляра или раздел находится в hello процесс перехода. Несмотря на то, что в Service Fabric отработки отказа службы с одного узла tooanother происходит очень быстро, может возникнуть задержка доступности при медленных toostart hello компонента связи службы.

Для бесперебойной работы системы важно правильно обрабатывать такие сценарии. toodo таким образом, следует помнить, что:

* Каждая служба, может быть подключенным toohas *адрес* , прослушивающих (например, HTTP или WebSockets). При перемещении экземпляра или раздела службы меняется адрес соответствующей конечной точки (Он перемещает tooa другой узел с другой IP-адрес). При использовании встроенного соединения компонентов hello, они будут обрабатывать повторно разрешение адресов службы для вас.
* Могут существовать временному увеличению задержки службы при запуске экземпляра службы hello слушателя его еще раз. Это зависит от того, насколько быстро службы hello открывает прослушиватель hello после перемещения hello экземпляра службы.
* Все существующие подключения должны toobe закрыт и открыт повторно после открытия службы hello на новый узел. Перезагрузка или завершение работы узла корректное экономит время toobe существующих подключений, корректно завершить работу.

### <a name="test-it-move-service-instances"></a>Тестирование. Перемещение экземпляров службы
С помощью средств тестирования Service Fabric, вы можете создавать сценарии тестирования tootest таких ситуациях различными способами:

1. Переместите первичную реплику службы с отслеживанием состояния.
   
    Hello первичной реплики раздела с отслеживанием состояния службы могут перемещаться по любой причине. Используйте этот tootarget hello первичная реплика toosee определенной секции, как переместить toohello реагирование на них вашей службы очень контролируемым образом.
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. Остановите работу узла.
   
    Когда узел остановлен, Service Fabric перемещает все hello службы экземпляров или секции, которые были на этот узел tooone из hello другие доступные узлы в кластере hello. С помощью этой ситуации, когда узел выходит из кластера, и все экземпляры службы hello и реплик на этом узле требуется toomove tootest.
   
    Можно остановить узел с помощью hello PowerShell **Stop ServiceFabricNode** командлета:
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a>Поддержание доступности службы
Платформа Service Fabric — спроектированный tooprovide высокий уровень доступности служб. Но в исключительных случаях проблемы с базовой инфраструктурой все еще могут привести к недоступности. Он оказался слишком важные tootest в следующих случаях.

С отслеживанием состояния службы используют состояние системы, основанный на кворуме tooreplicate для обеспечения высокой доступности. Это означает, что реплики должна операций записи доступны tooperform toobe. В редких случаях, например при масштабном сбое оборудования, кворум реплик может быть недоступен. В таких случаях может tooperform операции записи не будет, но будет по-прежнему может tooperform операций чтения.

### <a name="test-it-write-operation-unavailability"></a>Тестирование. Недоступность операции записи
С помощью средств тестирования hello в Service Fabric, может вводить ошибки, который вызывает потери кворума, в качестве теста. Несмотря на то, что этот сценарий является редко, очень важно, что клиенты и службы, зависящие от служб с отслеживанием состояния подготовлены toohandle ситуациях, где они не могут вносить записи tooit запросов. Также важно, самой службы с отслеживанием состояния hello известно об этой возможности и может правильно взаимодействовать его toocallers.

Потери кворума можно вызвать с помощью hello PowerShell **Invoke ServiceFabricPartitionQuorumLoss** командлета:

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

В этом примере задается `QuorumLossMode` слишком`QuorumReplicas` tooindicate, мы хотим tooinduce потери кворума, не снимая всех реплик. Таким образом выполнение операций чтения по-прежнему возможно. tootest сценарий, где весь раздел недоступен, можно задать для этого ключа слишком`AllReplicas`.

## <a name="next-steps"></a>Дальнейшие действия
[Дополнительные сведения о действиях, доступных благодаря подсистеме тестирования](service-fabric-testability-actions.md)

[Дополнительные сведения о сценариях подсистемы тестирования](service-fabric-testability-scenarios.md)

