---
title: "Управление нагрузкой микрослужбы Azure с помощью метрик | Документация Майкрософт"
description: "Узнайте, как настраивать и использовать метрики в Service Fabric, чтобы управлять потреблением ресурсов службы."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 0d622ea6-a7c7-4bef-886b-06e6b85a97fb
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 7e020bb6c02c80127e4225ba695017dff9b5a168
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="managing-resource-consumption-and-load-in-service-fabric-with-metrics"></a><span data-ttu-id="eccc3-103">Управление потреблением ресурсов и нагрузкой в Service Fabric с помощью метрик</span><span class="sxs-lookup"><span data-stu-id="eccc3-103">Managing resource consumption and load in Service Fabric with metrics</span></span>
<span data-ttu-id="eccc3-104">*Метрики* определяют ресурсы, которые нужны вашим службам и которые предоставляются узлами в кластере.</span><span class="sxs-lookup"><span data-stu-id="eccc3-104">*Metrics* are the resources that your services care about and which are provided by the nodes in the cluster.</span></span> <span data-ttu-id="eccc3-105">Метрика — это все, чем требуется управлять, чтобы повышать или отслеживать производительность своих служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-105">A metric is anything that you want to manage in order to improve or monitor the performance of your services.</span></span> <span data-ttu-id="eccc3-106">Например, можно отслеживать потребление памяти, чтобы знать, не перегружена ли служба.</span><span class="sxs-lookup"><span data-stu-id="eccc3-106">For example, you might watch memory consumption to know if your service is overloaded.</span></span> <span data-ttu-id="eccc3-107">С помощью метрики вы можете определить, можно ли переместить службу в другое расположение, в котором память менее ограничена, чтобы повысить производительность.</span><span class="sxs-lookup"><span data-stu-id="eccc3-107">Another use is to figure out whether the service could move elsewhere where memory is less constrained in order to get better performance.</span></span>

<span data-ttu-id="eccc3-108">Примерами метрик может служить использование памяти, дисков и ЦП.</span><span class="sxs-lookup"><span data-stu-id="eccc3-108">Things like Memory, Disk, and CPU usage are examples of metrics.</span></span> <span data-ttu-id="eccc3-109">Это физические метрики, т. е. ресурсы, соответствующие физическим ресурсам на узле, которыми нужно управлять.</span><span class="sxs-lookup"><span data-stu-id="eccc3-109">These metrics are physical metrics, resources that correspond to physical resources on the node that need to be managed.</span></span> <span data-ttu-id="eccc3-110">Метрики также могут быть (и зачастую являются) логическими.</span><span class="sxs-lookup"><span data-stu-id="eccc3-110">Metrics can also be (and commonly are) logical metrics.</span></span> <span data-ttu-id="eccc3-111">Примерами логических метрик могут служить MyWorkQueueDepth, MessagesToProcess и TotalRecords.</span><span class="sxs-lookup"><span data-stu-id="eccc3-111">Logical metrics are things like “MyWorkQueueDepth” or "MessagesToProcess" or "TotalRecords".</span></span> <span data-ttu-id="eccc3-112">Логические метрики определяются приложениями и косвенно соответствуют потреблению некоторых физических ресурсов.</span><span class="sxs-lookup"><span data-stu-id="eccc3-112">Logical metrics are application-defined and indirectly correspond to some physical resource consumption.</span></span> <span data-ttu-id="eccc3-113">Логические метрики больше распространены, так как может быть трудно измерить потребление физических ресурсов для каждой службы и сообщить о нем.</span><span class="sxs-lookup"><span data-stu-id="eccc3-113">Logical metrics are common because it can be hard to measure and report consumption of physical resources on a per-service basis.</span></span> <span data-ttu-id="eccc3-114">Именно из-за сложности измерения и создания отчетов о собственных физических метриках Service Fabric предоставляет метрики по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eccc3-114">The complexity of measuring and reporting your own physical metrics is also why Service Fabric provides some default metrics.</span></span>

## <a name="default-metrics"></a><span data-ttu-id="eccc3-115">Метрики по умолчанию</span><span class="sxs-lookup"><span data-stu-id="eccc3-115">Default metrics</span></span>
<span data-ttu-id="eccc3-116">Предположим, что вы хотите начать создание и развертывание службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-116">Let’s say that you want to get started writing and deploying your service.</span></span> <span data-ttu-id="eccc3-117">На этом этапе вы не знаете, какие физические или логические ресурсы она будет использовать.</span><span class="sxs-lookup"><span data-stu-id="eccc3-117">At this point you don’t know what physical or logical resources it consumes.</span></span> <span data-ttu-id="eccc3-118">Все в порядке.</span><span class="sxs-lookup"><span data-stu-id="eccc3-118">That’s fine!</span></span> <span data-ttu-id="eccc3-119">Диспетчер кластерных ресурсов Service Fabric использует некоторые метрики по умолчанию, когда не указаны другие метрики.</span><span class="sxs-lookup"><span data-stu-id="eccc3-119">The Service Fabric Cluster Resource Manager uses some default metrics when no other metrics are specified.</span></span> <span data-ttu-id="eccc3-120">К ним относятся:</span><span class="sxs-lookup"><span data-stu-id="eccc3-120">They are:</span></span>

  - <span data-ttu-id="eccc3-121">PrimaryCount — число первичных реплик на узле;</span><span class="sxs-lookup"><span data-stu-id="eccc3-121">PrimaryCount - count of Primary replicas on the node</span></span> 
  - <span data-ttu-id="eccc3-122">ReplicaCount — общее число реплик с отслеживанием состояния на узле;</span><span class="sxs-lookup"><span data-stu-id="eccc3-122">ReplicaCount - count of total stateful replicas on the node</span></span>
  - <span data-ttu-id="eccc3-123">Count — число всех объектов службы (без отслеживания и с отслеживанием состояния) на узле.</span><span class="sxs-lookup"><span data-stu-id="eccc3-123">Count - count of all service objects (stateless and stateful) on the node</span></span>

| <span data-ttu-id="eccc3-124">Метрика</span><span class="sxs-lookup"><span data-stu-id="eccc3-124">Metric</span></span> | <span data-ttu-id="eccc3-125">Нагрузка экземпляра без отслеживания состояния</span><span class="sxs-lookup"><span data-stu-id="eccc3-125">Stateless Instance Load</span></span> | <span data-ttu-id="eccc3-126">Вторичная нагрузка с отслеживанием состояния</span><span class="sxs-lookup"><span data-stu-id="eccc3-126">Stateful Secondary Load</span></span> | <span data-ttu-id="eccc3-127">Первичная нагрузка с отслеживанием состояния</span><span class="sxs-lookup"><span data-stu-id="eccc3-127">Stateful Primary Load</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="eccc3-128">PrimaryCount</span><span class="sxs-lookup"><span data-stu-id="eccc3-128">PrimaryCount</span></span> |<span data-ttu-id="eccc3-129">0</span><span class="sxs-lookup"><span data-stu-id="eccc3-129">0</span></span> |<span data-ttu-id="eccc3-130">0</span><span class="sxs-lookup"><span data-stu-id="eccc3-130">0</span></span> |<span data-ttu-id="eccc3-131">1</span><span class="sxs-lookup"><span data-stu-id="eccc3-131">1</span></span> |
| <span data-ttu-id="eccc3-132">ReplicaCount</span><span class="sxs-lookup"><span data-stu-id="eccc3-132">ReplicaCount</span></span> |<span data-ttu-id="eccc3-133">0</span><span class="sxs-lookup"><span data-stu-id="eccc3-133">0</span></span> |<span data-ttu-id="eccc3-134">1</span><span class="sxs-lookup"><span data-stu-id="eccc3-134">1</span></span> |<span data-ttu-id="eccc3-135">1</span><span class="sxs-lookup"><span data-stu-id="eccc3-135">1</span></span> |
| <span data-ttu-id="eccc3-136">Count</span><span class="sxs-lookup"><span data-stu-id="eccc3-136">Count</span></span> |<span data-ttu-id="eccc3-137">1</span><span class="sxs-lookup"><span data-stu-id="eccc3-137">1</span></span> |<span data-ttu-id="eccc3-138">1</span><span class="sxs-lookup"><span data-stu-id="eccc3-138">1</span></span> |<span data-ttu-id="eccc3-139">1</span><span class="sxs-lookup"><span data-stu-id="eccc3-139">1</span></span> |

<span data-ttu-id="eccc3-140">Для простых рабочих нагрузок метрики по умолчанию обеспечивают достаточное распределение работы в кластере.</span><span class="sxs-lookup"><span data-stu-id="eccc3-140">For basic workloads, the default metrics provide a decent distribution of work in the cluster.</span></span> <span data-ttu-id="eccc3-141">В следующем примере показано, что происходит при создании двух служб, для балансировки которых используются метрики по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eccc3-141">In the following example, let’s see what happens when we create two services and rely on the default metrics for balancing.</span></span> <span data-ttu-id="eccc3-142">Первая из них — служба с отслеживанием состояния, тремя секциями и размером целевого набора реплик равным трем.</span><span class="sxs-lookup"><span data-stu-id="eccc3-142">The first service is a stateful service with three partitions and a target replica set size of three.</span></span> <span data-ttu-id="eccc3-143">Вторая — служба без отслеживания состояния с одной секцией и числом экземпляров равным трем.</span><span class="sxs-lookup"><span data-stu-id="eccc3-143">The second service is a stateless service with one partition and an instance count of three.</span></span>

<span data-ttu-id="eccc3-144">Вот что получается в итоге.</span><span class="sxs-lookup"><span data-stu-id="eccc3-144">Here's what you get:</span></span>

<span data-ttu-id="eccc3-145"><center>
![Макет кластера с метриками по умолчанию][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="eccc3-145"><center>
![Cluster Layout with Default Metrics][Image1]
</center></span></span>

<span data-ttu-id="eccc3-146">Нужно отметить следующее:</span><span class="sxs-lookup"><span data-stu-id="eccc3-146">Some things to note:</span></span>
  - <span data-ttu-id="eccc3-147">Первичные реплики для службы с отслеживанием состояния распределены между несколькими узлами.</span><span class="sxs-lookup"><span data-stu-id="eccc3-147">Primary replicas for the stateful service are distributed across several nodes</span></span>
  - <span data-ttu-id="eccc3-148">Реплики для одной секции находятся на разных узлах.</span><span class="sxs-lookup"><span data-stu-id="eccc3-148">Replicas for the same partition are on different nodes</span></span>
  - <span data-ttu-id="eccc3-149">Общее число первичных и вторичных реплик распределено в кластере.</span><span class="sxs-lookup"><span data-stu-id="eccc3-149">The total number of primaries and secondaries is distributed in the cluster</span></span>
  - <span data-ttu-id="eccc3-150">Общее количество объектов службы равномерно выделено на каждом узле.</span><span class="sxs-lookup"><span data-stu-id="eccc3-150">The total number of service objects are evenly allocated on each node</span></span>

<span data-ttu-id="eccc3-151">Хорошо!</span><span class="sxs-lookup"><span data-stu-id="eccc3-151">Good!</span></span>

<span data-ttu-id="eccc3-152">Метрики по умолчанию прекрасно подходят для начала работы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-152">The default metrics work great as a start.</span></span> <span data-ttu-id="eccc3-153">Однако на этом их возможности исчерпываются.</span><span class="sxs-lookup"><span data-stu-id="eccc3-153">However, the default metrics will only carry you so far.</span></span> <span data-ttu-id="eccc3-154">К примеру, какова вероятность того, что выбранная схема секционирования приведет к идеально равномерному использованию ресурсов всеми секциями?</span><span class="sxs-lookup"><span data-stu-id="eccc3-154">For example: What's the likelihood that the partitioning scheme you picked results in perfectly even utilization by all partitions?</span></span> <span data-ttu-id="eccc3-155">Какова вероятность того, что заданная служба испытывает одинаковую нагрузку все время или даже во всех секциях прямо сейчас?</span><span class="sxs-lookup"><span data-stu-id="eccc3-155">What’s the chance that the load for a given service is constant over time, or even just the same across multiple partitions right now?</span></span>

<span data-ttu-id="eccc3-156">Можно работать, используя только метрики по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eccc3-156">You could run with just the default metrics.</span></span> <span data-ttu-id="eccc3-157">Но, как правило, это означает, что использование вашего кластера ниже и неравномернее, чем хотелось бы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-157">However, doing so usually means that your cluster utilization is lower and more uneven than you’d like.</span></span> <span data-ttu-id="eccc3-158">Это связано с тем, что метрики по умолчанию не адаптивны и подразумевают эквивалентность всех служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-158">This is because the default metrics aren't adaptive and presume everything is equivalent.</span></span> <span data-ttu-id="eccc3-159">Например, работающая и неиспользуемая первичные реплики обе добавляют 1 к значению метрики PrimaryCount.</span><span class="sxs-lookup"><span data-stu-id="eccc3-159">For example, a Primary that is busy and one that is not both contribute "1" to the PrimaryCount metric.</span></span> <span data-ttu-id="eccc3-160">В худшем случае применение только метрик по умолчанию может также привести к неправильному планированию использования узлов, что, в свою очередь, может вызвать проблемы с производительностью.</span><span class="sxs-lookup"><span data-stu-id="eccc3-160">In the worst case, using only the default metrics can also result in overscheduled nodes resulting in performance issues.</span></span> <span data-ttu-id="eccc3-161">Если вы стремитесь максимально эффективно использовать кластер и избежать проблем с производительностью, необходимо использовать пользовательские метрики и отчеты о динамической нагрузке.</span><span class="sxs-lookup"><span data-stu-id="eccc3-161">If you're interested in getting the most out of your cluster and avoiding performance issues, you need to use custom metrics and dynamic load reporting.</span></span>

## <a name="custom-metrics"></a><span data-ttu-id="eccc3-162">Настраиваемые метрики</span><span class="sxs-lookup"><span data-stu-id="eccc3-162">Custom metrics</span></span>
<span data-ttu-id="eccc3-163">Метрики настраиваются отдельно для каждого экземпляра именованной службы во время ее создания.</span><span class="sxs-lookup"><span data-stu-id="eccc3-163">Metrics are configured on a per-named-service-instance basis when you’re creating the service.</span></span>

<span data-ttu-id="eccc3-164">У любой метрики есть описывающие ее свойства: имя, вес и нагрузка по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eccc3-164">Any metric has some properties that describe it: a name, a weight, and a default load.</span></span>

* <span data-ttu-id="eccc3-165">Metric Name: имя метрики,</span><span class="sxs-lookup"><span data-stu-id="eccc3-165">Metric Name: The name of the metric.</span></span> <span data-ttu-id="eccc3-166">которое представляет собой уникальный идентификатор метрики в кластере с точки зрения Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="eccc3-166">The metric name is a unique identifier for the metric within the cluster from the Resource Manager’s perspective.</span></span>
* <span data-ttu-id="eccc3-167">Weight — это вес метрики, который определяет ее важность по сравнению с другими метриками для этой службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-167">Weight: Metric weight defines how important this metric is relative to the other metrics for this service.</span></span>
* <span data-ttu-id="eccc3-168">Загрузка по умолчанию представляется по-разному в зависимости от того, какой является служба: с отслеживанием или без отслеживания состояния.</span><span class="sxs-lookup"><span data-stu-id="eccc3-168">Default Load: The default load is represented differently depending on whether the service is stateless or stateful.</span></span>
  * <span data-ttu-id="eccc3-169">Для служб без отслеживания состояния у каждой метрики есть одно свойство — DefaultLoad.</span><span class="sxs-lookup"><span data-stu-id="eccc3-169">For stateless services, each metric has a single property named DefaultLoad</span></span>
  * <span data-ttu-id="eccc3-170">Для служб с отслеживанием состояния можно определить следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="eccc3-170">For stateful services you define:</span></span>
    * <span data-ttu-id="eccc3-171">PrimaryDefaultLoad — величина метрики по умолчанию, которая соответствует потреблению службы в качестве первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="eccc3-171">PrimaryDefaultLoad: The default amount of this metric this service consumes when it is a Primary</span></span>
    * <span data-ttu-id="eccc3-172">SecondaryDefaultLoad — величина метрики по умолчанию, которая соответствует потреблению службы в качестве вторичной реплики.</span><span class="sxs-lookup"><span data-stu-id="eccc3-172">SecondaryDefaultLoad: The default amount of this metric this service consumes when it is a Secondary</span></span>

> [!NOTE]
> <span data-ttu-id="eccc3-173">Если определены пользовательские метрики и необходимо _также_ использовать метрики по умолчанию, следует _явно_ добавить их и определить для них веса и значения.</span><span class="sxs-lookup"><span data-stu-id="eccc3-173">If you define custom metrics and you want to _also_ use the default metrics, you need to _explicitly_ add the default metrics back and define weights and values for them.</span></span> <span data-ttu-id="eccc3-174">Это требуется для того, чтобы определить связь между метриками по умолчанию и пользовательскими метриками.</span><span class="sxs-lookup"><span data-stu-id="eccc3-174">This is because you must define the relationship between the default metrics and your custom metrics.</span></span> <span data-ttu-id="eccc3-175">Например, вас больше интересуют метрика ConnectionCount или WorkQueueDepth, чем распределение первичных реплик.</span><span class="sxs-lookup"><span data-stu-id="eccc3-175">For example, maybe you care about ConnectionCount or WorkQueueDepth more than Primary distribution.</span></span> <span data-ttu-id="eccc3-176">По умолчанию вес метрики PrimaryCount — высокий, поэтому вы хотите уменьшить его до среднего, когда добавляете другие метрики, чтобы они имели более высокий приоритет.</span><span class="sxs-lookup"><span data-stu-id="eccc3-176">By default the weight of the PrimaryCount metric is High, so you want to reduce it to Medium when you add your other metrics to ensure they take precedence.</span></span>
>

### <a name="defining-metrics-for-your-service---an-example"></a><span data-ttu-id="eccc3-177">Определение метрик для службы (пример)</span><span class="sxs-lookup"><span data-stu-id="eccc3-177">Defining metrics for your service - an example</span></span>
<span data-ttu-id="eccc3-178">Предположим, требуется следующая конфигурация:</span><span class="sxs-lookup"><span data-stu-id="eccc3-178">Let’s say you want the following configuration:</span></span>

  - <span data-ttu-id="eccc3-179">Служба сообщает о метрике ConnectionCount.</span><span class="sxs-lookup"><span data-stu-id="eccc3-179">Your service reports a metric named "ConnectionCount”</span></span>
  - <span data-ttu-id="eccc3-180">Вы также хотите использовать метрики по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eccc3-180">You also want to use the default metrics</span></span> 
  - <span data-ttu-id="eccc3-181">Вы провели некоторые измерения и выяснили, что обычно первичная реплика этой службы может потреблять 20 единиц MemoryInMb,</span><span class="sxs-lookup"><span data-stu-id="eccc3-181">You’ve done some measurements and know that normally a Primary replica of that service takes up 20 units of "ConnectionCount"</span></span>
  - <span data-ttu-id="eccc3-182">а вторичные реплики — 5 единиц.</span><span class="sxs-lookup"><span data-stu-id="eccc3-182">Secondaries use 5 units of "ConnectionCount"</span></span>
  - <span data-ttu-id="eccc3-183">Вы знаете, что ConnectionCount является наиболее важной метрикой с точки зрения управления производительностью данной службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-183">You know that "ConnectionCount" is the most important metric in terms of managing the performance of this particular service</span></span>
  - <span data-ttu-id="eccc3-184">Но вы все равно хотите, чтобы первичные реплики были сбалансированы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-184">You still want Primary replicas balanced.</span></span> <span data-ttu-id="eccc3-185">Балансировка первичных реплик обычно имеет смысл при любых обстоятельствах.</span><span class="sxs-lookup"><span data-stu-id="eccc3-185">Balancing primary replicas is generally a good idea no matter what.</span></span> <span data-ttu-id="eccc3-186">Это помогает избежать ситуации, когда потеря некоторых узлов или доменов сбоя негативно влияет и на большую часть первичных реплик.</span><span class="sxs-lookup"><span data-stu-id="eccc3-186">This helps prevent the loss of some node or fault domain from impacting a majority of primary replicas along with it.</span></span> 
  - <span data-ttu-id="eccc3-187">В прочих случаях можно использовать метрики по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eccc3-187">Otherwise, the default metrics are fine</span></span>

<span data-ttu-id="eccc3-188">Ниже приведен код, написанный для создания службы с этой конфигурацией метрики.</span><span class="sxs-lookup"><span data-stu-id="eccc3-188">Here’s the code that you would write to create a service with that metric configuration:</span></span>

<span data-ttu-id="eccc3-189">Код:</span><span class="sxs-lookup"><span data-stu-id="eccc3-189">Code:</span></span>

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
StatefulServiceLoadMetricDescription connectionMetric = new StatefulServiceLoadMetricDescription();
connectionMetric.Name = "ConnectionCount";
connectionMetric.PrimaryDefaultLoad = 20;
connectionMetric.SecondaryDefaultLoad = 5;
connectionMetric.Weight = ServiceLoadMetricWeight.High;

StatefulServiceLoadMetricDescription primaryCountMetric = new StatefulServiceLoadMetricDescription();
primaryCountMetric.Name = "PrimaryCount";
primaryCountMetric.PrimaryDefaultLoad = 1;
primaryCountMetric.SecondaryDefaultLoad = 0;
primaryCountMetric.Weight = ServiceLoadMetricWeight.Medium;

StatefulServiceLoadMetricDescription replicaCountMetric = new StatefulServiceLoadMetricDescription();
replicaCountMetric.Name = "ReplicaCount";
replicaCountMetric.PrimaryDefaultLoad = 1;
replicaCountMetric.SecondaryDefaultLoad = 1;
replicaCountMetric.Weight = ServiceLoadMetricWeight.Low;

StatefulServiceLoadMetricDescription totalCountMetric = new StatefulServiceLoadMetricDescription();
totalCountMetric.Name = "Count";
totalCountMetric.PrimaryDefaultLoad = 1;
totalCountMetric.SecondaryDefaultLoad = 1;
totalCountMetric.Weight = ServiceLoadMetricWeight.Low;

serviceDescription.Metrics.Add(connectionMetric);
serviceDescription.Metrics.Add(primaryCountMetric);
serviceDescription.Metrics.Add(replicaCountMetric);
serviceDescription.Metrics.Add(totalCountMetric);

await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="eccc3-190">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="eccc3-190">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ConnectionCount,High,20,5”,"PrimaryCount,Medium,1,0”,"ReplicaCount,Low,1,1”,"Count,Low,1,1”)
```

> [!NOTE]
> <span data-ttu-id="eccc3-191">В приведенных выше примерах и остальной части этого документа описывается управление метриками на уровне отдельных именованных служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-191">The above examples and the rest of this document describe managing metrics on a per-named-service basis.</span></span> <span data-ttu-id="eccc3-192">Можно также определить метрики для служб на уровне _типа_ службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-192">It is also possible to define metrics for your services at the service _type_ level.</span></span> <span data-ttu-id="eccc3-193">Для этого их нужно указать в манифестах служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-193">This is accomplished by specifying them in your service manifests.</span></span> <span data-ttu-id="eccc3-194">Определение метрики уровня типа не рекомендуется по нескольким причинам.</span><span class="sxs-lookup"><span data-stu-id="eccc3-194">Defining type level metrics is not recommended for several reasons.</span></span> <span data-ttu-id="eccc3-195">Первая причина заключается в том, что имена метрик часто зависят от среды.</span><span class="sxs-lookup"><span data-stu-id="eccc3-195">The first reason is that metric names are frequently environment-specific.</span></span> <span data-ttu-id="eccc3-196">При отсутствии утвержденного контракта нельзя быть уверенным, что метрика Cores в одной среде не называется MiliCores или CoReS в других средах.</span><span class="sxs-lookup"><span data-stu-id="eccc3-196">Unless there is a firm contract in place, you cannot be sure that the metric "Cores" in one environment isn't "MiliCores" or "CoReS" in others.</span></span> <span data-ttu-id="eccc3-197">Если метрики определены в манифесте, необходимо создавать новые манифесты для каждой среды.</span><span class="sxs-lookup"><span data-stu-id="eccc3-197">If your metrics are defined in your manifest you need to create new manifests per environment.</span></span> <span data-ttu-id="eccc3-198">Обычно это порождает большое число различных манифестов с незначительными отличиями, что может усложнить управление.</span><span class="sxs-lookup"><span data-stu-id="eccc3-198">This usually leads to a proliferation of different manifests with only minor differences, which can lead to management difficulties.</span></span>  
>
> <span data-ttu-id="eccc3-199">Как правило, нагрузки метрик назначаются на уровне отдельных именованных экземпляров служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-199">Metric loads are commonly assigned on a per-named-service-instance basis.</span></span> <span data-ttu-id="eccc3-200">Предположим, что вы создаете один экземпляр службы для клиента А, который планирует использовать его лишь в незначительной степени.</span><span class="sxs-lookup"><span data-stu-id="eccc3-200">For example, let's say you create one instance of the service for CustomerA who plans to use it only lightly.</span></span> <span data-ttu-id="eccc3-201">Также предположим, что вы создаете другую службу для клиента Б, рабочая нагрузка которого больше.</span><span class="sxs-lookup"><span data-stu-id="eccc3-201">Let's also say you create another for CustomerB who has a larger workload.</span></span> <span data-ttu-id="eccc3-202">В этом случае, вероятно, следует настроить нагрузку по умолчанию для этих служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-202">In this case, you'd probably want to tweak the default loads for those services.</span></span> <span data-ttu-id="eccc3-203">Если имеются метрики и нагрузки, определенные в манифестах, и необходима поддержка этого сценария, то для этого потребуются разные типы приложений и служб для каждого клиента.</span><span class="sxs-lookup"><span data-stu-id="eccc3-203">If you have metrics and loads defined via manifests and you want to support this scenario, it requires different application and service types for each customer.</span></span> <span data-ttu-id="eccc3-204">Значения, определенные во время создания службы, переопределяют значения, определенные в манифесте, поэтому их можно использовать, чтобы задать значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eccc3-204">The values defined at service creation time override those defined in the manifest, so you could use that to set the specific defaults.</span></span> <span data-ttu-id="eccc3-205">Однако это приводит к тому, что значения, объявленные в манифестах, не совпадают с фактическими значениями, используемыми работающей службой.</span><span class="sxs-lookup"><span data-stu-id="eccc3-205">However, doing that causes the values declared in the manifests to not match those the service actually runs with.</span></span> <span data-ttu-id="eccc3-206">Это может привести к путанице.</span><span class="sxs-lookup"><span data-stu-id="eccc3-206">This can lead to confusion.</span></span> 
>

<span data-ttu-id="eccc3-207">Напоминаем, что если вы хотите использовать метрики по умолчанию, то вам вообще не нужно ничего менять в коллекции метрик или делать что-то специальное при создании службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-207">As a reminder: if you just want to use the default metrics, you don’t need to touch the metrics collection at all or do anything special when creating your service.</span></span> <span data-ttu-id="eccc3-208">Метрики по умолчанию используются автоматически, если другие метрики не определены.</span><span class="sxs-lookup"><span data-stu-id="eccc3-208">The default metrics get used automatically when no others are defined.</span></span> 

<span data-ttu-id="eccc3-209">Теперь подробнее рассмотрим каждый из этих параметров и обсудим, на что он влияет.</span><span class="sxs-lookup"><span data-stu-id="eccc3-209">Now, let's go through each of these settings in more detail and talk about the behavior that it influences.</span></span>

## <a name="load"></a><span data-ttu-id="eccc3-210">загрузить</span><span class="sxs-lookup"><span data-stu-id="eccc3-210">Load</span></span>
<span data-ttu-id="eccc3-211">Весь смысл определения метрики заключается в том, чтобы представить определенную нагрузку.</span><span class="sxs-lookup"><span data-stu-id="eccc3-211">The whole point of defining metrics is to represent some load.</span></span> <span data-ttu-id="eccc3-212">*Нагрузка* — это количество единиц определенной метрики, используемое экземпляром или репликой службы на заданном узле.</span><span class="sxs-lookup"><span data-stu-id="eccc3-212">*Load* is how much of a given metric is consumed by some service instance or replica on a given node.</span></span> <span data-ttu-id="eccc3-213">Нагрузку можно настроить практически в любой момент.</span><span class="sxs-lookup"><span data-stu-id="eccc3-213">Load can be configured at almost any point.</span></span> <span data-ttu-id="eccc3-214">Например:</span><span class="sxs-lookup"><span data-stu-id="eccc3-214">For example:</span></span>

  - <span data-ttu-id="eccc3-215">Можно определить нагрузку при создании службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-215">Load can be defined when a service is created.</span></span> <span data-ttu-id="eccc3-216">Она называется _нагрузкой по умолчанию_.</span><span class="sxs-lookup"><span data-stu-id="eccc3-216">This is called _default load_.</span></span>
  - <span data-ttu-id="eccc3-217">Данные о метрике, включая нагрузки по умолчанию, для службы могут быть обновлены после создания службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-217">The metric information, including default loads, for a service can updated after the service is created.</span></span> <span data-ttu-id="eccc3-218">Это называется _обновлением службы_.</span><span class="sxs-lookup"><span data-stu-id="eccc3-218">This is called _updating a service_.</span></span> 
  - <span data-ttu-id="eccc3-219">Нагрузки для заданной секции можно сбросить, восстановив значения по умолчанию для этой службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-219">The loads for a given partition can be reset to the default values for that service.</span></span> <span data-ttu-id="eccc3-220">Это называется _сбросом нагрузки секции_.</span><span class="sxs-lookup"><span data-stu-id="eccc3-220">This is called _resetting partition load_.</span></span>
  - <span data-ttu-id="eccc3-221">Можно создавать отчеты о динамической нагрузке каждого объекта службы во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="eccc3-221">Load can be reported on a per service object basis dynamically during runtime.</span></span> <span data-ttu-id="eccc3-222">Это называется _созданием отчетов о нагрузке_.</span><span class="sxs-lookup"><span data-stu-id="eccc3-222">This is called _reporting load_.</span></span> 
  
<span data-ttu-id="eccc3-223">Все эти стратегии можно использовать в одной и той же службе на протяжении ее времени существования.</span><span class="sxs-lookup"><span data-stu-id="eccc3-223">All of these strategies can be used within the same service over its lifetime.</span></span> 

## <a name="default-load"></a><span data-ttu-id="eccc3-224">Нагрузка по умолчанию</span><span class="sxs-lookup"><span data-stu-id="eccc3-224">Default load</span></span>
<span data-ttu-id="eccc3-225">*Нагрузка по умолчанию* означает, сколько единиц метрики потребляет каждый объект службы (экземпляр без отслеживания состояния или реплика с отслеживанием состояния) данной службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-225">*Default load* is how much of the metric each service object (stateless instance or stateful replica) of this service consumes.</span></span> <span data-ttu-id="eccc3-226">Диспетчер кластерных ресурсов использует это число для определения нагрузки объекта службы, пока не получит другие сведения, такие как отчет о динамической нагрузке.</span><span class="sxs-lookup"><span data-stu-id="eccc3-226">The Cluster Resource Manager uses this number for the load of the service object until it receives other information, such as a dynamic load report.</span></span> <span data-ttu-id="eccc3-227">Для более простых служб нагрузка по умолчанию представляет собой статическое определение.</span><span class="sxs-lookup"><span data-stu-id="eccc3-227">For simpler services, the default load is a static definition.</span></span> <span data-ttu-id="eccc3-228">Нагрузка по умолчанию никогда не обновляется и используется в течение всего времени существования службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-228">The default load is never updated and is used for the lifetime of the service.</span></span> <span data-ttu-id="eccc3-229">Нагрузки по умолчанию прекрасно подходят для простых сценариев планирования ресурсов, в которых различным рабочим нагрузкам выделяются определенные объемы ресурсов, которые не изменяются.</span><span class="sxs-lookup"><span data-stu-id="eccc3-229">Default loads works great for simple capacity planning scenarios where certain amounts of resources are dedicated to different workloads and do not change.</span></span>

> [!NOTE]
> <span data-ttu-id="eccc3-230">Дополнительные сведения об управлении емкостью и определении емкости узлов в кластере см. в [этой статье](service-fabric-cluster-resource-manager-cluster-description.md#capacity).</span><span class="sxs-lookup"><span data-stu-id="eccc3-230">For more information on capacity management and defining capacities for the nodes in your cluster, please see [this article](service-fabric-cluster-resource-manager-cluster-description.md#capacity).</span></span>
> 

<span data-ttu-id="eccc3-231">Диспетчер кластерных ресурсов позволяет службам с отслеживанием состояния задать различные нагрузки по умолчанию для первичных и вторичных реплик.</span><span class="sxs-lookup"><span data-stu-id="eccc3-231">The Cluster Resource Manager allows stateful services to specify a different default load for their Primaries and Secondaries.</span></span> <span data-ttu-id="eccc3-232">Службы без отслеживания состояния могут указать только одно значение, которое применяется ко всем экземплярам.</span><span class="sxs-lookup"><span data-stu-id="eccc3-232">Stateless services can only specify one value that applies to all instances.</span></span> <span data-ttu-id="eccc3-233">Для служб с отслеживанием состояния нагрузки по умолчанию для первичных и вторичных реплик обычно отличаются, так как в каждой из этих ролей реплики выполняют различные виды работы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-233">For stateful services, the default load for Primary and Secondary replicas are typically different since replicas do different kinds of work in each role.</span></span> <span data-ttu-id="eccc3-234">Например, в отличие от вторичных реплик, первичные реплики обычно используются для обработки операций чтения и записи и берут на себя большую часть вычислительной нагрузки.</span><span class="sxs-lookup"><span data-stu-id="eccc3-234">For example, Primaries usually serve both reads and writes, and handle most of the computational burden, while secondaries do not.</span></span> <span data-ttu-id="eccc3-235">Обычно нагрузка по умолчанию для первичной реплики больше, чем нагрузка по умолчанию для вторичных реплик.</span><span class="sxs-lookup"><span data-stu-id="eccc3-235">Usually the default load for a primary replica is higher than the default load for secondary replicas.</span></span> <span data-ttu-id="eccc3-236">Фактические значения должны основываться на ваших измерениях.</span><span class="sxs-lookup"><span data-stu-id="eccc3-236">The real numbers should depend on your own measurements.</span></span>

## <a name="dynamic-load"></a><span data-ttu-id="eccc3-237">Динамическая нагрузка</span><span class="sxs-lookup"><span data-stu-id="eccc3-237">Dynamic load</span></span>
<span data-ttu-id="eccc3-238">Предположим, что ваша служба работает уже некоторое время.</span><span class="sxs-lookup"><span data-stu-id="eccc3-238">Let’s say that you’ve been running your service for a while.</span></span> <span data-ttu-id="eccc3-239">С помощью средств мониторинга вы определили, что:</span><span class="sxs-lookup"><span data-stu-id="eccc3-239">With some monitoring, you’ve noticed that:</span></span>

1. <span data-ttu-id="eccc3-240">некоторые разделы или экземпляры данной службы потребляют больше ресурсов, чем другие;</span><span class="sxs-lookup"><span data-stu-id="eccc3-240">Some partitions or instances of a given service consume more resources than others</span></span>
2. <span data-ttu-id="eccc3-241">нагрузки некоторых служб меняются с течением времени.</span><span class="sxs-lookup"><span data-stu-id="eccc3-241">Some services have load that varies over time.</span></span>

<span data-ttu-id="eccc3-242">Такого рода колебания нагрузки могут возникать по различным причинам.</span><span class="sxs-lookup"><span data-stu-id="eccc3-242">There's lots of things that could cause these types of load fluctuations.</span></span> <span data-ttu-id="eccc3-243">Например, разные службы или секции могут быть связаны с разными клиентами с отличающимися требованиями.</span><span class="sxs-lookup"><span data-stu-id="eccc3-243">For example, different services or partitions are associated with different customers with different requirements.</span></span> <span data-ttu-id="eccc3-244">Нагрузка также может изменяться из-за того, что объем работы, который выполняет служба, меняется в течение дня.</span><span class="sxs-lookup"><span data-stu-id="eccc3-244">Load could also change because the amount of work the service does varies over the course of the day.</span></span> <span data-ttu-id="eccc3-245">Так или иначе, обычно вы не можете использовать для нагрузки по умолчанию какое-либо строго определенное значение.</span><span class="sxs-lookup"><span data-stu-id="eccc3-245">Regardless of the reason, there’s usually no single number that you can use for default.</span></span> <span data-ttu-id="eccc3-246">Это особенно важно, если вы хотите максимально эффективно использовать ресурсы кластера.</span><span class="sxs-lookup"><span data-stu-id="eccc3-246">This is especially true if you want to get the most utilization out of the cluster.</span></span> <span data-ttu-id="eccc3-247">Какую бы величину вы ни выбрали, какое-то время она будет неправильной.</span><span class="sxs-lookup"><span data-stu-id="eccc3-247">Any value you pick for default load is wrong some of the time.</span></span> <span data-ttu-id="eccc3-248">При неправильно заданных нагрузках по умолчанию диспетчер кластерных ресурсов будет выделять избыточное или недостаточное количество ресурсов.</span><span class="sxs-lookup"><span data-stu-id="eccc3-248">Incorrect default loads result in the Cluster Resource Manager either over or under allocating resources.</span></span> <span data-ttu-id="eccc3-249">В результате у вас появятся недостаточно и избыточно используемые узлы, даже если с точки зрения диспетчер кластерных ресурсов кластер будет сбалансированным.</span><span class="sxs-lookup"><span data-stu-id="eccc3-249">As a result, you have nodes that are over or under utilized even though the Cluster Resource Manager thinks the cluster is balanced.</span></span> <span data-ttu-id="eccc3-250">И все же использовать нагрузки по умолчанию весьма удобно, так как они предоставляют определенные сведения для первоначального размещения, хотя и не отражают реальное состояние рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="eccc3-250">Default loads are still good since they provide some information for initial placement, but they're not a complete story for real workloads.</span></span> <span data-ttu-id="eccc3-251">Чтобы точно выявлять меняющиеся требования к ресурсам, диспетчер кластерных ресурсов позволяет каждому объекту службы обновлять данные о своей нагрузке во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="eccc3-251">To accurately capture changing resource requirements, the Cluster Resource Manager allows each service object to update its own load during runtime.</span></span> <span data-ttu-id="eccc3-252">Это называется передачей данных о динамической нагрузке.</span><span class="sxs-lookup"><span data-stu-id="eccc3-252">This is called dynamic load reporting.</span></span>

<span data-ttu-id="eccc3-253">Отчеты о динамической нагрузке позволяют репликам или экземплярам во время своего существования регулировать заявленную или реальную нагрузку для метрик.</span><span class="sxs-lookup"><span data-stu-id="eccc3-253">Dynamic load reports allow replicas or instances to adjust their allocation/reported load of metrics over their lifetime.</span></span> <span data-ttu-id="eccc3-254">Реплики или экземпляры службы, которые простаивали и не выполняли никакой работы, обычно сообщают, что они использовали меньшее количество заданной метрики.</span><span class="sxs-lookup"><span data-stu-id="eccc3-254">A service replica or instance that was cold and not doing any work would usually report that it was using low amounts of a given metric.</span></span> <span data-ttu-id="eccc3-255">В то же время загруженные реплики или экземпляры сообщают, что они используют больше ресурсов.</span><span class="sxs-lookup"><span data-stu-id="eccc3-255">A busy replica or instance would report that they are using more.</span></span>

<span data-ttu-id="eccc3-256">Отчеты о нагрузке для каждой реплики или экземпляра позволяют диспетчеру кластерных ресурсов реорганизовать отдельные объекты службы в кластере.</span><span class="sxs-lookup"><span data-stu-id="eccc3-256">Reporting load per replica or instance allows the Cluster Resource Manager to reorganize the individual service objects in the cluster.</span></span> <span data-ttu-id="eccc3-257">Реорганизация служб гарантирует получение ими необходимых ресурсов.</span><span class="sxs-lookup"><span data-stu-id="eccc3-257">Reorganizing the services helps ensure that they get the resources they require.</span></span> <span data-ttu-id="eccc3-258">По сути, загруженные службы "высвобождают" неиспользуемые или мало используемые ресурсы других реплик или экземпляров.</span><span class="sxs-lookup"><span data-stu-id="eccc3-258">Busy services effectively get to "reclaim" resources from other replicas or instances that are currently cold or doing less work.</span></span>

<span data-ttu-id="eccc3-259">В Reliable Services код, используемый для динамического создания отчетов о нагрузке, выглядит следующим образом.</span><span class="sxs-lookup"><span data-stu-id="eccc3-259">Within Reliable Services, the code to report load dynamically looks like this:</span></span>

<span data-ttu-id="eccc3-260">Код:</span><span class="sxs-lookup"><span data-stu-id="eccc3-260">Code:</span></span>

```csharp
this.Partition.ReportLoad(new List<LoadMetric> { new LoadMetric("CurrentConnectionCount", 1234), new LoadMetric("metric1", 42) });
```

<span data-ttu-id="eccc3-261">Служба может сообщать о любой из метрик, определенной для нее во время создания.</span><span class="sxs-lookup"><span data-stu-id="eccc3-261">A service can report on any of the metrics defined for it at creation time.</span></span> <span data-ttu-id="eccc3-262">Если служба сообщает о нагрузке для метрики, использование которой не настроено, Service Fabric игнорирует этот отчет.</span><span class="sxs-lookup"><span data-stu-id="eccc3-262">If a service reports load for a metric that it is not configured to use, Service Fabric ignores that report.</span></span> <span data-ttu-id="eccc3-263">Если одновременно сообщается и о других допустимых метриках, эти отчеты принимаются.</span><span class="sxs-lookup"><span data-stu-id="eccc3-263">If there are other metrics reported at the same time that are valid, those reports are accepted.</span></span> <span data-ttu-id="eccc3-264">Код службы может измерять значения всех известных метрик и сообщать о них. При этом операторам не нужно вносить изменения в код службы, чтобы задать конфигурацию метрик для нее.</span><span class="sxs-lookup"><span data-stu-id="eccc3-264">Service code can measure and report all the metrics it knows how to, and operators can specify the metric configuration to use without having to change the service code.</span></span> 

### <a name="updating-a-services-metric-configuration"></a><span data-ttu-id="eccc3-265">Обновление конфигурации метрик службы</span><span class="sxs-lookup"><span data-stu-id="eccc3-265">Updating a service's metric configuration</span></span>
<span data-ttu-id="eccc3-266">Список метрик, связанных со службой, и свойства этих метрик могут быть обновлены динамически во время выполнения службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-266">The list of metrics associated with the service, and the properties of those metrics can be updated dynamically while the service is live.</span></span> <span data-ttu-id="eccc3-267">Это позволяет экспериментировать и обеспечивает гибкость.</span><span class="sxs-lookup"><span data-stu-id="eccc3-267">This allows for experimentation and flexibility.</span></span> <span data-ttu-id="eccc3-268">Ниже приведено несколько примеров, когда это удобно использовать:</span><span class="sxs-lookup"><span data-stu-id="eccc3-268">Some examples of when this is useful are:</span></span>

  - <span data-ttu-id="eccc3-269">отключение метрики с ошибками в отчете для определенной службы;</span><span class="sxs-lookup"><span data-stu-id="eccc3-269">disabling a metric with a buggy report for a particular service</span></span>
  - <span data-ttu-id="eccc3-270">перенастройка весов метрик в зависимости от требуемого поведения;</span><span class="sxs-lookup"><span data-stu-id="eccc3-270">reconfiguring the weights of metrics based on desired behavior</span></span>
  - <span data-ttu-id="eccc3-271">включение новой метрики только после того, как код будет развернут и проверен с помощью других механизмов;</span><span class="sxs-lookup"><span data-stu-id="eccc3-271">enabling a new metric only after the code has already been deployed and validated via other mechanisms</span></span>
  - <span data-ttu-id="eccc3-272">изменение нагрузки по умолчанию для службы на основе наблюдаемого поведения и потребления.</span><span class="sxs-lookup"><span data-stu-id="eccc3-272">changing the default load for a service based on observed behavior and consumption</span></span>

<span data-ttu-id="eccc3-273">Основными интерфейсами API для изменения конфигурации метрик являются `FabricClient.ServiceManagementClient.UpdateServiceAsync` в C# и `Update-ServiceFabricService` в PowerShell.</span><span class="sxs-lookup"><span data-stu-id="eccc3-273">The main APIs for changing metric configuration are `FabricClient.ServiceManagementClient.UpdateServiceAsync` in C# and `Update-ServiceFabricService` in PowerShell.</span></span> <span data-ttu-id="eccc3-274">Любые данные, указанные с помощью этих API, немедленно заменяют существующие сведения о метриках для службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-274">Whatever information you specify with these APIs replaces the existing metric information for the service immediately.</span></span> 

## <a name="mixing-default-load-values-and-dynamic-load-reports"></a><span data-ttu-id="eccc3-275">Совместное использование значений нагрузки по умолчанию и отчетов о динамической загрузке</span><span class="sxs-lookup"><span data-stu-id="eccc3-275">Mixing default load values and dynamic load reports</span></span>
<span data-ttu-id="eccc3-276">Нагрузка по умолчанию и динамические нагрузки могут использоваться для одной и той же службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-276">Default load and dynamic loads can be used for the same service.</span></span> <span data-ttu-id="eccc3-277">Если служба использует нагрузку по умолчанию и отчеты о динамической нагрузке, то нагрузка по умолчанию служит в качестве оценочного значения, пока не появятся отчеты о динамической нагрузке.</span><span class="sxs-lookup"><span data-stu-id="eccc3-277">When a service utilizes both default load and dynamic load reports, default load serves as an estimate until dynamic reports show up.</span></span> <span data-ttu-id="eccc3-278">Использовать нагрузку по умолчанию удобно, так как диспетчер кластерных ресурсов сразу получает данные для работы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-278">Default load is good because it gives the Cluster Resource Manager something to work with.</span></span> <span data-ttu-id="eccc3-279">Используя нагрузку по умолчанию, диспетчер кластерных ресурсов может оптимально разместить объекты службы при их создании.</span><span class="sxs-lookup"><span data-stu-id="eccc3-279">The default load allows the Cluster Resource Manager to place the service objects in good locations when they are created.</span></span> <span data-ttu-id="eccc3-280">Если сведения по умолчанию не предоставляются, службы размещаются практически произвольно.</span><span class="sxs-lookup"><span data-stu-id="eccc3-280">If no default load information is provided, placement of services is effectively random.</span></span> <span data-ttu-id="eccc3-281">Когда позже поступают отчеты о нагрузке, первоначальное произвольное размещение часто оказывается неправильным, и диспетчеру кластерных ресурсов приходится перемещать службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-281">When load reports arrive later the initial random placement is often wrong and the Cluster Resource Manager has to move services.</span></span>

<span data-ttu-id="eccc3-282">Возьмем наш предыдущий пример и посмотрим, что произойдет, если мы добавим пользовательские метрики и будем динамически создавать отчеты о нагрузке.</span><span class="sxs-lookup"><span data-stu-id="eccc3-282">Let’s take our previous example and see what happens when we add some custom metrics and dynamic load reporting.</span></span> <span data-ttu-id="eccc3-283">В этом примере мы используем метрику MemoryInMb.</span><span class="sxs-lookup"><span data-stu-id="eccc3-283">In this example, we use “MemoryInMb” as an example metric.</span></span>

> [!NOTE]
> <span data-ttu-id="eccc3-284">Память является одной из системных метрик, [ресурсами которой может управлять](service-fabric-resource-governance.md) Service Fabric, и самостоятельно создавать отчеты о ней обычно затруднительно.</span><span class="sxs-lookup"><span data-stu-id="eccc3-284">Memory is one of the system metrics that Service Fabric can [resource govern](service-fabric-resource-governance.md), and reporting it yourself is typically difficult.</span></span> <span data-ttu-id="eccc3-285">Мы не ожидаем, что вы действительно будете создавать отчеты об использовании памяти. Здесь память используется как средство для изучения возможностей диспетчера кластерных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="eccc3-285">We don't actually expect you to report on Memory consumption; Memory is used here as an aid to learning about the capabilities of the Cluster Resource Manager.</span></span>
>

<span data-ttu-id="eccc3-286">Предположим, мы создали службу с отслеживанием состояния с помощью следующей команды:</span><span class="sxs-lookup"><span data-stu-id="eccc3-286">Let’s presume that we initially created the stateful service with the following command:</span></span>

<span data-ttu-id="eccc3-287">PowerShell:</span><span class="sxs-lookup"><span data-stu-id="eccc3-287">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("MemoryInMb,High,21,11”,"PrimaryCount,Medium,1,0”,"ReplicaCount,Low,1,1”,"Count,Low,1,1”)
```

<span data-ttu-id="eccc3-288">Напомним, что синтаксис выглядит следующим образом: ("MetricName, MetricWeight, PrimaryDefaultLoad, SecondaryDefaultLoad").</span><span class="sxs-lookup"><span data-stu-id="eccc3-288">As a reminder, this syntax is ("MetricName, MetricWeight, PrimaryDefaultLoad, SecondaryDefaultLoad").</span></span>

<span data-ttu-id="eccc3-289">Один из возможных макетов кластера может выглядеть как:</span><span class="sxs-lookup"><span data-stu-id="eccc3-289">Let's see what one possible cluster layout could look like:</span></span>

<span data-ttu-id="eccc3-290"><center>
![Сбалансированный кластер с метриками по умолчанию и пользовательскими метриками][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="eccc3-290"><center>
![Cluster Balanced with both Default and Custom metrics][Image2]
</center></span></span>

<span data-ttu-id="eccc3-291">Обратите внимание на следующие факторы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-291">Some things that are worth noting:</span></span>

* <span data-ttu-id="eccc3-292">Вторичные реплики в секции могут иметь собственные нагрузки.</span><span class="sxs-lookup"><span data-stu-id="eccc3-292">Secondary replicas within a partition can each have their own load</span></span>
* <span data-ttu-id="eccc3-293">В целом метрики выглядят сбалансированными.</span><span class="sxs-lookup"><span data-stu-id="eccc3-293">Overall the metrics look balanced.</span></span> <span data-ttu-id="eccc3-294">В случае памяти отношение между минимальной и максимальной нагрузкой составляет 1,75 (узел с наибольшей нагрузкой — N3, с наименьшей — N2, следовательно 28/16 = 1,75).</span><span class="sxs-lookup"><span data-stu-id="eccc3-294">For Memory, the ratio between the maximum and minimum load is 1.75 (the node with the most load is N3, the least is N2, and 28/16 = 1.75).</span></span>

<span data-ttu-id="eccc3-295">Но некоторые факторы все же необходимо объяснить.</span><span class="sxs-lookup"><span data-stu-id="eccc3-295">There are some things that we still need to explain:</span></span>

* <span data-ttu-id="eccc3-296">Как определить, является ли соотношение 1,75 разумным?</span><span class="sxs-lookup"><span data-stu-id="eccc3-296">What determined whether a ratio of 1.75 was reasonable or not?</span></span> <span data-ttu-id="eccc3-297">Как Cluster Resource Manager узнает, достаточно ли этого соотношения или нужно еще что-то делать?</span><span class="sxs-lookup"><span data-stu-id="eccc3-297">How does the Cluster Resource Manager know if that’s good enough or if there is more work to do?</span></span>
* <span data-ttu-id="eccc3-298">Когда происходит балансировка нагрузки?</span><span class="sxs-lookup"><span data-stu-id="eccc3-298">When does balancing happen?</span></span>
* <span data-ttu-id="eccc3-299">Что означает, если вес метрики "Память" определен как высокий?</span><span class="sxs-lookup"><span data-stu-id="eccc3-299">What does it mean that Memory was weighted “High”?</span></span>

## <a name="metric-weights"></a><span data-ttu-id="eccc3-300">Вес метрик</span><span class="sxs-lookup"><span data-stu-id="eccc3-300">Metric weights</span></span>
<span data-ttu-id="eccc3-301">Важно отслеживать одни и те же метрики для разных служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-301">Tracking the same metrics across different services is important.</span></span> <span data-ttu-id="eccc3-302">Такой глобальный охват позволяет диспетчеру кластерных ресурсов отслеживать потребление ресурсов в кластере, обеспечивать балансировку потребления межу узлами и следить за тем, чтобы емкость узлов не была превышена.</span><span class="sxs-lookup"><span data-stu-id="eccc3-302">That global view is what allows the Cluster Resource Manager to track consumption in the cluster, balance consumption across nodes, and ensure that nodes don’t go over capacity.</span></span> <span data-ttu-id="eccc3-303">Тем не менее важность одной и той же метрики для разных служб может отличаться.</span><span class="sxs-lookup"><span data-stu-id="eccc3-303">However, services may have different views as to the importance of the same metric.</span></span> <span data-ttu-id="eccc3-304">Кроме того, в кластере с множеством метрик и большим количеством служб для некоторых метрик полностью сбалансированные решения могут и не существовать.</span><span class="sxs-lookup"><span data-stu-id="eccc3-304">Also, in a cluster with many metrics and lots of services, perfectly balanced solutions may not exist for all metrics.</span></span> <span data-ttu-id="eccc3-305">Как в таких ситуациях должен поступать Cluster Resource Manager?</span><span class="sxs-lookup"><span data-stu-id="eccc3-305">How should the Cluster Resource Manager handle these situations?</span></span>

<span data-ttu-id="eccc3-306">Веса метрик позволяют Cluster Resource Manager принимать решение о способе балансировки кластера, когда нет идеального решения.</span><span class="sxs-lookup"><span data-stu-id="eccc3-306">Metric weights allow the Cluster Resource Manager to decide how to balance the cluster when there’s no perfect answer.</span></span> <span data-ttu-id="eccc3-307">Веса метрик также позволяют Cluster Resource Manager по-разному выполнять балансировку для определенных служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-307">Metric weights also allow the Cluster Resource Manager to balance specific services differently.</span></span> <span data-ttu-id="eccc3-308">Метрики могут иметь четыре разных уровня веса: нулевой, низкий, средний и высокий.</span><span class="sxs-lookup"><span data-stu-id="eccc3-308">Metrics can have four different weight levels: Zero, Low, Medium, and High.</span></span> <span data-ttu-id="eccc3-309">Метрика с нулевым весом не играет роли для балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="eccc3-309">A metric with a weight of Zero contributes nothing when considering whether things are balanced or not.</span></span> <span data-ttu-id="eccc3-310">Однако ее нагрузка имеет значение для управления емкостью.</span><span class="sxs-lookup"><span data-stu-id="eccc3-310">However, its load does still contribute to capacity management.</span></span> <span data-ttu-id="eccc3-311">Метрики с нулевым весом удобны и часто используются для настройки поведения службы и отслеживания производительности.</span><span class="sxs-lookup"><span data-stu-id="eccc3-311">Metrics with Zero weight are still useful and are frequently used as a part of service behavior and performance monitoring.</span></span> <span data-ttu-id="eccc3-312">[В этой статье](service-fabric-diagnostics-event-generation-infra.md) приведены дополнительные сведения об использовании метрик для мониторинга и диагностики служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-312">[This article](service-fabric-diagnostics-event-generation-infra.md) provides more information on the use of metrics for monitoring and diagnostics of your services.</span></span> 

<span data-ttu-id="eccc3-313">Фактическое влияние разных весов метрик в кластере проявляется в том, что Cluster Resource Manager создает различные решения.</span><span class="sxs-lookup"><span data-stu-id="eccc3-313">The real impact of different metric weights in the cluster is that the Cluster Resource Manager generates different solutions.</span></span> <span data-ttu-id="eccc3-314">По ним он определяет, какие из метрик важнее других.</span><span class="sxs-lookup"><span data-stu-id="eccc3-314">Metric weights tell the Cluster Resource Manager that certain metrics are more important than others.</span></span> <span data-ttu-id="eccc3-315">При отсутствии идеального решения служба Cluster Resource Manager может выбрать решения, которые лучше балансируют метрики с большими весами.</span><span class="sxs-lookup"><span data-stu-id="eccc3-315">When there's no perfect solution the Cluster Resource Manager can prefer solutions which balance the higher weighted metrics better.</span></span> <span data-ttu-id="eccc3-316">Если определенная метрика неважна для какой-либо службы, то с точки зрения диспетчера кластерных ресурсов ее использование может казаться несбалансированным.</span><span class="sxs-lookup"><span data-stu-id="eccc3-316">If a service thinks a particular metric is unimportant, it may find their use of that metric imbalanced.</span></span> <span data-ttu-id="eccc3-317">Это позволит другой службе получить равномерное распределение для метрики, которая важна для нее.</span><span class="sxs-lookup"><span data-stu-id="eccc3-317">This allows another service to get an even distribution of some metric that is important to it.</span></span>

<span data-ttu-id="eccc3-318">Рассмотрим пример нескольких отчетов о нагрузке и влияния разных весов метрик на выделение ресурсов в кластере.</span><span class="sxs-lookup"><span data-stu-id="eccc3-318">Let’s look at an example of some load reports and how different metric weights results in different allocations in the cluster.</span></span> <span data-ttu-id="eccc3-319">В этом примере мы видим, что переключение относительного веса метрик влияет на то, как диспетчер кластерных ресурсов организовывает размещение служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-319">In this example, we see that switching the relative weight of the metrics causes the Cluster Resource Manager to create different arrangements of services.</span></span>

<span data-ttu-id="eccc3-320"><center>
![Пример веса метрики и его влияния на решения балансировки нагрузки][Image3]
</center></span><span class="sxs-lookup"><span data-stu-id="eccc3-320"><center>
![Metric Weight Example and Its Impact on Balancing Solutions][Image3]
</center></span></span>

<span data-ttu-id="eccc3-321">В этом примере используются четыре разные службы. Все они сообщают разные значения для двух метрик, MetricA и MetricB.</span><span class="sxs-lookup"><span data-stu-id="eccc3-321">In this example, there are four different services, all reporting different values for two different metrics, MetricA and MetricB.</span></span> <span data-ttu-id="eccc3-322">В одном случае все службы определяют метрику MetricA как наиболее важную (высокий вес), а метрику MetricB — как несущественную (низкий вес).</span><span class="sxs-lookup"><span data-stu-id="eccc3-322">In one case, all the services define MetricA is the most important one (Weight = High) and MetricB as unimportant (Weight = Low).</span></span> <span data-ttu-id="eccc3-323">В результате мы видим, что диспетчер кластерных ресурсов размещает службы таким образом, чтобы нагрузка для метрики MetricA была лучше сбалансирована, чем нагрузка для метрики MetricB.</span><span class="sxs-lookup"><span data-stu-id="eccc3-323">As a result, we see that the Cluster Resource Manager places the services so that MetricA is better balanced than MetricB.</span></span> <span data-ttu-id="eccc3-324">"Лучше сбалансирована" означает, что среднеквадратичное отклонение метрики MetricA меньше, чем среднеквадратичное отклонение метрики MetricB.</span><span class="sxs-lookup"><span data-stu-id="eccc3-324">"Better balanced" means that MetricA has a lower has a lower standard deviation than MetricB.</span></span> <span data-ttu-id="eccc3-325">Во втором случае мы поменяли веса метрик местами.</span><span class="sxs-lookup"><span data-stu-id="eccc3-325">In the second case, we reverse the metric weights.</span></span> <span data-ttu-id="eccc3-326">В результате диспетчер кластерных ресурсов меняет местами службы A и B, чтобы обеспечить выделение ресурсов, при котором нагрузка для метрики MetricB сбалансирована лучше, чем для метрики MetricA.</span><span class="sxs-lookup"><span data-stu-id="eccc3-326">As a result, the Cluster Resource Manager swaps services A and B to come up with an allocation where MetricB is better balanced than MetricA.</span></span>

> [!NOTE]
> <span data-ttu-id="eccc3-327">Веса метрик определяют, как диспетчер кластерных ресурсов балансирует нагрузку, но не определяют, когда именно осуществляется балансировка.</span><span class="sxs-lookup"><span data-stu-id="eccc3-327">Metric weights determine how the Cluster Resource Manager should balance, but not when balancing should happen.</span></span> <span data-ttu-id="eccc3-328">Дополнительные сведения о балансировке см. в [этой статье](service-fabric-cluster-resource-manager-balancing.md).</span><span class="sxs-lookup"><span data-stu-id="eccc3-328">For more information on balancing, check out [this article](service-fabric-cluster-resource-manager-balancing.md)</span></span>
>

### <a name="global-metric-weights"></a><span data-ttu-id="eccc3-329">Глобальный вес метрик</span><span class="sxs-lookup"><span data-stu-id="eccc3-329">Global metric weights</span></span>
<span data-ttu-id="eccc3-330">Предположим, что служба ServiceA определяет метрику MetricA и назначает ей высокий вес, а служба ServiceB назначает метрике MetricA низкий или нулевой вес.</span><span class="sxs-lookup"><span data-stu-id="eccc3-330">Let's say ServiceA defines MetricA as weight High, and ServiceB sets the weight for MetricA to Low or Zero.</span></span> <span data-ttu-id="eccc3-331">Какой же фактический вес будет использован в итоге?</span><span class="sxs-lookup"><span data-stu-id="eccc3-331">What’s the actual weight that ends up getting used?</span></span>

<span data-ttu-id="eccc3-332">Для каждой метрики отслеживаются несколько весов.</span><span class="sxs-lookup"><span data-stu-id="eccc3-332">There are multiple weights that are tracked for every metric.</span></span> <span data-ttu-id="eccc3-333">Первый вес — это вес, определенный для метрики при создании службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-333">The first weight is the one defined for the metric when the service is created.</span></span> <span data-ttu-id="eccc3-334">Второй вес — это глобальной вес, который вычисляется автоматически.</span><span class="sxs-lookup"><span data-stu-id="eccc3-334">The other weight is a global weight, which is computed automatically.</span></span> <span data-ttu-id="eccc3-335">Диспетчер кластерных ресурсов использует оба эти веса для оценки решений.</span><span class="sxs-lookup"><span data-stu-id="eccc3-335">The Cluster Resource Manager uses both these weights when scoring solutions.</span></span> <span data-ttu-id="eccc3-336">Важно учитывать оба эти веса.</span><span class="sxs-lookup"><span data-stu-id="eccc3-336">Taking both weights into account is important.</span></span> <span data-ttu-id="eccc3-337">Это позволяет диспетчеру кластерных ресурсов балансировать нагрузку каждой службы в соответствии с ее собственными приоритетами, а также обеспечивает правильное выделение ресурсов кластера в целом.</span><span class="sxs-lookup"><span data-stu-id="eccc3-337">This allows the Cluster Resource Manager to balance each service according to its own priorities, and also ensure that the cluster as a whole is allocated correctly.</span></span>

<span data-ttu-id="eccc3-338">Что произойдет, если Cluster Resource Manager не будет учитывать и глобальный, и локальный баланс?</span><span class="sxs-lookup"><span data-stu-id="eccc3-338">What would happen if the Cluster Resource Manager didn’t care about both global and local balance?</span></span> <span data-ttu-id="eccc3-339">Конечно, несложно создать решения с глобальной балансировкой нагрузки, но это приводит к неправильной балансировке выделяемых ресурсов для отдельных служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-339">Well, it’s easy to construct solutions that are globally balanced, but which result in poor resource balance for individual services.</span></span> <span data-ttu-id="eccc3-340">В следующем примере рассмотрим службу, для которой настроены только метрики по умолчанию, и узнаем, что происходит, если учитывается только глобальная балансировка нагрузки.</span><span class="sxs-lookup"><span data-stu-id="eccc3-340">In the following example, let’s look at a service configured with just the default metrics, and see what happens when only global balance is considered:</span></span>

<span data-ttu-id="eccc3-341"><center>
![Результаты решения только глобальной балансировки][Image4]
</center></span><span class="sxs-lookup"><span data-stu-id="eccc3-341"><center>
![The Impact of a Global Only Solution][Image4]
</center></span></span>

<span data-ttu-id="eccc3-342">В приведенном выше примере только с глобальной балансировкой нагрузки кластер в целом действительно сбалансирован.</span><span class="sxs-lookup"><span data-stu-id="eccc3-342">In the top example based only on global balance, the cluster as a whole is indeed balanced.</span></span> <span data-ttu-id="eccc3-343">Все узлы имеют одинаковое количество первичных реплик и реплик вообще.</span><span class="sxs-lookup"><span data-stu-id="eccc3-343">All nodes have the same count of primaries and the same number total replicas.</span></span> <span data-ttu-id="eccc3-344">Однако, если взглянуть на результаты такого выделения ресурсов, окажется, что оно не совсем правильное. Потеря одного узла непропорционально влияет на конкретную рабочую нагрузку, так как вместе с узлом теряются все первичные реплики этой рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="eccc3-344">However, if you look at the actual impact of this allocation it’s not so good: the loss of any node impacts a particular workload disproportionately, because it takes out all of its primaries.</span></span> <span data-ttu-id="eccc3-345">Например, в случае сбоя первого узла будут потеряны три первичные реплики для трех разных разделов службы "Круг".</span><span class="sxs-lookup"><span data-stu-id="eccc3-345">For example, if the first node fails the three primaries for the three different partitions of the Circle service would all be lost.</span></span> <span data-ttu-id="eccc3-346">В то же время в секциях служб "Треугольник" и "Шестиугольник" будет утрачена реплика.</span><span class="sxs-lookup"><span data-stu-id="eccc3-346">Conversely, the Triangle and Hexagon services have their partitions lose a replica.</span></span> <span data-ttu-id="eccc3-347">Это не нарушит работу, но потребуется восстановить утраченную реплику.</span><span class="sxs-lookup"><span data-stu-id="eccc3-347">This causes no disruption, other than having to recover the down replica.</span></span>

<span data-ttu-id="eccc3-348">В примере ниже служба Cluster Resource Manager распределил реплики с учетом глобального баланса и баланса каждой службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-348">In the bottom example, the Cluster Resource Manager has distributed the replicas based on both the global and per-service balance.</span></span> <span data-ttu-id="eccc3-349">При вычислении оценки решения она присваивает наибольший вес глобальному решению и (настраиваемой) части для отдельных служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-349">When calculating the score of the solution it gives most of the weight to the global solution, and a (configurable) portion to individual services.</span></span> <span data-ttu-id="eccc3-350">Глобальное распределение нагрузки для метрики вычисляется на основе средних весов метрик, настроенных для каждой службы.</span><span class="sxs-lookup"><span data-stu-id="eccc3-350">Global balance for a metric is calculated based on the average of the metric weights from each service.</span></span> <span data-ttu-id="eccc3-351">Каждая служба балансируется с учетом определенных для нее весов метрик.</span><span class="sxs-lookup"><span data-stu-id="eccc3-351">Each service is balanced according to its own defined metric weights.</span></span> <span data-ttu-id="eccc3-352">Это гарантирует, что внутренняя балансировка служб выполняется в соответствии с их потребностями.</span><span class="sxs-lookup"><span data-stu-id="eccc3-352">This ensures that the services are balanced within themselves according to their own needs.</span></span> <span data-ttu-id="eccc3-353">В результате, если сбой произойдет на том же первом узле, то его последствия распределятся на все секции всех служб.</span><span class="sxs-lookup"><span data-stu-id="eccc3-353">As a result, if the same first node fails the failure is distributed across all partitions of all services.</span></span> <span data-ttu-id="eccc3-354">При этом она влияет одинаково на каждую из них.</span><span class="sxs-lookup"><span data-stu-id="eccc3-354">The impact to each is the same.</span></span>

## <a name="next-steps"></a><span data-ttu-id="eccc3-355">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="eccc3-355">Next steps</span></span>
- <span data-ttu-id="eccc3-356">Дополнительные сведения о настройке служб см. в разделе [Настройка параметров Cluster Resource Manager для служб Service Fabric](service-fabric-cluster-resource-manager-configure-services.md)(service-fabric-cluster-resource-manager-configure-services.md)</span><span class="sxs-lookup"><span data-stu-id="eccc3-356">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)(service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="eccc3-357">Определение метрик дефрагментации — один из способов объединения нагрузки на узлах вместо ее рассредоточения. Сведения о настройке дефрагментации см. в [этой статье](service-fabric-cluster-resource-manager-defragmentation-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="eccc3-357">Defining Defragmentation Metrics is one way to consolidate load on nodes instead of spreading it out. To learn how to configure defragmentation, refer to [this article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span></span>
- <span data-ttu-id="eccc3-358">Чтобы узнать, как диспетчер кластерных ресурсов управляет нагрузкой кластера и балансирует ее, ознакомьтесь со статьей о [балансировке нагрузки](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="eccc3-358">To find out about how the Cluster Resource Manager manages and balances load in the cluster, check out the article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>
- <span data-ttu-id="eccc3-359">Начните с самого начала, [изучив общие сведения о диспетчере кластерных ресурсов Service Fabric](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="eccc3-359">Start from the beginning and [get an Introduction to the Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
- <span data-ttu-id="eccc3-360">Стоимость перемещения — один из способов сообщить диспетчеру кластерных ресурсов, что некоторые службы перемещать затратнее, чем остальные.</span><span class="sxs-lookup"><span data-stu-id="eccc3-360">Movement Cost is one way of signaling to the Cluster Resource Manager that certain services are more expensive to move than others.</span></span> <span data-ttu-id="eccc3-361">Сведения о стоимости перемещения см. в [этой статье](service-fabric-cluster-resource-manager-movement-cost.md).</span><span class="sxs-lookup"><span data-stu-id="eccc3-361">To learn more about movement cost, refer to [this article](service-fabric-cluster-resource-manager-movement-cost.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-cluster-layout-with-default-metrics.png
[Image2]:./media/service-fabric-cluster-resource-manager-metrics/Service-Fabric-Resource-Manager-Dynamic-Load-Reports.png
[Image3]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-metric-weights-impact.png
[Image4]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-global-vs-local-balancing.png
