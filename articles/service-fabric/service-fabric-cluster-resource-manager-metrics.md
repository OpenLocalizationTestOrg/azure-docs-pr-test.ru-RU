---
title: "Загрузка Azure микрослужбу aaaManage использования метрик | Документы Microsoft"
description: "Узнайте, как метрики tooconfigure и использования в Service Fabric toomanage службы потребления ресурсов."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 0d622ea6-a7c7-4bef-886b-06e6b85a97fb
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 592dc749ce30683a1e439a702b7d0dc0a638276f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="managing-resource-consumption-and-load-in-service-fabric-with-metrics"></a>Управление потреблением ресурсов и нагрузкой в Service Fabric с помощью метрик
*Метрики* hello ресурсов, предоставленные вашей службы важны и которые hello узлами в кластере hello. Метрика никаких действий, которые должны toomanage в порядке tooimprove или монитора производительности hello служб. Например может отслеживать tooknow потребления памяти, если служба перегружена. Кроме того можно использовать toofigure out ли служба hello переместить в другом месте, где памяти — меньше ограниченного порядок tooget лучшую производительность.

Примерами метрик может служить использование памяти, дисков и ЦП. Эти показатели представляют физические метрики, ресурсы, соответствующие toophysical ресурсы на узле hello, для которых требуются toobe управляемых. Метрики также могут быть (и зачастую являются) логическими. Примерами логических метрик могут служить MyWorkQueueDepth, MessagesToProcess и TotalRecords. Логические показатели, определяемые приложением и косвенно соответствуют потребления toosome физических ресурсов. Логический метрики являются общими, так как она может быть жестких toomeasure и потребление отчетов физических ресурсов на основе службы. сложность Hello измерения и физических показатели reporting — также почему Service Fabric предоставляет некоторые показатели по умолчанию.

## <a name="default-metrics"></a>Метрики по умолчанию
Предположим, что требуется tooget работы запись и развертывание службы. На этом этапе вы не знаете, какие физические или логические ресурсы она будет использовать. Все в порядке. Диспетчер ресурсов кластера Service Fabric Hello использует некоторые показатели по умолчанию при указании нет других метрик. К ним относятся:

  - PrimaryCount - число первичных реплик на узле hello 
  - ReplicaCount - количество полных реплик с отслеживанием состояния на узле hello
  - Count - число всех объектов службы (без сохранения состояния и с отслеживанием состояния) на узле hello

| Метрика | Нагрузка экземпляра без отслеживания состояния | Вторичная нагрузка с отслеживанием состояния | Первичная нагрузка с отслеживанием состояния |
| --- | --- | --- | --- |
| PrimaryCount |0 |0 |1 |
| ReplicaCount |0 |1 |1 |
| Count |1 |1 |1 |

Для основных рабочих нагрузок показатели по умолчанию hello предоставляют довольно распространения работы в кластере hello. В следующем примере hello давайте посмотрим, что произойдет, если мы создание двух служб и полагаться на метрики по умолчанию hello балансировки. службы с отслеживанием состояния с тремя секциями является первая служба Hello и целевой размер набора реплик из трех. Вторая служба Hello — службы без отслеживания состояния с одним разделом и число экземпляров из трех.

Вот что получается в итоге.

<center>
![Макет кластера с метриками по умолчанию][Image1]
</center>

Toonote некоторые вещи:
  - Первичной реплики для службы с отслеживанием состояния hello распределены между несколькими узлами
  - Реплики для одной секции находятся на разных узлах hello
  - в кластере hello распространяется Hello общее число источников и баз данных-получателей
  - Hello общее число объектов службы равномерно распределяются на каждом узле

Хорошо!

Запуск по прекрасно работать метрики по умолчанию Hello. Тем не менее метрики по умолчанию hello будет только разноситься вы к текущему моменту. Например: Какова вероятность hello, секционирование hello схема извлечь результаты вполне даже использования во всех секциях? Какова вероятность hello hello нагрузки для данной службы является константой во времени или даже просто hello же в разных секциях прямо сейчас?

Можно выполнить с только что метрики по умолчанию hello. Но, как правило, это означает, что использование вашего кластера ниже и неравномернее, чем хотелось бы. Это так, как метрики по умолчанию hello не адаптивной и предполагают, что все, что эквивалентно. Например основной, занят и который не обоих contribute «1» toohello PrimaryCount метрику. В худшем случае hello с использованием только метрик по умолчанию hello может также привести к overscheduled узлов, что приводит к проблемам с производительностью. Если вы заинтересованы в получении hello большинство из кластера и как избежать проблем с производительностью, понадобится toouse настраиваемых метрик и динамическая загрузка отчетов.

## <a name="custom-metrics"></a>Настраиваемые метрики
Метрики настраиваются отдельно для каждого с именем service экземпляра при создании службы hello.

У любой метрики есть описывающие ее свойства: имя, вес и нагрузка по умолчанию.

* Имя метрики: hello имя метрики hello. Имя метрики Hello имеет уникальный идентификатор для метрики hello в кластере hello с точки зрения диспетчера ресурсов hello.
* Вес: Вес метрики определяет важность эта метрика относительный toohello другие метрики для этой службы.
* Загрузка по умолчанию: нагрузки по умолчанию hello представляется по-разному в зависимости от того, является ли hello службы без сохранения состояния или с отслеживанием состояния.
  * Для служб без отслеживания состояния у каждой метрики есть одно свойство — DefaultLoad.
  * Для служб с отслеживанием состояния можно определить следующие свойства:
    * PrimaryDefaultLoad: сумма hello по умолчанию, которые эта служба использует при основной метрики
    * SecondaryDefaultLoad: сумма по умолчанию hello метрики эта служба при потребляет получателя

> [!NOTE]
> Если определение настраиваемых метрик и требуется too_also_ используйте hello по умолчанию метрики, необходимо too_explicitly_ добавить метрики по умолчанию hello резервное и определить для них весовые коэффициенты и значения. Это так, как необходимо определить связь hello метрики по умолчанию hello и настраиваемые показатели. Например, вас больше интересуют метрика ConnectionCount или WorkQueueDepth, чем распределение первичных реплик. С весом по умолчанию hello hello PrimaryCount метрика высокой, поэтому вы хотите tooreduce его tooMedium при добавлении на других метрик tooensure, они имеют более высокий приоритет.
>

### <a name="defining-metrics-for-your-service---an-example"></a>Определение метрик для службы (пример)
Предположим, требуется следующая конфигурация hello:

  - Служба сообщает о метрике ConnectionCount.
  - Также требуется показателей по умолчанию hello toouse 
  - Вы провели некоторые измерения и выяснили, что обычно первичная реплика этой службы может потреблять 20 единиц MemoryInMb,
  - а вторичные реплики — 5 единиц.
  - Можно считать «ConnectionCount» hello наиболее важные метрики с точки зрения Управление производительностью hello этой конкретной службы
  - Но вы все равно хотите, чтобы первичные реплики были сбалансированы. Балансировка первичных реплик обычно имеет смысл при любых обстоятельствах. Это помогает избежать hello потери некоторых домена узла или fault, влияющие на большую часть первичные реплики вместе с ним. 
  - В противном случае допустимы метрики по умолчанию hello

Вот что можно написать toocreate службы с этой конфигурацией метрики кода hello.

Код:

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
StatefulServiceLoadMetricDescription connectionMetric = new StatefulServiceLoadMetricDescription();
connectionMetric.Name = "ConnectionCount";
connectionMetric.PrimaryDefaultLoad = 20;
connectionMetric.SecondaryDefaultLoad = 5;
connectionMetric.Weight = ServiceLoadMetricWeight.High;

StatefulServiceLoadMetricDescription primaryCountMetric = new StatefulServiceLoadMetricDescription();
primaryCountMetric.Name = "PrimaryCount";
primaryCountMetric.PrimaryDefaultLoad = 1;
primaryCountMetric.SecondaryDefaultLoad = 0;
primaryCountMetric.Weight = ServiceLoadMetricWeight.Medium;

StatefulServiceLoadMetricDescription replicaCountMetric = new StatefulServiceLoadMetricDescription();
replicaCountMetric.Name = "ReplicaCount";
replicaCountMetric.PrimaryDefaultLoad = 1;
replicaCountMetric.SecondaryDefaultLoad = 1;
replicaCountMetric.Weight = ServiceLoadMetricWeight.Low;

StatefulServiceLoadMetricDescription totalCountMetric = new StatefulServiceLoadMetricDescription();
totalCountMetric.Name = "Count";
totalCountMetric.PrimaryDefaultLoad = 1;
totalCountMetric.SecondaryDefaultLoad = 1;
totalCountMetric.Weight = ServiceLoadMetricWeight.Low;

serviceDescription.Metrics.Add(connectionMetric);
serviceDescription.Metrics.Add(primaryCountMetric);
serviceDescription.Metrics.Add(replicaCountMetric);
serviceDescription.Metrics.Add(totalCountMetric);

await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

PowerShell:

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ConnectionCount,High,20,5”,"PrimaryCount,Medium,1,0”,"ReplicaCount,Low,1,1”,"Count,Low,1,1”)
```

> [!NOTE]
> Здравствуйте выше примеры и hello остальной части этого документа описываются управление метрики на основе с именем службы. Это также возможно toodefine метрики для служб в службе hello _тип_ уровне. Для этого их нужно указать в манифестах служб. Определение метрики уровня типа не рекомендуется по нескольким причинам. Hello первый обусловлено тем, что имена метрик учитывают часто конкретной среды. При отсутствии утвержденный контракт на месте, невозможно убедитесь, что эта метрика hello «Ядра» в одной среде, не является «MiliCores» или «Ядра» в других. Если показатели определяются в манифесте необходимо toocreate новые манифесты для среды. В связи с увеличением tooa разных манифестов с только незначительные различия, которые может вызвать трудности toomanagement.  
>
> Как правило, нагрузки метрик назначаются на уровне отдельных именованных экземпляров служб. Например, предположим, что можно создать один экземпляр hello service для CustomerA, кто планирует toouse его лишь в незначительной степени. Также предположим, что вы создаете другую службу для клиента Б, рабочая нагрузка которого больше. В этом случае может потребоваться по умолчанию hello tootweak загружает для этих служб. При наличии метрик и загружает, определенное через манифесты и вы хотите toosupport этот сценарий, требуется другое приложение, а типы службы для каждого клиента. Hello значений, определенных во время создания службы переопределяют определен в манифесте hello, поэтому можно использовать, tooset hello значения по умолчанию. Тем не менее это то hello значения объявлены в hello манифесты toonot совпадают, эти службы hello фактически выполняется с. Это может привести к tooconfusion. 
>

Для напоминания: Если необходимо просто метрики по умолчанию hello toouse не нужна коллекция метрик hello tootouch во всех или выполнять никаких особых действий при создании службы. метрики по умолчанию Hello получить используется автоматически, когда другие не определены. 

Теперь разберем каждого из этих параметров более подробно и говорить о hello поведение, которое оно влияет.

## <a name="load"></a>загрузить
Здравствуйте смысл определение метрики является toorepresent повышению нагрузки. *Нагрузка* — это количество единиц определенной метрики, используемое экземпляром или репликой службы на заданном узле. Нагрузку можно настроить практически в любой момент. Например:

  - Можно определить нагрузку при создании службы. Она называется _нагрузкой по умолчанию_.
  - загружает сведения метрики Hello, включая по умолчанию, для службы можно обновить после создания службы hello. Это называется _обновлением службы_. 
  - Загружает Hello для данной секции может быть значения по умолчанию toohello сброса для этой службы. Это называется _сбросом нагрузки секции_.
  - Можно создавать отчеты о динамической нагрузке каждого объекта службы во время выполнения. Это называется _созданием отчетов о нагрузке_. 
  
Все эти стратегии можно использовать в hello же службы в течение времени существования. 

## <a name="default-load"></a>Нагрузка по умолчанию
*По умолчанию нагрузки* — метрики hello потребляет каждый объект службы (без сохранения состояния экземпляра или реплики с отслеживанием состояния) этой службы. Hello диспетчер ресурсов кластера использует это число для загрузки hello объекта службы hello, пока не получит другие сведения, такие как динамический загрузить отчет. Для более простой службы нагрузки по умолчанию hello представляет собой статический определение. загрузки по умолчанию Hello никогда не обновляется и используется для hello времени существования службы hello. По умолчанию загружает прекрасно работает для простых сценариях, где определенные периоды времени, выделенный toodifferent рабочих нагрузок и не изменяйте для оптимизации производительности.

> [!NOTE]
> Дополнительные сведения о управление емкостью и определение емкости hello узлы в кластер см. в разделе [в этой статье](service-fabric-cluster-resource-manager-cluster-description.md#capacity).
> 

Hello диспетчер ресурсов кластера позволяет toospecify служб с отслеживанием состояния нагрузки по умолчанию для своих источников и баз данных-получателей. Службы без сохранения состояния можно указать только одно значение, которое применяет tooall экземпляры. Для служб с отслеживанием состояния hello нагрузки по умолчанию для первичной и вторичной реплик являются чаще всего отличаются, поскольку реплик выполнять различные виды работ в каждой роли. Например в источниках обычно обслуживать операций чтения и записи и для выполнения большинства задач hello вычислительную нагрузку, а нет баз данных-получателей. Обычно hello нагрузки по умолчанию для первичной реплики больше, чем нагрузки по умолчанию hello для вторичных реплик. Hello вещественных чисел, должны использовать размеры.

## <a name="dynamic-load"></a>Динамическая нагрузка
Предположим, что ваша служба работает уже некоторое время. С помощью средств мониторинга вы определили, что:

1. некоторые разделы или экземпляры данной службы потребляют больше ресурсов, чем другие;
2. нагрузки некоторых служб меняются с течением времени.

Такого рода колебания нагрузки могут возникать по различным причинам. Например, разные службы или секции могут быть связаны с разными клиентами с отличающимися требованиями. Нагрузки можно также изменить, так как hello объем работы службы hello меняется в течение hello hello день. Независимо от причины hello обычно отсутствует номер один, можно использовать по умолчанию. Это особенно важно, если требуется использование большинства из кластера hello tooget hello. Любое значение, выбранное для загрузки по умолчанию неверный часть времени hello. Неверный по умолчанию загружает результат в hello диспетчер ресурсов кластера над или под выделение ресурсов. В результате имеется узлов, которые превышают используются несмотря на то, что диспетчер ресурсов кластера hello полагает, что hello кластера сбалансирован. И все же использовать нагрузки по умолчанию весьма удобно, так как они предоставляют определенные сведения для первоначального размещения, хотя и не отражают реальное состояние рабочих нагрузок. Захват tooaccurately изменение требований к ресурсам, hello диспетчер ресурсов кластера позволяет tooupdate объекта каждой службы собственный нагрузки во время выполнения. Это называется передачей данных о динамической нагрузке.

Динамическая загрузка отчетов разрешать реплики или экземпляров tooadjust их/сообщил распределения нагрузки метрик по времени их существования. Реплики или экземпляры службы, которые простаивали и не выполняли никакой работы, обычно сообщают, что они использовали меньшее количество заданной метрики. В то же время загруженные реплики или экземпляры сообщают, что они используют больше ресурсов.

Reporting нагрузки на реплику или экземпляр позволяет объектам отдельной службе hello hello tooreorganize диспетчер ресурсов кластера в кластере hello. Реорганизация hello служб гарантирует получение hello ресурсы, которые необходимы. Занят services эффективно получить слишком «освободить» ресурсов из других реплик или экземпляры, которые в данный момент холодного или меньше работой.

В надежных служб нагрузки tooreport кода hello динамически выглядит следующим образом:

Код:

```csharp
this.Partition.ReportLoad(new List<LoadMetric> { new LoadMetric("CurrentConnectionCount", 1234), new LoadMetric("metric1", 42) });
```

Служба может указывать на любой из метрик hello, определенные для нее во время создания. Если службы отчетов нагрузки для показателя, который не настроен toouse, Service Fabric игнорирует этот отчет. Если существуют другие метрики на обнаружил hello же времени, которые являются допустимыми, эти отчеты принимаются. Код службы можно измерять и отчетов все hello метрики, он знает, как и операторы могут указывать toouse hello метрики конфигурации без необходимости код службы toochange hello. 

### <a name="updating-a-services-metric-configuration"></a>Обновление конфигурации метрик службы
Список Hello метрик, связанных с службы hello и hello свойства метрик могут обновляться динамически во время динамической hello службы. Это позволяет экспериментировать и обеспечивает гибкость. Ниже приведено несколько примеров, когда это удобно использовать:

  - отключение метрики с ошибками в отчете для определенной службы;
  - Перенастройка весовые коэффициенты hello метрик, в зависимости от требуемого поведения
  - Включение нового метрика только после кода hello уже развернуты и через другие механизмы проверки
  - Изменение hello нагрузки по умолчанию для служб, основываясь на поведение и потребление

Hello основной API для изменение метрические конфигурации являются `FabricClient.ServiceManagementClient.UpdateServiceAsync` в C# и `Update-ServiceFabricService` в PowerShell. Сведения, указывается с помощью этих API заменяет hello существующие данные о метриках для службы hello немедленно. 

## <a name="mixing-default-load-values-and-dynamic-load-reports"></a>Совместное использование значений нагрузки по умолчанию и отчетов о динамической загрузке
Загрузки по умолчанию и динамической загрузки может использоваться для hello одной службы. Если служба использует нагрузку по умолчанию и отчеты о динамической нагрузке, то нагрузка по умолчанию служит в качестве оценочного значения, пока не появятся отчеты о динамической нагрузке. Загрузки по умолчанию является хорошим, потому что он дает hello диспетчер ресурсов кластера что-нибудь toowork с. нагрузки по умолчанию Hello позволяет hello tooplace диспетчер ресурсов кластера объектов службы hello в хорошо расположения при их создании. Если сведения по умолчанию не предоставляются, службы размещаются практически произвольно. По прибытии нагрузки отчеты позже исходное размещение случайного hello часто неверное и hello диспетчер ресурсов кластера есть toomove службы.

Возьмем наш предыдущий пример и посмотрим, что произойдет, если мы добавим пользовательские метрики и будем динамически создавать отчеты о нагрузке. В этом примере мы используем метрику MemoryInMb.

> [!NOTE]
> Памяти является одним из метрик системы hello, Service Fabric можно [управляют ресурсов](service-fabric-resource-governance.md), и обычно трудно reporting самостоятельно. Не ожидается, что фактически вы tooreport потребление памяти; Память используется здесь как вспомогательное средство toolearning о возможностях hello hello диспетчер ресурсов кластера.
>

Давайте предположим, изначально созданного hello службы с отслеживанием состояния с hello следующую команду:

PowerShell:

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("MemoryInMb,High,21,11”,"PrimaryCount,Medium,1,0”,"ReplicaCount,Low,1,1”,"Count,Low,1,1”)
```

Напомним, что синтаксис выглядит следующим образом: ("MetricName, MetricWeight, PrimaryDefaultLoad, SecondaryDefaultLoad").

Один из возможных макетов кластера может выглядеть как:

<center>
![Сбалансированный кластер с метриками по умолчанию и пользовательскими метриками][Image2]
</center>

Обратите внимание на следующие факторы.

* Вторичные реплики в секции могут иметь собственные нагрузки.
* В целом показатели hello найдите балансировкой. Объем памяти, hello соотношение между hello максимальное и минимальное нагрузки — 1,75 (hello узла с hello наибольшую нагрузку N3, hello бы N2 и 28/16 = 1,75).

Существуют некоторые особенности, что мы по-прежнему должны tooexplain:

* Как определить, является ли соотношение 1,75 разумным? Как узнает hello диспетчер ресурсов кластера в случае достаточно хорошо, или если существует несколько toodo рабочих?
* Когда происходит балансировка нагрузки?
* Что означает, если вес метрики "Память" определен как высокий?

## <a name="metric-weights"></a>Вес метрик
Отслеживание hello же важные метрики в разных службах. Что глобальное представление является то, что позволяет hello потребления tootrack диспетчер ресурсов кластера в кластере hello, сальдо по узлам потребления и убедитесь, что узлы не выходят емкости. Тем не менее, службы могут иметь различные представления как toohello важность hello одинаковую метрику. Кроме того, в кластере с множеством метрик и большим количеством служб для некоторых метрик полностью сбалансированные решения могут и не существовать. Как hello диспетчер ресурсов кластера должна обрабатывать такие ситуации?

Метрической системы весов разрешить hello toodecide диспетчер ресурсов кластера, как toobalance hello кластеру, когда точной ответа нет. Вес метрики также позволяют hello диспетчер ресурсов кластера toobalance определенных служб по-разному. Метрики могут иметь четыре разных уровня веса: нулевой, низкий, средний и высокий. Метрика с нулевым весом не играет роли для балансировки нагрузки. Однако его нагрузки по-прежнему примененные toocapacity управления. Метрики с нулевым весом удобны и часто используются для настройки поведения службы и отслеживания производительности. [В этой статье](service-fabric-diagnostics-event-generation-infra.md) подробно описывает использование hello метрики для наблюдения и диагностики служб. 

Hello реальных последствий различных метрической системы весов в кластере hello — что hello диспетчер ресурсов кластера приводит к возникновению ошибки различные решения. Метрической системы весов сообщить hello диспетчер ресурсов кластера, что некоторые показатели, более важной, чем другие. При наличии hello не идеальное решение диспетчер ресурсов кластера можно выбирать решений, выполняющие hello выше взвешенного метрики лучшую балансировку. Если определенная метрика неважна для какой-либо службы, то с точки зрения диспетчера кластерных ресурсов ее использование может казаться несбалансированным. Это позволяет другим tooget службы равномерное распределение некоторые метрику, является важным tooit.

Давайте рассмотрим пример некоторые отчеты о загрузке и как различные метрики смещать баланс результатов в различных выделений в кластере hello. В этом примере мы видим, что переключение hello относительный вес метрики hello приводит hello диспетчер ресурсов кластера toocreate различных вариантов расположения служб.

<center>
![Пример веса метрики и его влияния на решения балансировки нагрузки][Image3]
</center>

В этом примере используются четыре разные службы. Все они сообщают разные значения для двух метрик, MetricA и MetricB. В первом случае все службы hello определяют MetricA — наиболее важной hello (вес = высокий) и MetricB как незначительной (вес = низкий). В результате мы увидим, что этой hello диспетчер ресурсов кластера помещает hello служб таким образом, чтобы лучше балансировкой чем MetricB MetricA. "Лучше сбалансирована" означает, что среднеквадратичное отклонение метрики MetricA меньше, чем среднеквадратичное отклонение метрики MetricB. В втором случае hello мы обратная метрической системы весов hello. В результате hello диспетчер ресурсов кластера меняет службы A и B toocome копирование выделения памяти, где MetricB лучше чем MetricA балансировкой.

> [!NOTE]
> Метрической системы весов определяют, как следует сбалансировать hello диспетчер ресурсов кластера, но не когда балансировки должно выполняться. Дополнительные сведения о балансировке см. в [этой статье](service-fabric-cluster-resource-manager-balancing.md).
>

### <a name="global-metric-weights"></a>Глобальный вес метрик
Предположим, что ServiceA определяет MetricA как вес высокой, а ServiceB задает вес hello для MetricA tooLow или ноль. Что такое hello фактическое вес, который заканчивается привыкли?

Для каждой метрики отслеживаются несколько весов. Вес первой Hello — hello, один для метрики hello определено при создании hello службы. Hello других веса является глобальной вес, который вычисляется автоматически. Hello диспетчер ресурсов кластера использует оба этих весовых коэффициентов при оценке решения. Важно учитывать оба эти веса. Это позволяет каждой службы соответствующим tooits собственному приоритеты и обеспечьте hello кластера как неправильное выделение всего hello toobalance диспетчер ресурсов кластера.

Что произойдет, если диспетчер ресурсов кластера hello не интересует глобальные и локальные баланс? Также это легко tooconstruct решений, распределяются глобально, но что привести в балансе низкой ресурсов для отдельных служб. В следующем примере hello рассмотрим службе, настроенной с только что метрики по умолчанию hello и увидеть, что произойдет, если только глобальные баланс считается:

<center>
![Влияние глобальное решение только Hello][Image4]
</center>

В примере top hello основываются только на глобальной балансировки на самом деле равномерно hello кластер в целом. Все узлы имеют hello же число в источниках и hello же число полных реплик. Однако если взглянуть на hello влияние данного выделения это не так хорошо: hello потери любого узла влияет на конкретной рабочей нагрузки без соблюдения пропорций, так как она использует все его в источниках. Например первый узел hello в случае hello три основных цвета для трех разных секций hello hello круг службы все будут потеряны. И наоборот hello треугольник и шестиугольник службы имеют их разделы потерять реплики. В этом случае без разрыва, отличные от необходимости hello toorecover вниз реплики.

В примере hello нижней hello диспетчер ресурсов кластера с распределенными реплики hello обоих баланс hello глобальный, так и службы. При вычислении оценки hello hello решения он предоставляет большинство hello вес toohello глобальное решение и tooindividual (значение настраивается) часть службы. Глобальные баланс для метрики, рассчитывается на основании среднего hello hello метрической системы весов из каждой службы. Каждой службы равномерно соответствующим tooits собственные определенных метрической системы весов. Это гарантирует, что службы hello распределяются внутри себя в соответствии с tootheir собственных нужд. В результате Если hello же первый узел, сбой hello распространяется во всех разделах всех служб. Здравствуйте tooeach влияние Hello, одинаково.

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о настройке служб см. в разделе [Настройка параметров Cluster Resource Manager для служб Service Fabric](service-fabric-cluster-resource-manager-configure-services.md)(service-fabric-cluster-resource-manager-configure-services.md)
- Определение метрики дефрагментации является одним из способов tooconsolidate нагрузки на узлах, а не его рассредоточения. toolearn как tooconfigure дефрагментации см. в слишком[в данной статье](service-fabric-cluster-resource-manager-defragmentation-metrics.md)
- toofind out о управляет hello диспетчер ресурсов кластера и балансировку нагрузки в кластере hello Извлеките hello статьи на [балансировки нагрузки](service-fabric-cluster-resource-manager-balancing.md)
- Начать с начала hello и [получить введение toohello диспетчер ресурсов кластера Service Fabric](service-fabric-cluster-resource-manager-introduction.md)
- Стоимость перемещения — один из способов передачи сигналов toohello диспетчер ресурсов кластера, что некоторые службы являются toomove дороже, чем другие. toolearn Дополнительные сведения о стоимость перемещения ссылаться слишком[в данной статье](service-fabric-cluster-resource-manager-movement-cost.md)

[Image1]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-cluster-layout-with-default-metrics.png
[Image2]:./media/service-fabric-cluster-resource-manager-metrics/Service-Fabric-Resource-Manager-Dynamic-Load-Reports.png
[Image3]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-metric-weights-impact.png
[Image4]:./media/service-fabric-cluster-resource-manager-metrics/cluster-resource-manager-global-vs-local-balancing.png
