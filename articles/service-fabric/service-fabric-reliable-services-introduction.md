---
title: "aaaOverview модели программирования служба Service Fabric надежного hello | Документы Microsoft"
description: "Сведения о модели программирования надежных служб Service Fabric, позволяющие приступить к написанию собственных служб."
services: Service-Fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: vturecek; mani-ramaswamy
ms.assetid: 0c88a533-73f8-4ae1-a939-67d17456ac06
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: masnider;
ms.openlocfilehash: 41d1826df902b1f1845c4702bf2567e6b9ca1f1f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="reliable-services-overview"></a>Обзор надежных служб
Платформа Azure Service Fabric упрощает написание надежных служб с отслеживанием и без отслеживания состояния и управление такими службами. В этой статье рассматриваются следующие вопросы.

* Hello надежного обмена модель программирования для служб без отслеживания состояния и с отслеживанием состояния.
* варианты Hello имеется toomake при написании надежные службы.
* Некоторые сценарии и примеры, когда toouse надежность службы и как они написаны.

Надежные службы является одним из hello программирование моделей, доступных в Service Fabric. Hello других — hello Reliable Actor модель программирования, которая предоставляет виртуальный субъекта модель программирования на основе модели надежного обмена hello. Дополнительные сведения о модели программирования службы Reliable Actor hello см. в разделе [tooService введение структуры службы Reliable Actor](service-fabric-reliable-actors-introduction.md).

Service Fabric управляет временем существования hello служб: от подготовки и развертывания с помощью обновления и удаления, через [управления приложения Service Fabric](service-fabric-deploy-remove-applications.md).

## <a name="what-are-reliable-services"></a>Что такое надежные службы?
Надежные службы обеспечивает простой и эффективный, верхнего уровня, можно указать, что такое приложение важные tooyour toohelp модели программирования. С помощью надежного обмена hello модель программирования можно получить:

* Остальные toohello доступа hello API-интерфейсов Service Fabric. В отличие от структуры службы, смоделированная в виде [исполняемые файлы гостевой](service-fabric-deploy-existing-app.md), надежные службы непосредственно получить toouse hello остальной части hello API-интерфейсы службы структуры. Это дает службам такие возможности:
  * Система hello запроса
  * отчет о работоспособности о сущностях в кластере hello
  * получение уведомлений об изменениях конфигурации и кода;
  * поиск других служб и обмен данными с ними;
  * (необязательно) используйте hello [надежного коллекций](service-fabric-reliable-services-reliable-collections.md)
  * .. и предоставление им доступа к toomany других возможностей из первого класса модели программирования в нескольких языках программирования.
* Простая модель для выполнения собственного кода, которая похожа на привычные модели программирования: у создаваемого кода четко определенная точка входа и простой в управлении жизненный цикл.
* Модель взаимодействия со службами Использование транспорта hello по своему усмотрению, например HTTP с [веб-API](service-fabric-reliable-services-communication-webapi.md), WebSockets, пользовательские протоколы TCP и любые другие элементы. Надежные службы позволяют использовать ряд отличных готовых вариантов или задействовать собственный.
* Для служб с отслеживанием состояния, позволяет вам tooconsistently и надежно хранить состояние прямо в службе с использованием модели программирования надежные службы hello [надежного коллекции](service-fabric-reliable-services-reliable-collections.md). Надежные коллекции являются простым набором классов коллекций высокой доступности и надежности, которые будут знакомы tooanyone, который использовал C# коллекций. Обычно для надежного управления состоянием службам требовались внешние системы. С помощью надежного коллекций можно хранить состояние Далее вычислительные tooyour с hello же высокий уровень доступности и надежности, вы уже tooexpect сопряжен с высокой надежности внешнего хранилища. Эта модель также повышает задержку, так как совместного размещения вычислений hello и состояние, он должен toofunction.

Посмотрите этот видеоролик от Microsoft Virtual Academy, который содержит обзор служб Reliable Services: <center>
<a target="_blank" href="https://mva.microsoft.com/en-US/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=HhD9566yC_4106218965">
<img src="./media/service-fabric-reliable-services-introduction/ReliableServicesVid.png" WIDTH="360" HEIGHT="244" />
</a>
</center>

## <a name="what-makes-reliable-services-different"></a>Чем отличаются надежные службы
Надежные службы в Service Fabric отличаются от служб, которые вы могли создавать ранее. Service Fabric обеспечивает надежность, доступность, согласованность и масштабируемость.

* **Надежность** - вашей службы остается копирование даже в ненадежной средах, где компьютеры с ошибкой, или нажмите кнопку неполадок сети, или в случаях, где hello служб сами возникают ошибки и сбоя или вызвать сбой. Для служб с отслеживанием состояния в состояние сохраняется даже при наличии hello сети и другие сбои.
* **Доступность** — служба доступна и отвечает на запросы. Платформа Service Fabric поддерживает нужное число запущенных копий.
* **Масштабируемость** - службы связаны с определенным оборудованием и увеличиваться или уменьшаться при необходимости через hello Добавление или удаление оборудования или других ресурсов. Службы являются tooensure легко секционированных (особенно в случае с отслеживанием состояния hello), которую можно масштабировать службу hello и дескриптор частичных сбоев. Службы могут создаваться и удаления динамически посредством кода, включение дополнительные toobe экземпляров зацикливается при необходимости прочитать в ответ toocustomer запросов. Наконец Service Fabric стимулирует облегченного toobe служб. Service Fabric позволяет тысячи служб toobe подготовкой внутри одного процесса, вместо необходимости или выделять все экземпляры операционной системы или процессы tooa один экземпляр службы.
* **Согласованность** -все данные, сохраненные в этой службе можно гарантировать toobe согласованной. Это касается и согласованности между несколькими коллекциями Reliable Collections в пределах одной службы. Изменения в нескольких коллекциях в пределах службы можно выполнять путем атомарных транзакций.

## <a name="service-lifecycle"></a>Жизненный цикл службы
Независимо от того, какую службу вы используете (с отслеживанием или без отслеживания состояния), надежные службы обеспечивают простой жизненный цикл, позволяющий быстро подключить код и приступить к работе.  Существует всего один или два метода, необходимость tooimplement tooget службы запуска.

* **CreateServiceReplicaListeners/CreateServiceInstanceListeners** — этот метод является, где служба hello определяет stack(s) hello связи, что ему toouse. Здравствуйте стек связи, таких как [веб-API](service-fabric-reliable-services-communication-webapi.md), является то, что определяет hello прослушивания конечной точки или конечные точки для hello службы (как клиентам подключиться hello службы). Он также определяет, как подозрительные сообщения hello взаимодействовать с hello остальная часть кода службы hello.
* **RunAsync** — этот метод является, где работает служба его бизнес-логики и где он начнем все фоновые задачи, которые должно выполняться на протяжении времени существования hello hello службы. Hello токен отмены, который предоставляется сигнал для при следует остановить эту работу. Например если служба hello должен toopull сообщений из очереди надежного и их обработки, это где происходит этой работы.

Если о службах надежного hello изучении первый раз, читайте дальше! Если вы ищете жизненного цикла hello надежных служб Подробное пошаговое руководство, вы может перейдите слишком[в этой статье](service-fabric-reliable-services-lifecycle.md).

## <a name="example-services"></a>Примеры служб
Зная этой модели программирования, давайте кратко рассмотрим две разные службы toosee, как взаимодействуют эти элементы.

### <a name="stateless-reliable-services"></a>Надежные службы без отслеживания состояния
Служба без сохранения состояния — один where не поддерживается, если в службе hello вызовов состояние. Любое имеющееся состояние является одноразовым и не требует синхронизации, репликации, постоянного сохранения или высокой доступности.

Например рассмотрим калькулятора, который не хранит и получает все условия и операций tooperform за один раз.

В этом случае hello `RunAsync()` (C#) или `runAsync()` (Java) hello службы может быть пустым, так как она не фоновой задачи обработки этой службы hello должен toodo. При создании службы калькулятора hello возвращает `ICommunicationListener` (C#) или `CommunicationListener` (Java) (например [веб-API](service-fabric-reliable-services-communication-webapi.md)), которая будет открывать прослушивания конечной точки для этого же порта. Этой конечной точке подключает toohello другое вычисление методов (пример: «Добавить (n1, n2)»), которые определяют открытый API hello калькулятора.

При вызове из клиента, вызывается соответствующий метод hello, а служба калькулятора hello выполняет операции hello для hello данных предоставляются и возвращает результат hello. Никакого состояния она не хранит.

Это простой пример, так как в службе калькулятора внутреннее состояние не сохраняется. Большинство служб без отслеживания состояния не являются таковыми в полной мере, Вместо этого они прикрепить их состояние toosome другое хранилище. (например, веб-приложение, хранящее состояние сеанса в резервном хранилище или кэше, не является службой без отслеживания состояния).

Распространенным примером службы без сохранения состояния в том, как используются в Service Fabric — как начальную, предоставляет hello публичный веб-API для веб-приложения. Затем службы интерфейса Hello рассказывает toocomplete служб toostateful запрос пользователя. В этом случае вызовы от клиентов, направленной tooa известен порт, например 80, где прослушивание службы без отслеживания состояния hello. Этой службы без отслеживания состояния, получает вызов hello и определяет ли hello вызовов из надежного источника, а какую службу оно предназначено.  Затем службы без отслеживания состояния hello пересылает hello вызовов toohello верная секция службы с отслеживанием состояния hello и ожидает ответа. Когда службы без отслеживания состояния hello получает ответ, он возвращает toohello исходного клиента. Пример такой службы можно найти в образцах [C#](https://github.com/Azure-Samples/service-fabric-dotnet-getting-started) / [Java](https://github.com/Azure-Samples/service-fabric-java-getting-started/tree/master/Actors/VisualObjectActor/VisualObjectWebService). Это лишь один пример этот шаблон в образцах hello, существуют и другие в других образцах также.

### <a name="stateful-reliable-services"></a>Надежные службы с отслеживанием состояния
Службы с отслеживанием состояния —, должен иметь какой-либо части состояние, согласованное и присутствовать для службы toofunction hello. Рассмотрим службу, которая постоянно вычисляет скользящее среднее некоторых значений на основе получаемых обновлений. toodo, оно должно иметь hello текущий набор входящих запросов, он должен tooprocess и hello текущее среднее. Любая служба, которая получает, обрабатывает и сохраняет информацию во внешнем хранилище (как это сегодня делается в хранилище BLOB-объектов или табличном хранилище Azure), является службой с отслеживанием состояния — Он просто сохраняет свое состояние в хранилище внешних состояний hello.

Большинство служб сегодня сохранять свое состояние во извне, поскольку внешнем хранилище hello именно это и обеспечивает надежность, доступность, масштабируемость и согласованности для этого состояния. В Service Fabric службы не требуется toostore их состояние на внешних ресурсах. Эти требования для службы кода hello и состояние службы hello занимается Service Fabric.

> [!NOTE]
> Поддержка надежных служб с отслеживанием состояния пока недоступна в Linux (для C# и Java).
>

Предположим, что мы хотим toowrite служба, обрабатывающая изображения. toodo это принимает службы hello в образ и hello ряд tooperform преобразования на этот образ. Эта служба возвращает прослушиватель связи (допустим, веб-API), который предоставляет такой API, как `ConvertImage(Image i, IList<Conversion> conversions)`. При получении запроса, службы hello сохраняет его в `IReliableQueue`и возвращает toohello некоторые идентификатор клиента, поэтому он может отслеживать hello запроса.

В этой службе метод `RunAsync()` может быть более сложным. Служба Hello содержит цикл внутри его `RunAsync()` , извлекает запросы из `IReliableQueue` и выполняет преобразование hello запрошено. Hello результаты сохраняются в `IReliableDictionary` , чтобы при hello клиента возвращается быстро получать их преобразованные изображения. tooensure, даже в том случае, если что-то происходит сбой hello образ не будет потерян, это надежной службы будет извлекать из очереди hello, выполняют преобразования hello и сохранения результата hello все в одной транзакции. В этом случае приветственное сообщение удаляется из очереди hello и hello результаты хранятся в словаре результат hello, только после завершения преобразования hello. Кроме того служба hello может по запросу hello изображения из очереди сообщений hello и немедленно сохранить его в удаленное хранилище. Это уменьшает hello объем hello службы состояний имеет toomanage, но повышает сложность, так как служба hello tookeep hello необходимых метаданных toomanage hello удаленное хранилище. В обоих подходах Если что-то сбой в запрос средней hello hello остается в hello очереди ожидания toobe обработки.

Один самое toonote об этой службе является своему названию обычной службы .NET! Hello единственное отличие заключается в том, что данные hello структуры используются (`IReliableQueue` и `IReliableDictionary`) предоставляются Service Fabric и высокой надежные, доступны и согласованность.

## <a name="when-toouse-reliable-services-apis"></a>Когда toouse надежные API служб
Если любой из следующих hello характеризующих потребностей приложения службы, затем следует надежные API служб:

* Код службы (и при необходимости состояния) toobe высокой доступности и надежности
* Необходимы гарантии выполнения транзакций между несколькими единицами состояния (например, заказами и позициями строки заказа).
* Состояние приложения можно естественным образом моделировать в виде надежных словарей и очередей.
* Код приложения или состояние должен toobe высокой надежности с небольшими задержками операций чтения и записи.
* Приложению параллелизма hello toocontrol или гранулярности транзакционных операций через одну или несколько коллекций надежным.
* Требуется сообщений hello toomanage или управления hello секционирование схемы для службы.
* Коду требуется среда выполнения, работающая в режиме свободного потока.
* Приложение должно toodynamically создавать или удалять надежного словари или очередей или всей службы во время выполнения.
* Необходимо tooprogrammatically Service Fabric техники резервного копирования и восстановления возможности управления для состояния вашей службы.
* Вашему приложению требуется toomaintain журнала изменений для его единиц измерения состояния.
* Требуется toodevelop, или использовать поставщики сторонних производителей разработаны, пользовательские состояния.

## <a name="next-steps"></a>Дальнейшие действия
* [Краткое руководство по надежным службам Reliable Services](service-fabric-reliable-services-quick-start.md)
* [Продвинутое использование надежных служб](service-fabric-reliable-services-advanced-usage.md)
* [модель программирования службы Reliable Actor Hello](service-fabric-reliable-actors-introduction.md)
