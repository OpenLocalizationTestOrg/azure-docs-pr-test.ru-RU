---
title: "Общие сведения о модели программирования Service Fabric Reliable Services | Документация Майкрософт"
description: "Сведения о модели программирования надежных служб Service Fabric, позволяющие приступить к написанию собственных служб."
services: Service-Fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: vturecek; mani-ramaswamy
ms.assetid: 0c88a533-73f8-4ae1-a939-67d17456ac06
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: masnider;
ms.openlocfilehash: 601b1c7713c9785d949c1c72000ec7f3f63dd682
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="reliable-services-overview"></a><span data-ttu-id="e140b-103">Обзор надежных служб</span><span class="sxs-lookup"><span data-stu-id="e140b-103">Reliable Services overview</span></span>
<span data-ttu-id="e140b-104">Платформа Azure Service Fabric упрощает написание надежных служб с отслеживанием и без отслеживания состояния и управление такими службами.</span><span class="sxs-lookup"><span data-stu-id="e140b-104">Azure Service Fabric simplifies writing and managing stateless and stateful Reliable Services.</span></span> <span data-ttu-id="e140b-105">В этой статье рассматриваются следующие вопросы.</span><span class="sxs-lookup"><span data-stu-id="e140b-105">This topic covers:</span></span>

* <span data-ttu-id="e140b-106">Модель программирования надежных служб для служб с отслеживанием состояния и без него.</span><span class="sxs-lookup"><span data-stu-id="e140b-106">The Reliable Services programming model for stateless and stateful services.</span></span>
* <span data-ttu-id="e140b-107">Варианты выбора при написании надежной службы.</span><span class="sxs-lookup"><span data-stu-id="e140b-107">The choices you have to make when writing a Reliable Service.</span></span>
* <span data-ttu-id="e140b-108">Некоторые сценарии и примеры использования надежных служб, а также способ их написания.</span><span class="sxs-lookup"><span data-stu-id="e140b-108">Some scenarios and examples of when to use Reliable Services and how they are written.</span></span>

<span data-ttu-id="e140b-109">Надежные службы являются одной из моделей программирования, доступных в Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e140b-109">Reliable Services is one of the programming models available on Service Fabric.</span></span> <span data-ttu-id="e140b-110">Другая модель программирования — модель Reliable Actors, которая в дополнение к модели Reliable Services предоставляет модель программирования на основе виртуальных субъектов.</span><span class="sxs-lookup"><span data-stu-id="e140b-110">The other is the Reliable Actor programming model, which provides a virtual Actor programming model on top of the Reliable Services model.</span></span> <span data-ttu-id="e140b-111">Дополнительные сведения о модели программирования Reliable Actors см. в статье [Общие сведения о надежных субъектах Service Fabric](service-fabric-reliable-actors-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="e140b-111">For more information on the Reliable Actors programming model, see [Introduction to Service Fabric Reliable Actors](service-fabric-reliable-actors-introduction.md).</span></span>

<span data-ttu-id="e140b-112">Service Fabric управляет временем существования служб от подготовки и развертывания до обновления и удаления посредством [управления приложениями Service Fabric](service-fabric-deploy-remove-applications.md).</span><span class="sxs-lookup"><span data-stu-id="e140b-112">Service Fabric manages the lifetime of services, from provisioning and deployment through upgrade and deletion, via [Service Fabric application management](service-fabric-deploy-remove-applications.md).</span></span>

## <a name="what-are-reliable-services"></a><span data-ttu-id="e140b-113">Что такое надежные службы?</span><span class="sxs-lookup"><span data-stu-id="e140b-113">What are Reliable Services?</span></span>
<span data-ttu-id="e140b-114">Надежные службы — это простая, мощная, верхнеуровневая модель программирования, открывающая широкие и гибкие возможности для разработки приложений.</span><span class="sxs-lookup"><span data-stu-id="e140b-114">Reliable Services gives you a simple, powerful, top-level programming model to help you express what is important to your application.</span></span> <span data-ttu-id="e140b-115">С помощью модели программирования надежных служб вы получаете такие возможности:</span><span class="sxs-lookup"><span data-stu-id="e140b-115">With the Reliable Services programming model, you get:</span></span>

* <span data-ttu-id="e140b-116">Доступ к остальным программным интерфейсам API платформы Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e140b-116">Access to the rest of the Service Fabric programming APIs.</span></span> <span data-ttu-id="e140b-117">В отличие от служб Service Fabric, смоделированных в виде [гостевых исполняемых файлов](service-fabric-deploy-existing-app.md), Reliable Services напрямую использует остальные API-интерфейсы платформы Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e140b-117">Unlike Service Fabric Services modeled as [Guest Executables](service-fabric-deploy-existing-app.md), Reliable Services get to use the rest of the Service Fabric APIs directly.</span></span> <span data-ttu-id="e140b-118">Это дает службам такие возможности:</span><span class="sxs-lookup"><span data-stu-id="e140b-118">This allows services to:</span></span>
  * <span data-ttu-id="e140b-119">выполнение запросов к системе;</span><span class="sxs-lookup"><span data-stu-id="e140b-119">query the system</span></span>
  * <span data-ttu-id="e140b-120">создание отчетов о работоспособности сущностей в кластере;</span><span class="sxs-lookup"><span data-stu-id="e140b-120">report health about entities in the cluster</span></span>
  * <span data-ttu-id="e140b-121">получение уведомлений об изменениях конфигурации и кода;</span><span class="sxs-lookup"><span data-stu-id="e140b-121">receive notifications about configuration and code changes</span></span>
  * <span data-ttu-id="e140b-122">поиск других служб и обмен данными с ними;</span><span class="sxs-lookup"><span data-stu-id="e140b-122">find and communicate with other services,</span></span>
  * <span data-ttu-id="e140b-123">(необязательно) использование коллекций [Reliable Collections](service-fabric-reliable-services-reliable-collections.md);</span><span class="sxs-lookup"><span data-stu-id="e140b-123">(optionally) use the [Reliable Collections](service-fabric-reliable-services-reliable-collections.md)</span></span>
  * <span data-ttu-id="e140b-124">доступ ко многим другим возможностям высококлассной модели программирования на нескольких языках программирования.</span><span class="sxs-lookup"><span data-stu-id="e140b-124">...and giving them access to many other capabilities, all from a first class programming model in several programming languages.</span></span>
* <span data-ttu-id="e140b-125">Простая модель для выполнения собственного кода, которая похожа на привычные модели программирования:</span><span class="sxs-lookup"><span data-stu-id="e140b-125">A simple model for running your own code that looks like programming models you are used to.</span></span> <span data-ttu-id="e140b-126">у создаваемого кода четко определенная точка входа и простой в управлении жизненный цикл.</span><span class="sxs-lookup"><span data-stu-id="e140b-126">Your code has a well-defined entry point and easily managed lifecycle.</span></span>
* <span data-ttu-id="e140b-127">Модель взаимодействия со службами</span><span class="sxs-lookup"><span data-stu-id="e140b-127">A pluggable communication model.</span></span> <span data-ttu-id="e140b-128">Транспорт может быть любым, включая HTTP с [веб-API](service-fabric-reliable-services-communication-webapi.md), протоколы WebSocket, пользовательские протоколы TCP и т. п.</span><span class="sxs-lookup"><span data-stu-id="e140b-128">Use the transport of your choice, such as HTTP with [Web API](service-fabric-reliable-services-communication-webapi.md), WebSockets, custom TCP protocols, or anything else.</span></span> <span data-ttu-id="e140b-129">Надежные службы позволяют использовать ряд отличных готовых вариантов или задействовать собственный.</span><span class="sxs-lookup"><span data-stu-id="e140b-129">Reliable Services provide some great out-of-the-box options you can use, or you can provide your own.</span></span>
* <span data-ttu-id="e140b-130">Для служб с отслеживанием состояния модель программирования Reliable Services позволяет согласованно и надежно хранить состояние прямо в службе с помощью коллекций [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="e140b-130">For stateful services, the Reliable Services programming model allows you to consistently and reliably store your state right inside your service by using [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="e140b-131">Reliable Collections — это простой набор классов коллекций с высокой доступностью и надежностью, которые будут знакомы всем, кто использовал коллекции C#.</span><span class="sxs-lookup"><span data-stu-id="e140b-131">Reliable Collections are a simple set of highly available and reliable collection classes that will be familiar to anyone who has used C# collections.</span></span> <span data-ttu-id="e140b-132">Обычно для надежного управления состоянием службам требовались внешние системы.</span><span class="sxs-lookup"><span data-stu-id="e140b-132">Traditionally, services needed external systems for Reliable state management.</span></span> <span data-ttu-id="e140b-133">Коллекции Reliable Collections обеспечивают хранение состояния вместе с вычислениями при таком же уровне доступности и надежности, как и в высокодоступных внешних хранилищах.</span><span class="sxs-lookup"><span data-stu-id="e140b-133">With Reliable Collections, you can store your state next to your compute with the same high availability and reliability you've come to expect from highly available external stores.</span></span> <span data-ttu-id="e140b-134">Такая модель также сокращает задержку, потому что необходимые для работы данные состояния и вычисления хранятся рядом.</span><span class="sxs-lookup"><span data-stu-id="e140b-134">This model also improves latency because you are co-locating the compute and state it needs to function.</span></span>

<span data-ttu-id="e140b-135">Посмотрите этот видеоролик от Microsoft Virtual Academy, который содержит обзор служб Reliable Services: <center>
<a target="_blank" href="https://mva.microsoft.com/en-US/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=HhD9566yC_4106218965">
<img src="./media/service-fabric-reliable-services-introduction/ReliableServicesVid.png" WIDTH="360" HEIGHT="244" />
</a>
</center></span><span class="sxs-lookup"><span data-stu-id="e140b-135">Watch this Microsoft Virtual Academy video for an overview of Reliable services: <center>
<a target="_blank" href="https://mva.microsoft.com/en-US/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=HhD9566yC_4106218965">
<img src="./media/service-fabric-reliable-services-introduction/ReliableServicesVid.png" WIDTH="360" HEIGHT="244" />
</a>
</center></span></span>

## <a name="what-makes-reliable-services-different"></a><span data-ttu-id="e140b-136">Чем отличаются надежные службы</span><span class="sxs-lookup"><span data-stu-id="e140b-136">What makes Reliable Services different?</span></span>
<span data-ttu-id="e140b-137">Надежные службы в Service Fabric отличаются от служб, которые вы могли создавать ранее.</span><span class="sxs-lookup"><span data-stu-id="e140b-137">Reliable Services in Service Fabric are different from services you may have written before.</span></span> <span data-ttu-id="e140b-138">Service Fabric обеспечивает надежность, доступность, согласованность и масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="e140b-138">Service Fabric provides reliability, availability, consistency, and scalability.</span></span>

* <span data-ttu-id="e140b-139">**Надежность** — служба остается активной даже в ненадежных средах, в которых компьютеры дают сбой или сталкиваются с ошибками сети, либо когда ошибки возникают в самих службах и происходит сбой.</span><span class="sxs-lookup"><span data-stu-id="e140b-139">**Reliability** - Your service stays up even in unreliable environments where your machines fail or hit network issues, or in cases where the services themselves encounter errors and crash or fail.</span></span> <span data-ttu-id="e140b-140">В службах с отслеживанием состояния состояние сохраняется даже при наличии ошибок сети или других сбоев.</span><span class="sxs-lookup"><span data-stu-id="e140b-140">For stateful services, your state is preserved even in the presence of network or other failures.</span></span>
* <span data-ttu-id="e140b-141">**Доступность** — служба доступна и отвечает на запросы.</span><span class="sxs-lookup"><span data-stu-id="e140b-141">**Availability** - Your service is reachable and responsive.</span></span> <span data-ttu-id="e140b-142">Платформа Service Fabric поддерживает нужное число запущенных копий.</span><span class="sxs-lookup"><span data-stu-id="e140b-142">Service Fabric maintains your desired number of running copies.</span></span>
* <span data-ttu-id="e140b-143">**Масштабируемость** — службы отвязываются от конкретного оборудования и могут увеличиваться или уменьшаться в масштабе (насколько нужно) путем добавления или удаления оборудования или других ресурсов.</span><span class="sxs-lookup"><span data-stu-id="e140b-143">**Scalability** - Services are decoupled from specific hardware, and they can grow or shrink as necessary through the addition or removal of hardware or other resources.</span></span> <span data-ttu-id="e140b-144">Службы легко секционируются (особенно в случае с отслеживанием состояния). Это дает возможность масштабировать службу и обрабатывать частичные сбои.</span><span class="sxs-lookup"><span data-stu-id="e140b-144">Services are easily partitioned (especially in the stateful case) to ensure that the service can scale and handle partial failures.</span></span> <span data-ttu-id="e140b-145">Службы можно динамически создавать и удалять с помощью кода, развертывая по мере необходимости дополнительные экземпляры, например по запросу клиента.</span><span class="sxs-lookup"><span data-stu-id="e140b-145">Services can be created and deleted dynamically via code, enabling more instances to be spun up as necessary, say in response to customer requests.</span></span> <span data-ttu-id="e140b-146">И наконец, платформа Service Fabric способствует тому, что службы имеют небольшой размер.</span><span class="sxs-lookup"><span data-stu-id="e140b-146">Finally, Service Fabric encourages services to be lightweight.</span></span> <span data-ttu-id="e140b-147">Service Fabric позволяет подготавливать тысячи служб в рамках одного процесса. То есть нет необходимости выделять целые экземпляры ОС или процессы для одного экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="e140b-147">Service Fabric allows thousands of services to be provisioned within a single process, rather than requiring or dedicating entire OS instances or processes to a single instance of a service.</span></span>
* <span data-ttu-id="e140b-148">**Согласованность** — гарантия согласованности любых данных, которые хранятся в этой службе.</span><span class="sxs-lookup"><span data-stu-id="e140b-148">**Consistency** - Any information stored in this service can be guaranteed to be consistent.</span></span> <span data-ttu-id="e140b-149">Это касается и согласованности между несколькими коллекциями Reliable Collections в пределах одной службы.</span><span class="sxs-lookup"><span data-stu-id="e140b-149">This is true even across multiple reliable collections within a service.</span></span> <span data-ttu-id="e140b-150">Изменения в нескольких коллекциях в пределах службы можно выполнять путем атомарных транзакций.</span><span class="sxs-lookup"><span data-stu-id="e140b-150">Changes across collections within a service can be made in a transactionally atomic manner.</span></span>

## <a name="service-lifecycle"></a><span data-ttu-id="e140b-151">Жизненный цикл службы</span><span class="sxs-lookup"><span data-stu-id="e140b-151">Service lifecycle</span></span>
<span data-ttu-id="e140b-152">Независимо от того, какую службу вы используете (с отслеживанием или без отслеживания состояния), надежные службы обеспечивают простой жизненный цикл, позволяющий быстро подключить код и приступить к работе.</span><span class="sxs-lookup"><span data-stu-id="e140b-152">Whether your service is stateful or stateless, Reliable Services provide a simple lifecycle that lets you quickly plug in your code and get started.</span></span>  <span data-ttu-id="e140b-153">Для запуска службы необходимо реализовать всего лишь один или два метода.</span><span class="sxs-lookup"><span data-stu-id="e140b-153">There are just one or two methods that you need to implement to get your service up and running.</span></span>

* <span data-ttu-id="e140b-154">**CreateServiceReplicaListeners/CreateServiceInstanceListeners** — в этом методе служба определяет стеки связи, которые собирается использовать.</span><span class="sxs-lookup"><span data-stu-id="e140b-154">**CreateServiceReplicaListeners/CreateServiceInstanceListeners** - This method is where the service defines the communication stack(s) that it wants to use.</span></span> <span data-ttu-id="e140b-155">Стек связи, например [веб-API](service-fabric-reliable-services-communication-webapi.md), определяет одну или несколько конечных точек прослушивания для службы (способ доступа к ней клиентов),</span><span class="sxs-lookup"><span data-stu-id="e140b-155">The communication stack, such as [Web API](service-fabric-reliable-services-communication-webapi.md), is what defines the listening endpoint or endpoints for the service (how clients reach the service).</span></span> <span data-ttu-id="e140b-156">а также определяет взаимодействие поступающих сообщений с остальным кодом службы.</span><span class="sxs-lookup"><span data-stu-id="e140b-156">It also defines how the messages that appear interact with the rest of the service code.</span></span>
* <span data-ttu-id="e140b-157">**RunAsync** — в этом методе выполняется бизнес-логика службы, а также запускаются все фоновые задачи, которые должны выполняться в течение всего времени существования службы.</span><span class="sxs-lookup"><span data-stu-id="e140b-157">**RunAsync** - This method is where your service runs its business logic, and where it would kick off any background tasks that should run for the lifetime of the service.</span></span> <span data-ttu-id="e140b-158">Предоставляемый токен отмены сигнализирует о моменте, когда работу следует остановить.</span><span class="sxs-lookup"><span data-stu-id="e140b-158">The cancellation token that is provided is a signal for when that work should stop.</span></span> <span data-ttu-id="e140b-159">Например, если служба должна извлекать сообщения из очереди Reliable Queue и обрабатывать их, это и будет местом выполнения соответствующей работы.</span><span class="sxs-lookup"><span data-stu-id="e140b-159">For example, if the service needs to pull messages out of a Reliable Queue and process them, this is where that work happens.</span></span>

<span data-ttu-id="e140b-160">Если вы впервые узнали о Reliable Services, читайте статью дальше.</span><span class="sxs-lookup"><span data-stu-id="e140b-160">If you're learning about reliable services for the first time, read on!</span></span> <span data-ttu-id="e140b-161">Если вам необходимо подробное пошаговое руководство о жизненном цикле Reliable Services, можно перейти [к этой статье](service-fabric-reliable-services-lifecycle.md).</span><span class="sxs-lookup"><span data-stu-id="e140b-161">If you're looking for a detailed walkthrough of the lifecycle of reliable services, you can head over to [this article](service-fabric-reliable-services-lifecycle.md).</span></span>

## <a name="example-services"></a><span data-ttu-id="e140b-162">Примеры служб</span><span class="sxs-lookup"><span data-stu-id="e140b-162">Example services</span></span>
<span data-ttu-id="e140b-163">Зная эту модель программирования, давайте кратко рассмотрим две разные службы, чтобы увидеть, как взаимодействуют все описанные элементы.</span><span class="sxs-lookup"><span data-stu-id="e140b-163">Knowing this programming model, let's take a quick look at two different services to see how these pieces fit together.</span></span>

### <a name="stateless-reliable-services"></a><span data-ttu-id="e140b-164">Надежные службы без отслеживания состояния</span><span class="sxs-lookup"><span data-stu-id="e140b-164">Stateless Reliable Services</span></span>
<span data-ttu-id="e140b-165">Служба без отслеживания состояния — это служба, в которой не поддерживается состояние в службе в пределах нескольких вызовов.</span><span class="sxs-lookup"><span data-stu-id="e140b-165">A stateless service is one where there is no state maintained within the service across calls.</span></span> <span data-ttu-id="e140b-166">Любое имеющееся состояние является одноразовым и не требует синхронизации, репликации, постоянного сохранения или высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="e140b-166">Any state that is present is entirely disposable and doesn't require synchronization, replication, persistence, or high availability.</span></span>

<span data-ttu-id="e140b-167">Например, рассмотрим калькулятор — службу, которая не пользуется памятью и которая принимает все условия и операции для одновременного выполнения.</span><span class="sxs-lookup"><span data-stu-id="e140b-167">For example, consider a calculator that has no memory and receives all terms and operations to perform at once.</span></span>

<span data-ttu-id="e140b-168">В этом случае метод `RunAsync()` (C#) или `runAsync()` (Java) службы может быть пустым, так как у службы нет необходимости в фоновой обработке задач.</span><span class="sxs-lookup"><span data-stu-id="e140b-168">In this case, the `RunAsync()` (C#) or `runAsync()` (Java) of the service can be empty, since there is no background task-processing that the service needs to do.</span></span> <span data-ttu-id="e140b-169">Когда создается служба калькулятора, она возвращает интерфейс `ICommunicationListener` (C#) или `CommunicationListener` (Java) (например, [веб-API](service-fabric-reliable-services-communication-webapi.md)), который открывает конечную точку прослушивания на том или ином порту.</span><span class="sxs-lookup"><span data-stu-id="e140b-169">When the calculator service is created, it returns an `ICommunicationListener` (C#) or `CommunicationListener` (Java) (for example [Web API](service-fabric-reliable-services-communication-webapi.md)) that opens up a listening endpoint on some port.</span></span> <span data-ttu-id="e140b-170">Эта конечная точка подключается к различным вычислительным методам (например, Add(n1, n2)), которые определяют общедоступный API калькулятора.</span><span class="sxs-lookup"><span data-stu-id="e140b-170">This listening endpoint hooks up to the different calculation methods (example: "Add(n1, n2)") that define the calculator's public API.</span></span>

<span data-ttu-id="e140b-171">При клиентском вызове вызывается соответствующий метод, а калькулятор выполняет операции над предоставленными данными и возвращает результат.</span><span class="sxs-lookup"><span data-stu-id="e140b-171">When a call is made from a client, the appropriate method is invoked, and the calculator service performs the operations on the data provided and returns the result.</span></span> <span data-ttu-id="e140b-172">Никакого состояния она не хранит.</span><span class="sxs-lookup"><span data-stu-id="e140b-172">It doesn't store any state.</span></span>

<span data-ttu-id="e140b-173">Это простой пример, так как в службе калькулятора внутреннее состояние не сохраняется.</span><span class="sxs-lookup"><span data-stu-id="e140b-173">Not storing any internal state makes this example calculator simple.</span></span> <span data-ttu-id="e140b-174">Большинство служб без отслеживания состояния не являются таковыми в полной мере,</span><span class="sxs-lookup"><span data-stu-id="e140b-174">But most services aren't truly stateless.</span></span> <span data-ttu-id="e140b-175">так как они записывают свои состояния в какое-либо внешнее хранилище</span><span class="sxs-lookup"><span data-stu-id="e140b-175">Instead, they externalize their state to some other store.</span></span> <span data-ttu-id="e140b-176">(например, веб-приложение, хранящее состояние сеанса в резервном хранилище или кэше, не является службой без отслеживания состояния).</span><span class="sxs-lookup"><span data-stu-id="e140b-176">(For example, any web app that relies on keeping session state in a backing store or cache is not stateless.)</span></span>

<span data-ttu-id="e140b-177">Распространенным примером использования служб без отслеживания состояния в Service Fabric является внешний интерфейс, который позволяет пользоваться общедоступным интерфейсом API для веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="e140b-177">A common example of how stateless services are used in Service Fabric is as a front-end that exposes the public-facing API for a web application.</span></span> <span data-ttu-id="e140b-178">Затем внешняя служба обменивается данными со службами с отслеживанием состояния для выполнения запроса пользователя.</span><span class="sxs-lookup"><span data-stu-id="e140b-178">The front-end service then talks to stateful services to complete a user request.</span></span> <span data-ttu-id="e140b-179">В этом случае вызовы от клиентов направляются на известный порт, например с номером 80, который прослушивает служба без отслеживания состояния.</span><span class="sxs-lookup"><span data-stu-id="e140b-179">In this case, calls from clients are directed to a known port, such as 80, where the stateless service is listening.</span></span> <span data-ttu-id="e140b-180">Такая служба получает вызов и определяет, поступил ли он из надежного источника, а также устанавливает, для какой службы он предназначен.</span><span class="sxs-lookup"><span data-stu-id="e140b-180">This stateless service receives the call and determines whether the call is from a trusted party and which service it's destined for.</span></span>  <span data-ttu-id="e140b-181">Затем служба без отслеживания состояния перенаправляет вызов на нужную секцию службы с отслеживанием состояния и ожидает ответа.</span><span class="sxs-lookup"><span data-stu-id="e140b-181">Then, the stateless service forwards the call to the correct partition of the stateful service and waits for a response.</span></span> <span data-ttu-id="e140b-182">При получении ответа служба без отслеживания состояния отвечает исходному клиенту.</span><span class="sxs-lookup"><span data-stu-id="e140b-182">When the stateless service receives a response, it replies to the original client.</span></span> <span data-ttu-id="e140b-183">Пример такой службы можно найти в образцах [C#](https://github.com/Azure-Samples/service-fabric-dotnet-getting-started) / [Java](https://github.com/Azure-Samples/service-fabric-java-getting-started/tree/master/Actors/VisualObjectActor/VisualObjectWebService).</span><span class="sxs-lookup"><span data-stu-id="e140b-183">An example of such a service is in our samples [C#](https://github.com/Azure-Samples/service-fabric-dotnet-getting-started) / [Java](https://github.com/Azure-Samples/service-fabric-java-getting-started/tree/master/Actors/VisualObjectActor/VisualObjectWebService).</span></span> <span data-ttu-id="e140b-184">Это только один из примеров данного шаблона. Существуют и другие.</span><span class="sxs-lookup"><span data-stu-id="e140b-184">This is only one example of this pattern in the samples, there are others in other samples as well.</span></span>

### <a name="stateful-reliable-services"></a><span data-ttu-id="e140b-185">Надежные службы с отслеживанием состояния</span><span class="sxs-lookup"><span data-stu-id="e140b-185">Stateful Reliable Services</span></span>
<span data-ttu-id="e140b-186">Служба с отслеживанием состояния — это служба, которой для надлежащего функционирования необходимо часть состояния поддерживать в согласованном виде.</span><span class="sxs-lookup"><span data-stu-id="e140b-186">A stateful service is one that must have some portion of state kept consistent and present in order for the service to function.</span></span> <span data-ttu-id="e140b-187">Рассмотрим службу, которая постоянно вычисляет скользящее среднее некоторых значений на основе получаемых обновлений.</span><span class="sxs-lookup"><span data-stu-id="e140b-187">Consider a service that constantly computes a rolling average of some value based on updates it receives.</span></span> <span data-ttu-id="e140b-188">Для этого службе необходимо располагать текущим набором входящих запросов, которые требуется обработать, а также текущим средним значением.</span><span class="sxs-lookup"><span data-stu-id="e140b-188">To do this, it must have the current set of incoming requests it needs to process and the current average.</span></span> <span data-ttu-id="e140b-189">Любая служба, которая получает, обрабатывает и сохраняет информацию во внешнем хранилище (как это сегодня делается в хранилище BLOB-объектов или табличном хранилище Azure), является службой с отслеживанием состояния —</span><span class="sxs-lookup"><span data-stu-id="e140b-189">Any service that retrieves, processes, and stores information in an external store (such as an Azure blob or table store today) is stateful.</span></span> <span data-ttu-id="e140b-190">она просто хранит свое состояние во внешнем хранилище состояний.</span><span class="sxs-lookup"><span data-stu-id="e140b-190">It just keeps its state in the external state store.</span></span>

<span data-ttu-id="e140b-191">Большинство служб сегодня хранят свое состояние во внешних хранилищах, что обеспечивает надежность, доступность, масштабируемость и согласованность состояния.</span><span class="sxs-lookup"><span data-stu-id="e140b-191">Most services today store their state externally, since the external store is what provides reliability, availability, scalability, and consistency for that state.</span></span> <span data-ttu-id="e140b-192">В Service Fabric необязательно, чтобы службы хранили состояние во внешних хранилищах.</span><span class="sxs-lookup"><span data-stu-id="e140b-192">In Service Fabric, services aren't required to store their state externally.</span></span> <span data-ttu-id="e140b-193">Service Fabric соответствует таким требованиям к коду и состоянию службы.</span><span class="sxs-lookup"><span data-stu-id="e140b-193">Service Fabric takes care of these requirements for both the service code and the service state.</span></span>

> [!NOTE]
> <span data-ttu-id="e140b-194">Поддержка надежных служб с отслеживанием состояния пока недоступна в Linux (для C# и Java).</span><span class="sxs-lookup"><span data-stu-id="e140b-194">Support for Stateful Reliable Services is not available on Linux yet (for C# or Java).</span></span>
>

<span data-ttu-id="e140b-195">Допустим, нам нужно создать службу, которая обрабатывает изображения.</span><span class="sxs-lookup"><span data-stu-id="e140b-195">Let's say we want to write a service that processes images.</span></span> <span data-ttu-id="e140b-196">Для этого служба принимает изображение и ряд преобразований, которые необходимо с ним выполнить.</span><span class="sxs-lookup"><span data-stu-id="e140b-196">To do this, the service takes in an image and the series of conversions to perform on that image.</span></span> <span data-ttu-id="e140b-197">Эта служба возвращает прослушиватель связи (допустим, веб-API), который предоставляет такой API, как `ConvertImage(Image i, IList<Conversion> conversions)`.</span><span class="sxs-lookup"><span data-stu-id="e140b-197">This service returns a communication listener (let's suppose it's a WebAPI) that exposes an API like `ConvertImage(Image i, IList<Conversion> conversions)`.</span></span> <span data-ttu-id="e140b-198">Получив запрос, служба сохраняет его в `IReliableQueue` и возвращает клиенту идентификатор для отслеживания запроса.</span><span class="sxs-lookup"><span data-stu-id="e140b-198">When it receives a request, the service stores it in a `IReliableQueue`, and returns some id to the client so it can track the request.</span></span>

<span data-ttu-id="e140b-199">В этой службе метод `RunAsync()` может быть более сложным.</span><span class="sxs-lookup"><span data-stu-id="e140b-199">In this service, `RunAsync()` could be more complex.</span></span> <span data-ttu-id="e140b-200">В методе `RunAsync()` этой службы существует цикл, который извлекает запросы из очереди `IReliableQueue` и выполняет запрошенные преобразования.</span><span class="sxs-lookup"><span data-stu-id="e140b-200">The service has a loop inside its `RunAsync()` that pulls requests out of `IReliableQueue` and performs the conversions requested.</span></span> <span data-ttu-id="e140b-201">Результаты сохраняются в `IReliableDictionary`. Когда клиент обращается к службе снова, он получает преобразованные изображения.</span><span class="sxs-lookup"><span data-stu-id="e140b-201">The results get stored in an `IReliableDictionary` so that when the client comes back they can get their converted images.</span></span> <span data-ttu-id="e140b-202">Чтобы гарантировать, что даже в случае отказа изображение не будет утеряно, такая служба Reliable Service выполняет извлечение из очереди, преобразование и сохранение результата в одной транзакции.</span><span class="sxs-lookup"><span data-stu-id="e140b-202">To ensure that even if something fails the image isn't lost, this Reliable Service would pull out of the queue, perform the conversions, and store the result all in a single transaction.</span></span> <span data-ttu-id="e140b-203">В таком случае сообщение удаляется из очереди и результаты сохраняются в словаре результатов только после завершения преобразований.</span><span class="sxs-lookup"><span data-stu-id="e140b-203">In this case, the message is removed from the queue and the results are stored in the result dictionary only when the conversions are complete.</span></span> <span data-ttu-id="e140b-204">Кроме того, служба может извлечь изображение из очереди и сразу же сохранить его в удаленном хранилище.</span><span class="sxs-lookup"><span data-stu-id="e140b-204">Alternatively, the service could pull the image out of the queue and immediately store it in a remote store.</span></span> <span data-ttu-id="e140b-205">Это уменьшает объем состояния, которым должна управлять служба, но увеличивает сложность, так как служба должна хранить необходимые метаданные для управления удаленным хранилищем.</span><span class="sxs-lookup"><span data-stu-id="e140b-205">This reduces the amount of state the service has to manage, but increases complexity since the service has to keep the necessary metadata to manage the remote store.</span></span> <span data-ttu-id="e140b-206">В обоих подходах при возникновении сбоя в процессе выполнения запрос остается в очереди, ожидая обработки.</span><span class="sxs-lookup"><span data-stu-id="e140b-206">With either approach, if something failed in the middle the request remains in the queue waiting to be processed.</span></span>

<span data-ttu-id="e140b-207">Следует также отметить, что эта служба выглядит почти как обычная служба .NET.</span><span class="sxs-lookup"><span data-stu-id="e140b-207">One thing to note about this service is that it sounds like a normal .NET service!</span></span> <span data-ttu-id="e140b-208">Единственная разница в том, что используемые структуры данных (`IReliableQueue` и `IReliableDictionary`) предоставляются платформой Service Fabric и для них обеспечивается высокая надежность, доступность и согласованность.</span><span class="sxs-lookup"><span data-stu-id="e140b-208">The only difference is that the data structures being used (`IReliableQueue` and `IReliableDictionary`) are provided by Service Fabric, and are highly reliable, available, and consistent.</span></span>

## <a name="when-to-use-reliable-services-apis"></a><span data-ttu-id="e140b-209">Когда следует использовать API надежных служб</span><span class="sxs-lookup"><span data-stu-id="e140b-209">When to use Reliable Services APIs</span></span>
<span data-ttu-id="e140b-210">Если службе приложения требуется любая из приведенных ниже характеристик, следует рассмотреть возможность использования интерфейсов API надежных служб.</span><span class="sxs-lookup"><span data-stu-id="e140b-210">If any of the following characterize your application service needs, then you should consider Reliable Services APIs:</span></span>

* <span data-ttu-id="e140b-211">Необходима высокая доступность и надежность кода службы (и при необходимости состояния).</span><span class="sxs-lookup"><span data-stu-id="e140b-211">You want your service's code (and optionally state) to be highly available and reliable</span></span>
* <span data-ttu-id="e140b-212">Необходимы гарантии выполнения транзакций между несколькими единицами состояния (например, заказами и позициями строки заказа).</span><span class="sxs-lookup"><span data-stu-id="e140b-212">You need transactional guarantees across multiple units of state (for example, orders and order line items).</span></span>
* <span data-ttu-id="e140b-213">Состояние приложения можно естественным образом моделировать в виде надежных словарей и очередей.</span><span class="sxs-lookup"><span data-stu-id="e140b-213">Your application’s state can be naturally modeled as Reliable Dictionaries and Queues.</span></span>
* <span data-ttu-id="e140b-214">Код или состояние приложения должны иметь высокую доступность с низкой задержкой операций чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="e140b-214">Your applications code or state needs to be highly available with low latency reads and writes.</span></span>
* <span data-ttu-id="e140b-215">Приложению требуется контролировать параллелизм или степень детализации транзакционных операций по одной или нескольким надежным коллекциям.</span><span class="sxs-lookup"><span data-stu-id="e140b-215">Your application needs to control the concurrency or granularity of transacted operations across one or more Reliable Collections.</span></span>
* <span data-ttu-id="e140b-216">Необходимо управлять обменом данными или контролировать схему секционирования службы.</span><span class="sxs-lookup"><span data-stu-id="e140b-216">You want to manage the communications or control the partitioning scheme for your service.</span></span>
* <span data-ttu-id="e140b-217">Коду требуется среда выполнения, работающая в режиме свободного потока.</span><span class="sxs-lookup"><span data-stu-id="e140b-217">Your code needs a free-threaded runtime environment.</span></span>
* <span data-ttu-id="e140b-218">Приложению требуется динамически создавать или уничтожать словари Reliable Dictionary, очереди Reliable Queue или целые службы во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="e140b-218">Your application needs to dynamically create or destroy Reliable Dictionaries or Queues or whole Services at runtime.</span></span>
* <span data-ttu-id="e140b-219">Вам нужно программным способом управлять функциями резервного копирования и восстановления, которые предоставляет платформа Service Fabric и которые относятся к вашей службе.</span><span class="sxs-lookup"><span data-stu-id="e140b-219">You need to programmatically control Service Fabric-provided backup and restore features for your service’s state.</span></span>
* <span data-ttu-id="e140b-220">Приложению необходимо поддерживать историю изменений своих единиц состояния.</span><span class="sxs-lookup"><span data-stu-id="e140b-220">Your application needs to maintain change history for its units of state.</span></span>
* <span data-ttu-id="e140b-221">Вам нужно разработать свои настраиваемые поставщики состояний или использовать сторонние.</span><span class="sxs-lookup"><span data-stu-id="e140b-221">You want to develop or consume third-party-developed, custom state providers.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e140b-222">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="e140b-222">Next steps</span></span>
* [<span data-ttu-id="e140b-223">Краткое руководство по надежным службам Reliable Services</span><span class="sxs-lookup"><span data-stu-id="e140b-223">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
* [<span data-ttu-id="e140b-224">Продвинутое использование надежных служб</span><span class="sxs-lookup"><span data-stu-id="e140b-224">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)
* [<span data-ttu-id="e140b-225">Модель программирования надежных субъектов</span><span class="sxs-lookup"><span data-stu-id="e140b-225">The Reliable Actors programming model</span></span>](service-fabric-reliable-actors-introduction.md)
