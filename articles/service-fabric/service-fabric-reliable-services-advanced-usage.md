---
title: "Использование надежного обмена aaaAdvanced | Документы Microsoft"
description: "Узнайте о расширенном использовании Service Fabric Reliable Services для повышения гибкости служб."
services: Service-Fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: masnider
ms.assetid: f2942871-863d-47c3-b14a-7cdad9a742c7
ms.service: Service-Fabric
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: e6d6310a4deae9edcfcd76551e1337f0e39e9e5d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-usage-of-hello-reliable-services-programming-model"></a>Расширенное использование служб hello надежного модели программирования
Приложение Azure Service Fabric упрощает написание надежных служб с отслеживанием или без отслеживания состояния и управление ими. В этом руководстве рассказывается о расширенного использования toogain надежного обмена больше контроля и гибкости по службам. Предыдущий tooreading это руководство, ознакомьтесь с [модель программирования для надежного обмена hello](service-fabric-reliable-services-introduction.md).

Службы с отслеживанием и без отслеживания состояния имеют две основные точки входа для пользовательского кода.

* `RunAsync(C#) / runAsync(Java)` — точка входа общего назначения для кода службы.
* `CreateServiceReplicaListeners(C#)` и `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` служат для открытия прослушивателей связи для клиентских запросов.

Этих двух точек входа достаточно для большинства служб. В редких случаях, когда необходим больший контроль над жизненным циклом службы, можно использовать дополнительные события жизненного цикла.

## <a name="stateless-service-instance-lifecycle"></a>Жизненный цикл экземпляра службы без отслеживания состояния
Жизненный цикл службы без отслеживания состояния очень прост. Службу без отслеживания состояния можно только открыть, закрыть или прервать ее работу. `RunAsync` в службе без отслеживания состояния выполняется при открытии экземпляра службы и отменяется, когда экземпляр службы закрывается или его работа прерывается.

Несмотря на то что `RunAsync` должно быть достаточно в почти во всех случаях Привет открыть, закрыть, а события прерывания в службы без отслеживания состояния, также доступны:

* `Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java`OnOpenAsync вызывается в том случае, если экземпляр службы без отслеживания состояния hello находится о toobe используется. В этот момент можно запустить расширенные задачи инициализации службы.
* `Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java`OnCloseAsync вызывается в том случае, когда экземпляр службы без отслеживания состояния hello будет toobe корректно завершить работу. Это может произойти при обновляется кода hello службы, экземпляр службы hello перемещается из-за tooload балансировки или обнаруживается временных ошибок. OnCloseAsync может быть используется toosafely закрыть все ресурсы, остановить все фоновые задачи, сохранения внешнего состояния или закрыть существующие соединения.
* `void OnAbort() - C# / void onAbort() - Java`OnAbort вызывается в том случае, когда экземпляр службы без отслеживания состояния hello принудительно завершает работу. Обычно это вызывается при обнаружении постоянной ошибкой на узле hello или когда Service Fabric невозможно надежно управлять жизненным циклом экземпляра службы hello из-за сбоев toointernal.

## <a name="stateful-service-replica-lifecycle"></a>Жизненный цикл реплики службы с отслеживанием состояния

> [!NOTE]
> Сейчас Java не поддерживает службы Reliable Services с отслеживанием состояния.
>
>

Жизненный цикл реплики службы с отслеживанием состояния намного сложнее, чем экземпляра службы без отслеживания состояния. В дополнение к этому tooopen, закрыть и прервать события, реплики с отслеживанием состояния службы роли изменяется во время существования. При изменении роли реплики службы с отслеживанием состояния hello `OnChangeRoleAsync` события:

* `Task OnChangeRoleAsync(ReplicaRole, CancellationToken)`OnChangeRoleAsync вызывается при изменении роли, например tooprimary или вторичной реплики с отслеживанием состояния службы hello. Первичные реплики, получают статус записи (допускаются toocreate и записать tooReliable коллекций). а дополнительным — статус чтения (могут только читать из существующих надежных коллекций). Большинство работа с отслеживанием состояния службы выполняется на первичной реплике hello. Вторичные реплики могут выполнять проверку, предусматривающую только чтение, создавать отчеты, выполнять интеллектуальный анализ данных, а также другие задания, доступные только для чтения.

В службы с отслеживанием состояния только первичная реплика hello имеет доступ на запись toostate и таким образом обычно является при hello служба выполняет фактическую работу. Hello `RunAsync` метод в службы с отслеживанием состояния выполняется только в том случае, если основной реплики службы с отслеживанием состояния hello. Hello `RunAsync` метод отменяется при отмене изменений в роли первичной реплики от основной, а также при hello закрыть и прервать события.

С помощью hello `OnChangeRoleAsync` событий позволяет tooperform работы в зависимости от роли реплики, также как и изменение toorole отклика.

Службы с отслеживанием состояния также предоставляет события жизненного цикла hello же четырех как служба без сохранения состояния, с hello совпадает с семантикой и вариантов использования:

```csharp
* Task OnOpenAsync(IStatefulServicePartition, CancellationToken)
* Task OnCloseAsync(CancellationToken)
* void OnAbort()
```

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные разделы связанные tooService структуры см. следующие статьи hello:

* [Настройка надежных служб с отслеживанием состояния](service-fabric-reliable-services-configuration.md)
* [Общие сведения о работоспособности Service Fabric](service-fabric-health-introduction.md)
* [Использование отчетов о работоспособности системы для устранения неполадок](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)
* [Настройка служб с помощью hello диспетчер ресурсов кластера Service Fabric](service-fabric-cluster-resource-manager-configure-services.md)
