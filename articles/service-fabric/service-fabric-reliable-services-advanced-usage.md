---
title: "Использование надежного обмена aaaAdvanced | Документы Microsoft"
description: "Узнайте о расширенном использовании Service Fabric Reliable Services для повышения гибкости служб."
services: Service-Fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: masnider
ms.assetid: f2942871-863d-47c3-b14a-7cdad9a742c7
ms.service: Service-Fabric
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: e6d6310a4deae9edcfcd76551e1337f0e39e9e5d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-usage-of-hello-reliable-services-programming-model"></a><span data-ttu-id="28a74-103">Расширенное использование служб hello надежного модели программирования</span><span class="sxs-lookup"><span data-stu-id="28a74-103">Advanced usage of hello Reliable Services programming model</span></span>
<span data-ttu-id="28a74-104">Приложение Azure Service Fabric упрощает написание надежных служб с отслеживанием или без отслеживания состояния и управление ими.</span><span class="sxs-lookup"><span data-stu-id="28a74-104">Azure Service Fabric simplifies writing and managing reliable stateless and stateful services.</span></span> <span data-ttu-id="28a74-105">В этом руководстве рассказывается о расширенного использования toogain надежного обмена больше контроля и гибкости по службам.</span><span class="sxs-lookup"><span data-stu-id="28a74-105">This guide talks about advanced usages of Reliable Services toogain more control and flexibility over your services.</span></span> <span data-ttu-id="28a74-106">Предыдущий tooreading это руководство, ознакомьтесь с [модель программирования для надежного обмена hello](service-fabric-reliable-services-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="28a74-106">Prior tooreading this guide, familiarize yourself with [hello Reliable Services programming model](service-fabric-reliable-services-introduction.md).</span></span>

<span data-ttu-id="28a74-107">Службы с отслеживанием и без отслеживания состояния имеют две основные точки входа для пользовательского кода.</span><span class="sxs-lookup"><span data-stu-id="28a74-107">Both stateful and stateless services have two primary entry points for user code:</span></span>

* <span data-ttu-id="28a74-108">`RunAsync(C#) / runAsync(Java)` — точка входа общего назначения для кода службы.</span><span class="sxs-lookup"><span data-stu-id="28a74-108">`RunAsync(C#) / runAsync(Java)` is a general-purpose entry point for your service code.</span></span>
* <span data-ttu-id="28a74-109">`CreateServiceReplicaListeners(C#)` и `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` служат для открытия прослушивателей связи для клиентских запросов.</span><span class="sxs-lookup"><span data-stu-id="28a74-109">`CreateServiceReplicaListeners(C#)` and `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` is for opening communication listeners for client requests.</span></span>

<span data-ttu-id="28a74-110">Этих двух точек входа достаточно для большинства служб.</span><span class="sxs-lookup"><span data-stu-id="28a74-110">For most services, these two entry points are sufficient.</span></span> <span data-ttu-id="28a74-111">В редких случаях, когда необходим больший контроль над жизненным циклом службы, можно использовать дополнительные события жизненного цикла.</span><span class="sxs-lookup"><span data-stu-id="28a74-111">In rare cases when more control over a service's lifecycle is required, additional lifecycle events are available.</span></span>

## <a name="stateless-service-instance-lifecycle"></a><span data-ttu-id="28a74-112">Жизненный цикл экземпляра службы без отслеживания состояния</span><span class="sxs-lookup"><span data-stu-id="28a74-112">Stateless service instance lifecycle</span></span>
<span data-ttu-id="28a74-113">Жизненный цикл службы без отслеживания состояния очень прост.</span><span class="sxs-lookup"><span data-stu-id="28a74-113">A stateless service's lifecycle is very simple.</span></span> <span data-ttu-id="28a74-114">Службу без отслеживания состояния можно только открыть, закрыть или прервать ее работу.</span><span class="sxs-lookup"><span data-stu-id="28a74-114">A stateless service can only be opened, closed, or aborted.</span></span> <span data-ttu-id="28a74-115">`RunAsync` в службе без отслеживания состояния выполняется при открытии экземпляра службы и отменяется, когда экземпляр службы закрывается или его работа прерывается.</span><span class="sxs-lookup"><span data-stu-id="28a74-115">`RunAsync` in a stateless service is executed when a service instance is opened, and canceled when a service instance is closed or aborted.</span></span>

<span data-ttu-id="28a74-116">Несмотря на то что `RunAsync` должно быть достаточно в почти во всех случаях Привет открыть, закрыть, а события прерывания в службы без отслеживания состояния, также доступны:</span><span class="sxs-lookup"><span data-stu-id="28a74-116">Although `RunAsync` should be sufficient in almost all cases, hello open, close, and abort events in a stateless service are also available:</span></span>

* <span data-ttu-id="28a74-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java`OnOpenAsync вызывается в том случае, если экземпляр службы без отслеживания состояния hello находится о toobe используется.</span><span class="sxs-lookup"><span data-stu-id="28a74-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java` OnOpenAsync is called when hello stateless service instance is about toobe used.</span></span> <span data-ttu-id="28a74-118">В этот момент можно запустить расширенные задачи инициализации службы.</span><span class="sxs-lookup"><span data-stu-id="28a74-118">Extended service initialization tasks can be started at this time.</span></span>
* <span data-ttu-id="28a74-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java`OnCloseAsync вызывается в том случае, когда экземпляр службы без отслеживания состояния hello будет toobe корректно завершить работу.</span><span class="sxs-lookup"><span data-stu-id="28a74-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java` OnCloseAsync is called when hello stateless service instance is going toobe gracefully shut down.</span></span> <span data-ttu-id="28a74-120">Это может произойти при обновляется кода hello службы, экземпляр службы hello перемещается из-за tooload балансировки или обнаруживается временных ошибок.</span><span class="sxs-lookup"><span data-stu-id="28a74-120">This can occur when hello service's code is being upgraded, hello service instance is being moved due tooload balancing, or a transient fault is detected.</span></span> <span data-ttu-id="28a74-121">OnCloseAsync может быть используется toosafely закрыть все ресурсы, остановить все фоновые задачи, сохранения внешнего состояния или закрыть существующие соединения.</span><span class="sxs-lookup"><span data-stu-id="28a74-121">OnCloseAsync can be used toosafely close any resources, stop any background processing, finish saving external state, or close down existing connections.</span></span>
* <span data-ttu-id="28a74-122">`void OnAbort() - C# / void onAbort() - Java`OnAbort вызывается в том случае, когда экземпляр службы без отслеживания состояния hello принудительно завершает работу.</span><span class="sxs-lookup"><span data-stu-id="28a74-122">`void OnAbort() - C# / void onAbort() - Java` OnAbort is called when hello stateless service instance is being forcefully shut down.</span></span> <span data-ttu-id="28a74-123">Обычно это вызывается при обнаружении постоянной ошибкой на узле hello или когда Service Fabric невозможно надежно управлять жизненным циклом экземпляра службы hello из-за сбоев toointernal.</span><span class="sxs-lookup"><span data-stu-id="28a74-123">This is generally called when a permanent fault is detected on hello node, or when Service Fabric cannot reliably manage hello service instance's lifecycle due toointernal failures.</span></span>

## <a name="stateful-service-replica-lifecycle"></a><span data-ttu-id="28a74-124">Жизненный цикл реплики службы с отслеживанием состояния</span><span class="sxs-lookup"><span data-stu-id="28a74-124">Stateful service replica lifecycle</span></span>

> [!NOTE]
> <span data-ttu-id="28a74-125">Сейчас Java не поддерживает службы Reliable Services с отслеживанием состояния.</span><span class="sxs-lookup"><span data-stu-id="28a74-125">Stateful reliable services are not supported in Java yet.</span></span>
>
>

<span data-ttu-id="28a74-126">Жизненный цикл реплики службы с отслеживанием состояния намного сложнее, чем экземпляра службы без отслеживания состояния.</span><span class="sxs-lookup"><span data-stu-id="28a74-126">A stateful service replica's lifecycle is much more complex than a stateless service instance.</span></span> <span data-ttu-id="28a74-127">В дополнение к этому tooopen, закрыть и прервать события, реплики с отслеживанием состояния службы роли изменяется во время существования.</span><span class="sxs-lookup"><span data-stu-id="28a74-127">In addition tooopen, close, and abort events, a stateful service replica undergoes role changes during its lifetime.</span></span> <span data-ttu-id="28a74-128">При изменении роли реплики службы с отслеживанием состояния hello `OnChangeRoleAsync` события:</span><span class="sxs-lookup"><span data-stu-id="28a74-128">When a stateful service replica changes role, hello `OnChangeRoleAsync` event is triggered:</span></span>

* <span data-ttu-id="28a74-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)`OnChangeRoleAsync вызывается при изменении роли, например tooprimary или вторичной реплики с отслеживанием состояния службы hello.</span><span class="sxs-lookup"><span data-stu-id="28a74-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)` OnChangeRoleAsync is called when hello stateful service replica is changing role, for example tooprimary or secondary.</span></span> <span data-ttu-id="28a74-130">Первичные реплики, получают статус записи (допускаются toocreate и записать tooReliable коллекций).</span><span class="sxs-lookup"><span data-stu-id="28a74-130">Primary replicas are given write status (are allowed toocreate and write tooReliable Collections).</span></span> <span data-ttu-id="28a74-131">а дополнительным — статус чтения (могут только читать из существующих надежных коллекций).</span><span class="sxs-lookup"><span data-stu-id="28a74-131">Secondary replicas are given read status (can only read from existing Reliable Collections).</span></span> <span data-ttu-id="28a74-132">Большинство работа с отслеживанием состояния службы выполняется на первичной реплике hello.</span><span class="sxs-lookup"><span data-stu-id="28a74-132">Most work in a stateful service is performed at hello primary replica.</span></span> <span data-ttu-id="28a74-133">Вторичные реплики могут выполнять проверку, предусматривающую только чтение, создавать отчеты, выполнять интеллектуальный анализ данных, а также другие задания, доступные только для чтения.</span><span class="sxs-lookup"><span data-stu-id="28a74-133">Secondary replicas can perform read-only validation, report generation, data mining, or other read-only jobs.</span></span>

<span data-ttu-id="28a74-134">В службы с отслеживанием состояния только первичная реплика hello имеет доступ на запись toostate и таким образом обычно является при hello служба выполняет фактическую работу.</span><span class="sxs-lookup"><span data-stu-id="28a74-134">In a stateful service, only hello primary replica has write access toostate and thus is generally when hello service is performing actual work.</span></span> <span data-ttu-id="28a74-135">Hello `RunAsync` метод в службы с отслеживанием состояния выполняется только в том случае, если основной реплики службы с отслеживанием состояния hello.</span><span class="sxs-lookup"><span data-stu-id="28a74-135">hello `RunAsync` method in a stateful service is executed only when hello stateful service replica is primary.</span></span> <span data-ttu-id="28a74-136">Hello `RunAsync` метод отменяется при отмене изменений в роли первичной реплики от основной, а также при hello закрыть и прервать события.</span><span class="sxs-lookup"><span data-stu-id="28a74-136">hello `RunAsync` method is canceled when a primary replica's role changes away from primary, as well as during hello close and abort events.</span></span>

<span data-ttu-id="28a74-137">С помощью hello `OnChangeRoleAsync` событий позволяет tooperform работы в зависимости от роли реплики, также как и изменение toorole отклика.</span><span class="sxs-lookup"><span data-stu-id="28a74-137">Using hello `OnChangeRoleAsync` event allows you tooperform work depending on replica role as well as in response toorole change.</span></span>

<span data-ttu-id="28a74-138">Службы с отслеживанием состояния также предоставляет события жизненного цикла hello же четырех как служба без сохранения состояния, с hello совпадает с семантикой и вариантов использования:</span><span class="sxs-lookup"><span data-stu-id="28a74-138">A stateful service also provides hello same four lifecycle events as a stateless service, with hello same semantics and use cases:</span></span>

```csharp
* Task OnOpenAsync(IStatefulServicePartition, CancellationToken)
* Task OnCloseAsync(CancellationToken)
* void OnAbort()
```

## <a name="next-steps"></a><span data-ttu-id="28a74-139">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="28a74-139">Next steps</span></span>
<span data-ttu-id="28a74-140">Дополнительные разделы связанные tooService структуры см. следующие статьи hello:</span><span class="sxs-lookup"><span data-stu-id="28a74-140">For more advanced topics related tooService Fabric, see hello following articles:</span></span>

* [<span data-ttu-id="28a74-141">Настройка надежных служб с отслеживанием состояния</span><span class="sxs-lookup"><span data-stu-id="28a74-141">Configuring stateful Reliable Services</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="28a74-142">Общие сведения о работоспособности Service Fabric</span><span class="sxs-lookup"><span data-stu-id="28a74-142">Service Fabric health introduction</span></span>](service-fabric-health-introduction.md)
* [<span data-ttu-id="28a74-143">Использование отчетов о работоспособности системы для устранения неполадок</span><span class="sxs-lookup"><span data-stu-id="28a74-143">Using system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)
* [<span data-ttu-id="28a74-144">Настройка служб с помощью hello диспетчер ресурсов кластера Service Fabric</span><span class="sxs-lookup"><span data-stu-id="28a74-144">Configuring Services with hello Service Fabric Cluster Resource Manager</span></span>](service-fabric-cluster-resource-manager-configure-services.md)
