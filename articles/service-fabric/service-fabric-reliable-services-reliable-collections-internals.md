---
title: "Внутренние компоненты диспетчера надежных состояний и надежных коллекций Azure Service Fabric | Документы Майкрософт"
description: "Углубленное рассмотрение концепции и проектирования надежных коллекций в Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: d607449a16e886337ab1bd96213fbb4231124353
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="azure-service-fabric-reliable-state-manager-and-reliable-collection-internals"></a>Внутренние компоненты диспетчера надежных состояний и надежных коллекций Azure Service Fabric
В этом документе рассматриваются диспетчер надежных состояний Reliable State Manager и надежные коллекции Reliable Collections и принципы работы их основных компонентов.

> [!NOTE]
> Этот документ находится на стадии разработки. Добавьте комментарии к этой статье, чтобы сообщить нам, какие темы требуется рассмотреть более подробно.
>

##  <a name="local-persistence-model-log-and-checkpoint"></a>Модель локальной сохраняемости: журнал и контрольная точка
Диспетчер надежных состояний и надежные коллекции используют модель сохраняемости под названием "Журнал и контрольная точка".
В этой модели каждое изменение состояния сначала регистрируется на диске, а затем применяется в памяти.
Полное состояние сохраняется только время от времени (создается контрольная точка).
Преимущество этого состоит в том, что изменения преобразуются в операции записи на диск, которые добавляют только недостающие данные, что позволяет повысить производительность.

Чтобы лучше понять модель журнала и контрольной точки, давайте сначала рассмотрим гипотетическую ситуацию с диском неограниченного объема.
Диспетчер надежных состояний заносит в журнал каждую операцию, прежде чем она реплицируется.
Ведение журнала позволяет надежной коллекции применять операцию только в памяти.
Поскольку журналы сохраняются, даже если произошел сбой реплики и ее необходимо перезапустить, диспетчер надежных состояний имеет достаточно сведений в журналах, чтобы воспроизвести все операции, которые потеряла реплика.
Так как место на диске бесконечно, записи журналов никогда не удаляются, а надежная коллекция управляет только состоянием в памяти.

Теперь рассмотрим ситуацию, когда место на диске ограничено.
Ввиду накопления записей журнала у диспетчера надежных состояний может закончиться доступное дисковое пространство.
Но пока это не произошло, диспетчеру нужно удалить из журнала часть записей, чтобы освободить место для новых записей.
Диспетчер запрашивает в надежных коллекциях создание контрольной точки их состояния в памяти на диске.
На этом этапе надежные коллекции сохраняют свое состояние в памяти.
Когда надежная коллекция создаст контрольную точку, диспетчер надежных состояний сможет удалить из журнала часть записей и освободить место на диске.
Когда возникнет необходимость перезапустить реплику, надежные коллекции смогут восстановить свое состояние из контрольной точки, а диспетчер надежных состояний — восстановить и воспроизвести все изменения состояния, которые произошли после создания контрольной точки.

Еще одно преимущество создания контрольных точек состоит в том, что в типичных сценариях они сокращают время восстановления. Журнал содержит все операции, которые произошли с момента создания последней контрольной точки.
Поэтому он может включать несколько версий элемента, например несколько значений для конкретной строки в надежном словаре.
Напротив, контрольные точки надежной коллекции сохраняют только последнюю версию каждого значения для ключа.

## <a name="next-steps"></a>Дальнейшие действия
* [Транзакции и блокировки](service-fabric-reliable-services-reliable-collections-transactions-locks.md)

