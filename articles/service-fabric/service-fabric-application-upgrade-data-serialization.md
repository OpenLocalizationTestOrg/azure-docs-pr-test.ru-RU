---
title: "Обновление приложений: сериализация данных | Документация Майкрософт"
description: "Лучшие методики для сериализации данных и ее влияние на последовательные обновления приложений."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: a5f36366-a2ab-4ae3-bb08-bc2f9533bc5a
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 1b65dfd3813423550631490640a81953864f58e3
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-data-serialization-affects-an-application-upgrade"></a><span data-ttu-id="f11a5-103">Влияние сериализации данных на обновление приложений</span><span class="sxs-lookup"><span data-stu-id="f11a5-103">How data serialization affects an application upgrade</span></span>
<span data-ttu-id="f11a5-104">В [пошаговое обновление приложения](service-fabric-application-upgrade.md), hello обновление будет применен tooa подмножество узлов, один домен обновления одновременно.</span><span class="sxs-lookup"><span data-stu-id="f11a5-104">In a [rolling application upgrade](service-fabric-application-upgrade.md), hello upgrade is applied tooa subset of nodes, one upgrade domain at a time.</span></span> <span data-ttu-id="f11a5-105">Во время этого процесса являются некоторых доменов обновления в новой версии приложения hello и некоторых доменов обновления являются более старую версию приложения hello.</span><span class="sxs-lookup"><span data-stu-id="f11a5-105">During this process, some upgrade domains are on hello newer version of your application, and some upgrade domains are on hello older version of your application.</span></span> <span data-ttu-id="f11a5-106">Во время этого этапа hello hello новой версии приложения должен быть доступ tooread hello старой версии данных и hello старой версии приложения должен быть доступ tooread hello новая версия данных.</span><span class="sxs-lookup"><span data-stu-id="f11a5-106">During hello rollout, hello new version of your application must be able tooread hello old version of your data, and hello old version of your application must be able tooread hello new version of your data.</span></span> <span data-ttu-id="f11a5-107">Если формат данных hello не является несовместимым, hello обновлением вперед и назад может сбой, или в худшем случае данные могут теряются и поврежден.</span><span class="sxs-lookup"><span data-stu-id="f11a5-107">If hello data format is not forward and backward compatible, hello upgrade may fail, or worse, data may be lost or corrupted.</span></span> <span data-ttu-id="f11a5-108">В этой статье обсуждаются составляющие формата данных, а также передовой опыт в обеспечении прямой и обратной совместимости данных.</span><span class="sxs-lookup"><span data-stu-id="f11a5-108">This article discusses what constitutes your data format and offers best practices for ensuring that your data is forward and backward compatible.</span></span>

## <a name="what-makes-up-your-data-format"></a><span data-ttu-id="f11a5-109">Что составляет ваш формат данных?</span><span class="sxs-lookup"><span data-stu-id="f11a5-109">What makes up your data format?</span></span>
<span data-ttu-id="f11a5-110">В Azure Service Fabric hello данные, которые сохраняются и реплицируются поступают из классов C#.</span><span class="sxs-lookup"><span data-stu-id="f11a5-110">In Azure Service Fabric, hello data that is persisted and replicated comes from your C# classes.</span></span> <span data-ttu-id="f11a5-111">Для приложений, использующих [надежного коллекции](service-fabric-reliable-services-reliable-collections.md), что данные, объекты hello надежного словари hello и очередей.</span><span class="sxs-lookup"><span data-stu-id="f11a5-111">For applications that use [Reliable Collections](service-fabric-reliable-services-reliable-collections.md), that data is hello objects in hello reliable dictionaries and queues.</span></span> <span data-ttu-id="f11a5-112">Для приложений, использующих [службы Reliable Actor](service-fabric-reliable-actors-introduction.md), то есть hello резервном состоянии для субъекта hello.</span><span class="sxs-lookup"><span data-stu-id="f11a5-112">For applications that use [Reliable Actors](service-fabric-reliable-actors-introduction.md), that is hello backing state for hello actor.</span></span> <span data-ttu-id="f11a5-113">Эти классы C#, должны быть сериализуемыми toobe сохранение и репликацию.</span><span class="sxs-lookup"><span data-stu-id="f11a5-113">These C# classes must be serializable toobe persisted and replicated.</span></span> <span data-ttu-id="f11a5-114">Таким образом hello формат данных определяется hello поля и свойства, которые сериализуются, а также как они сериализуются.</span><span class="sxs-lookup"><span data-stu-id="f11a5-114">Therefore, hello data format is defined by hello fields and properties that are serialized, as well as how they are serialized.</span></span> <span data-ttu-id="f11a5-115">Например, в `IReliableDictionary<int, MyClass>` hello данных является сериализованный `int` и сериализованный `MyClass`.</span><span class="sxs-lookup"><span data-stu-id="f11a5-115">For example, in an `IReliableDictionary<int, MyClass>` hello data is a serialized `int` and a serialized `MyClass`.</span></span>

### <a name="code-changes-that-result-in-a-data-format-change"></a><span data-ttu-id="f11a5-116">Изменения кода, вызывающие изменение формата данных</span><span class="sxs-lookup"><span data-stu-id="f11a5-116">Code changes that result in a data format change</span></span>
<span data-ttu-id="f11a5-117">Так как формат данных hello зависит от классов C#, классы toohello изменения может вызвать изменение формата данных.</span><span class="sxs-lookup"><span data-stu-id="f11a5-117">Since hello data format is determined by C# classes, changes toohello classes may cause a data format change.</span></span> <span data-ttu-id="f11a5-118">Следует соблюдать осторожность tooensure, который может обработать последовательного обновления измените формат данных hello.</span><span class="sxs-lookup"><span data-stu-id="f11a5-118">Care must be taken tooensure that a rolling upgrade can handle hello data format change.</span></span> <span data-ttu-id="f11a5-119">Примеры, которые могут вызвать изменения формата данных:</span><span class="sxs-lookup"><span data-stu-id="f11a5-119">Examples that may cause data format changes:</span></span>

* <span data-ttu-id="f11a5-120">Добавление или удаление полей или свойств</span><span class="sxs-lookup"><span data-stu-id="f11a5-120">Adding or removing fields or properties</span></span>
* <span data-ttu-id="f11a5-121">Переименование полей или свойств</span><span class="sxs-lookup"><span data-stu-id="f11a5-121">Renaming fields or properties</span></span>
* <span data-ttu-id="f11a5-122">Изменение типов полей или свойств hello</span><span class="sxs-lookup"><span data-stu-id="f11a5-122">Changing hello types of fields or properties</span></span>
* <span data-ttu-id="f11a5-123">Изменение hello имя класса или пространства имен</span><span class="sxs-lookup"><span data-stu-id="f11a5-123">Changing hello class name or namespace</span></span>

### <a name="data-contract-as-hello-default-serializer"></a><span data-ttu-id="f11a5-124">Контракт данных, как сериализатор по умолчанию hello</span><span class="sxs-lookup"><span data-stu-id="f11a5-124">Data Contract as hello default serializer</span></span>
<span data-ttu-id="f11a5-125">Hello сериализатор отвечает обычно для чтения данных hello и десериализации его в текущей версии hello, даже если данные hello в более старой версии или *новой* версии.</span><span class="sxs-lookup"><span data-stu-id="f11a5-125">hello serializer is generally responsible for reading hello data and deserializing it into hello current version, even if hello data is in an older or *newer* version.</span></span> <span data-ttu-id="f11a5-126">Hello сериализатор по умолчанию — hello [сериализатор контрактов данных](https://msdn.microsoft.com/library/ms733127.aspx), имеющий управление версиями четко определенных правил.</span><span class="sxs-lookup"><span data-stu-id="f11a5-126">hello default serializer is hello [Data Contract serializer](https://msdn.microsoft.com/library/ms733127.aspx), which has well-defined versioning rules.</span></span> <span data-ttu-id="f11a5-127">Надежные коллекции позволяют переопределить toobe сериализатор hello, а службы Reliable Actor в настоящее время нет.</span><span class="sxs-lookup"><span data-stu-id="f11a5-127">Reliable Collections allow hello serializer toobe overridden, but Reliable Actors currently do not.</span></span> <span data-ttu-id="f11a5-128">сериализатор данных Hello играет важную роль в обеспечении последовательное обновление.</span><span class="sxs-lookup"><span data-stu-id="f11a5-128">hello data serializer plays an important role in enabling rolling upgrades.</span></span> <span data-ttu-id="f11a5-129">сериализатор контракта данных Hello — hello сериализатор, который рекомендуется использовать для приложения Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="f11a5-129">hello Data Contract serializer is hello serializer that we recommend for Service Fabric applications.</span></span>

## <a name="how-hello-data-format-affects-a-rolling-upgrade"></a><span data-ttu-id="f11a5-130">Влияние формата данных hello последовательного обновления</span><span class="sxs-lookup"><span data-stu-id="f11a5-130">How hello data format affects a rolling upgrade</span></span>
<span data-ttu-id="f11a5-131">Во время обновления существует два основных сценария, где могут возникнуть более старой версии сериализатор hello или *новой* версии данных:</span><span class="sxs-lookup"><span data-stu-id="f11a5-131">During a rolling upgrade, there are two main scenarios where hello serializer may encounter an older or *newer* version of your data:</span></span>

1. <span data-ttu-id="f11a5-132">После узла обновляется и начинает резервное копирование, новый сериализатор hello загрузит hello данные, которые были сохраненного toodisk hello старой версии.</span><span class="sxs-lookup"><span data-stu-id="f11a5-132">After a node is upgraded and starts back up, hello new serializer will load hello data that was persisted toodisk by hello old version.</span></span>
2. <span data-ttu-id="f11a5-133">Во время обновления hello hello кластера будут содержать как hello старых и новых версий кода.</span><span class="sxs-lookup"><span data-stu-id="f11a5-133">During hello rolling upgrade, hello cluster will contain a mix of hello old and new versions of your code.</span></span> <span data-ttu-id="f11a5-134">Поскольку реплик, которые могут быть помещены в разные домены обновления, а реплики отправляют данные tooeach других, hello новые и старые версии данных могли быть обнаружены hello новые и старые версии преобразователя.</span><span class="sxs-lookup"><span data-stu-id="f11a5-134">Since replicas may be placed in different upgrade domains, and replicas send data tooeach other, hello new and/or old version of your data may be encountered by hello new and/or old version of your serializer.</span></span>

> [!NOTE]
> <span data-ttu-id="f11a5-135">Здравствуйте, «новая версия» и «старая версия» см. Здесь toohello версии кода, на котором выполняется.</span><span class="sxs-lookup"><span data-stu-id="f11a5-135">hello "new version" and "old version" here refer toohello version of your code that is running.</span></span> <span data-ttu-id="f11a5-136">«новый сериализатор» Hello ссылается toohello сериализатор код, выполняемый в новой версии приложения hello.</span><span class="sxs-lookup"><span data-stu-id="f11a5-136">hello "new serializer" refers toohello serializer code that is executing in hello new version of your application.</span></span> <span data-ttu-id="f11a5-137">Hello «новые данные» обозначает toohello сериализации класса C# hello новой версии приложения.</span><span class="sxs-lookup"><span data-stu-id="f11a5-137">hello "new data" refers toohello serialized C# class from hello new version of your application.</span></span>
> 
> 

<span data-ttu-id="f11a5-138">две версии кода Hello и формат данных должен быть вперед и назад совместимы.</span><span class="sxs-lookup"><span data-stu-id="f11a5-138">hello two versions of code and data format must be both forward and backward compatible.</span></span> <span data-ttu-id="f11a5-139">Если они не совместимы, hello последовательное обновление может завершиться ошибкой или могут быть потеряны данные.</span><span class="sxs-lookup"><span data-stu-id="f11a5-139">If they are not compatible, hello rolling upgrade may fail or data may be lost.</span></span> <span data-ttu-id="f11a5-140">Hello последовательное обновление может завершиться ошибкой, так как код hello или сериализатора может вызвать исключения или ошибки при обнаружении hello другие версии.</span><span class="sxs-lookup"><span data-stu-id="f11a5-140">hello rolling upgrade may fail because hello code or serializer may throw exceptions or a fault when it encounters hello other version.</span></span> <span data-ttu-id="f11a5-141">Данные могут быть потеряны, если, например, было добавлено новое свойство, но старые сериализатор hello отвергает его во время десериализации.</span><span class="sxs-lookup"><span data-stu-id="f11a5-141">Data may be lost if, for example, a new property was added but hello old serializer discards it during deserialization.</span></span>

<span data-ttu-id="f11a5-142">Контракт данных — hello, рекомендуется использовать решение для обеспечения того, что данные будут совместимы.</span><span class="sxs-lookup"><span data-stu-id="f11a5-142">Data Contract is hello recommended solution for ensuring that your data is compatible.</span></span> <span data-ttu-id="f11a5-143">Он обладает строго заданными правилами управления версиями при добавлении, удалении или изменении полей.</span><span class="sxs-lookup"><span data-stu-id="f11a5-143">It has well-defined versioning rules for adding, removing, and changing fields.</span></span> <span data-ttu-id="f11a5-144">Имеется также поддержка работа с полями неизвестный, прикрепления процесс сериализации и десериализации hello и работе с наследованием класса.</span><span class="sxs-lookup"><span data-stu-id="f11a5-144">It also has support for dealing with unknown fields, hooking into hello serialization and deserialization process, and dealing with class inheritance.</span></span> <span data-ttu-id="f11a5-145">Дополнительные сведения см. в разделе [Использование контракта данных](https://msdn.microsoft.com/library/ms733127.aspx).</span><span class="sxs-lookup"><span data-stu-id="f11a5-145">For more information, see [Using Data Contract](https://msdn.microsoft.com/library/ms733127.aspx).</span></span>

## <a name="next-steps"></a><span data-ttu-id="f11a5-146">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="f11a5-146">Next steps</span></span>
<span data-ttu-id="f11a5-147">[Руководство по обновлению приложений Service Fabric с помощью Visual Studio](service-fabric-application-upgrade-tutorial.md) поможет вам выполнить поэтапное обновление приложения с помощью Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f11a5-147">[Upgrading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="f11a5-148">[Обновление приложения с помощью PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) поможет вам выполнить обновление приложения с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f11a5-148">[Upgrading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="f11a5-149">Управление обновлениями приложения осуществляется с помощью [параметров обновления](service-fabric-application-upgrade-parameters.md).</span><span class="sxs-lookup"><span data-stu-id="f11a5-149">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="f11a5-150">Узнайте, как toouse расширенные функции при обновлении приложения с помощью ссылки слишком[дополнительные разделы](service-fabric-application-upgrade-advanced.md).</span><span class="sxs-lookup"><span data-stu-id="f11a5-150">Learn how toouse advanced functionality while upgrading your application by referring too[Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="f11a5-151">Исправьте распространенных проблем в обновлений приложений с помощью ссылки действия toohello в [Устранение неполадок обновлений приложений ](service-fabric-application-upgrade-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="f11a5-151">Fix common problems in application upgrades by referring toohello steps in [Troubleshooting Application Upgrades ](service-fabric-application-upgrade-troubleshooting.md).</span></span>

