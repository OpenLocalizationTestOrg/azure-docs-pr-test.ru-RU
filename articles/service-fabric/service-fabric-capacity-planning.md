---
title: "Планирование емкости для приложений Service Fabric | Документация Майкрософт"
description: "Описание процедуры определения количество вычислительных узлов, необходимых для приложения Service Fabric."
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: markfuss
editor: 
ms.assetid: 9fa47be0-50a2-4a51-84a5-20992af94bea
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: fc98bdd8b3597810b0c07563af507e93c611f769
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="capacity-planning-for-service-fabric-applications"></a><span data-ttu-id="efb44-103">Планирование емкости для приложений Service Fabric</span><span class="sxs-lookup"><span data-stu-id="efb44-103">Capacity planning for Service Fabric applications</span></span>
<span data-ttu-id="efb44-104">В этом документе содержатся сведения об определении объема ресурсов (ЦП, ОЗУ, дискового хранилища), необходимых для выполнения приложений Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="efb44-104">This document teaches you how to estimate the amount of resources (CPUs, RAM, disk storage) you need to run your Azure Service Fabric applications.</span></span> <span data-ttu-id="efb44-105">Чаще всего требования к ресурсам со временем меняются.</span><span class="sxs-lookup"><span data-stu-id="efb44-105">It is common for your resource requirements to change over time.</span></span> <span data-ttu-id="efb44-106">Как правило, при разработке или тестировании службы требуется незначительное количество ресурсов. Но при переходе в рабочую среду и росте популярности приложения объем ресурсов возрастает.</span><span class="sxs-lookup"><span data-stu-id="efb44-106">You typically require few resources as you develop/test your service, and then require more resources as you go into production and your application grows in popularity.</span></span> <span data-ttu-id="efb44-107">При проектировании приложения следует рассмотреть требования в долгосрочной перспективе и принять решения, которые позволят масштабировать службу в соответствии с возросшими требованиями клиентов.</span><span class="sxs-lookup"><span data-stu-id="efb44-107">When you design your application, think through the long-term requirements and make choices that allow your service to scale to meet high customer demand.</span></span>

 <span data-ttu-id="efb44-108">Создавая кластер Service Fabric, вы решаете, какого типа виртуальные машины будут входить в его состав.</span><span class="sxs-lookup"><span data-stu-id="efb44-108">When you create a Service Fabric cluster, you decide what kinds of virtual machines (VMs) make up the cluster.</span></span> <span data-ttu-id="efb44-109">Каждая виртуальная машина имеет ограниченный объем ресурсов в виде ЦП (ядра и быстродействие), пропускной способности сети, ОЗУ и дискового пространства.</span><span class="sxs-lookup"><span data-stu-id="efb44-109">Each VM comes with a limited amount of resources in the form of CPUs (cores and speed), network bandwidth, RAM, and disk storage.</span></span> <span data-ttu-id="efb44-110">По мере расширения службы можно выполнить обновление до виртуальных машин с более высоким объемом и/или добавить в кластер дополнительные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="efb44-110">As your service grows over time, you can upgrade to VMs that offer greater resources and/or add more VMs to your cluster.</span></span> <span data-ttu-id="efb44-111">Чтобы решить последнюю задачу, необходимо первоначально так разработать службу, чтобы она смогла поддерживать преимущества новых виртуальных машин, динамически добавляемых в кластер.</span><span class="sxs-lookup"><span data-stu-id="efb44-111">To do the latter, you must architect your service initially so it can take advantage of new VMs that get dynamically added to the cluster.</span></span>

<span data-ttu-id="efb44-112">Некоторые службы управляют слишком малым объемом данных на самих виртуальных машинах либо не управляют вообще ничем.</span><span class="sxs-lookup"><span data-stu-id="efb44-112">Some services manage little to no data on the VMs themselves.</span></span> <span data-ttu-id="efb44-113">Следовательно, при планировании загрузки для этих служб следует главным образом сосредоточиться на производительности, то есть нужно выбрать ЦП виртуальных машин с соответствующим числом ядер и тактовой частотой.</span><span class="sxs-lookup"><span data-stu-id="efb44-113">Therefore, capacity planning for these services should focus primarily on performance, which means selecting the appropriate CPUs (cores and speed) of the VMs.</span></span> <span data-ttu-id="efb44-114">Кроме того, также следует учесть пропускную способность сети, включая частоту передачи данных и объем передаваемых данных.</span><span class="sxs-lookup"><span data-stu-id="efb44-114">In addition, you should consider network bandwidth, including how frequently network transfers are occurring and how much data is being transferred.</span></span> <span data-ttu-id="efb44-115">Если по мере увеличения степени использования функционирование службы должно оставаться на высоком уровне, в кластер можно добавить дополнительные виртуальные машины и обеспечить балансировку сетевых запросов на всех виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="efb44-115">If your service needs to perform well as service usage increases, you can add more VMs to the cluster and load balance the network requests across all the VMs.</span></span>

<span data-ttu-id="efb44-116">При планировании загрузки для служб, управляющих большим объемом данных на виртуальных машинах, особое внимание следует уделить размеру.</span><span class="sxs-lookup"><span data-stu-id="efb44-116">For services that manage large amounts of data on the VMs, capacity planning should focus primarily on size.</span></span> <span data-ttu-id="efb44-117">Поэтому необходимо тщательно обдумать выделение виртуальной машине требуемого объема ОЗУ и дискового пространства.</span><span class="sxs-lookup"><span data-stu-id="efb44-117">Thus, you should carefully consider the capacity of the VM's RAM and disk storage.</span></span> <span data-ttu-id="efb44-118">В системе управления виртуальной памятью Windows дисковое пространство выглядит как ОЗУ в коде приложения.</span><span class="sxs-lookup"><span data-stu-id="efb44-118">The virtual memory management system in Windows makes disk space look like RAM to application code.</span></span> <span data-ttu-id="efb44-119">Кроме того, среда выполнения Service Fabric предоставляет функцию Smart Paging, оставляя в памяти горячие (часто используемые) данные и перемещая холодные (редко используемые) данные на диск.</span><span class="sxs-lookup"><span data-stu-id="efb44-119">In addition, the Service Fabric runtime provides smart paging keeping only hot data in memory and moving the cold data to disk.</span></span> <span data-ttu-id="efb44-120">Это позволяет приложениям использовать больше памяти, чем доступно физически на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="efb44-120">Applications can thus use more memory than is physically available on the VM.</span></span> <span data-ttu-id="efb44-121">Увеличение объема памяти просто приводит к увеличению производительности, так как виртуальная машина может содержать больше дискового пространства в ОЗУ.</span><span class="sxs-lookup"><span data-stu-id="efb44-121">Having more RAM simply increases performance, since the VM can keep more disk storage in RAM.</span></span> <span data-ttu-id="efb44-122">У выбранной виртуальной машины должен быть достаточно большой диск для хранения данных, которые должны размещаться на этой виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="efb44-122">The VM you select should have a disk large enough to store the data that you want on the VM.</span></span> <span data-ttu-id="efb44-123">Аналогично, у виртуальной машины должен быть достаточный объем оперативной памяти для обеспечения нужной вам производительности.</span><span class="sxs-lookup"><span data-stu-id="efb44-123">Similarly, the VM should have enough RAM to provide you with the performance you desire.</span></span> <span data-ttu-id="efb44-124">По мере увеличения объема данных службы в кластер можно добавить дополнительные виртуальные машины и секционировать данные на всех виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="efb44-124">If your service's data grows over time, you can add more VMs to the cluster and partition the data across all the VMs.</span></span>

## <a name="determine-how-many-nodes-you-need"></a><span data-ttu-id="efb44-125">Определение количества необходимых узлов</span><span class="sxs-lookup"><span data-stu-id="efb44-125">Determine how many nodes you need</span></span>
<span data-ttu-id="efb44-126">Секционирование службы позволяет развернуть данные службы.</span><span class="sxs-lookup"><span data-stu-id="efb44-126">Partitioning your service allows you to scale out your service's data.</span></span> <span data-ttu-id="efb44-127">Дополнительные сведения о секционировании см. в статье [Секционирование служб Reliable Services в Service Fabric](service-fabric-concepts-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="efb44-127">For more information on partitioning, see [Partitioning Service Fabric](service-fabric-concepts-partitioning.md).</span></span> <span data-ttu-id="efb44-128">Каждая секция должна помещаться на одной виртуальной машине. Однако на одной виртуальной машине также можно разместить несколько небольших секций.</span><span class="sxs-lookup"><span data-stu-id="efb44-128">Each partition must fit within a single VM, but multiple (small) partitions can be placed on a single VM.</span></span> <span data-ttu-id="efb44-129">Следовательно, наличие большего количества небольших секций обеспечивает большую гибкость, чем небольшое количество более крупных секций.</span><span class="sxs-lookup"><span data-stu-id="efb44-129">So, having more small partitions gives you greater flexibility than having a few larger partitions.</span></span> <span data-ttu-id="efb44-130">Компромисс заключается в том, что значительное количество секций увеличивает нагрузку на платформу Service Fabric, поэтому вы не можете выполнять транзакционные операции между секциями.</span><span class="sxs-lookup"><span data-stu-id="efb44-130">The trade-off is that having lots of partitions increases Service Fabric overhead and you cannot perform transacted operations across partitions.</span></span> <span data-ttu-id="efb44-131">Если коду службы часто требуется доступ к фрагментам данных, расположенным в разных секциях, увеличивается объем потенциального сетевого трафика.</span><span class="sxs-lookup"><span data-stu-id="efb44-131">There is also more potential network traffic if your service code frequently needs to access pieces of data that live in different partitions.</span></span> <span data-ttu-id="efb44-132">При разработке службы следует внимательно рассмотреть эти преимущества и недостатки, чтобы в результате прийти к эффективной стратегии секционирования.</span><span class="sxs-lookup"><span data-stu-id="efb44-132">When designing your service, you should carefully consider these pros and cons to arrive at an effective partitioning strategy.</span></span>

<span data-ttu-id="efb44-133">Предположим, что приложение имеет одну службу с отслеживанием состояния, размер хранилища которой будет предположительно увеличиваться до DB_Size ГБ в год.</span><span class="sxs-lookup"><span data-stu-id="efb44-133">Let's assume your application has a single stateful service that has a store size that you expect to grow to DB_Size GB in a year.</span></span> <span data-ttu-id="efb44-134">Вам нужно добавить несколько приложений (и секций), так как ваше решение за год расширилось.</span><span class="sxs-lookup"><span data-stu-id="efb44-134">You are willing to add more applications (and partitions) as you experience growth beyond that year.</span></span>  <span data-ttu-id="efb44-135">Коэффициент репликации (RF), который определяет число реплик службы, влияющее на итоговое значение DB_Size.</span><span class="sxs-lookup"><span data-stu-id="efb44-135">The replication factor (RF), which determines the number of replicas for your service impacts the total DB_Size.</span></span> <span data-ttu-id="efb44-136">Итоговое значение DB_Size всех реплик равно произведению коэффициента репликации и значения DB_Size.</span><span class="sxs-lookup"><span data-stu-id="efb44-136">The total DB_Size across all replicas is the Replication Factor multiplied by DB_Size.</span></span>  <span data-ttu-id="efb44-137">Значение Node_Size представляет дисковое пространство/ОЗУ для каждого узла, используемого для службы.</span><span class="sxs-lookup"><span data-stu-id="efb44-137">Node_Size represents the disk space/RAM per node you want to use for your service.</span></span> <span data-ttu-id="efb44-138">Для наилучшей производительности значение DB_Size должно соответствовать памяти в кластере, а значение Node_Size — ОЗУ виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="efb44-138">For best performance, the DB_Size should fit into memory across the cluster, and a Node_Size that is around the RAM of the VM should be chosen.</span></span> <span data-ttu-id="efb44-139">Выделяя значение Node_Size, превышающее емкость ОЗУ, вы полагаетесь на функцию подкачки, предоставляемую средой выполнения Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="efb44-139">By allocating a Node_Size that is larger than the RAM capacity, you are relying on the paging provided by the Service Fabric runtime.</span></span> <span data-ttu-id="efb44-140">Поэтому производительность может оказаться неоптимальной, если все данные будут считаться горячими (после подкачки данных).</span><span class="sxs-lookup"><span data-stu-id="efb44-140">Thus, your performance may not be optimal if your entire data is considered to be hot (since then the data is paged in/out).</span></span> <span data-ttu-id="efb44-141">Однако для многих служб, активно использующих только часть данных, этот подход является более экономичным.</span><span class="sxs-lookup"><span data-stu-id="efb44-141">However, for many services where only a fraction of the data is hot, it is more cost-effective.</span></span>

<span data-ttu-id="efb44-142">Количество узлов, необходимое для достижения максимальной производительности, можно вычислить следующим образом.</span><span class="sxs-lookup"><span data-stu-id="efb44-142">The number of nodes required for maximum performance can be computed as follows:</span></span>

```
Number of Nodes = (DB_Size * RF)/Node_Size

```


## <a name="account-for-growth"></a><span data-ttu-id="efb44-143">Действия с учетом расширения службы</span><span class="sxs-lookup"><span data-stu-id="efb44-143">Account for growth</span></span>
<span data-ttu-id="efb44-144">Чтобы вычислить количество узлов, вы можете использовать ожидаемое значение DB_Size для своей службы в дополнение к исходному значению DB_Size.</span><span class="sxs-lookup"><span data-stu-id="efb44-144">You may want to compute the number of nodes based on the DB_Size that you expect your service to grow to, in addition to the DB_Size that you began with.</span></span> <span data-ttu-id="efb44-145">По мере роста службы увеличивайте количество узлов, чтобы избежать их избыточной подготовки.</span><span class="sxs-lookup"><span data-stu-id="efb44-145">Then, grow the number of nodes as your service grows so that you are not over-provisioning the number of nodes.</span></span> <span data-ttu-id="efb44-146">Количество секций должно быть основано на количестве узлов, необходимых для работы службы на максимально эффективном уровне.</span><span class="sxs-lookup"><span data-stu-id="efb44-146">But the number of partitions should be based on the number of nodes that are needed when you're running your service at maximum growth.</span></span>

<span data-ttu-id="efb44-147">Рекомендуется иметь несколько дополнительных виртуальных машин под рукой, чтобы справляться с любыми непредвиденными скачками нагрузки или сбоями (например, при отказе нескольких виртуальных машин).</span><span class="sxs-lookup"><span data-stu-id="efb44-147">It is good to have some extra machines available at any time so that you can handle any unexpected spikes or failure (for example, if a few VMs go down).</span></span>  <span data-ttu-id="efb44-148">Хотя дополнительные ресурсы следует определить согласно ожидаемым скачкам нагрузки, для начала можно зарезервировать несколько дополнительных виртуальных машин (дополнительно 5–10 %).</span><span class="sxs-lookup"><span data-stu-id="efb44-148">While the extra capacity should be determined by using your expected spikes, a starting point is to reserve a few extra VMs (5-10 percent extra).</span></span>

<span data-ttu-id="efb44-149">Изложенное выше предполагает, что у вас есть одна служба с отслеживанием состояния.</span><span class="sxs-lookup"><span data-stu-id="efb44-149">The preceding assumes a single stateful service.</span></span> <span data-ttu-id="efb44-150">Если у вас их несколько, то необходимо добавить в уравнение значение DB_Size, связанное с другими службами.</span><span class="sxs-lookup"><span data-stu-id="efb44-150">If you have more than one stateful service, you have to add the DB_Size associated with the other services into the equation.</span></span> <span data-ttu-id="efb44-151">Кроме того, можно отдельно вычислить количество узлов для каждой службы с отслеживанием состояния.</span><span class="sxs-lookup"><span data-stu-id="efb44-151">Alternatively, you can compute the number of nodes separately for each stateful service.</span></span>  <span data-ttu-id="efb44-152">У службы могут быть реплики или секции, которые не сбалансированы.</span><span class="sxs-lookup"><span data-stu-id="efb44-152">Your service may have replicas or partitions that aren't balanced.</span></span> <span data-ttu-id="efb44-153">Имейте в виду, что одни секции также могут содержать больше данных, чем другие.</span><span class="sxs-lookup"><span data-stu-id="efb44-153">Keep in mind that partitions may also have more data than others.</span></span> <span data-ttu-id="efb44-154">Дополнительные сведения о секционировании см. в статье [Секционирование служб Reliable Services в Service Fabric](service-fabric-concepts-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="efb44-154">For more information on partitioning, see [partitioning article on best practices](service-fabric-concepts-partitioning.md).</span></span> <span data-ttu-id="efb44-155">Тем не менее приведенное выше уравнение не зависит от количества секций или реплик, так как Service Fabric обеспечивает оптимальное распределение реплик между узлами.</span><span class="sxs-lookup"><span data-stu-id="efb44-155">However, the preceding equation is partition and replica agnostic, because Service Fabric ensures that the replicas are spread out among the nodes in an optimized manner.</span></span>

## <a name="use-a-spreadsheet-for-cost-calculation"></a><span data-ttu-id="efb44-156">Использование таблицы для расчета стоимости</span><span class="sxs-lookup"><span data-stu-id="efb44-156">Use a spreadsheet for cost calculation</span></span>
<span data-ttu-id="efb44-157">Теперь давайте введем несколько реальных чисел в нашу формулу.</span><span class="sxs-lookup"><span data-stu-id="efb44-157">Now let's put some real numbers in the formula.</span></span> <span data-ttu-id="efb44-158">В [этом примере таблицы](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) показано планирование емкости для приложения, содержащего три типа объектов данных.</span><span class="sxs-lookup"><span data-stu-id="efb44-158">An [example spreadsheet](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) shows how to plan the capacity for an application that contains three types of data objects.</span></span> <span data-ttu-id="efb44-159">Для каждого объекта мы приблизительно определяем его размер и планируемое количество объектов.</span><span class="sxs-lookup"><span data-stu-id="efb44-159">For each object, we approximate its size and how many objects we expect to have.</span></span> <span data-ttu-id="efb44-160">Мы также выбираем требуемое количество реплик каждого типа объекта.</span><span class="sxs-lookup"><span data-stu-id="efb44-160">We also select how many replicas we want of each object type.</span></span> <span data-ttu-id="efb44-161">Таблица вычисляет общий объем памяти для хранения в кластере.</span><span class="sxs-lookup"><span data-stu-id="efb44-161">The spreadsheet calculates the total amount of memory to be stored in the cluster.</span></span>

<span data-ttu-id="efb44-162">Затем мы вводим размер виртуальной машины и ежемесячные расходы.</span><span class="sxs-lookup"><span data-stu-id="efb44-162">Then we enter a VM size and monthly cost.</span></span> <span data-ttu-id="efb44-163">В зависимости от размера виртуальной машины в таблице выводится минимальное количество секций, на которые необходимо разбить данные для физического размещения на узлах.</span><span class="sxs-lookup"><span data-stu-id="efb44-163">Based on the VM size, the spreadsheet tells you the minimum number of partitions you must use to split your data to physically fit on the nodes.</span></span> <span data-ttu-id="efb44-164">В соответствии с конкретными вычислениями вашего приложения и потребностями сетевого трафика может потребоваться дополнительное количество секций.</span><span class="sxs-lookup"><span data-stu-id="efb44-164">You may desire a larger number of partitions to accommodate your application's specific computation and network traffic needs.</span></span> <span data-ttu-id="efb44-165">В таблице показано увеличение количества секций, управляющих объектами профиля пользователя, от 1 до 6.</span><span class="sxs-lookup"><span data-stu-id="efb44-165">The spreadsheet shows the number of partitions that are managing the user profile objects has increased from one to six.</span></span>

<span data-ttu-id="efb44-166">Теперь на основе этой информации понятно, что вы можете физически получить все данные с нужными разделами и репликами в кластере с 26 узлами.</span><span class="sxs-lookup"><span data-stu-id="efb44-166">Now, based on all this information, the spreadsheet shows that you could physically get all the data with the desired partitions and replicas on a 26-node cluster.</span></span> <span data-ttu-id="efb44-167">Однако, так как этот кластер плотно упакован, могут потребоваться дополнительные узлы для обработки сбоев и обновлений.</span><span class="sxs-lookup"><span data-stu-id="efb44-167">However, this cluster would be densely packed, so you may want some additional nodes to accommodate node failures and upgrades.</span></span> <span data-ttu-id="efb44-168">В таблице также показано, что наличие более 57 узлов не дает дополнительных преимуществ — у вас просто будут пустые узлы.</span><span class="sxs-lookup"><span data-stu-id="efb44-168">The spreadsheet also shows that having more than 57 nodes provides no additional value because you would have empty nodes.</span></span> <span data-ttu-id="efb44-169">Опять же, может потребоваться более 57 узлов для обслуживания сбоев и обновлений узлов.</span><span class="sxs-lookup"><span data-stu-id="efb44-169">Again, you may want to go above 57 nodes anyway to accommodate node failures and upgrades.</span></span> <span data-ttu-id="efb44-170">Таблицу можно настроить в соответствии с конкретными потребностями.</span><span class="sxs-lookup"><span data-stu-id="efb44-170">You can tweak the spreadsheet to match your application's specific needs.</span></span>   

![Таблица для расчета стоимости][Image1]

## <a name="next-steps"></a><span data-ttu-id="efb44-172">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="efb44-172">Next steps</span></span>
<span data-ttu-id="efb44-173">Дополнительные сведения о секционировании служб см. в статье [Секционирование служб Reliable Services в Service Fabric][10].</span><span class="sxs-lookup"><span data-stu-id="efb44-173">Check out [Partitioning Service Fabric services][10] to learn more about partitioning your service.</span></span>

<!--Image references-->
[Image1]: ./media/SF-Cost.png

<!--Link references--In actual articles, you only need a single period before the slash-->
[10]: service-fabric-concepts-partitioning.md
