---
title: "Архитектура Azure Service Fabric | Документация Майкрософт"
description: "Service Fabric представляет собой платформу распределенных систем, используемых для создания масштабируемых, надежных и легко управляемых приложений в облаке. В настоящей статье освещается архитектура структуры служб."
services: service-fabric
documentationcenter: .net
author: rishirsinha
manager: timlt
editor: rishirsinha
ms.assetid: 6b554243-70cb-4c22-9b28-1a8b4703f45e
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/19/2017
ms.author: rsinha
ms.openlocfilehash: 3cf019bf9a08574c984e92985452df438f3eeb77
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="service-fabric-architecture"></a><span data-ttu-id="415e1-104">Архитектура Service Fabric</span><span class="sxs-lookup"><span data-stu-id="415e1-104">Service Fabric architecture</span></span>
<span data-ttu-id="415e1-105">Service Fabric имеет многоуровневые подсистемы.</span><span class="sxs-lookup"><span data-stu-id="415e1-105">Service Fabric is built with layered subsystems.</span></span> <span data-ttu-id="415e1-106">Эти подсистемы позволяют создавать приложения, которые обладают следующими свойствами:</span><span class="sxs-lookup"><span data-stu-id="415e1-106">These subsystems enable you to write applications that are:</span></span>

* <span data-ttu-id="415e1-107">высокая доступность,</span><span class="sxs-lookup"><span data-stu-id="415e1-107">Highly available</span></span>
* <span data-ttu-id="415e1-108">масштабируемость,</span><span class="sxs-lookup"><span data-stu-id="415e1-108">Scalable</span></span>
* <span data-ttu-id="415e1-109">управляемость,</span><span class="sxs-lookup"><span data-stu-id="415e1-109">Manageable</span></span>
* <span data-ttu-id="415e1-110">тестируемость.</span><span class="sxs-lookup"><span data-stu-id="415e1-110">Testable</span></span>

<span data-ttu-id="415e1-111">На следующей схеме показаны основные подсистемы Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="415e1-111">The following diagram shows the major subsystems of Service Fabric.</span></span>

![Схема архитектуры Service Fabric](media/service-fabric-architecture/service-fabric-architecture.png)

<span data-ttu-id="415e1-113">В распределенной системе возможность безопасного обмена данными между различными узлами кластера имеет решающее значение.</span><span class="sxs-lookup"><span data-stu-id="415e1-113">In a distributed system, the ability to securely communicate between nodes in a cluster is crucial.</span></span> <span data-ttu-id="415e1-114">В основании стека находится транспортная подсистема, которая обеспечивает безопасный обмен данными между узлами.</span><span class="sxs-lookup"><span data-stu-id="415e1-114">At the base of the stack is the transport subsystem, which provides secure communication between nodes.</span></span> <span data-ttu-id="415e1-115">Уровнем выше транспортной системы находится подсистема федерации, которая предназначена для объединения разных узлов в кластер как единую сущность (именованные кластеры). Таким образом, Service Fabric может обнаруживать ошибки, выбирать лидера и осуществлять согласованную маршрутизацию.</span><span class="sxs-lookup"><span data-stu-id="415e1-115">Above the transport subsystem lies the federation subsystem, which clusters the different nodes into a single entity (named clusters) so that Service Fabric can detect failures, perform leader election, and provide consistent routing.</span></span> <span data-ttu-id="415e1-116">Подсистема надежности, расположенная уровнем выше подсистемы федерации, обеспечивает надежность служб Service Fabric с помощью таких механизмов, как репликация, управление ресурсами и отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="415e1-116">The reliability subsystem, layered on top of the federation subsystem, is responsible for the reliability of Service Fabric services through mechanisms such as replication, resource management, and failover.</span></span> <span data-ttu-id="415e1-117">Подсистема федерации также является основой для подсистемы хостинга и активации, которая управляет жизненным циклом приложения на отдельном узле.</span><span class="sxs-lookup"><span data-stu-id="415e1-117">The federation subsystem also underlies the hosting and activation subsystem, which manages the lifecycle of an application on a single node.</span></span> <span data-ttu-id="415e1-118">Подсистема управления управляет жизненным циклом приложений и служб.</span><span class="sxs-lookup"><span data-stu-id="415e1-118">The management subsystem manages the lifecycle of applications and services.</span></span> <span data-ttu-id="415e1-119">Подсистема тестирования помогает разработчикам приложений проверять работу своих служб, имитируя ошибки и сбои до и после развертывания приложений и служб в производственных средах.</span><span class="sxs-lookup"><span data-stu-id="415e1-119">The testability subsystem helps application developers test their services through simulated faults before and after deploying applications and services to production environments.</span></span> <span data-ttu-id="415e1-120">Service Fabric обеспечивает возможность разрешать местоположения служб через подсистему коммуникации.</span><span class="sxs-lookup"><span data-stu-id="415e1-120">Service Fabric provides the ability to resolve service locations through its communication subsystem.</span></span> <span data-ttu-id="415e1-121">Модели программирования приложений, предоставляемые разработчикам, располагаются поверх этих подсистем вместе с моделью приложения для включения инструментария.</span><span class="sxs-lookup"><span data-stu-id="415e1-121">The application programming models exposed to developers are layered on top of these subsystems along with the application model to enable tooling.</span></span>

## <a name="transport-subsystem"></a><span data-ttu-id="415e1-122">Транспортная подсистема</span><span class="sxs-lookup"><span data-stu-id="415e1-122">Transport subsystem</span></span>
<span data-ttu-id="415e1-123">Транспортная подсистема реализована на модели обмена данными по каналу "точка-точка".</span><span class="sxs-lookup"><span data-stu-id="415e1-123">The transport subsystem implements a point-to-point datagram communication channel.</span></span> <span data-ttu-id="415e1-124">Этот канал используется для обмена данными в пределах кластера Service Fabric и между кластером Service Fabric и клиентами.</span><span class="sxs-lookup"><span data-stu-id="415e1-124">This channel is used for communication within service fabric clusters and communication between the service fabric cluster and clients.</span></span> <span data-ttu-id="415e1-125">Поддерживается как односторонняя модель обмена данными, так и модель на основе схемы "запрос — ответ". Это позволяет внедрять технологии широковещательной и многоканальной трансляции на уровне федерации.</span><span class="sxs-lookup"><span data-stu-id="415e1-125">It supports one-way and request-reply communication patterns, which provides the basis for implementing broadcast and multicast in the Federation layer.</span></span> <span data-ttu-id="415e1-126">Транспортная подсистема обеспечивает безопасность при обмене данными за счет использования сертификатов X509 или средств безопасности Windows.</span><span class="sxs-lookup"><span data-stu-id="415e1-126">The transport subsystem secures communication by using X509 certificates or Windows security.</span></span> <span data-ttu-id="415e1-127">Эта подсистема используется в рамках Service Fabric. При программировании приложений она недоступна напрямую для разработчиков.</span><span class="sxs-lookup"><span data-stu-id="415e1-127">This subsystem is used internally by Service Fabric and is not directly accessible to developers for application programming.</span></span>

## <a name="federation-subsystem"></a><span data-ttu-id="415e1-128">Подсистема федерации</span><span class="sxs-lookup"><span data-stu-id="415e1-128">Federation subsystem</span></span>
<span data-ttu-id="415e1-129">Чтобы рассуждать о наборе узлов в распределенной системе, нам потребуется сформировать целостное представление обо всей системе.</span><span class="sxs-lookup"><span data-stu-id="415e1-129">In order to reason about a set of nodes in a distributed system, you need to have a consistent view of the system.</span></span> <span data-ttu-id="415e1-130">Подсистема федерации использует составные элементы обмена данными, предоставляемые транспортной подсистемой, и объединяет различные узлы в единый унифицированный кластер.</span><span class="sxs-lookup"><span data-stu-id="415e1-130">The federation subsystem uses the communication primitives provided by the transport subsystem and stitches the various nodes into a single unified cluster that it can reason about.</span></span> <span data-ttu-id="415e1-131">Это обеспечивает составные элементы распределенной системы, которые требуются другим подсистемам: обнаружение сбоев, выбор лидера и постоянная маршрутизация.</span><span class="sxs-lookup"><span data-stu-id="415e1-131">It provides the distributed systems primitives needed by the other subsystems - failure detection, leader election, and consistent routing.</span></span> <span data-ttu-id="415e1-132">Подсистема федерации основана на распределенных хэш-таблицах с 128-разрядным пространством маркера.</span><span class="sxs-lookup"><span data-stu-id="415e1-132">The federation subsystem is built on top of distributed hash tables with a 128-bit token space.</span></span> <span data-ttu-id="415e1-133">Она создает кольцевую топологию на узлах, где каждому узлу в кольце выделяется подмножество пространства маркера для владельца.</span><span class="sxs-lookup"><span data-stu-id="415e1-133">The subsystem creates a ring topology over the nodes, with each node in the ring being allocated a subset of the token space for ownership.</span></span> <span data-ttu-id="415e1-134">Для обнаружения ошибок этот уровень использует механизм аренды, основанный на сердцебиении и разрешении конфликтов.</span><span class="sxs-lookup"><span data-stu-id="415e1-134">For failure detection, the layer uses a leasing mechanism based on heart beating and arbitration.</span></span> <span data-ttu-id="415e1-135">Кроме того, подсистема федерации при помощи сложных протоколов присоединения и отсоединения гарантирует, что в конкретный момент существует только один владелец.</span><span class="sxs-lookup"><span data-stu-id="415e1-135">The federation subsystem also guarantees through intricate join and departure protocols that only a single owner of a token exists at any time.</span></span> <span data-ttu-id="415e1-136">Это позволяет выбирать лидера и обеспечивать согласованную маршрутизацию.</span><span class="sxs-lookup"><span data-stu-id="415e1-136">This provides leader election and consistent routing guarantees.</span></span>

## <a name="reliability-subsystem"></a><span data-ttu-id="415e1-137">Подсистема надежности</span><span class="sxs-lookup"><span data-stu-id="415e1-137">Reliability subsystem</span></span>
<span data-ttu-id="415e1-138">Подсистема надежности предусматривает механизм, обеспечивающий высокую доступность службы Service Fabric за счет использования *репликатора*, *диспетчера отработки отказов* и *балансировщика ресурсов*.</span><span class="sxs-lookup"><span data-stu-id="415e1-138">The reliability subsystem provides the mechanism to make the state of a Service Fabric service highly available through the use of the *Replicator*, *Failover Manager*, and *Resource Balancer*.</span></span>

* <span data-ttu-id="415e1-139">Репликатор следит за тем, чтобы смена состояний в основной реплике службы автоматически реплицировалась на вторичные реплики, поддерживая согласованность между первичной и вторичной репликами в наборе реплик службы.</span><span class="sxs-lookup"><span data-stu-id="415e1-139">The Replicator ensures that state changes in the primary service replica will automatically be replicated to secondary replicas, maintaining consistency between the primary and secondary replicas in a service replica set.</span></span> <span data-ttu-id="415e1-140">Репликатор отвечает за управление кворумом между репликами в наборе.</span><span class="sxs-lookup"><span data-stu-id="415e1-140">The replicator is responsible for quorum management among the replicas in the replica set.</span></span> <span data-ttu-id="415e1-141">Он взаимодействует с единицей отработки отказа, чтобы получить список операций для репликации, а агент перенастройки предоставляет ему конфигурацию набора реплик.</span><span class="sxs-lookup"><span data-stu-id="415e1-141">It interacts with the failover unit to get the list of operations to replicate, and the reconfiguration agent provides it with the configuration of the replica set.</span></span> <span data-ttu-id="415e1-142">В этой конфигурации указано, на какие реплики необходимо реплицировать операции.</span><span class="sxs-lookup"><span data-stu-id="415e1-142">That configuration indicates which replicas the operations need to be replicated.</span></span> <span data-ttu-id="415e1-143">В Service Fabric используется репликатор по умолчанию, который называется репликатором структуры. Он может использоваться API модели программирования для обеспечения высокодоступного и надежного состояния службы.</span><span class="sxs-lookup"><span data-stu-id="415e1-143">Service Fabric provides a default replicator called Fabric Replicator, which can be used by the programming model API to make the service state highly available and reliable.</span></span>
* <span data-ttu-id="415e1-144">Диспетчер отработки отказов отвечает за автоматическое перераспределение нагрузки между доступными узлами при добавлении или удалении узлов из кластера.</span><span class="sxs-lookup"><span data-stu-id="415e1-144">The Failover Manager ensures that when nodes are added to or removed from the cluster, the load is automatically redistributed across the available nodes.</span></span> <span data-ttu-id="415e1-145">Кластер автоматически перенастроит реплики службы при отказе одного из узлов в кластере, обеспечивая доступность.</span><span class="sxs-lookup"><span data-stu-id="415e1-145">If a node in the cluster fails, the cluster will automatically reconfigure the service replicas to maintain availability.</span></span>
* <span data-ttu-id="415e1-146">Диспетчер ресурсов размещает реплики служб в домене сбоя по кластеру и обеспечивает работу всех единиц отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="415e1-146">The Resource Manager places service replicas across failure domain in the cluster and ensures that all failover units are operational.</span></span> <span data-ttu-id="415e1-147">Диспетчер ресурсов также распределяет ресурсы службы в рамках совместного пула узлов кластера, обеспечивая равномерное распределение нагрузки.</span><span class="sxs-lookup"><span data-stu-id="415e1-147">The Resource Manager also balances service resources across the underlying shared pool of cluster nodes to achieve optimal uniform load distribution.</span></span>

## <a name="management-subsystem"></a><span data-ttu-id="415e1-148">Подсистема управления</span><span class="sxs-lookup"><span data-stu-id="415e1-148">Management subsystem</span></span>
<span data-ttu-id="415e1-149">Подсистема управления обеспечивает комплексное управление жизненным циклом приложений и служб.</span><span class="sxs-lookup"><span data-stu-id="415e1-149">The management subsystem provides end-to-end service and application lifecycle management.</span></span> <span data-ttu-id="415e1-150">Командлеты PowerShell и API администрирования позволяют без потери доступности подготавливать к работе, развертывать, обновлять и удалять приложения, а также добавлять в них исправления.</span><span class="sxs-lookup"><span data-stu-id="415e1-150">PowerShell cmdlets and administrative APIs enable you to provision, deploy, patch, upgrade, and de-provision applications without loss of availability.</span></span> <span data-ttu-id="415e1-151">Подсистема управления выполняет это при помощи следующих служб.</span><span class="sxs-lookup"><span data-stu-id="415e1-151">The management subsystem performs this through the following services.</span></span>

* <span data-ttu-id="415e1-152">**Диспетчер кластера**представляет собой главную службу, которая взаимодействует с диспетчером отработки отказов с точки зрения обеспечения надежности, чтобы размещать приложения на узлах на основании ограничений на размещение служб.</span><span class="sxs-lookup"><span data-stu-id="415e1-152">**Cluster Manager**: This is the primary service that interacts with the Failover Manager from reliability to place the applications on the nodes based on the service placement constraints.</span></span> <span data-ttu-id="415e1-153">Диспетчер ресурсов в подсистеме отработки отказа обеспечивает соблюдение установленных ограничений.</span><span class="sxs-lookup"><span data-stu-id="415e1-153">The Resource Manager in failover subsystem ensures that the constraints are never broken.</span></span> <span data-ttu-id="415e1-154">Диспетчер кластеров управляет жизненным циклом приложений, включая подготовку и ее отмену.</span><span class="sxs-lookup"><span data-stu-id="415e1-154">The cluster manager manages the lifecycle of the applications from provision to de-provision.</span></span> <span data-ttu-id="415e1-155">Он интегрируется с диспетчером работоспособности, чтобы обеспечить доступность приложения с точки зрения семантической работоспособности во время обновлений.</span><span class="sxs-lookup"><span data-stu-id="415e1-155">It integrates with the health manager to ensure that application availability is not lost from a semantic health perspective during upgrades.</span></span>
* <span data-ttu-id="415e1-156">**Диспетчер работоспособности**активирует наблюдение за работоспособностью приложений, служб и сущностей кластеров.</span><span class="sxs-lookup"><span data-stu-id="415e1-156">**Health Manager**: This service enables health monitoring of applications, services, and cluster entities.</span></span> <span data-ttu-id="415e1-157">Сущности кластеров (такие как узлы, разделы служб и реплики) могут сообщать сведения о работоспособности, которые затем собираются в централизованное хранилище данных о работоспособности.</span><span class="sxs-lookup"><span data-stu-id="415e1-157">Cluster entities (such as nodes, service partitions, and replicas) can report health information, which is then aggregated into the centralized health store.</span></span> <span data-ttu-id="415e1-158">Эти сведения о работоспособности предоставляют общие моментальные снимки о состоянии работоспособности служб и узлов, распределенных между многими узлами кластера, позволяя предпринимать своевременные корректирующие действия.</span><span class="sxs-lookup"><span data-stu-id="415e1-158">This health information provides an overall point-in-time health snapshot of the services and nodes distributed across multiple nodes in the cluster, enabling you to take any needed corrective actions.</span></span> <span data-ttu-id="415e1-159">Интерфейсы API работоспособности позволяют опрашивать события работоспособности, переданные в подсистему работоспособности.</span><span class="sxs-lookup"><span data-stu-id="415e1-159">Health query APIs enable you to query the health events reported to the health subsystem.</span></span> <span data-ttu-id="415e1-160">Интерфейсы API работоспособности возвращают необработанные данные о работоспособности, которые размещаются в хранилище данных о работоспособности, или агрегированные и интерпретированные данные о работоспособности для конкретной сущности кластера.</span><span class="sxs-lookup"><span data-stu-id="415e1-160">The health query APIs return the raw health data stored in the health store or the aggregated, interpreted health data for a specific cluster entity.</span></span>
* <span data-ttu-id="415e1-161">**Хранилище образов**позволяет хранить и распространять двоичные файлы приложений.</span><span class="sxs-lookup"><span data-stu-id="415e1-161">**Image Store**: This service provides storage and distribution of the application binaries.</span></span> <span data-ttu-id="415e1-162">Эта служба представляет собой простое распределенное хранилище файлов, в которое отправляются и из которого скачиваются приложения.</span><span class="sxs-lookup"><span data-stu-id="415e1-162">This service provides a simple distributed file store where the applications are uploaded to and downloaded from.</span></span>

## <a name="hosting-subsystem"></a><span data-ttu-id="415e1-163">Подсистема хостинга</span><span class="sxs-lookup"><span data-stu-id="415e1-163">Hosting subsystem</span></span>
<span data-ttu-id="415e1-164">Диспетчер кластеров информирует подсистему хостинга (работающую на каждом узле) о том, какими службами ему необходимо управлять на каждом конкретном узле.</span><span class="sxs-lookup"><span data-stu-id="415e1-164">The cluster manager informs the hosting subsystem (running on each node) which services it needs to manage for a particular node.</span></span> <span data-ttu-id="415e1-165">Подсистема хостинга затем управляет жизненным циклом приложения на этом узле.</span><span class="sxs-lookup"><span data-stu-id="415e1-165">The hosting subsystem then manages the lifecycle of the application on that node.</span></span> <span data-ttu-id="415e1-166">Она взаимодействует с компонентами обеспечения надежности и работоспособности, чтобы обеспечить нужное размещение реплик и их работоспособность.</span><span class="sxs-lookup"><span data-stu-id="415e1-166">It interacts with the reliability and health components to ensure that the replicas are properly placed and are healthy.</span></span>

## <a name="communication-subsystem"></a><span data-ttu-id="415e1-167">Подсистема связи</span><span class="sxs-lookup"><span data-stu-id="415e1-167">Communication subsystem</span></span>
<span data-ttu-id="415e1-168">Эта подсистема предоставляет надежный обмен сообщениями в пределах кластера, а также функции обнаружения служб через службу именования.</span><span class="sxs-lookup"><span data-stu-id="415e1-168">This subsystem provides reliable messaging within the cluster and service discovery through the Naming service.</span></span> <span data-ttu-id="415e1-169">Служба именования присваивает имена служб определенному расположению в кластере, позволяя пользователям управлять именами и свойствами.</span><span class="sxs-lookup"><span data-stu-id="415e1-169">The Naming service resolves service names to a location in the cluster and enables users to manage service names and properties.</span></span> <span data-ttu-id="415e1-170">Используя службу именования, клиенты могут безопасно обмениваться данными с любыми узлами в кластере, чтобы разрешать имена и извлекать метаданные служб.</span><span class="sxs-lookup"><span data-stu-id="415e1-170">Using the Naming service, clients can securely communicate with any node in the cluster to resolve a service name and retrieve service metadata.</span></span> <span data-ttu-id="415e1-171">С помощью простого API именования клиента пользователи Service Fabric могут разрабатывать службы и клиенты, способные разрешать текущее сетевое расположение независимо от динамичности узлов или изменения размера кластера.</span><span class="sxs-lookup"><span data-stu-id="415e1-171">Using a simple Naming client API, users of Service Fabric can develop services and clients capable of resolving the current network location despite node dynamism or the re-sizing of the cluster.</span></span>

## <a name="testability-subsystem"></a><span data-ttu-id="415e1-172">Подсистема тестирования</span><span class="sxs-lookup"><span data-stu-id="415e1-172">Testability subsystem</span></span>
<span data-ttu-id="415e1-173">Подсистема тестирования представляет собой набор инструментов, специально предназначенных для тестирования служб, созданных в структуре служб.</span><span class="sxs-lookup"><span data-stu-id="415e1-173">Testability is a suite of tools specifically designed for testing services built on Service Fabric.</span></span> <span data-ttu-id="415e1-174">Эти инструменты позволяют разработчику легко вызывать значимые ошибки и запускать тестовые сценарии, чтобы воспроизводить и проверять в контролируемых и безопасных условиях разные состояния и переходы, происходящие со службой в течение ее жизненного цикла.</span><span class="sxs-lookup"><span data-stu-id="415e1-174">The tools let a developer easily induce meaningful faults and run test scenarios to exercise and validate the numerous states and transitions that a service will experience throughout its lifetime, all in a controlled and safe manner.</span></span> <span data-ttu-id="415e1-175">Средства тестирования также предоставляют механизм для запуска долговременных тестов с возможностью итерации по вероятным ошибкам без потери доступности.</span><span class="sxs-lookup"><span data-stu-id="415e1-175">Testability also provides a mechanism to run longer tests that can iterate through various possible failures without losing availability.</span></span> <span data-ttu-id="415e1-176">Это обеспечивает возможность тестирования в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="415e1-176">This provides you with a test-in-production environment.</span></span>

