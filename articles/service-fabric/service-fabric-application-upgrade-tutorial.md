---
title: "Руководство по обновлению приложения Service Fabric | Документация Майкрософт"
description: "В этой статье рассматривается процесс развертывания приложения Service Fabric, изменения кода и развертывания обновления с помощью Visual Studio."
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: timlt
editor: 
ms.assetid: a3181a7a-9ab1-4216-b07a-05b79bd826a4
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: 940440688ec770a4aeb932b574bd6be173f494d4
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="service-fabric-application-upgrade-tutorial-using-visual-studio"></a><span data-ttu-id="775fd-103">Учебник по обновлению приложений Service Fabric с помощью Visual Studio</span><span class="sxs-lookup"><span data-stu-id="775fd-103">Service Fabric application upgrade tutorial using Visual Studio</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="775fd-104">PowerShell</span><span class="sxs-lookup"><span data-stu-id="775fd-104">PowerShell</span></span>](service-fabric-application-upgrade-tutorial-powershell.md)
> * [<span data-ttu-id="775fd-105">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="775fd-105">Visual Studio</span></span>](service-fabric-application-upgrade-tutorial.md)
> 
> 

<br/>

<span data-ttu-id="775fd-106">Azure Service Fabric упрощает процесс обновления облачных приложений за счет того, что обновляются только измененные службы, кроме того, в процессе обновления отслеживается работоспособность приложения.</span><span class="sxs-lookup"><span data-stu-id="775fd-106">Azure Service Fabric simplifies the process of upgrading cloud applications by ensuring that only changed services are upgraded, and that application health is monitored throughout the upgrade process.</span></span> <span data-ttu-id="775fd-107">При обнаружении проблем автоматически выполняется откат к предыдущей версии приложения.</span><span class="sxs-lookup"><span data-stu-id="775fd-107">It also automatically rolls back the application to the previous version upon encountering issues.</span></span> <span data-ttu-id="775fd-108">Обновление приложений Service Fabric выполняется *без времени простоя*, так как приложение можно обновить без времени простоя.</span><span class="sxs-lookup"><span data-stu-id="775fd-108">Service Fabric application upgrades are *Zero Downtime*, since the application can be upgraded with no downtime.</span></span> <span data-ttu-id="775fd-109">В этом учебнике описывается развертывание последовательного обновления из Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="775fd-109">This tutorial covers how to complete a rolling upgrade from Visual Studio.</span></span>

## <a name="step-1-build-and-publish-the-visual-objects-sample"></a><span data-ttu-id="775fd-110">Шаг 1. Построение и публикация примера приложения Visual Objects</span><span class="sxs-lookup"><span data-stu-id="775fd-110">Step 1: Build and publish the Visual Objects sample</span></span>
<span data-ttu-id="775fd-111">Во-первых, скачайте приложение [Visual Objects](https://github.com/Azure-Samples/service-fabric-dotnet-getting-started/tree/classic/Actors/VisualObjects) с сайта GitHub.</span><span class="sxs-lookup"><span data-stu-id="775fd-111">First, download the [Visual Objects](https://github.com/Azure-Samples/service-fabric-dotnet-getting-started/tree/classic/Actors/VisualObjects) application from GitHub.</span></span> <span data-ttu-id="775fd-112">Затем выполните сборку приложения и опубликуйте его. Для этого щелкните правой кнопкой мыши проект приложения **VisualObjects** и выберите в меню Service Fabric команду **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="775fd-112">Then, build and publish the application by right-clicking on the application project, **VisualObjects**, and selecting the **Publish** command in the Service Fabric menu item.</span></span>

![Контекстное меню для приложения Service Fabric][image1]

<span data-ttu-id="775fd-114">После выбора **Опубликовать** отобразится всплывающее окно, в котором в качестве **целевого профиля** можно выбрать файл **PublishProfiles\Local.xml**.</span><span class="sxs-lookup"><span data-stu-id="775fd-114">Selecting **Publish** brings up a popup, and you can set the **Target profile** to **PublishProfiles\Local.xml**.</span></span> <span data-ttu-id="775fd-115">Перед нажатием кнопки **Опубликовать**окно должно выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="775fd-115">The window should look like the following before you click **Publish**.</span></span>

![Публикация приложения Service Fabric][image2]

<span data-ttu-id="775fd-117">Теперь можно нажать кнопку **Опубликовать** в диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="775fd-117">Now you can click **Publish** in the dialog box.</span></span> <span data-ttu-id="775fd-118">Для просмотра кластера и приложения теперь можно использовать [обозреватель Service Fabric](service-fabric-visualizing-your-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="775fd-118">You can use [Service Fabric Explorer to view the cluster and the application](service-fabric-visualizing-your-cluster.md).</span></span> <span data-ttu-id="775fd-119">Приложение Visual Objects включает в себя веб-службу, к которой можно перейти, указав в адресной строке браузера [http://localhost:8081/visualobjects/](http://localhost:8081/visualobjects/).</span><span class="sxs-lookup"><span data-stu-id="775fd-119">The Visual Objects application has a web service that you can go to by typing [http://localhost:8081/visualobjects/](http://localhost:8081/visualobjects/) in the address bar of your browser.</span></span>  <span data-ttu-id="775fd-120">Вы должны увидеть 10 плавающих визуальных объектов, перемещающихся по экрану.</span><span class="sxs-lookup"><span data-stu-id="775fd-120">You should see 10 floating visual objects moving around on the screen.</span></span>

<span data-ttu-id="775fd-121">**Примечание.** При развертывании в профиле `Cloud.xml` (Azure Service Fabric) приложение должно быть доступно по адресу **http://{ServiceFabricName}.{Region}.cloudapp.azure.com:8081/visualobjects/**.</span><span class="sxs-lookup"><span data-stu-id="775fd-121">**NOTE:** If deploying to `Cloud.xml` profile (Azure Service Fabric), the application should then be available at **http://{ServiceFabricName}.{Region}.cloudapp.azure.com:8081/visualobjects/**.</span></span> <span data-ttu-id="775fd-122">Убедитесь, что в балансировщике нагрузки настроен `8081/TCP` (балансировщик нагрузки находится в той же группе ресурсов, что и экземпляр Service Fabric).</span><span class="sxs-lookup"><span data-stu-id="775fd-122">Make sure you do have `8081/TCP` configured in the Load Balancer (find the Load Balancer in the same resource group as the Service Fabric instance).</span></span>

## <a name="step-2-update-the-visual-objects-sample"></a><span data-ttu-id="775fd-123">Шаг 2. Обновление образца визуальных объектов</span><span class="sxs-lookup"><span data-stu-id="775fd-123">Step 2: Update the Visual Objects sample</span></span>
<span data-ttu-id="775fd-124">Вы можете заметить, что в версии, развернутой на шаге 1, визуальные объекты не вращаются.</span><span class="sxs-lookup"><span data-stu-id="775fd-124">You might notice that with the version that was deployed in step 1, the visual objects do not rotate.</span></span> <span data-ttu-id="775fd-125">Давайте обновим это приложение до версии, в которой визуальные объекты будут вращаться.</span><span class="sxs-lookup"><span data-stu-id="775fd-125">Let's upgrade this application to one where the visual objects also rotate.</span></span>

<span data-ttu-id="775fd-126">Выберите проект VisualObjects.ActorService в решении VisualObjects и откройте файл **VisualObjectActor.cs**.</span><span class="sxs-lookup"><span data-stu-id="775fd-126">Select the VisualObjects.ActorService project within the VisualObjects solution, and open the **VisualObjectActor.cs** file.</span></span> <span data-ttu-id="775fd-127">В этом файле перейдите к методу `MoveObject`, а затем закомментируйте `visualObject.Move(false)` и раскомментируйте `visualObject.Move(true)`.</span><span class="sxs-lookup"><span data-stu-id="775fd-127">Within that file, go to the method `MoveObject`, comment out `visualObject.Move(false)`, and uncomment `visualObject.Move(true)`.</span></span> <span data-ttu-id="775fd-128">Это изменение кода приведет к вращению объектов после обновления службы.</span><span class="sxs-lookup"><span data-stu-id="775fd-128">This code change rotates the objects after the service is upgraded.</span></span>  <span data-ttu-id="775fd-129">**Теперь можно выполнить сборку (не перестроить) решения**. При этом будет выполнена сборка измененных проектов.</span><span class="sxs-lookup"><span data-stu-id="775fd-129">**Now you can build (not rebuild) the solution**, which builds the modified projects.</span></span> <span data-ttu-id="775fd-130">Если вы выберете *Перестроить все*, то придется обновить версии для всех проектов.</span><span class="sxs-lookup"><span data-stu-id="775fd-130">If you select *Rebuild all*, you have to update the versions for all the projects.</span></span>

<span data-ttu-id="775fd-131">Необходимо также задать версию приложения.</span><span class="sxs-lookup"><span data-stu-id="775fd-131">We also need to version our application.</span></span> <span data-ttu-id="775fd-132">Чтобы изменить версию, можно в Visual Studio щелкнуть проект **VisualObjects** правой кнопкой мыши и выбрать пункт меню **Изменить версии манифеста**.</span><span class="sxs-lookup"><span data-stu-id="775fd-132">To make the version changes after you right-click on the **VisualObjects** project, you can use the Visual Studio **Edit Manifest Versions** option.</span></span> <span data-ttu-id="775fd-133">После этого откроется диалоговое окно для редактирования версий выпуска.</span><span class="sxs-lookup"><span data-stu-id="775fd-133">Selecting this option brings up the dialog box for edition versions as follows:</span></span>

![Диалоговое окно "Управление версиями"][image3]

<span data-ttu-id="775fd-135">Обновите версии для измененных проектов, соответствующих пакетов кода и приложения до версии 2.0.0.</span><span class="sxs-lookup"><span data-stu-id="775fd-135">Update the versions for the modified projects and their code packages, along with the application to version 2.0.0.</span></span> <span data-ttu-id="775fd-136">После внесения изменений манифест должен выглядеть следующим образом (полужирным шрифтом выделены измененные части):</span><span class="sxs-lookup"><span data-stu-id="775fd-136">After the changes are made, the manifest should look like the following (bold portions show the changes):</span></span>

![Обновление версий][image4]

<span data-ttu-id="775fd-138">Средства Visual Studio могут выполнять автоматическое обновление версий, если вы выберете пункт меню **Автоматическое обновление версий приложения и службы**.</span><span class="sxs-lookup"><span data-stu-id="775fd-138">The Visual Studio tools can do automatic rollups of versions upon selecting **Automatically update application and service versions**.</span></span> <span data-ttu-id="775fd-139">Если вы используете [SemVer](http://www.semver.org), необходимо обновить код и (или) конфигурацию версии пакета, если выбран этот параметр.</span><span class="sxs-lookup"><span data-stu-id="775fd-139">If you use [SemVer](http://www.semver.org), you need to update the code and/or configuration package version alone if that option is selected.</span></span>

<span data-ttu-id="775fd-140">Сохраните изменения и установите флажок **Обновить приложение** .</span><span class="sxs-lookup"><span data-stu-id="775fd-140">Save the changes, and now check the **Upgrade the Application** box.</span></span>

## <a name="step-3--upgrade-your-application"></a><span data-ttu-id="775fd-141">Шаг 3. Обновление приложения</span><span class="sxs-lookup"><span data-stu-id="775fd-141">Step 3:  Upgrade your application</span></span>
<span data-ttu-id="775fd-142">Ознакомьтесь с [параметрами обновления приложений](service-fabric-application-upgrade-parameters.md) и [процессом обновления](service-fabric-application-upgrade.md) для лучшего понимания различных параметров обновления, значений времени ожидания и применяемых критериев.</span><span class="sxs-lookup"><span data-stu-id="775fd-142">Familiarize yourself with the [application upgrade parameters](service-fabric-application-upgrade-parameters.md) and the [upgrade process](service-fabric-application-upgrade.md) to get a good understanding of the various upgrade parameters, time-outs, and health criterion that can be applied.</span></span> <span data-ttu-id="775fd-143">В этом пошаговом руководстве используется значение критерия оценки работоспособности по умолчанию (неотслеживаемый режим).</span><span class="sxs-lookup"><span data-stu-id="775fd-143">For this walkthrough, the service health evaluation criterion is set to the default (unmonitored mode).</span></span> <span data-ttu-id="775fd-144">Эти параметры можно установить, выбрав пункт **Настроить параметры обновления** и изменив параметры по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="775fd-144">You can configure these settings by selecting **Configure Upgrade Settings** and then modifying the parameters as desired.</span></span>

<span data-ttu-id="775fd-145">Теперь все готово к тому, чтобы запустить обновление приложения нажатием кнопки **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="775fd-145">Now we are all set to start the application upgrade by selecting **Publish**.</span></span> <span data-ttu-id="775fd-146">В результате приложение будет обновлено до версии 2.0.0, в которой объекты вращаются.</span><span class="sxs-lookup"><span data-stu-id="775fd-146">This option upgrades your application to version 2.0.0, in which the objects rotate.</span></span> <span data-ttu-id="775fd-147">Service Fabric обновляет домены обновления по одному (некоторые объекты будут обновлены первыми, другие — позже), и во время обновления служба остается доступна.</span><span class="sxs-lookup"><span data-stu-id="775fd-147">Service Fabric upgrades one update domain at a time (some objects are updated first, followed by others), and the service remains accessible during the upgrade.</span></span> <span data-ttu-id="775fd-148">Доступ к службе можно проверить с помощью клиента (в браузере).</span><span class="sxs-lookup"><span data-stu-id="775fd-148">Access to the service can be checked through your client (browser).</span></span>  

<span data-ttu-id="775fd-149">По мере обновления приложения этот процесс можно отслеживать с помощью обозревателя Service Fabric (вкладка **Upgrades in Progress** (Выполняемые обновления) в разделе приложений).</span><span class="sxs-lookup"><span data-stu-id="775fd-149">Now, as the application upgrade proceeds, you can monitor it with Service Fabric Explorer, by using the **Upgrades in Progress** tab under the applications.</span></span>

<span data-ttu-id="775fd-150">Через несколько минут должны быть обновлены все домены обновления, и в окне выходных данных Visual Studio также должно появиться сообщение о том, что обновление выполнено.</span><span class="sxs-lookup"><span data-stu-id="775fd-150">In a few minutes, all update domains should be upgraded (completed), and the Visual Studio output window should also state that the upgrade is completed.</span></span> <span data-ttu-id="775fd-151">Кроме того, вы должны увидеть, что *все* визуальные объекты в окне браузера начали вращаться.</span><span class="sxs-lookup"><span data-stu-id="775fd-151">And you should find that *all* the visual objects in your browser window are now rotating!</span></span>

<span data-ttu-id="775fd-152">Вы можете попробовать изменить версии и перейти от версии 2.0.0 к версии 3.0.0 в качестве упражнения или даже от версии 2.0.0 назад к версии 1.0.0.</span><span class="sxs-lookup"><span data-stu-id="775fd-152">You may want to try changing the versions, and moving from version 2.0.0 to version 3.0.0 as an exercise, or even from version 2.0.0 back to version 1.0.0.</span></span> <span data-ttu-id="775fd-153">Попробуйте изменить значения времени ожидания и параметры политики работоспособности в качестве тренировки.</span><span class="sxs-lookup"><span data-stu-id="775fd-153">Play with time-outs and health policies to make yourself familiar with them.</span></span> <span data-ttu-id="775fd-154">При развертывании в кластер Azure параметры могут отличаться от используемых при развертывании в локальный кластер.</span><span class="sxs-lookup"><span data-stu-id="775fd-154">When deploying to an Azure cluster as opposed to a local cluster, the parameters used may have to differ.</span></span> <span data-ttu-id="775fd-155">Рекомендуется применить консервативный подход при настройке значений времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="775fd-155">We recommend that you set the time-outs conservatively.</span></span>

## <a name="next-steps"></a><span data-ttu-id="775fd-156">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="775fd-156">Next steps</span></span>
<span data-ttu-id="775fd-157">[Обновление приложения с помощью PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) поможет вам выполнить обновление приложения с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="775fd-157">[Upgrading your application using PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="775fd-158">Управление обновлениями приложения осуществляется с помощью [параметров обновления](service-fabric-application-upgrade-parameters.md).</span><span class="sxs-lookup"><span data-stu-id="775fd-158">Control how your application is upgraded by using [upgrade parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="775fd-159">Узнайте, как использовать [сериализацию данных](service-fabric-application-upgrade-data-serialization.md), чтобы обеспечить совместимость обновлений приложения.</span><span class="sxs-lookup"><span data-stu-id="775fd-159">Make your application upgrades compatible by learning how to use [data serialization](service-fabric-application-upgrade-data-serialization.md).</span></span>

<span data-ttu-id="775fd-160">[Дополнительные разделы](service-fabric-application-upgrade-advanced.md)содержат сведения о работе с расширенными функциями при обновлении приложения.</span><span class="sxs-lookup"><span data-stu-id="775fd-160">Learn how to use advanced functionality while upgrading your application by referring to [Advanced topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="775fd-161">Сведения об устранении распространенных проблем при обновлении приложений см. в статье [Устранение неполадок обновления приложения](service-fabric-application-upgrade-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="775fd-161">Fix common problems in application upgrades by referring to the steps in [Troubleshooting application upgrades](service-fabric-application-upgrade-troubleshooting.md).</span></span>

[image1]: media/service-fabric-application-upgrade-tutorial/upgrade7.png
[image2]: media/service-fabric-application-upgrade-tutorial/upgrade1.png
[image3]: media/service-fabric-application-upgrade-tutorial/upgrade5.png
[image4]: media/service-fabric-application-upgrade-tutorial/upgrade6.png
