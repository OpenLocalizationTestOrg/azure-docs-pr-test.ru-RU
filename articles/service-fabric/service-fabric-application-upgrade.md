---
title: "обновление приложения Fabric aaaService | Документы Microsoft"
description: "Эта статья содержит общие сведения tooupgrading приложения Service Fabric, включая выбор режимов обновления и выполнение проверок работоспособности."
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: timlt
editor: 
ms.assetid: 803c9c63-373a-4d6a-8ef2-ea97e16e88dd
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: 6f649ef4a5c0afab682522bcba7d2d66a4268ead
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-application-upgrade"></a><span data-ttu-id="959a3-103">Обновление приложения Service Fabric</span><span class="sxs-lookup"><span data-stu-id="959a3-103">Service Fabric application upgrade</span></span>
<span data-ttu-id="959a3-104">Приложение Azure Service Fabric представляет собой коллекцию служб.</span><span class="sxs-lookup"><span data-stu-id="959a3-104">An Azure Service Fabric application is a collection of services.</span></span> <span data-ttu-id="959a3-105">Во время обновления, Service Fabric сравнивает hello новый [манифест приложения](service-fabric-application-model.md#describe-an-application) с предыдущей версией hello и определяет, какие службы в приложение hello требуются обновления.</span><span class="sxs-lookup"><span data-stu-id="959a3-105">During an upgrade, Service Fabric compares hello new [application manifest](service-fabric-application-model.md#describe-an-application) with hello previous version and determines which services in hello application require updates.</span></span> <span data-ttu-id="959a3-106">Service Fabric сравнивает версию hello, номера в службе hello манифесты с номерами версий hello в предыдущей версии hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-106">Service Fabric compares hello version numbers in hello service manifests with hello version numbers in hello previous version.</span></span> <span data-ttu-id="959a3-107">Если служба не была изменена, эта служба не обновляется.</span><span class="sxs-lookup"><span data-stu-id="959a3-107">If a service has not changed, that service is not upgraded.</span></span>

## <a name="rolling-upgrades-overview"></a><span data-ttu-id="959a3-108">Обзор последовательных обновлений</span><span class="sxs-lookup"><span data-stu-id="959a3-108">Rolling upgrades overview</span></span>
<span data-ttu-id="959a3-109">В обновление приложения hello обновление выполняется поэтапно.</span><span class="sxs-lookup"><span data-stu-id="959a3-109">In a rolling application upgrade, hello upgrade is performed in stages.</span></span> <span data-ttu-id="959a3-110">На каждом этапе примененных tooa ограниченного набора узлов в кластере hello, называется домен обновления — обновление hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-110">At each stage, hello upgrade is applied tooa subset of nodes in hello cluster, called an update domain.</span></span> <span data-ttu-id="959a3-111">В результате приложение hello остается доступным в ходе обновления hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-111">As a result, hello application remains available throughout hello upgrade.</span></span> <span data-ttu-id="959a3-112">Во время обновления hello hello кластер может содержать сочетание hello старые и новые версии.</span><span class="sxs-lookup"><span data-stu-id="959a3-112">During hello upgrade, hello cluster may contain a mix of hello old and new versions.</span></span>

<span data-ttu-id="959a3-113">По этой причине hello двух версии должны быть прямую и обратную совместимость.</span><span class="sxs-lookup"><span data-stu-id="959a3-113">For that reason, hello two versions must be forward and backward compatible.</span></span> <span data-ttu-id="959a3-114">Если они не совместимы, администратор приложения hello отвечает за промежуточных доступности многоэтапный обновления toomaintain.</span><span class="sxs-lookup"><span data-stu-id="959a3-114">If they are not compatible, hello application administrator is responsible for staging a multiple-phase upgrade toomaintain availability.</span></span> <span data-ttu-id="959a3-115">При обновлении многоэтапный hello первым шагом является обновление tooan промежуточной версией приложения hello, совместимую с предыдущей версии hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-115">In a multiple-phase upgrade, hello first step is upgrading tooan intermediate version of hello application that is compatible with hello previous version.</span></span> <span data-ttu-id="959a3-116">второй шаг Hello-tooupgrade hello окончательного версия прерывается совместимости с версией hello перед обновлением, но совместима с версией промежуточного hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-116">hello second step is tooupgrade hello final version that breaks compatibility with hello pre-update version, but is compatible with hello intermediate version.</span></span>

<span data-ttu-id="959a3-117">Домены обновления указаны в манифесте кластера hello при настройке кластера hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-117">Update domains are specified in hello cluster manifest when you configure hello cluster.</span></span> <span data-ttu-id="959a3-118">Домены обновления не получают обновления в определенном порядке.</span><span class="sxs-lookup"><span data-stu-id="959a3-118">Update domains do not receive updates in a particular order.</span></span> <span data-ttu-id="959a3-119">Домен обновления представляет собой логическую единицу, в пределах которой развертывается то или иное приложение.</span><span class="sxs-lookup"><span data-stu-id="959a3-119">An update domain is a logical unit of deployment for an application.</span></span> <span data-ttu-id="959a3-120">Домены обновления допускает tooremain hello служб на высокий уровень доступности во время обновления.</span><span class="sxs-lookup"><span data-stu-id="959a3-120">Update domains allow hello services tooremain at high availability during an upgrade.</span></span>

<span data-ttu-id="959a3-121">Не чередующихся обновлений возможны, если обновление hello примененных tooall узлов в кластере hello, что случается hello, когда приложение hello имеет только один домен обновления.</span><span class="sxs-lookup"><span data-stu-id="959a3-121">Non-rolling upgrades are possible if hello upgrade is applied tooall nodes in hello cluster, which is hello case when hello application has only one update domain.</span></span> <span data-ttu-id="959a3-122">Такой подход не рекомендуется, так как служба hello выходит из строя и недоступен во время обновления hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-122">This approach is not recommended, since hello service goes down and isn't available at hello time of upgrade.</span></span> <span data-ttu-id="959a3-123">Кроме того, Azure не предоставляет никаких гарантий в случаях, когда кластер настраивается только с одним доменом обновления.</span><span class="sxs-lookup"><span data-stu-id="959a3-123">Additionally, Azure doesn't provide any guarantees when a cluster is set up with only one update domain.</span></span>

## <a name="health-checks-during-upgrades"></a><span data-ttu-id="959a3-124">Проверки работоспособности во время обновления</span><span class="sxs-lookup"><span data-stu-id="959a3-124">Health checks during upgrades</span></span>
<span data-ttu-id="959a3-125">Для обновления политики работоспособности toobe установить (или может использовать значения по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="959a3-125">For an upgrade, health policies have toobe set (or default values may be used).</span></span> <span data-ttu-id="959a3-126">Обновление называется успешно при обновлении версии всех доменов обновления в hello указанное время ожидания, и при обновлении все домены, считаются работоспособное.</span><span class="sxs-lookup"><span data-stu-id="959a3-126">An upgrade is termed successful when all update domains are upgraded within hello specified time-outs, and when all update domains are deemed healthy.</span></span>  <span data-ttu-id="959a3-127">Домен работоспособное обновления означает, что этот домен обновления hello передать все проверки работоспособности hello, указанным в политике работоспособности hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-127">A healthy update domain means that hello update domain passed all hello health checks specified in hello health policy.</span></span> <span data-ttu-id="959a3-128">Например, политика работоспособности может подразумевать обязательную *работоспособность*всех служб в экземпляре приложения, так как работоспособность определяется Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="959a3-128">For example, a health policy may mandate that all services within an application instance must be *healthy*, as health is defined by Service Fabric.</span></span>

<span data-ttu-id="959a3-129">Политики работоспособности и проверки во время обновлений средствами Service Fabric не опираются на службы и приложения.</span><span class="sxs-lookup"><span data-stu-id="959a3-129">Health policies and checks during upgrade by Service Fabric are service and application agnostic.</span></span> <span data-ttu-id="959a3-130">Это означает, что проверок, зависящих от конкретных служб, не выполняется.</span><span class="sxs-lookup"><span data-stu-id="959a3-130">That is, no service-specific tests are done.</span></span>  <span data-ttu-id="959a3-131">Например служба может иметь требование пропускной способности, но Service Fabric имеет пропускную способность toocheck сведения hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-131">For example, your service might have a throughput requirement, but Service Fabric does not have hello information toocheck throughput.</span></span> <span data-ttu-id="959a3-132">См. toohello [работоспособности статьи](service-fabric-health-introduction.md) для выполняемые проверки hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-132">Refer toohello [health articles](service-fabric-health-introduction.md) for hello checks that are performed.</span></span> <span data-ttu-id="959a3-133">проверяет Hello, происходящие во время обновления include проверяет ли пакет приложения hello был скопирован правильно, является ли экземпляр hello был запущен и т. д.</span><span class="sxs-lookup"><span data-stu-id="959a3-133">hello checks that happen during an upgrade include tests for whether hello application package was copied correctly, whether hello instance was started, and so on.</span></span>

<span data-ttu-id="959a3-134">работоспособность приложения Hello является сочетанием hello дочерних сущностей этого приложения hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-134">hello application health is an aggregation of hello child entities of hello application.</span></span> <span data-ttu-id="959a3-135">Иными словами Service Fabric оценивает работоспособность приложения hello через работоспособности hello, полученных с приложение hello hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-135">In short, Service Fabric evaluates hello health of hello application through hello health that is reported on hello application.</span></span> <span data-ttu-id="959a3-136">Он также проверяет hello работоспособности всех hello служб для приложения hello, таким образом.</span><span class="sxs-lookup"><span data-stu-id="959a3-136">It also evaluates hello health of all hello services for hello application this way.</span></span> <span data-ttu-id="959a3-137">Service Fabric дальнейшей оценки работоспособности hello служб приложения hello, применяя статистическую обработку работоспособности hello дочерние объекты, такие как hello реплики службы.</span><span class="sxs-lookup"><span data-stu-id="959a3-137">Service Fabric further evaluates hello health of hello application services by aggregating hello health of their children, such as hello service replica.</span></span> <span data-ttu-id="959a3-138">Политика работоспособности приложения hello удовлетворяется, откройте hello обновления.</span><span class="sxs-lookup"><span data-stu-id="959a3-138">Once hello application health policy is satisfied, hello upgrade can proceed.</span></span> <span data-ttu-id="959a3-139">В случае нарушения политики работоспособности hello обновление приложения hello завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="959a3-139">If hello health policy is violated, hello application upgrade fails.</span></span>

## <a name="upgrade-modes"></a><span data-ttu-id="959a3-140">Режимы обновления</span><span class="sxs-lookup"><span data-stu-id="959a3-140">Upgrade modes</span></span>
<span data-ttu-id="959a3-141">Привет, рекомендуется использовать для обновления приложения используется hello отслеживаемых режим hello обычно используется режим.</span><span class="sxs-lookup"><span data-stu-id="959a3-141">hello mode that we recommend for application upgrade is hello monitored mode, which is hello commonly used mode.</span></span> <span data-ttu-id="959a3-142">Отслеживаемых режиме выполняется обновление hello на одно обновление домена и если проверяет работоспособность всех проход (согласно hello политике указан), перемещается на следующий домен обновления toohello автоматически.</span><span class="sxs-lookup"><span data-stu-id="959a3-142">Monitored mode performs hello upgrade on one update domain, and if all health checks pass (per hello policy specified), moves on toohello next update domain automatically.</span></span>  <span data-ttu-id="959a3-143">Если проверок работоспособности и/или достижении значения времени ожидания, обновление hello либо откат для домена обновления hello или hello режим — измененные toounmonitored вручную.</span><span class="sxs-lookup"><span data-stu-id="959a3-143">If health checks fail and/or time-outs are reached, hello upgrade is either rolled back for hello update domain, or hello mode is changed toounmonitored manual.</span></span> <span data-ttu-id="959a3-144">Вы можете настроить hello обновления toochoose одного из этих двух режимов сбоя обновления.</span><span class="sxs-lookup"><span data-stu-id="959a3-144">You can configure hello upgrade toochoose one of those two modes for failed upgrades.</span></span> 

<span data-ttu-id="959a3-145">Не отслеживается в ручном режиме необходимо вмешательство после каждого обновления на домен обновления, tookick off hello обновления на hello следующего домена обновления.</span><span class="sxs-lookup"><span data-stu-id="959a3-145">Unmonitored manual mode needs manual intervention after every upgrade on an update domain, tookick off hello upgrade on hello next update domain.</span></span> <span data-ttu-id="959a3-146">Проверок работоспособности Service Fabric не выполняется.</span><span class="sxs-lookup"><span data-stu-id="959a3-146">No Service Fabric health checks are performed.</span></span> <span data-ttu-id="959a3-147">Здравствуйте, администратор выполняет проверку работоспособности или состояния hello, перед запуском обновления hello в следующий домен обновления hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-147">hello administrator performs hello health or status checks before starting hello upgrade in hello next update domain.</span></span>

## <a name="upgrade-default-services"></a><span data-ttu-id="959a3-148">Обновление служб по умолчанию</span><span class="sxs-lookup"><span data-stu-id="959a3-148">Upgrade default services</span></span>
<span data-ttu-id="959a3-149">По умолчанию служб внутри приложения Service Fabric могут быть обновлены во время обновления hello приложения.</span><span class="sxs-lookup"><span data-stu-id="959a3-149">Default services within Service Fabric application can be upgraded during hello upgrade process of an application.</span></span> <span data-ttu-id="959a3-150">По умолчанию службы задаются в hello [манифест приложения](service-fabric-application-model.md#describe-an-application).</span><span class="sxs-lookup"><span data-stu-id="959a3-150">Default services are defined in hello [application manifest](service-fabric-application-model.md#describe-an-application).</span></span> <span data-ttu-id="959a3-151">используются стандартные правила Hello обновления службы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="959a3-151">hello standard rules of upgrading default services are:</span></span>

1. <span data-ttu-id="959a3-152">По умолчанию службы в новый hello [манифест приложения](service-fabric-application-model.md#describe-an-application) , не существуют в кластере hello создаются.</span><span class="sxs-lookup"><span data-stu-id="959a3-152">Default services in hello new [application manifest](service-fabric-application-model.md#describe-an-application) that do not exist in hello cluster are created.</span></span>
> [!TIP]
> <span data-ttu-id="959a3-153">[EnableDefaultServicesUpgrade](service-fabric-cluster-fabric-settings.md#fabric-settings-that-you-can-customize) требуется toobe набор правил hello tooenable tootrue.</span><span class="sxs-lookup"><span data-stu-id="959a3-153">[EnableDefaultServicesUpgrade](service-fabric-cluster-fabric-settings.md#fabric-settings-that-you-can-customize) needs toobe set tootrue tooenable hello following rules.</span></span> <span data-ttu-id="959a3-154">Эта функция поддерживается, начиная с версии 5.5.</span><span class="sxs-lookup"><span data-stu-id="959a3-154">This feature is supported from v5.5.</span></span>

2. <span data-ttu-id="959a3-155">Службы по умолчанию, существующие в предыдущей и новой версиях [манифеста приложения](service-fabric-application-model.md#describe-an-application), обновляются.</span><span class="sxs-lookup"><span data-stu-id="959a3-155">Default services existing in both previous [application manifest](service-fabric-application-model.md#describe-an-application) and new version are updated.</span></span> <span data-ttu-id="959a3-156">Описания службы в новой версии hello перезапишет уже в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="959a3-156">Service descriptions in hello new version would overwrite those already in hello cluster.</span></span> <span data-ttu-id="959a3-157">При сбое обновления служб по умолчанию автоматически выполняется откат обновления приложения.</span><span class="sxs-lookup"><span data-stu-id="959a3-157">Application upgrade would rollback automatically upon updating default service failure.</span></span>
3. <span data-ttu-id="959a3-158">По умолчанию службы в предыдущем hello [манифест приложения](service-fabric-application-model.md#describe-an-application) , но не в новой версии hello удаляются.</span><span class="sxs-lookup"><span data-stu-id="959a3-158">Default services in hello previous [application manifest](service-fabric-application-model.md#describe-an-application) but not in hello new version are deleted.</span></span> <span data-ttu-id="959a3-159">**Обратите внимание, что это удаление служб по умолчанию невозможно отменить.**</span><span class="sxs-lookup"><span data-stu-id="959a3-159">**Note that this deleting default services can not be reverted.**</span></span>

<span data-ttu-id="959a3-160">В случае, если приложения обновления выполняется откат, службы по умолчанию, возвращенной toohello состояние до начала обновления.</span><span class="sxs-lookup"><span data-stu-id="959a3-160">In case of an application upgrade is rolled back, default services are reverted toohello status before upgrade started.</span></span> <span data-ttu-id="959a3-161">Но создать удаленные службы будет невозможно.</span><span class="sxs-lookup"><span data-stu-id="959a3-161">But deleted services can never be created.</span></span>

## <a name="application-upgrade-flowchart"></a><span data-ttu-id="959a3-162">Блок-схема обновления приложения</span><span class="sxs-lookup"><span data-stu-id="959a3-162">Application upgrade flowchart</span></span>
<span data-ttu-id="959a3-163">Блок-схема Hello ниже поможет вам понять процесс обновления hello приложения Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="959a3-163">hello flowchart following this paragraph can help you understand hello upgrade process of a Service Fabric application.</span></span> <span data-ttu-id="959a3-164">В частности, описывает hello потока как hello тайм-аутов, включая *HealthCheckStableDuration*, *HealthCheckRetryTimeout*, и *UpgradeHealthCheckInterval*, помогают управлять тем, когда обновление hello в доменах одно обновление, считается успеха или сбоя.</span><span class="sxs-lookup"><span data-stu-id="959a3-164">In particular, hello flow describes how hello time-outs, including *HealthCheckStableDuration*, *HealthCheckRetryTimeout*, and *UpgradeHealthCheckInterval*, help control when hello upgrade in one update domain is considered a success or a failure.</span></span>

![процесс обновления Hello для структуры приложения службы][image]

## <a name="next-steps"></a><span data-ttu-id="959a3-166">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="959a3-166">Next steps</span></span>
<span data-ttu-id="959a3-167">[Руководство по обновлению приложений Service Fabric с помощью Visual Studio](service-fabric-application-upgrade-tutorial.md) поможет вам выполнить поэтапное обновление приложения с помощью Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="959a3-167">[Upgrading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="959a3-168">[Обновление приложения с помощью PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) поможет вам выполнить обновление приложения с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="959a3-168">[Upgrading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="959a3-169">Управление обновлениями приложения осуществляется с помощью [параметров обновления](service-fabric-application-upgrade-parameters.md).</span><span class="sxs-lookup"><span data-stu-id="959a3-169">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="959a3-170">Обеспечить совместимость на обновление приложения путем изучения как toouse [сериализации данных](service-fabric-application-upgrade-data-serialization.md).</span><span class="sxs-lookup"><span data-stu-id="959a3-170">Make your application upgrades compatible by learning how toouse [Data Serialization](service-fabric-application-upgrade-data-serialization.md).</span></span>

<span data-ttu-id="959a3-171">Узнайте, как toouse расширенные функции при обновлении приложения с помощью ссылки слишком[дополнительные разделы](service-fabric-application-upgrade-advanced.md).</span><span class="sxs-lookup"><span data-stu-id="959a3-171">Learn how toouse advanced functionality while upgrading your application by referring too[Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="959a3-172">Исправьте распространенных проблем в обновлений приложений с помощью ссылки действия toohello в [Устранение неполадок обновлений приложений](service-fabric-application-upgrade-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="959a3-172">Fix common problems in application upgrades by referring toohello steps in [Troubleshooting Application Upgrades](service-fabric-application-upgrade-troubleshooting.md).</span></span>

[image]: media/service-fabric-application-upgrade/service-fabric-application-upgrade-flowchart.png
