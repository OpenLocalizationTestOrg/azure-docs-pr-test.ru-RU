---
title: "Обновление приложения Service Fabric | Документация Майкрософт"
description: "Эта статья содержит вводные сведения об обновлении приложения Service Fabric, включая выбор режимов обновления и выполнение проверок работоспособности."
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: timlt
editor: 
ms.assetid: 803c9c63-373a-4d6a-8ef2-ea97e16e88dd
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: 5fed3b5b127a2b398b99ab2b46c762920e9dc249
ms.sourcegitcommit: e266df9f97d04acfc4a843770fadfd8edf4fa2b7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2017
---
# <a name="service-fabric-application-upgrade"></a>Обновление приложения Service Fabric
Приложение Azure Service Fabric представляет собой коллекцию служб. Во время обновления структура служб сравнивает новый [манифест приложения](service-fabric-application-and-service-manifests.md) с предыдущей версией и определяет, каким службам в приложении требуется обновление. Service Fabric сравнивает номера версий в манифестах служб с номерами версий для предыдущей версии. Если служба не была изменена, эта служба не обновляется.

## <a name="rolling-upgrades-overview"></a>Обзор последовательных обновлений
При последовательном обновлении приложения обновление выполняется поэтапно. На каждом этапе обновление применяется к определенному подмножеству узлов в кластере, который называется доменом обновления. В результате этого приложение остается доступным в течение всего времени обновления. Во время обновления в кластере может содержаться сочетание старых и новых версий приложения.

По этой причине обе версии должны обладать прямой и обратной совместимостью. Если такая совместимость отсутствует, администратор приложения несет ответственность за поэтапное многофазное обновление для обеспечения доступности. При многоэтапном обновлении сначала выполняется обновление до промежуточной версии приложения, которая совместима с предыдущей версией. Затем выполняется обновление до окончательной версии, которая несовместима с версией, предшествующей обновлению, но совместима с промежуточной версией.

Домены обновления указываются в манифесте кластера при его настройке. Домены обновления не получают обновления в определенном порядке. Домен обновления представляет собой логическую единицу, в пределах которой развертывается то или иное приложение. Домены обновления позволяют сохранять высокий уровень доступности служб во время обновления.

Непоследовательные обновления возможны в том случае, если обновление применяется ко всем узлам кластера, что и происходит, если у приложения имеется только один домен обновления. Этот подход не рекомендуется, так как служба будет отключена и недоступна в течение процесса обновления. Кроме того, Azure не предоставляет никаких гарантий в случаях, когда кластер настраивается только с одним доменом обновления.

По завершении обновления все службы и реплики (экземпляры) будут одной и той же версии, то есть, если обновление будет успешным, они будут обновлены до новой версии. Если обновление завершится неудачей и будет выполнен откат, они будут возвращены к старой версии.

## <a name="health-checks-during-upgrades"></a>Проверки работоспособности во время обновления
Для обновления необходимо настроить политики работоспособности (могут также использоваться значения по умолчанию). Обновление считается успешным, когда все домены обновления обновлены в пределах заданного времени ожидания, а все домены обновления считаются работоспособными.  Работоспособное обновление домена означает, что обновленный домен прошел все проверки работоспособности, указанные в политике работоспособности. Например, политика работоспособности может подразумевать обязательную *работоспособность*всех служб в экземпляре приложения, так как работоспособность определяется Service Fabric.

Политики работоспособности и проверки во время обновлений средствами Service Fabric не опираются на службы и приложения. Это означает, что проверок, зависящих от конкретных служб, не выполняется.  Например, службе может требоваться определенная пропускная способность, но в Service Fabric отсутствуют сведения для проверки пропускной способности. Сведения о выполняемых проверках см. в [статьях о работоспособности](service-fabric-health-introduction.md). Проверки, которые происходят во время обновления, включают проверки того, был ли пакет приложения скопирован правильно, был ли экземпляр запущен и т. д.

Работоспособность приложения фактически представляет собой коллекцию дочерних сущностей приложения. Одним словом, Service Fabric выполняет оценку работоспособности приложения по данным о работоспособности, которые передает само приложение. Она также проверяет работоспособность всех служб приложения таким образом. Service Fabric выполняет дальнейшую проверку работоспособности служб приложения путем статистической обработки данных о работоспособности их дочерних элементов, таких как реплики служб. После того как политика работоспособности приложения удовлетворена, обновление продолжается. При нарушении политики работоспособности обновление приложения считается неудачным.

## <a name="upgrade-modes"></a>Режимы обновления
Мы рекомендуем использовать для обновления приложения отслеживаемый режим. Он используется наиболее часто. В отслеживаемом режиме обновление выполняется на одном домене обновления. При успешном разрешении всех проверок безопасности (в соответствии с заданной политикой) осуществляется автоматический переход к следующему домену обновления.  Если проверки работоспособности завершаются ошибкой и (или) превышено время ожидания, то выполняется либо откат обновления для домена обновления, либо изменение режима на неотслеживаемый ручной. Вы можете настроить обновление, чтобы выбрать один из этих двух режимов для обновлений, завершенных ошибкой. 

При использовании неотслеживаемого ручного режима после каждого обновления домена обновления потребуется вручную запустить обновление на следующем домене обновления. Проверок работоспособности Service Fabric не выполняется. Администратор проверяет работоспособность или состояние перед запуском обновления в следующем домене обновления.

## <a name="upgrade-default-services"></a>Обновление служб по умолчанию
Службы по умолчанию внутри приложения Service Fabric могут быть обновлены во время обновления приложения. Службы по умолчанию определяются в [манифесте приложения](service-fabric-application-and-service-manifests.md). Применяются следующие стандартные правила обновления служб по умолчанию.

1. Если службы по умолчанию, определенные в новом [манифесте приложения](service-fabric-application-and-service-manifests.md), не существуют в кластере, то они создаются.
> [!TIP]
> Чтобы включить приведенные правила, для [EnableDefaultServicesUpgrade](service-fabric-cluster-fabric-settings.md) необходимо задать значение true. Эта функция поддерживается, начиная с версии 5.5.

2. Службы по умолчанию, существующие в предыдущей и новой версиях [манифеста приложения](service-fabric-application-and-service-manifests.md), обновляются. Описания служб в новой версии заменят описания, уже используемые в кластере. При сбое обновления служб по умолчанию автоматически выполняется откат обновления приложения.
3. Службы по умолчанию, присутствующие в предыдущем [манифесте приложения](service-fabric-application-and-service-manifests.md), но отсутствующие в его новой версии, удаляются. **Обратите внимание, что это удаление служб по умолчанию невозможно отменить.**

В случае отката обновления приложения будет возвращено состояние служб по умолчанию на момент до начала обновления. Но создать удаленные службы будет невозможно.

## <a name="application-upgrade-flowchart"></a>Блок-схема обновления приложения
Блок-схема, приведенная далее в этом абзаце, поможет понять процесс обновления приложения Service Fabric. В частности, она описывает, как параметры времени ожидания, в том числе *HealthCheckStableDuration*, *HealthCheckRetryTimeout* и *UpgradeHealthCheckInterval*, помогают управлять тем, при каких условиях обновление домена обновления считается успешным или неудачным.

![Процесс обновления приложения структуры служб][image]

## <a name="next-steps"></a>Дальнейшие действия
[Руководство по обновлению приложений Service Fabric с помощью Visual Studio](service-fabric-application-upgrade-tutorial.md) поможет вам выполнить поэтапное обновление приложения с помощью Visual Studio.

[Обновление приложения с помощью PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) поможет вам выполнить обновление приложения с помощью PowerShell.

Управление обновлениями приложения осуществляется с помощью [параметров обновления](service-fabric-application-upgrade-parameters.md).

Узнайте, как использовать [сериализацию данных](service-fabric-application-upgrade-data-serialization.md), чтобы обеспечить совместимость обновлений приложения.

[Дополнительные разделы](service-fabric-application-upgrade-advanced.md)содержат сведения о работе с расширенными функциями при обновлении приложения.

Сведения об устранении распространенных проблем при обновлении приложений см. в статье [Устранение неполадок при обновлениях приложений](service-fabric-application-upgrade-troubleshooting.md).

[image]: media/service-fabric-application-upgrade/service-fabric-application-upgrade-flowchart.png
