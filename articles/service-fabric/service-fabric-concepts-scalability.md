---
title: "aaaScalability служб Service Fabric | Документы Microsoft"
description: "Описывает способ tooscale служб Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: ed324f23-242f-47b7-af1a-e55c839e7d5d
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 5af06f8f71ad5dee32ba115b922842684867e654
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="scaling-in-service-fabric"></a>Масштабирование в Service Fabric
Azure Service Fabric делает его легко toobuild масштабируемых приложений, управление службами hello, секций и реплик на узлах кластера hello. Выполнение многих рабочих нагрузок hello же об использовании ресурсов оборудования позволяет, но также обеспечивает гибкость с точки зрения Выбор tooscale рабочих нагрузок. 

В Service Fabric масштабирования осуществляется несколькими способами:

1. масштабирование путем создания или удаления экземпляров службы без отслеживания состояния;
2. масштабирование путем создания или удаления новых именованных служб;
3. масштабирование путем создания или удаления новых именованных экземпляров приложений;
4. масштабирование с использованием секционированных служб;
5. Масштабирование путем добавления и удаления узлов из кластера hello 
6. масштабирование с помощью метрик диспетчера кластерных ресурсов.

## <a name="scaling-by-creating-or-removing-stateless-service-instances"></a>Масштабирование путем создания или удаления экземпляров службы без отслеживания состояния
Один простой tooscale способов hello в Service Fabric работает с службы без сохранения состояния. При создании службы без отслеживания состояния, вы получаете toodefine вероятность `InstanceCount`. `InstanceCount`Определяет, сколько работающие копии этой службы кода создаются при запуске службы hello. Предположим, например, 100 узлов в кластере hello. Предположим также, что служба создается с параметром `InstanceCount`, равным 10. Во время выполнения эти 10 работающие копии кода hello все станут слишком занят (или может не быть достаточно занят). Одним из способов tooscale что рабочая нагрузка является toochange hello число экземпляров. Например некоторые части кода, мониторинга и управления можно изменить hello существующего количества экземпляров too50 или too5, в зависимости от того, должен ли рабочая нагрузка hello tooscale in или out на основе hello загрузки. 

C#:

```csharp
StatelessServiceUpdateDescription updateDescription = new StatelessServiceUpdateDescription(); 
updateDescription.InstanceCount = 50;
await fabricClient.ServiceManager.UpdateServiceAsync(new Uri("fabric:/app/service"), updateDescription);
```

PowerShell:

```posh
Update-ServiceFabricService -Stateless -ServiceName $serviceName -InstanceCount 50
```
### <a name="using-dynamic-instance-count"></a>Использование динамического числа экземпляров
Специально для службы без сохранения состояния Service Fabric предлагает число экземпляров hello toochange автоматическим способом. Это позволяет tooscale службы hello динамически с hello количеством доступные узлы. tooopt способом Hello на это поведение является число экземпляров hello tooset = -1. InstanceCount = -1 — инструкция tooService структуры с надписью «Запустить эту службу без отслеживания состояния на каждом узле». При изменении номера hello узлов Service Fabric автоматически изменяет toomatch число экземпляр hello, гарантирует, что hello запущена на всех узлах допустимым. 

C#:

```csharp
StatelessServiceDescription serviceDescription = new StatelessServiceDescription();
//Set other service properties necessary for creation....
serviceDescription.InstanceCount = -1;
await fc.ServiceManager.CreateServiceAsync(serviceDescription);
```

PowerShell:

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName -Stateless -PartitionSchemeSingleton -InstanceCount "-1"
```

## <a name="scaling-by-creating-or-removing-new-named-services"></a>масштабирование путем создания или удаления новых именованных служб;
Экземпляр службы является экземпляр типа службы (в разделе [жизненного цикла приложения Service Fabric](service-fabric-application-lifecycle.md)) в некоторых именованный экземпляр приложения в кластере hello. 

Новые именованные экземпляры службы могут создаваться (или удаляться) при повышении (или снижении) нагрузки службы. Это позволяет распределить по несколько экземпляров службы, обычно разрешение загрузки для существующих служб toodecrease toobe запросов. При создании служб, hello диспетчер ресурсов кластера Service Fabric помещает hello службы в кластере hello распределенных образом. точные решения Hello управляются hello [метрики](service-fabric-cluster-resource-manager-metrics.md) в кластере hello и другие правила размещения. Службы можно создать несколькими способами, однако hello чаще всего либо через административных действий, таких как вызывающий [ `New-ServiceFabricService` ](https://docs.microsoft.com/en-us/powershell/module/servicefabric/new-servicefabricservice?view=azureservicefabricps), или код, вызывающий [ `CreateServiceAsync` ](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricclient.servicemanagementclient.createserviceasync?view=azure-dotnet). `CreateServiceAsync`Можно даже вызвать из других служб, выполняющихся в кластере hello.

Динамическое создание служб можно использовать во всех видах сценариев, это общепринятая практика. Например, рассмотрим службу с отслеживанием состояния, которая представляет определенный рабочий процесс. Вызовы, представляющий работу будет tooshow toothis службы, и эта служба является постоянной tooexecute hello действия toothat рабочего процесса и записи о ходе выполнения. 

Как сделать этот масштаб конкретной службы? Hello службы может быть нескольких клиентов в определенной форме и принимать вызовы и начнем действия для многих различных экземпляров hello же рабочего процесса за один раз. Тем не менее, может сделать hello код сложнее, поскольку теперь tooworry о многих различных экземпляров hello того же рабочего процесса, все на разных этапах и от различных клиентов. Кроме того, обработка несколько рабочих процессов, в то же время не устранит hello hello масштаб проблемы. Это потому, что в определенный момент эта служба будет занимать слишком много ресурсов toofit на конкретном компьютере. Многие службы, не создан для этого шаблона на первом месте hello также затруднений оплаты toosome специфические узким местом или замедление в своем коде. Подобные проблемы вызвать службу hello не toowork также при hello количество одновременных рабочих процессов, которые он отслеживает увеличивается.  

Решением является toocreate экземпляр службы каждый другой экземпляр рабочего процесса hello требуется tootrack. Это отличный шаблон, работает ли служба hello без сохранения состояния или с отслеживанием состояния. Для этого toowork шаблон имеется обычно другой службы, которая выступает в роли «Служба диспетчера рабочей нагрузки». Задание Hello этой службы является tooreceive запросы и tooroute tooother этих запросов служб. Диспетчер Hello можно динамически создать экземпляр службы hello рабочей нагрузки при получении сообщения hello, а затем передайте в службах toothose запросов. Служба диспетчера Hello также может получать обратные вызовы службы рабочего процесса по завершении этого задания. При получении диспетчером hello эти обратные вызовы его удалось удалить этот экземпляр службы рабочего процесса hello, или оставить его, если ожидается, что дополнительные вызовы. 

Дополнительных версий этого типа диспетчера, можно создавать пулы служб hello, которыми он управляет. пул Hello помогает убедитесь, что при поступлении нового запроса он не toowait для hello службы toospin. Вместо этого диспетчер hello можно просто выбрать службы рабочего процесса, не является в настоящее время занято из пула hello, или маршрутизации случайным образом. Поддержание пула доступных служб ускоряется обработки новых запросов, так как она является менее вероятно, у этого запроса hello toowait для новой службы toobe, зацикливается. Новые службы создаются быстро, но не бесплатно и не мгновенно. Hello пула позволяет минимизировать период времени, hello запрос имеет toowait перед обслуживаемые hello. Вы увидите этот диспетчер и пула шаблон часто при отклика интересующим hello. Очереди запросов hello и создание службы hello в фоновом режиме hello и _затем_ передача его также является шаблон популярных manager как является создание и удаление служб, основанных на некоторых отслеживание hello объем работы этой службы в настоящее время имеет ожидающие. 

## <a name="scaling-by-creating-or-removing-new-named-application-instances"></a>Масштабирование путем создания или удаления новых именованных экземпляров приложений
Создание и удаление экземпляров всего приложения является аналогичный toohello шаблон создания и удаления служб. Для этого шаблона отсутствует некоторые service manager, предоставляющего hello принятия решений на основе запросов hello, он видит и другие службы внутри кластера hello hello hello сведений, которые он получает из. 

В каких случаях должен создаваться новый именованный экземпляр приложения, а не новые именованные экземпляры службы в существующем приложении? Таких случаев несколько.

  * новый экземпляр приложения Hello предназначено для клиента, код должен toorun в некоторых конкретное удостоверение или параметры безопасности.
    * Service Fabric возможность определения toorun пакеты другой код под определенной удостоверениями. В порядке toolaunch hello того же пакета кода под разными учетными записями, активаций hello должны toooccur в экземплярах другого приложения. Предположим, в вашей среде развернуты рабочие нагрузки клиента. Они могут выполняться в конкретное удостоверение, чтобы можно было отслеживать и управлять tooother их доступа к ресурсам, например удаленных баз данных или других систем. В этом случае когда регистрируется новый клиент, вероятно, необходимо исключить tooactivate кода hello того же контекста (пространство процесса). Хотя можно было бы это затрудняет для вашего tooact кода службы в контексте hello конкретное удостоверение. Обычно требуется дополнительный код для защиты, изоляции и управления удостоверениями. Вместо использования различных с именем службы экземпляры внутри одного экземпляра приложения hello и поэтому hello же пространстве процесса, можно использовать различные именованные экземпляры структуры приложения службы. Это позволяет проще контексты toodefine другим удостоверением.
  * новый экземпляр приложения Hello также служит в качестве средства конфигурации
    * По умолчанию все именованные экземпляры службы типа конкретной службы в пределах экземпляра приложения hello будет выполняться в hello же процесс на заданном узле. Это означает, что хотя каждый экземпляр службы можно настроить по-разному, сделать это сложно. Службы должны иметь некоторые токен, они используют toolook вверх их конфигурации в рамках конфигурации пакета. Обычно это просто имя службы hello. Это работает отлично, но он связывает hello конфигурации toohello имена экземпляров отдельные службы hello в пределах данного экземпляра приложения. Это может вызывать путаницу и жестких toomanage с момента конфигурации обычно является артефактом времени разработки с определенными значениями экземпляра приложения. Создание нескольких служб всегда означает дополнительные обновления приложения toochange сведения hello в пакеты конфигурации hello или toodeploy новые, чтобы их определенные сведения можно найти новые службы hello. Часто бывает проще toocreate совершенно новый именованный экземпляр приложения. Затем можно использовать tooset параметры приложения hello, независимо от настройки не требуется для служб hello. Таким образом, все службы hello, созданных в пределах, именованный экземпляр приложения может наследовать параметры конкретной конфигурации. Например вместо того, один файл конфигурации с hello параметры и настройки для каждого клиента, такие как секреты или за пределы ресурсов клиента, вместо этого пришлось бы экземпляр другое приложение для каждого клиента с помощью этих параметров переопределить. 
  * новое приложение Hello служит границу обновления
    * В Service Fabric разные именованные экземпляры приложения служат в качестве границы для обновления. Обновление один именованный экземпляр приложения не влияет на код hello, на котором выполняется другой именованный экземпляр приложения. Hello различных приложений будет заканчиваться под управлением других версий hello же код на hello разным узлам. Это может быть фактор, при необходимости toomake масштабирования принятия решений, так как вы можете ли новый код hello должен следовать за hello же обновляет как другая служба или нет. Например, вызов достигает службы диспетчера hello, который отвечает за масштабирование рабочих нагрузок конкретного клиента путем создания и удаления служб динамически. В этом случае вызов hello то, для рабочей нагрузки, связанные с _новый_ клиента. Большинство пользователей как отделены друг от друга не только для hello и настройка безопасности причинам, перечисленным выше, но так как он обеспечивает большую гибкость с точки зрения под управлением определенных версий программного обеспечения hello и выбрав когда они обновляются. Можно также создать новый экземпляр приложения и создать службу hello существует просто toofurther секции hello сумма служб, которые затрагивает одного обновления. Отдельные экземпляры приложения обеспечивают большую детализацию при обновлении приложений, а также позволяют использовать тестирование A/B и развертывания Blue-Green. 
  * существующий экземпляр приложения Hello заполнен
    * В Service Fabric [емкость приложения](service-fabric-cluster-resource-manager-application-groups.md) — это понятие, toocontrol hello объем доступных ресурсов можно использовать для экземпляров конкретного приложения. Например вы можете решить, что данной службе должна toohave другим экземпляром, созданным в tooscale порядке. Однако этот экземпляр приложения превышает емкость для определенной метрики. Если этого конкретного клиента или рабочей нагрузки следует по-прежнему предоставить больше ресурсов, затем можно либо увеличить емкость существующих hello для этого приложения или создайте новое приложение. 

## <a name="scaling-at-hello-partition-level"></a>Масштабирование на уровне секции hello
Service Fabric поддерживает секционирование. Секционирование позволяет разделить службы на несколько логических и физических секций, каждая из которых работает независимо друг от друга. Это удобно использовать с отслеживанием состояния служб, поскольку ни один набор реплик есть toohandle все вызовы hello и управления всеми hello состояние за один раз. Hello [секционирование Обзор](service-fabric-concepts-partitioning.md) содержит сведения о типах hello схем секционирования, которые поддерживаются. Hello реплики каждой секции распределены по hello узлов в кластере, распределение нагрузки для этой службы и проверку того, ни hello службе в целом или любого раздела имеет единую точку сбоя. 

Рассмотрим службу, использующую схему секционирования по диапазонам, в которой нижний ключ равен 0, верхний ключ равен 99, а количество разделов равно 4. В кластере три узла службы hello может располагаться с 4 реплик, совместно использующих ресурсы hello на каждом узле, как показано ниже:

<center>
![Распределение разделов с тремя узлами](./media/service-fabric-concepts-scalability/layout-three-nodes.png)
</center>

Если увеличить количество узлов в hello Service Fabric будет переместить некоторые из существующих реплик hello существует. Например предположим, что hello узлы возрастает toofour и получить перераспределения hello реплик. Теперь служба hello теперь имеет три реплики, которые выполняются на каждом узле, каждый принадлежащий toodifferent секций. Это позволяет более эффективное использование ресурсов, поскольку новый узел hello не холодного. Как правило она также повышает производительность как каждая служба имеет несколько доступных tooit ресурсов.

<center>
![Распределение разделов с четырьмя узлами](./media/service-fabric-concepts-scalability/layout-four-nodes.png)
</center>

## <a name="scaling-by-using-hello-service-fabric-cluster-resource-manager-and-metrics"></a>Масштабирование, используя диспетчер ресурсов кластера Service Fabric hello и метрики
[Метрики](service-fabric-cluster-resource-manager-metrics.md) являются как службы express их tooService потребления ресурсов структуры. С помощью метрики дает возможность tooreorganize hello диспетчер ресурсов кластера и оптимизировать макет hello hello кластера. Например может быть большое количество ресурсов в кластере hello, но они не может быть выделено toohello служб, которые в настоящее время выполнения задачи. Использование метрики позволяет hello диспетчер ресурсов кластера tooreorganize tooensure hello кластера, что служба имеет доступ toohello доступных ресурсов. 


## <a name="scaling-by-adding-and-removing-nodes-from-hello-cluster"></a>Масштабирование путем добавления и удаления узлов из кластера hello 
Другой вариант для масштабирования в Service Fabric — toochange hello размер кластера hello. Изменение размера hello hello кластера означает добавление или удаление узлов для одного или нескольких типов hello узлов в кластере hello. Например рассмотрим случай, где все hello узлы в кластере hello, горячей. Это означает, что ресурсы кластера hello почти все потребления. В этом случае добавление toohello дополнительные узлы кластера является лучшим способом tooscale hello. После новых узлов hello join hello кластера hello диспетчер ресурсов кластера Service Fabric перемещает toothem службы приведет к менее общую нагрузку на существующие узлы hello. Для служб без отслеживания состояния с числом экземпляров, равным -1, дополнительные экземпляры службы создаются автоматически. Это позволяет toomove некоторые вызовы из hello существующие узлы toohello новых узлов. 

Добавление и удаление toohello узлы кластера можно выполнить с помощью модуля PowerShell диспетчера ресурсов Azure Service Fabric hello.

```posh
Add-AzureRmServiceFabricNode -ResourceGroupName $resourceGroupName -Name $clusterResourceName -NodeType $nodeTypeName  -NumberOfNodesToAdd 5 
Remove-AzureRmServiceFabricNode -ResourceGroupName $resourceGroupName -Name $clusterResourceName -NodeType $nodeTypeName -NumberOfNodesToRemove 5
```

## <a name="putting-it-all-together"></a>Сборка
Давайте все hello идеи, которые мы обсуждали здесь и взаимодействовать через пример. Рассмотрим следующие службы hello: вы пытаетесь toobuild службы, который выступает в качестве адресную книгу, удерживая для toonames и контактные данные. 

Использующейся есть ряд вопросов связанные tooscale: сколько пользователей, будет toohave? Сколько контактов будет хранить каждый пользователь? Попыткой toofigure всем этим когда вы поддержку службы для hello первый раз сложно. Предположим, что ты toogo с одной службой статических с количеством определенной секции. последствия Hello комплектации hello неверное количество секций может привести к вы toohave проблемы масштабирования позже. Аналогичным образом даже если выбрать hello правой count, которые не могут быть вся информация hello необходимо. Например имеется toodecide hello размер кластера hello заранее, как с точки зрения hello числом узлов и их размер. Обычно жестких toopredict сколько ресурсов службы будет tooconsume со временем. Он также может быть жестких tooknow опережает время hello трафика шаблон, который фактически видит hello службы. Например пользователей может быть добавления и удаления их только первое, что в утром hello или возможно его значение распределяется равномерно продолжался hello hello дня. Исходя из этого, которые могут понадобиться tooscale извлечение и возврат динамически. Может быть toopredict можно узнать, когда ты tooneed tooscale извлечение и возврат, но в любом случае, скорее всего, понадобятся потребления ресурсов toochanging tooreact tooneed вашей службой. Это может включать изменение размера hello кластера hello в порядке tooprovide дополнительные ресурсы при реорганизации использование существующих ресурсов недостаточно. 

Но зачем даже попробуйте toopick схему секционирования одной ожидания для всех пользователей? Почему ограничиться tooone службы и один статический кластера? Hello реальной ситуации обычно более динамичным процессом. 

При построении для масштабирования, рассмотрим следующие динамические шаблон hello. Может потребоваться tooadapt его tooyour ситуации:

1. Вместо того toopick схему секционирования для всех пользователей заранее, построение «service manager».
2. Задание Hello службы диспетчера hello — toolook на сведения о заказчике, после их регистрации в службе. В зависимости от того, что сведения о hello manager service создать экземпляр вашего _фактическое_ службы хранилища контакт _только для этого клиента_. Если они требуют особой конфигурации, изоляции и обновлении, можно также toospin экземпляр приложения для этого клиента. 

Эта схема динамического создания имеет множество преимуществ.

  - Не пытаетесь tooguess hello правильный раздел счетчик для всех пользователей заранее или создания единой службы, бесконечно масштабируемые по себе. 
  - Разные пользователи нет hello toohave же секции count, count реплики, ограничения размещения, метрик, по умолчанию загружает, имена служб, параметры dns или любой из hello другие свойства, заданные в службе hello или на уровне приложения. 
  - Это обеспечивает дополнительную сегментацию данных. Каждый клиент имеет собственную копию службы hello
    - Каждую службу клиента можно настроить по-разному и предоставить ей больше или меньше ресурсов, например, выделив большее или меньшее число секций или реплик с учетом прогнозируемого масштаба.
      - Например, клиента hello оплаты hello «Gold» уровень — они могут получить несколько реплик или больше число секций и потенциально ресурсов выделенной службы tootheir через метрик и приложения.
      - Или, например они предоставляемых количеству hello контакты, которые они нужны сведения «Малый» - они бы получить только несколько секций или даже может быть помещена в пул общих служб с другими клиентами.
  - Вы не используете несколько экземпляров службы или реплики во время ожидания для клиентов tooshow вверх
  - Если клиент покидает, последующего удаления свои данные из службы сложнее, чем настройка диспетчера hello удаление этой службы или приложения, он создан.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о концепции Service Fabric см. следующие статьи hello:

* [Доступность служб структуры служб](service-fabric-availability-services.md)
* [Разделение служб Service Fabric](service-fabric-concepts-partitioning.md)
