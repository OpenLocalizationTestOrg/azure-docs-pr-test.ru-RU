---
title: "Распространенные вопросы о Microsoft Azure Service Fabric | Документация Майкрософт"
description: "Часто задаваемые вопросы о Service Fabric и ответы на них"
services: service-fabric
documentationcenter: .net
author: chackdan
manager: timlt
editor: 
ms.assetid: 5a179703-ff0c-4b8e-98cd-377253295d12
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/18/2017
ms.author: chackdan
ms.openlocfilehash: ee1fe4e83ce796fd50b779c0880701b9dfcefff7
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="commonly-asked-service-fabric-questions"></a><span data-ttu-id="f6331-103">Распространенные вопросы о Service Fabric</span><span class="sxs-lookup"><span data-stu-id="f6331-103">Commonly asked Service Fabric questions</span></span>

<span data-ttu-id="f6331-104">Пользователи задают множество схожих вопросов о возможностях и использовании Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="f6331-104">There are many commonly asked questions about what Service Fabric can do and how it should be used.</span></span> <span data-ttu-id="f6331-105">В этом документе приведены ответы на многие из этих вопросов.</span><span class="sxs-lookup"><span data-stu-id="f6331-105">This document covers many of those common questions and their answers.</span></span>

## <a name="cluster-setup-and-management"></a><span data-ttu-id="f6331-106">Настройка кластера и управление им</span><span class="sxs-lookup"><span data-stu-id="f6331-106">Cluster setup and management</span></span>

### <a name="can-i-create-a-cluster-that-spans-multiple-azure-regions-or-my-own-datacenters"></a><span data-ttu-id="f6331-107">Можно ли создать кластер, охватывающий несколько регионов Azure или моих центров обработки данных?</span><span class="sxs-lookup"><span data-stu-id="f6331-107">Can I create a cluster that spans multiple Azure regions or my own datacenters?</span></span>

<span data-ttu-id="f6331-108">Да.</span><span class="sxs-lookup"><span data-stu-id="f6331-108">Yes.</span></span> 

<span data-ttu-id="f6331-109">Базовые технологии кластеризации Service Fabric можно использовать для объединения компьютеров, которые работают в любой точке мира, если между ними есть сетевое подключение.</span><span class="sxs-lookup"><span data-stu-id="f6331-109">The core Service Fabric clustering technology can be used to combine machines running anywhere in the world, so long as they have network connectivity to each other.</span></span> <span data-ttu-id="f6331-110">Однако создание и запуск такого кластера может оказаться сложной задачей.</span><span class="sxs-lookup"><span data-stu-id="f6331-110">However, building and running such a cluster can be complicated.</span></span>

<span data-ttu-id="f6331-111">Если вам интересен этот сценарий, мы рекомендуем вам ознакомиться со [списком проблем Service Fabric в репозитории GitHub](https://github.com/azure/service-fabric-issues) или обратиться к сотруднику службы поддержки для получения дополнительных указаний.</span><span class="sxs-lookup"><span data-stu-id="f6331-111">If you are interested in this scenario, we encourage you to get in contact either through the [Service Fabric Github Issues List](https://github.com/azure/service-fabric-issues) or through your support representative in order to obtain additional guidance.</span></span> <span data-ttu-id="f6331-112">Команда разработчиков Service Fabric работает над тем, чтобы предоставить дополнительные сведения, указания и рекомендации для данного сценария.</span><span class="sxs-lookup"><span data-stu-id="f6331-112">The Service Fabric team is working to provide additional clarity, guidance, and recommendations for this scenario.</span></span> 

<span data-ttu-id="f6331-113">Необходимо учитывать следующие факторы.</span><span class="sxs-lookup"><span data-stu-id="f6331-113">Some things to consider:</span></span> 

1. <span data-ttu-id="f6331-114">На данный момент кластерный ресурс Service Fabric в Azure относится к определенному региону, как и масштабируемые наборы виртуальных машин, на основе которых создан кластер.</span><span class="sxs-lookup"><span data-stu-id="f6331-114">The Service Fabric cluster resource in Azure is regional today, as are the virtual machine scale sets that the cluster is built on.</span></span> <span data-ttu-id="f6331-115">Это означает, что в случае регионального сбоя вы можете утратить возможность управления кластером с помощью Azure Resource Manager или портала Azure.</span><span class="sxs-lookup"><span data-stu-id="f6331-115">This means that in the event of a regional failure you may lose the ability to manage the cluster via the Azure Resource Manager or the Azure Portal.</span></span> <span data-ttu-id="f6331-116">Это может произойти, даже если кластер продолжает работать и вы можете напрямую взаимодействовать с ним.</span><span class="sxs-lookup"><span data-stu-id="f6331-116">This can happen even though the cluster remains running and you'd be able to interact with it directly.</span></span> <span data-ttu-id="f6331-117">Кроме того, на текущий момент Azure не предоставляет возможность использовать отдельную виртуальную сеть в разных регионах.</span><span class="sxs-lookup"><span data-stu-id="f6331-117">In addition, Azure today does not offer the ability to have a single virtual network that is usable across regions.</span></span> <span data-ttu-id="f6331-118">Это означает, что для кластера, охватывающего несколько регионов Azure, требуются либо [общедоступные IP-адреса для каждой виртуальной машины в масштабируемых наборах виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-networking.md#public-ipv4-per-virtual-machine), либо [VPN-шлюзы Azure](../vpn-gateway/vpn-gateway-about-vpngateways.md).</span><span class="sxs-lookup"><span data-stu-id="f6331-118">This means that a multi-region cluster in Azure requires either [Public IP Addresses for each VM in the VM Scale Sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-networking.md#public-ipv4-per-virtual-machine) or [Azure VPN Gateways](../vpn-gateway/vpn-gateway-about-vpngateways.md).</span></span> <span data-ttu-id="f6331-119">Эти варианты сетевых подключений по-разному влияют на затраты, производительность и, в некоторой степени, на структуру приложений, поэтому перед внедрением такой среды требуется выполнить тщательный анализ и планирование.</span><span class="sxs-lookup"><span data-stu-id="f6331-119">These networking choices have different impacts on costs, performance, and to some degree application design, so careful analysis and planning is required before standing up such an environment.</span></span>
2. <span data-ttu-id="f6331-120">Обслуживание, мониторинг этих компьютеров и управление ими может стать сложной задачей, особенно в том случае, если они распределены по средам разных _типов_, например, между разными поставщиками облачных служб или между локальными ресурсами и Azure.</span><span class="sxs-lookup"><span data-stu-id="f6331-120">The maintenance, management, and monitoring of these machines can become complicated, especially when spanned across _types_ of environments, such as between different cloud providers or between on-premises resources and Azure.</span></span> <span data-ttu-id="f6331-121">Перед запуском производственных рабочих нагрузок в такой среде необходимо внимательно проверить, распознают ли кластер и приложения операции обновления, отслеживания, управления и диагностики.</span><span class="sxs-lookup"><span data-stu-id="f6331-121">Care must be taken to ensure that upgrades, monitoring, management, and diagnostics are understood for both the cluster and the applications before running production workloads in such an environment.</span></span> <span data-ttu-id="f6331-122">Если у вас уже имеется значительный опыт решения этих задач в Azure или в собственных центрах обработки данных, скорее всего, аналогичные решения можно будет применить для создания или выполнения кластера Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="f6331-122">If you already have lots of experience solving these problems in Azure or within your own datacenters, then it is likely that those same solutions can be applied when building out or running your Service Fabric cluster.</span></span> 

### <a name="do-service-fabric-nodes-automatically-receive-os-updates"></a><span data-ttu-id="f6331-123">Получают ли узлы Service Fabric обновления операционной системы автоматически?</span><span class="sxs-lookup"><span data-stu-id="f6331-123">Do Service Fabric nodes automatically receive OS updates?</span></span>

<span data-ttu-id="f6331-124">Пока нет, но это популярный запрос, и мы планируем реализовать эту возможность в Azure.</span><span class="sxs-lookup"><span data-stu-id="f6331-124">Not today, but this is also a common request that Azure intends to deliver.</span></span>

<span data-ttu-id="f6331-125">Тем временем мы [предоставили приложение](service-fabric-patch-orchestration-application.md), которое устанавливает исправления и обновления для операционных систем на узлах Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="f6331-125">In the interim, we have [provided an application](service-fabric-patch-orchestration-application.md) that the operating systems underneath your Service Fabric nodes stay patched and up to date.</span></span>

<span data-ttu-id="f6331-126">Проблема с обновлениями ОС заключается в том, что для них обычно требуется перезагрузка компьютера, что приводит к временной потере доступности.</span><span class="sxs-lookup"><span data-stu-id="f6331-126">The challenge with OS updates is that they typically require a reboot of the machine, which results in temporary availability loss.</span></span> <span data-ttu-id="f6331-127">Сама по себе это не проблема, так как Service Fabric выполнит автоматическое перенаправление трафика для этих служб на другие узлы.</span><span class="sxs-lookup"><span data-stu-id="f6331-127">By itself, that is not a problem, since Service Fabric will automatically redirect traffic for those services to other nodes.</span></span> <span data-ttu-id="f6331-128">Тем не менее, если обновления ОС не согласованы между собой по всему кластеру, есть вероятность того, что множество узлов будут выключены одновременно.</span><span class="sxs-lookup"><span data-stu-id="f6331-128">However, if OS updates are not coordinated across the cluster, there is the potential that many nodes go down at once.</span></span> <span data-ttu-id="f6331-129">Такие одновременные перезагрузки могут привести к полной потере доступности службы или как минимум определенного раздела (для службы с отслеживанием состояния).</span><span class="sxs-lookup"><span data-stu-id="f6331-129">Such simultaneous reboots can cause complete availability loss for a service, or at least for a specific partition (for a stateful service).</span></span>

<span data-ttu-id="f6331-130">В будущем мы планируем реализовать поддержку полностью автоматизированной политики обновления ОС, скоординированной между доменами обновления, чтобы обеспечить доступность несмотря на перезагрузки и другие непредвиденные сбои.</span><span class="sxs-lookup"><span data-stu-id="f6331-130">In the future, we plan to support an OS update policy that is fully automated and coordinated across update domains, ensuring that availability is maintained despite reboots and other unexpected failures.</span></span>

### <a name="can-i-use-large-virtual-machine-scale-sets-in-my-sf-cluster"></a><span data-ttu-id="f6331-131">Можно ли использовать большие масштабируемые наборы виртуальных машин в кластере Service Fabric?</span><span class="sxs-lookup"><span data-stu-id="f6331-131">Can I use Large Virtual Machine Scale Sets in my SF cluster?</span></span> 

<span data-ttu-id="f6331-132">**Краткий ответ**. Нет.</span><span class="sxs-lookup"><span data-stu-id="f6331-132">**Short answer** - No.</span></span> 

<span data-ttu-id="f6331-133">**Подробный ответ**. Хотя большие масштабируемые наборы виртуальных машин можно масштабировать до 1000 экземпляров виртуальных машин, это делается с помощью групп размещения.</span><span class="sxs-lookup"><span data-stu-id="f6331-133">**Long Answer** - Although the Large Virtual Machine Scale Sets allow you to scale a virtual machine scale set upto 1000 VM instances, it does so by the use of Placement Groups (PGs).</span></span> <span data-ttu-id="f6331-134">Домены сбоя и домены обновления согласовываются только в пределах группы размещения. Service Fabric использует домены сбоя и домены обновления для принятия решений о размещении экземпляров реплик или экземпляров служб.</span><span class="sxs-lookup"><span data-stu-id="f6331-134">Fault domains (FDs) and upgrade domains (UDs) are only consistent within a placement group Service fabric uses FDs and UDs to make placement decisions of your service replicas/Service instances.</span></span> <span data-ttu-id="f6331-135">Так как домены сбоя и домены обновления сравнимы только в пределах группы размещения, Service Fabric не может ее использовать.</span><span class="sxs-lookup"><span data-stu-id="f6331-135">Since the FDs  and UDs are comparable only within a placement group SF cannot use it.</span></span> <span data-ttu-id="f6331-136">Например, если виртуальная машина VM1 в группе размещения PG1 использует топологию с 0 доменов сбоя, а виртуальная машина VM9 в группе размещения PG2 — топологию с 4 доменами сбоя, это не значит, VM1 и VM2 размещены в двух разных аппаратных стойках. Следовательно, в этом случае Service Fabric не может использовать значения доменов сбоя для принятия решений о размещении.</span><span class="sxs-lookup"><span data-stu-id="f6331-136">For example, If VM1 in PG1 has a topology of FD=0 and VM9 in PG2 has a topology of FD=4 , it does not mean that VM1 and VM2 are on two different Hardware Racks, hence SF cannot use the FD values in this case to make placement decisions.</span></span>

<span data-ttu-id="f6331-137">Сейчас существуют и другие проблемы с большими масштабируемыми наборами виртуальных машин, в том числе отсутствие поддержки балансировки нагрузки уровня 4.</span><span class="sxs-lookup"><span data-stu-id="f6331-137">There are other issues with Large virtual machine scale sets currently, like the lack of level-4 Load balancing support.</span></span> <span data-ttu-id="f6331-138">Ознакомьтесь со [сведениями о больших масштабируемых наборах](../virtual-machine-scale-sets/virtual-machine-scale-sets-placement-groups.md).</span><span class="sxs-lookup"><span data-stu-id="f6331-138">Refer to for [details on Large scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-placement-groups.md)</span></span>



### <a name="what-is-the-minimum-size-of-a-service-fabric-cluster-why-cant-it-be-smaller"></a><span data-ttu-id="f6331-139">Каков минимальный размер кластера Service Fabric?</span><span class="sxs-lookup"><span data-stu-id="f6331-139">What is the minimum size of a Service Fabric cluster?</span></span> <span data-ttu-id="f6331-140">Почему он не может быть меньше?</span><span class="sxs-lookup"><span data-stu-id="f6331-140">Why can't it be smaller?</span></span>

<span data-ttu-id="f6331-141">Минимальный поддерживаемый размер кластера Service Fabric с рабочими нагрузками — пять узлов.</span><span class="sxs-lookup"><span data-stu-id="f6331-141">The minimum supported size for a Service Fabric cluster running production workloads is five nodes.</span></span> <span data-ttu-id="f6331-142">Для сценариев разработки и тестирования мы поддерживаем кластеры из трех узлов.</span><span class="sxs-lookup"><span data-stu-id="f6331-142">For dev/test scenarios, we support three node clusters.</span></span>

<span data-ttu-id="f6331-143">Эти минимальные значения связаны с тем, что в кластере Service Fabric выполняется ряд системных служб с отслеживанием состояния, включая службы имен и диспетчера отработки отказов.</span><span class="sxs-lookup"><span data-stu-id="f6331-143">These minimums exist because the Service Fabric cluster runs a set of stateful system services, including the naming service and the failover manager.</span></span> <span data-ttu-id="f6331-144">Эти службы, которые отслеживают, какие службы развернуты в кластере и где они в настоящее время размещены, существенно зависят от целостности кластера.</span><span class="sxs-lookup"><span data-stu-id="f6331-144">These services, which track what services have been deployed to the cluster and where they're currently hosted, depend on strong consistency.</span></span> <span data-ttu-id="f6331-145">Эта целостность, в свою очередь, зависит от возможности получения *кворума* для любого обновления состояния служб, где кворум означает строгое большинство реплик (N/2 + 1) для данной службы.</span><span class="sxs-lookup"><span data-stu-id="f6331-145">That strong consistency, in turn, depends on the ability to acquire a *quorum* for any given update to the state of those services, where a quorum represents a strict majority of the replicas (N/2 +1) for a given service.</span></span>

<span data-ttu-id="f6331-146">С учетом этого давайте рассмотрим некоторые возможные конфигурации кластера.</span><span class="sxs-lookup"><span data-stu-id="f6331-146">With that background, let's examine some possible cluster configurations:</span></span>

<span data-ttu-id="f6331-147">**Один узел.** Этот вариант не обеспечивает высокой доступности, так как потеря одного узла по какой-либо причине означает потерю всего кластера.</span><span class="sxs-lookup"><span data-stu-id="f6331-147">**One node**: this option does not provide high availability since the loss of the single node for any reason means the loss of the entire cluster.</span></span>

<span data-ttu-id="f6331-148">**Два узла.** Кворум для службы, развернутой на двух узлах (N = 2), составляет 2 узла (2/2 + 1 = 2).</span><span class="sxs-lookup"><span data-stu-id="f6331-148">**Two nodes**: a quorum for a service deployed across two nodes (N = 2) is 2 (2/2 + 1 = 2).</span></span> <span data-ttu-id="f6331-149">При потере одной реплики кворум создать невозможно.</span><span class="sxs-lookup"><span data-stu-id="f6331-149">When a single replica is lost, it is impossible to create a quorum.</span></span> <span data-ttu-id="f6331-150">Так как обновление службы требует временного отключения реплики, эта конфигурация бесполезна.</span><span class="sxs-lookup"><span data-stu-id="f6331-150">Since performing a service upgrade requires temporarily taking down a replica, this is not a useful configuration.</span></span>

<span data-ttu-id="f6331-151">**Три узла.** В случае трех узлов (N = 3) для создания кворума по-прежнему нужно два узла (3/2 + 1 = 2).</span><span class="sxs-lookup"><span data-stu-id="f6331-151">**Three nodes**: with three nodes (N=3), the requirement to create a quorum is still two nodes (3/2 + 1 = 2).</span></span> <span data-ttu-id="f6331-152">Это означает, что можно потерять один узел и по-прежнему сохранить кворум.</span><span class="sxs-lookup"><span data-stu-id="f6331-152">This means that you can lose an individual node and still maintain quorum.</span></span>

<span data-ttu-id="f6331-153">Кластер из трех узлов поддерживается для разработки и тестирования, так как в этом случае можно безопасно выполнять обновления и справляться со сбоями отдельных узлов, если они не происходят одновременно.</span><span class="sxs-lookup"><span data-stu-id="f6331-153">The three node cluster configuration is supported for dev/test because you can safely perform upgrades and survive individual node failures, as long as they don't happen simultaneously.</span></span> <span data-ttu-id="f6331-154">Для рабочих нагрузок в производственной среде кластер должен быть устойчив к таким одновременным сбоям, поэтому пять узлов являются обязательными.</span><span class="sxs-lookup"><span data-stu-id="f6331-154">For production workloads, you must be resilient to such a simultaneous failure, so five nodes are required.</span></span>

### <a name="can-i-turn-off-my-cluster-at-nightweekends-to-save-costs"></a><span data-ttu-id="f6331-155">Можно ли отключить кластер на ночь или выходные дни для снижения расходов?</span><span class="sxs-lookup"><span data-stu-id="f6331-155">Can I turn off my cluster at night/weekends to save costs?</span></span>

<span data-ttu-id="f6331-156">Как правило, нет.</span><span class="sxs-lookup"><span data-stu-id="f6331-156">In general, no.</span></span> <span data-ttu-id="f6331-157">Service Fabric сохраняет состояние на локальных временных дисках, и это означает, что если виртуальная машина перемещается на другой узел, данные не перемещаются вместе с ней.</span><span class="sxs-lookup"><span data-stu-id="f6331-157">Service Fabric stores state on local, ephemeral disks, meaning that if the virtual machine is moved to a different host, the data does not move with it.</span></span> <span data-ttu-id="f6331-158">Во время работы это не проблема, так как состояние нового узла обновляется с помощью других узлов.</span><span class="sxs-lookup"><span data-stu-id="f6331-158">In normal operation, that is not a problem as the new node is brought up to date by other nodes.</span></span> <span data-ttu-id="f6331-159">Однако если остановить все узлы и затем перезагрузить их, существует значительная вероятность, что большинство узлов будут запущены на новых серверах и восстановить систему не удастся.</span><span class="sxs-lookup"><span data-stu-id="f6331-159">However, if you stop all nodes and restart them later, there is a significant possibility that most of the nodes start on new hosts and make the system unable to recover.</span></span>

<span data-ttu-id="f6331-160">Если нужно создать кластеры для тестирования приложения перед его развертыванием, мы рекомендуем динамически создавать кластеры в процессе [непрерывной интеграции и непрерывного развертывания](service-fabric-set-up-continuous-integration.md).</span><span class="sxs-lookup"><span data-stu-id="f6331-160">If you would like to create clusters for testing your application before it is deployed, we recommend that you dynamically create those clusters as part of your [continuous integration/continuous deployment pipeline](service-fabric-set-up-continuous-integration.md).</span></span>


### <a name="how-do-i-upgrade-my-operating-system-for-example-from-windows-server-2012-to-windows-server-2016"></a><span data-ttu-id="f6331-161">Как обновить операционную систему (например, с Windows Server 2012 до Windows Server 2016)?</span><span class="sxs-lookup"><span data-stu-id="f6331-161">How do I upgrade my Operating System (for example from Windows Server 2012 to Windows Server 2016)?</span></span>

<span data-ttu-id="f6331-162">Хотя мы работаем над упрощением этой задачи, в настоящее время вы отвечаете за обновление.</span><span class="sxs-lookup"><span data-stu-id="f6331-162">While we're working on an improved experience, today, you are responsible for the upgrade.</span></span> <span data-ttu-id="f6331-163">Вам необходимо обновить образ ОС на виртуальных машинах кластера поочередно.</span><span class="sxs-lookup"><span data-stu-id="f6331-163">You must upgrade the OS image on the virtual machines of the cluster one VM at a time.</span></span> 

## <a name="container-support"></a><span data-ttu-id="f6331-164">Поддержка контейнеров</span><span class="sxs-lookup"><span data-stu-id="f6331-164">Container Support</span></span>

### <a name="why-are-my-containers-that-are-deployed-to-sf-unable-to-resolve-dns-addresses"></a><span data-ttu-id="f6331-165">Почему мои контейнеры, развернутые в Service Fabric, не могут разрешать DNS-адреса?</span><span class="sxs-lookup"><span data-stu-id="f6331-165">Why are my containers that are deployed to SF unable to resolve DNS addresses?</span></span>

<span data-ttu-id="f6331-166">Эта проблема обнаружена в кластерах версии 5.6.204.9494.</span><span class="sxs-lookup"><span data-stu-id="f6331-166">This issue has been reported on clusters that are on 5.6.204.9494 version</span></span> 

<span data-ttu-id="f6331-167">**Устранение**. Следуйте инструкциям в [этом документе](service-fabric-dnsservice.md), чтобы включить службу DNS Service Fabric в кластере.</span><span class="sxs-lookup"><span data-stu-id="f6331-167">**Mitigation** :  Follow [this document](service-fabric-dnsservice.md) to enable the DNS service fabric service in your cluster.</span></span>

<span data-ttu-id="f6331-168">**Исправление**. Обновите кластер до поддерживаемой версии, то есть до версии выше 5.6.204.9494, если она доступна.</span><span class="sxs-lookup"><span data-stu-id="f6331-168">**Fix** :  Upgrade to a supported cluster version that is higher than 5.6.204.9494, when it is available.</span></span> <span data-ttu-id="f6331-169">Если для кластера включено автоматическое обновление, он автоматически обновится до версии, в которой эта проблема устранена.</span><span class="sxs-lookup"><span data-stu-id="f6331-169">If your cluster is set to automatic upgrades, then the cluster will automatically upgrade to the version that has this issue fixed.</span></span>

  
## <a name="application-design"></a><span data-ttu-id="f6331-170">Проектирование приложений</span><span class="sxs-lookup"><span data-stu-id="f6331-170">Application Design</span></span>

### <a name="whats-the-best-way-to-query-data-across-partitions-of-a-reliable-collection"></a><span data-ttu-id="f6331-171">Как лучше запрашивать данные из всех разделов Reliable Collection?</span><span class="sxs-lookup"><span data-stu-id="f6331-171">What's the best way to query data across partitions of a Reliable Collection?</span></span>

<span data-ttu-id="f6331-172">Reliable Collection обычно содержит несколько [разделов](service-fabric-concepts-partitioning.md) для обеспечения развертывания с целью повышения производительности и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="f6331-172">Reliable collections are typically [partitioned](service-fabric-concepts-partitioning.md) to enable scale out for greater performance and throughput.</span></span> <span data-ttu-id="f6331-173">Это означает, что состояние данной службы может быть распределено между десятками и сотнями компьютеров.</span><span class="sxs-lookup"><span data-stu-id="f6331-173">That means that the state for a given service may be spread across 10s or 100s of machines.</span></span> <span data-ttu-id="f6331-174">Для выполнения операций над таким полным набором данных доступны такие возможности.</span><span class="sxs-lookup"><span data-stu-id="f6331-174">To perform operations over that full data set, you have a few options:</span></span>

- <span data-ttu-id="f6331-175">Создать службу, которая направляет запросы во все разделы другой службы для извлечения необходимых данных.</span><span class="sxs-lookup"><span data-stu-id="f6331-175">Create a service that queries all partitions of another service to pull in the required data.</span></span>
- <span data-ttu-id="f6331-176">Создать службу, которая может получать данные из всех разделов другой службы.</span><span class="sxs-lookup"><span data-stu-id="f6331-176">Create a service that can receive data from all partitions of another service.</span></span>
- <span data-ttu-id="f6331-177">Периодически передавать данные из каждой службы во внешнее хранилище.</span><span class="sxs-lookup"><span data-stu-id="f6331-177">Periodically push data from each service to an external store.</span></span> <span data-ttu-id="f6331-178">Этот подход используется, только если выполняемые запросы не являются частью основной бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="f6331-178">This approach is only appropriate if the queries you're performing are not part of your core business logic.</span></span>


### <a name="whats-the-best-way-to-query-data-across-my-actors"></a><span data-ttu-id="f6331-179">Как лучше запрашивать данные из моих субъектов?</span><span class="sxs-lookup"><span data-stu-id="f6331-179">What's the best way to query data across my actors?</span></span>

<span data-ttu-id="f6331-180">Субъекты должны быть независимыми единицами состояния и вычислений, поэтому не рекомендуется делать широковещательные запросы состояния субъектов во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f6331-180">Actors are designed to be independent units of state and compute, so it is not recommended to perform broad queries of actor state at runtime.</span></span> <span data-ttu-id="f6331-181">Если требуется направить запрос в полный набор состояния субъекта, необходимо выполнить одно из таких указаний.</span><span class="sxs-lookup"><span data-stu-id="f6331-181">If you have a need to query across the full set of actor state, you should consider either:</span></span>

- <span data-ttu-id="f6331-182">Заменить службы субъектов надежными службами с отслеживанием состояния таким образом, чтобы число сетевых запросов для сбора всех данных из нескольких субъектов выполнялось для нескольких разделов в службе.</span><span class="sxs-lookup"><span data-stu-id="f6331-182">Replacing your actor services with stateful reliable services, such that the number of network requests to gather all data from the number of actors to the number of partitions in your service.</span></span>
- <span data-ttu-id="f6331-183">Разрабатывать субъекты таким образом, чтобы периодически передавать их состояние во внешнее хранилище для упрощения запросов.</span><span class="sxs-lookup"><span data-stu-id="f6331-183">Designing your actors to periodically push their state to an external store for easier querying.</span></span> <span data-ttu-id="f6331-184">Как и способ выше, этот способ подходит, только если выполняемые запросы не являются обязательными для поведения среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="f6331-184">As above, this approach is only viable if the queries you're performing are not required for your runtime behavior.</span></span>

### <a name="how-much-data-can-i-store-in-a-reliable-collection"></a><span data-ttu-id="f6331-185">Сколько данных можно сохранить в Reliable Collection?</span><span class="sxs-lookup"><span data-stu-id="f6331-185">How much data can I store in a Reliable Collection?</span></span>

<span data-ttu-id="f6331-186">Reliable Services обычно состоит из нескольких разделов, поэтому объем данных, которые можно хранить, ограничивается только числом компьютеров в кластере и объемом доступной памяти на этих компьютерах.</span><span class="sxs-lookup"><span data-stu-id="f6331-186">Reliable services are typically partitioned, so the amount you can store is only limited by the number of machines you have in the cluster, and the amount of memory available on those machines.</span></span>

<span data-ttu-id="f6331-187">Например, предположим, что есть Reliable Collection в службе со 100 разделами и 3 репликами для хранения объектов со средним размером 1 КБ.</span><span class="sxs-lookup"><span data-stu-id="f6331-187">As an example, suppose that you have a reliable collection in a service with 100 partitions and 3 replicas, storing objects that average 1kb in size.</span></span> <span data-ttu-id="f6331-188">Теперь предположим, что имеется кластер из 10 компьютеров с 16 ГБ памяти на каждом компьютере.</span><span class="sxs-lookup"><span data-stu-id="f6331-188">Now suppose that you have a 10 machine cluster with 16gb of memory per machine.</span></span> <span data-ttu-id="f6331-189">Чтобы обеспечить простоту и умеренность оценки, предположим, что операционная система и системные службы, среда выполнения Service Fabric и службы используют 6 ГБ, оставляя свободными 10 ГБ на каждом компьютере, или 100 ГБ на кластер.</span><span class="sxs-lookup"><span data-stu-id="f6331-189">For simplicity and to be very conservative, assume that the operating system and system services, the Service Fabric runtime, and your services consume 6gb of that, leaving 10gb available per machine, or 100gb for the cluster.</span></span>

<span data-ttu-id="f6331-190">Учитывая, что каждый объект должен быть сохранен трижды (основная копия и две реплики), памяти будет достаточно примерно для 35 миллионов объектов в коллекции при полной загрузке.</span><span class="sxs-lookup"><span data-stu-id="f6331-190">Keeping in mind that each object must be stored three times (one primary and two replicas), you would have sufficient memory for approximately 35 million objects in your collection when operating at full capacity.</span></span> <span data-ttu-id="f6331-191">Тем не менее рекомендуется обеспечить устойчивость к одновременной потере домена сбоя и домена обновления, для чего потребуется примерно треть емкости, и это количество может сократиться примерно до 23 миллионов объектов.</span><span class="sxs-lookup"><span data-stu-id="f6331-191">However, we recommend being resilient to the simultaneous loss of a failure domain and an upgrade domain, which represents about 1/3 of capacity, and would reduce the number to roughly 23 million.</span></span>

<span data-ttu-id="f6331-192">Обратите внимание, что в этой оценке также предполагается следующее.</span><span class="sxs-lookup"><span data-stu-id="f6331-192">Note that this calculation also assumes:</span></span>

- <span data-ttu-id="f6331-193">Распределение данных по секциям примерно равномерное, или метрики нагрузки передаются в диспетчер кластерных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f6331-193">That the distribution of data across the partitions is roughly uniform or that you're reporting load metrics to the Cluster Resource Manager.</span></span> <span data-ttu-id="f6331-194">По умолчанию Service Fabric будет распределять нагрузку, исходя из числа реплик.</span><span class="sxs-lookup"><span data-stu-id="f6331-194">By default, Service Fabric will load balance based on replica count.</span></span> <span data-ttu-id="f6331-195">В приведенном выше примере можно поместить 10 основных реплик и 20 дополнительных реплик на каждом узле в кластере.</span><span class="sxs-lookup"><span data-stu-id="f6331-195">In our example above, that would put 10 primary replicas and 20 secondary replicas on each node in the cluster.</span></span> <span data-ttu-id="f6331-196">Этот вариант хорошо подходит для нагрузки, равномерно распределенной по разделам.</span><span class="sxs-lookup"><span data-stu-id="f6331-196">That works well for load that is evenly distributed across the partitions.</span></span> <span data-ttu-id="f6331-197">Если нагрузка распределена неравномерно, необходимо сообщить о нагрузке, чтобы диспетчер ресурсов мог упаковать реплики меньшего размера вместе и разрешить репликам большего размера использовать больше памяти на отдельном узле.</span><span class="sxs-lookup"><span data-stu-id="f6331-197">If load is not even, you must report load so that the Resource Manager can pack smaller replicas together and allow larger replicas to consume more memory on an individual node.</span></span>

- <span data-ttu-id="f6331-198">Рассматриваемая надежная служба является единственной, которая сохраняет состояние в кластере.</span><span class="sxs-lookup"><span data-stu-id="f6331-198">That the reliable service in question is the only one storing state in the cluster.</span></span> <span data-ttu-id="f6331-199">Так как в кластере можно развернуть несколько служб, необходимо учитывать ресурсы, которые потребуется запускать для каждой из них, и управлять состоянием этих служб.</span><span class="sxs-lookup"><span data-stu-id="f6331-199">Since you can deploy multiple services to a cluster, you need to be mindful of the resources that each will need to run and manage its state.</span></span>

- <span data-ttu-id="f6331-200">Сам кластер не увеличивается и не сжимается.</span><span class="sxs-lookup"><span data-stu-id="f6331-200">That the cluster itself is not growing or shrinking.</span></span> <span data-ttu-id="f6331-201">При добавлении дополнительных компьютеров Service Fabric выполнит повторную балансировку реплик для эффективного использования дополнительной емкости, пока количество компьютеров не превысит количество разделов в службе, так как отдельная реплика не может находиться на нескольких компьютерах.</span><span class="sxs-lookup"><span data-stu-id="f6331-201">If you add more machines, Service Fabric will rebalance your replicas to leverage the additional capacity until the number of machines surpasses the number of partitions in your service, since an individual replica cannot span machines.</span></span> <span data-ttu-id="f6331-202">Напротив, если уменьшить размер кластера, удалив компьютеры, реплики будут упакованы плотнее и будут обладать меньшей общей емкостью.</span><span class="sxs-lookup"><span data-stu-id="f6331-202">By contrast, if you reduce the size of the cluster by removing machines, your replicas will be packed more tightly and have less overall capacity.</span></span>

### <a name="how-much-data-can-i-store-in-an-actor"></a><span data-ttu-id="f6331-203">Сколько данных можно хранить в субъекте?</span><span class="sxs-lookup"><span data-stu-id="f6331-203">How much data can I store in an actor?</span></span>

<span data-ttu-id="f6331-204">Как и в случае с надежными службами, объем данных, которые могут храниться в службе субъекта, ограничивается только общим объемом дискового пространства и доступным объемом памяти на всех узлах в кластере.</span><span class="sxs-lookup"><span data-stu-id="f6331-204">As with reliable services, the amount of data that you can store in an actor service is only limited by the total disk space and memory available across the nodes in your cluster.</span></span> <span data-ttu-id="f6331-205">Тем не менее отдельные субъекты наиболее эффективны, когда они используются для инкапсуляции небольшого объема состояния и связанной бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="f6331-205">However, individual actors are most effective when they are used to encapsulate a small amount of state and associated business logic.</span></span> <span data-ttu-id="f6331-206">Как правило, состояние отдельного субъекта должно измеряться в килобайтах.</span><span class="sxs-lookup"><span data-stu-id="f6331-206">As a general rule, an individual actor should have state that is measured in kilobytes.</span></span>

## <a name="other-questions"></a><span data-ttu-id="f6331-207">Другие вопросы</span><span class="sxs-lookup"><span data-stu-id="f6331-207">Other questions</span></span>

### <a name="how-does-service-fabric-relate-to-containers"></a><span data-ttu-id="f6331-208">Как Service Fabric связана с контейнерами?</span><span class="sxs-lookup"><span data-stu-id="f6331-208">How does Service Fabric relate to containers?</span></span>

<span data-ttu-id="f6331-209">Контейнеры обеспечивают простой способ для упаковки служб и их зависимостей таким образом, чтобы они согласованно запускались во всех средах и могли изолированно работать на одном компьютере.</span><span class="sxs-lookup"><span data-stu-id="f6331-209">Containers offer a simple way to package services and their dependencies such that they run consistently in all environments and can operate in an isolated fashion on a single machine.</span></span> <span data-ttu-id="f6331-210">Service Fabric предлагает способ развертывания служб и управления ими, включая [службы, упакованные в контейнер](service-fabric-containers-overview.md).</span><span class="sxs-lookup"><span data-stu-id="f6331-210">Service Fabric offers a way to deploy and manage services, including [services that have been packaged in a container](service-fabric-containers-overview.md).</span></span>

### <a name="are-you-planning-to-open-source-service-fabric"></a><span data-ttu-id="f6331-211">Планируете создать решение на базе Service Fabric с открытым исходным кодом?</span><span class="sxs-lookup"><span data-stu-id="f6331-211">Are you planning to open source Service Fabric?</span></span>

<span data-ttu-id="f6331-212">Мы намерены перевести платформы Reliable Services и Reliable Actors на открытый исходный код на GitHub и будем рады участию сообщества в этих проектах.</span><span class="sxs-lookup"><span data-stu-id="f6331-212">We intend to open source the reliable services and reliable actors frameworks on GitHub and will accept community contributions to those projects.</span></span> <span data-ttu-id="f6331-213">После объявления о начале их реализации с дополнительными сведениями о них можно будет ознакомиться в [блоге Service Fabric](https://blogs.msdn.microsoft.com/azureservicefabric/).</span><span class="sxs-lookup"><span data-stu-id="f6331-213">Please follow the [Service Fabric blog](https://blogs.msdn.microsoft.com/azureservicefabric/) for more details as they're announced.</span></span>

<span data-ttu-id="f6331-214">Переводить среду выполнения Service Fabric на открытый исходный код пока не планируется.</span><span class="sxs-lookup"><span data-stu-id="f6331-214">The are currently no plans to open source the Service Fabric runtime.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f6331-215">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="f6331-215">Next steps</span></span>

- [<span data-ttu-id="f6331-216">Дополнительные сведения об основных понятиях и рекомендациях Service Fabric</span><span class="sxs-lookup"><span data-stu-id="f6331-216">Learn about core Service Fabric concepts and best practices</span></span>](https://mva.microsoft.com/en-us/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tbuZM46yC_5206218965)
