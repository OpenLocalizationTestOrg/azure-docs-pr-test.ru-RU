---
title: "Обзор аутентификации концентраторов событий Azure и модели безопасности | Документация Майкрософт"
description: "Обзор проверки подлинности концентраторов событий и модели безопасности."
services: event-hubs
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 93841e30-0c5c-4719-9dc1-57a4814342e7
ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/20/2017
ms.author: sethm;clemensv
ms.openlocfilehash: bfe7b95236c1a5336c1bb3a93d0eb5ca880adabf
ms.sourcegitcommit: b5c6197f997aa6858f420302d375896360dd7ceb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="event-hubs-authentication-and-security-model-overview"></a>Обзор проверки подлинности концентраторов событий и модели безопасности

Модель безопасности концентраторов событий Azure соответствует следующим требованиям.

* Только клиенты, предоставляющие действительные учетные данные, могут передать данные в концентратор событий.
* Клиент не может действовать от имени другого клиента.
* Постороннему клиенту можно запретить отправку данных в концентратор событий.

## <a name="client-authentication"></a>Аутентификация клиента

В основе модели безопасности концентраторов событий лежит сочетание [издателей событий](../service-bus-messaging/service-bus-sas.md) и маркеров *подписанных URL-адресов (SAS)*. Издатель событий определяет виртуальную конечную точку для концентратора событий. Издатель можно использовать только для отправки сообщений в концентратор событий. Получать сообщения от издателя невозможно.

Как правило, концентратор событий использует один издатель на клиент. Все сообщения, отправленные любому из издателей концентратора событий, добавляются в очередь этого концентратора событий. Издатели обеспечивают точный контроль доступа и регулирование.

Каждому клиенту концентраторов событий назначается уникальный маркер, который передается в клиент. Маркеры созданы таким образом, что каждый уникальный маркер предоставляет доступ к одному уникальному издателю. Клиент, обладающий маркером, может отправлять данные только в один издатель, но не в другие издатели. Если несколько клиентов совместно используют один маркер, они также совместно используют издатель.

Хотя это и не рекомендуется, можно предоставить устройствам маркеры, которые обеспечивают прямой доступ к концентратору событий. Любое устройство с этим маркером может отправлять сообщения непосредственно в концентратор событий. Такие устройства не подвергаются регулированию. Кроме того, устройство нельзя внести в черный список, чтобы запретить отправку данных в концентратор событий.

Все маркеры подписаны с помощью ключа SAS. Как правило, все маркеры должны быть подписаны тем же ключом. Клиенты не имеют сведений о ключе. Это не позволяет другим клиентам создавать маркеры.

### <a name="create-the-sas-key"></a>Создание ключа SAS

При создании пространства имен концентраторов событий служба автоматически создает 256-битный ключ SAS с именем **RootManageSharedAccessKey**. Это правило имеет связанную пару первичного и вторичного ключей, которые дают пространству имен право на отправку, прослушивание и управление. Кроме того, можно создать дополнительные ключи. Рекомендуется создать ключ, дающий разрешения на отправку в конкретный концентратор событий. Далее в этом разделе предполагается, что вы дали ключу имя **EventHubSendKey**.

В следующем примере при создании концентратора событий создается ключ только для отправки.

```csharp
// Create namespace manager.
string serviceNamespace = "YOUR_NAMESPACE";
string namespaceManageKeyName = "RootManageSharedAccessKey";
string namespaceManageKey = "YOUR_ROOT_MANAGE_SHARED_ACCESS_KEY";
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", serviceNamespace, string.Empty);
TokenProvider td = TokenProvider.CreateSharedAccessSignatureTokenProvider(namespaceManageKeyName, namespaceManageKey);
NamespaceManager nm = new NamespaceManager(namespaceUri, namespaceManageTokenProvider);

// Create event hub with a SAS rule that enables sending to that event hub
EventHubDescription ed = new EventHubDescription("MY_EVENT_HUB") { PartitionCount = 32 };
string eventHubSendKeyName = "EventHubSendKey";
string eventHubSendKey = SharedAccessAuthorizationRule.GenerateRandomKey();
SharedAccessAuthorizationRule eventHubSendRule = new SharedAccessAuthorizationRule(eventHubSendKeyName, eventHubSendKey, new[] { AccessRights.Send });
ed.Authorization.Add(eventHubSendRule); 
nm.CreateEventHub(ed);
```

### <a name="generate-tokens"></a>Создание маркеров

Маркеры можно создать с помощью ключа SAS. Следует создавать только один маркер на клиент. Маркеры можно создать с помощью следующего метода. Все маркеры создаются с помощью ключа **EventHubSendKey** . Каждому маркеру назначается уникальный URI.

```csharp
public static string SharedAccessSignatureTokenProvider.GetSharedAccessSignature(string keyName, string sharedAccessKey, string resource, TimeSpan tokenTimeToLive)
```

При вызове этого метода URI должен быть указан как `//<NAMESPACE>.servicebus.windows.net/<EVENT_HUB_NAME>/publishers/<PUBLISHER_NAME>`. URI идентичен для всех маркеров за исключением класса `PUBLISHER_NAME`, который должен быть уникальным для каждого маркера. В идеальном случае `PUBLISHER_NAME` представляет идентификатор клиента, который получает маркер.

Этот метод создает маркер со следующей структурой:

```csharp
SharedAccessSignature sr={URI}&sig={HMAC_SHA256_SIGNATURE}&se={EXPIRATION_TIME}&skn={KEY_NAME}
```

Срок действия маркера указывается в секундах от 1 января 1970 г. Ниже приведен пример маркера:

```csharp
SharedAccessSignature sr=contoso&sig=nPzdNN%2Gli0ifrfJwaK4mkK0RqAB%2byJUlt%2bGFmBHG77A%3d&se=1403130337&skn=RootManageSharedAccessKey
```

Как правило, срок существования маркера соответствует времени существования клиента или превышает его. Если клиент имеет возможность получить новый маркер, можно использовать маркеры с более коротким временем существования.

### <a name="sending-data"></a>Отправка данных

После создания маркеров каждому клиенту присваивается собственный уникальный маркер.

Когда клиент отправляет данные в концентратор событий, к запросу на отправку прикрепляется специальный маркер. Во избежание перехвата и кражи маркера злоумышленником связь между клиентом и концентратором событий должна выполняться по зашифрованному каналу.

### <a name="blacklisting-clients"></a>Добавление клиентов в черный список

Если маркер украден злоумышленником, злоумышленник может действовать от имени клиента, маркер которого был украден. Добавление клиента в черный список означает, что этот клиент не сможет работать, пока не получит новый маркер, использующий другой издатель.

## <a name="authentication-of-back-end-applications"></a>Проверка подлинности серверных приложений

Для аутентификации серверных приложений, которые используют данные, созданные клиентами концентраторов событий, концентраторы событий применяют модель безопасности, похожую на модель, используемую для разделов служебной шины. Группа потребителей концентраторов событий соответствует подписке на раздел служебной шины. Клиент может создать группу потребителей, если запрос на ее создание содержит маркер, который предоставляет права управления для концентратора событий или для пространства имен, которому принадлежит этот концентратор. Клиент может получать данные от группы потребителей, если запрос на получение сопровождается маркером, который предоставляет права на получение для этой группы потребителей, концентратора событий или пространства имен, которому принадлежит концентратор событий.

Текущая версия служебной шины не поддерживает правила SAS для отдельных подписок. Это же справедливо и для групп потребителей концентраторов событий. В будущем планируется добавить поддержку SAS для обоих компонентов.

В отсутствие проверки подлинности SAS для отдельных групп потребителей можно использовать ключи SAS для защиты всех групп потребителей общим ключом. Такой подход позволяет приложению получать данные от любых групп потребителей концентратора событий.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать больше о концентраторах событий, посетите следующие разделы:

* [Event Hubs overview]
* [Обзор подписанных URL-адресов]
* [Примеры приложений, использующие концентраторы событий]

[Event Hubs overview]: event-hubs-what-is-event-hubs.md
[Примеры приложений, использующие концентраторы событий]: https://github.com/Azure/azure-event-hubs/tree/master/samples
[Обзор подписанных URL-адресов]: ../service-bus-messaging/service-bus-sas.md

