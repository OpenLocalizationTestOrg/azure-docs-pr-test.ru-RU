---
title: "Удостоверение управляемой службы с предварительной версии концентраторов событий Azure | Документы Microsoft"
description: "Использование управляемой службы удостоверений с концентраторов событий Azure"
services: event-hubs
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 
ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/18/2017
ms.author: sethm
ms.openlocfilehash: dd50e4f6ebc5fdf5496a5127fde20bd052087b59
ms.sourcegitcommit: f46cbcff710f590aebe437c6dd459452ddf0af09
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2017
---
# <a name="managed-service-identity-preview"></a>Управляемые учетные данные службы (Предварительная версия)

Управляемые службы удостоверений (MSI) является функцией между Azure, которая позволяет создавать безопасные удостоверение, связанное с развертыванием, под которой выполняется код приложения. Затем можно связать его с ролями управления доступом, предоставляющими пользовательских разрешений для доступа к определенным ресурсам Azure, необходимые приложению. 

С помощью MSI платформа Azure управляет этот идентификатор среды выполнения. Необязательно для хранения и защиты ключей доступа в коде приложения или конфигурации, либо для идентификации себя, либо необходимо получить доступ к ресурсам. Концентраторы событий клиентского приложения внутри приложения службы приложений Azure или на виртуальной машине включена поддержка MSI не требуется обрабатывать правила SAS и ключи или любые другие маркеры доступа. В клиентском приложении достаточно только адрес конечной точки пространства имен концентраторов событий. Когда приложение подключается, концентраторы событий привязывает контекст MSI клиенту в операции, показанный в примере далее в этой статье.

Как только он связан с удостоверением управляемой службы, клиент концентраторов событий могут выполнять полномочными операции. Авторизация выполняется с помощью привязывания MSI ролей концентраторов событий. 

## <a name="event-hubs-roles-and-permissions"></a>Роли концентраторов событий и разрешения

Для начальной общедоступном предварительном выпуске можно добавлять только идентификаторы управляемых служб роли «Владелец» или «Участник» пространства имен концентраторов событий, который предоставляет удостоверение полный доступ на все сущности в пространстве имен. Однако управление операций, изменяющих топологии пространства имен, изначально являются только то, что поддерживается диспетчера ресурсов Azure, а не через интерфейс управления REST концентраторов событий в машинном коде. Эта поддержка также означает, что нельзя использовать клиент .NET Framework [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) объекта в идентификаторы управляемых служб. 
 
## <a name="use-event-hubs-with-a-managed-service-identity"></a>Использование концентраторов событий с идентификаторы управляемых служб

В следующем разделе описаны шаги, необходимые для создания и развертывания, работающей под удостоверением управляемой службы, предоставьте этой идентификации доступ к пространству имен концентраторов событий и способ взаимодействия приложения с концентраторами событий с помощью этого образца приложения удостоверение.

Это Введение Описание веб-приложения, размещенного в [службе приложений Azure](https://azure.microsoft.com/services/app-service/). Шаги, необходимые для приложения, разместить виртуальную Машину похожи.

### <a name="create-an-app-service-web-application"></a>Создание веб-приложения служб приложений

Первым шагом является создание приложения ASP.NET службы приложения. Если вы не знакомы с тем, как это сделать в Azure, выполните [это руководство](../app-service/app-service-web-get-started-dotnet-framework.md). Тем не менее вместо того чтобы создавать приложения MVC, как показано в этом учебнике, создайте приложение веб-форм.

### <a name="set-up-the-managed-service-identity"></a>Настройка удостоверений управляемой службы

После создания приложения, перейдите к только что созданный веб-приложения на портале Azure (также отображаются в практическом руководстве), а затем перейдите к **управляемого удостоверения службы** страницы и включить функцию: 

![](./media/event-hubs-managed-service-identity/msi1.png)
 
После включения компонента нового удостоверения службы создается в Azure Active Directory и настраивается в узел службы приложений.

### <a name="create-a-new-event-hubs-namespace"></a>Создать новое пространство имен концентраторов событий

Далее, [создать пространство имен концентраторов событий](event-hubs-create.md) в одном из регионов Azure с поддержкой предварительной версии MSI: **Востоке**, **Восток 2**, или **Западной Европе**. 

Перейдите к пространству имен **управления доступа (IAM)** на портале и нажмите кнопку **добавить** Добавление удостоверение управляемой службы **владельца** роли. Для этого найдите имя веб-приложения в **добавить разрешения** панель **выберите** , а затем щелкните запись. Нажмите кнопку **Сохранить**.

![](./media/event-hubs-managed-service-identity/msi2.png)
 
Удостоверение управляемой службы веб-приложение теперь имеет доступ к пространству имен концентраторов событий и в концентратор событий созданного ранее. 

### <a name="run-the-app"></a>Запуск приложения

Теперь можно измените страницу по умолчанию созданное приложение ASP.NET. Можно также использовать кода веб-приложений из [этот репозиторий GitHub](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/MSI/EventHubsMSIDemoWebApp). 

После запуска приложения, укажите в браузере для EventHubsMSIDemo.aspx. Кроме того задайте его как начальная страница. Код можно найти в файле EventHubsMSIDemo.aspx.cs. Результатом является минимальной веб-приложения с несколько полей ввода и **отправки** и **получать** кнопок, подключиться к концентраторов событий для отправки или получения сообщений. 

Обратите внимание как [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) инициализации объекта. Вместо того чтобы использовать Поставщик маркера общего доступа маркера (SAS), код создает поставщик маркеров для управляемой службы удостоверения с `TokenProvider.CreateManagedServiceIdentityTokenProvider(ServiceAudience.EventHubAudience)` вызова. Таким образом нет не секретные данные, чтобы сохранять и использовать. Поток контекста удостоверение управляемой службы концентраторам событий и подтверждения авторизации параметры автоматически обрабатываются поставщиком маркера, который является моделью проще, чем при использовании SAS.

После внесения этих изменений, публикация и запуск приложения. Для загрузки и затем импортировать профиль публикации в Visual Studio — простой способ получить правильные данные публикации:

![](./media/event-hubs-managed-service-identity/msi3.png)
 
Для отправки и получения сообщений, введите имя пространства имен и имя сущности, вы создали, а затем выберите либо **отправки** или **получать**. 
 
Обратите внимание, что удостоверение управляемой службы работает только в среде Azure и только в развертывании службы приложения, в котором она была настроена. Также Обратите внимание, что управляемые удостоверения службы не работают с слоты развертывания служб приложений в настоящее время.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о концентраторах событий см. по следующим ссылкам:

* Начните работу с [руководства по концентраторам событий](event-hubs-dotnet-standard-getstarted-send.md)
* [Часто задаваемые вопросы о концентраторах событий](event-hubs-faq.md)
* [Сведения о ценах на концентраторы событий](https://azure.microsoft.com/pricing/details/event-hubs/)
* [Примеры приложений, использующие концентраторы событий](https://github.com/Azure/azure-event-hubs/tree/master/samples)