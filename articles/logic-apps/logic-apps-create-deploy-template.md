---
title: "Создание шаблонов развертывания для Azure Logic Apps | Документация Майкрософт"
description: "Узнайте, как создавать шаблоны Azure Resource Manager для развертывания приложений логики и управлять выпусками."
services: logic-apps
documentationcenter: .net,nodejs,java
author: jeffhollan
manager: anneta
editor: 
ms.assetid: 85928ec6-d7cb-488e-926e-2e5db89508ee
ms.service: logic-apps
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.custom: H1Hack27Feb2017
ms.date: 10/18/2016
ms.author: LADocs; jehollan
ms.openlocfilehash: 9cfbb294010d48deaf4b4c78c6a6bcd59a387d87
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="create-templates-for-logic-apps-deployment-and-release-management"></a><span data-ttu-id="6e774-103">Создание шаблонов для развертывания приложений логики и управления выпусками</span><span class="sxs-lookup"><span data-stu-id="6e774-103">Create templates for logic apps deployment and release management</span></span>

<span data-ttu-id="6e774-104">После создания приложения логики на его основе можно создать шаблон Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="6e774-104">After a logic app has been created, you might want to create it as an Azure Resource Manager template.</span></span>
<span data-ttu-id="6e774-105">Таким образом вы сможете легко развернуть приложение логики в любой среде или группе ресурсов, где это может потребоваться.</span><span class="sxs-lookup"><span data-stu-id="6e774-105">This way, you can easily deploy the logic app to any environment or resource group where you might need it.</span></span>
<span data-ttu-id="6e774-106">Дополнительные сведения о шаблонах Resource Manager см. в статьях [Создание шаблонов диспетчера ресурсов Azure](../azure-resource-manager/resource-group-authoring-templates.md) и [Развертывание ресурсов с использованием шаблонов Resource Manager и Azure PowerShell](../azure-resource-manager/resource-group-template-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="6e774-106">For more about Resource Manager templates, see [authoring Azure Resource Manager templates](../azure-resource-manager/resource-group-authoring-templates.md) and [deploying resources by using Azure Resource Manager templates](../azure-resource-manager/resource-group-template-deploy.md).</span></span>

## <a name="logic-app-deployment-template"></a><span data-ttu-id="6e774-107">Шаблон развертывания приложения логики</span><span class="sxs-lookup"><span data-stu-id="6e774-107">Logic app deployment template</span></span>

<span data-ttu-id="6e774-108">Приложение логики состоит из трех основных компонентов:</span><span class="sxs-lookup"><span data-stu-id="6e774-108">A logic app has three basic components:</span></span>

* <span data-ttu-id="6e774-109">**Ресурс приложения логики**: содержит такие сведения, как тарифный план, расположение и определение рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="6e774-109">**Logic app resource**: Contains information about things like pricing plan, location, and the workflow definition.</span></span>
* <span data-ttu-id="6e774-110">**Определение рабочего процесса**: описывает этапы рабочего процесса приложения логики и способ выполнения рабочего процесса обработчиком приложений логики.</span><span class="sxs-lookup"><span data-stu-id="6e774-110">**Workflow definition**: Describes your logic app's workflow steps and how the Logic Apps engine should execute the workflow.</span></span>
<span data-ttu-id="6e774-111">Это определение можно просмотреть в окне **Представление кода** приложения логики.</span><span class="sxs-lookup"><span data-stu-id="6e774-111">You can view this definition in your logic app's **Code View** window.</span></span>
<span data-ttu-id="6e774-112">В ресурсе приложения логики это определение можно найти в свойстве `definition`.</span><span class="sxs-lookup"><span data-stu-id="6e774-112">In the logic app resource, you can find this definition in the `definition` property.</span></span>
* <span data-ttu-id="6e774-113">**Подключения**: отдельные ресурсы для безопасного хранения метаданных, связанных со всеми подключениями соединителя, таких как строка подключения и маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="6e774-113">**Connections**: Refers to separate resources that securely store metadata about any connector connections, such as a connection string and an access token.</span></span>
<span data-ttu-id="6e774-114">Эти ресурсы указываются в разделе `parameters` ресурса приложения логики.</span><span class="sxs-lookup"><span data-stu-id="6e774-114">In the logic app resource, your logic app references these resources in the `parameters` section.</span></span>

<span data-ttu-id="6e774-115">Вы можете просмотреть все эти компоненты имеющихся приложений логики с помощью таких инструментов, как [обозреватель ресурсов Azure](http://resources.azure.com).</span><span class="sxs-lookup"><span data-stu-id="6e774-115">You can view all these pieces of existing logic apps by using a tool like [Azure Resource Explorer](http://resources.azure.com).</span></span>

<span data-ttu-id="6e774-116">Чтобы создать шаблон для приложения логики, который можно использовать для развертываний групп ресурсов, необходимо определить ресурсы и при необходимости параметризовать их.</span><span class="sxs-lookup"><span data-stu-id="6e774-116">To make a template for a logic app to use with resource group deployments, you must define the resources and parameterize as needed.</span></span>
<span data-ttu-id="6e774-117">Например, если развертывание осуществляется в тестовой, рабочей среде или в среде разработки, то скорее всего в каждой из этих сред потребуется использовать различные строки подключения к базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="6e774-117">For example, if you're deploying to a development, test, and production environment, you likely want to use different connection strings to a SQL database in each environment.</span></span>
<span data-ttu-id="6e774-118">Или выполнить развертывания в разных подписках или группах ресурсов.</span><span class="sxs-lookup"><span data-stu-id="6e774-118">Or, you might want to deploy within different subscriptions or resource groups.</span></span>  

## <a name="create-a-logic-app-deployment-template"></a><span data-ttu-id="6e774-119">Создание шаблона развертывания приложения логики</span><span class="sxs-lookup"><span data-stu-id="6e774-119">Create a logic app deployment template</span></span>

<span data-ttu-id="6e774-120">Самый простой способ создать допустимый шаблон развертывания приложения логики — это воспользоваться [инструментами Visual Studio для приложений логики](logic-apps-deploy-from-vs.md).</span><span class="sxs-lookup"><span data-stu-id="6e774-120">The easiest way to have a valid logic app deployment template is to use the [Visual Studio Tools for Logic Apps](logic-apps-deploy-from-vs.md).</span></span>
<span data-ttu-id="6e774-121">Инструменты Visual Studio создают допустимый шаблон развертывания, который можно использовать в разных подписках или расположениях.</span><span class="sxs-lookup"><span data-stu-id="6e774-121">The Visual Studio tools generate a valid deployment template that can be used across any subscription or location.</span></span>

<span data-ttu-id="6e774-122">При создании шаблона для развертывания приложения логики могут быть полезными и некоторые другие инструменты.</span><span class="sxs-lookup"><span data-stu-id="6e774-122">A few other tools can assist you as you create a logic app deployment template.</span></span>
<span data-ttu-id="6e774-123">Его можно создать вручную, используя указанные выше ресурсы и настроив требуемые параметры.</span><span class="sxs-lookup"><span data-stu-id="6e774-123">You can author by hand, that is, by using the resources already discussed here to create parameters as needed.</span></span>
<span data-ttu-id="6e774-124">Также можно использовать модуль PowerShell для [создания шаблона приложения логики](https://github.com/jeffhollan/LogicAppTemplateCreator) .</span><span class="sxs-lookup"><span data-stu-id="6e774-124">Another option is to use a [logic app template creator](https://github.com/jeffhollan/LogicAppTemplateCreator) PowerShell module.</span></span> <span data-ttu-id="6e774-125">Этот модуль с открытым исходным кодом оценивает приложение логики и все подключения, используемые в этом приложении, а затем создает ресурсы шаблона с необходимыми параметрами для развертывания.</span><span class="sxs-lookup"><span data-stu-id="6e774-125">This open-source module first evaluates the logic app and any connections that it is using, and then generates template resources with the necessary parameters for deployment.</span></span>
<span data-ttu-id="6e774-126">Например, если приложение логики получает сообщение из очереди служебной шины Azure и добавляет данные в базу данных SQL Azure, то инструмент сохраняет всю логику оркестрации и параметризует строки подключения SQL и служебной шины, чтобы их можно было настроить во время развертывания.</span><span class="sxs-lookup"><span data-stu-id="6e774-126">For example, if you have a logic app that receives a message from an Azure Service Bus queue and adds data to an Azure SQL database, the tool preserves all the orchestration logic and parameterizes the SQL and Service Bus connection strings so that they can be set at deployment.</span></span>

> [!NOTE]
> <span data-ttu-id="6e774-127">Подключения должны относиться к той же группе ресурсов, что и приложение логики.</span><span class="sxs-lookup"><span data-stu-id="6e774-127">Connections must be within the same resource group as the logic app.</span></span>
>
>

### <a name="install-the-logic-app-template-powershell-module"></a><span data-ttu-id="6e774-128">Установка модуля PowerShell для шаблона приложения логики</span><span class="sxs-lookup"><span data-stu-id="6e774-128">Install the logic app template PowerShell module</span></span>
<span data-ttu-id="6e774-129">Проще всего установить модуль через [коллекцию PowerShell](https://www.powershellgallery.com/packages/LogicAppTemplate/0.1) с использованием команды `Install-Module -Name LogicAppTemplate`.</span><span class="sxs-lookup"><span data-stu-id="6e774-129">The easiest way to install the module is via the [PowerShell Gallery](https://www.powershellgallery.com/packages/LogicAppTemplate/0.1), by using the command `Install-Module -Name LogicAppTemplate`.</span></span>  

<span data-ttu-id="6e774-130">Также можно установить модуль PowerShell вручную:</span><span class="sxs-lookup"><span data-stu-id="6e774-130">You also can install the PowerShell module manually:</span></span>

1. <span data-ttu-id="6e774-131">Скачайте последний выпуск [модуля для создания шаблона приложения логики](https://github.com/jeffhollan/LogicAppTemplateCreator/releases).</span><span class="sxs-lookup"><span data-stu-id="6e774-131">Download the latest release of the [logic app template creator](https://github.com/jeffhollan/LogicAppTemplateCreator/releases).</span></span>  
2. <span data-ttu-id="6e774-132">Извлеките содержимое папки в папку модуля PowerShell (обычно это `%UserProfile%\Documents\WindowsPowerShell\Modules`).</span><span class="sxs-lookup"><span data-stu-id="6e774-132">Extract the folder in your PowerShell module folder (usually `%UserProfile%\Documents\WindowsPowerShell\Modules`).</span></span>

<span data-ttu-id="6e774-133">Чтобы модуль поддерживал любой маркер доступа клиента или подписки, рекомендуется использовать программу командной строки [ARMClient](https://github.com/projectkudu/ARMClient).</span><span class="sxs-lookup"><span data-stu-id="6e774-133">For the module to work with any tenant and subscription access token, we recommend that you use it with the [ARMClient](https://github.com/projectkudu/ARMClient) command-line tool.</span></span>  <span data-ttu-id="6e774-134">В этой [записи блога](http://blog.davidebbo.com/2015/01/azure-resource-manager-client.html) программа ARMClient рассматривается подробней.</span><span class="sxs-lookup"><span data-stu-id="6e774-134">This [blog post](http://blog.davidebbo.com/2015/01/azure-resource-manager-client.html) discusses ARMClient in more detail.</span></span>

### <a name="generate-a-logic-app-template-by-using-powershell"></a><span data-ttu-id="6e774-135">Создание шаблона приложения логики с помощью PowerShell</span><span class="sxs-lookup"><span data-stu-id="6e774-135">Generate a logic app template by using PowerShell</span></span>
<span data-ttu-id="6e774-136">После установки PowerShell можно создать шаблон, используя следующую команду:</span><span class="sxs-lookup"><span data-stu-id="6e774-136">After PowerShell is installed, you can generate a template by using the following command:</span></span>

`armclient token $SubscriptionId | Get-LogicAppTemplate -LogicApp MyApp -ResourceGroup MyRG -SubscriptionId $SubscriptionId -Verbose | Out-File C:\template.json`

<span data-ttu-id="6e774-137">`$SubscriptionId` — это идентификатор подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="6e774-137">`$SubscriptionId` is the Azure subscription ID.</span></span> <span data-ttu-id="6e774-138">Эта строка сначала получает маркер доступа через программу ARMClient, затем передает его по конвейеру в сценарий PowerShell и создает шаблон в JSON-файл.</span><span class="sxs-lookup"><span data-stu-id="6e774-138">This line first gets an access token via ARMClient, then pipes it through to the PowerShell script, and then creates the template in a JSON file.</span></span>

## <a name="add-parameters-to-a-logic-app-template"></a><span data-ttu-id="6e774-139">Добавление параметров для шаблона приложения логики</span><span class="sxs-lookup"><span data-stu-id="6e774-139">Add parameters to a logic app template</span></span>
<span data-ttu-id="6e774-140">После создания шаблона приложения логики можно добавлять или изменять любые дополнительные параметры.</span><span class="sxs-lookup"><span data-stu-id="6e774-140">After you create your logic app template, you can continue to add or modify parameters that you might need.</span></span> <span data-ttu-id="6e774-141">Например, если определение включает идентификатор ресурса в функции Azure или вложенном рабочем процессе, где планируется одно развертывание, можно добавить дополнительные ресурсы для шаблона и при необходимости параметризовать идентификаторы.</span><span class="sxs-lookup"><span data-stu-id="6e774-141">For example, if your definition includes a resource ID to an Azure function or nested workflow that you plan to deploy in a single deployment, you can add more resources to your template and parameterize IDs as needed.</span></span> <span data-ttu-id="6e774-142">То же касается и ссылок на пользовательские интерфейсы API или конечные точки Swagger, которые будут развернуты в каждой группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="6e774-142">The same applies to any references to custom APIs or Swagger endpoints you expect to deploy with each resource group.</span></span>

## <a name="deploy-a-logic-app-template"></a><span data-ttu-id="6e774-143">Развертывание шаблона приложения логики</span><span class="sxs-lookup"><span data-stu-id="6e774-143">Deploy a logic app template</span></span>

<span data-ttu-id="6e774-144">Шаблон можно развернуть, используя любые инструменты, включая PowerShell, REST API, [Visual Studio Team Services Release Management](#team-services), а также функцию развертывания шаблона на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="6e774-144">You can deploy your template by using any tools like PowerShell, REST API, [Visual Studio Team Services Release Management](#team-services), and template deployment through the Azure portal.</span></span>
<span data-ttu-id="6e774-145">Кроме того, для сохранения значений параметров рекомендуется создать [файл параметров](../azure-resource-manager/resource-group-template-deploy.md#parameter-files).</span><span class="sxs-lookup"><span data-stu-id="6e774-145">Also, to store the values for parameters, we recommend that you create a [parameter file](../azure-resource-manager/resource-group-template-deploy.md#parameter-files).</span></span>
<span data-ttu-id="6e774-146">Узнайте, как [развертывать ресурсы с помощью шаблонов Azure Resource Manager и PowerShell](../azure-resource-manager/resource-group-template-deploy.md) или [развертывать ресурсы с помощью шаблонов Azure Resource Manager и портала Azure](../azure-resource-manager/resource-group-template-deploy-portal.md).</span><span class="sxs-lookup"><span data-stu-id="6e774-146">Learn how to [deploy resources with Azure Resource Manager templates and PowerShell](../azure-resource-manager/resource-group-template-deploy.md) or [deploy resources with Azure Resource Manager templates and the Azure portal](../azure-resource-manager/resource-group-template-deploy-portal.md).</span></span>

### <a name="authorize-oauth-connections"></a><span data-ttu-id="6e774-147">Авторизация подключений OAuth</span><span class="sxs-lookup"><span data-stu-id="6e774-147">Authorize OAuth connections</span></span>

<span data-ttu-id="6e774-148">После развертывания приложение логики будет полноценно работать с допустимыми параметрами.</span><span class="sxs-lookup"><span data-stu-id="6e774-148">After deployment, the logic app works end-to-end with valid parameters.</span></span>
<span data-ttu-id="6e774-149">Но чтобы создать допустимый маркер доступа, необходимо авторизовать подключения OAuth.</span><span class="sxs-lookup"><span data-stu-id="6e774-149">However, you must still authorize OAuth connections to generate a valid access token.</span></span>
<span data-ttu-id="6e774-150">Чтобы разрешить подключения OAuth, откройте приложение логики в конструкторе приложений логики и авторизуйте эти подключения.</span><span class="sxs-lookup"><span data-stu-id="6e774-150">To authorize OAuth connections, open the logic app in the Logic Apps Designer, and authorize these connections.</span></span> <span data-ttu-id="6e774-151">Или, если выполняется автоматизированное развертывание, можно использовать сценарий, предоставляющий разрешение на каждое подключение OAuth.</span><span class="sxs-lookup"><span data-stu-id="6e774-151">Or for automated deployment, you can use a script to consent to each OAuth connection.</span></span>
<span data-ttu-id="6e774-152">На GitHub есть пример сценария в проекте [LogicAppConnectionAuth](https://github.com/logicappsio/LogicAppConnectionAuth) .</span><span class="sxs-lookup"><span data-stu-id="6e774-152">There's an example script on GitHub under the [LogicAppConnectionAuth](https://github.com/logicappsio/LogicAppConnectionAuth) project.</span></span>

<a name="team-services"></a>
## <a name="visual-studio-team-services-release-management"></a><span data-ttu-id="6e774-153">Visual Studio Team Services Release Management</span><span class="sxs-lookup"><span data-stu-id="6e774-153">Visual Studio Team Services Release Management</span></span>

<span data-ttu-id="6e774-154">При развертывании среды и управлении ею часто используется инструмент Release Management в Visual Studio Team Services и шаблон развертывания приложения логики.</span><span class="sxs-lookup"><span data-stu-id="6e774-154">A common scenario for deploying and managing an environment is to use a tool like Release Management in Visual Studio Team Services, with a logic app deployment template.</span></span> <span data-ttu-id="6e774-155">Служба Visual Studio Team Services содержит задачу [развертывания группы ресурсов Azure](https://github.com/Microsoft/vsts-tasks/tree/master/Tasks/DeployAzureResourceGroup), которую можно добавить в любую сборку или конвейер выпуска.</span><span class="sxs-lookup"><span data-stu-id="6e774-155">Visual Studio Team Services includes a [Deploy Azure Resource Group](https://github.com/Microsoft/vsts-tasks/tree/master/Tasks/DeployAzureResourceGroup) task that you can add to any build or release pipeline.</span></span> <span data-ttu-id="6e774-156">Для авторизации развертывания требуется [субъект-служба](https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/). При ее наличии можно создать определение выпуска.</span><span class="sxs-lookup"><span data-stu-id="6e774-156">You need to have a [service principal](https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/) for authorization to deploy, and then you can generate the release definition.</span></span>

1. <span data-ttu-id="6e774-157">Для создания пустого определения в Release Management выберите пункт **Пусто**.</span><span class="sxs-lookup"><span data-stu-id="6e774-157">In Release Management, select **Empty** so that you create an empty definition.</span></span>

    ![Создание пустого определения][1]

2. <span data-ttu-id="6e774-159">Выберите для этого любые ресурсы. Лучше всего подойдет шаблон приложения логики, созданный вручную или в процессе сборки.</span><span class="sxs-lookup"><span data-stu-id="6e774-159">Choose any resources you need for this, most likely including the logic app template that is generated manually or as part of the build process.</span></span>
3. <span data-ttu-id="6e774-160">Добавьте задачу **развертывания группы ресурсов Azure** .</span><span class="sxs-lookup"><span data-stu-id="6e774-160">Add an **Azure Resource Group Deployment** task.</span></span>
4. <span data-ttu-id="6e774-161">Настройте использование [субъекта-службы](https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/)и добавьте ссылку на файлы шаблона и параметров шаблона.</span><span class="sxs-lookup"><span data-stu-id="6e774-161">Configure with a [service principal](https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/), and reference the Template and Template Parameters files.</span></span>
5. <span data-ttu-id="6e774-162">При необходимости выполните соответствующие действия в процессе выпуска для других сред, автоматических тестов или механизмов утверждения.</span><span class="sxs-lookup"><span data-stu-id="6e774-162">Continue to build out steps in the release process for any other environment, automated test, or approvers as needed.</span></span>

<!-- Image References -->
[1]: ./media/logic-apps-create-deploy-template/emptyreleasedefinition.png
