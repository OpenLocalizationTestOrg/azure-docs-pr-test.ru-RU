---
title: "Пакетная обработка сообщений EDI как группы или коллекции в Azure Logic Apps | Документация Майкрософт"
description: "Отправка сообщений EDI для пакетной обработки в приложениях логики"
keywords: "пакет, пакетная обработка, пакетное кодирование"
author: divswa
manager: anneta
editor: 
services: logic-apps
documentationcenter: 
ms.assetid: 
ms.service: logic-apps
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/21/2017
ms.author: LADocs; estfan; divswa
ms.openlocfilehash: 837cb0d9595da5b5bd4f01fb4576f75e98ab8912
ms.sourcegitcommit: ccb84f6b1d445d88b9870041c84cebd64fbdbc72
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/14/2017
---
# <a name="send-x12-messages-in-batch-to-trading-partners"></a>Пакетная отправка сообщений X12 торговым партнерам

В сценариях "бизнес — бизнес" (B2B) партнеры часто обмениваются сообщениями в группах или пакетах. Для отправки сообщений в группах или пакетах торговым партнерам можно создать пакет с несколькими элементами, а затем обработать эти элементы пакетом с помощью пакетного действия X12.


Пакетная обработка сообщений X12, как и других сообщений, использует триггер и действие "Пакет". Также для X12 пакет проходит через этап кодирования X12, прежде чем отправиться к партнеру или в любое другое назначение. Дополнительные сведения о триггере и действии "Пакет" см. в статье [Пакетная обработка сообщений](logic-apps-batch-process-send-receive-messages.md).

В этом разделе показано, как выполнять пакетную обработку сообщений X12 с помощью следующих задач:
* [Создание приложения логики, которое получает элементы и создает пакет](#receiver). Это "получающее" приложение логики выполняет следующие действия:
 
   * указывает имя пакета и условия отправки, которые должны выполняться для отправки элементов в виде пакета;

   * обрабатывает или кодирует элементы в пакете с помощью указанного соглашения X12 или идентификаторов партнеров.

* [Создание приложения логики, которое отправляет элементы в пакет](#sender). Это "отправляющее" приложение логики указывает, куда отправлять элементы для пакетной обработки. Точкой назначения должно быть существующее получающее приложение логики.


## <a name="prerequisites"></a>Предварительные требования

Для выполнения этого примера необходимы следующие компоненты:

* Подписка Azure. Если у вас нет подписки, вы можете [создать бесплатную пробную версию учетной записи Azure](https://azure.microsoft.com/free/). В противном случае вы можете [зарегистрироваться на получение подписки с оплатой по мере использования](https://azure.microsoft.com/pricing/purchase-options/).

* [учетная запись интеграции](logic-apps-enterprise-integration-create-integration-account.md), которая уже определена и связана с подпиской Azure;

* По крайней мере два [партнера](logic-apps-enterprise-integration-partners.md), которые определены в учетной записи интеграции. Убедитесь, что каждый партнер использует квалификатор X12 (код SCAC) в свойствах партнера в качестве бизнес-идентификатора.

* В учетной записи интеграции должно быть определено [соглашение X12](logic-apps-enterprise-integration-x12.md).

<a name="receiver"></a>

## <a name="create-a-logic-app-that-receives-x12-messages-and-creates-a-batch"></a>Создание приложения логики, которое получает сообщения X12 и создает пакет

Прежде чем отправлять сообщения в пакет, необходимо сначала создать "получающее" приложение логики с триггером **Пакет**. Тогда вы сможете выбрать это получающее приложение логики при создании отправляющего приложения. В настройках получения укажите имя пакета, условия его отправки, соглашение X12 и другие параметры. 


1. На [портале Azure](https://portal.azure.com) создайте приложение логики с именем BatchX12Messages.

2. В конструкторе Logic Apps добавьте триггер **Пакет**, который запускает рабочий процесс приложения логики. В поле поиска введите слово "пакет" в качестве фильтра. Выберите триггер **Пакет — Пакетные сообщения**.

   ![Добавление триггера "Пакет"](./media/logic-apps-scenario-EDI-send-batch-messages/add-batch-receiver-trigger.png)

3. Задайте имя пакета и укажите критерии для его отправки, например:

   * **Имя пакета**: имя, используемое для идентификации пакета. В данном примере — TestBatch.

   * **Критерии выпуска**: условия отправки пакета, которые основываются на количестве сообщений, расписании или на обоих этих факторах.
   
     ![Ввод сведений для триггера "Пакет"](./media/logic-apps-batch-process-send-receive-messages/receive-batch-release-criteria.png)

   * **Число сообщений**: количество сообщений, которое хранится как пакет, а затем отправляется в обработку. В данном примере — 5.

     ![Ввод сведений для триггера "Пакет"](./media/logic-apps-batch-process-send-receive-messages/receive-batch-count-based.png)

   * **Расписание**: расписание отправки пакета на обработку (в этом примере — "каждые 10 минут").

     ![Ввод сведений для триггера "Пакет"](./media/logic-apps-scenario-EDI-send-batch-messages/receive-batch-schedule-based.png)


4. Добавьте еще одно действие, которое кодирует сообщения, объединенные в группы или пакеты, и создает пакетированное сообщение X12. 

   а. Выберите **+ Новый шаг** > **Добавить действие**.

   b. В поле поиска введите "X12 пакет" в качестве фильтра и выберите вариант действия для **X12 — Пакетная кодировка**. Как и в случае с соединителем для кодирования X12 для действия пакетного кодирования доступно несколько вариантов. Можно выбрать любой из них.

   ![Выбор действия пакетного кодирования X12](./media/logic-apps-scenario-EDI-send-batch-messages/add-batch-encode-action.png)
   
5. Задайте свойства для только что добавленного действия.

   * В поле **Имя соглашения X12** выберите соглашение из раскрывающегося списка. Если список пуст, то убедитесь в том, что создано подключение к учетной записи интеграции.

   * В поле **BatchName** выберите **Имя пакета** из списка динамического содержимого.
   
   * В поле **PartitionName** выберите **Имя раздела** из списка динамического содержимого.

   * В поле **Items** выберите **Пакетные элементы** из списка динамического содержимого.

   ![Сведения о действии пакетного кодирования](./media/logic-apps-scenario-EDI-send-batch-messages/batch-encode-action-details.png)

6. Для тестирования добавьте действие HTTP, чтобы отправить пакетированное сообщение в [службу RequestBin](https://requestbin.fullcontact.com/). 

   1. В поле поиска введите "HTTP" в качестве фильтра. Выберите действие **HTTP — HTTP**.
    
      ![Выбор действия HTTP](./media/logic-apps-scenario-EDI-send-batch-messages/batch-receive-add-http-action.png)

   2. В списке **Метод** выберите **POST**. Для поля **Uri** создайте универсальный код ресурса (URI) с помощью службы RequestBin и введите полученный URI. В поле **Текст**, когда откроется динамический список, выберите значение **Текст** в разделе **Пакетная кодировка по имени соглашения**. Если значение **Текст** не отображается, то щелкните **Показать больше** рядом с пунктом **Пакетная кодировка по имени соглашения**.

      ![Ввод сведений о действии HTTP](./media/logic-apps-scenario-EDI-send-batch-messages/batch-receive-add-http-action-details.png)

7.  Когда получающее приложение логики создано, сохраните это приложение.

    ![Сохранение приложения логики](./media/logic-apps-scenario-EDI-send-batch-messages/save-batch-receiver-logic-app.png)

    > [!IMPORTANT]
    > Раздел имеет ограничение в 5000 сообщений или 80 МБ. При выполнении хотя бы одного условия пакет может быть отправлен, даже если не выполняется условие, определенное пользователем.

<a name="sender"></a>

## <a name="create-a-logic-app-that-sends-x12-messages-to-a-batch"></a>Создание приложения логики, которое отправляет сообщения X12 в пакет

Теперь создайте одно или несколько приложений логики, которые отправляют элементы в пакет, заданный получающим приложением логики. В настройках отправки укажите получающее приложение логики, имя пакета, содержимое сообщения и другие параметры. При необходимости можно указать уникальный ключ секции, чтобы разделить пакет на подмножества для сбора элементов с помощью этого ключа.

Отправляющее приложение логики должно знать, куда отправлять элементы, в то время как получающее приложение логики не нуждается в сведениях об отправителях.


1. Создайте второе приложение логики с именем X12MessageSender. Добавьте триггер **Запрос/ответ — Запрос** в свое приложение логики. 
   
   ![Добавление триггера "Запрос"](./media/logic-apps-scenario-EDI-send-batch-messages/add-request-trigger-sender.png)

2. Добавьте новый шаг для отправки сообщений в пакет.

   1. Выберите **+ Новый шаг** > **Добавить действие**.

   2. В поле поиска введите слово "пакет" в качестве фильтра. 

3. Выберите действие **Отправить сообщения в пакет — Выберите рабочий процесс Logic Apps с триггером пакета**.

   ![Выбор действия "Отправить сообщения в пакет"](./media/logic-apps-scenario-EDI-send-batch-messages/send-messages-batch-action.png)

4. Теперь выберите приложение логики BatchX12Messages, которое вы создали ранее и которое теперь доступно как действие.

   ![Выбор приложения логики для "получения пакета"](./media/logic-apps-scenario-EDI-send-batch-messages/send-batch-select-batch-receiver.png)

   > [!NOTE]
   > В этом списке также отображаются все прочие приложения логики, которые содержат триггеры пакетной обработки.

5. Задайте свойства пакета.

   * **Имя пакета**: имя пакета, определяемое принимающим приложением логики. В данном примере — TestBatch. Это имя проверяется во время выполнения.

     > [!IMPORTANT]
     > Убедитесь, что имя пакета не было изменено. Оно должно совпадать с именем пакета, указанным в принимающем приложении логики.
     > Изменение имени пакета приводит к сбою в работе отправляющего приложения логики.

   * **Содержимое сообщения**: текст сообщения, отправляемого в пакет.
   
   ![Настройка свойств пакета](./media/logic-apps-scenario-EDI-send-batch-messages/send-batch-select-batch-properties.png)

6. Сохраните приложение логики. Теперь ваше отправляющее приложение логики выглядит примерно так:

   ![Сохранение отправляющего приложения логики](./media/logic-apps-scenario-EDI-send-batch-messages/send-batch-finished.png)

## <a name="test-your-logic-apps"></a>Тестирование приложений логики

Чтобы проверить решение пакетной обработки, опубликуйте сообщения X12 в отправляющем приложении логики из приложения [Postman](https://www.getpostman.com/postman) или аналогичного инструмента. Через некоторое время вы должны начать получать сообщения X12 в службе RequestBin — в виде пакета из пяти элементов или каждые 10 минут. Все они должны иметь одинаковый ключ раздела.

## <a name="next-steps"></a>Дальнейшие действия

* [Пакетная обработка сообщений](logic-apps-batch-process-send-receive-messages.md) 
* [Создание бессерверного приложения в Visual Studio с использованием приложений логики и функций](../logic-apps/logic-apps-serverless-get-started-vs.md)
* [Сценарий обработки исключений и ведения журнала ошибок для приложений логики](../logic-apps/logic-apps-scenario-error-and-exception-handling.md)
