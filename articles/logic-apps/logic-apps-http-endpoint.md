---
title: "Вызовы, срабатывания триггеров и создание вложенных рабочих процессов c помощью конечных точек HTTP в Azure Logic Apps | Документация Майкрософт"
description: "Настройка конечных точек HTTP для вызова, срабатывания триггеров или создания вложенных рабочих процессов для Azure Logic Apps"
services: logic-apps
keywords: "рабочие процессы, конечные точки HTTP"
author: jeffhollan
manager: anneta
editor: 
documentationcenter: 
ms.assetid: 73ba2a70-03e9-4982-bfc8-ebfaad798bc2
ms.service: logic-apps
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.custom: H1Hack27Feb2017
ms.date: 03/31/2017
ms.author: LADocs; jehollan
ms.openlocfilehash: dab336da4e010d0a78de9a2bdd62536d8fdd9bf1
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="call-trigger-or-nest-workflows-with-http-endpoints-in-logic-apps"></a>Вызовы, срабатывания триггеров и создание вложенных рабочих процессов в приложениях логики

Вы можете предоставлять доступ к синхронным конечным точкам HTTP, выступающим в качестве триггеров в приложениях логики, с помощью которых можно активировать или вызвать приложение логики через URL-адрес. Также вы можете создавать вложенные рабочие процессы в приложениях логики с помощью шаблона вызываемых конечных точек.

Для создания конечных точек HTTP, чтобы ваши приложения логики могли получать входящие запросы, добавьте эти триггеры:

* [Запрос](../connectors/connectors-native-reqres.md)

* [webhook API подключения;](logic-apps-workflow-actions-triggers.md#api-connection-trigger)

* [webhook HTTP](../connectors/connectors-native-webhook.md).

   > [!NOTE]
   > Несмотря на то что в наших примерах используется триггер **запроса**, все принципы аналогично применимы для других типов триггеров, поэтому вы можете использовать любой из перечисленных триггеров HTTP.

## <a name="set-up-an-http-endpoint-for-your-logic-app"></a>Настройка конечной точки HTTP для приложения логики

Чтобы создать конечную точку HTTP, добавьте триггер, который может принимать входящие запросы.

1. Войдите на [портал Azure](https://portal.azure.com "Портал Azure"). В вашем приложении логики откройте конструктор приложений логики.

2. Добавьте триггер, который позволяет приложению логики получать входящие запросы. Например, добавьте триггер **Request** в приложение логики.

3.  В разделе **Схема JSON текста запроса** вы можете при необходимости ввести схему JSON для полезных данных, которые должен получить триггер.

    Конструктор использует эту схему для создания токенов, с помощью которых приложение логики получает, анализирует и передает данные от триггера через рабочий процесс. 
    Дополнительные сведения о [токенах, созданных из схем JSON](#generated-tokens).

    В этом примере введите схему, показанную в конструкторе:

    ```json
    {
      "type": "object",
      "properties": {
        "address": {
          "type": "string"
        }
      },
      "required": [
        "address"
      ]
    }
    ```

    ![Добавление действия Request][1]

    > [!TIP]
    > 
    > Вы можете создать схему для примера полезных данных JSON с помощью такого инструмента, как [jsonschema.net](http://jsonschema.net/), или с помощью триггера **запроса**, выбрав **Использовать пример полезной нагрузки, чтобы создать схему**. 
    > Введите образец полезных данных и выберите **Готово**.

    Например, образец полезных данных

    ```json
    {
       "address": "21 2nd Street, New York, New York"
    }
    ```

    создает эту схему:

    ```json
    {
       "type": "object",
       "properties": {
          "address": {
             "type": "string" 
          }
       }
    }
    ```

4.  Сохраните приложение логики. В поле **HTTP POST на этот URL-адрес** необходимо указать созданный URL-адрес обратного вызова:

    ![Созданный URL-адрес обратного вызова для конечной точки](./media/logic-apps-http-endpoint/generated-endpoint-url.png)

    Этот URL-адрес содержит ключ подписанного URL-адреса в параметрах запроса, используемого для проверки подлинности. 
    Вы также можете получить URL-адрес конечной точки HTTP из колонки обзора приложения логики на портале Azure. В разделе **Журнал триггеров** выберите триггер:

    ![Получение URL-адреса конечной точки HTTP на портале Azure][2]

    URL-адрес также можно получить, выполнив этот вызов:

    ```
    POST https://management.azure.com/{logic-app-resourceID}/triggers/{myendpointtrigger}/listCallbackURL?api-version=2016-06-01
    ```

## <a name="change-the-http-method-for-your-trigger"></a>Изменение метода HTTP для триггера

По умолчанию триггер **запроса** ожидает запрос HTTP POST, но вы можете воспользоваться другим методом HTTP. 

> [!NOTE]
> Вы можете указать только один тип метода.

1. Для триггера **запроса** выберите **Показать дополнительные параметры**.

2. Откройте список **Метод**. В этом примере выберите **GET**, чтобы вы могли позже проверить URL-адрес конечной точки HTTP.

    > [!NOTE]
    > Вы можете выбрать любой другой метод HTTP или указать пользовательский метод для своего приложения логики.

    ![Изменение метода HTTP](./media/logic-apps-http-endpoint/change-method.png)

## <a name="accept-parameters-through-your-http-endpoint-url"></a>Принятие параметров через URL-адрес конечной точки HTTP

Если вы хотите, чтобы ваш URL-адрес конечной точки HTTP принял параметры, следует настроить относительный путь триггера.

1. Для триггера **запроса** выберите **Показать дополнительные параметры**. 

2. В разделе **Метод** укажите метод HTTP, который будет использовать запрос. В этом примере выберите метод **GET**, чтобы проверить свой URL-адрес конечной точки HTTP.

      > [!NOTE]
      > Когда вы указываете относительный путь для своего триггера, вы должны явно указать для триггера метод HTTP.

3. В поле **Относительный путь** укажите относительный путь для параметра, который ваш URL-адрес должен принять, например `customers/{customerID}`.

    ![Указание метода HTTP и относительного пути для параметра](./media/logic-apps-http-endpoint/relativeurl.png)

4. Чтобы использовать параметр, добавьте действие **Ответ** для приложения логики. (Для вашего триггера выберите **Новый шаг** > **Добавить действие** > **Ответ**.) 

5. В **тексте** ответа добавьте токен для параметра, который вы указали в относительном пути триггера.

    Например, чтобы вернуть `Hello {customerID}`, добавьте в **текст** ответа `Hello {customerID token}`. 
    Появится список динамического содержимого с токеном `customerID`, который нужно выбрать.

    ![Добавление параметра в текст ответа](./media/logic-apps-http-endpoint/relativeurlresponse.png)

    Поле **текста** должно выглядеть, как в следующем примере:

    ![Поле текста ответа с параметром](./media/logic-apps-http-endpoint/relative-url-with-parameter.png)

6. Сохраните приложение логики. 

    URL-адрес конечной точки HTTP теперь включает относительный путь, например: 

    https&#58;//prod-00.southcentralus.logic.azure.com/workflows/f90cb66c52ea4e9cabe0abf4e197deff/triggers/manual/paths/invoke/customers/{customerID}...

7. Для проверки конечной точки HTTP скопируйте и вставьте обновленный URL-адрес в другом окне браузера, но замените `{customerID}` на `123456` и нажмите клавишу ВВОД.

    Браузер должен вывести следующий текст: 

    `Hello 123456`

<a name="generated-tokens"></a>
### <a name="tokens-generated-from-json-schemas-for-your-logic-app"></a>Токены, создаваемые из схем JSON для вашего приложения логики

При указании схемы JSON для триггера **запроса** в конструкторе приложений логики создаются токены для свойств в этой схеме. Затем эти токены можно использовать для передачи данных через рабочий процесс приложения логики.

В этом примере, если вы добавили свойства `title` и `name` для схемы JSON, их токены теперь доступны для использования на последующих шагах рабочего процесса. 

Ниже приведена полная схема JSON.

```json
{
   "type": "object",
   "properties": {
      "address": {
         "type": "string"
      },
      "title": {
         "type": "string"
      },
      "name": {
         "type": "string"
      }
   },
   "required": [
      "address",
      "title",
      "name"
   ]
}
```

## <a name="create-nested-workflows-for-logic-apps"></a>Создание вложенных рабочих процессов для приложений логики

Вы можете вкладывать рабочие процессы в свое приложение логики путем добавления других приложений логики, которые могут принимать запросы. Чтобы включить приложения логики, добавьте действие **Azure Logic Apps — Выберите рабочий процесс Logic Apps** в свой триггер. Затем вы можете выбрать подходящие приложения логики.

![Добавление другого приложения логики](./media/logic-apps-http-endpoint/choose-logic-apps-workflow.png)

## <a name="call-or-trigger-logic-apps-through-http-endpoints"></a>Вызов или запуск приложений логики через конечные точки HTTP

После создания конечной точки HTTP можно вызвать приложение логики, добавив метод `POST` к полному URL-адресу. Приложения логики имеют встроенную поддержку конечных точек прямого доступа.

## <a name="reference-content-from-an-incoming-request"></a>Ссылка на содержимое входящего запроса

При использовании типа содержимого `application/json` можно ссылаться на свойства из входящего запроса. Иначе содержимое обрабатывается как единая двоичная единица, которую можно передать в другие интерфейсы API. Чтобы сослаться на это содержимое внутри рабочего процесса, необходимо преобразовать его. Например, если передать содержимое `application/xml`, можно использовать `@xpath()` для извлечения XPath или `@json()` для преобразования XML в JSON. Дополнительные сведения о [работе с типами содержимого](../logic-apps/logic-apps-content-type.md).

Чтобы получить выходные данные из входящего запроса, можно использовать функцию `@triggerOutputs()`. Выходные данные выглядят следующим образом:

```json
{
    "headers": {
        "content-type" : "application/json"
    },
    "body": {
        "myProperty" : "property value"
    }
}
```

Для доступа к свойству `body` можно использовать сокращенный вариант `@triggerBody()`. 

## <a name="respond-to-requests"></a>Ответ на запросы

Возможно, вы захотите ответить на определенные запросы, которые запускают логическое приложение, возвращая содержимое вызывающему объекту. Чтобы создать код состояния, заголовок и текст вашего ответа, вы можете использовать действие **Ответ**. Это действие может находиться в любом месте приложения логики, а не только в конце рабочего процесса.

> [!NOTE] 
> Если ваше приложение логики не включает действие **Ответ**, конечная точка HTTP *немедленно* отвечает состоянием **202 — Принят**. Кроме того, для получения ответа на исходный запрос следует завершить все шаги, необходимые для получения ответа, в течение [времени ожидания запроса](./logic-apps-limits-and-config.md). Исключение составляет только вызов рабочего процесса в качестве вложенного приложения логики. Если в течение этого времени ответ не получен, срок действия входящего запроса истечет и будет получен ответ HTTP **408 время ожидания клиента истекло**. Для вложенных приложений логики родительское приложение логики будет ожидать ответ до конца, независимо от того, сколько времени на это потребуется.

### <a name="construct-the-response"></a>Создание ответа

Вы можете включить несколько заголовков и любой тип содержимого в тексте ответа. В нашем примере ответа заголовок указывает, что ответ имеет тип содержимого `application/json`, а текст содержит `title` и `name`, на основе обновленной ранее схемы JSON для триггера **запроса**.

![Действие ответа HTTP][3]

У ответов есть следующие свойства:

| Свойство | Описание |
| --- | --- |
| statusCode |Указывает код состояния HTTP для ответа на входящий запрос. Это может быть любой допустимый код состояния, который начинается с 2xx, 4xx или 5xx. Но коды состояния 3xx не допускаются. |
| headers |Определяет число заголовков для включения в ответ. |
| текст |Определяет объект текста. Это может быть строка, объект JSON и даже двоичное содержимое из предыдущего шага. |

Вот как выглядит схема JSON для действия **Ответ**:

``` json
"Response": {
   "inputs": {
      "body": {
         "title": "@{triggerBody()?['title']}",
         "name": "@{triggerBody()?['name']}"
      },
      "headers": {
           "content-type": "application/json"
      },
      "statusCode": 200
   },
   "runAfter": {},
   "type": "Response"
}
```

> [!TIP]
> Чтобы просмотреть полное определение JSON для приложения логики, в конструкторе приложений логики выберите **Представление кода**.

## <a name="q--a"></a>Вопросы и ответы

#### <a name="q-what-about-url-security"></a>Вопрос. Как обеспечивается безопасность URL-адресов?

Ответ. При создании URL-адресов обратного вызова Azure обеспечивает безопасность с помощью подписанного URL-адреса. Подпись передается в качестве параметра запроса и проверяется перед запуском приложения логики. Azure создает эту подпись на основе уникального сочетания секретного ключа для каждого приложения логики, имени триггера и выполняемой операции. Не имея доступа к секретному ключу приложения логики, создать действительную подпись невозможно.

   > [!IMPORTANT]
   > Для рабочих и безопасных систем настоятельно не рекомендуется вызывать приложения логики напрямую из браузера, так как:
   > 
   > * ключ общего доступа отображается в URL-адресе;
   > * невозможно управлять политиками безопасного содержимого из-за общих доменов, используемых клиентами приложения логики.

#### <a name="q-can-i-configure-http-endpoints-further"></a>Вопрос. Могу ли я дополнительно настроить конечные точки HTTP?

Ответ. Да, конечные точки HTTP поддерживают расширенную конфигурацию через [**управление API**](../api-management/api-management-key-concepts.md). Эта служба также предлагает вам возможность согласованно управлять всеми своими API, включая приложения логики, настраивать имена домена, использовать дополнительные методы проверки подлинности и т. д. В частности она предоставляет следующие возможности:

* [Изменение метода запроса](https://docs.microsoft.com/azure/api-management/api-management-advanced-policies#SetRequestMethod)
* [Изменение сегментов URL-адреса запроса](https://docs.microsoft.com/azure/api-management/api-management-transformation-policies#RewriteURL)
* настройка доменов управления API на [портале Azure](https://portal.azure.com/ "портал Azure");
* настройка политики для проверки базовой проверки подлинности.

#### <a name="q-what-changed-when-the-schema-migrated-from-the-december-1-2014-preview"></a>Вопрос. Что изменилось после миграции схемы с предварительной версии от 1 декабря 2014 года?

Ответ. Вот сводка об этих изменениях:

| Предварительная версия от 1 декабря 2014 года | 1 июня 2016 года |
| --- | --- |
| Щелкните приложение API **Прослушиватель HTTP**. |Щелкните **Ручной триггер** (приложение API не требуется). |
| Параметр прослушивателя HTTP*Sends response automatically*(Отправляет ответ автоматически). |Добавьте действие **Ответ** в определение рабочего процесса или не делайте этого |
| Настройка базовой проверки подлинности или OAuth |с помощью управления API |
| Настройка метода HTTP |В разделе **Показать дополнительные параметры** выберите метод HTTP |
| Настройка относительного пути |В разделе **Показать дополнительные параметры** добавьте относительный путь |
| Ссылка на текст входящего ответа через `@triggerOutputs().body.Content` |Используйте для ссылки `@triggerOutputs().body` |
| **Отправка HTTP-ответа** для прослушивателя HTTP. |Щелкните **Ответить на запрос HTTP** (приложение API не требуется) |

## <a name="get-help"></a>Получение справки

Чтобы задать вопросы, помочь другим пользователям и узнать, что делают другие пользователи, посетите [форум по Azure Logic Apps](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps).

Чтобы улучшить Azure Logic Apps и соединители, голосуйте за идеи или предлагайте собственные на [сайте обратной связи Azure Logic Apps](http://aka.ms/logicapps-wish).

## <a name="next-steps"></a>Дальнейшие действия

* [Создание определений приложений логики](./logic-apps-author-definitions.md)
* [Обработка ошибок и исключений](./logic-apps-exception-handling.md)

[1]: ./media/logic-apps-http-endpoint/manualtrigger.png
[2]: ./media/logic-apps-http-endpoint/manualtriggerurl.png
[3]: ./media/logic-apps-http-endpoint/response.png
