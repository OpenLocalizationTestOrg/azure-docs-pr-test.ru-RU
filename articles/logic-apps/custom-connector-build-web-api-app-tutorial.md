---
title: "Создание пользовательских соединителей с помощью интерфейсов веб-API (Azure Logic Apps) | Документация Майкрософт"
description: "Создание пользовательских соединителей с помощью интерфейсов веб-API"
author: ecfan
manager: anneta
editor: 
services: logic-apps
documentationcenter: 
ms.assetid: 
ms.service: logic-apps
ms.workload: logic-apps
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/22/2017
ms.author: LADocs; estfan
ms.openlocfilehash: 22bf335718721d29933557142b436e75778f8c86
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="create-custom-connectors-from-web-apis"></a>Создание пользовательских соединителей с помощью интерфейсов веб-API

Чтобы создать пользовательский соединитель, который можно использовать в Azure Logic Apps, Microsoft Flow или Microsoft PowerApps, сначала необходимо создать интерфейс веб-API, который можно разместить в веб-приложениях Azure, зарегистрировать в качестве соединителя в Logic Apps, Flow или PowerApps и для которого можно выполнить аутентификацию в Azure Active Directory. В этом руководстве показано, как выполнить эти задачи, создав приложение веб-API на ASP.NET. Шаблоны, которые демонстрируют структуру кода для создания триггеров и действий соединителя, вы найдете в разделе [Создание пользовательских API в качестве соединителей для приложений логики](../logic-apps/logic-apps-create-api-app.md).

## <a name="prerequisites"></a>Предварительные требования

* [Visual Studio 2013 или более поздней версия](https://www.visualstudio.com/vs/). В этом учебнике используется Visual Studio 2015.

* Код для интерфейса веб-API. Если у вас его нет, изучите руководство [Getting Started with ASP.NET Web API 2 (C#)](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api) (Приступая к работе с веб-API ASP.NET, версия 2 (C#)).

* Подписка Azure. Если у вас нет подписки, вы можете для начала использовать [бесплатную учетную запись Azure](https://azure.microsoft.com/free/). Или зарегистрируйтесь для получения [подписки с оплатой по мере использования](https://azure.microsoft.com/pricing/purchase-options/).

## <a name="create-and-deploy-an-aspnet-web-app-to-azure"></a>Создание и развертывание веб-приложения ASP.NET в Azure

Для работы с этим руководством создайте веб-приложение ASP.NET на Visual C#. 

1. Откройте Visual Studio и последовательно выберите элементы **Файл** > **Создать проект**.

   1. Разверните элемент **Установленные**, перейдите в меню **Шаблоны** > **Visual C#** > **Web**и выберите **Веб-приложение ASP.NET**.

   2. Укажите имя проекта, расположение и имя решения для вашего приложения, а затем нажмите кнопку **ОК**.

   Например:

   ![Создание веб-приложения ASP.NET на Visual C#](./media/custom-connector-build-web-api-app-tutorial/visual-studio-new-project-aspnet-web-app.png)

2. В поле **Создание веб-приложения ASP.NET** выберите шаблон **Веб-API**. Выберите значение **Размещение в облаке**, если оно еще не выбрано. Щелкните **Изменить аутентификацию**.

   ![Выбор шаблона "Веб-API", параметра "Размещение в облаке" и действия "Изменить аутентификацию"](./media/custom-connector-build-web-api-app-tutorial/visual-studio-web-api-template.png)

3. Выберите **Без аутентификации** и нажмите **ОК**. Аутентификацию можно настроить позднее.

   ![Выбор варианта "Без аутентификации"](./media/custom-connector-build-web-api-app-tutorial/visual-studio-change-authentication.png)

4. Когда отобразится поле **Создание веб-приложения ASP.NET**, нажмите кнопку **ОК**. 

5. В поле **Создание службы приложений** проверьте описанные в таблице параметры размещения, при необходимости внесите изменения и щелкните **Создать**. 

   [План служб приложений](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md) представляет коллекцию физических ресурсов, используемых для размещения приложений в подписке Azure. Узнайте больше о [службе приложений](../app-service/app-service-value-prop-what-is.md).

   ![Создание службы приложений](./media/custom-connector-build-web-api-app-tutorial/visual-studio-create-app-service.png)

   | Настройка | Рекомендуемое значение | Описание | 
   | ------- | --------------- | ----------- | 
   | Рабочая или учебная учетная запись Azure либо персональная учетная запись Майкрософт | *your-user-account* | Выберите нужную учетную запись | 
   | **Имя веб-приложения** | *custom-web-api-app-name* или имя по умолчанию | Введите имя для приложения веб-API, которое будет включено в URL-адрес приложения, например: http://*web-api-app-name*. | 
   | **Подписка** | *Azure-subscription-name* | Выберите подписку Azure, которую нужно использовать. | 
   | **Группа ресурсов** | *Azure-resource-group-name* | Выберите существующую группу ресурсов Azure или создайте новую, если ее еще нет. <p>**Примечание.** Группа ресурсов Azure помогает структурировать ресурсы Azure в подписке Azure. | 
   | **План службы приложений** | *App-Service-plan-name* | Выберите существующий план службы приложений или создайте новый, если его еще нет. | 
   |||| 

   Если вы создаете план службы приложений, укажите следующие параметры:

   | Настройка | Рекомендуемое значение | Описание | 
   | ------- | --------------- | ----------- | 
   | **Расположение** | *deployment-region* | Выберите регион для развертывания приложения. | 
   | **Размер** | *App-Service-plan-size* | Выберите размер вашего плана, который определяет стоимость и производительность вычислительных ресурсов для плана службы. | 
   |||| 

   Чтобы настроить другие ресурсы, необходимые приложению, выберите действие **Обзор дополнительных служб Azure**.

   | Настройка | Рекомендуемое значение | Описание | 
   | ------- | --------------- | ----------- | 
   | **Тип ресурса** | *Azure-resource-type* | Выберите и настройте дополнительные ресурсы, которые требуются вашему приложению. | 
   |||| 

6. Когда Visual Studio завершит развертывание проекта, приступайте к созданию кода для приложения.

## <a name="create-an-openapi-swagger-file-that-describes-your-web-api"></a>Создание файла OpenAPI (Swagger) с описанием интерфейса веб-API

Чтобы подключить приложение веб-API к Azure Logic Apps, вам потребуется [файл OpenAPI (ранее назывался Swagger)](http://swagger.io/) с описанием функциональности этого интерфейса API. Чтобы написать собственное определение OpenAPI для API-интерфейса, вы можете использовать [веб-редактор Swagger](http://editor.swagger.io/). В этом руководстве мы используем средство [Swashbuckle](https://github.com/domaindrivendev/Swashbuckle/blob/master/README.md) с открытым исходным кодом.

1. Установите пакет Nuget Swashbuckle в проект Visual Studio, если вы этого не сделали ранее.

   1. В Visual Studio щелкните **Инструменты** > **Диспетчер пакетов NuGet** > 
   **Консоль диспетчера пакетов**.

   2. В разделе **Консоль диспетчера пакетов** перейдите к каталогу проекта приложения, если открыт другой каталог (выполните `Set-Location "project-path"`), и запустите командлет PowerShell: 
   
      `Install-Package Swashbuckle`

      Например:

      ![Консоль диспетчера пакетов, установка Swashbuckle](./media/custom-connector-build-web-api-app-tutorial/visual-studio-package-manager-install-swashbuckle.png)

   > [!TIP]
   > Если вы запустите приложение после установки Swashbuckle, это средство создаст файл OpenAPI, доступный по URL-адресу: 
   >
   > http://*{корневой_URL_адрес_вашего_веб_api}*/swagger/docs/v1
   > 
   > Также Swashbuckle поддерживает пользовательский интерфейс по URL-адресу: 
   > 
   > http://*{корневой_URL_адрес_вашего_веб_api}*/swagger

3. Когда все будет готово, опубликуйте приложение веб-API в Azure. Для публикации из Visual Studio откройте обозреватель решений, щелкните веб-проект правой кнопкой мыши, выберите **Опубликовать...** и следуйте инструкциям на экране.

   > [!IMPORTANT]
   > Если в документе OpenAPI есть повторяющиеся идентификаторы операций, он считается недействительным. Если вы использовали шаблон для C#, в нем есть *повторяющийся идентификатор операции*: `Values_Get`. 
   > 
   > Чтобы устранить эту проблему, измените один из этих идентификаторов на `Value_Get` и опубликуйте документ повторно.

4. Чтобы получить документ OpenAPI, откройте в браузере такой адрес: 

   http://*{корневой_URL_адрес_вашего_веб_api}*/swagger/docs/v1

   Также вы можете скачать [пример документа OpenAPI](https://pwrappssamples.blob.core.windows.net/samples/webAPI.json) из этого руководства. 
   Прежде чем использовать этот документ, удалите все комментарии, то есть все содержимое строк после символов "//".

5. Сохраните содержимое в файле JSON. В некоторых браузерах вам придется скопировать этот текст и вставить его в пустой текстовый файл.

## <a name="next-steps"></a>Дальнейшие действия

* [Настройка аутентификации для пользовательских соединителей](../logic-apps/custom-connector-azure-active-directory-authentication.md).











