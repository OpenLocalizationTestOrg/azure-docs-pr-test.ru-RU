---
title: "Руководство по созданию службы данных для Marketplace | Документация Майкрософт"
description: "Подробные инструкции по созданию, сертификации и развертыванию службы данных для продажи в Azure Marketplace."
services: marketplace-publishing
documentationcenter: 
author: HannibalSII
manager: hascipio
editor: 
ms.assetid: 107baab2-5828-4158-abdf-59a580c80d37
ms.service: marketplace
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/26/2016
ms.author: hascipio; avikova
ms.openlocfilehash: 8ff76ea21ba684ae2a2afcb74d66b4912d7be053
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="understanding-the-nodes-schema-for-mapping-an-existing-web-service-to-odata-through-csdl"></a>Общее представление о схеме узлов для сопоставления существующей веб-службы с OData с помощью языка CSDL
> [!IMPORTANT]
> **В настоящее время мы больше не подключаем новые издатели служб данных. Новые службы данных не будут утверждены для добавления в список.** Дополнительные сведения о публикации бизнес-приложения SaaS на AppSource см. [здесь](https://appsource.microsoft.com/partners). Дополнительные сведения о публикации приложений IaaS или службы разработчика в Azure Marketplace см. [здесь](https://azure.microsoft.com/marketplace/programs/certified/).
>
>

В этом документе поясняется структура узла для сопоставления протокола OData и CSDL. Следует отметить, что структура узла представляет собой XML-документ правильного формата. Поэтому при разработке сопоставления OData применяются корневая, родительская и дочерняя схемы.

## <a name="ignored-elements"></a>Пропускаемые элементы
Ниже приведены элементы CSDL высокого уровня (узлы XML), которые не будут использоваться серверной службой Azure Marketplace во время импорта метаданных веб-служб. Они могут присутствовать, но будут пропущены.

| Элемент | Область |
| --- | --- |
| Элемент Using |Узел, подузлы и все атрибуты |
| Элемент Documentation |Узел, подузлы и все атрибуты |
| ComplexType |Узел, подузлы и все атрибуты |
| Элемент Association |Узел, подузлы и все атрибуты |
| Свойство Extended |Узел, подузлы и все атрибуты |
| EntityContainer |Пропускаемые атрибуты: *extends* и *AssociationSet* |
| Схема |Пропускаемые атрибуты: *Namespace* |
| FunctionImport |Пропускаемые атрибуты: *Mode* (предполагается использование значения по умолчанию: ln) |
| EntityType |Пропускаемые подузлы: *Key* и *PropertyRef* |

Ниже подробно описаны изменения (добавляемые и пропускаемые элементы) различных узлов XML на языке CSDL.

## <a name="functionimport-node"></a>Узел FunctionImport
Узел FunctionImport представляет один URL-адрес (точку входа), который предоставляет службу пользователю. Он позволяет описать способ обращения к URL-адресу, доступные пользователю параметры и способ предоставления этих параметров.

Подробные сведения об этом узле см. на странице [MSDNFunctionImportLink](https://msdn.microsoft.com/library/cc716710.aspx).

Ниже приведены дополнительные атрибуты (или дополнения к атрибутам), предоставляемые узлом FunctionImport.

**d:BaseUri** — шаблон URI для ресурса REST, предоставляемый Marketplace. Marketplace использует этот шаблон для создания запросов к веб-службе REST. Шаблон URI содержит заполнители параметров в форме {parameterName}, где parameterName — имя параметра. Например, apiVersion={версия_API}.
Параметры могут отображаться в качестве параметров URI или в качестве части пути URI. Если они отображаются в пути, они всегда являются обязательными (не могут быть помечены, как допускающие значение NULL). *Пример:* `d:BaseUri="http://api.MyWeb.com/Site/{url}/v1/visits?start={start}&amp;end={end}&amp;ApiKey=3fadcaa&amp;Format=XML"`

**Name** — имя импортируемой функции.  Не может совпадать с другими определенными именами в CSDL.  Например, Name="GetModelUsageFile".

**EntitySet** *(необязательно)* — если функция возвращает коллекцию типов сущностей, значение **EntitySet** должно представлять собой набор сущностей, к которому относится коллекция. В противном случае атрибут **EntitySet** не должен использоваться. *Пример:* `EntitySet="GetUsageStatisticsEntitySet"`

**ReturnType** *(необязательно)* — задает тип элементов, возвращаемых URI.  Не используйте этот атрибут, если функция не возвращает значение. Ниже приведены поддерживающиеся типы.

* **Collection (<Entity type name>)** — задает коллекцию определенных типов сущностей. Имя указано в атрибуте Name узла EntityType. Например, Collection(WXC.HourlyResult).
* **Raw (<mime type>)** — задает необработанный документ или большой двоичный объект, возвращаемый пользователю. Например, Raw(image/jpeg). Другие примеры:

  * ReturnType="Raw(text/plain)";
  * ReturnType="Collection(sage.DeleteAllUsageFilesEntity)"*.

**d:Paging** — задает способ обработки разбиения по страницам ресурсом REST. Значения параметров задаются в фигурных скобках, например, page={$page}&itemsperpage={$size}. Доступны следующие варианты:

* **None** — разбиение на страницы недоступно.
* **Skip** — разбиение на страницы выражается с помощью логических значений skip и take (вверху). skip перескакивает через M элементов, а take возвращает следующие N элементов. Значение параметра: $skip.
* **Take** — take возвращает следующие N элементов. Значение параметра: $take.
* **PageSize** — разбиение на страницы выражается с помощью логических значений page и size (количество элементов на страницу). page представляет текущую страницу, которая возвращается. Значение параметра: $page.
* **Size** — size представляет количество элементов, возвращаемых для каждой страницы. Значение параметра: $size.

**d:AllowedHttpMethods** *(необязательно)* — указывает, какие команды обрабатываются ресурсом REST. Кроме того, этот атрибут ограничивает допустимые команды заданными значениями.  По умолчанию используется POST.  *Пример:* `d:AllowedHttpMethods="GET"`. Доступны следующие варианты:

* **GET** — обычно используется для возврата данных.
* **POST** — обычно используется для вставки новых данных.
* **PUT** — обычно используется для обновления данных.
* **DELETE** — используется для удаления данных.

Ниже перечислены дополнительные дочерние узлы (не описанные в документации CSDL) в узле FunctionImport.

**d:RequestBody** *(необязательно)* — текст запроса, который используется для указания, что запрос ожидает отправки текста. В тексте запроса можно указать параметры. Они задаются в фигурных скобках, например {parameterName}. Эти параметры сопоставляются из входных данных пользователя с текстом, передаваемым в службу поставщика содержимого. Элемент RequestBody обладает атрибутом с именем httpMethod. Этот атрибут допускает два значения.

* **POST** — используется при запросе HTTP POST.
* **GET** — используется при запросе HTTP GET.

    Пример:

        `<d:RequestBody d:httpMethod="POST">
        <![CDATA[
        <req1:Request xmlns:r1="http://schemas.mysite.com//generic/requests/1" Version="1.0">
        <req1:Query>{Query}</req1:Query><req1:AppId>D453474</req1:AppId>
        <req:DestinationSchemas><req1:Schema>Generic.RequestResponse[1.0]</req1:Schema>
        </req1:DestinationSchemas>
        </req1: Request>
        ]]>
        </d:RequestBody>`

**d:Namespaces** и **d:Namespace** — этот узел описывает пространства имен, которые определяются в данных XML, возвращаемых при импорте функции (конечная точка URI). Данные XML, возвращаемые серверной службой, могут содержать любое количество пространств имен, необходимых, чтобы различать возвращаемое содержимое. **При использовании в запросах d:Map или d:Map XPath все эти пространства имен должны быть перечислены.** Узел d:Namespaces содержит набор или список узлов d:Namespace. В каждом из них отображается одно пространство имен, используемое в ответе серверной службы. Ниже перечислены атрибуты узла d:Namespace.

* **d:Prefix** — префикс пространства имен в том виде, в котором он отображается в результатах XML, возвращенных службой, например, f:FirstName, f:LastName, где f — это префикс.
* **d:Uri** — полный URI пространства имен, используемого в документе результата. Он представляет значение, в которое разрешается префикс во время выполнения.

**d:ErrorHandling** *(необязательно)* — узел содержит условия обработки ошибок. Каждое из условий сопоставляется с результатом, возвращаемым службой поставщика содержимого. Если условие соответствует предложенному коду ошибки HTTP, пользователю возвращается сообщение об ошибке.

**d:ErrorHandling** *(необязательно)* и **d:Condition** *(необязательно)* — узел условия содержит одно условие, которое проверяется в результате, возвращаемом службой поставщика содержимого. Ниже перечислены **обязательные** атрибуты.

* **d:Match** — выражение XPath, проверяющее, содержится ли заданный узел или значение в выходных данных XML поставщика содержимого. Выражение XPath выполняется применительно к выходным данным. Если условие совпало, возвращается значение true, а если нет — false.
* **d:HttpStatusCode** — код состояния HTTP, который должен возвращать Marketplace в случае совпадения условия. Marketplace сообщает пользователю об ошибках с помощью кодов состояния HTTP. Список кодов состояния HTTP можно найти по адресу http://en.wikipedia.org/wiki/HTTP_status_code.
* **d:ErrorMessage** — возвращаемое пользователю сообщение об ошибке, содержащее код состояния HTTP. Это должно быть понятное сообщение об ошибке, не содержащее секретных данных.

**d:Title** *(необязательно)* — позволяет описать заголовок функции. Источником значения в заголовке функции является:

* необязательный атрибут сопоставления (xpath), который указывает, в каком месте ответа, возвращенного на запрос службы, находится заголовок;
* заголовок, указанный в качестве значения узла.

**d:Rights** *(необязательно)* — права (например, авторские права), связанные с функцией. Источником значения для прав является:

* необязательный атрибут сопоставления (xpath), который указывает, в каком месте ответа, возвращенного на запрос службы, находятся права;
* права, указанные в качестве значения узла.

**d:Description** *(необязательно)* — краткое описание функции. Источником значения в описании является:

* необязательный атрибут сопоставления (xpath), который указывает, в каком месте ответа, возвращенного на запрос службы, находится описание;
* описание, указанное в качестве значения узла.

**d:EmitSelfLink** - *см. пример выше «FunctionImport для разбиения возвращаемых данных на страницы»*

**d:EncodeParameterValue** — дополнительное расширение OData.

**d:QueryResourceCost** — дополнительное расширение OData.

**d:Map** — дополнительное расширение OData.

**d:Headers** — дополнительное расширение OData.

**d:Headers** — дополнительное расширение OData.

**d:Value** — дополнительное расширение OData.

**d:HttpStatusCode** — дополнительное расширение OData.

**d:ErrorMessage** — дополнительное расширение OData.

## <a name="parameter-node"></a>Узел параметра
Этот узел представляет один параметр, который предоставляется как часть шаблона URI или текста запроса, который был указан в узле FunctionImport.

Полезные сведения об узле Parameter Element см. [здесь](http://msdn.microsoft.com/library/ee473431.aspx). (Используйте раскрывающийся список **Другие версии**, чтобы просмотреть документацию по другой версии.) *Пример:* `<Parameter Name="Query" Nullable="false" Mode="In" Type="String" d:Description="Query" d:SampleValues="Rudy Duck" d:EncodeParameterValue="true" MaxLength="255" FixedLength="false" Unicode="false" annotation:StoreGeneratedPattern="Identity"/>`

| Атрибут параметра | Обязательный | Значение |
| --- | --- | --- |
| Имя |Да |Имя параметра. Учитывается регистр.  Соответствует регистру BaseUri. **Пример:** `<Property Name="IsDormant" Type="Byte" />` |
| Тип |Да |Тип параметра. Значение должно представлять собой **EDMSimpleType** или сложный тип в рамках модели. Дополнительные сведения см. в разделе «6 поддерживаемых параметров и типов свойств».  (Учитывается регистр. Первый символ — прописная буква, все остальные — строчные.)  Дополнительные сведения см. в статье [Типы концептуальной модели (CSDL)] ([MSDNParameterLink](http://msdn.microsoft.com/library/bb399548.aspx)). **Пример:** `<Property Name="LimitedPartnershipID " Type="Int32" />` |
| Mode |Нет |**In**, Out или InOut в зависимости от типа параметра: входной, выходной или параметр ввода-вывода. (В Azure Marketplace доступен только In.) **Пример:** `<Parameter Name="StudentID" Mode="In" Type="Int32" />` |
| MaxLength |Нет |Максимально допустимая длина параметра. **Пример:** `<Property Name="URI" Type="String" MaxLength="100" FixedLength="false" Unicode="false" />` |
| Precision |Нет |Точность параметра. **Пример:** `<Property Name="PreviousDate" Type="DateTime" Precision="0" />` |
| Масштаб |Нет |Масштаб параметра. **Пример:** `<Property Name="SICCode" Type="Decimal" Precision="10" Scale="0" />` |

Ниже перечислены атрибуты, которые были добавлены в спецификации языка CSDL.

| Атрибут параметра | Описание |
| --- | --- |
| **d:Regex** *(необязательно)* |Оператор регулярных выражений, используемый для проверки входных значений параметра. Если входное значение не соответствует оператору, значение отклоняется. Это также позволяет задать набор возможных значений, например ^[0-9]+?$, чтобы разрешить использование только чисел. **Пример:** `<Parameter Name="имя" Mode="In" Type="String" d:Nullable="false" d:Regex="^[a-zA-Z]*$" d:Description="Имя, которое не может содержать пробелы, цифры или знаки, не входящие в латинский алфавит" d:SampleValues="George |
| **d:Enum** *(необязательно)* |Отделенный вертикальной чертой список значений, допустимых для параметра. Тип значений должен совпадать с определенным типом параметра. Пример: `english |
| **d: Nullable** *(необязательно)* |Позволяет определить, может ли параметр иметь значение NULL. Значение по умолчанию — true. Однако параметры, предоставляемые как часть пути в шаблоне URI, не могут принимать значение NULL. Если для этих параметров в атрибуте задано значение false, входные данные пользователя переопределяются. **Пример:** `<Parameter Name="BikeType" Type="String" Mode="In" Nullable="false"/>` |
| **d:SampleValue** *(необязательно)* |Пример значения, который отображается в виде сообщения клиенту в пользовательском интерфейсе.  Чтобы добавить несколько значений, воспользуйтесь списком значений, разделенных вертикальной чертой, т. е. `a |

## <a name="entitytype-node"></a>Узел EntityType
Этот узел представляет один из типов, возвращаемых пользователю из Marketplace. Он также содержит сопоставление выходных данных, возвращенных службой поставщика содержимого, со значениями, которые возвращаются пользователю.

Сведения об этом узле см. [здесь](http://msdn.microsoft.com/library/bb399206.aspx). (Используйте раскрывающийся список **Другие версии**, чтобы просмотреть документацию по другой версии.)

| Имя атрибута | Обязательный | Значение |
| --- | --- | --- |
| Имя |Да |Имя типа сущности. **Пример:** `<EntityType Name="ListOfAllEntities" d:Map="//EntityModel">` |
| BaseType |Нет |Имя другого типа сущности, который является базовым типом определяемого типа сущности. **Пример:** `<EntityType Name="PhoneRecord" BaseType="dqs:RequestRecord">` |

Ниже перечислены атрибуты, которые были добавлены в спецификации языка CSDL.

**d:Map** — выражение XPath, которое выполняется применительно к выходным данным службы. Здесь предполагается, что выходные данные службы содержат набор повторяющихся элементов, как при использовании ATOM, где есть набор повторяющихся входных узлов. Каждый из повторяющихся узлов содержит одну запись. XPath задается для указания отдельного повторяющегося узла в результате службы поставщика содержимого, содержащего значения для отдельной записи. Пример выходных данных из службы:

        `<foo>
          <bar> … content … </bar>
          <bar> … content … </bar>
          <bar> … content … </bar>
        </foo>`

В этом случае выражение XPath выглядело бы, как /foo/bar, так как каждый узел bar является повторяющимся узлом в выходных данных, содержащим фактические данные, возвращаемые пользователю.

**Key** — Marketplace пропускает этот атрибут. Веб-службы на основе REST обычно не предоставляют первичный ключ.

## <a name="property-node"></a>Узел Property
Этот узел содержит одно свойство записи.

Сведения об этом узле см. по адресу [http://msdn.microsoft.com/library/bb399546.aspx.](http://msdn.microsoft.com/library/bb399546.aspx) (Используйте раскрывающийся список **Другие версии**, чтобы просмотреть документацию по другой версии.) *Пример:* `<EntityType Name="MetaDataEntityType" d:Map="/MyXMLPath">
        <Property Name="Name"     Type="String" Nullable="true" d:Map="./Service/Name" d:IsPrimaryKey="true" DefaultValue=”Joe Doh” MaxLength="25" FixedLength="true" />
        ...
        </EntityType>`

| AttributeName | обязательные | Значение |
| --- | --- | --- |
| Имя |Да |Имя свойства. |
| Тип |Да |Тип значения свойства. Тип значения свойства должен представлять собой **EDMSimpleType** или сложный тип (указано в полном имени) в рамках модели. Дополнительные сведения см. в разделе «Типы концептуальной модели». |
| Nullable |Нет |**True** (значение по умолчанию) или **False** в зависимости от того, может ли свойство иметь значение null. Примечание. В версии языка CSDL, указанной в пространстве имен [http://schemas.microsoft.com/ado/2006/04/edm](http://schemas.microsoft.com/ado/2006/04/edm), для свойства сложного типа должно быть задано значение Nullable="False". |
| DefaultValue |Нет |Значение свойства по умолчанию. |
| MaxLength |Нет |Максимальная длина значения свойства. |
| FixedLength |Нет |**True** или **False** в зависимости от того, будет ли значение свойства храниться в виде строки с фиксированной длиной. |
| Precision |Нет |Обозначает максимальное количество цифр, сохраняемых в числовом значении. |
| Масштаб |Нет |Максимальное количество десятичных разрядов, сохраняемых в числовом значении. |
| Unicode |Нет |**True** или **False** в зависимости от того, будет ли значение свойства храниться в виде строки Юникода. |
| Collation |Нет |Строка, указывающая порядок сортировки, используемый в источнике данных. |
| ConcurrencyMode |Нет |**None** (значение по умолчанию) или **Fixed**. Если задано значение **Fixed**, значение свойства будет использоваться при выполнении проверок оптимистичного параллелизма. |

Ниже перечислены дополнительные атрибуты, которые были добавлены в спецификации языка CSDL.

**d:Map** — выражение XPath, которое выполняется применительно к выходным данным службы и извлекает одно свойство выходных данных. Указанное выражение XPath соотносится с повторяющимся узлом, который был выбран в XPath узла EntityType. Можно также указать абсолютное выражение XPath, чтобы разрешить включение статических ресурсов в каждый из выходных узлов, например, заявление об авторских правах, которое содержится только в одном месте выходных данных исходной службы, но которое должно присутствовать в каждой строке выходных данных OData. Пример из службы:

        `<foo>
          <bar>
           <baz0>… value …</baz0>
           <baz1>… value …</baz1>
           <baz2>… value …</baz2>
          </bar>
        </foo>`

Здесь выражение XPath будет выглядеть, как ./bar/baz0 для получения узла baz0 от службы поставщика содержимого.

**d:CharMaxLength** — можно задать максимальную длину для типа строки. См. пример DataService CSDL.

**d:IsPrimaryKey** — указывает, является ли столбец первичным ключом в таблице или представлении. См. пример DataService CSDL.

**d:isExposed** — определяет, предоставляется ли схема таблицы (обычно задается значение True). См. пример DataService CSDL.

**d:IsView** *(необязательно)* — задается значение True, если основывается на представлении, а не на таблице.  См. пример DataService CSDL.

**d:Tableschema** — см. пример DataService CSDL.

**d:ColumnName** — имя столбца в таблице или представлении.  См. пример DataService CSDL.

**d:IsReturned** — логическое значение, определяющее, предоставляет ли служба это значение клиенту.  См. пример DataService CSDL.

**d:IsQueryable** — логическое значение, определяющее, можно ли использовать столбец в запросе к базе данных.   См. пример DataService CSDL.

**d:OrdinalPosition** — числовое значение положения столбца, x, в таблице или представлении, где x может иметь значение от 1 до числа столбцов в таблице.  См. пример DataService CSDL.

**d:DatabaseDataType** — тип данных столбца в базе данных, то есть тип данных SQL. См. пример DataService CSDL.

## <a name="supported-parametersproperty-types"></a>Поддерживаемые типы параметров и свойств
Ниже приведены поддерживаемые типы параметров и свойств. (Учитывается регистр.)

| Примитивные типы | Описание |
| --- | --- |
| Null |Отсутствие значения |
| Логический |Представляет математическое понятие двоичной логики |
| Byte |8-разрядное целое значение без знака |
| DateTime |Представляет дату и время с диапазоном значений от 12:00:00 полночь 1 января 1753 г. н. э. до 11:59:59 пополудни, декабрь 9999 г. н. э. |
| Decimal |Представляет числовые значения с фиксированной точностью и масштабом. Этот тип может описывать числовые значения в диапазоне от отрицательного значения 10^255 + 1 до положительного 10^255 -1 |
| Double |Представляет число с плавающей запятой с точностью в 15 цифр, которое может представлять значения в диапазоне примерно от ±2.23e –308 до ±1.79e +308. **Из-за проблемы с экспортом в Excel необходимо использовать десятичные числа.** |
| Single |Представляет число с плавающей запятой с точностью в 7 цифр, которое может представлять значения в диапазоне примерно от ± 1.18e -38 до ± 3.40e +38 |
| Guid |Представляет 16-байтовое (128-разрядное) значение уникального идентификатора |
| Int16 |Представляет 16-разрядное целое значение со знаком |
| Int32 |Представляет 32-разрядное целое значение со знаком |
| Int64 |Представляет 64-разрядное целое значение со знаком |
| Строка |Представляет символьные данные фиксированной или переменной длины |

## <a name="see-also"></a>См. также
* Если вы хотите понять процесс и смысл сопоставления OData, см. статью [Сопоставление существующей веб-службы и OData с помощью CSDL](marketplace-publishing-data-service-creation-odata-mapping.md), где приводятся определения, структуры и инструкции.
* Если вы хотите поработать с примерами, см. статью [Примеры сопоставления существующей веб-службы OData через CSDL](marketplace-publishing-data-service-creation-odata-mapping-examples.md), где приводятся примеры кода вместе с объяснением синтаксиса и контекста.
* Чтобы вернуться к указанному пути для публикации службы данных в Azure Marketplace, см. [руководство по публикации службы данных](marketplace-publishing-data-service-creation.md).
