---
title: "aaaCreating образ виртуальной машины для hello Azure Marketplace | Документы Microsoft"
description: "Подробные инструкции о том, как toocreate виртуальной машины из образа для hello Azure Marketplace для других toopurchase."
services: Azure Marketplace
documentationcenter: 
author: HannibalSII
manager: hascipio
editor: 
ms.assetid: 5c937b8e-e28d-4007-9fef-624046bca2ae
ms.service: marketplace
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: Azure
ms.workload: na
ms.date: 01/05/2017
ms.author: hascipio; v-divte
ms.openlocfilehash: 65e1c0530bb050fb379a52544e36c55faacd84df
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="guide-toocreate-a-virtual-machine-image-for-hello-azure-marketplace"></a>Руководство по toocreate образ виртуальной машины для hello Azure Marketplace
В этой статье **шаг 2**, руководство по подготовке hello виртуальные жесткие диски (VHD), развертывается toohello Azure Marketplace. Виртуальные жесткие диски являются основой hello ваш SKU. Hello процесса зависит от того, предоставляется под управлением Linux или на основе Windows SKU. В этой статье рассматриваются оба сценария. Описываемую процедуру можно выполнять параллельно с [созданием учетной записи разработчика Майкрософт][link-acct-creation].

## <a name="1-define-offers-and-skus"></a>1. Определение предложений и номеров SKU
В этом разделе вы узнаете, как toodefine hello предложений и их связанные номера SKU.

Предложение имеет «родительский» tooall его номеров SKU. Вы можете создать несколько предложений. Как решить toostructure вашей работает tooyou. При передаче toostaging предложение, оно помещается вместе со всеми ее номера SKU. Внимательно рассмотрите вашей идентификаторы SKU, так как они будут отображаться в URL-АДРЕСЕ hello:

* Azure.com: http://azure.microsoft.com/marketplace/partners/{пространство_имен_партнера}/{идентификатор_заказа}-{идентификатор_SKU};
* портал предварительной версии Azure: https://portal.azure.com/#gallery/{пространство_имен_издателя}.{идентификатор_заказа}{идентификатор_SKU}.  

SKU — hello коммерческих имя образа виртуальной Машины. Образ VM содержит один диск операционной системы и от нуля до нескольких дисков данных. Это по сути профиль hello завершения хранилища для виртуальной машины. Для одного диска требуется один VHD. Диски с данными даже пустые требуют toobe виртуальный жесткий ДИСК создан.

Независимо от того, какая операционная система используется добавьте только hello минимальное число дисков данных, необходимые для hello SKU. Не удается удалить диски, которые являются частью изображения во время развертывания hello клиенты, но всегда можно добавить диски во время или после развертывания, если они необходимы.

> [!IMPORTANT]
> **Не изменяйте число дисков в новой версии образа.** Если необходимо перенастроить диски с данными в образе hello, определите новая Конфигурация. Публикации новой версии изображения с учетом количества другой диск будет иметь hello вероятность нарушения новое развертывание на основе версии нового образа hello в случаях развертываний автоматического масштабирования, автоматический решений через шаблоны ARM и других сценариев.
>
>

### <a name="11-add-an-offer"></a>1.1. Добавление предложения
1. Войдите в toohello [портал публикации] [ link-pubportal] с помощью учетной записи продавца.
2. Выберите hello **виртуальные машины** вкладке hello портал публикации. В поле запроса ввода hello введите имя предложения. имя предложения Hello обычно — имя hello hello продукта или услуги, планировании toosell в hello Azure Marketplace.
3. Нажмите кнопку **Создать**.

### <a name="12-define-a-sku"></a>1.2. Определение номера SKU
После добавления предложения требуется toodefine и идентификации вашей конфигурации. У вас может быть несколько предложений, и каждое из них может содержать несколько номеров SKU. При передаче toostaging предложение, оно помещается вместе со всеми ее номера SKU.

1. **Добавьте номер SKU.** Hello SKU требует идентификатора, который используется в URL-адрес hello. Hello идентификатор должен быть уникальным в пределах ваш профиль публикации, но нет риска возникновения конфликта идентификатор с другими издателями.

   > [!NOTE]
   > предложение Hello и идентификаторы SKU, отображаются в hello предложение URL-адрес hello Marketplace.
   >
   >
2. **Добавьте сводное описание для номера SKU.** Сводных описаний являются видимыми toocustomers, поэтому необходимо сделать их легко читаемыми. Эти сведения не обязательно toobe заблокирована до фазы «Принудительной tooStaging» hello. До тех пор являются свободного tooedit его.
3. При использовании ОС Windows SKU выполните предлагаемые связи hello tooacquire hello утверждения версий Windows Server.

## <a name="2-create-an-azure-compatible-vhd-linux-based"></a>2. Создание виртуального жесткого диска, совместимого с Azure (для Linux)
Этот раздел содержит рекомендации по созданию образа виртуальной Машины на основе Linux для hello Azure Marketplace. Пошаговое руководство см. в разделе toohello Следующая документация: [Создание и загрузка виртуального жесткого диска, который содержит hello операционной системы Linux](../virtual-machines/linux/classic/create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2fclassic%2ftoc.json)

## <a name="3-create-an-azure-compatible-vhd-windows-based"></a>3. Создание виртуального жесткого диска, совместимого с Azure (на основе Windows)
Этот раздел посвящен toocreate действия hello SKU, на основе Windows Server для hello Azure Marketplace.

### <a name="31-ensure-that-you-are-using-hello-correct-base-vhds"></a>3.1 Убедитесь, что вы используете hello исправьте базовые виртуальные жесткие диски
Hello операционной системы для образа виртуальной Машины должен быть основан на утвержденные Azure базового образа, содержащего Windows Server или SQL Server.

toobegin, создайте виртуальную Машину из одного hello после изображения, находящийся в hello [портал Microsoft Azure][link-azure-portal]:

* Windows Server ([2012 R2 Datacenter][link-datactr-2012-r2], [2012 Datacenter][link-datactr-2012], [2008 R2 SP1][link-datactr-2008-r2]);
* SQL Server 2014 ([Enterprise][link-sql-2014-ent], [Standard][link-sql-2014-std], [Web][link-sql-2014-web]);
* SQL Server 2012 SP2 ([Enterprise][link-sql-2012-ent], [Standard][link-sql-2012-std], [Web][link-sql-2012-web]).

Эти ссылки можно также найти в hello портал публикации под страницей SKU hello.

> [!TIP]
> Если вы используете hello текущей версией портала Azure или PowerShell, утверждаются образов Windows Server, опубликованные на 8 сентября 2014 г. и более поздней версии.
>
>

### <a name="32-create-your-windows-based-vm"></a>3.2. Создайте виртуальную машину Windows
С портала Microsoft Azure hello можно создать ВМ на основе утвержденных базового образа всего несколько простых шагов. Hello ниже приведен обзор процесса hello.

1. На странице приветствия базового образа, выбрать **создания виртуальной машины** toobe направленный toohello новый [портал Microsoft Azure][link-azure-portal].

    ![рисунок][img-acom-1]
2. Войдите в портал toohello с hello учетную запись Майкрософт и пароль для подписки Azure, требуется toouse hello.
3. Выполните запросы hello toocreate виртуальной Машины с помощью hello базового образа, которые вы выбрали. Требуется tooprovide имя узла (имя компьютера hello), (зарегистрированный с правами администратора) имя пользователя и пароль для hello виртуальной Машины.

    ![рисунок][img-portal-vm-create]
4. Выберите размер виртуальной Машины toodeploy hello hello:

    а.    Если планируется toodevelop hello виртуальный жесткий ДИСК в локальной среде, размер hello не имеет значения. Можно воспользоваться одним из hello меньшего размера виртуальных машин.

    b.    Если планируется toodevelop hello образ в Azure, можно с помощью одного из hello рекомендуемые размеры виртуальных Машин для выбранного образа hello.

    c.    Сведения о ценах, см. в разделе toohello **рекомендуется ценовым категориям** селектор отображается на портале hello. Он предоставляет hello три рекомендуемые размеры, предоставленную издателем hello. (В этом случае издатель hello — Microsoft.)

    ![рисунок][img-portal-vm-size]
5. Задайте свойства.

    а.    Для быстрого развертывания можно оставить значения по умолчанию для свойств hello в hello **необязательная конфигурация** и **группы ресурсов**.

    b.    В разделе **учетной записи хранилища**, при необходимости можно выбрать учетную запись хранения hello, в какие hello, операционная система будет храниться виртуального жесткого диска.

    c.    В разделе **группы ресурсов**, при необходимости можно выбрать hello логическую группу, в которой tooplace hello виртуальной Машины.
6. Выберите hello **расположение** для развертывания:

    а.    Если планируется toodevelop hello виртуальный жесткий ДИСК в локальной среде, расположение hello не имеет значения tooAzure hello образ будет отправлен позже.

    b.    Если планируется toodevelop hello образ в Azure, можно воспользоваться одним из регионов США под управлением Microsoft Azure hello с начала hello. Это ускоряет hello VHD процесса копирования, выполняющий Microsoft от вашего имени, при отправке изображения для сертификации.

    ![рисунок][img-portal-vm-location]
7. Щелкните **Создать**. Hello виртуальных Машин запускает toodeploy. В течение минут будет иметь успешного развертывания и можно начать toocreate hello изображения для вашей конфигурации.

### <a name="33-develop-your-vhd-in-hello-cloud"></a>3.3 разработки вашего виртуального жесткого диска в облаке hello
Настоятельно рекомендуется разрабатывать вашего виртуального жесткого диска в облаке hello, с помощью удаленного рабочего стола (RDP). TooRDP подключиться с hello имя пользователя и пароль, указанные во время инициализации.

> [!IMPORTANT]
> В случае локальной разработки виртуального жесткого диска (мы не рекомендуем) см. статью [Локальная разработка образа виртуальной машины для Azure Marketplace](marketplace-publishing-vm-image-creation-on-premise.md). Загрузка вашего виртуального жесткого диска не является обязательным, если вы разрабатываете в облаке hello.
>
>

**Подключаться с помощью протокола удаленного рабочего СТОЛА с помощью hello [портал Microsoft Azure][link-azure-portal]**

1. Выберите **Обзор** > **Виртуальные машины**.
2. Открывает колонку Hello виртуальных машин. Убедитесь, что hello виртуальная машина, которую вы хотите tooconnect с работает и выберите его из списка hello развернутых виртуальных машин.
3. Открывается колонка, которое описывает hello выбранной виртуальной Машины. В верхней части экрана приветствия нажмите кнопку **Connect**.
4. Вы являетесь запрашиваемые tooenter hello пользователя имя и пароль, указанный во время инициализации.

**Подключение по протоколу RDP с помощью PowerShell**

toodownload tooa локальном компьютере файл удаленного рабочего стола, используйте hello [командлет Get-AzureRemoteDesktopFile][link-technet-2]. В заказ toouse этот командлет, требуются имя hello tooknow hello службы и имя виртуальной Машины hello. При создании виртуальной Машины hello с hello [портал Microsoft Azure][link-azure-portal], можно найти эту информацию в свойствах виртуальной Машины:

1. На портале Microsoft Azure hello, выберите **Обзор** > **виртуальные машины**.
2. Открывает колонку Hello виртуальных машин. Выберите виртуальную Машину, которая была развернута hello.
3. Открывается колонка, которое описывает hello выбранной виртуальной Машины.
4. Щелкните **Свойства**.
5. Первая часть Hello hello доменное имя — имя службы hello. Имя узла Hello — имя виртуальной Машины hello.

    ![рисунок][img-portal-vm-rdp]
6. Hello командлет toodownload hello RDP-файл для hello создана виртуальная машина toohello администратора локальный рабочий стол выглядит следующим образом.

        Get‐AzureRemoteDesktopFile ‐ServiceName “baseimagevm‐6820cq00” ‐Name “BaseImageVM” –LocalPath “C:\Users\Administrator\Desktop\BaseImageVM.rdp”

Дополнительные сведения о RDP можно найти в библиотеке MSDN в статье hello [подключения tooan ВМ Azure с помощью протокола удаленного рабочего СТОЛА или SSH](http://msdn.microsoft.com/library/azure/dn535788.aspx).

**Настройка виртуальной машины и создание номера SKU**

После hello ОС загруженном виртуального жесткого диска Hyper-v и настройки toobegin виртуальной Машины, создание ваш SKU. Подробные инструкции можно найти в hello TechNet по ссылке: [установить Hyper-v и настройка виртуальной Машины](http://technet.microsoft.com/library/hh846766.aspx).

### <a name="34-choose-hello-correct-vhd-size"></a>3.4 выберите hello правильный размер виртуального жесткого диска
Hello операционной системы Windows виртуального жесткого диска в образ виртуальной Машины должна быть создана как виртуальный жесткий ДИСК фиксированного формата 128 ГБ.  

Если hello физический размер не превышает 128 ГБ, hello виртуального жесткого диска должен быть разреженным. Hello базовый Windows и SQL Server образов, предоставляемых уже удовлетворяют этим требованиям, поэтому не hello формат или hello размер hello получить виртуальный жесткий ДИСК.  

Размер дисков данных может достигать 1 ТБ. При принятии решения о hello места на диске, помните, что клиентам не удается изменить размер виртуальных жестких дисков в изображении во время развертывания hello. Виртуальные жесткие диски для дисков данных должны создаваться в фиксированном формате. Тем не менее их также следует разбивать на части. Диски данных могут быть пустыми или содержать данные.

### <a name="35-install-hello-latest-windows-patches"></a>3.5 установите последние обновления Windows hello
Hello базовые образы содержат последние исправления hello вверх tootheir Дата публикации. Перед публикацией hello операционной системы создания виртуального жесткого диска, убедитесь, выполнение центра обновления Windows и все hello последние критических и важных обновлениях безопасности были установлены.

### <a name="36-perform-additional-configuration-and-schedule-tasks-as-necessary"></a>3.6. Выполнение дополнительной настройки и задание расписания для выполнения задач по мере необходимости
Если требуется дополнительная настройка, рассмотрите возможность использования запланированную задачу, которая выполняется в toomake запуска любого окончательных изменений toohello виртуальной Машины, после его развертывания:

* Это наиболее задачу hello toohave рекомендуется удалить сам после успешного выполнения.
* Конфигурация не следует полагаться на дисках, отличных от дисков C и D, так как эти hello только двух дисков, которые гарантированно tooexist. Диск C — hello диска операционной системы, а диск D — hello временный локальный диск.

### <a name="37-generalize-hello-image"></a>3.7 обобщить образ hello
Все образы в Azure Marketplace hello необходимо для повторного использования в универсальный код. Другими словами обобщенный hello операционной системы:

* Для Windows hello изображения должно быть «командой Sysprep» и конфигурации не должно выполняться, не поддерживающие hello **sysprep** команды.
* Можно выполнить следующую команду из hello каталог % windir%\System32\Sysprep hello.

        sysprep.exe /generalize /oobe /shutdown

  Рекомендации по как предоставляется toosysprep hello операционной системы на шаге hello см: [Создание и отправка Windows Server VHD tooAzure](../virtual-machines/windows/classic/createupload-vhd.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).

## <a name="4-deploy-a-vm-from-your-vhds"></a>4. Развертывание виртуальной машины из дисков VHD
После загрузки виртуальные жесткие диски (VHD hello обобщенный операционной системы и данных ноль или более виртуальных жестких дисков на диске) tooan учетной записи хранилища Azure, можно зарегистрировать их как образ виртуальной Машины пользователя. Затем можно приступать к тестированию образа. Обратите внимание, что поскольку обобщенный виртуальный жесткий ДИСК операционной системы нельзя развернуть напрямую hello виртуальной Машины, предоставляя hello URL-адрес VHD.

Дополнительные сведения о образов виртуальных Машин toolearn hello просмотрите следующие записи в блогах:

* [Образ виртуальной машины](https://azure.microsoft.com/blog/vm-image-blog-post/)
* [Способы использования PowerShell при работе с образами виртуальных машин](https://azure.microsoft.com/blog/vm-image-powershell-how-to-blog-post/)
* [Образы виртуальных машин в Azure](https://msdn.microsoft.com/library/azure/dn790290.aspx)

### <a name="set-up-hello-necessary-tools-powershell-and-azure-cli"></a>Настроить необходимые средства hello Azure CLI и PowerShell
* [Как toosetup PowerShell](/powershell/azure/overview)
* [Как toosetup Azure CLI](../cli-install-nodejs.md)

### <a name="41-create-a-user-vm-image"></a>4.1. Создание пользовательского образа виртуальной машины
#### <a name="capture-vm"></a>Запись виртуальной машины
Прочитайте приведенные ниже рекомендации о захвате hello виртуальную Машину с помощью API, PowerShell или Azure CLI ссылки hello.

* [API](https://msdn.microsoft.com/library/mt163560.aspx)
* [PowerShell](../virtual-machines/windows/capture-image.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)
* [интерфейс командной строки Azure](../virtual-machines/linux/capture-image.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

### <a name="generalize-image"></a>Подготовка образа
Прочитайте приведенные ниже рекомендации о захвате hello виртуальную Машину с помощью API, PowerShell или Azure CLI ссылки hello.

* [API](https://msdn.microsoft.com/library/mt269439.aspx)
* [PowerShell](../virtual-machines/windows/capture-image.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)
* [интерфейс командной строки Azure](../virtual-machines/linux/capture-image.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

### <a name="42-deploy-a-vm-from-a-user-vm-image"></a>4.2 Развертывание виртуальной машины из пользовательского образа VM
toodeploy виртуальной Машины из образа виртуальной Машины пользователя может использовать текущий hello [портал Azure](https://manage.windowsazure.com) или PowerShell.

**Развертывание виртуальной Машины из hello текущей версией портала Azure**

1. Go слишком**New** > **вычислений** > **виртуальной машины** > **из коллекции**.

    ![рисунок][img-manage-vm-new]
2. Go слишком**Мои образы**, а затем выберите hello образа виртуальной Машины, из которых toodeploy виртуальной Машины:

   1. Оплата особое внимание toowhich изображение, выбрать, так как hello **Мои образы** представлении перечислены образов операционных систем и образы виртуальных Машин.
   2. Просмотрев hello число дисков может помочь определить тип образа выполняется развертывание, так как большинство hello образов виртуальных Машин имеют более одного диска. Однако это все еще возможно toohave образа виртуальной Машины с только одной операционной системы диска, при котором будет иметь **число дисков** задать too1.

      ![рисунок][img-manage-vm-select]
3. Выполните мастер создания виртуальной Машины hello и укажите имя виртуальной Машины hello, размер виртуальной Машины, расположение, имя пользователя и пароль.

**Развертывание виртуальной машины из PowerShell**

toodeploy большая ВМ из hello обобщенный образ виртуальной Машины только что создан, можно использовать следующие командлеты hello.

    $img = Get-AzureVMImage -ImageName "myVMImage"
    $user = "user123"
    $pass = "adminPassword123"
    $myVM = New-AzureVMConfig -Name "VMImageVM" -InstanceSize "Large" -ImageName $img.ImageName | Add-AzureProvisioningConfig -Windows -AdminUsername $user -Password $pass
    New-AzureVM -ServiceName "VMImageCloudService" -VMs $myVM -Location "West US" -WaitForBoot

> [!IMPORTANT]
> Дополнительные сведения см. в статье [Как устранить распространенные неполадки, возникающие в процессе создания виртуального жесткого диска].
>
>

## <a name="5-obtain-certification-for-your-vm-image"></a>5. Получение сертификата для образа виртуальной машины
Следующий этап подготовки образа виртуальной Машины для hello Azure Marketplace Hello — toohave, оно Сертифицировано.

Этот процесс включает в себя запуск средства специальные сертификации, отправка toohello результаты проверки hello Azure контейнера, где размещаются виртуальные жесткие диски, добавив предложение, определение ваш SKU и отправка ВМ изображений для сертификации.

### <a name="51-download-and-run-hello-certification-test-tool-for-azure-certified"></a>5.1 Загрузите и запустите средство тестирования сертификации hello для Azure Certified
Средство сертификации Hello выполняется на работающей виртуальной Машины, подготовленного образа виртуальной Машины пользователя, tooensure, hello образа виртуальной Машины не совместима с Microsoft Azure. Проверит, что выполнены рекомендации hello и требования о подготовке вашего виртуального жесткого диска. Hello средства hello выводится отчет о совместимости, которого должна быть загружена на hello портал публикации во время запроса сертификации.

можно использовать средство сертификации Hello с Windows и виртуальных машин Linux. Он подключается виртуальных машин на основе tooWindows через PowerShell, а tooLinux виртуальных машин с помощью SSH.Net:

1. Сначала загрузите средство сертификации hello в hello [узла центра загрузки Майкрософт][link-msft-download].
2. Откройте средство сертификации hello и нажмите кнопку hello **запустить новый тест** кнопки.
3. Из hello **тестирования сведения** экране, введите имя для hello тестового запуска.
4. Выберите операционную систему для вашей виртуальной машины — Linux или Windows. В зависимости от выбранного выберите доступные параметры настройки hello.

### <a name="connect-hello-certification-tool-tooa-linux-vm-image"></a>**Подключение tooa средство сертификации hello образ операционной системы Linux**
1. Режим проверки подлинности SSH выберите hello: файл пароля или ключа.
2. При использовании проверки подлинности на основе пароля, введите имя hello доменных имен (DNS), имя пользователя и пароль.
3. При использовании файла ключа проверки подлинности, введите hello DNS-имя, имя пользователя и расположение закрытого ключа.

   ![Проверка пароля для образа виртуальной машины Linux][img-cert-vm-pswd-lnx]

   ![Проверка подлинности файла ключа для образа виртуальной машины Linux][img-cert-vm-key-lnx]

### <a name="connect-hello-certification-tool-tooa-windows-based-vm-image"></a>**Подключение сертификации средство hello tooa-образ виртуальной Машины на основе Windows**
1. Введите DNS виртуальной Машины hello полное доменное имя (например, MyVMName.Cloudapp.net).
2. Введите имя пользователя hello и пароль.

   ![Проверка пароля для образа виртуальной машины Windows][img-cert-vm-pswd-win]

После того как выбрана hello правильные параметры для образа виртуальной Машины на основе Windows или Linux, выберите **проверить подключение** tooensure, SSH.Net или PowerShell имеет допустимое соединение в целях тестирования. После установки подключения, выберите **Далее** toostart hello теста.

После завершения теста hello результаты hello (Pass/Fail/предупреждение) для каждого элемента теста будут получены.

![Тестовые случаи для образа виртуальной машины Linux][img-cert-vm-test-lnx]

![Тестовые случаи для образа виртуальной машины Windows][img-cert-vm-test-win]

В случае сбоя любой тестов hello образ не пройти сертификацию. В этом случае ознакомьтесь с требованиями hello и внесите необходимые изменения.

После hello автоматических тестов, на образ виртуальной Машины через экран анкеты предлагается tooprovide дополнительных входных данных.  Вопросы hello, а затем выберите **Далее**.

![Анкета средства сертификации][img-cert-vm-questionnaire]

![Анкета средства сертификации][img-cert-vm-questionnaire-2]

После завершения hello анкеты, можно предоставить дополнительные сведения, такие как сведения о SSH доступа для hello образ операционной системы Linux, а также дается описание любой сбой оценки. Можно загрузить результаты теста hello и файлы журнала для hello выполнения тестовых случаев в ответы toohello сложения tooyour анкеты. Сохранить результаты hello в hello же контейнере, что виртуальные жесткие диски.

![Сохранение результатов теста для сертификации][img-cert-vm-results]

### <a name="52-get-hello-shared-access-signature-uri-for-your-vm-images"></a>5.2 Получите URI подписи коллективного доступа hello для образов виртуальных Машин
Во время процесса публикации hello укажите hello универсальных кодов ресурсов (URI), ведущих tooeach из hello виртуальных жестких дисков, созданных для вашей конфигурации. Корпорации Майкрософт потребуются доступа toothese виртуальных жестких дисков во время процесса сертификации hello. Поэтому необходимо toocreate URI подписи коллективного доступа для каждого виртуального жесткого диска. Это URI, который следует вводить в hello **изображения** на вкладке hello портал публикации.

подпись общего доступа Hello создан URI должны соблюдаться следующие требования к toohello:

* Для создания URI подписанного URL-адреса для виртуальных жестких дисков достаточно разрешений на создание списков и на чтение. Не предоставляйте разрешения на запись или удаление.
* Длительность Hello для доступа должна быть не менее трех (3) недель от, при создании URI подписи коллективного доступа hello.
* toosafeguard для hello выберите день, предшествующий hello текущей даты времени в формате UTC. Например если hello текущая дата равна 6 октября 2014 г., выберите 10/5/2014.

URL-адрес SAS может быть создан в несколько способов tooshare вашего виртуального жесткого диска для Azure Marketplace.
Следующие являются hello 3 Рекомендованные средства:

1.  обозреватель хранилищ Azure
2.  Обозреватель хранилищ Microsoft Azure
3.  Инфраструктура CLI Azure

**Обозреватель хранилищ Azure (рекомендуется для пользователей Windows)**

Ниже приведены шаги hello для формирования URL-адрес SAS с помощью обозревателя хранилищ Azure

1. Скачайте [обозреватель хранилищ Azure версии 6 (предварительная версия 3)](https://azurestorageexplorer.codeplex.com/) на сайте CodePlex. Go слишком[предварительной версии 6 обозреватель хранилища Azure](https://azurestorageexplorer.codeplex.com/) и нажмите кнопку **«Загрузки»**.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_01.png)

2. Скачайте и распакуйте файл [AzureStorageExplorer6Preview3.zip](https://azurestorageexplorer.codeplex.com/downloads/get/891668), а затем установите его.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_02.png)

3. После установки, откройте приложение hello.
4. Щелкните **Добавить учетную запись**.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_03.png)

5. Укажите имя учетной записи хранения hello, ключ учетной записи хранилища и домен конечные точки хранилища. Это hello учетной записи хранилища в подписке Azure, где была сохранена вашего виртуального жесткого диска на портале Azure.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_04.png)

6. После подключения обозревателя хранилищ Azure tooyour конкретной учетной записи хранения, он будет запущен отображение всех hello содержит внутри hello учетной записи хранилища. Выберите контейнер hello, куда был скопирован hello операционной системы диска VHD-файл (также диски с данными, если они применимы для вашего сценария).

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_05.png)

7. После выбора hello контейнер больших двоичных объектов, обозреватель хранилищ Azure начинается отображение файлов hello в контейнере hello. Выберите файл образа hello (.vhd), который должен toobe отправлен.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_06.png)

8.  После выбора hello VHD-файл в контейнере hello щелкните hello **безопасности** вкладки.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_07.png)

9.  В hello **безопасности контейнер больших двоичных объектов** диалоговое окно, оставьте hello параметрами по умолчанию hello **уровень доступа** , а затем щелкните **подписей общего доступа** вкладки.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_08.png)

10. Выполните действия hello ниже toogenerate URI подписи коллективного доступа для hello VHD-образ.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_09.png)

    а. **Доступ разрешен из:** toosafeguard для hello выберите день, предшествующий hello текущей даты времени в формате UTC. Например если hello текущая дата равна 6 октября 2014 г., выберите 10/5/2014.

    b. **Доступ разрешен для:** выберите дату, которая имеет по крайней мере 3 недель после hello **доступ разрешен из** даты.

    c. **Разрешены действия:** выберите hello **списка** и **чтения** разрешения.

    d. Если вы выбрали файл .vhd правильно, то файл отображается в **больших двоичных объектов tooaccess имя** с расширением .vhd.

    д. Щелкните **Создать подпись**.

    f. В **создается общий доступ подписи URI этого контейнера**, проверьте следующие как видно выше hello:

       - Убедитесь, что имя файла изображения и **«.vhd»** в hello URI.
       - Убедитесь, что в конце hello hello подписи **«= rl»** отображается. Это показывает, что права на чтение и создание списков успешно предоставлены.
       - Убедитесь, что в середине hello подписи **«sr = c»** отображается. Это означает, что у вас есть доступ на уровне контейнера.

11. tooensure, hello созданный общих работы URI подписи доступа, нажмите кнопку **тест в обозревателе**. Он должен запустить процесс загрузки hello.

12. Скопируйте URI подписи коллективного доступа hello. Это toopaste URI hello в hello портал публикации.

13. Повторите шаги 6-10 для каждого виртуального жесткого диска в hello SKU.

**Обозреватель хранилищ Microsoft Azure (Windows/MAC/Linux)**

Ниже приведены шаги hello для формирования URL-адрес SAS с помощью обозревателя хранилищ Microsoft Azure

1.  Скачайте обозреватель хранилищ Microsoft Azure Storage Explorer на сайте [http://storageexplorer.com/](http://storageexplorer.com/). Go слишком[Microsoft Azure Storage Explorer](http://storageexplorer.com/releasenotes.html) и нажмите кнопку **«Загрузить для Windows»**.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_10.png)

2.  После установки, откройте приложение hello.

3.  Щелкните **Добавить учетную запись**.

4.  Настройка подписки Microsoft Azure Storage Explorer tooyour знак в учетной записи tooyour

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_11.png)

5.  Учетная запись toostorage перейдите и выберите hello контейнера

6.  Выберите **Get Shared Access Signature** (Получить подписанный URL-адрес), с помощью правой кнопкой мыши из hello **контейнера**

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_12.png)

7.  Обновите время начала, время окончания срока действия и разрешения, как показано ниже.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_13.png)

    а.  **Время начала:** toosafeguard для hello выберите день, предшествующий hello текущей даты времени в формате UTC. Например если hello текущая дата равна 6 октября 2014 г., выберите 10/5/2014.

    b.  **Время окончания:** выберите дату, которая имеет по крайней мере 3 недель после hello **время начала** даты.

    c.  **Разрешения:** выберите hello **списка** и **чтения** разрешения

8.  Скопируйте подписанный URL-адрес контейнера.

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_14.png)

    Созданный URL-адрес SAS для контейнера уровень и теперь нам требуется tooadd имени виртуального жесткого диска в нем.

    Формат URL-адреса SAS на уровне контейнера:`https://testrg009.blob.core.windows.net/vhds?st=2016-04-22T23%3A05%3A00Z&se=2016-04-30T23%3A05%3A00Z&sp=rl&sv=2015-04-05&sr=c&sig=J3twCQZv4L4EurvugRW2klE2l2EFB9XyM6K9FkuVB58%3D`

    Вставить имя виртуального жесткого диска после имени контейнера hello в URL-адрес SAS указанным ниже образом`https://testrg009.blob.core.windows.net/vhds/<VHD NAME>?st=2016-04-22T23%3A05%3A00Z&se=2016-04-30T23%3A05%3A00Z&sp=rl&sv=2015-04-05&sr=c&sig=J3twCQZv4L4EurvugRW2klE2l2EFB9XyM6K9FkuVB58%3D`

    Пример:

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_15.png)

    TestRGVM201631920152.vhd — hello имени виртуального жесткого диска будет URL-адрес SAS виртуального жесткого диска`https://testrg009.blob.core.windows.net/vhds/TestRGVM201631920152.vhd?st=2016-04-22T23%3A05%3A00Z&se=2016-04-30T23%3A05%3A00Z&sp=rl&sv=2015-04-05&sr=c&sig=J3twCQZv4L4EurvugRW2klE2l2EFB9XyM6K9FkuVB58%3D`

    - Убедитесь, что имя файла изображения и **«.vhd»** в hello URI.
    - Убедитесь, что в середине hello подписи **«sp = rl»** отображается. Это показывает, что права на чтение и создание списков успешно предоставлены.
    - Убедитесь, что в середине hello подписи **«sr = c»** отображается. Это означает, что у вас есть доступ на уровне контейнера.

9.  tooensure, hello works URI подписи общего доступа, созданный, проверить его в браузере. Он должен запустить процесс загрузки hello

10. Скопируйте URI подписи коллективного доступа hello. Это toopaste URI hello в hello портал публикации.

11. Повторите эти шаги для каждого виртуального жесткого диска в hello SKU.

**Azure CLI (рекомендуется для непрерывной интеграции и интеграции со сторонними решениями)**

Ниже приведены шаги hello для формирования URL-адрес SAS с помощью Azure CLI

1.  Скачайте Microsoft Azure CLI [отсюда](https://azure.microsoft.com/en-in/documentation/articles/xplat-cli-install/). Также можно использовать ссылки для **[Windows](http://aka.ms/webpi-azure-cli)** и **[MAC OS](http://aka.ms/mac-azure-cli)**.

2.  Установите скачанные файлы.

3.  Создайте файл PowerShell, используя следующий код, а затем сохраните его в локальной переменной.

          $conn="DefaultEndpointsProtocol=https;AccountName=<StorageAccountName>;AccountKey=<Storage Account Key>"
          azure storage container list vhds -c $conn
          azure storage container sas create vhds rl <Permission End Date> -c $conn --start <Permission Start Date>  

    Обновить hello следующие параметры в выше

    а. **`<StorageAccountName>`**: укажите имя учетной записи хранения.

    b. **`<Storage Account Key>`**: укажите ключ учетной записи хранения.

    c. **`<Permission Start Date>`**: toosafeguard для hello выберите день, предшествующий hello текущей даты времени в формате UTC. Например, если hello текущая дата — 26 октября 2016 г., то значение должно быть 10/25/2016

    d. **`<Permission End Date>`**: Выберите дату, которая имеет по крайней мере 3 недель после hello **Дата начала**. Значение должно быть **02.11.2016**.

    Ниже приведен пример кода hello после обновления с соответствующими параметрами

          $conn="DefaultEndpointsProtocol=https;AccountName=st20151;AccountKey=TIQE5QWMKHpT5q2VnF1bb+NUV7NVMY2xmzVx1rdgIVsw7h0pcI5nMM6+DVFO65i4bQevx21dmrflA91r0Vh2Yw=="
          azure storage container list vhds -c $conn
          azure storage container sas create vhds rl 11/02/2016 -c $conn --start 10/25/2016  

4.  Запустите редактор Powershell от имени администратора, а затем откройте файл из шага 3.

5.  Сценарий выполнения hello и обеспечит hello URL-адрес SAS для доступа на уровне контейнера

    Ниже будет выдано hello hello подписью SAS и скопируйте hello выделенной части блокнота

    ![рисунок](media/marketplace-publishing-vm-image-creation/img5.2_16.png)

6.  Теперь вы получите уровня контейнера URL-адрес SAS и потребуется tooadd имени виртуального жесткого диска в нем.

    URL-адрес SAS уровня контейнера

    `https://st20151.blob.core.windows.net/vhds?st=2016-10-25T07%3A00%3A00Z&se=2016-11-02T07%3A00%3A00Z&sp=rl&sv=2015-12-11&sr=c&sig=wnEw9RfVKeSmVgqDfsDvC9IHhis4x0fc9Hu%2FW4yvBxk%3D`

7.  Вставить имя виртуального жесткого диска после имени контейнера hello в URL-адрес SAS, как показано ниже`https://st20151.blob.core.windows.net/vhds/<VHDName>?st=2016-10-25T07%3A00%3A00Z&se=2016-11-02T07%3A00%3A00Z&sp=rl&sv=2015-12-11&sr=c&sig=wnEw9RfVKeSmVgqDfsDvC9IHhis4x0fc9Hu%2FW4yvBxk%3D`

    Пример:

    TestRGVM201631920152.vhd — hello имени виртуального жесткого диска будет URL-адрес SAS виртуального жесткого диска

    `https://st20151.blob.core.windows.net/vhds/ TestRGVM201631920152.vhd?st=2016-10-25T07%3A00%3A00Z&se=2016-11-02T07%3A00%3A00Z&sp=rl&sv=2015-12-11&sr=c&sig=wnEw9RfVKeSmVgqDfsDvC9IHhis4x0fc9Hu%2FW4yvBxk%3D`

    - Убедитесь, что имя файла изображения и «.vhd» заданы в hello URI.
    -   Убедитесь, что в середине hello подписи «sp = rl» отображается. Это показывает, что права на чтение и создание списков успешно предоставлены.
    -   Убедитесь, что в середине подписи hello, «sr = c» отображается. Это означает, что у вас есть доступ на уровне контейнера.

8.  tooensure, hello works URI подписи общего доступа, созданный, проверить его в браузере. Он должен запустить процесс загрузки hello

9.  Скопируйте URI подписи коллективного доступа hello. Это toopaste URI hello в hello портал публикации.

10. Повторите эти шаги для каждого виртуального жесткого диска в hello SKU.


### <a name="53-provide-information-about-hello-vm-image-and-request-certification-in-hello-publishing-portal"></a>5.3 содержат сведения о образа виртуальной Машины hello и запросить сертификат hello портал публикации
После создания предложение, SKU, следует ввести сведения об изображении hello, связанные с этой Конфигурацией:

1. Go toohello [портал публикации][link-pubportal], а затем войдите с учетной записи продавца.
2. Выберите hello **образов виртуальных Машин** вкладки.
3. Идентификатор Hello, перечисленные в начале hello страницы приветствия на самом деле идентификатор предложения hello и hello идентификатора SKU.
4. Заполнить hello свойства в разделе hello **SKU** раздела.
5. В разделе **семейство операционных систем**, выберите тип hello операционной системы, связанные с операционной системой hello виртуального жесткого диска.
6. В hello **операционной системы** опишите hello операционной системы. Рекомендуется использовать формат «Семейство ОС, тип, версия, обновления». Например, Windows Server Datacenter 2014 R2.
7. Выберите вверх toosix рекомендуемые размеры виртуальных машин. Это рекомендации, которые при их решить toopurchase и развертывание образа получить отображаемых toohello клиента в колонке уровень ценообразования hello в hello портала Azure. **Это только рекомендации. Клиент Hello — может tooselect любого размера виртуальной Машины, чтобы разместить hello дисков, указанный в образ.**
8. Введите версию hello. поля версии Hello инкапсулирует tooidentify hello семантическую версию продукта и обновления:
   * Версии должен иметь вид hello X.Y.Z, где X, Y и Z являются целыми числами.
   * Образы в разных номерах SKU могут иметь различные основные и дополнительные версии.
   * Версии в SKU должно быть только добавочные изменения, которые увеличить версию исправления hello (Z из X.Y.Z).
9. В hello **URL-адрес виртуального жесткого диска ОС** введите hello подписанного URL-адреса URI создан для операционной системы hello виртуального жесткого диска.
10. При наличии дисков данных, связанных с этим SKU, выберите hello логическую единицу номера (LUN) toowhich хотелось бы этот toobe диск данных, подключенных после развертывания.
11. В hello **URL-адрес VHD X LUN** введите hello подписанного URL-адреса для первого данных hello виртуальный жесткий ДИСК создается URI.

    ![рисунок](media/marketplace-publishing-vm-image-creation/vm-image-pubportal-skus-3.png)


## <a name="common-sas-url-issues--fixes"></a>Распространенные проблемы с URL-адресом SAS и способы их устранения

|Проблема|Сообщение об ошибке|Исправление|Ссылка на документацию|
|---|---|---|---|
|Сбой при копировании образов: символ "?" не найден в URL-адресе SAS.|Ошибка: копирование образов. Не удается toodownload больших двоичных объектов с помощью предоставленных универсальный код ресурса SAS.|Рекомендуется использовать URL-адрес SAS hello обновления средств|[https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/](https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/)|
|Сбой при копировании образов: параметры st и se отсутствуют в URL-адресе SAS.|Ошибка: копирование образов. Не удается toodownload больших двоичных объектов с помощью предоставленных универсальный код ресурса SAS.|Обновление hello URL-адрес SAS с датами начала и окончания для него|[https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/](https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/)|
|Сбой при копировании образов: параметр sp=rl отсутствует в URL-адресе SAS.|Ошибка: копирование образов. Не удается toodownload больших двоичных объектов с помощью предоставленных универсальный код ресурса SAS|Обновление hello URL-адрес SAS с разрешениями, установленными как «Чтение» и «список|[https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/](https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/)|
|Сбой при копировании образов: URL-адрес SAS в имени VHD-файла содержит пробелы.|Ошибка: копирование образов. Не удается toodownload больших двоичных объектов с помощью предоставленных универсальный код ресурса SAS.|Обновление hello URL-адрес SAS без пробелов|[https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/](https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/)|
|Сбой при копировании образов: ошибка авторизации URL-адреса SAS.|Ошибка: копирование образов. Не удается toodownload большой двоичный объект из-за ошибки tooauthorization|Повторное создание hello URL-адрес SAS|[https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/](https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-shared-access-signature-part-1/)|


## <a name="next-step"></a>Дальнейшие действия
После завершения подробности номера SKU hello, можно переместить вперед toohello [руководство по содержимому маркетинга Azure Marketplace][link-pushstaging]. В этот шаг hello процесс публикации, необходимо предоставить hello маркетинг содержимого, ценах и другие сведения о необходимости предварительного слишком**Step 3: тестирование ВМ предоставляют в промежуточной**, где протестировать различные сценарии использования перед развертыванием Hello предложение toohello Azure Marketplace для общей видимостью и покупки.  

## <a name="see-also"></a>См. также
* [Приступая к работе: как toopublish toohello предложение Azure Marketplace](marketplace-publishing-getting-started.md)

[img-acom-1]:media/marketplace-publishing-vm-image-creation/vm-image-acom-datacenter.png
[img-portal-vm-size]:media/marketplace-publishing-vm-image-creation/vm-image-portal-size.png
[img-portal-vm-create]:media/marketplace-publishing-vm-image-creation/vm-image-portal-create-vm.png
[img-portal-vm-location]:media/marketplace-publishing-vm-image-creation/vm-image-portal-location.png
[img-portal-vm-rdp]:media/marketplace-publishing-vm-image-creation/vm-image-portal-rdp.png
[img-azstg-add]:media/marketplace-publishing-vm-image-creation/vm-image-storage-add.png
[img-manage-vm-new]:media/marketplace-publishing-vm-image-creation/vm-image-manage-new.png
[img-manage-vm-select]:media/marketplace-publishing-vm-image-creation/vm-image-manage-select.png
[img-cert-vm-key-lnx]:media/marketplace-publishing-vm-image-creation/vm-image-certification-keyfile-linux.png
[img-cert-vm-pswd-lnx]:media/marketplace-publishing-vm-image-creation/vm-image-certification-password-linux.png
[img-cert-vm-pswd-win]:media/marketplace-publishing-vm-image-creation/vm-image-certification-password-win.png
[img-cert-vm-test-lnx]:media/marketplace-publishing-vm-image-creation/vm-image-certification-test-sample-linux.png
[img-cert-vm-test-win]:media/marketplace-publishing-vm-image-creation/vm-image-certification-test-sample-win.png
[img-cert-vm-results]:media/marketplace-publishing-vm-image-creation/vm-image-certification-results.png
[img-cert-vm-questionnaire]:media/marketplace-publishing-vm-image-creation/vm-image-certification-questionnaire.png
[img-cert-vm-questionnaire-2]:media/marketplace-publishing-vm-image-creation/vm-image-certification-questionnaire-2.png
[img-pubportal-vm-skus]:media/marketplace-publishing-vm-image-creation/vm-image-pubportal-skus.png
[img-pubportal-vm-skus-2]:media/marketplace-publishing-vm-image-creation/vm-image-pubportal-skus-2.png

[link-pushstaging]:marketplace-publishing-push-to-staging.md
[link-github-waagent]:https://github.com/Azure/WALinuxAgent
[link-azure-codeplex]:https://azurestorageexplorer.codeplex.com/
[link-azure-2]:../storage/blobs/storage-dotnet-shared-access-signature-part-2.md
[link-azure-1]:../storage/common/storage-dotnet-shared-access-signature-part-1.md
[link-msft-download]:http://www.microsoft.com/download/details.aspx?id=44299
[link-technet-3]:https://technet.microsoft.com/library/hh846766.aspx
[link-technet-2]:https://msdn.microsoft.com/library/dn495261.aspx
[link-azure-portal]:https://portal.azure.com
[link-pubportal]:https://publish.windowsazure.com
[link-sql-2014-ent]:http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2014enterprisewindowsserver2012r2/
[link-sql-2014-std]:http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2014standardwindowsserver2012r2/
[link-sql-2014-web]:http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2014webwindowsserver2012r2/
[link-sql-2012-ent]:http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2012sp2enterprisewindowsserver2012/
[link-sql-2012-std]:http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2012sp2standardwindowsserver2012/
[link-sql-2012-web]:http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2012sp2webwindowsserver2012/
[link-datactr-2012-r2]:http://azure.microsoft.com/marketplace/partners/microsoft/windowsserver2012r2datacenter/
[link-datactr-2012]:http://azure.microsoft.com/marketplace/partners/microsoft/windowsserver2012datacenter/
[link-datactr-2008-r2]:http://azure.microsoft.com/marketplace/partners/microsoft/windowsserver2008r2sp1/
[link-acct-creation]:marketplace-publishing-accounts-creation-registration.md
[link-technet-1]:https://technet.microsoft.com/library/hh848454.aspx
[link-azure-vm-2]:./virtual-machines-linux-agent-user-guide/
[link-openssl]:https://www.openssl.org/
[link-intsvc]:http://www.microsoft.com/download/details.aspx?id=41554
[link-python]:https://www.python.org/
