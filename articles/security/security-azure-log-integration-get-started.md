---
title: "Приступая к работе со службой интеграции журналов Azure | Документация Майкрософт"
description: "Узнайте, как установить службу интеграции журналов Azure и интегрировать журналы из службы хранилища Azure, журналы аудита Azure и оповещения центра безопасности Azure."
services: security
documentationcenter: na
author: Barclayn
manager: MBaldwin
editor: TomShinder
ms.assetid: 53f67a7c-7e17-4c19-ac5c-a43fabff70e1
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ums.workload: na
ms.date: 07/26/2017
ms.author: TomSh
ms.custom: azlog
ms.openlocfilehash: 9d39ecd513386b75b4b640721f80991caaf9ade8
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="azure-log-integration-with-azure-diagnostics-logging-and-windows-event-forwarding"></a>Интеграция журналов Azure с ведением журнала системы диагностики Azure и пересылкой событий Windows
Служба интеграции журналов Azure (AzLog) позволяет интегрировать необработанные журналы из ресурсов Azure с локальными системами управления информацией о безопасности и событиями безопасности (SIEM). С помощью такой интеграции можно получить унифицированную панель мониторинга безопасности для всех ресурсов, локальных или облачных, что позволяет выполнять статистическую обработку, сопоставление и анализ, а также оповещать о событиях безопасности, связанных с приложениями.
>[!NOTE]
Дополнительные сведения об интеграции журналов Azure см. в [обзоре интеграции журналов Azure](https://docs.microsoft.com/azure/security/security-azure-log-integration-overview).

Эта статья поможет вам приступить к работе с интеграцией журналов Azure. Она посвящена установке службы Azlog и ее интеграции с системой диагностики Azure. После этого служба интеграции журналов Azure сможет собирать данные журнала событий Windows из канала событий безопасности Windows, поступающие из виртуальных машин, развернутых в IaaS Azure. Это очень похоже на пересылку событий, которую вы, возможно, использовали в локальной среде.

>[!NOTE]
>SIEM обеспечивает возможность передачи выходных данных службы интеграции журналов Azure в SIEM. Дополнительные сведения см. в статье [Azure Log Integration SIEM configuration steps](https://blogs.msdn.microsoft.com/azuresecurity/2016/08/23/azure-log-siem-configuration-steps/) (Настройка службы интеграции журналов Azure в SIEM).

Следует уточнить: служба интеграции журналов Azure выполняется на физическом компьютере или виртуальной машине под управлением операционной системы Windows Server 2008 R2 или более поздней версии (Windows Server 2012 R2 или Windows Server 2016 являются предпочтительными).

Физический компьютер может работать в локальной среде (или на сайте поставщика услуг размещения). Если вы решили выполнять службу интеграции журналов Azure на виртуальной машине, эта виртуальная машина может быть расположена в локальной среде или общедоступном облаке, например Microsoft Azure.

У физического компьютера или виртуальной машины, на которой выполняется служба интеграции журналов Azure, должно быть сетевое подключение к общедоступному облаку Azure. Инструкции в этой статье описывают настройку.

## <a name="prerequisites"></a>Предварительные требования
Для установки службы AzLog как минимум требуется следующее.
* **Подписка Azure**. Если у вас нет подписки, вы можете зарегистрироваться для использования [бесплатной учетной записи](https://azure.microsoft.com/free/).
* **Учетная запись хранения**, которая может использоваться для ведения журнала диагностики Microsoft Azure (можно указать предварительно настроенную учетную запись хранения или создать новую; далее в этой статье мы покажем, как настроить учетную запись хранения).
  >[!NOTE]
  В зависимости от ситуации учетная запись хранения может не потребоваться. Однако она требуется для сценария диагностики Azure, описанном в этой статье.
* **Две системы**: компьютер, на котором будет выполняться служба интеграции журналов Azure, и компьютер, который будет отслеживаться и предоставлять данные журнала для передачи на компьютер службы Azlog.
   * Компьютер, который требуется отслеживать, — это виртуальная машина [Azure](../virtual-machines/virtual-machines-windows-overview.md).
   * Компьютер, на котором будет выполняться служба интеграции журналов Azure. Этот компьютер будет собирать все данные журнала, которые позже будут импортироваться в SIEM.
    * Эта система может размещаться в локальной среде или в облаке Microsoft Azure.  
    * На нем должен использоваться 64-разрядный выпуск Windows Server 2008 2008 R2 с пакетом обновления 1 (SP1) или более поздней версии и установлена платформа .NET Framework 4.5.1. Установленную версию .NET можно определить, следуя указаниям в статье [Практическое руководство. Определение установленных версий платформы .NET Framework](https://msdn.microsoft.com/library/hh925568).  
    Он должен иметь возможность подключения к учетной записи хранения Azure, используемой для ведения журналов диагностики Azure. Далее в этой статье будут даны указания по проверке этого подключения.

Быстрая демонстрация процесса создания виртуальной машины с помощью портала Azure показана в видео ниже.

> [!VIDEO https://channel9.msdn.com/Blogs/Azure-Security-Videos/Azure-Log-Integration-Videos-Create-a-Virtual-Machine/player]



## <a name="deployment-considerations"></a>Рекомендации по развертыванию
Во время тестирования интеграции журналов Azure можно использовать любую систему, отвечающую минимальным требованиям к операционной системе. Однако загрузка рабочей среды может потребовать планирования масштабирования ресурсов.

В случае большого объема событий можно запустить несколько экземпляров службы интеграции журналов Azure (по одному на физический компьютер или виртуальную машину). Кроме того, можно балансировать нагрузку учетных записей хранения системы диагностики Azure для Windows (WAD) и число подписок, предоставляемых для экземпляров, в соответствии с нагрузкой.
>[!NOTE]
В настоящее время у нас нет каких-либо определенных рекомендаций по развертыванию экземпляров компьютера интеграции журналов Azure (т. е. компьютеров, на которых запущена служба интеграции журналов Azure) или советов для учетных записей хранения или подписок. Решения о масштабировании следует принимать, исходя из наблюдаемой производительности в каждой из этих областей.

Также имеется возможность развернуть службу интеграции журналов Azure, чтобы повысить производительность. Ниже приведены метрики производительности, которые помогут выбрать размер компьютеров для выполнения службы интеграции журналов Azure.
* На компьютере с 8 процессорами (ядрами) один экземпляр Azlog Integrator может обрабатывать около 24 млн событий в день (примерно 1 млн в час).

* На компьютере с 4 процессорами (ядрами) один экземпляр Azlog Integrator может обрабатывать около 1,5 млн событий в день (примерно 62,5 тыс. в час).

## <a name="install-azure-log-integration"></a>Установка интеграции журналов Azure
Чтобы установить службу интеграции журналов Azure, необходимо скачать ее [файл установки](https://www.microsoft.com/download/details.aspx?id=53324). Выполните процедуру установки и примите решение, передавать ли данные телеметрии в корпорацию Майкрософт.  

![Экран установки с установленным флажком для передачи данных телеметрии](./media/security-azure-log-integration-get-started/telemetry.png)

*
> [!NOTE]
> Рекомендуется разрешить корпорации Майкрософт собирать данные телеметрии. Сбор данных телеметрии можно отключить, сняв этот флажок.
>


Служба интеграции журналов Azure собирает данные телеметрии с компьютера, на котором она установлена.  

Собираются следующие данные телеметрии:

* исключения, возникающие при выполнении интеграции журналов Azure;
* метрики о количестве обработанных запросов и событий;
* статистические данные использования параметров командной строки Azlog.exe.

В следующем видео рассматривается процесс установки.
> [!VIDEO https://channel9.msdn.com/Blogs/Azure-Security-Videos/Azure-Log-Integration-Videos-Install-Azure-Log-Integration/player]



## <a name="post-installation-and-validation-steps"></a>Действия после установки и проверка
После завершения базовой установки все готово для выполнения послеустановочных действий и проверки.
1. Откройте окно PowerShell с повышенными привилегиями и перейдите в каталог **c:\Program Files\Microsoft Azure Log Integration**.
2. Первое, что необходимо сделать, — импортировать командлеты AzLog. Для этого можно выполнить сценарий **LoadAzlogModule.ps1** (обратите внимание на знак ".\" в приведенной ниже команде). Введите **.\LoadAzlogModule.ps1** и нажмите клавишу **ВВОД**.  
На рисунке ниже показан пример того, что вы должны увидеть на экране. </br></br>
![Экран установки с установленным флажком для передачи данных телеметрии](./media/security-azure-log-integration-get-started/loaded-modules.png) </br></br>
3. Теперь необходимо настроить AzLog для использования конкретной среды Azure. "Среда Azure" — это тип облачного центра обработки данных Azure, с которым требуется работать. Хотя в настоящее время существует несколько сред Azure, на данный момент доступны значения **AzureCloud** и **AzureUSGovernment**.   В среде PowerShell с повышенными привилегиями убедитесь, что вы находитесь в каталоге **c:\program files\Microsoft Azure Log Integration\**. </br></br>
    Затем выполните следующую команду: </br>
    ``Set-AzlogAzureEnvironment -Name AzureCloud`` (для Azure для коммерческих организаций)

      >[!NOTE]
      Результат успешного выполнения команды на экране не отобразится.  Если вы хотите использовать облако Azure для государственных организаций США, для переменной -Name облака следует использовать значение **AzureUSGovernment**. Другие облака Azure в настоящее время не поддерживаются.  
4. Прежде чем начать мониторинг системы, потребуется получить имя учетной записи хранения, используемой для системы диагностики Azure.  На портале Azure перейдите в колонку **Виртуальные машины** и найдите виртуальную машину, которую будете отслеживать. В разделе **Свойства** щелкните **Параметры диагностики**.  Щелкните **Агент** и запишите указанное имя учетной записи хранения. Оно потребуется вам в дальнейшем.
![Параметры системы диагностики Azure](./media/security-azure-log-integration-get-started/storage-account-large.png) </br></br>

      ![Параметры системы диагностики Azure](./media/security-azure-log-integration-get-started/azure-monitoring-not-enabled-large.png)
      >[!NOTE]
      Если мониторинг не был включен во время создания виртуальной машины, вам будет предоставлена возможность включить его, как показано выше.
5. Теперь мы перейдем к компьютеру интеграции журналов Azure. Нужно проверить возможность подключения к учетной записи хранения из системы, в которой установлена служба интеграции журналов Azure. Физическому компьютеру или виртуальной машине, на которой работает служба интеграции журналов Azure, требуется доступ к учетной записи хранения для получения сведений, регистрируемых системой диагностики Azure, в соответствии с настройками в каждой из отслеживаемых систем.  
  1. Скачать Azure Storage Explorer можно [отсюда](http://storageexplorer.com/).
  2. Выполнение процедуры установки
  3. После завершения установки нажмите кнопку **Далее** и не устанавливайте флажок **Launch Microsoft Azure Storage Explorer** (Запустить Microsoft Azure Storage Explorer).  
  4. Войдите в Azure.
  5. Убедитесь, что на портале отображается учетная запись хранения, настроенная для системы диагностики Azure.  
![учетные записи хранения;](./media/security-azure-log-integration-get-started/storage-account.jpg) </br></br>
   6. Обратите внимание, что в учетной записи хранения отображается несколько элементов. Один из них — **Таблицы**. В элементе **Таблицы** отображается таблица **WADWindowsEventLogsTable**. </br></br>
   ![Учетные записи хранения](./media/security-azure-log-integration-get-started/storage-explorer.png) </br>

## <a name="integrate-azure-diagnostic-logging"></a>Интеграция ведения журналов диагностики Azure
На этом шаге вы настроите компьютер, на котором выполняется служба интеграции журналов Azure, для подключения к учетной записи хранения, содержащей файлы журнала.
Для выполнения этого шага необходимо заранее кое-что подготовить.  
* **FriendlyNameForSource**. Это понятное имя, которое можно применить к учетной записи хранения, настроенной в виртуальной машине для хранения сведений из системы диагностики Azure.
* **StorageAccountName**. Это имя учетной записи хранения, указанный при настройке системы диагностики Azure.  
* **StorageKey**. Это ключ к хранилищу данных для учетной записи хранения, содержащей сведения системы диагностики Azure для данной виртуальной машины.  

Выполните следующее, чтобы получить ключ к хранилищу данных.
 1. Перейдите на [портал Azure](http://portal.azure.com).
 2. Прокрутите вниз область навигации консоли Azure и щелкните **Больше служб**.

 ![Пункт "Больше служб"](./media/security-azure-log-integration-get-started/more-services.png)
 3. В текстовом поле **Фильтр** введите **Учетные записи хранения**. Щелкните **Учетные записи хранения** (этот элемент появится после ввода текста **Учетные записи хранения**).

   ![Поле фильтра](./media/security-azure-log-integration-get-started/filter.png)
 4. Появится список учетных записей хранения. Дважды щелкните учетную запись, назначенную для хранения журналов.

   ![Список учетных записей хранения](./media/security-azure-log-integration-get-started/storage-accounts.png)
 5. В разделе **Параметры** щелкните **Ключи доступа**.

  ![ключи доступа](./media/security-azure-log-integration-get-started/storage-account-access-keys.png)
 6. Скопируйте значение **key1** и поместите его в безопасное место, откуда вы сможете его получить для следующего шага.

   ![Два ключа доступа](./media/security-azure-log-integration-get-started/storage-account-access-keys.png)
 7. На сервере, на котором установлена служба интеграции журналов Azure, откройте командную строку с повышенными привилегиями. Обратите внимание, что мы используем окно командной строки с повышенными привилегиями, а не консоль PowerShell с повышенными привилегиями.
 8. Перейдите в каталог **c:\Program Files\Microsoft Azure Log Integration**.
 9. Запустите ``Azlog source add <FriendlyNameForTheSource> WAD <StorageAccountName> <StorageKey> `` </br> Пример: ``Azlog source add Azlogtest WAD Azlog9414 fxxxFxxxxxxxxywoEJK2xxxxxxxxxixxxJ+xVJx6m/X5SQDYc4Wpjpli9S9Mm+vXS2RVYtp1mes0t9H5cuqXEw==``. Если требуется отобразить идентификатор подписки в коде XML события, добавьте идентификатор подписки к понятному имени: ``Azlog source add <FriendlyNameForTheSource>.<SubscriptionID> WAD <StorageAccountName> <StorageKey>`` или ``Azlog source add Azlogtest.YourSubscriptionID WAD Azlog9414 fxxxFxxxxxxxxywoEJK2xxxxxxxxxixxxJ+xVJx6m/X5SQDYc4Wpjpli9S9Mm+vXS2RVYtp1mes0t9H5cuqXEw==``.

>[!NOTE]  
Подождите до 60 минут, а затем просмотрите события, извлеченные из учетной записи хранения. Для этого в Azlog Integrator щелкните **Event Viewer (Просмотр событий) > Windows Logs (Журналы Windows) > Forwarded Events (Пересланные события)**.

Вот видео с практическим выполнением инструкций, описанных выше.
> [!VIDEO https://channel9.msdn.com/Blogs/Azure-Security-Videos/Azure-Log-Integration-Videos-Enable-Diagnostics-and-Storage/player]


## <a name="what-if-data-is-not-showing-up-in-the-forwarded-events-folder"></a>Что делать, если данные не отображаются в папке "Пересланные события"?
Если через час в папке **Пересланные события** не появились данные, то сделайте следующее:

1. Проверьте компьютер, на котором выполняется служба интеграции журналов Azure, и убедитесь, что у него есть доступ к Azure. Чтобы проверить возможность подключения, попробуйте открыть [портал Azure](http://portal.azure.com) в браузере.
2. Убедитесь, что учетная запись пользователя **Azlog** имеет разрешение на запись в папку **users\Azlog**.
  <ol type="a">
   <li>Откройте **проводник** .</li>
  <li> Перейдите в папку **c:\users** .</li>
  <li> Щелкните правой кнопкой мыши папку **c:\users\Azlog** .</li>
  <li> Щелкните **Безопасность**  .</li>
  <li> Щелкните **NT Service\Azlog** и проверьте разрешения для этой учетной записи. Если эта учетная запись отсутствует на вкладке или соответствующие разрешения в настоящее время не отображены, можно предоставить их данной учетной записи на этой вкладке.</li>
  </ol>
3. Убедитесь, что учетная запись хранения, указанная в команде **Azlog source add**, отображается при выполнении команды **Azlog source list**.
4. Щелкните **Event Viewer (Просмотр событий) > Windows Logs (Журналы Windows) > Application (Приложение)**, чтобы проверить наличие ошибок, о которых сообщила служба интеграции журналов Azure.


В случае проблем при установке и настройке создайте [запрос в службу поддержки](../azure-supportability/how-to-create-azure-support-request.md), указав **Интеграция журнала** в качестве службы, для которой запрашивается поддержка.

Другим средством источником поддержки служит [форум MSDN по интеграции журналов Azure](https://social.msdn.microsoft.com/Forums/home?forum=AzureLogIntegration). С его помощью сообщество разработчиков может помогать друг другу, делясь вопросами, ответами, советами и рекомендациями о том, как максимально использовать возможности интеграции журналов Azure. Кроме того, команда разработчиков службы интеграции журналов Azure отслеживает этот форум и помогает при любой возможности.

## <a name="next-steps"></a>Дальнейшие действия
Чтобы узнать больше об интеграции журналов Azure, ознакомьтесь со следующими документами:

* [Служба интеграции журналов Microsoft Azure для журналов Azure](https://www.microsoft.com/download/details.aspx?id=53324) — посетите Центр загрузки, чтобы получить дополнительные сведения, изучить требования к системе и получить инструкции по установке службы интеграции журналов Azure.
* [Introduction to Microsoft Azure log integration (Preview)](security-azure-log-integration-overview.md) (Введение в службу интеграции журналов Azure (предварительная версия)) — в этом документе рассказывается о службе интеграции журналов Azure, ее основных возможностях и принципах работы.
* [Azure Log Integration SIEM configuration steps](https://blogs.msdn.microsoft.com/azuresecurity/2016/08/23/azure-log-siem-configuration-steps/) (Настройка SIEM для службы интеграции журналов Azure) — в этой записи блога показано, как настроить службу интеграции журналов Azure для работы с такими решениями партнеров, как Splunk, HP ArcSight и IBM QRadar. В настоящее время это наше руководство по настройке компонентов SIEM. Обратитесь сначала к своему поставщику SIEM для получения дополнительных сведений.
* [Azure log integration frequently asked questions (FAQ)](security-azure-log-integration-faq.md) (Служба интеграции журналов Azure: часто задаваемые вопросы) — эта статья содержит ответы на часто задаваемые вопросы об интеграции журналов Azure.
* [Интеграция оповещений центра обеспечения безопасности с помощью интеграции журналов Azure (предварительная версия)](../security-center/security-center-integrating-alerts-with-log-integration.md) — в этом документе показано, как синхронизировать оповещения центра безопасности, а также события безопасности виртуальных машин, собранные системой диагностики Azure и в журналах действий Azure, с решением Log Analytics или SIEM.
* [New features for Azure diagnostics and Azure Audit logs](https://azure.microsoft.com/blog/new-features-for-azure-diagnostics-and-azure-audit-logs/) (Новые возможности системы диагностики Azure и журналов аудита Azure) — в этой записи блога рассказывается о журналах аудита Azure и других функциях, которые помогут глубже понять, как работают ваши ресурсы Azure.
