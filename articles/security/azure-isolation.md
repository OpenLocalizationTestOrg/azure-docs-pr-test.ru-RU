---
title: "Изоляция в общедоступном облаке Azure | Документация Майкрософт"
description: "Узнайте об облачных службах вычислений, которые включают в себя широкий спектр вычислительных операций и служб, поддерживающих автомасштабирование ресурсов в соответствии с потребностями приложения или предприятия."
services: security
documentationcenter: na
author: UnifyCloud
manager: swadhwa
editor: TomSh
ms.assetid: 
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/21/2017
ms.author: TomSh
ms.openlocfilehash: a153d70e077ad63a042e76d0c4ae40e3cc067a2a
ms.sourcegitcommit: 62eaa376437687de4ef2e325ac3d7e195d158f9f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/22/2017
---
# <a name="isolation-in-the-azure-public-cloud"></a>Изоляция в общедоступном облаке Azure
##  <a name="introduction"></a>Введение
### <a name="overview"></a>Обзор
Чтобы помочь текущим и потенциальным клиентам Azure понять и правильно использовать различные функции безопасности, доступные в платформе Azure и связанных продуктах, корпорация Майкрософт разработала ряд технических документов, обзоров возможностей безопасности, рекомендаций и контрольных списков.
Содержимое разделов периодически обновляется с точки зрения охвата и углубленности материала. Данный документ является частью этого цикла, как описано в приведенной ниже аннотации.

### <a name="azure-platform"></a>Платформа Azure
Azure — открытая, гибкая облачная платформа, которая поддерживает самый широкий выбор операционных систем, языков программирования, платформ, инструментов, баз данных и устройств. Вот что вы можете, к примеру, делать:
- запускать контейнеры Linux с интеграцией Docker;
- создавать приложения с помощью JavaScript, Python, .NET, PHP, Java и Node.js;
- создавать серверные части для устройств iOS, Android и Windows.

Microsoft Azure поддерживает технологии, которым доверяют миллионы разработчиков и ИТ-специалистов.

Создавая ресурсы ИТ или перенося их в поставщик общедоступных облачных служб, вы полагаетесь на возможности организации по обеспечению защиты приложений и данных с помощью предоставляемых решений для управления безопасностью облачных ресурсов.

Инфраструктура устройств и приложений Azure предназначена для размещения миллионов пользователей одновременно. Это надежная база, которая удовлетворяет корпоративным требованиям к обеспечению безопасности. Кроме того, Azure включает самые разные настраиваемые решения для обеспечения безопасности, а также возможность управления ими. Все это позволит настроить защиту в соответствии с особенностями развернутых решений. Данный документ поможет вам выполнить эти требования.

### <a name="abstract"></a>Аннотация

Microsoft Azure позволяет выполнять приложения и виртуальные машины в общей физической инфраструктуре. Одной из первостепенных коммерческих предпосылок для запуска приложений в облачной среде является возможность распределить затраты на общие ресурсы между несколькими клиентами. Такой мультитенантный подход повышает эффективность мультиплексирования ресурсов между различными заказчиками и обеспечивает снижение затрат. К сожалению, он также создает риск совместного использования физических серверов и других ресурсов инфраструктуры для выполнения критически важных приложений и виртуальных машин, которые могут принадлежать произвольному и потенциально злоумышленному пользователю.

В этой статье описано, как Microsoft Azure обеспечивает изоляцию от пользователей-злоумышленников и обычных пользователей. Она служит руководством по разработке облачных решений, предлагая архитекторам различные варианты изоляции. В этом техническом документе рассматриваются технологии платформы Azure и средства управления безопасностью клиентов. В нем не затрагиваются соглашения об уровне обслуживания, модели ценообразования и рекомендации для DevOps.

## <a name="tenant-level-isolation"></a>Уровень изоляции клиентов
Одно из основных преимуществ облачных вычислений — принцип общей инфраструктуры, одновременно разделяемой многочисленными клиентами, что позволяет сократить затраты на порядок. Этот принцип называется мультитенантностью. Корпорация Майкрософт постоянно работает над мультитенантной архитектурой облака Microsoft Azure, чтобы обеспечить соблюдение стандартов безопасности, конфиденциальности, целостности и доступности.

В облачной среде клиента можно определить как заказчика или организацию, которая владеет определенным экземпляром облачной службы и управляет им. В рамках платформы идентификации Microsoft Azure клиент — это просто выделенный экземпляр Azure Active Directory (Azure AD), который ваша организация получает и которым она владеет после регистрации в облачной службе Майкрософт.

Каждый каталог Azure AD отделен от других каталогов Azure AD. Как и офисное здание представляет безопасный актив только для вашей организации, каталог Azure AD также может безопасно использоваться только вашей организацией. Архитектура Azure AD изолирует сведения о клиентах и удостоверениях от других пользователей. Это означает, что пользователи и администраторы одного каталога Azure AD не могут случайно или злонамеренно получить доступ к данным в другом каталоге.

### <a name="azure-tenancy"></a>Аренда Azure
Аренда Azure (подписка Azure) означает связь между клиентом и выставлением счетов. Ей соответствует уникальный [клиент](https://docs.microsoft.com/azure/active-directory/develop/active-directory-howto-tenant) в [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-whatis). Изоляция на уровне клиента в Microsoft Azure достигается с помощью службы Azure Active Directory и ее [элементов управления на основе ролей](https://docs.microsoft.com/azure/active-directory/role-based-access-control-what-is). Каждая подписка Azure связана с одним каталогом Azure Active Directory (AD).

Пользователи, группы и приложения из этого каталога могут управлять ресурсами в подписке Azure. Эти права доступа можно назначать с помощью портала Azure, программ командной строки Azure и интерфейсов API управления Azure. Клиент Azure AD логически изолируется с помощью границ безопасности, чтобы никакой клиент не мог получить доступ к данным совладельцев или скопрометировать их, злонамеренно или случайно. Azure AD выполняется на выделенных серверах, изолированных в отдельном сегменте сети, в котором средство фильтрации пакетов на уровне узла и брандмауэр Windows блокируют нежелательные подключения и трафик.

- Доступ к данным в Azure AD требует проверки подлинности пользователя через службу маркеров безопасности. Система авторизации определяет, имеет ли этот пользователь в этом сеансе право на доступ требуемого типа к целевому клиенту. Решение принимается на основе информации о существовании, состоянии активности и роли пользователя.

![Аренда Azure](./media/azure-isolation/azure-isolation-fig1.png)


- Клиенты являются отдельными контейнерами, не взаимосвязанными между собой.

- У клиентов нет доступа друг к другу, если только администратор клиентов не предоставит его, использовав федерацию или подготовив учетные записи пользователей из других клиентов.

- Физический доступ к серверам службы Azure AD и прямой доступ к серверным системам Azure AD ограничен.

- У пользователей Azure AD нет доступа к физическим ресурсам или расположениям, поэтому они не могут обойти логические проверки политик RBAC, приведенные ниже.

Для диагностики и обслуживания требуется и используется рабочая модель, которая использует JIT-систему повышения привилегий. В управлении привилегированными пользователями Azure AD вводится понятие "временный администратор". [Временные администраторы](https://docs.microsoft.com/azure/active-directory/active-directory-privileged-identity-management-configure) — это пользователи, которым привилегированный доступ требуется время от времени, а не каждый день. Эта роль будет неактивной, пока пользователю не потребуется доступ. При необходимости пользователь выполнит активацию и станет активным администратором на заранее определенный период времени.

![Azure AD Privileged Identity Management](./media/azure-isolation/azure-isolation-fig2.png)

В Azure Active Directory размещается каждый клиент и его защищенный контейнер. Политиками и разрешениями для контейнера и в нем исключительно владеет и управляет клиент.

Понятие контейнеров клиента прочно внедрено в службе каталогов на всех уровнях, от порталов до постоянного хранилища.

Даже если метаданные нескольких клиентов Azure Active Directory хранятся на одном физическом диске, между контейнерами нет какой-либо связи, кроме определенной службой каталогов, что, в свою очередь, определяет администратора клиентов.

### <a name="azure-role-based-access-control-rbac"></a>Управление доступом на основе ролей в Azure (RBAC)
[Управление доступом на основе ролей в Azure (RBAC)](https://docs.microsoft.com/azure/active-directory/role-based-access-control-what-is) позволяет совместно использовать различные компоненты, доступные в подписке Azure, обеспечивая детализированное управление доступом в Azure. Azure RBAC позволяет разделять обязанности в организации и предоставлять доступ в зависимости от того, что нужно пользователям для работы. Вместо того, чтобы предоставить всем неограниченные разрешения для подписки Azure или ресурсов, можно разрешить только определенные действия.

Механизм RBAC Azure (управление доступом на основе ролей) включает в себя три основные роли, которые применяются ко всем типам ресурсов.

- **Владелец** имеет полный доступ ко всем ресурсам, включая право делегировать доступ другим.

- **Участник** может создавать все типы ресурсов Azure и управлять ими, но не может предоставлять доступ другим.

- **Читатель** может просматривать существующие ресурсы Azure.

![Управление доступом на основе ролей в Azure](./media/azure-isolation/azure-isolation-fig3.png)

Остальные роли RBAC в Azure разрешают управление определенными ресурсами Azure. Например, роль "Участник виртуальных машин" позволяет пользователю создавать виртуальные машины и управлять ими. Эта роль не предоставляет доступ к виртуальной сети или подсети Azure, к которой подключается виртуальная машина.

В статье [RBAC: встроенные роли](https://docs.microsoft.com/azure/active-directory/role-based-access-built-in-roles) перечислены роли, доступные в Azure. В статье указаны также операции и области, которые каждая встроенная роль предоставляет пользователям. Если вы хотите определить собственные роли для дополнительного управления, см. статью [Пользовательские роли в Azure RBAC](https://docs.microsoft.com/azure/active-directory/role-based-access-control-custom-roles).

К другим возможностям Azure Active Directory относятся следующие.
- Azure AD позволяет использовать функцию единого входа в приложениях SaaS независимо от их размещения. Некоторые приложения служба Azure AD объединяет в федерацию, а другие используют единый вход с помощью пароля. Федеративные приложения могут также поддерживать подготовку пользователя и [хранение паролей в хранилище](https://www.techopedia.com/definition/31415/password-vault).

- Доступ к данным в [службе хранилища Azure](https://azure.microsoft.com/services/storage/) регулируется механизмом проверки подлинности. Для каждой учетной записи хранения предусмотрен первичный ключ ([ключ учетной записи хранения](https://docs.microsoft.com/azure/storage/storage-create-storage-account), или SAK) и вторичный секретный ключ (подписанный URL-адрес, или SAS).

- В Azure AD можно использовать удостоверение как услугу при федерации (с помощью [служб федерации Active Directory](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-azure-adfs)), синхронизации и репликации локальных каталогов.

- [Многофакторная Идентификация Azure](https://docs.microsoft.com/azure/multi-factor-authentication/multi-factor-authentication) — это служба многофакторной идентификации, которая требует от пользователей подтверждения входа с помощью мобильного приложения, телефонного звонка или текстового сообщения. Ее можно использовать с Azure AD для защиты локальных ресурсов с помощью сервера Многофакторной идентификации Azure, а также с пользовательскими приложениями и каталогами с помощью пакета SDK.

- [Доменные службы Azure AD](https://azure.microsoft.com/services/active-directory-ds/) позволяют присоединять виртуальные машины Azure к домену Active Directory без необходимости развертывать контроллеры домена. Вы можете входить на эти виртуальные машины, используя корпоративные учетные данные Active Directory. Кроме того, вы можете выполнять администрирование виртуальных машин, присоединенных к домену, с помощью групповой политики, применяя базовые средства защиты на всех виртуальных машинах Azure.

- [Azure Active Directory B2C](https://azure.microsoft.com/services/active-directory-b2c/) — это высокодоступная глобальная служба управления удостоверениями для клиентских приложений с возможностью масштабирования до сотен миллионов удостоверений. Служба интегрируется с мобильными и веб-платформами. Клиенты могут входить в ваши приложения через настраиваемый интерфейс, используя существующие учетные записи социальных сетей или создавая новые.

### <a name="isolation-from-microsoft-administrators--data-deletion"></a>Изоляция от администраторов корпорации Майкрософт и удаление данных
Корпорация Майкрософт принимает надежные меры для защиты ваших данных от несанкционированного доступа или использования посторонними лицами. Эти рабочие процессы и элементы управления регулируются [условиями использования веб-служб](http://aka.ms/Online-Services-Terms), которые обеспечивают договорные обязательства по управлению доступом к данным.

-   Инженеры корпорации Майкрософт по умолчанию не имеют доступ к вашим данным в облаке. Вместо этого они получают доступ под надзором руководства, только когда это необходимо. Этот доступ тщательно контролируется, регистрируется и аннулируется сразу же, как только перестает быть нужен.

-   Корпорация Майкрософт может нанять другие компании для предоставления ограниченных служб от своего имени. Субподрядчики могут получить доступ к данным клиента только для обеспечения служб, для предоставления которых мы их наняли, и им запрещается использовать эти данные для других целей. Более того, они связаны контрактными обязательствами и должны соблюдать конфиденциальность данных наших клиентов.

Бизнес-службы, использующие сертификаты аудита, например ISO/IEC 27001, регулярно проверяются корпорацией Майкрософт и аккредитованными аудиторскими компаниями, которые проводят выборочный аудит для подтверждения этого доступа, исключительно для законных коммерческих целей. Вы всегда можете получить доступ к своим данным клиента, в любое время и по любой причине.

Если вы удалите данные, Microsoft Azure удалит их, включая все сохраненные в кэше или резервные копии. В соответствующих службах удаление произойдет в течение 90 дней после окончания периода хранения. (Соответствующие службы указаны в разделе "Условия обработки данных" наших [условий использования веб-служб](http://aka.ms/Online-Services-Terms).)

Если дисковый накопитель, используемый для хранения данных, выходит из строя, то перед тем, как корпорация Майкрософт вернет его изготовителю для замены или ремонта, все данные на нем безопасно [удаляются или уничтожаются](https://www.microsoft.com/trustcenter/Privacy/You-own-your-data). Данные на диске перезаписываются, чтобы гарантировать невозможность их восстановления любым способом.

## <a name="compute-isolation"></a>Изоляция вычислений
Microsoft Azure предоставляет различные облачные службы вычислений, которые включают в себя широкий спектр вычислительных операций и служб, поддерживающих автомасштабирование ресурсов в соответствии с потребностями приложения или предприятия. Эти вычислительные операции и службы обеспечивают изоляцию на нескольких уровнях, позволяющую защитить данные без ущерба для гибкости в требуемой клиенту конфигурации.

### <a name="hyper-v--root-os-isolation-between-root-vm--guest-vms"></a>Hyper-V и корневая ОС: изоляция корневой виртуальной машины и гостевых виртуальных машин
Вычислительная платформа Azure основана на виртуализации компьютеров. Это значит, что весь код клиента выполняется на виртуальной машине Hyper-V. На каждом узле Azure (или конечной точки сети) размещен гипервизор, который выполняется непосредственно на аппаратном обеспечении и разделяет узел на переменное количество гостевых виртуальных машин.


![Hyper-V и корневая ОС: изоляция корневой виртуальной машины и гостевых виртуальных машин](./media/azure-isolation/azure-isolation-fig4.jpg)


На каждом узле имеется также одна специальная корневая виртуальная машина, на которой выполняется операционная система узла. Критической границей является изоляция корневой виртуальной машины от гостевых виртуальных машин, а также изоляция гостевых виртуальных машин друг от друга. Этой изоляцией управляют гипервизор и корневая ОС. Для совместного применения гипервизора и корневой ОС корпорация Майкрософт использует десятилетия своего опыта в области безопасности операционных систем и более поздние знания о Microsoft Hyper-V, чтобы обеспечить строгую изоляцию виртуальных машин.

Платформа Azure использует виртуальную среду. Пользовательские экземпляры работают как изолированные виртуальные машины, у которых нет доступа к физическому серверу узла. Такая изоляция обеспечивается применением уровней привилегий физического процессора (кольцо 0 и кольцо 3).

Кольцо 0 обеспечивает максимальные привилегии, а кольцо 3 — минимальные. Гостевая ОС выполняется в кольце 1 с меньшими привилегиями, а приложения — в последнем кольце 3 с наименьшими привилегиями. Виртуализация физических ресурсов приводит к четкому разделению гостевой ОС и низкоуровневой оболочки, что приводит к дополнительному разделению по безопасности между ними.

Низкоуровневая оболочка Azure выполняет роль микроядра, передавая все запросы на доступ к оборудованию из гостевых виртуальных машин узлам для обработки с помощью интерфейса общей памяти VMBus. Благодаря этому пользователь не может получить доступ RAW к системе на чтение, запись и выполнение. Таким образом снижается риск совместного доступа к системным ресурсам.

### <a name="advanced-vm-placement-algorithm--protection-from-side-channel-attacks"></a>Расширенный алгоритм размещения виртуальных машин и защита от атак по сторонним каналам
Любая перекрестная атака на виртуальную машину состоит из двух этапов: виртуальная машина под управлением хакера размещается на том же узле, что и виртуальная машина, выбранная в качестве жертвы, и затем нарушается граница изоляции, чтобы похитить конфиденциальные данные или повлиять на ее работу из корыстных или хулиганских побуждений. Microsoft Azure обеспечивает защиту от обоих действий благодаря расширенному алгоритму размещения виртуальных машин и защите от всех известных атак по сторонним каналам, включая виртуальные машины типа "шумный сосед".

### <a name="the-azure-fabric-controller"></a>Контроллер структуры Azure
Контролер структуры Azure отвечает за распределение ресурсов инфраструктуры между рабочими нагрузками клиента, управляя односторонней связью между узлом и виртуальными машинами. Алгоритм размещения виртуальных машин, применяемый контроллером структуры Azure, очень сложен, и почти невозможно предсказать, как он будет себя вести на уровне физического узла.

![Контроллер структуры Azure](./media/azure-isolation/azure-isolation-fig5.png)

Низкоуровневая оболочка Azure принудительно разделяет память и процессы между виртуальными машинами, обеспечивая безопасную передачу сетевого трафика клиентам гостевой ОС. Это исключает вероятность атаки по сторонним каналам на уровне виртуальной машины.

Корневая виртуальная машина в Azure является особенной: она работает под управлением операционной системы с усиленной защитой, называемой корневой ОС, в которой размещается агент структуры. Агенты структуры, в свою очередь, используются для управления гостевыми агентами в гостевых ОС на виртуальных машинах клиентов. Агенты структуры также управляют узлами хранилища.

Набор из гипервизора Azure, корневой ОС и агента структуры, а также виртуальных машин клиентов и гостевых агентов представляет собой вычислительный узел. Агентами структуры управляет контроллер структуры, размещенный за пределами вычислительных узлов и узлов хранилища (вычислительными кластерами и кластерами хранилища управляют отдельные контроллеры структуры). Если клиент обновляет файл конфигурации своего приложения, когда оно выполняется, контроллер структуры обращается к агенту структуры, после чего агент структуры обращается к гостевым агентам, которые уведомляют приложение об изменении конфигурации. В случае сбоя оборудования контроллер структуры автоматически найдет доступное оборудование и перезапустит виртуальную машину на нем.

![Контроллер структуры Azure](./media/azure-isolation/azure-isolation-fig6.jpg)

Связь контроллера структуры с агентом является однонаправленной. Агент реализует службу с защитой SSL, которая только отвечает на запросы от контроллера. Он не может инициировать подключения к контроллеру или другим привилегированным внутренним узлам. Контроллер структуры рассматривает все ответы как ненадежные.


![Контроллер структуры](./media/azure-isolation/azure-isolation-fig7.png)

Изоляция распространяется от корневой виртуальной машины на все гостевые виртуальные машины, которые также изолируются друг от друга. Вычислительные узлы также изолированы от узлов хранилища в целях усиления защиты.


Гипервизор и ОС узла предоставляют фильтры сетевых пакетов, позволяющие гарантировать, что ненадежные виртуальные машины не смогут создавать поддельный трафик или получать трафик, адресованный не им, направлять трафик к конечным точкам защищенной инфраструктуры или отправлять и получать нежелательный широковещательный трафик.


### <a name="additional-rules-configured-by-fabric-controller-agent-to-isolate-vm"></a>Дополнительные правила, настраиваемые агентом контроллера структуры для изоляции виртуальных машин
По умолчанию при создании виртуальной машины весь трафик блокируется. Затем агент контроллера структуры настраивает фильтр пакетов, чтобы добавить правила и исключения, которые позволяют передавать разрешенный трафик.

Запрограммированы две категории правил.

-   **Конфигурация компьютера или правила инфраструктуры**. По умолчанию весь обмен данными блокируется. Но есть исключения, которые разрешают виртуальной машине отправлять и получать трафик DHCP и DNS. Виртуальные машины могут также отправлять трафик как в общедоступный сегмент Интернета, так и другим виртуальным машинам в той же виртуальной сети Azure и на сервере активации ОС. Список разрешенных исходящих назначений виртуальных машин не включает в себя подсети маршрутизатора Azure, сервер управления Azure и другие компоненты Майкрософт.

-   **Файл конфигурации ролей**. Он определяет входящие списки управления доступом на основе клиентской модели службы.

### <a name="vlan-isolation"></a>Изоляция виртуальных локальных сетей
В каждом кластере существуют три виртуальные локальные сети.

![Изоляция виртуальных локальных сетей](./media/azure-isolation/azure-isolation-fig8.jpg)


-   Основная виртуальная локальная сеть соединяет ненадежные узлы клиента между собой.

-   Виртуальная локальная сеть контроллера структуры содержит доверенные контроллеры структуры и вспомогательные системы.

-   Виртуальная локальная сеть устройств содержит доверенные сетевые и другие устройства инфраструктуры.

Разрешается передача данных из виртуальной локальной сети контроллера структуры в основную виртуальную локальную сеть, но невозможно инициировать передачу данных из основной виртуальной локальной сети в виртуальную локальную сеть контроллера. Кроме того, блокируется передача данных из основной виртуальной локальной сети в виртуальную локальную сеть устройств. Это гарантирует, что даже при компрометации узла, на котором выполняется код клиента, будет невозможно атаковать узлы в виртуальной локальной сети контроллера структуры или устройств.

## <a name="storage-isolation"></a>Изоляция хранилища
### <a name="logical-isolation-between-compute-and-storage"></a>Логическая изоляция вычислений и хранилища
В основе платформы Microsoft Azure реализовано отделение вычислений на виртуальных машинах от хранилища. Такое разделение позволяет масштабировать вычисления и хранилище независимо друг от друга, что упрощает обеспечение мультитенантности и изоляции.

Поэтому служба хранилища Azure выполняется на отдельном оборудовании без сетевого подключения к службе вычислений Azure, за исключением логических подключений. [Это](https://msenterprise.global.ssl.fastly.net/vnext/PDFs/A01_AzureSecurityWhitepaper20160415c.pdf) означает, что при создании виртуального диска не выделяется дисковое пространство для всей его емкости. Вместо этого создается таблица, сопоставляющая адреса на виртуальном диске с областями на физическом диске, и эта таблица изначально пуста. **Когда клиент впервые записывает данные на виртуальный диск, на физическом диске выделяется область и указатель нее помещается в таблицу.**
### <a name="isolation-using-storage-access-control"></a>Изоляция с помощью управления доступом к хранилищу
**Управление доступом в службе хранилища Azure** использует простую модель. Для каждой подписки Azure можно создать одну или несколько учетных записей хранения. Каждая учетная запись хранения имеет один секретный ключ, используемый для управления доступом ко всем данным в этой учетной записи хранения.

![Изоляция с помощью управления доступом к хранилищу](./media/azure-isolation/azure-isolation-fig9.png)

**Доступом к данным службы хранилища Azure (включая таблицы)** можно управлять с помощью маркера [SAS (подписанный URL-адрес)](https://docs.microsoft.com/azure/storage/storage-dotnet-shared-access-signature-part-1), который предоставляет доступ с заданной областью. SAS создается с помощью шаблона запроса (URL-адреса), подписанного с помощью [SAK (ключа учетной записи хранения)](https://msdn.microsoft.com/library/azure/ee460785.aspx). Этот [подписанный URL-адрес](https://docs.microsoft.com/azure/storage/storage-dotnet-shared-access-signature-part-1) можно предоставить другому процессу (то есть делегировать), который затем может заполнить данные запроса и выполнить запрос службы хранилища. С помощью SAS можно предоставить клиентам доступ с ограниченным сроком действия, не предоставляя секретный ключ учетной записи хранения.

SAS означает, что клиенту можно предоставить ограниченное право на работу с объектами в вашей учетной записи хранения на определенный период времени и с определенным набором разрешений. Вы можете предоставлять эти ограниченные права, не сообщая ключи доступа к своей учетной записи.

### <a name="ip-level-storage-isolation"></a>Изоляция хранилища на уровне IP-адреса
Вы можете настроить брандмауэры и определить диапазон IP-адресов для доверенных клиентов. После определения диапазона IP-адресов к [службе хранилища Azure](https://docs.microsoft.com/azure/storage/storage-security-guide) смогут подключаться только клиенты с IP-адресами в пределах этого диапазона.

Данные IP-хранилища могут быть защищены от неавторизованных пользователей с помощью сетевого механизма, используемого для установления выделенного туннеля для трафика IP-хранилища.

### <a name="encryption"></a>Шифрование
Azure предлагает следующие типы шифрования для защиты данных.
-   Шифрование при передаче

-   Шифрование при хранении

#### <a name="encryption-in-transit"></a>Шифрование при передаче
Шифрование при передаче — это механизм защиты данных, передаваемых по сетям. Служба хранилища Azure позволяет применять для защиты данных:

-   [шифрование транспортного уровня](https://docs.microsoft.com/azure/storage/storage-security-guide#encryption-in-transit), например протокол HTTPS, при передаче данных в службу хранилища Azure или из нее;

-   [шифрование подключения](../storage/common/storage-security-guide.md#using-encryption-during-transit-with-azure-file-shares), например шифрование SMB 3.0 для файловых ресурсов Azure;

-   [шифрование на стороне клиента](https://docs.microsoft.com/azure/storage/storage-security-guide#using-client-side-encryption-to-secure-data-that-you-send-to-storage), которое шифрует данные перед их передачей в хранилище и расшифровывает данные после получения из хранилища.

#### <a name="encryption-at-rest"></a>Шифрование при хранении
Для многих организаций [шифрование неактивных данных](https://blogs.microsoft.com/cybertrust/2015/09/10/cloud-security-controls-series-encrypting-data-at-rest/) является обязательным шагом для защиты данных, соблюдения стандартов и обеспечения конфиденциальности данных. В Azure есть три функции, обеспечивающие шифрование неактивных данных.

-   [Шифрование службы хранилища](https://docs.microsoft.com/azure/storage/storage-security-guide#encryption-at-rest) позволяет настроить автоматическое шифрование данных, записываемых в службу хранилища Azure.

-   [Шифрование на стороне клиента](https://docs.microsoft.com/azure/storage/storage-security-guide#client-side-encryption) также обеспечивает шифрование при хранении.

-   [Шифрование дисков Azure](https://docs.microsoft.com/azure/security/azure-security-disk-encryption) позволяет шифровать диски ОС и диски данных, используемые виртуальными машинами IaaS.

#### <a name="azure-disk-encryption"></a>Дисковое шифрование Azure
[Шифрование дисков Azure](https://docs.microsoft.com/azure/security/azure-security-disk-encryption) для виртуальных машин помогает соблюдать корпоративные требования к безопасности и соответствию. Эта служба выполняет шифрование дисков виртуальных машин (загрузочных дисков и дисков данных) с использованием ключей и политик, которыми вы управляете в [Azure Key Vault](https://azure.microsoft.com/services/key-vault/).

Шифрование дисков для Windows основано на [шифровании дисков Microsoft BitLocker](https://technet.microsoft.com/library/cc732774.aspx), а аналогичное решение для Linux использует шифрование [dm-crypt](https://en.wikipedia.org/wiki/Dm-crypt).

В решениях, которые появляются в Microsoft Azure, реализована поддержка следующих возможностей для виртуальных машин IaaS:
-   интеграция с хранилищем ключей Azure;

-   виртуальные машины IaaS серий A, D, DS, G, GS и т. д. уровня "Стандартный";

-   включение шифрования для виртуальных машин IaaS под управлением Windows и Linux;

-   отключение шифрования дисков данных и дисков операционной системы виртуальных машин IaaS под управлением Windows;

-   отключение шифрования дисков данных виртуальных машин IaaS под управлением Linux;

-   включение шифрования для виртуальных машин IaaS под управлением клиентской ОС Windows;

-   включение шифрования томов с путями подключения;

-   включение шифрования для виртуальных машин Linux с чередованием дисков (RAID) с помощью программы [mdadm](https://en.wikipedia.org/wiki/Mdadm);

-   включение шифрования для виртуальных машин Linux с использованием [диспетчера логических томов (LVM)](https://msdn.microsoft.com/library/windows/desktop/bb540532) для дисков данных;

-   включение шифрования для виртуальных машин Windows, использующих дисковые пространства.

-   поддерживаются все общедоступные регионы Azure.

В этом выпуске решения не поддерживаются следующие сценарии, функции и технологии:

-   виртуальные машины уровня "Базовый";

-   отключение шифрования диска ОС виртуальных машин IaaS под управлением Linux;

-   виртуальные машины IaaS, созданные с помощью классической модели развертывания;

-   интеграция с локальной службой управления ключами;

-   служба файлов Azure (файловый ресурс Azure), NFS, динамические тома, виртуальные машины Windows с программными системами RAID.

## <a name="sql-azure-database-isolation"></a>Изоляция базы данных SQL Azure
База данных SQL — это реляционная служба баз данных в Microsoft Cloud на основе популярного ядра Microsoft SQL Server, которая подходит для выполнения критически важных рабочих нагрузок. База данных SQL предоставляет изоляцию прогнозируемых данных на уровне учетной записи на основе географического расположения или региона либо сети, обеспечивая практически полностью автоматизированное администрирование.

### <a name="sql-azure-application-model"></a>Модель приложения SQL Azure

База данных [Microsoft SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-get-started) — это облачная служба реляционных баз данных, созданная на основе технологий SQL Server. Она предоставляет высокодоступную, масштабируемую и мультитенантную службу баз данных, размещаемую корпорацией Майкрософт в облаке.

С точки зрения приложения SQL Azure предоставляет следующую иерархию: каждый уровень содержит приведенные ниже вложенные уровни по схеме "один ко многим".

![Модель приложения SQL Azure](./media/azure-isolation/azure-isolation-fig10.png)

Учетная запись и подписка — это понятия, используемые в платформе Microsoft Azure, чтобы связать выставления счетов и управление.

Логические серверы и базы данных — это понятия, связанные с SQL Azure и управляемые с помощью SQL Azure посредством интерфейсов OData и TSQL или портала SQL Azure, который интегрирован в портал Azure.

Серверы SQL Azure не являются физическими экземплярами или экземплярами виртуальных машин. Они представляют собой коллекции баз данных, использующих общие политики управления и безопасности, которые хранятся в так называемой логической базе данных master.

![SQL Azure](./media/azure-isolation/azure-isolation-fig11.png)

Логические базы данных master содержат:

-   имена для входа SQL, используемые для подключения к серверу;

-   Правила файрволла

Данные о выставлении счетов и использовании для баз данных SQL Azure на одном логическом сервере не обязательно будут храниться в одном физическом экземпляре в кластере SQL Azure. Вместо этого при подключении приложение должно указать имя целевой базы данных.

С точки зрения клиента логический сервер создается в графическом регионе, тогда как на самом деле сервер создается в одном из кластеров в регионе.

### <a name="isolation-through-network-topology"></a>Изоляции с помощью топологии сети

При создании логического сервера и регистрации его DNS-имени оно указывает на так называемый "виртуальный IP-адрес шлюза" в центре обработки данных, в котором размещается этот сервер.

За этим виртуальным IP-адресом находится набор служб шлюза без отслеживания. В общем случае шлюз задействуется, когда требуется координировать работу нескольких источников данных (база данных master, база данных пользователя и т. д.). Службы шлюза реализуют следующие функции.
-   **Использование прокси-сервера TDS-подключений.** Это включает в себя поиск базы данных пользователя во внутреннем кластере, реализацию последовательности входа в систему и пересылку пакетов TDS в серверную часть и обратно.

-   **Управление базами данных.** Это включает в себя реализацию коллекции рабочих процессов для выполнения операций CREATE, ALTER или DROP с базами данных. Операции базы данных могут быть вызваны посредством сканирования пакетов TDS или явного использования интерфейсов API OData.

-   Операции пользователя CREATE, ALTER или DROP.

-   Операции управления логическим сервером с помощью API OData.

![Изоляции с помощью топологии сети](./media/azure-isolation/azure-isolation-fig12.png)

Уровень за шлюзом называется "внутренним". На нем хранятся все данные в режиме высокой доступности. Каждый фрагмент данных принадлежит "секции" или "единице отработки отказа", у каждой из которых есть по крайней мере три реплики. Реплики сохраняются и реплицируются ядром SQL Server, а управляет ими система отработки отказа, которую часто называют "структурой".

Как правило, внутренняя система не передает данные в другие системы из соображений безопасности. Эта функция возложена на интерфейсный (шлюзовой) уровень. Компьютеры шлюзового уровня имеют ограниченные привилегии на внутренних компьютерах, чтобы свести к минимуму возможные виды атак благодаря механизму эшелонированной защиты.

### <a name="isolation-by-machine-function-and-access"></a>Изоляция с помощью функций и доступа компьютеров
SQL Azure состоит из служб, использующих различные функции компьютеров. SQL Azure делится на "внутреннюю" среду облачной базы данных и "интерфейсную" среду (управление и шлюз), которые реализуют общий принцип: трафик передается только в серверную часть (внутреннюю среду), но не из нее. Интерфейсная среда может взаимодействовать с внешним миром других служб и в общем случае имеет только ограниченные разрешения для серверной части (достаточные для вызова необходимых точек входа).

## <a name="networking-isolation"></a>Изоляция сетей
Развертывание Azure использует несколько уровней изоляции сети. На следующей схеме показаны различные уровни изоляции сети, которые Azure предоставляет клиентам. Эти уровни представляют собой как уровни безопасности самой платформы Azure, так и пользовательские функции. На входе трафика из Интернета действует защита Azure от атак DDoS, которая изолирует масштабные атаки на среду Azure. Следующий уровень изоляции — определяемые пользователем общедоступные IP-адреса (конечные точки). С их помощью можно определить, какой трафик можно передать через облачную службу в виртуальную сеть. Виртуальная сеть Azure имеет встроенную систему изоляции от всех остальных сетей, и этот трафик может проходить только теми путями и методами, которые настроены пользователем. Эти пути и методы образуют следующий уровень, на котором с помощью групп безопасности сети (NSG), определяемых пользователем маршрутов (UDR) и виртуальных сетевых устройств можно создать границы изоляции для обеспечения безопасности развернутых приложений в защищенной сети.

![Изоляция сетей](./media/azure-isolation/azure-isolation-fig13.png)

**Изоляция трафика.** [Виртуальная сеть](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) на платформе Azure выступает в качестве границы изоляции трафика. Виртуальные машины в одной виртуальной сети не могут напрямую обращаться к виртуальным машинам в другой виртуальной сети, даже если обе виртуальные сети созданы одним клиентом. Это критически важное свойство, которое гарантирует, что виртуальные машины и все коммуникации клиента останутся закрытыми в пределах виртуальной сети.

[Подсеть](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview#subnets) обеспечивает дополнительный уровень изоляции в виртуальной сети на основе диапазона IP-адресов. IP-адреса виртуальной сети можно разделить на несколько подсетей для организационного удобства и безопасности. Виртуальные машины и экземпляры роли PaaS, развернутые в подсети (одной или разных) в виртуальной сети, могут взаимодействовать друг с другом без дополнительной настройки. Можно также настроить [группу безопасности сети (NSG)](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview#network-security-groups-nsg), чтобы разрешить или запретить сетевой трафик для экземпляра виртуальной машины на основе правил, настроенных в списке управления доступом (ACL) NSG. Группы безопасности сети можно связать с подсетями или отдельными экземплярами виртуальных машин в одной из подсетей. Когда NSG связана с подсетью, правила списка управления доступом применяются ко всем экземплярам виртуальной машины в этой подсети.

## <a name="next-steps"></a>Дальнейшие действия

- [Network Isolation Options for Machines in Windows Azure Virtual Networks](https://azure.microsoft.com/blog/network-isolation-options-for-machines-in-windows-azure-virtual-networks/) (Возможности изоляции сети для компьютеров в виртуальных сетях Microsoft Azure)

Описывается классический сценарий интерфейсной и внутренней сетей, в котором компьютеры, размещенные в определенной внутренней сети или подсети, разрешают подключаться к определенной конечной точке только определенным клиентам или компьютерам, в соответствии со списком разрешенных IP-адресов.

- [Изоляция вычислений](https://msenterprise.global.ssl.fastly.net/vnext/PDFs/A01_AzureSecurityWhitepaper20160415c.pdf)

Microsoft Azure предоставляет различные облачные службы вычислений, которые включают в себя широкий спектр вычислительных операций и служб, поддерживающих автомасштабирование ресурсов в соответствии с потребностями приложения или предприятия.

- [Изоляция хранилища](https://msenterprise.global.ssl.fastly.net/vnext/PDFs/A01_AzureSecurityWhitepaper20160415c.pdf)

Microsoft Azure отделяет вычисления клиента на виртуальных машинах от хранилища. Такое разделение позволяет масштабировать вычисления и хранилище независимо друг от друга, что упрощает обеспечение мультитенантности и изоляции. Поэтому служба хранилища Azure выполняется на отдельном оборудовании без сетевого подключения к службе вычислений Azure, за исключением логических подключений. Все запросы передаются по протоколу HTTP или HTTPS в зависимости от выбора клиента.

