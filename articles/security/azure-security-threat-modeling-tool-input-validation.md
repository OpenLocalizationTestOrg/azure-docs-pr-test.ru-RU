---
title: "Проверка входных данных. Средство моделирования угроз Microsoft Azure | Документация Майкрософт"
description: "Устранение угроз, обнаруженных с помощью средства моделирования угроз"
services: security
documentationcenter: na
author: RodSan
manager: RodSan
editor: RodSan
ms.assetid: na
ms.service: security
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: rodsan
ms.openlocfilehash: b7ce6f353cf8cf48d5fb038ee77b0d3fdae16fb7
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="security-frame-input-validation--mitigations"></a><span data-ttu-id="c6a87-103">Механизм безопасности: проверки входных данных | Снижение риска</span><span class="sxs-lookup"><span data-stu-id="c6a87-103">Security Frame: Input Validation | Mitigations</span></span> 
| <span data-ttu-id="c6a87-104">Продукт или служба</span><span class="sxs-lookup"><span data-stu-id="c6a87-104">Product/Service</span></span> | <span data-ttu-id="c6a87-105">Статья</span><span class="sxs-lookup"><span data-stu-id="c6a87-105">Article</span></span> |
| --------------- | ------- |
| <span data-ttu-id="c6a87-106">**Веб-приложение**</span><span class="sxs-lookup"><span data-stu-id="c6a87-106">**Web Application**</span></span> | <ul><li>[<span data-ttu-id="c6a87-107">Отключайте скрипты XSLT для всех операций преобразования, использующих ненадежные таблицы стилей</span><span class="sxs-lookup"><span data-stu-id="c6a87-107">Disable XSLT scripting for all transforms using untrusted style sheets</span></span>](#disable-xslt)</li><li>[<span data-ttu-id="c6a87-108">Убедитесь, что каждая страница, на которой может быть содержимое, управляемое пользователем, не использует автоматическое обнаружение типов MIME</span><span class="sxs-lookup"><span data-stu-id="c6a87-108">Ensure that each page that could contain user controllable content opts out of automatic MIME sniffing</span></span>](#out-sniffing)</li><li>[<span data-ttu-id="c6a87-109">Усильте защиту для разрешения сущностей XML или отключите его</span><span class="sxs-lookup"><span data-stu-id="c6a87-109">Harden or Disable XML Entity Resolution</span></span>](#xml-resolution)</li><li>[<span data-ttu-id="c6a87-110">Приложения, использующие драйвер http.sys, выполняют проверку нормализации URL-адресов</span><span class="sxs-lookup"><span data-stu-id="c6a87-110">Applications utilizing http.sys perform URL canonicalization verification</span></span>](#app-verification)</li><li>[<span data-ttu-id="c6a87-111">Убедитесь, что при приеме файлов от пользователей обеспечиваются соответствующие меры безопасности</span><span class="sxs-lookup"><span data-stu-id="c6a87-111">Ensure appropriate controls are in place when accepting files from users</span></span>](#controls-users)</li><li>[<span data-ttu-id="c6a87-112">Убедитесь, что в веб-приложении для доступа к данным используются параметры типобезопасности</span><span class="sxs-lookup"><span data-stu-id="c6a87-112">Ensure that type-safe parameters are used in Web Application for data access</span></span>](#typesafe)</li><li>[<span data-ttu-id="c6a87-113">Используйте отдельные классы привязки моделей или списки привязки фильтров для устранения уязвимости массового назначения MVC</span><span class="sxs-lookup"><span data-stu-id="c6a87-113">Use separate model binding classes or binding filter lists to prevent MVC mass assignment vulnerability</span></span>](#binding-mvc)</li><li>[<span data-ttu-id="c6a87-114">Кодируйте ненадежные выходные веб-данные перед обработкой</span><span class="sxs-lookup"><span data-stu-id="c6a87-114">Encode untrusted web output prior to rendering</span></span>](#rendering)</li><li>[<span data-ttu-id="c6a87-115">Проверяйте и фильтруйте входные данные по всем свойствам модели строкового типа</span><span class="sxs-lookup"><span data-stu-id="c6a87-115">Perform input validation and filtering on all string type Model properties</span></span>](#typemodel)</li><li>[<span data-ttu-id="c6a87-116">Очищайте поля форм, принимающие все знаки, например редактор форматированного текста</span><span class="sxs-lookup"><span data-stu-id="c6a87-116">Sanitization should be applied on form fields that accept all characters, e.g, rich text editor</span></span>](#richtext)</li><li>[<span data-ttu-id="c6a87-117">Не назначайте элементы модели DOM приемникам без встроенных возможностей кодирования</span><span class="sxs-lookup"><span data-stu-id="c6a87-117">Do not assign DOM elements to sinks that do not have inbuilt encoding</span></span>](#inbuilt-encode)</li><li>[<span data-ttu-id="c6a87-118">Убедитесь, что операции перенаправления в приложении закрыты или выполняются безопасно</span><span class="sxs-lookup"><span data-stu-id="c6a87-118">Validate all redirects within the application are closed or done safely</span></span>](#redirect-safe)</li><li>[<span data-ttu-id="c6a87-119">Внедрите проверку входных данных для всех параметров строкового типа, принимаемых методами контроллера</span><span class="sxs-lookup"><span data-stu-id="c6a87-119">Implement input validation on all string type parameters accepted by Controller methods</span></span>](#string-method)</li><li>[<span data-ttu-id="c6a87-120">Задайте верхний предел времени ожидания для обработки регулярных выражений во избежание атаки типа "отказ в обслуживании" из-за недопустимого регулярного выражения</span><span class="sxs-lookup"><span data-stu-id="c6a87-120">Set upper limit timeout for regular expression processing to prevent DoS due to bad regular expressions</span></span>](#dos-expression)</li><li>[<span data-ttu-id="c6a87-121">Не используйте метод Html.Raw в представлениях Razor</span><span class="sxs-lookup"><span data-stu-id="c6a87-121">Avoid using Html.Raw in Razor views</span></span>](#html-razor)</li></ul> | 
| <span data-ttu-id="c6a87-122">**База данных**</span><span class="sxs-lookup"><span data-stu-id="c6a87-122">**Database**</span></span> | <ul><li>[<span data-ttu-id="c6a87-123">Не используйте динамические запросы в хранимых процедурах</span><span class="sxs-lookup"><span data-stu-id="c6a87-123">Do not use dynamic queries in stored procedures</span></span>](#stored-proc)</li></ul> |
| <span data-ttu-id="c6a87-124">**Веб-интерфейс API**</span><span class="sxs-lookup"><span data-stu-id="c6a87-124">**Web API**</span></span> | <ul><li>[<span data-ttu-id="c6a87-125">Убедитесь, что в методах веб-API выполнена проверка моделей</span><span class="sxs-lookup"><span data-stu-id="c6a87-125">Ensure that model validation is done on Web API methods</span></span>](#validation-api)</li><li>[<span data-ttu-id="c6a87-126">Внедрите проверку входных данных для всех параметров строкового типа, принимаемых методами веб-API</span><span class="sxs-lookup"><span data-stu-id="c6a87-126">Implement input validation on all string type parameters accepted by Web API methods</span></span>](#string-api)</li><li>[<span data-ttu-id="c6a87-127">Убедитесь, что в веб-API для доступа к данным используются параметры типобезопасности</span><span class="sxs-lookup"><span data-stu-id="c6a87-127">Ensure that type-safe parameters are used in Web API for data access</span></span>](#typesafe-api)</li></ul> | 
| <span data-ttu-id="c6a87-128">**Azure DocumentDB**</span><span class="sxs-lookup"><span data-stu-id="c6a87-128">**Azure Document DB**</span></span> | <ul><li>[<span data-ttu-id="c6a87-129">Используйте параметризованные SQL-запросы для DocumentDB</span><span class="sxs-lookup"><span data-stu-id="c6a87-129">Use parametrized SQL queries for DocumentDB</span></span>](#sql-docdb)</li></ul> | 
| <span data-ttu-id="c6a87-130">**WCF**</span><span class="sxs-lookup"><span data-stu-id="c6a87-130">**WCF**</span></span> | <ul><li>[<span data-ttu-id="c6a87-131">Проверка входных данных WCF путем привязки к схеме</span><span class="sxs-lookup"><span data-stu-id="c6a87-131">WCF Input validation through Schema binding</span></span>](#schema-binding)</li><li>[<span data-ttu-id="c6a87-132">Проверка входных данных WCF с помощью инспекторов параметров</span><span class="sxs-lookup"><span data-stu-id="c6a87-132">WCF- Input validation through Parameter Inspectors</span></span>](#parameters)</li></ul> |

## <span data-ttu-id="c6a87-133"><a id="disable-xslt"></a>Отключайте скрипты XSLT для всех операций преобразования, использующих ненадежные таблицы стилей</span><span class="sxs-lookup"><span data-stu-id="c6a87-133"><a id="disable-xslt"></a>Disable XSLT scripting for all transforms using untrusted style sheets</span></span>

| <span data-ttu-id="c6a87-134">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-134">Title</span></span>                   | <span data-ttu-id="c6a87-135">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-135">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-136">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-136">**Component**</span></span>               | <span data-ttu-id="c6a87-137">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-137">Web Application</span></span> | 
| <span data-ttu-id="c6a87-138">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-138">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-139">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-139">Build</span></span> |  
| <span data-ttu-id="c6a87-140">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-140">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-141">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-141">Generic</span></span> |
| <span data-ttu-id="c6a87-142">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-142">**Attributes**</span></span>              | <span data-ttu-id="c6a87-143">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-143">N/A</span></span>  |
| <span data-ttu-id="c6a87-144">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-144">**References**</span></span>              | <span data-ttu-id="c6a87-145">[Безопасность XSLT](https://msdn.microsoft.com/library/ms763800(v=vs.85).aspx), [XsltSettings.EnableScript Property](http://msdn.microsoft.com/library/system.xml.xsl.xsltsettings.enablescript.aspx) (Свойство XsltSettings.EnableScript)</span><span class="sxs-lookup"><span data-stu-id="c6a87-145">[XSLT Security](https://msdn.microsoft.com/library/ms763800(v=vs.85).aspx), [XsltSettings.EnableScript Property](http://msdn.microsoft.com/library/system.xml.xsl.xsltsettings.enablescript.aspx)</span></span> |
| <span data-ttu-id="c6a87-146">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-146">**Steps**</span></span> | <span data-ttu-id="c6a87-147">XSLT поддерживает использование скриптов в таблицах стилей с применением элемента `<msxml:script>`.</span><span class="sxs-lookup"><span data-stu-id="c6a87-147">XSLT supports scripting inside style sheets using the `<msxml:script>` element.</span></span> <span data-ttu-id="c6a87-148">Таким образом пользовательские функции можно задействовать в преобразовании XSLT.</span><span class="sxs-lookup"><span data-stu-id="c6a87-148">This allows custom functions to be used in an XSLT transformation.</span></span> <span data-ttu-id="c6a87-149">Сценарий выполняется в контексте процесса, выполняющего преобразование.</span><span class="sxs-lookup"><span data-stu-id="c6a87-149">The script is executed under the context of the process performing the transform.</span></span> <span data-ttu-id="c6a87-150">При работе в ненадежной среде скрипт XSLT нужно отключить, чтобы предотвратить выполнение ненадежного кода.</span><span class="sxs-lookup"><span data-stu-id="c6a87-150">XSLT script must be disabled when in an untrusted environment to prevent execution of untrusted code.</span></span> <span data-ttu-id="c6a87-151">*При использовании .NET* скрипты XSLT отключены по умолчанию. Тем не менее необходимо убедиться, что они не были явно включены в свойстве `XsltSettings.EnableScript`.</span><span class="sxs-lookup"><span data-stu-id="c6a87-151">*If using .NET:* XSLT scripting is disabled by default; however, you must ensure that it has not been explicitly enabled through the `XsltSettings.EnableScript` property.</span></span>|

### <a name="example"></a><span data-ttu-id="c6a87-152">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-152">Example</span></span> 

```C#
XsltSettings settings = new XsltSettings();
settings.EnableScript = true; // WRONG: THIS SHOULD BE SET TO false
```

### <a name="example"></a><span data-ttu-id="c6a87-153">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-153">Example</span></span>
<span data-ttu-id="c6a87-154">При использовании MSXML 6.0 скрипты XSLT отключены по умолчанию. Тем не менее необходимо убедиться, что они не были явно включены в свойстве AllowXsltScript объекта XML модели DOM.</span><span class="sxs-lookup"><span data-stu-id="c6a87-154">If you are using using MSXML 6.0, XSLT scripting is disabled by default; however, you must ensure that it has not been explicitly enabled through the XML DOM object property AllowXsltScript.</span></span> 

```C#
doc.setProperty("AllowXsltScript", true); // WRONG: THIS SHOULD BE SET TO false
```

### <a name="example"></a><span data-ttu-id="c6a87-155">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-155">Example</span></span>
<span data-ttu-id="c6a87-156">Если вы используете MSXML версии 5 или более ранней, скрипты XSLT включены по умолчанию. Их необходимо явно отключать.</span><span class="sxs-lookup"><span data-stu-id="c6a87-156">If you are using MSXML 5 or below, XSLT scripting is enabled by default and you must explicitly disable it.</span></span> <span data-ttu-id="c6a87-157">Задайте для свойства AllowXsltScript объекта XML модели DOM значение false.</span><span class="sxs-lookup"><span data-stu-id="c6a87-157">Set the XML DOM object property AllowXsltScript to false.</span></span> 

```C#
doc.setProperty("AllowXsltScript", false); // CORRECT. Setting to false disables XSLT scripting.
```

## <span data-ttu-id="c6a87-158"><a id="out-sniffing"></a>Убедитесь, что каждая страница, на которой может быть содержимое, управляемое пользователем, не использует автоматическое обнаружение типов MIME</span><span class="sxs-lookup"><span data-stu-id="c6a87-158"><a id="out-sniffing"></a>Ensure that each page that could contain user controllable content opts out of automatic MIME sniffing</span></span>

| <span data-ttu-id="c6a87-159">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-159">Title</span></span>                   | <span data-ttu-id="c6a87-160">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-160">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-161">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-161">**Component**</span></span>               | <span data-ttu-id="c6a87-162">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-162">Web Application</span></span> | 
| <span data-ttu-id="c6a87-163">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-163">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-164">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-164">Build</span></span> |  
| <span data-ttu-id="c6a87-165">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-165">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-166">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-166">Generic</span></span> |
| <span data-ttu-id="c6a87-167">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-167">**Attributes**</span></span>              | <span data-ttu-id="c6a87-168">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-168">N/A</span></span>  |
| <span data-ttu-id="c6a87-169">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-169">**References**</span></span>              | <span data-ttu-id="c6a87-170">[IE8 Security Part V — Comprehensive Protection](http://blogs.msdn.com/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx) (Безопасность IE8, часть 5: комплексная защита)</span><span class="sxs-lookup"><span data-stu-id="c6a87-170">[IE8 Security Part V - Comprehensive Protection](http://blogs.msdn.com/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx)</span></span>  |
| <span data-ttu-id="c6a87-171">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-171">**Steps**</span></span> | <p><span data-ttu-id="c6a87-172">Для каждой страницы, на которой может быть содержимое, управляемое пользователем, необходимо использовать HTTP-заголовок `X-Content-Type-Options:nosniff`.</span><span class="sxs-lookup"><span data-stu-id="c6a87-172">For each page that could contain user controllable content, you must use the HTTP Header `X-Content-Type-Options:nosniff`.</span></span> <span data-ttu-id="c6a87-173">Чтобы выполнить это требование, можно установить требуемый заголовок постранично для страниц, на которых может быть настраиваемое пользователем содержимое, или задать его глобально для всех страниц в приложении.</span><span class="sxs-lookup"><span data-stu-id="c6a87-173">To comply with this requirement, you can either set the required header page by page for only those pages that might contain user-controllable content, or you can set it globally for all pages in the application.</span></span></p><p><span data-ttu-id="c6a87-174">С каждым типом файлов, доставленных с веб-сервера, связан [тип MIME](http://en.wikipedia.org/wiki/Mime_type) (также называется *content-type*), описывающий характер содержимого (изображение, текст, приложение и т. д.).</span><span class="sxs-lookup"><span data-stu-id="c6a87-174">Each type of file delivered from a web server has an associated [MIME type](http://en.wikipedia.org/wiki/Mime_type) (also called a *content-type*) that describes the nature of the content (that is, image, text, application, etc.)</span></span></p><p><span data-ttu-id="c6a87-175">Заголовок X-Content-Type-Options — это HTTP-заголовок, используя который разработчики могут запретить определение типов MIME содержимого.</span><span class="sxs-lookup"><span data-stu-id="c6a87-175">The X-Content-Type-Options header is an HTTP header that allows developers to specify that their content should not be MIME-sniffed.</span></span> <span data-ttu-id="c6a87-176">Этот заголовок обеспечивает защиту от атак путем определения типов MIME.</span><span class="sxs-lookup"><span data-stu-id="c6a87-176">This header is designed to mitigate MIME-Sniffing attacks.</span></span> <span data-ttu-id="c6a87-177">В Internet Explorer 8 (IE8) добавлена поддержка этого заголовка.</span><span class="sxs-lookup"><span data-stu-id="c6a87-177">Support for this header was added in Internet Explorer 8 (IE8)</span></span></p><p><span data-ttu-id="c6a87-178">Заголовком X-Content-Type-Options смогут воспользоваться только пользователи Internet Explorer 8 (IE8).</span><span class="sxs-lookup"><span data-stu-id="c6a87-178">Only users of Internet Explorer 8 (IE8) will benefit from X-Content-Type-Options.</span></span> <span data-ttu-id="c6a87-179">В предыдущих версиях Internet Explorer не предусмотрена поддержка этого заголовка.</span><span class="sxs-lookup"><span data-stu-id="c6a87-179">Previous versions of Internet Explorer do not currently respect the X-Content-Type-Options header</span></span></p><p><span data-ttu-id="c6a87-180">Только в одном из основных браузеров Internet Explorer 8 (или более поздних версий) можно отключить обнаружение типов MIME.</span><span class="sxs-lookup"><span data-stu-id="c6a87-180">Internet Explorer 8 (and later) are the only major browsers to implement a MIME-sniffing opt-out feature.</span></span> <span data-ttu-id="c6a87-181">Когда подобная возможность будет реализована в других популярных браузерах (Firefox, Safari, Chrome), мы обновим эту рекомендацию и добавим синтаксис для соответствующих браузеров.</span><span class="sxs-lookup"><span data-stu-id="c6a87-181">If and when other major browsers (Firefox, Safari, Chrome) implement similar features, this recommendation will be updated to include syntax for those browsers as well</span></span></p>|

### <a name="example"></a><span data-ttu-id="c6a87-182">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-182">Example</span></span>
<span data-ttu-id="c6a87-183">Чтобы включить требуемый заголовок глобально для всех страниц в приложении, выполните одно из следующих действий.</span><span class="sxs-lookup"><span data-stu-id="c6a87-183">To enable the required header globally for all pages in the application, you can do one of the following:</span></span> 

* <span data-ttu-id="c6a87-184">Добавьте заголовок в файл web.config, если приложение размещено в службах IIS 7.</span><span class="sxs-lookup"><span data-stu-id="c6a87-184">Add the header in the web.config file if the application is hosted by Internet Information Services (IIS) 7</span></span> 

```
<system.webServer> 
  <httpProtocol> 
    <customHeaders> 
      <add name=""X-Content-Type-Options"" value=""nosniff""/>
    </customHeaders>
  </httpProtocol>
</system.webServer> 
```

* <span data-ttu-id="c6a87-185">Добавьте заголовок в глобальной функции Application\_BeginRequest.</span><span class="sxs-lookup"><span data-stu-id="c6a87-185">Add the header through the global Application\_BeginRequest</span></span> 

``` 
void Application_BeginRequest(object sender, EventArgs e)
{
  this.Response.Headers[""X-Content-Type-Options""] = ""nosniff"";
} 
```

* <span data-ttu-id="c6a87-186">Внедрите пользовательский HTTP-модуль.</span><span class="sxs-lookup"><span data-stu-id="c6a87-186">Implement custom HTTP module</span></span> 

``` 
public class XContentTypeOptionsModule : IHttpModule 
  {
    #region IHttpModule Members 
    public void Dispose() 
    { 

    } 
    public void Init(HttpApplication context)
    { 
      context.PreSendRequestHeaders += newEventHandler(context_PreSendRequestHeaders); 
    } 
    #endregion 
    void context_PreSendRequestHeaders(object sender, EventArgs e) 
      { 
        HttpApplication application = sender as HttpApplication; 
        if (application == null) 
          return; 
        if (application.Response.Headers[""X-Content-Type-Options ""] != null) 
          return; 
        application.Response.Headers.Add(""X-Content-Type-Options "", ""nosniff""); 
      } 
  } 

``` 

* <span data-ttu-id="c6a87-187">Чтобы включить требуемый заголовок только для определенных страниц, добавьте его в отдельные ответы:</span><span class="sxs-lookup"><span data-stu-id="c6a87-187">You can enable the required header only for specific pages by adding it to individual responses:</span></span> 

```
this.Response.Headers[""X-Content-Type-Options""] = ""nosniff""; 
``` 

## <span data-ttu-id="c6a87-188"><a id="xml-resolution"></a>Усильте защиту для разрешения сущностей XML или отключите его</span><span class="sxs-lookup"><span data-stu-id="c6a87-188"><a id="xml-resolution"></a>Harden or Disable XML Entity Resolution</span></span>

| <span data-ttu-id="c6a87-189">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-189">Title</span></span>                   | <span data-ttu-id="c6a87-190">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-190">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-191">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-191">**Component**</span></span>               | <span data-ttu-id="c6a87-192">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-192">Web Application</span></span> | 
| <span data-ttu-id="c6a87-193">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-193">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-194">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-194">Build</span></span> |  
| <span data-ttu-id="c6a87-195">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-195">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-196">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-196">Generic</span></span> |
| <span data-ttu-id="c6a87-197">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-197">**Attributes**</span></span>              | <span data-ttu-id="c6a87-198">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-198">N/A</span></span>  |
| <span data-ttu-id="c6a87-199">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-199">**References**</span></span>              | <span data-ttu-id="c6a87-200">[XML Entity Expansion](http://capec.mitre.org/data/definitions/197.html) (Расширения сущностей XML), [XML Denial of Service Attacks and Defenses](http://msdn.microsoft.com/magazine/ee335713.aspx) (XML: атаки типа "отказ в обслуживании" и способы защиты от них), [Общие сведения о безопасности MSXML](http://msdn.microsoft.com/library/ms754611(v=VS.85).aspx), [Рекомендации по обеспечению безопасности кода MSXML](http://msdn.microsoft.com/library/ms759188(VS.85).aspx), [NSXMLParserDelegate Protocol Reference](http://developer.apple.com/library/ios/#documentation/cocoa/reference/NSXMLParserDelegate_Protocol/Reference/Reference.html) (Справочник по протоколу NSXMLParserDelegate), [Разрешение внешних ресурсов](https://msdn.microsoft.com/library/5fcwybb2.aspx)</span><span class="sxs-lookup"><span data-stu-id="c6a87-200">[XML Entity Expansion](http://capec.mitre.org/data/definitions/197.html), [XML Denial of Service Attacks and Defenses](http://msdn.microsoft.com/magazine/ee335713.aspx), [MSXML Security Overview](http://msdn.microsoft.com/library/ms754611(v=VS.85).aspx), [Best Practices for Securing MSXML Code](http://msdn.microsoft.com/library/ms759188(VS.85).aspx), [NSXMLParserDelegate Protocol Reference](http://developer.apple.com/library/ios/#documentation/cocoa/reference/NSXMLParserDelegate_Protocol/Reference/Reference.html), [Resolving External References](https://msdn.microsoft.com/library/5fcwybb2.aspx)</span></span> |
| <span data-ttu-id="c6a87-201">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-201">**Steps**</span></span>| <p><span data-ttu-id="c6a87-202">Существует редко используемая функция XML, благодаря которой средство синтаксического анализа XML расширяет макро-сущности за счет значений, определенных в документе, или из внешних источников.</span><span class="sxs-lookup"><span data-stu-id="c6a87-202">Although it is not widely used, there is a feature of XML that allows the XML parser to expand macro entities with values defined either within the document itself or from external sources.</span></span> <span data-ttu-id="c6a87-203">Например, в документе для сущности companyname может быть определено значение Microsoft, поэтому каждый раз, когда в документе появляется текст &companyname;, он автоматически заменяется на Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c6a87-203">For example, the document might define an entity "companyname" with the value "Microsoft," so that every time the text "&companyname;" appears in the document, it is automatically replaced with the text Microsoft.</span></span> <span data-ttu-id="c6a87-204">Или в документе может быть определена сущность MSFTStock, которая ссылается на внешнюю веб-службу, чтобы получить текущее значение акций Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c6a87-204">Or, the document might define an entity "MSFTStock" that references an external web service to fetch the current value of Microsoft stock.</span></span></p><p><span data-ttu-id="c6a87-205">Каждый раз, когда в документе появляется сущность &MSFTStock;, она автоматически заменяется на текущую цену акций.</span><span class="sxs-lookup"><span data-stu-id="c6a87-205">Then any time "&MSFTStock;" appears in the document, it is automatically replaced with the current stock price.</span></span> <span data-ttu-id="c6a87-206">Тем не менее этой возможностью можно злоупотребить, что приведет к атаке типа "отказ в обслуживании".</span><span class="sxs-lookup"><span data-stu-id="c6a87-206">However, this functionality can be abused to create denial of service (DoS) conditions.</span></span> <span data-ttu-id="c6a87-207">Злоумышленники могут быть вложены несколько сущностей, чтобы создать механизм XML экспоненциального расширения, который использует всю доступную память в системе.</span><span class="sxs-lookup"><span data-stu-id="c6a87-207">An attacker can nest multiple entities to create an exponential expansion XML bomb that consumes all available memory on the system.</span></span> </p><p><span data-ttu-id="c6a87-208">Злоумышленник также может создать внешнюю ссылку, которая выполняет потоковую передачу неограниченного количества данных или приводит к зависанию передачи потока.</span><span class="sxs-lookup"><span data-stu-id="c6a87-208">Alternatively, he can create an external reference that streams back an infinite amount of data or that simply hangs the thread.</span></span> <span data-ttu-id="c6a87-209">В результате всем командам необходимо полностью отключить внутреннее и/или внешнее разрешение сущностей XML, если приложение не использует эту функцию, или вручную ограничить объем памяти и количество времени, которые приложение может тратить на разрешение сущностей, если эта функция крайне необходима.</span><span class="sxs-lookup"><span data-stu-id="c6a87-209">As a result, all teams must disable internal and/or external XML entity resolution entirely if their application does not use it, or manually limit the amount of memory and time that the application can consume for entity resolution if this functionality is absolutely necessary.</span></span> <span data-ttu-id="c6a87-210">Если приложению не требуется разрешение сущностей, отключите его.</span><span class="sxs-lookup"><span data-stu-id="c6a87-210">If entity resolution is not required by your application, then disable it.</span></span> </p>|

### <a name="example"></a><span data-ttu-id="c6a87-211">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-211">Example</span></span>
<span data-ttu-id="c6a87-212">Для кода .NET Framework можно применять следующие подходы:</span><span class="sxs-lookup"><span data-stu-id="c6a87-212">For .NET Framework code, you can use the following approaches:</span></span>

```C#
XmlTextReader reader = new XmlTextReader(stream);
reader.ProhibitDtd = true;

XmlReaderSettings settings = new XmlReaderSettings();
settings.ProhibitDtd = true;
XmlReader reader = XmlReader.Create(stream, settings);

// for .NET 4
XmlReaderSettings settings = new XmlReaderSettings();
settings.DtdProcessing = DtdProcessing.Prohibit;
XmlReader reader = XmlReader.Create(stream, settings);
```
<span data-ttu-id="c6a87-213">Обратите внимание, что значение по умолчанию параметра `ProhibitDtd` в параметре `XmlReaderSettings` — true, но в параметре `XmlTextReader` это значение false.</span><span class="sxs-lookup"><span data-stu-id="c6a87-213">Note that the default value of `ProhibitDtd` in `XmlReaderSettings` is true, but in `XmlTextReader` it is false.</span></span> <span data-ttu-id="c6a87-214">При использовании XmlReaderSettings не нужно явно задавать для параметра ProhibitDtd значение true, но по соображениям безопасности это стоит сделать.</span><span class="sxs-lookup"><span data-stu-id="c6a87-214">If you are using XmlReaderSettings, you do not need to set ProhibitDtd to true explicitly, but it is recommended for safety sake that you do.</span></span> <span data-ttu-id="c6a87-215">Кроме того, обратите внимание, что по умолчанию класс XmlDocument поддерживает разрешение сущностей.</span><span class="sxs-lookup"><span data-stu-id="c6a87-215">Also note that the XmlDocument class allows entity resolution by default.</span></span> 

### <a name="example"></a><span data-ttu-id="c6a87-216">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-216">Example</span></span>
<span data-ttu-id="c6a87-217">Чтобы отключить разрешение сущностей для объектов XmlDocument, используйте перезагрузку `XmlDocument.Load(XmlReader)` метода Load и задайте соответствующие свойства в аргументе XmlReader, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="c6a87-217">To disable entity resolution for XmlDocuments, use the `XmlDocument.Load(XmlReader)` overload of the Load method and set the appropriate properties in the XmlReader argument to disable resolution, as illustrated in the following code:</span></span> 

```C#
XmlReaderSettings settings = new XmlReaderSettings();
settings.ProhibitDtd = true;
XmlReader reader = XmlReader.Create(stream, settings);
XmlDocument doc = new XmlDocument();
doc.Load(reader);
```

### <a name="example"></a><span data-ttu-id="c6a87-218">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-218">Example</span></span>
<span data-ttu-id="c6a87-219">Если в вашем приложении невозможно отключить разрешение сущностей, задайте для свойства XmlReaderSettings.MaxCharactersFromEntities значение в соответствии с требованиями приложения.</span><span class="sxs-lookup"><span data-stu-id="c6a87-219">If disabling entity resolution is not possible for your application, set the XmlReaderSettings.MaxCharactersFromEntities property to a reasonable value according to your application's needs.</span></span> <span data-ttu-id="c6a87-220">Это ограничит воздействие потенциальных атак типа "отказ в обслуживании" с экспоненциальным расширением.</span><span class="sxs-lookup"><span data-stu-id="c6a87-220">This will limit the impact of potential exponential expansion DoS attacks.</span></span> <span data-ttu-id="c6a87-221">В коде ниже приведен пример такого подхода.</span><span class="sxs-lookup"><span data-stu-id="c6a87-221">The following code provides an example of this approach:</span></span> 

```C#
XmlReaderSettings settings = new XmlReaderSettings();
settings.ProhibitDtd = false;
settings.MaxCharactersFromEntities = 1000;
XmlReader reader = XmlReader.Create(stream, settings);
```

### <a name="example"></a><span data-ttu-id="c6a87-222">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-222">Example</span></span>
<span data-ttu-id="c6a87-223">Если необходимо разрешать встроенные сущности, но не внешние сущности, задайте для свойства XmlReaderSettings.XmlResolver значение null.</span><span class="sxs-lookup"><span data-stu-id="c6a87-223">If you need to resolve inline entities but do not need to resolve external entities, set the XmlReaderSettings.XmlResolver property to null.</span></span> <span data-ttu-id="c6a87-224">Например:</span><span class="sxs-lookup"><span data-stu-id="c6a87-224">For example:</span></span> 

```C#
XmlReaderSettings settings = new XmlReaderSettings();
settings.ProhibitDtd = false;
settings.MaxCharactersFromEntities = 1000;
settings.XmlResolver = null;
XmlReader reader = XmlReader.Create(stream, settings);
```
<span data-ttu-id="c6a87-225">Обратите внимание, что в MSXML6 параметр ProhibitDTD имеет значение true (отключение обработки DTD) по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-225">Note that in MSXML6, ProhibitDTD is set to true (disabling DTD processing) by default.</span></span> <span data-ttu-id="c6a87-226">Для кода Apple OSX или iOS можно использовать два средства синтаксического анализа XML: NSXMLParser и libXML2.</span><span class="sxs-lookup"><span data-stu-id="c6a87-226">For Apple OSX/iOS code, there are two XML parsers you can use: NSXMLParser and libXML2.</span></span> 

## <span data-ttu-id="c6a87-227"><a id="app-verification"></a>Приложения, использующие драйвер http.sys, выполняют проверку нормализации URL-адресов</span><span class="sxs-lookup"><span data-stu-id="c6a87-227"><a id="app-verification"></a>Applications utilizing http.sys perform URL canonicalization verification</span></span>

| <span data-ttu-id="c6a87-228">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-228">Title</span></span>                   | <span data-ttu-id="c6a87-229">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-229">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-230">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-230">**Component**</span></span>               | <span data-ttu-id="c6a87-231">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-231">Web Application</span></span> | 
| <span data-ttu-id="c6a87-232">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-232">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-233">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-233">Build</span></span> |  
| <span data-ttu-id="c6a87-234">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-234">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-235">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-235">Generic</span></span> |
| <span data-ttu-id="c6a87-236">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-236">**Attributes**</span></span>              | <span data-ttu-id="c6a87-237">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-237">N/A</span></span>  |
| <span data-ttu-id="c6a87-238">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-238">**References**</span></span>              | <span data-ttu-id="c6a87-239">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-239">N/A</span></span>  |
| <span data-ttu-id="c6a87-240">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-240">**Steps**</span></span> | <p><span data-ttu-id="c6a87-241">При работе с любым приложением, использующим драйвер http.sys, следует придерживаться следующих правил:</span><span class="sxs-lookup"><span data-stu-id="c6a87-241">Any application that uses http.sys should follow these guidelines:</span></span></p><ul><li><span data-ttu-id="c6a87-242">Ограничьте длину URL-адреса 16 384 знаками (ASCII или Юникод).</span><span class="sxs-lookup"><span data-stu-id="c6a87-242">Limit the URL length to no more than 16,384 characters (ASCII or Unicode).</span></span> <span data-ttu-id="c6a87-243">В соответствии с параметрами по умолчанию служб IIS 6 это максимальная длина URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c6a87-243">This is the absolute maximum URL length based on the default Internet Information Services (IIS) 6 setting.</span></span> <span data-ttu-id="c6a87-244">По возможности для веб-сайтов следует создавать более короткие URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c6a87-244">Websites should strive for a length shorter than this if possible</span></span></li><li><span data-ttu-id="c6a87-245">Используйте стандартные классы файлового ввода-вывода платформы .NET Framework (например, FileStream), так как таким образом вы сможете воспользоваться правилами нормализации в .NET FX.</span><span class="sxs-lookup"><span data-stu-id="c6a87-245">Use the standard .NET Framework file I/O classes (such as FileStream) as these will take advantage of the canonicalization rules in the .NET FX</span></span></li><li><span data-ttu-id="c6a87-246">Создайте список разрешенных известных имен файлов явным образом.</span><span class="sxs-lookup"><span data-stu-id="c6a87-246">Explicitly build an allow-list of known filenames</span></span></li><li><span data-ttu-id="c6a87-247">Явно отклоните известные типы файлов, для которых не будет выдаваться отклонение UrlScan: EXE, BAT, CMD, COM, HTW, IDA, IDQ, HTR, IDC, SHTM[L], STM, PRINTER, INI, POL, DAT.</span><span class="sxs-lookup"><span data-stu-id="c6a87-247">Explicitly reject known filetypes you will not serve UrlScan rejects: exe, bat, cmd, com, htw, ida, idq, htr, idc, shtm[l], stm, printer, ini, pol, dat files</span></span></li><li><span data-ttu-id="c6a87-248">Реализуйте перехват следующих исключений:</span><span class="sxs-lookup"><span data-stu-id="c6a87-248">Catch the following exceptions:</span></span><ul><li><span data-ttu-id="c6a87-249">System.ArgumentException (для имен устройств);</span><span class="sxs-lookup"><span data-stu-id="c6a87-249">System.ArgumentException (for device names)</span></span></li><li><span data-ttu-id="c6a87-250">System.NotSupportedException (для потоков данных);</span><span class="sxs-lookup"><span data-stu-id="c6a87-250">System.NotSupportedException (for data streams)</span></span></li><li><span data-ttu-id="c6a87-251">System.IO.FileNotFoundException (для недопустимых экранированных имен файлов);</span><span class="sxs-lookup"><span data-stu-id="c6a87-251">System.IO.FileNotFoundException (for invalid escaped filenames)</span></span></li><li><span data-ttu-id="c6a87-252">System.IO.DirectoryNotFoundException (для недопустимых экранированных каталогов).</span><span class="sxs-lookup"><span data-stu-id="c6a87-252">System.IO.DirectoryNotFoundException (for invalid escaped dirs)</span></span></li></ul></li><li><span data-ttu-id="c6a87-253">*Не* вызывайте файловые API ввода-вывода Win32.</span><span class="sxs-lookup"><span data-stu-id="c6a87-253">*Do not* call out to Win32 file I/O APIs.</span></span> <span data-ttu-id="c6a87-254">При получении недопустимого URL-адреса реализуйте корректное возвращение ошибки 400 пользователю и зарегистрируйте фактическую ошибку.</span><span class="sxs-lookup"><span data-stu-id="c6a87-254">On an invalid URL gracefully return a 400 error to the user, and log the real error.</span></span></li></ul>|

## <span data-ttu-id="c6a87-255"><a id="controls-users"></a>Убедитесь, что при приеме файлов от пользователей обеспечиваются соответствующие меры безопасности</span><span class="sxs-lookup"><span data-stu-id="c6a87-255"><a id="controls-users"></a>Ensure appropriate controls are in place when accepting files from users</span></span>

| <span data-ttu-id="c6a87-256">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-256">Title</span></span>                   | <span data-ttu-id="c6a87-257">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-257">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-258">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-258">**Component**</span></span>               | <span data-ttu-id="c6a87-259">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-259">Web Application</span></span> | 
| <span data-ttu-id="c6a87-260">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-260">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-261">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-261">Build</span></span> |  
| <span data-ttu-id="c6a87-262">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-262">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-263">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-263">Generic</span></span> |
| <span data-ttu-id="c6a87-264">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-264">**Attributes**</span></span>              | <span data-ttu-id="c6a87-265">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-265">N/A</span></span>  |
| <span data-ttu-id="c6a87-266">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-266">**References**</span></span>              | <span data-ttu-id="c6a87-267">[Unrestricted File Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload) (Неограниченная передача файлов), [File Signature Table](http://www.garykessler.net/library/file_sigs.html) (Таблица подписей файлов)</span><span class="sxs-lookup"><span data-stu-id="c6a87-267">[Unrestricted File Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload), [File Signature Table](http://www.garykessler.net/library/file_sigs.html)</span></span> |
| <span data-ttu-id="c6a87-268">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-268">**Steps**</span></span> | <p><span data-ttu-id="c6a87-269">Переданные файлы представляют серьезную угрозу для приложений.</span><span class="sxs-lookup"><span data-stu-id="c6a87-269">Uploaded files represent a significant risk to applications.</span></span></p><p><span data-ttu-id="c6a87-270">Первый этап множества атак — это внедрение кода в атакуемую систему.</span><span class="sxs-lookup"><span data-stu-id="c6a87-270">The first step in many attacks is to get some code to the system to be attacked.</span></span> <span data-ttu-id="c6a87-271">Затем механизму атаки достаточно найти способ выполнения кода.</span><span class="sxs-lookup"><span data-stu-id="c6a87-271">Then the attack only needs to find a way to get the code executed.</span></span> <span data-ttu-id="c6a87-272">За счет передачи файла злоумышленник выполняет первый этап.</span><span class="sxs-lookup"><span data-stu-id="c6a87-272">Using a file upload helps the attacker accomplish the first step.</span></span> <span data-ttu-id="c6a87-273">Неограниченная передача файлов приводит к самым разным последствиям: перехват системы, перегруженность файловой системы или базы данных, перенаправление атак на внутренние системы и просто искажение внешнего вида.</span><span class="sxs-lookup"><span data-stu-id="c6a87-273">The consequences of unrestricted file upload can vary, including complete system takeover, an overloaded file system or database, forwarding attacks to back-end systems, and simple defacement.</span></span></p><p><span data-ttu-id="c6a87-274">Последствия зависят от того, что приложение делает с переданным файлом, и в особенности от того, где сохранился этот файл.</span><span class="sxs-lookup"><span data-stu-id="c6a87-274">It depends on what the application does with the uploaded file and especially where it is stored.</span></span> <span data-ttu-id="c6a87-275">На стороне сервера не предусмотрена проверка передаваемых файлов.</span><span class="sxs-lookup"><span data-stu-id="c6a87-275">Server side validation of file uploads is missing.</span></span> <span data-ttu-id="c6a87-276">Для отправки файлов нужно внедрять следующие меры безопасности:</span><span class="sxs-lookup"><span data-stu-id="c6a87-276">Following security controls should be implemented for File Upload functionality:</span></span></p><ul><li><span data-ttu-id="c6a87-277">Проверка расширений файлов (должны приниматься только определенные допустимые типы файлов).</span><span class="sxs-lookup"><span data-stu-id="c6a87-277">File Extension check (only a valid set of allowed file type should be accepted)</span></span></li><li><span data-ttu-id="c6a87-278">Ограничение максимального размера файлов.</span><span class="sxs-lookup"><span data-stu-id="c6a87-278">Maximum file size limit</span></span></li><li><span data-ttu-id="c6a87-279">Запрет на передачу файлов в webroot. В качестве расположения нужно использовать каталог на несистемном диске.</span><span class="sxs-lookup"><span data-stu-id="c6a87-279">File should not be uploaded to webroot; the location should be a directory on non-system drive</span></span></li><li><span data-ttu-id="c6a87-280">Соблюдение условий соглашения об именовании. Передаваемому файлу назначается случайное имя, чтобы предотвратить перезапись файла.</span><span class="sxs-lookup"><span data-stu-id="c6a87-280">Naming convention should be followed, such that the uploaded file name have some randomness, so as to prevent file overwrites</span></span></li><li><span data-ttu-id="c6a87-281">Сканирование файлов с помощью антивирусных программ перед записью на диск.</span><span class="sxs-lookup"><span data-stu-id="c6a87-281">Files should be scanned for anti-virus before writing to the disk</span></span></li><li><span data-ttu-id="c6a87-282">Проверка имени файла и других метаданных (например, путь к файлу) на наличие вредоносных знаков.</span><span class="sxs-lookup"><span data-stu-id="c6a87-282">Ensure that the file name and any other metadata (e.g., file path) are validated for malicious characters</span></span></li><li><span data-ttu-id="c6a87-283">Проверка формата подписи файла, чтобы запретить отправку замаскированных файлов (например, передача EXE-файла с заменой расширения на TXT).</span><span class="sxs-lookup"><span data-stu-id="c6a87-283">File format signature should be checked, to prevent a user from uploading a masqueraded file (e.g., uploading an exe file by changing extension to txt)</span></span></li></ul>| 

### <a name="example"></a><span data-ttu-id="c6a87-284">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-284">Example</span></span>
<span data-ttu-id="c6a87-285">Подробные сведения о проверке подписи формата файла см. в классе ниже:</span><span class="sxs-lookup"><span data-stu-id="c6a87-285">For the last point regarding file format signature validation, refer to the class below for details:</span></span> 

```C#
        private static Dictionary<string, List<byte[]>> fileSignature = new Dictionary<string, List<byte[]>>
                    {
                    { ".DOC", new List<byte[]> { new byte[] { 0xD0, 0xCF, 0x11, 0xE0, 0xA1, 0xB1, 0x1A, 0xE1 } } },
                    { ".DOCX", new List<byte[]> { new byte[] { 0x50, 0x4B, 0x03, 0x04 } } },
                    { ".PDF", new List<byte[]> { new byte[] { 0x25, 0x50, 0x44, 0x46 } } },
                    { ".ZIP", new List<byte[]> 
                                            {
                                              new byte[] { 0x50, 0x4B, 0x03, 0x04 },
                                              new byte[] { 0x50, 0x4B, 0x4C, 0x49, 0x54, 0x55 },
                                              new byte[] { 0x50, 0x4B, 0x53, 0x70, 0x58 },
                                              new byte[] { 0x50, 0x4B, 0x05, 0x06 },
                                              new byte[] { 0x50, 0x4B, 0x07, 0x08 },
                                              new byte[] { 0x57, 0x69, 0x6E, 0x5A, 0x69, 0x70 }
                                                }
                                            },
                    { ".PNG", new List<byte[]> { new byte[] { 0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A } } },
                    { ".JPG", new List<byte[]>
                                    {
                                              new byte[] { 0xFF, 0xD8, 0xFF, 0xE0 },
                                              new byte[] { 0xFF, 0xD8, 0xFF, 0xE1 },
                                              new byte[] { 0xFF, 0xD8, 0xFF, 0xE8 }
                                    }
                                    },
                    { ".JPEG", new List<byte[]>
                                        { 
                                            new byte[] { 0xFF, 0xD8, 0xFF, 0xE0 },
                                            new byte[] { 0xFF, 0xD8, 0xFF, 0xE2 },
                                            new byte[] { 0xFF, 0xD8, 0xFF, 0xE3 }
                                        }
                                        },
                    { ".XLS", new List<byte[]>
                                            {
                                              new byte[] { 0xD0, 0xCF, 0x11, 0xE0, 0xA1, 0xB1, 0x1A, 0xE1 },
                                              new byte[] { 0x09, 0x08, 0x10, 0x00, 0x00, 0x06, 0x05, 0x00 },
                                              new byte[] { 0xFD, 0xFF, 0xFF, 0xFF }
                                            }
                                            },
                    { ".XLSX", new List<byte[]> { new byte[] { 0x50, 0x4B, 0x03, 0x04 } } },
                    { ".GIF", new List<byte[]> { new byte[] { 0x47, 0x49, 0x46, 0x38 } } }
                };

        public static bool IsValidFileExtension(string fileName, byte[] fileData, byte[] allowedChars)
        {
            if (string.IsNullOrEmpty(fileName) || fileData == null || fileData.Length == 0)
            {
                return false;
            }

            bool flag = false;
            string ext = Path.GetExtension(fileName);
            if (string.IsNullOrEmpty(ext))
            {
                return false;
            }

            ext = ext.ToUpperInvariant();

            if (ext.Equals(".TXT") || ext.Equals(".CSV") || ext.Equals(".PRN"))
            {
                foreach (byte b in fileData)
                {
                    if (b > 0x7F)
                    {
                        if (allowedChars != null)
                        {
                            if (!allowedChars.Contains(b))
                            {
                                return false;
                            }
                        }
                        else
                        {
                            return false;
                        }
                    }
                }

                return true;
            }

            if (!fileSignature.ContainsKey(ext))
            {
                return true;
            }

            List<byte[]> sig = fileSignature[ext];
            foreach (byte[] b in sig)
            {
                var curFileSig = new byte[b.Length];
                Array.Copy(fileData, curFileSig, b.Length);
                if (curFileSig.SequenceEqual(b))
                {
                    flag = true;
                    break;
                }
            }

            return flag;
        }
```

## <span data-ttu-id="c6a87-286"><a id="typesafe"></a>Убедитесь, что в веб-приложении для доступа к данным используются параметры типобезопасности</span><span class="sxs-lookup"><span data-stu-id="c6a87-286"><a id="typesafe"></a>Ensure that type-safe parameters are used in Web Application for data access</span></span>

| <span data-ttu-id="c6a87-287">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-287">Title</span></span>                   | <span data-ttu-id="c6a87-288">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-288">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-289">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-289">**Component**</span></span>               | <span data-ttu-id="c6a87-290">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-290">Web Application</span></span> | 
| <span data-ttu-id="c6a87-291">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-291">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-292">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-292">Build</span></span> |  
| <span data-ttu-id="c6a87-293">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-293">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-294">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-294">Generic</span></span> |
| <span data-ttu-id="c6a87-295">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-295">**Attributes**</span></span>              | <span data-ttu-id="c6a87-296">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-296">N/A</span></span>  |
| <span data-ttu-id="c6a87-297">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-297">**References**</span></span>              | <span data-ttu-id="c6a87-298">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-298">N/A</span></span>  |
| <span data-ttu-id="c6a87-299">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-299">**Steps**</span></span> | <p><span data-ttu-id="c6a87-300">При использовании коллекции параметров SQL рассматривает входные данные как литеральное значение, а не как исполняемый код.</span><span class="sxs-lookup"><span data-stu-id="c6a87-300">If you use the Parameters collection, SQL treats the input is as a literal value rather then as executable code.</span></span> <span data-ttu-id="c6a87-301">Используя коллекцию параметров, можно принудительно ограничить тип и длину входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-301">The Parameters collection can be used to enforce type and length constraints on input data.</span></span> <span data-ttu-id="c6a87-302">Значения вне диапазона вызывают исключение.</span><span class="sxs-lookup"><span data-stu-id="c6a87-302">Values outside of the range trigger an exception.</span></span> <span data-ttu-id="c6a87-303">Если параметры типобезопасности SQL не используются, злоумышленники могут выполнить атаку путем внедрения кода в нефильтрованные входные данные.</span><span class="sxs-lookup"><span data-stu-id="c6a87-303">If type-safe SQL parameters are not used, attackers might be able to execute injection attacks that are embedded in the unfiltered input.</span></span></p><p><span data-ttu-id="c6a87-304">Используйте параметры типобезопасности при создании SQL-запросов, чтобы предотвратить возможные атаки путем внедрения кода SQL в нефильтрованные входные данные.</span><span class="sxs-lookup"><span data-stu-id="c6a87-304">Use type safe parameters when constructing SQL queries to avoid possible SQL injection attacks that can occur with unfiltered input.</span></span> <span data-ttu-id="c6a87-305">Эти параметры можно использовать с хранимыми процедурами и динамическими инструкциями SQL.</span><span class="sxs-lookup"><span data-stu-id="c6a87-305">You can use type safe parameters with stored procedures and with dynamic SQL statements.</span></span> <span data-ttu-id="c6a87-306">В базе данных параметры обрабатываются как литеральные значения, а не как исполняемый код.</span><span class="sxs-lookup"><span data-stu-id="c6a87-306">Parameters are treated as literal values by the database and not as executable code.</span></span> <span data-ttu-id="c6a87-307">Кроме того, проверяется тип и длина параметров.</span><span class="sxs-lookup"><span data-stu-id="c6a87-307">Parameters are also checked for type and length.</span></span></p>|

### <a name="example"></a><span data-ttu-id="c6a87-308">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-308">Example</span></span> 
<span data-ttu-id="c6a87-309">В следующем коде показано, как использовать параметры типобезопасности с SqlParameterCollection при вызове хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="c6a87-309">The following code shows how to use type safe parameters with the SqlParameterCollection when calling a stored procedure.</span></span> 

```C#
using System.Data;
using System.Data.SqlClient;

using (SqlConnection connection = new SqlConnection(connectionString))
{ 
DataSet userDataset = new DataSet(); 
SqlDataAdapter myCommand = new SqlDataAdapter(LoginStoredProcedure", connection); 
myCommand.SelectCommand.CommandType = CommandType.StoredProcedure; 
myCommand.SelectCommand.Parameters.Add("@au_id", SqlDbType.VarChar, 11); 
myCommand.SelectCommand.Parameters["@au_id"].Value = SSN.Text; 
myCommand.Fill(userDataset);
}  
```
<span data-ttu-id="c6a87-310">В предыдущем примере кода длина входного значения не должна превышать 11 знаков.</span><span class="sxs-lookup"><span data-stu-id="c6a87-310">In the preceding code example, the input value cannot be longer than 11 characters.</span></span> <span data-ttu-id="c6a87-311">Если тип и длина данных не соответствуют типу или длине, определенным в параметре, класс SqlParameter выдает исключение.</span><span class="sxs-lookup"><span data-stu-id="c6a87-311">If the data does not conform to the type or length defined by the parameter, the SqlParameter class throws an exception.</span></span> 

## <span data-ttu-id="c6a87-312"><a id="binding-mvc"></a>Используйте отдельные классы привязки моделей или списки привязки фильтров для устранения уязвимости массового назначения MVC</span><span class="sxs-lookup"><span data-stu-id="c6a87-312"><a id="binding-mvc"></a>Use separate model binding classes or binding filter lists to prevent MVC mass assignment vulnerability</span></span>

| <span data-ttu-id="c6a87-313">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-313">Title</span></span>                   | <span data-ttu-id="c6a87-314">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-314">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-315">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-315">**Component**</span></span>               | <span data-ttu-id="c6a87-316">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-316">Web Application</span></span> | 
| <span data-ttu-id="c6a87-317">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-317">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-318">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-318">Build</span></span> |  
| <span data-ttu-id="c6a87-319">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-319">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-320">MVC 5, MVC 6</span><span class="sxs-lookup"><span data-stu-id="c6a87-320">MVC5, MVC6</span></span> |
| <span data-ttu-id="c6a87-321">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-321">**Attributes**</span></span>              | <span data-ttu-id="c6a87-322">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-322">N/A</span></span>  |
| <span data-ttu-id="c6a87-323">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-323">**References**</span></span>              | <span data-ttu-id="c6a87-324">[Класс MetadataTypeAttribute](http://msdn.microsoft.com/library/system.componentmodel.dataannotations.metadatatypeattribute), [Public Key Security Vulnerability And Mitigation](https://github.com/blog/1068-public-key-security-vulnerability-and-mitigation) (Уязвимость системы безопасности в виде открытого ключа и способы ее устранения), [Complete Guide to Mass Assignment in ASP.NET MVC](http://odetocode.com/Blogs/scott/archive/2012/03/11/complete-guide-to-mass-assignment-in-asp-net-mvc.aspx) (Полное руководство по массовому назначению в ASP.NET MVC), [Getting Started with EF using MVC](http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application#overpost) (Начало работы с EF с использованием MVC)</span><span class="sxs-lookup"><span data-stu-id="c6a87-324">[Metadata Attributes](http://msdn.microsoft.com/library/system.componentmodel.dataannotations.metadatatypeattribute), [Public Key Security Vulnerability And Mitigation](https://github.com/blog/1068-public-key-security-vulnerability-and-mitigation), [Complete Guide to Mass Assignment in ASP.NET MVC](http://odetocode.com/Blogs/scott/archive/2012/03/11/complete-guide-to-mass-assignment-in-asp-net-mvc.aspx), [Getting Started with EF using MVC](http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application#overpost)</span></span> |
| <span data-ttu-id="c6a87-325">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-325">**Steps**</span></span> | <ul><li><span data-ttu-id="c6a87-326">**Когда следует искать уязвимости типа overposting?** Уязвимости типа overposting могут появляться на любом этапе привязки классов модели из входных данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-326">**When should I look for over-posting vulnerabilities? -** Over-posting vulnerabilities can occur any place you bind model classes from user input.</span></span> <span data-ttu-id="c6a87-327">Платформы, такие как MVC, могут представлять данные пользователя в пользовательских классах .NET, включая Plain Old CLR Object (POCO).</span><span class="sxs-lookup"><span data-stu-id="c6a87-327">Frameworks like MVC can represent user data in custom .NET classes, including Plain Old CLR Objects (POCOs).</span></span> <span data-ttu-id="c6a87-328">MVC автоматически заполняет эти классы модели данными из запроса, предоставляя удобный способ обработки входных данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-328">MVC automatically populates these model classes with data from the request, providing a convenient representation for dealing with user input.</span></span> <span data-ttu-id="c6a87-329">Если эти классы содержат свойства, которые не должны устанавливать пользователи, приложение может быть уязвимо к атакам типа overposting, при которых пользователи могут управлять данными приложения, которыми они не должны управлять.</span><span class="sxs-lookup"><span data-stu-id="c6a87-329">When these classes include properties that should not be set by the user, the application can be vulnerable to over-posting attacks, which allow user control of data that the application never intended.</span></span> <span data-ttu-id="c6a87-330">Как и привязка моделей MVC, технологии доступа к базе данных, такие как реляционные модули сопоставления, например Entity Framework, часто также поддерживают использование объектов POCO для представления данных базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-330">Like MVC model binding, database access technologies such as object/relational mappers like Entity Framework often also support using POCO objects to represent database data.</span></span> <span data-ttu-id="c6a87-331">Эти классы модели данных обеспечивают удобство при работе с данными базы данных, как и MVC при работе с входными данными пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-331">These data model classes provide the same convenience in dealing with database data as MVC does in dealing with user input.</span></span> <span data-ttu-id="c6a87-332">Так как MVC и база данных поддерживают аналогичные модели, например объекты POCO, достаточно просто повторно использовать те же классы и там, и там.</span><span class="sxs-lookup"><span data-stu-id="c6a87-332">Because both MVC and the database support similar models, like POCO objects, it seems easy to reuse the same classes for both purposes.</span></span> <span data-ttu-id="c6a87-333">Однако при таком подходе не удается сохранить разделение областей ответственности. Именно в этом общем случае непредусмотренные свойства используются для привязки модели, что приводит к возникновению атак типа overposting.</span><span class="sxs-lookup"><span data-stu-id="c6a87-333">This practice fails to preserve separation of concerns, and it is one common area where unintended properties are exposed to model binding, enabling over-posting attacks.</span></span></li><li><span data-ttu-id="c6a87-334">**Почему не следует использовать нефильтрованные классы модели базы данных в качестве параметров в действиях MVC?** Привязка модели MVC предусматривает привязку всех элементов класса.</span><span class="sxs-lookup"><span data-stu-id="c6a87-334">**Why shouldn't I use my unfiltered database model classes as parameters to my MVC actions? -** Because MVC model binding will bind anything in that class.</span></span> <span data-ttu-id="c6a87-335">Даже если данные не отображаются, злоумышленник может отправить HTTP-запрос с этими данными, а MVC привяжет их, так как в действии указано, что класс базы данных должен приниматься в качестве входных данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-335">Even if the data does not appear in your view, a malicious user can send an HTTP request with this data included, and MVC will gladly bind it because your action says that database class is the shape of data it should accept for user input.</span></span></li><li><span data-ttu-id="c6a87-336">**Почему следует обращать внимание на тип, используемый для привязки модели?** При привязке слишком общих моделей ASP.NET MVC приложение подвергается риску атаки типа overposting.</span><span class="sxs-lookup"><span data-stu-id="c6a87-336">**Why should I care about the shape used for model binding? -** Using ASP.NET MVC model binding with overly broad models exposes an application to over-posting attacks.</span></span> <span data-ttu-id="c6a87-337">В ходе такой атаки злоумышленник может изменить данные приложения так, чтобы они расходились с указанными разработчиком, например переопределить цену на товар или привилегии безопасности для учетной записи.</span><span class="sxs-lookup"><span data-stu-id="c6a87-337">Over-posting could enable attackers to change application data beyond what the developer intended, such as overriding the price for an item or the security privileges for an account.</span></span> <span data-ttu-id="c6a87-338">Приложения должны использовать модели привязки для конкретных действий (или для списков конкретных допустимых фильтров свойств), чтобы явно определить, какие ненадежные действия ввода следует разрешать через привязку модели.</span><span class="sxs-lookup"><span data-stu-id="c6a87-338">Applications should use action-specific binding models (or specific allowed property filter lists) to provide an explicit contract for what untrusted input to allow via model binding.</span></span></li><li><span data-ttu-id="c6a87-339">**Дублируется ли код при наличии отдельных моделей привязки?** Нет. Дело касается разделения областей ответственности.</span><span class="sxs-lookup"><span data-stu-id="c6a87-339">**Is having separate binding models just duplicating code? -** No, it is a matter of separation of concerns.</span></span> <span data-ttu-id="c6a87-340">При повторном использовании моделей баз данных в методах действий вы указываете, что пользователь может задать любое свойство (или подсвойство) в классе в HTTP-запросе.</span><span class="sxs-lookup"><span data-stu-id="c6a87-340">If you reuse database models in action methods, you are saying any property (or sub-property) in that class can be set by the user in an HTTP request.</span></span> <span data-ttu-id="c6a87-341">Если вам нужно в MVC совсем не это, создайте список фильтров или отдельный тип класса, чтобы сообщить MVC, какие данные могут поступать при вводе пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-341">If that is not what you want MVC to do, you need a filter list or a separate class shape to show MVC what data can come from user input instead.</span></span></li><li><span data-ttu-id="c6a87-342">**Нужно ли копировать все атрибуты аннотации данных, если для входных данных пользователя заданы отдельные модели привязки?** Не обязательно.</span><span class="sxs-lookup"><span data-stu-id="c6a87-342">**If I have separate binding models for user input, do I have to duplicate all my data annotation attributes? -** Not necessarily.</span></span> <span data-ttu-id="c6a87-343">MetadataTypeAttribute можно использовать в классе модели базы данных для связывания метаданных в классе привязки модели.</span><span class="sxs-lookup"><span data-stu-id="c6a87-343">You can use MetadataTypeAttribute on the database model class to link to the metadata on a model binding class.</span></span> <span data-ttu-id="c6a87-344">При этом учтите, что тип, на который ссылается MetadataTypeAttribute, должен быть подмножеством ссылающегося типа (в нем может быть меньше свойств, но не больше).</span><span class="sxs-lookup"><span data-stu-id="c6a87-344">Just note that the type referenced by the MetadataTypeAttribute must be a subset of the referencing type (it can have fewer properties, but not more).</span></span></li><li><span data-ttu-id="c6a87-345">**Перемещать данные между моделями входных данных пользователя и моделями базы данных утомительно. Можно ли просто скопировать все свойства с использованием отражения?** Да.</span><span class="sxs-lookup"><span data-stu-id="c6a87-345">**Moving data back and forth between user input models and database models is tedious. Can I just copy over all properties using reflection? -** Yes.</span></span> <span data-ttu-id="c6a87-346">В моделях привязки содержатся только те свойства, которые определены как безопасные для ввода пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-346">The only properties that appear in the binding models are the ones you have determined to be safe for user input.</span></span> <span data-ttu-id="c6a87-347">С точки зрения безопасности можно копировать все общие свойства двух моделей путем отражения.</span><span class="sxs-lookup"><span data-stu-id="c6a87-347">There is no security reason that prevents using reflection to copy over all properties that exist in common between these two models.</span></span></li><li><span data-ttu-id="c6a87-348">**Можно ли использовать свойство [Bind(Exclude ="â€¦")] вместо того, чтобы создавать отдельные модели привязки?** Мы не рекомендуем использовать такой подход.</span><span class="sxs-lookup"><span data-stu-id="c6a87-348">**What about [Bind(Exclude ="â€¦")]. Can I use that instead of having separate binding models? -** This approach is not recommended.</span></span> <span data-ttu-id="c6a87-349">Если использовать свойство [Bind(Exclude ="â€¦")], любое новое свойство можно будет привязать по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-349">Using [Bind(Exclude ="â€¦")] means that any new property is bindable by default.</span></span> <span data-ttu-id="c6a87-350">При добавлении нового свойства обеспечение защиты должно быть дополнительным этапом. Не нужно обеспечивать безопасность всей структуры по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-350">When a new property is added, there is an extra step to remember to keep things secure, rather than having the design be secure by default.</span></span> <span data-ttu-id="c6a87-351">В зависимости от разработчика проверка этого списка при каждом добавлении свойства может быть рискованной.</span><span class="sxs-lookup"><span data-stu-id="c6a87-351">Depending on the developer checking this list every time a property is added is risky.</span></span></li><li><span data-ttu-id="c6a87-352">**Можно ли использовать атрибут [Bind(Include ="â€¦")] в операциях изменения?** Нет.</span><span class="sxs-lookup"><span data-stu-id="c6a87-352">**Is [Bind(Include ="â€¦")] useful for Edit operations? -** No.</span></span> <span data-ttu-id="c6a87-353">Атрибут [Bind(Include ="â€¦")] поддерживает только операции вставки (добавление новых данных).</span><span class="sxs-lookup"><span data-stu-id="c6a87-353">[Bind(Include ="â€¦")] is only suitable for INSERT-style operations (adding new data).</span></span> <span data-ttu-id="c6a87-354">В операциях обновления (пересмотр имеющихся данных) используйте другой подход, например создание отдельных моделей привязки или передача явного списка допустимых свойств в UpdateModel или TryUpdateModel.</span><span class="sxs-lookup"><span data-stu-id="c6a87-354">For UPDATE-style operations (revising existing data), use another approach, like having separate binding models or passing an explicit list of allowed properties to UpdateModel or TryUpdateModel.</span></span> <span data-ttu-id="c6a87-355">При добавлении атрибута [Bind(Include ="â€¦")] в операцию изменения MVC создаст экземпляр объекта и установит значения только для перечисленных свойств. Во всех остальных свойствах сохранятся значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-355">Adding a [Bind(Include ="â€¦")] attribute on an Edit operation means that MVC will create an object instance and set only the listed properties, leaving all others at their default values.</span></span> <span data-ttu-id="c6a87-356">При сохранении данных имеющаяся сущность будет полностью заменена, а все пропущенные свойства будут сброшены к значениям по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-356">When the data is persisted, it will entirely replace the existing entity, resetting the values for any omitted properties to their defaults.</span></span> <span data-ttu-id="c6a87-357">Например, если в атрибуте [Bind(Include ="â€¦")] в операции изменения пропущено свойство IsAdmin, для любого пользователя, имя которого было изменено с помощью этого действия, значение этого свойства будет сброшено к false (все измененные пользователи лишатся прав администратора).</span><span class="sxs-lookup"><span data-stu-id="c6a87-357">For example, if IsAdmin was omitted from a [Bind(Include ="â€¦")] attribute on an Edit operation, any user whose name was edited via this action would be reset to IsAdmin = false (any edited user would lose administrator status).</span></span> <span data-ttu-id="c6a87-358">Если нужно запретить обновление определенных свойств, используйте один из перечисленных выше методов.</span><span class="sxs-lookup"><span data-stu-id="c6a87-358">If you want to prevent updates to certain properties, use one of the other approaches above.</span></span> <span data-ttu-id="c6a87-359">Обратите внимание, что некоторые версии средств MVC создают классы контроллера с атрибутом [Bind(Include ="â€¦")] в действиях изменения. При этом подразумевается, что удалив свойство из этого списка, вы сократите риск атак типа overposting.</span><span class="sxs-lookup"><span data-stu-id="c6a87-359">Note that some versions of MVC tooling generate controller classes with [Bind(Include ="â€¦")] on Edit actions and imply that removing a property from that list will prevent over-posting attacks.</span></span> <span data-ttu-id="c6a87-360">Тем не менее, как описано выше, этот подход не действует надлежащим образом. При его использовании все данные в пропущенных свойствах будут сброшены к значениям по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-360">However, as described above, that approach does not work as intended and instead will reset any data in the omitted properties to their default values.</span></span></li><li><span data-ttu-id="c6a87-361">**Есть ли какие-либо особенности при использовании атрибута [Bind(Include ="â€¦")] вместо отдельных моделей привязки в операциях создания?** Да.</span><span class="sxs-lookup"><span data-stu-id="c6a87-361">**For Create operations, are there any caveats using [Bind(Include ="â€¦")] rather than separate binding models? -** Yes.</span></span> <span data-ttu-id="c6a87-362">Во-первых, этот подход не действует в операциях изменения. Чтобы устранить все уязвимости типа overposting, следует применять два отдельных подхода.</span><span class="sxs-lookup"><span data-stu-id="c6a87-362">First this approach does not work for Edit scenarios, requiring maintaining two separate approaches for mitigating all over-posting vulnerabilities.</span></span> <span data-ttu-id="c6a87-363">Во-вторых, при использовании отдельных моделей привязки принудительно применяется разделение областей ответственности между типом, используемым для входных данных пользователя, и типом, используемым для хранения, чего не обеспечивает атрибут [Bind(Include ="â€¦")].</span><span class="sxs-lookup"><span data-stu-id="c6a87-363">Second, separate binding models enforce separation of concerns between the shape used for user input and the shape used for persistence, something [Bind(Include ="â€¦")] does not do.</span></span> <span data-ttu-id="c6a87-364">В-третьих, обратите внимание, что атрибут [Bind(Include ="â€¦")] может обрабатывать только свойства верхнего уровня. В нем нельзя использовать части вложенных свойств (например, Details.Name).</span><span class="sxs-lookup"><span data-stu-id="c6a87-364">Third, note that [Bind(Include ="â€¦")] can only handle top-level properties; you cannot allow only portions of sub-properties (such as "Details.Name") in the attribute.</span></span> <span data-ttu-id="c6a87-365">И наконец (возможно, что самое важное), используя [Bind(Include ="â€¦")], нужно выполнять дополнительное действие, о котором нужно помнить постоянно, когда класс используется для привязки модели.</span><span class="sxs-lookup"><span data-stu-id="c6a87-365">Finally, and perhaps most importantly, using [Bind(Include ="â€¦")] adds an extra step that must be remembered any time the class is used for model binding.</span></span> <span data-ttu-id="c6a87-366">Если новый метод действия привязывается к классу данных напрямую и не включает атрибут [Bind(Include ="â€¦")], он подвергается риску атаки типа overposting. Поэтому подход с использованием атрибута [Bind(Include ="â€¦")] менее безопасен по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-366">If a new action method binds to the data class directly and forgets to include a [Bind(Include ="â€¦")] attribute, it can be vulnerable to over-posting attacks, so the [Bind(Include ="â€¦")] approach is somewhat less secure by default.</span></span> <span data-ttu-id="c6a87-367">Указывайте атрибут [Bind(Include ="â€¦")] каждый раз, когда классы данных используются как параметры метода действия.</span><span class="sxs-lookup"><span data-stu-id="c6a87-367">If you use [Bind(Include ="â€¦")], take care always to remember to specify it every time your data classes appear as action method parameters.</span></span></li><li><span data-ttu-id="c6a87-368">**Можно ли добавить атрибут [Bind(Include ="â€¦")] в сам класс модели в операциях создания? Ведь при этом не нужно помнить о том, что этот атрибут следует добавлять во все методы действия?** Этот подход действует не всегда.</span><span class="sxs-lookup"><span data-stu-id="c6a87-368">**For Create operations, what about putting the [Bind(Include ="â€¦")] attribute on the model class itself? Does not this approach avoid the need to remember putting the attribute on every action method? -** This approach works in some cases.</span></span> <span data-ttu-id="c6a87-369">Используя [Bind(Include ="â€¦")] в самом типе модели (а не в параметрах действия с использованием этого класса), вам действительно не нужно помнить о том, что этот атрибут нужно добавлять в каждый метод действия.</span><span class="sxs-lookup"><span data-stu-id="c6a87-369">Using [Bind(Include ="â€¦")] on the model type itself (rather than on action parameters using this class), does avoid the need to remember to include the [Bind(Include ="â€¦")] attribute on every action method.</span></span> <span data-ttu-id="c6a87-370">Если использовать атрибут непосредственно в классе, создается отдельная контактная зона этого класса для привязки модели.</span><span class="sxs-lookup"><span data-stu-id="c6a87-370">Using the attribute directly on the class effectively creates a separate surface area of this class for model binding purposes.</span></span> <span data-ttu-id="c6a87-371">Однако такой подход позволяет использовать привязку модели одного типа на класс модели.</span><span class="sxs-lookup"><span data-stu-id="c6a87-371">However, this approach only allows for one model binding shape per model class.</span></span> <span data-ttu-id="c6a87-372">Если одному методу действия нужно разрешать привязку модели определенной области (например, действие только для администратора, обновляющее роли пользователей), а другим действиям нужно запрещать ее, этот подход будет безрезультатным.</span><span class="sxs-lookup"><span data-stu-id="c6a87-372">If one action method needs to allow model binding of a field (for example, an administrator-only action that updates user roles) and other actions need to prevent model binding of this field, this approach will not work.</span></span> <span data-ttu-id="c6a87-373">Каждый класс может иметь привязку модели только одного типа. Если для различных действий требуются привязки моделей разных типов, они должны представлять эти отдельные типы с помощью отдельных классов привязки модели или отдельных атрибутов [Bind(Include ="â€¦")] в методах действий.</span><span class="sxs-lookup"><span data-stu-id="c6a87-373">Each class can only have one model binding shape; if different actions need different model binding shapes, they need to represent these separate shapes using either separate model binding classes or separate [Bind(Include ="â€¦")] attributes on the action methods.</span></span></li><li><span data-ttu-id="c6a87-374">**Что такое модели привязки? То же самое, что и модели представлений?** Это два связанных понятия.</span><span class="sxs-lookup"><span data-stu-id="c6a87-374">**What are binding models? Are they the same thing as view models? -** These are two related concepts.</span></span> <span data-ttu-id="c6a87-375">Термин "модель привязки" относится к классу модели, используемому в действии, который представляет собой список параметров (тип, передаваемый из привязки модели MVC в метод действия).</span><span class="sxs-lookup"><span data-stu-id="c6a87-375">The term binding model refers to a model class used in an action is parameter list (the shape passed from MVC model binding to the action method).</span></span> <span data-ttu-id="c6a87-376">Термин "модель представления" относится к классу модели, передаваемому из метода действия в представление.</span><span class="sxs-lookup"><span data-stu-id="c6a87-376">The term view model refers to a model class passed from an action method to a view.</span></span> <span data-ttu-id="c6a87-377">Использование модели для конкретного представления — это распространенный способ передачи данных из метода действия в представление.</span><span class="sxs-lookup"><span data-stu-id="c6a87-377">Using a view-specific model is a common approach for passing data from an action method to a view.</span></span> <span data-ttu-id="c6a87-378">Часто эта фигура также подходит для привязки модели и модели представления термин может использоваться для ссылки на той же модели, используемые в обоих местах.</span><span class="sxs-lookup"><span data-stu-id="c6a87-378">Often, this shape is also suitable for model binding, and the term view model can be used to refer the same model used in both places.</span></span> <span data-ttu-id="c6a87-379">Если точнее, здесь рассматриваются именно модели привязки, в которых внимание уделяется типу, который передается в действие. Это важно для массового назначения.</span><span class="sxs-lookup"><span data-stu-id="c6a87-379">To be precise, this procedure talks specifically about binding models, focusing on the shape passed to the action, which is what matters for mass assignment purposes.</span></span></li></ul>| 

## <span data-ttu-id="c6a87-380"><a id="rendering"></a>Кодируйте ненадежные выходные веб-данные перед обработкой</span><span class="sxs-lookup"><span data-stu-id="c6a87-380"><a id="rendering"></a>Encode untrusted web output prior to rendering</span></span>

| <span data-ttu-id="c6a87-381">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-381">Title</span></span>                   | <span data-ttu-id="c6a87-382">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-382">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-383">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-383">**Component**</span></span>               | <span data-ttu-id="c6a87-384">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-384">Web Application</span></span> | 
| <span data-ttu-id="c6a87-385">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-385">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-386">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-386">Build</span></span> |  
| <span data-ttu-id="c6a87-387">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-387">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-388">Универсальные, веб-формы, MVC 5, MVC 6</span><span class="sxs-lookup"><span data-stu-id="c6a87-388">Generic, Web Forms, MVC5, MVC6</span></span> |
| <span data-ttu-id="c6a87-389">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-389">**Attributes**</span></span>              | <span data-ttu-id="c6a87-390">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-390">N/A</span></span>  |
| <span data-ttu-id="c6a87-391">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-391">**References**</span></span>              | <span data-ttu-id="c6a87-392">[How to prevent Cross-site scripting in ASP.NET](http://msdn.microsoft.com/library/ms998274.aspx) (Защита от использования межсайтовых сценариев в ASP.NET), [Cross-site Scripting](http://cwe.mitre.org/data/definitions/79.html) (Использование межсайтовых сценариев), [XSS (Cross Site Scripting) Prevention Cheat Sheet](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet) (Памятка по защите от использования межсайтовых сценариев (XSS))</span><span class="sxs-lookup"><span data-stu-id="c6a87-392">[How to prevent Cross-site scripting in ASP.NET](http://msdn.microsoft.com/library/ms998274.aspx), [Cross-site Scripting](http://cwe.mitre.org/data/definitions/79.html), [XSS (Cross Site Scripting) Prevention Cheat Sheet](https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet)</span></span> |
| <span data-ttu-id="c6a87-393">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-393">**Steps**</span></span> | <span data-ttu-id="c6a87-394">Использование межсайтовых сценариев (обычно сокращается как XSS) — это атака, направленная на веб-службы либо приложение или компонент, использующие входные данные из Интернета.</span><span class="sxs-lookup"><span data-stu-id="c6a87-394">Cross-site scripting (commonly abbreviated as XSS) is an attack vector for online services or any application/component that consumes input from the web.</span></span> <span data-ttu-id="c6a87-395">Используя межсайтовые сценарии, злоумышленник может выполнить сценарий в уязвимом веб-приложении на компьютере другого пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-395">XSS vulnerabilities may allow an attacker to execute script on another user's machine through a vulnerable web application.</span></span> <span data-ttu-id="c6a87-396">Вредоносные сценарии можно использовать для хищения файлов cookie и выполнения мошеннических действий на компьютере атакуемого с помощью JavaScript.</span><span class="sxs-lookup"><span data-stu-id="c6a87-396">Malicious scripts can be used to steal cookies and otherwise tamper with a victim's machine through JavaScript.</span></span> <span data-ttu-id="c6a87-397">Чтобы обеспечить защиту от использования межсайтовых сценариев, следует проверять входные данные пользователя, их формат, а также кодировать их перед обработкой на веб-странице.</span><span class="sxs-lookup"><span data-stu-id="c6a87-397">XSS is prevented by validating user input, ensuring it is well formed and encoding before it is rendered in a web page.</span></span> <span data-ttu-id="c6a87-398">Для проверки входных данных и кодирования выходных данных можно использовать библиотеку веб-защиты.</span><span class="sxs-lookup"><span data-stu-id="c6a87-398">Input validation and output encoding can be done by using Web Protection Library.</span></span> <span data-ttu-id="c6a87-399">Используйте один или несколько подходящих методов кодирования из библиотеки веб-защиты (защита от использования межсайтовых сценариев) для управляемого кода (C\#, VB.net и т. д.) в зависимости от контекста, в котором объявляются входные данные пользователя:</span><span class="sxs-lookup"><span data-stu-id="c6a87-399">For Managed code (C\#, VB.net, etc.), use one or more appropriate encoding methods from the Web Protection (Anti-XSS) Library, depending on the context where the user input gets manifested:</span></span>| 

### <a name="example"></a><span data-ttu-id="c6a87-400">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-400">Example</span></span>

```C#
* Encoder.HtmlEncode 
* Encoder.HtmlAttributeEncode 
* Encoder.JavaScriptEncode 
* Encoder.UrlEncode
* Encoder.VisualBasicScriptEncode 
* Encoder.XmlEncode 
* Encoder.XmlAttributeEncode 
* Encoder.CssEncode 
* Encoder.LdapEncode 
```

## <span data-ttu-id="c6a87-401"><a id="typemodel"></a>Проверяйте и фильтруйте входные данные по всем свойствам модели строкового типа</span><span class="sxs-lookup"><span data-stu-id="c6a87-401"><a id="typemodel"></a>Perform input validation and filtering on all string type Model properties</span></span>

| <span data-ttu-id="c6a87-402">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-402">Title</span></span>                   | <span data-ttu-id="c6a87-403">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-403">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-404">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-404">**Component**</span></span>               | <span data-ttu-id="c6a87-405">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-405">Web Application</span></span> | 
| <span data-ttu-id="c6a87-406">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-406">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-407">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-407">Build</span></span> |  
| <span data-ttu-id="c6a87-408">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-408">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-409">Универсальные, MVC 5, MVC 6</span><span class="sxs-lookup"><span data-stu-id="c6a87-409">Generic, MVC5, MVC6</span></span> |
| <span data-ttu-id="c6a87-410">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-410">**Attributes**</span></span>              | <span data-ttu-id="c6a87-411">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-411">N/A</span></span>  |
| <span data-ttu-id="c6a87-412">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-412">**References**</span></span>              | <span data-ttu-id="c6a87-413">[Adding Validation](http://www.asp.net/mvc/overview/getting-started/introduction/adding-validation) (Добавление проверки), [Validating Model Data in an MVC Application](http://msdn.microsoft.com/library/dd410404(v=vs.90).aspx) (Проверка данных модели в приложении MVC), [Основные принципы ваших приложений ASP.NET MVC](http://msdn.microsoft.com/magazine/dd942822.aspx)</span><span class="sxs-lookup"><span data-stu-id="c6a87-413">[Adding Validation](http://www.asp.net/mvc/overview/getting-started/introduction/adding-validation), [Validating Model Data in an MVC Application](http://msdn.microsoft.com/library/dd410404(v=vs.90).aspx), [Guiding Principles For Your ASP.NET MVC Applications](http://msdn.microsoft.com/magazine/dd942822.aspx)</span></span> |
| <span data-ttu-id="c6a87-414">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-414">**Steps**</span></span> | <p><span data-ttu-id="c6a87-415">Перед использованием в приложении все входные параметры нужно проверять, чтобы убедиться, что приложение защищено от вредоносных входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-415">All the input parameters must be validated before they are used in the application to ensure that the application is safeguarded against malicious user inputs.</span></span> <span data-ttu-id="c6a87-416">Проверьте входные значения, используя регулярные выражения на стороне сервера и стратегию проверки по списку разрешений.</span><span class="sxs-lookup"><span data-stu-id="c6a87-416">Validate the input values using regular expression validations on server side with a whitelist validation strategy.</span></span> <span data-ttu-id="c6a87-417">Если передать в метод непроверенные входные данные или параметры, приложение подвергается риску атаки путем внедрения кода.</span><span class="sxs-lookup"><span data-stu-id="c6a87-417">Unsanitized user inputs / parameters passed to the methods can cause code injection vulnerabilities.</span></span></p><p><span data-ttu-id="c6a87-418">Точки входа для веб-приложений также включают поля форм, строки запросов, файлы cookie, заголовки HTTP и параметры веб-службы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-418">For web applications, entry points can also include form fields, QueryStrings, cookies, HTTP headers, and web service parameters.</span></span></p><p><span data-ttu-id="c6a87-419">После привязки модели необходимо выполнить следующие проверки входных данных:</span><span class="sxs-lookup"><span data-stu-id="c6a87-419">The following input validation checks must be performed upon model binding:</span></span></p><ul><li><span data-ttu-id="c6a87-420">Свойства модели нужно пометить с помощью аннотации RegularExpression, чтобы принимались допустимые знаки, а также применялась максимально допустимая длина.</span><span class="sxs-lookup"><span data-stu-id="c6a87-420">The model properties should be annotated with RegularExpression annotation, for accepting allowed characters and maximum permissible length</span></span></li><li><span data-ttu-id="c6a87-421">Методы контроллера должны выполнить проверку ModelState.</span><span class="sxs-lookup"><span data-stu-id="c6a87-421">The controller methods should perform ModelState validity</span></span></li></ul>|

## <span data-ttu-id="c6a87-422"><a id="richtext"></a>Очищайте поля форм, принимающие все знаки, например редактор форматированного текста</span><span class="sxs-lookup"><span data-stu-id="c6a87-422"><a id="richtext"></a>Sanitization should be applied on form fields that accept all characters, e.g, rich text editor</span></span>

| <span data-ttu-id="c6a87-423">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-423">Title</span></span>                   | <span data-ttu-id="c6a87-424">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-424">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-425">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-425">**Component**</span></span>               | <span data-ttu-id="c6a87-426">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-426">Web Application</span></span> | 
| <span data-ttu-id="c6a87-427">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-427">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-428">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-428">Build</span></span> |  
| <span data-ttu-id="c6a87-429">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-429">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-430">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-430">Generic</span></span> |
| <span data-ttu-id="c6a87-431">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-431">**Attributes**</span></span>              | <span data-ttu-id="c6a87-432">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-432">N/A</span></span>  |
| <span data-ttu-id="c6a87-433">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-433">**References**</span></span>              | <span data-ttu-id="c6a87-434">[Кодирование небезопасных входных данных](https://msdn.microsoft.com/library/ff647397.aspx#paght000003_step3), [HTML Sanitizer](https://github.com/mganss/HtmlSanitizer) (Библиотека HtmlSanitizer)</span><span class="sxs-lookup"><span data-stu-id="c6a87-434">[Encode Unsafe Input](https://msdn.microsoft.com/library/ff647397.aspx#paght000003_step3), [HTML Sanitizer](https://github.com/mganss/HtmlSanitizer)</span></span> |
| <span data-ttu-id="c6a87-435">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-435">**Steps**</span></span> | <p><span data-ttu-id="c6a87-436">Определите все статические теги разметки, которые нужно использовать.</span><span class="sxs-lookup"><span data-stu-id="c6a87-436">Identify all static markup tags that you want to use.</span></span> <span data-ttu-id="c6a87-437">Зачастую при форматировании используются только безопасные элементы HTML, такие как `<b>` (жирный шрифт) и `<i>` (курсив).</span><span class="sxs-lookup"><span data-stu-id="c6a87-437">A common practice is to restrict formatting to safe HTML elements, such as `<b>` (bold) and `<i>` (italic).</span></span></p><p><span data-ttu-id="c6a87-438">Прежде чем записывать данные, закодируйте их в HTML.</span><span class="sxs-lookup"><span data-stu-id="c6a87-438">Before writing the data, HTML-encode it.</span></span> <span data-ttu-id="c6a87-439">Таким образом, любой вредоносный скрипт становится безопасным, так как он обрабатывается как текст, а не как исполняемый код.</span><span class="sxs-lookup"><span data-stu-id="c6a87-439">This makes any malicious script safe by causing it to be handled as text, not as executable code.</span></span></p><ol><li><span data-ttu-id="c6a87-440">Отключите проверку запросов ASP.NET, добавив атрибут ValidateRequest="false" в директиву @ Page.</span><span class="sxs-lookup"><span data-stu-id="c6a87-440">Disable ASP.NET request validation by the adding the ValidateRequest="false" attribute to the @ Page directive</span></span></li><li><span data-ttu-id="c6a87-441">Закодируйте строковые входные данные с помощью метода HtmlEncode.</span><span class="sxs-lookup"><span data-stu-id="c6a87-441">Encode the string input with the HtmlEncode method</span></span></li><li><span data-ttu-id="c6a87-442">Используйте StringBuilder и вызовите его метод Replace, чтобы выборочно удалить кодировку элементов HTML, которые необходимо разрешить.</span><span class="sxs-lookup"><span data-stu-id="c6a87-442">Use a StringBuilder and call its Replace method to selectively remove the encoding on the HTML elements that you want to permit</span></span></li></ol><p><span data-ttu-id="c6a87-443">Страница в ссылках отключает проверку запросов ASP.NET, задав атрибут `ValidateRequest="false"`.</span><span class="sxs-lookup"><span data-stu-id="c6a87-443">The page-in the references disables ASP.NET request validation by setting `ValidateRequest="false"`.</span></span> <span data-ttu-id="c6a87-444">Она кодирует входные данные с помощью HTML и выборочно разрешает использовать элементы `<b>` и `<i>`. Кроме того, для очистки HTML можно использовать библиотеку .NET.</span><span class="sxs-lookup"><span data-stu-id="c6a87-444">It HTML-encodes the input and selectively allows the `<b>` and `<i>` Alternatively, a .NET library for HTML sanitization may also be used.</span></span></p><p><span data-ttu-id="c6a87-445">HtmlSanitizer — это библиотека .NET для очистки фрагментов и документов HTML от конструкций, которые могут привести к атаке с использованием межсайтовых сценариев.</span><span class="sxs-lookup"><span data-stu-id="c6a87-445">HtmlSanitizer is a .NET library for cleaning HTML fragments and documents from constructs that can lead to XSS attacks.</span></span> <span data-ttu-id="c6a87-446">Она использует AngleSharp для анализа и обработки HTML и CSS, а также для управления.</span><span class="sxs-lookup"><span data-stu-id="c6a87-446">It uses AngleSharp to parse, manipulate, and render HTML and CSS.</span></span> <span data-ttu-id="c6a87-447">HtmlSanitizer можно установить в виде пакета NuGet. Входные данные пользователя можно передать через соответствующие методы очистки HTML или CSS на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="c6a87-447">HtmlSanitizer can be installed as a NuGet package, and the user input can be passed through relevant HTML or CSS sanitization methods, as applicable, on the server side.</span></span> <span data-ttu-id="c6a87-448">Обратите внимание, что очистка — это крайняя мера безопасности.</span><span class="sxs-lookup"><span data-stu-id="c6a87-448">Please note that Sanitization as a security control should be considered only as a last option.</span></span></p><p><span data-ttu-id="c6a87-449">Самые эффективные меры безопасности — это проверка входных данных и кодирование выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-449">Input validation and Output Encoding are considered better security controls.</span></span></p> |

## <span data-ttu-id="c6a87-450"><a id="inbuilt-encode"></a>Не назначайте элементы модели DOM приемникам без встроенных возможностей кодирования</span><span class="sxs-lookup"><span data-stu-id="c6a87-450"><a id="inbuilt-encode"></a>Do not assign DOM elements to sinks that do not have inbuilt encoding</span></span>

| <span data-ttu-id="c6a87-451">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-451">Title</span></span>                   | <span data-ttu-id="c6a87-452">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-452">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-453">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-453">**Component**</span></span>               | <span data-ttu-id="c6a87-454">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-454">Web Application</span></span> | 
| <span data-ttu-id="c6a87-455">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-455">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-456">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-456">Build</span></span> |  
| <span data-ttu-id="c6a87-457">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-457">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-458">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-458">Generic</span></span> |
| <span data-ttu-id="c6a87-459">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-459">**Attributes**</span></span>              | <span data-ttu-id="c6a87-460">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-460">N/A</span></span>  |
| <span data-ttu-id="c6a87-461">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-461">**References**</span></span>              | <span data-ttu-id="c6a87-462">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-462">N/A</span></span>  |
| <span data-ttu-id="c6a87-463">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-463">**Steps**</span></span> | <span data-ttu-id="c6a87-464">Многие функции JavaScript не выполняют кодирование по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-464">Many javascript functions don't do encoding by default.</span></span> <span data-ttu-id="c6a87-465">Назначение ненадежных входных данных элементам модели DOM через такие функции может привести к выполнению межсайтовых сценариев (XSS).</span><span class="sxs-lookup"><span data-stu-id="c6a87-465">When assigning untrusted input to DOM elements via such functions, may result in cross site script (XSS) executions.</span></span>| 

### <a name="example"></a><span data-ttu-id="c6a87-466">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-466">Example</span></span>
<span data-ttu-id="c6a87-467">Ниже приведены примеры ненадежных входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-467">Following are insecure examples:</span></span> 

```
document.getElementByID("div1").innerHtml = value;
$("#userName").html(res.Name);
return $('<div/>').html(value)
$('body').append(resHTML);   
```
<span data-ttu-id="c6a87-468">Не используйте элемент `innerHtml`. Вместо него используйте `innerText`.</span><span class="sxs-lookup"><span data-stu-id="c6a87-468">Don't use `innerHtml`; instead use `innerText`.</span></span> <span data-ttu-id="c6a87-469">Аналогичным образом вместо `$("#elm").html()` используйте `$("#elm").text()`.</span><span class="sxs-lookup"><span data-stu-id="c6a87-469">Similarly, instead of `$("#elm").html()`, use `$("#elm").text()`</span></span> 

## <span data-ttu-id="c6a87-470"><a id="redirect-safe"></a>Убедитесь, что операции перенаправления в приложении закрыты или выполняются безопасно</span><span class="sxs-lookup"><span data-stu-id="c6a87-470"><a id="redirect-safe"></a>Validate all redirects within the application are closed or done safely</span></span>

| <span data-ttu-id="c6a87-471">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-471">Title</span></span>                   | <span data-ttu-id="c6a87-472">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-472">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-473">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-473">**Component**</span></span>               | <span data-ttu-id="c6a87-474">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-474">Web Application</span></span> | 
| <span data-ttu-id="c6a87-475">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-475">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-476">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-476">Build</span></span> |  
| <span data-ttu-id="c6a87-477">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-477">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-478">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-478">Generic</span></span> |
| <span data-ttu-id="c6a87-479">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-479">**Attributes**</span></span>              | <span data-ttu-id="c6a87-480">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-480">N/A</span></span>  |
| <span data-ttu-id="c6a87-481">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-481">**References**</span></span>              | <span data-ttu-id="c6a87-482">[The OAuth 2.0 Authorization Framework — Open Redirectors](http://tools.ietf.org/html/rfc6749#section-10.15) (OAuth 2.0 Authorization Framework: открытые средства перенаправления)</span><span class="sxs-lookup"><span data-stu-id="c6a87-482">[The OAuth 2.0 Authorization Framework - Open Redirectors](http://tools.ietf.org/html/rfc6749#section-10.15)</span></span> |
| <span data-ttu-id="c6a87-483">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-483">**Steps**</span></span> | <p><span data-ttu-id="c6a87-484">Если приложение требует перенаправления в пользовательское расположение, необходимо ограничить возможные целевые расположения для перенаправления, задав предопределенный список безопасных сайтов или доменов.</span><span class="sxs-lookup"><span data-stu-id="c6a87-484">Application design requiring redirection to a user-supplied location must constrain the possible redirection targets to a predefined "safe" list of sites or domains.</span></span> <span data-ttu-id="c6a87-485">Все операции перенаправления в приложении должны быть закрытыми и безопасными.</span><span class="sxs-lookup"><span data-stu-id="c6a87-485">All redirects in the application must be closed/safe.</span></span></p><p><span data-ttu-id="c6a87-486">Для этого:</span><span class="sxs-lookup"><span data-stu-id="c6a87-486">To do this:</span></span></p><ul><li><span data-ttu-id="c6a87-487">Определяйте все операции перенаправления.</span><span class="sxs-lookup"><span data-stu-id="c6a87-487">Identify all redirects</span></span></li><li><span data-ttu-id="c6a87-488">Реализуйте подходящий метод защиты для каждого перенаправления.</span><span class="sxs-lookup"><span data-stu-id="c6a87-488">Implement an appropriate mitigation for each redirect.</span></span> <span data-ttu-id="c6a87-489">Сюда входит список разрешений для перенаправления или подтверждение пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-489">Appropriate mitigations include redirect whitelist or user confirmation.</span></span> <span data-ttu-id="c6a87-490">Если веб-узел или служба с уязвимостью в виде открытого перенаправления использует поставщиков удостоверений Facebook, OAuth или OpenID, злоумышленник может похитить маркер входа пользователя и выполнять действия от его имени.</span><span class="sxs-lookup"><span data-stu-id="c6a87-490">If a web site or service with an open redirect vulnerability uses Facebook/OAuth/OpenID identity providers, an attacker can steal a user's logon token and impersonate that user.</span></span> <span data-ttu-id="c6a87-491">Это неизбежный риск при использовании OAuth, который описан в документе RFC 6749 The OAuth 2.0 Authorization Framework (OAuth 2.0 Authorization Framework), раздел 10.15 Open Redirects (Открытые перенаправления). Аналогичным образом можно скомпрометировать учетные данные пользователя путем фишинга с использованием открытого перенаправления.</span><span class="sxs-lookup"><span data-stu-id="c6a87-491">This is an inherent risk when using OAuth, which is documented in RFC 6749 "The OAuth 2.0 Authorization Framework", Section 10.15 "Open Redirects" Similarly, users' credentials can be compromised by spear phishing attacks using open redirects</span></span></li></ul>|

## <span data-ttu-id="c6a87-492"><a id="string-method"></a>Внедрите проверку входных данных для всех параметров строкового типа, принимаемых методами контроллера</span><span class="sxs-lookup"><span data-stu-id="c6a87-492"><a id="string-method"></a>Implement input validation on all string type parameters accepted by Controller methods</span></span>

| <span data-ttu-id="c6a87-493">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-493">Title</span></span>                   | <span data-ttu-id="c6a87-494">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-494">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-495">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-495">**Component**</span></span>               | <span data-ttu-id="c6a87-496">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-496">Web Application</span></span> | 
| <span data-ttu-id="c6a87-497">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-497">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-498">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-498">Build</span></span> |  
| <span data-ttu-id="c6a87-499">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-499">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-500">Универсальные, MVC 5, MVC 6</span><span class="sxs-lookup"><span data-stu-id="c6a87-500">Generic, MVC5, MVC6</span></span> |
| <span data-ttu-id="c6a87-501">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-501">**Attributes**</span></span>              | <span data-ttu-id="c6a87-502">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-502">N/A</span></span>  |
| <span data-ttu-id="c6a87-503">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-503">**References**</span></span>              | <span data-ttu-id="c6a87-504">[Validating Model Data in an MVC Application](http://msdn.microsoft.com/library/dd410404(v=vs.90).aspx) (Проверка данных модели в приложении MVC), [Основные принципы ваших приложений ASP.NET MVC](http://msdn.microsoft.com/magazine/dd942822.aspx)</span><span class="sxs-lookup"><span data-stu-id="c6a87-504">[Validating Model Data in an MVC Application](http://msdn.microsoft.com/library/dd410404(v=vs.90).aspx), [Guiding Principles For Your ASP.NET MVC Applications](http://msdn.microsoft.com/magazine/dd942822.aspx)</span></span> |
| <span data-ttu-id="c6a87-505">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-505">**Steps**</span></span> | <span data-ttu-id="c6a87-506">Для методов, принимающих примитивные типы данных, а не модели в качестве аргументов, следует выполнять проверки входных данных с использованием регулярных выражений.</span><span class="sxs-lookup"><span data-stu-id="c6a87-506">For methods that just accept primitive data type, and not models as argument,input validation using Regular Expression should be done.</span></span> <span data-ttu-id="c6a87-507">Здесь следует использовать Regex.IsMatch с шаблоном допустимого регулярного выражения.</span><span class="sxs-lookup"><span data-stu-id="c6a87-507">Here Regex.IsMatch should be used with a valid regex pattern.</span></span> <span data-ttu-id="c6a87-508">Если входные данные не соответствуют указанному регулярному выражению, работа прекращается и отображается соответствующее предупреждение об ошибке проверки.</span><span class="sxs-lookup"><span data-stu-id="c6a87-508">If the input doesn't match the specified Regular Expression, control should not proceed further, and an adequate warning regarding validation failure should be displayed.</span></span>| 

## <span data-ttu-id="c6a87-509"><a id="dos-expression"></a>Задайте верхний предел времени ожидания для обработки регулярных выражений во избежание атаки типа "отказ в обслуживании" из-за недопустимого регулярного выражения</span><span class="sxs-lookup"><span data-stu-id="c6a87-509"><a id="dos-expression"></a>Set upper limit timeout for regular expression processing to prevent DoS due to bad regular expressions</span></span>

| <span data-ttu-id="c6a87-510">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-510">Title</span></span>                   | <span data-ttu-id="c6a87-511">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-511">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-512">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-512">**Component**</span></span>               | <span data-ttu-id="c6a87-513">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-513">Web Application</span></span> | 
| <span data-ttu-id="c6a87-514">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-514">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-515">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-515">Build</span></span> |  
| <span data-ttu-id="c6a87-516">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-516">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-517">Универсальные, веб-формы, MVC 5, MVC 6</span><span class="sxs-lookup"><span data-stu-id="c6a87-517">Generic, Web Forms, MVC5, MVC6</span></span>  |
| <span data-ttu-id="c6a87-518">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-518">**Attributes**</span></span>              | <span data-ttu-id="c6a87-519">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-519">N/A</span></span>  |
| <span data-ttu-id="c6a87-520">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-520">**References**</span></span>              | [<span data-ttu-id="c6a87-521">Свойство DefaultRegexMatchTimeout</span><span class="sxs-lookup"><span data-stu-id="c6a87-521">DefaultRegexMatchTimeout Property </span></span>](https://msdn.microsoft.com/library/system.web.configuration.httpruntimesection.defaultregexmatchtimeout.aspx) |
| <span data-ttu-id="c6a87-522">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-522">**Steps**</span></span> | <span data-ttu-id="c6a87-523">Чтобы при использовании недопустимых регулярных выражений, из-за чего вам пришлось вернуться на много шагов, появлялась ошибка типа "отказ в обслуживании", задайте глобальное время ожидания по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c6a87-523">To ensure denial of service attacks against badly created regular expressions, that cause a lot of backtracking, set the global default timeout.</span></span> <span data-ttu-id="c6a87-524">Если обработка выполняется дольше заданного верхнего предела, будет выведено исключение времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="c6a87-524">If the processing time takes longer than the defined upper limit, it would throw a Timeout exception.</span></span> <span data-ttu-id="c6a87-525">Если ничего не настраивать, время ожидания будет бесконечным.</span><span class="sxs-lookup"><span data-stu-id="c6a87-525">If nothing is configured, the timeout would be infinite.</span></span>| 

### <a name="example"></a><span data-ttu-id="c6a87-526">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-526">Example</span></span>
<span data-ttu-id="c6a87-527">Например, если обработка занимает более 5 секунд, исключение RegexMatchTimeoutException вызывает следующая конфигурация:</span><span class="sxs-lookup"><span data-stu-id="c6a87-527">For example, the following configuration will throw a RegexMatchTimeoutException, if the processing takes more than 5 seconds:</span></span> 

```C#
<httpRuntime targetFramework="4.5" defaultRegexMatchTimeout="00:00:05" />
```

## <span data-ttu-id="c6a87-528"><a id="html-razor"></a>Не используйте метод Html.Raw в представлениях Razor</span><span class="sxs-lookup"><span data-stu-id="c6a87-528"><a id="html-razor"></a>Avoid using Html.Raw in Razor views</span></span>

| <span data-ttu-id="c6a87-529">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-529">Title</span></span>                   | <span data-ttu-id="c6a87-530">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-530">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-531">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-531">**Component**</span></span>               | <span data-ttu-id="c6a87-532">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="c6a87-532">Web Application</span></span> | 
| <span data-ttu-id="c6a87-533">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-533">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-534">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-534">Build</span></span> |  
| <span data-ttu-id="c6a87-535">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-535">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-536">MVC 5, MVC 6</span><span class="sxs-lookup"><span data-stu-id="c6a87-536">MVC5, MVC6</span></span> |
| <span data-ttu-id="c6a87-537">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-537">**Attributes**</span></span>              | <span data-ttu-id="c6a87-538">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-538">N/A</span></span>  |
| <span data-ttu-id="c6a87-539">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-539">**References**</span></span>              | <span data-ttu-id="c6a87-540">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-540">N/A</span></span>  |
| <span data-ttu-id="c6a87-541">Шаг</span><span class="sxs-lookup"><span data-stu-id="c6a87-541">Step</span></span> | <span data-ttu-id="c6a87-542">Веб-страницы ASP.NET (Razor) выполняют автоматическое кодирование HTML.</span><span class="sxs-lookup"><span data-stu-id="c6a87-542">ASP.Net WebPages (Razor) perform automatic HTML encoding.</span></span> <span data-ttu-id="c6a87-543">Все строки, которые выводятся внедренными ограничителями кода (блоки @), автоматически преобразовываются в формат HTML.</span><span class="sxs-lookup"><span data-stu-id="c6a87-543">All strings printed by embedded code nuggets (@ blocks) are automatically HTML-encoded.</span></span> <span data-ttu-id="c6a87-544">Однако при вызове метод `HtmlHelper.Raw` возвращает разметку без кодировки HTML.</span><span class="sxs-lookup"><span data-stu-id="c6a87-544">However, when `HtmlHelper.Raw` Method is invoked, it returns markup that is not HTML encoded.</span></span> <span data-ttu-id="c6a87-545">Если используется вспомогательный метод `Html.Raw()`, он обходит автоматическую защиту кодирования, обеспечиваемую Razor.</span><span class="sxs-lookup"><span data-stu-id="c6a87-545">If `Html.Raw()` helper method is used, it bypasses the automatic encoding protection that Razor provides.</span></span>|

### <a name="example"></a><span data-ttu-id="c6a87-546">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-546">Example</span></span>
<span data-ttu-id="c6a87-547">Ниже приведены примеры ненадежных входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-547">Following is an insecure example:</span></span> 

```C#
<div class="form-group">
            @Html.Raw(Model.AccountConfirmText)
        </div>
        <div class="form-group">
            @Html.Raw(Model.PaymentConfirmText)
        </div>
</div>
```
<span data-ttu-id="c6a87-548">Используйте метод `Html.Raw()` только для отображения разметки.</span><span class="sxs-lookup"><span data-stu-id="c6a87-548">Do not use `Html.Raw()` unless you need to display markup.</span></span> <span data-ttu-id="c6a87-549">Этот метод помогает избежать неявного кодирования выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-549">This method does not perform output encoding implicitly.</span></span> <span data-ttu-id="c6a87-550">Используйте другие вспомогательные методы ASP.NET, например `@Html.DisplayFor()`.</span><span class="sxs-lookup"><span data-stu-id="c6a87-550">Use other ASP.NET helpers e.g., `@Html.DisplayFor()`</span></span> 

## <span data-ttu-id="c6a87-551"><a id="stored-proc"></a>Не используйте динамические запросы в хранимых процедурах</span><span class="sxs-lookup"><span data-stu-id="c6a87-551"><a id="stored-proc"></a>Do not use dynamic queries in stored procedures</span></span>

| <span data-ttu-id="c6a87-552">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-552">Title</span></span>                   | <span data-ttu-id="c6a87-553">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-553">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-554">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-554">**Component**</span></span>               | <span data-ttu-id="c6a87-555">База данных</span><span class="sxs-lookup"><span data-stu-id="c6a87-555">Database</span></span> | 
| <span data-ttu-id="c6a87-556">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-556">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-557">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-557">Build</span></span> |  
| <span data-ttu-id="c6a87-558">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-558">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-559">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-559">Generic</span></span> |
| <span data-ttu-id="c6a87-560">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-560">**Attributes**</span></span>              | <span data-ttu-id="c6a87-561">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-561">N/A</span></span>  |
| <span data-ttu-id="c6a87-562">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-562">**References**</span></span>              | <span data-ttu-id="c6a87-563">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-563">N/A</span></span>  |
| <span data-ttu-id="c6a87-564">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-564">**Steps**</span></span> | <p><span data-ttu-id="c6a87-565">В ходе атаки путем внедрения кода SQL используются уязвимости проверки входных данных для выполнения произвольных команд в базе данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-565">A SQL injection attack exploits vulnerabilities in input validation to run arbitrary commands in the database.</span></span> <span data-ttu-id="c6a87-566">Это может произойти, когда приложение использует входные данные, чтобы создать динамические инструкции SQL для доступа к базе данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-566">It can occur when your application uses input to construct dynamic SQL statements to access the database.</span></span> <span data-ttu-id="c6a87-567">Кроме того, такая атака может выполняться, если код использует хранимые процедуры, передающие строки с необработанными входными данными пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-567">It can also occur if your code uses stored procedures that are passed strings that contain raw user input.</span></span> <span data-ttu-id="c6a87-568">В ходе атаки путем внедрения кода SQL злоумышленник может выполнять произвольные команды в базе данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-568">Using the SQL injection attack, the attacker can execute arbitrary commands in the database.</span></span> <span data-ttu-id="c6a87-569">Все инструкции SQL (включая инструкции SQL в хранимых процедурах) нужно параметризовать.</span><span class="sxs-lookup"><span data-stu-id="c6a87-569">All SQL statements (including the SQL statements in stored procedures) must be parameterized.</span></span> <span data-ttu-id="c6a87-570">Параметризованные инструкции SQL без проблем принимают знаки, имеющие специальное значение в SQL (например, одинарная кавычка), так как они строго типизированы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-570">Parameterized SQL statements will accept characters that have special meaning to SQL (like single quote) without problems because they are strongly typed.</span></span> |

### <a name="example"></a><span data-ttu-id="c6a87-571">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-571">Example</span></span>
<span data-ttu-id="c6a87-572">Ниже приведен пример небезопасной динамической хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="c6a87-572">Following is an example of insecure dynamic Stored Procedure:</span></span> 

```C#
CREATE PROCEDURE [dbo].[uspGetProductsByCriteria]
(
  @productName nvarchar(200) = NULL,
  @startPrice float = NULL,
  @endPrice float = NULL
)
AS
 BEGIN
  DECLARE @sql nvarchar(max)
  SELECT @sql = ' SELECT ProductID, ProductName, Description, UnitPrice, ImagePath' +
       ' FROM dbo.Products WHERE 1 = 1 '
       PRINT @sql
  IF @productName IS NOT NULL
     SELECT @sql = @sql + ' AND ProductName LIKE ''%' + @productName + '%'''
  IF @startPrice IS NOT NULL
     SELECT @sql = @sql + ' AND UnitPrice > ''' + CONVERT(VARCHAR(10),@startPrice) + ''''
  IF @endPrice IS NOT NULL
     SELECT @sql = @sql + ' AND UnitPrice < ''' + CONVERT(VARCHAR(10),@endPrice) + ''''

  PRINT @sql
  EXEC(@sql)
 END
```

### <a name="example"></a><span data-ttu-id="c6a87-573">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-573">Example</span></span>
<span data-ttu-id="c6a87-574">Ниже приведен пример той же хранимой процедуры, реализованной безопасным образом.</span><span class="sxs-lookup"><span data-stu-id="c6a87-574">Following is the same stored procedure implemented securely:</span></span> 
```C#
CREATE PROCEDURE [dbo].[uspGetProductsByCriteriaSecure]
(
             @productName nvarchar(200) = NULL,
             @startPrice float = NULL,
             @endPrice float = NULL
)
AS
       BEGIN
             SELECT ProductID, ProductName, Description, UnitPrice, ImagePath
             FROM dbo.Products where
             (@productName IS NULL or ProductName like '%'+ @productName +'%')
             AND
             (@startPrice IS NULL or UnitPrice > @startPrice)
             AND
             (@endPrice IS NULL or UnitPrice < @endPrice)         
       END
```

## <span data-ttu-id="c6a87-575"><a id="validation-api"></a>Убедитесь, что в методах веб-API выполнена проверка моделей</span><span class="sxs-lookup"><span data-stu-id="c6a87-575"><a id="validation-api"></a>Ensure that model validation is done on Web API methods</span></span>

| <span data-ttu-id="c6a87-576">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-576">Title</span></span>                   | <span data-ttu-id="c6a87-577">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-577">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-578">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-578">**Component**</span></span>               | <span data-ttu-id="c6a87-579">Веб-интерфейс API</span><span class="sxs-lookup"><span data-stu-id="c6a87-579">Web API</span></span> | 
| <span data-ttu-id="c6a87-580">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-580">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-581">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-581">Build</span></span> |  
| <span data-ttu-id="c6a87-582">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-582">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-583">MVC 5, MVC 6</span><span class="sxs-lookup"><span data-stu-id="c6a87-583">MVC5, MVC6</span></span> |
| <span data-ttu-id="c6a87-584">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-584">**Attributes**</span></span>              | <span data-ttu-id="c6a87-585">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-585">N/A</span></span>  |
| <span data-ttu-id="c6a87-586">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-586">**References**</span></span>              | <span data-ttu-id="c6a87-587">[Model Validation in ASP.NET Web API ](http://www.asp.net/web-api/overview/formats-and-model-binding/model-validation-in-aspnet-web-api) (Проверка модели в веб-API ASP.NET)</span><span class="sxs-lookup"><span data-stu-id="c6a87-587">[Model Validation in ASP.NET Web API ](http://www.asp.net/web-api/overview/formats-and-model-binding/model-validation-in-aspnet-web-api)</span></span> |
| <span data-ttu-id="c6a87-588">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-588">**Steps**</span></span> | <span data-ttu-id="c6a87-589">Данные, которые клиент отправляет в веб-API, нужно обязательно проверить перед обработкой.</span><span class="sxs-lookup"><span data-stu-id="c6a87-589">When a client sends data to a web API, it is mandatory to validate the data before doing any processing.</span></span> <span data-ttu-id="c6a87-590">В веб-API ASP.NET, которые принимают модели в качестве входных данных, используйте аннотации данных для моделей, чтобы задать правила проверки свойств модели.</span><span class="sxs-lookup"><span data-stu-id="c6a87-590">For ASP.NET Web APIs which accept models as input, use data annotations on models to set validation rules on the properties of the model.</span></span>|

### <a name="example"></a><span data-ttu-id="c6a87-591">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-591">Example</span></span>
<span data-ttu-id="c6a87-592">Это показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="c6a87-592">The following code demonstrates the same:</span></span> 

```C#
using System.ComponentModel.DataAnnotations;

namespace MyApi.Models
{
    public class Product
    {
        public int Id { get; set; }
        [Required]
        [RegularExpression(@"^[a-zA-Z0-9]*$", ErrorMessage="Only alphanumeric characters are allowed.")]
        public string Name { get; set; }
        public decimal Price { get; set; }
        [Range(0, 999)]
        public double Weight { get; set; }
    }
}
```

### <a name="example"></a><span data-ttu-id="c6a87-593">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-593">Example</span></span>
<span data-ttu-id="c6a87-594">В методе действия контроллеров API достоверность модели должна быть проверена явно, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="c6a87-594">In the action method of the API controllers, validity of the model has to be explicitly checked as shown below:</span></span> 

```C#
namespace MyApi.Controllers
{
    public class ProductsController : ApiController
    {
        public HttpResponseMessage Post(Product product)
        {
            if (ModelState.IsValid)
            {
                // Do something with the product (not shown).

                return new HttpResponseMessage(HttpStatusCode.OK);
            }
            else
            {
                return Request.CreateErrorResponse(HttpStatusCode.BadRequest, ModelState);
            }
        }
    }
}
```

## <span data-ttu-id="c6a87-595"><a id="string-api"></a>Внедрите проверку входных данных для всех параметров строкового типа, принимаемых методами веб-API</span><span class="sxs-lookup"><span data-stu-id="c6a87-595"><a id="string-api"></a>Implement input validation on all string type parameters accepted by Web API methods</span></span>

| <span data-ttu-id="c6a87-596">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-596">Title</span></span>                   | <span data-ttu-id="c6a87-597">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-597">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-598">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-598">**Component**</span></span>               | <span data-ttu-id="c6a87-599">Веб-интерфейс API</span><span class="sxs-lookup"><span data-stu-id="c6a87-599">Web API</span></span> | 
| <span data-ttu-id="c6a87-600">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-600">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-601">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-601">Build</span></span> |  
| <span data-ttu-id="c6a87-602">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-602">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-603">Универсальные, MVC 5, MVC 6</span><span class="sxs-lookup"><span data-stu-id="c6a87-603">Generic, MVC 5, MVC 6</span></span> |
| <span data-ttu-id="c6a87-604">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-604">**Attributes**</span></span>              | <span data-ttu-id="c6a87-605">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-605">N/A</span></span>  |
| <span data-ttu-id="c6a87-606">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-606">**References**</span></span>              | <span data-ttu-id="c6a87-607">[Validating Model Data in an MVC Application](http://msdn.microsoft.com/library/dd410404(v=vs.90).aspx) (Проверка данных модели в приложении MVC), [Основные принципы ваших приложений ASP.NET MVC](http://msdn.microsoft.com/magazine/dd942822.aspx)</span><span class="sxs-lookup"><span data-stu-id="c6a87-607">[Validating Model Data in an MVC Application](http://msdn.microsoft.com/library/dd410404(v=vs.90).aspx), [Guiding Principles For Your ASP.NET MVC Applications](http://msdn.microsoft.com/magazine/dd942822.aspx)</span></span> |
| <span data-ttu-id="c6a87-608">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-608">**Steps**</span></span> | <span data-ttu-id="c6a87-609">Для методов, принимающих примитивные типы данных, а не модели в качестве аргументов, следует выполнять проверки входных данных с использованием регулярных выражений.</span><span class="sxs-lookup"><span data-stu-id="c6a87-609">For methods that just accept primitive data type, and not models as argument,input validation using Regular Expression should be done.</span></span> <span data-ttu-id="c6a87-610">Здесь следует использовать Regex.IsMatch с шаблоном допустимого регулярного выражения.</span><span class="sxs-lookup"><span data-stu-id="c6a87-610">Here Regex.IsMatch should be used with a valid regex pattern.</span></span> <span data-ttu-id="c6a87-611">Если входные данные не соответствуют указанному регулярному выражению, работа прекращается и отображается соответствующее предупреждение об ошибке проверки.</span><span class="sxs-lookup"><span data-stu-id="c6a87-611">If the input doesn't match the specified Regular Expression, control should not proceed further, and an adequate warning regarding validation failure should be displayed.</span></span>|

## <span data-ttu-id="c6a87-612"><a id="typesafe-api"></a>Убедитесь, что в веб-API для доступа к данным используются параметры типобезопасности</span><span class="sxs-lookup"><span data-stu-id="c6a87-612"><a id="typesafe-api"></a>Ensure that type-safe parameters are used in Web API for data access</span></span>

| <span data-ttu-id="c6a87-613">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-613">Title</span></span>                   | <span data-ttu-id="c6a87-614">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-614">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-615">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-615">**Component**</span></span>               | <span data-ttu-id="c6a87-616">Веб-интерфейс API</span><span class="sxs-lookup"><span data-stu-id="c6a87-616">Web API</span></span> | 
| <span data-ttu-id="c6a87-617">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-617">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-618">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-618">Build</span></span> |  
| <span data-ttu-id="c6a87-619">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-619">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-620">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-620">Generic</span></span> |
| <span data-ttu-id="c6a87-621">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-621">**Attributes**</span></span>              | <span data-ttu-id="c6a87-622">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-622">N/A</span></span>  |
| <span data-ttu-id="c6a87-623">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-623">**References**</span></span>              | <span data-ttu-id="c6a87-624">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-624">N/A</span></span>  |
| <span data-ttu-id="c6a87-625">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-625">**Steps**</span></span> | <p><span data-ttu-id="c6a87-626">При использовании коллекции параметров SQL рассматривает входные данные как литеральное значение, а не как исполняемый код.</span><span class="sxs-lookup"><span data-stu-id="c6a87-626">If you use the Parameters collection, SQL treats the input is as a literal value rather then as executable code.</span></span> <span data-ttu-id="c6a87-627">Используя коллекцию параметров, можно принудительно ограничить тип и длину входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-627">The Parameters collection can be used to enforce type and length constraints on input data.</span></span> <span data-ttu-id="c6a87-628">Значения вне диапазона вызывают исключение.</span><span class="sxs-lookup"><span data-stu-id="c6a87-628">Values outside of the range trigger an exception.</span></span> <span data-ttu-id="c6a87-629">Если параметры типобезопасности SQL не используются, злоумышленники могут выполнить атаку путем внедрения кода в нефильтрованные входные данные.</span><span class="sxs-lookup"><span data-stu-id="c6a87-629">If type-safe SQL parameters are not used, attackers might be able to execute injection attacks that are embedded in the unfiltered input.</span></span></p><p><span data-ttu-id="c6a87-630">Используйте параметры типобезопасности при создании SQL-запросов, чтобы предотвратить возможные атаки путем внедрения кода SQL в нефильтрованные входные данные.</span><span class="sxs-lookup"><span data-stu-id="c6a87-630">Use type safe parameters when constructing SQL queries to avoid possible SQL injection attacks that can occur with unfiltered input.</span></span> <span data-ttu-id="c6a87-631">Эти параметры можно использовать с хранимыми процедурами и динамическими инструкциями SQL.</span><span class="sxs-lookup"><span data-stu-id="c6a87-631">You can use type safe parameters with stored procedures and with dynamic SQL statements.</span></span> <span data-ttu-id="c6a87-632">В базе данных параметры обрабатываются как литеральные значения, а не как исполняемый код.</span><span class="sxs-lookup"><span data-stu-id="c6a87-632">Parameters are treated as literal values by the database and not as executable code.</span></span> <span data-ttu-id="c6a87-633">Кроме того, проверяется тип и длина параметров.</span><span class="sxs-lookup"><span data-stu-id="c6a87-633">Parameters are also checked for type and length.</span></span></p>|

### <a name="example"></a><span data-ttu-id="c6a87-634">Пример</span><span class="sxs-lookup"><span data-stu-id="c6a87-634">Example</span></span>
<span data-ttu-id="c6a87-635">В следующем коде показано, как использовать параметры типобезопасности с SqlParameterCollection при вызове хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="c6a87-635">The following code shows how to use type safe parameters with the SqlParameterCollection when calling a stored procedure.</span></span> 

```C#
using System.Data;
using System.Data.SqlClient;

using (SqlConnection connection = new SqlConnection(connectionString))
{ 
DataSet userDataset = new DataSet(); 
SqlDataAdapter myCommand = new SqlDataAdapter(LoginStoredProcedure", connection); 
myCommand.SelectCommand.CommandType = CommandType.StoredProcedure; 
myCommand.SelectCommand.Parameters.Add("@au_id", SqlDbType.VarChar, 11); 
myCommand.SelectCommand.Parameters["@au_id"].Value = SSN.Text; 
myCommand.Fill(userDataset);
}  
```
<span data-ttu-id="c6a87-636">В предыдущем примере кода длина входного значения не должна превышать 11 знаков.</span><span class="sxs-lookup"><span data-stu-id="c6a87-636">In the preceding code example, the input value cannot be longer than 11 characters.</span></span> <span data-ttu-id="c6a87-637">Если тип и длина данных не соответствуют типу или длине, определенным в параметре, класс SqlParameter выдает исключение.</span><span class="sxs-lookup"><span data-stu-id="c6a87-637">If the data does not conform to the type or length defined by the parameter, the SqlParameter class throws an exception.</span></span> 

## <span data-ttu-id="c6a87-638"><a id="sql-docdb"></a>Использование параметризованных SQL-запросов для Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="c6a87-638"><a id="sql-docdb"></a>Use parametrized SQL queries for Cosmos DB</span></span>

| <span data-ttu-id="c6a87-639">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-639">Title</span></span>                   | <span data-ttu-id="c6a87-640">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-640">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-641">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-641">**Component**</span></span>               | <span data-ttu-id="c6a87-642">Azure DocumentDB</span><span class="sxs-lookup"><span data-stu-id="c6a87-642">Azure Document DB</span></span> | 
| <span data-ttu-id="c6a87-643">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-643">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-644">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-644">Build</span></span> |  
| <span data-ttu-id="c6a87-645">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-645">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-646">Универсальный</span><span class="sxs-lookup"><span data-stu-id="c6a87-646">Generic</span></span> |
| <span data-ttu-id="c6a87-647">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-647">**Attributes**</span></span>              | <span data-ttu-id="c6a87-648">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-648">N/A</span></span>  |
| <span data-ttu-id="c6a87-649">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-649">**References**</span></span>              | <span data-ttu-id="c6a87-650">[Announcing SQL Parameterization in DocumentDB](https://azure.microsoft.com/blog/announcing-sql-parameterization-in-documentdb/) (Объявление о параметризации SQL в DocumentDB)</span><span class="sxs-lookup"><span data-stu-id="c6a87-650">[Announcing SQL Parameterization in DocumentDB](https://azure.microsoft.com/blog/announcing-sql-parameterization-in-documentdb/)</span></span> |
| <span data-ttu-id="c6a87-651">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-651">**Steps**</span></span> | <span data-ttu-id="c6a87-652">Несмотря на то что DocumentDB поддерживает исключительно запросы только для чтения, атака путем внедрения кода SQL по-прежнему возможна, если создавать запросы, объединяя их с входными данными пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-652">Although DocumentDB only supports read-only queries, SQL injection is still possible if queries are constructed by concatenating with user input.</span></span> <span data-ttu-id="c6a87-653">Пользователи могут получить доступ к данным, к которым они не должны обращаться, в одной коллекции, составляя вредоносные SQL-запросы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-653">It might be possible for a user to gain access to data they shouldn’t be accessing within the same collection by crafting malicious SQL queries.</span></span> <span data-ttu-id="c6a87-654">Используйте параметризованные SQL-запросы, если запросы создаются на основе входных данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6a87-654">Use parameterized SQL queries if queries are constructed based on user input.</span></span> |

## <span data-ttu-id="c6a87-655"><a id="schema-binding"></a>Проверка входных данных WCF путем привязки к схеме</span><span class="sxs-lookup"><span data-stu-id="c6a87-655"><a id="schema-binding"></a>WCF Input validation through Schema binding</span></span>

| <span data-ttu-id="c6a87-656">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-656">Title</span></span>                   | <span data-ttu-id="c6a87-657">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-657">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-658">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-658">**Component**</span></span>               | <span data-ttu-id="c6a87-659">WCF</span><span class="sxs-lookup"><span data-stu-id="c6a87-659">WCF</span></span> | 
| <span data-ttu-id="c6a87-660">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-660">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-661">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-661">Build</span></span> |  
| <span data-ttu-id="c6a87-662">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-662">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-663">Универсальные, .NET Framework 3</span><span class="sxs-lookup"><span data-stu-id="c6a87-663">Generic, NET Framework 3</span></span> |
| <span data-ttu-id="c6a87-664">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-664">**Attributes**</span></span>              | <span data-ttu-id="c6a87-665">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-665">N/A</span></span>  |
| <span data-ttu-id="c6a87-666">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-666">**References**</span></span>              | [<span data-ttu-id="c6a87-667">MSDN</span><span class="sxs-lookup"><span data-stu-id="c6a87-667">MSDN</span></span>](https://msdn.microsoft.com/library/ff647820.aspx) |
| <span data-ttu-id="c6a87-668">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-668">**Steps**</span></span> | <p><span data-ttu-id="c6a87-669">Отсутствие проверки приводит к разным атакам путем внедрения кода.</span><span class="sxs-lookup"><span data-stu-id="c6a87-669">Lack of validation leads to different type injection attacks.</span></span></p><p><span data-ttu-id="c6a87-670">Проверка сообщений представляет один этап защиты приложения WCF.</span><span class="sxs-lookup"><span data-stu-id="c6a87-670">Message validation represents one line of defense in the protection of your WCF application.</span></span> <span data-ttu-id="c6a87-671">При таком подходе сообщения проверяются с использованием схем защиты операций службы WCF от атак со стороны вредоносного клиента.</span><span class="sxs-lookup"><span data-stu-id="c6a87-671">With this approach, you validate messages using schemas to protect WCF service operations from attack by a malicious client.</span></span> <span data-ttu-id="c6a87-672">Проверяйте все сообщения, полученные клиентом, чтобы защитить его от атаки вредоносной службы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-672">Validate all messages received by the client to protect the client from attack by a malicious service.</span></span> <span data-ttu-id="c6a87-673">При этом сообщения проверяются, когда операции используют контракты сообщений или данных. Такая возможность не обеспечивается при проверке параметров.</span><span class="sxs-lookup"><span data-stu-id="c6a87-673">Message validation makes it possible to validate messages when operations consume message contracts or data contracts, which cannot be done using parameter validation.</span></span> <span data-ttu-id="c6a87-674">Проверка сообщений предусматривает создание логики проверки в схемах, тем самым обеспечивая большую гибкость и ускоряя разработку.</span><span class="sxs-lookup"><span data-stu-id="c6a87-674">Message validation allows you to create validation logic inside schemas, thereby providing more flexibility and reducing development time.</span></span> <span data-ttu-id="c6a87-675">Схемы можно повторно использовать в разных приложениях в организации, создавая стандарты представления данных.</span><span class="sxs-lookup"><span data-stu-id="c6a87-675">Schemas can be reused across different applications inside the organization, creating standards for data representation.</span></span> <span data-ttu-id="c6a87-676">Кроме того, путем проверки сообщений можно защитить операции, использующие более сложные типы данных, включая контракты, представляющие бизнес-логику.</span><span class="sxs-lookup"><span data-stu-id="c6a87-676">Additionally, message validation allows you to protect operations when they consume more complex data types involving contracts representing business logic.</span></span></p><p><span data-ttu-id="c6a87-677">Чтобы выполнить проверку сообщений, сначала нужно создать схему, которая представляет операции службы и типы данных, используемые этими операциями.</span><span class="sxs-lookup"><span data-stu-id="c6a87-677">To perform message validation, you first build a schema that represents the operations of your service and the data types consumed by those operations.</span></span> <span data-ttu-id="c6a87-678">Затем создайте класс .NET, который реализует пользовательский инспектор клиентских сообщений и пользовательский инспектор сообщений диспетчера, для проверки сообщений, отправленных службе или полученных от службы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-678">You then create a .NET class that implements a custom client message inspector and custom dispatcher message inspector to validate the messages sent/received to/from the service.</span></span> <span data-ttu-id="c6a87-679">Далее необходимо реализовать поведение пользовательской конечной точки, чтобы включить проверку сообщений клиента и службы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-679">Next, you implement a custom endpoint behavior to enable message validation on both the client and the service.</span></span> <span data-ttu-id="c6a87-680">Наконец, нужно реализовать пользовательский элемент конфигурации в классе, который позволяет использовать расширенное поведение пользовательской конечной точки в файле конфигурации службы или клиента.</span><span class="sxs-lookup"><span data-stu-id="c6a87-680">Finally, you implement a custom configuration element on the class that allows you to expose the extended custom endpoint behavior in the configuration file of the service or the client"</span></span></p>|

## <span data-ttu-id="c6a87-681"><a id="parameters"></a>Проверка входных данных WCF с помощью инспекторов параметров</span><span class="sxs-lookup"><span data-stu-id="c6a87-681"><a id="parameters"></a>WCF- Input validation through Parameter Inspectors</span></span>

| <span data-ttu-id="c6a87-682">Название</span><span class="sxs-lookup"><span data-stu-id="c6a87-682">Title</span></span>                   | <span data-ttu-id="c6a87-683">Сведения</span><span class="sxs-lookup"><span data-stu-id="c6a87-683">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="c6a87-684">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="c6a87-684">**Component**</span></span>               | <span data-ttu-id="c6a87-685">WCF</span><span class="sxs-lookup"><span data-stu-id="c6a87-685">WCF</span></span> | 
| <span data-ttu-id="c6a87-686">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="c6a87-686">**SDL Phase**</span></span>               | <span data-ttu-id="c6a87-687">Создание</span><span class="sxs-lookup"><span data-stu-id="c6a87-687">Build</span></span> |  
| <span data-ttu-id="c6a87-688">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="c6a87-688">**Applicable Technologies**</span></span> | <span data-ttu-id="c6a87-689">Универсальные, .NET Framework 3</span><span class="sxs-lookup"><span data-stu-id="c6a87-689">Generic, NET Framework 3</span></span> |
| <span data-ttu-id="c6a87-690">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="c6a87-690">**Attributes**</span></span>              | <span data-ttu-id="c6a87-691">Недоступно</span><span class="sxs-lookup"><span data-stu-id="c6a87-691">N/A</span></span>  |
| <span data-ttu-id="c6a87-692">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="c6a87-692">**References**</span></span>              | [<span data-ttu-id="c6a87-693">MSDN</span><span class="sxs-lookup"><span data-stu-id="c6a87-693">MSDN</span></span>](https://msdn.microsoft.com/library/ff647875.aspx) |
| <span data-ttu-id="c6a87-694">**Действия**</span><span class="sxs-lookup"><span data-stu-id="c6a87-694">**Steps**</span></span> | <p><span data-ttu-id="c6a87-695">Проверка входных данных представляет важный этап защиты приложения WCF.</span><span class="sxs-lookup"><span data-stu-id="c6a87-695">Input and data validation represents one important line of defense in the protection of your WCF application.</span></span> <span data-ttu-id="c6a87-696">Следует проверять все параметры, используемые в операциях службы WCF, чтобы обеспечить защиту службы от атак вредоносного клиента.</span><span class="sxs-lookup"><span data-stu-id="c6a87-696">You should validate all parameters exposed in WCF service operations to protect the service from attack by a malicious client.</span></span> <span data-ttu-id="c6a87-697">И наоборот, проверяйте все возвращенные значения, полученные клиентом, чтобы защитить его от атаки вредоносной службы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-697">Conversely, you should also validate all return values received by the client to protect the client from attack by a malicious service</span></span></p><p><span data-ttu-id="c6a87-698">WCF предоставляет разные точки расширения, которые позволяют настроить поведение среды выполнения WCF за счет создания пользовательских расширений.</span><span class="sxs-lookup"><span data-stu-id="c6a87-698">WCF provides different extensibility points that allow you to customize the WCF runtime behavior by creating custom extensions.</span></span> <span data-ttu-id="c6a87-699">Инспекторы сообщений и инспекторы параметров представляют собой два механизма расширения, обеспечивающие более высокий уровень контроля над данными, передаваемыми между клиентом и службой.</span><span class="sxs-lookup"><span data-stu-id="c6a87-699">Message Inspectors and Parameter Inspectors are two extensibility mechanisms used to gain greater control over the data passing between a client and a service.</span></span> <span data-ttu-id="c6a87-700">Инспекторы параметров следует использовать для проверки входных данных, а инспекторы сообщений — только для проверки всех входящих и исходящих сообщений службы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-700">You should use parameter inspectors for input validation and use message inspectors only when you need to inspect the entire message flowing in and out of a service.</span></span></p><p><span data-ttu-id="c6a87-701">Чтобы выполнить проверку входных данных, создайте класс .NET и внедрите пользовательский инспектор параметров для проверки параметров в операциях службы.</span><span class="sxs-lookup"><span data-stu-id="c6a87-701">To perform input validation, you will build a .NET class and implement a custom parameter inspector in order to validate parameters on operations in your service.</span></span> <span data-ttu-id="c6a87-702">Далее необходимо реализовать поведение пользовательской конечной точки, чтобы включить проверку в клиенте и службе.</span><span class="sxs-lookup"><span data-stu-id="c6a87-702">You will then implement a custom endpoint behavior to enable validation on both the client and the service.</span></span> <span data-ttu-id="c6a87-703">Наконец, нужно реализовать пользовательский элемент конфигурации в классе, который позволяет использовать расширенное поведение пользовательской конечной точки в файле конфигурации службы или клиента.</span><span class="sxs-lookup"><span data-stu-id="c6a87-703">Finally, you will implement a custom configuration element on the class that allows you to expose the extended custom endpoint behavior in the configuration file of the service or the client</span></span></p>|
