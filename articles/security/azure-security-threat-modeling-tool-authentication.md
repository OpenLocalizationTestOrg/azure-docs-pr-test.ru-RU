---
title: "Проверка подлинности. Средство моделирования угроз Microsoft Azure | Документация Майкрософт"
description: "Устранение угроз, обнаруженных с помощью средства моделирования угроз"
services: security
documentationcenter: na
author: RodSan
manager: RodSan
editor: RodSan
ms.assetid: na
ms.service: security
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: rodsan
ms.openlocfilehash: e547469dc61eddd1d772571ab0919532ac91f128
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="security-frame-authentication--mitigations"></a><span data-ttu-id="9b8b5-103">Механизм безопасности. Проверка подлинности | Устранение рисков</span><span class="sxs-lookup"><span data-stu-id="9b8b5-103">Security Frame: Authentication | Mitigations</span></span> 
| <span data-ttu-id="9b8b5-104">Продукт или служба</span><span class="sxs-lookup"><span data-stu-id="9b8b5-104">Product/Service</span></span> | <span data-ttu-id="9b8b5-105">Статья</span><span class="sxs-lookup"><span data-stu-id="9b8b5-105">Article</span></span> |
| --------------- | ------- |
| <span data-ttu-id="9b8b5-106">**Веб-приложение**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-106">**Web Application**</span></span>    | <ul><li>[<span data-ttu-id="9b8b5-107">Рассмотрите возможность использования стандартного механизма проверки подлинности в веб-приложениях</span><span class="sxs-lookup"><span data-stu-id="9b8b5-107">Consider using a standard authentication mechanism to authenticate to Web Application</span></span>](#standard-authn-web-app)</li><li>[<span data-ttu-id="9b8b5-108">Приложения должны надежно обрабатывать сценарии неудачной проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-108">Applications must handle failed authentication scenarios securely</span></span>](#handle-failed-authn)</li><li>[<span data-ttu-id="9b8b5-109">Включите проверку подлинности повышенного уровня или адаптивную проверку подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-109">Enable step up or adaptive authentication</span></span>](#step-up-adaptive-authn)</li><li>[<span data-ttu-id="9b8b5-110">Интерфейсы администрирования должны быть заблокированы соответствующим образом</span><span class="sxs-lookup"><span data-stu-id="9b8b5-110">Ensure that administrative interfaces are appropriately locked down</span></span>](#admin-interface-lockdown)</li><li>[<span data-ttu-id="9b8b5-111">Реализуйте безопасный механизм восстановления пароля</span><span class="sxs-lookup"><span data-stu-id="9b8b5-111">Implement forgot password functionalities securely</span></span>](#forgot-pword-fxn)</li><li>[<span data-ttu-id="9b8b5-112">Настройте применение политик учетных записей и паролей</span><span class="sxs-lookup"><span data-stu-id="9b8b5-112">Ensure that password and account policy are implemented</span></span>](#pword-account-policy)</li><li>[<span data-ttu-id="9b8b5-113">Реализуйте элементы управления для предотвращения перечисления имен пользователей</span><span class="sxs-lookup"><span data-stu-id="9b8b5-113">Implement controls to prevent username enumeration</span></span>](#controls-username-enum)</li></ul> |
| <span data-ttu-id="9b8b5-114">**База данных**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-114">**Database**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-115">По возможности используйте проверку подлинности Windows для подключения к SQL Server</span><span class="sxs-lookup"><span data-stu-id="9b8b5-115">When possible, use Windows Authentication for connecting to SQL Server</span></span>](#win-authn-sql)</li><li>[<span data-ttu-id="9b8b5-116">По возможности используйте проверку подлинности Azure Active Directory для подключения к базе данных SQL</span><span class="sxs-lookup"><span data-stu-id="9b8b5-116">When possible use Azure Active Directory Authentication for Connecting to SQL Database</span></span>](#aad-authn-sql)</li><li>[<span data-ttu-id="9b8b5-117">Если используется режим проверки подлинности SQL, обеспечьте применение политики учетных записей и паролей на сервере SQL Server</span><span class="sxs-lookup"><span data-stu-id="9b8b5-117">When SQL authentication mode is used, ensure that account and password policy are enforced on SQL server</span></span>](#authn-account-pword)</li><li>[<span data-ttu-id="9b8b5-118">Не используйте проверку подлинности SQL в автономных базах данных</span><span class="sxs-lookup"><span data-stu-id="9b8b5-118">Do not use SQL Authentication in contained databases</span></span>](#autn-contained-db)</li></ul> |
| <span data-ttu-id="9b8b5-119">**Концентратор событий Azure**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-119">**Azure Event Hub**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-120">Используйте учетные данные проверки подлинности на уровне отдельного устройства с помощью маркеров SaS</span><span class="sxs-lookup"><span data-stu-id="9b8b5-120">Use per device authentication credentials using SaS tokens</span></span>](#authn-sas-tokens)</li></ul> |
| <span data-ttu-id="9b8b5-121">**Граница доверия Azure**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-121">**Azure Trust Boundary**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-122">Включите Многофакторную идентификацию Azure для администраторов Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-122">Enable Azure Multi-Factor Authentication for Azure Administrators</span></span>](#multi-factor-azure-admin)</li></ul> |
| <span data-ttu-id="9b8b5-123">**Граница доверия Service Fabric**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-123">**Service Fabric Trust Boundary**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-124">Запретите анонимный доступ к кластеру Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-124">Restrict anonymous access to Service Fabric Cluster</span></span>](#anon-access-cluster)</li><li>[<span data-ttu-id="9b8b5-125">Сертификат Service Fabric для обмена данными между клиентом и узлом должен отличаться от простого сертификата для обмена данными между узлами</span><span class="sxs-lookup"><span data-stu-id="9b8b5-125">Ensure that Service Fabric client-to-node certificate is different from node-to-node certificate</span></span>](#fabric-cn-nn)</li><li>[<span data-ttu-id="9b8b5-126">Используйте AAD для проверки подлинности клиентов в кластерах Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-126">Use AAD to authenticate clients to service fabric clusters</span></span>](#aad-client-fabric)</li><li>[<span data-ttu-id="9b8b5-127">Нужно использовать сертификаты Service Fabric, полученные из утвержденного Центра сертификации</span><span class="sxs-lookup"><span data-stu-id="9b8b5-127">Ensure that service fabric certificates are obtained from an approved Certificate Authority (CA)</span></span>](#fabric-cert-ca)</li></ul> |
| <span data-ttu-id="9b8b5-128">**Сервер удостоверений**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-128">**Identity Server**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-129">Используйте стандартные сценарии проверки подлинности, поддерживаемые сервером удостоверений</span><span class="sxs-lookup"><span data-stu-id="9b8b5-129">Use standard authentication scenarios supported by Identity Server</span></span>](#standard-authn-id)</li><li>[<span data-ttu-id="9b8b5-130">Переопределите кэш маркеров сервера удостоверений по умолчанию масштабируемым альтернативным кэшем</span><span class="sxs-lookup"><span data-stu-id="9b8b5-130">Override the default Identity Server token cache with a scalable alternative</span></span>](#override-token)</li></ul> |
| <span data-ttu-id="9b8b5-131">**Граница доверия между компьютерами**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-131">**Machine Trust Boundary**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-132">Двоичные файлы развернутого приложения должны иметь цифровую подпись</span><span class="sxs-lookup"><span data-stu-id="9b8b5-132">Ensure that deployed application's binaries are digitally signed</span></span>](#binaries-signed)</li></ul> |
| <span data-ttu-id="9b8b5-133">**WCF**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-133">**WCF**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-134">Включите проверку подлинности при подключении к очередям MSMQ в WCF</span><span class="sxs-lookup"><span data-stu-id="9b8b5-134">Enable authentication when connecting to MSMQ queues in WCF</span></span>](#msmq-queues)</li><li>[<span data-ttu-id="9b8b5-135">WCF: не присваивайте атрибуту message clientCredentialType значение None</span><span class="sxs-lookup"><span data-stu-id="9b8b5-135">WCF-Do not set Message clientCredentialType to none</span></span>](#message-none)</li><li>[<span data-ttu-id="9b8b5-136">WCF: не присваивайте атрибуту transport clientCredentialType значение None</span><span class="sxs-lookup"><span data-stu-id="9b8b5-136">WCF-Do not set Transport clientCredentialType to none</span></span>](#transport-none)</li></ul> |
| <span data-ttu-id="9b8b5-137">**Веб-интерфейс API**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-137">**Web API**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-138">Для защиты веб-API нужно использовать стандартные методы проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-138">Ensure that standard authentication techniques are used to secure Web APIs</span></span>](#authn-secure-api)</li></ul> |
| <span data-ttu-id="9b8b5-139">**Azure AD**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-139">**Azure AD**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-140">Используйте стандартные сценарии проверки подлинности, поддерживаемые Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9b8b5-140">Use standard authentication scenarios supported by Azure Active Directory</span></span>](#authn-aad)</li><li>[<span data-ttu-id="9b8b5-141">Переопределите кэш маркера ADAL по умолчанию масштабируемым альтернативным кэшем</span><span class="sxs-lookup"><span data-stu-id="9b8b5-141">Override the default ADAL token cache with a scalable alternative</span></span>](#adal-scalable)</li><li>[<span data-ttu-id="9b8b5-142">Для предотвращения воспроизведения маркеров проверки подлинности ADAL нужно использовать свойство TokenReplayCache</span><span class="sxs-lookup"><span data-stu-id="9b8b5-142">Ensure that TokenReplayCache is used to prevent the replay of ADAL authentication tokens</span></span>](#tokenreplaycache-adal)</li><li>[<span data-ttu-id="9b8b5-143">Используйте библиотеки ADAL для управления запросами маркеров от клиентов OAuth2 к AAD (или к локальной службе AD)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-143">Use ADAL libraries to manage token requests from OAuth2 clients to AAD (or on-premises AD)</span></span>](#adal-oauth2)</li></ul> |
| <span data-ttu-id="9b8b5-144">**Полевой шлюз Интернета вещей**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-144">**IoT Field Gateway**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-145">Проверяйте подлинность устройств, подключаемых к полевому шлюзу</span><span class="sxs-lookup"><span data-stu-id="9b8b5-145">Authenticate devices connecting to the Field Gateway</span></span>](#authn-devices-field)</li></ul> |
| <span data-ttu-id="9b8b5-146">**Облачный шлюз Интернета вещей**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-146">**IoT Cloud Gateway**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-147">Устройства, подключаемые к облачному шлюзу, должны проходить проверку подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-147">Ensure that devices connecting to Cloud gateway are authenticated</span></span>](#authn-devices-cloud)</li><li>[<span data-ttu-id="9b8b5-148">Используйте учетные данные проверки подлинности на уровне отдельного устройства</span><span class="sxs-lookup"><span data-stu-id="9b8b5-148">Use per-device authentication credentials</span></span>](#authn-cred)</li></ul> |
| <span data-ttu-id="9b8b5-149">**Хранилище Azure**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-149">**Azure Storage**</span></span> | <ul><li>[<span data-ttu-id="9b8b5-150">Анонимный доступ на чтение должен быть предоставлен только к необходимым контейнерам и большим двоичным объектам</span><span class="sxs-lookup"><span data-stu-id="9b8b5-150">Ensure that only the required containers and blobs are given anonymous read access</span></span>](#req-containers-anon)</li><li>[<span data-ttu-id="9b8b5-151">Предоставьте ограниченный доступ к объектам в службе хранилища Azure с помощью SAS или SAP</span><span class="sxs-lookup"><span data-stu-id="9b8b5-151">Grant limited access to objects in Azure storage using SAS or SAP</span></span>](#limited-access-sas)</li></ul> |

## <span data-ttu-id="9b8b5-152"><a id="standard-authn-web-app"></a>Рассмотрите возможность использования стандартного механизма проверки подлинности в веб-приложениях</span><span class="sxs-lookup"><span data-stu-id="9b8b5-152"><a id="standard-authn-web-app"></a>Consider using a standard authentication mechanism to authenticate to Web Application</span></span>

| <span data-ttu-id="9b8b5-153">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-153">Title</span></span>                   | <span data-ttu-id="9b8b5-154">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-154">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-155">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-155">**Component**</span></span>               | <span data-ttu-id="9b8b5-156">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="9b8b5-156">Web Application</span></span> | 
| <span data-ttu-id="9b8b5-157">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-157">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-158">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-158">Build</span></span> |  
| <span data-ttu-id="9b8b5-159">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-159">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-160">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-160">Generic</span></span> |
| <span data-ttu-id="9b8b5-161">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-161">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-162">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-162">N/A</span></span>  |
| <span data-ttu-id="9b8b5-163">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-163">**References**</span></span>              | <span data-ttu-id="9b8b5-164">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-164">N/A</span></span>  |
| <span data-ttu-id="9b8b5-165">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-165">Details</span></span> | <p><span data-ttu-id="9b8b5-166">Проверка подлинности — это процесс, во время которого сущность подтверждает свою подлинность с помощью учетных данных, таких как имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-166">Authentication is the process where an entity proves its identity, typically through credentials, such as a user name and password.</span></span> <span data-ttu-id="9b8b5-167">Существует множество протоколов проверки подлинности,</span><span class="sxs-lookup"><span data-stu-id="9b8b5-167">There are multiple authentication protocols available which may be considered.</span></span> <span data-ttu-id="9b8b5-168">включая следующие:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-168">Some of them are listed below:</span></span></p><ul><li><span data-ttu-id="9b8b5-169">Client certificates</span><span class="sxs-lookup"><span data-stu-id="9b8b5-169">Client certificates</span></span></li><li><span data-ttu-id="9b8b5-170">на основе Windows;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-170">Windows based</span></span></li><li><span data-ttu-id="9b8b5-171">на основе форм;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-171">Forms based</span></span></li><li><span data-ttu-id="9b8b5-172">федерация: ADFS;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-172">Federation - ADFS</span></span></li><li><span data-ttu-id="9b8b5-173">федерация: Azure AD;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-173">Federation - Azure AD</span></span></li><li><span data-ttu-id="9b8b5-174">федерация: сервер удостоверений.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-174">Federation - Identity Server</span></span></li></ul><p><span data-ttu-id="9b8b5-175">Рассмотрите возможность использования стандартного механизма проверки подлинности для идентификации исходного процесса.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-175">Consider using a standard authentication mechanism to identify the source process</span></span></p>|

## <span data-ttu-id="9b8b5-176"><a id="handle-failed-authn"></a>Приложения должны надежно обрабатывать сценарии неудачной проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-176"><a id="handle-failed-authn"></a>Applications must handle failed authentication scenarios securely</span></span>

| <span data-ttu-id="9b8b5-177">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-177">Title</span></span>                   | <span data-ttu-id="9b8b5-178">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-178">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-179">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-179">**Component**</span></span>               | <span data-ttu-id="9b8b5-180">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="9b8b5-180">Web Application</span></span> | 
| <span data-ttu-id="9b8b5-181">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-181">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-182">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-182">Build</span></span> |  
| <span data-ttu-id="9b8b5-183">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-183">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-184">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-184">Generic</span></span> |
| <span data-ttu-id="9b8b5-185">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-185">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-186">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-186">N/A</span></span>  |
| <span data-ttu-id="9b8b5-187">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-187">**References**</span></span>              | <span data-ttu-id="9b8b5-188">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-188">N/A</span></span>  |
| <span data-ttu-id="9b8b5-189">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-189">Details</span></span> | <p><span data-ttu-id="9b8b5-190">Приложения, которые явно проверяют подлинность пользователей, должны безопасно обрабатывать сценарии неудачной проверки подлинности. Механизм проверки подлинности должен:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-190">Applications that explicitly authenticate users must handle failed authentication scenarios securely.The authentication mechanism must:</span></span></p><ul><li><span data-ttu-id="9b8b5-191">запрещать доступ к привилегированным ресурсам при сбое проверки подлинности;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-191">Deny access to privileged resources when authentication fails</span></span></li><li><span data-ttu-id="9b8b5-192">отображать общее сообщение об ошибке после неудачной проверки подлинности и запрета доступа.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-192">Display a generic error message after failed authentication and access denied occurs</span></span></li></ul><p><span data-ttu-id="9b8b5-193">Проверьте, обеспечивает ли механизм проверки подлинности следующее:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-193">Test for:</span></span></p><ul><li><span data-ttu-id="9b8b5-194">защиту привилегированных ресурсов после неудачных попыток входа;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-194">Protection of privileged resources after failed logins</span></span></li><li><span data-ttu-id="9b8b5-195">отображение общего сообщения об ошибке после неудачной проверки подлинности и запрета доступа;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-195">A generic error message is displayed on failed authentication and access denied event(s)</span></span></li><li><span data-ttu-id="9b8b5-196">отключение учетных записей после слишком большого количества неудачных попыток.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-196">Accounts are disabled after an excessive number of failed attempts</span></span></li><ul>|

## <span data-ttu-id="9b8b5-197"><a id="step-up-adaptive-authn"></a>Включите проверку подлинности повышенного уровня или адаптивную проверку подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-197"><a id="step-up-adaptive-authn"></a>Enable step up or adaptive authentication</span></span>

| <span data-ttu-id="9b8b5-198">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-198">Title</span></span>                   | <span data-ttu-id="9b8b5-199">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-199">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-200">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-200">**Component**</span></span>               | <span data-ttu-id="9b8b5-201">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="9b8b5-201">Web Application</span></span> | 
| <span data-ttu-id="9b8b5-202">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-202">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-203">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-203">Build</span></span> |  
| <span data-ttu-id="9b8b5-204">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-204">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-205">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-205">Generic</span></span> |
| <span data-ttu-id="9b8b5-206">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-206">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-207">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-207">N/A</span></span>  |
| <span data-ttu-id="9b8b5-208">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-208">**References**</span></span>              | <span data-ttu-id="9b8b5-209">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-209">N/A</span></span>  |
| <span data-ttu-id="9b8b5-210">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-210">Details</span></span> | <p><span data-ttu-id="9b8b5-211">Убедитесь, что приложение имеет дополнительную авторизацию (проверку подлинности повышенного уровня или адаптивную проверку подлинности через службу Многофакторной идентификации, например с отправкой одноразового пароля в SMS, сообщении электронной почты и т. д. или запрос повторной проверки подлинности), которую пользователь должен пройти, прежде чем получить доступ к конфиденциальной информации.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-211">Verify the application has additional authorization (such as step up or adaptive authentication, via multi-factor authentication such as sending OTP in SMS, email etc. or prompting for re-authentication) so the user is challenged before being granted access to sensitive information.</span></span> <span data-ttu-id="9b8b5-212">Это правило также применяется для внесения критически важных изменений в учетную запись или в действие.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-212">This rule also applies for making critical changes to an account or action</span></span></p><p><span data-ttu-id="9b8b5-213">Это означает, что адаптация проверки подлинности должна быть реализована таким образом, чтобы приложение правильно применяло контекстно-зависимую авторизацию и не допускало несанкционированные манипуляции, например путем изменения параметров.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-213">This also means that the adaptation of authentication has to be implemented in such a manner that the application correctly enforces context-sensitive authorization so as to not allow unauthorized manipulation by means of in example, parameter tampering</span></span></p>|

## <span data-ttu-id="9b8b5-214"><a id="admin-interface-lockdown"></a>Интерфейсы администрирования должны быть заблокированы соответствующим образом</span><span class="sxs-lookup"><span data-stu-id="9b8b5-214"><a id="admin-interface-lockdown"></a>Ensure that administrative interfaces are appropriately locked down</span></span>

| <span data-ttu-id="9b8b5-215">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-215">Title</span></span>                   | <span data-ttu-id="9b8b5-216">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-216">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-217">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-217">**Component**</span></span>               | <span data-ttu-id="9b8b5-218">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="9b8b5-218">Web Application</span></span> | 
| <span data-ttu-id="9b8b5-219">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-219">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-220">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-220">Build</span></span> |  
| <span data-ttu-id="9b8b5-221">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-221">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-222">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-222">Generic</span></span> |
| <span data-ttu-id="9b8b5-223">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-223">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-224">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-224">N/A</span></span>  |
| <span data-ttu-id="9b8b5-225">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-225">**References**</span></span>              | <span data-ttu-id="9b8b5-226">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-226">N/A</span></span>  |
| <span data-ttu-id="9b8b5-227">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-227">Details</span></span> | <span data-ttu-id="9b8b5-228">Для начала предоставьте доступ к интерфейсу администрирования только для исходного диапазона IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-228">The first solution is to grant access only from a certain source IP range to the administrative interface.</span></span> <span data-ttu-id="9b8b5-229">Если это решение невозможно, рекомендуется применить проверку подлинности повышенного уровня или адаптивную проверку подлинности для входа в интерфейс администрирования.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-229">If that solution would not be possible than it is always recommended to enforce a step-up or adaptive authentication for logging in into the administrative interface</span></span> |

## <span data-ttu-id="9b8b5-230"><a id="forgot-pword-fxn"></a>Реализуйте безопасный механизм восстановления пароля</span><span class="sxs-lookup"><span data-stu-id="9b8b5-230"><a id="forgot-pword-fxn"></a>Implement forgot password functionalities securely</span></span>

| <span data-ttu-id="9b8b5-231">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-231">Title</span></span>                   | <span data-ttu-id="9b8b5-232">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-232">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-233">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-233">**Component**</span></span>               | <span data-ttu-id="9b8b5-234">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="9b8b5-234">Web Application</span></span> | 
| <span data-ttu-id="9b8b5-235">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-235">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-236">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-236">Build</span></span> |  
| <span data-ttu-id="9b8b5-237">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-237">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-238">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-238">Generic</span></span> |
| <span data-ttu-id="9b8b5-239">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-239">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-240">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-240">N/A</span></span>  |
| <span data-ttu-id="9b8b5-241">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-241">**References**</span></span>              | <span data-ttu-id="9b8b5-242">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-242">N/A</span></span>  |
| <span data-ttu-id="9b8b5-243">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-243">Details</span></span> | <p><span data-ttu-id="9b8b5-244">Прежде всего убедитесь, что в случае потери паролей и для восстановления по другим причинам отправляется ссылка, содержащая маркер активации с ограниченным временем действия, а не сам пароль.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-244">The first thing is to verify that forgot password and other recovery paths send a link including a time-limited activation token rather than the password itself.</span></span> <span data-ttu-id="9b8b5-245">Также перед отправкой ссылки может потребоваться дополнительная проверка подлинности на основе программных маркеров (SMS-маркер, собственное мобильное приложение и т. д.).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-245">Additional authentication based on soft-tokens (e.g. SMS token, native mobile applications, etc.) can be required as well before the link is sent over.</span></span> <span data-ttu-id="9b8b5-246">Во-вторых, вам не следует блокировать учетные записи пользователей во время процедуры получения нового пароля.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-246">Second, you should not lock out the users account whilst the process of getting a new password is in progress.</span></span></p><p><span data-ttu-id="9b8b5-247">Это может привести к атаке типа "отказ в обслуживании" всякий раз, когда злоумышленник решит намеренно блокировать пользователей с помощью автоматизированных атак.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-247">This could lead to a Denial of service attack whenever an attacker decides to intentionally lock out the users with an automated attack.</span></span> <span data-ttu-id="9b8b5-248">В-третьих, сообщение, которое отображается во время выполнения запроса нового пароля, должно быть обобщенным во избежание перечисления имен пользователей.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-248">Third, whenever the new password request was set in progress, the message you display should be generalized in order to prevent username enumeration.</span></span> <span data-ttu-id="9b8b5-249">В-четвертых, всегда запрещайте использовать старые пароли и реализуйте политику надежных паролей.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-249">Fourth, always disallow the use of old passwords and implement a strong password policy.</span></span></p> |

## <span data-ttu-id="9b8b5-250"><a id="pword-account-policy"></a>Настройте применение политик учетных записей и паролей</span><span class="sxs-lookup"><span data-stu-id="9b8b5-250"><a id="pword-account-policy"></a>Ensure that password and account policy are implemented</span></span>

| <span data-ttu-id="9b8b5-251">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-251">Title</span></span>                   | <span data-ttu-id="9b8b5-252">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-252">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-253">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-253">**Component**</span></span>               | <span data-ttu-id="9b8b5-254">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="9b8b5-254">Web Application</span></span> | 
| <span data-ttu-id="9b8b5-255">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-255">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-256">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-256">Build</span></span> |  
| <span data-ttu-id="9b8b5-257">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-257">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-258">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-258">Generic</span></span> |
| <span data-ttu-id="9b8b5-259">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-259">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-260">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-260">N/A</span></span>  |
| <span data-ttu-id="9b8b5-261">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-261">**References**</span></span>              | <span data-ttu-id="9b8b5-262">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-262">N/A</span></span>  |
| <span data-ttu-id="9b8b5-263">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-263">Details</span></span> | <p><span data-ttu-id="9b8b5-264">Политика паролей и учетных записей должна быть реализована в соответствии с политикой организации и рекомендациями.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-264">Password and account policy in compliance with organizational policy and best practices should be implemented.</span></span></p><p><span data-ttu-id="9b8b5-265">Для защиты от атак методом прямого подбора и подбора на основе словаря необходимо реализовать политику надежных паролей, чтобы пользователи создавали сложные пароли (например, длиной не менее 12 символов, а также содержащие алфавитно-цифровые или специальные символы).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-265">To defend against brute-force and dictionary based guessing: Strong password policy must be implemented to ensure that users create complex password (e.g., 12 characters minimum length, alphanumeric and special characters).</span></span></p><p><span data-ttu-id="9b8b5-266">Политики блокировки учетных записей можно реализовать следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-266">Account lockout policies may be implemented in the following manner:</span></span></p><ul><li><span data-ttu-id="9b8b5-267">**Мягкая блокировка.** Может быть хорошим вариантом для защиты пользователей от атак методом прямого подбора.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-267">**Soft lock-out:** This can be a good option for protecting your users against brute force attacks.</span></span> <span data-ttu-id="9b8b5-268">Например, всякий раз, когда пользователь вводит неверный пароль три раза подряд, приложение может заблокировать учетную запись на минуту, чтобы замедлить процесс прямого подбора пароля, сделав его менее выгодным для злоумышленника.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-268">For example, whenever the user enters a wrong password three times the application could lock down the account for a minute in order to slow down the process of brute forcing his password making it less profitable for the attacker to proceed.</span></span> <span data-ttu-id="9b8b5-269">Если в этом случае реализовать жесткую блокировку, это приведет к "отказу в обслуживании" и окончательно заблокирует учетные записи.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-269">If u were to implement hard lock-out countermeasures for this example you would achieve a "Dos" by permanently locking out accounts.</span></span> <span data-ttu-id="9b8b5-270">Кроме того, приложение может создать одноразовый пароль и отправить его пользователю по внештатному каналу (по электронной почте, SMS и т. д.).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-270">Alternatively, application may generate an OTP (One Time Password) and send it out-of-band (through email, sms etc.) to the user.</span></span> <span data-ttu-id="9b8b5-271">Как вариант, можно реализовать проверку CAPTCHA по достижении порогового значения числа неудачных попыток.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-271">Another approach may be to implement CAPTCHA after a threshold number of failed attempts is reached.</span></span></li><li><span data-ttu-id="9b8b5-272">**Жесткая блокировка.** Этот тип блокировки следует применять всякий раз при обнаружении атаки пользователя на ваше приложение. В качестве контрмеры можно окончательно заблокировать его учетную запись до тех пор, пока группа реагирования не проведет экспертизу.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-272">**Hard lock-out:** This type of lockout should be applied whenever you detect a user attacking your application and counter him by means of permanently locking out his account until a response team had time to do their forensics.</span></span> <span data-ttu-id="9b8b5-273">После этой процедуры вы можете разблокировать учетную запись пользователя или принять в отношении него дальнейшие юридические меры.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-273">After this process you can decide to give the user back his account or take further legal actions against him.</span></span> <span data-ttu-id="9b8b5-274">Такой подход не позволит злоумышленнику продолжить атаки на приложение и инфраструктуру.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-274">This type of approach prevents the attacker from further penetrating your application and infrastructure.</span></span></li></ul><p><span data-ttu-id="9b8b5-275">Для защиты от атак на прогнозируемые учетные записи и учетные записи по умолчанию все ключи и пароли должны быть заменяемыми, а также быть созданы или заменены с момента их создания.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-275">To defend against attacks on default and predictable accounts, verify that all keys and passwords are replaceable, and are generated or replaced after installation time.</span></span></p><p><span data-ttu-id="9b8b5-276">Если приложение автоматически создает пароли, они должны создаваться случайным образом и иметь высокий уровень энтропии.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-276">If the application has to auto-generate passwords, ensure that the generated passwords are random and have high entropy.</span></span></p>|

## <span data-ttu-id="9b8b5-277"><a id="controls-username-enum"></a>Реализуйте элементы управления для предотвращения перечисления имен пользователей</span><span class="sxs-lookup"><span data-stu-id="9b8b5-277"><a id="controls-username-enum"></a>Implement controls to prevent username enumeration</span></span>

| <span data-ttu-id="9b8b5-278">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-278">Title</span></span>                   | <span data-ttu-id="9b8b5-279">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-279">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-280">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-280">**Component**</span></span>               | <span data-ttu-id="9b8b5-281">Веб-приложение</span><span class="sxs-lookup"><span data-stu-id="9b8b5-281">Web Application</span></span> | 
| <span data-ttu-id="9b8b5-282">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-282">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-283">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-283">Build</span></span> |  
| <span data-ttu-id="9b8b5-284">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-284">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-285">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-285">Generic</span></span> |
| <span data-ttu-id="9b8b5-286">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-286">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-287">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-287">N/A</span></span>  |
| <span data-ttu-id="9b8b5-288">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-288">**References**</span></span>              | <span data-ttu-id="9b8b5-289">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-289">N/A</span></span>  |
| <span data-ttu-id="9b8b5-290">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-290">**Steps**</span></span> | <span data-ttu-id="9b8b5-291">Во избежание перечисления имен пользователей все сообщения об ошибках должны быть обобщенными.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-291">All error messages should be generalized in order to prevent username enumeration.</span></span> <span data-ttu-id="9b8b5-292">Иногда не удается избежать утечки информации при использовании определенного компонента или функции, например страницы регистрации пользователя.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-292">Also sometimes you cannot avoid information leaking in functionalities such as a registration page.</span></span> <span data-ttu-id="9b8b5-293">В таких случаях, чтобы предотвратить автоматизированные атаки, необходимо использовать методы ограничения скорости обращений к странице, например CAPTCHA.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-293">Here you need to use rate-limiting methods like CAPTCHA to prevent an automated attack by an attacker.</span></span> |

## <span data-ttu-id="9b8b5-294"><a id="win-authn-sql"></a>По возможности используйте проверку подлинности Windows для подключения к SQL Server</span><span class="sxs-lookup"><span data-stu-id="9b8b5-294"><a id="win-authn-sql"></a>When possible, use Windows Authentication for connecting to SQL Server</span></span>

| <span data-ttu-id="9b8b5-295">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-295">Title</span></span>                   | <span data-ttu-id="9b8b5-296">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-296">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-297">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-297">**Component**</span></span>               | <span data-ttu-id="9b8b5-298">База данных</span><span class="sxs-lookup"><span data-stu-id="9b8b5-298">Database</span></span> | 
| <span data-ttu-id="9b8b5-299">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-299">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-300">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-300">Build</span></span> |  
| <span data-ttu-id="9b8b5-301">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-301">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-302">Локальные</span><span class="sxs-lookup"><span data-stu-id="9b8b5-302">OnPrem</span></span> |
| <span data-ttu-id="9b8b5-303">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-303">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-304">Версия SQL: все</span><span class="sxs-lookup"><span data-stu-id="9b8b5-304">SQL Version - All</span></span> |
| <span data-ttu-id="9b8b5-305">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-305">**References**</span></span>              | [<span data-ttu-id="9b8b5-306">Выбор режима проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-306">SQL Server - Choose an Authentication Mode</span></span>](https://msdn.microsoft.com/library/ms144284.aspx) |
| <span data-ttu-id="9b8b5-307">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-307">**Steps**</span></span> | <span data-ttu-id="9b8b5-308">Проверка подлинности Windows использует протокол безопасности Kerberos, политику паролей с применением проверки сложности для надежности паролей, поддерживает блокировку учетных записей и ограничение срока действия паролей.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-308">Windows Authentication uses Kerberos security protocol, provides password policy enforcement with regard to complexity validation for strong passwords, provides support for account lockout, and supports password expiration.</span></span>|

## <span data-ttu-id="9b8b5-309"><a id="aad-authn-sql"></a>По возможности используйте проверку подлинности Azure Active Directory для подключения к базе данных SQL</span><span class="sxs-lookup"><span data-stu-id="9b8b5-309"><a id="aad-authn-sql"></a>When possible use Azure Active Directory Authentication for Connecting to SQL Database</span></span>

| <span data-ttu-id="9b8b5-310">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-310">Title</span></span>                   | <span data-ttu-id="9b8b5-311">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-311">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-312">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-312">**Component**</span></span>               | <span data-ttu-id="9b8b5-313">База данных</span><span class="sxs-lookup"><span data-stu-id="9b8b5-313">Database</span></span> | 
| <span data-ttu-id="9b8b5-314">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-314">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-315">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-315">Build</span></span> |  
| <span data-ttu-id="9b8b5-316">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-316">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-317">SQL Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-317">SQL Azure</span></span> |
| <span data-ttu-id="9b8b5-318">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-318">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-319">Версия SQL: 12</span><span class="sxs-lookup"><span data-stu-id="9b8b5-319">SQL Version - V12</span></span> |
| <span data-ttu-id="9b8b5-320">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-320">**References**</span></span>              | [<span data-ttu-id="9b8b5-321">Подключение к базе данных SQL с использованием проверки подлинности Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9b8b5-321">Connecting to SQL Database By Using Azure Active Directory Authentication</span></span>](https://azure.microsoft.com/documentation/articles/sql-database-aad-authentication/) |
| <span data-ttu-id="9b8b5-322">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-322">**Steps**</span></span> | <span data-ttu-id="9b8b5-323">**Минимальная версия.** Чтобы разрешить базе данных SQL использовать проверку подлинности AAD в каталоге Майкрософт, необходимо использовать базу данных SQL Azure версии 12.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-323">**Minimum version:** Azure SQL Database V12 required to allow Azure SQL Database to use AAD Authentication against the Microsoft Directory</span></span> |

## <span data-ttu-id="9b8b5-324"><a id="authn-account-pword"></a>Если используется режим проверки подлинности SQL, обеспечьте применение политики учетных записей и паролей на сервере SQL Server</span><span class="sxs-lookup"><span data-stu-id="9b8b5-324"><a id="authn-account-pword"></a>When SQL authentication mode is used, ensure that account and password policy are enforced on SQL server</span></span>

| <span data-ttu-id="9b8b5-325">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-325">Title</span></span>                   | <span data-ttu-id="9b8b5-326">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-326">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-327">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-327">**Component**</span></span>               | <span data-ttu-id="9b8b5-328">База данных</span><span class="sxs-lookup"><span data-stu-id="9b8b5-328">Database</span></span> | 
| <span data-ttu-id="9b8b5-329">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-329">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-330">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-330">Build</span></span> |  
| <span data-ttu-id="9b8b5-331">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-331">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-332">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-332">Generic</span></span> |
| <span data-ttu-id="9b8b5-333">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-333">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-334">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-334">N/A</span></span>  |
| <span data-ttu-id="9b8b5-335">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-335">**References**</span></span>              | <span data-ttu-id="9b8b5-336">[Политика паролей](https://technet.microsoft.com/library/ms161959(v=sql.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-336">[SQL Server password policy](https://technet.microsoft.com/library/ms161959(v=sql.110).aspx)</span></span> |
| <span data-ttu-id="9b8b5-337">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-337">**Steps**</span></span> | <span data-ttu-id="9b8b5-338">При использовании проверки подлинности SQL Server создаются имена входа, которые не основаны на учетных записях Windows.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-338">When using SQL Server Authentication, logins are created in SQL Server that are not based on Windows user accounts.</span></span> <span data-ttu-id="9b8b5-339">Имя пользователя и пароль создаются и хранятся в SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-339">Both the user name and the password are created by using SQL Server and stored in SQL Server.</span></span> <span data-ttu-id="9b8b5-340">SQL Server может использовать механизмы политики паролей Windows.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-340">SQL Server can use Windows password policy mechanisms.</span></span> <span data-ttu-id="9b8b5-341">К паролям, используемым в SQL Server, можно применить те же политики ограничения срока действия и сложности, которые применяются в Windows.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-341">It can apply the same complexity and expiration policies used in Windows to passwords used inside SQL Server.</span></span> |

## <span data-ttu-id="9b8b5-342"><a id="autn-contained-db"></a>Не используйте проверку подлинности SQL в автономных базах данных</span><span class="sxs-lookup"><span data-stu-id="9b8b5-342"><a id="autn-contained-db"></a>Do not use SQL Authentication in contained databases</span></span>

| <span data-ttu-id="9b8b5-343">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-343">Title</span></span>                   | <span data-ttu-id="9b8b5-344">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-344">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-345">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-345">**Component**</span></span>               | <span data-ttu-id="9b8b5-346">База данных</span><span class="sxs-lookup"><span data-stu-id="9b8b5-346">Database</span></span> | 
| <span data-ttu-id="9b8b5-347">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-347">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-348">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-348">Build</span></span> |  
| <span data-ttu-id="9b8b5-349">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-349">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-350">Локальное, SQL Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-350">OnPrem, SQL Azure</span></span> |
| <span data-ttu-id="9b8b5-351">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-351">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-352">Версия SQL: MSSQL2012, версия SQL: 12</span><span class="sxs-lookup"><span data-stu-id="9b8b5-352">SQL Version - MSSQL2012, SQL Version - V12</span></span> |
| <span data-ttu-id="9b8b5-353">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-353">**References**</span></span>              | [<span data-ttu-id="9b8b5-354">Рекомендации по обеспечению безопасности автономных баз данных</span><span class="sxs-lookup"><span data-stu-id="9b8b5-354">Security Best Practices with Contained Databases</span></span>](http://msdn.microsoft.com/library/ff929055.aspx) |
| <span data-ttu-id="9b8b5-355">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-355">**Steps**</span></span> | <span data-ttu-id="9b8b5-356">Отсутствие принудительной политики паролей может увеличить вероятность установки слабых учетных данных в автономной базе данных.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-356">The absence of an enforced password policy may increase the likelihood of a weak credential being established in a contained database.</span></span> <span data-ttu-id="9b8b5-357">Используйте проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-357">Leverage Windows Authentication.</span></span> |

## <span data-ttu-id="9b8b5-358"><a id="authn-sas-tokens"></a>Используйте учетные данные проверки подлинности на уровне отдельного устройства с помощью маркеров SaS</span><span class="sxs-lookup"><span data-stu-id="9b8b5-358"><a id="authn-sas-tokens"></a>Use per device authentication credentials using SaS tokens</span></span>

| <span data-ttu-id="9b8b5-359">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-359">Title</span></span>                   | <span data-ttu-id="9b8b5-360">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-360">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-361">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-361">**Component**</span></span>               | <span data-ttu-id="9b8b5-362">концентратору событий Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-362">Azure Event Hub</span></span> | 
| <span data-ttu-id="9b8b5-363">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-363">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-364">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-364">Build</span></span> |  
| <span data-ttu-id="9b8b5-365">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-365">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-366">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-366">Generic</span></span> |
| <span data-ttu-id="9b8b5-367">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-367">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-368">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-368">N/A</span></span>  |
| <span data-ttu-id="9b8b5-369">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-369">**References**</span></span>              | [<span data-ttu-id="9b8b5-370">Обзор проверки подлинности концентраторов событий и модели безопасности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-370">Event Hubs authentication and security model overview</span></span>](https://azure.microsoft.com/documentation/articles/event-hubs-authentication-and-security-model-overview/) |
| <span data-ttu-id="9b8b5-371">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-371">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-372">В основе модели безопасности концентраторов событий лежит сочетание издателей событий и маркеров подписанных URL-адресов (SAS).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-372">The Event Hubs security model is based on a combination of Shared Access Signature (SAS) tokens and event publishers.</span></span> <span data-ttu-id="9b8b5-373">Имя издателя представляет идентификатор устройства, которое получает маркер.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-373">The publisher name represents the DeviceID that receives the token.</span></span> <span data-ttu-id="9b8b5-374">Это поможет связать маркеры, созданные с помощью соответствующих устройств.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-374">This would help associate the tokens generated with the respective devices.</span></span></p><p><span data-ttu-id="9b8b5-375">Все сообщения помечаются отправителем на стороне службы, что дает возможность обнаруживать попытки подделки происхождения в полезных данных.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-375">All messages are tagged with originator on service side allowing detection of in-payload origin spoofing attempts.</span></span> <span data-ttu-id="9b8b5-376">При проверке подлинности устройств создавайте маркер SaS для каждого устройства с использованием уникального издателя.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-376">When authenticating devices, generate a per device SaS token scoped to a unique publisher.</span></span></p>|

## <span data-ttu-id="9b8b5-377"><a id="multi-factor-azure-admin"></a>Включите Многофакторную идентификацию Azure для администраторов Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-377"><a id="multi-factor-azure-admin"></a>Enable Azure Multi-Factor Authentication for Azure Administrators</span></span>

| <span data-ttu-id="9b8b5-378">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-378">Title</span></span>                   | <span data-ttu-id="9b8b5-379">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-379">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-380">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-380">**Component**</span></span>               | <span data-ttu-id="9b8b5-381">Граница доверия Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-381">Azure Trust Boundary</span></span> | 
| <span data-ttu-id="9b8b5-382">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-382">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-383">Развертывание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-383">Deployment</span></span> |  
| <span data-ttu-id="9b8b5-384">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-384">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-385">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-385">Generic</span></span> |
| <span data-ttu-id="9b8b5-386">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-386">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-387">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-387">N/A</span></span>  |
| <span data-ttu-id="9b8b5-388">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-388">**References**</span></span>              | [<span data-ttu-id="9b8b5-389">Что такое Многофакторная идентификация Azure?</span><span class="sxs-lookup"><span data-stu-id="9b8b5-389">What is Azure Multi-Factor Authentication?</span></span>](https://azure.microsoft.com/documentation/articles/multi-factor-authentication/) |
| <span data-ttu-id="9b8b5-390">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-390">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-391">Многофакторная идентификация Azure (MFA) — это метод аутентификации, который требует применения более одного метода проверки и добавляет критически важный второй уровень безопасности для операций входа и транзакций пользователя.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-391">Multi-factor authentication (MFA) is a method of authentication that requires more than one verification method and adds a critical second layer of security to user sign-ins and transactions.</span></span> <span data-ttu-id="9b8b5-392">Во время работы он требует использования двух и более методов проверки следующего характера:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-392">It works by requiring any two or more of the following verification methods:</span></span></p><ul><li><span data-ttu-id="9b8b5-393">Что-то, что известно вам (обычно это пароль).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-393">Something you know (typically a password)</span></span></li><li><span data-ttu-id="9b8b5-394">Что-то, что у вас есть (доверенное устройство, которое непросто дублируется, такое как телефон).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-394">Something you have (a trusted device that is not easily duplicated, like a phone)</span></span></li><li><span data-ttu-id="9b8b5-395">Что-то, относящееся непосредственно к вам (биометрические данные).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-395">Something you are (biometrics)</span></span></li><ul>|

## <span data-ttu-id="9b8b5-396"><a id="anon-access-cluster"></a>Запретите анонимный доступ к кластеру Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-396"><a id="anon-access-cluster"></a>Restrict anonymous access to Service Fabric Cluster</span></span>

| <span data-ttu-id="9b8b5-397">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-397">Title</span></span>                   | <span data-ttu-id="9b8b5-398">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-398">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-399">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-399">**Component**</span></span>               | <span data-ttu-id="9b8b5-400">Граница доверия Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-400">Service Fabric Trust Boundary</span></span> | 
| <span data-ttu-id="9b8b5-401">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-401">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-402">Развертывание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-402">Deployment</span></span> |  
| <span data-ttu-id="9b8b5-403">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-403">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-404">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-404">Generic</span></span> |
| <span data-ttu-id="9b8b5-405">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-405">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-406">Среда: Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-406">Environment - Azure</span></span>  |
| <span data-ttu-id="9b8b5-407">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-407">**References**</span></span>              | [<span data-ttu-id="9b8b5-408">Сценарии защиты кластера Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-408">Service Fabric cluster security scenarios</span></span>](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security) |
| <span data-ttu-id="9b8b5-409">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-409">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-410">Кластеры всегда должны быть защищены для предотвращения подключения к ним неавторизованных пользователей, особенно в тех случаях, когда на кластере выполняются рабочие нагрузки в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-410">Clusters should always be secured to prevent unauthorized users from connecting to your cluster, especially when it has production workloads running on it.</span></span></p><p><span data-ttu-id="9b8b5-411">При создании кластера Service Fabric убедитесь, что для режима безопасности задано значение "seсure", и настройте требуемый сертификат сервера X.509.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-411">While creating a service fabric cluster, ensure that the security mode is set to "secure" and configure the required X.509 server certificate.</span></span> <span data-ttu-id="9b8b5-412">Создание незащищенного кластера позволит любому анонимному пользователю подключаться к нему, если конечные точки управления кластером общедоступны через Интернет.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-412">Creating an "insecure" cluster will allow any anonymous user to connect to it if it exposes management endpoints to the public Internet.</span></span></p>|

## <span data-ttu-id="9b8b5-413"><a id="fabric-cn-nn"></a>Сертификат Service Fabric для обмена данными между клиентом и узлом должен отличаться от простого сертификата для обмена данными между узлами</span><span class="sxs-lookup"><span data-stu-id="9b8b5-413"><a id="fabric-cn-nn"></a>Ensure that Service Fabric client-to-node certificate is different from node-to-node certificate</span></span>

| <span data-ttu-id="9b8b5-414">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-414">Title</span></span>                   | <span data-ttu-id="9b8b5-415">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-415">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-416">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-416">**Component**</span></span>               | <span data-ttu-id="9b8b5-417">Граница доверия Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-417">Service Fabric Trust Boundary</span></span> | 
| <span data-ttu-id="9b8b5-418">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-418">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-419">Развертывание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-419">Deployment</span></span> |  
| <span data-ttu-id="9b8b5-420">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-420">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-421">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-421">Generic</span></span> |
| <span data-ttu-id="9b8b5-422">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-422">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-423">Среда: Azure, автономная</span><span class="sxs-lookup"><span data-stu-id="9b8b5-423">Environment - Azure, Environment - Stand alone</span></span> |
| <span data-ttu-id="9b8b5-424">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-424">**References**</span></span>              | <span data-ttu-id="9b8b5-425">[Сценарии защиты кластера Service Fabric](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security/#_client-to-node-certificate-security), [Безопасное подключение к кластеру](https://azure.microsoft.com/documentation/articles/service-fabric-connect-to-secure-cluster/)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-425">[Service Fabric Client-to-node certificate security](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security/#_client-to-node-certificate-security), [Connect to a secure cluster using client certificate](https://azure.microsoft.com/documentation/articles/service-fabric-connect-to-secure-cluster/)</span></span> |
| <span data-ttu-id="9b8b5-426">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-426">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-427">Безопасность обмена данными между клиентами и узлами на основе сертификатов настраивается при создании кластера (на портале Azure, с помощью шаблонов Resource Manager или автономного шаблона JSON). Для этого указывается сертификат клиента администрирования и (или) пользовательский сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-427">Client-to-node certificate security is configured while creating the cluster either through the Azure portal, Resource Manager templates or a standalone JSON template by specifying an admin client certificate and/or a user client certificate.</span></span></p><p><span data-ttu-id="9b8b5-428">Эти сертификаты должны отличаться от основного и дополнительного сертификатов, указанных для защиты обмена данными между узлами.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-428">The admin client and user client certificates you specify should be different than the primary and secondary certificates you specify for Node-to-node security.</span></span></p>|

## <span data-ttu-id="9b8b5-429"><a id="aad-client-fabric"></a>Используйте AAD для проверки подлинности клиентов в кластерах Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-429"><a id="aad-client-fabric"></a>Use AAD to authenticate clients to service fabric clusters</span></span>

| <span data-ttu-id="9b8b5-430">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-430">Title</span></span>                   | <span data-ttu-id="9b8b5-431">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-431">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-432">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-432">**Component**</span></span>               | <span data-ttu-id="9b8b5-433">Граница доверия Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-433">Service Fabric Trust Boundary</span></span> | 
| <span data-ttu-id="9b8b5-434">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-434">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-435">Развертывание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-435">Deployment</span></span> |  
| <span data-ttu-id="9b8b5-436">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-436">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-437">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-437">Generic</span></span> |
| <span data-ttu-id="9b8b5-438">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-438">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-439">Среда: Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-439">Environment - Azure</span></span> |
| <span data-ttu-id="9b8b5-440">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-440">**References**</span></span>              | [<span data-ttu-id="9b8b5-441">Рекомендации по обеспечению безопасности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-441">Cluster security scenarios - Security Recommendations</span></span>](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security/#security-recommendations) |
| <span data-ttu-id="9b8b5-442">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-442">**Steps**</span></span> | <span data-ttu-id="9b8b5-443">Для защиты доступа к конечным точкам управления, помимо сертификатов клиентов, кластеры под управлением Azure также могут использовать Azure Active Directory (AAD).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-443">Clusters running on Azure can also secure access to the management endpoints using Azure Active Directory (AAD), apart from client certificates.</span></span> <span data-ttu-id="9b8b5-444">Чтобы обеспечить безопасность обмена данными между узлами в кластерах Azure, рекомендуется использовать безопасность AAD для аутентификации клиентов и сертификатов.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-444">For Azure clusters, it is recommended that you use AAD security to authenticate clients and certificates for node-to-node security.</span></span>|

## <span data-ttu-id="9b8b5-445"><a id="fabric-cert-ca"></a>Нужно использовать сертификаты Service Fabric, полученные из утвержденного Центра сертификации</span><span class="sxs-lookup"><span data-stu-id="9b8b5-445"><a id="fabric-cert-ca"></a>Ensure that service fabric certificates are obtained from an approved Certificate Authority (CA)</span></span>

| <span data-ttu-id="9b8b5-446">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-446">Title</span></span>                   | <span data-ttu-id="9b8b5-447">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-447">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-448">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-448">**Component**</span></span>               | <span data-ttu-id="9b8b5-449">Граница доверия Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-449">Service Fabric Trust Boundary</span></span> | 
| <span data-ttu-id="9b8b5-450">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-450">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-451">Развертывание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-451">Deployment</span></span> |  
| <span data-ttu-id="9b8b5-452">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-452">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-453">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-453">Generic</span></span> |
| <span data-ttu-id="9b8b5-454">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-454">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-455">Среда: Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-455">Environment - Azure</span></span> |
| <span data-ttu-id="9b8b5-456">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-456">**References**</span></span>              | [<span data-ttu-id="9b8b5-457">Сертификаты X.509 и Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9b8b5-457">X.509 certificates and Service Fabric</span></span>](https://azure.microsoft.com/documentation/articles/service-fabric-cluster-security/#x509-certificates-and-service-fabric) |
| <span data-ttu-id="9b8b5-458">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-458">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-459">Для проверки подлинности узлов и клиентов Service Fabric использует сертификаты сервера X.509.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-459">Service Fabric uses X.509 server certificates for authenticating nodes and clients.</span></span></p><p><span data-ttu-id="9b8b5-460">При использовании сертификатов в Service Fabric следует учитывать некоторые важные моменты:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-460">Some important things to consider while using certificates in service fabrics:</span></span></p><ul><li><span data-ttu-id="9b8b5-461">Сертификаты, которые используются в кластерах, выполняющих рабочие нагрузки в рабочей среде, следует создать с помощью правильно настроенной службы сертификации Windows Server или получить из утвержденного центра сертификации.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-461">Certificates used in clusters running production workloads should be created by using a correctly configured Windows Server certificate service or obtained from an approved Certificate Authority (CA).</span></span> <span data-ttu-id="9b8b5-462">Центр сертификации может быть утвержденным внешним центром сертификации или правильно управляемой внутренней инфраструктурой открытых ключей (PKI).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-462">The CA can be an approved external CA or a properly managed internal Public Key Infrastructure (PKI)</span></span></li><li><span data-ttu-id="9b8b5-463">Никогда не используйте в рабочей среде какие-либо временные или тестовые сертификаты, созданные с помощью таких инструментов, как MakeCert.exe.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-463">Never use any temporary or test certificates in production that are created with tools such as MakeCert.exe</span></span></li><li><span data-ttu-id="9b8b5-464">Можно использовать самозаверяющий сертификат, но это следует делать только для тестовых кластеров, а не в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-464">You can use a self-signed certificate, but should only do so for test clusters and not in production</span></span></li></ul>|

## <span data-ttu-id="9b8b5-465"><a id="standard-authn-id"></a>Используйте стандартные сценарии проверки подлинности, поддерживаемые сервером удостоверений</span><span class="sxs-lookup"><span data-stu-id="9b8b5-465"><a id="standard-authn-id"></a>Use standard authentication scenarios supported by Identity Server</span></span>

| <span data-ttu-id="9b8b5-466">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-466">Title</span></span>                   | <span data-ttu-id="9b8b5-467">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-467">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-468">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-468">**Component**</span></span>               | <span data-ttu-id="9b8b5-469">Сервер удостоверений</span><span class="sxs-lookup"><span data-stu-id="9b8b5-469">Identity Server</span></span> | 
| <span data-ttu-id="9b8b5-470">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-470">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-471">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-471">Build</span></span> |  
| <span data-ttu-id="9b8b5-472">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-472">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-473">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-473">Generic</span></span> |
| <span data-ttu-id="9b8b5-474">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-474">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-475">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-475">N/A</span></span>  |
| <span data-ttu-id="9b8b5-476">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-476">**References**</span></span>              | [<span data-ttu-id="9b8b5-477">IdentityServer3. Общая картина</span><span class="sxs-lookup"><span data-stu-id="9b8b5-477">IdentityServer3 - The Big Picture</span></span>](https://identityserver.github.io/Documentation/docsv2/overview/bigPicture.html) |
| <span data-ttu-id="9b8b5-478">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-478">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-479">Ниже приведены типичные взаимодействия, поддерживаемые сервером удостоверений.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-479">Below are the typical interactions supported by Identity Server:</span></span></p><ul><li><span data-ttu-id="9b8b5-480">Браузеры взаимодействуют с веб-приложениями.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-480">Browsers communicate with web applications</span></span></li><li><span data-ttu-id="9b8b5-481">Веб-приложения взаимодействуют с веб-API (иногда самостоятельно, иногда от имени пользователя).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-481">Web applications communicate with web APIs (sometimes on their own, sometimes on behalf of a user)</span></span></li><li><span data-ttu-id="9b8b5-482">Браузерные приложения взаимодействуют с веб-API.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-482">Browser-based applications communicate with web APIs</span></span></li><li><span data-ttu-id="9b8b5-483">Собственные приложения взаимодействуют с веб-API.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-483">Native applications communicate with web APIs</span></span></li><li><span data-ttu-id="9b8b5-484">Серверные приложения взаимодействуют с веб-API.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-484">Server-based applications communicate with web APIs</span></span></li><li><span data-ttu-id="9b8b5-485">Веб-API взаимодействуют с веб-API (иногда самостоятельно, иногда от имени пользователя).</span><span class="sxs-lookup"><span data-stu-id="9b8b5-485">Web APIs communicate with web APIs (sometimes on their own, sometimes on behalf of a user)</span></span></li></ul>|

## <span data-ttu-id="9b8b5-486"><a id="override-token"></a>Переопределите кэш маркеров сервера удостоверений по умолчанию масштабируемым альтернативным кэшем</span><span class="sxs-lookup"><span data-stu-id="9b8b5-486"><a id="override-token"></a>Override the default Identity Server token cache with a scalable alternative</span></span>

| <span data-ttu-id="9b8b5-487">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-487">Title</span></span>                   | <span data-ttu-id="9b8b5-488">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-488">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-489">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-489">**Component**</span></span>               | <span data-ttu-id="9b8b5-490">Сервер удостоверений</span><span class="sxs-lookup"><span data-stu-id="9b8b5-490">Identity Server</span></span> | 
| <span data-ttu-id="9b8b5-491">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-491">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-492">Развертывание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-492">Deployment</span></span> |  
| <span data-ttu-id="9b8b5-493">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-493">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-494">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-494">Generic</span></span> |
| <span data-ttu-id="9b8b5-495">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-495">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-496">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-496">N/A</span></span>  |
| <span data-ttu-id="9b8b5-497">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-497">**References**</span></span>              | [<span data-ttu-id="9b8b5-498">Развертывание сервера удостоверений. Кэширование</span><span class="sxs-lookup"><span data-stu-id="9b8b5-498">Identity Server Deployment - Caching</span></span>](https://identityserver.github.io/Documentation/docsv2/advanced/deployment.html) |
| <span data-ttu-id="9b8b5-499">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-499">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-500">Сервер удостоверений имеет простой встроенный кэш, работающий в памяти.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-500">IdentityServer has a simple built-in in-memory cache.</span></span> <span data-ttu-id="9b8b5-501">Хотя он хорошо подходит для небольших собственных приложений, он не масштабируется для приложений среднего уровня и приложений уровня сервера по следующим причинам.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-501">While this is good for small scale native apps, it does not scale for mid tier and backend applications for the following reasons:</span></span></p><ul><li><span data-ttu-id="9b8b5-502">Доступ к этим приложениям осуществляют несколько пользователей одновременно.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-502">These applications are accessed by many users at once.</span></span> <span data-ttu-id="9b8b5-503">Если сохранять все маркеры доступа в одном хранилище, могут возникнуть трудности с изоляцией, которые вызовут проблемы при увеличении масштаба. При множестве пользователей с количеством маркеров, равным количеству ресурсов, к которым приложение обращается от их имени, может стать больше ресурсоемких операций поиска сопоставлений.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-503">Saving all access tokens in the same store creates isolation issues and presents challenges when operating at scale: many users, each with as many tokens as the resources the app accesses on their behalf, can mean huge numbers and very expensive lookup operations</span></span></li><li><span data-ttu-id="9b8b5-504">Эти приложения обычно развертываются в распределенной топологии, где несколько узлов должны иметь доступ к одному кэшу.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-504">These applications are typically deployed on distributed topologies, where multiple nodes must have access to the same cache</span></span></li><li><span data-ttu-id="9b8b5-505">Кэшированные маркеры должны выдерживать перезапуски и деактивации процесса.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-505">Cached tokens must survive process recycles and deactivations</span></span></li><li><span data-ttu-id="9b8b5-506">По указанным выше причинам при реализации веб-приложений рекомендуется переопределить кэш маркеров сервера удостоверений по умолчанию масштабируемым альтернативным кэшем, например кэшем Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-506">For all the above reasons, while implementing web apps, it is recommended to override the default Identity Server's token cache with a scalable alternative such as Azure Redis cache</span></span></li></ul>|

## <span data-ttu-id="9b8b5-507"><a id="binaries-signed"></a>Двоичные файлы развернутого приложения должны иметь цифровую подпись</span><span class="sxs-lookup"><span data-stu-id="9b8b5-507"><a id="binaries-signed"></a>Ensure that deployed application's binaries are digitally signed</span></span>

| <span data-ttu-id="9b8b5-508">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-508">Title</span></span>                   | <span data-ttu-id="9b8b5-509">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-509">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-510">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-510">**Component**</span></span>               | <span data-ttu-id="9b8b5-511">Отношения доверия между компьютерами</span><span class="sxs-lookup"><span data-stu-id="9b8b5-511">Machine Trust Boundary</span></span> | 
| <span data-ttu-id="9b8b5-512">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-512">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-513">Развертывание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-513">Deployment</span></span> |  
| <span data-ttu-id="9b8b5-514">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-514">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-515">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-515">Generic</span></span> |
| <span data-ttu-id="9b8b5-516">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-516">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-517">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-517">N/A</span></span>  |
| <span data-ttu-id="9b8b5-518">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-518">**References**</span></span>              | <span data-ttu-id="9b8b5-519">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-519">N/A</span></span>  |
| <span data-ttu-id="9b8b5-520">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-520">**Steps**</span></span> | <span data-ttu-id="9b8b5-521">Убедитесь, что все двоичные файлы развернутого приложения имеют цифровую подпись, что дает возможность проверить их целостность.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-521">Ensure that deployed application's binaries are digitally signed so that the integrity of the binaries can be verified</span></span>|

## <span data-ttu-id="9b8b5-522"><a id="msmq-queues"></a>Включите проверку подлинности при подключении к очередям MSMQ в WCF</span><span class="sxs-lookup"><span data-stu-id="9b8b5-522"><a id="msmq-queues"></a>Enable authentication when connecting to MSMQ queues in WCF</span></span>

| <span data-ttu-id="9b8b5-523">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-523">Title</span></span>                   | <span data-ttu-id="9b8b5-524">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-524">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-525">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-525">**Component**</span></span>               | <span data-ttu-id="9b8b5-526">WCF</span><span class="sxs-lookup"><span data-stu-id="9b8b5-526">WCF</span></span> | 
| <span data-ttu-id="9b8b5-527">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-527">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-528">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-528">Build</span></span> |  
| <span data-ttu-id="9b8b5-529">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-529">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-530">Универсальные, .NET Framework 3</span><span class="sxs-lookup"><span data-stu-id="9b8b5-530">Generic, NET Framework 3</span></span> |
| <span data-ttu-id="9b8b5-531">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-531">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-532">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-532">N/A</span></span> |
| <span data-ttu-id="9b8b5-533">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-533">**References**</span></span>              | [<span data-ttu-id="9b8b5-534">MSDN</span><span class="sxs-lookup"><span data-stu-id="9b8b5-534">MSDN</span></span>](https://msdn.microsoft.com/library/ff648500.aspx) |
| <span data-ttu-id="9b8b5-535">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-535">**Steps**</span></span> | <span data-ttu-id="9b8b5-536">Если при подключении к очередям MSMQ программе не удается включить проверку подлинности, злоумышленник может анонимно отправить сообщения в очередь для обработки.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-536">Program fails to enable authentication when connecting to MSMQ queues, an attacker can anonymously submit messages to the queue for processing.</span></span> <span data-ttu-id="9b8b5-537">Если для подключения к очереди MSMQ, которая используется для доставки сообщения в другую программу, проверка подлинности отсутствует, злоумышленник может анонимно отправить вредоносное сообщение.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-537">If authentication is not used to connect to an MSMQ queue used to deliver a message to another program, an attacker could submit an anonymous message that is malicious.</span></span>|

### <a name="example"></a><span data-ttu-id="9b8b5-538">Пример</span><span class="sxs-lookup"><span data-stu-id="9b8b5-538">Example</span></span>
<span data-ttu-id="9b8b5-539">Элемент `<netMsmqBinding/>` расположенного ниже файла конфигурации WCF указывает WCF отключить проверку подлинности при подключении к очереди MSMQ для доставки сообщений.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-539">The `<netMsmqBinding/>` element of the WCF configuration file below instructs WCF to disable authentication when connecting to an MSMQ queue for message delivery.</span></span>
```
<bindings>
    <netMsmqBinding>
        <binding>
            <security>
                <transport msmqAuthenticationMode=""None"" />
            </security>
        </binding>
    </netMsmqBinding>
</bindings>
```
<span data-ttu-id="9b8b5-540">Настройте в MSMQ обязательную проверку подлинности сертификата или домена Windows для всех входящих или исходящих сообщений.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-540">Configure MSMQ to require Windows Domain or Certificate authentication at all times for any incoming or outgoing messages.</span></span>

### <a name="example"></a><span data-ttu-id="9b8b5-541">Пример</span><span class="sxs-lookup"><span data-stu-id="9b8b5-541">Example</span></span>
<span data-ttu-id="9b8b5-542">Элемент `<netMsmqBinding/>` расположенного ниже файла конфигурации WCF указывает WCF включить проверку подлинности сертификата при подключении к очереди MSMQ.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-542">The `<netMsmqBinding/>` element of the WCF configuration file below instructs WCF to enable certificate authentication when connecting to an MSMQ queue.</span></span> <span data-ttu-id="9b8b5-543">Клиент проходит проверку подлинности с использованием сертификатов X.509.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-543">The client is authenticated using X.509 certificates.</span></span> <span data-ttu-id="9b8b5-544">Сертификат клиента должен присутствовать в хранилище сертификатов сервера.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-544">The client certificate must be present in the certificate store of the server.</span></span>
```
<bindings>
    <netMsmqBinding>
        <binding>
            <security>
                <transport msmqAuthenticationMode=""Certificate"" />
            </security>
        </binding>
    </netMsmqBinding>
</bindings>
```

## <span data-ttu-id="9b8b5-545"><a id="message-none"></a>WCF: не присваивайте атрибуту message clientCredentialType значение None</span><span class="sxs-lookup"><span data-stu-id="9b8b5-545"><a id="message-none"></a>WCF-Do not set Message clientCredentialType to none</span></span>

| <span data-ttu-id="9b8b5-546">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-546">Title</span></span>                   | <span data-ttu-id="9b8b5-547">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-547">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-548">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-548">**Component**</span></span>               | <span data-ttu-id="9b8b5-549">WCF</span><span class="sxs-lookup"><span data-stu-id="9b8b5-549">WCF</span></span> | 
| <span data-ttu-id="9b8b5-550">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-550">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-551">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-551">Build</span></span> |  
| <span data-ttu-id="9b8b5-552">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-552">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-553">.NET Framework 3</span><span class="sxs-lookup"><span data-stu-id="9b8b5-553">.NET Framework 3</span></span> |
| <span data-ttu-id="9b8b5-554">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-554">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-555">Тип учетных данных клиента: None</span><span class="sxs-lookup"><span data-stu-id="9b8b5-555">Client Credential Type - None</span></span> |
| <span data-ttu-id="9b8b5-556">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-556">**References**</span></span>              | <span data-ttu-id="9b8b5-557">[MSDN](https://msdn.microsoft.com/library/ff648500.aspx), [Fortify](https://vulncat.fortify.com/en/vulncat/index.html)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-557">[MSDN](https://msdn.microsoft.com/library/ff648500.aspx), [Fortify](https://vulncat.fortify.com/en/vulncat/index.html)</span></span> |
| <span data-ttu-id="9b8b5-558">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-558">**Steps**</span></span> | <span data-ttu-id="9b8b5-559">Отсутствие проверки подлинности означает, что каждый может получить доступ к этой службе.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-559">The absence of authentication means everyone is able to access this service.</span></span> <span data-ttu-id="9b8b5-560">Служба, которая не выполняет проверку подлинности своих клиентов, предоставляет доступ всем пользователям.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-560">A service that does not authenticate its clients allows access to all users.</span></span> <span data-ttu-id="9b8b5-561">Настройте в приложении проверку подлинности учетных данных клиента.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-561">Configure the application to authenticate against client credentials.</span></span> <span data-ttu-id="9b8b5-562">Это можно сделать, задав для атрибута message clientCredentialType значение Windows или Certificate.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-562">This can be done by setting the message clientCredentialType to Windows or Certificate.</span></span> |

### <a name="example"></a><span data-ttu-id="9b8b5-563">Пример</span><span class="sxs-lookup"><span data-stu-id="9b8b5-563">Example</span></span>
```
<message clientCredentialType=""Certificate""/>
```

## <span data-ttu-id="9b8b5-564"><a id="transport-none"></a>WCF: не присваивайте атрибуту transport clientCredentialType значение None</span><span class="sxs-lookup"><span data-stu-id="9b8b5-564"><a id="transport-none"></a>WCF-Do not set Transport clientCredentialType to none</span></span>

| <span data-ttu-id="9b8b5-565">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-565">Title</span></span>                   | <span data-ttu-id="9b8b5-566">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-566">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-567">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-567">**Component**</span></span>               | <span data-ttu-id="9b8b5-568">WCF</span><span class="sxs-lookup"><span data-stu-id="9b8b5-568">WCF</span></span> | 
| <span data-ttu-id="9b8b5-569">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-569">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-570">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-570">Build</span></span> |  
| <span data-ttu-id="9b8b5-571">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-571">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-572">Универсальные, .NET Framework 3</span><span class="sxs-lookup"><span data-stu-id="9b8b5-572">Generic, .NET Framework 3</span></span> |
| <span data-ttu-id="9b8b5-573">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-573">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-574">Тип учетных данных клиента: None</span><span class="sxs-lookup"><span data-stu-id="9b8b5-574">Client Credential Type - None</span></span> |
| <span data-ttu-id="9b8b5-575">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-575">**References**</span></span>              | <span data-ttu-id="9b8b5-576">[MSDN](https://msdn.microsoft.com/library/ff648500.aspx), [Fortify](https://vulncat.fortify.com/en/vulncat/index.html)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-576">[MSDN](https://msdn.microsoft.com/library/ff648500.aspx), [Fortify](https://vulncat.fortify.com/en/vulncat/index.html)</span></span> |
| <span data-ttu-id="9b8b5-577">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-577">**Steps**</span></span> | <span data-ttu-id="9b8b5-578">Отсутствие проверки подлинности означает, что каждый может получить доступ к этой службе.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-578">The absence of authentication means everyone is able to access this service.</span></span> <span data-ttu-id="9b8b5-579">Служба, которая не выполняет проверку подлинности своих клиентов, предоставляет доступ к своим функциям всем пользователям.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-579">A service that does not authenticate its clients allows all users to access its functionality.</span></span> <span data-ttu-id="9b8b5-580">Настройте в приложении проверку подлинности учетных данных клиента.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-580">Configure the application to authenticate against client credentials.</span></span> <span data-ttu-id="9b8b5-581">Это можно сделать, задав для атрибута transport clientCredentialType значение Windows или Certificate.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-581">This can be done by setting the transport clientCredentialType to Windows or Certificate.</span></span> |

### <a name="example"></a><span data-ttu-id="9b8b5-582">Пример</span><span class="sxs-lookup"><span data-stu-id="9b8b5-582">Example</span></span>
```
<transport clientCredentialType=""Certificate""/>
```

## <span data-ttu-id="9b8b5-583"><a id="authn-secure-api"></a>Для защиты веб-API нужно использовать стандартные методы проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-583"><a id="authn-secure-api"></a>Ensure that standard authentication techniques are used to secure Web APIs</span></span>

| <span data-ttu-id="9b8b5-584">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-584">Title</span></span>                   | <span data-ttu-id="9b8b5-585">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-585">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-586">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-586">**Component**</span></span>               | <span data-ttu-id="9b8b5-587">Веб-интерфейс API</span><span class="sxs-lookup"><span data-stu-id="9b8b5-587">Web API</span></span> | 
| <span data-ttu-id="9b8b5-588">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-588">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-589">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-589">Build</span></span> |  
| <span data-ttu-id="9b8b5-590">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-590">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-591">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-591">Generic</span></span> |
| <span data-ttu-id="9b8b5-592">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-592">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-593">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-593">N/A</span></span>  |
| <span data-ttu-id="9b8b5-594">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-594">**References**</span></span>              | <span data-ttu-id="9b8b5-595">[Проверка подлинности и авторизация в веб-API ASP.NET](http://www.asp.net/web-api/overview/security/authentication-and-authorization-in-aspnet-web-api), [сведения о внешних службах проверки подлинности с веб-API ASP.NET (C#)](http://www.asp.net/web-api/overview/security/external-authentication-services)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-595">[Authentication and Authorization in ASP.NET Web API](http://www.asp.net/web-api/overview/security/authentication-and-authorization-in-aspnet-web-api), [External Authentication Services with ASP.NET Web API (C#)](http://www.asp.net/web-api/overview/security/external-authentication-services)</span></span> |
| <span data-ttu-id="9b8b5-596">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-596">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-597">Проверка подлинности — это процесс, во время которого сущность подтверждает свою подлинность с помощью учетных данных, таких как имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-597">Authentication is the process where an entity proves its identity, typically through credentials, such as a user name and password.</span></span> <span data-ttu-id="9b8b5-598">Существует множество протоколов проверки подлинности,</span><span class="sxs-lookup"><span data-stu-id="9b8b5-598">There are multiple authentication protocols available which may be considered.</span></span> <span data-ttu-id="9b8b5-599">включая следующие:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-599">Some of them are listed below:</span></span></p><ul><li><span data-ttu-id="9b8b5-600">Client certificates</span><span class="sxs-lookup"><span data-stu-id="9b8b5-600">Client certificates</span></span></li><li><span data-ttu-id="9b8b5-601">на основе Windows;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-601">Windows based</span></span></li><li><span data-ttu-id="9b8b5-602">на основе форм;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-602">Forms based</span></span></li><li><span data-ttu-id="9b8b5-603">федерация: ADFS;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-603">Federation - ADFS</span></span></li><li><span data-ttu-id="9b8b5-604">федерация: Azure AD;</span><span class="sxs-lookup"><span data-stu-id="9b8b5-604">Federation - Azure AD</span></span></li><li><span data-ttu-id="9b8b5-605">федерация: сервер удостоверений.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-605">Federation - Identity Server</span></span></li></ul><p><span data-ttu-id="9b8b5-606">Ссылки в разделе справочных сведений предоставляют низкоуровневые сведения о том, как можно реализовать каждую схему проверки подлинности для защиты веб-API.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-606">Links in the references section provide low-level details on how each of the authentication schemes can be implemented to secure a Web API.</span></span></p>|

## <span data-ttu-id="9b8b5-607"><a id="authn-aad"></a>Используйте стандартные сценарии проверки подлинности, поддерживаемые Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9b8b5-607"><a id="authn-aad"></a>Use standard authentication scenarios supported by Azure Active Directory</span></span>

| <span data-ttu-id="9b8b5-608">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-608">Title</span></span>                   | <span data-ttu-id="9b8b5-609">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-609">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-610">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-610">**Component**</span></span>               | <span data-ttu-id="9b8b5-611">Azure AD</span><span class="sxs-lookup"><span data-stu-id="9b8b5-611">Azure AD</span></span> | 
| <span data-ttu-id="9b8b5-612">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-612">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-613">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-613">Build</span></span> |  
| <span data-ttu-id="9b8b5-614">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-614">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-615">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-615">Generic</span></span> |
| <span data-ttu-id="9b8b5-616">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-616">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-617">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-617">N/A</span></span>  |
| <span data-ttu-id="9b8b5-618">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-618">**References**</span></span>              | <span data-ttu-id="9b8b5-619">[Сценарии аутентификации в Azure Active Directory](https://azure.microsoft.com/documentation/articles/active-directory-authentication-scenarios/), [Примеры кода Azure Active Directory](https://azure.microsoft.com/documentation/articles/active-directory-code-samples/), [Руководство разработчика по Azure Active Directory](https://azure.microsoft.com/documentation/articles/active-directory-developers-guide/)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-619">[Authentication Scenarios for Azure AD](https://azure.microsoft.com/documentation/articles/active-directory-authentication-scenarios/), [Azure Active Directory Code Samples](https://azure.microsoft.com/documentation/articles/active-directory-code-samples/), [Azure Active Directory developer's guide](https://azure.microsoft.com/documentation/articles/active-directory-developers-guide/)</span></span> |
| <span data-ttu-id="9b8b5-620">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-620">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-621">Azure Active Directory (Azure AD) упрощает аутентификацию для разработчиков, предоставляя удостоверение как услугу, благодаря поддержке стандартных протоколов, например OAuth 2.0 и OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-621">Azure Active Directory (Azure AD) simplifies authentication for developers by providing identity as a service, with support for industry-standard protocols such as OAuth 2.0 and OpenID Connect.</span></span> <span data-ttu-id="9b8b5-622">Ниже приведены пять основных сценариев приложений, которые поддерживает служба Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-622">Below are the five primary application scenarios supported by Azure AD:</span></span></p><ul><li><span data-ttu-id="9b8b5-623">Из веб-браузера в веб-приложение. Пользователю нужно войти в веб-приложение, защиту которого выполняет Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-623">Web Browser to Web Application: A user needs to sign in to a web application that is secured by Azure AD</span></span></li><li><span data-ttu-id="9b8b5-624">Одностраничное приложение (SPA). Пользователю нужно войти в одностраничное приложение, защиту которого выполняет Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-624">Single Page Application (SPA): A user needs to sign in to a single page application that is secured by Azure AD</span></span></li><li><span data-ttu-id="9b8b5-625">Из собственного приложения в веб-интерфейс API. Собственному приложению, которое выполняется на телефоне, планшете или ПК, требуется проверить подлинность пользователя для получения ресурсов из веб-интерфейса API, защиту которого обеспечивает Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-625">Native Application to Web API: A native application that runs on a phone, tablet, or PC needs to authenticate a user to get resources from a web API that is secured by Azure AD</span></span></li><li><span data-ttu-id="9b8b5-626">Из веб-приложения в веб-интерфейс API. Веб-приложению требуется получать ресурсы из веб-интерфейса API, защиту которого обеспечивает Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-626">Web Application to Web API: A web application needs to get resources from a web API secured by Azure AD</span></span></li><li><span data-ttu-id="9b8b5-627">Из управляющей программы или серверного приложения в веб-интерфейс API. Управляющей программе (демону) или серверному приложению, в котором нет веб-интерфейса пользователя, требуется получить ресурсы из веб-интерфейса API, защиту которого обеспечивает Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-627">Daemon or Server Application to Web API: A daemon application or a server application with no web user interface needs to get resources from a web API secured by Azure AD</span></span></li></ul><p><span data-ttu-id="9b8b5-628">Используйте ссылки в разделе справочных сведений, чтобы получить низкоуровневые сведения о реализации.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-628">Please refer to the links in the references section for low-level implementation details</span></span></p>|

## <span data-ttu-id="9b8b5-629"><a id="adal-scalable"></a>Переопределите кэш маркера ADAL по умолчанию масштабируемым альтернативным кэшем</span><span class="sxs-lookup"><span data-stu-id="9b8b5-629"><a id="adal-scalable"></a>Override the default ADAL token cache with a scalable alternative</span></span>

| <span data-ttu-id="9b8b5-630">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-630">Title</span></span>                   | <span data-ttu-id="9b8b5-631">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-631">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-632">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-632">**Component**</span></span>               | <span data-ttu-id="9b8b5-633">Azure AD</span><span class="sxs-lookup"><span data-stu-id="9b8b5-633">Azure AD</span></span> | 
| <span data-ttu-id="9b8b5-634">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-634">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-635">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-635">Build</span></span> |  
| <span data-ttu-id="9b8b5-636">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-636">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-637">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-637">Generic</span></span> |
| <span data-ttu-id="9b8b5-638">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-638">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-639">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-639">N/A</span></span>  |
| <span data-ttu-id="9b8b5-640">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-640">**References**</span></span>              | <span data-ttu-id="9b8b5-641">[Современная проверка подлинности с помощью Azure Active Directory для веб-приложений](https://blogs.msdn.microsoft.com/microsoft_press/2016/01/04/new-book-modern-authentication-with-azure-active-directory-for-web-applications/), [запись блога об использовании Redis в качестве кэша маркеров ADAL](https://blogs.msdn.microsoft.com/mrochon/2016/09/19/using-redis-as-adal-token-cache/)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-641">[Modern Authentication with Azure Active Directory for Web Applications](https://blogs.msdn.microsoft.com/microsoft_press/2016/01/04/new-book-modern-authentication-with-azure-active-directory-for-web-applications/), [Using Redis as ADAL token cache](https://blogs.msdn.microsoft.com/mrochon/2016/09/19/using-redis-as-adal-token-cache/)</span></span>  |
| <span data-ttu-id="9b8b5-642">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-642">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-643">Кэш по умолчанию, который использует ADAL, — это работающий в памяти кэш, который зависит от статического хранилища и доступен на уровне процессов.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-643">The default cache that ADAL (Active Directory Authentication Library) uses is an in-memory cache that relies on a static store, available process-wide.</span></span> <span data-ttu-id="9b8b5-644">Хотя он подходит для собственных приложений, он не масштабируется для приложений среднего уровня и приложений уровня сервера по следующим причинам.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-644">While this works for native applications, it does not scale for mid tier and backend applications for the following reasons:</span></span></p><ul><li><span data-ttu-id="9b8b5-645">Доступ к этим приложениям осуществляют несколько пользователей одновременно.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-645">These applications are accessed by many users at once.</span></span> <span data-ttu-id="9b8b5-646">Если сохранять все маркеры доступа в одном хранилище, могут возникнуть трудности с изоляцией, которые вызовут проблемы при увеличении масштаба. При множестве пользователей с количеством маркеров, равным количеству ресурсов, к которым приложение обращается от их имени, может стать больше ресурсоемких операций поиска сопоставлений.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-646">Saving all access tokens in the same store creates isolation issues and presents challenges when operating at scale: many users, each with as many tokens as the resources the app accesses on their behalf, can mean huge numbers and very expensive lookup operations</span></span></li><li><span data-ttu-id="9b8b5-647">Эти приложения обычно развертываются в распределенной топологии, где несколько узлов должны иметь доступ к одному кэшу.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-647">These applications are typically deployed on distributed topologies, where multiple nodes must have access to the same cache</span></span></li><li><span data-ttu-id="9b8b5-648">Кэшированные маркеры должны выдерживать перезапуски и деактивации процесса.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-648">Cached tokens must survive process recycles and deactivations</span></span></li></ul><p><span data-ttu-id="9b8b5-649">По указанным выше причинам при реализации веб-приложений рекомендуется переопределить кэш маркеров ADAL по умолчанию масштабируемым альтернативным кэшем, например кэшем Redis для Azure.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-649">For all the above reasons, while implementing web apps, it is recommended to override the default ADAL token cache with a scalable alternative such as Azure Redis cache.</span></span></p>|

## <span data-ttu-id="9b8b5-650"><a id="tokenreplaycache-adal"></a>Для предотвращения воспроизведения маркеров проверки подлинности ADAL нужно использовать свойство TokenReplayCache</span><span class="sxs-lookup"><span data-stu-id="9b8b5-650"><a id="tokenreplaycache-adal"></a>Ensure that TokenReplayCache is used to prevent the replay of ADAL authentication tokens</span></span>

| <span data-ttu-id="9b8b5-651">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-651">Title</span></span>                   | <span data-ttu-id="9b8b5-652">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-652">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-653">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-653">**Component**</span></span>               | <span data-ttu-id="9b8b5-654">Azure AD</span><span class="sxs-lookup"><span data-stu-id="9b8b5-654">Azure AD</span></span> | 
| <span data-ttu-id="9b8b5-655">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-655">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-656">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-656">Build</span></span> |  
| <span data-ttu-id="9b8b5-657">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-657">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-658">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-658">Generic</span></span> |
| <span data-ttu-id="9b8b5-659">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-659">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-660">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-660">N/A</span></span>  |
| <span data-ttu-id="9b8b5-661">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-661">**References**</span></span>              | [<span data-ttu-id="9b8b5-662">Современная проверка подлинности с помощью Azure Active Directory для веб-приложений</span><span class="sxs-lookup"><span data-stu-id="9b8b5-662">Modern Authentication with Azure Active Directory for Web Applications</span></span>](https://blogs.msdn.microsoft.com/microsoft_press/2016/01/04/new-book-modern-authentication-with-azure-active-directory-for-web-applications/) |
| <span data-ttu-id="9b8b5-663">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-663">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-664">Свойство TokenReplayCache позволяет разработчикам определять кэш воспроизведения маркеров, хранилище, которое можно использовать для сохранения маркеров, чтобы предотвратить использование повторяющихся маркеров.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-664">The TokenReplayCache property allows developers to define a token replay cache, a store that can be used for saving tokens for the purpose of verifying that no token can be used more than once.</span></span></p><p><span data-ttu-id="9b8b5-665">Эта мера защиты от распространенных атак с использованием воспроизведения маркеров. Злоумышленник, который перехватывает маркер, отправленный при входе в систему, может попытаться снова отправить его в приложение ("воспроизвести" его), чтобы создать новый сеанс.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-665">This is a measure against a common attack, the aptly called token replay attack: an attacker intercepting the token sent at sign-in might try to send it to the app again (“replay” it) for establishing a new session.</span></span> <span data-ttu-id="9b8b5-666">Например, в потоке предоставления кода OIDC после успешной проверки подлинности пользователя запрос к конечной точке "/signin-oidc" проверяющей стороны выполняется с параметрами "id_token", "code" и "state".</span><span class="sxs-lookup"><span data-stu-id="9b8b5-666">E.g., In OIDC code-grant flow, after successful user authentication, a request to "/signin-oidc" endpoint of the relying party is made with "id_token", "code" and "state" parameters.</span></span></p><p><span data-ttu-id="9b8b5-667">Проверяющая сторона проверяет запрос и создает новый сеанс.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-667">The relying party validates this request and establishes a new session.</span></span> <span data-ttu-id="9b8b5-668">Если злоумышленник перехватил и воспроизвел этот запрос, он может успешно создать сеанс, выдав себя за пользователя.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-668">If an adversary captures this request and replays it, he/she can establish a successful session and spoof the user.</span></span> <span data-ttu-id="9b8b5-669">Наличие специального утверждения в OpenID Connect может ограничить, но не полностью исключить подобные атаки.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-669">The presence of the nonce in OpenID Connect can limit but not fully eliminate the circumstances in which the attack can be successfully enacted.</span></span> <span data-ttu-id="9b8b5-670">Чтобы защитить свои приложения, разработчики могут реализовать интерфейс ITokenReplayCache и присвоить экземпляр свойству TokenReplayCache.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-670">To protect their applications, developers can provide an implementation of ITokenReplayCache and assign an instance to TokenReplayCache.</span></span></p>|

### <a name="example"></a><span data-ttu-id="9b8b5-671">Пример</span><span class="sxs-lookup"><span data-stu-id="9b8b5-671">Example</span></span>
```C#
// ITokenReplayCache defined in ADAL
public interface ITokenReplayCache
{
bool TryAdd(string securityToken, DateTime expiresOn);
bool TryFind(string securityToken);
}
```

### <a name="example"></a><span data-ttu-id="9b8b5-672">Пример</span><span class="sxs-lookup"><span data-stu-id="9b8b5-672">Example</span></span>
<span data-ttu-id="9b8b5-673">Ниже приведен пример реализации интерфейса ITokenReplayCache.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-673">Here is a sample implementation of the ITokenReplayCache interface.</span></span> <span data-ttu-id="9b8b5-674">(Выполните соответствующие настройки и реализуйте платформу кэширования конкретного проекта.)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-674">(Please customize and implement your project-specific caching framework)</span></span>
```C#
public class TokenReplayCache : ITokenReplayCache
{
    private readonly ICacheProvider cache; // Your project-specific cache provider
    public TokenReplayCache(ICacheProvider cache)
    {
        this.cache = cache;
    }
    public bool TryAdd(string securityToken, DateTime expiresOn)
    {
        if (this.cache.Get<string>(securityToken) == null)
        {
            this.cache.Set(securityToken, securityToken);
            return true;
        }
        return false;
    }
    public bool TryFind(string securityToken)
    {
        return this.cache.Get<string>(securityToken) != null;
    }
}
```
<span data-ttu-id="9b8b5-675">Ссылку на реализованный кэш нужно добавить в параметрах OIDC с помощью свойства TokenValidationParameters следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-675">The implemented cache has to be referenced in OIDC options via the "TokenValidationParameters" property as follows.</span></span>
```C#
OpenIdConnectOptions openIdConnectOptions = new OpenIdConnectOptions
{
    AutomaticAuthenticate = true,
    ... // other configuration properties follow..
    TokenValidationParameters = new TokenValidationParameters
    {
        TokenReplayCache = new TokenReplayCache(/*Inject your cache provider*/);
    }
}
```

<span data-ttu-id="9b8b5-676">Чтобы проверить эффективность данной конфигурации, войдите в локальное приложение, защищенное с помощью OIDC, и запишите запрос к конечной точке `"/signin-oidc"` в Fiddler.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-676">Please note that to test the effectiveness of this configuration, login into your local OIDC-protected application and capture the request to `"/signin-oidc"` endpoint in fiddler.</span></span> <span data-ttu-id="9b8b5-677">Если защита не включена, воспроизведение этого запроса в Fiddler приведет к созданию нового файла cookie сеанса.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-677">When the protection is not in place, replaying this request in fiddler will set a new session cookie.</span></span> <span data-ttu-id="9b8b5-678">При воспроизведении запроса после добавления защиты с помощью свойства TokenReplayCache приложение выдаст исключение следующего типа: `SecurityTokenReplayDetectedException: IDX10228: The securityToken has previously been validated, securityToken: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ1......`</span><span class="sxs-lookup"><span data-stu-id="9b8b5-678">When the request is replayed after the TokenReplayCache protection is added, the application will throw an exception as follows: `SecurityTokenReplayDetectedException: IDX10228: The securityToken has previously been validated, securityToken: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ1......`</span></span>

## <span data-ttu-id="9b8b5-679"><a id="adal-oauth2"></a>Используйте библиотеки ADAL для управления запросами маркеров от клиентов OAuth2 к AAD (или к локальной службе AD)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-679"><a id="adal-oauth2"></a>Use ADAL libraries to manage token requests from OAuth2 clients to AAD (or on-premises AD)</span></span>

| <span data-ttu-id="9b8b5-680">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-680">Title</span></span>                   | <span data-ttu-id="9b8b5-681">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-681">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-682">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-682">**Component**</span></span>               | <span data-ttu-id="9b8b5-683">Azure AD</span><span class="sxs-lookup"><span data-stu-id="9b8b5-683">Azure AD</span></span> | 
| <span data-ttu-id="9b8b5-684">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-684">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-685">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-685">Build</span></span> |  
| <span data-ttu-id="9b8b5-686">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-686">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-687">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-687">Generic</span></span> |
| <span data-ttu-id="9b8b5-688">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-688">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-689">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-689">N/A</span></span>  |
| <span data-ttu-id="9b8b5-690">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-690">**References**</span></span>              | [<span data-ttu-id="9b8b5-691">ADAL</span><span class="sxs-lookup"><span data-stu-id="9b8b5-691">ADAL</span></span>](https://azure.microsoft.com/documentation/articles/active-directory-authentication-libraries/) |
| <span data-ttu-id="9b8b5-692">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-692">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-693">Библиотека проверки подлинности Azure AD (ADAL) позволяет разработчикам клиентских приложений легко проверять подлинность пользователей в облачной или локальной Active Directory (AD) и получать маркеры доступа для защиты вызовов API.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-693">The Azure AD authentication Library (ADAL) enables client application developers to easily authenticate users to cloud or on-premises Active Directory (AD), and then obtain access tokens for securing API calls.</span></span></p><p><span data-ttu-id="9b8b5-694">ADAL имеет множество функций, которые упрощают проверку подлинности для разработчиков. К ним относятся поддержка асинхронных операций, настраиваемый кэш маркеров, в котором хранятся маркеры доступа и маркеры обновления, автоматическое обновление маркера, когда срок действия маркера доступа истекает и маркер обновления доступен, и многие другие функции.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-694">ADAL has many features that make authentication easier for developers, such as asynchronous support, a configurable token cache that stores access tokens and refresh tokens, automatic token refresh when an access token expires and a refresh token is available, and more.</span></span></p><p><span data-ttu-id="9b8b5-695">ADAL берет на себя большую часть сложных операций и позволяет разработчику сосредоточиться на бизнес-логике своего приложения и легко защитить ресурсы, не будучи экспертом в области безопасности.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-695">By handling most of the complexity, ADAL can help a developer focus on business logic in their application and easily secure resources without being an expert on security.</span></span> <span data-ttu-id="9b8b5-696">Отдельные библиотеки доступны для .NET, JavaScript (клиент и Node.js), iOS, Android и Java.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-696">Separate libraries are available for .NET, JavaScript (client and Node.js), iOS, Android and Java.</span></span></p>|

## <span data-ttu-id="9b8b5-697"><a id="authn-devices-field"></a>Проверяйте подлинность устройств, подключаемых к полевому шлюзу</span><span class="sxs-lookup"><span data-stu-id="9b8b5-697"><a id="authn-devices-field"></a>Authenticate devices connecting to the Field Gateway</span></span>

| <span data-ttu-id="9b8b5-698">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-698">Title</span></span>                   | <span data-ttu-id="9b8b5-699">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-699">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-700">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-700">**Component**</span></span>               | <span data-ttu-id="9b8b5-701">Полевой шлюз Интернета вещей</span><span class="sxs-lookup"><span data-stu-id="9b8b5-701">IoT Field Gateway</span></span> | 
| <span data-ttu-id="9b8b5-702">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-702">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-703">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-703">Build</span></span> |  
| <span data-ttu-id="9b8b5-704">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-704">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-705">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-705">Generic</span></span> |
| <span data-ttu-id="9b8b5-706">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-706">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-707">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-707">N/A</span></span>  |
| <span data-ttu-id="9b8b5-708">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-708">**References**</span></span>              | <span data-ttu-id="9b8b5-709">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-709">N/A</span></span>  |
| <span data-ttu-id="9b8b5-710">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-710">**Steps**</span></span> | <span data-ttu-id="9b8b5-711">Настройте полевой шлюз таким образом, чтобы он выполнял проверку подлинности каждого устройства, прежде чем получать от них данные и упрощать взаимодействие вышестоящих объектов с облачным шлюзом.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-711">Ensure that each device is authenticated by the Field Gateway before accepting data from them and before facilitating upstream communications with the Cloud Gateway.</span></span> <span data-ttu-id="9b8b5-712">Кроме того, настройте подключение устройств с помощью учетных данных на уровне отдельного устройства, чтобы уникально идентифицировать отдельные устройства.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-712">Also, ensure that devices connect with a per device credential so that individual devices can be uniquely identified.</span></span>|

## <span data-ttu-id="9b8b5-713"><a id="authn-devices-cloud"></a>Устройства, подключаемые к облачному шлюзу, должны проходить проверку подлинности</span><span class="sxs-lookup"><span data-stu-id="9b8b5-713"><a id="authn-devices-cloud"></a>Ensure that devices connecting to Cloud gateway are authenticated</span></span>

| <span data-ttu-id="9b8b5-714">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-714">Title</span></span>                   | <span data-ttu-id="9b8b5-715">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-715">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-716">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-716">**Component**</span></span>               | <span data-ttu-id="9b8b5-717">Облачный шлюз Интернета вещей</span><span class="sxs-lookup"><span data-stu-id="9b8b5-717">IoT Cloud Gateway</span></span> | 
| <span data-ttu-id="9b8b5-718">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-718">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-719">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-719">Build</span></span> |  
| <span data-ttu-id="9b8b5-720">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-720">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-721">Универсальное, C#, Node.js</span><span class="sxs-lookup"><span data-stu-id="9b8b5-721">Generic, C#, Node.JS,</span></span>  |
| <span data-ttu-id="9b8b5-722">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-722">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-723">Н/д, выбор шлюза: Центр Интернета вещей Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-723">N/A, Gateway choice - Azure IoT Hub</span></span> |
| <span data-ttu-id="9b8b5-724">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-724">**References**</span></span>              | <span data-ttu-id="9b8b5-725">Н/д, [Приступая к работе с Центром Интернета вещей Azure (.NET)](https://azure.microsoft.com/documentation/articles/iot-hub-csharp-csharp-getstarted/), [Приступая к работе с Центром Интернета вещей Azure (Node)](https://azure.microsoft.com/documentation/articles/iot-hub-node-node-getstarted), [Поддерживаемые сертификаты X.509](https://azure.microsoft.com/documentation/articles/iot-hub-sas-tokens/), [репозиторий Git](https://github.com/Azure/azure-iot-sdks/tree/master/node)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-725">N/A, [Azure IoT hub with .NET](https://azure.microsoft.com/documentation/articles/iot-hub-csharp-csharp-getstarted/), [Getting Started wih IoT hub and Node JS](https://azure.microsoft.com/documentation/articles/iot-hub-node-node-getstarted), [Securing IoT with SAS and certificates](https://azure.microsoft.com/documentation/articles/iot-hub-sas-tokens/), [Git repository](https://github.com/Azure/azure-iot-sdks/tree/master/node)</span></span> |
| <span data-ttu-id="9b8b5-726">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-726">**Steps**</span></span> | <ul><li><span data-ttu-id="9b8b5-727">**Универсальное.** Выполняйте проверку подлинности устройства с использованием протокола TLS или IPSec.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-727">**Generic:** Authenticate the device using Transport Layer Security (TLS) or IPSec.</span></span> <span data-ttu-id="9b8b5-728">Инфраструктура должна поддерживать общие ключи для тех устройств, которые не выполняют полное асимметричное шифрование.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-728">Infrastructure should support using pre-shared key (PSK) on those devices that cannot handle full asymmetric cryptography.</span></span> <span data-ttu-id="9b8b5-729">Используйте Azure AD, OAuth.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-729">Leverage Azure AD, Oauth.</span></span></li><li><span data-ttu-id="9b8b5-730">**C#.** При создании экземпляра DeviceClient по умолчанию метод Create создает экземпляр DeviceClient, который использует протокол AMQP для связи с Центром Интернета вещей.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-730">**C#:** When creating a DeviceClient instance, by default, the Create method creates a DeviceClient instance that uses the AMQP protocol to communicate with IoT Hub.</span></span> <span data-ttu-id="9b8b5-731">Для использования протокола HTTPS используйте переопределение метода Create, чтобы указать протокол.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-731">To use the HTTPS protocol, use the override of the Create method that enables you to specify the protocol.</span></span> <span data-ttu-id="9b8b5-732">Если вы используете протокол HTTPS, вам также следует добавить в свой проект пакет NuGet `Microsoft.AspNet.WebApi.Client`, чтобы включить пространство имен `System.Net.Http.Formatting`.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-732">If you use the HTTPS protocol, you should also add the `Microsoft.AspNet.WebApi.Client` NuGet package to your project to include the `System.Net.Http.Formatting` namespace.</span></span></li></ul>|

### <a name="example"></a><span data-ttu-id="9b8b5-733">Пример</span><span class="sxs-lookup"><span data-stu-id="9b8b5-733">Example</span></span>
```C#
static DeviceClient deviceClient;

static string deviceKey = "{device key}";
static string iotHubUri = "{iot hub hostname}";

var messageString = "{message in string format}";
var message = new Message(Encoding.ASCII.GetBytes(messageString));

deviceClient = DeviceClient.Create(iotHubUri, new DeviceAuthenticationWithRegistrySymmetricKey("myFirstDevice", deviceKey));

await deviceClient.SendEventAsync(message);
```

### <a name="example"></a><span data-ttu-id="9b8b5-734">Пример</span><span class="sxs-lookup"><span data-stu-id="9b8b5-734">Example</span></span>
<span data-ttu-id="9b8b5-735">**Проверка подлинности Node.js**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-735">**Node.JS: Authentication**</span></span>
#### <a name="symmetric-key"></a><span data-ttu-id="9b8b5-736">Симметричный ключ</span><span class="sxs-lookup"><span data-stu-id="9b8b5-736">Symmetric key</span></span>
* <span data-ttu-id="9b8b5-737">Создайте Центр Интернета вещей в Azure.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-737">Create a IoT hub on azure</span></span>
* <span data-ttu-id="9b8b5-738">Создайте запись в реестре удостоверений устройств.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-738">Create an entry in the device identity registry</span></span>
    ```javascript
    var device = new iothub.Device(null);
    device.deviceId = <DeviceId >
    registry.create(device, function(err, deviceInfo, res) {})
    ```
* <span data-ttu-id="9b8b5-739">Создайте виртуальное устройство.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-739">Create a simulated device</span></span>
    ```javascript
    var clientFromConnectionString = require('azure-iot-device-amqp').clientFromConnectionString;
    var Message = require('azure-iot-device').Message;
    var connectionString = 'HostName=<HostName>DeviceId=<DeviceId>SharedAccessKey=<SharedAccessKey>';
    var client = clientFromConnectionString(connectionString);
    ```
#### <a name="sas-token"></a><span data-ttu-id="9b8b5-740">Маркер SAS</span><span class="sxs-lookup"><span data-stu-id="9b8b5-740">SAS Token</span></span>
* <span data-ttu-id="9b8b5-741">Создается в системе при использовании симметричного ключа, но его также можно создать и использовать явным образом.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-741">Gets internally generated when using symmetric key but we can generate and use it explicitly as well</span></span>
* <span data-ttu-id="9b8b5-742">Определите протокол: `var Http = require('azure-iot-device-http').Http;`</span><span class="sxs-lookup"><span data-stu-id="9b8b5-742">Define a protocol : `var Http = require('azure-iot-device-http').Http;`</span></span>
* <span data-ttu-id="9b8b5-743">Создайте маркер SAS:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-743">Create a sas token :</span></span>
    ```javascript
    resourceUri = encodeURIComponent(resourceUri.toLowerCase()).toLowerCase();
    var deviceName = "<deviceName >";
    var expires = (Date.now() / 1000) + expiresInMins * 60;
    var toSign = resourceUri + '\n' + expires;
    // using crypto
    var decodedPassword = new Buffer(signingKey, 'base64').toString('binary');
    const hmac = crypto.createHmac('sha256', decodedPassword);
    hmac.update(toSign);
    var base64signature = hmac.digest('base64');
    var base64UriEncoded = encodeURIComponent(base64signature);
    // construct authorization string
    var token = "SharedAccessSignature sr=" + resourceUri + "%2fdevices%2f"+deviceName+"&sig="
    + base64UriEncoded + "&se=" + expires;
    if (policyName) token += "&skn="+policyName;
    return token;
    ```
* <span data-ttu-id="9b8b5-744">Подключитесь с помощью маркера SAS:</span><span class="sxs-lookup"><span data-stu-id="9b8b5-744">Connect using sas token:</span></span> 
    ```javascript
    Client.fromSharedAccessSignature(sas, Http); 
    ```
#### <a name="certificates"></a><span data-ttu-id="9b8b5-745">Сертификаты</span><span class="sxs-lookup"><span data-stu-id="9b8b5-745">Certificates</span></span>
* <span data-ttu-id="9b8b5-746">Создайте самозаверяющий сертификат X509 с помощью любого средства, такого как OpenSSL, чтобы создать файлы CERT и KEY для хранения сертификата и ключа соответственно.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-746">Generate a self signed X509 certificate using any tool such as OpenSSL to generate a .cert and .key files to store the certificate and the key respectively</span></span>
* <span data-ttu-id="9b8b5-747">Подготовьте устройство, которое принимает безопасное подключение с использованием сертификатов.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-747">Provision a device that accepts secured connection using certificates.</span></span>
    ```javascript
    var connectionString = '<connectionString>';
    var registry = iothub.Registry.fromConnectionString(connectionString);
    var deviceJSON = {deviceId:"<deviceId>",
    authentication: {
        x509Thumbprint: {
        primaryThumbprint: "<PrimaryThumbprint>",
        secondaryThumbprint: "<SecondaryThumbprint>"
        }
    }}
    var device = deviceJSON;
    registry.create(device, function (err) {});
    ```
* <span data-ttu-id="9b8b5-748">Подключите устройство с помощью сертификата.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-748">Connect a device using a certificate</span></span>
    ```javascript
    var Protocol = require('azure-iot-device-http').Http;
    var Client = require('azure-iot-device').Client;
    var connectionString = 'HostName=<HostName>DeviceId=<DeviceId>x509=true';
    var client = Client.fromConnectionString(connectionString, Protocol);
    var options = {
        key: fs.readFileSync('./key.pem', 'utf8'),
        cert: fs.readFileSync('./server.crt', 'utf8')
    }; 
    // Calling setOptions with the x509 certificate and key (and optionally, passphrase) will configure the client //transport to use x509 when connecting to IoT Hub
    client.setOptions(options);
    //call fn to execute after the connection is set up
    client.open(fn);
    ```

## <span data-ttu-id="9b8b5-749"><a id="authn-cred"></a>Используйте учетные данные проверки подлинности на уровне отдельного устройства</span><span class="sxs-lookup"><span data-stu-id="9b8b5-749"><a id="authn-cred"></a>Use per-device authentication credentials</span></span>

| <span data-ttu-id="9b8b5-750">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-750">Title</span></span>                   | <span data-ttu-id="9b8b5-751">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-751">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-752">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-752">**Component**</span></span>               | <span data-ttu-id="9b8b5-753">Облачный шлюз Интернета вещей</span><span class="sxs-lookup"><span data-stu-id="9b8b5-753">IoT Cloud Gateway</span></span>  | 
| <span data-ttu-id="9b8b5-754">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-754">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-755">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-755">Build</span></span> |  
| <span data-ttu-id="9b8b5-756">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-756">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-757">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-757">Generic</span></span> |
| <span data-ttu-id="9b8b5-758">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-758">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-759">Выбор шлюза: Центр Интернета вещей Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-759">Gateway choice - Azure IoT Hub</span></span> |
| <span data-ttu-id="9b8b5-760">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-760">**References**</span></span>              | [<span data-ttu-id="9b8b5-761">Маркеры безопасности Центра Интернета вещей Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-761">Azure IoT Hub Security Tokens</span></span>](https://azure.microsoft.com/documentation/articles/iot-hub-sas-tokens/) |
| <span data-ttu-id="9b8b5-762">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-762">**Steps**</span></span> | <span data-ttu-id="9b8b5-763">Используйте учетные данные проверки подлинности с помощью маркеров SAS на основе ключа устройства или сертификата клиента для каждого отдельного устройства вместо политик общего доступа на уровне Центра Интернета вещей.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-763">Use per device authentication credentials using SaS tokens based on Device key or Client Certificate, instead of IoT Hub-level shared access policies.</span></span> <span data-ttu-id="9b8b5-764">Это предотвратит повторное использование маркеров проверки подлинности одного устройства или полевого шлюза другим устройством.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-764">This prevents the reuse of authentication tokens of one device or field gateway by another</span></span> |

## <span data-ttu-id="9b8b5-765"><a id="req-containers-anon"></a>Анонимный доступ на чтение должен быть предоставлен только к необходимым контейнерам и большим двоичным объектам</span><span class="sxs-lookup"><span data-stu-id="9b8b5-765"><a id="req-containers-anon"></a>Ensure that only the required containers and blobs are given anonymous read access</span></span>

| <span data-ttu-id="9b8b5-766">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-766">Title</span></span>                   | <span data-ttu-id="9b8b5-767">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-767">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-768">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-768">**Component**</span></span>               | <span data-ttu-id="9b8b5-769">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-769">Azure Storage</span></span> | 
| <span data-ttu-id="9b8b5-770">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-770">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-771">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-771">Build</span></span> |  
| <span data-ttu-id="9b8b5-772">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-772">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-773">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-773">Generic</span></span> |
| <span data-ttu-id="9b8b5-774">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-774">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-775">Тип хранилища: большой двоичный объект</span><span class="sxs-lookup"><span data-stu-id="9b8b5-775">StorageType - Blob</span></span> |
| <span data-ttu-id="9b8b5-776">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-776">**References**</span></span>              | <span data-ttu-id="9b8b5-777">[Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам](https://azure.microsoft.com/documentation/articles/storage-manage-access-to-resources/), [Использование подписанных URL-адресов (SAS): общие сведения о модели SAS](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-777">[Manage anonymous read access to containers and blobs](https://azure.microsoft.com/documentation/articles/storage-manage-access-to-resources/), [Shared Access Signatures, Part 1: Understanding the SAS model](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/)</span></span> |
| <span data-ttu-id="9b8b5-778">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-778">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-779">По умолчанию контейнер и все большие двоичные объекты внутри него доступны только владельцу учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-779">By default, a container and any blobs within it may be accessed only by the owner of the storage account.</span></span> <span data-ttu-id="9b8b5-780">Чтобы предоставить анонимным пользователями доступ на их чтение, следует разрешить общий доступ к контейнеру.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-780">To give anonymous users read permissions to a container and its blobs, one can set the container permissions to allow public access.</span></span> <span data-ttu-id="9b8b5-781">Анонимные пользователи могут считывать данные большого двоичного объекта из общедоступного контейнера, при этом их запросы не будут проходить аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-781">Anonymous users can read blobs within a publicly accessible container without authenticating the request.</span></span></p><p><span data-ttu-id="9b8b5-782">Доступны следующие возможности управления доступом к контейнеру.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-782">Containers provide the following options for managing container access:</span></span></p><ul><li><span data-ttu-id="9b8b5-783">Полный общий доступ на чтение: контейнер и данные больших двоичных объектов можно считывать с помощью анонимного запроса.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-783">Full public read access: Container and blob data can be read via anonymous request.</span></span> <span data-ttu-id="9b8b5-784">Клиенты могут перечислять BLOB-объекты внутри контейнера с помощью анонимного запроса, но не могут перечислять контейнеры в учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-784">Clients can enumerate blobs within the container via anonymous request, but cannot enumerate containers within the storage account.</span></span></li><li><span data-ttu-id="9b8b5-785">Общий доступ на чтение только для больших двоичных объектов: данные больших двоичных объектов в этом контейнере можно считать с помощью анонимного запроса, но данные контейнера недоступны.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-785">Public read access for blobs only: Blob data within this container can be read via anonymous request, but container data is not available.</span></span> <span data-ttu-id="9b8b5-786">Клиенты не могут перечислять большие двоичные объекты внутри с помощью анонимного запроса.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-786">Clients cannot enumerate blobs within the container via anonymous request</span></span></li><li><span data-ttu-id="9b8b5-787">Без общего доступа для чтения: контейнер и данные больших двоичных объектов может считывать только владелец учетной записи.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-787">No public read access: Container and blob data can be read by the account owner only</span></span></li></ul><p><span data-ttu-id="9b8b5-788">Анонимный доступ лучше всего подходит для сценариев, когда определенные большие двоичные объекты нужно сделать всегда доступными для анонимного доступа на чтение.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-788">Anonymous access is best for scenarios where certain blobs should always be available for anonymous read access.</span></span> <span data-ttu-id="9b8b5-789">Для осуществления детального контроля можно создать подписанный URL-адрес, который позволит делегировать ограниченный доступ на определенный временной интервал, используя разные разрешения.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-789">For finer-grained control, one can create a shared access signature, which enables to delegate restricted access using different permissions and over a specified time interval.</span></span> <span data-ttu-id="9b8b5-790">Проверьте, чтобы случайно не был предоставлен анонимный доступ к контейнерам и большим двоичным объектам, которые могут содержать конфиденциальные данные.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-790">Ensure that containers and blobs, which may potentially contain sensitive data, are not given anonymous access accidentally</span></span></p>|

## <span data-ttu-id="9b8b5-791"><a id="limited-access-sas"></a>Предоставьте ограниченный доступ к объектам в службе хранилища Azure с помощью SAS или SAP</span><span class="sxs-lookup"><span data-stu-id="9b8b5-791"><a id="limited-access-sas"></a>Grant limited access to objects in Azure storage using SAS or SAP</span></span>

| <span data-ttu-id="9b8b5-792">Название</span><span class="sxs-lookup"><span data-stu-id="9b8b5-792">Title</span></span>                   | <span data-ttu-id="9b8b5-793">Сведения</span><span class="sxs-lookup"><span data-stu-id="9b8b5-793">Details</span></span>      |
| ----------------------- | ------------ |
| <span data-ttu-id="9b8b5-794">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-794">**Component**</span></span>               | <span data-ttu-id="9b8b5-795">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="9b8b5-795">Azure Storage</span></span> | 
| <span data-ttu-id="9b8b5-796">**Этап SDL**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-796">**SDL Phase**</span></span>               | <span data-ttu-id="9b8b5-797">Создание</span><span class="sxs-lookup"><span data-stu-id="9b8b5-797">Build</span></span> |  
| <span data-ttu-id="9b8b5-798">**Применимые технологии**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-798">**Applicable Technologies**</span></span> | <span data-ttu-id="9b8b5-799">Универсальный</span><span class="sxs-lookup"><span data-stu-id="9b8b5-799">Generic</span></span> |
| <span data-ttu-id="9b8b5-800">**Атрибуты**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-800">**Attributes**</span></span>              | <span data-ttu-id="9b8b5-801">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9b8b5-801">N/A</span></span> |
| <span data-ttu-id="9b8b5-802">**Справочные материалы**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-802">**References**</span></span>              | <span data-ttu-id="9b8b5-803">[Использование подписанных URL-адресов (SAS): общие сведения о модели SAS](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/), [Подписанные URL-адреса. Часть 2: создание и использование подписанного URL-адреса в службе BLOB-объектов](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-2/), [сведения о делегировании доступа к объектам в учетной записи с помощью подписанных URL-адресов и хранимых политик доступа](https://azure.microsoft.com/documentation/articles/storage-security-guide/#_how-to-delegate-access-to-objects-in-your-account-using-shared-access-signatures-and-stored-access-policies)</span><span class="sxs-lookup"><span data-stu-id="9b8b5-803">[Shared Access Signatures, Part 1: Understanding the SAS model](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/), [Shared Access Signatures, Part 2: Create and use a SAS with Blob storage](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-2/), [How to delegate access to objects in your account using Shared Access Signatures and Stored Access Policies](https://azure.microsoft.com/documentation/articles/storage-security-guide/#_how-to-delegate-access-to-objects-in-your-account-using-shared-access-signatures-and-stored-access-policies)</span></span> |
| <span data-ttu-id="9b8b5-804">**Действия**</span><span class="sxs-lookup"><span data-stu-id="9b8b5-804">**Steps**</span></span> | <p><span data-ttu-id="9b8b5-805">Подписанный URL-адрес (SAS) — это эффективное средство для предоставления другим клиентам ограниченного доступа к объектам в вашей учетной записи хранения без предоставления ключа доступа к вашей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-805">Using a shared access signature (SAS) is a powerful way to grant limited access to objects in a storage account to other clients, without having to expose account access key.</span></span> <span data-ttu-id="9b8b5-806">Подпись общего доступа — это URI, который в своих параметрах запроса содержит все сведения, необходимые доступа к ресурсу хранилища с прохождением проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-806">The SAS is a URI that encompasses in its query parameters all of the information necessary for authenticated access to a storage resource.</span></span> <span data-ttu-id="9b8b5-807">Для доступа к ресурсам хранилища с помощью SAS клиенту достаточно передать SAS в соответствующий конструктор или метод.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-807">To access storage resources with the SAS, the client only needs to pass in the SAS to the appropriate constructor or method.</span></span></p><p><span data-ttu-id="9b8b5-808">Подпись общего доступа можно использовать, когда доступ к ресурсам в вашей учетной записи хранения требуется предоставить клиенту, которому нельзя доверить ключ учетной записи.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-808">You can use a SAS when you want to provide access to resources in your storage account to a client that can't be trusted with the account key.</span></span> <span data-ttu-id="9b8b5-809">Ключи вашей учетной записи хранения включают в себя как первичный, так и вторичный ключ, и оба этих ключа предоставляют административный доступ к вашей учетной записи и всем ее ресурсам.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-809">Your storage account keys include both a primary and secondary key, both of which grant administrative access to your account and all of the resources in it.</span></span> <span data-ttu-id="9b8b5-810">Предоставление любого из ключей учетной записи делает ее уязвимой вредоносного или небрежного использования.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-810">Exposing either of your account keys opens your account to the possibility of malicious or negligent use.</span></span> <span data-ttu-id="9b8b5-811">Подписи общего доступа обеспечивают безопасную альтернативу, позволяющую другим клиентам считывать, записывать и удалять данные в вашей учетной записи хранения в соответствии с выданными вами разрешениями и без потребности в ключе учетной записи.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-811">Shared access signatures provide a safe alternative that allows other clients to read, write, and delete data in your storage account according to the permissions you've granted, and without need for the account key.</span></span></p><p><span data-ttu-id="9b8b5-812">Если у вас есть логически связанный и относительно постоянный набор параметров, лучше использовать хранимую политику доступа.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-812">If you have a logical set of parameters that are similar each time, using a Stored Access Policy (SAP) is a better idea.</span></span> <span data-ttu-id="9b8b5-813">Та как подписанный URL-адрес, полученный на основе хранимой политики доступа, можно отозвать немедленно, рекомендуется использовать хранимые политики доступа всегда, когда это возможно.</span><span class="sxs-lookup"><span data-stu-id="9b8b5-813">Because using a SAS derived from a Stored Access Policy gives you the ability to revoke that SAS immediately, it is the recommended best practice to always use Stored Access Policies when possible.</span></span></p>|