---
title: "Шифрование виртуальной машины Azure | Документация Майкрософт"
description: "Этот документ поможет вам зашифровать виртуальную машину Azure после получения оповещения из центра безопасности Azure."
services: security, security-center
documentationcenter: na
author: TomShinder
manager: swadhwa
editor: 
ms.assetid: f6c28bc4-1f79-4352-89d0-03659b2fa2f5
ms.service: security
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/15/2017
ms.author: tomsh
ms.openlocfilehash: 8d39aafb0ab7b0e87afdf4d2f50f1e224b8d251f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="encrypt-an-azure-virtual-machine"></a><span data-ttu-id="95907-103">Шифрование виртуальной машины Azure</span><span class="sxs-lookup"><span data-stu-id="95907-103">Encrypt an Azure Virtual Machine</span></span>
<span data-ttu-id="95907-104">Если у вас есть незашифрованные виртуальные машины, центр безопасности Azure оповестит вас.</span><span class="sxs-lookup"><span data-stu-id="95907-104">Azure Security Center will alert you if you have virtual machines that are not encrypted.</span></span> <span data-ttu-id="95907-105">Вы получите оповещение высокого уровня серьезности вместе рекомендацией о шифровании таких виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="95907-105">These alerts will show as High Severity and the recommendation is to encrypt these virtual machines.</span></span>

![Рекомендации по шифрованию дисков](./media/security-center-disk-encryption/security-center-disk-encryption-fig1.png)

> [!NOTE]
> <span data-ttu-id="95907-107">Сведения, содержащиеся в этой статье, относятся к шифрованию виртуальных машин без использования ключа шифрования ключей (необходимого для резервного копирования виртуальных машин с помощью службы архивации Azure).</span><span class="sxs-lookup"><span data-stu-id="95907-107">The information in this document applies to encrypting virtual machines without using a Key Encryption Key (which is required for backing up virtual machines using Azure Backup).</span></span> <span data-ttu-id="95907-108">Дополнительные сведения об использовании ключа шифрования ключей для поддержки службы архивации Azure для зашифрованных виртуальных машин Azure см. в статье [Дисковое шифрование Azure для виртуальных машин IaaS под управлением Windows и Linux](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption).</span><span class="sxs-lookup"><span data-stu-id="95907-108">Please see the article [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for information on how to use a Key Encryption Key to support Azure Backup for encrypted Azure Virtual Machines.</span></span>
>
>

<span data-ttu-id="95907-109">Для шифрования виртуальных машин Azure, которые определены центром безопасности Azure как требующие шифрования, мы рекомендуем выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="95907-109">To encrypt Azure Virtual Machines that have been identified by Azure Security Center as needing encryption, we recommend the following steps:</span></span>

* <span data-ttu-id="95907-110">Установите и настройте Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="95907-110">Install and configure Azure PowerShell.</span></span> <span data-ttu-id="95907-111">Это позволит вам выполнять команды PowerShell, чтобы установить необходимые компоненты для шифрования виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="95907-111">This will enable you to run the PowerShell commands required to set up the prerequisites required to encrypt Azure Virtual Machines.</span></span>
* <span data-ttu-id="95907-112">Получите и выполните скрипт Azure PowerShell с необходимыми компонентами для шифрования дисков Azure. </span><span class="sxs-lookup"><span data-stu-id="95907-112">Obtain and run the Azure Disk Encryption Prerequisites Azure PowerShell script</span></span>
* <span data-ttu-id="95907-113">Зашифруйте свои виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="95907-113">Encrypt your virtual machines</span></span>

<span data-ttu-id="95907-114">Этот документ поможет вам зашифровать виртуальные машины, даже если у вас недостаточно или совсем нет опыта работы с Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="95907-114">The goal of this document is to enable you to encrypt your virtual machines, even if you have little or no background in Azure PowerShell.</span></span>
<span data-ttu-id="95907-115">В этом документе предполагается, что в качестве клиентского компьютера, на котором будет настраиваться шифрование дисков Azure, используется компьютер под управлением ОС Windows 10.</span><span class="sxs-lookup"><span data-stu-id="95907-115">This document assumes you are using Windows 10 as the client machine from which you will configure Azure Disk Encryption.</span></span>

<span data-ttu-id="95907-116">Существуют разные методы установки необходимых компонентов и настройки шифрования виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="95907-116">There are many approaches that can be used to setup the prerequisites and to configure encryption for Azure Virtual Machines.</span></span> <span data-ttu-id="95907-117">Если у вас есть опыт работы с Azure PowerShell или интерфейсом командной строки Azure, вы можете использовать альтернативные подходы.</span><span class="sxs-lookup"><span data-stu-id="95907-117">If you are already well-versed in Azure PowerShell or Azure CLI, then you may prefer to use alternate approaches.</span></span>

> [!NOTE]
> <span data-ttu-id="95907-118">Дополнительные сведения об альтернативных подходах к настройке шифрования для виртуальных машин Azure см. в статье [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://gallery.technet.microsoft.com/Azure-Disk-Encryption-for-a0018eb0) (Шифрование дисков Azure для виртуальных машин Azure под управлением Windows и Linux).</span><span class="sxs-lookup"><span data-stu-id="95907-118">To learn more about alternate approaches to configuring encryption for Azure virtual machines, please see [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://gallery.technet.microsoft.com/Azure-Disk-Encryption-for-a0018eb0).</span></span>
>
>

## <a name="install-and-configure-azure-powershell"></a><span data-ttu-id="95907-119">Установка и настройка Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="95907-119">Install and configure Azure PowerShell</span></span>
<span data-ttu-id="95907-120">На компьютере необходимо установить Azure PowerShell 1.2.1 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="95907-120">You need Azure PowerShell version 1.2.1 or above installed on your computer.</span></span> <span data-ttu-id="95907-121">В статье [Установка и настройка Azure PowerShell](/powershell/azure/overview) описаны все действия, необходимые для подготовки компьютера для работы с Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="95907-121">The article [How to install and configure Azure PowerShell](/powershell/azure/overview) contains all the steps you need to provision your computer to work with Azure PowerShell.</span></span> <span data-ttu-id="95907-122">Самый простой способ — использовать установщик веб-платформы, который упоминается в этой статье.</span><span class="sxs-lookup"><span data-stu-id="95907-122">The most straightforward approach is to use the Web PI installation approach mentioned in that article.</span></span> <span data-ttu-id="95907-123">Даже если у вас уже установлен модуль Azure PowerShell, с помощью установщика веб-платформы выполните повторную установку, чтобы получить последнюю версию Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="95907-123">Even if you already have Azure PowerShell installed, install again using the Web PI approach so that you have the latest version of Azure PowerShell.</span></span>

## <a name="obtain-and-run-the-azure-disk-encryption-prerequisites-configuration-script"></a><span data-ttu-id="95907-124">Получение и выполнение скрипта для установки компонентов, необходимых при шифровании дисков Azure</span><span class="sxs-lookup"><span data-stu-id="95907-124">Obtain and run the Azure disk encryption prerequisites configuration script</span></span>
<span data-ttu-id="95907-125">Скрипт для установки компонентов, необходимых при шифрования дисков Azure, устанавливает все соответствующие компоненты.</span><span class="sxs-lookup"><span data-stu-id="95907-125">The Azure Disk Encryption Prerequisites Configuration Script will set up all the prerequisites required for encrypting your Azure Virtual Machines.</span></span>

1. <span data-ttu-id="95907-126">Перейдите на страницу GitHub, на которой размещен [скрипт для установки компонентов, необходимых при шифровании дисков Azure](https://github.com/Azure/azure-powershell/blob/master/src/ResourceManager/Compute/Commands.Compute/Extension/AzureDiskEncryption/Scripts/AzureDiskEncryptionPreRequisiteSetup.ps1).</span><span class="sxs-lookup"><span data-stu-id="95907-126">Go to the GitHub page that has the [Azure Disk Encryption Prerequisite Setup Script](https://github.com/Azure/azure-powershell/blob/master/src/ResourceManager/Compute/Commands.Compute/Extension/AzureDiskEncryption/Scripts/AzureDiskEncryptionPreRequisiteSetup.ps1).</span></span>
2. <span data-ttu-id="95907-127">На странице GitHub нажмите кнопку **Raw** (Без форматирования).</span><span class="sxs-lookup"><span data-stu-id="95907-127">On the GibHub page, click the **Raw** button.</span></span>
3. <span data-ttu-id="95907-128">С помощью клавиш **CTRL+A** выделите весь текст на странице, а затем нажмите **CTRL+C**, чтобы скопировать в буфер обмена весь текст на странице.</span><span class="sxs-lookup"><span data-stu-id="95907-128">Use **CTRL-A** to select all the text on the page and then use **CTRL-C** to copy all the text on the page to the clipboard.</span></span>
4. <span data-ttu-id="95907-129">Откройте **Блокнот** и вставьте скопированный текст.</span><span class="sxs-lookup"><span data-stu-id="95907-129">Open **Notepad** and paste the copied text into Notepad.</span></span>
5. <span data-ttu-id="95907-130">Создайте на диске C: новую папку с именем **AzureADEScript**.</span><span class="sxs-lookup"><span data-stu-id="95907-130">Create a new folder on your C: drive named **AzureADEScript**.</span></span>
6. <span data-ttu-id="95907-131">Сохраните файл Блокнота: щелкните **Файл**, а затем — **Сохранить как**.</span><span class="sxs-lookup"><span data-stu-id="95907-131">Save the Notepad file – click **File**, then click **Save As**.</span></span> <span data-ttu-id="95907-132">В текстовое поле "Имя файла" введите **ADEPrereqScript.ps1** и нажмите кнопку **Сохранить**</span><span class="sxs-lookup"><span data-stu-id="95907-132">In the File name textbox, enter **“ADEPrereqScript.ps1”** and click **Save**.</span></span> <span data-ttu-id="95907-133">(имя нужно заключить в кавычки, иначе файл будет сохранен с расширением TXT).</span><span class="sxs-lookup"><span data-stu-id="95907-133">(make sure you put the quotation marks around the name, otherwise it will save the file with a .txt file extension).</span></span>

<span data-ttu-id="95907-134">Содержимое скрипта сохранено. Теперь откройте скрипт в интегрированной среде сценариев Windows PowerShell (PowerShell ISE):</span><span class="sxs-lookup"><span data-stu-id="95907-134">Now that the script content is saved, open the script in the PowerShell ISE:</span></span>

1. <span data-ttu-id="95907-135">В меню "Пуск" выберите пункт **Кортана**.</span><span class="sxs-lookup"><span data-stu-id="95907-135">In the Start Menu, click **Cortana**.</span></span> <span data-ttu-id="95907-136">Чтобы с помощью **Кортаны** найти PowerShell, введите **PowerShell** в текстовом поле поиска.</span><span class="sxs-lookup"><span data-stu-id="95907-136">Ask **Cortana** “PowerShell” by typing **PowerShell** in the Cortana search text box.</span></span>
2. <span data-ttu-id="95907-137">Щелкните правой кнопкой мыши **Интегрированная среда сценариев Windows PowerShell** и выберите пункт **Запуск от имени администратора**.</span><span class="sxs-lookup"><span data-stu-id="95907-137">Right click **Windows PowerShell ISE** and click **Run as administrator**.</span></span>
3. <span data-ttu-id="95907-138">В окне **Администратор: интегрированная среда сценариев Windows PowerShell** щелкните **Представление**, а затем — **Show Script Pane** (Показать область сценариев).</span><span class="sxs-lookup"><span data-stu-id="95907-138">In the **Administrator: Windows PowerShell ISE** window, click **View** and then click **Show Script Pane**.</span></span>
4. <span data-ttu-id="95907-139">Если панель **Команды** отображается в правой части окна, щелкните значок **x** в правом верхнем углу панели, чтобы закрыть ее.</span><span class="sxs-lookup"><span data-stu-id="95907-139">If you see the **Commands** pane on the right side of the window, click the **“x”** in the top right corner of the pane to close it.</span></span> <span data-ttu-id="95907-140">Если текст слишком мелкий, используйте **CTRL+Add** (Add — это знак "+").</span><span class="sxs-lookup"><span data-stu-id="95907-140">If the text is too small for you to see, use **CTRL+Add** (“Add” is the “+” sign).</span></span> <span data-ttu-id="95907-141">Если текст слишком крупный, используйте **CTRL+Subtract** (Subtract — это знак "-").</span><span class="sxs-lookup"><span data-stu-id="95907-141">If the text is too large, use **CTRL+Subtract** (Subtract is the “-“ sign).</span></span>
5. <span data-ttu-id="95907-142">Щелкните **Файл** и выберите пункт **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="95907-142">Click **File** and then click **Open**.</span></span> <span data-ttu-id="95907-143">Перейдите в папку **C:\AzureADEScript** и дважды щелкните файл **ADEPrereqScript**.</span><span class="sxs-lookup"><span data-stu-id="95907-143">Navigate to the **C:\AzureADEScript** folder and the double-click on the **ADEPrereqScript**.</span></span>
6. <span data-ttu-id="95907-144">Содержимое файла **ADEPrereqScript** должно отобразиться в среде PowerShell ISE; разные компоненты, включая команды, параметры и переменные, обозначены цветом для удобства.</span><span class="sxs-lookup"><span data-stu-id="95907-144">The **ADEPrereqScript** contents should now appear in the PowerShell ISE and is color-coded to help you see various components, such as commands, parameters and variables more easily.</span></span>

<span data-ttu-id="95907-145">Теперь вы должны увидеть что-то похожее:</span><span class="sxs-lookup"><span data-stu-id="95907-145">You should now see something like the figure below.</span></span>

![Окно PowerShell ISE](./media/security-center-disk-encryption/security-center-disk-encryption-fig2.png)

<span data-ttu-id="95907-147">Верхняя панель называется областью сценариев, а нижняя — консолью.</span><span class="sxs-lookup"><span data-stu-id="95907-147">The top pane is referred to as the “script pane” and the bottom pane is referred to as the “console”.</span></span> <span data-ttu-id="95907-148">Мы будем использовать эти термины далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="95907-148">We will use these terms later in this article.</span></span>

## <a name="run-the-azure-disk-encryption-prerequisites-powershell-command"></a><span data-ttu-id="95907-149">Выполнение команды PowerShell для установки компонентов, необходимых при шифровании дисков Azure </span><span class="sxs-lookup"><span data-stu-id="95907-149">Run the Azure disk encryption prerequisites PowerShell command</span></span>
<span data-ttu-id="95907-150">Когда вы запустите скрипт для установки компонентов, необходимых при шифровании диска Azure, появится запрос на ввод следующих сведений:</span><span class="sxs-lookup"><span data-stu-id="95907-150">The Azure Disk Encryption Prerequisites script will ask you for the following information after you start the script:</span></span>

* <span data-ttu-id="95907-151">**Имя группы ресурсов** — имя группы ресурсов, в которой вы планируете расположить хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="95907-151">**Resource Group Name** - Name of the Resource Group that you want to put the Key Vault into.</span></span>  <span data-ttu-id="95907-152">Будет создана группа ресурсов с указанным именем (если такая группа ресурсов еще не существует).</span><span class="sxs-lookup"><span data-stu-id="95907-152">A new Resource Group with the name you enter will be created if there isn’t already one with that name created.</span></span> <span data-ttu-id="95907-153">Если у вас уже есть группа ресурсов, которую следует использовать в этой подписке, укажите ее имя.</span><span class="sxs-lookup"><span data-stu-id="95907-153">If you already have a Resource Group that you want to use in this subscription, then enter the name of that Resource Group.</span></span>
* <span data-ttu-id="95907-154">**Имя хранилища ключей** — имя хранилища ключей, в котором будут размещаться ключи шифрования.</span><span class="sxs-lookup"><span data-stu-id="95907-154">**Key Vault Name** - Name of the Key Vault in which encryption keys are to be placed.</span></span> <span data-ttu-id="95907-155">Будет создано хранилище ключей с таким именем (если оно еще не создано).</span><span class="sxs-lookup"><span data-stu-id="95907-155">A new Key Vault with this name will be created if you don’t already have a Key Vault with this name.</span></span> <span data-ttu-id="95907-156">Если у вас уже есть хранилище ключей, которое следует использовать, введите его имя.</span><span class="sxs-lookup"><span data-stu-id="95907-156">If you already have a Key Vault that you want to use, enter the name of the existing Key Vault.</span></span>
* <span data-ttu-id="95907-157">**Расположение** — расположение хранилища ключей.</span><span class="sxs-lookup"><span data-stu-id="95907-157">**Location** - Location of the Key Vault.</span></span> <span data-ttu-id="95907-158">Убедитесь, что хранилище ключей и виртуальные машины, которые предстоит зашифровать, находятся в одном расположении.</span><span class="sxs-lookup"><span data-stu-id="95907-158">Make sure the Key Vault and VMs to be encrypted are in the same location.</span></span> <span data-ttu-id="95907-159">Если расположение неизвестно, далее в этой статье показано, как его узнать.</span><span class="sxs-lookup"><span data-stu-id="95907-159">If you don’t know the location, there are steps later in this article that will show you how to find out.</span></span>
* <span data-ttu-id="95907-160">**Имя приложения Azure Active Directory** — имя приложения Azure Active Directory, которое будет использоваться для записи секретов в хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="95907-160">**Azure Active Directory Application Name** - Name of the Azure Active Directory application that will be used to write secrets to the Key Vault.</span></span> <span data-ttu-id="95907-161">Будет создано приложение с таким именем (если оно еще не создано).</span><span class="sxs-lookup"><span data-stu-id="95907-161">A new application with this name will be created if one doesn't exist.</span></span> <span data-ttu-id="95907-162">Если приложение Azure Active Directory, которое вы хотите использовать, уже существует, введите его имя.</span><span class="sxs-lookup"><span data-stu-id="95907-162">If you already have an Azure Active Directory application that you want to use, enter the name of that Azure Active Directory application.</span></span>

> [!NOTE]
> <span data-ttu-id="95907-163">Если вам интересно, почему нужно создать приложение Azure Active Directory, см. раздел *Регистрация приложения в Azure Active Directory* статьи [Приступая к работе с хранилищем ключей Azure](../key-vault/key-vault-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="95907-163">If you’re curious as to why you need to create an Azure Active Directory application, please see *Register an application with Azure Active Directory* section in the article [Getting Started with Azure Key Vault](../key-vault/key-vault-get-started.md).</span></span>
>
>

<span data-ttu-id="95907-164">Зашифровать виртуальную машину Azure можно так.</span><span class="sxs-lookup"><span data-stu-id="95907-164">Perform the following steps to encrypt an Azure Virtual Machine:</span></span>

1. <span data-ttu-id="95907-165">Если вы закрыли PowerShell ISE, откройте экземпляр PowerShell ISE с повышенными правами.</span><span class="sxs-lookup"><span data-stu-id="95907-165">If you closed the PowerShell ISE, open an elevated instance of the PowerShell ISE.</span></span> <span data-ttu-id="95907-166">Если среда PowerShell ISE еще не открыта, следуйте инструкциям, приведенным выше в этой статье.</span><span class="sxs-lookup"><span data-stu-id="95907-166">Follow the instructions earlier in this article if the PowerShell ISE is not already open.</span></span> <span data-ttu-id="95907-167">Если вы закрыли скрипт, откройте файл **ADEPrereqScript.ps1**: щелкните **Файл** и **Открыть**, а затем выберите скрипт из папки **C:\AzureADEScript**.</span><span class="sxs-lookup"><span data-stu-id="95907-167">If you closed the script, then open the **ADEPrereqScript.ps1** clicking **File**, then **Open** and selecting the script from the **c:\AzureADEScript** folder.</span></span> <span data-ttu-id="95907-168">Если вы выполняли инструкции с самого начала, просто перейдите к следующему шагу.</span><span class="sxs-lookup"><span data-stu-id="95907-168">If you have followed this article from the start, then just move on to the next step.</span></span>
2. <span data-ttu-id="95907-169">В консоли PowerShell ISE (нижняя область PowerShell ISE) перейдите в каталог со скриптом, введя **cd c:\AzureADEScript**, и нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-169">In the console of the PowerShell ISE (the bottom pane of the PowerShell ISE), change the focus to the local of the script by typing **cd c:\AzureADEScript** and press **ENTER**.</span></span>
3. <span data-ttu-id="95907-170">Задайте политику выполнения на компьютере, чтобы можно было выполнить скрипт.</span><span class="sxs-lookup"><span data-stu-id="95907-170">Set the execution policy on your machine so that you can run the script.</span></span> <span data-ttu-id="95907-171">Введите в консоли **Set-ExecutionPolicy Unrestricted** и нажмите клавишу ВВОД.</span><span class="sxs-lookup"><span data-stu-id="95907-171">Type **Set-ExecutionPolicy Unrestricted** in the console and then press ENTER.</span></span> <span data-ttu-id="95907-172">Если отобразится диалоговое окно, в котором сообщается о последствиях изменения политики выполнения, щелкните **Да для всех** или **Да** (если команда **Да для всех** отображается, выберите ее; в **противном случае** нажмите кнопку **Да**).</span><span class="sxs-lookup"><span data-stu-id="95907-172">If you see a dialog box telling about the effects of the change to execution policy, click either **Yes to all** or **Yes** (if you see **Yes to all**, select that option – if you do not see **Yes to all**, then click **Yes**).</span></span>
4. <span data-ttu-id="95907-173">Войдите в свою учетную запись Azure.</span><span class="sxs-lookup"><span data-stu-id="95907-173">Log into your Azure account.</span></span> <span data-ttu-id="95907-174">В окне консоли введите **Login-AzureRmAccount** и нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-174">In the console, type **Login-AzureRmAccount** and press **ENTER**.</span></span> <span data-ttu-id="95907-175">Появится диалоговое окно, в котором можно ввести учетные данные.</span><span class="sxs-lookup"><span data-stu-id="95907-175">A dialog box will appear in which you enter your credentials (make sure you have rights to change the virtual machines – if you do not have rights, you will not be able to encrypt them.</span></span> <span data-ttu-id="95907-176">(Убедитесь, что у вас есть права на изменение виртуальных машин, иначе вы не сможете зашифровать виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="95907-176">If you are not sure, ask your subscription owner or administrator).</span></span> <span data-ttu-id="95907-177">Вы должны увидеть сведения о **среде**, **учетной записи**, а также **TenantId**, **SubscriptionId** и **CurrentStorageAccount**.</span><span class="sxs-lookup"><span data-stu-id="95907-177">You should see information about your **Environment**, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span></span> <span data-ttu-id="95907-178">Скопируйте значение **SubscriptionId** в Блокнот.</span><span class="sxs-lookup"><span data-stu-id="95907-178">Copy the **SubscriptionId** to Notepad.</span></span> <span data-ttu-id="95907-179">Оно понадобится вам на этапе 6.</span><span class="sxs-lookup"><span data-stu-id="95907-179">You will need to use this in step #6.</span></span>
5. <span data-ttu-id="95907-180">Выясните, к какой подписке принадлежит ваша виртуальная машина и в каком расположении она находится.</span><span class="sxs-lookup"><span data-stu-id="95907-180">Find what subscription your virtual machine belongs to and its location.</span></span> <span data-ttu-id="95907-181">Перейдите по адресу [https://portal.azure.com](ttps://portal.azure.com) и выполните вход.</span><span class="sxs-lookup"><span data-stu-id="95907-181">Go to [https://portal.azure.com](ttps://portal.azure.com) and log in.</span></span>  <span data-ttu-id="95907-182">В левой части страницы щелкните **Виртуальные машины**.</span><span class="sxs-lookup"><span data-stu-id="95907-182">On the left side of the page, click **Virtual Machines**.</span></span> <span data-ttu-id="95907-183">Отобразится список виртуальных машин и подписок, к которым они принадлежат.</span><span class="sxs-lookup"><span data-stu-id="95907-183">You will see a list of your virtual machines and the subscriptions they belong to.</span></span>

   ![Виртуальные машины](./media/security-center-disk-encryption/security-center-disk-encryption-fig3.png)
6. <span data-ttu-id="95907-185">Вернитесь в среду PowerShell ISE.</span><span class="sxs-lookup"><span data-stu-id="95907-185">Return to the PowerShell ISE.</span></span> <span data-ttu-id="95907-186">Задайте контекст подписки, в котором будет выполняться скрипт.</span><span class="sxs-lookup"><span data-stu-id="95907-186">Set the subscription context in which the script will be run.</span></span> <span data-ttu-id="95907-187">В окне консоли введите **Select-AzureRmSubscription –SubscriptionId <your_subscription_Id>** (замените **< your_subscription_Id >** на фактический идентификатор подписки) и нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-187">In the console, type **Select-AzureRmSubscription –SubscriptionId <your_subscription_Id>** (replace **< your_subscription_Id >** with your actual Subscription ID) and press **ENTER**.</span></span> <span data-ttu-id="95907-188">Вы должны увидеть сведения о среде, **учетной записи**, а также **TenantId**, **SubscriptionId** и **CurrentStorageAccount**.</span><span class="sxs-lookup"><span data-stu-id="95907-188">You will see information about the Environment, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span></span>
7. <span data-ttu-id="95907-189">Теперь все готово к запуску скрипта.</span><span class="sxs-lookup"><span data-stu-id="95907-189">You are now ready to run the script.</span></span> <span data-ttu-id="95907-190">Нажмите кнопку **Выполнить сценарий** или клавишу **F5** на клавиатуре.</span><span class="sxs-lookup"><span data-stu-id="95907-190">Click the **Run Script** button or press **F5** on the keyboard.</span></span>

   ![Выполнение скрипта PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig4.png)
8. <span data-ttu-id="95907-192">Скрипт запросит значение **resourceGroupName**: введите имя *группы ресурсов*, которую вы хотите использовать, а затем нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-192">The script asks for **resourceGroupName:** - enter the name of *Resource Group* you want to use, then press **ENTER**.</span></span> <span data-ttu-id="95907-193">Если у вас нет такой группы ресурсов, введите имя, которое будет использовано для создания новой группы.</span><span class="sxs-lookup"><span data-stu-id="95907-193">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="95907-194">Если у вас уже есть *группа ресурсов* , которую вы хотите использовать (например, та, к которой относится ваша виртуальная машина), введите ее имя.</span><span class="sxs-lookup"><span data-stu-id="95907-194">If you already have a *Resource Group* that you want to use (such as the one that your virtual machine is in), enter the name of the existing Resource Group.</span></span>
9. <span data-ttu-id="95907-195">Скрипт запросит значение **keyVaultName:** введите имя *хранилища ключей* , которое вы хотите использовать, а затем нажмите клавишу ВВОД.</span><span class="sxs-lookup"><span data-stu-id="95907-195">The script asks for **keyVaultName:** - enter the name of the *Key Vault* you want to use, then press ENTER.</span></span> <span data-ttu-id="95907-196">Если у вас нет такой группы ресурсов, введите имя, которое будет использовано для создания новой группы.</span><span class="sxs-lookup"><span data-stu-id="95907-196">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="95907-197">Если у вас уже есть *хранилище ключей*, которое следует использовать, введите его имя.</span><span class="sxs-lookup"><span data-stu-id="95907-197">If you already have a Key Vault that you want to use, enter the name of the existing *Key Vault*.</span></span>
10. <span data-ttu-id="95907-198">Скрипт запросит значение **location**: введите имя расположения виртуальной машины, которую требуется зашифровать, а затем нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-198">The script asks for **location:** - enter the name of the location in which the VM you want to encrypt is located, then press **ENTER**.</span></span> <span data-ttu-id="95907-199">Если вы не помните расположение, вернитесь к шагу 5.</span><span class="sxs-lookup"><span data-stu-id="95907-199">If you don’t remember the location, go back to step #5.</span></span>
11. <span data-ttu-id="95907-200">Скрипт запросит значение **aadAppName**: введите имя приложения *Azure Active Directory*, которое вы хотите использовать, а затем нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-200">The script asks for **aadAppName:** - enter the name of the *Azure Active Directory* application you want to use, then press **ENTER**.</span></span> <span data-ttu-id="95907-201">Если у вас нет такой группы ресурсов, введите имя, которое будет использовано для создания новой группы.</span><span class="sxs-lookup"><span data-stu-id="95907-201">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="95907-202">Если *приложение Azure Active Directory*, которое вы хотите использовать, уже *существует*, введите его имя.</span><span class="sxs-lookup"><span data-stu-id="95907-202">If you already have an *Azure Active Directory application* that you want to use, enter the name of the existing *Azure Active Directory application*.</span></span>
12. <span data-ttu-id="95907-203">Появится диалоговое окно входа.</span><span class="sxs-lookup"><span data-stu-id="95907-203">A log in dialog box will appear.</span></span> <span data-ttu-id="95907-204">Укажите свои учетные данные (да, вы уже вошли в систему, но это необходимо сделать еще раз).</span><span class="sxs-lookup"><span data-stu-id="95907-204">Provide your credentials (yes, you have logged in once, but now you need to do it again).</span></span>
13. <span data-ttu-id="95907-205">Скрипт будет выполнен. По завершении появится запрос на копирование значений **aadClientID**, **aadClientSecret**, **diskEncryptionKeyVaultUrl** и **keyVaultResourceId**.</span><span class="sxs-lookup"><span data-stu-id="95907-205">The script runs and when complete it will ask you to copy the values of the **aadClientID**, **aadClientSecret**, **diskEncryptionKeyVaultUrl**, and **keyVaultResourceId**.</span></span> <span data-ttu-id="95907-206">Скопируйте все эти значения в буфер обмена и вставьте их в Блокнот.</span><span class="sxs-lookup"><span data-stu-id="95907-206">Copy each of these values to the clipboard and paste them into Notepad.</span></span>
14. <span data-ttu-id="95907-207">Вернитесь в интегрированную среду сценариев PowerShell, поместите курсор в конце последней строки и нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-207">Return to the PowerShell ISE and place the cursor at the end of the last line, and press **ENTER**.</span></span>

<span data-ttu-id="95907-208">Выходные данные скрипта должны выглядеть примерно как на снимке экрана ниже:</span><span class="sxs-lookup"><span data-stu-id="95907-208">The output of the script should look something like the screen below:</span></span>

![Вывод PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig5.png)

## <a name="encrypt-the-azure-virtual-machine"></a><span data-ttu-id="95907-210">Шифрование виртуальной машины Azure</span><span class="sxs-lookup"><span data-stu-id="95907-210">Encrypt the Azure virtual machine</span></span>
<span data-ttu-id="95907-211">Теперь все готово к шифрованию виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="95907-211">You are now ready to encrypt your virtual machine.</span></span> <span data-ttu-id="95907-212">Если виртуальная машина расположена в той же группе ресурсов, что и хранилище ключей, можно перейти к разделу, в котором описаны действия шифрования.</span><span class="sxs-lookup"><span data-stu-id="95907-212">If your virtual machine is located in the same Resource Group as your Key Vault, you can move on to the encryption steps section.</span></span> <span data-ttu-id="95907-213">Если же виртуальная машина расположена в другой группе ресурсов, в консоли PowerShell ISE введите следующее:</span><span class="sxs-lookup"><span data-stu-id="95907-213">However, if your virtual machine is not in the same Resource Group as your Key Vault, you will need to enter the following in the console in the PowerShell ISE:</span></span>

<span data-ttu-id="95907-214">**$resourceGroupName = <’Virtual_Machine_RG’>**</span><span class="sxs-lookup"><span data-stu-id="95907-214">**$resourceGroupName = <’Virtual_Machine_RG’>**</span></span>

<span data-ttu-id="95907-215">Замените **<’Virtual_Machine_RG’>** именем группы ресурсов, в которой находятся ваши виртуальные машины, взяв его в одинарные кавычки.</span><span class="sxs-lookup"><span data-stu-id="95907-215">Replace **< Virtual_Machine_RG >** with the name of the Resource Group in which your virtual machines are contained, surrounded by a single quote.</span></span> <span data-ttu-id="95907-216">Нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-216">Then press **ENTER**.</span></span>
<span data-ttu-id="95907-217">Чтобы убедиться, что указано правильное имя группы ресурсов, введите следующую команду в консоли PowerShell ISE:</span><span class="sxs-lookup"><span data-stu-id="95907-217">To confirm that the correct Resource Group name was entered, type the following in the PowerShell ISE console:</span></span>

<span data-ttu-id="95907-218">**$resourceGroupName**</span><span class="sxs-lookup"><span data-stu-id="95907-218">**$resourceGroupName**</span></span>

<span data-ttu-id="95907-219">Нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-219">Press **ENTER**.</span></span> <span data-ttu-id="95907-220">Должно отобразиться имя группы ресурсов, в которой расположены ваши виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="95907-220">You should see the name of Resource Group that your virtual machines are located in.</span></span> <span data-ttu-id="95907-221">Например:</span><span class="sxs-lookup"><span data-stu-id="95907-221">For example:</span></span>

![Вывод PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig6.png)

### <a name="encryption-steps"></a><span data-ttu-id="95907-223">Шаги шифрования</span><span class="sxs-lookup"><span data-stu-id="95907-223">Encryption steps</span></span>
<span data-ttu-id="95907-224">Во-первых, в PowerShell необходимо указать имя виртуальной машины, которую вы хотите зашифровать.</span><span class="sxs-lookup"><span data-stu-id="95907-224">First, you need to tell PowerShell the name of the virtual machine you want to encrypt.</span></span> <span data-ttu-id="95907-225">В окне консоли введите:</span><span class="sxs-lookup"><span data-stu-id="95907-225">In the console, type:</span></span>

<span data-ttu-id="95907-226">**$vmName = <’your_vm_name’>**</span><span class="sxs-lookup"><span data-stu-id="95907-226">**$vmName = <’your_vm_name’>**</span></span>

<span data-ttu-id="95907-227">Замените **<’your_vm_name’>** именем виртуальной машины, взяв его в одинарные кавычки, и нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-227">Replace **<’your_vm_name’>** with the name of your VM (make sure the name is surrounded by a single quote) and then press **ENTER**.</span></span>

<span data-ttu-id="95907-228">Чтобы убедиться, что указано правильное имя виртуальной машины, введите:</span><span class="sxs-lookup"><span data-stu-id="95907-228">To confirm that the correct VM name was entered, type:</span></span>

<span data-ttu-id="95907-229">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="95907-229">**$vmName**</span></span>

<span data-ttu-id="95907-230">Нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-230">Press **ENTER**.</span></span> <span data-ttu-id="95907-231">Должно отобразиться имя виртуальной машины, которую требуется зашифровать.</span><span class="sxs-lookup"><span data-stu-id="95907-231">You should see the name of the virtual machine you want to encrypt.</span></span> <span data-ttu-id="95907-232">Например:</span><span class="sxs-lookup"><span data-stu-id="95907-232">For example:</span></span>

![Вывод PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig7.png)

<span data-ttu-id="95907-234">Существует два метода выполнить команду шифрования всех дисков виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="95907-234">There are two methods to run the encryption command to encrypt all drives on the virtual machine.</span></span> <span data-ttu-id="95907-235">Первый способ — введите в консоли PowerShell ISE следующую команду:</span><span class="sxs-lookup"><span data-stu-id="95907-235">The first method is to type the following command in the PowerShell ISE console:</span></span>

~~~
Set-AzureRmVMDiskEncryptionExtension -ResourceGroupName $resourceGroupName -VMName $vmName -AadClientID $aadClientID -AadClientSecret $aadClientSecret -DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -DiskEncryptionKeyVaultId $keyVaultResourceId -VolumeType All
~~~

<span data-ttu-id="95907-236">Введя эту команду, нажмите клавишу **ВВОД**.</span><span class="sxs-lookup"><span data-stu-id="95907-236">After typing this command press **ENTER**.</span></span>

<span data-ttu-id="95907-237">Второй способ — щелкните в области сценариев (в верхней области PowerShell ISE) и прокрутите вниз до конца скрипта.</span><span class="sxs-lookup"><span data-stu-id="95907-237">The second method is to click in the script pane (the top pane of the PowerShell ISE) and scroll down to the bottom of the script.</span></span> <span data-ttu-id="95907-238">Выделите команду приведенную выше, а затем щелкните ее правой кнопкой мыши и выберите пункт **Выполнить выбранное** или нажмите клавишу **F8** на клавиатуре.</span><span class="sxs-lookup"><span data-stu-id="95907-238">Highlight the command listed above, and then right click it and then click **Run Selection** or press **F8** on the keyboard.</span></span>

![Интегрированная среда сценариев PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig8.png)

<span data-ttu-id="95907-240">В любом случае должно появиться диалоговое окно с сообщением о том, что операция будет завершена через 10–15 минут.</span><span class="sxs-lookup"><span data-stu-id="95907-240">Regardless of the method you use, a dialog box will appear informing you that it will take 10-15 minutes for the operation to complete.</span></span> <span data-ttu-id="95907-241">Щелкните **Да**.</span><span class="sxs-lookup"><span data-stu-id="95907-241">Click **Yes**.</span></span>

<span data-ttu-id="95907-242">В ходе шифрования можно вернуться на портал Azure и просмотреть состояние виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="95907-242">While the encryption process is taking place, you can return to the Azure Portal and see the status of the virtual machine.</span></span> <span data-ttu-id="95907-243">В левой части страницы щелкните **Виртуальные машины**, затем в колонке **Виртуальные машины** щелкните имя виртуальной машины, для которой выполняется шифрование.</span><span class="sxs-lookup"><span data-stu-id="95907-243">On the left side of the page, click **Virtual Machines**, then in the **Virtual Machines** blade, click the name of the virtual machine you’re encrypting.</span></span> <span data-ttu-id="95907-244">В появившейся колонке отобразится ее **состояние** — **Обновление**.</span><span class="sxs-lookup"><span data-stu-id="95907-244">In the blade that appears, you’ll notice that the **Status** says that it’s **Updating**.</span></span> <span data-ttu-id="95907-245">которое свидетельствует о выполнении шифрования.</span><span class="sxs-lookup"><span data-stu-id="95907-245">This demonstrates that encryption is in process.</span></span>

![Дополнительные сведения о виртуальной машине](./media/security-center-disk-encryption/security-center-disk-encryption-fig9.png)

<span data-ttu-id="95907-247">Вернитесь в среду PowerShell ISE.</span><span class="sxs-lookup"><span data-stu-id="95907-247">Return to the PowerShell ISE.</span></span> <span data-ttu-id="95907-248">Когда скрипт буде выполнен, вы увидите результат, показанный на рисунке ниже.</span><span class="sxs-lookup"><span data-stu-id="95907-248">When the script completes, you’ll see what appears in the figure below.</span></span>

![Вывод PowerShell](./media/security-center-disk-encryption/security-center-disk-encryption-fig10.png)

<span data-ttu-id="95907-250">Чтобы убедиться, что виртуальная машина зашифрована, вернитесь на портал Azure и щелкните **Виртуальные машины** в левой части страницы.</span><span class="sxs-lookup"><span data-stu-id="95907-250">To demonstrate that the virtual machine is now encrypted, return to the Azure Portal and click **Virtual Machines** on the left side of the page.</span></span> <span data-ttu-id="95907-251">Щелкните имя зашифрованной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="95907-251">Click the name of the virtual machine you encrypted.</span></span> <span data-ttu-id="95907-252">В колонке **Параметры** щелкните **Диски**.</span><span class="sxs-lookup"><span data-stu-id="95907-252">In the **Settings** blade, click **Disks**.</span></span>

![Параметры](./media/security-center-disk-encryption/security-center-disk-encryption-fig11.png)

<span data-ttu-id="95907-254">В колонке **Диски** вы увидите состояние **шифрования** — **Включено**.</span><span class="sxs-lookup"><span data-stu-id="95907-254">On the **Disks** blade, you will see that **Encryption** is **Enabled**.</span></span>

![Свойства дисков](./media/security-center-disk-encryption/security-center-disk-encryption-fig12.png)

## <a name="next-steps"></a><span data-ttu-id="95907-256">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="95907-256">Next steps</span></span>
<span data-ttu-id="95907-257">Из этого документа вы узнали, как зашифровать виртуальную машину Azure.</span><span class="sxs-lookup"><span data-stu-id="95907-257">In this document, you learned how to encrypt an Azure Virtual Machine.</span></span> <span data-ttu-id="95907-258">Дополнительные сведения о Центре безопасности Azure см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="95907-258">To learn more about Azure Security Center, see the following:</span></span>

* <span data-ttu-id="95907-259">[Наблюдение за работоспособностью системы безопасности в Центре безопасности Azure](security-center-monitoring.md) — узнайте, как наблюдать за работоспособностью ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="95907-259">[Security health monitoring in Azure Security Center](security-center-monitoring.md) – Learn how to monitor the health of your Azure resources</span></span>
* <span data-ttu-id="95907-260">[Управление оповещениями безопасности в Центре безопасности Azure и реагирование на них](security-center-managing-and-responding-alerts.md) — сведения об управлении оповещениями системы безопасности и реагировании на них.</span><span class="sxs-lookup"><span data-stu-id="95907-260">[Managing and responding to security alerts in Azure Security Center](security-center-managing-and-responding-alerts.md) - Learn how to manage and respond to security alerts</span></span>
* <span data-ttu-id="95907-261">[Часто задаваемые вопросы о Центре безопасности Azure](security-center-faq.md) — часто задаваемые вопросы об использовании этой службы.</span><span class="sxs-lookup"><span data-stu-id="95907-261">[Azure Security Center FAQ](security-center-faq.md) – Find frequently asked questions about using the service</span></span>
* <span data-ttu-id="95907-262">[Блог по безопасности Azure](http://blogs.msdn.com/b/azuresecurity/) — публикации блога, посвященные безопасности Azure и соответствию требованиям.</span><span class="sxs-lookup"><span data-stu-id="95907-262">[Azure Security Blog](http://blogs.msdn.com/b/azuresecurity/) – Find blog posts about Azure security and compliance</span></span>
