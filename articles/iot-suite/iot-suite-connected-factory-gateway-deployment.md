---
title: "подключение к Azure IoT Suite aaaDeploy фабрики шлюза | Документы Microsoft"
description: "Способ toodeploy шлюз в Windows или Linux toohello подключения tooenable подключения фабрики предварительно настроенных решений."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: 72436dec60eda0de20143f362fe740b0c4412f36
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-hello-connected-factory-preconfigured-solution"></a><span data-ttu-id="58e27-103">Развертывание шлюза в Windows или Linux для hello подключен фабрики предварительно настроенных решений</span><span class="sxs-lookup"><span data-stu-id="58e27-103">Deploy a gateway on Windows or Linux for hello connected factory preconfigured solution</span></span>

<span data-ttu-id="58e27-104">Hello программного обеспечения требуемые toodeploy a шлюз для hello подключен фабрики предварительно настроенное решение состоит из двух компонентов:</span><span class="sxs-lookup"><span data-stu-id="58e27-104">hello software required toodeploy a gateway for hello connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="58e27-105">Hello *прокси OPC* устанавливает tooIoT подключение концентратора.</span><span class="sxs-lookup"><span data-stu-id="58e27-105">hello *OPC Proxy* establishes a connection tooIoT Hub.</span></span> <span data-ttu-id="58e27-106">Hello *прокси OPC* затем ожидает команды и управления сообщения от hello интеграции OPC браузер, в котором выполняется решение портала hello подключенных фабрики.</span><span class="sxs-lookup"><span data-stu-id="58e27-106">hello *OPC Proxy* then waits for command and control messages from hello integrated OPC Browser that runs in hello connected factory solution portal.</span></span>
* <span data-ttu-id="58e27-107">Hello *издатель OPC* подключается tooexisting локальных OPC UA серверов и перенаправляет сообщения телеметрии из них tooIoT концентратора.</span><span class="sxs-lookup"><span data-stu-id="58e27-107">hello *OPC Publisher* connects tooexisting on-premises OPC UA servers and forwards telemetry messages from them tooIoT Hub.</span></span>

<span data-ttu-id="58e27-108">Оба компонента имеют открытый исходный код и доступны в виде файлов с исходным кодом на GitHub и в качестве контейнеров Docker:</span><span class="sxs-lookup"><span data-stu-id="58e27-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="58e27-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="58e27-109">GitHub</span></span> | <span data-ttu-id="58e27-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="58e27-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="58e27-111">[Издатель OPC][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="58e27-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="58e27-112">[Издатель OPC][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="58e27-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="58e27-113">[Прокси-сервер OPC][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="58e27-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="58e27-114">[Прокси-сервер OPC][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="58e27-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="58e27-115">Нет общедоступный IP-адрес или уязвимости в брандмауэре шлюза hello необходимы для любого компонента.</span><span class="sxs-lookup"><span data-stu-id="58e27-115">No public-facing IP address or holes in hello gateway firewall are required for either component.</span></span> <span data-ttu-id="58e27-116">Hello OPC прокси-сервер и издатель OPC используют только исходящие порты 443, 5671 и 8883.</span><span class="sxs-lookup"><span data-stu-id="58e27-116">hello OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="58e27-117">Hello действия, описанные в этой статье показано, как toodeploy a шлюз с помощью Docker на либо [Windows](#windows-deployment) или [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="58e27-117">hello steps in this article show you how toodeploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="58e27-118">шлюз Hello позволяет подключения toohello подключен фабрики предварительно настроенных решений.</span><span class="sxs-lookup"><span data-stu-id="58e27-118">hello gateway enables connectivity toohello connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="58e27-119">программное обеспечение шлюза Hello, работающего в контейнер Docker hello [Azure IoT Edge].</span><span class="sxs-lookup"><span data-stu-id="58e27-119">hello gateway software that runs in hello Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="58e27-120">Развертывание в ОС Windows</span><span class="sxs-lookup"><span data-stu-id="58e27-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="58e27-121">Если у вас еще нет устройства шлюза, то корпорация Майкрософт рекомендует приобрести коммерческий шлюз у одного из наших партнеров.</span><span class="sxs-lookup"><span data-stu-id="58e27-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="58e27-122">Посетите hello [каталога устройства Azure IoT] список шлюза устройств, совместимых с hello подключен фабрики решения.</span><span class="sxs-lookup"><span data-stu-id="58e27-122">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="58e27-123">Следуйте инструкциям hello, входящие в состав tooset устройства hello Создание шлюза hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-123">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="58e27-124">Кроме того можно используйте следующие инструкции toomanually настроить один из шлюзов существующих hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-124">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="58e27-125">Установка Docker</span><span class="sxs-lookup"><span data-stu-id="58e27-125">Install Docker</span></span>

<span data-ttu-id="58e27-126">Установите [Docker для Windows] на устройстве шлюза, работающем под управлением Windows.</span><span class="sxs-lookup"><span data-stu-id="58e27-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="58e27-127">Во время установки Windows Docker выберите накопитель на tooshare машины на узле с помощью Docker.</span><span class="sxs-lookup"><span data-stu-id="58e27-127">During Windows Docker setup, select a drive on your host machine tooshare with Docker.</span></span> <span data-ttu-id="58e27-128">Следующий снимок экрана показан общий доступ к диску hello D в системе Windows Hello:</span><span class="sxs-lookup"><span data-stu-id="58e27-128">hello following screenshot shows sharing hello D drive on your Windows system:</span></span>

![Установка Docker][img-install-docker]

<span data-ttu-id="58e27-130">Затем создайте папку с именем **docker** в корне hello hello общий диск.</span><span class="sxs-lookup"><span data-stu-id="58e27-130">Then create a folder called **docker** in hello root of hello shared drive.</span></span>
<span data-ttu-id="58e27-131">Кроме того, этот этап можно выполнить после установки docker из hello **параметры** меню.</span><span class="sxs-lookup"><span data-stu-id="58e27-131">You can also perform this step after installing docker from hello **Settings** menu.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="58e27-132">Настройка шлюза hello</span><span class="sxs-lookup"><span data-stu-id="58e27-132">Configure hello gateway</span></span>

1. <span data-ttu-id="58e27-133">Требуется hello **iothubowner** строка подключения к Azure IoT Suite подключен развертывания шлюза hello toocomplete развертывания фабрики.</span><span class="sxs-lookup"><span data-stu-id="58e27-133">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="58e27-134">В hello [портал Azure], перейдите в центр IoT в группе ресурсов hello, созданные при развертывании решения фабрики hello подключен tooyour.</span><span class="sxs-lookup"><span data-stu-id="58e27-134">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="58e27-135">Нажмите кнопку **политики общего доступа** tooaccess hello **iothubowner** строка подключения:</span><span class="sxs-lookup"><span data-stu-id="58e27-135">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Найти строку подключения центр IoT hello][img-hub-connection]

    <span data-ttu-id="58e27-137">Копировать hello **строка подключения — первичный ключ** значение.</span><span class="sxs-lookup"><span data-stu-id="58e27-137">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="58e27-138">Настройка шлюза hello для вашего центра IoT, выполнив hello двух модулей шлюза **после** из командной строки с помощью:</span><span class="sxs-lookup"><span data-stu-id="58e27-138">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="58e27-139">**&lt;ApplicationName&gt;**  — tooyour toogive hello имя издателя OPC агент пользователя в формате hello **издателя.&lt; свое полное доменное имя&gt;**.</span><span class="sxs-lookup"><span data-stu-id="58e27-139">**&lt;ApplicationName&gt;** is hello name toogive tooyour OPC UA Publisher in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="58e27-140">Например, если фабрика сети называется **myfactorynetwork.com**, hello **ApplicationName** значение **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="58e27-140">For example, if your factory network is called **myfactorynetwork.com**, hello **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="58e27-141">**&lt;IoTHubOwnerConnectionString&gt;**  — hello **iothubowner** строку подключения, скопированным на предыдущем шаге hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-141">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="58e27-142">Эта строка подключения используется только на этом шаге, он не нужен в hello следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="58e27-142">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="58e27-143">Вы используете hello сопоставленный диск D:\\папку docker (hello `-v` аргумент) более поздней версии toopersist hello двух сертификатов X.509, использующих модули шлюза hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-143">You use hello mapped D:\\docker folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="58e27-144">Запустите шлюз hello</span><span class="sxs-lookup"><span data-stu-id="58e27-144">Run hello gateway</span></span>

1. <span data-ttu-id="58e27-145">Перезапустите шлюз hello, с помощью hello, следующие команды:</span><span class="sxs-lookup"><span data-stu-id="58e27-145">Restart hello gateway using hello following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="58e27-146">По соображениям безопасности hello двух сертификатов X.509 сохраняется в hello D:\\папку docker содержит hello закрытого ключа.</span><span class="sxs-lookup"><span data-stu-id="58e27-146">For security reasons, hello two X.509 certificates persisted in hello D:\\docker folder contain hello private key.</span></span> <span data-ttu-id="58e27-147">Ограничение доступа к папке toothis toohello, учетные данные (обычно **Администраторы**) использовать контейнер Docker toorun hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-147">Limit access toothis folder toohello credentials (typically **Administrators**) you use toorun hello Docker container.</span></span> <span data-ttu-id="58e27-148">Щелкните правой кнопкой мыши hello D:\\папку docker выберите **свойства**, затем **безопасности**, а затем **изменить**.</span><span class="sxs-lookup"><span data-stu-id="58e27-148">Right-click hello D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="58e27-149">Предоставьте **администраторам** полный доступ и удалите всех остальных:</span><span class="sxs-lookup"><span data-stu-id="58e27-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Предоставление разрешений tooDocker папки][img-docker-share]

1. <span data-ttu-id="58e27-151">Проверьте сетевое подключение.</span><span class="sxs-lookup"><span data-stu-id="58e27-151">Verify network connectivity.</span></span> <span data-ttu-id="58e27-152">В командной строке введите команду hello `ping publisher.<your fully qualified domain name>` tooping шлюза.</span><span class="sxs-lookup"><span data-stu-id="58e27-152">From a command prompt, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="58e27-153">Если hello назначения недоступен, добавьте hello IP-адрес и имя файла hosts toohello шлюза на шлюзе.</span><span class="sxs-lookup"><span data-stu-id="58e27-153">If hello destination is unreachable, add hello IP address and name of your gateway toohello hosts file on your gateway.</span></span> <span data-ttu-id="58e27-154">файл hosts Hello находится в hello **Windows\\System32\\драйверы\\и т. д** папки.</span><span class="sxs-lookup"><span data-stu-id="58e27-154">hello hosts file is located in hello **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="58e27-155">После этого повторите tooconnect toohello издателя с помощью локального OPC агент пользователя клиента, запущенного на шлюз hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-155">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="58e27-156">Здравствуйте, OPC UA-адрес конечной точки `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="58e27-156">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="58e27-157">Если у вас нет клиента OPC UA, скачайте и используйте [клиент OPC UA с открытым кодом].</span><span class="sxs-lookup"><span data-stu-id="58e27-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="58e27-158">Когда эти локальные тесты успешно завершена, Обзор toohello **подключения сервер UA OPC** hello подключенных фабрики решение портала.</span><span class="sxs-lookup"><span data-stu-id="58e27-158">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="58e27-159">Введите URL-адрес конечной точки издателя hello (`tcp://publisher.<your fully qualified domain name>:62222`) и нажмите кнопку **Connect**.</span><span class="sxs-lookup"><span data-stu-id="58e27-159">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="58e27-160">После отображения предупреждения о сертификате щелкните **Продолжить**.</span><span class="sxs-lookup"><span data-stu-id="58e27-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="58e27-161">Далее вы получаете сообщение об этом hello hello UA веб-клиента не является доверенным издателем.</span><span class="sxs-lookup"><span data-stu-id="58e27-161">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="58e27-162">tooresolve этой ошибки, hello копирования **веб-агент пользователя клиента** сертификат из hello **D:\\docker\\отклонено сертификаты\\сертификаты** папки toohello **D:\\docker\\приложений UA\\сертификаты** папки на шлюзе hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-162">tooresolve this error, copy hello **UA Web Client** certificate from hello **D:\\docker\\Rejected Certificates\\certs** folder toohello **D:\\docker\\UA Applications\\certs** folder on hello gateway.</span></span> <span data-ttu-id="58e27-163">Toorestart hello шлюза не обязательно.</span><span class="sxs-lookup"><span data-stu-id="58e27-163">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="58e27-164">Повторите этот шаг.</span><span class="sxs-lookup"><span data-stu-id="58e27-164">Repeat this step.</span></span> <span data-ttu-id="58e27-165">Шлюз toohello теперь можно подключиться из облака hello и будут готовы tooadd решения toohello серверы OPC UA.</span><span class="sxs-lookup"><span data-stu-id="58e27-165">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="58e27-166">Добавление серверов OPC UA</span><span class="sxs-lookup"><span data-stu-id="58e27-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="58e27-167">Обзор toohello **подключения сервер UA OPC** hello подключенных фабрики решение портала.</span><span class="sxs-lookup"><span data-stu-id="58e27-167">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="58e27-168">Выполните приветствия же действия, как предшествующий tooestablish раздел hello доверие между hello портала подключенных фабрики и hello server OPC UA.</span><span class="sxs-lookup"><span data-stu-id="58e27-168">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="58e27-169">Этот шаг устанавливает взаимного доверия сертификатов hello из hello подключен портала фабрики и hello OPC UA server и создает подключение.</span><span class="sxs-lookup"><span data-stu-id="58e27-169">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="58e27-170">Обзор hello дерева узлов OPC UA OPC UA сервера, щелкните правой кнопкой мыши узлы OPC hello и выберите **публикации**.</span><span class="sxs-lookup"><span data-stu-id="58e27-170">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="58e27-171">Для публикации toowork таким образом, hello OPC UA сервера и hello издатель должен быть на hello одной сети.</span><span class="sxs-lookup"><span data-stu-id="58e27-171">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="58e27-172">Другими словами, если hello полное доменное имя домена hello издателя — **publisher.mydomain.com** hello полное доменное имя hello OPC UA сервер должен быть, например, а затем **myopcuaserver.mydomain.com**. Если настройки отличаются, можно вручную добавить узлы toohello publishesnodes.json файл, находящийся в hello **D:\\docker** папки.</span><span class="sxs-lookup"><span data-stu-id="58e27-172">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **D:\\docker** folder.</span></span> <span data-ttu-id="58e27-173">Hello publishesnodes.json файл создается автоматически на hello сначала успешной публикации узла OPC.</span><span class="sxs-lookup"><span data-stu-id="58e27-173">hello publishesnodes.json file is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="58e27-174">Данные телеметрии, направляемые из устройства шлюза hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-174">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="58e27-175">Можно просмотреть данные телеметрии hello в hello **расположения фабрики** представление портала подключенных фабрики hello в разделе **новую фабрику**.</span><span class="sxs-lookup"><span data-stu-id="58e27-175">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="58e27-176">Развертывание в ОС Linux</span><span class="sxs-lookup"><span data-stu-id="58e27-176">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="58e27-177">Если у вас еще нет устройства шлюза, то корпорация Майкрософт рекомендует приобрести коммерческий шлюз у одного из наших партнеров.</span><span class="sxs-lookup"><span data-stu-id="58e27-177">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="58e27-178">Посетите hello [каталога устройства Azure IoT] список шлюза устройств, совместимых с hello подключен фабрики решения.</span><span class="sxs-lookup"><span data-stu-id="58e27-178">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="58e27-179">Следуйте инструкциям hello, входящие в состав tooset устройства hello Создание шлюза hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-179">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="58e27-180">Кроме того можно используйте следующие инструкции toomanually настроить один из шлюзов существующих hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-180">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

<span data-ttu-id="58e27-181">[Установите Docker] на устройстве шлюза, работающем под управлением Linux.</span><span class="sxs-lookup"><span data-stu-id="58e27-181">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="58e27-182">Настройка шлюза hello</span><span class="sxs-lookup"><span data-stu-id="58e27-182">Configure hello gateway</span></span>

1. <span data-ttu-id="58e27-183">Требуется hello **iothubowner** строка подключения к Azure IoT Suite подключен развертывания шлюза hello toocomplete развертывания фабрики.</span><span class="sxs-lookup"><span data-stu-id="58e27-183">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="58e27-184">В hello [портал Azure], перейдите в центр IoT в группе ресурсов hello, созданные при развертывании решения фабрики hello подключен tooyour.</span><span class="sxs-lookup"><span data-stu-id="58e27-184">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="58e27-185">Нажмите кнопку **политики общего доступа** tooaccess hello **iothubowner** строка подключения:</span><span class="sxs-lookup"><span data-stu-id="58e27-185">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Найти строку подключения центр IoT hello][img-hub-connection]

    <span data-ttu-id="58e27-187">Копировать hello **строка подключения — первичный ключ** значение.</span><span class="sxs-lookup"><span data-stu-id="58e27-187">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="58e27-188">Настройка шлюза hello для вашего центра IoT, выполнив hello двух модулей шлюза **после** из оболочки с:</span><span class="sxs-lookup"><span data-stu-id="58e27-188">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="58e27-189">**&lt;ApplicationName&gt;**  — имя hello hello создает OPC UA приложения hello шлюза в формате hello **издателя.&lt; свое полное доменное имя&gt;**.</span><span class="sxs-lookup"><span data-stu-id="58e27-189">**&lt;ApplicationName&gt;** is hello name of hello OPC UA application hello gateway creates in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="58e27-190">Например, **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="58e27-190">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="58e27-191">**&lt;IoTHubOwnerConnectionString&gt;**  — hello **iothubowner** строку подключения, скопированным на предыдущем шаге hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-191">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="58e27-192">Эта строка подключения используется только на этом шаге, он не нужен в hello следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="58e27-192">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="58e27-193">Использовать hello **/ shared** папку (hello `-v` аргумент) двух сертификатов X.509, использующих модули шлюза hello hello toopersist более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="58e27-193">You use hello **/shared** folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="58e27-194">Запустите шлюз hello</span><span class="sxs-lookup"><span data-stu-id="58e27-194">Run hello gateway</span></span>

1. <span data-ttu-id="58e27-195">Перезапустите шлюз hello, с помощью hello, следующие команды:</span><span class="sxs-lookup"><span data-stu-id="58e27-195">Restart hello gateway using hello following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="58e27-196">По соображениям безопасности hello двух сертификатов X.509 сохраняется в hello **/ shared** папки содержит hello закрытого ключа.</span><span class="sxs-lookup"><span data-stu-id="58e27-196">For security reasons, hello two X.509 certificates persisted in hello **/shared** folder contain hello private key.</span></span> <span data-ttu-id="58e27-197">Ограничение доступа toothis папки toohello учетные данные, используемые toorun hello контейнера Docker.</span><span class="sxs-lookup"><span data-stu-id="58e27-197">Limit access toothis folder toohello credentials you use toorun hello Docker container.</span></span> <span data-ttu-id="58e27-198">разрешения hello tooset для **корневой** только использовать hello `chmod` команде hello папки оболочки.</span><span class="sxs-lookup"><span data-stu-id="58e27-198">tooset hello permissions for **root** only, use hello `chmod` shell command on hello folder.</span></span>

1. <span data-ttu-id="58e27-199">Проверьте сетевое подключение.</span><span class="sxs-lookup"><span data-stu-id="58e27-199">Verify network connectivity.</span></span> <span data-ttu-id="58e27-200">Из оболочки, введите команду hello `ping publisher.<your fully qualified domain name>` tooping шлюза.</span><span class="sxs-lookup"><span data-stu-id="58e27-200">From a shell, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="58e27-201">Если hello назначения недоступен, добавьте hello IP-адрес и имя файла hosts tooyour шлюза на шлюзе.</span><span class="sxs-lookup"><span data-stu-id="58e27-201">If hello destination is unreachable, add hello IP address and name of your gateway tooyour hosts file on your gateway.</span></span> <span data-ttu-id="58e27-202">файл hosts Hello находится в hello **и т. п.** папки.</span><span class="sxs-lookup"><span data-stu-id="58e27-202">hello hosts file is located in hello **/etc** folder.</span></span>

1. <span data-ttu-id="58e27-203">После этого повторите tooconnect toohello издателя с помощью локального OPC агент пользователя клиента, запущенного на шлюз hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-203">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="58e27-204">Здравствуйте, OPC UA-адрес конечной точки `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="58e27-204">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="58e27-205">Если у вас нет клиента OPC UA, скачайте и используйте [клиент OPC UA с открытым кодом].</span><span class="sxs-lookup"><span data-stu-id="58e27-205">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="58e27-206">Когда эти локальные тесты успешно завершена, Обзор toohello **подключения сервер UA OPC** hello подключенных фабрики решение портала.</span><span class="sxs-lookup"><span data-stu-id="58e27-206">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="58e27-207">Введите URL-адрес конечной точки издателя hello (`tcp://publisher.<your fully qualified domain name>:62222`) и нажмите кнопку **Connect**.</span><span class="sxs-lookup"><span data-stu-id="58e27-207">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="58e27-208">После отображения предупреждения о сертификате щелкните **Продолжить**.</span><span class="sxs-lookup"><span data-stu-id="58e27-208">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="58e27-209">Далее вы получаете сообщение об этом hello hello UA веб-клиента не является доверенным издателем.</span><span class="sxs-lookup"><span data-stu-id="58e27-209">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="58e27-210">tooresolve этой ошибки, hello копирования **веб-агент пользователя клиента** сертификат из hello **/общие/отклонено сертификаты и сертификаты** toohello папки **/shared/UA приложения и сертификаты** Папка на шлюзе hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-210">tooresolve this error, copy hello **UA Web Client** certificate from hello **/shared/Rejected Certificates/certs** folder toohello **/shared/UA Applications/certs** folder on hello gateway.</span></span> <span data-ttu-id="58e27-211">Toorestart hello шлюза не обязательно.</span><span class="sxs-lookup"><span data-stu-id="58e27-211">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="58e27-212">Повторите этот шаг.</span><span class="sxs-lookup"><span data-stu-id="58e27-212">Repeat this step.</span></span> <span data-ttu-id="58e27-213">Шлюз toohello теперь можно подключиться из облака hello и будут готовы tooadd решения toohello серверы OPC UA.</span><span class="sxs-lookup"><span data-stu-id="58e27-213">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="58e27-214">Добавление серверов OPC UA</span><span class="sxs-lookup"><span data-stu-id="58e27-214">Add your OPC UA servers</span></span>

1. <span data-ttu-id="58e27-215">Обзор toohello **подключения сервер UA OPC** hello подключенных фабрики решение портала.</span><span class="sxs-lookup"><span data-stu-id="58e27-215">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="58e27-216">Выполните приветствия же действия, как предшествующий tooestablish раздел hello доверие между hello портала подключенных фабрики и hello server OPC UA.</span><span class="sxs-lookup"><span data-stu-id="58e27-216">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="58e27-217">Этот шаг устанавливает взаимного доверия сертификатов hello из hello подключен портала фабрики и hello OPC UA server и создает подключение.</span><span class="sxs-lookup"><span data-stu-id="58e27-217">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="58e27-218">Обзор hello дерева узлов OPC UA OPC UA сервера, щелкните правой кнопкой мыши узлы OPC hello и выберите **публикации**.</span><span class="sxs-lookup"><span data-stu-id="58e27-218">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="58e27-219">Для публикации toowork таким образом, hello OPC UA сервера и hello издатель должен быть на hello одной сети.</span><span class="sxs-lookup"><span data-stu-id="58e27-219">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="58e27-220">Другими словами, если hello полное доменное имя домена hello издателя — **publisher.mydomain.com** hello полное доменное имя hello OPC UA сервер должен быть, например, а затем **myopcuaserver.mydomain.com**. Если настройки отличаются, можно вручную добавить узлы toohello publishesnodes.json файл, находящийся в hello **/ shared** папки.</span><span class="sxs-lookup"><span data-stu-id="58e27-220">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **/shared** folder.</span></span> <span data-ttu-id="58e27-221">Hello publishesnodes.json создается автоматически на hello сначала успешной публикации узла OPC.</span><span class="sxs-lookup"><span data-stu-id="58e27-221">hello publishesnodes.json is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="58e27-222">Данные телеметрии, направляемые из устройства шлюза hello.</span><span class="sxs-lookup"><span data-stu-id="58e27-222">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="58e27-223">Можно просмотреть данные телеметрии hello в hello **расположения фабрики** представление портала подключенных фабрики hello в разделе **новую фабрику**.</span><span class="sxs-lookup"><span data-stu-id="58e27-223">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="58e27-224">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="58e27-224">Next steps</span></span>

<span data-ttu-id="58e27-225">toolearn больше об архитектуре hello подключенных фабрики hello предварительно настроенных решений см. в разделе [подключенных фабрики заранее настроенные Пошаговое руководство по решениям][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="58e27-225">toolearn more about hello architecture of hello connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

[Docker для Windows]: https://www.docker.com/docker-windows
[каталога устройства Azure IoT]: https://catalog.azureiotsuite.com/?q=opc
[портал Azure]: http://portal.azure.com/
[клиент OPC UA с открытым кодом]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4
[Установите Docker]: https://www.docker.com/community-edition#/download
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[Azure IoT Edge]: https://github.com/Azure/iot-edge (Edge Интернета вещей Azure)

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy