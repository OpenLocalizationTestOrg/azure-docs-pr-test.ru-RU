---
title: "Пошаговое руководство по работе с решением подключенной фабрики Azure IoT Suite | Документация Майкрософт"
description: "Описание предварительно настроенного решения подключенной фабрики Azure IoT и его архитектура."
services: 
suite: iot-suite
documentationcenter: 
author: dominicbetts
manager: timlt
editor: 
ms.assetid: 31fe13af-0482-47be-b4c8-e98e36625855
ms.service: iot-suite
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/27/2017
ms.author: dobett
ms.openlocfilehash: 517e908a744734139ed0aeee314a4f3b9eda86cc
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="connected-factory-preconfigured-solution-walkthrough"></a>Пошаговое руководство по работе с предварительно настроенным решением подключенной фабрики

[Предварительно настроенное решение][lnk-preconfigured-solutions] подключенной фабрики IoT Suite представляет собой законченную реализацию отраслевого решения, которое умеет выполнять следующие задачи.

* Подключается к виртуальным отраслевым устройствам под управлением серверов OPC UA на производственных линиях виртуальной фабрики и к физическим устройствам сервера OPC UA. Дополнительные сведения об OPC UA см. в статье [Часто задаваемые вопросы о предварительно настроенном решении для подключенной фабрики IoT Suite](iot-suite-faq-cf.md).
* Показывает оперативные ключевые показатели эффективности и общую эффективность оборудования этих устройств и производственных линий.
* Демонстрирует, как можно использовать облачное приложение для взаимодействия с серверными системами OPC UA.
* Позволяет подключать собственные устройства под управлением сервера OPC UA.
* Позволяет просматривать и изменять данные сервера OPC UA.
* Интегрируется со службой Azure Time Series Insights (TSI) для предоставления пользовательских представлений данных с серверов OPC UA.

Его можно использовать в качестве отправной точки для собственной реализации и [настроить][lnk-customize] в соответствии с потребностями конкретной организации.

В этой статье рассматриваются некоторые основные компоненты решения подключенной фабрики, которые помогут вам представить, как оно работает. Эти знания помогут вам:

* устранить проблемы, возникшие с решением;
* спланировать настройку решения в соответствии с определенными требованиями;
* спроектировать собственное решение IoT, использующее службы Azure.

Дополнительные сведения см. в разделе с [часто задаваемыми вопросами о подключенной фабрике](iot-suite-faq-cf.md).

## <a name="logical-architecture"></a>Логическая архитектура

На следующей диаграмме показаны логические компоненты предварительно настроенного решения.

![Логическая архитектура подключенной фабрики][connected-factory-logical]

## <a name="communication-patterns"></a>Модели связи

Решение использует [спецификацию публикации и подписки OPC UA](https://opcfoundation.org/news/opc-foundation-news/opc-foundation-announces-support-of-publish-subscribe-for-opc-ua/) для отправки данных телеметрии OPC UA в Центр Интернета вещей в формате JSON. В решении для этого используется модуль IoT Edge [издателя OPC](https://github.com/Azure/iot-edge-opc-publisher).

Решение также содержит клиент OPC UA, интегрированный в веб-приложение, которое может устанавливать соединение с локальными серверами OPC UA. Клиент использует [обратный прокси-сервер](https://wikipedia.org/wiki/Reverse_proxy) и с помощью Центра Интернета вещей создает подключение без необходимости открывать порты в локальном брандмауэре. Эта модель связи называется [взаимодействием с поддержкой службы](https://blogs.msdn.microsoft.com/clemensv/2014/02/09/service-assisted-communication-for-connected-devices/). В решении для этого используется модуль IoT Edge [прокси OPC](https://github.com/Azure/iot-edge-opc-proxy/).


## <a name="simulation"></a>Моделирование

Виртуальные станции и системы управления производственными процессами (MES) образуют производственную линию фабрики. Виртуальные устройства и модуль издателя OPC основаны на [стандарте OPC UA .NET][lnk-OPC-UA-NET-Standard], опубликованном OPC Foundation.

Прокси-сервер и издатель OPC реализованы как модули на основе [Edge Интернета вещей Azure][lnk-Azure-IoT-Gateway]. К каждой виртуальной производственной линии подключен отдельный шлюз.

Все виртуальные компоненты работают в контейнерах Docker, размещенных на виртуальной машине Azure под управлением Linux. По умолчанию моделирование настроено для работы восьми виртуальных производственных линий.

## <a name="simulated-production-line"></a>Виртуальная производственная линия

Производственная линия изготавливает детали. Она состоит из различных станций: станция сборки, станция тестирования и станция упаковки.

Моделирование работает и обновляет данные, которые отображаются на узлах OPC UA. Работа всех станций виртуальной производственной линии координируется с помощью MES через OPC UA.

## <a name="simulated-manufacturing-execution-system"></a>Виртуальная система управления производственными процессами

Система MES отслеживает каждую станцию на производственной линии через OPC UA для обнаружения изменений в состоянии станции. Она вызывает методы OPC UA для управления станциями и передает изделие с одной рабочей станции на другую, пока оно не будет готово.

## <a name="gateway-opc-publisher-module"></a>Модуль издателя OPC шлюза

Модуль издателя OPC подключается к серверам OPC UA на станции и подписывается на узлы OPC, которые должны быть опубликованы. Модуль преобразует данные узла в формат JSON, шифрует их и отправляет Центр Интернета вещей в виде сообщений публикации и подписки OPC UA.

Модулю издателя OPC требуется только исходящий порт HTTPS (443), и он может работать с существующей инфраструктурой предприятия.

## <a name="gateway-opc-proxy-module"></a>Модуль прокси OPC шлюза

Модуль прокси OPC UA шлюза предоставляет доступ через туннели двоичным командам и управляющим сообщениям OPC UA. Для его работы требуется только исходящий порт HTTPS (443). Он может работать с существующей инфраструктурой предприятия, в том числе с веб-прокси.

Этот модуль использует методы устройства Центра Интернета вещей для передачи пакетированных данных TCP/IP на уровне приложения. Таким образом с помощью SSL/TLS он обеспечивает доверие конечной точки, шифрование данных и их целостность.

Двоичный протокол OPC UA, который ретранслируется через сам прокси, использует проверку подлинности и шифрование UA.

## <a name="azure-time-series-insights"></a>Azure Time Series Insights

Модуль издателя OPC шлюза подписывается на узлы сервера OPC UA для обнаружения изменений в значениях данных. Если обнаруживается изменение данных на одном из узлов, этот модуль отправляет сообщения в Центр Интернета вещей Azure.

Центр Интернета вещей передает источник события в Azure TSI. TSI хранит данные в течение 30 дней в зависимости от меток времени, вложенных в сообщения. Эти данные включают:

* OPC UA ApplicationUri;
* OPC UA NodeId;
* значение узла;
* метка времени источника;
* OPC UA DisplayName.

Сейчас TSI не позволяет клиентам настраивать продолжительность хранения данных.

TSI отправляет запрос к данным узла с помощью SearchSpan (Time.From, Time.To) и выполняет вычисление на основе значений OPC UA ApplicationUri, OPC UA NodeId или OPC UA DisplayName.

Чтобы получить данные для датчиков общей эффективности оборудования и ключевых показателей эффективности, а также диаграммы временных рядов, данные группируются по количеству событий (Sum — всего событий, Avg — среднее количество, Min — минимальное количество и Max — максимальное количество).

Временные ряды создаются с помощью другого процесса. Показатели общей эффективности оборудования и ключевые показатели эффективности вычисляются на основе базовых данных станции и отображаются для топологии (производственные линии, фабрики, предприятие) в приложении.

Кроме того, временные ряды для топологии общей эффективности оборудования и ключевых показателей эффективности вычисляются в приложении, когда готов отображаемый временной диапазон. Например, представление за день обновляется каждый час.

Представление временного ряда данных узла извлекается напрямую из TSI с помощью вычисления временного диапазона.

## <a name="iot-hub"></a>Центр Интернета вещей
[Центр Интернета вещей][lnk-IoT Hub] принимает данные, отправленные из модуля издателя OPC в облако, и предоставляет к ним доступ службе Azure TSI. 

Центр Интернета вещей также выполняет в решении следующие функции.
- Поддерживает реестр удостоверений, в котором хранятся идентификаторы всех модулей издателя OPC и модулей прокси OPC.
- Используется в качестве канала транспортировки для двустороннего обмена данными модуля прокси OPC.

## <a name="azure-storage"></a>Хранилище Azure
Решение использует хранилище BLOB-объектов Azure в качестве дискового хранилища виртуальной машины и в качестве хранилища данных развертывания.

## <a name="web-app"></a>Веб-приложение
Веб-приложение, развернутое как часть предварительно настроенного решения, состоит из встроенного клиента OPC UA, механизма обработки оповещений и визуализации данных телеметрии.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об IoT Suite см. в следующих статьях.

* [Разрешения на сайте azureiotsuite.com][lnk-permissions]
* [Развертывание шлюза в ОС Windows или Linux для предварительно настроенного решения подключенной фабрики](iot-suite-connected-factory-gateway-deployment.md).

[connected-factory-logical]:media/iot-suite-connected-factory-walkthrough/cf-logical-architecture.png

[lnk-preconfigured-solutions]: iot-suite-what-are-preconfigured-solutions.md
[lnk-customize]: iot-suite-guidance-on-customizing-preconfigured-solutions.md
[lnk-IoT Hub]: https://azure.microsoft.com/documentation/services/iot-hub/
[lnk-direct-methods]: ../iot-hub/iot-hub-devguide-direct-methods.md
[lnk-OPC-UA-NET-Standard]:https://github.com/OPCFoundation/UA-.NETStandardLibrary
[lnk-Azure-IoT-Gateway]: https://github.com/azure/iot-edge
[lnk-permissions]: iot-suite-permissions.md
