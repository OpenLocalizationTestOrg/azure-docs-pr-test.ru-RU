---
title: "Использование динамической телеметрии | Документация Майкрософт"
description: "Ознакомьтесь с этим руководством, чтобы узнать, как использовать динамическую телеметрию с предварительно настроенным решением для удаленного мониторинга Azure IoT Suite."
services: 
suite: iot-suite
documentationcenter: 
author: dominicbetts
manager: timlt
editor: 
ms.assetid: 562799dc-06ea-4cdd-b822-80d1f70d2f09
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/02/2017
ms.author: dobett
ms.openlocfilehash: 60e9ee00fabf15a62e782c70bca251b1a8e617c3
ms.sourcegitcommit: 295ec94e3332d3e0a8704c1b848913672f7467c8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2017
---
# <a name="use-dynamic-telemetry-with-the-remote-monitoring-preconfigured-solution"></a>Использование динамической телеметрии с предварительно настроенным решением для удаленного мониторинга

Динамическая телеметрия позволяют визуализировать любые данные телеметрии, отправленные в предварительно настроенное решение для удаленного мониторинга. Имитации устройств, развертываемые вместе с предварительно настроенным решением, отправляют данные телеметрии температуры и влажности, которые можно отобразить на панели мониторинга. Если настроить существующие имитации устройств, создать имитации устройств или подключить физические устройства к предварительно настроенному решению, то это позволит отправлять другие значения телеметрии, такие как внешняя температура, число оборотов в минуту или скорость ветра. Затем эти дополнительные данные телеметрии можно будет визуализировать на панели мониторинга.

В этом учебнике используется простая имитация устройства Node.js, которую можно легко изменить для экспериментов с динамической телеметрией.

Чтобы завершить этот учебник, потребуется следующее.

* Активная подписка Azure. Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в статье о [бесплатной пробной версии Azure][lnk_free_trial].
* [Node.js][lnk-node] версии 0.12.x или более поздней.

Этот учебник подходит для любой операционной системы, например Windows или Linux, в которой можно установить Node.js.

[!INCLUDE [iot-suite-v1-provision-remote-monitoring](../../includes/iot-suite-v1-provision-remote-monitoring.md)]

[!INCLUDE [iot-suite-v1-send-external-temperature](../../includes/iot-suite-v1-send-external-temperature.md)]

## <a name="add-a-telemetry-type"></a>Добавление типа данных телеметрии

Следующий шаг — заменить данные телеметрии, созданные имитацией устройства Node.js, новым набором значений.

1. Остановите имитацию устройства Node.js, нажав клавиши **Ctrl+C** в командной строке или оболочке.
2. В файле remote_monitoring.js можно увидеть базовые значения для существующих данных телеметрии температуры, влажности и внешней температуры. Добавьте базовое значение данных для **rpm** следующим образом.

    ```nodejs
    // Sensors data
    var temperature = 50;
    var humidity = 50;
    var externalTemperature = 55;
    var rpm = 200;
    ```

3. Имитированное устройство Node.js добавляет случайное приращение базовых значений данных с помощью функции **generateRandomIncrement**, определенной в файле remote_monitoring.js. Рандомизируйте значение **rpm** , добавив строку кода после существующего кода рандомизации следующим образом.

    ```nodejs
    temperature += generateRandomIncrement();
    externalTemperature += generateRandomIncrement();
    humidity += generateRandomIncrement();
    rpm += generateRandomIncrement();
    ```

4. Добавьте новое значение rpm в полезные данные JSON, которые устройство отправляет в Центр Интернета вещей.

    ```nodejs
    var data = JSON.stringify({
      'DeviceID': deviceId,
      'Temperature': temperature,
      'Humidity': humidity,
      'ExternalTemperature': externalTemperature,
      'RPM': rpm
    });
    ```

5. Запустите имитацию устройства Node.js с помощью следующей команды.

    `node remote_monitoring.js`

6. Вы увидите новый тип данных телеметрии RPM на диаграмме на панели мониторинга.

![Добавление значения оборотов в секунду на панель мониторинга][image3]

> [!NOTE]
> Может потребоваться отключить и снова включить устройство Node.js на странице **Устройства** на панели мониторинга, чтобы немедленно отобразить изменения.

## <a name="customize-the-dashboard-display"></a>Настройка отображения панели мониторинга

Сообщение **Device-Info** может содержать метаданные о данных телеметрии, которые устройство может отправлять в Центр Интернета вещей. В этих метаданных могут быть указаны типы данных телеметрии, отправляемых устройством. Измените значение **deviceMetaData** в файле remote_monitoring.js, чтобы добавить определение **Telemetry** после определения **Commands**. Определение **Commands** показано в следующем фрагменте кода (не забудьте добавить `,` после определения **Commands**).

```nodejs
'Commands': [{
  'Name': 'SetTemperature',
  'Parameters': [{
    'Name': 'Temperature',
    'Type': 'double'
  }]
},
{
  'Name': 'SetHumidity',
  'Parameters': [{
    'Name': 'Humidity',
    'Type': 'double'
  }]
}],
'Telemetry': [{
  'Name': 'Temperature',
  'Type': 'double'
},
{
  'Name': 'Humidity',
  'Type': 'double'
},
{
  'Name': 'ExternalTemperature',
  'Type': 'double'
}]
```

> [!NOTE]
> Решение для удаленного мониторинга проверяет соответствие регистра при сравнении определения метаданных с информацией в потоке данных телеметрии.


Добавление определения **Telemetry** , показанное в предыдущем фрагменте кода, не изменяет поведение панели мониторинга. Тем не менее метаданные также могут содержать атрибут **DisplayName** для настройки отображения на панели мониторинга. Измените определение метаданных **Telemetry** , как показано во фрагменте кода ниже.

```nodejs
'Telemetry': [
{
  'Name': 'Temperature',
  'Type': 'double',
  'DisplayName': 'Temperature (C*)'
},
{
  'Name': 'Humidity',
  'Type': 'double',
  'DisplayName': 'Humidity (relative)'
},
{
  'Name': 'ExternalTemperature',
  'Type': 'double',
  'DisplayName': 'Outdoor Temperature (C*)'
}
]
```

На следующем снимке экрана показано, как это изменение меняет легенду диаграммы на панели мониторинга.

![Настройка легенды диаграммы][image4]

> [!NOTE]
> Может потребоваться отключить и снова включить устройство Node.js на странице **Устройства** на панели мониторинга, чтобы немедленно отобразить изменения.

## <a name="filter-the-telemetry-types"></a>Фильтрация типов данных телеметрии

По умолчанию диаграмма на панели мониторинга отображает каждый ряд данных в потоке данных телеметрии. Можно использовать метаданные **Device-Info** , чтобы подавить вывод определенных типов данных телеметрии на диаграмме. 

Чтобы на диаграмме отображались только данные телеметрии температуры и влажности, опустите **ExternalTemperature** в метаданных **Telemetry** для **Device-Info**, как показано ниже.

```nodejs
'Telemetry': [
{
  'Name': 'Temperature',
  'Type': 'double',
  'DisplayName': 'Temperature (C*)'
},
{
  'Name': 'Humidity',
  'Type': 'double',
  'DisplayName': 'Humidity (relative)'
},
//{
//  'Name': 'ExternalTemperature',
//  'Type': 'double',
//  'DisplayName': 'Outdoor Temperature (C*)'
//}
]
```

**Outdoor Temperature** (Наружная температура) больше не отображается на диаграмме.

![Фильтрация данных телеметрии на панели мониторинга][image5]

Это изменение влияет только на отображение диаграммы. Значения данных **ExternalTemperature** по-прежнему сохраняются и остаются доступными для внутренней обработки.

> [!NOTE]
> Может потребоваться отключить и снова включить устройство Node.js на странице **Устройства** на панели мониторинга, чтобы немедленно отобразить изменения.

## <a name="handle-errors"></a>Обработка ошибок

Чтобы поток данных можно было отобразить на диаграмме, его значение **Type** в метаданных **Device-Info** должно соответствовать типу данных значений телеметрии. Например, если в метаданных указано, что **Type** данных влажности — **int**, а в потоке данных телеметрии обнаружен тип **double**, то данные телеметрии влажности не отображаются на диаграмме. Тем не менее значения **Humidity** по-прежнему сохраняются и остаются доступными для внутренней обработки.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как использовать динамическую телеметрию, ознакомьтесь также со статьей о том, как с помощью предварительно настроенных решений применять сведения об устройстве: [Метаданные сведений об устройстве в предварительно настроенном решении для удаленного мониторинга][lnk-devinfo].

[lnk-devinfo]: iot-suite-v1-remote-monitoring-device-info.md

[image3]: media/iot-suite-v1-dynamic-telemetry/image3.png
[image4]: media/iot-suite-v1-dynamic-telemetry/image4.png
[image5]: media/iot-suite-v1-dynamic-telemetry/image5.png

[lnk_free_trial]: http://azure.microsoft.com/pricing/free-trial/
[lnk-node]: http://nodejs.org
