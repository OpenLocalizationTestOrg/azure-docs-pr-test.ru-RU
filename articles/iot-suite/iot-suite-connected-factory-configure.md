---
title: "Настройка топологии подключенных фабрики | Документы Microsoft"
description: "Настройка топологии подключенных фабрики предварительно настроенных решений."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/12/2017
ms.author: dobett
ms.openlocfilehash: 19e0f48ab817428a1f953c80296b2e23effe5a8a
ms.sourcegitcommit: 85012dbead7879f1f6c2965daa61302eb78bd366
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/02/2018
---
# <a name="configure-the-connected-factory-preconfigured-solution"></a>Настройка подключенных фабрики предварительно настроенных решений

Подключенных фабрики предварительно настроенных решений показано имитацию панели мониторинга для вымышленной компании Contoso. Компания располагает фабрики в различных точках земного шара глобального глобально.

В этой статье в качестве примера используется Contoso в целях описания способа настройки топологии решения подключенных фабрики.

## <a name="simulated-factories-configuration"></a>Имитация фабрик конфигурации

Каждая фабрика Contoso имеет рабочей строки, состоящие из трех станций. Каждая станция является сервером реальные OPC UA с определенной ролью:

* Станции сборки
* Тестирование станции
* Упаковка станции

Эти серверы OPC UA имеют OPC UA узлов и [издатель OPC](https://github.com/Azure/iot-edge-opc-publisher) отправляет значения этих узлов подключенных фабрики. А именно:

* Текущее рабочее состояние, например текущее энергопотребление.
* Создаются производственной информации, такие как количество продуктов.

Панели мониторинга можно использовать для перехода к топологии фабрики Contoso из глобальное представление до уровня представления станции. Панели мониторинга подключенных фабрики включает:

* Визуализация фигур OEE и ключевого показателя Эффективности для каждого слоя в топологии.
* Визуализация текущие значения OPC UA узлов в станции.
* Статистическая обработка значений OEE и ключевой показатель Эффективности из уровня станции на глобальном уровне.
* Визуализация оповещений и действия, которые выполняются, если значения достигает определенного предела.

## <a name="connected-factory-topology"></a>Топология подключенных фабрики

Топология фабрик, производственной линии и станций является иерархической:

* Глобальном уровне имеет фабрики узлов как дочерние элементы.
* Фабрик иметь узлов рабочей строки как дочерние элементы.
* Строки производственного иметь станции узлов как дочерние элементы.
* Станции (OPC UA серверы) иметь OPC UA узлов как дочерние элементы.

Каждый узел в топологии имеет общий набор свойств, определяющих:

* Уникальный идентификатор для узла топологии.
* Имя.
* Описание.
* Изображение.
* Дочерние узлы узла топологии.
* Минимальное, целевой и максимальное значения для OEE и ключевого показателя Эффективности рисунков и оповещения для выполнения.

## <a name="topology-configuration-file"></a>Файл конфигурации топологии

Чтобы настроить свойства, перечисленные в предыдущем разделе, подключенных фабрики решение использует файл конфигурации с именем [ContosoTopologyDescription.json](https://github.com/Azure/azure-iot-connected-factory/blob/master/WebApp/Contoso/Topology/ContosoTopologyDescription.json).

Этот файл можно найти в исходном коде решения в `WebApp/Contoso/Topology` папки.

В следующем фрагменте показан Обзор `ContosoTopologyDescription.json` файла конфигурации:

```json
{
  <global_configuration>,
  "Factories": [
    <factory_configuration>,
    "ProductionLines": [
      <production_line_configuration>,
      "Stations": [
        <station_configuration>,
        <more station_configurations>
      ],
      <more production_line_configurations>
    ]
    <more factory_configurations>
  ]
}
```

Общие свойства `<global_configuration>`, `<factory_configuration>`, `<production_line_configuration>`, и `<station_configuration>` являются:

* **Имя** (введите строку)

  Определяет описательное имя, которое должно быть только одно слово для узла топологии для отображения на панели мониторинга.

* **Описание** (введите строку)

  Описание узла топологии более подробно.

* **Изображение** (введите строку)

  Путь к изображению в решение веб-приложение для отображения при отображении сведений об узле топологии на панели мониторинга.

* **OeeOverall**, **OeePerformance**, **OeeAvailability**, **OeeQuality**, **Kpi1**, **Kpi2** (тип `<performance_definition>`)

  Эти свойства определяют минимальный, конечный объект и максимальное значения операционные рисунок, используемый для создания предупреждения. Эти свойства определяют также действий, выполняемых при обнаружении оповещение.

`<factory_configuration>` И `<production_line_configuration>` элементы имеют свойство:

* **Идентификатор GUID** (введите строку)

  Уникально идентифицирует узла топологии.

`<factory_configuration>`имеет свойство:

* **Расположение** (типа `<location_definition>`)

  Указывает, где находится фабрики.

`<station_configuration>`имеет свойства.

* **OpcUri** (введите строку)

  Это свойство должно быть присвоено URI приложения UA OPC сервера OPC UA.
  Так как оно должно быть глобально уникальным по спецификации OPC UA, это свойство используется для идентификации узла топологии станции.

* **OpcNodes**, являющиеся массив узлов OPC UA (типа `<opc_node_description>`)

`<location_definition>`имеет свойства.

* **Город** (введите строку)

  Название города, ближайший к местоположению

* **Страна** (введите строку)

  Страна расположения

* **Широта** (тип double)

  Широта расположения

* **Долгота** (тип double)

  Долгота расположения

`<performance_definition>`имеет свойства.

* **Минимум** (тип double)

  Нижнее пороговое значение значение может получить доступ. Если текущее значение ниже данного порога, оповещение.

* **Целевой** (тип double)

  Идеальный целевое значение.

* **Максимальная** (тип double)

  Верхнее пороговое значение может получить доступ. Если текущее значение превышает это пороговое значение, создается предупреждение.

* **MinimumAlertActions** (типа `<alert_action>`)

  Определяет набор действий, которые могут быть предприняты в ответ на оповещение минимальное.

* **MaximumAlertActions** (типа `<alert_action>`)

  Определяет набор действий, которые могут быть предприняты в ответ на оповещение максимальное.

`<alert_action`> имеет свойства:

* **Тип** (введите строку)

  Тип действие для оповещения. Известны следующие типы:

  * **AcknowledgeAlert**: следует изменить на подтвержденного состояние предупреждения.
  * **CloseAlert**: все старые предупреждения того же типа больше не будут отображаться на панели мониторинга.
  * **CallOpcMethod**: следует вызвать метод OPC UA.
  * **OpenWebPage**: следует открыть окно браузера отображение дополнительную контекстную информацию.

* **Описание** (введите строку)

  Описание действий, которые отображаются на панели мониторинга.

* **Параметр** (введите строку)

  Параметры, необходимые для выполнения действия. Значение зависит от типа действия.

  * **AcknowledgeAlert**: параметр не требуется.
  * **CloseAlert**: параметр не требуется.
  * **CallOpcMethod**: сведения об узле и параметры OPC UA метод, вызываемый в формате «NodeId родительский узел, NodeId метода для вызова URI сервера OPC UA».
  * **OpenWebPage**: URL-адрес для отображения в окне браузера.

`<opc_node_description>`содержит сведения об узлах OPC UA станции (OPC UA сервера). Узлы, которые представляют ни один из существующих узлов OPC UA, но используются в качестве хранилища в логике вычислений подключенных фабрики, также допустимы. Он имеет следующие свойства:

* **NodeId** (введите строку)

  Адрес UA OPC пространства имен узла в станции (OPC UA сервера). Синтаксис должен быть, как указано в спецификации OPC UA NodeId.

* **Символическое** (введите строку)

  Имя, которое будет отображаться на панели мониторинга, если отображается значение этого узла OPC UA.

* **Релевантность** (массив типа String)

  Указывает, для которых вычисление OEE или ключевой показатель Эффективности OPC UA значение узла не применимо. Каждый элемент массива может принимать одно из следующих значений:

  * **OeeAvailability_Running**: значение действителен для вычисления доступности OEE.
  * **OeeAvailability_Fault**: значение действителен для вычисления доступности OEE.
  * **OeePerformance_Ideal**: значение относится к вычисления OEE производительности и обычно имеет постоянное значение.
  * **OeePerformance_Actual**: значение относится к вычисления OEE производительности.
  * **OeeQuality_Good**: значение относится к вычисления OEE качества.
  * **OeeQuality_Bad**: значение относится к вычисления OEE качества.
  * **Kpi1**: значение для расчета KPI1 применимо.
  * **Kpi2**: значение для расчета KPI2 применимо.

* **Код операции** (введите строку)

  Указывает, как значение узла OPC UA обрабатывается в анализ ряда времени запросов и вычислений OEE/ключевого показателя Эффективности. Каждый запрос анализ ряда времени предназначен для конкретного timespan, которая является параметром запроса и доставляет результат. Код операции управляет вычисляется результат и может принимать одно из следующих значений:

  * **Разница между**: разница между последнего и первого значения в период времени.
  * **AVG**: среднее арифметическое всех значений в период времени.
  * **Сумма**: сумму всех значений в период времени.
  * **Последний**: в настоящее время не используется.
  * **Число**: число значений в период времени.
  * **Max**: максимальное значение в период времени.
  * **Min**: минимальное значение в период времени.
  * **Const**: результат — значение, заданное свойством ConstValue.
  * **SubMaxMin**: разница между максимальное и минимальное значение.
  * **TimeSpan**: период времени.

* **Единицы** (введите строку)

  Определение единицы значения для отображения на панели мониторинга.

* **Отображается** (тип boolean)

  Элементы управления, если значение должно отображаться в панели мониторинга.

* **ConstValue** (тип double)

  Если **OpCode** — **Const**, это свойство имеет значение узла.

* **Минимум** (тип double)

  Если текущее значение становится ниже этого значения, минимальные Предупреждение формируется.

* **Максимальная** (тип double)

  Если текущее значение вызывает выше это значение, максимальное Предупреждение формируется.

* **MinimumAlertActions** (типа `<alert_action>`)

  Определяет набор действий, которые могут быть предприняты в ответ на оповещение минимальное.

* **MaximumAlertActions** (типа `<alert_action>`)

  Определяет набор действий, которые могут быть предприняты в ответ на оповещение максимальное.

На уровне станции вы видите **моделирование** объектов. Эти объекты используются только для настройки подключенных фабрики моделирование и не следует использовать для настройки топологии real.

## <a name="how-the-configuration-data-is-used-at-runtime"></a>Как используются данные конфигурации во время выполнения

Все свойства, используемые в файле конфигурации могут быть сгруппированы в различных категориях в зависимости от того, как они используются. Эти категории являются:

### <a name="visual-appearance"></a>Внешний вид

Свойства этой категории определяют внешний вид панели мониторинга подключенных фабрики. Примеры приведены ниже.

* ИМЯ
* ОПИСАНИЕ
* Образ —
* Расположение
* Units
* Visible

### <a name="internal-topology-tree-addressing"></a>Адресация внутренних топологии дерева

Веб-приложение поддерживает внутренние данные словарь, содержащий сведения о всех узлов топологии. Свойства **Guid** и **OpcUri** используются в качестве ключей для доступа к этот словарь и должны быть уникальными.

### <a name="oeekpi-computation"></a>Вычисление OEE/ключевого показателя Эффективности

Фигуры OEE/ключевого показателя Эффективности для имитации подключенных фабрики параметризованных по:

* Значения узлов OPC UA должны быть включены в расчет.
* Как на рисунке вычисляется на основе значений телеметрии.

Подключенный фабрики использует OEE формулы, опубликованное http://oeeindustrystandard.oeefoundation.org.

OPC UA объекты узла в станции Включить тегов для использования в вычислении OEE/ключевого показателя Эффективности. **Релевантности** свойство указывает, для какой рисунок OEE/ключевого показателя Эффективности должно использоваться значение узла OPC UA. **OpCode** свойство определяет, каким образом это значение включается в вычисление.

### <a name="alert-handling"></a>Обработка оповещений

Подключенный фабрики поддерживает механизм простой минимума и максимума на основе порога создание предупреждений. Существует ряд стандартных действий, которые можно настроить в ответ на эти предупреждения. Следующие свойства управляют этот механизм:

* Максимальная
* Минимальная
* MaximumAlertActions
* MinimumAlertActions

## <a name="correlating-to-telemetry-data"></a>Сопоставление для данных телеметрии

Для некоторых операций, таких как визуализация последнее значение или создания анализ ряда времени запросов, веб-приложения должен схему адресации для данных телеметрии полученный. Телеметрии, отправляемые подключенных фабрики также должно быть сохранено в структурах внутренних данных. Эти два свойства, включение этих операций — на станции (OPC UA сервера) и OPC UA узла:

* **OpcUri**

  Идентифицирует (глобально уникальное) сервере OPC UA телеметрии поступают из. В полученный сообщениях это свойство отправляется в виде **ApplicationUri**.

* **NodeId**

  Определяет значения узла на сервере OPC UA. Следует использовать формат свойства, как указано в спецификации OPC агент пользователя. В полученный сообщениях это свойство отправляется в виде **NodeId**.

Проверьте [это](https://github.com/Azure/iot-edge-opc-publisher) странице GitHub Дополнительные сведения о том, как данные телеметрии полученный подключенных фабрики с помощью издателя OPC.

## <a name="example-how-kpi1-is-calculated"></a>Пример: Каким образом вычисляется KPI1

Конфигурации в `ContosoTopologyDescription.json` файл управляет вычисление фигур OEE/ключевого показателя Эффективности. В следующем примере показано, как свойства в этом файле контролировать вычисления KPI1.

В Connected фабрики KPI1 используется для подсчета числа успешно программные продукты за последний час. При моделировании подключенных фабрики каждой станции (OPC UA server) предоставляет узел OPC UA (`NodeId: "ns=2;i=385"`), который предоставляет данные телеметрии для вычисления этого ключевого показателя Эффективности.

Конфигурации для данного узла OPC UA выглядит как следующий фрагмент кода:

```json
{
  "NodeId": "ns=2;i=385",
  "SymbolicName": "NumberOfManufacturedProducts",
  "Relevance": [ "Kpi1", "OeeQuality_Good" ],
  "OpCode": "SubMaxMin"
},
```

Такая конфигурация позволяет запрос значений телеметрии этого узла с помощью аналитики ряда времени. Получает аналитики ряда времени запроса:

* Количество значений.
* Минимальное значение.
* Максимальное значение.
* Среднее всех значений.
* Сумма всех значений для всех уникальных **OpcUri** (**ApplicationUri**), **NodeId** пар в указанного timespan.

Одной из характеристик **NumberOfManufactureredProducts** значение узла является то, что он только повышает. Для вычисления количества продуктов, произведенных в период времени, подключение использует фабрику **OpCode** **SubMaxMin**. Вычисление возвращает минимальное значение в начале период времени и максимальное значение в конце период времени.

**OpCode** в конфигурации настраивает логика вычислений для вычисления результата разница между минимальным и максимальным значениями. Эти результаты, после этого Накоплено нижней вплоть до корневого уровня (глобальная) и отображаются на панели мониторинга.

## <a name="next-steps"></a>Дальнейшие действия

Далее мы советуем ознакомиться с тем, как [развертывать шлюз в Windows или Linux для предварительно настроенного решения подключенной фабрики](iot-suite-connected-factory-gateway-deployment.md).