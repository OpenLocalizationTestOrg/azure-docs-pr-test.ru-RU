---
title: "Использование групп компьютеров при поиске по журналам Log Analytics в Azure | Документация Майкрософт"
description: "В Log Analytics вы можете ограничить поиск по журналам определенной группой компьютеров.  В этой статье описывается, как можно создавать группы компьютеров и использовать их при поиске по журналам."
services: log-analytics
documentationcenter: 
author: bwren
manager: jwhit
editor: 
ms.assetid: a28b9e8a-6761-4ead-aa61-c8451ca90125
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/09/2018
ms.author: bwren
ms.openlocfilehash: 4d6a80082711f09e9c189d53fb4fda00a7d73c29
ms.sourcegitcommit: 9292e15fc80cc9df3e62731bafdcb0bb98c256e1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2018
---
# <a name="computer-groups-in-log-analytics-log-searches"></a>Использование групп компьютеров при поиске по журналам Log Analytics

В Log Analytics вы можете ограничить [поиск по журналам определенной группой компьютеров](log-analytics-log-search-new.md).  Каждая группа заполняется компьютерами с помощью определяемого запроса или при импорте групп из разных источников.  Если группу включить в область поиска по журналам, результаты будут ограничены записями, соответствующими компьютерам в этой группе.

## <a name="creating-a-computer-group"></a>Создание группы компьютеров
В Log Analytics группу компьютеров можно создать с помощью любого из способов, перечисленных в следующей таблице.  Подробные сведения о способе представлены в разделах ниже. 

| Метод | ОПИСАНИЕ |
|:--- |:--- |
| Поиск по журналам |Создание поиска по журналам, который возвращает список компьютеров. |
| API поиска по журналам |Использование API поиска по журналам для создания группы компьютеров на основе результатов поиска по журналам программным образом. |
| Active Directory |Автоматическая проверка членства в группе на компьютерах агента, которые являются членами домена Active Directory, и создание группы в Log Analytics для каждой группы безопасности. |
| Менеджер конфигураций | Импорт коллекций из System Center Configuration Manager и создание группы в службе Log Analytics для каждой из коллекций. |
| Службы обновления Windows Server |Автоматическая проверка целевых групп на клиентах или серверах WSUS и создание для каждой из них группы в Log Analytics. |

### <a name="log-search"></a>Поиск по журналам
Группы компьютеров, созданные с помощью поиска по журналам, содержат все компьютеры, возвращенные указанным поисковым запросом.  Так как этот запрос выполняется при каждом использовании группы компьютеров, отражаются все изменения, внесенные с момента создания группы.  

Для группы можно применить любой запрос, но он должен возвращать набор компьютеров без повторов (используйте для этого `distinct Computer`).  Ниже приведен типичный пример поиска, который можно использовать как группу компьютеров.

    Heartbeat | where Computer contains "srv" | distinct Computer

В приведенной ниже таблице описаны свойства, которые есть у группы компьютеров.

| Свойство | ОПИСАНИЕ |
|:---|:---|
| Отображаемое имя   | Имя поиска, которое отображается на портале. |
| Категория       | Категория для группировки поисковых запросов на портале. |
| Запрос          | Запрос, возвращающий группу компьютеров. |
| Псевдоним функции | Уникальный псевдоним для идентификации группы компьютеров в запросе. |

Ниже приведены инструкции по созданию группы компьютеров с помощью поиска по журналам на портале Azure.

2. Откройте **Поиск по журналам** и щелкните элемент **Сохраненные поиски** в верхней части экрана.
3. Щелкните **Добавить** и укажите значения для каждого свойства группы компьютеров.
4. Выберите действие **Сохранить этот запрос как группу компьютеров** и щелкните **OK**.


Ниже описано, как создать группу компьютеров с помощью поиска по журналам на портале OMS.

1. Откройте **Поиск по журналам** и создайте поиск по журналам, который возвращает группу компьютеров.  
2. Нажмите кнопку **Сохранить** в верхней части экрана.
3. Для параметра **Сохранить этот запрос как группу компьютеров:** выберите значение **Да**.
5. Укажите значения для каждого свойства группы компьютеров. 


>[!NOTE]
> Если ваша рабочая область все еще использует [прежний язык запросов Log Analytics](log-analytics-log-search-upgrade.md), процедура создания группы компьютеров остается неизменной, но в запросе необходимо использовать синтаксис языка запросов прежней версии.


### <a name="log-search-api"></a>API поиска по журналам
Группы компьютеров, созданные с помощью API поиска по журналам и операции поиска по журналам, аналогичны.  Дополнительные сведения о создании группы компьютеров с помощью этого варианта см. в статье [API REST поиска по журналам Log Analytics](log-analytics-log-search-api.md#computer-groups).

### <a name="active-directory"></a>Active Directory
При настройке Log Analytics для импорта членства в группах Active Directory выполняется анализ членства в группах всех присоединенных к домену компьютеров с агентом OMS.  Группа компьютеров создается в Log Analytics для каждой группы безопасности в Active Directory. При этом каждый компьютер включается в группы компьютеров, соответствующие группам безопасности, членами которых они являются.  Это членство обновляется каждые 4 часа.  

Вы можете настроить в Log Analytics импорт групп безопасности из Active Directory, используя раздел **Дополнительные параметры** Log Analytics на портале Azure.  Последовательно выберите **Группы компьютеров**, **Active Directory** и **Импорт членств в группах Active Directory с компьютеров**.  Дополнительная настройка не требуется.

![Группы компьютеров в Active Directory](media/log-analytics-computer-groups/configure-activedirectory.png)

При импорте групп в меню отображаются число компьютеров с обнаруженным членством в группах и число импортированных групп.  Можно щелкнуть любую из этих ссылок для возврата записей **ComputerGroup** с этой информацией.

### <a name="windows-server-update-service"></a>Служба обновления Windows Server
При настройке Log Analytics для импорта членства в группах WSUS выполняется анализ членства в целевых группах всех компьютеров с агентом OMS.  Если выбор осуществляется на стороне клиента, данные членства в группе для всех компьютеров, подключенных к Log Analytics и входящих в любую целевую группу WSUS, импортируются в Log Analytics. При выборе на стороне сервера агент OMS должен быть установлен на сервере WSUS. Это позволит импортировать данные членства в группе в Log Analytics.  Это членство обновляется каждые 4 часа. 

Вы можете настроить в Log Analytics импорт групп из WSUS, используя раздел **Дополнительные параметры** Log Analytics на портале Azure.  Последовательно выберите **Группы компьютеров**, **WSUS** и **Импорт членств в группах WSUS**.  Дополнительная настройка не требуется.

![Группы компьютеров из WSUS](media/log-analytics-computer-groups/configure-wsus.png)

При импорте групп в меню отображаются число компьютеров с обнаруженным членством в группах и число импортированных групп.  Можно щелкнуть любую из этих ссылок для возврата записей **ComputerGroup** с этой информацией.

### <a name="system-center-configuration-manager"></a>System Center Configuration Manager
Если вы настроите в Log Analytics импорт членств в коллекциях Configuration Manager, служба создаст отдельную группу компьютеров для каждой коллекции.  Данные о членстве в коллекциях извлекаются каждые три часа, чтобы поддерживать актуальность групп компьютеров. 

Перед импортом коллекций Configuration Manager следует [подключить Configuration Manager к Log Analytics](log-analytics-sccm.md).  После этого вы сможете настроить импорт в разделе **Дополнительные параметры** Log Analytics на портале Azure.  Последовательно выберите **Группы компьютеров**, **SCCM** и **Импортировать членства в коллекциях Configuration Manager**.  Дополнительная настройка не требуется.

![Группы компьютеров из SCCM](media/log-analytics-computer-groups/configure-sccm.png)

При импорте коллекций в меню отображается число компьютеров с обнаруженным членством в группах и число импортированных групп.  Можно щелкнуть любую из этих ссылок для возврата записей **ComputerGroup** с этой информацией.

## <a name="managing-computer-groups"></a>Управление группами компьютеров
В Log Analytics группы компьютеров, созданные с помощью операции или API поиска по журналам, можно просматривать в меню **Дополнительные параметры** на портале Azure.  Выберите **Группы компьютеров**, а затем **Сохраненные группы**.  

Щелкните значок **x** в столбце **Удаление**, чтобы удалить группу компьютеров.  Щелкните значок **просмотра участников** группы, чтобы выполнить поиск по журналам группы, который возвращает ее участников.  Вы не можете изменить группу компьютеров. Вместо этого следует удалить группу и создать ее заново с новыми параметрами.

![Сохраненные группы компьютеров](media/log-analytics-computer-groups/configure-saved.png)


## <a name="using-a-computer-group-in-a-log-search"></a>Использование группы компьютеров при поиске по журналам
Группу компьютеров, созданную с помощью операции поиска по журналам, можно использовать в запросах, применяя ее псевдоним как функцию. Вот типичный синтаксис для этого:

  `Table | where Computer in (ComputerGroup)`

Например, следующий запрос возвращает записи UpdateSummary только для тех компьютеров, которые входят в группу компьютеров mycomputergroup.
 
  `UpdateSummary | where Computer in (mycomputergroup)`


Импортированные группы компьютеров и их включенные компьютеры хранятся в таблице **ComputerGroup**.  Например, следующий запрос вернет список компьютеров в группе компьютеров домена из Active Directory. 

  `ComputerGroup | where GroupSource == "ActiveDirectory" and Group == "Domain Computers" | distinct Computer`

Следующий запрос вернет записи UpdateSummary только для компьютеров из группы компьютеров домена.

  ```
  let ADComputers = ComputerGroup | where GroupSource == "ActiveDirectory" and Group == "Domain Computers" | distinct Computer;
  UpdateSummary | where Computer in (ADComputers)
  ```



  

>[!NOTE]
> Если ваша рабочая область все еще использует [язык запросов Log Analytics прежней версии](log-analytics-log-search-upgrade.md), примените следующий синтаксис для указания группы компьютеров на странице поиска по журналам.  Параметр **Категория** указывать не обязательно. Он нужен, только если у вас есть группы с одинаковыми именами в разных категориях. 
>
>    `$ComputerGroups[Category: Name]`
>
>При поиске по журналам группы компьютеров обычно используются с предложением **IN**, как показано в следующем примере:
>
>    `Type=UpdateSummary Computer IN $ComputerGroups[My Computer Group]`



## <a name="computer-group-records"></a>Записи группы компьютеров
Запись создается в рабочей области Log Analytics для каждого членства в группе компьютеров, создаваемого в Active Directory или WSUS.  Записи о производительности имеют тип **ComputerGroup**. Их свойства описаны в таблице ниже.  Для групп компьютеров, созданных с помощью операции поиска по журналам, записи не создаются.

| Свойство | ОПИСАНИЕ |
|:--- |:--- |
| type |*ComputerGroup* |
| SourceSystem |*SourceSystem* |
| Компьютер |Имя компьютера-члена. |
| Группа |Имя группы. |
| GroupFullName |Полный путь к группе, включая источник и имя источника. |
| GroupSource |Источник, из которого получена группа. <br><br>ActiveDirectory<br>WSUS<br>WSUSClientTargeting |
| GroupSourceName |Имя источника, из которого получена группа.  Для Active Directory это имя домена. |
| ManagementGroupName |Имя группы управления для агентов SCOM.  Для других агентов это AOI-\<идентификатор_рабочей_области\>. |
| TimeGenerated |Дата и время создания или изменения группы компьютеров. |

## <a name="next-steps"></a>Дополнительная информация
* Узнайте больше об [операциях поиска по журналу](log-analytics-log-searches.md) , которые можно применять для анализа данных, собираемых из источников данных и решений.  

