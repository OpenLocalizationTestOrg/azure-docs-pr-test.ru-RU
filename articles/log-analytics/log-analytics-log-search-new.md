---
title: "Поиск по журналам в OMS Log Analytics | Документация Майкрософт"
description: "Чтобы получить данные из Log Analytics, требуется поиск по журналам.  В этой статье описывается использование новых поисков по журналам в Log Analytics и приведены основные сведения, которые необходимо знать перед их созданием."
services: log-analytics
documentationcenter: 
author: bwren
manager: carmonm
editor: 
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: bwren
ms.openlocfilehash: 0f27db7018e398f71a8d7bd0b86e643367b15875
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="understanding-log-searches-in-log-analytics"></a><span data-ttu-id="a8e96-104">Основные сведения о поисках по журналам в Log Analytics</span><span class="sxs-lookup"><span data-stu-id="a8e96-104">Understanding log searches in Log Analytics</span></span>

> [!NOTE]
> <span data-ttu-id="a8e96-105">В этой статье описываются поиски по журналам в Azure Log Analytics с использованием нового языка запросов.</span><span class="sxs-lookup"><span data-stu-id="a8e96-105">This article describes log searches in Azure Log Analytics using the new query language.</span></span>  <span data-ttu-id="a8e96-106">Дополнительные сведения о новом языке и процедурах обновления рабочей области см. в [этой статье](log-analytics-log-search-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="a8e96-106">You can learn more about the new language and get the procedure to upgrade your workspace at [Upgrade your Azure Log Analytics workspace to new log search](log-analytics-log-search-upgrade.md).</span></span>  
>
> <span data-ttu-id="a8e96-107">Если вы еще не перевели рабочую область на новый язык запросов, используйте информацию из статьи [Поиск данных по журналам](log-analytics-log-searches.md).</span><span class="sxs-lookup"><span data-stu-id="a8e96-107">If your workspace hasn't been upgraded to the new query language, you should refer to [Find data using log searches in Log Analytics](log-analytics-log-searches.md).</span></span>

<span data-ttu-id="a8e96-108">Чтобы получить данные из Log Analytics, требуется поиск по журналам.</span><span class="sxs-lookup"><span data-stu-id="a8e96-108">You require a log search to retrieve any data from Log Analytics.</span></span>  <span data-ttu-id="a8e96-109">Независимо от того, анализируете ли вы данные на портале, настраиваете ли правило генерации оповещений для уведомления о конкретном состоянии или получаете ли данные с помощью API Log Analytics, вы будете использовать поиск по журналам, чтобы указать нужные данные.</span><span class="sxs-lookup"><span data-stu-id="a8e96-109">Whether you're analyzing data in the portal, configuring an alert rule to be notified of a particular condition, or retrieving data using the Log Analytics API, you will use a log search to specify the data you want.</span></span>  <span data-ttu-id="a8e96-110">В этой статье описывается использование поисков по журналам в Log Analytics и предоставляются основные сведения, которые необходимо знать перед их созданием.</span><span class="sxs-lookup"><span data-stu-id="a8e96-110">This article describes how log searches are used in Log Analytics and provides concepts that should understand before creating one.</span></span> <span data-ttu-id="a8e96-111">Дополнительные сведения о создании и редактировании поисков по журналам, а также материалы о языке запросов см. в разделе [Дальнейшие действия](#next-steps).</span><span class="sxs-lookup"><span data-stu-id="a8e96-111">See the [Next steps](#next-steps) section for details on creating and editing log searches and for references on the query language.</span></span>

## <a name="where-log-searches-are-used"></a><span data-ttu-id="a8e96-112">Где используются поиски по журналам</span><span class="sxs-lookup"><span data-stu-id="a8e96-112">Where log searches are used</span></span>

<span data-ttu-id="a8e96-113">Ниже приведены различные способы использования поисков по журналам в Log Analytics:</span><span class="sxs-lookup"><span data-stu-id="a8e96-113">The different ways that you will use log searches in Log Analytics include the following:</span></span>

- <span data-ttu-id="a8e96-114">**Порталы.**</span><span class="sxs-lookup"><span data-stu-id="a8e96-114">**Portals.**</span></span> <span data-ttu-id="a8e96-115">Вы можете выполнять интерактивный анализ данных в репозитории с помощью [портала поиска по журналам](log-analytics-log-search-log-search-portal.md) или [портала расширенной аналитики](https://go.microsoft.com/fwlink/?linkid=856587).</span><span class="sxs-lookup"><span data-stu-id="a8e96-115">You can perform interactive analysis of data in the repository with the [Log Search portal](log-analytics-log-search-log-search-portal.md) or the [Advanced Analytics portal](https://go.microsoft.com/fwlink/?linkid=856587).</span></span>  <span data-ttu-id="a8e96-116">Так вы можете изменить запрос и анализировать результаты в различных форматах и визуализациях.</span><span class="sxs-lookup"><span data-stu-id="a8e96-116">This allows you to edit your query and analyze the results in a variety of formats and visualizations.</span></span>  <span data-ttu-id="a8e96-117">Большинство создаваемых запросов сначала выполняются на одном из порталов. Убедившись, что они работают ожидаемым образом, вы можете копировать их в нужное расположение.</span><span class="sxs-lookup"><span data-stu-id="a8e96-117">Most queries that you create will start in one of the portals and then copied once you verify that it works as expected.</span></span>
- <span data-ttu-id="a8e96-118">**Правила генерации оповещений.**</span><span class="sxs-lookup"><span data-stu-id="a8e96-118">**Alert rules.**</span></span> <span data-ttu-id="a8e96-119">[Правила генерации оповещений](log-analytics-alerts.md) заранее выявляют проблемы с данными в рабочей области.</span><span class="sxs-lookup"><span data-stu-id="a8e96-119">[Alert rules](log-analytics-alerts.md) proactively identify issues from data in your workspace.</span></span>  <span data-ttu-id="a8e96-120">Каждое правило генерации оповещений основано на поиске по журналам, который автоматически выполняется через определенные интервалы.</span><span class="sxs-lookup"><span data-stu-id="a8e96-120">Each alert rule is based on a log search that is automatically run at regular intervals.</span></span>  <span data-ttu-id="a8e96-121">Результаты проверяются, чтобы определить, следует ли создавать оповещение.</span><span class="sxs-lookup"><span data-stu-id="a8e96-121">The results are inspected to determine if an alert should be created.</span></span>
- <span data-ttu-id="a8e96-122">**Представления.**</span><span class="sxs-lookup"><span data-stu-id="a8e96-122">**Views.**</span></span>  <span data-ttu-id="a8e96-123">Вы можете создавать визуализации данных, которые добавлены на панели мониторинга пользователя, с помощью [конструктора представлений](log-analytics-view-designer.md).</span><span class="sxs-lookup"><span data-stu-id="a8e96-123">You can create visualizations of data to be included in user dashboards with [View Designer](log-analytics-view-designer.md).</span></span>  <span data-ttu-id="a8e96-124">Поиски по журналам предоставляют данные, используемые [плитками](log-analytics-view-designer-tiles.md) и [элементами визуализации](log-analytics-view-designer-parts.md), в каждом представлении.</span><span class="sxs-lookup"><span data-stu-id="a8e96-124">Log searches provide the data used by [tiles](log-analytics-view-designer-tiles.md) and [visualization parts](log-analytics-view-designer-parts.md) in each view.</span></span>  <span data-ttu-id="a8e96-125">Для дальнейшего анализа данных можно выполнить детализацию из элементов визуализации на портал поиска по журналам.</span><span class="sxs-lookup"><span data-stu-id="a8e96-125">You can drill down from visualization parts into the Log Search portal to perform further analysis on the data.</span></span>
- <span data-ttu-id="a8e96-126">**Экспорт.**</span><span class="sxs-lookup"><span data-stu-id="a8e96-126">**Export.**</span></span>  <span data-ttu-id="a8e96-127">Когда вы экспортируете данные из рабочей области Log Analytics в Excel или [Power BI](log-analytics-powerbi.md), вы создаете поиск по журналам для определения экспортируемых данных.</span><span class="sxs-lookup"><span data-stu-id="a8e96-127">When you export data from the Log Analytics workspace to Excel or [Power BI](log-analytics-powerbi.md), you create a log search to define the data to export.</span></span>
- <span data-ttu-id="a8e96-128">**PowerShell.**</span><span class="sxs-lookup"><span data-stu-id="a8e96-128">**PowerShell.**</span></span> <span data-ttu-id="a8e96-129">Вы можете запустить скрипт PowerShell из командной строки или модуль Runbook службы автоматизации Azure, использующий командлет [Get-AzureRmOperationalInsightsSearchResults](https://docs.microsoft.com/powershell/module/azurerm.operationalinsights/get-azurermoperationalinsightssearchresults?view=azurermps-4.0.0), для получения данных из Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="a8e96-129">You can run a PowerShell script from a command line or an Azure Automation runbook that uses [Get-AzureRmOperationalInsightsSearchResults](https://docs.microsoft.com/powershell/module/azurerm.operationalinsights/get-azurermoperationalinsightssearchresults?view=azurermps-4.0.0) to retrieve data from Log Analytics.</span></span>  <span data-ttu-id="a8e96-130">Для этого командлета требуется запрос, чтобы определить извлекаемые данные.</span><span class="sxs-lookup"><span data-stu-id="a8e96-130">This cmdlet requires a query to determine the data to retrieve.</span></span>
- <span data-ttu-id="a8e96-131">**API Log Analytics.**</span><span class="sxs-lookup"><span data-stu-id="a8e96-131">**Log Analytics API.**</span></span>  <span data-ttu-id="a8e96-132">[API поиска по журналам службы Log Analytics](log-analytics-log-search-api.md) позволяет любому клиенту REST API извлекать данные из рабочей области.</span><span class="sxs-lookup"><span data-stu-id="a8e96-132">The [Log Analytics log search API](log-analytics-log-search-api.md) allows any REST API client to retrieve data from the workspace.</span></span>  <span data-ttu-id="a8e96-133">Запрос API включает запрос, который выполняется в Log Analytics, чтобы определить извлекаемые данные.</span><span class="sxs-lookup"><span data-stu-id="a8e96-133">The API request includes a query that is run against Log Analytics to determine the data to retrieve.</span></span>

![Поиск по журналам](media/log-analytics-log-search-new/log-search-overview.png)

## <a name="how-log-analytics-data-is-organized"></a><span data-ttu-id="a8e96-135">Упорядочивание данных в Log Analytics</span><span class="sxs-lookup"><span data-stu-id="a8e96-135">How Log Analytics data is organized</span></span>
<span data-ttu-id="a8e96-136">При создании запроса сначала нужно определить, какие таблицы содержат нужные данные.</span><span class="sxs-lookup"><span data-stu-id="a8e96-136">When you build a query, you start by determining which tables have the data that you're looking for.</span></span> <span data-ttu-id="a8e96-137">Каждый [источник данных](log-analytics-data-sources.md) и [решение](../operations-management-suite/operations-management-suite-solutions.md) хранит данные в выделенных таблицах в рабочей области Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="a8e96-137">Each [data source](log-analytics-data-sources.md) and [solution](../operations-management-suite/operations-management-suite-solutions.md) stores its data in dedicated tables in the Log Analytics workspace.</span></span>  <span data-ttu-id="a8e96-138">Документация для каждого источника данных и решения включает имя создаваемого типа данных и описание каждого из его свойств.</span><span class="sxs-lookup"><span data-stu-id="a8e96-138">Documentation for each data source and solution includes the name of the data type that it creates and a description of each of its properties.</span></span>     <span data-ttu-id="a8e96-139">Многие запросы потребуют только данные из одной таблицы, но другие могут использовать множество параметров для включения данных из нескольких таблиц.</span><span class="sxs-lookup"><span data-stu-id="a8e96-139">Many queries will only require data from a single tables, but others may use a variety of options to include data from multiple tables.</span></span>

![Таблицы](media/log-analytics-log-search-new/queries-tables.png)


## <a name="writing-a-query"></a><span data-ttu-id="a8e96-141">Написание запроса</span><span class="sxs-lookup"><span data-stu-id="a8e96-141">Writing a query</span></span>
<span data-ttu-id="a8e96-142">Основой поисков по журналам в Log Analytics является [обширный язык запросов](https://docs.loganalytics.io/), позволяющий извлекать и анализировать данные из репозитория различными способами.</span><span class="sxs-lookup"><span data-stu-id="a8e96-142">At the core of log searches in Log Analytics is [an extensive query language](https://docs.loganalytics.io/) that lets you retrieve and analyze data from the repository in a variety of ways.</span></span>  <span data-ttu-id="a8e96-143">Этот же язык запросов используется для [Application Insights](../application-insights/app-insights-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="a8e96-143">This same query language is used for [Application Insights](../application-insights/app-insights-analytics.md).</span></span>  <span data-ttu-id="a8e96-144">Сведения о написании запроса крайне важны для создания поисков по журналам в Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="a8e96-144">Learning how to write a query is critical to creating log searches in Log Analytics.</span></span>  <span data-ttu-id="a8e96-145">Обычно начинают с основных запросов, а затем переходят к использованию более усовершенствованных функций, так как требования становятся более сложными.</span><span class="sxs-lookup"><span data-stu-id="a8e96-145">You'll typically start with basic queries and then progress to use more advanced functions as your requirements become more complex.</span></span>

<span data-ttu-id="a8e96-146">Базовая структура запроса — это исходная таблица и ряд операторов, разделенных символом вертикальной черты `|`.</span><span class="sxs-lookup"><span data-stu-id="a8e96-146">The basic structure of a query is a source table followed by a series of operators separated by a pipe character `|`.</span></span>  <span data-ttu-id="a8e96-147">Вы можете объединить в цепочку несколько операторов для уточнения данных и выполнения расширенных функций.</span><span class="sxs-lookup"><span data-stu-id="a8e96-147">You can chain together multiple operators to refine the data and perform advanced functions.</span></span>

<span data-ttu-id="a8e96-148">Например, предположим, необходимо найти первые десять компьютеров с наибольшим количеством событий ошибок за последний день.</span><span class="sxs-lookup"><span data-stu-id="a8e96-148">For example, suppose you wanted to find the top ten computers with the most error events over the past day.</span></span>

    Event
    | where (EventLevelName == "Error")
    | where (TimeGenerated > ago(1days))
    | summarize ErrorCount = count() by Computer
    | top 10 by ErrorCount desc

<span data-ttu-id="a8e96-149">Или нужно найти компьютеры, которые не были активными в течение последнего дня.</span><span class="sxs-lookup"><span data-stu-id="a8e96-149">Or maybe you want to find computers that haven't had a heartbeat in the last day.</span></span>

    Heartbeat
    | where TimeGenerated > ago(7d)
    | summarize max(TimeGenerated) by Computer
    | where max_TimeGenerated < ago(1d)  

<span data-ttu-id="a8e96-150">Как насчет графика, отражающего использование процессора на каждом компьютере за прошлую неделю?</span><span class="sxs-lookup"><span data-stu-id="a8e96-150">How about a line chart with the processor utilization for each computer from last week?</span></span>

    Perf
    | where ObjectName == "Processor" and CounterName == "% Processor Time"
    | where TimeGenerated  between (startofweek(ago(7d)) .. endofweek(ago(7d)) )
    | summarize avg(CounterValue) by Computer, bin(TimeGenerated, 5min)
    | render timechart    

<span data-ttu-id="a8e96-151">Из этих примеров можно увидеть, что независимо от типа данных, с которыми вы работаете, структура запроса является аналогичной.</span><span class="sxs-lookup"><span data-stu-id="a8e96-151">You can see from these quick samples that regardless of the kind of data that you're working with, the structure of the query is similar.</span></span>  <span data-ttu-id="a8e96-152">Ее можно разбить на отдельные действия, где полученные данные из одной команды отправляются через конвейер в следующую команду.</span><span class="sxs-lookup"><span data-stu-id="a8e96-152">You can break it down into distinct steps where the resulting data from one command is sent through the pipeline to the next command.</span></span>

<span data-ttu-id="a8e96-153">Полную документацию по языку запросов Azure Log Analytics, включающую руководства и справочник по языку, см. [здесь](https://docs.loganalytics.io/).</span><span class="sxs-lookup"><span data-stu-id="a8e96-153">For complete documentation on the Azure Log Analytics query language including tutorials and language reference, see the [Azure Log Analytics query language documentation](https://docs.loganalytics.io/).</span></span>

## <a name="next-steps"></a><span data-ttu-id="a8e96-154">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a8e96-154">Next steps</span></span>

- <span data-ttu-id="a8e96-155">Узнайте о [порталах, которые можно использовать для создания и изменения поисков по журналам](log-analytics-log-search-portals.md).</span><span class="sxs-lookup"><span data-stu-id="a8e96-155">Learn about the [portals that you use to create and edit log searches](log-analytics-log-search-portals.md).</span></span>
- <span data-ttu-id="a8e96-156">Изучите [руководство по написанию запросов](https://go.microsoft.com/fwlink/?linkid=856078) на новом языке.</span><span class="sxs-lookup"><span data-stu-id="a8e96-156">Check out a [tutorial on writing queries](https://go.microsoft.com/fwlink/?linkid=856078) using the new query language.</span></span>
