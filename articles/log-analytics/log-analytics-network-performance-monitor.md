---
title: "Монитор производительности сети в Azure Log Analytics | Документация Майкрософт"
description: "Монитор производительности сети в Azure Log Analytics позволяет отслеживать производительность ваших сетей практически в реальном времени для обнаружения проблем производительности."
services: log-analytics
documentationcenter: 
author: bandersmsft
manager: carmonm
editor: 
ms.assetid: 5b9c9c83-3435-488c-b4f6-7653003ae18a
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: banders
ms.openlocfilehash: c6568e491429f6046ab164ab5eacd0ae5846e201
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="network-performance-monitor-solution-in-log-analytics"></a><span data-ttu-id="ae362-103">Решение монитора производительности сети в Azure Log Analytics</span><span class="sxs-lookup"><span data-stu-id="ae362-103">Network Performance Monitor solution in Log Analytics</span></span>

![Символ монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-symbol.png)

<span data-ttu-id="ae362-105">В этом документе объясняется, как настроить и использовать в Azure Log Analytics монитор производительности сети, который позволяет отслеживать производительность ваших сетей практически в реальном времени для обнаружения проблем производительности.</span><span class="sxs-lookup"><span data-stu-id="ae362-105">This document describes how to set-up and use the Network Performance Monitor solution in Log Analytics, which helps you monitor the performance of your networks-in near real-time-to detect and locate network performance bottlenecks.</span></span> <span data-ttu-id="ae362-106">С помощью этого решения можно отслеживать потери и задержки между двумя сетями, подсетями или серверами.</span><span class="sxs-lookup"><span data-stu-id="ae362-106">With the Network Performance Monitor solution, you can monitor the loss and latency between two networks, subnets or servers.</span></span> <span data-ttu-id="ae362-107">Монитор производительности сети обнаруживает проблемы сети, такие как появление "черных дыр" в трафике, ошибки маршрутизации и проблемы, которые невозможно обнаружить с помощью традиционных методов мониторинга сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-107">Network Performance Monitor detects network issues like traffic blackholing, routing errors, and issues that conventional network monitoring methods are not able to detect.</span></span> <span data-ttu-id="ae362-108">Он создает предупреждения и уведомляет о превышении порогового значения для сетевого соединения.</span><span class="sxs-lookup"><span data-stu-id="ae362-108">Network Performance Monitor generates alerts and notifies as and when a threshold is breached for a network link.</span></span> <span data-ttu-id="ae362-109">Система может определить эти пороговые значения автоматически. Кроме того, для них можно настроить использование настраиваемых правил предупреждений.</span><span class="sxs-lookup"><span data-stu-id="ae362-109">These thresholds can be learned automatically by the system or you can configure them to use custom alert rules.</span></span> <span data-ttu-id="ae362-110">Монитор производительности сети обеспечивает своевременное обнаружение проблем с производительностью сети и определяет конкретный сегмент сети или сетевое устройство как источник проблемы.</span><span class="sxs-lookup"><span data-stu-id="ae362-110">Network Performance Monitor ensures timely detection of network performance issues and localizes the source of the problem to a particular network segment or device.</span></span>

<span data-ttu-id="ae362-111">Проблемы с сетью можно обнаружить с помощью панели мониторинга решения. На ней отображаются сведения о сети, включая последние события работоспособности сети, неработоспособные сетевые соединения и соединения подсетей, в которых возник высокий уровень потери пакетов и задержки.</span><span class="sxs-lookup"><span data-stu-id="ae362-111">You can detect network issues with the solution dashboard which displays summarized information about your network including recent network health events, unhealthy network links, and subnetwork links that are facing high packet loss and latency.</span></span> <span data-ttu-id="ae362-112">Вы можете перейти к сведениям о сетевом соединении, чтобы просмотреть текущее состояние работоспособности соединений подсети, а также соединений между узлами.</span><span class="sxs-lookup"><span data-stu-id="ae362-112">You can drill-down into a network link to view the current health status of subnetwork links as well as node-to-node links.</span></span> <span data-ttu-id="ae362-113">Кроме того, можно просмотреть историческую тенденцию потери и задержки на уровне сети, подсети и между узлами.</span><span class="sxs-lookup"><span data-stu-id="ae362-113">You can also view the historical trend of loss and latency at the network, subnetwork, and node-to-node level.</span></span> <span data-ttu-id="ae362-114">Вы можете определить временные неполадки сети, просматривая диаграммы исторических трендов, где видны потери пакетов и задержки, а также найти узкие места сети на карте топологии.</span><span class="sxs-lookup"><span data-stu-id="ae362-114">You can detect transient network issues by viewing historical trend charts for packet loss and latency and locate network bottlenecks on a topology map.</span></span> <span data-ttu-id="ae362-115">Интерактивная диаграмма топологии позволяет визуализировать сетевые маршруты по прыжкам и определить источник проблемы.</span><span class="sxs-lookup"><span data-stu-id="ae362-115">The interactive topology graph allows you to visualize the hop-by-hop network routes and determine the source of the problem.</span></span> <span data-ttu-id="ae362-116">Помимо других решений, можно использовать поиск по журналу с учетом различных требований к аналитике, чтобы создавать настраиваемые отчеты на основе данных, собираемых с помощью монитора производительности сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-116">Like any other solutions, you can use Log Search for various analytics requirements to create custom reports based on the data collected by Network Performance Monitor.</span></span>

<span data-ttu-id="ae362-117">В качестве основного механизма для обнаружения ошибок сети в решении используются искусственные транзакции.</span><span class="sxs-lookup"><span data-stu-id="ae362-117">The solution uses synthetic transactions as a primary mechanism to detect network faults.</span></span> <span data-ttu-id="ae362-118">Таким образом, его можно использовать вне зависимости от поставщика или модели определенного сетевого устройства.</span><span class="sxs-lookup"><span data-stu-id="ae362-118">So, you can use it without regard for a specific network device's vendor or model.</span></span> <span data-ttu-id="ae362-119">Он работает в локальных, облачных (IaaS) и гибридных средах.</span><span class="sxs-lookup"><span data-stu-id="ae362-119">It works across on-premises, cloud (IaaS), and hybrid environments.</span></span> <span data-ttu-id="ae362-120">Это решение автоматически обнаруживает топологию сети и различные сетевые маршруты.</span><span class="sxs-lookup"><span data-stu-id="ae362-120">The solution automatically discovers the network topology and various routes in your network.</span></span>

<span data-ttu-id="ae362-121">Монитор производительности сети предоставляет ценную информацию о реальном качестве сетевого подключения между двумя точками в отличие от типичных продуктов сетевого мониторинга, которые ориентированы только на мониторинг работоспособности сетевого устройства (маршрутизаторов, коммутаторов и т. д.).</span><span class="sxs-lookup"><span data-stu-id="ae362-121">Typical network monitoring products focus on monitoring the network device (routers, switches etc.) health but do not provide insights into the actual quality of network connectivity between two points, which Network Performance Monitor does.</span></span>

### <a name="using-the-solution-standalone"></a><span data-ttu-id="ae362-122">Использование только решения</span><span class="sxs-lookup"><span data-stu-id="ae362-122">Using the solution standalone</span></span>
<span data-ttu-id="ae362-123">Если требуется отслеживать качество сетевых подключений между критически важными рабочими нагрузками, сетями, центрами обработки данных или расположениями организации, вы можете использовать само решение монитора производительности сети для мониторинга работоспособности подключений между:</span><span class="sxs-lookup"><span data-stu-id="ae362-123">If you want to monitor the quality of network connections between their critical workloads, networks, datacenters or office sites, then you can use the Network Performance Monitor solution by itself to monitor connectivity health between:</span></span>

* <span data-ttu-id="ae362-124">несколькими центрами обработки данных или расположениями организации, которые соединены с помощью частной или общедоступной сети;</span><span class="sxs-lookup"><span data-stu-id="ae362-124">multiple datacenters or office sites that are connected using a public or private network</span></span>
* <span data-ttu-id="ae362-125">критически важными рабочими нагрузками, выполняющими бизнес-приложения;</span><span class="sxs-lookup"><span data-stu-id="ae362-125">critical workloads that are running line of business applications</span></span>
* <span data-ttu-id="ae362-126">общедоступными облачными службами, например Microsoft Azure или Amazon Web Services (AWS), и локальными сетями, если у вас есть доступная IaaS (виртуальная машина) и шлюзы настроены для обеспечения связи между локальными и облачными сетями;</span><span class="sxs-lookup"><span data-stu-id="ae362-126">public cloud services like Microsoft Azure or Amazon Web Services (AWS) and on-premises networks, if you have IaaS (VM) available and you have gateways configured to allow communication between on-premises networks and cloud networks</span></span>
* <span data-ttu-id="ae362-127">сетями Azure и локальными сетями при использовании Express Route.</span><span class="sxs-lookup"><span data-stu-id="ae362-127">Azure and on-premises networks when you use Express Route</span></span>

### <a name="using-the-solution-with-other-networking-tools"></a><span data-ttu-id="ae362-128">Использование решения с другими сетевыми средствами</span><span class="sxs-lookup"><span data-stu-id="ae362-128">Using the solution with other networking tools</span></span>
<span data-ttu-id="ae362-129">Если вам необходимо отслеживать бизнес-приложение, вы можете использовать монитор производительности сети совместно с другими сетевыми средствами.</span><span class="sxs-lookup"><span data-stu-id="ae362-129">If you want to monitor a line of business application, you can use the Network Performance Monitor solution as a companion solution to other network tools.</span></span> <span data-ttu-id="ae362-130">Низкая скорость сети может замедлить работу приложений. В этом случае монитор производительности сети поможет обнаружить проблемы с производительностью приложений, вызванные базовыми сетевыми проблемами.</span><span class="sxs-lookup"><span data-stu-id="ae362-130">A slow network can lead to slow applications and Network Performance Monitor can help you investigate application performance issues that are caused by underlying networking issues.</span></span> <span data-ttu-id="ae362-131">Так как для решения не требуется доступ к сетевым устройствам, администратору приложения не нужно полагаться на команду специалистов по сетям для предоставления сведений о влиянии сети на приложения.</span><span class="sxs-lookup"><span data-stu-id="ae362-131">Because the solution does not require any access to network devices, the application administrator doesn't need to rely on a networking team to provide information about how the network is affecting applications.</span></span>

<span data-ttu-id="ae362-132">Кроме того, если вы уже вложили средства в другие средства мониторинга сети, это решение может дополнить их, так как большинство традиционных решений для мониторинга сети не предоставляют подробные сведения о комплексных показателях производительности сети, например о потере и задержке.</span><span class="sxs-lookup"><span data-stu-id="ae362-132">Also, if you already invest in other network monitoring tools, then the solution can complement those tools because most traditional network monitoring solutions do not provide insights into end-to-end network performance metrics like loss and latency.</span></span>  <span data-ttu-id="ae362-133">Монитор производительности сети поможет заполнить этот пробел.</span><span class="sxs-lookup"><span data-stu-id="ae362-133">The Network Performance Monitor solution can help fill that gap.</span></span>

## <a name="installing-and-configuring-agents-for-the-solution"></a><span data-ttu-id="ae362-134">Установка и настройка агентов для решения</span><span class="sxs-lookup"><span data-stu-id="ae362-134">Installing and configuring agents for the solution</span></span>
<span data-ttu-id="ae362-135">Базовая процедура установки агентов приведена в статьях [Подключение компьютеров Windows к Log Analytics](log-analytics-windows-agents.md) и [Подключение Operations Manager к Log Analytics](log-analytics-om-agents.md).</span><span class="sxs-lookup"><span data-stu-id="ae362-135">Use the basic processes to install agents at [Connect Windows computers to Log Analytics](log-analytics-windows-agents.md) and [Connect Operations Manager to Log Analytics](log-analytics-om-agents.md).</span></span>

> [!NOTE]
> <span data-ttu-id="ae362-136">Необходимо установить по крайней мере два агента, которые будут собирать достаточно данных для обнаружения сетевых ресурсов и наблюдения за ними.</span><span class="sxs-lookup"><span data-stu-id="ae362-136">You'll need to install at least 2 agents in order to have enough data to discover and monitor your network resources.</span></span> <span data-ttu-id="ae362-137">В противном случае решение будет оставаться в состоянии настройки, пока не будут установлены и настроены дополнительные агенты.</span><span class="sxs-lookup"><span data-stu-id="ae362-137">Otherwise, the solution will remain in a configuring state until you install and configure additional agents.</span></span>
>
>

### <a name="where-to-install-the-agents"></a><span data-ttu-id="ae362-138">Место для установки агентов</span><span class="sxs-lookup"><span data-stu-id="ae362-138">Where to install the agents</span></span>
<span data-ttu-id="ae362-139">Перед установкой агентов выберите топологию сети и части сети, которые требуется отслеживать.</span><span class="sxs-lookup"><span data-stu-id="ae362-139">Before you install agents, consider the topology of your network and what parts of the network you want to monitor.</span></span> <span data-ttu-id="ae362-140">Мы советуем установить несколько агентов для каждой подсети, которую требуется отслеживать.</span><span class="sxs-lookup"><span data-stu-id="ae362-140">We recommend that you install more than one agent for each subnet that you want to monitor.</span></span> <span data-ttu-id="ae362-141">Иными словами, для каждой такой подсети выберите два или больше серверов или виртуальных машин и установите на них агент.</span><span class="sxs-lookup"><span data-stu-id="ae362-141">In other words, for every subnet that you want to monitor, choose two or more servers or VMs and install the agent on them.</span></span>

<span data-ttu-id="ae362-142">Если вы не знаете топологию сети, установите агенты на серверах с критически важными рабочими нагрузками, где требуется отслеживать производительность сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-142">If you are unsure about the topology of your network, install the agents on servers with critical workloads where you want to monitor the network performance.</span></span> <span data-ttu-id="ae362-143">Например, вам может понадобиться отслеживать сетевое подключение между веб-сервером и сервером под управлением SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ae362-143">For example, you might want to keep track of a network connection between a Web server and a server running SQL Server.</span></span> <span data-ttu-id="ae362-144">В этом случае агент необходимо установить на обоих серверах.</span><span class="sxs-lookup"><span data-stu-id="ae362-144">In this example, you'd install an agent on both servers.</span></span>

<span data-ttu-id="ae362-145">Агенты отслеживают сетевое подключение (соединения) между узлами, а не сами узлы.</span><span class="sxs-lookup"><span data-stu-id="ae362-145">Agents monitor network connectivity (links) between hosts -- not the hosts themselves.</span></span> <span data-ttu-id="ae362-146">Таким образом, для отслеживания сетевого соединения агенты нужно установить на обеих конечных точках соединения.</span><span class="sxs-lookup"><span data-stu-id="ae362-146">So, to monitor a network link, you must install agents on both endpoints of that link.</span></span>

### <a name="configure-agents"></a><span data-ttu-id="ae362-147">Настройка агентов</span><span class="sxs-lookup"><span data-stu-id="ae362-147">Configure agents</span></span>

<span data-ttu-id="ae362-148">Если вы планируете использовать протокол ICMP для синтетических транзакций, включите следующие правила брандмауэра для надежного использования ICMP:</span><span class="sxs-lookup"><span data-stu-id="ae362-148">If you intend to use the ICMP protocol for synthetic transactions, you need to enable the following firewall rules for reliably utilizing ICMP:</span></span>

```
netsh advfirewall firewall add rule name="NPMDICMPV4Echo" protocol="icmpv4:8,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6Echo" protocol="icmpv6:128,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV4DestinationUnreachable" protocol="icmpv4:3,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6DestinationUnreachable" protocol="icmpv6:1,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV4TimeExceeded" protocol="icmpv4:11,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6TimeExceeded" protocol="icmpv6:3,any" dir=in action=allow
```


<span data-ttu-id="ae362-149">Если вы собираетесь использовать протокол TCP, необходимо открыть порты брандмауэра этих компьютеров, чтобы агенты могли обмениваться данными.</span><span class="sxs-lookup"><span data-stu-id="ae362-149">If you intend to use the TCP protocol you need to open firewall ports for those computers to ensure that agents can communicate.</span></span> <span data-ttu-id="ae362-150">Вам нужно скачать, а затем запустить [скрипт PowerShell EnableRules.ps1](https://gallery.technet.microsoft.com/OMS-Network-Performance-04a66634), не задавая каких-либо параметров, в окне PowerShell с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="ae362-150">You need to download and then run the [EnableRules.ps1 PowerShell script](https://gallery.technet.microsoft.com/OMS-Network-Performance-04a66634) without any parameters in a PowerShell window with administrative privileges.</span></span>

<span data-ttu-id="ae362-151">Этот скрипт создает разделы реестра, необходимые для монитора производительности сети, а также правила брандмауэра Windows, чтобы разрешить агентам создавать TCP-подключения друг к другу.</span><span class="sxs-lookup"><span data-stu-id="ae362-151">The script creates registry keys required by the Network Performance Monitor and it creates Windows firewall rules to allow agents to create TCP connections with each other.</span></span> <span data-ttu-id="ae362-152">В разделах реестра, созданных скриптом, также нужно указать, следует ли записывать журналы отладки и путь к файлу журнала.</span><span class="sxs-lookup"><span data-stu-id="ae362-152">The registry keys created by the script also specify whether to log the debug logs and the path for the logs file.</span></span> <span data-ttu-id="ae362-153">Он также определяет TCP-порт агента, используемый для обмена данными.</span><span class="sxs-lookup"><span data-stu-id="ae362-153">It also defines the agent TCP port used for communication.</span></span> <span data-ttu-id="ae362-154">Значения этих реестров автоматически устанавливаются с помощью скрипта, поэтому вам не нужно изменять их вручную.</span><span class="sxs-lookup"><span data-stu-id="ae362-154">The values for these keys are automatically set by the script, so you should not manually change these keys.</span></span>

<span data-ttu-id="ae362-155">Открытый порт по умолчанию — 8084.</span><span class="sxs-lookup"><span data-stu-id="ae362-155">The port opened by default is 8084.</span></span> <span data-ttu-id="ae362-156">Вы можете использовать пользовательский порт, задав в скрипте параметр `portNumber`.</span><span class="sxs-lookup"><span data-stu-id="ae362-156">You can use a custom port by providing the parameter `portNumber` to the script.</span></span> <span data-ttu-id="ae362-157">На всех компьютерах, где выполняется скрипт, нужно использовать один и тот же порт.</span><span class="sxs-lookup"><span data-stu-id="ae362-157">However, the same port should be used on all the computers where the script is run.</span></span>

> [!NOTE]
> <span data-ttu-id="ae362-158">Скрипт EnableRules.ps1 настраивает правила брандмауэра Windows только на том компьютере, где он выполняется.</span><span class="sxs-lookup"><span data-stu-id="ae362-158">The EnableRules.ps1 script configures Windows firewall rules only on the computer where the script is run.</span></span> <span data-ttu-id="ae362-159">При наличии брандмауэра сети он должен разрешать пропуск трафика к TCP-порту, который используется монитором производительности сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-159">If you have a network firewall, you should make sure that it allows traffic destined for the TCP port being used by Network Performance Monitor.</span></span>
>
>

## <a name="configuring-the-solution"></a><span data-ttu-id="ae362-160">Настройка решения</span><span class="sxs-lookup"><span data-stu-id="ae362-160">Configuring the solution</span></span>
<span data-ttu-id="ae362-161">Для установки и настройки решений используйте указанные ниже данные.</span><span class="sxs-lookup"><span data-stu-id="ae362-161">Use the following information to install and configure the solution.</span></span>

1. <span data-ttu-id="ae362-162">Монитор производительности сети получает данные из компьютеров под управлением Windows Server 2008 с пакетом обновления 1 либо более поздней версии или Windows 7 с пакетом обновления 1 либо более поздней версии. Эти требования применяются и к Microsoft Monitoring Agent.</span><span class="sxs-lookup"><span data-stu-id="ae362-162">The Network Performance Monitor solution acquires data from computers running Windows Server 2008 SP 1 or later or Windows 7 SP1 or later, which are the same requirements as the Microsoft Monitoring Agent (MMA).</span></span> <span data-ttu-id="ae362-163">Агенты NPM могут работать в классических и клиентских операционных системах (Windows 10, Windows 8.1, Windows 8 и Windows 7).</span><span class="sxs-lookup"><span data-stu-id="ae362-163">NPM agents can also run on Windows desktop/client operating systems (Windows 10, Windows 8.1, Windows 8 and Windows 7).</span></span>
    >[!NOTE]
    ><span data-ttu-id="ae362-164">Агенты для серверных операционных систем Windows поддерживают TCP и ICMP в качестве протоколов для синтетических транзакций.</span><span class="sxs-lookup"><span data-stu-id="ae362-164">The agents for Windows server operating systems support both TCP and ICMP as the protocols for synthetic transaction.</span></span> <span data-ttu-id="ae362-165">Но агенты для клиентских операционных систем Windows поддерживают в качестве протокола для синтетических транзакций только ICMP.</span><span class="sxs-lookup"><span data-stu-id="ae362-165">However, the agents for Windows client operating systems only support ICMP as the protocol for synthetic transaction.</span></span>

2. <span data-ttu-id="ae362-166">Добавьте решение "Монитор производительности сети" из [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.NetworkMonitoringOMS?tab=Overview) в рабочую область, как описано в статье [Добавление решений для управления Azure Log Analytics в рабочую область](log-analytics-add-solutions.md).</span><span class="sxs-lookup"><span data-stu-id="ae362-166">Add the Network Performance Monitor solution to your workspace from [Azure marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.NetworkMonitoringOMS?tab=Overview) or by using the process described in [Add Log Analytics solutions from the Solutions Gallery](log-analytics-add-solutions.md).</span></span>  
   <span data-ttu-id="ae362-167">![Символ монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-symbol.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-167">![Network Performance Monitor symbol](./media/log-analytics-network-performance-monitor/npm-symbol.png)</span></span>
3. <span data-ttu-id="ae362-168">На портале OMS отобразится новая плитка под названием **Монитор производительности сети** с сообщением *Для решения требуется дополнительная настройка*.</span><span class="sxs-lookup"><span data-stu-id="ae362-168">In the OMS portal, you'll see a new tile titled **Network Performance Monitor** with the message *Solution requires additional configuration*.</span></span> <span data-ttu-id="ae362-169">Вам понадобится настроить решение для добавления сетей на основе подсетей и узлов, обнаруженных агентами.</span><span class="sxs-lookup"><span data-stu-id="ae362-169">You'll need to configure the solution to add networks based on subnetworks and nodes that are discovered by agents.</span></span> <span data-ttu-id="ae362-170">Щелкните **Монитор производительности сети**, чтобы приступить к настройке сети по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ae362-170">Click **Network Performance Monitor** to start configuring the default network.</span></span>  
   <span data-ttu-id="ae362-171">![Для решения требуется дополнительная настройка](./media/log-analytics-network-performance-monitor/npm-config.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-171">![solution requires additional configuration](./media/log-analytics-network-performance-monitor/npm-config.png)</span></span>

### <a name="configure-the-solution-with-a-default-network"></a><span data-ttu-id="ae362-172">Настройка решения с использованием сети по умолчанию</span><span class="sxs-lookup"><span data-stu-id="ae362-172">Configure the solution with a default network</span></span>
<span data-ttu-id="ae362-173">На странице конфигурации отобразится одна сеть с именем **По умолчанию**.</span><span class="sxs-lookup"><span data-stu-id="ae362-173">On the configuration page, you'll see a single network named **Default**.</span></span> <span data-ttu-id="ae362-174">Если вы еще не определили сеть, все автоматически обнаруженные подсети размещаются в сети "По умолчанию".</span><span class="sxs-lookup"><span data-stu-id="ae362-174">When you haven't defined any networks, all the automatically-discovered subnets are placed in the Default network.</span></span>

<span data-ttu-id="ae362-175">При создании сети добавьте в нее подсеть, и эта подсеть удалится из сети "По умолчанию".</span><span class="sxs-lookup"><span data-stu-id="ae362-175">Whenever you create a network, you add a subnet to it and that subnet is removed from the Default network.</span></span> <span data-ttu-id="ae362-176">Если удалить сеть, все подсети автоматически возвратятся в сеть "По умолчанию".</span><span class="sxs-lookup"><span data-stu-id="ae362-176">If you delete a network, all its subnets are automatically returned to the Default network.</span></span>

<span data-ttu-id="ae362-177">Иными словами, сеть "По умолчанию" является контейнером для всех подсетей, которые не содержатся в какой-либо сети, определяемой пользователем.</span><span class="sxs-lookup"><span data-stu-id="ae362-177">In other words, the Default network is the container for all the subnets that are not contained in any user-defined network.</span></span> <span data-ttu-id="ae362-178">Сеть "По умолчанию" нельзя изменить или удалить.</span><span class="sxs-lookup"><span data-stu-id="ae362-178">You cannot edit or delete the Default network.</span></span> <span data-ttu-id="ae362-179">Она всегда остается в системе.</span><span class="sxs-lookup"><span data-stu-id="ae362-179">It always remains in the system.</span></span> <span data-ttu-id="ae362-180">Тем не менее вы можете создать любое количество сетей.</span><span class="sxs-lookup"><span data-stu-id="ae362-180">However, you can create as many networks as you need.</span></span>

<span data-ttu-id="ae362-181">В большинстве случаев подсети в вашей организации будут расположены в нескольких сетях. Вам следует создать одну или несколько сетей, чтобы логически сгруппировать подсети.</span><span class="sxs-lookup"><span data-stu-id="ae362-181">In most cases, the subnets in your organization will be arranged in more than one network and you should create one or more networks to logically group your subnets.</span></span>

### <a name="create-new-networks"></a><span data-ttu-id="ae362-182">Создание сетей</span><span class="sxs-lookup"><span data-stu-id="ae362-182">Create new networks</span></span>
<span data-ttu-id="ae362-183">Сеть в мониторе производительности сети — это контейнер для подсетей.</span><span class="sxs-lookup"><span data-stu-id="ae362-183">A network in Network Performance Monitor is a container for subnets.</span></span> <span data-ttu-id="ae362-184">Вы можете назвать ее любым именем и добавить в нее подсети.</span><span class="sxs-lookup"><span data-stu-id="ae362-184">You can create a network with any name that you want and add subnets to the network.</span></span> <span data-ttu-id="ae362-185">Например, можно создать сеть с именем *Здание 1*, а затем добавить в нее подсети, или сеть с именем *DMZ* и добавить в нее все общедоступные подсети, принадлежащие периметру сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-185">For example, you can create a network named *Building1* and then add subnets, or you can create a network named *DMZ* and then add all subnets belonging to demilitarized zone to this network.</span></span>

#### <a name="to-create-a-new-network"></a><span data-ttu-id="ae362-186">Создание сети</span><span class="sxs-lookup"><span data-stu-id="ae362-186">To create a new network</span></span>
1. <span data-ttu-id="ae362-187">Щелкните **Добавить сеть** и введите имя и описание сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-187">Click **Add network** and then type the network name and description.</span></span>
2. <span data-ttu-id="ae362-188">Выберите одну или несколько подсетей и щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="ae362-188">Select one or more subnets, and then click **Add**.</span></span>
3. <span data-ttu-id="ae362-189">Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="ae362-189">Click **Save** to save the configuration.</span></span>  
   <span data-ttu-id="ae362-190">![Добавление сети](./media/log-analytics-network-performance-monitor/npm-add-network.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-190">![add network](./media/log-analytics-network-performance-monitor/npm-add-network.png)</span></span>

### <a name="wait-for-data-aggregation"></a><span data-ttu-id="ae362-191">Ожидание агрегирования данных</span><span class="sxs-lookup"><span data-stu-id="ae362-191">Wait for data aggregation</span></span>
<span data-ttu-id="ae362-192">Как только вы сохраните конфигурацию в первый раз, решение начнет собирать информацию о потерях пакетов и задержках сети между узлами, на которых установлены агенты.</span><span class="sxs-lookup"><span data-stu-id="ae362-192">After you've saved the configuration for first time, the solution starts collecting network packet loss and latency information between the nodes where agents are installed.</span></span> <span data-ttu-id="ae362-193">Этот процесс может занять некоторое время, иногда больше 30 минут.</span><span class="sxs-lookup"><span data-stu-id="ae362-193">This process can take a while, sometimes over 30 minutes.</span></span> <span data-ttu-id="ae362-194">В этом состоянии на плитке монитора производительности сети на странице обзора будет отображаться сообщение с текстом *Выполняется агрегирование данных*.</span><span class="sxs-lookup"><span data-stu-id="ae362-194">During this state, the Network Performance Monitor tile in the overview page displays a message stating *Data aggregation in process*.</span></span>

![Выполняется агрегирование данных](./media/log-analytics-network-performance-monitor/npm-aggregation.png)

<span data-ttu-id="ae362-196">После передачи данных на плитке монитора производительности сети будут отображаться данные.</span><span class="sxs-lookup"><span data-stu-id="ae362-196">When the data has been uploaded, you'll see the Network Performance Monitor tile updated showing data.</span></span>

![Плитка монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-tile.png)

<span data-ttu-id="ae362-198">Щелкните плитку, чтобы просмотреть панель мониторинга монитора производительности сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-198">Click the tile to view the Network Performance Monitor dashboard.</span></span>

![Панель мониторинга монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-dash01.png)

### <a name="edit-monitoring-settings-for-subnets"></a><span data-ttu-id="ae362-200">Изменение параметров мониторинга для подсетей</span><span class="sxs-lookup"><span data-stu-id="ae362-200">Edit monitoring settings for subnets</span></span>
<span data-ttu-id="ae362-201">Все подсети, в которых установлен хотя бы один агент, приведены на вкладке **Подсети** на странице конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ae362-201">All subnets where at least one agent was installed are listed on the **Subnetworks** tab in the configuration page.</span></span>

#### <a name="to-enable-or-disable-monitoring-for-particular-subnetworks"></a><span data-ttu-id="ae362-202">Включение или отключение мониторинга для определенных подсетей</span><span class="sxs-lookup"><span data-stu-id="ae362-202">To enable or disable monitoring for particular subnetworks</span></span>
1. <span data-ttu-id="ae362-203">Установите или снимите флажок рядом с **идентификатором подсети** и установите или снимите флажок **Используйте для мониторинга** соответственно.</span><span class="sxs-lookup"><span data-stu-id="ae362-203">Select or clear the box next to the **subnetwork ID** and then ensure that **Use for Monitoring** is selected or cleared, as appropriate.</span></span> <span data-ttu-id="ae362-204">Вы можете установить или снять флажки для нескольких подсетей.</span><span class="sxs-lookup"><span data-stu-id="ae362-204">You can select or clear multiple subnets.</span></span> <span data-ttu-id="ae362-205">Если мониторинг подсетей отключен, они не отслеживаются, так как агенты останавливают проверку связи с другими агентами.</span><span class="sxs-lookup"><span data-stu-id="ae362-205">When disabled, subnetworks are not monitored as the agents will be updated to stop pinging other agents.</span></span>
2. <span data-ttu-id="ae362-206">Выберите узлы, которые требуется отслеживать для определенной подсети, выбрав подсеть из списка и переместив необходимые узлы между списками, содержащими неотслеживаемые и отслеживаемые узлы.</span><span class="sxs-lookup"><span data-stu-id="ae362-206">Choose the nodes that you want to monitor for a particular subnetwork by selecting the subnetwork from the list and moving the required nodes between the lists containing unmonitored and monitored nodes.</span></span>
   <span data-ttu-id="ae362-207">При желании в подсеть можно добавить пользовательское **описание**.</span><span class="sxs-lookup"><span data-stu-id="ae362-207">You can add a custom **description** to the subnetwork, if you like.</span></span>
3. <span data-ttu-id="ae362-208">Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="ae362-208">Click **Save** to save the configuration.</span></span>  
   <span data-ttu-id="ae362-209">![Изменение подсети](./media/log-analytics-network-performance-monitor/npm-edit-subnet.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-209">![edit subnet](./media/log-analytics-network-performance-monitor/npm-edit-subnet.png)</span></span>

### <a name="choose-nodes-to-monitor"></a><span data-ttu-id="ae362-210">Выбор узлов для отслеживания</span><span class="sxs-lookup"><span data-stu-id="ae362-210">Choose nodes to monitor</span></span>
<span data-ttu-id="ae362-211">Все узлы, на которых установлен агент, перечислены на вкладке **Узлы**.</span><span class="sxs-lookup"><span data-stu-id="ae362-211">All the nodes that have an agent installed on them are listed in the **Nodes** tab.</span></span>

#### <a name="to-enable-or-disable-monitoring-for-nodes"></a><span data-ttu-id="ae362-212">Включение или отключение мониторинга узлов</span><span class="sxs-lookup"><span data-stu-id="ae362-212">To enable or disable monitoring for nodes</span></span>
1. <span data-ttu-id="ae362-213">Установите флажки возле узлов, которые необходимо отслеживать, и снимите флажки возле тех узлов, мониторинг которых необходимо прекратить.</span><span class="sxs-lookup"><span data-stu-id="ae362-213">Select or clear the nodes that you want to monitor or stop monitoring.</span></span>
2. <span data-ttu-id="ae362-214">Установите или снимите флажок **Используйте для мониторинга** соответственно.</span><span class="sxs-lookup"><span data-stu-id="ae362-214">Click **Use for Monitoring**, or clear it, as appropriate.</span></span>
3. <span data-ttu-id="ae362-215">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="ae362-215">Click **Save**.</span></span>  
   <span data-ttu-id="ae362-216">![Включение мониторинга узла](./media/log-analytics-network-performance-monitor/npm-enable-node-monitor.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-216">![enable node monitoring](./media/log-analytics-network-performance-monitor/npm-enable-node-monitor.png)</span></span>

### <a name="set-monitoring-rules"></a><span data-ttu-id="ae362-217">Установка правил мониторинга</span><span class="sxs-lookup"><span data-stu-id="ae362-217">Set monitoring rules</span></span>
<span data-ttu-id="ae362-218">Монитор производительности сети создает события работоспособности о подключении между парой узлов либо соединениями подсети или сети при достижении порогового значения.</span><span class="sxs-lookup"><span data-stu-id="ae362-218">Network Performance Monitor generates health events about the connectivity between a pair of nodes or subnetwork or network links when a threshold is breached.</span></span> <span data-ttu-id="ae362-219">Система может определить эти пороговые значения автоматически. При желании можно настроить использование настраиваемых правил предупреждений.</span><span class="sxs-lookup"><span data-stu-id="ae362-219">These thresholds can be learned automatically by the system or you can configure them custom alert rules.</span></span>

<span data-ttu-id="ae362-220">Генерируемое системой *правило по умолчанию* создает событие работоспособности каждый раз, когда значения потери и задержки между любой парой сетевых соединений или соединений подсети превышают определенное системой пороговое значение.</span><span class="sxs-lookup"><span data-stu-id="ae362-220">The *Default rule* is created by the system and it creates a health event whenever loss or latency between any pair of networks or subnetwork links breaches the system-learned threshold.</span></span> <span data-ttu-id="ae362-221">Вы можете отключить правило по умолчанию и создать настраиваемые правила мониторинга.</span><span class="sxs-lookup"><span data-stu-id="ae362-221">You can choose to disable the default rule and create custom monitoring rules</span></span>

#### <a name="to-create-custom-monitoring-rules"></a><span data-ttu-id="ae362-222">Создание настраиваемых правил мониторинга</span><span class="sxs-lookup"><span data-stu-id="ae362-222">To create custom monitoring rules</span></span>
1. <span data-ttu-id="ae362-223">На вкладке **Монитор** щелкните **Добавить правило** и введите имя и описание правила.</span><span class="sxs-lookup"><span data-stu-id="ae362-223">Click **Add Rule** in the **Monitor** tab and enter the rule name and description.</span></span>
2. <span data-ttu-id="ae362-224">Выберите из списков пару сетевых соединений или соединений подсети для мониторинга.</span><span class="sxs-lookup"><span data-stu-id="ae362-224">Select the pair of network or subnetwork links to monitor from the lists.</span></span>
3. <span data-ttu-id="ae362-225">Сначала выберите сеть, в которой содержатся необходимые первые подсети, в раскрывающемся списке сетей, а затем выберите нужные подсети в раскрывающемся списке подсетей.</span><span class="sxs-lookup"><span data-stu-id="ae362-225">First select the network in which the first subnetwork/s of interest is contained from the network dropdown, and then select the subnetwork/s from the corresponding subnetwork dropdown.</span></span>
   <span data-ttu-id="ae362-226">Выберите **Все подсети**, если необходимо отслеживать все подсети в сетевом соединении.</span><span class="sxs-lookup"><span data-stu-id="ae362-226">Select **All subnetworks** if you want to monitor all the subnetworks in a network link.</span></span> <span data-ttu-id="ae362-227">Аналогичным образом выберите другие необходимые подсети.</span><span class="sxs-lookup"><span data-stu-id="ae362-227">Similarly select the other subnetwork/s of interest.</span></span> <span data-ttu-id="ae362-228">Щелкните **Добавить исключение**, чтобы исключить мониторинг для определенных соединений подсети из списка выбранных.</span><span class="sxs-lookup"><span data-stu-id="ae362-228">And, you can click **Add Exception** to exclude monitoring for particular subnetwork links from the selection you've made.</span></span>
4. <span data-ttu-id="ae362-229">Для выполнения искусственных транзакций в NPM выберите один из протоколов: ICMP или TCP.</span><span class="sxs-lookup"><span data-stu-id="ae362-229">Choose between ICMP and TCP protocols for executing synthetic transactions.</span></span>
5. <span data-ttu-id="ae362-230">Если не нужно создавать события работоспособности для выбранных элементов, снимите флажок **Включить наблюдение за работоспособностью ссылок, охваченных этим правилом**.</span><span class="sxs-lookup"><span data-stu-id="ae362-230">If you don't want to create health events for the items you've selected, then clear **Enable health monitoring on the links covered by this rule**.</span></span>
6. <span data-ttu-id="ae362-231">Выберите условия мониторинга.</span><span class="sxs-lookup"><span data-stu-id="ae362-231">Choose monitoring conditions.</span></span>
   <span data-ttu-id="ae362-232">Вы можете задать настраиваемые пороговые значения для создания событий работоспособности.</span><span class="sxs-lookup"><span data-stu-id="ae362-232">You can set custom thresholds for health event generation by typing threshold values.</span></span> <span data-ttu-id="ae362-233">Каждый раз, когда значение условия превышает выбранное пороговое значение для выбранной пары сетей или подсетей, создается событие работоспособности.</span><span class="sxs-lookup"><span data-stu-id="ae362-233">Whenever the value of the condition goes above its selected threshold for the selected network/subnetwork pair, a health event is generated.</span></span>
7. <span data-ttu-id="ae362-234">Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="ae362-234">Click **Save** to save the configuration.</span></span>  
   <span data-ttu-id="ae362-235">![Создание настраиваемых правил мониторинга](./media/log-analytics-network-performance-monitor/npm-monitor-rule.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-235">![create custom monitoring rule](./media/log-analytics-network-performance-monitor/npm-monitor-rule.png)</span></span>

<span data-ttu-id="ae362-236">Сохранив правило мониторинга, вы можете интегрировать это правило с управлением оповещениями. Для этого щелкните **Создать предупреждение**.</span><span class="sxs-lookup"><span data-stu-id="ae362-236">After you save a monitoring rule, you can integrate that rule with Alert Management by clicking **Create Alert**.</span></span> <span data-ttu-id="ae362-237">Правило оповещений автоматически создается с заполненными полями поискового запроса и других необходимых параметров.</span><span class="sxs-lookup"><span data-stu-id="ae362-237">An alert rule is automatically created with the search query and other required parameters automatically filled-in.</span></span> <span data-ttu-id="ae362-238">Используя правило оповещения, вы можете получать оповещения по электронной почте в дополнение к существующим оповещениям в NPM.</span><span class="sxs-lookup"><span data-stu-id="ae362-238">Using an alert rule, you can receive email-based alerts, in addition to the existing alerts within NPM.</span></span> <span data-ttu-id="ae362-239">Оповещения также могут активировать корректирующие действия для модулей runbook. Или их можно интегрировать с существующими решениями управления службами, использующими объекты webhook.</span><span class="sxs-lookup"><span data-stu-id="ae362-239">Alerts can also trigger remedial actions with runbooks or they can integrate with existing service management solutions using webhooks.</span></span> <span data-ttu-id="ae362-240">Нажмите кнопку **Управлять оповещениями**, чтобы изменить параметры оповещений.</span><span class="sxs-lookup"><span data-stu-id="ae362-240">You can click **Manage Alert** to edit the alert settings.</span></span>

### <a name="choose-the-right-protocol-icmp-or-tcp"></a><span data-ttu-id="ae362-241">Выбор правильного протокола — ICMP или TCP</span><span class="sxs-lookup"><span data-stu-id="ae362-241">Choose the right protocol-ICMP or TCP</span></span>

<span data-ttu-id="ae362-242">Монитор производительности сети (NPM) использует искусственные транзакции для вычисления показателей производительности сети, таких как потеря пакетов и задержка связи.</span><span class="sxs-lookup"><span data-stu-id="ae362-242">Network Performance Monitor (NPM) uses synthetic transactions to calculate network performance metrics like packet loss and link latency.</span></span> <span data-ttu-id="ae362-243">Чтобы лучше в этом разобраться, рассмотрим агент NPM, подключенный к одной конечной точке сетевого соединения.</span><span class="sxs-lookup"><span data-stu-id="ae362-243">To understand this better, consider an NPM agent connected to one end of a network link.</span></span> <span data-ttu-id="ae362-244">Этот агент NPM отправляет пробные пакеты во второй агент NPM, подключенный к другой конечной точке сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-244">This NPM agent sends probe packets to a second NPM agent connected to another end of the network.</span></span> <span data-ttu-id="ae362-245">Второй агент отвечает отправкой ответных пакетов.</span><span class="sxs-lookup"><span data-stu-id="ae362-245">The second agent replies with response packets.</span></span> <span data-ttu-id="ae362-246">Этот процесс повторяется несколько раз.</span><span class="sxs-lookup"><span data-stu-id="ae362-246">This process is repeated a few times.</span></span> <span data-ttu-id="ae362-247">Измеряя количество ответов и время, затраченное на получение каждого ответа, первый агент NPM оценивает задержку связи и потерю пакетов.</span><span class="sxs-lookup"><span data-stu-id="ae362-247">By measuring the number of replies and time taken to receive each reply, the first NPM agent assesses link latency and packet drops.</span></span>

<span data-ttu-id="ae362-248">Формат, размер и последовательность этих пакетов определяется протоколом, который выбирается при создании правил мониторинга.</span><span class="sxs-lookup"><span data-stu-id="ae362-248">The format, size and sequence of these packets is determined by the protocol that you choose when you create monitoring rules.</span></span> <span data-ttu-id="ae362-249">В зависимости от протокола пакетов промежуточные сетевые устройства (маршрутизаторы, коммутаторы и др.) могут по-разному обрабатывать эти пакеты.</span><span class="sxs-lookup"><span data-stu-id="ae362-249">Based on protocol of the packets, the intermediate network devices (routers, switches etc.) might process these packets differently.</span></span> <span data-ttu-id="ae362-250">Поэтому от выбора протокола зависит точность результатов.</span><span class="sxs-lookup"><span data-stu-id="ae362-250">Consequently, your protocol choice affects the accuracy of the results.</span></span> <span data-ttu-id="ae362-251">От выбора протокола также зависит, потребуется ли после развертывания решения NPM выполнять какие-то действия вручную.</span><span class="sxs-lookup"><span data-stu-id="ae362-251">And, your protocol choice also determines whether you must take any manual steps after you deploy the NPM solution.</span></span>

<span data-ttu-id="ae362-252">Для выполнения искусственных транзакций в NPM доступны два протокола — ICMP и TCP.</span><span class="sxs-lookup"><span data-stu-id="ae362-252">NPM offers you the choice between ICMP and TCP protocols for executing synthetic transactions.</span></span>
<span data-ttu-id="ae362-253">Если при создании правила искусственных транзакций выбрать протокол ICMP, то для расчета задержки в сети и потери пакетов агенты NPM будут использовать эхо-сообщения ICMP.</span><span class="sxs-lookup"><span data-stu-id="ae362-253">If you choose ICMP when you create a synthetic transaction rule, the NPM agents use ICMP ECHO messages to calculate the network latency and packet loss.</span></span> <span data-ttu-id="ae362-254">В эхо-сообщениях ICMP используется такой же тип сообщений, как и в традиционной служебной программе проверки связи.</span><span class="sxs-lookup"><span data-stu-id="ae362-254">ICMP ECHO uses the same message that is sent by the conventional Ping utility.</span></span> <span data-ttu-id="ae362-255">Если выбрать протокол TCP, то агенты NPM будут отправлять по сети пакет TCP SYN.</span><span class="sxs-lookup"><span data-stu-id="ae362-255">When you use TCP as the protocol, NPM agents send TCP SYN packet over the network.</span></span> <span data-ttu-id="ae362-256">После этого выполняется подтверждение TCP, а затем подключение удаляется с помощью пакетов RST.</span><span class="sxs-lookup"><span data-stu-id="ae362-256">This is followed by a TCP handshake completion and then removing the connection using RST packets.</span></span>

#### <a name="points-to-consider-before-choosing-the-protocol"></a><span data-ttu-id="ae362-257">Что необходимо учитывать при выборе протокола</span><span class="sxs-lookup"><span data-stu-id="ae362-257">Points to consider before choosing the protocol</span></span>
<span data-ttu-id="ae362-258">Прежде чем выбрать протокол, ознакомьтесь с приведенными ниже сведениями.</span><span class="sxs-lookup"><span data-stu-id="ae362-258">Consider the following information before you choose a protocol to use:</span></span>

##### <a name="discovering-multiple-network-routes"></a><span data-ttu-id="ae362-259">Обнаружение нескольких сетевых маршрутов</span><span class="sxs-lookup"><span data-stu-id="ae362-259">Discovering multiple network routes</span></span>
<span data-ttu-id="ae362-260">При обнаружении нескольких маршрутов протокол TCP обеспечивает более точные результаты. А также ему требуется меньше агентов в каждой подсети.</span><span class="sxs-lookup"><span data-stu-id="ae362-260">TCP is more accurate when discovering multiple routes and it needs fewer agents in each subnet.</span></span> <span data-ttu-id="ae362-261">Например, один или два агента, использующие протокол TCP, могут обнаруживать все избыточные пути между подсетями.</span><span class="sxs-lookup"><span data-stu-id="ae362-261">For example, one or two agents using TCP can discover all redundant paths between subnets.</span></span> <span data-ttu-id="ae362-262">При этом для достижения подобных результатов с помощью протокола ICMP необходимо несколько агентов.</span><span class="sxs-lookup"><span data-stu-id="ae362-262">However, you need several agents using ICMP to achieve similar results.</span></span> <span data-ttu-id="ae362-263">При использовании протокола ICMP, если у вас *N* маршрутов между двумя подсетями, то вам необходимо иметь не менее 5*N* агентов в исходной или целевой подсети.</span><span class="sxs-lookup"><span data-stu-id="ae362-263">Using ICMP, if you have *N* number of routes between two subnets you need more than 5*N* agents in either a source or destination subnet.</span></span>

##### <a name="accuracy-of-results"></a><span data-ttu-id="ae362-264">Точность результатов</span><span class="sxs-lookup"><span data-stu-id="ae362-264">Accuracy of results</span></span>
<span data-ttu-id="ae362-265">Как правило, маршрутизаторы и коммутаторы назначают эхо-пакетам ICMP более низкий приоритет по сравнению с пакетами TCP.</span><span class="sxs-lookup"><span data-stu-id="ae362-265">Routers and switches tend to assign lower priority to ICMP ECHO packets compared to TCP packets.</span></span> <span data-ttu-id="ae362-266">В определенных ситуациях при высокой загрузке сетевых устройств данные, полученные по протоколу TCP, более точно отражают фактические показатели потери и задержки в приложениях.</span><span class="sxs-lookup"><span data-stu-id="ae362-266">In certain situations, when network devices are heavily loaded, the data obtained by TCP more closely reflects the loss and latency experienced by applications.</span></span> <span data-ttu-id="ae362-267">Это связано с тем, что большая часть трафика приложений проходит по протоколу TCP.</span><span class="sxs-lookup"><span data-stu-id="ae362-267">This occurs because most of the application traffic flows over TCP.</span></span> <span data-ttu-id="ae362-268">В таких случаях ICMP обеспечивает менее точные результаты, чем TCP.</span><span class="sxs-lookup"><span data-stu-id="ae362-268">In such cases, ICMP provides less accurate results compared to TCP.</span></span>

##### <a name="firewall-configuration"></a><span data-ttu-id="ae362-269">Настройка брандмауэра</span><span class="sxs-lookup"><span data-stu-id="ae362-269">Firewall configuration</span></span>
<span data-ttu-id="ae362-270">Для протокола TCP требуется, чтобы пакеты TCP отправлялись на конечный порт.</span><span class="sxs-lookup"><span data-stu-id="ae362-270">TCP protocol requires that TCP packets are sent to a destination port.</span></span> <span data-ttu-id="ae362-271">По умолчанию агенты NPM используют порт 8084, однако его можно изменить при настройке агентов.</span><span class="sxs-lookup"><span data-stu-id="ae362-271">The default port used by NPM agents is 8084, however you can change this when you configure agents.</span></span> <span data-ttu-id="ae362-272">Таким образом, необходимо убедиться, что сетевые брандмауэры или правила групп безопасности сети (в Azure) разрешают трафик через этот порт.</span><span class="sxs-lookup"><span data-stu-id="ae362-272">So, you need to ensure that your network firewalls or NSG rules (in Azure) are allowing traffic on the port.</span></span> <span data-ttu-id="ae362-273">Также необходимо убедиться, что в настройках локального брандмауэра на компьютерах, где установлены агенты, разрешен трафик через этот порт.</span><span class="sxs-lookup"><span data-stu-id="ae362-273">You also need to make sure that the local firewall on the computers where agents are installed is configured to allow traffic on this port.</span></span>

<span data-ttu-id="ae362-274">Правила брандмауэра на компьютерах под управлением Windows можно настроить с помощью сценариев PowerShell, а сетевой брандмауэр настраивается вручную.</span><span class="sxs-lookup"><span data-stu-id="ae362-274">You can use PowerShell scripts to configure firewall rules on your computers running Windows, however you need to configure your network firewall manually.</span></span>

<span data-ttu-id="ae362-275">ICMP функционирует иначе. Этот протокол не использует порт.</span><span class="sxs-lookup"><span data-stu-id="ae362-275">In contrast, ICMP does not operate using port.</span></span> <span data-ttu-id="ae362-276">В большинстве корпоративных сценариев ICMP-трафик через брандмауэры разрешается, чтобы была возможность использовать диагностические инструменты, такие как служебная программа проверки связи.</span><span class="sxs-lookup"><span data-stu-id="ae362-276">In most enterprise scenarios, ICMP traffic is permitted through the firewalls to allow you to use network diagnostics tools like the Ping utility.</span></span> <span data-ttu-id="ae362-277">Таким образом, если вам удалось выполнить проверку связи между двумя компьютерами, то вы можете использовать протокол ICMP, не настраивая брандмауэры вручную.</span><span class="sxs-lookup"><span data-stu-id="ae362-277">So, if you can Ping one machine from another, then you can use the ICMP protocol without having to configure firewalls manually.</span></span>

> [!NOTE]
> <span data-ttu-id="ae362-278">Если вы не уверены, какой протокол лучше использовать, выберите сначала ICMP.</span><span class="sxs-lookup"><span data-stu-id="ae362-278">In case you are not sure what protocol to use, choose ICMP to start with.</span></span> <span data-ttu-id="ae362-279">Если результаты вас не удовлетворят, то вы всегда сможете сменить протокол на TCP.</span><span class="sxs-lookup"><span data-stu-id="ae362-279">If you are not satisfied with the results, you can always switch to TCP later.</span></span>


#### <a name="how-to-switch-the-protocol"></a><span data-ttu-id="ae362-280">Как сменить протокол</span><span class="sxs-lookup"><span data-stu-id="ae362-280">How to switch the protocol</span></span>

<span data-ttu-id="ae362-281">Если во время развертывания вы выбрали протокол ICMP, то для его смены на TCP можно в любое время изменить правило мониторинга по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ae362-281">If you chose to use ICMP during deployment, you can switch to TCP at any time by editing the default monitoring rule.</span></span>

##### <a name="to-edit-the-default-monitoring-rule"></a><span data-ttu-id="ae362-282">Чтобы изменить правило мониторинга по умолчанию, выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="ae362-282">To edit the default monitoring rule</span></span>
1.  <span data-ttu-id="ae362-283">Последовательно выберите **Network Performance** (Производительность сети)  > **Monitor** (Мониторинг)  > **Configure** (Настройка)  > **Monitor** (Мониторинг), а затем щелкните **Default rule** (Правило по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="ae362-283">Navigate to **Network Performance** > **Monitor** > **Configure** > **Monitor** and then click **Default rule**.</span></span>
2.  <span data-ttu-id="ae362-284">Прокрутите страницу до раздела **Protocol** (Протокол) и выберите протокол, который хотите использовать.</span><span class="sxs-lookup"><span data-stu-id="ae362-284">Scroll to the **Protocol** section and select the protocol that you want to use.</span></span>
3.  <span data-ttu-id="ae362-285">Чтобы применить настройку, нажмите кнопку **Save** (Сохранить).</span><span class="sxs-lookup"><span data-stu-id="ae362-285">Click **Save** to apply the setting.</span></span>

<span data-ttu-id="ae362-286">Даже если в правиле по умолчанию используется определенный протокол, вы можете создавать другие правила с другим протоколом.</span><span class="sxs-lookup"><span data-stu-id="ae362-286">Even if the default rule is using a specific protocol, you can create new rules with a different protocol.</span></span> <span data-ttu-id="ae362-287">Можно даже создать набор правил, в котором одна часть правил будет использовать протокол ICMP, и другая часть — TCP.</span><span class="sxs-lookup"><span data-stu-id="ae362-287">You can even create a mix of rules where some of the rules use ICMP and another uses TCP.</span></span>




## <a name="data-collection-details"></a><span data-ttu-id="ae362-288">Сведения о сборе данных</span><span class="sxs-lookup"><span data-stu-id="ae362-288">Data collection details</span></span>
<span data-ttu-id="ae362-289">Монитор производительности сети использует пакет подтверждения TCP SYN-SYNACK при выборе TCP и ICMP ECHO ICMP ECHO REPLY при выборе ICMP в качестве протокола для сбора сведений о потере и задержке.</span><span class="sxs-lookup"><span data-stu-id="ae362-289">Network Performance Monitor uses TCP SYN-SYNACK-ACK handshake packets when TCP is chosen and ICMP ECHO ICMP ECHO REPLY when ICMP is chosen as the protocol to collect loss and latency information.</span></span> <span data-ttu-id="ae362-290">Для получения сведений о топологии также используется трассировка маршрута.</span><span class="sxs-lookup"><span data-stu-id="ae362-290">Traceroute is also used to get topology information.</span></span>

<span data-ttu-id="ae362-291">В следующей таблице приведены методы сбора данных и другие сведения о сборе данных для монитора производительности сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-291">The following table shows data collection methods and other details about how data is collected for Network Performance Monitor.</span></span>

| <span data-ttu-id="ae362-292">платформа</span><span class="sxs-lookup"><span data-stu-id="ae362-292">platform</span></span> | <span data-ttu-id="ae362-293">Direct Agent</span><span class="sxs-lookup"><span data-stu-id="ae362-293">Direct Agent</span></span> | <span data-ttu-id="ae362-294">Агент SCOM</span><span class="sxs-lookup"><span data-stu-id="ae362-294">SCOM agent</span></span> | <span data-ttu-id="ae362-295">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="ae362-295">Azure Storage</span></span> | <span data-ttu-id="ae362-296">Нужен ли SCOM?</span><span class="sxs-lookup"><span data-stu-id="ae362-296">SCOM required?</span></span> | <span data-ttu-id="ae362-297">Отправка данных агента SCOM через группу управления</span><span class="sxs-lookup"><span data-stu-id="ae362-297">SCOM agent data sent via management group</span></span> | <span data-ttu-id="ae362-298">частота сбора</span><span class="sxs-lookup"><span data-stu-id="ae362-298">collection frequency</span></span> |
| --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="ae362-299">Windows</span><span class="sxs-lookup"><span data-stu-id="ae362-299">Windows</span></span> | <span data-ttu-id="ae362-300">&#8226;</span><span class="sxs-lookup"><span data-stu-id="ae362-300">&#8226;</span></span> | <span data-ttu-id="ae362-301">&#8226;</span><span class="sxs-lookup"><span data-stu-id="ae362-301">&#8226;</span></span> |  |  |  |<span data-ttu-id="ae362-302">Подтверждения TCP/сообщения ICMP ECHO отправляются каждые 5 секунд. Данные отправляются каждые 3 минуты.</span><span class="sxs-lookup"><span data-stu-id="ae362-302">TCP handshakes/ICMP ECHO messages every 5 seconds, data sent every 3 minutes</span></span> |

<span data-ttu-id="ae362-303">Решение использует искусственные транзакции для оценки работоспособности сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-303">The solution uses synthetic transactions to assess the health of the network.</span></span> <span data-ttu-id="ae362-304">Агенты OMS, установленные в различных точках сети, обмениваются между собой пакетами TCP или ICMP Echo (в зависимости от выбранного для мониторинга протокола).</span><span class="sxs-lookup"><span data-stu-id="ae362-304">OMS agents installed at various point in the network exchange TCP packets or ICMP Echo (depending on the protocol selected for monitoring) with one another.</span></span> <span data-ttu-id="ae362-305">В процессе агенты узнают время приема-передачи и обнаруживают потерю пакетов, если она есть.</span><span class="sxs-lookup"><span data-stu-id="ae362-305">In the process, agents learn the round-trip time and packet loss, if any.</span></span> <span data-ttu-id="ae362-306">Периодически каждый агент выполняет трассировку маршрута к другим агентам, чтобы найти все маршруты в сети, которые необходимо протестировать.</span><span class="sxs-lookup"><span data-stu-id="ae362-306">Periodically, each agent also performs a trace route to other agents to find all the various routes in the network that must be tested.</span></span> <span data-ttu-id="ae362-307">Используя эти данные, агенты могут снизить показатели задержки сети и потери пакетов.</span><span class="sxs-lookup"><span data-stu-id="ae362-307">Using this data, the agents can deduce the network latency and packet loss figures.</span></span> <span data-ttu-id="ae362-308">Тесты повторяются каждые пять секунд, и агенты собирают данные в течение трех минут перед их отправкой в службу Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="ae362-308">The tests are repeated every five seconds and data is aggregated for a period of three minutes by the agents before uploading it to the Log Analytics service.</span></span>

> [!NOTE]
> <span data-ttu-id="ae362-309">Несмотря на то что агенты часто обмениваются данными друг с другом, они не создают большой объем сетевого трафика во время проведения тестов.</span><span class="sxs-lookup"><span data-stu-id="ae362-309">Although agents communicate with each other frequently, they do not generate a lot of network traffic while conducting the tests.</span></span> <span data-ttu-id="ae362-310">Чтобы определить потери и задержки, агенты полагаются только на пакеты подтверждения TCP SYN-SYNACK-ACK. Обмен пакетами данных не происходит.</span><span class="sxs-lookup"><span data-stu-id="ae362-310">Agents rely only on TCP SYN-SYNACK-ACK handshake packets to determine the loss and latency -- no data packets are exchanged.</span></span> <span data-ttu-id="ae362-311">Во время этого процесса агенты взаимодействуют друг с другом только при необходимости, а топология обмена данными между агентами оптимизирована для снижения сетевого трафика.</span><span class="sxs-lookup"><span data-stu-id="ae362-311">During this process, agents communicate with each other only when needed and the agent communication topology is optimized to reduce network traffic.</span></span>
>
>

## <a name="using-the-solution"></a><span data-ttu-id="ae362-312">Использование решения</span><span class="sxs-lookup"><span data-stu-id="ae362-312">Using the solution</span></span>
<span data-ttu-id="ae362-313">В этом разделе описываются функции панели мониторинга и способы их использования.</span><span class="sxs-lookup"><span data-stu-id="ae362-313">This section explains all the dashboard functions and how to use them.</span></span>

### <a name="solution-overview-tile"></a><span data-ttu-id="ae362-314">Плитка обзора решения</span><span class="sxs-lookup"><span data-stu-id="ae362-314">Solution Overview tile</span></span>
<span data-ttu-id="ae362-315">После включения монитора производительности сети на плитке решения на странице обзора OMS появляется краткий обзор работоспособности сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-315">After you've enabled the Network Performance Monitor solution, the solution tile on the OMS Overview page provides a quick overview of the network health.</span></span> <span data-ttu-id="ae362-316">На ней отображается кольцевая диаграмма, отображающая число работоспособных и неработоспособных соединений подсети.</span><span class="sxs-lookup"><span data-stu-id="ae362-316">It displays a doughnut chart showing the number of healthy and unhealthy subnetwork links.</span></span> <span data-ttu-id="ae362-317">Если щелкнуть плитку, откроется панель мониторинга решения.</span><span class="sxs-lookup"><span data-stu-id="ae362-317">When you click the tile, it opens the solution dashboard.</span></span>

![Плитка монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-tile.png)

### <a name="network-performance-monitor-solution-dashboard"></a><span data-ttu-id="ae362-319">Панель мониторинга решения монитора производительности сети</span><span class="sxs-lookup"><span data-stu-id="ae362-319">Network Performance Monitor solution dashboard</span></span>
<span data-ttu-id="ae362-320">В колонке **Сводка о сети** приведены сведения о сетях и об их размерах.</span><span class="sxs-lookup"><span data-stu-id="ae362-320">The **Network Summary** blade shows a summary of the networks along with their relative size.</span></span> <span data-ttu-id="ae362-321">Далее отображаются плитки, показывающие общее число сетевых соединений и соединений подсети, а также путей в системе (путь состоит из IP-адресов двух узлов с агентами и всех прыжков между ними).</span><span class="sxs-lookup"><span data-stu-id="ae362-321">This is followed by tiles showing total number of network links, subnet links and paths in the system (a path consists of the IP addresses of two hosts with agents and all the hops between them).</span></span>

<span data-ttu-id="ae362-322">В колонке **Наиболее частые события работоспособности сети** представлен список последних событий работоспособности и предупреждений в системе, а также время, когда событие стало активным.</span><span class="sxs-lookup"><span data-stu-id="ae362-322">The **Top Network Health Events** blade provides a list of most recent health events and alerts in the system and the time since the event has been active.</span></span> <span data-ttu-id="ae362-323">Событие работоспособности или предупреждение создается, когда значение потери пакетов или задержки сетевого соединения или соединения подсети превышает пороговое значение.</span><span class="sxs-lookup"><span data-stu-id="ae362-323">A health event or alert is generated whenever the packet loss or latency of a network or subnetwork link exceeds a threshold.</span></span>

<span data-ttu-id="ae362-324">В колонке **Главные неработоспособные сетевые соединения** отображается список неработоспособных сетевых соединений.</span><span class="sxs-lookup"><span data-stu-id="ae362-324">The **Top Unhealthy Network Links** blade shows a list of unhealthy network links.</span></span> <span data-ttu-id="ae362-325">Это сетевые соединения с одним или несколькими событиями работоспособности, неблагоприятными для них в данный момент.</span><span class="sxs-lookup"><span data-stu-id="ae362-325">These are the network links that have one or more adverse health event for them at the moment.</span></span>

<span data-ttu-id="ae362-326">В колонках **Top Subnetwork Links with Most Loss** (Главные соединения подсетей с наибольшим показателем потери) и **Соединения подсети с наибольшей задержкой** приведены главные соединения подсетей с наибольшим показателем потери пакетов и главные соединения подсетей с задержкой соответственно.</span><span class="sxs-lookup"><span data-stu-id="ae362-326">The **Top Subnetwork Links with Most Loss** and **Subnetwork Links with Most Latency** blades show the top subnetwork links by packet loss and top subnetwork links by latency respectively.</span></span> <span data-ttu-id="ae362-327">В некоторых сетевых соединениях можно ожидать высокие показатели задержки или значительные потери пакетов.</span><span class="sxs-lookup"><span data-stu-id="ae362-327">High latency or some amount of packet loss might be expected on certain network links.</span></span> <span data-ttu-id="ae362-328">Такие соединения отображаются в первых десяти позициях списка, но не помечаются как неработоспособные.</span><span class="sxs-lookup"><span data-stu-id="ae362-328">Such links appear in the top ten lists but are not marked unhealthy.</span></span>

<span data-ttu-id="ae362-329">В колонке **Общие запросы** содержится набор запросов поиска, выполнив которые можно напрямую получить необработанные данные о мониторинге сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-329">The **Common Queries** blade contains a set of search queries that fetch raw network monitoring data directly.</span></span> <span data-ttu-id="ae362-330">Эти запросы можно использовать как отправную точку для создания собственных запросов для настраиваемых отчетов.</span><span class="sxs-lookup"><span data-stu-id="ae362-330">You can use these queries as a starting point for creating your own queries for customized reporting.</span></span>

![Панель мониторинга монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-dash01.png)

### <a name="drill-down-for-depth"></a><span data-ttu-id="ae362-332">Углубленное изучение</span><span class="sxs-lookup"><span data-stu-id="ae362-332">Drill-down for depth</span></span>
<span data-ttu-id="ae362-333">Вы можете щелкнуть различные ссылки на панели мониторинга решения, чтобы узнать больше о любой интересующей вас области.</span><span class="sxs-lookup"><span data-stu-id="ae362-333">You can click various links on the solution dashboard to drill-down deeper into any area of interest.</span></span> <span data-ttu-id="ae362-334">Например, когда на панели мониторинга отображается предупреждение или неработоспособное сетевое соединение, его можно щелкнуть для дальнейшего изучения.</span><span class="sxs-lookup"><span data-stu-id="ae362-334">For example, when you see an alert or an unhealthy network link appear on the dashboard, you can click it to investigate further.</span></span> <span data-ttu-id="ae362-335">Вы будете перенаправлены на страницу, на которой приведены все соединения подсети, относящиеся к конкретному сетевому соединению.</span><span class="sxs-lookup"><span data-stu-id="ae362-335">You'll be taken to a page that lists all the subnetwork links for the particular network link.</span></span> <span data-ttu-id="ae362-336">Там вы сможете увидеть показатели потери, задержки и работоспособности каждого соединения подсети и быстро узнать, какие соединения подсети являются причиной проблемы.</span><span class="sxs-lookup"><span data-stu-id="ae362-336">You will be able to see the loss, latency and health status of each subnetwork link and quickly find out what subnetwork links are causing the problem.</span></span> <span data-ttu-id="ae362-337">Вы также можете щелкнуть **Просмотреть ссылки на узлы**, чтобы просмотреть все соединения узлов, связанные с неработоспособным соединением подсети.</span><span class="sxs-lookup"><span data-stu-id="ae362-337">You can then click **View node links** to see all the node links for the unhealthy subnet link.</span></span> <span data-ttu-id="ae362-338">Затем можно просмотреть отдельные соединения между узлами и найти неработоспособные соединения узлов.</span><span class="sxs-lookup"><span data-stu-id="ae362-338">Then, you can see individual node-to-node links and find the unhealthy node links.</span></span>

<span data-ttu-id="ae362-339">Выберите **Просмотреть топологию**, чтобы просмотреть топологию по прыжкам маршрута между исходным узлом и узлом назначения.</span><span class="sxs-lookup"><span data-stu-id="ae362-339">You can click **View topology** to view the hop-by-hop topology of the routes between the source and destination nodes.</span></span> <span data-ttu-id="ae362-340">Неработоспособные маршруты или прыжки отображаются красным цветом, что дает возможность быстро обнаружить проблемы в определенной части сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-340">The unhealthy routes or hops are shown in red so that you can quickly identify the problem to a particular portion of the network.</span></span>

![Детализация данных](./media/log-analytics-network-performance-monitor/npm-drill.png)

### <a name="network-state-recorder"></a><span data-ttu-id="ae362-342">Запись состояния сети</span><span class="sxs-lookup"><span data-stu-id="ae362-342">Network State Recorder</span></span>

<span data-ttu-id="ae362-343">Каждое представление отображает моментальный снимок работоспособности сети в определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="ae362-343">Each view displays a snapshot of your network health at a particular point in time.</span></span> <span data-ttu-id="ae362-344">По умолчанию отображается последнее состояние.</span><span class="sxs-lookup"><span data-stu-id="ae362-344">By default, the most recent state is shown.</span></span> <span data-ttu-id="ae362-345">На панели в верхней части страницы отображается точка времени, для которой отображается состояние.</span><span class="sxs-lookup"><span data-stu-id="ae362-345">The bar at the top of the page shows the point in time for which the state is being displayed.</span></span> <span data-ttu-id="ae362-346">Вы можете вернуться назад во времени и просмотреть моментальный снимок работоспособности сети, щелкнув панель **Действия**.</span><span class="sxs-lookup"><span data-stu-id="ae362-346">You can choose to go back in time and view the snapshot of your network health by clicking on the bar on **Actions**.</span></span> <span data-ttu-id="ae362-347">Также во время просмотра актуального состояния можно включить или отключить автоматическое обновление для любой страницы.</span><span class="sxs-lookup"><span data-stu-id="ae362-347">You can also choose to enable or disable auto-refresh for any page while you view the latest state.</span></span>

![состояние сети](./media/log-analytics-network-performance-monitor/network-state.png)

#### <a name="trend-charts"></a><span data-ttu-id="ae362-349">Диаграммы трендов</span><span class="sxs-lookup"><span data-stu-id="ae362-349">Trend charts</span></span>
<span data-ttu-id="ae362-350">На каждом уровне детализации можно увидеть тенденцию потери и задержки сетевого соединения.</span><span class="sxs-lookup"><span data-stu-id="ae362-350">At each level that you drill-down, you can see the trend of loss and latency for a network link.</span></span> <span data-ttu-id="ae362-351">Диаграммы трендов также доступны для соединений подсети и соединений узлов.</span><span class="sxs-lookup"><span data-stu-id="ae362-351">Trend charts are also available for Subnetwork and Node links.</span></span> <span data-ttu-id="ae362-352">Вы можете изменить интервал времени, отображаемый на диаграмме, с помощью элемента управления временем в верхней части диаграммы.</span><span class="sxs-lookup"><span data-stu-id="ae362-352">You can change the time interval for the graph to plot by using the time control at the top of the chart.</span></span>

<span data-ttu-id="ae362-353">На диаграммах трендов отображается историческая справка о производительности сетевого соединения.</span><span class="sxs-lookup"><span data-stu-id="ae362-353">Trend charts show you a historical perspective of the performance of a network link.</span></span> <span data-ttu-id="ae362-354">Некоторые проблемы с сетью временные и их трудно обнаружить только на основе текущего состояния сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-354">Some network issues are transient in nature and would be hard to catch only by looking at the current state of the network.</span></span> <span data-ttu-id="ae362-355">Это объясняется тем, что проблемы могут быстро появиться и исчезнуть, прежде чем их кто-либо заметит. Они появятся вновь чуть позднее.</span><span class="sxs-lookup"><span data-stu-id="ae362-355">This is because issues can surface quickly and disappear before anyone notices, only to reappear at a later point in time.</span></span> <span data-ttu-id="ae362-356">Такие временные проблемы также создают сложности для администраторов приложений, так как они часто проявляются в виде необъяснимых увеличений времени отклика приложения, даже если все компоненты приложения работают стабильно.</span><span class="sxs-lookup"><span data-stu-id="ae362-356">Such transient issues can also be difficult for application administrators because those issues often surface as unexplained increases in application response time, even when all application components appear to run smoothly.</span></span>

<span data-ttu-id="ae362-357">Вы можете легко обнаружить проблемы такого рода, просмотрев диаграмму тренда, где проблема будет отображаться в виде внезапного пика задержки сети или потери пакетов.</span><span class="sxs-lookup"><span data-stu-id="ae362-357">You can easily detect those kinds of issues by looking at a trend chart where the issue will appear as a sudden spike in network latency or packet loss.</span></span>

![Диаграмма трендов](./media/log-analytics-network-performance-monitor/npm-trend.png)

#### <a name="hop-by-hop-topology-map"></a><span data-ttu-id="ae362-359">Схема топологии по прыжкам</span><span class="sxs-lookup"><span data-stu-id="ae362-359">Hop-by-hop topology map</span></span>
<span data-ttu-id="ae362-360">Монитор производительности сети отображает топологию по прыжкам маршрутов между двумя узлами на интерактивной карте топологии.</span><span class="sxs-lookup"><span data-stu-id="ae362-360">Network Performance Monitor shows you the hop-by-hop topology of routes between two nodes on an interactive topology map.</span></span> <span data-ttu-id="ae362-361">Карту топологии можно просмотреть, выделив соединение узла и выбрав команду **Просмотреть топологию**.</span><span class="sxs-lookup"><span data-stu-id="ae362-361">You can view the topology map by selecting a node link and then clicking **View topology**.</span></span> <span data-ttu-id="ae362-362">Кроме того, карту топологии можно просмотреть, щелкнув плитку **Пути** на панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="ae362-362">Also, you can view the topology map by clicking **Paths** tile on the dashboard.</span></span> <span data-ttu-id="ae362-363">После выбора **этой плитки** на панели мониторинга необходимо выбрать исходный узел и узел назначения на панели слева и щелкнуть **Построить**, чтобы построить маршруты между двумя узлами.</span><span class="sxs-lookup"><span data-stu-id="ae362-363">When you click **Paths** on the dashboard, you'll have to select the source and destination nodes from the left hand panel and then click **Plot** to plot the routes between the two nodes.</span></span>

<span data-ttu-id="ae362-364">На карте топологии отображается количество маршрутов между двумя узлами и пути, по которым передаются пакеты данных.</span><span class="sxs-lookup"><span data-stu-id="ae362-364">The topology map displays how many routes are between the two nodes and what paths the data packets take.</span></span> <span data-ttu-id="ae362-365">На этой карте узкие места производительности сети помечаются красным цветом.</span><span class="sxs-lookup"><span data-stu-id="ae362-365">Network performance bottlenecks are marked in red on the topology map.</span></span> <span data-ttu-id="ae362-366">Чтобы найти неисправное сетевое подключение или неисправное сетевое устройство, нужно просмотреть элементы, помеченные красным цветом на карте топологии.</span><span class="sxs-lookup"><span data-stu-id="ae362-366">You can locate a faulty network connection or a faulty network device by looking at red colored elements on the topology map.</span></span>

<span data-ttu-id="ae362-367">Если щелкнуть узел или навести на него указатель мыши на карте топологии, отобразятся его свойства, например полное доменное имя и IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="ae362-367">When you click a node or hover over it on the topology map, you'll see the properties of the node like FQDN and IP address.</span></span> <span data-ttu-id="ae362-368">Нажмите кнопку прыжка, чтобы увидеть IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="ae362-368">Click a hop to see it's IP address.</span></span> <span data-ttu-id="ae362-369">Вы можете фильтровать определенные маршруты с помощью фильтров на свертываемой панели действий.</span><span class="sxs-lookup"><span data-stu-id="ae362-369">You can choose to filter particular routes by using the filters in the collapsible action pane.</span></span> <span data-ttu-id="ae362-370">Вы также можете упрощать топологии сети, скрывая промежуточные прыжки с помощью ползунка на панели действий.</span><span class="sxs-lookup"><span data-stu-id="ae362-370">And, you can also simplify the network topologies by hiding the intermediate hops using the slider in the action pane.</span></span> <span data-ttu-id="ae362-371">Масштаб карты топологии можно увеличить или уменьшить с помощью колесика мыши.</span><span class="sxs-lookup"><span data-stu-id="ae362-371">You can zoom-in or out of the topology map by using your mouse wheel.</span></span>

<span data-ttu-id="ae362-372">Обратите внимание, что топология, показанная на карте, — это топология уровня 3, которая не содержит устройства и подключения уровня 2.</span><span class="sxs-lookup"><span data-stu-id="ae362-372">Note that the topology shown in the map is layer 3 topology and doesn't contain layer 2 devices and connections.</span></span>

![Схема топологии по прыжкам](./media/log-analytics-network-performance-monitor/npm-topology.png)

#### <a name="fault-localization"></a><span data-ttu-id="ae362-374">Локализация неисправностей</span><span class="sxs-lookup"><span data-stu-id="ae362-374">Fault localization</span></span>
<span data-ttu-id="ae362-375">Монитор производительности сети может выполнять поиск узких мест сети без подключения к сетевым устройствам.</span><span class="sxs-lookup"><span data-stu-id="ae362-375">Network Performance Monitor is able to find the network bottlenecks without connecting to the network devices.</span></span> <span data-ttu-id="ae362-376">Используя данные, которые он собирает из сети, и применяя усовершенствованные алгоритмы на диаграмме сети, монитор производительности сети выполняет вероятностную оценку частей сети, которые, скорее всего, являются источником проблемы.</span><span class="sxs-lookup"><span data-stu-id="ae362-376">Based on the data that it gathers from the network and by applying advanced algorithms on the network graph, Network Performance Monitor makes a probabilistic estimate of the parts of network that are most likely the source of the problem.</span></span>

<span data-ttu-id="ae362-377">Этот подход полезен при выявлении узких мест сети, когда доступ к прыжкам недоступен, так как при в этом случае не требуется собирать какие-либо данные из сетевых устройств, например маршрутизаторов и коммутаторов.</span><span class="sxs-lookup"><span data-stu-id="ae362-377">This approach is useful to determine the network bottlenecks when access to hops isn't available because it doesn't require any data to be gathered from the network devices such as routers or switches.</span></span> <span data-ttu-id="ae362-378">Он также полезен, когда у вас нет прав администрирования в отношении прыжков между двумя узлами.</span><span class="sxs-lookup"><span data-stu-id="ae362-378">This is also useful when the hops between two nodes are not in your administrative control.</span></span> <span data-ttu-id="ae362-379">Например, прыжки могут быть маршрутизаторами поставщика услуг Интернета.</span><span class="sxs-lookup"><span data-stu-id="ae362-379">For example, the hops may be ISP routers.</span></span>

### <a name="log-analytics-search"></a><span data-ttu-id="ae362-380">Поиск в Log Analytics</span><span class="sxs-lookup"><span data-stu-id="ae362-380">Log Analytics search</span></span>
<span data-ttu-id="ae362-381">Все данные, графически представленные на панели мониторинга монитора производительности сети и страницах детализации, также доступны непосредственно через поиск в Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="ae362-381">All data that is exposed graphically through the Network Performance Monitor dashboard and drill-down pages is also available natively in Log Analytics search.</span></span> <span data-ttu-id="ae362-382">Вы можете запрашивать данные с помощью языка поисковых запросов и создавать пользовательские отчеты путем экспорта данных в Excel или PowerBI.</span><span class="sxs-lookup"><span data-stu-id="ae362-382">You can query the data using the search query language and create custom reports by exporting the data to Excel or PowerBI.</span></span> <span data-ttu-id="ae362-383">В колонке **Общие запросы** на панели мониторинга содержатся некоторые полезные запросы, которые можно использовать в качестве отправной точки для создания собственных запросов и отчетов.</span><span class="sxs-lookup"><span data-stu-id="ae362-383">The **Common Queries** blade in the dashboard has some useful queries that you can use as the starting point for creating your own queries and reports.</span></span>

![Поисковые запросы](./media/log-analytics-network-performance-monitor/npm-queries.png)

## <a name="investigate-the-root-cause-of-a-health-alert"></a><span data-ttu-id="ae362-385">Выявление основной причины появления оповещения о работоспособности</span><span class="sxs-lookup"><span data-stu-id="ae362-385">Investigate the root cause of a health alert</span></span>
<span data-ttu-id="ae362-386">Теперь, когда вы прочитали о мониторе производительности сети, давайте рассмотрим, как легко выявить причину возникновения события работоспособности.</span><span class="sxs-lookup"><span data-stu-id="ae362-386">Now that you've read about Network Performance Monitor, let's look at a simple investigation into the root-cause for a health event.</span></span>

1. <span data-ttu-id="ae362-387">Чтобы быстро получить представление о работоспособности сети, наблюдайте за плиткой **Монитор производительности сети** на странице обзора.</span><span class="sxs-lookup"><span data-stu-id="ae362-387">On the Overview page, you'll get a quick snapshot of the health of your network by observing the **Network Performance Monitor** tile.</span></span> <span data-ttu-id="ae362-388">Обратите внимание, что из 6 отслеживаемых соединений подсетей 2 являются неработоспособными.</span><span class="sxs-lookup"><span data-stu-id="ae362-388">Notice that out of the 6 subnetworks links being monitored, 2 are unhealthy.</span></span> <span data-ttu-id="ae362-389">Это гарантирует выявление.</span><span class="sxs-lookup"><span data-stu-id="ae362-389">This warrants investigation.</span></span> <span data-ttu-id="ae362-390">Щелкните плитку, чтобы просмотреть панель мониторинга решения.</span><span class="sxs-lookup"><span data-stu-id="ae362-390">Click the tile to view the solution dashboard.</span></span>  
   <span data-ttu-id="ae362-391">![Плитка монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-investigation01.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-391">![Network Performance Monitor tile](./media/log-analytics-network-performance-monitor/npm-investigation01.png)</span></span>
2. <span data-ttu-id="ae362-392">В приведенном ниже примере можно увидеть событие работоспособности в сетевом соединении, которое находится в неработоспособном состоянии.</span><span class="sxs-lookup"><span data-stu-id="ae362-392">In the example image below, you'll notice that there is a health event a network link that is unhealthy.</span></span> <span data-ttu-id="ae362-393">Чтобы определить причину проблемы, выберите сетевое соединение **DMZ2-DMZ1**.</span><span class="sxs-lookup"><span data-stu-id="ae362-393">You decide to investigate the issue and click on the **DMZ2-DMZ1** network link to find out the root of the problem.</span></span>  
   <span data-ttu-id="ae362-394">![Пример неработоспособного сетевого соединения](./media/log-analytics-network-performance-monitor/npm-investigation02.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-394">![unhealthy network link example](./media/log-analytics-network-performance-monitor/npm-investigation02.png)</span></span>
3. <span data-ttu-id="ae362-395">На странице детализации отобразятся все соединения подсети в сетевом соединении **DMZ2-DMZ1**.</span><span class="sxs-lookup"><span data-stu-id="ae362-395">The drill-down page shows all the subnetwork links in **DMZ2-DMZ1** network link.</span></span> <span data-ttu-id="ae362-396">Вы увидите, что для обоих соединений подсети значение задержки превысило пороговое значение. Это и является причиной неработоспособности сетевого соединения.</span><span class="sxs-lookup"><span data-stu-id="ae362-396">You'll notice that for both the subnetwork links, the latency has crossed the threshold making the network link unhealthy.</span></span> <span data-ttu-id="ae362-397">Кроме того, можно увидеть тенденции задержки обоих соединений подсети.</span><span class="sxs-lookup"><span data-stu-id="ae362-397">You can also see the latency trends of both the subnetwork links.</span></span> <span data-ttu-id="ae362-398">На диаграмме можно использовать элемент управления для выбора времени, чтобы сосредоточиться на необходимом диапазоне времени.</span><span class="sxs-lookup"><span data-stu-id="ae362-398">You can use the time selection control in the graph to focus on the required time range.</span></span> <span data-ttu-id="ae362-399">Вы узнаете период, когда значение задержки достигло пика.</span><span class="sxs-lookup"><span data-stu-id="ae362-399">You can see the time of the day when latency has reached its peak.</span></span> <span data-ttu-id="ae362-400">Позже можно найти сведения для этого периода времени в журналах, чтобы определить причину проблемы.</span><span class="sxs-lookup"><span data-stu-id="ae362-400">You can later search the logs for this time period to investigate the issue.</span></span> <span data-ttu-id="ae362-401">Щелкните **Просмотреть ссылки на узлы** для дополнительной детализации.</span><span class="sxs-lookup"><span data-stu-id="ae362-401">Click **View node links** to drill-down further.</span></span>  
   <span data-ttu-id="ae362-402">![Пример неработоспособных соединений подсети](./media/log-analytics-network-performance-monitor/npm-investigation03.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-402">![unhealthy subnet links example](./media/log-analytics-network-performance-monitor/npm-investigation03.png)</span></span>
4. <span data-ttu-id="ae362-403">Как и на предыдущей странице, на странице детализации для определенного соединения подсети представлены, связанные с ней соединения узлов.</span><span class="sxs-lookup"><span data-stu-id="ae362-403">Similar to the previous page, the drill-down page for the particular subnetwork link lists down its constituent node links.</span></span> <span data-ttu-id="ae362-404">Здесь можно выполнить те же действия, которые описаны на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="ae362-404">You can perform similar actions  here as you did in the previous step.</span></span> <span data-ttu-id="ae362-405">Щелкните **Просмотреть топологию**, чтобы просмотреть топологию между двумя узлами.</span><span class="sxs-lookup"><span data-stu-id="ae362-405">Click **View topology** to view the topology between the 2 nodes.</span></span>  
   <span data-ttu-id="ae362-406">![Пример неработоспособных соединений узлов](./media/log-analytics-network-performance-monitor/npm-investigation04.png)</span><span class="sxs-lookup"><span data-stu-id="ae362-406">![unhealthy node links example](./media/log-analytics-network-performance-monitor/npm-investigation04.png)</span></span>
5. <span data-ttu-id="ae362-407">Все пути между двумя выбранными узлами отображаются на карте топологии.</span><span class="sxs-lookup"><span data-stu-id="ae362-407">All the paths between the 2 selected nodes are plotted in the topology map.</span></span> <span data-ttu-id="ae362-408">Топологию маршрутов можно визуализировать по прыжкам между двумя узлами на карте топологии.</span><span class="sxs-lookup"><span data-stu-id="ae362-408">You can visualize the hop-by-hop topology of routes between two nodes on the topology map.</span></span> <span data-ttu-id="ae362-409">Это обеспечивает четкое представление о количестве маршрутов между двумя узлами и путях, по которым передаются пакеты данных.</span><span class="sxs-lookup"><span data-stu-id="ae362-409">It gives you a clear picture of how many routes exist between the two nodes and what paths the data packets are taking.</span></span> <span data-ttu-id="ae362-410">Узкие места производительности сети помечаются красным цветом.</span><span class="sxs-lookup"><span data-stu-id="ae362-410">Network performance bottlenecks are marked in red color.</span></span> <span data-ttu-id="ae362-411">Чтобы найти неисправное сетевое подключение или неисправное сетевое устройство, нужно просмотреть элементы, помеченные красным цветом на карте топологии.</span><span class="sxs-lookup"><span data-stu-id="ae362-411">You can locate a faulty network connection or a faulty network device by looking at red colored elements on the topology map.</span></span>  
   ![Пример представления неработоспособной топологии](./media/log-analytics-network-performance-monitor/npm-investigation05.png)
6. <span data-ttu-id="ae362-413">Значения потери, задержки и количество прыжков в каждом пути можно просмотреть в области **Действие**.</span><span class="sxs-lookup"><span data-stu-id="ae362-413">The loss, latency, and the number of hops in each path can be reviewed in the **Action** pane.</span></span> <span data-ttu-id="ae362-414">Используйте полосу прокрутки, чтобы просмотреть сведения об этих неработоспособных путях.</span><span class="sxs-lookup"><span data-stu-id="ae362-414">Use the scrollbar to view the details of those unhealthy paths.</span></span>  <span data-ttu-id="ae362-415">Используйте фильтры для выбора путей с неработоспособными прыжками, чтобы отобразить топологию только выбранных путей.</span><span class="sxs-lookup"><span data-stu-id="ae362-415">Use the filters to select the paths with the unhealthy hop so that the topology for only the selected paths is plotted.</span></span> <span data-ttu-id="ae362-416">С помощью колесика мыши можно увеличить или уменьшить масштаб карты топологии.</span><span class="sxs-lookup"><span data-stu-id="ae362-416">You can use your mouse wheel to zoom in or out of the topology map.</span></span>

   <span data-ttu-id="ae362-417">Если посмотреть на пути и прыжки, выделенные красным цветом на изображении ниже, станет понятна основная причина проблем для определенной части сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-417">In the below image you can clearly see the root-cause of the problem areas to the specific section of the network by looking at the paths and hops in red color.</span></span> <span data-ttu-id="ae362-418">Щелкнув узел на карте топологии, можно увидеть его свойства, включая полное доменное имя и IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="ae362-418">Clicking on a node in the topology map reveals the properties of the node, including the FQDN, and IP address.</span></span> <span data-ttu-id="ae362-419">Если щелкнуть прыжок, отобразится IP-адрес прыжка.</span><span class="sxs-lookup"><span data-stu-id="ae362-419">Clicking on a hop shows the IP address of the hop.</span></span>  
   ![Неработоспособная топология — пример сведений о пути](./media/log-analytics-network-performance-monitor/npm-investigation06.png)

## <a name="provide-feedback"></a><span data-ttu-id="ae362-421">Отзывы</span><span class="sxs-lookup"><span data-stu-id="ae362-421">Provide feedback</span></span>

- <span data-ttu-id="ae362-422">**UserVoice.** Если вы хотите, чтобы мы разработали новые функции для монитора производительности сети, здесь вы можете публиковать свои идеи.</span><span class="sxs-lookup"><span data-stu-id="ae362-422">**UserVoice** - You can post your ideas for Network Performance Monitor features that you want us to work on.</span></span> <span data-ttu-id="ae362-423">Посетите нашу [страницу UserVoice](https://feedback.azure.com/forums/267889-log-analytics/category/188146-network-monitoring).</span><span class="sxs-lookup"><span data-stu-id="ae362-423">Visit our [UserVoice page](https://feedback.azure.com/forums/267889-log-analytics/category/188146-network-monitoring).</span></span>
- <span data-ttu-id="ae362-424">**Присоединяйтесь к когорте наших клиентов.** Мы всегда заинтересованы в новых клиентах.</span><span class="sxs-lookup"><span data-stu-id="ae362-424">**Join our cohort** - We’re always interested in having new customers join our cohort.</span></span> <span data-ttu-id="ae362-425">Став одним из них, вы получите доступ к новым функциям и поможете нам улучшить монитор производительности сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-425">As part of it, you'll get early access to new features and help us improve Network Performance Monitor.</span></span> <span data-ttu-id="ae362-426">Если вы хотите присоединиться к нам, пройдите этот [быстрый опрос](https://aka.ms/npmcohort).</span><span class="sxs-lookup"><span data-stu-id="ae362-426">If you're interested in joining, fill-out this [quick survey](https://aka.ms/npmcohort).</span></span>

## <a name="next-steps"></a><span data-ttu-id="ae362-427">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ae362-427">Next steps</span></span>
* <span data-ttu-id="ae362-428">[Выполните поиск по журналам](log-analytics-log-searches.md), чтобы просмотреть подробные записи данных о производительности сети.</span><span class="sxs-lookup"><span data-stu-id="ae362-428">[Search logs](log-analytics-log-searches.md) to view detailed network performance data records.</span></span>
