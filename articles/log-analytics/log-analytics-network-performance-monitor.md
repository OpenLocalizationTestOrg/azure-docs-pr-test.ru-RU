---
title: "Монитор производительности сети в Azure Log Analytics | Документация Майкрософт"
description: "Монитор производительности сети в Azure Log Analytics позволяет отслеживать производительность ваших сетей практически в реальном времени для обнаружения проблем производительности."
services: log-analytics
documentationcenter: 
author: bandersmsft
manager: carmonm
editor: 
ms.assetid: 5b9c9c83-3435-488c-b4f6-7653003ae18a
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: banders
ms.openlocfilehash: c6568e491429f6046ab164ab5eacd0ae5846e201
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="network-performance-monitor-solution-in-log-analytics"></a>Решение монитора производительности сети в Azure Log Analytics

![Символ монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-symbol.png)

В этом документе объясняется, как настроить и использовать в Azure Log Analytics монитор производительности сети, который позволяет отслеживать производительность ваших сетей практически в реальном времени для обнаружения проблем производительности. С помощью этого решения можно отслеживать потери и задержки между двумя сетями, подсетями или серверами. Монитор производительности сети обнаруживает проблемы сети, такие как появление "черных дыр" в трафике, ошибки маршрутизации и проблемы, которые невозможно обнаружить с помощью традиционных методов мониторинга сети. Он создает предупреждения и уведомляет о превышении порогового значения для сетевого соединения. Система может определить эти пороговые значения автоматически. Кроме того, для них можно настроить использование настраиваемых правил предупреждений. Монитор производительности сети обеспечивает своевременное обнаружение проблем с производительностью сети и определяет конкретный сегмент сети или сетевое устройство как источник проблемы.

Проблемы с сетью можно обнаружить с помощью панели мониторинга решения. На ней отображаются сведения о сети, включая последние события работоспособности сети, неработоспособные сетевые соединения и соединения подсетей, в которых возник высокий уровень потери пакетов и задержки. Вы можете перейти к сведениям о сетевом соединении, чтобы просмотреть текущее состояние работоспособности соединений подсети, а также соединений между узлами. Кроме того, можно просмотреть историческую тенденцию потери и задержки на уровне сети, подсети и между узлами. Вы можете определить временные неполадки сети, просматривая диаграммы исторических трендов, где видны потери пакетов и задержки, а также найти узкие места сети на карте топологии. Интерактивная диаграмма топологии позволяет визуализировать сетевые маршруты по прыжкам и определить источник проблемы. Помимо других решений, можно использовать поиск по журналу с учетом различных требований к аналитике, чтобы создавать настраиваемые отчеты на основе данных, собираемых с помощью монитора производительности сети.

В качестве основного механизма для обнаружения ошибок сети в решении используются искусственные транзакции. Таким образом, его можно использовать вне зависимости от поставщика или модели определенного сетевого устройства. Он работает в локальных, облачных (IaaS) и гибридных средах. Это решение автоматически обнаруживает топологию сети и различные сетевые маршруты.

Монитор производительности сети предоставляет ценную информацию о реальном качестве сетевого подключения между двумя точками в отличие от типичных продуктов сетевого мониторинга, которые ориентированы только на мониторинг работоспособности сетевого устройства (маршрутизаторов, коммутаторов и т. д.).

### <a name="using-the-solution-standalone"></a>Использование только решения
Если требуется отслеживать качество сетевых подключений между критически важными рабочими нагрузками, сетями, центрами обработки данных или расположениями организации, вы можете использовать само решение монитора производительности сети для мониторинга работоспособности подключений между:

* несколькими центрами обработки данных или расположениями организации, которые соединены с помощью частной или общедоступной сети;
* критически важными рабочими нагрузками, выполняющими бизнес-приложения;
* общедоступными облачными службами, например Microsoft Azure или Amazon Web Services (AWS), и локальными сетями, если у вас есть доступная IaaS (виртуальная машина) и шлюзы настроены для обеспечения связи между локальными и облачными сетями;
* сетями Azure и локальными сетями при использовании Express Route.

### <a name="using-the-solution-with-other-networking-tools"></a>Использование решения с другими сетевыми средствами
Если вам необходимо отслеживать бизнес-приложение, вы можете использовать монитор производительности сети совместно с другими сетевыми средствами. Низкая скорость сети может замедлить работу приложений. В этом случае монитор производительности сети поможет обнаружить проблемы с производительностью приложений, вызванные базовыми сетевыми проблемами. Так как для решения не требуется доступ к сетевым устройствам, администратору приложения не нужно полагаться на команду специалистов по сетям для предоставления сведений о влиянии сети на приложения.

Кроме того, если вы уже вложили средства в другие средства мониторинга сети, это решение может дополнить их, так как большинство традиционных решений для мониторинга сети не предоставляют подробные сведения о комплексных показателях производительности сети, например о потере и задержке.  Монитор производительности сети поможет заполнить этот пробел.

## <a name="installing-and-configuring-agents-for-the-solution"></a>Установка и настройка агентов для решения
Базовая процедура установки агентов приведена в статьях [Подключение компьютеров Windows к Log Analytics](log-analytics-windows-agents.md) и [Подключение Operations Manager к Log Analytics](log-analytics-om-agents.md).

> [!NOTE]
> Необходимо установить по крайней мере два агента, которые будут собирать достаточно данных для обнаружения сетевых ресурсов и наблюдения за ними. В противном случае решение будет оставаться в состоянии настройки, пока не будут установлены и настроены дополнительные агенты.
>
>

### <a name="where-to-install-the-agents"></a>Место для установки агентов
Перед установкой агентов выберите топологию сети и части сети, которые требуется отслеживать. Мы советуем установить несколько агентов для каждой подсети, которую требуется отслеживать. Иными словами, для каждой такой подсети выберите два или больше серверов или виртуальных машин и установите на них агент.

Если вы не знаете топологию сети, установите агенты на серверах с критически важными рабочими нагрузками, где требуется отслеживать производительность сети. Например, вам может понадобиться отслеживать сетевое подключение между веб-сервером и сервером под управлением SQL Server. В этом случае агент необходимо установить на обоих серверах.

Агенты отслеживают сетевое подключение (соединения) между узлами, а не сами узлы. Таким образом, для отслеживания сетевого соединения агенты нужно установить на обеих конечных точках соединения.

### <a name="configure-agents"></a>Настройка агентов

Если вы планируете использовать протокол ICMP для синтетических транзакций, включите следующие правила брандмауэра для надежного использования ICMP:

```
netsh advfirewall firewall add rule name="NPMDICMPV4Echo" protocol="icmpv4:8,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6Echo" protocol="icmpv6:128,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV4DestinationUnreachable" protocol="icmpv4:3,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6DestinationUnreachable" protocol="icmpv6:1,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV4TimeExceeded" protocol="icmpv4:11,any" dir=in action=allow
netsh advfirewall firewall add rule name="NPMDICMPV6TimeExceeded" protocol="icmpv6:3,any" dir=in action=allow
```


Если вы собираетесь использовать протокол TCP, необходимо открыть порты брандмауэра этих компьютеров, чтобы агенты могли обмениваться данными. Вам нужно скачать, а затем запустить [скрипт PowerShell EnableRules.ps1](https://gallery.technet.microsoft.com/OMS-Network-Performance-04a66634), не задавая каких-либо параметров, в окне PowerShell с правами администратора.

Этот скрипт создает разделы реестра, необходимые для монитора производительности сети, а также правила брандмауэра Windows, чтобы разрешить агентам создавать TCP-подключения друг к другу. В разделах реестра, созданных скриптом, также нужно указать, следует ли записывать журналы отладки и путь к файлу журнала. Он также определяет TCP-порт агента, используемый для обмена данными. Значения этих реестров автоматически устанавливаются с помощью скрипта, поэтому вам не нужно изменять их вручную.

Открытый порт по умолчанию — 8084. Вы можете использовать пользовательский порт, задав в скрипте параметр `portNumber`. На всех компьютерах, где выполняется скрипт, нужно использовать один и тот же порт.

> [!NOTE]
> Скрипт EnableRules.ps1 настраивает правила брандмауэра Windows только на том компьютере, где он выполняется. При наличии брандмауэра сети он должен разрешать пропуск трафика к TCP-порту, который используется монитором производительности сети.
>
>

## <a name="configuring-the-solution"></a>Настройка решения
Для установки и настройки решений используйте указанные ниже данные.

1. Монитор производительности сети получает данные из компьютеров под управлением Windows Server 2008 с пакетом обновления 1 либо более поздней версии или Windows 7 с пакетом обновления 1 либо более поздней версии. Эти требования применяются и к Microsoft Monitoring Agent. Агенты NPM могут работать в классических и клиентских операционных системах (Windows 10, Windows 8.1, Windows 8 и Windows 7).
    >[!NOTE]
    >Агенты для серверных операционных систем Windows поддерживают TCP и ICMP в качестве протоколов для синтетических транзакций. Но агенты для клиентских операционных систем Windows поддерживают в качестве протокола для синтетических транзакций только ICMP.

2. Добавьте решение "Монитор производительности сети" из [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.NetworkMonitoringOMS?tab=Overview) в рабочую область, как описано в статье [Добавление решений для управления Azure Log Analytics в рабочую область](log-analytics-add-solutions.md).  
   ![Символ монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-symbol.png)
3. На портале OMS отобразится новая плитка под названием **Монитор производительности сети** с сообщением *Для решения требуется дополнительная настройка*. Вам понадобится настроить решение для добавления сетей на основе подсетей и узлов, обнаруженных агентами. Щелкните **Монитор производительности сети**, чтобы приступить к настройке сети по умолчанию.  
   ![Для решения требуется дополнительная настройка](./media/log-analytics-network-performance-monitor/npm-config.png)

### <a name="configure-the-solution-with-a-default-network"></a>Настройка решения с использованием сети по умолчанию
На странице конфигурации отобразится одна сеть с именем **По умолчанию**. Если вы еще не определили сеть, все автоматически обнаруженные подсети размещаются в сети "По умолчанию".

При создании сети добавьте в нее подсеть, и эта подсеть удалится из сети "По умолчанию". Если удалить сеть, все подсети автоматически возвратятся в сеть "По умолчанию".

Иными словами, сеть "По умолчанию" является контейнером для всех подсетей, которые не содержатся в какой-либо сети, определяемой пользователем. Сеть "По умолчанию" нельзя изменить или удалить. Она всегда остается в системе. Тем не менее вы можете создать любое количество сетей.

В большинстве случаев подсети в вашей организации будут расположены в нескольких сетях. Вам следует создать одну или несколько сетей, чтобы логически сгруппировать подсети.

### <a name="create-new-networks"></a>Создание сетей
Сеть в мониторе производительности сети — это контейнер для подсетей. Вы можете назвать ее любым именем и добавить в нее подсети. Например, можно создать сеть с именем *Здание 1*, а затем добавить в нее подсети, или сеть с именем *DMZ* и добавить в нее все общедоступные подсети, принадлежащие периметру сети.

#### <a name="to-create-a-new-network"></a>Создание сети
1. Щелкните **Добавить сеть** и введите имя и описание сети.
2. Выберите одну или несколько подсетей и щелкните **Добавить**.
3. Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить**.  
   ![Добавление сети](./media/log-analytics-network-performance-monitor/npm-add-network.png)

### <a name="wait-for-data-aggregation"></a>Ожидание агрегирования данных
Как только вы сохраните конфигурацию в первый раз, решение начнет собирать информацию о потерях пакетов и задержках сети между узлами, на которых установлены агенты. Этот процесс может занять некоторое время, иногда больше 30 минут. В этом состоянии на плитке монитора производительности сети на странице обзора будет отображаться сообщение с текстом *Выполняется агрегирование данных*.

![Выполняется агрегирование данных](./media/log-analytics-network-performance-monitor/npm-aggregation.png)

После передачи данных на плитке монитора производительности сети будут отображаться данные.

![Плитка монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-tile.png)

Щелкните плитку, чтобы просмотреть панель мониторинга монитора производительности сети.

![Панель мониторинга монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-dash01.png)

### <a name="edit-monitoring-settings-for-subnets"></a>Изменение параметров мониторинга для подсетей
Все подсети, в которых установлен хотя бы один агент, приведены на вкладке **Подсети** на странице конфигурации.

#### <a name="to-enable-or-disable-monitoring-for-particular-subnetworks"></a>Включение или отключение мониторинга для определенных подсетей
1. Установите или снимите флажок рядом с **идентификатором подсети** и установите или снимите флажок **Используйте для мониторинга** соответственно. Вы можете установить или снять флажки для нескольких подсетей. Если мониторинг подсетей отключен, они не отслеживаются, так как агенты останавливают проверку связи с другими агентами.
2. Выберите узлы, которые требуется отслеживать для определенной подсети, выбрав подсеть из списка и переместив необходимые узлы между списками, содержащими неотслеживаемые и отслеживаемые узлы.
   При желании в подсеть можно добавить пользовательское **описание**.
3. Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить**.  
   ![Изменение подсети](./media/log-analytics-network-performance-monitor/npm-edit-subnet.png)

### <a name="choose-nodes-to-monitor"></a>Выбор узлов для отслеживания
Все узлы, на которых установлен агент, перечислены на вкладке **Узлы**.

#### <a name="to-enable-or-disable-monitoring-for-nodes"></a>Включение или отключение мониторинга узлов
1. Установите флажки возле узлов, которые необходимо отслеживать, и снимите флажки возле тех узлов, мониторинг которых необходимо прекратить.
2. Установите или снимите флажок **Используйте для мониторинга** соответственно.
3. Щелкните **Сохранить**.  
   ![Включение мониторинга узла](./media/log-analytics-network-performance-monitor/npm-enable-node-monitor.png)

### <a name="set-monitoring-rules"></a>Установка правил мониторинга
Монитор производительности сети создает события работоспособности о подключении между парой узлов либо соединениями подсети или сети при достижении порогового значения. Система может определить эти пороговые значения автоматически. При желании можно настроить использование настраиваемых правил предупреждений.

Генерируемое системой *правило по умолчанию* создает событие работоспособности каждый раз, когда значения потери и задержки между любой парой сетевых соединений или соединений подсети превышают определенное системой пороговое значение. Вы можете отключить правило по умолчанию и создать настраиваемые правила мониторинга.

#### <a name="to-create-custom-monitoring-rules"></a>Создание настраиваемых правил мониторинга
1. На вкладке **Монитор** щелкните **Добавить правило** и введите имя и описание правила.
2. Выберите из списков пару сетевых соединений или соединений подсети для мониторинга.
3. Сначала выберите сеть, в которой содержатся необходимые первые подсети, в раскрывающемся списке сетей, а затем выберите нужные подсети в раскрывающемся списке подсетей.
   Выберите **Все подсети**, если необходимо отслеживать все подсети в сетевом соединении. Аналогичным образом выберите другие необходимые подсети. Щелкните **Добавить исключение**, чтобы исключить мониторинг для определенных соединений подсети из списка выбранных.
4. Для выполнения искусственных транзакций в NPM выберите один из протоколов: ICMP или TCP.
5. Если не нужно создавать события работоспособности для выбранных элементов, снимите флажок **Включить наблюдение за работоспособностью ссылок, охваченных этим правилом**.
6. Выберите условия мониторинга.
   Вы можете задать настраиваемые пороговые значения для создания событий работоспособности. Каждый раз, когда значение условия превышает выбранное пороговое значение для выбранной пары сетей или подсетей, создается событие работоспособности.
7. Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить**.  
   ![Создание настраиваемых правил мониторинга](./media/log-analytics-network-performance-monitor/npm-monitor-rule.png)

Сохранив правило мониторинга, вы можете интегрировать это правило с управлением оповещениями. Для этого щелкните **Создать предупреждение**. Правило оповещений автоматически создается с заполненными полями поискового запроса и других необходимых параметров. Используя правило оповещения, вы можете получать оповещения по электронной почте в дополнение к существующим оповещениям в NPM. Оповещения также могут активировать корректирующие действия для модулей runbook. Или их можно интегрировать с существующими решениями управления службами, использующими объекты webhook. Нажмите кнопку **Управлять оповещениями**, чтобы изменить параметры оповещений.

### <a name="choose-the-right-protocol-icmp-or-tcp"></a>Выбор правильного протокола — ICMP или TCP

Монитор производительности сети (NPM) использует искусственные транзакции для вычисления показателей производительности сети, таких как потеря пакетов и задержка связи. Чтобы лучше в этом разобраться, рассмотрим агент NPM, подключенный к одной конечной точке сетевого соединения. Этот агент NPM отправляет пробные пакеты во второй агент NPM, подключенный к другой конечной точке сети. Второй агент отвечает отправкой ответных пакетов. Этот процесс повторяется несколько раз. Измеряя количество ответов и время, затраченное на получение каждого ответа, первый агент NPM оценивает задержку связи и потерю пакетов.

Формат, размер и последовательность этих пакетов определяется протоколом, который выбирается при создании правил мониторинга. В зависимости от протокола пакетов промежуточные сетевые устройства (маршрутизаторы, коммутаторы и др.) могут по-разному обрабатывать эти пакеты. Поэтому от выбора протокола зависит точность результатов. От выбора протокола также зависит, потребуется ли после развертывания решения NPM выполнять какие-то действия вручную.

Для выполнения искусственных транзакций в NPM доступны два протокола — ICMP и TCP.
Если при создании правила искусственных транзакций выбрать протокол ICMP, то для расчета задержки в сети и потери пакетов агенты NPM будут использовать эхо-сообщения ICMP. В эхо-сообщениях ICMP используется такой же тип сообщений, как и в традиционной служебной программе проверки связи. Если выбрать протокол TCP, то агенты NPM будут отправлять по сети пакет TCP SYN. После этого выполняется подтверждение TCP, а затем подключение удаляется с помощью пакетов RST.

#### <a name="points-to-consider-before-choosing-the-protocol"></a>Что необходимо учитывать при выборе протокола
Прежде чем выбрать протокол, ознакомьтесь с приведенными ниже сведениями.

##### <a name="discovering-multiple-network-routes"></a>Обнаружение нескольких сетевых маршрутов
При обнаружении нескольких маршрутов протокол TCP обеспечивает более точные результаты. А также ему требуется меньше агентов в каждой подсети. Например, один или два агента, использующие протокол TCP, могут обнаруживать все избыточные пути между подсетями. При этом для достижения подобных результатов с помощью протокола ICMP необходимо несколько агентов. При использовании протокола ICMP, если у вас *N* маршрутов между двумя подсетями, то вам необходимо иметь не менее 5*N* агентов в исходной или целевой подсети.

##### <a name="accuracy-of-results"></a>Точность результатов
Как правило, маршрутизаторы и коммутаторы назначают эхо-пакетам ICMP более низкий приоритет по сравнению с пакетами TCP. В определенных ситуациях при высокой загрузке сетевых устройств данные, полученные по протоколу TCP, более точно отражают фактические показатели потери и задержки в приложениях. Это связано с тем, что большая часть трафика приложений проходит по протоколу TCP. В таких случаях ICMP обеспечивает менее точные результаты, чем TCP.

##### <a name="firewall-configuration"></a>Настройка брандмауэра
Для протокола TCP требуется, чтобы пакеты TCP отправлялись на конечный порт. По умолчанию агенты NPM используют порт 8084, однако его можно изменить при настройке агентов. Таким образом, необходимо убедиться, что сетевые брандмауэры или правила групп безопасности сети (в Azure) разрешают трафик через этот порт. Также необходимо убедиться, что в настройках локального брандмауэра на компьютерах, где установлены агенты, разрешен трафик через этот порт.

Правила брандмауэра на компьютерах под управлением Windows можно настроить с помощью сценариев PowerShell, а сетевой брандмауэр настраивается вручную.

ICMP функционирует иначе. Этот протокол не использует порт. В большинстве корпоративных сценариев ICMP-трафик через брандмауэры разрешается, чтобы была возможность использовать диагностические инструменты, такие как служебная программа проверки связи. Таким образом, если вам удалось выполнить проверку связи между двумя компьютерами, то вы можете использовать протокол ICMP, не настраивая брандмауэры вручную.

> [!NOTE]
> Если вы не уверены, какой протокол лучше использовать, выберите сначала ICMP. Если результаты вас не удовлетворят, то вы всегда сможете сменить протокол на TCP.


#### <a name="how-to-switch-the-protocol"></a>Как сменить протокол

Если во время развертывания вы выбрали протокол ICMP, то для его смены на TCP можно в любое время изменить правило мониторинга по умолчанию.

##### <a name="to-edit-the-default-monitoring-rule"></a>Чтобы изменить правило мониторинга по умолчанию, выполните следующие действия:
1.  Последовательно выберите **Network Performance** (Производительность сети)  > **Monitor** (Мониторинг)  > **Configure** (Настройка)  > **Monitor** (Мониторинг), а затем щелкните **Default rule** (Правило по умолчанию).
2.  Прокрутите страницу до раздела **Protocol** (Протокол) и выберите протокол, который хотите использовать.
3.  Чтобы применить настройку, нажмите кнопку **Save** (Сохранить).

Даже если в правиле по умолчанию используется определенный протокол, вы можете создавать другие правила с другим протоколом. Можно даже создать набор правил, в котором одна часть правил будет использовать протокол ICMP, и другая часть — TCP.




## <a name="data-collection-details"></a>Сведения о сборе данных
Монитор производительности сети использует пакет подтверждения TCP SYN-SYNACK при выборе TCP и ICMP ECHO ICMP ECHO REPLY при выборе ICMP в качестве протокола для сбора сведений о потере и задержке. Для получения сведений о топологии также используется трассировка маршрута.

В следующей таблице приведены методы сбора данных и другие сведения о сборе данных для монитора производительности сети.

| платформа | Direct Agent | Агент SCOM | Хранилище Azure | Нужен ли SCOM? | Отправка данных агента SCOM через группу управления | частота сбора |
| --- | --- | --- | --- | --- | --- | --- |
| Windows | &#8226; | &#8226; |  |  |  |Подтверждения TCP/сообщения ICMP ECHO отправляются каждые 5 секунд. Данные отправляются каждые 3 минуты. |

Решение использует искусственные транзакции для оценки работоспособности сети. Агенты OMS, установленные в различных точках сети, обмениваются между собой пакетами TCP или ICMP Echo (в зависимости от выбранного для мониторинга протокола). В процессе агенты узнают время приема-передачи и обнаруживают потерю пакетов, если она есть. Периодически каждый агент выполняет трассировку маршрута к другим агентам, чтобы найти все маршруты в сети, которые необходимо протестировать. Используя эти данные, агенты могут снизить показатели задержки сети и потери пакетов. Тесты повторяются каждые пять секунд, и агенты собирают данные в течение трех минут перед их отправкой в службу Log Analytics.

> [!NOTE]
> Несмотря на то что агенты часто обмениваются данными друг с другом, они не создают большой объем сетевого трафика во время проведения тестов. Чтобы определить потери и задержки, агенты полагаются только на пакеты подтверждения TCP SYN-SYNACK-ACK. Обмен пакетами данных не происходит. Во время этого процесса агенты взаимодействуют друг с другом только при необходимости, а топология обмена данными между агентами оптимизирована для снижения сетевого трафика.
>
>

## <a name="using-the-solution"></a>Использование решения
В этом разделе описываются функции панели мониторинга и способы их использования.

### <a name="solution-overview-tile"></a>Плитка обзора решения
После включения монитора производительности сети на плитке решения на странице обзора OMS появляется краткий обзор работоспособности сети. На ней отображается кольцевая диаграмма, отображающая число работоспособных и неработоспособных соединений подсети. Если щелкнуть плитку, откроется панель мониторинга решения.

![Плитка монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-tile.png)

### <a name="network-performance-monitor-solution-dashboard"></a>Панель мониторинга решения монитора производительности сети
В колонке **Сводка о сети** приведены сведения о сетях и об их размерах. Далее отображаются плитки, показывающие общее число сетевых соединений и соединений подсети, а также путей в системе (путь состоит из IP-адресов двух узлов с агентами и всех прыжков между ними).

В колонке **Наиболее частые события работоспособности сети** представлен список последних событий работоспособности и предупреждений в системе, а также время, когда событие стало активным. Событие работоспособности или предупреждение создается, когда значение потери пакетов или задержки сетевого соединения или соединения подсети превышает пороговое значение.

В колонке **Главные неработоспособные сетевые соединения** отображается список неработоспособных сетевых соединений. Это сетевые соединения с одним или несколькими событиями работоспособности, неблагоприятными для них в данный момент.

В колонках **Top Subnetwork Links with Most Loss** (Главные соединения подсетей с наибольшим показателем потери) и **Соединения подсети с наибольшей задержкой** приведены главные соединения подсетей с наибольшим показателем потери пакетов и главные соединения подсетей с задержкой соответственно. В некоторых сетевых соединениях можно ожидать высокие показатели задержки или значительные потери пакетов. Такие соединения отображаются в первых десяти позициях списка, но не помечаются как неработоспособные.

В колонке **Общие запросы** содержится набор запросов поиска, выполнив которые можно напрямую получить необработанные данные о мониторинге сети. Эти запросы можно использовать как отправную точку для создания собственных запросов для настраиваемых отчетов.

![Панель мониторинга монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-dash01.png)

### <a name="drill-down-for-depth"></a>Углубленное изучение
Вы можете щелкнуть различные ссылки на панели мониторинга решения, чтобы узнать больше о любой интересующей вас области. Например, когда на панели мониторинга отображается предупреждение или неработоспособное сетевое соединение, его можно щелкнуть для дальнейшего изучения. Вы будете перенаправлены на страницу, на которой приведены все соединения подсети, относящиеся к конкретному сетевому соединению. Там вы сможете увидеть показатели потери, задержки и работоспособности каждого соединения подсети и быстро узнать, какие соединения подсети являются причиной проблемы. Вы также можете щелкнуть **Просмотреть ссылки на узлы**, чтобы просмотреть все соединения узлов, связанные с неработоспособным соединением подсети. Затем можно просмотреть отдельные соединения между узлами и найти неработоспособные соединения узлов.

Выберите **Просмотреть топологию**, чтобы просмотреть топологию по прыжкам маршрута между исходным узлом и узлом назначения. Неработоспособные маршруты или прыжки отображаются красным цветом, что дает возможность быстро обнаружить проблемы в определенной части сети.

![Детализация данных](./media/log-analytics-network-performance-monitor/npm-drill.png)

### <a name="network-state-recorder"></a>Запись состояния сети

Каждое представление отображает моментальный снимок работоспособности сети в определенный момент времени. По умолчанию отображается последнее состояние. На панели в верхней части страницы отображается точка времени, для которой отображается состояние. Вы можете вернуться назад во времени и просмотреть моментальный снимок работоспособности сети, щелкнув панель **Действия**. Также во время просмотра актуального состояния можно включить или отключить автоматическое обновление для любой страницы.

![состояние сети](./media/log-analytics-network-performance-monitor/network-state.png)

#### <a name="trend-charts"></a>Диаграммы трендов
На каждом уровне детализации можно увидеть тенденцию потери и задержки сетевого соединения. Диаграммы трендов также доступны для соединений подсети и соединений узлов. Вы можете изменить интервал времени, отображаемый на диаграмме, с помощью элемента управления временем в верхней части диаграммы.

На диаграммах трендов отображается историческая справка о производительности сетевого соединения. Некоторые проблемы с сетью временные и их трудно обнаружить только на основе текущего состояния сети. Это объясняется тем, что проблемы могут быстро появиться и исчезнуть, прежде чем их кто-либо заметит. Они появятся вновь чуть позднее. Такие временные проблемы также создают сложности для администраторов приложений, так как они часто проявляются в виде необъяснимых увеличений времени отклика приложения, даже если все компоненты приложения работают стабильно.

Вы можете легко обнаружить проблемы такого рода, просмотрев диаграмму тренда, где проблема будет отображаться в виде внезапного пика задержки сети или потери пакетов.

![Диаграмма трендов](./media/log-analytics-network-performance-monitor/npm-trend.png)

#### <a name="hop-by-hop-topology-map"></a>Схема топологии по прыжкам
Монитор производительности сети отображает топологию по прыжкам маршрутов между двумя узлами на интерактивной карте топологии. Карту топологии можно просмотреть, выделив соединение узла и выбрав команду **Просмотреть топологию**. Кроме того, карту топологии можно просмотреть, щелкнув плитку **Пути** на панели мониторинга. После выбора **этой плитки** на панели мониторинга необходимо выбрать исходный узел и узел назначения на панели слева и щелкнуть **Построить**, чтобы построить маршруты между двумя узлами.

На карте топологии отображается количество маршрутов между двумя узлами и пути, по которым передаются пакеты данных. На этой карте узкие места производительности сети помечаются красным цветом. Чтобы найти неисправное сетевое подключение или неисправное сетевое устройство, нужно просмотреть элементы, помеченные красным цветом на карте топологии.

Если щелкнуть узел или навести на него указатель мыши на карте топологии, отобразятся его свойства, например полное доменное имя и IP-адрес. Нажмите кнопку прыжка, чтобы увидеть IP-адрес. Вы можете фильтровать определенные маршруты с помощью фильтров на свертываемой панели действий. Вы также можете упрощать топологии сети, скрывая промежуточные прыжки с помощью ползунка на панели действий. Масштаб карты топологии можно увеличить или уменьшить с помощью колесика мыши.

Обратите внимание, что топология, показанная на карте, — это топология уровня 3, которая не содержит устройства и подключения уровня 2.

![Схема топологии по прыжкам](./media/log-analytics-network-performance-monitor/npm-topology.png)

#### <a name="fault-localization"></a>Локализация неисправностей
Монитор производительности сети может выполнять поиск узких мест сети без подключения к сетевым устройствам. Используя данные, которые он собирает из сети, и применяя усовершенствованные алгоритмы на диаграмме сети, монитор производительности сети выполняет вероятностную оценку частей сети, которые, скорее всего, являются источником проблемы.

Этот подход полезен при выявлении узких мест сети, когда доступ к прыжкам недоступен, так как при в этом случае не требуется собирать какие-либо данные из сетевых устройств, например маршрутизаторов и коммутаторов. Он также полезен, когда у вас нет прав администрирования в отношении прыжков между двумя узлами. Например, прыжки могут быть маршрутизаторами поставщика услуг Интернета.

### <a name="log-analytics-search"></a>Поиск в Log Analytics
Все данные, графически представленные на панели мониторинга монитора производительности сети и страницах детализации, также доступны непосредственно через поиск в Log Analytics. Вы можете запрашивать данные с помощью языка поисковых запросов и создавать пользовательские отчеты путем экспорта данных в Excel или PowerBI. В колонке **Общие запросы** на панели мониторинга содержатся некоторые полезные запросы, которые можно использовать в качестве отправной точки для создания собственных запросов и отчетов.

![Поисковые запросы](./media/log-analytics-network-performance-monitor/npm-queries.png)

## <a name="investigate-the-root-cause-of-a-health-alert"></a>Выявление основной причины появления оповещения о работоспособности
Теперь, когда вы прочитали о мониторе производительности сети, давайте рассмотрим, как легко выявить причину возникновения события работоспособности.

1. Чтобы быстро получить представление о работоспособности сети, наблюдайте за плиткой **Монитор производительности сети** на странице обзора. Обратите внимание, что из 6 отслеживаемых соединений подсетей 2 являются неработоспособными. Это гарантирует выявление. Щелкните плитку, чтобы просмотреть панель мониторинга решения.  
   ![Плитка монитора производительности сети](./media/log-analytics-network-performance-monitor/npm-investigation01.png)
2. В приведенном ниже примере можно увидеть событие работоспособности в сетевом соединении, которое находится в неработоспособном состоянии. Чтобы определить причину проблемы, выберите сетевое соединение **DMZ2-DMZ1**.  
   ![Пример неработоспособного сетевого соединения](./media/log-analytics-network-performance-monitor/npm-investigation02.png)
3. На странице детализации отобразятся все соединения подсети в сетевом соединении **DMZ2-DMZ1**. Вы увидите, что для обоих соединений подсети значение задержки превысило пороговое значение. Это и является причиной неработоспособности сетевого соединения. Кроме того, можно увидеть тенденции задержки обоих соединений подсети. На диаграмме можно использовать элемент управления для выбора времени, чтобы сосредоточиться на необходимом диапазоне времени. Вы узнаете период, когда значение задержки достигло пика. Позже можно найти сведения для этого периода времени в журналах, чтобы определить причину проблемы. Щелкните **Просмотреть ссылки на узлы** для дополнительной детализации.  
   ![Пример неработоспособных соединений подсети](./media/log-analytics-network-performance-monitor/npm-investigation03.png)
4. Как и на предыдущей странице, на странице детализации для определенного соединения подсети представлены, связанные с ней соединения узлов. Здесь можно выполнить те же действия, которые описаны на предыдущем шаге. Щелкните **Просмотреть топологию**, чтобы просмотреть топологию между двумя узлами.  
   ![Пример неработоспособных соединений узлов](./media/log-analytics-network-performance-monitor/npm-investigation04.png)
5. Все пути между двумя выбранными узлами отображаются на карте топологии. Топологию маршрутов можно визуализировать по прыжкам между двумя узлами на карте топологии. Это обеспечивает четкое представление о количестве маршрутов между двумя узлами и путях, по которым передаются пакеты данных. Узкие места производительности сети помечаются красным цветом. Чтобы найти неисправное сетевое подключение или неисправное сетевое устройство, нужно просмотреть элементы, помеченные красным цветом на карте топологии.  
   ![Пример представления неработоспособной топологии](./media/log-analytics-network-performance-monitor/npm-investigation05.png)
6. Значения потери, задержки и количество прыжков в каждом пути можно просмотреть в области **Действие**. Используйте полосу прокрутки, чтобы просмотреть сведения об этих неработоспособных путях.  Используйте фильтры для выбора путей с неработоспособными прыжками, чтобы отобразить топологию только выбранных путей. С помощью колесика мыши можно увеличить или уменьшить масштаб карты топологии.

   Если посмотреть на пути и прыжки, выделенные красным цветом на изображении ниже, станет понятна основная причина проблем для определенной части сети. Щелкнув узел на карте топологии, можно увидеть его свойства, включая полное доменное имя и IP-адрес. Если щелкнуть прыжок, отобразится IP-адрес прыжка.  
   ![Неработоспособная топология — пример сведений о пути](./media/log-analytics-network-performance-monitor/npm-investigation06.png)

## <a name="provide-feedback"></a>Отзывы

- **UserVoice.** Если вы хотите, чтобы мы разработали новые функции для монитора производительности сети, здесь вы можете публиковать свои идеи. Посетите нашу [страницу UserVoice](https://feedback.azure.com/forums/267889-log-analytics/category/188146-network-monitoring).
- **Присоединяйтесь к когорте наших клиентов.** Мы всегда заинтересованы в новых клиентах. Став одним из них, вы получите доступ к новым функциям и поможете нам улучшить монитор производительности сети. Если вы хотите присоединиться к нам, пройдите этот [быстрый опрос](https://aka.ms/npmcohort).

## <a name="next-steps"></a>Дальнейшие действия
* [Выполните поиск по журналам](log-analytics-log-searches.md), чтобы просмотреть подробные записи данных о производительности сети.
