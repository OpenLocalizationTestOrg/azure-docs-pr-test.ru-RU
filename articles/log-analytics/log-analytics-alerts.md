---
title: "Общие сведения об оповещениях в Azure Log Analytics | Документация Майкрософт"
description: "Оповещения в Log Analytics идентифицируют важную информацию в репозитории OMS и могут заранее уведомлять вас о возникших проблемах или выполнять действия в попытке устранить их.  В этой статье описываются различные типы правил генерации оповещений и их определение."
services: log-analytics
documentationcenter: 
author: bwren
manager: carmonm
editor: tysonn
ms.assetid: 6cfd2a46-b6a2-4f79-a67b-08ce488f9a91
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/05/2018
ms.author: bwren
ms.openlocfilehash: 07e8312d5e113eeb9016dcc832b1cf66f8001c5f
ms.sourcegitcommit: 719dd33d18cc25c719572cd67e4e6bce29b1d6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2018
---
# <a name="understanding-alerts-in-log-analytics"></a>Общие сведения об оповещениях в Log Analytics

Оповещения в Log Analytics содержат важную информацию о вашем репозитории Log Analytics.  В этой статье рассматриваются некоторые ключевые аспекты проекта, необходимо сделать на основе интервала сбора данных, запрашиваемых, случайные задержки с приема данных, может быть обусловлена задержки в сети или производительности обработки и отправку данных в журнал Аналитики репозитории.  Также предоставляет сведения о правилах как предупреждения в работе службы анализа журналов и описываются различия между различными типами правил оповещения.

Сведения о создании правил генерации оповещений см. по следующим ссылкам:

- создание правил генерации оповещений на [портале Azure](log-analytics-alerts-creating.md);
- создание правил генерации оповещений с помощью [шаблона Resource Manager](../operations-management-suite/operations-management-suite-solutions-resources-searches-alerts.md);
- создание правил генерации оповещений с помощью [REST API](log-analytics-api-alerts.md).

## <a name="considerations"></a>Рекомендации

Сведений о частоте сбора данных для различных решений и тип данных доступны в [сведения о сборе данных](log-analytics-add-solutions.md#data-collection-details) статьи Обзор решения. Как уже отмечалось в данной статье, частоту сбора может быть как редкие как каждые семь дней в *уведомление о*. Важно понять и учесть частоту сбора данных перед настройкой оповещение. 

- Частота сбора определяет, как часто агент OMS на машинах будет отправлять данные в службе анализа журналов. Для экземпляра Если частоту сбора — 10 минут, и существует в системе нет другие задержки, отметки времени передаваемых данных может находиться в любом от 0 до 10 минут перед добавлением в репозиторий и для поиска в службе анализа журналов.

- Прежде, чем может запускаться оповещение, данные должны записываться в репозиторий, чтобы она доступна при запросе. Из-за задержки, описанных выше частоту сбора не совпадает с временем становятся доступными для запросов. К примеру пока точно каждые 10 мин может сбор данных, данные можно найти в хранилище данных через нерегулярные интервалы времени. Виртуально могут быть доступны для поиска на 25, 28 до 35 минут соответственно или других нестандартных интервалом влияет задержка приема данных, собранных интервалы равно нулю, 10 и 20 минут. Описано в худшем случае эти задержки [соглашения об уровне ОБСЛУЖИВАНИЯ для службы анализа журналов](https://azure.microsoft.com/support/legal/sla/log-analytics/v1_1), не включает задержки, представленные коллекции частоту или сетевой задержки между компьютером и служба аналитики журнала.


## <a name="alert-rules"></a>правила оповещений.

Оповещения создаются с помощью правил оповещения, которые автоматически выполняют поиск по журналам через регулярные интервалы.  Если результаты поиска по журналам соответствуют определенным условиям, создается запись оповещения.  После этого правило может автоматически запустить одно или несколько действий, чтобы заблаговременно уведомить вас об оповещении либо вызвать другой процесс.  В каждом типе правил генерации оповещений используется определенная логика выполнения этого анализа.

![Оповещения Log Analytics](media/log-analytics-alerts/overview.png)

Поскольку предполагаемого времени задержки с помощью приема данных журнала, абсолютное время между индексации данных и когда будет доступен для поиска могут быть непредсказуемыми.  Доступность около реального времени собираемых данных следует учитывать при определении правил генерации оповещений.    

Не существует компромисс между надежность предупреждений и оповещений скорость реагирования. Вы можете настроить параметры оповещений, чтобы свести к минимуму false предупреждений и оповещений отсутствует, или можно выбрать параметры оповещений быстро реагировать на условия, которые отслеживаются, но иногда будет создавать оповещения, false или пропущенных.

Правила генерации оповещений определяются следующими сведениями:

- **Поиск по журналам**.  Это запрос, который будет запускаться каждый раз при срабатывании правила генерации оповещений.  С помощью записей, возвращаемых этим запросом, можно определить, нужно ли создавать оповещение.
- **Временное окно**.  Указывает диапазон времени для запроса.  Запрос возвращает только те записи, которые были созданы в течение этого периода, предшествующего настоящему времени.  Это может быть любое значение от 5 минут до 24 часов. Диапазон должен быть достаточно широкой, чтобы вместить разумного задержек в приема. Временное окно должно быть два раза длину самой длинной задержки, который вы хотите иметь возможность обрабатывать.<br> Для экземпляра Если оповещения на надежность задержки 30 минут, диапазон должен быть один час.  

    Существует две проблемы, может наблюдаться, если временной диапазон слишком мал.

    - **Отсутствует предупреждения**. Предполагается приема задержка составляет 60 минут иногда, но в большинстве случаев это пятнадцать минут.  Если интервал времени равно 30 минут затем Пропуск предупреждения, если задержка составляет 60 минут, так как данные не будут доступны для поиска при выполнении запроса предупреждения. 
   
        >[!NOTE]
        >При попытке установить причину предупреждения опускается невозможна. Например в приведенном выше случае данные записываются в репозиторий 60 минут после предупреждения запрос был выполнен. Если предупреждение было пропущено, что следующий день запрос выполняется за интервал, правильное время, он будет замечено достаточно следующего дня, условия поиска журнала будет соответствовать результат. Может показаться, что предупреждение должно запускаться. На самом деле оповещение не вызвано, поскольку данные еще не обладал при выполнении запроса предупреждения. 
        >
 
    - **Значение false, предупреждения**. Запросы иногда оповещений предназначены для идентификации отсутствие событий. Одним из примеров обнаружение, когда виртуальная машина находится в автономном состоянии, выполняя поиск пропущенных периодических сигналов. Выше, если пульса не доступен для поиска в окне предупреждения времени затем предупреждение будет создаваться, так как данные пульса еще не был доступным для поиска, а поэтому отсутствует. Это тот же результат, как если бы виртуальной Машины было законно в автономном режиме и не было пульса данных созданные им. Выполнение запроса на следующий день поверх окна правильное время покажет, что было Периодические сигналы и предупреждения не удалось. На самом деле тактовые импульсы не были еще доступным для поиска так как предупреждения временное окно было задано слишком мал.  

- **Частота**.  Указывает, как часто следует запускать запрос и может использоваться для ускорения оповещения в обычном случае. Значение может находиться в диапазоне от 5 минут до 24 часов и должно быть равно или меньше, чем предупреждения временного окна.  Если значение больше, чем временное окно, появляется риск пропуска записей.<br>Если целью является на надежность для задерживается до 30 минут и обычная задержка составляет 10 минут, интервал времени должен быть один час и это значение должно быть 10 минут. Это приведет к запуску оповещения с данными, 10 минут приема задержки от 10 до 20 минут для создания данных предупреждений.<br>Чтобы избежать создания нескольких оповещений для тех же данных из-за слишком большой интервал времени [подавить предупреждения](log-analytics-tutorial-response.md#create-alerts) параметр может использоваться для подавления предупреждений для по крайней мере в течение периода.
  
- **Пороговое значение**.  Чтобы определить, следует ли создавать оповещение, оцениваются результаты поиска по журналам.  Для каждого типа правил генерации оповещений определяется собственное пороговое значение.

Каждое правило генерации оповещений в Log Analytics относится к одному из двух типов.  Каждый из этих типов подробно описан в последующих разделах.

- **[Число результатов](#number-of-results-alert-rules)**. Если число записей, возвращенных в результатах поиска по журналам, превышает указанное количество, создается оповещение.
- **[Измерение метрик](#metric-measurement-alert-rules)**.  Оповещение, созданное для каждого объекта в результатах поиска по журналам со значением, превышающим указанное пороговое значение.

Ниже приведены различия между типами правил генерации оповещений.

- Правило генерации оповещений **Число результатов** всегда создает одно оповещение, а **Измерение метрик** — по одному для каждого объекта, для которого превышено пороговое значение.
- Правило генерации оповещений **Число результатов** создает оповещение при одноразовом превышении порогового значения. Правило генерации оповещений **Измерение метрик** может создавать оповещение при превышении порогового значения определенное количество раз за указанный интервал времени.

## <a name="number-of-results-alert-rules"></a>Правило генерации оповещений "Число результатов"
Правила генерации оповещений **Число результатов** создают одно оповещение, если количество записей, возвращенных в результатах поискового запроса, превышает указанное пороговое значение.

### <a name="threshold"></a>Threshold (Пороговое значение)
Под пороговым значением правила генерации оповещений **Число результатов** подразумевается значение, большее или меньшее чем определенное значение.  Если число записей, возвращенных в результатах поиска по журналам, соответствует этому критерию, создается оповещение.

### <a name="scenarios"></a>Сценарии

#### <a name="events"></a>События
Этот тип правила генерации оповещений идеально подходит для работы с такими событиями, как журналы событий Windows, системный журнал и настраиваемые журналы.  Вам может потребоваться создать оповещение, когда создается конкретное событие ошибки или при создании нескольких событий ошибки в определенном временном окне.

Для оповещения об одном событии задайте количество результатов больше 0, а частоту и временное окно установите равными 5 минутам.  При этом запрос выполняется каждые 5 минут и проверяет наличие одного события, созданного с момента последнего выполнения запроса.  Уменьшение частоты может привести к увеличению интервала между сбором данных о событии и созданием оповещения.

Некоторые приложения могут вносить в журнал нерегулярную ошибку, которая не обязательно должна вызывать оповещение.  Например, приложение может повторно запустить процесс, который создал событие ошибки и затем успешно завершил работу при следующем выполнении.  В этом случае вам может потребоваться создавать оповещение только в случае возникновения нескольких событий за определенное временное окно.  

В некоторых случаях может потребоваться создать оповещение в случае отсутствия события.  Например, процесс может регистрировать регулярные события, чтобы указать, что он работает правильно.  Если он не регистрирует одно из таких событий в пределах определенного временного окна, следует создать оповещение.  В этом случае задайте пороговое значение **Меньше 1**.

#### <a name="performance-alerts"></a>Оповещения производительности
[Данные о производительности](log-analytics-data-sources-performance-counters.md) хранятся в виде записей в репозитории OMS по аналогии с событиями.  Если вы хотите создать оповещение, когда значение счетчика производительности превышает определенный порог, это пороговое значение следует включить в запрос.

Например, если бы вам было нужно получать оповещения, когда процессор нагружен более чем на 90 %, то вы могли бы использовать запрос с пороговым значением для правила генерации оповещений **Больше 0**. Пример такого запроса приведен ниже.

    Type=Perf ObjectName=Processor CounterName="% Processor Time" CounterValue>90

Если бы вам было нужно получать оповещения, когда средняя нагрузка процессора превышает 90 % в определенном временном окне, то вы могли бы использовать запрос с [командой measure](log-analytics-search-reference.md#commands) и пороговым значением для правила генерации оповещений **Больше 0**. Ниже приведен пример такого запроса.

    Type=Perf ObjectName=Processor CounterName="% Processor Time" | measure avg(CounterValue) by Computer | where AggregatedValue>90

>[!NOTE]
> Если для рабочей области обновлен [язык запросов Log Analytics](log-analytics-log-search-upgrade.md), указанные выше запросы будут изменены следующим образом: `Perf | where ObjectName=="Processor" and CounterName=="% Processor Time" and CounterValue>90`
> `Perf | where ObjectName=="Processor" and CounterName=="% Processor Time" | summarize avg(CounterValue) by Computer | where CounterValue>90`.


## <a name="metric-measurement-alert-rules"></a>Metric measurement alert rules (Измерение метрики для правила генерации оповещений)

>[!NOTE]
> Сейчас правила генерации оповещений "Измерение метрик" находятся на этапе общедоступной предварительной версии.

Правила генерации оповещений **Измерение метрик** создают оповещение для каждого объекта в запросе со значением, превышающим указанное пороговое значение.  Ниже приведены их четко выраженные отличия от правил генерации оповещений **Число результатов**.

#### <a name="log-search"></a>Поиск по журналам
Правило генерации оповещений **Число результатов** поддерживает все типы запросов, но в отношении запросов для правила "Измерение метрик" применяются определенные требования.  Например, этот запрос должен содержать [команду measure](log-analytics-search-reference.md#commands), которая позволяет сгруппировать результаты по определенному полю. Эта команда должна содержать следующие элементы.

- **Агрегатная функция**.  Указывает выполняемые вычисления и (необязательно) числовое поле для статистических вычислений.  Например, **count()** возвращает число записей в запросе, а **avg(CounterValue)** — среднее значение поля CounterValue в течение указанного интервала.
- **Группировка по полю**.  Для каждого экземпляра этого поля будет создана запись с агрегированным значением, и для каждого из них можно создать оповещение.  Например, если вы хотите создать оповещение для каждого компьютера, используйте группировку **по компьютерам**.   
- **Интервал**.  Определяет интервал времени, в течение которого выполняется статистическое вычисление данных.  Например, если вы указали **5 минут**, приведет к созданию записи для каждого экземпляра поля группы суммарный каждые 5 минут за период, указанный для предупреждения.

#### <a name="threshold"></a>Threshold (Пороговое значение)
Пороговое значение для правил генерации оповещений "Измерение метрик" определяется на основе статического значения и числа нарушений.  Если любая точка данных в результатах поиска по журналам превышает это значение, она рассматривается как нарушение.  Когда число нарушений в результатах для любого объекта превышает указанное значение, для этого объекта создается оповещение.

#### <a name="example"></a>Пример
Рассмотрим ситуацию, где оповещение должно создаваться, когда использование процессора на компьютере превышает 90 % три раза в течение 30 минут.  Вы должны создать правило генерации оповещений с приведенными ниже сведениями.  

**Запрос:** Type=Perf ObjectName=Processor CounterName="% Processor Time" | measure avg(CounterValue) by Computer Interval 5minute.<br>
**Интервал времени:** 30 минут<br>
**Частота предупреждений:** 5 минут<br>
**Статистические значения:** больше 90<br>
**На основе триггера предупреждение:** всего нарушений больше 5<br>

Запрос вернет среднее значение для каждого компьютера с интервалом в 5 минут.  Этот запрос выполняется каждые 5 минут для данных, собранных в течение предыдущих 30 минут.  Ниже приведен пример данных для трех компьютеров.

![Результаты выполнения примера запроса](media/log-analytics-alerts/metrics-measurement-sample-graph.png)

В этом примере отдельные оповещения создаются для компьютеров srv02 и srv03, так как за указанное временное окно они 3 раза превысили пороговое значение в 90 %.  Если значение параметра **Активировать оповещение на основе:** изменить на **Consecutive** (Последовательные нарушения), тогда оповещение будет создано только для компьютера srv03, так как он превысил пороговое значение 3 раза подряд.

## <a name="alert-records"></a>Записи оповещений
Записи оповещений, созданные правилами генерации оповещений в Log Analytics, имеют значение **Alert** для **Type** и значение **OMS** для **SourceSystem**.  У них есть свойства, приведенные в таблице ниже.

| Свойство | ОПИСАНИЕ |
|:--- |:--- |
| type |*Предупреждение* |
| SourceSystem |*OMS* |
| *Объект*  | Оповещения [Измерение метрик](#metric-measurement-alert-rules) будут содержать свойство поля группировки.  Например, если результаты поиска по журналам группируются по компьютерам, запись оповещения будет содержать поле Computer с именем компьютера в качестве значения.
| AlertName |Имя оповещения. |
| AlertSeverity |Серьезность оповещения. |
| LinkToSearchResults |Ссылки на поиск журналов Log Analytics, возвращающая записи из запроса, создавшего оповещение. |
| Запрос |Текст запроса, который был запущен. |
| QueryExecutionEndTime |Конец диапазона времени для запроса. |
| QueryExecutionStartTime |Начало диапазона времени для запроса. |
| ThresholdOperator | Оператор, используемый правилом оповещения. |
| ThresholdValue | Значение, используемое правилом оповещения. |
| TimeGenerated |Дата и время создания оповещения. |

Существуют и другие виды записей оповещений, создаваемые [решением для управления оповещениями](log-analytics-solution-alert-management.md) и [экспортами Power BI](log-analytics-powerbi.md).  Все они имеют значение **Alert** для **Type**, но различаются по **SourceSystem**.


## <a name="next-steps"></a>Дальнейшие действия
* Установите [решение для управления оповещениями](log-analytics-solution-alert-management.md), чтобы анализировать предупреждения, создаваемые в Log Analytics, вместе с оповещениями, полученными от System Center Operations Manager.
* Вы можете ознакомиться с дополнительными сведениями о [поисках журналов](log-analytics-log-searches.md) , которые могут создавать оповещения.
* Вы можете выполнить пошаговое руководство по [настройке webook](log-analytics-alerts-webhooks.md) с использованием правила генерации оповещений.  
* Вы можете научиться писать [модули Runbook в службе автоматизации Azure](https://azure.microsoft.com/documentation/services/automation) для устранения проблем, обозначенных в оповещениях.
