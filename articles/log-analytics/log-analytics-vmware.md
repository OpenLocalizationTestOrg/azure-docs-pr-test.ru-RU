---
title: "Решение для мониторинга VMware в Log Analytics | Документация Майкрософт"
description: "Узнайте о том, как решение для мониторинга VMware помогает управлять журналами событий и отслеживать узлы ESXi."
services: log-analytics
documentationcenter: 
author: bandersmsft
manager: carmonm
editor: 
ms.assetid: 16516639-cc1e-465c-a22f-022f3be297f1
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: banders
ms.openlocfilehash: 17072c4b6e4fdf6e4dc2b7a6a4ded7fa9f9f6fde
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="vmware-monitoring-preview-solution-in-log-analytics"></a><span data-ttu-id="d3e75-103">Решение для мониторинга VMware (предварительная версия) в Log Analytics | Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="d3e75-103">VMware Monitoring (Preview) solution in Log Analytics</span></span>

![Символ VMware](./media/log-analytics-vmware/vmware-symbol.png)

<span data-ttu-id="d3e75-105">Решение для мониторинга VMware в Log Analytics помогает управлять централизованным ведением больших журналов VMware, а также отслеживать их.</span><span class="sxs-lookup"><span data-stu-id="d3e75-105">The VMware Monitoring solution in Log Analytics is a solution that helps you create a centralized logging and monitoring approach for large VMware logs.</span></span> <span data-ttu-id="d3e75-106">В статье описано, как с помощью этого решения централизованно устранять неполадки, связанные с узлами ESXi, а также регистрировать их и управлять ими.</span><span class="sxs-lookup"><span data-stu-id="d3e75-106">This article describes how you can troubleshoot, capture, and manage the ESXi hosts in a single location using the solution.</span></span> <span data-ttu-id="d3e75-107">В решении можно увидеть подробные данные для всех узлов ESXi в одном расположении.</span><span class="sxs-lookup"><span data-stu-id="d3e75-107">With the solution, you can see detailed data for all your ESXi hosts in a single location.</span></span> <span data-ttu-id="d3e75-108">В журналах узла ESXi вы можете просматривать счетчики основных событий, а также состояния и тенденции ВМ и узлов ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-108">You can see top event counts, status, and trends of VM and ESXi hosts provided through the ESXi host logs.</span></span> <span data-ttu-id="d3e75-109">Вы также можете устранять неполадки, просматривая централизованные журналы узлов ESXi и выполняя поиск в них.</span><span class="sxs-lookup"><span data-stu-id="d3e75-109">You can troubleshoot by viewing and searching centralized ESXi host logs.</span></span> <span data-ttu-id="d3e75-110">И наоборот, можно создавать оповещения на основе поисковых запросов по журналам.</span><span class="sxs-lookup"><span data-stu-id="d3e75-110">And, you can create alerts based on log search queries.</span></span>

<span data-ttu-id="d3e75-111">В решении для отправки данных на целевую виртуальную машину, где установлен агент OMS, используются встроенные функции системного журнала узла ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-111">The solution uses native syslog functionality of the ESXi host to push data to a target VM, which has OMS Agent.</span></span> <span data-ttu-id="d3e75-112">Однако решение не предусматривает запись файлов в системный журнал целевой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="d3e75-112">However, the solution doesn't write files into syslog within the target VM.</span></span> <span data-ttu-id="d3e75-113">Агент OMS открывает порт 1514 и прослушивает его.</span><span class="sxs-lookup"><span data-stu-id="d3e75-113">The OMS agent opens port 1514 and listens to this.</span></span> <span data-ttu-id="d3e75-114">При получении данных он отправляет данные в OMS.</span><span class="sxs-lookup"><span data-stu-id="d3e75-114">Once it receives the data, the OMS agent pushes the data into OMS.</span></span>

## <a name="installing-and-configuring-the-solution"></a><span data-ttu-id="d3e75-115">Установка и настройка решения</span><span class="sxs-lookup"><span data-stu-id="d3e75-115">Installing and configuring the solution</span></span>
<span data-ttu-id="d3e75-116">Для установки и настройки решений используйте указанные ниже данные.</span><span class="sxs-lookup"><span data-stu-id="d3e75-116">Use the following information to install and configure the solution.</span></span>

* <span data-ttu-id="d3e75-117">Включите решение для мониторинга VMware в рабочую область OMS, как описано в статье [Добавление решений Log Analytics из коллекции решений](log-analytics-add-solutions.md).</span><span class="sxs-lookup"><span data-stu-id="d3e75-117">Add the VMware Monitoring solution to your OMS workspace using the process described in [Add Log Analytics solutions from the Solutions Gallery](log-analytics-add-solutions.md).</span></span>

#### <a name="supported-vmware-esxi-hosts"></a><span data-ttu-id="d3e75-118">Поддерживаемые узлы VMware ESXi</span><span class="sxs-lookup"><span data-stu-id="d3e75-118">Supported VMware ESXi hosts</span></span>
<span data-ttu-id="d3e75-119">vSphere ESXi Host версий 5.5 и 6.0.</span><span class="sxs-lookup"><span data-stu-id="d3e75-119">vSphere ESXi Host 5.5 and 6.0</span></span>

#### <a name="prepare-a-linux-server"></a><span data-ttu-id="d3e75-120">Подготовка сервера под управлением Linux</span><span class="sxs-lookup"><span data-stu-id="d3e75-120">Prepare a Linux server</span></span>
<span data-ttu-id="d3e75-121">Создайте ВМ с ОС Linux, чтобы получать все данные системных журналов от узлов ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-121">Create a Linux operating system VM to receive all syslog data from the ESXi hosts.</span></span> <span data-ttu-id="d3e75-122">[Агент OMS для Linux ](log-analytics-linux-agents.md) — это точка сбора всех данных системных журналов узлов ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-122">The [OMS Linux Agent](log-analytics-linux-agents.md) is the collection point for all ESXi host syslog data.</span></span> <span data-ttu-id="d3e75-123">Можно использовать несколько узлов ESXi для пересылки журналов на отдельный сервер под управлением Linux, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="d3e75-123">You can use multiple ESXi hosts to forward logs to a single Linux server, as in the following example.</span></span>  

   ![Поток данных системных журналов](./media/log-analytics-vmware/diagram.png)

### <a name="configure-syslog-collection"></a><span data-ttu-id="d3e75-125">Настройка сбора системных журналов</span><span class="sxs-lookup"><span data-stu-id="d3e75-125">Configure syslog collection</span></span>
1. <span data-ttu-id="d3e75-126">Настройте пересылку системных журналов для VSphere.</span><span class="sxs-lookup"><span data-stu-id="d3e75-126">Set up syslog forwarding for VSphere.</span></span> <span data-ttu-id="d3e75-127">Подробные сведения о настройке пересылки системных журналов см. [здесь](https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2003322).</span><span class="sxs-lookup"><span data-stu-id="d3e75-127">For detailed information to help set up syslog forwarding, see [Configuring syslog on ESXi 5.x and 6.0 (2003322)](https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2003322).</span></span> <span data-ttu-id="d3e75-128">Последовательно выберите **ESXi Host Configuration** > **Software** > **Advanced Settings** > **Syslog** (Конфигурация узла ESXi > Программное обеспечение > Дополнительные параметры > Системный журнал).</span><span class="sxs-lookup"><span data-stu-id="d3e75-128">Go to **ESXi Host Configuration** > **Software** > **Advanced Settings** > **Syslog**.</span></span>
   <span data-ttu-id="d3e75-129">![vsphereconfig](./media/log-analytics-vmware/vsphere1.png)</span><span class="sxs-lookup"><span data-stu-id="d3e75-129">![vsphereconfig](./media/log-analytics-vmware/vsphere1.png)</span></span>  
2. <span data-ttu-id="d3e75-130">В поле *Syslog.global.logHost* укажите сервер Linux и номер порта *1514*.</span><span class="sxs-lookup"><span data-stu-id="d3e75-130">In the *Syslog.global.logHost* field, add your Linux server and the port number *1514*.</span></span> <span data-ttu-id="d3e75-131">Например, `tcp://hostname:1514` или `tcp://123.456.789.101:1514`.</span><span class="sxs-lookup"><span data-stu-id="d3e75-131">For example, `tcp://hostname:1514` or `tcp://123.456.789.101:1514`</span></span>
3. <span data-ttu-id="d3e75-132">Откройте брандмауэр узла ESXi для системного журнала.</span><span class="sxs-lookup"><span data-stu-id="d3e75-132">Open the ESXi host firewall for syslog.</span></span> <span data-ttu-id="d3e75-133">Последовательно выберите **ESXi Host Configuration** > **Software** > **Security Profile** > **Firewall** и **Properties** (Конфигурация узла ESXi > Программное обеспечение > Профиль безопасности > Брандмауэр > Свойства).</span><span class="sxs-lookup"><span data-stu-id="d3e75-133">**ESXi Host Configuration** > **Software** > **Security Profile** > **Firewall** and open **Properties**.</span></span>  

    ![vspherefw](./media/log-analytics-vmware/vsphere2.png)  

    ![vspherefwproperties](./media/log-analytics-vmware/vsphere3.png)  
4. <span data-ttu-id="d3e75-136">Проверьте консоль vSphere, чтобы удостовериться в правильной настройке системного журнала.</span><span class="sxs-lookup"><span data-stu-id="d3e75-136">Check the vSphere Console to verify that that syslog is properly set up.</span></span> <span data-ttu-id="d3e75-137">Подтвердите на узле ESXI, что этот порт **1514** настроен.</span><span class="sxs-lookup"><span data-stu-id="d3e75-137">Confirm on the ESXI host that port **1514** is configured.</span></span>
5. <span data-ttu-id="d3e75-138">Скачайте и установите агент OMS для Linux на сервере Linux.</span><span class="sxs-lookup"><span data-stu-id="d3e75-138">Download and install the OMS Agent for Linux on the Linux server.</span></span> <span data-ttu-id="d3e75-139">Дополнительные сведения см. в [документации по агенту OMS для Linux](https://github.com/Microsoft/OMS-Agent-for-Linux).</span><span class="sxs-lookup"><span data-stu-id="d3e75-139">For more information, see the [Documentation for OMS Agent for Linux](https://github.com/Microsoft/OMS-Agent-for-Linux).</span></span>
6. <span data-ttu-id="d3e75-140">Установив агента OMS для Linux, перейдите в каталог /etc/opt/microsoft/omsagent/sysconf/omsagent.d и скопируйте файл vmware_esxi.conf в каталог /etc/opt/microsoft/omsagent/conf/omsagent.d. Измените владельца или группу и разрешения для файла.</span><span class="sxs-lookup"><span data-stu-id="d3e75-140">After the OMS Agent for Linux is installed, go to the  /etc/opt/microsoft/omsagent/sysconf/omsagent.d directory and copy the vmware_esxi.conf file to the /etc/opt/microsoft/omsagent/conf/omsagent.d directory and the change the owner/group and permissions of the file.</span></span> <span data-ttu-id="d3e75-141">Например:</span><span class="sxs-lookup"><span data-stu-id="d3e75-141">For example:</span></span>

    ```
    sudo cp /etc/opt/microsoft/omsagent/sysconf/omsagent.d/vmware_esxi.conf /etc/opt/microsoft/omsagent/conf/omsagent.d
   sudo chown omsagent:omiusers /etc/opt/microsoft/omsagent/conf/omsagent.d/vmware_esxi.conf
    ```
7. <span data-ttu-id="d3e75-142">Перезапустите агент OMS для Linux, выполнив `sudo /opt/microsoft/omsagent/bin/service_control restart`.</span><span class="sxs-lookup"><span data-stu-id="d3e75-142">Restart the OMS Agent for Linux by running `sudo /opt/microsoft/omsagent/bin/service_control restart`.</span></span>
8. <span data-ttu-id="d3e75-143">Проверьте подключение между сервером Linux и узлом ESXi, выполнив команду `nc` на узле ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-143">Test the connectivity between the Linux server and the ESXi host by using the `nc` command on the ESXi Host.</span></span> <span data-ttu-id="d3e75-144">Например:</span><span class="sxs-lookup"><span data-stu-id="d3e75-144">For example:</span></span>

    ```
    [root@ESXiHost:~] nc -z 123.456.789.101 1514
    Connection to 123.456.789.101 1514 port [tcp/*] succeeded!
    ```

9. <span data-ttu-id="d3e75-145">На портале OMS выполните следующий поиск по журналу: `Type=VMware_CL`.</span><span class="sxs-lookup"><span data-stu-id="d3e75-145">In the OMS Portal, perform a log search for `Type=VMware_CL`.</span></span> <span data-ttu-id="d3e75-146">Собирая данные системного журнала, OMS сохраняет формат syslog.</span><span class="sxs-lookup"><span data-stu-id="d3e75-146">When OMS collects the syslog data, it retains the syslog format.</span></span> <span data-ttu-id="d3e75-147">На портале регистрируются некоторые поля, включая *Hostname* и *ProcessName*.</span><span class="sxs-lookup"><span data-stu-id="d3e75-147">In the portal, some specific fields are captured, such as *Hostname* and *ProcessName*.</span></span>  

    ![type](./media/log-analytics-vmware/type.png)  

    <span data-ttu-id="d3e75-149">Если представление с результатами поиска по журналу похоже на изображенное выше, это значит, что панель мониторинга для соответствующего решения OMS VMware настроена.</span><span class="sxs-lookup"><span data-stu-id="d3e75-149">If your view log search results are similar to the image above, you're set to use the OMS VMware Monitoring solution dashboard.</span></span>  

## <a name="vmware-data-collection-details"></a><span data-ttu-id="d3e75-150">Сведения о сборе данных VMware</span><span class="sxs-lookup"><span data-stu-id="d3e75-150">VMware data collection details</span></span>
<span data-ttu-id="d3e75-151">Решения для мониторинга VMware собирает разные метрики производительности и данные журналов на узлах ESXi с помощью включенных агентов OMS для Linux.</span><span class="sxs-lookup"><span data-stu-id="d3e75-151">The VMware Monitoring solution collects various performance metrics and log data from ESXi hosts using the OMS Agents for Linux that you have enabled.</span></span>

<span data-ttu-id="d3e75-152">В следующей таблице содержатся методы сбора данных и другие связанные сведения.</span><span class="sxs-lookup"><span data-stu-id="d3e75-152">The following table shows data collection methods and other details about how data is collected.</span></span>

| <span data-ttu-id="d3e75-153">платформа</span><span class="sxs-lookup"><span data-stu-id="d3e75-153">platform</span></span> | <span data-ttu-id="d3e75-154">Агент OMS для Linux</span><span class="sxs-lookup"><span data-stu-id="d3e75-154">OMS Agent for Linux</span></span> | <span data-ttu-id="d3e75-155">Агент SCOM</span><span class="sxs-lookup"><span data-stu-id="d3e75-155">SCOM agent</span></span> | <span data-ttu-id="d3e75-156">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="d3e75-156">Azure Storage</span></span> | <span data-ttu-id="d3e75-157">Нужен ли SCOM?</span><span class="sxs-lookup"><span data-stu-id="d3e75-157">SCOM required?</span></span> | <span data-ttu-id="d3e75-158">Отправка данных агента SCOM через группу управления</span><span class="sxs-lookup"><span data-stu-id="d3e75-158">SCOM agent data sent via management group</span></span> | <span data-ttu-id="d3e75-159">частота сбора</span><span class="sxs-lookup"><span data-stu-id="d3e75-159">collection frequency</span></span> |
| --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="d3e75-160">Linux</span><span class="sxs-lookup"><span data-stu-id="d3e75-160">Linux</span></span> |<span data-ttu-id="d3e75-161">&#8226;</span><span class="sxs-lookup"><span data-stu-id="d3e75-161">&#8226;</span></span> |  |  |  |  |<span data-ttu-id="d3e75-162">Каждые 3 минуты</span><span class="sxs-lookup"><span data-stu-id="d3e75-162">every 3 minutes</span></span> |

<span data-ttu-id="d3e75-163">В следующей таблице приведены примеры типов данных, собираемых решением для мониторинга VMware.</span><span class="sxs-lookup"><span data-stu-id="d3e75-163">The following table show examples of data fields collected by the VMware Monitoring solution:</span></span>

| <span data-ttu-id="d3e75-164">Имя поля</span><span class="sxs-lookup"><span data-stu-id="d3e75-164">field name</span></span> | <span data-ttu-id="d3e75-165">Описание</span><span class="sxs-lookup"><span data-stu-id="d3e75-165">description</span></span> |
| --- | --- |
| <span data-ttu-id="d3e75-166">Device_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-166">Device_s</span></span> |<span data-ttu-id="d3e75-167">Запоминающие устройства VMware</span><span class="sxs-lookup"><span data-stu-id="d3e75-167">VMware storage devices</span></span> |
| <span data-ttu-id="d3e75-168">ESXIFailure_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-168">ESXIFailure_s</span></span> |<span data-ttu-id="d3e75-169">Типы сбоев</span><span class="sxs-lookup"><span data-stu-id="d3e75-169">failure types</span></span> |
| <span data-ttu-id="d3e75-170">EventTime_t</span><span class="sxs-lookup"><span data-stu-id="d3e75-170">EventTime_t</span></span> |<span data-ttu-id="d3e75-171">Время возникновения события</span><span class="sxs-lookup"><span data-stu-id="d3e75-171">time when event occurred</span></span> |
| <span data-ttu-id="d3e75-172">HostName_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-172">HostName_s</span></span> |<span data-ttu-id="d3e75-173">Имя узла ESXi</span><span class="sxs-lookup"><span data-stu-id="d3e75-173">ESXi host name</span></span> |
| <span data-ttu-id="d3e75-174">Operation_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-174">Operation_s</span></span> |<span data-ttu-id="d3e75-175">Создание или удаление ВМ</span><span class="sxs-lookup"><span data-stu-id="d3e75-175">create VM or delete VM</span></span> |
| <span data-ttu-id="d3e75-176">ProcessName_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-176">ProcessName_s</span></span> |<span data-ttu-id="d3e75-177">Имя события</span><span class="sxs-lookup"><span data-stu-id="d3e75-177">event name</span></span> |
| <span data-ttu-id="d3e75-178">ResourceId_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-178">ResourceId_s</span></span> |<span data-ttu-id="d3e75-179">Имя узла VMware</span><span class="sxs-lookup"><span data-stu-id="d3e75-179">name of the VMware host</span></span> |
| <span data-ttu-id="d3e75-180">ResourceLocation_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-180">ResourceLocation_s</span></span> |<span data-ttu-id="d3e75-181">VMware</span><span class="sxs-lookup"><span data-stu-id="d3e75-181">VMware</span></span> |
| <span data-ttu-id="d3e75-182">ResourceName_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-182">ResourceName_s</span></span> |<span data-ttu-id="d3e75-183">VMware</span><span class="sxs-lookup"><span data-stu-id="d3e75-183">VMware</span></span> |
| <span data-ttu-id="d3e75-184">ResourceType_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-184">ResourceType_s</span></span> |<span data-ttu-id="d3e75-185">Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="d3e75-185">Hyper-V</span></span> |
| <span data-ttu-id="d3e75-186">SCSIStatus_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-186">SCSIStatus_s</span></span> |<span data-ttu-id="d3e75-187">Состояние VMware SCSI</span><span class="sxs-lookup"><span data-stu-id="d3e75-187">VMware SCSI status</span></span> |
| <span data-ttu-id="d3e75-188">SyslogMessage_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-188">SyslogMessage_s</span></span> |<span data-ttu-id="d3e75-189">Данные системного журнала</span><span class="sxs-lookup"><span data-stu-id="d3e75-189">Syslog data</span></span> |
| <span data-ttu-id="d3e75-190">UserName_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-190">UserName_s</span></span> |<span data-ttu-id="d3e75-191">Пользователь, создавший или удаливший ВМ</span><span class="sxs-lookup"><span data-stu-id="d3e75-191">user who created or deleted VM</span></span> |
| <span data-ttu-id="d3e75-192">VMName_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-192">VMName_s</span></span> |<span data-ttu-id="d3e75-193">имя виртуальной машины;</span><span class="sxs-lookup"><span data-stu-id="d3e75-193">VM name</span></span> |
| <span data-ttu-id="d3e75-194">Компьютер</span><span class="sxs-lookup"><span data-stu-id="d3e75-194">Computer</span></span> |<span data-ttu-id="d3e75-195">Главный компьютер</span><span class="sxs-lookup"><span data-stu-id="d3e75-195">host computer</span></span> |
| <span data-ttu-id="d3e75-196">TimeGenerated</span><span class="sxs-lookup"><span data-stu-id="d3e75-196">TimeGenerated</span></span> |<span data-ttu-id="d3e75-197">Время создания данных</span><span class="sxs-lookup"><span data-stu-id="d3e75-197">time the data was generated</span></span> |
| <span data-ttu-id="d3e75-198">DataCenter_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-198">DataCenter_s</span></span> |<span data-ttu-id="d3e75-199">Центр обработки данных VMware</span><span class="sxs-lookup"><span data-stu-id="d3e75-199">VMware datacenter</span></span> |
| <span data-ttu-id="d3e75-200">StorageLatency_s</span><span class="sxs-lookup"><span data-stu-id="d3e75-200">StorageLatency_s</span></span> |<span data-ttu-id="d3e75-201">Задержка хранилища (мс)</span><span class="sxs-lookup"><span data-stu-id="d3e75-201">storage latency (ms)</span></span> |

## <a name="vmware-monitoring-solution-overview"></a><span data-ttu-id="d3e75-202">Обзор решения для мониторинга VMware</span><span class="sxs-lookup"><span data-stu-id="d3e75-202">VMware Monitoring solution overview</span></span>
<span data-ttu-id="d3e75-203">Плитка VMware отображается на портале OMS.</span><span class="sxs-lookup"><span data-stu-id="d3e75-203">The VMware tile appears in the OMS portal.</span></span> <span data-ttu-id="d3e75-204">Решение отображает обобщенное представление ошибок.</span><span class="sxs-lookup"><span data-stu-id="d3e75-204">It provides a high-level view of any failures.</span></span> <span data-ttu-id="d3e75-205">Щелкнув плитку, вы перейдете в представление панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="d3e75-205">When you click the tile, you go into a dashboard view.</span></span>

![Плитка](./media/log-analytics-vmware/tile.png)

#### <a name="navigate-the-dashboard-view"></a><span data-ttu-id="d3e75-207">Навигация в представлении панели мониторинга</span><span class="sxs-lookup"><span data-stu-id="d3e75-207">Navigate the dashboard view</span></span>
<span data-ttu-id="d3e75-208">В представлении панели мониторинга **VMware** колонки упорядочены по следующим категориям:</span><span class="sxs-lookup"><span data-stu-id="d3e75-208">In the **VMware** dashboard view, blades are organized by:</span></span>

* <span data-ttu-id="d3e75-209">число состояний сбоя;</span><span class="sxs-lookup"><span data-stu-id="d3e75-209">Failure Status Count</span></span>
* <span data-ttu-id="d3e75-210">основной узел по счетчикам событий;</span><span class="sxs-lookup"><span data-stu-id="d3e75-210">Top Host by Event Counts</span></span>
* <span data-ttu-id="d3e75-211">счетчики основных событий;</span><span class="sxs-lookup"><span data-stu-id="d3e75-211">Top Event Counts</span></span>
* <span data-ttu-id="d3e75-212">действия виртуальной машины;</span><span class="sxs-lookup"><span data-stu-id="d3e75-212">Virtual Machine Activities</span></span>
* <span data-ttu-id="d3e75-213">события диска узла ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-213">ESXi Host Disk Events</span></span>

![Решение 1](./media/log-analytics-vmware/solutionview1-1.png)

![Решение 2](./media/log-analytics-vmware/solutionview1-2.png)

<span data-ttu-id="d3e75-216">Щелкните любую колонку, чтобы открыть область поиска Log Analytics с соответствующими подробными сведениями.</span><span class="sxs-lookup"><span data-stu-id="d3e75-216">Click any blade to open Log Analytics search pane that shows detailed information specific for the blade.</span></span>

<span data-ttu-id="d3e75-217">Здесь можно изменить поисковый запрос в соответствии с определенной задачей.</span><span class="sxs-lookup"><span data-stu-id="d3e75-217">From here, you can edit the search query to modify it for something specific.</span></span> <span data-ttu-id="d3e75-218">Руководство по поиску по журналам OMS доступно [здесь](log-analytics-log-searches.md).</span><span class="sxs-lookup"><span data-stu-id="d3e75-218">For a tutorial on the basics of OMS search, check out the [OMS log search tutorial.](log-analytics-log-searches.md)</span></span>

#### <a name="find-esxi-host-events"></a><span data-ttu-id="d3e75-219">Поиск событий узлов ESXi</span><span class="sxs-lookup"><span data-stu-id="d3e75-219">Find ESXi host events</span></span>
<span data-ttu-id="d3e75-220">Для одного узла ESXi создается несколько журналов на основе выполняющихся процессов.</span><span class="sxs-lookup"><span data-stu-id="d3e75-220">A single ESXi host generates multiple logs, based on their processes.</span></span> <span data-ttu-id="d3e75-221">Решение для мониторинга VMware объединяет их, суммируя счетчики событий.</span><span class="sxs-lookup"><span data-stu-id="d3e75-221">The VMware Monitoring solution centralizes them and summarizes the event counts.</span></span> <span data-ttu-id="d3e75-222">Это централизованное представление помогает понять, на каком узле ESXi происходит больше всего событий и какие именно события происходят в вашей среде чаще всего.</span><span class="sxs-lookup"><span data-stu-id="d3e75-222">This centralized view helps you understand which ESXi host has a high volume of events and what events occur most frequently in your environment.</span></span>

![event](./media/log-analytics-vmware/events.png)

<span data-ttu-id="d3e75-224">Чтобы просмотреть дополнительные сведения, щелкните узел ESXi или тип события.</span><span class="sxs-lookup"><span data-stu-id="d3e75-224">You can drill further by clicking an ESXi host or an event type.</span></span>

<span data-ttu-id="d3e75-225">Щелкнув имя узла ESXi, вы сможете просмотреть сведения, связанные с этим узлом ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-225">When you click an ESXi host name, you view information from that ESXi host.</span></span> <span data-ttu-id="d3e75-226">Чтобы отфильтровать результаты по типу события, добавьте `“ProcessName_s=EVENT TYPE”` в поисковом запросе.</span><span class="sxs-lookup"><span data-stu-id="d3e75-226">If you want to narrow results with the event type, add `“ProcessName_s=EVENT TYPE”` in your search query.</span></span> <span data-ttu-id="d3e75-227">Можно выбрать **ProcessName** в фильтре поиска.</span><span class="sxs-lookup"><span data-stu-id="d3e75-227">You can select **ProcessName** in the search filter.</span></span> <span data-ttu-id="d3e75-228">Это поможет ограничить поиск.</span><span class="sxs-lookup"><span data-stu-id="d3e75-228">That narrows the information for you.</span></span>

![Детализация](./media/log-analytics-vmware/eventhostdrilldown.png)

#### <a name="find-high-vm-activities"></a><span data-ttu-id="d3e75-230">Поиск активных действий ВМ</span><span class="sxs-lookup"><span data-stu-id="d3e75-230">Find high VM activities</span></span>
<span data-ttu-id="d3e75-231">Виртуальные машины могут создаваться и удаляться на любом узле ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-231">A virtual machine can be created and deleted on any ESXi host.</span></span> <span data-ttu-id="d3e75-232">Администраторам часто требуется знать, сколько ВМ создается узлом ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-232">It's helpful for an administrator to identify how many VMs an ESXi host creates.</span></span> <span data-ttu-id="d3e75-233">Это помогает оценить производительность и рассчитать использование ресурсов.</span><span class="sxs-lookup"><span data-stu-id="d3e75-233">That in-turn, helps to understand performance and capacity planning.</span></span> <span data-ttu-id="d3e75-234">При управлении средой очень важно отслеживать события действий ВМ.</span><span class="sxs-lookup"><span data-stu-id="d3e75-234">Keeping track of VM activity events is crucial when managing your environment.</span></span>

![Детализация](./media/log-analytics-vmware/vmactivities1.png)

<span data-ttu-id="d3e75-236">Чтобы просмотреть дополнительные данные о создании ВМ узлом ESXi, щелкните имя узла ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-236">If you want to see additional ESXi host VM creation data, click an ESXi host name.</span></span>

![Детализация](./media/log-analytics-vmware/createvm.png)

#### <a name="common-search-queries"></a><span data-ttu-id="d3e75-238">Распространенные поисковые запросы</span><span class="sxs-lookup"><span data-stu-id="d3e75-238">Common search queries</span></span>
<span data-ttu-id="d3e75-239">Решение включает и другие полезные запросы, которые помогают управлять узлами ESXi узлов. Сюда входят запросы к данным о переполнении дискового пространства, задержках хранилища и сбоях пути.</span><span class="sxs-lookup"><span data-stu-id="d3e75-239">The solution includes other useful queries that can help you manage your ESXi hosts, such as high storage space, storage latency, and path failure.</span></span>

[!include[log-analytics-log-search-nextgeneration](../../includes/log-analytics-log-search-nextgeneration.md)]

![Запросы](./media/log-analytics-vmware/queries.png)


#### <a name="save-queries"></a><span data-ttu-id="d3e75-241">Сохранение запросов</span><span class="sxs-lookup"><span data-stu-id="d3e75-241">Save queries</span></span>
<span data-ttu-id="d3e75-242">Сохранение запросов поиска — это стандартная функция OMS, которая помогает сохранять запросы, которые оказались полезными для вас.</span><span class="sxs-lookup"><span data-stu-id="d3e75-242">Saving search queries is a standard feature in OMS and can help you keep any queries that you’ve found useful.</span></span> <span data-ttu-id="d3e75-243">Создав запрос, который вы считаете полезным, сохраните его, щелкнув **Избранное**.</span><span class="sxs-lookup"><span data-stu-id="d3e75-243">After you create a query that you find useful, save it by clicking the **Favorites**.</span></span> <span data-ttu-id="d3e75-244">Сохранение запроса позволяет без труда использовать его позже на странице [Моя панель мониторинга](log-analytics-dashboards.md), где вы можете создавать собственные настраиваемые панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="d3e75-244">A saved query lets you easily reuse it later from the [My Dashboard](log-analytics-dashboards.md) page where you can create your own custom dashboards.</span></span>

![DockerDashboardView](./media/log-analytics-vmware/dockerdashboardview.png)

#### <a name="create-alerts-from-queries"></a><span data-ttu-id="d3e75-246">Создание оповещений из запросов</span><span class="sxs-lookup"><span data-stu-id="d3e75-246">Create alerts from queries</span></span>
<span data-ttu-id="d3e75-247">Созданные запросы можно использовать для оповещения при возникновении определенных событий.</span><span class="sxs-lookup"><span data-stu-id="d3e75-247">After you’ve created your queries, you might want to use the queries to alert you when specific events occur.</span></span> <span data-ttu-id="d3e75-248">Подробные сведения о создании оповещений см. в статье [Оповещения в Log Analytics](log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="d3e75-248">See [Alerts in Log Analytics](log-analytics-alerts.md) for information about how to create alerts.</span></span> <span data-ttu-id="d3e75-249">Примеры оповещающих и других запросов см. в записи блога [Monitor VMware using OMS Log Analytics](https://blogs.technet.microsoft.com/msoms/2016/06/15/monitor-vmware-using-oms-log-analytics) (Мониторинг VMware с помощью OMS Log Analytics).</span><span class="sxs-lookup"><span data-stu-id="d3e75-249">For examples of alerting queries and other query examples, see the [Monitor VMware using OMS Log Analytics](https://blogs.technet.microsoft.com/msoms/2016/06/15/monitor-vmware-using-oms-log-analytics) blog post.</span></span>

## <a name="frequently-asked-questions"></a><span data-ttu-id="d3e75-250">Часто задаваемые вопросы</span><span class="sxs-lookup"><span data-stu-id="d3e75-250">Frequently asked questions</span></span>
### <a name="what-do-i-need-to-do-on-the-esxi-host-setting-what-impact-will-it-have-on-my-current-environment"></a><span data-ttu-id="d3e75-251">Что нужно настраивать для узла ESXi?</span><span class="sxs-lookup"><span data-stu-id="d3e75-251">What do I need to do on the ESXi host setting?</span></span> <span data-ttu-id="d3e75-252">Какое влияние это окажет на мою текущую среду?</span><span class="sxs-lookup"><span data-stu-id="d3e75-252">What impact will it have on my current environment?</span></span>
<span data-ttu-id="d3e75-253">В решении используется встроенный механизм перенаправления системного журнала узла ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-253">The solution uses the native ESXi Host Syslog forwarding mechanism.</span></span> <span data-ttu-id="d3e75-254">Для ведения журналов на узле ESXi не нужно устанавливать дополнительное программное обеспечение Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="d3e75-254">You don't need any additional Microsoft software on the ESXi Host to capture the logs.</span></span> <span data-ttu-id="d3e75-255">Существенное влияние на имеющуюся среду не оказывается.</span><span class="sxs-lookup"><span data-stu-id="d3e75-255">It should have a low impact to your existing environment.</span></span> <span data-ttu-id="d3e75-256">Тем не менее необходимо настроить перенаправление системного журнала, что является функцией ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-256">However, you do need to set syslog forwarding, which is ESXI functionality.</span></span>

### <a name="do-i-need-to-restart-my-esxi-host"></a><span data-ttu-id="d3e75-257">Нужно ли перезапускать узел ESXi?</span><span class="sxs-lookup"><span data-stu-id="d3e75-257">Do I need to restart my ESXi host?</span></span>
<span data-ttu-id="d3e75-258">Нет.</span><span class="sxs-lookup"><span data-stu-id="d3e75-258">No.</span></span> <span data-ttu-id="d3e75-259">Для этого процесса перезапуск не требуется.</span><span class="sxs-lookup"><span data-stu-id="d3e75-259">This process does not require a restart.</span></span> <span data-ttu-id="d3e75-260">В некоторых случаях vSphere не обновляет системный журнал надлежащим образом.</span><span class="sxs-lookup"><span data-stu-id="d3e75-260">Sometimes, vSphere does not properly update the syslog.</span></span> <span data-ttu-id="d3e75-261">В таком случае войдите на узел ESXi и перезагрузите системный журнал.</span><span class="sxs-lookup"><span data-stu-id="d3e75-261">In such a case, log on to the ESXi host and reload the syslog.</span></span> <span data-ttu-id="d3e75-262">Опять же, узел перезапускать не нужно, поэтому этот процесс не нарушает работу в среде.</span><span class="sxs-lookup"><span data-stu-id="d3e75-262">Again, you don't have to restart the host, so this process isn't disruptive to your environment.</span></span>

### <a name="can-i-increase-or-decrease-the-volume-of-log-data-sent-to-oms"></a><span data-ttu-id="d3e75-263">Можно ли увеличить или уменьшить объем данных журнала, отправляемых в OMS?</span><span class="sxs-lookup"><span data-stu-id="d3e75-263">Can I increase or decrease the volume of log data sent to OMS?</span></span>
<span data-ttu-id="d3e75-264">Да, можно.</span><span class="sxs-lookup"><span data-stu-id="d3e75-264">Yes you can.</span></span> <span data-ttu-id="d3e75-265">В vSphere можно использовать параметры уровня ведения журнала узла ESXi.</span><span class="sxs-lookup"><span data-stu-id="d3e75-265">You can use the ESXi Host Log Level settings in vSphere.</span></span> <span data-ttu-id="d3e75-266">Сбор данных журналов основан на уровне *info*.</span><span class="sxs-lookup"><span data-stu-id="d3e75-266">Log collection is based on the *info* level.</span></span> <span data-ttu-id="d3e75-267">Таким образом, если нужно выполнить аудит создания или удаления виртуальной машины, необходимо задать уровень *info* для Hostd.</span><span class="sxs-lookup"><span data-stu-id="d3e75-267">So, if you want to audit VM creation or deletion, you need to keep the *info* level on Hostd.</span></span> <span data-ttu-id="d3e75-268">Дополнительные сведения см. в [базе знаний VMware](https://kb.vmware.com/selfservice/microsites/search.do?&cmd=displayKC&externalId=1017658).</span><span class="sxs-lookup"><span data-stu-id="d3e75-268">For more information, see the [VMware Knowledge Base](https://kb.vmware.com/selfservice/microsites/search.do?&cmd=displayKC&externalId=1017658).</span></span>

### <a name="why-is-hostd-not-providing-data-to-oms-my-log-setting-is-set-to-info"></a><span data-ttu-id="d3e75-269">Почему Hostd не предоставляет данные в OMS?</span><span class="sxs-lookup"><span data-stu-id="d3e75-269">Why is Hostd not providing data to OMS?</span></span> <span data-ttu-id="d3e75-270">Для моего параметра журнала установлено значение info.</span><span class="sxs-lookup"><span data-stu-id="d3e75-270">My log setting is set to info.</span></span>
<span data-ttu-id="d3e75-271">Произошла ошибка узла ESXi, касающаяся метки времени системного журнала.</span><span class="sxs-lookup"><span data-stu-id="d3e75-271">There was an ESXi host bug for the syslog timestamp.</span></span> <span data-ttu-id="d3e75-272">Дополнительные сведения см. в [базе знаний VMware](https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2111202).</span><span class="sxs-lookup"><span data-stu-id="d3e75-272">For more information, see the [VMware Knowledge Base](https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2111202).</span></span> <span data-ttu-id="d3e75-273">После применения обходного решения Hostd должен работать нормально.</span><span class="sxs-lookup"><span data-stu-id="d3e75-273">After you apply the workaround, Hostd should function normally.</span></span>

### <a name="can-i-have-multiple-esxi-hosts-forwarding-syslog-data-to-a-single-vm-with-omsagent"></a><span data-ttu-id="d3e75-274">Можно ли иметь несколько узлов ESXi, которые пересылают данные системного журнала на одну виртуальную машину с агентом OMS?</span><span class="sxs-lookup"><span data-stu-id="d3e75-274">Can I have multiple ESXi hosts forwarding syslog data to a single VM with omsagent?</span></span>
<span data-ttu-id="d3e75-275">Да.</span><span class="sxs-lookup"><span data-stu-id="d3e75-275">Yes.</span></span> <span data-ttu-id="d3e75-276">Вы можете иметь несколько узлов ESXi, которые пересылают данные системного журнала в одну виртуальную машину с агентом OMS.</span><span class="sxs-lookup"><span data-stu-id="d3e75-276">You can have multiple ESXi hosts forwarding to a single VM with omsagent.</span></span>

### <a name="why-dont-i-see-data-flowing-into-oms"></a><span data-ttu-id="d3e75-277">Почему не отображается поступление данных в OMS?</span><span class="sxs-lookup"><span data-stu-id="d3e75-277">Why don't I see data flowing into OMS?</span></span>
<span data-ttu-id="d3e75-278">Это может быть вызвано несколькими причинами.</span><span class="sxs-lookup"><span data-stu-id="d3e75-278">There can be multiple reasons:</span></span>

* <span data-ttu-id="d3e75-279">Узел ESXi неправильно передает данные на виртуальную машину под управлением агента OMS.</span><span class="sxs-lookup"><span data-stu-id="d3e75-279">The ESXi host is not correctly pushing data to the VM running omsagent.</span></span> <span data-ttu-id="d3e75-280">Чтобы проверить это, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="d3e75-280">To test, perform the following steps:</span></span>

  1. <span data-ttu-id="d3e75-281">Войдите на узел ESXi с помощью SSH и выполните следующую команду: `nc -z ipaddressofVM 1514`</span><span class="sxs-lookup"><span data-stu-id="d3e75-281">To confirm, log on to the ESXi host using ssh and run the following command: `nc -z ipaddressofVM 1514`</span></span>

      <span data-ttu-id="d3e75-282">Если команда завершится ошибкой, скорее всего, параметры vSphere в расширенной конфигурации настроены неправильно.</span><span class="sxs-lookup"><span data-stu-id="d3e75-282">If this is not successful, vSphere settings in the Advanced Configuration are likely not correct.</span></span> <span data-ttu-id="d3e75-283">Сведения о том, как настроить узел ESXi для перенаправления системного журнала, см. в разделе [Настройка сбора системных журналов](#configure-syslog-collection).</span><span class="sxs-lookup"><span data-stu-id="d3e75-283">See [Configure syslog collection](#configure-syslog-collection) for information about how to set up the ESXi host for syslog forwarding.</span></span>
  2. <span data-ttu-id="d3e75-284">Если подключение к порту системного журнала выполнено успешно, но данные не отображаются, перезагрузите системный журнал на узле ESXi с помощью SSH и выполните следующую команду: ` esxcli system syslog reload`</span><span class="sxs-lookup"><span data-stu-id="d3e75-284">If syslog port connectivity is successful, but you don't still see any data, then reload the syslog on the ESXi host by using ssh to run the following command: ` esxcli system syslog reload`</span></span>
* <span data-ttu-id="d3e75-285">Виртуальная машина с агентом OMS настроена неправильно.</span><span class="sxs-lookup"><span data-stu-id="d3e75-285">The VM with OMS Agent is not set correctly.</span></span> <span data-ttu-id="d3e75-286">Чтобы проверить это, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="d3e75-286">To test this, perform the following steps:</span></span>

  1. <span data-ttu-id="d3e75-287">OMS прослушивает порт 1514 и передает данные в OMS.</span><span class="sxs-lookup"><span data-stu-id="d3e75-287">OMS listens to the port 1514 and pushes data into OMS.</span></span> <span data-ttu-id="d3e75-288">Чтобы проверить, что он открыт, выполните следующую команду: `netstat -a | grep 1514`</span><span class="sxs-lookup"><span data-stu-id="d3e75-288">To verify that it is open, run the following command: `netstat -a | grep 1514`</span></span>
  2. <span data-ttu-id="d3e75-289">Вы увидите, что порт `1514/tcp` открыт.</span><span class="sxs-lookup"><span data-stu-id="d3e75-289">You should see port `1514/tcp` open.</span></span> <span data-ttu-id="d3e75-290">В противном случае проверьте, правильно ли установлен агент OMS.</span><span class="sxs-lookup"><span data-stu-id="d3e75-290">If you do not, verify that the omsagent is installed correctly.</span></span> <span data-ttu-id="d3e75-291">Если сведения о порте не отображаются, порт системного журнала не открыт на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="d3e75-291">If you do not see the port information, then the syslog port is not open on the VM.</span></span>

     1. <span data-ttu-id="d3e75-292">Убедитесь, что агент OMS запущен, с помощью `ps -ef | grep oms`.</span><span class="sxs-lookup"><span data-stu-id="d3e75-292">Verify that the OMS Agent is running by using `ps -ef | grep oms`.</span></span> <span data-ttu-id="d3e75-293">Если это не так, запустите его, выполнив команду ` sudo /opt/microsoft/omsagent/bin/service_control start`</span><span class="sxs-lookup"><span data-stu-id="d3e75-293">If it is not running, start the process by running the command ` sudo /opt/microsoft/omsagent/bin/service_control start`</span></span>
     2. <span data-ttu-id="d3e75-294">Откройте файл `/etc/opt/microsoft/omsagent/conf/omsagent.d/vmware_esxi.conf` .</span><span class="sxs-lookup"><span data-stu-id="d3e75-294">Open the `/etc/opt/microsoft/omsagent/conf/omsagent.d/vmware_esxi.conf` file.</span></span>

         <span data-ttu-id="d3e75-295">Убедитесь, что настройки пользователей и группы допустимы. Они должны выглядеть следующим образом: `-rw-r--r-- 1 omsagent omiusers 677 Sep 20 16:46 vmware_esxi.conf`</span><span class="sxs-lookup"><span data-stu-id="d3e75-295">Verify that the proper user and group setting is valid, similar to: `-rw-r--r-- 1 omsagent omiusers 677 Sep 20 16:46 vmware_esxi.conf`</span></span>

         <span data-ttu-id="d3e75-296">Если файл не существует или настройки пользователя и группы неправильны, выполните действия по исправлению, приведенные в разделе [Подготовка сервера под управлением Linux](#prepare-a-linux-server).</span><span class="sxs-lookup"><span data-stu-id="d3e75-296">If the file does not exist or the user and group setting is wrong, take corrective action by [Preparing a Linux server](#prepare-a-linux-server).</span></span>

## <a name="next-steps"></a><span data-ttu-id="d3e75-297">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="d3e75-297">Next steps</span></span>
* <span data-ttu-id="d3e75-298">Используйте [поиск по журналам в Log Analytics](log-analytics-log-searches.md) для просмотра подробных данных об узле VMware.</span><span class="sxs-lookup"><span data-stu-id="d3e75-298">Use [Log Searches](log-analytics-log-searches.md) in Log Analytics to view detailed VMware host data.</span></span>
* <span data-ttu-id="d3e75-299">[Создавайте собственные панели мониторинга](log-analytics-dashboards.md), отображающие данные об узле VMware.</span><span class="sxs-lookup"><span data-stu-id="d3e75-299">[Create your own dashboards](log-analytics-dashboards.md) showing VMware host data.</span></span>
* <span data-ttu-id="d3e75-300">[Создавайте оповещения](log-analytics-alerts.md), информирующие о возникновении определенных событий узла VMware.</span><span class="sxs-lookup"><span data-stu-id="d3e75-300">[Create alerts](log-analytics-alerts.md) when specific VMware host events occur.</span></span>
