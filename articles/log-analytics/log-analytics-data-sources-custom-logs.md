---
title: "Сбор пользовательских журналов в OMS Log Analytics | Документация Майкрософт"
description: "Служба Log Analytics может собирать события из текстовых файлов на компьютерах Windows и Linux.  В этой статье описано, как определить новый настраиваемый журнал и сведения для записей, которые он создает в репозитории OMS."
services: log-analytics
documentationcenter: 
author: bwren
manager: jwhit
editor: tysonn
ms.assetid: aca7f6bb-6f53-4fd4-a45c-93f12ead4ae1
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/15/2017
ms.author: bwren
ms.openlocfilehash: b7f28868e3ffdf95dbe39872f382e7c97eae692c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="custom-logs-in-log-analytics"></a><span data-ttu-id="f3bbc-104">Настраиваемые журналы в службе Log Analytics</span><span class="sxs-lookup"><span data-stu-id="f3bbc-104">Custom logs in Log Analytics</span></span>
<span data-ttu-id="f3bbc-105">С помощью настраиваемых журналов, выступающих в качестве источников данных, в службе Log Analytics можно собирать события из текстовых файлов на компьютерах Windows и Linux.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-105">The Custom Logs data source in Log Analytics allows you to collect events from text files on both Windows and Linux computers.</span></span> <span data-ttu-id="f3bbc-106">Во многих приложениях вместо стандартной службы ведения журнала, например журнала событий Windows или системного журнала, данные журналов записываются в текстовые файлы.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-106">Many applications log information to text files instead of standard logging services such as Windows Event log or Syslog.</span></span>  <span data-ttu-id="f3bbc-107">Каждую собранную запись в журнале можно преобразовать в отдельные поля с помощью функции [Настраиваемые поля](log-analytics-custom-fields.md) службы Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-107">Once collected, you can parse each record in the log in to individual fields using the [Custom Fields](log-analytics-custom-fields.md) feature of Log Analytics.</span></span>

![Сбор данных из настраиваемых журналов](media/log-analytics-data-sources-custom-logs/overview.png)

<span data-ttu-id="f3bbc-109">Собираемые файлы журнала должны соответствовать следующим условиям:</span><span class="sxs-lookup"><span data-stu-id="f3bbc-109">The log files to be collected must match the following criteria.</span></span>

- <span data-ttu-id="f3bbc-110">В каждой строке журнала должна содержаться одна запись либо в начале каждой строки должна быть временная метка в одном из следующих форматов:</span><span class="sxs-lookup"><span data-stu-id="f3bbc-110">The log must either have a single entry per line or use a timestamp matching one of the following formats at the start of each entry.</span></span>

    <span data-ttu-id="f3bbc-111">ГГГГ-ММ-ДД ЧЧ:ММ:СС; </span><span class="sxs-lookup"><span data-stu-id="f3bbc-111">YYYY-MM-DD HH:MM:SS</span></span><br><span data-ttu-id="f3bbc-112">М/Д/ГГГГ ЧЧ:ММ:СС AM/PM (12-часовой формат);</span><span class="sxs-lookup"><span data-stu-id="f3bbc-112">M/D/YYYY HH:MM:SS AM/PM</span></span> <br><span data-ttu-id="f3bbc-113"> М ДД, ГГГГ ЧЧ:ММ:СС.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-113">Mon DD,YYYY HH:MM:SS</span></span>

- <span data-ttu-id="f3bbc-114">В части файла журнала, где будут добавляться новые записи, не должны выполняться циклические обновления.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-114">The log file must not allow circular updates where the file is overwritten with new entries.</span></span>
- <span data-ttu-id="f3bbc-115">В файле журнала должна использоваться кодировка ASCII или UTF-8.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-115">The log file must use ASCII or UTF-8 encoding.</span></span>  <span data-ttu-id="f3bbc-116">Другие форматы, например UTF-16, не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-116">Other formats such as UTF-16 are not supported.</span></span>

>[!NOTE]
><span data-ttu-id="f3bbc-117">Если в файле журнала имеются повторяющиеся записи, Log Analytics будет собирать их.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-117">If there are duplicate entries in the log file, Log Analytics will collect them.</span></span>  <span data-ttu-id="f3bbc-118">Тем не менее результаты поиска будет несогласованы, когда после применения фильтра будет показано больше событий, чем самих результатов.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-118">However, the search results will be inconsistent where the filter results show more events than the result count.</span></span>  <span data-ttu-id="f3bbc-119">Будет важно проверить журнал, чтобы определить, вызвано ли это поведение приложением, которое его создает, и устранить проблему, если это возможно, перед созданием определения сбора настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-119">It will be important that you validate the log to determine if the application that creates it is causing this behavior and address it if possible before creating the custom log collection definition.</span></span>  
>
  
## <a name="defining-a-custom-log"></a><span data-ttu-id="f3bbc-120">Определение настраиваемого журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-120">Defining a custom log</span></span>
<span data-ttu-id="f3bbc-121">Ниже описана процедура определения файла настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-121">Use the following procedure to define a custom log file.</span></span>  <span data-ttu-id="f3bbc-122">В конце этой статьи содержится пошаговое руководство по добавлению настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-122">Scroll to the end of this article for a walkthrough of a sample of adding a custom log.</span></span>

### <a name="step-1-open-the-custom-log-wizard"></a><span data-ttu-id="f3bbc-123">Шаг 1.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-123">Step 1.</span></span> <span data-ttu-id="f3bbc-124">Открытие мастера настраиваемого журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-124">Open the Custom Log Wizard</span></span>
<span data-ttu-id="f3bbc-125">Мастер настраиваемого журнала на портале OMS позволяет определить новый настраиваемый журнал для сбора данных.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-125">The Custom Log Wizard runs in the OMS portal and allows you to define a new custom log to collect.</span></span>

1. <span data-ttu-id="f3bbc-126">На портале OMS выберите **Параметры**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-126">In the OMS portal, go to **Settings**.</span></span>
2. <span data-ttu-id="f3bbc-127">Выберите вкладку **Данные**, а затем — раздел **Настраиваемые журналы**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-127">Click on **Data** and then **Custom logs**.</span></span>
3. <span data-ttu-id="f3bbc-128">По умолчанию все изменения конфигурации автоматически отправляются во все агенты.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-128">By default, all configuration changes are automatically pushed to all agents.</span></span>  <span data-ttu-id="f3bbc-129">Файл конфигурации агентов Linux отправляется в сборщик данных Fluentd.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-129">For Linux agents, a configuration file is sent to the Fluentd data collector.</span></span>  <span data-ttu-id="f3bbc-130">Если вы хотите изменить этот файл вручную в каждом агенте Linux, снимите флажок *Apply below configuration to my Linux machines*(Применить конфигурацию ниже к моим компьютерам Linux).</span><span class="sxs-lookup"><span data-stu-id="f3bbc-130">If you wish to modify this file manually on each Linux agent, then uncheck the box *Apply below configuration to my Linux machines*.</span></span>
4. <span data-ttu-id="f3bbc-131">Щелкните **Add+** (Добавить+), чтобы открыть мастер настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-131">Click **Add+** to open the Custom Log Wizard.</span></span>

### <a name="step-2-upload-and-parse-a-sample-log"></a><span data-ttu-id="f3bbc-132">Шаг 2.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-132">Step 2.</span></span> <span data-ttu-id="f3bbc-133">Загрузка и преобразование примера журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-133">Upload and parse a sample log</span></span>
<span data-ttu-id="f3bbc-134">Сначала необходимо загрузить пример настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-134">You start by uploading a sample of the custom log.</span></span>  <span data-ttu-id="f3bbc-135">Затем мастер выполнит преобразование и отобразит записи в этом файле, чтобы вы смогли их проверить.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-135">The wizard will parse and display the entries in this file for you to validate.</span></span>  <span data-ttu-id="f3bbc-136">Log Analytics будет использовать указанный вами разделитель для определения каждой записи.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-136">Log Analytics will use the delimiter that you specify to identify each record.</span></span>

<span data-ttu-id="f3bbc-137">**Новая строка** — тип разделителя по умолчанию, который используется для файлов журнала с одной записью в строке.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-137">**New Line** is the default delimiter and is used for log files that have a single entry per line.</span></span>  <span data-ttu-id="f3bbc-138">Если строка начинается с даты и времени в одном из доступных форматов, то можно указать тип разделителя **Метка времени** , который поддерживает записи, охватывающие несколько строк.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-138">If the line starts with a date and time in one of the available formats, then you can specify a **Timestamp** delimiter which supports entries that span more than one line.</span></span>

<span data-ttu-id="f3bbc-139">Если в качестве разделителя используется метка времени, свойство TimeGenerated каждой записи в OMS будет заполнено датой и временем, указанными для этой записи в файле журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-139">If a timestamp delimiter is used, then the TimeGenerated property of each record stored in OMS will be populated with the date/time specified for that entry in the log file.</span></span>  <span data-ttu-id="f3bbc-140">Если в качестве разделителя используется новая строка, свойство TimeGenerated заполняется датой и временем сбора этой записи в Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-140">If a new line delimiter is used, then TimeGenerated is populated with date and time that Log Analytics collected the entry.</span></span>

> [!NOTE]
> <span data-ttu-id="f3bbc-141">В настоящее время Log Analytics обрабатывает дату и время, собранные из журнала, используя в качестве разделителя метку времени в формате UTC.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-141">Log Analytics currently treats the date/time collected from a log using a timestamp delimiter as UTC.</span></span>  <span data-ttu-id="f3bbc-142">Вскоре в агенте для этого будет использоваться часовой пояс.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-142">This will soon be changed to use the time zone on the agent.</span></span>
>
>

1. <span data-ttu-id="f3bbc-143">Нажмите кнопку **Обзор** , чтобы перейти к примеру файла.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-143">Click **Browse** and browse to a sample file.</span></span>  <span data-ttu-id="f3bbc-144">Обратите внимание, что в некоторых браузерах эта кнопка может называться **Выбрать файл** .</span><span class="sxs-lookup"><span data-stu-id="f3bbc-144">Note that this may button may be labeled **Choose File** in some browsers.</span></span>
2. <span data-ttu-id="f3bbc-145">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-145">Click **Next**.</span></span>
3. <span data-ttu-id="f3bbc-146">Мастер настраиваемого журнала загрузит файл и выведет список определяемых записей.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-146">The Custom Log Wizard will upload the file and list the records that it identifies.</span></span>
4. <span data-ttu-id="f3bbc-147">Измените разделитель, который используется для определения новой записи, и выберите разделитель, который подходит для записей в файле журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-147">Change the delimiter that is used to identify a new record and select the delimiter that best identifies the records in your log file.</span></span>
5. <span data-ttu-id="f3bbc-148">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-148">Click **Next**.</span></span>

### <a name="step-3-add-log-collection-paths"></a><span data-ttu-id="f3bbc-149">Шаг 3.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-149">Step 3.</span></span> <span data-ttu-id="f3bbc-150">Добавление пути к файлам журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-150">Add log collection paths</span></span>
<span data-ttu-id="f3bbc-151">Для агента необходимо определить один или несколько путей, по которым будет расположен настраиваемый журнал.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-151">You must define one or more paths on the agent where it can locate the custom log.</span></span>  <span data-ttu-id="f3bbc-152">Вы можете указать конкретный путь и имя файла журнала или путь с подстановочным знаком вместо имени.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-152">You can either provide a specific path and name for the log file, or you can specify a path with a wildcard for the name.</span></span>  <span data-ttu-id="f3bbc-153">Это подходит для приложений, в которых каждый день создается новый файл, или когда один файл достигает определенного размера.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-153">This supports applications that create a new file each day or when one file reaches a certain size.</span></span>  <span data-ttu-id="f3bbc-154">Вы также можете указать несколько путей для одного файла журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-154">You can also provide multiple paths for a single log file.</span></span>

<span data-ttu-id="f3bbc-155">Например, приложение может каждый день создавать файл журнала, добавляя в имя дату, например log20100316.txt.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-155">For example, an application might create a log file each day with the date included in the name as in log20100316.txt.</span></span> <span data-ttu-id="f3bbc-156">Шаблоном для такого журнала может быть *log\*.txt*, который будет применяться к любому файлу журнала в соответствии со схемой именования приложения.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-156">A pattern for such a log might be *log\*.txt* which would apply to any log file following the application’s naming scheme.</span></span>

<span data-ttu-id="f3bbc-157">Ниже приведены примеры допустимых шаблонов для указания различных файлов журналов.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-157">The following table provides examples of valid patterns to specify different log files.</span></span>

| <span data-ttu-id="f3bbc-158">Описание</span><span class="sxs-lookup"><span data-stu-id="f3bbc-158">Description</span></span> | <span data-ttu-id="f3bbc-159">Путь</span><span class="sxs-lookup"><span data-stu-id="f3bbc-159">Path</span></span> |
|:--- |:--- |
| <span data-ttu-id="f3bbc-160">Все файлы агента Windows в папке *C:\Logs* с расширением .txt</span><span class="sxs-lookup"><span data-stu-id="f3bbc-160">All files in *C:\Logs* with .txt extension on Windows agent</span></span> |<span data-ttu-id="f3bbc-161">C:\Logs\\\*.txt</span><span class="sxs-lookup"><span data-stu-id="f3bbc-161">C:\Logs\\\*.txt</span></span> |
| <span data-ttu-id="f3bbc-162">Все файлы агента Windows в папке *C:\Logs* с расширением .txt и именем, начинающимся со слова log</span><span class="sxs-lookup"><span data-stu-id="f3bbc-162">All files in *C:\Logs* with a name starting with log and a .txt extension on Windows agent</span></span> |<span data-ttu-id="f3bbc-163">C:\Logs\log\*.txt</span><span class="sxs-lookup"><span data-stu-id="f3bbc-163">C:\Logs\log\*.txt</span></span> |
| <span data-ttu-id="f3bbc-164">Все файлы агента Linux в папке */var/log/audits* с расширением .txt</span><span class="sxs-lookup"><span data-stu-id="f3bbc-164">All files in */var/log/audit* with .txt extension on Linux agent</span></span> |<span data-ttu-id="f3bbc-165">/var/log/audit/*.txt</span><span class="sxs-lookup"><span data-stu-id="f3bbc-165">/var/log/audit/*.txt</span></span> |
| <span data-ttu-id="f3bbc-166">Все файлы агента Linux в папке */var/log/audit* с расширением .txt и именем, начинающимся со слова log</span><span class="sxs-lookup"><span data-stu-id="f3bbc-166">All files in */var/log/audit* with a name starting with log and a .txt extension on Linux agent</span></span> |<span data-ttu-id="f3bbc-167">/var/log/Audit/log\*.txt</span><span class="sxs-lookup"><span data-stu-id="f3bbc-167">/var/log/audit/log\*.txt</span></span> |

1. <span data-ttu-id="f3bbc-168">Выберите Windows или Linux, чтобы указать, какой формат пути добавляется.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-168">Select Windows or Linux to specify which path format you are adding.</span></span>
2. <span data-ttu-id="f3bbc-169">Введите путь и нажмите кнопку **+** .</span><span class="sxs-lookup"><span data-stu-id="f3bbc-169">Type in the path and click the **+** button.</span></span>
3. <span data-ttu-id="f3bbc-170">Повторите эту процедуру для всех других путей.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-170">Repeat the process for any additional paths.</span></span>

### <a name="step-4-provide-a-name-and-description-for-the-log"></a><span data-ttu-id="f3bbc-171">Шаг 4.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-171">Step 4.</span></span> <span data-ttu-id="f3bbc-172">Указание имени и описания журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-172">Provide a name and description for the log</span></span>
<span data-ttu-id="f3bbc-173">Указываемое вами имя будет использоваться для типа журнала, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-173">The name that you specify will be used for the log type as described above.</span></span>  <span data-ttu-id="f3bbc-174">Это имя всегда будет заканчиваться на _CL, чтобы обозначить, что это настраиваемый журнал.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-174">It will always end with _CL to distinguish it as a custom log.</span></span>

1. <span data-ttu-id="f3bbc-175">Введите имя для журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-175">Type in a name for the log.</span></span>  <span data-ttu-id="f3bbc-176">Суффикс **\__CL** добавляется автоматически.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-176">The **\_CL** suffix is automatically provided.</span></span>
2. <span data-ttu-id="f3bbc-177">При необходимости введите **описание**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-177">Add an optional **Description**.</span></span>
3. <span data-ttu-id="f3bbc-178">Нажмите кнопку **Далее** , чтобы сохранить определения настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-178">Click **Next** to save the custom log definition.</span></span>

### <a name="step-5-validate-that-the-custom-logs-are-being-collected"></a><span data-ttu-id="f3bbc-179">Шаг 5.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-179">Step 5.</span></span> <span data-ttu-id="f3bbc-180">Проверка того, собираются ли данные настраиваемых журналов</span><span class="sxs-lookup"><span data-stu-id="f3bbc-180">Validate that the custom logs are being collected</span></span>
<span data-ttu-id="f3bbc-181">Чтобы начальные данные из нового настраиваемого журнала появились в Log Analytics, может потребоваться около часа.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-181">It may take up to an hour for the initial data from a new custom log to appear in Log Analytics.</span></span>  <span data-ttu-id="f3bbc-182">Из журналов, расположенных по пути, который вы указали, будут собираться записи, добавленные после определения настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-182">It will start collecting entries from the logs found in the path you specified from the point that you defined the custom log.</span></span>  <span data-ttu-id="f3bbc-183">Служба Log Analytics не будет сохранять записи, загруженные во время создания настраиваемого журнала, но она будет собирать уже существующие записи в найденных файлах журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-183">It will not retain the entries that you uploaded during the custom log creation, but it will collect already existing entries in the log files that it locates.</span></span>

<span data-ttu-id="f3bbc-184">Как только Log Analytics начнет собирать записи из настраиваемого журнала, их можно будет найти, используя поиск по журналу.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-184">Once Log Analytics starts collecting from the custom log, its records will be available with a Log Search.</span></span>  <span data-ttu-id="f3bbc-185">В качестве **типа** запроса следует использовать имя, присвоенное настраиваемому журналу.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-185">Use the name that you gave the custom log as the **Type** in your query.</span></span>

> [!NOTE]
> <span data-ttu-id="f3bbc-186">Если в разделе поиска отсутствует свойство RawData, закройте и откройте браузер снова.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-186">If the RawData property is missing from the search, you may need to close and reopen your browser.</span></span>
>
>

### <a name="step-6-parse-the-custom-log-entries"></a><span data-ttu-id="f3bbc-187">Шаг 6.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-187">Step 6.</span></span> <span data-ttu-id="f3bbc-188">Преобразование записей настраиваемого журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-188">Parse the custom log entries</span></span>
<span data-ttu-id="f3bbc-189">Вся запись журнала будет сохранена в свойстве **RawData**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-189">The entire log entry will be stored in a single property called **RawData**.</span></span>  <span data-ttu-id="f3bbc-190">Скорее всего, вам потребуется разделить различные сведения в каждой записи между отдельными свойствами, которые хранятся в записи.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-190">You will most likely want to separate the different pieces of information in each entry into individual properties stored in the record.</span></span>  <span data-ttu-id="f3bbc-191">Это можно сделать с помощью [настраиваемых полей](log-analytics-custom-fields.md) в Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-191">You do this using the [Custom Fields](log-analytics-custom-fields.md) feature of Log Analytics.</span></span>

<span data-ttu-id="f3bbc-192">Здесь не приведены подробные инструкции по преобразованию записи настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-192">Detailed steps for parsing the custom log entry are not provided here.</span></span>  <span data-ttu-id="f3bbc-193">Они приведены в статье о [настраиваемых полях](log-analytics-custom-fields.md) .</span><span class="sxs-lookup"><span data-stu-id="f3bbc-193">Please refer to the [Custom Fields](log-analytics-custom-fields.md) documentation for this information.</span></span>

## <a name="disabling-a-custom-log"></a><span data-ttu-id="f3bbc-194">Отключение настраиваемого журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-194">Disabling a custom log</span></span>
<span data-ttu-id="f3bbc-195">Определение настраиваемого журнала нельзя удалить после создания, но его можно отключить, удалив все пути к коллекции.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-195">You cannot remove a custom log definition once it's been created, but you can disable it by removing all of its collection paths.</span></span>

1. <span data-ttu-id="f3bbc-196">На портале OMS выберите **Параметры**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-196">In the OMS portal, go to **Settings**.</span></span>
2. <span data-ttu-id="f3bbc-197">Выберите вкладку **Данные**, а затем — раздел **Настраиваемые журналы**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-197">Click on **Data** and then **Custom logs**.</span></span>
3. <span data-ttu-id="f3bbc-198">Для отключения щелкните **Сведения** рядом с определением настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-198">Click **Details** next to the custom log definition to disable.</span></span>
4. <span data-ttu-id="f3bbc-199">Удалите все пути коллекции для определения настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-199">Remove each of the collection paths for the custom log definition.</span></span>

## <a name="data-collection"></a><span data-ttu-id="f3bbc-200">Сбор данных</span><span class="sxs-lookup"><span data-stu-id="f3bbc-200">Data collection</span></span>
<span data-ttu-id="f3bbc-201">Log Analytics собирает новые записи из каждого настраиваемого журнала примерно каждые 5 минут.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-201">Log Analytics will collect new entries from each custom log approximately every 5 minutes.</span></span>  <span data-ttu-id="f3bbc-202">Агент фиксирует место сбора в каждом отслеживаемом файле журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-202">The agent will record its place in each log file that it collects from.</span></span>  <span data-ttu-id="f3bbc-203">Если агент на некоторое времени перейдет в автономный режим, Log Analytics будет собирать записи, начиная с места остановки, даже если эти записи были созданы, пока агент был отключен.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-203">If the agent goes offline for a period of time, then Log Analytics will collect entries from where it last left off, even if those entries were created while the agent was offline.</span></span>

<span data-ttu-id="f3bbc-204">Все содержимое записи журнала записывается в свойство **RawData**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-204">The entire contents of the log entry are written to a single property called **RawData**.</span></span>  <span data-ttu-id="f3bbc-205">Это содержимое можно разделить на несколько свойств, которые можно анализировать и применять для поиска по отдельности. Для этого после создания настраиваемого журнала нужно определить [настраиваемые поля](log-analytics-custom-fields.md).</span><span class="sxs-lookup"><span data-stu-id="f3bbc-205">You can parse this into multiple properties that can be analyzed and searched separately by defining [Custom Fields](log-analytics-custom-fields.md) after you have created the custom log.</span></span>

## <a name="custom-log-record-properties"></a><span data-ttu-id="f3bbc-206">Свойства записей настраиваемого журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-206">Custom log record properties</span></span>
<span data-ttu-id="f3bbc-207">Записи настраиваемого журнала имеют тип на основе указанного имени журнала и указанные ниже свойства.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-207">Custom log records have a type with the log name that you provide and the properties in the following table.</span></span>

| <span data-ttu-id="f3bbc-208">Свойство</span><span class="sxs-lookup"><span data-stu-id="f3bbc-208">Property</span></span> | <span data-ttu-id="f3bbc-209">Описание</span><span class="sxs-lookup"><span data-stu-id="f3bbc-209">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="f3bbc-210">TimeGenerated</span><span class="sxs-lookup"><span data-stu-id="f3bbc-210">TimeGenerated</span></span> |<span data-ttu-id="f3bbc-211">Дата и время сбора записи службой Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-211">Date and time that the record was collected by Log Analytics.</span></span>  <span data-ttu-id="f3bbc-212">Если журнал использует разделитель на основе времени, это время, взятое из записи.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-212">If the log uses a time-based delimiter then this is the time collected from the entry.</span></span> |
| <span data-ttu-id="f3bbc-213">SourceSystem</span><span class="sxs-lookup"><span data-stu-id="f3bbc-213">SourceSystem</span></span> |<span data-ttu-id="f3bbc-214">Тип агента, из которого собрана запись.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-214">Type of agent the record was collected from.</span></span> <br> <span data-ttu-id="f3bbc-215">OpsManager — агент Windows, подключенный напрямую или управляемый с помощью System Center Operations Manager.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-215">OpsManager – Windows agent, either direct connect or System Center Operations Manager</span></span> <br> <span data-ttu-id="f3bbc-216">Linux — все агенты Linux</span><span class="sxs-lookup"><span data-stu-id="f3bbc-216">Linux – All Linux agents</span></span> |
| <span data-ttu-id="f3bbc-217">RawData</span><span class="sxs-lookup"><span data-stu-id="f3bbc-217">RawData</span></span> |<span data-ttu-id="f3bbc-218">Полный текст собранной записи.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-218">Full text of the collected entry.</span></span> |
| <span data-ttu-id="f3bbc-219">ManagementGroupName</span><span class="sxs-lookup"><span data-stu-id="f3bbc-219">ManagementGroupName</span></span> |<span data-ttu-id="f3bbc-220">Имя группы управления для агентов System Center Operations Manager.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-220">Name of the management group for System Center Operations Manage agents.</span></span>  <span data-ttu-id="f3bbc-221">Для других агентов это AOI-\<идентификатор_рабочей_области\>.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-221">For other agents, this is AOI-\<workspace ID\></span></span> |

## <a name="log-searches-with-custom-log-records"></a><span data-ttu-id="f3bbc-222">Поиск по журналу с использованием записей настраиваемого журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-222">Log searches with custom log records</span></span>
<span data-ttu-id="f3bbc-223">Записи из настраиваемых журналов сохраняются в репозитории OMS так же, как и записи из любого другого источника данных.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-223">Records from custom logs are stored in the OMS repository just like records from any other data source.</span></span>  <span data-ttu-id="f3bbc-224">Они имеют тип, совпадающий с именем, которое указывается при определении журнала, поэтому при поиске можно использовать свойство Type для извлечения записей, собранных из определенного журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-224">They will have a type matching the name that you provide when you define the log, so you can use the Type property in your search to retrieve records collected from a specific log.</span></span>

<span data-ttu-id="f3bbc-225">Ниже приведены различные примеры запросов поиска по журналу, которые извлекают записи из настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-225">The following table provides different examples of log searches that retrieve records from custom logs.</span></span>

| <span data-ttu-id="f3bbc-226">Запрос</span><span class="sxs-lookup"><span data-stu-id="f3bbc-226">Query</span></span> | <span data-ttu-id="f3bbc-227">Описание</span><span class="sxs-lookup"><span data-stu-id="f3bbc-227">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="f3bbc-228">Type=MyApp_CL</span><span class="sxs-lookup"><span data-stu-id="f3bbc-228">Type=MyApp_CL</span></span> |<span data-ttu-id="f3bbc-229">Все события из настраиваемого журнала с именем MyApp_CL.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-229">All events from a custom log named MyApp_CL.</span></span> |
| <span data-ttu-id="f3bbc-230">Type=MyApp_CL Severity_CF=error</span><span class="sxs-lookup"><span data-stu-id="f3bbc-230">Type=MyApp_CL Severity_CF=error</span></span> |<span data-ttu-id="f3bbc-231">Все события из настраиваемого журнала с именем MyApp_CL и значением *error* в настраиваемом поле с именем *Severity_CF*.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-231">All events from a custom log named MyApp_CL with a value of *error* in a custom field named *Severity_CF*.</span></span> |

>[!NOTE]
> <span data-ttu-id="f3bbc-232">Если ваша рабочая область переведена на [язык запросов Log Analytics](log-analytics-log-search-upgrade.md), указанные выше запросы будут изменены следующим образом.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-232">If your workspace has been upgraded to the [new Log Analytics query language](log-analytics-log-search-upgrade.md), then the above queries would change to the following.</span></span>

> | <span data-ttu-id="f3bbc-233">Запрос</span><span class="sxs-lookup"><span data-stu-id="f3bbc-233">Query</span></span> | <span data-ttu-id="f3bbc-234">Описание</span><span class="sxs-lookup"><span data-stu-id="f3bbc-234">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="f3bbc-235">MyApp_CL</span><span class="sxs-lookup"><span data-stu-id="f3bbc-235">MyApp_CL</span></span> |<span data-ttu-id="f3bbc-236">Все события из настраиваемого журнала с именем MyApp_CL.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-236">All events from a custom log named MyApp_CL.</span></span> |
| <span data-ttu-id="f3bbc-237">MyApp_CL &#124; где Severity_CF=="error"</span><span class="sxs-lookup"><span data-stu-id="f3bbc-237">MyApp_CL &#124; where Severity_CF=="error"</span></span> |<span data-ttu-id="f3bbc-238">Все события из настраиваемого журнала с именем MyApp_CL и значением *error* в настраиваемом поле с именем *Severity_CF*.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-238">All events from a custom log named MyApp_CL with a value of *error* in a custom field named *Severity_CF*.</span></span> |


## <a name="sample-walkthrough-of-adding-a-custom-log"></a><span data-ttu-id="f3bbc-239">Пошаговое руководство по добавлению настраиваемого журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-239">Sample walkthrough of adding a custom log</span></span>
<span data-ttu-id="f3bbc-240">В этом разделе описывается процедура создания настраиваемого журнала.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-240">The following section walks through an example of creating a custom log.</span></span>  <span data-ttu-id="f3bbc-241">В каждой строке примера журнала, из которого собираются данные, содержится одна запись, начинающаяся с даты и времени, после которых идут поля для кода, состояния и сообщения, разделенные запятыми.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-241">The sample log being collected has a single entry on each line starting with a date and time and then comma-delimited fields for code, status, and message.</span></span>  <span data-ttu-id="f3bbc-242">Ниже приведены некоторые примеры записей.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-242">Several sample entries are shown below.</span></span>

    2016-03-10 01:34:36 207,Success,Client 05a26a97-272a-4bc9-8f64-269d154b0e39 connected
    2016-03-10 01:33:33 208,Warning,Client ec53d95c-1c88-41ae-8174-92104212de5d disconnected
    2016-03-10 01:35:44 209,Success,Transaction 10d65890-b003-48f8-9cfc-9c74b51189c8 succeeded
    2016-03-10 01:38:22 302,Error,Application could not connect to database
    2016-03-10 01:31:34 303,Error,Application lost connection to database

### <a name="upload-and-parse-a-sample-log"></a><span data-ttu-id="f3bbc-243">Загрузка и преобразование примера журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-243">Upload and parse a sample log</span></span>
<span data-ttu-id="f3bbc-244">Мы откроем один из файлов журнала, чтобы увидеть события, которые он будет собирать.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-244">We provide one of the log files and can see the events that it will be collecting.</span></span>  <span data-ttu-id="f3bbc-245">В этом случае достаточно использовать в качестве разделителя новую строку.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-245">In this case New Line is a sufficient delimiter.</span></span>  <span data-ttu-id="f3bbc-246">Если одна запись в журнале может занимать несколько строк, то потребуется использовать в качестве разделителя метку времени.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-246">If a single entry in the log could span multiple lines though, then a timestamp delimiter would need to be used.</span></span>

![Загрузка и преобразование примера журнала](media/log-analytics-data-sources-custom-logs/delimiter.png)

### <a name="add-log-collection-paths"></a><span data-ttu-id="f3bbc-248">Добавление пути к файлам журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-248">Add log collection paths</span></span>
<span data-ttu-id="f3bbc-249">Файлы журнала будут храниться в каталоге *C:\MyApp\Logs*.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-249">The log files will be located in *C:\MyApp\Logs*.</span></span>  <span data-ttu-id="f3bbc-250">Каждый день создается файл с именем, которое включает в себя дату, в формате *приложение_ГГГГММДД.log*.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-250">A new file will be created each day with a name that includes the date in the pattern *appYYYYMMDD.log*.</span></span>  <span data-ttu-id="f3bbc-251">Для этого журнала будет использоваться путь *C:\MyApp\Logs\\\*.log*.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-251">A sufficient pattern for this log would be *C:\MyApp\Logs\\\*.log*.</span></span>

![Путь к файлам журнала](media/log-analytics-data-sources-custom-logs/collection-path.png)

### <a name="provide-a-name-and-description-for-the-log"></a><span data-ttu-id="f3bbc-253">Указание имени и описания журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-253">Provide a name and description for the log</span></span>
<span data-ttu-id="f3bbc-254">Мы введем имя *MyApp_CL* и текст **описания**.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-254">We use a name of *MyApp_CL* and type in a **Description**.</span></span>

![Имя журнала](media/log-analytics-data-sources-custom-logs/log-name.png)

### <a name="validate-that-the-custom-logs-are-being-collected"></a><span data-ttu-id="f3bbc-256">Проверка того, собираются ли данные настраиваемых журналов</span><span class="sxs-lookup"><span data-stu-id="f3bbc-256">Validate that the custom logs are being collected</span></span>
<span data-ttu-id="f3bbc-257">Мы используем запрос *Type=MyApp_CL*, чтобы вернуть все записи из журнала, данные которого собираются.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-257">We use a query of *Type=MyApp_CL* to return all records from the collected log.</span></span>

![Запрос к журналу без настраиваемых полей](media/log-analytics-data-sources-custom-logs/query-01.png)

### <a name="parse-the-custom-log-entries"></a><span data-ttu-id="f3bbc-259">Преобразование записей настраиваемого журнала</span><span class="sxs-lookup"><span data-stu-id="f3bbc-259">Parse the custom log entries</span></span>
<span data-ttu-id="f3bbc-260">Мы используем настраиваемые поля, чтобы определить поля *EventTime* (Время события), *Code* (Кодировка), *Status* (Состояние) и *Message* (Сообщение). Кроме того, мы сможем увидеть разницу в записях, которые возвращаются запросом.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-260">We use Custom Fields to define the *EventTime*, *Code*, *Status*, and *Message* fields and we can see the difference in the records that are returned by the query.</span></span>

![Запрос к журналу с использованием настраиваемых полей](media/log-analytics-data-sources-custom-logs/query-02.png)

## <a name="next-steps"></a><span data-ttu-id="f3bbc-262">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="f3bbc-262">Next steps</span></span>
* <span data-ttu-id="f3bbc-263">Используйте [настраиваемые поля](log-analytics-custom-fields.md), чтобы проанализировать записи в настраиваемом журнале в отдельных полях.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-263">Use [Custom Fields](log-analytics-custom-fields.md) to parse the entries in the custom log in to individual fields.</span></span>
* <span data-ttu-id="f3bbc-264">Узнайте больше об [операциях поиска по журналу](log-analytics-log-searches.md) , которые можно применять для анализа данных, собираемых из источников данных и решений.</span><span class="sxs-lookup"><span data-stu-id="f3bbc-264">Learn about [log searches](log-analytics-log-searches.md) to analyze the data collected from data sources and solutions.</span></span>
