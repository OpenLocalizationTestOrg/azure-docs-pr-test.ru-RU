---
title: "aaaOptimize среды SQL Server с помощью анализа журналов Azure | Документы Microsoft"
description: "С помощью аналитики журналов Azure можно использовать hello оценки SQL tooassess решения hello риска и работоспособности среды SQL server через равные промежутки времени."
services: log-analytics
documentationcenter: 
author: bandersmsft
manager: carmonm
editor: 
ms.assetid: e297eb57-1718-4cfe-a241-b9e84b2c42ac
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: banders
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f31326d8cdad3ef5d5a190614d1a18c1dac826ed
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-your-sql-server-environment-with-hello-sql-assessment-solution-in-log-analytics"></a>Оптимизация среды SQL Server с hello решение для оценки SQL в службе анализа журналов

![Символ оценки SQL](./media/log-analytics-sql-assessment/sql-assessment-symbol.png)

Можно использовать hello оценки SQL tooassess решения hello риска и работоспособности серверной среды с регулярным интервалом. Эта статья поможет вам установить решение hello, позволяют предпринимать корректирующие действия для потенциальных проблем.

Это решение предоставляет упорядоченный список рекомендаций конкретных tooyour развернутой серверной инфраструктуре. Hello рекомендации разделены на шесть фокуса, областей, которые помогают быстро понять hello риска и примите необходимые меры.

Hello рекомендации основаны на hello знания и опыт, приобретенные специалистами Майкрософт в результате многочисленных посещений клиентов. Каждая рекомендация содержит обоснования, почему проблема может играть важную роль tooyou и как tooimplement hello предложенные изменения.

Можно выбрать приоритетные области, наиболее важные tooyour организации и отслеживать выполнение задач по рисков формированию работоспособной и свободной среды.

После добавления решения hello и оценка завершенной, сводные данные по приоритетным областям отображается на hello **оценки SQL** панель мониторинга для hello инфраструктуры в среде. Hello ниже описано, как toouse hello сведения о hello **оценки SQL** мониторинга, где можно просматривать и предпринимать рекомендуемые действия для серверной инфраструктуры SQL.

![image of SQL Assessment tile](./media/log-analytics-sql-assessment/sql-assess-tile.png)

![image of SQL Assessment dashboard](./media/log-analytics-sql-assessment/sql-assess-dash.png)

## <a name="installing-and-configuring-hello-solution"></a>Установка и настройка решения hello
Оценка SQL работает со всеми версиями SQL Server для выпусков Standard, Developer и Enterprise hello, поддерживаемых в настоящее время.

Используйте следующие сведения tooinstall hello и настроить решение hello.

* Агенты должны устанавливаться на серверах, на которых установлен SQL Server.
* Hello решение для оценки SQL требуется поддерживаемая версия платформы .NET Framework 4 установлена на каждом компьютере, где установлен агент OMS.
* В решении hello tooinstall порядок hello пользователь должен быть toohello администратора или участника подписки Azure при с помощью портала Azure "hello". Кроме того hello пользователь должен быть членом hello OMS рабочей участника или администратора роли на портале OMS hello.
* При использовании hello агент Operations Manager с помощью оценки SQL, вам потребуется toouse Operations Manager Run-As учетную запись. Дополнительные сведения см. в разделе ниже [Учетные записи запуска от имени в Operations Manager для службы OMS](#operations-manager-run-as-accounts-for-oms).

  > [!NOTE]
  > агент MMA Hello не поддерживает учетные записи Operations Manager Run-As.
  >
  >
* Добавить tooyour решения оценки SQL hello, рабочую область OMS hello процесс описывается в [решений добавьте анализа журналов из коллекции решений hello](log-analytics-add-solutions.md). Дополнительная настройка не требуется.

> [!NOTE]
> После добавления решения hello tooservers с агентами добавляется файл AdvisorAssessment.exe hello. Данные конфигурации считываются и затем отправляется toohello службой OMS в облаке hello для обработки. Логика является примененных toohello полученных данных и hello облачная служба записывает данные hello.

## <a name="sql-assessment-data-collection-details"></a>Сведения о сборе данных по оценке SQL
Оценка SQL собирает данные WMI, данные реестра, данные о производительности и результатов представления динамического управления SQL Server, с помощью hello агенты, которые вы включили.

Hello следующей таблице приведены методы сбора данных для агентов, ли Operations Manager (SCOM) является обязательным и как часто данные собираются агентом.

| платформа | Direct Agent | Агент SCOM | Хранилище Azure | Нужен ли SCOM? | Отправка данных агента SCOM через группу управления | частота сбора |
| --- | --- | --- | --- | --- | --- | --- |
| Windows | &#8226; | &#8226; |  |  | &#8226; |7 дней |

## <a name="operations-manager-run-as-accounts-for-oms"></a>Учетные записи запуска от имени в Operations Manager для службы OMS
Аналитика журналов в OMS использует агент Operations Manager hello и toocollect группы управления и отправки службой OMS toohello данных. OMS строится на пакетах управления для рабочих нагрузок tooprovide ценных служб. Каждая рабочая нагрузка требует наличия пакетов управления toorun привилегии, относящиеся в другом контексте безопасности, например учетной записи домена. Необходимо tooprovide учетные данные, настроив Operations Manager запуска от имени учетной записи.

Используйте следующие сведения tooset hello Operations Manager запуска от имени учетной записи для оценки SQL hello.

### <a name="set-hello-run-as-account-for-sql-assessment"></a>Задать hello запись запуска от имени для оценки SQL
 Если вы уже используете hello пакет управления SQL Server, следует использовать эту учетную запись запуска от имени.

#### <a name="tooconfigure-hello-sql-run-as-account-in-hello-operations-console"></a>hello tooconfigure SQL запуска от учетной записи в консоли управления hello
> [!NOTE]
> При использовании hello OMS прямой агент, а не агент SCOM hello, пакет управления hello всегда запускается в контексте безопасности hello hello локальной системной учетной записи. Пропустить шаги 1 – 5 ниже и выполнения либо hello образец T-SQL или Powershell, указав в качестве hello имя пользователя NT AUTHORITY\SYSTEM.
>
>

1. В Operations Manager откройте консоль управления hello и нажмите кнопку **администрирования**.
2. В разделе **Настройка запуска от имени** щелкните **Профили** и откройте **Профиль запуска от имени для оценки SQL в OMS**.
3. На hello **учетные записи запуска от** щелкните **добавить**.
4. Выберите учетную запись запуска от имени Windows, содержащий hello учетные данные, необходимые для SQL Server, или нажмите кнопку **New** toocreate один.

   > [!NOTE]
   > Hello типа учетной записи запуска от имени должен быть Windows. Hello учетная запись запуска от имени также должна входить группы локальных администраторов на всех серверах Windows, размещения экземпляров SQL Server.
   >
   >
5. Щелкните **Сохранить**.
6. Изменения, а затем выполните следующий пример T-SQL на tooRun минимальные разрешения необходимые tooperform учетную запись от имени для оценки SQL toogrant каждого экземпляра SQL Server hello. Тем не менее вам это не требуется toodo Если учетная запись запуска от имени уже является частью серверной роли sysadmin hello в экземплярах SQL Server.

```
---
    -- Replace <UserName> with hello actual user name being used as Run As Account.
    USE master

    -- Create login for hello user, comment this line if login is already created.
    CREATE LOGIN [<UserName>] FROM WINDOWS

    -- Grant permissions toouser.
    GRANT VIEW SERVER STATE too[<UserName>]
    GRANT VIEW ANY DEFINITION too[<UserName>]
    GRANT VIEW ANY DATABASE too[<UserName>]

    -- Add database user for all hello databases on SQL Server Instance, this is required for connecting tooindividual databases.
    -- NOTE: This command must be run anytime new databases are added tooSQL Server instances.
    EXEC sp_msforeachdb N'USE [?]; CREATE USER [<UserName>] FOR LOGIN [<UserName>];'

```
#### <a name="tooconfigure-hello-sql-run-as-account-using-windows-powershell"></a>hello tooconfigure SQL запуска от учетной записи с помощью Windows PowerShell
Откройте окно PowerShell и выполните следующий скрипт после обновления его своими данными hello:

```

    import-module OperationsManager
    New-SCOMManagementGroupConnection "<your management group name>"

    $profile = Get-SCOMRunAsProfile -DisplayName "OMS SQL Assessment Run As Profile"
    $account = Get-SCOMrunAsAccount | Where-Object {$_.Name -eq "<your run as account name>"}
    Set-SCOMRunAsProfile -Action "Add" -Profile $Profile -Account $Account
```

## <a name="understanding-how-recommendations-are-prioritized"></a>Основные сведения о приоритизации рекомендаций
Каждая рекомендация получает взвешенное значение, определяющее относительную важность рекомендаций hello hello. Отображаются только hello десять наиболее важных рекомендаций.

### <a name="how-weights-are-calculated"></a>Процесс вычисления взвешенного значения
Взвешенные значения являются статистическими значениями, основанными на трех ключевых факторах.

* Hello *вероятность* вызовет что проблемы, обнаруженной проблемы. Более высокие значения вероятности приравниваются tooa высокой общей оценке для рекомендации hello.
* Hello *влияние* проблемы hello в вашей организации, если она является причиной проблемы. Более высокая степень влияния приравнивается tooa высокой общей оценке для рекомендации hello.
* Hello *усилия* необходимые рекомендации tooimplement hello. Более высокое значение усилий приравнивается tooa меньшей общей оценке для рекомендации hello.

Hello весовой коэффициент для каждой рекомендации выражается в процентах от hello общей оценки, доступной для каждой приоритетной области. Например если рекомендация в hello безопасности и соответствия приоритетной области имеет показатель 5%, реализация этой рекомендации увеличит общую оценку на 5% безопасности и соответствия требованиям.

### <a name="focus-areas"></a>Приоритетные области
**Безопасность и соответствие требованиям**. В этой области содержатся рекомендации в отношении возможных угроз, нарушений безопасности и корпоративных политик, а также технические, юридические и нормативные требования.

**Доступность и непрерывность бизнес-процессов**. Эта область содержит рекомендации в отношении доступности служб, устойчивости инфраструктуры и защиты бизнеса.

**Производительность и масштабируемость** -фокус в этой области отображается toohelp рекомендации вашей организации ИТ-инфраструктуры увеличиваться, убедитесь, что ИТ-среды требованиям текущей производительности и возможности toorespond toochanging требуется инфраструктура.

**Обновление, миграция и развертывание** — в этой области фокуса отображается toohelp рекомендации при обновлении, перенос и развертывание SQL Server tooyour существующей инфраструктуры.

**Операции и мониторинг** : фокус в этой области отображается оптимизировать toohelp рекомендации ИТ-операций, реализовать профилактического обслуживания и повышения производительности.

**Управление изменениями и настройкой** -рекомендаций в этой области фокуса отображается toohelp защита повседневной деятельности, убедитесь, что изменения не отрицательно повлиять на инфраструктуру, Разработка процедур управления изменениями и tootrack и аудита конфигурации системы.

### <a name="should-you-aim-tooscore-100-in-every-focus-area"></a>Следует ли стремиться tooscore 100% в каждой приоритетной области?
Не обязательно. Hello рекомендации основываются на hello знания и опыт, приобретенные специалистами Майкрософт в результате многочисленных посещений клиентов. Однако не двух серверных инфраструктур, же hello и конкретные рекомендации могут быть более или менее соответствующие tooyou. Например некоторые рекомендации по безопасности может быть менее значимыми, если виртуальные машины не предоставляется toohello Интернета. Некоторые рекомендации о доступности могут иметь менее важное значение для служб, которые обеспечивают сбор низкоприоритетных данных. Проблемы, которые являются важной tooa зрелой организации может быть менее важные tooa при запуске. Можно tooidentify, какие области фокуса и затем отследить изменение оценок с течением времени.

В каждой рекомендации указано, почему она важна. Следует использовать это руководство tooevaluate целесообразность реализации рекомендации hello, условии hello характера ИТ служб и hello потребностям вашей организации.

## <a name="use-assessment-focus-area-recommendations"></a>Использование рекомендаций по оцениваемой приоритетной области
Перед использованием решения оценки в OMS, необходимо установить решение hello. tooread Дополнительные сведения об установке решений, в разделе [решений добавьте анализа журналов из коллекции решений hello](log-analytics-add-solutions.md). После установки, можно просмотреть сводку hello рекомендаций с помощью плитки оценки SQL hello на страницу обзора hello в OMS.

Представление hello суммирование оценок соответствия для инфраструктуры, а затем глубже изучить рекомендации.

### <a name="tooview-recommendations-for-a-focus-area-and-take-corrective-action"></a>рекомендации tooview фокус области и предпринять корректирующее действие
1. На hello **Обзор** щелкните hello **оценки SQL** плитки.
2. На hello **оценки SQL** , просмотрите сводные сведения о hello в одной из колонок приоритетной области hello и выберите один tooview рекомендации для этой приоритетной области.
3. На всех страницах интересующей области hello можно просмотреть hello приоритеты рекомендации для вашей среды. Щелкните рекомендацию, в разделе **затронутые объекты** tooview сведений о причинах hello рекомендации.  
    ![Изображение с рекомендациями оценки SQL](./media/log-analytics-sql-assessment/sql-assess-focus.png)
4. В разделе **Предложенные действия**представлены действия по исправлению, которые вы можете предпринять. Когда hello элементом будет устранена, последующие оценки будут указывать, что рекомендованные действия были выполнены, и тогда оценка соответствия возрастет. Исправленные элементы отображаются как **Прошедшие проверку объекты**.

## <a name="ignore-recommendations"></a>Игнорирование рекомендаций
Если у вас есть рекомендации, что требуется tooignore, можно создать текстовый файл, который OMS будет использовать tooprevent отображения рекомендаций в результатах оценки.

[!include[log-analytics-log-search-nextgeneration](../../includes/log-analytics-log-search-nextgeneration.md)]

### <a name="tooidentify-recommendations-that-you-will-ignore"></a>tooidentify рекомендации, которые будет игнорировать
1. Войдите в рабочую область tooyour и откройте раздел поиска журналов. Используйте hello рекомендации запроса toolist сбоев для компьютеров в вашей среде.

   ```
   Type=SQLAssessmentRecommendation RecommendationResult=Failed | select  Computer, RecommendationId, Recommendation | sort  Computer
   ```

   Вот запрос поиска журналов hello снимке экрана показан: ![сбой рекомендации](./media/log-analytics-sql-assessment/sql-assess-failed-recommendations.png)
2. Выберите рекомендации, которые должны tooignore. В следующей процедуре hello будут использоваться hello значения для recommendationid будут.

### <a name="toocreate-and-use-an-ignorerecommendationstxt-text-file"></a>toocreate и использование текстового файла IgnoreRecommendations.txt
1. Создайте файл с именем IgnoreRecommendations.txt.
2. Вставьте или введите каждое значение RecommendationId для каждой рекомендации требуется tooignore OMS в отдельной строке, а затем сохраните и закройте файл hello.
3. Поместите файл hello в следующие папки на каждом компьютере место рекомендации tooignore OMS hello.
   * На компьютерах с Microsoft Monitoring Agent (с подключением напрямую или с помощью Operations Manager) - hello *SystemDrive*: \Program Files\Microsoft Monitoring agent\agent.
   * На сервере управления Operations Manager hello - *SystemDrive*: \Program Files\Microsoft System Center 2012 R2\Operations Manager\Server

### <a name="tooverify-that-recommendations-are-ignored"></a>tooverify игнорирования рекомендаций
1. После запуска hello следующего запланированного оценки по умолчанию каждые 7 дней hello указан рекомендации помечаются как игнорируемые и не отображаются на панели мониторинга оценки hello.
2. Можно использовать hello следующих toolist запросы поиска журналов всех рекомендаций hello игнорируются.

   ```
   Type=SQLAssessmentRecommendation RecommendationResult=Ignored | select  Computer, RecommendationId, Recommendation | sort  Computer
   ```
3. Если вы решите позже, toosee учитываются рекомендации, удалите все файлы IgnoreRecommendations.txt или удалите из них Recommendationid.

## <a name="sql-assessment-solution-faq"></a>Часто задаваемые вопросы по решениям оценки SQL
*Как часто выполняется оценка?*

* Hello оценка выполняется каждые 7 дней.

*Есть ли способ tooconfigure как часто выполняется оценка hello?*

* На данный момент нет.

*Если после добавления решения оценки SQL hello обнаружен другой сервер, будет оценивается ли он?*

* Да, после обнаружения он оценивается каждые 7 дней.

*Если сервер выведен из эксплуатации, когда он будет удален из оценки hello?*

* Если сервер не отправляет данные в течение 3 недель, то он удаляется.

*Что такое имя hello hello процесса, который hello сбора данных?*

* AdvisorAssessment.exe

*Сколько времени требуется для toobe данных собираются?*

* время сбора данных на сервере hello Hello занимает примерно 1 час. На серверах, которые имеют большое количество экземпляров или баз данных SQL, процесс сбора может занять больше времени.

*Какие типы данных собираются?*

* собираются следующие типы данных Hello:
  * WMI
  * Реестр
  * Счетчики производительности
  * Динамические административные представления (DMV) SQL

*Есть ли способ tooconfigure время сбора данных?*

* На данный момент нет.

*Почему у tooconfigure учетная запись запуска от имени*

* Для SQL Server выполняется небольшое количество SQL-запросов. Для них необходимо использовать toorun, учетная запись запуска от имени с tooSQL разрешения VIEW SERVER STATE.  Кроме того в порядке tooquery WMI, требуются учетные данные локального администратора.

*Почему отображаются только первые 10 рекомендаций hello?*

* Вместо отображения полного списка задач, мы рекомендуем сконцентрироваться на рекомендациях hello приоритеты. После этого станут доступны дополнительные рекомендации. Если вы предпочитаете toosee hello подробный список, можно просмотреть всех рекомендаций, с помощью поиска журналов OMS hello.

*Есть ли способ tooignore рекомендации?*

* Да. См. раздел [Игнорирование рекомендаций](#ignore-recommendations) выше в этой статье.

## <a name="next-steps"></a>Дальнейшие действия
* [Выполнять поиск в журналах](log-analytics-log-searches.md) tooview подробные данные оценки SQL и рекомендации.
