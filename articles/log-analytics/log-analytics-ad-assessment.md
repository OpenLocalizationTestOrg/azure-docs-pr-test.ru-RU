---
title: "Оптимизация среды Active Directory с помощью Azure Log Analytics | Документация Майкрософт"
description: "Решение оценки Active Directory можно использовать для оценки риска и работоспособности серверной среды с постоянной периодичностью."
services: log-analytics
documentationcenter: 
author: bandersmsft
manager: carmonm
editor: 
ms.assetid: 81eb41b8-eb62-4eb2-9f7b-fde5c89c9b47
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: banders
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 97368f0b9e89ffd0cd982b6e8670d5a1f62ad42c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="optimize-your-active-directory-environment-with-the-active-directory-assessment-solution-in-log-analytics"></a>Оптимизация среды Active Directory с помощью решения оценки Active Directory в Log Analytics

![Символ "Оценка AD"](./media/log-analytics-ad-assessment/ad-assessment-symbol.png)

Решение оценки Active Directory можно использовать для оценки риска и работоспособности серверной среды с постоянной периодичностью. Эта статья поможет вам установить и использовать это решение таким образом, чтобы в случае проблем вы могли выполнить корректирующие действия.

Это решение предоставляет приоритетный список рекомендаций, относящихся к развернутой серверной инфраструктуре. Рекомендации сгруппированы в четыре приоритетные области, помогающие быстро оценить риски и принять меры.

В основу предлагаемых рекомендаций положены знания и опыт, приобретенные специалистами Майкрософт в результате многочисленных посещений клиентов. Каждая рекомендация является определенным руководством, поясняющим важность проблемы и приводящим действия по реализации предложенных изменений.

Можно выбрать приоритетные области, наиболее важные для организации, и отслеживать выполнение задач по формированию работоспособной и свободной от рисков среды.

После добавления решения и завершения оценки сводная информация по приоритетным областям отображается на панели мониторинга **Оценка AD** для инфраструктуры среды. В следующих разделах описано, как использовать информацию на панели мониторинга **Оценка AD** , где можно увидеть и выполнить действия, рекомендованные для вашей инфраструктуры сервера Active Directory.

![image of SQL Assessment tile](./media/log-analytics-ad-assessment/ad-tile.png)

![image of SQL Assessment dashboard](./media/log-analytics-ad-assessment/ad-assessment.png)

## <a name="installing-and-configuring-the-solution"></a>Установка и настройка решения
Для установки и настройки решений используйте указанные ниже данные.

* Агенты должны устанавливаться на контроллерах домена, являющихся членами домена, который будет оцениваться.
* Для решения оценки Active Directory на каждом компьютере с агентом OMS должна быть установлена поддерживаемая версия платформы .NET Framework 4 (4.5.2 или выше).
* Решение для оценки Active Directory необходимо добавить в рабочую область OMS из [Azure Мarketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.ADAssessmentOMS?tab=Overview) или в соответствии с инструкциями по [добавлению решений Log Analytics из коллекции решений](log-analytics-add-solutions.md).  Дополнительная настройка не требуется.

  > [!NOTE]
  > После добавления решения на серверы с агентами добавляется файл AdvisorAssessment.exe. Данные конфигурации считываются и отправляются на обработку в службу OMS в облаке. К полученным данным применяется логика и облачная служба записывает данные.
  >
  >

## <a name="active-directory-assessment-data-collection-details"></a>Сведения о сборе данных оценки Active Directory

Оценка Active Directory собирает данные из следующих источников с помощью включенных агентов:

- Сборщики данных реестра
- Сборщики LDAP
- .NET Framework
- Сборщики журналируемых данных событий
- Интерфейс ADSI
- Windows PowerShell
- Сборщики данных файлов
- Инструментарий управления Windows (WMI)
- API инструмента DCDIAG
- API службы репликации файлов (NTFRS)
- Пользовательский код C#


В следующей таблице показаны методы сбора данных для агентов, необходимость Operations Manager (SCOM) и периодичность сбора данных агентом.

| платформа | Direct Agent | Агент SCOM | Хранилище Azure | Нужен ли SCOM? | Отправка данных агента SCOM через группу управления | частота сбора |
| --- | --- | --- | --- | --- | --- | --- |
| Windows |&#8226; |&#8226; |  |  |&#8226; |7 дней |

## <a name="understanding-how-recommendations-are-prioritized"></a>Основные сведения о приоритизации рекомендаций
Каждая рекомендация получает взвешенное значение, определяющее относительную важность рекомендаций. Отображаются только 10 наиболее важных рекомендаций.

### <a name="how-weights-are-calculated"></a>Процесс вычисления взвешенного значения
Взвешенные значения являются статистическими значениями, основанными на трех ключевых факторах.

* *Вероятность* возникновения проблем. Более высокие значения вероятности приравниваются к более высокой общей оценке для рекомендации.
* *Влияние* на работу организации, если она является причиной проблемы. Более высокая степень влияния приравнивается к более высокой общей оценке для рекомендации.
* *Усилия* , необходимые для реализации рекомендации. Более высокое значение усилий приравнивается к меньшей общей оценке рекомендации.

Взвешенное значение для каждой рекомендации выражается в процентах от общей оценки, доступной для каждой приоритетной области. Например, если рекомендация в области обеспечения безопасности и соответствия требованиям имеет показатель 5 %, реализация этой рекомендации увеличит общую оценку в этой области на 5 %.

### <a name="focus-areas"></a>Приоритетные области
**Безопасность и соответствие требованиям**. В этой области содержатся рекомендации в отношении возможных угроз, нарушений безопасности и корпоративных политик, а также технические, юридические и нормативные требования.

**Доступность и непрерывность бизнес-процессов**. Эта область содержит рекомендации в отношении доступности служб, устойчивости инфраструктуры и защиты бизнеса.

**Производительность и масштабируемость**. В этой области содержатся рекомендации, которые помогут ИТ-инфраструктуре вашей организации расти, обеспечат соответствие ИТ-среды текущим требованиям к производительности и позволят ей адаптироваться к новым требованиям к инфраструктуре.

**Обновление, миграция и развертывание**. Эта область содержит рекомендации, которые помогут вам обновить, перенести или развернуть Active Directory в существующую инфраструктуру.

### <a name="should-you-aim-to-score-100-in-every-focus-area"></a>Следует ли стремиться к показателю 100 % в каждой приоритетной области?
Не обязательно. В основу предлагаемых рекомендаций положены знания и опыт, приобретенные специалистами Майкрософт в результате многочисленных посещений клиентов. Однако не существует двух одинаковых серверных инфраструктур, и конкретные рекомендации могут быть применимы к вам в большей или меньшей степени. Например, некоторые рекомендации по обеспечению безопасности могут быть менее значимыми, если виртуальные машины в организации не подключены к Интернету. Некоторые рекомендации о доступности могут иметь менее важное значение для служб, которые обеспечивают сбор низкоприоритетных данных. Проблемы, которые важны для зрелой организации, могут быть не так важны для начинающей компании. Можно определить приоритетные области и затем отследить изменение оценок с течением времени.

В каждой рекомендации указано, почему она важна. Их следует использовать, чтобы определить целесообразность реализации рекомендации с учетом характера ИТ-служб и бизнес-потребностей организации.

## <a name="use-assessment-focus-area-recommendations"></a>Использование рекомендаций по оцениваемой приоритетной области
Чтобы использовать решение оценки в OMS, его необходимо установить. Дополнительные сведения об установке решений см. в статье [Добавление решений Log Analytics из коллекции решений](log-analytics-add-solutions.md). После установки пакета аналитики можно просматривать сводку рекомендаций с помощью плитки оценки на странице "Обзор" в OMS.

Вы можете посматривать сводку оценок соответствия для инфраструктуры, а затем глубже изучить рекомендации.

### <a name="to-view-recommendations-for-a-focus-area-and-take-corrective-action"></a>Просмотр рекомендаций для приоритетной области и выполнение действий по исправлению
1. На странице **Обзор** щелкните плитку **Оценка** для серверной инфраструктуры.
2. На странице **Оценка** просмотрите сводные данные в одной из колонок приоритетной области, а затем щелкните ее, чтобы просмотреть рекомендации для этой приоритетной области.
3. На всех страницах интересующей области можно просматривать приоритетные рекомендации для вашей среды. Щелкните рекомендацию в разделе **Затронутые объекты** , чтобы просмотреть сведения о причинах возникновения этой рекомендации.  
    ![изображение с рекомендациями оценки](./media/log-analytics-ad-assessment/ad-focus.png)
4. В разделе **Предложенные действия**представлены действия по исправлению, которые вы можете предпринять. Когда проблема с этим элементом будет устранена, последующие оценки будут указывать, что рекомендованные действия были выполнены, и тогда оценка соответствия возрастет. Исправленные элементы отображаются как **Прошедшие проверку объекты**.

## <a name="ignore-recommendations"></a>Игнорирование рекомендаций
Если вы хотите проигнорировать какие-то рекомендации, создайте текстовый файл, который OMS будет использовать для того, чтобы убрать рекомендации из результатов оценки.

### <a name="to-identify-recommendations-that-you-will-ignore"></a>Указание рекомендаций, которые нужно проигнорировать
1. Войдите в рабочую область и откройте поиск по журналам. Выполните следующий запрос, чтобы получить список рекомендаций, не выполненных на компьютерах в вашей среде.

   ```
   Type=ADAssessmentRecommendation RecommendationResult=Failed | select  Computer, RecommendationId, Recommendation | sort  Computer
   ```
>[!NOTE]
> Если ваша рабочая область переведена на [язык запросов Log Analytics](log-analytics-log-search-upgrade.md), приведенный выше запрос будет изменен следующим образом.
>
> `ADAssessmentRecommendation | where RecommendationResult == "Failed" | sort by Computer asc | project Computer, RecommendationId, Recommendation`

   Вот снимок экрана с запросом на поиск по журналам: ![невыполненные рекомендации](./media/log-analytics-ad-assessment/ad-failed-recommendations.png).
2. Выберите рекомендации, которые нужно проигнорировать. Эти значения будут использоваться для параметра RecommendationId в следующей процедуре.

### <a name="to-create-and-use-an-ignorerecommendationstxt-text-file"></a>Создание и использование текстового файла IgnoreRecommendations.txt
1. Создайте файл с именем IgnoreRecommendations.txt.
2. Вставьте или введите значение RecommendationId для каждой рекомендации, которую служба Log Analytics должна игнорировать, в отдельной строке, а затем сохраните и закройте файл.
3. Поместите файл в следующую папку на каждом компьютере, где OMS должен проигнорировать рекомендации.
   * На компьютерах с Microsoft Monitoring Agent (подключенных напрямую или через Operations Manager): *системный диск*:\Program Files\Microsoft Monitoring Agent\Agent.
   * На сервере управления Operations Manager: *системный диск*:\Program Files\Microsoft System Center 2012 R2\Operations Manager\Server.

### <a name="to-verify-that-recommendations-are-ignored"></a>Контроль игнорирования рекомендаций
После выполнения следующей плановой оценки (по умолчанию выполняется раз в семь дней) указанные рекомендации помечаются как *игнорируемые* и больше не отображаются на панели мониторинга оценки.

1. Для получения списка всех игнорируемых рекомендаций можно использовать следующие запросы поиска по журналам.

    ```
    Type=ADAssessmentRecommendation RecommendationResult=Ignored | select  Computer, RecommendationId, Recommendation | sort  Computer
    ```
>[!NOTE]
> Если ваша рабочая область переведена на [язык запросов Log Analytics](log-analytics-log-search-upgrade.md), приведенный выше запрос будет изменен следующим образом.
>
> `ADAssessmentRecommendation | where RecommendationResult == "Ignored" | sort by Computer asc | project Computer, RecommendationId, Recommendation`

2. Если вы решите позже просмотреть игнорируемые рекомендации, удалите все файлы IgnoreRecommendations.txt или RecommendationIDs можно удалить из них.

## <a name="ad-assessment-solutions-faq"></a>Часто задаваемые вопросы по решениям оценки AD
*Как часто выполняется оценка?*

* Оценка выполняется каждые 7 дней.

*Есть ли способ настроить частоту оценки?*

* На данный момент нет.

*Если после добавления решения оценки будет обнаружен другой сервер, оценивается ли он?*

* Да, после обнаружения он оценивается каждые 7 дней.

*Если сервер выведен из эксплуатации, он будет удален из оценки?*

* Если сервер не отправляет данные в течение 3 недель, то он удаляется.

*Как называется процесс, который собирает данные?*

* AdvisorAssessment.exe

*Сколько времени требуется для сбора данных?*

* Время сбора данных на сервере занимает примерно 1 час. На серверах, которые имеют большое количество серверов Active Directory, процесс сбора может занять больше времени.

*Можно ли настроить время сбора данных?*

* На данный момент нет.

*Почему отображаются только первые 10 рекомендаций?*

* Вместо отображения полного списка задач мы рекомендуем сконцентрироваться на приоритетных рекомендациях. После этого станут доступны дополнительные рекомендации. Если вы хотите просмотреть весь список, используйте функцию поиска по журналам.

*Можно ли игнорировать рекомендации?*

* Да. См. раздел [Игнорирование рекомендаций](#ignore-recommendations) выше в этой статье.

## <a name="next-steps"></a>Дальнейшие действия
* Используйте [Поиск по журналам в Log Analytics](log-analytics-log-searches.md) для просмотра подробных данных по оценке AD и рекомендациям.
