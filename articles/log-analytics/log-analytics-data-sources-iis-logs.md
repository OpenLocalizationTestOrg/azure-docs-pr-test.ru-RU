---
title: "Журналы IIS в службе Log Analytics | Документация Майкрософт"
description: "Службы IIS (Internet Information Services) хранят данные об активности пользователей в файлах журналов, собираемых службой Log Analytics.  В этой статье описано, как настроить коллекцию журналов IIS и сведения о записях, созданных ими в репозитории OMS."
services: log-analytics
documentationcenter: 
author: bwren
manager: jwhit
editor: tysonn
ms.assetid: cec5ff0a-01f5-4262-b2e8-e3db7b7467d2
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/12/2017
ms.author: bwren
ms.openlocfilehash: 2114bdafb3b9fe2eb0632271840b8b70a76d10f1
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="iis-logs-in-log-analytics"></a><span data-ttu-id="2cfb3-104">Журналы IIS в службе Log Analytics</span><span class="sxs-lookup"><span data-stu-id="2cfb3-104">IIS logs in Log Analytics</span></span>
<span data-ttu-id="2cfb3-105">Службы IIS (Internet Information Services) хранят данные об активности пользователей в файлах журналов, собираемых службой Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-105">Internet Information Services (IIS) stores user activity in log files that can be collected by Log Analytics.</span></span>  

![Журналы IIS](media/log-analytics-data-sources-iis-logs/overview.png)

## <a name="configuring-iis-logs"></a><span data-ttu-id="2cfb3-107">Настройка журналов IIS</span><span class="sxs-lookup"><span data-stu-id="2cfb3-107">Configuring IIS logs</span></span>
<span data-ttu-id="2cfb3-108">Служба Log Analytics собирает записи из файлов журналов, созданных службами IIS, поэтому вам необходимо [настроить IIS для ведения журнала](https://technet.microsoft.com/library/hh831775.aspx).</span><span class="sxs-lookup"><span data-stu-id="2cfb3-108">Log Analytics collects entries from log files created by IIS, so you must [configure IIS for logging](https://technet.microsoft.com/library/hh831775.aspx).</span></span>

<span data-ttu-id="2cfb3-109">Служба Log Analytics поддерживает только те файлы журналов IIS, которые хранятся в формате W3C, и не поддерживает настраиваемые поля или расширенное ведение журналов IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-109">Log Analytics only supports IIS log files stored in W3C format and does not support custom fields or IIS Advanced Logging.</span></span>  
<span data-ttu-id="2cfb3-110">Она не собирает журналы в формате NCSA или в собственном формате IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-110">Log Analytics does not collect logs in NCSA or IIS native format.</span></span>

<span data-ttu-id="2cfb3-111">Журналы IIS настраиваются в меню ["Данные" в параметрах Log Analytics](log-analytics-data-sources.md#configuring-data-sources).</span><span class="sxs-lookup"><span data-stu-id="2cfb3-111">Configure IIS logs in Log Analytics from the [Data menu in Log Analytics Settings](log-analytics-data-sources.md#configuring-data-sources).</span></span>  <span data-ttu-id="2cfb3-112">Никакие настройки, кроме выбора параметра **Сбор файлов журналов IIS в формате W3C**, не требуются.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-112">There is no configuration required other than selecting **Collect W3C format IIS log files**.</span></span>

<span data-ttu-id="2cfb3-113">Если вы включаете сбор данных журналов IIS, рекомендуем настроить на каждом сервере переход на журналы IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-113">We recommend that when you enable IIS log collection, you should configure the IIS log rollover setting on each server.</span></span>

## <a name="data-collection"></a><span data-ttu-id="2cfb3-114">Сбор данных</span><span class="sxs-lookup"><span data-stu-id="2cfb3-114">Data collection</span></span>
<span data-ttu-id="2cfb3-115">Log Analytics собирает записи в журналах IIS из каждого подключенного источника примерно раз в 15 минут.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-115">Log Analytics collects IIS log entries from each connected source approximately every 15 minutes.</span></span>  <span data-ttu-id="2cfb3-116">Агент фиксирует место сбора в каждом журнале событий, который используется для сбора данных.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-116">The agent records its place in each event log that it collects from.</span></span>  <span data-ttu-id="2cfb3-117">Если агент перейдет в автономный режим, Log Analytics собирает события, начиная с места остановки, даже если эти события были созданы, пока агент находился вне сети.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-117">If the agent goes offline, then Log Analytics collects events from where it last left off, even if those events were created while the agent was offline.</span></span>

## <a name="iis-log-record-properties"></a><span data-ttu-id="2cfb3-118">Свойства записей в журналах IIS</span><span class="sxs-lookup"><span data-stu-id="2cfb3-118">IIS log record properties</span></span>
<span data-ttu-id="2cfb3-119">Записи в журналах IIS относятся к типу **W3CIISLog** и обладают свойствами, описанными в таблице ниже.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-119">IIS log records have a type of **W3CIISLog** and have the properties in the following table:</span></span>

| <span data-ttu-id="2cfb3-120">Свойство</span><span class="sxs-lookup"><span data-stu-id="2cfb3-120">Property</span></span> | <span data-ttu-id="2cfb3-121">Описание</span><span class="sxs-lookup"><span data-stu-id="2cfb3-121">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="2cfb3-122">Компьютер</span><span class="sxs-lookup"><span data-stu-id="2cfb3-122">Computer</span></span> |<span data-ttu-id="2cfb3-123">Имя компьютера, с которого было получено событие.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-123">Name of the computer that the event was collected from.</span></span> |
| <span data-ttu-id="2cfb3-124">cIP</span><span class="sxs-lookup"><span data-stu-id="2cfb3-124">cIP</span></span> |<span data-ttu-id="2cfb3-125">IP-адрес клиента.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-125">IP address of the client.</span></span> |
| <span data-ttu-id="2cfb3-126">csMethod</span><span class="sxs-lookup"><span data-stu-id="2cfb3-126">csMethod</span></span> |<span data-ttu-id="2cfb3-127">Метод запроса, такой как GET или POST.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-127">Method of the request such as GET or POST.</span></span> |
| <span data-ttu-id="2cfb3-128">csReferer</span><span class="sxs-lookup"><span data-stu-id="2cfb3-128">csReferer</span></span> |<span data-ttu-id="2cfb3-129">Сайт, с которого пользователь перешел на текущий сайт.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-129">Site that the user followed a link from to the current site.</span></span> |
| <span data-ttu-id="2cfb3-130">csUserAgent</span><span class="sxs-lookup"><span data-stu-id="2cfb3-130">csUserAgent</span></span> |<span data-ttu-id="2cfb3-131">Тип браузера клиента.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-131">Browser type of the client.</span></span> |
| <span data-ttu-id="2cfb3-132">csUserName</span><span class="sxs-lookup"><span data-stu-id="2cfb3-132">csUserName</span></span> |<span data-ttu-id="2cfb3-133">Имя прошедшего проверку пользователя, который подключился к серверу.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-133">Name of the authenticated user that accessed the server.</span></span> <span data-ttu-id="2cfb3-134">Анонимные пользователи обозначаются дефисом.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-134">Anonymous users are indicated by a hyphen.</span></span> |
| <span data-ttu-id="2cfb3-135">csUriStem</span><span class="sxs-lookup"><span data-stu-id="2cfb3-135">csUriStem</span></span> |<span data-ttu-id="2cfb3-136">Целевой объект запроса, такой как веб-страница.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-136">Target of the request such as a web page.</span></span> |
| <span data-ttu-id="2cfb3-137">csUriQuery</span><span class="sxs-lookup"><span data-stu-id="2cfb3-137">csUriQuery</span></span> |<span data-ttu-id="2cfb3-138">Запрос, который пытался выполнить клиент (если есть).</span><span class="sxs-lookup"><span data-stu-id="2cfb3-138">Query, if any, that the client was trying to perform.</span></span> |
| <span data-ttu-id="2cfb3-139">ManagementGroupName</span><span class="sxs-lookup"><span data-stu-id="2cfb3-139">ManagementGroupName</span></span> |<span data-ttu-id="2cfb3-140">Имя группы управления для агентов Operations Manager.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-140">Name of the management group for Operations Manager agents.</span></span>  <span data-ttu-id="2cfb3-141">Для других агентов это AOI-\<идентификатор_рабочей_области\>.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-141">For other agents, this is AOI-\<workspace ID\></span></span> |
| <span data-ttu-id="2cfb3-142">RemoteIPCountry</span><span class="sxs-lookup"><span data-stu-id="2cfb3-142">RemoteIPCountry</span></span> |<span data-ttu-id="2cfb3-143">Страна IP-адреса клиента.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-143">Country of the IP address of the client.</span></span> |
| <span data-ttu-id="2cfb3-144">RemoteIPLatitude</span><span class="sxs-lookup"><span data-stu-id="2cfb3-144">RemoteIPLatitude</span></span> |<span data-ttu-id="2cfb3-145">Широта IP-адреса клиента.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-145">Latitude of the client IP address.</span></span> |
| <span data-ttu-id="2cfb3-146">RemoteIPLongitude</span><span class="sxs-lookup"><span data-stu-id="2cfb3-146">RemoteIPLongitude</span></span> |<span data-ttu-id="2cfb3-147">Долгота IP-адреса клиента.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-147">Longitude of the client IP address.</span></span> |
| <span data-ttu-id="2cfb3-148">scStatus</span><span class="sxs-lookup"><span data-stu-id="2cfb3-148">scStatus</span></span> |<span data-ttu-id="2cfb3-149">Код состояния HTTP.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-149">HTTP status code.</span></span> |
| <span data-ttu-id="2cfb3-150">scSubStatus</span><span class="sxs-lookup"><span data-stu-id="2cfb3-150">scSubStatus</span></span> |<span data-ttu-id="2cfb3-151">Код ошибки подсостояния .</span><span class="sxs-lookup"><span data-stu-id="2cfb3-151">Substatus error code.</span></span> |
| <span data-ttu-id="2cfb3-152">scWin32Status</span><span class="sxs-lookup"><span data-stu-id="2cfb3-152">scWin32Status</span></span> |<span data-ttu-id="2cfb3-153">Код состояния Windows.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-153">Windows status code.</span></span> |
| <span data-ttu-id="2cfb3-154">sIP</span><span class="sxs-lookup"><span data-stu-id="2cfb3-154">sIP</span></span> |<span data-ttu-id="2cfb3-155">IP-адрес веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-155">IP address of the web server.</span></span> |
| <span data-ttu-id="2cfb3-156">SourceSystem</span><span class="sxs-lookup"><span data-stu-id="2cfb3-156">SourceSystem</span></span> |<span data-ttu-id="2cfb3-157">OpsMgr</span><span class="sxs-lookup"><span data-stu-id="2cfb3-157">OpsMgr</span></span> |
| <span data-ttu-id="2cfb3-158">sPort</span><span class="sxs-lookup"><span data-stu-id="2cfb3-158">sPort</span></span> |<span data-ttu-id="2cfb3-159">Порт на сервере, к которому подключен клиент.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-159">Port on the server the client connected to.</span></span> |
| <span data-ttu-id="2cfb3-160">sSiteName</span><span class="sxs-lookup"><span data-stu-id="2cfb3-160">sSiteName</span></span> |<span data-ttu-id="2cfb3-161">Имя сайта IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-161">Name of the IIS site.</span></span> |
| <span data-ttu-id="2cfb3-162">TimeGenerated</span><span class="sxs-lookup"><span data-stu-id="2cfb3-162">TimeGenerated</span></span> |<span data-ttu-id="2cfb3-163">Дата и время регистрации записи.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-163">Date and time the entry was logged.</span></span> |
| <span data-ttu-id="2cfb3-164">TimeTaken</span><span class="sxs-lookup"><span data-stu-id="2cfb3-164">TimeTaken</span></span> |<span data-ttu-id="2cfb3-165">Время обработки запроса в миллисекундах.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-165">Length of time to process the request in milliseconds.</span></span> |

## <a name="log-searches-with-iis-logs"></a><span data-ttu-id="2cfb3-166">Поиск по журналами с помощью журналов IIS</span><span class="sxs-lookup"><span data-stu-id="2cfb3-166">Log searches with IIS logs</span></span>
<span data-ttu-id="2cfb3-167">В следующей таблице представлены различные примеры запросов к журналу, извлекающих записи из журналов IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-167">The following table provides different examples of log queries that retrieve IIS log records.</span></span>

| <span data-ttu-id="2cfb3-168">Запрос</span><span class="sxs-lookup"><span data-stu-id="2cfb3-168">Query</span></span> | <span data-ttu-id="2cfb3-169">Описание</span><span class="sxs-lookup"><span data-stu-id="2cfb3-169">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="2cfb3-170">Type=W3CIISLog</span><span class="sxs-lookup"><span data-stu-id="2cfb3-170">Type=W3CIISLog</span></span> |<span data-ttu-id="2cfb3-171">Все записи в журнале IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-171">All IIS log records.</span></span> |
| <span data-ttu-id="2cfb3-172">Type=W3CIISLog scStatus=500</span><span class="sxs-lookup"><span data-stu-id="2cfb3-172">Type=W3CIISLog scStatus=500</span></span> |<span data-ttu-id="2cfb3-173">Все записи журнала IIS с состоянием возврата 500.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-173">All IIS log records with a return status of 500.</span></span> |
| <span data-ttu-id="2cfb3-174">Type=W3CIISLog &#124; Measure count() by cIP</span><span class="sxs-lookup"><span data-stu-id="2cfb3-174">Type=W3CIISLog &#124; Measure count() by cIP</span></span> |<span data-ttu-id="2cfb3-175">Число записей в журнале IIS по IP-адресу клиента.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-175">Count of IIS log entries by client IP address.</span></span> |
| <span data-ttu-id="2cfb3-176">Type=W3CIISLog csHost="www.contoso.com" &#124; Measure count() by csUriStem</span><span class="sxs-lookup"><span data-stu-id="2cfb3-176">Type=W3CIISLog csHost="www.contoso.com" &#124; Measure count() by csUriStem</span></span> |<span data-ttu-id="2cfb3-177">Число записей в журнале IIS по URL-адресу для узла www.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-177">Count of IIS log entries by URL for the host www.contoso.com.</span></span> |
| <span data-ttu-id="2cfb3-178">Type=W3CIISLog &#124; Measure Sum(csBytes) by Computer &#124; top 500000</span><span class="sxs-lookup"><span data-stu-id="2cfb3-178">Type=W3CIISLog &#124; Measure Sum(csBytes) by Computer &#124; top 500000</span></span> |<span data-ttu-id="2cfb3-179">Общее количество байтов, полученных каждым компьютером IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-179">Total bytes received by each IIS computer.</span></span> |

>[!NOTE]
> <span data-ttu-id="2cfb3-180">Если ваша рабочая область переведена на [язык запросов Log Analytics](log-analytics-log-search-upgrade.md), указанные выше запросы будут изменены следующим образом.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-180">If your workspace has been upgraded to the [new Log Analytics query language](log-analytics-log-search-upgrade.md), then the above queries would change to the following.</span></span>

> | <span data-ttu-id="2cfb3-181">Запрос</span><span class="sxs-lookup"><span data-stu-id="2cfb3-181">Query</span></span> | <span data-ttu-id="2cfb3-182">Описание</span><span class="sxs-lookup"><span data-stu-id="2cfb3-182">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="2cfb3-183">W3CIISLog</span><span class="sxs-lookup"><span data-stu-id="2cfb3-183">W3CIISLog</span></span> |<span data-ttu-id="2cfb3-184">Все записи в журнале IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-184">All IIS log records.</span></span> |
| <span data-ttu-id="2cfb3-185">W3CIISLog &#124; where scStatus==500</span><span class="sxs-lookup"><span data-stu-id="2cfb3-185">W3CIISLog &#124; where scStatus==500</span></span> |<span data-ttu-id="2cfb3-186">Все записи журнала IIS с состоянием возврата 500.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-186">All IIS log records with a return status of 500.</span></span> |
| <span data-ttu-id="2cfb3-187">W3CIISLog &#124; summarize count() by cIP</span><span class="sxs-lookup"><span data-stu-id="2cfb3-187">W3CIISLog &#124; summarize count() by cIP</span></span> |<span data-ttu-id="2cfb3-188">Число записей в журнале IIS по IP-адресу клиента.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-188">Count of IIS log entries by client IP address.</span></span> |
| <span data-ttu-id="2cfb3-189">W3CIISLog &#124; where csHost=="www.contoso.com" &#124; summarize count() by csUriStem</span><span class="sxs-lookup"><span data-stu-id="2cfb3-189">W3CIISLog &#124; where csHost=="www.contoso.com" &#124; summarize count() by csUriStem</span></span> |<span data-ttu-id="2cfb3-190">Число записей в журнале IIS по URL-адресу для узла www.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-190">Count of IIS log entries by URL for the host www.contoso.com.</span></span> |
| <span data-ttu-id="2cfb3-191">W3CIISLog &#124; summarize sum(csBytes) by Computer &#124; take 500000</span><span class="sxs-lookup"><span data-stu-id="2cfb3-191">W3CIISLog &#124; summarize sum(csBytes) by Computer &#124; take 500000</span></span> |<span data-ttu-id="2cfb3-192">Общее количество байтов, полученных каждым компьютером IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-192">Total bytes received by each IIS computer.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="2cfb3-193">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="2cfb3-193">Next steps</span></span>
* <span data-ttu-id="2cfb3-194">Настройте службу Log Analytics для сбора других [источников данных](log-analytics-data-sources.md) для анализа.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-194">Configure Log Analytics to collect other [data sources](log-analytics-data-sources.md) for analysis.</span></span>
* <span data-ttu-id="2cfb3-195">Узнайте больше об [операциях поиска по журналу](log-analytics-log-searches.md) , которые можно применять для анализа данных, собираемых из источников данных и решений.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-195">Learn about [log searches](log-analytics-log-searches.md) to analyze the data collected from data sources and solutions.</span></span>
* <span data-ttu-id="2cfb3-196">Настройте оповещения в службе Log Analytics для получения заблаговременных уведомлений о важных условиях, обнаруженных в журналах IIS.</span><span class="sxs-lookup"><span data-stu-id="2cfb3-196">Configure alerts in Log Analytics to proactively notify you of important conditions found in IIS logs.</span></span>
