---
title: "aaaBest и рекомендации для автомасштабирования | Документы Microsoft"
description: "Шаблоны автоматического масштабирования в веб-приложениях службы приложений Azure, масштабируемых наборах виртуальных машин и облачных службах"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: eb731c15e440af93a2675210583878814d0d8818
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-autoscale"></a>Рекомендации по автомасштабированию
В этой статье объясняется, советы и рекомендации tooautoscale в Azure. Azure автомасштабирования монитор также применяется только[наборы масштабирования виртуальных машин](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [облачные службы](https://azure.microsoft.com/services/cloud-services/), и [службы приложений — веб-приложений](https://azure.microsoft.com/services/app-service/web/). Прочие службы Azure используют другие методы масштабирования.

## <a name="autoscale-concepts"></a>Основные понятия автомасштабирования
* У ресурса может быть только *один* параметр автомасштабирования.
* У параметра автомасштабирования может быть один или несколько профилей, и каждый профиль может содержать одно или несколько правил автомасштабирования.
* Параметров автоматического масштабирования масштабирует экземпляры по горизонтали, который является *out* , увеличение числа экземпляров hello и *в* за счет уменьшения числа hello экземпляров.
  Параметр автомасштабирования определяет максимальное, минимальное и используемое по умолчанию число экземпляров.
* Задание автоматического масштабирования всегда читает hello связанной метрики tooscale путем проверки, если оно превысило hello пороговое значение для масштабирования или масштабирования в. Список метрик для автомасштабирования можно просмотреть в статье, посвященной [общим метрикам автомасштабирования Azure Monitor](insights-autoscale-common-metrics.md).
* Все пороговые значения вычисляются на уровне экземпляров. Например «масштабирование помещает по 1 экземпляр при среднее число ЦП > 80%, если число экземпляров равно 2», означает масштабирования, когда hello средняя загрузка ЦП для всех экземпляров превышает 80%.
* Уведомления о сбоях всегда приходят по электронной почте. В частности hello владельца, участники и читатели hello целевой ресурс получать по электронной почте. Кроме того, вы всегда получаете сообщение о *восстановлении*, когда работа службы автомасштабирования восстанавливается после сбоя и она начинает нормально функционировать.
* Можно включить в tooreceive уведомление о действии успешного масштабирования посредством электронной почты и веб-привязок.

## <a name="autoscale-best-practices"></a>Рекомендации по автомасштабированию
Используйте следующие рекомендации при использовании автомасштабирования hello.

### <a name="ensure-hello-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a>Убедитесь, максимальное и минимальное значения hello отличаются и имеют достаточно поле между ними
Если у вас есть параметр, который имеет минимальное = 2, максимальное = 2 и текущее количество экземпляров hello — 2, может произойти без масштабирования. Сохраните достаточно поле между количество экземпляров максимальное и минимальное hello, которые являются включительно. Служба автомасштабирования всегда масштабирует экземпляры в этих границах.

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a>Параметры масштабирования вручную будут сброшены заданными для автомасштабирования минимальным и максимальным значениями.
Если вручную обновить hello экземпляр tooa значение счетчика выше или ниже максимально hello hello автомасштабирования engine автоматически масштабирует задней toohello минимальное (Если ниже) или hello максимальное (если это значение больше). Например можно задать диапазон hello от 3 до 6. Если у вас есть один запущенный экземпляр, механизм автоматического масштабирования hello масштабирует экземпляров too3 выполняться. Аналогичным образом, он будет масштабирования в восьми экземпляров резервное too6 выполняться.  Ручное масштабирование является очень временных, если сбросить также правил автомасштабирования hello.

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a>Всегда используйте сочетание правил развертывания и свертывания, которые обеспечивают увеличение и уменьшение количества экземпляров.
При использовании только одной части сочетания hello автомасштабирования шкалы, в которых один out или in, пока hello максимум или минимум, достигнут.

### <a name="do-not-switch-between-hello-azure-portal-and-hello-azure-classic-portal-when-managing-autoscale"></a>Не переключаться между hello портал Azure и hello классический портал Azure, при управлении автоматического масштабирования
Облачные службы и службы приложений (веб-приложений) использовать портал Azure (portal.azure.com) toocreate hello и управление параметрами автоматического масштабирования. Наборы масштабирования виртуальных машин используйте toocreate PowerShell, CLI или REST API и управление ими параметров автоматического масштабирования. Не переключает hello классический портал Azure (адресу manage.windowsazure.com) и hello портал Azure (portal.azure.com) при управлении конфигураций автоматического масштабирования. Здравствуйте классический портал Azure и его базовой базы данных имеет ограничения. Переместите автомасштабирования Azure портала toomanage toohello с помощью графического пользовательского интерфейса. Параметры Hello, toouse hello автомасштабирования PowerShell, CLI или API REST (с помощью обозревателя ресурсов Azure).

### <a name="choose-hello-appropriate-statistic-for-your-diagnostics-metric"></a>Выберите hello соответствующие статистический показатель на диагностические метрики
Метрики диагностики можно выбрать среди *среднее*, *минимум*, *максимальное* и *общее* как метрики tooscale по. наиболее распространенные Hello статистический показатель представляет *среднее*.

### <a name="choose-hello-thresholds-carefully-for-all-metric-types"></a>Выберите пороговые значения hello тщательно для всех типов метрики
Рекомендуется тщательно выбирать различные пороговые значения для развертывания и свертывания в зависимости от практических ситуаций.

Мы *не рекомендует* параметры автоматического масштабирования, например hello приведенные ниже примеры с hello одинаковые или очень похожие пороговые значения для извлечение и возврат условий:

* Увеличение числа экземпляров на 1, если число потоков ≤ 600
* Уменьшение числа экземпляров на 1, если число потоков ≥ 600

Давайте рассмотрим пример, что может привести к tooa поведение, которое может показаться противоречивым. Рассмотрим следующие последовательности hello.

1. Предполагают, 2 toobegin экземпляров с помощью и затем hello среднее число потоков на один экземпляр роста too625.
2. Служба автомасштабирования разворачивает третий экземпляр.
3. Далее предположим, что счетчика потока среднее hello через экземпляр становится too575.
4. Перед уменьшения масштаба автомасштабирования предпринимает tooestimate конечное состояние какая hello будет если ее масштабируется по. Например, 575 x 3 (текущее количество экземпляров) = 1725 / 2 (итоговое количество экземпляров после уменьшения масштаба) = 862,5 потока. Это означает, что Автомасштабирование tooimmediately масштабирования снова даже после его масштабируется по, если бы остается hello потока среднее число hello же или даже становится очень мало. Тем не менее если он масштабировать в сторону увеличения, hello весь процесс будет повторяться, начальные tooan бесконечный цикл.
5. tooavoid этой ситуации (называется «flapping»), автомасштабирования не масштабировать вообще. Вместо этого пропускает и заново оценивает hello условие снова выполняет задание hello Далее время hello службы. Это может перепутать многие пользователи, поскольку автомасштабирования бы выглядеть toowork hello потока среднее число было 575.

Оценка во время масштабирования в является предполагаемым tooavoid «неустойчивый» ситуациях действия в масштабирования и масштабирования постоянно куда вперед и назад. При выборе hello же пороговые значения для масштабного развертывания, а также в учитывайте это поведение.

Рекомендуется выбирать соответствующие поля, между hello масштабирования и пороговых значений. Например рассмотрим следующие комбинации лучше правило hello.

* Увеличивать количество экземпляров на 1, если загрузка ЦП ≥ 80.
* Уменьшение числа экземпляров на 1, если загрузка ЦП ≤ 60

В данном случае:  

1. Предположим, что существует 2 toostart экземпляры с.
2. Если hello средний процент ЦП всех экземпляров становится too80, автомасштабирования масштабируемостью Добавление третий экземпляр.
3. Теперь предположим, что за время ЦП hello % попадает too60.
4. Правило автоматического масштабирования элемента шкалы в оценивает hello конечное состояние, будто tooscale в. Например, 60 x 3 (текущее число экземпляров) = 180 / 2 (итоговое число экземпляров после уменьшения масштаба) = 90. Поэтому автомасштабирования не шкалы в из-за ожидания tooscale бы немедленно. Вместо этого она пропускает уменьшение масштаба.
5. проверяет Далее время автомасштабирования Hello, hello ЦП по-прежнему toofall too50. Он снова - оценивает экземпляр 50 x 3 = 150 / 2 экземпляров = 75, который находится под hello масштабирования пороговое значение 80, поэтому она может масштабироваться в успешно too2 экземпляров.

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a>Рекомендации по пороговым значениям масштабирования для специальных метрик
 Специальные метрик, таких как длина метрики хранилища или очереди шины обслуживания hello пороговое значение составляет hello среднее число сообщений, доступных для текущего числа экземпляров. Тщательно выбирать hello выберите hello пороговое значение для этой метрики.

Проиллюстрируем его с tooensure примере понять поведение hello лучше.

* Увеличение числа экземпляров на 1, когда число сообщений в очереди хранилища ≥ 50
* Уменьшение числа экземпляров на 1, когда число сообщений в очереди хранилища ≤ 10

Примите во внимание следующие последовательности hello.

1. Существует 2 экземпляра очереди хранилища.
2. Сохранить поступающих сообщений и при просмотре хранилища очереди hello hello всего считывает 50. Вы можете предположить, что служба автомасштабирования должна начать развертывание. Однако обратите внимание, что число сообщений для каждого экземпляра по-прежнему 50 / 2 = 25. Поэтому развертывание не происходит. Для первого toohappen масштабирования hello hello общее количество сообщений в очереди хранилища hello должно быть 100.
3. Далее предположим, что hello общее количество сообщений достигает 100.
4. Из-за действия масштабирования tooa добавляется третий экземпляр очереди хранилища.  Hello следующее действие масштабирования не произойдет до hello общее количество сообщений в очереди hello достигает 150, так как 150-3 = 50.
5. Теперь hello количество сообщений в очереди hello уменьшается. С 3 экземплярами hello первое масштабирования в действие происходит, когда hello сложить всего сообщений во всех очередях too30, так как 30/3 = 10 сообщений на экземпляр, являющийся hello масштабирования в пороговое значение.

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a>Рекомендации по масштабированию при настройке нескольких профилей в параметре автомасштабирования
В параметре автомасштабирования можно выбрать профиль по умолчанию, который применяется всегда, вне зависимости от расписания или времени. Также можно выбрать профиль повторения или профиль для фиксированного периода с диапазоном дат и времени.

Когда служба автоматического масштабирования, обрабатывает их, всегда проверяет в hello следующий порядок:

1. профиль с фиксированной датой;
2. профиль повторения;
3. профиль по умолчанию ("Всегда").

При выполнении условия профиль автомасштабирования не проверяет hello следующего условия профиля под ней. Служба автомасштабирования обрабатывает только один профиль за раз. Это означает, что если требуется tooalso включить условие обработки из профиля более низкого уровня, необходимо включить эти правила также hello текущему профилю.

Рассмотрим это на примере.

Hello ниже рисунке параметров автоматического масштабирования с профилем по умолчанию минимальное экземпляров = 2 до максимального, экземпляр = 10. В этом примере правила, настроенного tooscale масштабирование при hello количество сообщений в очереди hello больше 10 и масштаб в при hello количество сообщений в очереди hello — меньше 3. Поэтому теперь hello ресурсов можно масштабировать от 2 до 10 экземпляров.

Кроме того, имеется профиль повторения, настроенный на "Понедельник". В нем задано минимальное число экземпляров, равное 2, и максимальное число экземпляров, равное 12. Это означает в понедельник, первый раз автомасштабирования hello проверяет это условие, если число экземпляров hello 2, он является масштабируемым toohello новый минимум 3. При условии, что Автомасштабирование по-прежнему toofind это условие профиль соответствует (понедельник), он обрабатывает только hello ЦП шкалы out или в правила на основе настроенных для данного профиля. В настоящее время он не проверяет наличие длина очереди hello. Тем не менее если также требуется hello длина очереди условие toobe этот флажок установлен, необходимо включить эти правила из профиля по умолчанию hello также в понедельник профиль.

Аналогичным образом когда Автомасштабирование переключается назад toohello профиль по умолчанию, его сначала проверяет Если hello минимальное и максимальное условий. Если hello число экземпляров во время hello 12, она может масштабироваться в too10, hello максимально допустимое для профиль по умолчанию hello.

![Параметры автомасштабирования](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a>Рекомендации по масштабированию при настройке нескольких правил в профиле
Существуют случаи, в которых используется tooset несколько правил в профиле. Следующий набор правил автомасштабирования Hello используются с помощью служб при установке нескольких правил.

Для запуска *развертывания* службе автомасштабирования достаточно, чтобы выполнялось любое из правил.
На *масштабирования в*, все правила выполнены toobe требуют автоматического масштабирования.

tooillustrate, предполагается, что hello 4 автомасштабирования правилам:

* если загрузка ЦП < 30 %, свернуть 1 экземпляр;
* если объем используемой памяти < 50 %, свернуть 1 экземпляр;
* если загрузка ЦП > 75 %, развернуть 1 экземпляр;
* если объем используемой памяти > 75 %, развернуть 1 экземпляр.

Затем происходит hello выполните:

* Если ресурсы ЦП загружены на 76 % и занято 50 % памяти, будет выполнено развертывание.
* Если ресурсы ЦП загружены на 50 % и занято 76 % памяти, будет выполнено развертывание.

На hello другой стороны, если является 25% ЦП и памяти, выполняет автомасштабирования 51% **не** в шкалы. В порядке в tooscale ЦП должно быть 29% и памяти 49%.

### <a name="always-select-a-safe-default-instance-count"></a>Всегда выбирайте безопасное число экземпляров по умолчанию
число экземпляров по умолчанию Hello важно, автомасштабирования масштабируется счетчик toothat вашей службы, если метрики недоступны. Поэтому выберите число экземпляров по умолчанию, являющееся безопасным для рабочих нагрузок.

### <a name="configure-autoscale-notifications"></a>Настройка уведомлений об автомасштабировании
Автомасштабирование уведомляет администраторов hello и участники hello ресурса по электронной почте при возникновении любого из следующих условий hello:

* Служба автоматического масштабирования не tootake действие.
* Метрики недоступны для автоматического масштабирования службы toomake шкалы принятия решений.
* Показатели, доступных (восстановление) снова toomake шкалы принятия решений.
  Кроме того при условиях toohello выше, можно настроить tooget уведомления по электронной почте или веб-перехватчика уведомление о том, для успешного масштабирования действий.
  
Также можно использовать журнал действий предупреждения toomonitor hello работоспособность подсистемы автомасштабирования hello. Ниже приведены примеры слишком[создать предупреждение журналов действий toomonitor всех операций автомасштабирования обработчика по подписке](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) или слишком[создать предупреждение журналов действий toomonitor, все Сбой автоматического масштабирования шкалы в / масштабирования операций подписки](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).

## <a name="next-steps"></a>Дальнейшие действия
- [Создайте предупреждение журналов действий toomonitor всех операций автомасштабирования обработчика для одной подписки.](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [Создать предупреждение журналов действий toomonitor, все Сбой автоматического масштабирования шкалы в / масштабирование операций по подписке](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
