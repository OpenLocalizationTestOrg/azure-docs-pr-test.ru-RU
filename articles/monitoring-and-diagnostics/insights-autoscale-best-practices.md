---
title: "aaaBest и рекомендации для автомасштабирования | Документы Microsoft"
description: "Шаблоны автоматического масштабирования в веб-приложениях службы приложений Azure, масштабируемых наборах виртуальных машин и облачных службах"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: eb731c15e440af93a2675210583878814d0d8818
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="bb947-103">Рекомендации по автомасштабированию</span><span class="sxs-lookup"><span data-stu-id="bb947-103">Best practices for Autoscale</span></span>
<span data-ttu-id="bb947-104">В этой статье объясняется, советы и рекомендации tooautoscale в Azure.</span><span class="sxs-lookup"><span data-stu-id="bb947-104">This article teaches best practices tooautoscale in Azure.</span></span> <span data-ttu-id="bb947-105">Azure автомасштабирования монитор также применяется только[наборы масштабирования виртуальных машин](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [облачные службы](https://azure.microsoft.com/services/cloud-services/), и [службы приложений — веб-приложений](https://azure.microsoft.com/services/app-service/web/).</span><span class="sxs-lookup"><span data-stu-id="bb947-105">Azure Monitor autoscale applies only too[Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="bb947-106">Прочие службы Azure используют другие методы масштабирования.</span><span class="sxs-lookup"><span data-stu-id="bb947-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="bb947-107">Основные понятия автомасштабирования</span><span class="sxs-lookup"><span data-stu-id="bb947-107">Autoscale concepts</span></span>
* <span data-ttu-id="bb947-108">У ресурса может быть только *один* параметр автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="bb947-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="bb947-109">У параметра автомасштабирования может быть один или несколько профилей, и каждый профиль может содержать одно или несколько правил автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="bb947-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="bb947-110">Параметров автоматического масштабирования масштабирует экземпляры по горизонтали, который является *out* , увеличение числа экземпляров hello и *в* за счет уменьшения числа hello экземпляров.</span><span class="sxs-lookup"><span data-stu-id="bb947-110">An autoscale setting scales instances horizontally, which is *out* by increasing hello instances and *in* by decreasing hello number of instances.</span></span>
  <span data-ttu-id="bb947-111">Параметр автомасштабирования определяет максимальное, минимальное и используемое по умолчанию число экземпляров.</span><span class="sxs-lookup"><span data-stu-id="bb947-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="bb947-112">Задание автоматического масштабирования всегда читает hello связанной метрики tooscale путем проверки, если оно превысило hello пороговое значение для масштабирования или масштабирования в.</span><span class="sxs-lookup"><span data-stu-id="bb947-112">An autoscale job always reads hello associated metric tooscale by, checking if it has crossed hello configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="bb947-113">Список метрик для автомасштабирования можно просмотреть в статье, посвященной [общим метрикам автомасштабирования Azure Monitor](insights-autoscale-common-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="bb947-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="bb947-114">Все пороговые значения вычисляются на уровне экземпляров.</span><span class="sxs-lookup"><span data-stu-id="bb947-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="bb947-115">Например «масштабирование помещает по 1 экземпляр при среднее число ЦП > 80%, если число экземпляров равно 2», означает масштабирования, когда hello средняя загрузка ЦП для всех экземпляров превышает 80%.</span><span class="sxs-lookup"><span data-stu-id="bb947-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when hello average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="bb947-116">Уведомления о сбоях всегда приходят по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="bb947-116">You always receive failure notifications via email.</span></span> <span data-ttu-id="bb947-117">В частности hello владельца, участники и читатели hello целевой ресурс получать по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="bb947-117">Specifically, hello owner, contributor, and readers of hello target resource receive email.</span></span> <span data-ttu-id="bb947-118">Кроме того, вы всегда получаете сообщение о *восстановлении*, когда работа службы автомасштабирования восстанавливается после сбоя и она начинает нормально функционировать.</span><span class="sxs-lookup"><span data-stu-id="bb947-118">You also always receive a *recovery* email when autoscale recovers from a failure and starts functioning normally.</span></span>
* <span data-ttu-id="bb947-119">Можно включить в tooreceive уведомление о действии успешного масштабирования посредством электронной почты и веб-привязок.</span><span class="sxs-lookup"><span data-stu-id="bb947-119">You can opt-in tooreceive a successful scale action notification via email and webhooks.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="bb947-120">Рекомендации по автомасштабированию</span><span class="sxs-lookup"><span data-stu-id="bb947-120">Autoscale best practices</span></span>
<span data-ttu-id="bb947-121">Используйте следующие рекомендации при использовании автомасштабирования hello.</span><span class="sxs-lookup"><span data-stu-id="bb947-121">Use hello following best practices as you use autoscale.</span></span>

### <a name="ensure-hello-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="bb947-122">Убедитесь, максимальное и минимальное значения hello отличаются и имеют достаточно поле между ними</span><span class="sxs-lookup"><span data-stu-id="bb947-122">Ensure hello maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="bb947-123">Если у вас есть параметр, который имеет минимальное = 2, максимальное = 2 и текущее количество экземпляров hello — 2, может произойти без масштабирования.</span><span class="sxs-lookup"><span data-stu-id="bb947-123">If you have a setting that has minimum=2, maximum=2 and hello current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="bb947-124">Сохраните достаточно поле между количество экземпляров максимальное и минимальное hello, которые являются включительно.</span><span class="sxs-lookup"><span data-stu-id="bb947-124">Keep an adequate margin between hello maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="bb947-125">Служба автомасштабирования всегда масштабирует экземпляры в этих границах.</span><span class="sxs-lookup"><span data-stu-id="bb947-125">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="bb947-126">Параметры масштабирования вручную будут сброшены заданными для автомасштабирования минимальным и максимальным значениями.</span><span class="sxs-lookup"><span data-stu-id="bb947-126">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="bb947-127">Если вручную обновить hello экземпляр tooa значение счетчика выше или ниже максимально hello hello автомасштабирования engine автоматически масштабирует задней toohello минимальное (Если ниже) или hello максимальное (если это значение больше).</span><span class="sxs-lookup"><span data-stu-id="bb947-127">If you manually update hello instance count tooa value above or below hello maximum, hello autoscale engine automatically scales back toohello minimum (if below) or hello maximum (if above).</span></span> <span data-ttu-id="bb947-128">Например можно задать диапазон hello от 3 до 6.</span><span class="sxs-lookup"><span data-stu-id="bb947-128">For example, you set hello range between 3 and 6.</span></span> <span data-ttu-id="bb947-129">Если у вас есть один запущенный экземпляр, механизм автоматического масштабирования hello масштабирует экземпляров too3 выполняться.</span><span class="sxs-lookup"><span data-stu-id="bb947-129">If you have one running instance, hello autoscale engine scales too3 instances on its next run.</span></span> <span data-ttu-id="bb947-130">Аналогичным образом, он будет масштабирования в восьми экземпляров резервное too6 выполняться.</span><span class="sxs-lookup"><span data-stu-id="bb947-130">Likewise, it would scale-in 8 instances back too6 on its next run.</span></span>  <span data-ttu-id="bb947-131">Ручное масштабирование является очень временных, если сбросить также правил автомасштабирования hello.</span><span class="sxs-lookup"><span data-stu-id="bb947-131">Manual scaling is very temporary unless you reset hello autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="bb947-132">Всегда используйте сочетание правил развертывания и свертывания, которые обеспечивают увеличение и уменьшение количества экземпляров.</span><span class="sxs-lookup"><span data-stu-id="bb947-132">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="bb947-133">При использовании только одной части сочетания hello автомасштабирования шкалы, в которых один out или in, пока hello максимум или минимум, достигнут.</span><span class="sxs-lookup"><span data-stu-id="bb947-133">If you use only one part of hello combination, autoscale scale-in that single out, or in, until hello maximum, or minimum, is reached.</span></span>

### <a name="do-not-switch-between-hello-azure-portal-and-hello-azure-classic-portal-when-managing-autoscale"></a><span data-ttu-id="bb947-134">Не переключаться между hello портал Azure и hello классический портал Azure, при управлении автоматического масштабирования</span><span class="sxs-lookup"><span data-stu-id="bb947-134">Do not switch between hello Azure portal and hello Azure classic portal when managing Autoscale</span></span>
<span data-ttu-id="bb947-135">Облачные службы и службы приложений (веб-приложений) использовать портал Azure (portal.azure.com) toocreate hello и управление параметрами автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="bb947-135">For Cloud Services and App Services (Web Apps), use hello Azure portal (portal.azure.com) toocreate and manage autoscale settings.</span></span> <span data-ttu-id="bb947-136">Наборы масштабирования виртуальных машин используйте toocreate PowerShell, CLI или REST API и управление ими параметров автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="bb947-136">For Virtual Machine Scale Sets use PowerShell, CLI or REST API toocreate and manage autoscale setting.</span></span> <span data-ttu-id="bb947-137">Не переключает hello классический портал Azure (адресу manage.windowsazure.com) и hello портал Azure (portal.azure.com) при управлении конфигураций автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="bb947-137">Do not switch between hello Azure classic portal (manage.windowsazure.com) and hello Azure portal (portal.azure.com) when managing autoscale configurations.</span></span> <span data-ttu-id="bb947-138">Здравствуйте классический портал Azure и его базовой базы данных имеет ограничения.</span><span class="sxs-lookup"><span data-stu-id="bb947-138">hello Azure classic portal and its underlying backend has limitations.</span></span> <span data-ttu-id="bb947-139">Переместите автомасштабирования Azure портала toomanage toohello с помощью графического пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="bb947-139">Move toohello Azure portal toomanage autoscale using a graphical user interface.</span></span> <span data-ttu-id="bb947-140">Параметры Hello, toouse hello автомасштабирования PowerShell, CLI или API REST (с помощью обозревателя ресурсов Azure).</span><span class="sxs-lookup"><span data-stu-id="bb947-140">hello options are toouse hello autoscale PowerShell, CLI or REST API (via Azure Resource Explorer).</span></span>

### <a name="choose-hello-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="bb947-141">Выберите hello соответствующие статистический показатель на диагностические метрики</span><span class="sxs-lookup"><span data-stu-id="bb947-141">Choose hello appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="bb947-142">Метрики диагностики можно выбрать среди *среднее*, *минимум*, *максимальное* и *общее* как метрики tooscale по.</span><span class="sxs-lookup"><span data-stu-id="bb947-142">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric tooscale by.</span></span> <span data-ttu-id="bb947-143">наиболее распространенные Hello статистический показатель представляет *среднее*.</span><span class="sxs-lookup"><span data-stu-id="bb947-143">hello most common statistic is *Average*.</span></span>

### <a name="choose-hello-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="bb947-144">Выберите пороговые значения hello тщательно для всех типов метрики</span><span class="sxs-lookup"><span data-stu-id="bb947-144">Choose hello thresholds carefully for all metric types</span></span>
<span data-ttu-id="bb947-145">Рекомендуется тщательно выбирать различные пороговые значения для развертывания и свертывания в зависимости от практических ситуаций.</span><span class="sxs-lookup"><span data-stu-id="bb947-145">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="bb947-146">Мы *не рекомендует* параметры автоматического масштабирования, например hello приведенные ниже примеры с hello одинаковые или очень похожие пороговые значения для извлечение и возврат условий:</span><span class="sxs-lookup"><span data-stu-id="bb947-146">We *do not recommend* autoscale settings like hello examples below with hello same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="bb947-147">Увеличение числа экземпляров на 1, если число потоков ≤ 600</span><span class="sxs-lookup"><span data-stu-id="bb947-147">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="bb947-148">Уменьшение числа экземпляров на 1, если число потоков ≥ 600</span><span class="sxs-lookup"><span data-stu-id="bb947-148">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="bb947-149">Давайте рассмотрим пример, что может привести к tooa поведение, которое может показаться противоречивым.</span><span class="sxs-lookup"><span data-stu-id="bb947-149">Let's look at an example of what can lead tooa behavior that may seem confusing.</span></span> <span data-ttu-id="bb947-150">Рассмотрим следующие последовательности hello.</span><span class="sxs-lookup"><span data-stu-id="bb947-150">Consider hello following sequence.</span></span>

1. <span data-ttu-id="bb947-151">Предполагают, 2 toobegin экземпляров с помощью и затем hello среднее число потоков на один экземпляр роста too625.</span><span class="sxs-lookup"><span data-stu-id="bb947-151">Assume there are 2 instances toobegin with and then hello average number of threads per instance grows too625.</span></span>
2. <span data-ttu-id="bb947-152">Служба автомасштабирования разворачивает третий экземпляр.</span><span class="sxs-lookup"><span data-stu-id="bb947-152">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="bb947-153">Далее предположим, что счетчика потока среднее hello через экземпляр становится too575.</span><span class="sxs-lookup"><span data-stu-id="bb947-153">Next, assume that hello average thread count across instance falls too575.</span></span>
4. <span data-ttu-id="bb947-154">Перед уменьшения масштаба автомасштабирования предпринимает tooestimate конечное состояние какая hello будет если ее масштабируется по.</span><span class="sxs-lookup"><span data-stu-id="bb947-154">Before scaling down, autoscale tries tooestimate what hello final state will be if it scaled in.</span></span> <span data-ttu-id="bb947-155">Например, 575 x 3 (текущее количество экземпляров) = 1725 / 2 (итоговое количество экземпляров после уменьшения масштаба) = 862,5 потока.</span><span class="sxs-lookup"><span data-stu-id="bb947-155">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="bb947-156">Это означает, что Автомасштабирование tooimmediately масштабирования снова даже после его масштабируется по, если бы остается hello потока среднее число hello же или даже становится очень мало.</span><span class="sxs-lookup"><span data-stu-id="bb947-156">This means autoscale would have tooimmediately scale-out again even after it scaled in, if hello average thread count remains hello same or even falls only a small amount.</span></span> <span data-ttu-id="bb947-157">Тем не менее если он масштабировать в сторону увеличения, hello весь процесс будет повторяться, начальные tooan бесконечный цикл.</span><span class="sxs-lookup"><span data-stu-id="bb947-157">However, if it scaled up again, hello whole process would repeat, leading tooan infinite loop.</span></span>
5. <span data-ttu-id="bb947-158">tooavoid этой ситуации (называется «flapping»), автомасштабирования не масштабировать вообще.</span><span class="sxs-lookup"><span data-stu-id="bb947-158">tooavoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="bb947-159">Вместо этого пропускает и заново оценивает hello условие снова выполняет задание hello Далее время hello службы.</span><span class="sxs-lookup"><span data-stu-id="bb947-159">Instead, it skips and reevaluates hello condition again hello next time hello service's job executes.</span></span> <span data-ttu-id="bb947-160">Это может перепутать многие пользователи, поскольку автомасштабирования бы выглядеть toowork hello потока среднее число было 575.</span><span class="sxs-lookup"><span data-stu-id="bb947-160">This could confuse many people because autoscale wouldn't appear toowork when hello average thread count was 575.</span></span>

<span data-ttu-id="bb947-161">Оценка во время масштабирования в является предполагаемым tooavoid «неустойчивый» ситуациях действия в масштабирования и масштабирования постоянно куда вперед и назад.</span><span class="sxs-lookup"><span data-stu-id="bb947-161">Estimation during a scale-in is intended tooavoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="bb947-162">При выборе hello же пороговые значения для масштабного развертывания, а также в учитывайте это поведение.</span><span class="sxs-lookup"><span data-stu-id="bb947-162">Keep this behavior in mind when you choose hello same thresholds for scale-out and in.</span></span>

<span data-ttu-id="bb947-163">Рекомендуется выбирать соответствующие поля, между hello масштабирования и пороговых значений.</span><span class="sxs-lookup"><span data-stu-id="bb947-163">We recommend choosing an adequate margin between hello scale-out and in thresholds.</span></span> <span data-ttu-id="bb947-164">Например рассмотрим следующие комбинации лучше правило hello.</span><span class="sxs-lookup"><span data-stu-id="bb947-164">As an example, consider hello following better rule combination.</span></span>

* <span data-ttu-id="bb947-165">Увеличивать количество экземпляров на 1, если загрузка ЦП ≥ 80.</span><span class="sxs-lookup"><span data-stu-id="bb947-165">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="bb947-166">Уменьшение числа экземпляров на 1, если загрузка ЦП ≤ 60</span><span class="sxs-lookup"><span data-stu-id="bb947-166">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="bb947-167">В данном случае:</span><span class="sxs-lookup"><span data-stu-id="bb947-167">In this case</span></span>  

1. <span data-ttu-id="bb947-168">Предположим, что существует 2 toostart экземпляры с.</span><span class="sxs-lookup"><span data-stu-id="bb947-168">Assume there are 2 instances toostart with.</span></span>
2. <span data-ttu-id="bb947-169">Если hello средний процент ЦП всех экземпляров становится too80, автомасштабирования масштабируемостью Добавление третий экземпляр.</span><span class="sxs-lookup"><span data-stu-id="bb947-169">If hello average CPU% across instances goes too80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="bb947-170">Теперь предположим, что за время ЦП hello % попадает too60.</span><span class="sxs-lookup"><span data-stu-id="bb947-170">Now assume that over time hello CPU% falls too60.</span></span>
4. <span data-ttu-id="bb947-171">Правило автоматического масштабирования элемента шкалы в оценивает hello конечное состояние, будто tooscale в.</span><span class="sxs-lookup"><span data-stu-id="bb947-171">Autoscale's scale-in rule estimates hello final state if it were tooscale-in.</span></span> <span data-ttu-id="bb947-172">Например, 60 x 3 (текущее число экземпляров) = 180 / 2 (итоговое число экземпляров после уменьшения масштаба) = 90.</span><span class="sxs-lookup"><span data-stu-id="bb947-172">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="bb947-173">Поэтому автомасштабирования не шкалы в из-за ожидания tooscale бы немедленно.</span><span class="sxs-lookup"><span data-stu-id="bb947-173">So autoscale does not scale-in because it would have tooscale-out again immediately.</span></span> <span data-ttu-id="bb947-174">Вместо этого она пропускает уменьшение масштаба.</span><span class="sxs-lookup"><span data-stu-id="bb947-174">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="bb947-175">проверяет Далее время автомасштабирования Hello, hello ЦП по-прежнему toofall too50.</span><span class="sxs-lookup"><span data-stu-id="bb947-175">hello next time autoscale checks, hello CPU continues toofall too50.</span></span> <span data-ttu-id="bb947-176">Он снова - оценивает экземпляр 50 x 3 = 150 / 2 экземпляров = 75, который находится под hello масштабирования пороговое значение 80, поэтому она может масштабироваться в успешно too2 экземпляров.</span><span class="sxs-lookup"><span data-stu-id="bb947-176">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below hello scale-out threshold of 80, so it scales in successfully too2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="bb947-177">Рекомендации по пороговым значениям масштабирования для специальных метрик</span><span class="sxs-lookup"><span data-stu-id="bb947-177">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="bb947-178">Специальные метрик, таких как длина метрики хранилища или очереди шины обслуживания hello пороговое значение составляет hello среднее число сообщений, доступных для текущего числа экземпляров.</span><span class="sxs-lookup"><span data-stu-id="bb947-178">For special metrics such as Storage or Service Bus Queue length metric, hello threshold is hello average number of messages available per current number of instances.</span></span> <span data-ttu-id="bb947-179">Тщательно выбирать hello выберите hello пороговое значение для этой метрики.</span><span class="sxs-lookup"><span data-stu-id="bb947-179">Carefully choose hello choose hello threshold value for this metric.</span></span>

<span data-ttu-id="bb947-180">Проиллюстрируем его с tooensure примере понять поведение hello лучше.</span><span class="sxs-lookup"><span data-stu-id="bb947-180">Let's illustrate it with an example tooensure you understand hello behavior better.</span></span>

* <span data-ttu-id="bb947-181">Увеличение числа экземпляров на 1, когда число сообщений в очереди хранилища ≥ 50</span><span class="sxs-lookup"><span data-stu-id="bb947-181">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="bb947-182">Уменьшение числа экземпляров на 1, когда число сообщений в очереди хранилища ≤ 10</span><span class="sxs-lookup"><span data-stu-id="bb947-182">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="bb947-183">Примите во внимание следующие последовательности hello.</span><span class="sxs-lookup"><span data-stu-id="bb947-183">Consider hello following sequence:</span></span>

1. <span data-ttu-id="bb947-184">Существует 2 экземпляра очереди хранилища.</span><span class="sxs-lookup"><span data-stu-id="bb947-184">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="bb947-185">Сохранить поступающих сообщений и при просмотре хранилища очереди hello hello всего считывает 50.</span><span class="sxs-lookup"><span data-stu-id="bb947-185">Messages keep coming and when you review hello storage queue, hello total count reads 50.</span></span> <span data-ttu-id="bb947-186">Вы можете предположить, что служба автомасштабирования должна начать развертывание.</span><span class="sxs-lookup"><span data-stu-id="bb947-186">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="bb947-187">Однако обратите внимание, что число сообщений для каждого экземпляра по-прежнему 50 / 2 = 25.</span><span class="sxs-lookup"><span data-stu-id="bb947-187">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="bb947-188">Поэтому развертывание не происходит.</span><span class="sxs-lookup"><span data-stu-id="bb947-188">So, scale-out does not occur.</span></span> <span data-ttu-id="bb947-189">Для первого toohappen масштабирования hello hello общее количество сообщений в очереди хранилища hello должно быть 100.</span><span class="sxs-lookup"><span data-stu-id="bb947-189">For hello first scale-out toohappen, hello total message count in hello storage queue should be 100.</span></span>
3. <span data-ttu-id="bb947-190">Далее предположим, что hello общее количество сообщений достигает 100.</span><span class="sxs-lookup"><span data-stu-id="bb947-190">Next, assume that hello total message count reaches 100.</span></span>
4. <span data-ttu-id="bb947-191">Из-за действия масштабирования tooa добавляется третий экземпляр очереди хранилища.</span><span class="sxs-lookup"><span data-stu-id="bb947-191">A 3rd storage queue instance is added due tooa scale-out action.</span></span>  <span data-ttu-id="bb947-192">Hello следующее действие масштабирования не произойдет до hello общее количество сообщений в очереди hello достигает 150, так как 150-3 = 50.</span><span class="sxs-lookup"><span data-stu-id="bb947-192">hello next scale-out action will not happen until hello total message count in hello queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="bb947-193">Теперь hello количество сообщений в очереди hello уменьшается.</span><span class="sxs-lookup"><span data-stu-id="bb947-193">Now hello number of messages in hello queue gets smaller.</span></span> <span data-ttu-id="bb947-194">С 3 экземплярами hello первое масштабирования в действие происходит, когда hello сложить всего сообщений во всех очередях too30, так как 30/3 = 10 сообщений на экземпляр, являющийся hello масштабирования в пороговое значение.</span><span class="sxs-lookup"><span data-stu-id="bb947-194">With 3 instances, hello first scale-in action happens when hello total messages in all queues add up too30 because 30/3 = 10 messages per instance, which is hello scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="bb947-195">Рекомендации по масштабированию при настройке нескольких профилей в параметре автомасштабирования</span><span class="sxs-lookup"><span data-stu-id="bb947-195">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="bb947-196">В параметре автомасштабирования можно выбрать профиль по умолчанию, который применяется всегда, вне зависимости от расписания или времени. Также можно выбрать профиль повторения или профиль для фиксированного периода с диапазоном дат и времени.</span><span class="sxs-lookup"><span data-stu-id="bb947-196">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="bb947-197">Когда служба автоматического масштабирования, обрабатывает их, всегда проверяет в hello следующий порядок:</span><span class="sxs-lookup"><span data-stu-id="bb947-197">When autoscale service processes them, it always checks in hello following order:</span></span>

1. <span data-ttu-id="bb947-198">профиль с фиксированной датой;</span><span class="sxs-lookup"><span data-stu-id="bb947-198">Fixed Date profile</span></span>
2. <span data-ttu-id="bb947-199">профиль повторения;</span><span class="sxs-lookup"><span data-stu-id="bb947-199">Recurring profile</span></span>
3. <span data-ttu-id="bb947-200">профиль по умолчанию ("Всегда").</span><span class="sxs-lookup"><span data-stu-id="bb947-200">Default ("Always") profile</span></span>

<span data-ttu-id="bb947-201">При выполнении условия профиль автомасштабирования не проверяет hello следующего условия профиля под ней.</span><span class="sxs-lookup"><span data-stu-id="bb947-201">If a profile condition is met, autoscale does not check hello next profile condition below it.</span></span> <span data-ttu-id="bb947-202">Служба автомасштабирования обрабатывает только один профиль за раз.</span><span class="sxs-lookup"><span data-stu-id="bb947-202">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="bb947-203">Это означает, что если требуется tooalso включить условие обработки из профиля более низкого уровня, необходимо включить эти правила также hello текущему профилю.</span><span class="sxs-lookup"><span data-stu-id="bb947-203">This means if you want tooalso include a processing condition from a lower-tier profile, you must include those rules as well in hello current profile.</span></span>

<span data-ttu-id="bb947-204">Рассмотрим это на примере.</span><span class="sxs-lookup"><span data-stu-id="bb947-204">Let's review this using an example:</span></span>

<span data-ttu-id="bb947-205">Hello ниже рисунке параметров автоматического масштабирования с профилем по умолчанию минимальное экземпляров = 2 до максимального, экземпляр = 10.</span><span class="sxs-lookup"><span data-stu-id="bb947-205">hello image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="bb947-206">В этом примере правила, настроенного tooscale масштабирование при hello количество сообщений в очереди hello больше 10 и масштаб в при hello количество сообщений в очереди hello — меньше 3.</span><span class="sxs-lookup"><span data-stu-id="bb947-206">In this example, rules are configured tooscale-out when hello message count in hello queue is greater than 10 and scale-in when hello message count in hello queue is less than 3.</span></span> <span data-ttu-id="bb947-207">Поэтому теперь hello ресурсов можно масштабировать от 2 до 10 экземпляров.</span><span class="sxs-lookup"><span data-stu-id="bb947-207">So now hello resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="bb947-208">Кроме того, имеется профиль повторения, настроенный на "Понедельник".</span><span class="sxs-lookup"><span data-stu-id="bb947-208">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="bb947-209">В нем задано минимальное число экземпляров, равное 2, и максимальное число экземпляров, равное 12.</span><span class="sxs-lookup"><span data-stu-id="bb947-209">It is set for minimum instances = 2 and maximum instances = 12.</span></span> <span data-ttu-id="bb947-210">Это означает в понедельник, первый раз автомасштабирования hello проверяет это условие, если число экземпляров hello 2, он является масштабируемым toohello новый минимум 3.</span><span class="sxs-lookup"><span data-stu-id="bb947-210">This means on Monday, hello first time autoscale checks for this condition, if hello instance count is 2, it scales toohello new minimum of 3.</span></span> <span data-ttu-id="bb947-211">При условии, что Автомасштабирование по-прежнему toofind это условие профиль соответствует (понедельник), он обрабатывает только hello ЦП шкалы out или в правила на основе настроенных для данного профиля.</span><span class="sxs-lookup"><span data-stu-id="bb947-211">As long as autoscale continues toofind this profile condition matched (Monday), it only processes hello CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="bb947-212">В настоящее время он не проверяет наличие длина очереди hello.</span><span class="sxs-lookup"><span data-stu-id="bb947-212">At this time, it does not check for hello queue length.</span></span> <span data-ttu-id="bb947-213">Тем не менее если также требуется hello длина очереди условие toobe этот флажок установлен, необходимо включить эти правила из профиля по умолчанию hello также в понедельник профиль.</span><span class="sxs-lookup"><span data-stu-id="bb947-213">However, if you also want hello queue length condition toobe checked, you should include those rules from hello default profile as well in your Monday profile.</span></span>

<span data-ttu-id="bb947-214">Аналогичным образом когда Автомасштабирование переключается назад toohello профиль по умолчанию, его сначала проверяет Если hello минимальное и максимальное условий.</span><span class="sxs-lookup"><span data-stu-id="bb947-214">Similarly, when autoscale switches back toohello default profile, it first checks if hello minimum and maximum conditions are met.</span></span> <span data-ttu-id="bb947-215">Если hello число экземпляров во время hello 12, она может масштабироваться в too10, hello максимально допустимое для профиль по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="bb947-215">If hello number of instances at hello time is 12, it scales in too10, hello maximum allowed for hello default profile.</span></span>

![Параметры автомасштабирования](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="bb947-217">Рекомендации по масштабированию при настройке нескольких правил в профиле</span><span class="sxs-lookup"><span data-stu-id="bb947-217">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="bb947-218">Существуют случаи, в которых используется tooset несколько правил в профиле.</span><span class="sxs-lookup"><span data-stu-id="bb947-218">There are cases where you may have tooset multiple rules in a profile.</span></span> <span data-ttu-id="bb947-219">Следующий набор правил автомасштабирования Hello используются с помощью служб при установке нескольких правил.</span><span class="sxs-lookup"><span data-stu-id="bb947-219">hello following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="bb947-220">Для запуска *развертывания* службе автомасштабирования достаточно, чтобы выполнялось любое из правил.</span><span class="sxs-lookup"><span data-stu-id="bb947-220">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="bb947-221">На *масштабирования в*, все правила выполнены toobe требуют автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="bb947-221">On *scale-in*, autoscale require all rules toobe met.</span></span>

<span data-ttu-id="bb947-222">tooillustrate, предполагается, что hello 4 автомасштабирования правилам:</span><span class="sxs-lookup"><span data-stu-id="bb947-222">tooillustrate, assume that you have hello following 4 autoscale rules:</span></span>

* <span data-ttu-id="bb947-223">если загрузка ЦП < 30 %, свернуть 1 экземпляр;</span><span class="sxs-lookup"><span data-stu-id="bb947-223">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="bb947-224">если объем используемой памяти < 50 %, свернуть 1 экземпляр;</span><span class="sxs-lookup"><span data-stu-id="bb947-224">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="bb947-225">если загрузка ЦП > 75 %, развернуть 1 экземпляр;</span><span class="sxs-lookup"><span data-stu-id="bb947-225">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="bb947-226">если объем используемой памяти > 75 %, развернуть 1 экземпляр.</span><span class="sxs-lookup"><span data-stu-id="bb947-226">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="bb947-227">Затем происходит hello выполните:</span><span class="sxs-lookup"><span data-stu-id="bb947-227">Then hello follow occurs:</span></span>

* <span data-ttu-id="bb947-228">Если ресурсы ЦП загружены на 76 % и занято 50 % памяти, будет выполнено развертывание.</span><span class="sxs-lookup"><span data-stu-id="bb947-228">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="bb947-229">Если ресурсы ЦП загружены на 50 % и занято 76 % памяти, будет выполнено развертывание.</span><span class="sxs-lookup"><span data-stu-id="bb947-229">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="bb947-230">На hello другой стороны, если является 25% ЦП и памяти, выполняет автомасштабирования 51% **не** в шкалы.</span><span class="sxs-lookup"><span data-stu-id="bb947-230">On hello other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="bb947-231">В порядке в tooscale ЦП должно быть 29% и памяти 49%.</span><span class="sxs-lookup"><span data-stu-id="bb947-231">In order tooscale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="bb947-232">Всегда выбирайте безопасное число экземпляров по умолчанию</span><span class="sxs-lookup"><span data-stu-id="bb947-232">Always select a safe default instance count</span></span>
<span data-ttu-id="bb947-233">число экземпляров по умолчанию Hello важно, автомасштабирования масштабируется счетчик toothat вашей службы, если метрики недоступны.</span><span class="sxs-lookup"><span data-stu-id="bb947-233">hello default instance count is important autoscale scales your service toothat count when metrics are not available.</span></span> <span data-ttu-id="bb947-234">Поэтому выберите число экземпляров по умолчанию, являющееся безопасным для рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="bb947-234">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="bb947-235">Настройка уведомлений об автомасштабировании</span><span class="sxs-lookup"><span data-stu-id="bb947-235">Configure autoscale notifications</span></span>
<span data-ttu-id="bb947-236">Автомасштабирование уведомляет администраторов hello и участники hello ресурса по электронной почте при возникновении любого из следующих условий hello:</span><span class="sxs-lookup"><span data-stu-id="bb947-236">Autoscale notifies hello administrators and contributors of hello resource by email if any of hello following conditions occur:</span></span>

* <span data-ttu-id="bb947-237">Служба автоматического масштабирования не tootake действие.</span><span class="sxs-lookup"><span data-stu-id="bb947-237">autoscale service fails tootake an action.</span></span>
* <span data-ttu-id="bb947-238">Метрики недоступны для автоматического масштабирования службы toomake шкалы принятия решений.</span><span class="sxs-lookup"><span data-stu-id="bb947-238">Metrics are not available for autoscale service toomake a scale decision.</span></span>
* <span data-ttu-id="bb947-239">Показатели, доступных (восстановление) снова toomake шкалы принятия решений.</span><span class="sxs-lookup"><span data-stu-id="bb947-239">Metrics are available (recovery) again toomake a scale decision.</span></span>
  <span data-ttu-id="bb947-240">Кроме того при условиях toohello выше, можно настроить tooget уведомления по электронной почте или веб-перехватчика уведомление о том, для успешного масштабирования действий.</span><span class="sxs-lookup"><span data-stu-id="bb947-240">In addition toohello conditions above, you can configure email or webhook notifications tooget notified for successful scale actions.</span></span>
  
<span data-ttu-id="bb947-241">Также можно использовать журнал действий предупреждения toomonitor hello работоспособность подсистемы автомасштабирования hello.</span><span class="sxs-lookup"><span data-stu-id="bb947-241">You can also use an Activity Log alert toomonitor hello health of hello autoscale engine.</span></span> <span data-ttu-id="bb947-242">Ниже приведены примеры слишком[создать предупреждение журналов действий toomonitor всех операций автомасштабирования обработчика по подписке](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) или слишком[создать предупреждение журналов действий toomonitor, все Сбой автоматического масштабирования шкалы в / масштабирования операций подписки](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span><span class="sxs-lookup"><span data-stu-id="bb947-242">Here are examples too[create an Activity Log Alert toomonitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or too[create an Activity Log Alert toomonitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

## <a name="next-steps"></a><span data-ttu-id="bb947-243">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="bb947-243">Next Steps</span></span>
- [<span data-ttu-id="bb947-244">Создайте предупреждение журналов действий toomonitor всех операций автомасштабирования обработчика для одной подписки.</span><span class="sxs-lookup"><span data-stu-id="bb947-244">Create an Activity Log Alert toomonitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="bb947-245">Создать предупреждение журналов действий toomonitor, все Сбой автоматического масштабирования шкалы в / масштабирование операций по подписке</span><span class="sxs-lookup"><span data-stu-id="bb947-245">Create an Activity Log Alert toomonitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
