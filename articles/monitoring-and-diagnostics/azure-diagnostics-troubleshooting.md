---
title: "Устранение неполадок системы диагностики Azure | Документация Майкрософт"
description: "Устранение неполадок при использовании системы диагностики Azure на виртуальных машинах, в Service Fabric или в облачных службах."
services: monitoring-and-diagnostics
documentationcenter: .net
author: rboucher
manager: carmonm
editor: 
ms.assetid: 66469bce-d457-4d1e-b550-a08d2be4d28c
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 07/12/2017
ms.author: robb
ms.openlocfilehash: a0cb529836b14df71e83616f4f625a002c535b7b
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="azure-diagnostics-troubleshooting"></a><span data-ttu-id="21151-103">Устранение неполадок с помощью системы диагностики Azure</span><span class="sxs-lookup"><span data-stu-id="21151-103">Azure Diagnostics Troubleshooting</span></span>
<span data-ttu-id="21151-104">Информация об устранении неполадок с помощью системы диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="21151-104">Troubleshooting information relevant to using Azure Diagnostics.</span></span> <span data-ttu-id="21151-105">Дополнительные сведения о системе диагностики Azure см. в [обзоре системы диагностики Azure](azure-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="21151-105">For more information on Azure diagnostics, see [Azure Diagnostics Overview](azure-diagnostics.md).</span></span>

## <a name="logical-components"></a><span data-ttu-id="21151-106">Логические компоненты</span><span class="sxs-lookup"><span data-stu-id="21151-106">Logical Components</span></span>
<span data-ttu-id="21151-107">**Средство запуска подключаемого модуля системы диагностики (DiagnosticsPluginLauncher.exe).** Запускает расширение системы диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="21151-107">**Diagnostics Plugin Launcher (DiagnosticsPluginLauncher.exe)**: Launches the Azure Diagnostics extension.</span></span> <span data-ttu-id="21151-108">Используется в качестве процесса точки входа.</span><span class="sxs-lookup"><span data-stu-id="21151-108">Serves as the entry point process.</span></span>

<span data-ttu-id="21151-109">**Подключаемый модуль системы диагностики (DiagnosticsPlugin.exe)** — основной процесс, который запускается с помощью упомянутого выше средства запуска. Этот модуль настраивает и запускает агент наблюдения, а также управляет его временем существования.</span><span class="sxs-lookup"><span data-stu-id="21151-109">**Diagnostics Plugin (DiagnosticsPlugin.exe)**: Main process that is launched by the launcher above and configures the Monitoring Agent, launches it and manages its lifetime.</span></span> 

<span data-ttu-id="21151-110">**Агент наблюдения (процессы MonAgent\*.exe).** Эти процессы выполняют большую часть работы, например наблюдение, сбор и передачу данных диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-110">**Monitoring Agent (MonAgent\*.exe processes)**: These processes do the bulk of the work; i.e., monitoring, collection and transfer of the diagnostics data.</span></span>  

## <a name="logartifact-paths"></a><span data-ttu-id="21151-111">Пути к журналам и артефактам</span><span class="sxs-lookup"><span data-stu-id="21151-111">Log/Artifact Paths</span></span>
<span data-ttu-id="21151-112">В таблицах ниже приведены расположения некоторых важных журналов и артефактов,</span><span class="sxs-lookup"><span data-stu-id="21151-112">Here are the paths to some important logs and artifacts.</span></span> <span data-ttu-id="21151-113">которые используются в остальной части документа.</span><span class="sxs-lookup"><span data-stu-id="21151-113">We keep referring to these throughout the rest of the document:</span></span>
### <a name="cloud-services"></a><span data-ttu-id="21151-114">Облачные службы</span><span class="sxs-lookup"><span data-stu-id="21151-114">Cloud Services</span></span>
| <span data-ttu-id="21151-115">Артефакт</span><span class="sxs-lookup"><span data-stu-id="21151-115">Artifact</span></span> | <span data-ttu-id="21151-116">Путь</span><span class="sxs-lookup"><span data-stu-id="21151-116">Path</span></span> |
| --- | --- |
| <span data-ttu-id="21151-117">**Файл конфигурации системы диагностики Azure**</span><span class="sxs-lookup"><span data-stu-id="21151-117">**Azure Diagnostics configuration file**</span></span> | <span data-ttu-id="21151-118">%SystemDrive%\Packages\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<версия>\Config.txt</span><span class="sxs-lookup"><span data-stu-id="21151-118">%SystemDrive%\Packages\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version>\Config.txt</span></span> |
| <span data-ttu-id="21151-119">**Файлы журналов**</span><span class="sxs-lookup"><span data-stu-id="21151-119">**Log files**</span></span> | <span data-ttu-id="21151-120">C:\Logs\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<версия>\\</span><span class="sxs-lookup"><span data-stu-id="21151-120">C:\Logs\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version>\\</span></span> |
| <span data-ttu-id="21151-121">**Локальное хранилище данных диагностики**</span><span class="sxs-lookup"><span data-stu-id="21151-121">**Local store for diagnostics data**</span></span> | <span data-ttu-id="21151-122">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Tables</span><span class="sxs-lookup"><span data-stu-id="21151-122">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Tables</span></span> |
| <span data-ttu-id="21151-123">**Файл конфигурации агента мониторинга**</span><span class="sxs-lookup"><span data-stu-id="21151-123">**Monitoring Agent configuration file**</span></span> | <span data-ttu-id="21151-124">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Configuration\MaConfig.xml</span><span class="sxs-lookup"><span data-stu-id="21151-124">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Configuration\MaConfig.xml</span></span> |
| <span data-ttu-id="21151-125">**Пакет расширений системы диагностики Azure**</span><span class="sxs-lookup"><span data-stu-id="21151-125">**Azure diagnostics extension package**</span></span> | <span data-ttu-id="21151-126">%SystemDrive%\Packages\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<версия></span><span class="sxs-lookup"><span data-stu-id="21151-126">%SystemDrive%\Packages\Plugins\Microsoft.Azure.Diagnostics.PaaSDiagnostics\<version></span></span> |
| <span data-ttu-id="21151-127">**Путь к служебной программе сбора журналов**</span><span class="sxs-lookup"><span data-stu-id="21151-127">**Log collection utility path**</span></span> | <span data-ttu-id="21151-128">%SystemDrive%\Packages\GuestAgent\\</span><span class="sxs-lookup"><span data-stu-id="21151-128">%SystemDrive%\Packages\GuestAgent\\</span></span> |
| <span data-ttu-id="21151-129">**Файл журнала MonAgentHost**</span><span class="sxs-lookup"><span data-stu-id="21151-129">**MonAgentHost log file**</span></span> | <span data-ttu-id="21151-130">C:\Resources\Directory\<ИД_разверт._облачн._службы>.\<имя_роли>.DiagnosticStore\WAD0107\Configuration\MonAgentHost.<текущ._номер>.log</span><span class="sxs-lookup"><span data-stu-id="21151-130">C:\Resources\Directory\<CloudServiceDeploymentID>.\<RoleName>.DiagnosticStore\WAD0107\Configuration\MonAgentHost.<seq_num>.log</span></span> |

### <a name="virtual-machines"></a><span data-ttu-id="21151-131">Виртуальные машины</span><span class="sxs-lookup"><span data-stu-id="21151-131">Virtual Machines</span></span>
| <span data-ttu-id="21151-132">Артефакт</span><span class="sxs-lookup"><span data-stu-id="21151-132">Artifact</span></span> | <span data-ttu-id="21151-133">Путь</span><span class="sxs-lookup"><span data-stu-id="21151-133">Path</span></span> |
| --- | --- |
| <span data-ttu-id="21151-134">**Файл конфигурации системы диагностики Azure**</span><span class="sxs-lookup"><span data-stu-id="21151-134">**Azure Diagnostics configuration file**</span></span> | <span data-ttu-id="21151-135">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<версия>\RuntimeSettings</span><span class="sxs-lookup"><span data-stu-id="21151-135">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\RuntimeSettings</span></span> |
| <span data-ttu-id="21151-136">**Файлы журналов**</span><span class="sxs-lookup"><span data-stu-id="21151-136">**Log files**</span></span> | <span data-ttu-id="21151-137">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<версия>\Logs\\</span><span class="sxs-lookup"><span data-stu-id="21151-137">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\Logs\\</span></span> |
| <span data-ttu-id="21151-138">**Локальное хранилище данных диагностики**</span><span class="sxs-lookup"><span data-stu-id="21151-138">**Local store for diagnostics data**</span></span> | <span data-ttu-id="21151-139">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<версия_системы_диагностики>\WAD0107\Tables</span><span class="sxs-lookup"><span data-stu-id="21151-139">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Tables</span></span> |
| <span data-ttu-id="21151-140">**Файл конфигурации агента мониторинга**</span><span class="sxs-lookup"><span data-stu-id="21151-140">**Monitoring Agent configuration file**</span></span> | <span data-ttu-id="21151-141">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<версия_системы_диагностики>\WAD0107\Configuration\MaConfig.xml</span><span class="sxs-lookup"><span data-stu-id="21151-141">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Configuration\MaConfig.xml</span></span> |
| <span data-ttu-id="21151-142">**Состояние файла**</span><span class="sxs-lookup"><span data-stu-id="21151-142">**Status file**</span></span> | <span data-ttu-id="21151-143">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<версия>\Status</span><span class="sxs-lookup"><span data-stu-id="21151-143">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<version>\Status</span></span> |
| <span data-ttu-id="21151-144">**Пакет расширений системы диагностики Azure**</span><span class="sxs-lookup"><span data-stu-id="21151-144">**Azure diagnostics extension package**</span></span> | <span data-ttu-id="21151-145">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<версия_системы_диагностики></span><span class="sxs-lookup"><span data-stu-id="21151-145">C:\Packages\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion></span></span>|
| <span data-ttu-id="21151-146">**Путь к служебной программе сбора журналов**</span><span class="sxs-lookup"><span data-stu-id="21151-146">**Log collection utility path**</span></span> | <span data-ttu-id="21151-147">C:\WindowsAzure\Packages</span><span class="sxs-lookup"><span data-stu-id="21151-147">C:\WindowsAzure\Packages</span></span> |
| <span data-ttu-id="21151-148">**Файл журнала MonAgentHost**</span><span class="sxs-lookup"><span data-stu-id="21151-148">**MonAgentHost log file**</span></span> | <span data-ttu-id="21151-149">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<версия_системы_диагностики>\WAD0107\Configuration\MonAgentHost.<текущ._номер>.log</span><span class="sxs-lookup"><span data-stu-id="21151-149">C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<DiagnosticsVersion>\WAD0107\Configuration\MonAgentHost.<seq_num>.log</span></span> |

## <a name="metric-data-doesnt-show-in-azure-portal"></a><span data-ttu-id="21151-150">Данные метрики не отображаются на портале Azure</span><span class="sxs-lookup"><span data-stu-id="21151-150">Metric data doesn't show in Azure portal</span></span>
<span data-ttu-id="21151-151">Система диагностики Azure предоставляет ряд данных метрики, которые можно отобразить на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="21151-151">Azure Diagnostics provides a bunch of metric data, which can be displayed in Azure portal.</span></span> <span data-ttu-id="21151-152">Если возникли проблемы с просмотром этих данных на портале, необходимо проверить учетную запись хранения диагностики и перейти к таблице WADMetrics\*, чтобы узнать, имеются ли соответствующие записи метрики.</span><span class="sxs-lookup"><span data-stu-id="21151-152">If you have problems with seeing these data in portal, check the diagnostics storage account -> WADMetrics\* table to see if the corresponding metric records are there.</span></span> <span data-ttu-id="21151-153">Здесь PartitionKey таблицы является идентификатором ресурса виртуальной машины или масштабируемого набора виртуальных машин, а RowKey — именем метрики, т. е. именем счетчика производительности.</span><span class="sxs-lookup"><span data-stu-id="21151-153">Here, the PartitionKey of the table is the resource ID of virtual machine or virtual machine scale set, and the RowKey is the metric name i.e. performance counter name.</span></span>

<span data-ttu-id="21151-154">Если идентификатор ресурса неверный, необходимо проверить правильность его значения. Для этого выберите "Diagnostics Configuration (Конфигурация диагностики) -> Метрики -> ResourceId".</span><span class="sxs-lookup"><span data-stu-id="21151-154">If the resource ID is incorrect, check Diagnostics Configuration -> Metrics -> ResourceId to see if the resource ID is set correctly.</span></span>

<span data-ttu-id="21151-155">Если нет данных для конкретной метрики, необходимо проверить, включена ли метрика (счетчик производительности). Для этого выберите "Diagnostics Configuration (Конфигурация диагностики) -> PerformanceCounter".</span><span class="sxs-lookup"><span data-stu-id="21151-155">If there's no data for the specific metric, check Diagnostics Configuration -> PerformanceCounter to see if the metric(performance counter) is included.</span></span> <span data-ttu-id="21151-156">Следующие счетчики включены по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="21151-156">We enable the following counters by default.</span></span>
- <span data-ttu-id="21151-157">\Processor(_Total)\% Загруженность процессора</span><span class="sxs-lookup"><span data-stu-id="21151-157">\Processor(_Total)\% Processor Time</span></span>
- <span data-ttu-id="21151-158">\Память\доступные байты</span><span class="sxs-lookup"><span data-stu-id="21151-158">\Memory\Available Bytes</span></span>
- <span data-ttu-id="21151-159">\ASP.NET Applications(__Total__)\Requests/Sec</span><span class="sxs-lookup"><span data-stu-id="21151-159">\ASP.NET Applications(__Total__)\Requests/Sec</span></span>
- <span data-ttu-id="21151-160">\ASP.NET Applications(__Total__)\Errors Total/Sec</span><span class="sxs-lookup"><span data-stu-id="21151-160">\ASP.NET Applications(__Total__)\Errors Total/Sec</span></span>
- <span data-ttu-id="21151-161">\ASP.NET\Requests Queued</span><span class="sxs-lookup"><span data-stu-id="21151-161">\ASP.NET\Requests Queued</span></span>
- <span data-ttu-id="21151-162">\ASP.NET\Requests Rejected</span><span class="sxs-lookup"><span data-stu-id="21151-162">\ASP.NET\Requests Rejected</span></span>
- <span data-ttu-id="21151-163">\Processor(w3wp)\% Processor Time</span><span class="sxs-lookup"><span data-stu-id="21151-163">\Processor(w3wp)\% Processor Time</span></span>
- <span data-ttu-id="21151-164">\Process(w3wp)\Private Bytes</span><span class="sxs-lookup"><span data-stu-id="21151-164">\Process(w3wp)\Private Bytes</span></span>
- <span data-ttu-id="21151-165">\Process(WaIISHost)\% Processor Time</span><span class="sxs-lookup"><span data-stu-id="21151-165">\Process(WaIISHost)\% Processor Time</span></span>
- <span data-ttu-id="21151-166">\Process(WaIISHost)\Private Bytes</span><span class="sxs-lookup"><span data-stu-id="21151-166">\Process(WaIISHost)\Private Bytes</span></span>
- <span data-ttu-id="21151-167">\Process(WaWorkerHost)\% Processor Time</span><span class="sxs-lookup"><span data-stu-id="21151-167">\Process(WaWorkerHost)\% Processor Time</span></span>
- <span data-ttu-id="21151-168">\Process(WaWorkerHost)\Private Bytes</span><span class="sxs-lookup"><span data-stu-id="21151-168">\Process(WaWorkerHost)\Private Bytes</span></span>
- <span data-ttu-id="21151-169">\Memory\Page Faults/sec</span><span class="sxs-lookup"><span data-stu-id="21151-169">\Memory\Page Faults/sec</span></span>
- <span data-ttu-id="21151-170">\.NET CLR Memory(_Global_)\% Time in GC</span><span class="sxs-lookup"><span data-stu-id="21151-170">\.NET CLR Memory(_Global_)\% Time in GC</span></span>
- <span data-ttu-id="21151-171">\LogicalDisk(C:)\Disk Write Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="21151-171">\LogicalDisk(C:)\Disk Write Bytes/sec</span></span>
- <span data-ttu-id="21151-172">\LogicalDisk(C:)\Disk Read Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="21151-172">\LogicalDisk(C:)\Disk Read Bytes/sec</span></span>
- <span data-ttu-id="21151-173">\LogicalDisk(D:)\Disk Write Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="21151-173">\LogicalDisk(D:)\Disk Write Bytes/sec</span></span>
- <span data-ttu-id="21151-174">\LogicalDisk(D:)\Disk Read Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="21151-174">\LogicalDisk(D:)\Disk Read Bytes/sec</span></span>

<span data-ttu-id="21151-175">Если конфигурация настроена правильно, но данные метрики все равно не отображаются, следуйте инструкциям ниже для дальнейшего исследования.</span><span class="sxs-lookup"><span data-stu-id="21151-175">If the configuration is set correctly but you still cannot see the metric data, follow the guidelines below for the further investigation.</span></span>


## <a name="azure-diagnostics-is-not-starting"></a><span data-ttu-id="21151-176">Система диагностики Azure не запускается</span><span class="sxs-lookup"><span data-stu-id="21151-176">Azure Diagnostics is not Starting</span></span>
<span data-ttu-id="21151-177">Сведения о том, почему диагностика не запускается, можно просмотреть в файлах журнала **DiagnosticsPluginLauncher.log** и **DiagnosticsPlugin.log**. Их расположение указано выше.</span><span class="sxs-lookup"><span data-stu-id="21151-177">Look at **DiagnosticsPluginLauncher.log** and **DiagnosticsPlugin.log** files from the location of the log files provided above for information on why diagnostics failed to start.</span></span> 

<span data-ttu-id="21151-178">Если эти журналы указывают `Monitoring Agent not reporting success after launch`, это означает, что произошел сбой запуска MonAgentHost.exe.</span><span class="sxs-lookup"><span data-stu-id="21151-178">If these logs indicate `Monitoring Agent not reporting success after launch`, it means there was a failure launching MonAgentHost.exe.</span></span> <span data-ttu-id="21151-179">Просмотрите журналы этого события в расположении, указанном для `MonAgentHost log file` в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="21151-179">Look at the logs for that in the location indicated for `MonAgentHost log file` in the section above.</span></span>

<span data-ttu-id="21151-180">В последней строке файлов журнала указан код выхода.</span><span class="sxs-lookup"><span data-stu-id="21151-180">The last line of the log files contains the exit code.</span></span>  

```
DiagnosticsPluginLauncher.exe Information: 0 : [4/16/2016 6:24:15 AM] DiagnosticPlugin exited with code 0
```
<span data-ttu-id="21151-181">Если код выхода имеет **отрицательное значение**, ознакомьтесь с [таблицей кодов выхода](#azure-diagnostics-plugin-exit-codes) в разделе [Рекомендации](#references).</span><span class="sxs-lookup"><span data-stu-id="21151-181">If you find a **negative** exit code, refer to the [exit code table](#azure-diagnostics-plugin-exit-codes) in the [References](#references).</span></span>

## <a name="diagnostics-data-is-not-logged-to-azure-storage"></a><span data-ttu-id="21151-182">Журнал данных диагностики не записывается в службу хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="21151-182">Diagnostics Data is Not Logged to Azure Storage</span></span>
<span data-ttu-id="21151-183">Определите, не отображаются ли все данные или только их часть.</span><span class="sxs-lookup"><span data-stu-id="21151-183">Determine if no data is showing up or only some of the data is not showing up.</span></span>

### <a name="diagnostics-infrastructure-logs"></a><span data-ttu-id="21151-184">Журналы инфраструктуры диагностики</span><span class="sxs-lookup"><span data-stu-id="21151-184">Diagnostics Infrastructure Logs</span></span>
<span data-ttu-id="21151-185">В журналах инфраструктуры диагностики записываются все ошибки системы диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="21151-185">Diagnostics Infrastructure Logs is where azure diagnostics logs any errors that it runs into.</span></span> <span data-ttu-id="21151-186">Убедитесь, что вы включили сбор журналов инфраструктуры диагностики в конфигурации и просмотрите соответствующие ошибки в таблице `DiagnosticInfrastructureLogsTable` настроенной учетной записи хранения. Дополнительные сведения о проверке см. в разделе[Как проверить конфигурацию расширения системы диагностики](#how-to-check-diagnostics-extension-configuration).</span><span class="sxs-lookup"><span data-stu-id="21151-186">Make sure you have enabled ([how to?](#how-to-check-diagnostics-extension-configuration)) capturing of Diagnostics Infrastructure logs in your configuration and quickly look for any relevant errors that show up in the `DiagnosticInfrastructureLogsTable` table in your configured storage account.</span></span>

### <a name="no-data-is-showing-up"></a><span data-ttu-id="21151-187">Данные не отображаются</span><span class="sxs-lookup"><span data-stu-id="21151-187">No data is showing up</span></span>
<span data-ttu-id="21151-188">Наиболее распространенная причина отсутствия данных событий — это некорректно определенная информация об учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="21151-188">The most common cause of event data entirely missing is incorrectly defined storage account information.</span></span>

<span data-ttu-id="21151-189">Решение. Исправьте файл конфигурации системы диагностики и переустановите систему диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-189">Solution: Correct your Diagnostics configuration and reinstall Diagnostics.</span></span>

<span data-ttu-id="21151-190">Если учетная запись хранения настроена правильно, подключитесь к удаленному рабочему столу виртуальной машины и проверьте, выполняются ли процессы DiagnosticsPlugin.exe и MonAgentCore.exe.</span><span class="sxs-lookup"><span data-stu-id="21151-190">If the storage account is configured correctly, remote desktop into the machine and make sure DiagnosticsPlugin.exe and MonAgentCore.exe are running.</span></span> <span data-ttu-id="21151-191">Если они не выполняются, следуйте сведениям в разделе [Система диагностики Azure не запускается](#azure-diagnostics-is-not-starting).</span><span class="sxs-lookup"><span data-stu-id="21151-191">If they are not running, follow [Azure Diagnostics is not Starting](#azure-diagnostics-is-not-starting).</span></span> <span data-ttu-id="21151-192">Если процессы выполняются, проверьте [сохраняются ли собранные данные локально](#is-data-getting-captured-locally).</span><span class="sxs-lookup"><span data-stu-id="21151-192">If the processes are running, jump to [Is data getting captured locally](#is-data-getting-captured-locally) and follow this guide from there on.</span></span>

### <a name="part-of-the-data-is-missing"></a><span data-ttu-id="21151-193">Отсутствует часть данных</span><span class="sxs-lookup"><span data-stu-id="21151-193">Part of the data is missing</span></span>
<span data-ttu-id="21151-194">В некоторых случаях вы можете получать не все данные.</span><span class="sxs-lookup"><span data-stu-id="21151-194">If you are getting some data but not other.</span></span> <span data-ttu-id="21151-195">Это означает, что конвейер сбора и передачи данных настроен правильно.</span><span class="sxs-lookup"><span data-stu-id="21151-195">This means the data collection / transfer pipeline is set correctly.</span></span> <span data-ttu-id="21151-196">Следуйте указаниям из подразделов ниже, чтобы сузить список возможных проблем:</span><span class="sxs-lookup"><span data-stu-id="21151-196">Follow the subsections here to narrow down what the issue is:</span></span>
#### <a name="is-collection-configured"></a><span data-ttu-id="21151-197">Проверка параметров сбора</span><span class="sxs-lookup"><span data-stu-id="21151-197">Is Collection Configured:</span></span> 
<span data-ttu-id="21151-198">Сбор определенных типов данных указывается в конфигурации системы диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-198">Diagnostics Configuration contains the part that instructs for a particular type of data to be collected.</span></span> <span data-ttu-id="21151-199">[Проверьте конфигурацию](#how-to-check-diagnostics-extension-configuration) и проверьте, указали ли вы раздел для сбора нужного типа данных.</span><span class="sxs-lookup"><span data-stu-id="21151-199">[Review your configuration](#how-to-check-diagnostics-extension-configuration) to make sure you are not looking for data you have not configured for collection.</span></span>
#### <a name="is-the-host-generating-data"></a><span data-ttu-id="21151-200">Проверка создания данных узлом</span><span class="sxs-lookup"><span data-stu-id="21151-200">Is the host generating data:</span></span>
- <span data-ttu-id="21151-201">**Счетчики производительности.** Откройте системный монитор и проверьте значение счетчика.</span><span class="sxs-lookup"><span data-stu-id="21151-201">**Performance Counters**: open perfmon and check the counter.</span></span>
- <span data-ttu-id="21151-202">**Журналы трассировки.** Подключитесь к удаленному рабочему столу виртуальной машины и добавьте экземпляр TextWriterTraceListener в файл конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="21151-202">**Trace Logs**:  Remote desktop into the VM and add a TextWriterTraceListener to the app’s config file.</span></span>  <span data-ttu-id="21151-203">Сведения о настройке прослушивателя трассировки см. в этой статье: http://msdn.microsoft.com/library/sk36c28t.aspx.</span><span class="sxs-lookup"><span data-stu-id="21151-203">See http://msdn.microsoft.com/library/sk36c28t.aspx to set up the text listener.</span></span>  <span data-ttu-id="21151-204">Проверьте, имеет ли элемент `<trace>` значение `<trace autoflush="true">`.</span><span class="sxs-lookup"><span data-stu-id="21151-204">Make sure the `<trace>` element has `<trace autoflush="true">`.</span></span><br />
<span data-ttu-id="21151-205">Если журналы трассировки не создаются, см. сведения в разделе [Подробные сведения об отсутствии журналов трассировки](#more-about-trace-logs-missing).</span><span class="sxs-lookup"><span data-stu-id="21151-205">If you don't see trace logs getting generated, follow [More About Trace Logs Missing](#more-about-trace-logs-missing).</span></span>
- <span data-ttu-id="21151-206">**Трассировка событий Windows.** Подключитесь к удаленному рабочему столу виртуальной машины и установите PerfView.</span><span class="sxs-lookup"><span data-stu-id="21151-206">**ETW traces**: Remote desktop into the VM and install PerfView.</span></span>  <span data-ttu-id="21151-207">Откройте средство PerfView и выберите "File (Файл) > User Command (Пользовательская команда) > Ожидать передачи данных", указав при этом необходимых поставщиков ETW (etwprovder1, etwprovider2 и т. д.).  Обратите внимание, что команда "Ожидать передачи данных" учитывает регистр. Поставщиков трассировки событий Windows следует указывать через запятые без пробелов.</span><span class="sxs-lookup"><span data-stu-id="21151-207">In PerfView run File -> User Command -> Listen etwprovder1, etwprovider2, etc.  Note that the Listen command is case-sensitive and there cannot be spaces between the comma-separated list of ETW providers.</span></span>  <span data-ttu-id="21151-208">Если выполнение этой команды завершилось сбоем, нажмите кнопку "Журнал" в правом нижнем углу средства Perfview, чтобы просмотреть попытки и результаты запуска.</span><span class="sxs-lookup"><span data-stu-id="21151-208">If the command fails to run, you can click the 'Log' button in the bottom-right of the Perfview tool to see what was attempted to run and what the result was.</span></span>  <span data-ttu-id="21151-209">Если все входные данные верны, через несколько секунд откроется новое окно с событиями трассировки событий Windows.</span><span class="sxs-lookup"><span data-stu-id="21151-209">Assuming the input is correct then a new window will pop up and in a few seconds you will begin seeing ETW traces.</span></span>
- <span data-ttu-id="21151-210">**Журналы событий.** Подключитесь к удаленному рабочему столу виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="21151-210">**Event Logs**: Remote desktop into the VM.</span></span> <span data-ttu-id="21151-211">Откройте `Event Viewer` и проверьте, записаны ли там события.</span><span class="sxs-lookup"><span data-stu-id="21151-211">Open `Event Viewer` and ensure the events exist.</span></span>
#### <a name="is-data-getting-captured-locally"></a><span data-ttu-id="21151-212">Проверка локального сохранения данных</span><span class="sxs-lookup"><span data-stu-id="21151-212">Is data getting captured locally:</span></span>
<span data-ttu-id="21151-213">Проверьте, сохраняются ли данные локально.</span><span class="sxs-lookup"><span data-stu-id="21151-213">Next make sure the data is getting captured locally.</span></span>
<span data-ttu-id="21151-214">По умолчанию эти данные хранятся в `*.tsf` файлах TSF в [локальном хранилище данных диагностики](#log-artifacts-path).</span><span class="sxs-lookup"><span data-stu-id="21151-214">The data is locally stored in `*.tsf` files in [the local store for diagnostics data](#log-artifacts-path).</span></span> <span data-ttu-id="21151-215">Каждый тип журнала записывается в разные файлы `.tsf`.</span><span class="sxs-lookup"><span data-stu-id="21151-215">Different kinds of logs get collected in different `.tsf` files.</span></span> <span data-ttu-id="21151-216">Их имена напоминают имена таблиц в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="21151-216">The names are similar to the table names in azure storage.</span></span> <span data-ttu-id="21151-217">Например, показатели счетчиков `Performance Counters` производительности записываются в файл `PerformanceCountersTable.tsf`, а данные журналов событий — в файл `WindowsEventLogsTable.tsf`.</span><span class="sxs-lookup"><span data-stu-id="21151-217">For example `Performance Counters` get collected in `PerformanceCountersTable.tsf`, Event Logs get collected in `WindowsEventLogsTable.tsf`.</span></span> <span data-ttu-id="21151-218">Откройте локальный набор файлов, используя указания в разделе [Извлечение локального журнала](#local-log-extraction), и проверьте, записываются ли они на диск.</span><span class="sxs-lookup"><span data-stu-id="21151-218">Use the instructions in [Local Log Extraction](#local-log-extraction) section to open the local collection files and make sure you see them getting collected on disk.</span></span>

<span data-ttu-id="21151-219">Если локальные журналы не сохраняются локально и узел создает данные, скорее всего проблема связана с конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="21151-219">If you don't see logs getting collected locally and have already verified that the host is generating data, you likely have a configuration issue.</span></span> <span data-ttu-id="21151-220">Тщательно проверьте соответствующий раздел конфигурации.</span><span class="sxs-lookup"><span data-stu-id="21151-220">Review your configuration carefully for the appropriate section.</span></span> <span data-ttu-id="21151-221">Кроме того, просмотрите файл конфигурации агента наблюдения ([MaConfig.xml](#log-artifacts-path)) и проверьте, задан ли раздел с описанием соответствующего исходного журнала и не возникают ли сложности с переводом между конфигурацией системы диагностики Azure и конфигурацией агента наблюдения.</span><span class="sxs-lookup"><span data-stu-id="21151-221">Also review the configuration generated for MonitoringAgent [MaConfig.xml](#log-artifacts-path) and make sure there is some section describing the relevant log source and that it is not lost in translation between azure diagnostics configuration and monitoring agent configuration.</span></span>
#### <a name="is-data-getting-transferred"></a><span data-ttu-id="21151-222">Проверка передачи данных</span><span class="sxs-lookup"><span data-stu-id="21151-222">Is data getting transferred:</span></span>
<span data-ttu-id="21151-223">Если данные сохраняются локально, но по-прежнему не отображаются в учетной записи хранения, выполните действия ниже.</span><span class="sxs-lookup"><span data-stu-id="21151-223">If you have verified the data is getting captured locally but you still don't see it in your storage account:</span></span> 
- <span data-ttu-id="21151-224">Прежде всего проверьте, указали ли вы правильную учетную запись хранения и не отзывали ли вы ее ключи.</span><span class="sxs-lookup"><span data-stu-id="21151-224">First and foremost, make sure that you have provided a correct storage account and that you have not rolled over keys etc.for the given storage account.</span></span> <span data-ttu-id="21151-225">Иногда пользователи облачных служб не обновляют раздел `useDevelopmentStorage=true`.</span><span class="sxs-lookup"><span data-stu-id="21151-225">For cloud services, sometimes we see that people don't update their `useDevelopmentStorage=true`.</span></span>
- <span data-ttu-id="21151-226">Если учетная запись хранения указана правильно,</span><span class="sxs-lookup"><span data-stu-id="21151-226">If provided storage account is correct.</span></span> <span data-ttu-id="21151-227">проверьте наличие каких-либо ограничений сети, блокирующих доступ компонентов к конечным точкам общедоступного хранилища.</span><span class="sxs-lookup"><span data-stu-id="21151-227">Make sure you do not have some network restrictions that do not allow the components to reach public storage endpoints.</span></span> <span data-ttu-id="21151-228">Это можно сделать, подключившись к удаленному рабочему столу виртуальной машины и создав запись в той же учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="21151-228">One way to do that is to remote desktop into the machine and try to write something to the same storage account yourself.</span></span>
- <span data-ttu-id="21151-229">Наконец, вы можете просмотреть ошибки агента наблюдения.</span><span class="sxs-lookup"><span data-stu-id="21151-229">Finally, you can try and see what failure are being reported by Monitoring Agent.</span></span> <span data-ttu-id="21151-230">Агент наблюдения записывает свои журналы в файл `maeventtable.tsf` в [локальном хранилище данных диагностики](#log-artifacts-path).</span><span class="sxs-lookup"><span data-stu-id="21151-230">Monitoring agent writes its logs in `maeventtable.tsf` located in [the local store for diagnostics data](#log-artifacts-path).</span></span> <span data-ttu-id="21151-231">Откройте этот файл, выполнив указания в разделе [Извлечение локального журнала](#local-log-extraction), и проверьте `errors` чтение локальных файлов или записи в хранилище.</span><span class="sxs-lookup"><span data-stu-id="21151-231">Follow instructions in [Local Log Extraction](#local-log-extraction) section to open this file and try and figure out if there are `errors` indicating failures to read local files or write to storage.</span></span>

### <a name="capturing--archiving-logs"></a><span data-ttu-id="21151-232">Архивация и запись журналов</span><span class="sxs-lookup"><span data-stu-id="21151-232">Capturing / Archiving logs</span></span>
<span data-ttu-id="21151-233">Если действия из предыдущих разделов не позволили определить проблему, возможно, вы захотите обратиться в службу поддержки.</span><span class="sxs-lookup"><span data-stu-id="21151-233">You went through the above steps but could not figure out what was wrong and are thinking about contacting support.</span></span> <span data-ttu-id="21151-234">Первое, что они могут вас попросить, — это собрать журналы с компьютера.</span><span class="sxs-lookup"><span data-stu-id="21151-234">The first thing they might ask you is to collect logs from your machine.</span></span> <span data-ttu-id="21151-235">Вы можете сэкономить время, сделав это самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="21151-235">You can save time by doing that yourself.</span></span> <span data-ttu-id="21151-236">Запустите служебную программу `CollectGuestLogs.exe`, расположенную в папке [Служебный путь коллекции журналов ](#log-artifacts-path). В той же папке она создаст ZIP-файл со всеми соответствующими журналами Azure.</span><span class="sxs-lookup"><span data-stu-id="21151-236">Run the `CollectGuestLogs.exe` utility at  [Log Collection Utility path](#log-artifacts-path) and it generates a zip file with all relevant azure logs in the same folder.</span></span>

## <a name="diagnostics-data-tables-not-found"></a><span data-ttu-id="21151-237">Таблицы данных диагностики не найдены</span><span class="sxs-lookup"><span data-stu-id="21151-237">Diagnostics data Tables not found</span></span>
<span data-ttu-id="21151-238">Таблицы в службе хранилища Azure, содержащие события трассировки событий Windows, именуются с помощью следующего кода:</span><span class="sxs-lookup"><span data-stu-id="21151-238">The tables in Azure storage holding ETW events are named using the following code:</span></span>

```C#
        if (String.IsNullOrEmpty(eventDestination)) {
            if (e == "DefaultEvents")
                tableName = "WADDefault" + MD5(provider);
            else
                tableName = "WADEvent" + MD5(provider) + eventId;
        }
        else
            tableName = "WAD" + eventDestination;
```

<span data-ttu-id="21151-239">Пример:</span><span class="sxs-lookup"><span data-stu-id="21151-239">Here is an example:</span></span>

```XML
        <EtwEventSourceProviderConfiguration provider="prov1">
          <Event id="1" />
          <Event id="2" eventDestination="dest1" />
          <DefaultEvents />
        </EtwEventSourceProviderConfiguration>
        <EtwEventSourceProviderConfiguration provider="prov2">
          <DefaultEvents eventDestination="dest2" />
        </EtwEventSourceProviderConfiguration>
```
```JSON
"EtwEventSourceProviderConfiguration": [
    {
        "provider": "prov1",
        "Event": [
            {
                "id": 1
            },
            {
                "id": 2,
                "eventDestination": "dest1"
            }
        ],
        "DefaultEvents": {
            "eventDestination": "DefaultEventDestination",
            "sinks": ""
        }
    },
    {
        "provider": "prov2",
        "DefaultEvents": {
            "eventDestination": "dest2"
        }
    }
]
```
<span data-ttu-id="21151-240">Создается 4 таблицы:</span><span class="sxs-lookup"><span data-stu-id="21151-240">That generates 4 tables:</span></span>

| <span data-ttu-id="21151-241">Событие</span><span class="sxs-lookup"><span data-stu-id="21151-241">Event</span></span> | <span data-ttu-id="21151-242">Имя таблицы</span><span class="sxs-lookup"><span data-stu-id="21151-242">Table Name</span></span> |
| --- | --- |
| <span data-ttu-id="21151-243">provider=”prov1” &lt;Event id=”1” /&gt;</span><span class="sxs-lookup"><span data-stu-id="21151-243">provider=”prov1” &lt;Event id=”1” /&gt;</span></span> |<span data-ttu-id="21151-244">WADEvent+MD5(“prov1”)+”1”</span><span class="sxs-lookup"><span data-stu-id="21151-244">WADEvent+MD5(“prov1”)+”1”</span></span> |
| <span data-ttu-id="21151-245">provider=”prov1” &lt;Event id=”2” eventDestination=”dest1” /&gt;</span><span class="sxs-lookup"><span data-stu-id="21151-245">provider=”prov1” &lt;Event id=”2” eventDestination=”dest1” /&gt;</span></span> |<span data-ttu-id="21151-246">WADdest1</span><span class="sxs-lookup"><span data-stu-id="21151-246">WADdest1</span></span> |
| <span data-ttu-id="21151-247">provider=”prov1” &lt;DefaultEvents /&gt;</span><span class="sxs-lookup"><span data-stu-id="21151-247">provider=”prov1” &lt;DefaultEvents /&gt;</span></span> |<span data-ttu-id="21151-248">WADDefault+MD5(“prov1”)</span><span class="sxs-lookup"><span data-stu-id="21151-248">WADDefault+MD5(“prov1”)</span></span> |
| <span data-ttu-id="21151-249">provider=”prov2” &lt;DefaultEvents eventDestination=”dest2” /&gt;</span><span class="sxs-lookup"><span data-stu-id="21151-249">provider=”prov2” &lt;DefaultEvents eventDestination=”dest2” /&gt;</span></span> |<span data-ttu-id="21151-250">WADdest2</span><span class="sxs-lookup"><span data-stu-id="21151-250">WADdest2</span></span> |

## <a name="references"></a><span data-ttu-id="21151-251">Ссылки</span><span class="sxs-lookup"><span data-stu-id="21151-251">References</span></span>

### <a name="how-to-check-diagnostics-extension-configuration"></a><span data-ttu-id="21151-252">Как проверить конфигурацию расширения системы диагностики</span><span class="sxs-lookup"><span data-stu-id="21151-252">How to check Diagnostics Extension Configuration</span></span>
<span data-ttu-id="21151-253">Самый простой способ проверить конфигурацию расширения — перейти на сайт http://resources.azure.com и выбрать виртуальную машину или облачную службу, где выполняется нужное расширение системы диагностики Azure (IaaSDiagnostics или PaaDiagnostics).</span><span class="sxs-lookup"><span data-stu-id="21151-253">The easiest way to check your extension configuration is to navigate to http://resources.azure.com, navigate to the virtual machine or cloud service on which the Azure Diagnostics extension (IaaSDiagnostics / PaaDiagnostics) is in question.</span></span>

<span data-ttu-id="21151-254">Кроме того, вы можете подключиться к удаленному рабочему столу виртуальной машины и просмотреть файл конфигурации системы диагностики Azure, как описано [здесь](#log-artifacts-path).</span><span class="sxs-lookup"><span data-stu-id="21151-254">Alternatively, remote desktop into the machine and look at the Azure Diagnostics Configuration file described in the appropriate section [here](#log-artifacts-path).</span></span>

<span data-ttu-id="21151-255">В любом случае выполните поиск **Microsoft.Azure.Diagnostics**, а затем найдите поле **xmlCfg** или **WadCfg**.</span><span class="sxs-lookup"><span data-stu-id="21151-255">In either case search for **Microsoft.Azure.Diagnostics** then for the **xmlCfg** or **WadCfg** field.</span></span> 

<span data-ttu-id="21151-256">Если вы проверяете расширение на виртуальных машинах и видите поле WadCfg, то это означает, что файл конфигурации имеет формат JSON.</span><span class="sxs-lookup"><span data-stu-id="21151-256">In case of virtual machines, if the WadCfg field is present, it means the config is in JSON.</span></span> <span data-ttu-id="21151-257">Если вы видите поле xmlCfg, то это означает, что файл конфигурации имеет формат XML и кодировку Base64.</span><span class="sxs-lookup"><span data-stu-id="21151-257">If the xmlCfg field is present, it means the config is in XML and is base64 encoded.</span></span> <span data-ttu-id="21151-258">Его необходимо [декодировать](http://www.bing.com/search?q=base64+decoder), чтобы увидеть XML-файл, который был загружен системой диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-258">You need to [decode it](http://www.bing.com/search?q=base64+decoder) to see the XML that was loaded by Diagnostics.</span></span>

<span data-ttu-id="21151-259">Если вы проверяете расширение в облачной службе и открыли файл конфигурации на диске, данные в нем будут в кодировке base64, поэтому необходимо [раскодировать их](http://www.bing.com/search?q=base64+decoder), чтобы просмотреть данные XML, загруженные системой диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-259">For Cloud Service role, if you pick the configuration from disk, the data is base64 encoded so you’ll need to [decode it](http://www.bing.com/search?q=base64+decoder) to see the XML that was loaded by Diagnostics.</span></span>

### <a name="azure-diagnostics-plugin-exit-codes"></a><span data-ttu-id="21151-260">Коды выхода подключаемого модуля системы диагностики Azure</span><span class="sxs-lookup"><span data-stu-id="21151-260">Azure Diagnostics Plugin Exit Codes</span></span>
<span data-ttu-id="21151-261">Подключаемый модуль возвращает следующие коды выхода:</span><span class="sxs-lookup"><span data-stu-id="21151-261">The plugin returns the following exit codes:</span></span>

| <span data-ttu-id="21151-262">Код выхода</span><span class="sxs-lookup"><span data-stu-id="21151-262">Exit Code</span></span> | <span data-ttu-id="21151-263">Описание</span><span class="sxs-lookup"><span data-stu-id="21151-263">Description</span></span> |
| --- | --- |
| <span data-ttu-id="21151-264">0</span><span class="sxs-lookup"><span data-stu-id="21151-264">0</span></span> |<span data-ttu-id="21151-265">Успешно.</span><span class="sxs-lookup"><span data-stu-id="21151-265">Success.</span></span> |
| <span data-ttu-id="21151-266">-1</span><span class="sxs-lookup"><span data-stu-id="21151-266">-1</span></span> |<span data-ttu-id="21151-267">Общая ошибка.</span><span class="sxs-lookup"><span data-stu-id="21151-267">Generic Error.</span></span> |
| <span data-ttu-id="21151-268">-2</span><span class="sxs-lookup"><span data-stu-id="21151-268">-2</span></span> |<span data-ttu-id="21151-269">Невозможно загрузить RCF-файл.</span><span class="sxs-lookup"><span data-stu-id="21151-269">Unable to load the rcf file.</span></span><p><span data-ttu-id="21151-270">Эта внутренняя ошибка возникает только тогда, когда средство запуска подключаемого модуля гостевого агента вызвано вручную, неправильно и на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="21151-270">This internal error should only happen if the guest agent plugin launcher is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="21151-271">-3</span><span class="sxs-lookup"><span data-stu-id="21151-271">-3</span></span> |<span data-ttu-id="21151-272">Не удалось загрузить файл конфигурации системы диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-272">Cannot load the Diagnostics configuration file.</span></span><p><p><span data-ttu-id="21151-273">Решение. Это вызвано тем, что файл конфигурации не прошел проверку схемы.</span><span class="sxs-lookup"><span data-stu-id="21151-273">Solution: Caused by a configuration file not passing schema validation.</span></span> <span data-ttu-id="21151-274">Следует предоставить файл конфигурации, соответствующий схеме.</span><span class="sxs-lookup"><span data-stu-id="21151-274">The solution is to provide a configuration file that complies with the schema.</span></span> |
| <span data-ttu-id="21151-275">-4</span><span class="sxs-lookup"><span data-stu-id="21151-275">-4</span></span> |<span data-ttu-id="21151-276">Другой экземпляр системы диагностики агента мониторинга уже использует локальный каталог ресурсов.</span><span class="sxs-lookup"><span data-stu-id="21151-276">Another instance of the monitoring agent Diagnostics is already using the local resource directory.</span></span><p><p><span data-ttu-id="21151-277">Решение. Укажите другое значение для **LocalResourceDirectory**.</span><span class="sxs-lookup"><span data-stu-id="21151-277">Solution: Specify a different value for **LocalResourceDirectory**.</span></span> |
| <span data-ttu-id="21151-278">-6</span><span class="sxs-lookup"><span data-stu-id="21151-278">-6</span></span> |<span data-ttu-id="21151-279">Попытка средства запуска подключаемого модуля гостевого агента запустить систему диагностики с помощью неправильно составленной команды.</span><span class="sxs-lookup"><span data-stu-id="21151-279">The guest agent plugin launcher attempted to launch Diagnostics with an invalid command line.</span></span><p><p><span data-ttu-id="21151-280">Эта внутренняя ошибка возникает только тогда, когда средство запуска подключаемого модуля гостевого агента вызвано вручную, неправильно и на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="21151-280">This internal error should only happen if the guest agent plugin launcher is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="21151-281">-10</span><span class="sxs-lookup"><span data-stu-id="21151-281">-10</span></span> |<span data-ttu-id="21151-282">Подключаемый модуль системы диагностики был завершен с необработанным исключением.</span><span class="sxs-lookup"><span data-stu-id="21151-282">The Diagnostics plugin exited with an unhandled exception.</span></span> |
| <span data-ttu-id="21151-283">-11</span><span class="sxs-lookup"><span data-stu-id="21151-283">-11</span></span> |<span data-ttu-id="21151-284">Гостевому агенту не удалось создать процесс, ответственный за запуск и мониторинг агента мониторинга.</span><span class="sxs-lookup"><span data-stu-id="21151-284">The guest agent was unable to create the process responsible for launching and monitoring the monitoring agent.</span></span><p><p><span data-ttu-id="21151-285">Решение. Убедитесь, что доступных системных ресурсов достаточно для запуска новых процессов.</span><span class="sxs-lookup"><span data-stu-id="21151-285">Solution: Verify that sufficient system resources are available to launch new processes.</span></span><p> |
| <span data-ttu-id="21151-286">-101</span><span class="sxs-lookup"><span data-stu-id="21151-286">-101</span></span> |<span data-ttu-id="21151-287">Недопустимые аргументы при вызове подключаемого модуля системы диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-287">Invalid arguments when calling the Diagnostics plugin.</span></span><p><p><span data-ttu-id="21151-288">Эта внутренняя ошибка возникает только тогда, когда средство запуска подключаемого модуля гостевого агента вызвано вручную, неправильно и на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="21151-288">This internal error should only happen if the guest agent plugin launcher is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="21151-289">-102</span><span class="sxs-lookup"><span data-stu-id="21151-289">-102</span></span> |<span data-ttu-id="21151-290">Процесс подключаемого модуля не может инициализироваться.</span><span class="sxs-lookup"><span data-stu-id="21151-290">The plugin process is unable to initialize itself.</span></span><p><p><span data-ttu-id="21151-291">Решение. Убедитесь, что доступных системных ресурсов достаточно для запуска новых процессов.</span><span class="sxs-lookup"><span data-stu-id="21151-291">Solution: Verify that sufficient system resources are available to launch new processes.</span></span> |
| <span data-ttu-id="21151-292">-103</span><span class="sxs-lookup"><span data-stu-id="21151-292">-103</span></span> |<span data-ttu-id="21151-293">Процесс подключаемого модуля не может инициализироваться.</span><span class="sxs-lookup"><span data-stu-id="21151-293">The plugin process is unable to initialize itself.</span></span> <span data-ttu-id="21151-294">А именно: не удается создать объект средства ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="21151-294">Specifically it is unable to create the logger object.</span></span><p><p><span data-ttu-id="21151-295">Решение. Убедитесь, что доступных системных ресурсов достаточно для запуска новых процессов.</span><span class="sxs-lookup"><span data-stu-id="21151-295">Solution: Verify that sufficient system resources are available to launch new processes.</span></span> |
| <span data-ttu-id="21151-296">-104</span><span class="sxs-lookup"><span data-stu-id="21151-296">-104</span></span> |<span data-ttu-id="21151-297">Не удалось загрузить RCF-файл, предоставленный гостевым агентом.</span><span class="sxs-lookup"><span data-stu-id="21151-297">Unable to load the rcf file provided by the guest agent.</span></span><p><p><span data-ttu-id="21151-298">Эта внутренняя ошибка возникает только тогда, когда средство запуска подключаемого модуля гостевого агента вызвано вручную, неправильно и на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="21151-298">This internal error should only happen if the guest agent plugin launcher is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="21151-299">-105</span><span class="sxs-lookup"><span data-stu-id="21151-299">-105</span></span> |<span data-ttu-id="21151-300">Подключаемому модулю системы диагностики не удается открыть файл конфигурации системы диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-300">The Diagnostics plugin cannot open the Diagnostics configuration file.</span></span><p><p><span data-ttu-id="21151-301">Эта внутренняя ошибка возникает только тогда, когда подключаемый модуль системы диагностики вызван вручную, неправильно и на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="21151-301">This internal error should only happen if the Diagnostics plugin is manually invoked, incorrectly, on the VM.</span></span> |
| <span data-ttu-id="21151-302">-106</span><span class="sxs-lookup"><span data-stu-id="21151-302">-106</span></span> |<span data-ttu-id="21151-303">Не удалось прочитать файл конфигурации системы диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-303">Cannot read the Diagnostics configuration file.</span></span><p><p><span data-ttu-id="21151-304">Решение. Это вызвано тем, что файл конфигурации не прошел проверку схемы.</span><span class="sxs-lookup"><span data-stu-id="21151-304">Solution: Caused by a configuration file not passing schema validation.</span></span> <span data-ttu-id="21151-305">Решением будет предоставить файл конфигурации, соответствующий схеме.</span><span class="sxs-lookup"><span data-stu-id="21151-305">So the solution is to provide a configuration file that complies with the schema.</span></span> <span data-ttu-id="21151-306">Дополнительные сведения см. в разделе [Как проверить конфигурацию расширения системы диагностики](#how-to-check-diagnostics-extension-configuration).</span><span class="sxs-lookup"><span data-stu-id="21151-306">See [How to check Diagnostics Extension Configuration](#how-to-check-diagnostics-extension-configuration).</span></span> |
| <span data-ttu-id="21151-307">-107</span><span class="sxs-lookup"><span data-stu-id="21151-307">-107</span></span> |<span data-ttu-id="21151-308">Недопустимая передача каталога ресурсов в агент мониторинга.</span><span class="sxs-lookup"><span data-stu-id="21151-308">The resource directory pass to the monitoring agent is invalid.</span></span><p><p><span data-ttu-id="21151-309">Эта внутренняя ошибка может возникать, только если агент мониторинга вызван вручную, неправильно и на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="21151-309">This internal error should only happen if the monitoring agent is manually invoked, incorrectly, on the VM.</span></span></p> |
| <span data-ttu-id="21151-310">-108</span><span class="sxs-lookup"><span data-stu-id="21151-310">-108</span></span> |<span data-ttu-id="21151-311">Не удалось преобразовать файл конфигурации системы диагностики в файл конфигурации агента мониторинга.</span><span class="sxs-lookup"><span data-stu-id="21151-311">Unable to convert the Diagnostics configuration file into the monitoring agent configuration file.</span></span><p><p><span data-ttu-id="21151-312">Эта внутренняя ошибка может возникать, только если подключаемый модуль системы диагностики вызван с помощью недопустимого файла конфигурации.</span><span class="sxs-lookup"><span data-stu-id="21151-312">This internal error should only happen if the Diagnostics plugin is manually invoked with an invalid configuration file.</span></span> |
| <span data-ttu-id="21151-313">-110</span><span class="sxs-lookup"><span data-stu-id="21151-313">-110</span></span> |<span data-ttu-id="21151-314">Общая ошибка конфигурации системы диагностики.</span><span class="sxs-lookup"><span data-stu-id="21151-314">General Diagnostics configuration error.</span></span><p><p><span data-ttu-id="21151-315">Эта внутренняя ошибка может возникать, только если подключаемый модуль системы диагностики вызван с помощью недопустимого файла конфигурации.</span><span class="sxs-lookup"><span data-stu-id="21151-315">This internal error should only happen if the Diagnostics plugin is manually invoked with an invalid configuration file.</span></span> |
| <span data-ttu-id="21151-316">-111</span><span class="sxs-lookup"><span data-stu-id="21151-316">-111</span></span> |<span data-ttu-id="21151-317">Не удалось запустить агент мониторинга.</span><span class="sxs-lookup"><span data-stu-id="21151-317">Unable to start the monitoring agent.</span></span><p><p><span data-ttu-id="21151-318">Решение. Убедитесь, что доступен достаточный объем системных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="21151-318">Solution: Verify that sufficient system resources are available.</span></span> |
| <span data-ttu-id="21151-319">-112</span><span class="sxs-lookup"><span data-stu-id="21151-319">-112</span></span> |<span data-ttu-id="21151-320">Общая ошибка</span><span class="sxs-lookup"><span data-stu-id="21151-320">General error</span></span> |

### <a name="local-log-extraction"></a><span data-ttu-id="21151-321">Извлечение локального журнала</span><span class="sxs-lookup"><span data-stu-id="21151-321">Local Log Extraction</span></span>
<span data-ttu-id="21151-322">Агент мониторинга сохраняет данные журналов и артефактов как файлы с расширением `.tsf`.</span><span class="sxs-lookup"><span data-stu-id="21151-322">The monitoring agent collects logs and artifacts as `.tsf` files.</span></span> <span data-ttu-id="21151-323">`.tsf` Файл TSF недоступен для чтения, но его можно преобразовать в формат CSV с помощью `.csv` следующей служебной программы:</span><span class="sxs-lookup"><span data-stu-id="21151-323">`.tsf` file is not readable but you can convert it into a `.csv` as follows:</span></span> 

```
<Azure diagnostics extension package>\Monitor\x64\table2csv.exe <relevantLogFile>.tsf
```
<span data-ttu-id="21151-324">После этого создается файл `<relevantLogFile>.csv` в том же расположении, что и соответствующий файл TSF. `.tsf`</span><span class="sxs-lookup"><span data-stu-id="21151-324">A new file called `<relevantLogFile>.csv` will be created in the same path as the corresponding `.tsf` file.</span></span>

<span data-ttu-id="21151-325">**Примечание.** С помощью этой служебной программы нужно преобразовать только основной файл TSF (например, PerformanceCountersTable.tsf).</span><span class="sxs-lookup"><span data-stu-id="21151-325">**NOTE**: You only need to run this utility against the main tsf file (e.g., PerformanceCountersTable.tsf).</span></span> <span data-ttu-id="21151-326">Все сопутствующие файлы (например, PerformanceCountersTables_\*\*001.tsf, PerformanceCountersTables_\*\*002.tsf и т. д.) обрабатываются автоматически.</span><span class="sxs-lookup"><span data-stu-id="21151-326">The accompanying files (e.g., PerformanceCountersTables_\*\*001.tsf, PerformanceCountersTables_\*\*002.tsf etc.) will automatically be processed.</span></span>

### <a name="more-about-trace-logs-missing"></a><span data-ttu-id="21151-327">Подробные сведения об отсутствии журналов трассировки</span><span class="sxs-lookup"><span data-stu-id="21151-327">More About Trace Logs Missing</span></span>

<span data-ttu-id="21151-328">**Примечание.** Этот раздел главным образом относится к облачным службам, если вы не настроили DiagnosticsMonitorTraceListener в приложении, выполняющемся на виртуальной машине IaaS.</span><span class="sxs-lookup"><span data-stu-id="21151-328">**Note:** This mostly applies to cloud services only unless you have configured the DiagnosticsMonitorTraceListener on an application running on your IaaS VM.</span></span> 

- <span data-ttu-id="21151-329">Проверьте, включен ли класс DiagnosticMonitorTraceListener в файле web.config или app.config.  Этот класс по умолчанию настроен в проектах облачных служб, но некоторые клиенты могут закомментировать его, в результате чего система диагностики не собирает трассировочные операторы.</span><span class="sxs-lookup"><span data-stu-id="21151-329">Make sure the DiagnosticMonitorTraceListener is configured in the web.config or app.config.  This is configured by default in cloud service projects, but some customers comment it out which will cause the trace statements to not be collected by diagnostics.</span></span> 
- <span data-ttu-id="21151-330">Если журналы не записываются из метода OnStart или Run проверьте наличие класса DiagnosticMonitorTraceListener в файле app.config.  По умолчанию он находится в файле web.config, но применяется только к коду, выполненному в средстве w3wp.exe. Поэтому этот класс также нужно определить в файле app.config, чтобы собирать трассировки, выполненные в средстве WaIISHost.exe.</span><span class="sxs-lookup"><span data-stu-id="21151-330">If logs are not getting written from the OnStart or Run method make sure the DiagnosticMonitorTraceListener is in the app.config.  By default it is in the web.config, but that only applies to code running within w3wp.exe; so you need it in app.config to capture traces running in WaIISHost.exe.</span></span>
- <span data-ttu-id="21151-331">Убедитесь, что вы используете Diagnostics.Trace.TraceXXX, а не Diagnostics.Debug.WriteXXX.</span><span class="sxs-lookup"><span data-stu-id="21151-331">Make sure you are using Diagnostics.Trace.TraceXXX instead of Diagnostics.Debug.WriteXXX.</span></span>  <span data-ttu-id="21151-332">Операторы отладки удаляются из конечной сборки.</span><span class="sxs-lookup"><span data-stu-id="21151-332">The Debug statements will be removed from a Release build.</span></span>
- <span data-ttu-id="21151-333">Проверьте, имеет ли скомпилированный код строки Diagnostics.Trace (для проверки используйте Reflector, ildasm или ILSpy).</span><span class="sxs-lookup"><span data-stu-id="21151-333">Make sure the compiled code actually has the Diagnostics.Trace lines (use Reflector, ildasm or ILSpy to verify).</span></span>  <span data-ttu-id="21151-334">Команды Diagnostics.Trace удаляются из скомпилированного двоичного файла, если не используется символ условной компиляции трассировки.</span><span class="sxs-lookup"><span data-stu-id="21151-334">Diagnostics.Trace commands are removed from the compiled binary unless you use the TRACE conditional compilation symbol.</span></span>  <span data-ttu-id="21151-335">Если для сборки проекта используется msbuild, это обычная проблема.</span><span class="sxs-lookup"><span data-stu-id="21151-335">If using msbuild to build the project then this is a common problem to run into.</span></span>

## <a name="known-issues-and-mitigations"></a><span data-ttu-id="21151-336">Известные проблемы и устранения рисков</span><span class="sxs-lookup"><span data-stu-id="21151-336">Known Issues and Mitigations</span></span>
<span data-ttu-id="21151-337">Ниже приведен список известных проблем и способы их устранения.</span><span class="sxs-lookup"><span data-stu-id="21151-337">Here is a list of known issues with known mitigations:</span></span>

<span data-ttu-id="21151-338">**1. Зависимость от .NET 4.5.**</span><span class="sxs-lookup"><span data-stu-id="21151-338">**1. .NET 4.5 dependency:**</span></span>

<span data-ttu-id="21151-339">Система диагностики Azure имеет зависимость среды выполнения на платформе .NET 4.5 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="21151-339">WAD has a runtime dependency on .NET 4.5 framework or above.</span></span> <span data-ttu-id="21151-340">На момент написания этой статьи на всех виртуальных машинах, подготовленных для облачных служб, а также во всех официальных базовых образах виртуальных машин Azure, установлена платформа .NET 4.5 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="21151-340">At the time of writing this, all machines provisioned for cloud services as well as all official azure Virtual Machine base images have .NET 4.5 or above installed.</span></span> <span data-ttu-id="21151-341">Но все же есть вероятность того, что вы можете запустить систему диагностики Azure на виртуальной машине с платформой .NET предыдущих версий.</span><span class="sxs-lookup"><span data-stu-id="21151-341">It is still however possible to land in a situation where you try to run WAD on a machine which does not have .NET 4.5 or above.</span></span> <span data-ttu-id="21151-342">Например, если создаете виртуальную машину на основе старого образа (моментального снимка) или с помощью собственного диска.</span><span class="sxs-lookup"><span data-stu-id="21151-342">This happens when you create your machine off of an old image or snapshot; or bring your own custom disk.</span></span>

<span data-ttu-id="21151-343">В этом случае при запуске DiagnosticsPluginLauncher.exe возвращается код выхода **255**.</span><span class="sxs-lookup"><span data-stu-id="21151-343">This generally manifests as an exit code **255** when running DiagnosticsPluginLauncher.exe.</span></span> <span data-ttu-id="21151-344">Сбой происходит из-за необработанного исключения:</span><span class="sxs-lookup"><span data-stu-id="21151-344">Failure happens due to the unhandled exception:</span></span> 
```
System.IO.FileLoadException: Could not load file or assembly 'System.Threading.Tasks, Version=1.5.11.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' or one of its dependencies
```

<span data-ttu-id="21151-345">**Устранение.** Установите на виртуальной машине платформу .NET 4.5 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="21151-345">**Mitigation:** Install .NET 4.5 or higher on your machine.</span></span>

<span data-ttu-id="21151-346">**2. Данные счетчиков производительности доступные в хранилище, но не отображаются на портале.**</span><span class="sxs-lookup"><span data-stu-id="21151-346">**2. Performance Counters data available in storage but not showing in portal**</span></span>

<span data-ttu-id="21151-347">На портале виртуальных машин данные определенных счетчиков производительности отображаются по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="21151-347">Virtual machines portal experience shows certain performance counters by default.</span></span> <span data-ttu-id="21151-348">Иногда эти данные не отображаются на портале, но доступны в хранилище.</span><span class="sxs-lookup"><span data-stu-id="21151-348">If you don't see them and you know the data is getting generated because it is available in storage.</span></span> <span data-ttu-id="21151-349">Убедитесь, что:</span><span class="sxs-lookup"><span data-stu-id="21151-349">Check:</span></span>
- <span data-ttu-id="21151-350">Имена счетчиков в хранилище указаны на английском.</span><span class="sxs-lookup"><span data-stu-id="21151-350">If the data in storage has counter names in English.</span></span> <span data-ttu-id="21151-351">В противном случае диаграмма метрик на портале не сможет распознать их.</span><span class="sxs-lookup"><span data-stu-id="21151-351">If the counter names are not in English, portal metric chart will not be able to recognize it.</span></span>
- <span data-ttu-id="21151-352">Если вы используете подстановочные знаки (\*) в именах счетчиков производительности, портал не сможет отслеживать настроенные и собранные показатели счетчика.</span><span class="sxs-lookup"><span data-stu-id="21151-352">If you are using wild cards (\*) in your performance counter names, the portal will not be able to correlate the configured and collected counter.</span></span>

<span data-ttu-id="21151-353">**Предотвращение.** Изменить язык системных учетных записей виртуальной машины на английский.</span><span class="sxs-lookup"><span data-stu-id="21151-353">**Mitigation**: Change the machine's language to English for system accounts.</span></span> <span data-ttu-id="21151-354">Для этого откройте панель управления, выберите "Регион > Дополнительно > Настройка копирования" и снимите флажок "Экран приветствия и системные учетные записи". После этого пользовательские параметры языка не будут применяться к системной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="21151-354">Control Panel -> Region -> Administrative -> Copy Settings -> uncheck "Welcome screen and system accounts" so that the custom language is not applied to system account.</span></span> <span data-ttu-id="21151-355">Кроме того, удалите подстановочные знаки, если хотите, чтобы данные о потреблении отображались на портале.</span><span class="sxs-lookup"><span data-stu-id="21151-355">Also make sure you do not use wild cards if you want portal to be your primary consumption experience.</span></span>
