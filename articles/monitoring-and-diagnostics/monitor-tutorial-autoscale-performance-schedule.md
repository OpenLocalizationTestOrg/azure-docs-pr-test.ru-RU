---
title: "Автомасштабирование ресурсов Azure на основе данных о производительности или расписания | Документы Майкрософт"
description: "Создание параметра автомасштабирования для плана службы приложений с помощью данных метрики и расписания"
author: anirudhcavale
manager: orenr
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.service: monitoring-and-diagnostics
ms.topic: tutorial
ms.date: 09/25/2017
ms.author: ancav
ms.custom: mvc
ms.openlocfilehash: 7e8d97657e03b0eaff76365d3988f51c773e3b55
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="create-an-autoscale-setting-for--azure-resources-based-on-performance-data-or-a-schedule"></a>Создание параметра автомасштабирования для ресурсов Azure на основе данных о производительности или расписания

Параметры автомасштабирования позволяют добавлять и удалять экземпляры службы на основе предварительно заданных условий. Эти параметры можно создать на портале. В этом случае для создания и настройки параметра автомасштабирования используется браузерный пользовательский интерфейс. Это руководство описывает следующие этапы:

1. Создание службы приложений
2. Настройка параметра автомасштабирования
3. Активация действия развертывания
4. Активация действия свертывания

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

## <a name="log-in-to-the-azure-portal"></a>Войдите на портал Azure.

Войдите на [портал Azure](https://portal.azure.com/).

## <a name="create-a-web-app-and-app-service-plan"></a>Создание веб-приложения и плана службы приложений
1. В левой области навигации выберите **Создать**.
2. Найдите и выберите элемент *Веб-приложение* и нажмите кнопку **Создать**.
3. Выберите имя приложения, такое как *MyTestScaleWebApp*. Создайте группу ресурсов "myResourceGroup" и поместите ее в группу ресурсов по своему выбору.
4. Подготовка ресурсов закончится через несколько минут. Мы ссылаемся на веб-приложение и соответствующий план службы приложений, созданные в рамках оставшейся части этого руководства.

    ![Создание службы приложений на портале](./media/monitor-tutorial-autoscale-performance-schedule/Web-App-Create.png)

## <a name="navigate-to-autoscale-settings"></a>Переход к параметрам автомасштабирования
1. В левой области навигации выберите **Монитор**. После загрузки страницы откройте вкладку **Автомасштабирование**.
2. На ней отображается список ресурсов в вашей подписке, поддерживающих автомасштабирование. Найдите созданный ранее план службы приложений и выберите его.

    ![Переход к параметрам автомасштабирования](./media/monitor-tutorial-autoscale-performance-schedule/monitor-blade-autoscale.png)

3. На странице параметра автомасштабирования нажмите кнопку **Включить автомасштабирование**.

Выполнив описанные ниже действия, вы сможете настроить экран автомасштабирования следующим образом:

   ![Сохранение параметра автомасштабирования](./media/monitor-tutorial-autoscale-performance-schedule/Autoscale-Setting-Save.png)

 ## <a name="configure-default-profile"></a>Настройка профиля по умолчанию
1. Укажите **Имя** для параметра автомасштабирования.
2. В профиле по умолчанию установите для параметра **Режим масштабирования** значение "Масштабировать до указанного числа экземпляров".
3. Установите число экземпляров равным 1. В этом случае профиль по умолчанию возвращает число экземпляров в значение 1 при отсутствии другого активного или действующего профиля.

  ![Переход к параметрам автомасштабирования](./media/monitor-tutorial-autoscale-performance-schedule/autoscale-setting-profile.png)


## <a name="create-recurrence-profile"></a>Создание профиля повторения

1. Выберите ссылку **Add a scale condition** (Добавить условие масштабирования) в профиле по умолчанию.

2. Измените **Имя** этого профиля на "Профиль, действующий с понедельника по пятницу".

3. Установите для параметра **Режим масштабирования** значение "Масштабировать на основе метрики".

4. В области **Ограничения экземпляров** задайте для параметра **Минимум** значение "1", для параметра **Максимум** — значение "2", а для параметра **По умолчанию** — значение "1". В этом случае данный профиль не будет автоматически масштабировать план службы ниже 1 экземпляра и выше 2 экземпляров. В случае нехватки данных для принятия решения используется число экземпляров по умолчанию (в данном случае 1).

5. Для параметра **Расписание** выберите значение "Повторять в определенные дни".

6. Настройте профиль для повторения с понедельника по пятницу с 09:00 до 18:00 по тихоокеанскому времени. В этом случае профиль будет активен лишь с 9:00 до 18:00 с понедельника по пятницу. В другое время для параметра автомасштабирования используется профиль "По умолчанию".

## <a name="create-a-scale-out-rule"></a>Создание правила развертывания

1. Откройте "Профиль, действующий с понедельника по пятницу".

2. Выберите ссылку **Добавить правило**.

3. Задайте для параметра **Источник метрики** значение "Другой ресурс". Задайте для параметра **Тип ресурса** значение "Службы приложений", а для параметра **Ресурс** — веб-приложение, созданное ранее в этом руководстве.

4. Задайте для параметра **Агрегат времени** значение "Итог", для параметра **Имя метрики** — значение "Запросы", а для параметра **Статистика интервала времени** — значение "Сумма".

5. Задайте для параметра **Оператор** значение "Больше", для параметра **Порог** — значение "10", а для параметра **Длительность** — значение "5" минут.

6. Задайте для параметра **Операция** значение "увеличить счетчик на", для параметра **Число экземпляров** — значение "1", а для параметра **Восстановление** — значение "5" минут.

7. Нажмите кнопку **Добавить**.

Согласно этому правилу, если веб-приложение получает более 10 запросов за 5 минут или менее, в план службы приложений добавляется один экземпляр для управления нагрузкой.

   ![Создание правила развертывания](./media/monitor-tutorial-autoscale-performance-schedule/Scale-Out-Rule.png)

## <a name="create-a-scale-in-rule"></a>Создание правила свертывания
Мы рекомендуем вам всегда создавать правило свертывания в дополнение к правилу развертывания. Наличие этой пары правил позволяет предотвратить подготовку чрезмерного объема ресурсов, то есть когда число запущенных экземпляров больше количества, необходимого для управления нагрузкой. 

1. Откройте "Профиль, действующий с понедельника по пятницу".

2. Выберите ссылку **Добавить правило**.

3. Задайте для параметра **Источник метрики** значение "Другой ресурс". Задайте для параметра **Тип ресурса** значение "Службы приложений", а для параметра **Ресурс** — веб-приложение, созданное ранее в этом руководстве.

4. Задайте для параметра **Агрегат времени** значение "Итог", для параметра **Имя метрики** — значение "Запросы", а для параметра **Статистика интервала времени** — значение "Среднее".

5. Задайте для параметра **Оператор** значение "Меньше", для параметра **Порог** — значение "5", а для параметра **Длительность** — значение "5" минут.

6. Задайте для параметра **Операция** значение "уменьшить счетчик на", для параметра **Число экземпляров** — значение "1", а для параметра **Восстановление** — значение "5" минут.

7. Нажмите кнопку **Добавить**.

    ![Создание правила свертывания](./media/monitor-tutorial-autoscale-performance-schedule/Scale-In-Rule.png)

8. Выберите **Сохранить**, чтобы сохранить параметр автомасштабирования.

    ![Сохранение параметра автомасштабирования](./media/monitor-tutorial-autoscale-performance-schedule/Autoscale-Setting-Save.png)

## <a name="trigger-scale-out-action"></a>Активация действия развертывания
Чтобы активировать условие развертывания в недавно созданном параметре автомасштабирования, веб-приложение должно получить более 10 запросов за менее чем 5 минут.

1. Откройте окно браузера и перейдите к веб-приложению, созданному ранее в этом руководстве. Вы можете найти URL-адрес для своего веб-приложения на портале Azure, перейдя к ресурсу веб-приложения и нажав кнопку **Обзор** на вкладке "Обзор".

2. Быстро перезагрузите страницу больше 10 раз.

3. В левой области навигации выберите **Монитор**. После загрузки страницы откройте вкладку **Автомасштабирование**.

4. Выберите в списке план службы приложений, используемый в этом руководстве.

5. На странице параметра автомасштабирования откройте вкладку **Выполнения**.

6. Отображается диаграмма, отображающая изменение числа экземпляров для плана службы приложений со временем.

7. Через несколько минут число экземпляров должно увеличиваться с 1 до 2.

8. Под диаграммой приведены записи журнала действий для каждого из действий масштабирования, выполняемых параметром автомасштабирования.

## <a name="trigger-scale-in-action"></a>Активация действия свертывания
Условие свертывания в параметре автомасштабирования активируется, если веб-приложение получает менее 5 запросов за 10 минут. 

1. Отключите отправку запросов в свое веб-приложение.

2. Загрузите портал Azure.

3. В левой области навигации выберите **Монитор**. После загрузки страницы откройте вкладку **Автомасштабирование**.

4. Выберите в списке план службы приложений, используемый в этом руководстве.

5. На странице параметра автомасштабирования откройте вкладку **Выполнения**.

6. Отображается диаграмма, отображающая изменение числа экземпляров для плана службы приложений со временем.

7. Через несколько минут число экземпляров должно уменьшиться с 2 до 1. Этот процесс занимает по меньшей мере 10 минут.  

8. Под диаграммой приведены записи журнала действий для каждого из действий масштабирования, выполняемых параметром автомасштабирования.

    ![Просмотр действий свертывания](./media/monitor-tutorial-autoscale-performance-schedule/Scale-In-Chart.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

1. В меню слева на портале Azure щелкните элемент **Все ресурсы** и веб-приложение, созданное в этом руководстве.

2. На странице ресурсов щелкните **Удалить**, подтвердите операцию, введя **да** в текстовом поле, а затем щелкните **Удалить**.

3. После этого выберите ресурс плана службы приложений и щелкните **Удалить**.

4. Подтвердите удаление, введя **да** в текстовом поле, а затем щелкните **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы создали простое веб-приложение и план службы приложений. Затем вы создали параметр автомасштабирования, масштабирующий план службы приложений в зависимости от числа запросов, получаемых веб-приложением. Для получения дополнительных сведений о параметрах автомасштабирования перейдите далее к обзору автомасштабирования.

> [!div class="nextstepaction"]
> [Архивирование данных мониторинга](./monitor-tutorial-archive-monitoring-data.md)
