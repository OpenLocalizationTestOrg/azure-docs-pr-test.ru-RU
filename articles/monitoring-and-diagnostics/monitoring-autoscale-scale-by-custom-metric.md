---
title: "Начало работы с автомасштабированием на основе пользовательской метрики в Azure | Документация Майкрософт"
description: "Узнайте, как масштабировать ресурс на основе пользовательской метрики в Azure."
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: d37d3fda-8ef1-477c-a360-a855b418de84
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/07/2017
ms.author: ancav
ms.openlocfilehash: 72b6a68d0dbad4639f21aa701ec4865f36409f0a
ms.sourcegitcommit: b07d06ea51a20e32fdc61980667e801cb5db7333
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2017
---
# <a name="get-started-with-auto-scale-by-custom-metric-in-azure"></a>Начало работы с автомасштабированием на основе пользовательской метрики в Azure
В этой статье описывается, как масштабировать ресурс на основе пользовательской метрики на портале Azure.

Автомасштабирование Azure Monitor используется только с масштабируемыми наборами виртуальных машин, облачными службами, а также с планами и средами службы приложений. 

# <a name="lets-get-started"></a>Начало работы
В данной статье предполагается, что у вас есть веб-приложение, для которого настроена среда Application Insights. Если у вас его нет, вы можете [установить Application Insights для веб-сайта ASP.NET][1].

- Откройте [портал Azure][2].
- В левой области навигации щелкните значок Azure Monitor.
  ![Запуск Azure Monitor][3]
- Выберите параметр "Автомасштабирование" для просмотра всех ресурсов, к которым применяется автомасштабирование, а также его текущего состояния. ![Обнаружение автомасштабирования в Azure Monitor][4]
- В Azure Monitor откройте колонку "Автомасштабирование" и выберите ресурс, который требуется масштабировать.
> Примечание. В приведенных ниже действиях используется план службы приложений, связанный с веб-приложением, для которого настроена Application Insights.
- В колонке "Параметр масштабирования" для ресурса обратите внимание, что текущее количество экземпляров равно 1. Щелкните Enable autoscale (Включить автомасштабирование).
  ![Параметр масштабирования для нового веб-приложения][5]
- Укажите имя для параметра масштабирования и щелкните Add a rule (Добавить правило). Параметры правила масштабирования откроются в правой части в виде контекстной области. Если загрузка ЦП ресурса превышает 70 %, по умолчанию для параметра масштабирования количество экземпляров будет равно 1. Измените вверху источник метрики на Application Insights, выберите ресурс App Insights в раскрывающемся списке "Ресурс", а затем пользовательскую метрику, на основе которой будет выполняться масштабирование.
  ![Масштабирование на основе пользовательской метрики][6]
- Как и на предыдущем шаге, добавьте правило масштабирования, которое будет уменьшать количество масштабируемых элементов на 1, если значение пользовательской метрики опустится ниже порогового значения.
  ![Масштабирование на основе использования ЦП][7]
- Задайте ограничения на число экземпляров. Например, если необходимо выполнить масштабирование в пределах 2–5 экземпляров в зависимости от колебаний пользовательской метрики, следует задать для параметров "Минимум" и "По умолчанию" значение 2, а для параметра "Максимум" — значение 5.
> Примечание. Если возникнут проблемы при чтении метрик ресурсов и текущая емкость будет меньше емкости по умолчанию, компонент автомасштабирования выполнит масштабирование до значения по умолчанию, чтобы обеспечить доступность ресурса. Если текущая емкость превышает емкость по умолчанию, количество экземпляров не будет уменьшено.
- Щелкните "Сохранить".

Поздравляем! Параметр масштабирования успешно создан для автомасштабирования веб-приложения на основе пользовательской метрики.

> Примечание. Эти действия также применимы для начала работы с VMSS или ролью облачной службы.

<!--Reference-->
[1]: https://docs.microsoft.com/azure/application-insights/app-insights-asp-net
[2]: https://portal.azure.com
[3]: ./media/monitoring-autoscale-scale-by-custom-metric/azure-monitor-launch.png
[4]: ./media/monitoring-autoscale-scale-by-custom-metric/discover-autoscale-azure-monitor.png
[5]: ./media/monitoring-autoscale-scale-by-custom-metric/scale-setting-new-web-app.png
[6]: ./media/monitoring-autoscale-scale-by-custom-metric/scale-by-custom-metric.png
[7]: ./media/monitoring-autoscale-scale-by-custom-metric/autoscale-setting-custom-metrics-ai.png
