---
title: "Журнал и версии схемы конфигурации расширения системы диагностики Azure | Документация Майкрософт"
description: "Используется для сбора данных со счетчиков производительности в виртуальных машинах Azure, масштабируемых наборах виртуальных машин, Service Fabric и облачных службах."
services: monitoring-and-diagnostics
documentationcenter: .net
author: rboucher
manager: carmonm
editor: 
ms.assetid: 
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 05/16/2017
ms.author: robb
ms.openlocfilehash: 119e8a237f24cdc80a1ab8e376f2b308c9eada05
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="azure-diagnostics-extention-configuration-schema-versions-and-history"></a>Журнал и версии схемы конфигурации расширения системы диагностики Azure
На этой странице приведен указатель версий схемы расширения системы диагностики Azure, которые поставляются в составе пакета Microsoft Azure SDK.  

> [!NOTE]
> Расширение системы диагностики Azure — это компонент, который используется для сбора данных счетчиков производительности и других статистических данных из:
> - Виртуальные машины Azure 
> - Наборы для масштабирования виртуальных машин
> - Service Fabric 
> - Облачные службы 
> - группы сетевой безопасности;
> 
> Данная страница применяется только в том случае, если вы используете одну из этих служб.

Расширение системы диагностики Azure используется с другими продуктами диагностики корпорации Майкрософт, такими как Azure Monitor, Application Insights и Log Analytics. Дополнительные сведения см. в статье [Обзор мониторинга в Microsoft Azure](monitoring-overview.md).

## <a name="azure-sdk-and-diagnostics-versions-shipping-chart"></a>Диаграмма версий пакета SDK для Azure и системы диагностики  

|Версия пакета SDK для Azure | Версия расширения системы диагностики | Модель|  
|------------------|-------------------------------|------|  
|1.x               |1.0                            |Подключаемый модуль|  
|2.0–2.4         |1.0                            |Подключаемый модуль|  
|2.5               |1.2                            |Расширение|  
|2.6               |1,3                            |"|  
|2.7               |1.4                            |"|  
|2.8               |1.5                            |"|  
|2,9               |1.6                            |"|
|2.96              |1.7                            |"|
|2.96              |1.8                            |"|
|2.96              |1.8.1                          |"|
|2.96              |1.9                            |"|



 Система диагностики Azure версии 1.0 сначала поставлялась как подключаемый модуль, устанавливаемый вместе с пакетом SDK для Azure.  

 Начиная с пакета SDK 2.5 (версия системы диагностики 1.2) для системы диагностики Azure стала использоваться модель расширения. Средства, использующие новые функции, были доступны только в более новых пакетах SDK для Azure, но любая служба, использующая систему диагностики Azure, имела возможность выбрать последнюю доступную версию прямо в Azure. Например, любой пользователь, все еще использующий пакет SDK 2.5, загрузит последнюю версию, отображаемую в предыдущей таблице, даже если он не применяет новые функции.  

## <a name="schemas-index"></a>Указатель схем  
Для разных версий системы диагностики Azure используются разные схемы конфигурации. 

[Схема конфигурации системы диагностики Azure 1.0](azure-diagnostics-schema-1dot0.md)  

[Схема конфигурации системы диагностики Azure 1.2](azure-diagnostics-schema-1dot2.md)  

[Схема конфигурации системы диагностики версии 1.3 и более поздние версии](azure-diagnostics-schema-1dot3-and-later.md)  

## <a name="version-history"></a>Журнал версий


### <a name="diagnostics-extension-19"></a>Расширение системы диагностики версии 1.9 
Добавлена поддержка Docker.


### <a name="diagnostics-extension-181"></a>Расширение системы диагностики версии 1.8.1 
Вы можете указать маркер SAS вместо ключа учетной записи хранения в закрытой конфигурации. Если он указан, ключ учетной записи хранения не учитывается.


```json
{
    "storageAccountName": "diagstorageaccount",
    "storageAccountEndPoint": "https://core.windows.net",
    "storageAccountSasToken": "{sas token}",
    "SecondaryStorageAccounts": {
        "StorageAccount": [
            {
                "name": "secondarydiagstorageaccount",
                "endpoint": "https://core.windows.net",
                "sasToken": "{sas token}"
            }
        ]
    }
}
```

```xml
<PrivateConfig>
    <StorageAccount name="diagstorageaccount" endpoint="https://core.windows.net" sasToken="{sas token}" />
    <SecondaryStorageAccounts>
        <StorageAccount name="secondarydiagstorageaccount" endpoint="https://core.windows.net" sasToken="{sas token}" />
    </SecondaryStorageAccounts>
</PrivateConfig>
```


### <a name="diagnostics-extension-18"></a>Расширение системы диагностики версии 1.8 
Добавлен тип хранилища в PublicConfig. StorageType может иметь значение*Table*, *Blob* и *TableAndBlob*. Значение *Table* используется по умолчанию.


```json
{
    "WadCfg": {
    },
    "StorageAccount": "diagstorageaccount",
    "StorageType": "TableAndBlob"
}
```

```xml
<PublicConfig>
    <WadCfg />
    <StorageAccount>diagstorageaccount</StorageAccount>
    <StorageType>TableAndBlob</StorageType>
</PublicConfig>
```


### <a name="diagnostics-extension-17"></a>Расширение системы диагностики версии 1.7 
Добавлена возможность маршрутизации в концентратор событий.

### <a name="diagnostics-extension-15"></a>Расширение системы диагностики версии 1.5
Добавлен элемент sinks и возможность отправлять данные диагностики в [Application Insights](../application-insights/app-insights-cloudservices.md). Это упрощает диагностирование проблем в приложении, а также на уровне системы и инфраструктуры.

### <a name="azure-sdk-26-and-diagnostics-extension-13"></a>Пакет SDK для Azure 2.6 и расширение системы диагностики версии 1.3 
Для проектов облачной службы, созданных в Visual Studio, были внесены следующие изменения. (Эти изменения действуют и в более поздних версиях Azure SDK.)

* Локальный эмулятор теперь поддерживает систему диагностики. Это означает, что на этапе разработки и тестирования в Visual Studio вы можете собирать диагностические данные. Это позволит вам убедиться, что приложение создает правильные трассировки. При запуске проекта облачной службы в Visual Studio строка подключения `UseDevelopmentStorage=true` включает сбор диагностических данных с помощью эмулятора хранения Azure. Все диагностические данные собираются в учетную запись хранения (хранилище для разработки).
* Строка подключения к учетной записи хранения диагностической информации (Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString) также хранится в файле конфигурации (CSCFG) службы. В пакете Azure SDK версии 2.5 учетная запись хранения диагностических данных указывается в файле diagnostics.wadcfgx.

Существуют важные различия между работой строки подключения в старых версиях пакета Azure SDK (до версии 2.4 включительно) и более новых (начиная с версии 2.6).

* В Azure SDK 2.4 и более ранних версиях строка подключения использовалась как среда выполнения подключаемого модуля диагностики, который получал из нее параметры учетной записи хранения для передачи журналов диагностики.
* В Azure SDK 2.6 и более поздних версиях Visual Studio использует строку подключения диагностики для настройки учетной записи хранения в расширении диагностики во время публикации. Строка подключения позволяет вам указать разные учетные записи хранения для различных конфигураций службы. Visual Studio будет использовать их во время публикации. Но подключаемый модуль диагностики больше не доступен (в пакетах Azure SDK, начиная с версии 2.5), поэтому сам CSCFG-файл уже не может включить расширение диагностики. Его нужно включать отдельно с помощью таких средств, как Visual Studio или PowerShell.
* Выходные данные пакета Visual Studio содержат, среди прочего, общедоступный XML-файл конфигурации расширения диагностики для каждой роли. Это позволяет упростить процесс настройки расширения с помощью PowerShell. С помощью строки подключения диагностики Visual Studio получает из общедоступной конфигурации данные учетной записи хранения. Общедоступные файлы конфигураций создаются в папке «Расширения» с именами в формате bvt.bnPaaSDiagnostics<RoleName>.PubConfig.xml. Все развертывания с использованием PowerShell могут использовать этот шаблон имени для сопоставления каждой конфигурации с ролью.
* Строку подключения из CSCFG-файла также использует портал Azure для доступа к диагностическим данным, отображаемым на вкладке **Мониторинг** . Строка подключения позволяет настроить в службе отображение на портале подробных данных мониторинга.

#### <a name="migrating-projects-to-azure-sdk-26-and-later"></a>Перенос проектов на Azure SDK версии 2.6 и выше
Когда проект переносится с Azure SDK 2.5 на Azure SDK 2.6 или более новую версию, данные учетной записи хранения диагностической информации, указанные в WADCFGX-файле, сохраняются. Чтобы воспользоваться преимуществами гибкости использования различных учетных записей хранения для разных конфигураций хранилища, необходимо вручную добавить строку подключения в проект. Если при переносе проекта на основе пакета SDK для Azure 2.4 или более ранней версии на пакет SDK для Azure 2.6 строки подключения системы диагностики сохраняются. Однако не забывайте, что в Azure SDK 2.6 строки подключения используются иначе (см. предыдущий раздел).

#### <a name="how-visual-studio-determines-the-diagnostics-storage-account"></a>Определение учетной записи хранения диагностических данных в Visual Studio
* Если в CSCFG-файле указана строка подключения диагностики, Visual Studio использует ее для настройки расширения диагностики во время публикации, а также при создании общедоступных XML-файлов конфигурации на этапе упаковки.
* Если в CSCFG-файле строка подключения диагностики не указана, Visual Studio использует для этих же целей учетную запись хранения, указанную в WADCFGX-файле.
* Строка подключения диагностики в CSCFG-файле имеет более высокий приоритет, чем учетная запись хранения в WADCFGX-файле. Если в CSCFG-файле присутствует строка подключения диагностики, Visual Studio использует именно ее, игнорируя учетную запись хранения в WADCFGX-файле.

#### <a name="what-does-the-update-development-storage-connection-strings-checkbox-do"></a>Что позволяет сделать флажок "Обновлять строки подключения хранилища разработки..."?
Флажок **Обновлять строки подключения хранилища разработки для диагностики и кэширования, используя учетную запись хранения Microsoft Azure, при публикации в Microsoft Azure** позволяет быстро заменить строку подключения хранилища для разработки учетной записью хранения Azure, указанной во время публикации.

Предположим, вы установили этот флажок, а в строке подключения диагностики указан параметр `UseDevelopmentStorage=true`. Когда вы будете публиковать проект в Azure, Visual Studio автоматически заменит строки подключения диагностики учетной записью хранения, которую вы указали в мастере публикации. Но если в строке подключения диагностики указана реальная учетная запись хранения, будет использоваться именно она.

### <a name="diagnostics-functionality-differences-between-azure-sdk-24-and-earlier-and-azure-sdk-25-and-later"></a>Функциональные различия диагностики в Azure SDK между более ранними (до 2.4 включительно) и более поздними (с 2.5 включительно) версиями
Обновляя свой проект с Azure SDK 2.4 на Azure SDK 2.5 и выше, помните о следующих функциональных различиях.

* **API конфигурации больше не используются.** Программная конфигурация диагностики доступна в пакете SDK для Azure 2.4 и более ранних версий, но в дальнейших выпусках, начиная с версии SDK для Azure 2.5, она не используется. Если конфигурация диагностики в вашем проекте определена в коде, после переноса проекта на более новую версию SDK все нужно настроить заново, иначе диагностика работать не будет. Azure SDK 2.4 используется файл конфигурации диагностики diagnostics.wadcfg, а Azure SDK 2.5 и более поздние версии — diagnostics.wadcfgx.
* **Диагностику для приложений облачной службы можно настроить только на уровне роли, а не на уровне экземпляра.**
* **Конфигурация диагностики обновляется при каждом развертывании приложения.** Если изменить конфигурацию диагностики в обозревателе сервера и повторно развернуть приложение, могут возникнуть проблемы с контролем четности.
* **В пакете SDK для Azure 2.5 и более поздних версиях аварийные дампы настраиваются в файле конфигурации диагностики, а не в коде.** Если вы настроили аварийные дампы в коде проекта, следует вручную перенести параметры из кода в файл конфигурации, так как при переходе на пакет SDK для Azure 2.6 аварийные дампы не переносятся.

