---
title: "Основные сведения о настройке автомасштабирования | Документы Microsoft"
description: "Подробный разбор параметров автоматического масштабирования и принципы их работы."
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: ce2930aa-fc41-4b81-b0cb-e7ea922467e1
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/18/2017
ms.author: ancav
ms.openlocfilehash: cff2be1818417a19f36da08d8c2eaa227bb945ec
ms.sourcegitcommit: f46cbcff710f590aebe437c6dd459452ddf0af09
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2017
---
# <a name="understand-autoscale-settings"></a>Понимание параметров автоматического масштабирования
Параметры автоматического масштабирования позволяют обеспечить наличие нужных объемов ресурсов, под управлением для обработки изменяющемуся нагрузки приложения. Можно настроить параметры автомасштабирования, чтобы оно запускалось на основе указывать нагрузки или производительности, или посредством очередей триггер в назначенную дату и время. Эта статья представляет собой подробное описание параметров автоматического масштабирования. Статья начинается с изучения схему и свойства параметра, а затем рассматриваются разные типы профилей, можно настроить и наконец описывается, как автомасштабирования вычисляет профиля для выполнения в любой момент времени.

## <a name="autoscale-setting-schema"></a>Параметр схемы автоматического масштабирования
Чтобы проиллюстрировать параметр схемы автоматического масштабирования, используется следующий параметр автоматического масштабирования. Важно отметить, что этот параметр автоматического масштабирования:
- Один профиль 
- Он имеет два правила метрики в этом профиле; один для масштабирования и один для масштабирования.
- Масштабирование правило срабатывает, когда средний процент ЦП метрика масштабный набор виртуальных машин превышает 85% в течение последних 10 минут.
- Масштаб в правило срабатывает при среднее значение для набора масштабирования виртуальных машин является менее 60% для последнюю минуту.

> [!NOTE]
> Параметр может иметь несколько профилей, перейти к [профили](#autoscale-profiles) раздел для получения дополнительных сведений.
> Профиль также может иметь несколько масштабирования правилами и масштабирования в определенных, перейти к [раздел оценки](#autoscale-evaluation) чтобы увидеть, как они вычисляются

```JSON
{
  "id": "/subscriptions/s1/resourceGroups/rg1/providers/microsoft.insights/autoscalesettings/setting1",
  "name": "setting1",
  "type": "Microsoft.Insights/autoscaleSettings",
  "location": "East US",
  "properties": {
    "enabled": true,
    "targetResourceUri": "/subscriptions/s1/resourceGroups/rg1/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1",
    "profiles": [
      {
        "name": "mainProfile",
        "capacity": {
          "minimum": "1",
          "maximum": "4",
          "default": "1"
        },
        "rules": [
          {
            "metricTrigger": {
              "metricName": "Percentage CPU",
              "metricResourceUri": "/subscriptions/s1/resourceGroups/rg1/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1",
              "timeGrain": "PT1M",
              "statistic": "Average",
              "timeWindow": "PT10M",
              "timeAggregation": "Average",
              "operator": "GreaterThan",
              "threshold": 85
            },
            "scaleAction": {
              "direction": "Increase",
              "type": "ChangeCount",
              "value": "1",
              "cooldown": "PT5M"
            }
          },
    {
            "metricTrigger": {
              "metricName": "Percentage CPU",
              "metricResourceUri": "/subscriptions/s1/resourceGroups/rg1/providers/Microsoft.Compute/virtualMachineScaleSets/vmss1",
              "timeGrain": "PT1M",
              "statistic": "Average",
              "timeWindow": "PT10M",
              "timeAggregation": "Average",
              "operator": "LessThan",
              "threshold": 60
            },
            "scaleAction": {
              "direction": "Decrease",
              "type": "ChangeCount",
              "value": "1",
              "cooldown": "PT5M"
            }
          }
        ]
      }
    ]
  }
}
```

| Раздел | Имя элемента | ОПИСАНИЕ |
| --- | --- | --- |
| Параметр | ИД | Идентификатор ресурса параметра автоматического масштабирования. Параметры автоматического масштабирования являются ресурсом диспетчера ресурсов Azure. |
| Параметр | name | Имя параметра автоматического масштабирования. |
| Параметр | location | Расположение параметра автоматического масштабирования. Это расположение может отличаться от расположения масштабирование ресурса. |
| properties | targetResourceUri | Идентификатор ресурса масштабирование ресурса. Может иметь только один параметр автомасштабирования для каждого ресурса. |
| properties | профили | Параметров автоматического масштабирования, состоит из одного или нескольких профилей. При каждом запуске автомасштабирования engine выполняет один профиль. |
| Профиль | name | Имя профиля, можно выбрать любое имя, которое помогает определить профиль. |
| Профиль | Capacity.Maximum | Максимальная емкость разрешено. Это гарантирует, что Автомасштабирование при выполнении этого профиля, не является масштабируемым ресурс свыше этого числа. |
| Профиль | Capacity.Minimum | Минимальная емкость разрешено. Это гарантирует, что Автомасштабирование при выполнении этого профиля, не является масштабируемым ресурс ниже этого значения. |
| Профиль | Capacity.Default | Если имеется проблема при чтении метрики ресурсов (в данном случае ЦП «vmss1»), текущая емкость меньше емкость по умолчанию, затем обеспечить доступность ресурса автомасштабирования шкал масштабированием по умолчанию. Если количество элементов превышает емкость по умолчанию, автомасштабирования будет не масштабирования в систему. |
| Профиль | правила | Автомасштабирование автоматически масштабируется между минимальным и максимальным объемом, с помощью правил в профиле. Может быть несколько правил в профиле. Базовый сценарий является два правила, одно, чтобы определить, когда для горизонтального масштабирования, а другая — для определения времени масштабирования в. |
| правило; | metricTrigger | Определяет метрики условие правила. |
| metricTrigger | metricName | Имя метрики. |
| metricTrigger |  metricResourceUri | Идентификатор ресурса для ресурса, который выдает метрику. В большинстве случаев это то же, что масштабирование ресурса. В некоторых случаях могут быть разными, например можно масштабировать масштабного набора виртуальных машин, на основе количества сообщений в очереди хранилища. |
| metricTrigger | timeGrain | Длительность показатель выборки. Например, значение TimeGrain = «PT1M» означает, что должно быть метрики статистическая обработка каждые 1 минуты с помощью метод статистической обработки, указанный в «Статистика». |
| metricTrigger | statistic | Метод статистической обработки в течение периода временной отрезок. Например, Статистика = «Среднее» и временной отрезок = «PT1M» означает, что должно быть метрики упорядоченные по усредненному каждую минуту. Это свойство определяет порядок выборки метрику. |
| metricTrigger | timeWindow | Количество времени для поиска метрик обратно. Например, значение timeWindow = «PT10M» означает, что каждый раз при запуске автоматического масштабирования, она запрашивает метрики за последние 10 минут. Окна времени позволяет показатели будут нормализованы и позволяет избежать отклик на временных пиков. |
| metricTrigger | timeAggregation | Метод агрегирования, используемую для статистического вычисления выборки показателей. Например, TimeAggregation = «Среднее» следует объединяются метрики выборки как среднее. В нашем случае выше занять десять примеров 1 минуту, а среднее их. |
| правило; | scaleAction | Действие, выполняемое при запуске metricTrigger правила. |
| scaleAction | direction | «Увеличить» для горизонтального масштабирования, «Уменьшить» для масштабирования в|
| scaleAction | value | Сколько увеличивать или уменьшать объем ресурсов |
| scaleAction | cooldown | Количество времени ожидания после операции масштабирования, прежде чем снова масштабирование. Например если cooldown = «PT10M», то после операции масштабирования, автомасштабирования не попытается выполнить масштабирование повторно для другой 10 минут. Cooldown является предоставление метрики стабилизировать после добавления или удаления экземпляров. |

## <a name="autoscale-profiles"></a>Профилей автомасштабирования

Существует три типа профилей автомасштабирования.

1. **Регулярные профиля:** наиболее распространенные профиля. Если не нужно масштабировать ресурс по-разному основана на день недели или в определенный день, затем достаточно настроить регулярное профиль в настройке автомасштабирования. Этот профиль может быть настроены метрики правила, определяющие для горизонтального масштабирования и масштабирования в. Должна иметь только один обычный профиль определен.

    Пример профиля, использованные ранее в этой статье приведен пример регулярных профиля. Задача, не существует также возможность задать профиль для масштабирования счетчику статического экземпляра ресурса.

2. **Фиксированной даты профиля:** профилю регулярного определен, предположим, что у вас есть важные события, возникающие на 26 декабря 2017 г. (по тихоокеанскому времени) и требуется емкость минимального или максимального ресурса отличаться в этот день, но по-прежнему масштабирования одинаковых метрик . В этом случае следует добавить профиля фиксированной даты список профилей для параметра. Профиль настроен только на день события. Для любой другой день выполняется регулярного профиля.

    ``` JSON
    "profiles": [{
    "name": " regularProfile",
    "capacity": {
    ...
    },
    "rules": [{
    ...
    },
    {
    ...
    }]
    },
    {
    "name": "eventProfile",
    "capacity": {
    ...
    },
    "rules": [{
    ...
    }, {
    ...
    }],
    "fixedDate": {
        "timeZone": "Pacific Standard Time",
               "start": "2017-12-26T00:00:00",
               "end": "2017-12-26T23:59:00"
    }}
    ]
    ```
    
3. **Профиля повторения:** этого типа профиля позволяет убедиться, что этот профиль всегда используется в определенный день недели. Профили повторения имеют только время начала, в результате выполняется до следующего профиля повторения или профиля фиксированной даты настроена для запуска. Параметр с только один профиль повторения автомасштабирования выполняет этот профиль, даже при наличии регулярного профиля, определенные в тот же параметр. Два ниже показаны примеры использования этого профиля:

    **Пример 1 - vs дня недели. Выходные дни** Предположим, что по выходным требуется максимальная емкость равным 4, но в рабочие дни, так как предполагается, что больше нагрузки, вы найдете Максимальная емкость равным 10. В этом случае настроек будет содержать два профиля повторения, один для запуска на выходные дни, а другой по рабочим дням.
    Параметр будет выглядеть следующим образом:

    ``` JSON
    "profiles": [
    {
    "name": "weekdayProfile",
    "capacity": {
        ...
    },
    "rules": [{
        ...
    }],
    "recurrence": {
        "frequency": "Week",
        "schedule": {
            "timeZone": "Pacific Standard Time",
            "days": [
                "Monday"
            ],
            "hours": [
                0
            ],
            "minutes": [
                0
            ]
        }
    }}
    },
    {
    "name": "weekendProfile",
    "capacity": {
        ...
    },
    "rules": [{
        ...
    }]
    "recurrence": {
        "frequency": "Week",
        "schedule": {
            "timeZone": "Pacific Standard Time",
            "days": [
                "Saturday"
            ],
            "hours": [
                0
            ],
            "minutes": [
                0
            ]
        }
    }
    }]
    ```

    Просмотрев предыдущий параметр, вы заметите, что каждый профиль повторения расписания, расписания определяет, когда профиль начинает выполнение. Профиль останавливает выполнение, когда все готово для выполнения другого профиля.

    Например в предыдущий параметр «weekdayProfile» настроена для запуска в понедельник в 0: 00, то есть этот профиль начинает выполняться в понедельник в 12.am. Продолжает выполнение до субботы 12a.m. в случае запланированного «weekendProfile» для начала выполнения.

    **Пример 2. рабочие часы** Возьмем другой пример, возможно, необходимо иметь пороговое = «x» в рабочее время, 9: 00 к 17: 00, а затем от 17: 00. в 9: 00 следующий день требуется пороговое быть 'y'.
    Параметр будет выглядеть следующим образом:
    
    ``` JSON
    "profiles": [
    {
    "name": "businessHoursProfile",
    "capacity": {
        ...
    },
    "rules": [{
        ...
    }],
    "recurrence": {
        "frequency": "Week",
        "schedule": {
            "timeZone": "Pacific Standard Time",
            "days": [
                "Monday", “Tuesday”, “Wednesday”, “Thursday”, “Friday”
            ],
            "hours": [
                9
            ],
            "minutes": [
                0
            ]
        }
    }
    },
    {
    "name": "nonBusinessHoursProfile",
    "capacity": {
        ...
    },
    "rules": [{
        ...
    }]
    "recurrence": {
        "frequency": "Week",
        "schedule": {
            "timeZone": "Pacific Standard Time",
            "days": [
                "Monday", “Tuesday”, “Wednesday”, “Thursday”, “Friday”
            ],
            "hours": [
                17
            ],
            "minutes": [
                0
            ]
        }
    }
    }]
    ```
    
    Просмотрев предыдущий параметр «businessHoursProfile» начинает выполняться в понедельник в 9: 00 и сохраняет выполнение до 17: 00. так как при запуске «nonBusinessHoursProfile». «nonBusinessHoursProfile» выполняет до 9: 00 Вторник и затем принимает «businessHoursProfile». Это повторится, пока пятница 17: 00, на этом этапе «nonBusinessHoursProfile» выполняет вплоть до понедельник в 9: 00 так как «businessHoursProfile» не удается запустить выполнение до 9: 00 с понедельника
    
> [!Note]
> Автомасштабирования UX на портале Azure обеспечивает времени окончания для повторения профилей и начинает выполнение профиль по умолчанию параметра автоматического масштабирования между профилями повторения.
    
## <a name="autoscale-evaluation"></a>Оценка автоматического масштабирования
Учитывая Автомасштабирование параметры могут иметь несколько профилей автомасштабирования, и каждый профиль может быть несколько правил метрики, которые важно понимать, каким образом вычисляется параметров автоматического масштабирования. Каждый раз, запускается задание автомасштабирования, он начинается с выбора профиля, возможно, после выбора профиля автомасштабирования оценивает min, max, значений и правил метрики в профиле и решает, если действие масштабирования не требуется.

### <a name="which-profile-will-autoscale-pick"></a>Какой профиль выберет автоматического масштабирования
- Автомасштабирование вначале будет искать любые фиксированной даты профиль, настроенный для выполнения, при наличии, автомасштабирования выполняет его. Если существует несколько профилей фиксированной даты, которые должны выполнить, автомасштабирования выберет первый.
- Если ни одного профиля фиксированной даты, автомасштабирования просматривает повторения профилей, если найден, он выполняется.
- Если нет фиксированной или профили повторения, а затем автомасштабирования выполнение регулярного профиля.

### <a name="how-does-autoscale-evaluate-multiple-rules"></a>Как автомасштабирования вычисляет несколько правил

После автоматического масштабирования определяет, какой профиль должен выполнить, он начинается с оценки всех правил масштабирования в профиле (правила с направлением = «Увеличить»).
- Если одно или несколько правил масштабирования активируются, автомасштабирования вычисляет новое значение емкости определяется scaleAction каждого из этих правил. Затем он шкал горизонтального максимальное значение этих производственные мощности, чтобы обеспечить доступность службы.
- Например: Если имеется набор масштабирования виртуальной машины с текущего емкостью 10 и существует два правила масштабирования; один увеличение емкости на 10%, а, увеличение емкости на 3. Первое правило приведет к появлению новой емкости 11, а второе правило приведет к емкости 13. Чтобы обеспечить доступность службы автомасштабирования выберет выбирается действие, которое приводит к максимальной емкости, поэтому второе правило.

Если правила масштабирования не активируются, автомасштабирования вычисляет все шкалы в правила (правила с направлением = «Уменьшение»). Автомасштабирования принимает действие масштабирования в только в том случае, если запускаются все правила масштабирования в.
- Автомасштабирование вычисляет новое значение емкости определяется scaleAction каждого из этих правил. Затем он выбирает действие масштабирования, приводит к более эти производственные мощности, чтобы обеспечить доступность службы.
- Например: Если имеется набор масштабирования виртуальной машины с текущего емкостью 10 и существуют две шкалы в правила; один уменьшается на 50% мощности, а, уменьшение емкости на 3. Первое правило приведет к появлению новой емкости 5, а второе правило приведет к емкости 7. Чтобы обеспечить доступность службы автомасштабирования выберет выбирается действие, которое приводит к максимальной емкости, поэтому второе правило.

## <a name="next-steps"></a>Следующие шаги
Чтобы узнать больше о автомасштабирования см. в следующих ресурсах:

* [Обзор автомасштабирования](monitoring-overview-autoscale.md)
* [Общие метрики автомасштабирования Azure Monitor](insights-autoscale-common-metrics.md)
* [Рекомендации по автомасштабированию в Azure Monitor](insights-autoscale-best-practices.md)
* [Использование действий автомасштабирования для отправки электронной почты и уведомлений об оповещениях веб-перехватчика в Azure Insights](insights-autoscale-to-webhook-email.md)
* [Create or update an autoscale setting in Azure Insights REST API (Создание и изменение параметров автомасштабирования в REST API Azure Insights)](https://msdn.microsoft.com/library/dn931953.aspx)
