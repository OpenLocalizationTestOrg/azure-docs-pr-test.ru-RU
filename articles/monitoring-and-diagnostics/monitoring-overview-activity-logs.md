---
title: "Общие сведения о журнале действий Azure | Документация Майкрософт"
description: "Узнайте, что такое журнал действий Azure и как его использовать для просмотра событий, происходящих в рамках подписки Azure."
author: johnkemnetz
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: c274782f-039d-4c28-9ddb-f89ce21052c7
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/02/2017
ms.author: johnkem
ms.openlocfilehash: 8ff9f73fc0732cd2227b7e0cc1091e04d69014eb
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="monitor-subscription-activity-with-the-azure-activity-log"></a><span data-ttu-id="e0fe2-103">Мониторинг действий подписки с помощью журнала действий Azure</span><span class="sxs-lookup"><span data-stu-id="e0fe2-103">Monitor Subscription Activity with the Azure Activity Log</span></span>
<span data-ttu-id="e0fe2-104">**Журнал действий Azure** — это журнал подписки с подробными сведениями о событиях на уровне подписки, которые произошли в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-104">The **Azure Activity Log** is a subscription log that provides insight into subscription-level events that have occurred in Azure.</span></span> <span data-ttu-id="e0fe2-105">Сюда входят различные данные — от операционных данных Azure Resource Manager до обновлений в событиях работоспособности службы.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-105">This includes a range of data, from Azure Resource Manager operational data to updates on Service Health events.</span></span> <span data-ttu-id="e0fe2-106">Журнал действий раньше назывался журналом аудита или операционным журналом, так как категория "Административная" содержит связанные с подписками события на уровне управления.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-106">The Activity Log was previously known as “Audit Logs” or “Operational Logs,” since the Administrative category reports control-plane events for your subscriptions.</span></span> <span data-ttu-id="e0fe2-107">С помощью журнала изменений можно ответить на вопросы "что? кто? когда?" о любой операции записи (PUT, POST, DELETE) с ресурсами в вашей подписке.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-107">Using the Activity Log, you can determine the ‘what, who, and when’ for any write operations (PUT, POST, DELETE) taken on the resources in your subscription.</span></span> <span data-ttu-id="e0fe2-108">Вы также можете отслеживать состояние операции и другие ее свойства.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-108">You can also understand the status of the operation and other relevant properties.</span></span> <span data-ttu-id="e0fe2-109">Журнал действий не содержит операции чтения (GET) или операции с ресурсами, которые используют классическую модель или модель RDFE.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-109">The Activity Log does not include read (GET) operations or operations for resources that use the Classic/"RDFE" model.</span></span>

![<span data-ttu-id="e0fe2-110">Журналы действий и другие типы журналов</span><span class="sxs-lookup"><span data-stu-id="e0fe2-110">Activity Logs vs other types of logs</span></span> ](./media/monitoring-overview-activity-logs/Activity_Log_vs_other_logs_v5.png)

<span data-ttu-id="e0fe2-111">Рис. 1. Журналы действий и другие типы журналов</span><span class="sxs-lookup"><span data-stu-id="e0fe2-111">Figure 1: Activity Logs vs other types of logs</span></span>

<span data-ttu-id="e0fe2-112">Журналы действий отличаются от [журналов диагностики](monitoring-overview-of-diagnostic-logs.md).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-112">The Activity Log differs from [Diagnostic Logs](monitoring-overview-of-diagnostic-logs.md).</span></span> <span data-ttu-id="e0fe2-113">Журналы действий предоставляют внешние данные об операциях с ресурсами (плоскость управления).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-113">Activity Logs provide data about the operations on a resource from the outside (the "control plane").</span></span> <span data-ttu-id="e0fe2-114">Журналы диагностики выдаются ресурсом и содержат данные о его работе (плоскость данных).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-114">Diagnostics Logs are emitted by a resource and provide information about the operation of that resource (the "data plane").</span></span>

<span data-ttu-id="e0fe2-115">События из журнала изменений можно получить с помощью портала Azure, интерфейса командной строки, командлетов PowerShell или REST API Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-115">You can retrieve events from your Activity Log using the Azure portal, CLI, PowerShell cmdlets, and Azure Monitor REST API.</span></span>


> [!WARNING]
> <span data-ttu-id="e0fe2-116">Журнал действий Azure используется главным образом для действий, которые происходят в Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-116">The Azure Activity Log is primarily for activities that occur in Azure Resource Manager.</span></span> <span data-ttu-id="e0fe2-117">Ресурсы, использующие классическую модель или модель RDFE, не отслеживаются.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-117">It does not track resources using the Classic/RDFE model.</span></span> <span data-ttu-id="e0fe2-118">Для некоторых классических типов ресурсов в Azure Resource Manager имеется прокси-поставщик ресурсов (например, Microsoft.ClassicCompute).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-118">Some Classic resource types have a proxy resource provider in Azure Resource Manager (for example, Microsoft.ClassicCompute).</span></span> <span data-ttu-id="e0fe2-119">Если вы взаимодействуете с ресурсом классического типа через Azure Resource Manager с помощью этих прокси-поставщиков ресурсов, то такие операции отображаются в журнале действий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-119">If you interact with a Classic resource type through Azure Resource Manager using these proxy resource providers, the operations appear in the Activity Log.</span></span> <span data-ttu-id="e0fe2-120">Если вы взаимодействуете с ресурсом классического типа на классическом портале или иным образом вне прокси Azure Resource Manager, то ваши действия записываются только в журнал операций.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-120">If you interact with a Classic resource type in the Classic portal or otherwise outside of the Azure Resource Manager proxies, your actions are only recorded in the Operation Log.</span></span> <span data-ttu-id="e0fe2-121">Журнал операций доступен только на классическом портале.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-121">The Operation Log is accessible only in the Classic portal.</span></span>
>
>

<span data-ttu-id="e0fe2-122">Просмотрите следующее ознакомительное видео о журнале действий:</span><span class="sxs-lookup"><span data-stu-id="e0fe2-122">View the following video introducing the Activity Log.</span></span>
> [!VIDEO https://channel9.msdn.com/Blogs/Seth-Juarez/Logs-John-Kemnetz/player]
> 
>

## <a name="categories-in-the-activity-log"></a><span data-ttu-id="e0fe2-123">Категории в журнале действий</span><span class="sxs-lookup"><span data-stu-id="e0fe2-123">Categories in the Activity Log</span></span>
<span data-ttu-id="e0fe2-124">Журнал действий содержит несколько категорий данных.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-124">The Activity Log contains several categories of data.</span></span> <span data-ttu-id="e0fe2-125">Подробные сведения о схемах этих категорий см. в [этой статье](monitoring-activity-log-schema.md).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-125">For full details on the schemata of these categories, [see this article](monitoring-activity-log-schema.md).</span></span> <span data-ttu-id="e0fe2-126">В частности, описаны такие возможности:</span><span class="sxs-lookup"><span data-stu-id="e0fe2-126">These include:</span></span>
* <span data-ttu-id="e0fe2-127">**Административная**. Эта категория содержит записи всех операций создания, обновления, удаления и других действий, которые выполняются через Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-127">**Administrative** - This category contains the record of all create, update, delete, and action operations performed through Resource Manager.</span></span> <span data-ttu-id="e0fe2-128">В качестве примеров типов событий, которые относятся к этой категории, можно назвать "создание виртуальной машины" или "удаление группы безопасности сети". Каждое действие, выполняемое пользователем или приложением с помощью Resource Manager, моделируется как операция с определенным типом ресурсов.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-128">Examples of the types of events you would see in this category include "create virtual machine" and "delete network security group" Every action taken by a user or application using Resource Manager is modeled as an operation on a particular resource type.</span></span> <span data-ttu-id="e0fe2-129">Если тип операции — "запись", "удаление" или "действие", то любые сведения об этой операции (о ее запуске, успешном выполнении или сбое) записываются в категорию "Административная".</span><span class="sxs-lookup"><span data-stu-id="e0fe2-129">If the operation type is Write, Delete, or Action, the records of both the start and success or fail of that operation are recorded in the Administrative category.</span></span> <span data-ttu-id="e0fe2-130">Категория "Административная" также включает в себя любые изменения в управлении доступом на основе ролей, которые происходят в подписке.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-130">The Administrative category also includes any changes to role-based access control in a subscription.</span></span>
* <span data-ttu-id="e0fe2-131">**Работоспособность службы**. Эта категория содержит записи всех инцидентов, связанных с работоспособностью службы, которые произошли в Azure.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-131">**Service Health** - This category contains the record of any service health incidents that have occurred in Azure.</span></span> <span data-ttu-id="e0fe2-132">В качестве примера типа события из этой категории можно назвать следующее: "В работе SQL Azure в восточной части США наблюдаются простои".</span><span class="sxs-lookup"><span data-stu-id="e0fe2-132">An example of the type of event you would see in this category is "SQL Azure in East US is experiencing downtime."</span></span> <span data-ttu-id="e0fe2-133">Существует шесть разновидностей событий работоспособности службы: "Требуется действие", "Помощь при восстановлении", "Инцидент", "Обслуживание", "Сведения" и "Безопасность". Они отображаются, только если в подписке есть ресурс, на который повлияет данное событие.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-133">Service health events come in five varieties: Action Required, Assisted Recovery, Incident, Maintenance, Information, or Security, and only appear if you have a resource in the subscription that would be impacted by the event.</span></span>
* <span data-ttu-id="e0fe2-134">**Оповещение**. Эта категория содержит записи всех активаций оповещений Azure.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-134">**Alert** - This category contains the record of all activations of Azure alerts.</span></span> <span data-ttu-id="e0fe2-135">В качестве примера типа события из этой категории можно назвать следующее: "Процент использования ЦП на виртуальной машине myVM за последние 5 минут превышал 80 %".</span><span class="sxs-lookup"><span data-stu-id="e0fe2-135">An example of the type of event you would see in this category is "CPU % on myVM has been over 80 for the past 5 minutes."</span></span> <span data-ttu-id="e0fe2-136">Различные системы Azure работают по принципу оповещений, то есть вы можете определить какое-то правило, и система будет направлять вам уведомление, когда условия этого правила выполняются.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-136">A variety of Azure systems have an alerting concept -- you can define a rule of some sort and receive a notification when conditions match that rule.</span></span> <span data-ttu-id="e0fe2-137">Каждый раз, когда "активируется" поддерживаемый тип оповещения Azure или выполняются условия для создания уведомления, в эту категорию журнала активности также передается запись об активации.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-137">Each time a supported Azure alert type 'activates,' or the conditions are met to generate a notification, a record of the activation is also pushed to this category of the Activity Log.</span></span>
* <span data-ttu-id="e0fe2-138">**Автомасштабирование**. Эта категория содержит записи всех событий, связанных с операциями системы автоматического масштабирования, в основе которой лежат параметры автомасштабирования, определенные в подписке.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-138">**Autoscale** - This category contains the record of any events related to the operation of the autoscale engine based on any autoscale settings you have defined in your subscription.</span></span> <span data-ttu-id="e0fe2-139">В качестве примера типа события из этой категории можно назвать следующее: "Не удалось выполнить автоматическое увеличение масштаба".</span><span class="sxs-lookup"><span data-stu-id="e0fe2-139">An example of the type of event you would see in this category is "Autoscale scale up action failed."</span></span> <span data-ttu-id="e0fe2-140">С помощью функции автомасштабирования можно автоматически увеличивать или уменьшать число экземпляров в поддерживаемом типе ресурсов на основе времени суток и (или) загружать данные (метрики), используя параметр автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-140">Using autoscale, you can automatically scale out or scale in the number of instances in a supported resource type based on time of day and/or load (metric) data using an autoscale setting.</span></span> <span data-ttu-id="e0fe2-141">Когда выполняются условия для увеличения или уменьшения масштаба, в эту категорию записываются соответствующие события (запуск, успешное выполнение или сбой).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-141">When the conditions are met to scale up or down, the start and succeeded or failed events are recorded in this category.</span></span>
* <span data-ttu-id="e0fe2-142">**Рекомендация**. Эта категория содержит события рекомендации из определенных типов ресурсов, таких как веб-сайты и серверы SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-142">**Recommendation** - This category contains recommendation events from certain resource types, such as web sites and SQL servers.</span></span> <span data-ttu-id="e0fe2-143">Эти события предоставляют рекомендации о лучшем использовании ресурсов.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-143">These events offer recommendations for how to better utilize your resources.</span></span> <span data-ttu-id="e0fe2-144">Вы будете получать события этого типа, только если у вас будут ресурсы, которые генерируют рекомендации.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-144">You only receive events of this type if you have resources that emit recommendations.</span></span>
* <span data-ttu-id="e0fe2-145">**Политика, Безопасность и Работоспособность ресурсов**. Эти категории не содержат никаких событий. Они зарезервированы для использования в будущем.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-145">**Policy, Security, and Resource Health** - These categories do not contain any events; they are reserved for future use.</span></span>

## <a name="event-schema-per-category"></a><span data-ttu-id="e0fe2-146">Схема событий по категориям</span><span class="sxs-lookup"><span data-stu-id="e0fe2-146">Event schema per category</span></span>
[<span data-ttu-id="e0fe2-147">Ознакомьтесь с этой статьей, чтобы понять, как устроена схема событий журнала действий по категориям.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-147">See this article to understand the Activity Log event schema per category.</span></span>](monitoring-activity-log-schema.md)

## <a name="what-you-can-do-with-the-activity-log"></a><span data-ttu-id="e0fe2-148">Что можно делать с журналом действий</span><span class="sxs-lookup"><span data-stu-id="e0fe2-148">What you can do with the Activity Log</span></span>
<span data-ttu-id="e0fe2-149">Ниже описано несколько доступных операций с журналом действий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-149">Here are some of the things you can do with the Activity Log:</span></span>

![Журнал действий Azure](./media/monitoring-overview-activity-logs/Activity_Log_Overview_v3.png)


* <span data-ttu-id="e0fe2-151">Запросы и просмотры журнала на **портале Azure**.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-151">Query and view it in the **Azure portal**.</span></span>
* [<span data-ttu-id="e0fe2-152">Создание оповещения о событии журнала действий Azure.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-152">Create an alert on an Activity Log event.</span></span>](monitoring-activity-log-alerts.md)
* <span data-ttu-id="e0fe2-153">[Потоковая передача журнала в **концентратор событий**](monitoring-stream-activity-logs-event-hubs.md) для обработки в сторонней службе или пользовательском аналитическом решении, например PowerBI.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-153">[Stream it to an **Event Hub**](monitoring-stream-activity-logs-event-hubs.md) for ingestion by a third-party service or custom analytics solution such as PowerBI.</span></span>
* <span data-ttu-id="e0fe2-154">Анализ журнала в PowerBI с помощью [**пакета содержимого PowerBI**](https://powerbi.microsoft.com/documentation/powerbi-content-pack-azure-audit-logs/).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-154">Analyze it in PowerBI using the [**PowerBI content pack**](https://powerbi.microsoft.com/documentation/powerbi-content-pack-azure-audit-logs/).</span></span>
* <span data-ttu-id="e0fe2-155">[Сохранение журнала в **учетную запись хранения** для архивации или проверки вручную](monitoring-archive-activity-log.md).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-155">[Save it to a **Storage Account** for archival or manual inspection](monitoring-archive-activity-log.md).</span></span> <span data-ttu-id="e0fe2-156">В **профиле журнала** можно задать время хранения (в днях).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-156">You can specify the retention time (in days) using the **Log Profile**.</span></span>
* <span data-ttu-id="e0fe2-157">Обращение к журналу с помощью командлетов PowerShell, интерфейса командной строки или REST API.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-157">Query it via PowerShell Cmdlet, CLI, or REST API.</span></span>

## <a name="query-the-activity-log-in-the-azure-portal"></a><span data-ttu-id="e0fe2-158">Запрос журнала действий на портале Azure</span><span class="sxs-lookup"><span data-stu-id="e0fe2-158">Query the Activity Log in the Azure portal</span></span>
<span data-ttu-id="e0fe2-159">На портале Azure журнал действий можно просмотреть в нескольких местах:</span><span class="sxs-lookup"><span data-stu-id="e0fe2-159">Within the Azure portal you can view your Activity Log in several places:</span></span>
* <span data-ttu-id="e0fe2-160">В колонке **Журнал действий**, к которой можно перейти, выполнив поиска журнала действий в разделе "Больше служб" в области навигации слева.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-160">The **Activity Log blade**, which you can access by searching for the Activity Log under "More Services" in the left-hand navigation pane.</span></span>
* <span data-ttu-id="e0fe2-161">В колонке **Монитор**, которая по умолчанию отображается в области навигации слева.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-161">The **Monitor blade**, which appears by default in the left-hand navigation pane.</span></span> <span data-ttu-id="e0fe2-162">Журнал действий занимает один раздел этой колонки Azure Monitor.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-162">The Activity Log is one section of this Azure Monitor blade.</span></span>
* <span data-ttu-id="e0fe2-163">В колонке любого **ресурса**, например в колонке конфигурации виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-163">Any resource's **resource blade**, for example, the configuration blade for a Virtual Machine.</span></span> <span data-ttu-id="e0fe2-164">Журнал действий занимает один из разделов в большинстве этих колонок ресурсов, и если щелкнуть его, события будут автоматически отфильтрованы в соответствии с данным ресурсом.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-164">The Activity Log is be one of the sections on most of these resource blades, and clicking on it automatically filters the events to those related to that specific resource.</span></span>

<span data-ttu-id="e0fe2-165">На портале Azure можно отфильтровать журнал действий по приведенным ниже полям.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-165">In the Azure portal, you can filter your Activity Log by these fields:</span></span>
* <span data-ttu-id="e0fe2-166">"Временной интервал": время начала и окончания событий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-166">Timespan - The start and end time for events.</span></span>
* <span data-ttu-id="e0fe2-167">"Категория": категории событий, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-167">Category - The event category as described above.</span></span>
* <span data-ttu-id="e0fe2-168">"Подписка": одно или несколько имен подписок Azure.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-168">Subscription - One or more Azure subscription names.</span></span>
* <span data-ttu-id="e0fe2-169">"Группа ресурсов": одна или несколько групп ресурсов в этих подписках.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-169">Resource group - One or more resource groups within those subscriptions.</span></span>
* <span data-ttu-id="e0fe2-170">"Имя ресурса": имя определенного ресурса.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-170">Resource (name) - The name of a specific resource.</span></span>
* <span data-ttu-id="e0fe2-171">"Тип ресурса": тип ресурса, например, Microsoft.Compute/virtualmachines.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-171">Resource type - The type of resource, for example, Microsoft.Compute/virtualmachines.</span></span>
* <span data-ttu-id="e0fe2-172">"Имя операции": имя операции Azure Resource Manager, например Microsoft.SQL/servers/Write.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-172">Operation name - The name of an Azure Resource Manager operation, for example, Microsoft.SQL/servers/Write.</span></span>
* <span data-ttu-id="e0fe2-173">"Серьезность": уровень серьезности события ("Информационное", "Предупреждение", "Ошибка", "Критическое").</span><span class="sxs-lookup"><span data-stu-id="e0fe2-173">Severity - The severity level of the event (Informational, Warning, Error, Critical).</span></span>
* <span data-ttu-id="e0fe2-174">"Кем инициировано событие": "вызывающая сторона" или пользователь, выполнивший операцию.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-174">Event initiated by - The 'caller,' or user who performed the operation.</span></span>
* <span data-ttu-id="e0fe2-175">"Открыть поиск": текстовое поле поиска, с помощью которого можно искать указанную строку во всех полях всех событий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-175">Open search - This is an open text search box that searches for that string across all fields in all events.</span></span>

<span data-ttu-id="e0fe2-176">Определив набор фильтров, его можно сохранить как запрос, который сохраняется между сеансами, если в будущем вам понадобится выполнять такой же запрос с этими фильтрами.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-176">Once you have defined a set of filters, you can save it as a query that is persisted across sessions if you ever need to perform the same query with those filters applied again in the future.</span></span> <span data-ttu-id="e0fe2-177">Этот запрос можно также закрепить на панели мониторинга Azure, чтобы всегда следить за определенными событиями.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-177">You can also pin a query to your Azure dashboard to always keep an eye on specific events.</span></span>

<span data-ttu-id="e0fe2-178">Если щелкнуть "Применить", будет выполнен запрос и показаны все соответствующие ему события.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-178">Clicking "Apply" runs your query and show all matching events.</span></span> <span data-ttu-id="e0fe2-179">Если щелкнуть любое событие в списке, отобразится сводка по этому событию, а также полные необработанные данные JSON для него.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-179">Clicking on any event in the list shows the summary of that event as well as the full raw JSON of that event.</span></span>

<span data-ttu-id="e0fe2-180">Чтобы еще больше расширить возможности, можно щелкнуть значок **Поиск по журналу**. Это позволит отобразить данные журнала действий в [решении Log Analytics для аналитики журнала действий](../log-analytics/log-analytics-activity.md).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-180">For even more power, you can click the **Log Search** icon, which displays your Activity Log data in the [Log Analytics Activity Log Analytics solution](../log-analytics/log-analytics-activity.md).</span></span> <span data-ttu-id="e0fe2-181">В колонке "Журнал действий" доступны основные фильтры и средства обзора журналов, тогда как Log Analytics позволяет сводить, запрашивать и визуализировать данные более эффективными способами.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-181">The Activity Log blade offers a basic filter/browse experience on logs, but Log Analytics enables you to pivot, query, and visualize your data in more powerful ways.</span></span>

## <a name="export-the-activity-log-with-a-log-profile"></a><span data-ttu-id="e0fe2-182">Экспорт журнала действий с помощью профиля журнала</span><span class="sxs-lookup"><span data-stu-id="e0fe2-182">Export the Activity Log with a Log Profile</span></span>
<span data-ttu-id="e0fe2-183">**Профиль журнала** определяет, как экспортируется журнал действий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-183">A **Log Profile** controls how your Activity Log is exported.</span></span> <span data-ttu-id="e0fe2-184">С помощью профиля журнала вы можете настроить следующие параметры.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-184">Using a Log Profile, you can configure:</span></span>

* <span data-ttu-id="e0fe2-185">Куда будет отправлен журнал действий (учетная запись хранения или концентраторы событий).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-185">Where the Activity Log should be sent (Storage Account or Event Hubs)</span></span>
* <span data-ttu-id="e0fe2-186">Какие категории событий будут отправляться (запись, удаление, действие).</span><span class="sxs-lookup"><span data-stu-id="e0fe2-186">Which event categories (Write, Delete, Action) should be sent.</span></span> <span data-ttu-id="e0fe2-187">*Термин "категория" имеет разное значение в профилях журнала и событиях журнала действий. В профиле журнала "категория" обозначает тип операции (запись, удаление, действие). А в событии журнала действий "категория" представляет источник или тип события (например, Administration, ServiceHealth, Alert и т. д.).*</span><span class="sxs-lookup"><span data-stu-id="e0fe2-187">*The meaning of "category" in Log Profiles and Activity Log events is different. In the Log Profile, "Category" represents the operation type (Write, Delete, Action). In an Activity Log event, the "category" property represents the source or type of event (for example, Administration, ServiceHealth, Alert, and more).*</span></span>
* <span data-ttu-id="e0fe2-188">Какие регионы (расположения) будут экспортированы.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-188">Which regions (locations) should be exported.</span></span> <span data-ttu-id="e0fe2-189">Обязательно укажите глобальное расположение, так как в журнале действий существует множество глобальных событий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-189">Make sure to include "global," as many events in the Activity Log are global events.</span></span>
* <span data-ttu-id="e0fe2-190">Как долго должен храниться журнал действий в учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-190">How long the Activity Log should be retained in a Storage Account.</span></span>
    - <span data-ttu-id="e0fe2-191">Срок хранения 0 дней означает, что журналы хранятся неограниченно долго.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-191">A retention of zero days means logs are kept forever.</span></span> <span data-ttu-id="e0fe2-192">В противном случае укажите количество дней в диапазоне от 1 до 2 147 483 647.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-192">Otherwise, the value can be any number of days between 1 and 2147483647.</span></span>
    - <span data-ttu-id="e0fe2-193">Если политики хранения заданы, но хранение журналов в учетной записи хранения отключено (например, выбраны только варианты концентраторов событий или OMS), политики хранения не будут применены.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-193">If retention policies are set but storing logs in a Storage Account is disabled (for example, if only Event Hubs or OMS options are selected), the retention policies have no effect.</span></span>
    - <span data-ttu-id="e0fe2-194">Политики хранения применяются по дням, поэтому в конце дня (по времени в формате UTC) журналы, срок которых теперь превышает период хранения, будут удалены.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-194">Retention policies are applied per-day, so at the end of a day (UTC), logs from the day that is now beyond the retention policy are deleted.</span></span> <span data-ttu-id="e0fe2-195">Например, если настроена политика хранения в течение одного дня, то в начале текущего дня журналы за вчерашний день будет удалены.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-195">For example, if you had a retention policy of one day, at the beginning of the day today the logs from the day before yesterday would be deleted.</span></span>

<span data-ttu-id="e0fe2-196">Вы можете использовать учетную запись хранения или пространство имен концентратора событий, не входящее в подписку, в которой создаются журналы.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-196">You can use a storage account or event hub namespace that is not in the same subscription as the one emitting logs.</span></span> <span data-ttu-id="e0fe2-197">Пользователю, который настраивает этот параметр, должен быть предоставлен соответствующий уровень доступа RBAC к обеим подпискам.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-197">The user who configures the setting must have the appropriate RBAC access to both subscriptions.</span></span>

<span data-ttu-id="e0fe2-198">Эти параметры можно настроить с помощью параметра "Экспорт" в колонке журнала изменений на портале.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-198">These settings can be configured via the “Export” option in the Activity Log blade in the portal.</span></span> <span data-ttu-id="e0fe2-199">Их также можно настроить программно [с помощью REST API Azure Monitor](https://msdn.microsoft.com/library/azure/dn931927.aspx), командлетов PowerShell или интерфейса командной строки.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-199">They can also be configured programmatically [using the Azure Monitor REST API](https://msdn.microsoft.com/library/azure/dn931927.aspx), PowerShell cmdlets, or CLI.</span></span> <span data-ttu-id="e0fe2-200">Для каждой подписки может существовать только один профиль журнала.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-200">A subscription can only have one log profile.</span></span>

### <a name="configure-log-profiles-using-the-azure-portal"></a><span data-ttu-id="e0fe2-201">Настройка профилей журнала на портале Azure</span><span class="sxs-lookup"><span data-stu-id="e0fe2-201">Configure log profiles using the Azure portal</span></span>
<span data-ttu-id="e0fe2-202">С помощью параметра "Экспорт" на портале Azure можно выполнить потоковую передачу журнала действий в концентратор событий или сохранить журнал в учетную запись хранения.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-202">You can stream the Activity Log to an Event Hub or store them in a Storage Account by using the “Export” option in the Azure portal.</span></span>

1. <span data-ttu-id="e0fe2-203">Перейдите к колонке **Журнал действий** с помощью меню в левой части портала.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-203">Navigate to the **Activity Log** blade using the menu on the left side of the portal.</span></span>

    ![Переход к журналу действий на портале](./media/monitoring-overview-activity-logs/activity-logs-portal-navigate.png)
2. <span data-ttu-id="e0fe2-205">Нажмите кнопку **Экспорт** в верхней части колонки.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-205">Click the **Export** button at the top of the blade.</span></span>

    ![Кнопка экспорта на портале](./media/monitoring-overview-activity-logs/activity-logs-portal-export.png)
3. <span data-ttu-id="e0fe2-207">В появившейся колонке вы можете выбрать следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="e0fe2-207">In the blade that appears, you can select:</span></span>  
  * <span data-ttu-id="e0fe2-208">регионы, события которых нужно экспортировать;</span><span class="sxs-lookup"><span data-stu-id="e0fe2-208">regions for which you would like to export events</span></span>
  * <span data-ttu-id="e0fe2-209">учетная запись хранения, в которой вы хотите сохранить события;</span><span class="sxs-lookup"><span data-stu-id="e0fe2-209">the Storage Account to which you would like to save events</span></span>
  * <span data-ttu-id="e0fe2-210">сколько дней следует хранить эти события в хранилище</span><span class="sxs-lookup"><span data-stu-id="e0fe2-210">the number of days you want to retain these events in storage.</span></span> <span data-ttu-id="e0fe2-211">(если выбрать значение "0 дней", журналы будут храниться бессрочно);</span><span class="sxs-lookup"><span data-stu-id="e0fe2-211">A setting of 0 days retains the logs forever.</span></span>
  * <span data-ttu-id="e0fe2-212">пространство имен служебной шины, в котором следует создать концентратор событий для потоковой передачи этих событий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-212">the Service Bus Namespace in which you would like an Event Hub to be created for streaming these events.</span></span>

     ![Колонка экспорта журнала действий](./media/monitoring-overview-activity-logs/activity-logs-portal-export-blade.png)
4. <span data-ttu-id="e0fe2-214">Нажмите кнопку **Сохранить** , чтобы сохранить эти параметры.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-214">Click **Save** to save these settings.</span></span> <span data-ttu-id="e0fe2-215">Параметры будут немедленно применены к подписке</span><span class="sxs-lookup"><span data-stu-id="e0fe2-215">The settings are immediately be applied to your subscription.</span></span>

### <a name="configure-log-profiles-using-the-azure-powershell-cmdlets"></a><span data-ttu-id="e0fe2-216">Настройка профилей журнала с помощью командлетов Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="e0fe2-216">Configure log profiles using the Azure PowerShell Cmdlets</span></span>
#### <a name="get-existing-log-profile"></a><span data-ttu-id="e0fe2-217">Получение существующего профиля журнала</span><span class="sxs-lookup"><span data-stu-id="e0fe2-217">Get existing log profile</span></span>
```
Get-AzureRmLogProfile
```

#### <a name="add-a-log-profile"></a><span data-ttu-id="e0fe2-218">Добавление профиля журнала</span><span class="sxs-lookup"><span data-stu-id="e0fe2-218">Add a log profile</span></span>
```
Add-AzureRmLogProfile -Name my_log_profile -StorageAccountId /subscriptions/s1/resourceGroups/myrg1/providers/Microsoft.Storage/storageAccounts/my_storage -serviceBusRuleId /subscriptions/s1/resourceGroups/Default-ServiceBus-EastUS/providers/Microsoft.ServiceBus/namespaces/mytestSB/authorizationrules/RootManageSharedAccessKey -Locations global,westus,eastus -RetentionInDays 90 -Categories Write,Delete,Action
```

| <span data-ttu-id="e0fe2-219">Свойство</span><span class="sxs-lookup"><span data-stu-id="e0fe2-219">Property</span></span> | <span data-ttu-id="e0fe2-220">Обязательно</span><span class="sxs-lookup"><span data-stu-id="e0fe2-220">Required</span></span> | <span data-ttu-id="e0fe2-221">Description (Описание)</span><span class="sxs-lookup"><span data-stu-id="e0fe2-221">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e0fe2-222">Name (Имя)</span><span class="sxs-lookup"><span data-stu-id="e0fe2-222">Name</span></span> |<span data-ttu-id="e0fe2-223">Да</span><span class="sxs-lookup"><span data-stu-id="e0fe2-223">Yes</span></span> |<span data-ttu-id="e0fe2-224">Имя профиля журнала.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-224">Name of your log profile.</span></span> |
| <span data-ttu-id="e0fe2-225">StorageAccountId</span><span class="sxs-lookup"><span data-stu-id="e0fe2-225">StorageAccountId</span></span> |<span data-ttu-id="e0fe2-226">Нет</span><span class="sxs-lookup"><span data-stu-id="e0fe2-226">No</span></span> |<span data-ttu-id="e0fe2-227">Идентификатор ресурса для учетной записи хранения, в которую будет сохранен журнал действий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-227">Resource ID of the Storage Account to which the Activity Log should be saved.</span></span> |
| <span data-ttu-id="e0fe2-228">serviceBusRuleId</span><span class="sxs-lookup"><span data-stu-id="e0fe2-228">serviceBusRuleId</span></span> |<span data-ttu-id="e0fe2-229">Нет</span><span class="sxs-lookup"><span data-stu-id="e0fe2-229">No</span></span> |<span data-ttu-id="e0fe2-230">Идентификатор правила служебной шины для пространства имен служебной шины, в котором вы будут созданы концентраторы событий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-230">Service Bus Rule ID for the Service Bus namespace you would like to have event hubs created in.</span></span> <span data-ttu-id="e0fe2-231">Это строка в таком формате: `{service bus resource ID}/authorizationrules/{key name}`.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-231">Is a string with this format: `{service bus resource ID}/authorizationrules/{key name}`.</span></span> |
| <span data-ttu-id="e0fe2-232">Расположения</span><span class="sxs-lookup"><span data-stu-id="e0fe2-232">Locations</span></span> |<span data-ttu-id="e0fe2-233">Да</span><span class="sxs-lookup"><span data-stu-id="e0fe2-233">Yes</span></span> |<span data-ttu-id="e0fe2-234">Разделенный запятыми список регионов, для которых будут собираться события журнала действий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-234">Comma-separated list of regions for which you would like to collect Activity Log events.</span></span> |
| <span data-ttu-id="e0fe2-235">RetentionInDays</span><span class="sxs-lookup"><span data-stu-id="e0fe2-235">RetentionInDays</span></span> |<span data-ttu-id="e0fe2-236">Да</span><span class="sxs-lookup"><span data-stu-id="e0fe2-236">Yes</span></span> |<span data-ttu-id="e0fe2-237">Количество дней, в течение которых будут храниться события: от 1 до 2 147 483 647.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-237">Number of days for which events should be retained, between 1 and 2147483647.</span></span> <span data-ttu-id="e0fe2-238">Нулевое значение означает, что журналы хранятся неограниченно долго, то есть всегда.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-238">A value of zero stores the logs indefinitely (forever).</span></span> |
| <span data-ttu-id="e0fe2-239">Категории</span><span class="sxs-lookup"><span data-stu-id="e0fe2-239">Categories</span></span> |<span data-ttu-id="e0fe2-240">Нет</span><span class="sxs-lookup"><span data-stu-id="e0fe2-240">No</span></span> |<span data-ttu-id="e0fe2-241">Разделенный запятыми список категорий событий, которые будут собираться.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-241">Comma-separated list of event categories that should be collected.</span></span> <span data-ttu-id="e0fe2-242">Возможные значения: Write, Delete или Action.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-242">Possible values are Write, Delete, and Action.</span></span> |

#### <a name="remove-a-log-profile"></a><span data-ttu-id="e0fe2-243">Удаление профиля журнала</span><span class="sxs-lookup"><span data-stu-id="e0fe2-243">Remove a log profile</span></span>
```
Remove-AzureRmLogProfile -name my_log_profile
```

### <a name="configure-log-profiles-using-the-azure-cross-platform-cli"></a><span data-ttu-id="e0fe2-244">Настройка профилей журнала с помощью кроссплатформенного интерфейса командной строки</span><span class="sxs-lookup"><span data-stu-id="e0fe2-244">Configure log profiles Using the Azure Cross-Platform CLI</span></span>
#### <a name="get-existing-log-profile"></a><span data-ttu-id="e0fe2-245">Получение существующего профиля журнала</span><span class="sxs-lookup"><span data-stu-id="e0fe2-245">Get existing log profile</span></span>
```
azure insights logprofile list
```
```
azure insights logprofile get --name my_log_profile
```
<span data-ttu-id="e0fe2-246">Свойство `name` должно содержать имя профиля журнала.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-246">The `name` property should be the name of your log profile.</span></span>

#### <a name="add-a-log-profile"></a><span data-ttu-id="e0fe2-247">Добавление профиля журнала</span><span class="sxs-lookup"><span data-stu-id="e0fe2-247">Add a log profile</span></span>
```
azure insights logprofile add --name my_log_profile --storageId /subscriptions/s1/resourceGroups/insights-integration/providers/Microsoft.Storage/storageAccounts/my_storage --serviceBusRuleId /subscriptions/s1/resourceGroups/Default-ServiceBus-EastUS/providers/Microsoft.ServiceBus/namespaces/mytestSB/authorizationrules/RootManageSharedAccessKey --locations global,westus,eastus,northeurope --retentionInDays 90 –categories Write,Delete,Action
```

| <span data-ttu-id="e0fe2-248">Свойство</span><span class="sxs-lookup"><span data-stu-id="e0fe2-248">Property</span></span> | <span data-ttu-id="e0fe2-249">Обязательно</span><span class="sxs-lookup"><span data-stu-id="e0fe2-249">Required</span></span> | <span data-ttu-id="e0fe2-250">Description (Описание)</span><span class="sxs-lookup"><span data-stu-id="e0fe2-250">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e0fe2-251">name</span><span class="sxs-lookup"><span data-stu-id="e0fe2-251">name</span></span> |<span data-ttu-id="e0fe2-252">Да</span><span class="sxs-lookup"><span data-stu-id="e0fe2-252">Yes</span></span> |<span data-ttu-id="e0fe2-253">Имя профиля журнала.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-253">Name of your log profile.</span></span> |
| <span data-ttu-id="e0fe2-254">storageId</span><span class="sxs-lookup"><span data-stu-id="e0fe2-254">storageId</span></span> |<span data-ttu-id="e0fe2-255">Нет</span><span class="sxs-lookup"><span data-stu-id="e0fe2-255">No</span></span> |<span data-ttu-id="e0fe2-256">Идентификатор ресурса для учетной записи хранения, в которую будет сохранен журнал действий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-256">Resource ID of the Storage Account to which the Activity Log should be saved.</span></span> |
| <span data-ttu-id="e0fe2-257">serviceBusRuleId</span><span class="sxs-lookup"><span data-stu-id="e0fe2-257">serviceBusRuleId</span></span> |<span data-ttu-id="e0fe2-258">Нет</span><span class="sxs-lookup"><span data-stu-id="e0fe2-258">No</span></span> |<span data-ttu-id="e0fe2-259">Идентификатор правила служебной шины для пространства имен служебной шины, в котором вы будут созданы концентраторы событий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-259">Service Bus Rule ID for the Service Bus namespace you would like to have event hubs created in.</span></span> <span data-ttu-id="e0fe2-260">Это строка в таком формате: `{service bus resource ID}/authorizationrules/{key name}`.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-260">Is a string with this format: `{service bus resource ID}/authorizationrules/{key name}`.</span></span> |
| <span data-ttu-id="e0fe2-261">locations</span><span class="sxs-lookup"><span data-stu-id="e0fe2-261">locations</span></span> |<span data-ttu-id="e0fe2-262">Да</span><span class="sxs-lookup"><span data-stu-id="e0fe2-262">Yes</span></span> |<span data-ttu-id="e0fe2-263">Разделенный запятыми список регионов, для которых будут собираться события журнала действий.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-263">Comma-separated list of regions for which you would like to collect Activity Log events.</span></span> |
| <span data-ttu-id="e0fe2-264">RetentionInDays</span><span class="sxs-lookup"><span data-stu-id="e0fe2-264">retentionInDays</span></span> |<span data-ttu-id="e0fe2-265">Да</span><span class="sxs-lookup"><span data-stu-id="e0fe2-265">Yes</span></span> |<span data-ttu-id="e0fe2-266">Количество дней, в течение которых будут храниться события: от 1 до 2 147 483 647.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-266">Number of days for which events should be retained, between 1 and 2147483647.</span></span> <span data-ttu-id="e0fe2-267">Нулевое значение означает, что журналы хранятся неограниченно долго, то есть всегда.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-267">A value of zero stores the logs indefinitely (forever).</span></span> |
| <span data-ttu-id="e0fe2-268">Категории</span><span class="sxs-lookup"><span data-stu-id="e0fe2-268">categories</span></span> |<span data-ttu-id="e0fe2-269">Нет</span><span class="sxs-lookup"><span data-stu-id="e0fe2-269">No</span></span> |<span data-ttu-id="e0fe2-270">Разделенный запятыми список категорий событий, которые будут собираться.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-270">Comma-separated list of event categories that should be collected.</span></span> <span data-ttu-id="e0fe2-271">Возможные значения: Write, Delete или Action.</span><span class="sxs-lookup"><span data-stu-id="e0fe2-271">Possible values are Write, Delete, and Action.</span></span> |

#### <a name="remove-a-log-profile"></a><span data-ttu-id="e0fe2-272">Удаление профиля журнала</span><span class="sxs-lookup"><span data-stu-id="e0fe2-272">Remove a log profile</span></span>
```
azure insights logprofile delete --name my_log_profile
```

## <a name="next-steps"></a><span data-ttu-id="e0fe2-273">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="e0fe2-273">Next Steps</span></span>
* [<span data-ttu-id="e0fe2-274">Дополнительные сведения о журнале действий (прежнее название — журналы аудита)</span><span class="sxs-lookup"><span data-stu-id="e0fe2-274">Learn more about the Activity Log (formerly Audit Logs)</span></span>](../azure-resource-manager/resource-group-audit.md)
* [<span data-ttu-id="e0fe2-275">Потоковая передача журнала действий Azure в концентраторы событий</span><span class="sxs-lookup"><span data-stu-id="e0fe2-275">Stream the Azure Activity Log to Event Hubs</span></span>](monitoring-stream-activity-logs-event-hubs.md)
