---
title: "Техническое руководство по переносу решений EDI для BizTalk Server в службы BizTalk | Документация Майкрософт"
description: "Перенос EDI в MABS; Службы BizTalk Microsoft Azure"
services: biztalk-services
documentationcenter: na
author: MandiOhlinger
manager: anneta
editor: 
ms.assetid: 61c179fa-3f37-495b-8016-dee7474fd3a6
ms.service: biztalk-services
ms.workload: integration
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 11/07/2016
ms.author: mandia
ms.openlocfilehash: 1b70fc3d199d7f1521acb534dafec8fb3e69500e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="migrating-biztalk-server-edi-solutions-to-biztalk-services-technical-guide"></a>Перенос решений EDI для BizTalk Server в службы BizTalk: техническое руководство

> [!INCLUDE [BizTalk Services is being retired, and replaced with Azure Logic Apps](../../includes/biztalk-services-retirement.md)]

Авторы: Тим Виман (Tim Wieman) и Нитин Мехротра (Nitin Mehrotra)

Рецензенты: Катрик Брахти (Karthik Bharthy)

Написано с использованием служб BizTalk Microsoft Azure, выпуск от февраля 2014 г.

## <a name="introduction"></a>Введение
Электронный обмен данными (EDI) является одним из наиболее распространенных средств электронного обмена данными между предприятиями, его также называют транзакциями «бизнес — бизнес» или B2B. BizTalk Server поддерживает EDI более десяти лет с момента своего первоначального выпуска. С помощью служб BizTalk Microsoft продолжает поддерживать решения EDI на платформе Microsoft Azure. B2B-транзакции в основном являются внешними для организации и поэтому их легче реализовать на базе облачной платформы. Microsoft Azure предоставляет такую возможность посредством служб BizTalk.

Хотя некоторые клиенты смотрят на службы BizTalk как на «зеленое поле» для новых решений EDI, у многих клиентов есть текущие решения EDI для BizTalk Server, которые они хотели бы перенести Azure. Поскольку EDI служб BizTalk построена на тех же основных понятиях, что и EDI для BizTalk Server (торговые партнеры, сущности, соглашения), артефакты EDI для BizTalk Server можно перенести в службы BizTalk.

В этом документе рассматриваются некоторые отличия, связанные с переносом артефактов EDI для BizTalk Server в службы BizTalk. Этот документ предполагает наличие у читателя практического опыта обработки EDI для BizTalk Server и соглашений между торговыми партнерами. Дополнительные сведения о EDI для BizTalk Server см. в статье [Управление торговыми партнерами с помощью BizTalk Server](https://msdn.microsoft.com/library/bb259970.aspx).

## <a name="which-version-of-biztalk-server-edi-artifacts-can-be-migrated-to-biztalk-services"></a>Какая версия артефактов EDI для BizTalk Server может быть перенесена в службы BizTalk?
Модуль EDI для BizTalk Server был значительно усовершенствован в BizTalk Server 2010, когда в него были включены партнеры, профили и соглашения. В службах BizTalk используется та же самая модель упорядочения торговых партнеров и бизнес-подразделений этих торговых партнеров, что и в BizTalk Server. Поэтому перенос артефактов EDI для BizTalk Server 2010 и более поздних версий в службы BizTalk является намного более простым процессом. Для версий BizTalk Server до 2010 необходимо сначала выполнить обновление BizTalk Server до версии 2010 и затем перенести артефакты EDI в службы BizTalk.

## <a name="scenariosmessage-flow"></a>Сценарии и поток сообщений
Как и в BizTalk Server, обработка EDI в службах BizTalk построена вокруг решения управления торговыми партнерами (TPM). Решение TPM состоит из следующих ключевых компонентов.

* Торговые партнеры, которые представляют организацию в B2B-транзакции.
* Профили, которые представляют подразделения торгового партнера.
* Соглашения торгового партнера, которые представляют бизнес-соглашения между двумя партнерами или профилями.

На следующем рисунке показаны сходства и различия между решениями EDI для BizTalk Server и решениями EDI для служб BizTalk.

![][EDImessageflow]

Ключевые сходства и различия между работой решения EDI в BizTalk Server и службах BizTalk таковы.

* Так же, как в BizTalk Server для получения сообщений EDI используется конвейер EDIReceive, а для отправки сообщений EDI — конвейер EDISend, в службах BizTalk для получения сообщений EDI используется мост EDI Receive, а для отправки — мост EDI Send. В BizTalk Server конвейеры связываются с соглашением с помощью портов отправки и получения. В службах BizTalk мост отправки или приема определяется самим соглашением.
* В BizTalk Server после обработки сообщения EDI конвейером EDIReceive оно помещается в базу данных SQL Server. Затем конвейер EdiSend извлекает сообщение из базы данных SQL Server, обрабатывает его и отправляет торговому партнеру.
  
    В службах BizTalk после получения сообщения приемный мост EDI обрабатывает его и направляет сообщение внешнему процессу. Внешний процесс может быть запущен в Microsoft Azure или локально. Внешний процесс должен отправить сообщение мосту отправки EDI; мост отправки не извлекает сообщения самостоятельно. После обработки сообщения мост отправки EDI направляет сообщение торговому партнеру.

В службах BizTalk можно легко и удобно создать и развернуть B2B-соглашение между торговыми партнерами, не настраивая ни одного вычислительного экземпляра Microsoft Azure (рабочих ролей и веб-ролей), ни одной базы данных SQL Microsoft Azure и ни одной учетной записи службы хранилища Microsoft Azure. Более сложные сценарии требуют привязок в рабочих процессах или другой обработки «по краям» соглашения между торговыми партнерами, то есть до или после обработки торгового соглашения партнера мостом EDI. Ниже подробно описана последовательность событий, которые возникают при обработке сообщения EDI в службах BizTalk.

1. Сообщение EDI получено от торгового партнера Fabrikam.  Для получения сообщений EDI от торговых партнеров службы BizTalk поддерживают такие транспортные протоколы, как FTP, SFTP, AS2 и HTTP/S.
2. На стороне приема соглашения торговых партнеров сообщение EDI разбирается в формат XML.  Разобранное EDI-сообщение (в формате XML) можно направить в конечные точки служебной шины, такие как конечная точка ретранслятора служебной шины, раздел служебной шины, очередь служебной шины или мост служб BizTalk.
3. Затем разобранные XML-сообщения можно получить из конечной точки для дальнейшей пользовательской обработки.  Эти конечные точки могут быть обработаны локальным компонентом или вычислительной операцией Microsoft Azure для дальнейшей обработки, например в службе Windows Workflow (WF) или в службе Windows Communication Foundation (WCF).
4. Затем на стороне отправки соглашения торгового партнера XML-сообщение собирается в формат EDI и отправляется его торговому партнеру Contoso.  Для отправки сообщений EDI торговым партнерам службы BizTalk поддерживают те же протоколы, которые используются для получения сообщений EDI.

Далее в этом документе содержатся подробные указания по переносу некоторых артефактов EDI для BizTalk Server в службы BizTalk.

## <a name="sendreceive-ports-to-trading-partners"></a>Порты отправки и получения для торговых партнеров
В BizTalk Server необходимо настроить местоположение приема и порт приема для приема сообщений EDI/XML от торговых партнеров, а также порты отправки для отправки сообщений EDI/XML торговому партнеру. Затем нужно связать эти порты с соглашением между торговыми партнерами с помощью консоли администрирования BizTalk Server. В службах BizTalk места получения сообщений от торговых партнеров и отправки сообщений торговым партнерам настраиваются как часть самого торгового соглашения (в составе Параметров передачи) на портале служб BizTalk.  Поэтому в службах BizTalk «портов отправки» и «портов получения» как таковых нет. Дополнительные сведения см. в статье [Создание соглашений](https://msdn.microsoft.com/library/windowsazure/hh689908.aspx).

## <a name="pipelines-bridges"></a>Конвейеры (мосты)
В EDI BizTalk Server конвейеры — это сущности для обработки сообщений, которые также могут включать настраиваемую логику для обработки определенных возможностей необходимых приложению. Их эквивалентом в службах BizTalk является мост EDI. Однако в службах BizTalk мосты EDI пока «закрыты».  То есть в мост EDI нельзя добавить собственные пользовательские действия. Любая пользовательская обработка должна выполняться вне моста EDI в приложении, до или после поступления сообщения в мост, настроенный как часть соглашения между торговыми партнерами. Мосты EAI имеют возможность пользовательской обработки данных. Чтобы ей воспользоваться, необходимо воспользоваться мостом EAI до или после обработки сообщения мостом EDI. Дополнительные сведения см. в статье [Включение пользовательского кода в мостах](https://msdn.microsoft.com/library/azure/dn232389.aspx).

Для обработки сообщения можно включить поток публикации или подписки с пользовательским кодом и/или использовать очереди сообщений и разделы служебной шины, до того как соглашение между торговыми партнерами получит сообщение или после того как соглашение обработает сообщение и направит его в конечную точку служебной шины.

Шаблон потока сообщений описан в разделе **Сценарии и поток сообщений** этой статьи.

## <a name="agreements"></a>Соглашения
Если вы знакомы с соглашениями между торговыми партнерами в BizTalk Server 2010, используемыми для обработки сообщений EDI, то соглашения между торговыми партнерами в службах BizTalk покажутся очень знакомыми. Большинство параметров соглашения одинаковы и используют ту же терминологию. В некоторых случаях параметры соглашения в службах гораздо проще по сравнению с аналогичными параметрами в BizTalk Server. Службы BizTalk Microsoft Azure поддерживают транспортные протоколы X12, EDIFACT и AS2.

Службы BizTalk Microsoft Azure также предоставляют средство **переноса данных TPM** для переноса торговых партнеров и соглашений из модуля торговых партнеров BizTalk Server на портал служб BizTalk. Средство переноса данных TPM доступно как часть пакета инструментов, который можно загрузить из [MABS SDK](http://go.microsoft.com/fwlink/p/?LinkId=235057). Пакет также содержит файл сведений с инструкциями по использованию средства и базовой информацией об устранении неполадок.

## <a name="schemas"></a>Схемы
Службы BizTalk предоставляют схемы EDI, которые можно использовать в решениях служб BizTalk.  Кроме того со службами BizTalk также могут использоваться схемы EDI для BizTalk Server, поскольку корневой узел схемы одинаков в EDI для BizTalk Server и для служб BizTalk. Таким образом, схемы EDI для BizTalk Server можно напрямую использовать в решениях EDI, разработанных с помощью служб BizTalk. Схемы также можно загрузить из [MABS SDK](http://go.microsoft.com/fwlink/p/?LinkId=235057).

## <a name="maps-transforms"></a>Сопоставления (преобразования)
Сопоставления в BizTalk Server называются преобразованиями в службах BizTalk. Миграция сопоставлений из BizTalk Server в службы BizTalk может быть весьма сложной задачей (в зависимости от сложности сопоставления). Средство сопоставления для служб BizTalk отличается от модуля сопоставления для BizTalk Server. Несмотря на то что модуль сопоставления очень похож на средство сопоставления, сам формат сопоставления отличается. Доступные пользователям функтоиды (называемые **операциями сопоставления** в службах BizTalk) также отличаются.  По сути, напрямую сопоставление BizTalk в службах BizTalk использовать нельзя. Кроме того, не все функтоиды в BizTalk Server доступны как операции сопоставления в службах BizTalk.

### <a name="new-transform-operations"></a>Новые операции преобразования
Хотя список доступных операций сопоставления преобразований в службах BizTalk может довольно сильно отличаться от списка в модуле сопоставления BizTalk Server, преобразования в службах BizTalk, по сути, выполняют те же задачи новыми способами. Например, в преобразованиях служб BizTalk доступен **Список операций**. В модуле сопоставления BizTalk этого списка не было.  **Список операций** позволяет создавать и работать со списком, который представляет собой набор элементов (также называемых "строками"), и каждый элемент может иметь несколько членов (также называемых "столбцами").  Список можно сортировать, выбирать элементы по условию и т. д.

Еще один пример новой функциональности в преобразованиях служб BizTalk — **операции цикла**.  В модуле сопоставления BizTalk Server сложно создавать вложенные циклы.  Таким образом, к преобразованиям служб BizTalk добавлены циклические операции с сопоставлениями.

Еще один пример — оператор **If-Then-Else** для сопоставления.  В модуле сопоставления BizTalk эта операция была невозможной и приходилось использовать несколько функтоидов для решения этой внешне простой задачи.

### <a name="migrating-biztalk-server-maps"></a>Миграция сопоставлений BizTalk Server
Службы BizTalk Microsoft Azure предоставляют средства для переноса сопоставлений BizTalk Server в преобразования служб BizTalk. Инструмент **BTMMigrationTool** входит в пакет **Инструменты**, предоставляемый при [скачивании пакета SDK для служб BizTalk](http://go.microsoft.com/fwlink/p/?LinkId=235057). Дополнительные сведения об этом средстве приведены в статье [Преобразование сопоставления BizTalk в преобразование служб BizTalk](https://msdn.microsoft.com/library/windowsazure/hh949812.aspx).

Кроме того, вы можете посмотреть на пример Сандро Перейры (Sandro Pereira), наиболее ценного специалиста Майкрософт, о [переносе сопоставлений BizTalk Server в службы BizTalk](http://social.technet.microsoft.com/wiki/contents/articles/23220.migrating-biztalk-server-maps-to-windows-azure-biztalk-services-wabs-maps.aspx).

## <a name="orchestrations"></a>Взаимодействия
Если нужно перенести обработку взаимодействий BizTalk Server в Microsoft Azure, то взаимодействия потребуется переписать, так как Microsoft Azure не поддерживает выполнение взаимодействий BizTalk Server.  Функциональность взаимодействий можно переписать в службе Windows Workflow Foundation 4.0 (WF4).  Возможно, ее придется переписать полностью, так как на данный момент не существует возможности переноса взаимодействий из BizTalk Server в WF4. Ниже приведены некоторые ресурсы для Windows Workflow.

* [*Интеграция службы WCF Workflow с очередями и разделами служебной шины*](https://msdn.microsoft.com/library/azure/hh709041.aspx) Паоло Сальватори (Paolo Salvatori). 
* [*Создание приложений с Windows Workflow Foundation и Azure*](http://go.microsoft.com/fwlink/p/?LinkId=237314) (выступление на конференции Build 2011).
* [*Центр разработчиков Windows Workflow Foundation*](http://go.microsoft.com/fwlink/p/?LinkId=237315) в MSDN.
* [*Документация по Windows Workflow Foundation 4 (WF4)*](https://msdn.microsoft.com/library/dd489441.aspx) в MSDN.

## <a name="other-considerations"></a>Дополнительные рекомендации
Ниже приведены некоторые рекомендации, которые необходимо учитывать при использовании служб BizTalk.

### <a name="fallback-agreements"></a>Резервные соглашения
При обработке EDI в BizTalk Server используется концепция «Резервных соглашений».  В службах BizTalk понятия резервных соглашений пока **нет**.  Сведения об использовании резервных соглашений в BizTalk Server см. в следующих разделах документации BizTalk: [Роль соглашений в обработке EDI](http://go.microsoft.com/fwlink/p/?LinkId=237317) и [Настройка свойств глобальных и резервных соглашений](https://msdn.microsoft.com/library/bb245981.aspx).

### <a name="routing-to-multiple-destinations"></a>Маршрутизация нескольким получателям
Мосты служб BizTalk на данный момент не поддерживают маршрутизацию сообщений нескольким получателям с использованием модели публикации-подписки. Вместо этого сообщения от моста служб BizTalk можно направить в раздел служебной шины, который может иметь несколько подписок для получения сообщения на нескольких конечных точках.

## <a name="conclusion"></a>Заключение
Службы BizTalk Microsoft Azure регулярно обновляются для добавления новых функций и возможностей. С каждым обновлением мы рассчитываем на увеличение функциональности для облегчения создания решений полного цикла с помощью служб BizTalk и других технологий Azure.

## <a name="see-also"></a>См. также
[Разработка корпоративных приложений с Azure](https://msdn.microsoft.com/library/azure/hh674490.aspx)

[EDImessageflow]: ./media/biztalk-migrating-to-edi-guide/IC719455.png
