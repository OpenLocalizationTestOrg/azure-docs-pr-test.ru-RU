---
title: "Архивация приложения в Azure"
description: "Узнайте, как создавать резервные копии приложений в службе приложений Azure."
services: app-service
documentationcenter: 
author: cephalin
manager: erikre
editor: jimbe
ms.assetid: 6223b6bd-84ec-48df-943f-461d84605694
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/06/2016
ms.author: cephalin
ms.openlocfilehash: 435370a8758d439a5fcce2e04efd11b4aaaf0357
ms.sourcegitcommit: 933af6219266cc685d0c9009f533ca1be03aa5e9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/18/2017
---
# <a name="back-up-your-app-in-azure"></a>Архивация приложения в Azure
Функция архивации и восстановления в [службе приложений Azure](app-service-web-overview.md) позволяет легко создавать резервные копии приложений вручную или по расписанию. Вы можете восстановить приложение до моментального снимка предыдущего состояния, перезаписав существующее приложение или восстановив другое. 

Сведения о восстановлении приложения из резервной копии см. в статье [Восстановление приложения в службе приложений Azure](web-sites-restore.md).

<a name="whatsbackedup"></a>

## <a name="what-gets-backed-up"></a>Что входит в резервную копию
Служба приложений может архивировать в учетную запись хранения Azure и контейнер, который вы настроили для использования вашим приложением, следующую информацию: 

* конфигурация приложения;
* содержимое файла;
* база данных, подключенная к приложению.

Функция архивации поддерживается для следующих решений базы данных: 
   - [База данных SQL](https://azure.microsoft.com/en-us/services/sql-database/)
   - [база данных Azure для MySQL (предварительная версия)](https://azure.microsoft.com/en-us/services/mysql);
   - [база данных Azure для PostgreSQL (предварительная версия)](https://azure.microsoft.com/en-us/services/postgres);
   - [MySQL в приложении](https://blogs.msdn.microsoft.com/appserviceteam/2017/03/06/announcing-general-availability-for-mysql-in-app).
 

> [!NOTE]
>  Каждая резервная копия является полной автономной копией приложения, а не добавочным обновлением.
>  

<a name="requirements"></a>

## <a name="requirements-and-restrictions"></a>Требования и ограничения
* Для использования резервного копирования и восстановления требуется, чтобы у плана службы приложений был уровень **Стандартный** или **Премиум**. Дополнительные сведения о масштабировании плана службы приложений для использования более высокого уровня см. в статье [Масштабирование веб-приложения в службе приложений Azure](web-sites-scale.md).  
  Уровень **Премиум** позволяет создавать большее количество ежедневных резервных копий по сравнению с уровнем **Стандартный**.
* Для архивации требуется учетная запись хранения Azure и контейнер в той же подписке, что и приложение, для которого вы хотите создавать резервные копии. Дополнительные сведения об учетных записях хранения Azure доступны в разделе [ссылок](#moreaboutstorage) в конце этой статьи.
* Резервная копия может вмещать до 10 ГБ содержимого приложения и базы данных. Если размер резервной копии превысит этот лимит, отобразится сообщение об ошибке.

<a name="manualbackup"></a>

## <a name="create-a-manual-backup"></a>Создание резервной копии вручную
1. На [портале Azure](https://portal.azure.com) перейдите на страницу своего приложения и выберите **Резервные копии**. Откроется страница **Резервные копии**.
   
    ![Страница резервных копий][ChooseBackupsPage]
   
   > [!NOTE]
   > Если вы видите приведенное ниже сообщение, щелкните его, чтобы обновить план службы приложений, прежде чем продолжить резервное копирование.
   > Дополнительные сведения см. в статье [Увеличение масштаба приложения в Azure](web-sites-scale.md).  
   > ![Выбор учетной записи хранения](./media/web-sites-backup/01UpgradePlan1.png)
   > 
   > 

2. На странице **Архивация** щелкните **Настройка**.
![Выбор параметра "Настройка"](./media/web-sites-backup/ClickConfigure1.png)
3. На странице **Конфигурация архивации** щелкните **Хранилище: не настроено**, чтобы настроить учетную запись хранения.
   
    ![Выбор учетной записи хранения][ChooseStorageAccount]
4. Выберите расположение резервной копии, щелкнув **Учетная запись хранения** > **Контейнер**. Эта учетная запись хранения должна принадлежать к той же подписке, что и приложение, резервную копию которого вы собираетесь создать. При необходимости на соответствующих страницах можно создать новую учетную запись хранения или новый контейнер. Закончив, щелкните **Выбрать**.
   
    ![Выбор учетной записи хранения](./media/web-sites-backup/02ChooseStorageAccount1-1.png)
5. На странице **Конфигурация архивации**, которая по-прежнему открыта, вы можете настроить **резервную копию базы данных**, а затем выбрать базы данных, которые необходимо включить в резервные копии (база данных SQL или MySQL), а затем нажмите кнопку **ОК**.  
   
    ![Выбор учетной записи хранения](./media/web-sites-backup/03ConfigureDatabase1.png)
   
   > [!NOTE]
   > Чтобы база данных появилась в этом списке, ее строка подключения должна присутствовать в разделе **Строки подключения** страницы **Параметры приложения** вашего приложения.
   > 
   > 
6. На странице **Конфигурация архивации** нажмите кнопку **Сохранить**.    
7. На странице **Резервные копии** щелкните **Архивация**.
   
    ![Кнопка создания резервной копии][BackUpNow]
   
    Во время процесса архивации отображается сообщение о ходе выполнения.

После того как вы настроили учетную запись хранения и контейнер, вы можете вручную запустить резервное копирование в любой момент.  

<a name="automatedbackups"></a>

## <a name="configure-automated-backups"></a>Настройка автоматического резервного копирования
1. На странице **Конфигурация архивации** для параметра **Архивация по расписанию** установите значение **Вкл**. 
   
    ![Выбор учетной записи хранения](./media/web-sites-backup/05ScheduleBackup1.png)
2. Появятся параметры расписания архивации. Выберите для параметра **Запланированная архивация** значение **Вкл**, а затем настройте необходимое расписание архивации и нажмите кнопку **ОК**.
   
    ![Включение автоматически создаваемых резервных копий][SetAutomatedBackupOn]

<a name="partialbackups"></a>

## <a name="configure-partial-backups"></a>Настройка частичной архивации
Иногда не нужно создавать резервную копию всего приложения. Вот несколько таких случаев.

* У вас [настроена еженедельная архивация](web-sites-backup.md#configure-automated-backups) приложения со статическим содержимым, которое никогда не меняется. Это могут быть старые записи блога или изображения.
* Размер содержимого приложения превышает 10 ГБ (т. е. максимальный размер резервной копии, которую можно создать за раз).
* Не нужно создавать резервную копию файлов журнала.

Частичное резервное копирование позволяет выбрать только те файлы, для которых нужно создать резервную копию.

### <a name="exclude-files-from-your-backup"></a>Исключение файлов из резервной копии
Допустим, есть приложение, содержащее файлы журнала и статические изображения, которые были однажды архивированы и не будут изменяться. В таких случаях вы можете исключить эти папки и файлы из будущих резервных копий. Чтобы исключить файлы и папки из резервных копий, создайте файл `_backup.filter` в папке `D:\home\site\wwwroot` своего приложения. В этом файле укажите список файлов и папок, которые вы хотите исключить. 

Самый простой способ получить доступ к файлам — использовать Kudu. Щелкните параметр **Дополнительные инструменты -> Вперед** для своего веб-приложения, чтобы получить доступ к Kudu.

![Использование Kudu с помощью портала][kudu-portal]

Определите папки, которые вы хотите исключить из резервных копий.  Например, вы хотите отфильтровать выделенные папки и файлы.

![Папка с изображениями][ImagesFolder]

Создайте файл `_backup.filter` и поместите в него приведенный выше список, при этом удалив `D:\home`. В одной строке указывайте один каталог или файл. В результате содержимое файла будет выглядеть так:
 ```bash
    \site\wwwroot\Images\brand.png
    \site\wwwroot\Images\2014
    \site\wwwroot\Images\2013
```

Отправьте файл `_backup.filter` в каталог `D:\home\site\wwwroot\` своего сайта с помощью протокола [FTP](app-service-deploy-ftp.md) или любым другим способом. При желании можно создать файл непосредственно с помощью `DebugConsole` Kudu и вставить в него содержимое.

Выполните архивацию привычным для вас способом — [вручную](#create-a-manual-backup) или [автоматически](#configure-automated-backups). Теперь любые файлы и папки, которые указаны в `_backup.filter`, будут исключены из будущих архиваций, инициированных по расписанию или вручную. 

> [!NOTE]
> Восстановление частичных резервных копий сайта происходит так же, как и [восстановление обычных резервных копий](web-sites-restore.md). Восстановление выполняется надлежащим образом.
> 
> При восстановлении полной резервной копии все содержимое сайта заменяется содержимым из резервной копии. Если файл, который находится на сайте, не включен в резервную копию, он удаляется. Однако при восстановлении частичной резервной копии все содержимое, которое находится в каталогах или файлах из черного списка, остается неизменным.
> 


<a name="aboutbackups"></a>

## <a name="how-backups-are-stored"></a>Как хранятся резервные копии
После создания одной или нескольких резервных копий приложения они отображаются на странице **Контейнеры** вашей учетной записи хранения, как и ваше приложение. В учетной записи хранения каждая резервная копия состоит из файла `.zip` с резервной копией данных и файла `.xml` с манифестом для содержимого файла `.zip`. Эти файлы можно распаковать и просмотреть, если необходимо получить доступ к резервным копиям без фактического восстановления приложения.

Резервная копия базы данных приложения хранится в корне ZIP-файла. Для базы данных SQL это файл BACPAC (без расширения), и его можно импортировать. Инструкции по созданию базы данных SQL на основе экспорта BACPAC-файла см. в статье [Импорт файла BACPAC для создания новой пользовательской базы данных](http://technet.microsoft.com/library/hh710052.aspx).

> [!WARNING]
> Изменение любого из этих файлов в контейнере **websitebackups** может привести к повреждению резервной копии и сделать восстановление из нее невозможным.
> 
> 

## <a name="automate-with-scripts"></a>Автоматизация с помощью сценариев

Управление резервным копированием можно автоматизировать с помощью сценариев, воспользовавшись [Azure CLI](/cli/azure/install-azure-cli) или [Azure PowerShell](/powershell/azure/overview).

Примеры см. в разделах:

- [Примеры Azure CLI](app-service-cli-samples.md)
- [Примеры сценариев Azure PowerShell](app-service-powershell-samples.md)

<a name="nextsteps"></a>

## <a name="next-steps"></a>Дальнейшие действия
Сведения о восстановлении приложения из резервной копии см. в статье [Восстановление приложения в службе приложений Azure](web-sites-restore.md). 


<!-- IMAGES -->
[ChooseBackupsPage]: ./media/web-sites-backup/01ChooseBackupsPage1.png
[ChooseStorageAccount]: ./media/web-sites-backup/02ChooseStorageAccount-1.png
[BackUpNow]: ./media/web-sites-backup/04BackUpNow1.png
[SetAutomatedBackupOn]: ./media/web-sites-backup/06SetAutomatedBackupOn1.png
[SaveIcon]: ./media/web-sites-backup/10SaveIcon.png
[ImagesFolder]: ./media/web-sites-backup/11Images.png
[LogsFolder]: ./media/web-sites-backup/12Logs.png
[GhostUpgradeWarning]: ./media/web-sites-backup/13GhostUpgradeWarning.png
[kudu-portal]:./media/web-sites-backup/kudu-portal.PNG

