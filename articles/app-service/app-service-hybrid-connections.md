---
title: "Гибридные подключения к службе приложений Azure | Документация Майкрософт"
description: "Создание и использование гибридных подключений для доступа к ресурсам в разнородных сетях."
services: app-service
documentationcenter: 
author: ccompy
manager: stefsch
editor: 
ms.assetid: 66774bde-13f5-45d0-9a70-4e9536a4f619
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/22/2017
ms.author: ccompy
ms.openlocfilehash: fef9e7b280387934cb093f51b4c8aa134a3b87e7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="azure-app-service-hybrid-connections"></a>Гибридные подключения к службе приложений Azure #

## <a name="overview"></a>Обзор ##

Гибридные подключения — это и служба в Azure, и функция в службе приложений Azure.  В качестве службы их применение и возможности шире, чем функциональные возможности, используемые в службе приложений Azure.  Чтобы узнать больше о гибридных подключениях и их использовании вне службы приложения Azure, можно начать с раздела [Протокол гибридных подключений ретранслятора Azure][HCService].

В службе приложений Azure гибридные подключения можно использовать для доступа к ресурсам приложений в других сетях. Они обеспечивают доступ из вашего приложения к конечной точке приложения.  Гибридные подключения не являются альтернативным средством доступа к вашему приложению.  При использовании в службе приложений каждое гибридное подключение сопоставляется с одной комбинацией узла TCP и TCP-порта.  Это означает, что конечная точка гибридного подключения может быть размещена в любой операционной системе, а любое ваше приложение использует TCP-порт прослушивания. Гибридным подключениям не важен используемый протокол приложения или ресурсы, к которым вы обращаетесь.  Они просто обеспечивают доступ к сети.  


## <a name="how-it-works"></a>Принцип работы ##
Функция гибридных подключений использует два исходящих вызова к ретранслятору служебной шины.  К узлу, на котором приложение выполняется в службе приложений, устанавливается подключение из библиотеки, после чего устанавливается подключение из Hybrid Connection Manager (HCM) к ретранслятору служебной шины.  HCM — это служба ретрансляции, которая развертывается в сетевом размещении. 

Посредством двух соединенных подключений приложение получает TCP-туннель к фиксированной комбинации "узел:порт" на другой стороне HCM.  Это подключение использует TLS 1.2 для обеспечения безопасности и ключи SAS для аутентификации и авторизации.    

![][1]

Когда приложение выполнит запрос DNS, который соответствует настроенной конечной точке гибридного подключения, исходящий трафик TCP будет перенаправлен дальше по этому гибридному подключению.  

> [!NOTE]
> Это означает, что для гибридного подключения следует всегда использовать DNS-имя.  Некоторые клиентские программы не выполняют поиск DNS, если конечная точка использует IP-адрес, а не DNS-имя.
>
>

Существуют два типа гибридных подключений: новые гибридные подключения, которые предоставляются как служба в ретрансляторе Azure, и устаревшие гибридные подключения BizTalk.  Устаревшие гибридные подключения BizTalk на портале называются классическими гибридными подключениями.  Дополнительная информация о них приведена далее в этом документе.

### <a name="app-service-hybrid-connection-benefits"></a>Преимущества гибридного подключения службы приложений ###

Гибридные подключения обладают рядом преимуществ, включая следующие:

- Приложения могут безопасно обращаться к локальным службам и системам.
- Для них не требуется конечная точка с доступом к Интернету.
- Их можно быстро и легко настроить.  
- Каждое гибридное подключение соответствует отдельной комбинации "узел:порт", что прекрасно с точки зрения безопасности.
- Как правило, бреши в брандмауэре не нужны, так как все подключения являются исходящими и осуществляются через стандартные веб-порты.
- Так как гибридные подключения работают на уровне сети, это также означает, что они не зависят ни от языка, используемого приложением, ни от технологии, используемой конечной точкой.
- Их можно использовать для доступа к нескольким сетям из одного приложения. 

### <a name="things-you-cannot-do-with-hybrid-connections"></a>Что невозможно сделать с помощью гибридных подключений ###

Существует несколько вещей, которые невозможно выполнить с помощью гибридных подключений, в том числе:

- подключение диска;
- использование протокола UDP;
- доступ к службам на основе протокола TCP, использующим динамические порты (таким как пассивным режим FTP или расширенный пассивный режим FTP);
- поддержка LDAP, так как иногда для нее требуется UDP;
- поддержка Active Directory.

## <a name="adding-and-creating-a-hybrid-connection-in-your-app"></a>Добавление и создание гибридного подключения в приложении ##

Гибридные подключения можно создавать на портале приложения или на портале службы гибридных подключений.  Настоятельно рекомендуется использовать портал приложения для создания гибридных подключений, которые вы хотите использовать в своем приложении.  Чтобы создать гибридное подключение, перейдите на [портал Azure][portal] и откройте пользовательский интерфейс своего приложения.  Выберите **Сети > Настройте конечные точки гибридного подключения**.  Здесь можно увидеть гибридные подключения, которые были настроены для приложения.  

![][2]

Чтобы добавить новое гибридное подключение, нажмите кнопку "Добавить гибридное подключение".  В открывшемся окне пользовательского интерфейса отобразится список гибридных подключений, которые вы уже создали.  Чтобы добавить одно или несколько из них в приложение, выберите соответствующие подключения, затем щелкните **Добавление выбранного гибридного подключения**.  

![][3]

Если вы хотите создать гибридное подключение, щелкните **Создать гибридное подключение**.  Теперь следует указать: 

- имя конечной точки;
- имя узла конечной точки;
- порт конечной точки;
- пространство имен служебной шины, которое вы хотите использовать.

![][4]

Каждое гибридное подключение привязано к пространству имен служебной шины, а каждое пространство имен служебной шины находится в регионе Azure.  Важно стараться использовать пространство имен служебной шины в том же регионе, в котором размещено ваше приложение, чтобы избежать сетевых задержек.

Если вы хотите удалить из приложения гибридное подключение, щелкните его правой кнопкой мыши и выберите **Отключить**.  

После добавления гибридного подключения в веб-приложение вы сможете просмотреть сведения о нем, просто щелкнув это подключение.  

![][5]

## <a name="hybrid-connections-and-app-service-plans"></a>Гибридные подключения и планы службы приложений ##

В настоящее время можно устанавливать только новые гибридные подключения.  Они доступны только для SKU "Базовый", "Стандартный", "Премиум" и Isolated.  С каждым тарифным планом связаны определенные ограничения.  

| Тарифный план | Количество гибридных подключений в плане |
|----|----|
| базовая; | 5 |
| Стандартная | 25 |
| Premium | 200 |
| Isolated | 200 |

Так как существуют ограничения плана службы приложений, в нем доступен пользовательский интерфейс, который показывает, сколько гибридных подключений используется и какими приложениями.  

![][6]

Как и в представлении приложения, просмотреть сведения о гибридном подключении можно, щелкнув его.  Среди отображенных свойств можно увидеть все сведения, показанные в представлении приложения, но также можно узнать, сколько других приложений в этом же плане службы приложений использует это гибридное подключение.

![][7]

Так как существует ограничение на количество конечных точек гибридных подключений, которые можно использовать в плане службы приложений, каждое гибридное подключение может использоваться любым количеством приложений в этом плане службе приложений.  Иными словами, если имеется 1 гибридное подключение, используемое в 5 отдельных приложениях в плане службы приложений, это все равно 1 гибридное подключение.

За гибридные подключения сверх лимита, определенного для уровней "Базовый", "Стандартный", "Премиум" и Isolated, взимается дополнительная плата.  Дополнительные сведения о ценах на гибридные подключения см. здесь: [Служебная шина — цены][sbpricing].

## <a name="hybrid-connection-manager"></a>Hybrid Connection Manager ##

Для работы гибридных подключений в сети, в которой размещена конечная точка гибридного подключения, необходим агент ретрансляции.  Он называется Hybrid Connection Manager (HCM).  Этот инструмент можно скачать, выбрав **Сети > Настройте конечные точки гибридного подключения** в пользовательском интерфейсе, доступном в приложении на [портале Azure][portal].  

Данный инструмент работает в Windows Server 2008 R2 и более поздних версиях Windows.  После установки HCM запускается как служба.  Эта служба подключается к ретранслятору служебной шины Azure в соответствии с настроенными конечными точками.  HCM устанавливает исходящие подключения через порты 80 и 443.    

В HCM доступен пользовательский интерфейс для его настройки.  После установки HCM можно вызвать его пользовательский интерфейс, запустив файл HybridConnectionManagerUi.exe, находящийся в каталоге установки Hybrid Connection Manager.  Кроме того, его легко вызвать в Windows 10, введя в поле поиска *Hybrid Connection Manager UI*.  

При запуске пользовательского интерфейса HCM первым, что вы увидите, будет таблица со списком всех гибридных подключений, настроенных с помощью этого экземпляра HCM.  Если вы хотите внести какие-либо изменения, потребуется пройти аутентификацию в Azure. 

Вот как можно добавить одно или несколько гибридных подключений в HCM.

1. Запустите пользовательский интерфейс HCM.
1. Щелкните "Configure another hybrid connection" (Настроить новое гибридное подключение). ![][8]

1. Войдите в систему, используя учетную запись Azure.
1. Выберите подписку.
1. Щелкните гибридные подключения, которые этот HCM должен транслировать. ![][9]

1. Щелкните Сохранить

На этом этапе вы увидите добавленные гибридные подключения.  Можно щелкнуть настроенное гибридное подключение и просмотреть сведения о нем.

![][10]

Чтобы HCM мог обслуживать настроенные для него гибридные подключения, ему требуется:

- доступ к Azure по протоколу TCP через порты 80 и 443;
- доступ к конечной точке гибридного подключения по протоколу TCP;
- возможность поиска DNS на узле конечной точки и в пространстве имен служебной шины Azure.

HCM поддерживает новые гибридные подключения и устаревшие гибридные подключения BizTalk.

### <a name="redundancy"></a>Избыточность ###

Каждый экземпляр HCM может поддерживать несколько гибридных подключений.  Кроме того, любое заданное гибридное подключение может поддерживаться несколькими HCM.  Режим по умолчанию — распределение трафика методом циклического перебора между настроенными экземплярами HCM для любой заданной конечной точки.  Если требуется обеспечить высокий уровень доступности гибридных подключений из сети, просто создайте несколько экземпляров HCM на разных компьютерах. 

### <a name="manually-adding-a-hybrid-connection"></a>Добавление гибридного подключения вручную ###

Если необходимо, чтобы кто-то вне вашей подписки разместил экземпляр HCM для заданного гибридного подключения, для этого можно предоставить строку подключения к шлюзу для этого гибридного подключения.  Ее можно найти в свойствах гибридного подключения на [портале Azure][portal]. Чтобы использовать эту строку, нажмите кнопку **Configure manually** (Настроить вручную) в HCM и вставьте строку подключения к шлюзу.


## <a name="troubleshooting"></a>Устранение неполадок ##

Когда для гибридного подключения настроено запущенное приложение и имеется по крайней мере один HCM, в котором настроено это гибридное подключение, то на портале отображается состояние **Подключено**.  Если состояние **Подключено** не отображается, значит, приложение не работает или экземпляру HCM не удается подключиться к Azure через порт 80 или 443.  

Основная причина, по которой клиенты не могут подключиться к своей конечной точке, состоит в том, что для нее был указан IP-адрес, а не DNS-имя.  Если приложение не может связаться с требуемой конечной точкой и был указан IP-адрес, перейдите на использование DNS-имени, являющегося действительным на узле, на котором выполняется HCM.  Дополнительно стоит проверить правильность разрешения DNS-имени на узле, на котором выполняется HCM, и возможность исходящего подключения от этого узла к конечной точке гибридного подключения.  

В службе приложений доступен инструмент, который можно вызвать из консоли, который называется tcpping.  Этот инструмент может сообщить, имеется ли доступ к конечной точке TCP, но не сообщает, имеется ли доступ к конечной точке гибридного подключения.  В случае использования консоли для конечной точки гибридного подключения успешная проверка связи означает только наличие гибридного подключения, настроенного для вашего приложения, которое использует заданную комбинацию "узел:порт".  

## <a name="biztalk-hybrid-connections"></a>Гибридные подключения BizTalk ##

Устаревшая функция гибридных подключений BizTalk была заблокирована для дальнейшего создания гибридных подключений.  Можно продолжить использование существующих гибридных подключений BizTalk в приложениях, но следует перейти на новую службу.  По сравнению с версией BizTalk новая служба обладает следующими преимуществами:

- не требуется дополнительная учетная запись BizTalk;
- используется протокол TLS 1.2 вместо TLS 1.0, как в гибридных подключениях BizTalk;
- обмен данными с Azure осуществляется через порты 80 и 443 с помощью DNS-имени, а не посредством IP-адресов и ряда дополнительных портов.  

Чтобы добавить гибридное подключение BizTalk в приложение, перейдите в приложение на [портале Azure][portal] и щелкните **Сети > Настройте конечные точки гибридного подключения**.  В таблице классических гибридных подключений щелкните **Добавить классическое гибридное подключение**.  Вы увидите список гибридных подключений BizTalk.  


<!--Image references-->
[1]: ./media/app-service-hybrid-connections/hybridconn-connectiondiagram.png
[2]: ./media/app-service-hybrid-connections/hybridconn-portal.png
[3]: ./media/app-service-hybrid-connections/hybridconn-addhc.png
[4]: ./media/app-service-hybrid-connections/hybridconn-createhc.png
[5]: ./media/app-service-hybrid-connections/hybridconn-properties.png
[6]: ./media/app-service-hybrid-connections/hybridconn-aspproperties.png
[7]: ./media/app-service-hybrid-connections/hybridconn-hcm.png
[8]: ./media/app-service-hybrid-connections/hybridconn-hcmadd.png
[9]: ./media/app-service-hybrid-connections/hybridconn-hcmadded.png
[10]: ./media/app-service-hybrid-connections/hybridconn-hcmdetails.png

<!--Links-->
[HCService]: http://docs.microsoft.com/azure/service-bus-relay/relay-hybrid-connections-protocol/
[portal]: http://portal.azure.com/
[oldhc]: http://docs.microsoft.com/azure/biztalk-services/integration-hybrid-connection-overview/
[sbpricing]: http://azure.microsoft.com/pricing/details/service-bus/

