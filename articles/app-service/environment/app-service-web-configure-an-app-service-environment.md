---
title: "Как настроить среду службы приложений версии 1"
description: "Настройка и мониторинг среды службы приложений версии 1, а также управление ею."
services: app-service
documentationcenter: 
author: ccompy
manager: stefsch
editor: 
ms.assetid: b5a1da49-4cab-460d-b5d2-edd086ec32f4
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: ccompy
ms.openlocfilehash: 34fb3f15c03a3d3ef5f0a27081539bf0a6d19c5f
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="configuring-an-app-service-environment-v1"></a>Настройка среды службы приложений версии 1

> [!NOTE]
> Эта статья посвящена среде службы приложений версии 1.  Имеется более новая версия среды службы приложений, которая проще в использовании и которая работает на более мощной инфраструктуре. Чтобы узнать больше о новой версии, начните с изучения статьи [Введение в среду службы приложения](intro.md).
> 

## <a name="overview"></a>Обзор
На высоком уровне среда службы приложений Azure состоит из нескольких основных компонентов:

* вычислительные ресурсы, работающие в службе, размещенной в среде службы приложений Azure;
* Хранилище
* база данных;
* классическая виртуальная сеть Azure (версия 1) или виртуальная сеть Azure Resource Manager (версия 2); 
* подсеть, в которой работает служба, размещенная в среде службы приложений.

### <a name="compute-resources"></a>Вычислительные ресурсы
Вычислительные ресурсы используются для четырех пулов ресурсов.  Каждая среда ASE включает набор внешних интерфейсов и три возможных рабочих пула. Использовать все три рабочих пула необязательно. При необходимости можно использовать только один или два.

Узлы в пулах внешних интерфейсов и рабочих ролей недоступны клиентам напрямую. К ним невозможно подключиться, используя протокол удаленного рабочего стола (RDP), а также невозможно изменить их подготовку или администрировать их.

Можно задать количество пулов ресурсов и их размер. В среде ASE доступны четыре варианта размеров с метками от P1 до P4. Дополнительные сведения об этих размерах и их ценах см. в разделе [этой статьи](https://azure.microsoft.com/pricing/details/app-service/).
Изменение количества или размера называется операцией масштабирования.  Одновременно может выполняться только одна такая операция.

**Внешние интерфейсы.** Внешние интерфейсы являются конечными точками HTTP/HTTPS для приложений в среде ASE. Не запускайте рабочие нагрузки во внешних интерфейсах.

* ASE начинается с двух P2 — этого достаточно для разработки и тестирования рабочих и низкоуровневых рабочих нагрузок. P3 рекомендуется использовать для средних и больших рабочих нагрузок.
* При средних и больших рабочих нагрузках рекомендуется иметь по крайней мере четыре пула ресурсов P3. Такое количество обеспечит достаточное число внешних интерфейсов при проведении планового обслуживания. Во время планового обслуживания внешние интерфейсы будут отключаться по одному. Так что общее число доступных интерфейсов во время обслуживания будет меньше.
* Подготовка внешних интерфейсов может занять до часа. 
* Для более тонкой настройки масштабирования нужно отслеживать процент использования ЦП и памяти, а также метрики активных запросов по интерфейсному пулу. Если при запуске P3 ЦП или память используются больше, чем на 70 %, число внешних интерфейсов необходимо увеличить. Если на каждый внешний интерфейс в среднем приходится по 15–20 тысяч активных запросов, значит, внешних интерфейсов должно быть больше. При работе P3 ЦП и память всегда должны использоваться меньше чем на 70 %, а на каждый внешний интерфейс должно приходиться меньше 15 тысяч активных запросов.  

**Рабочие роли.** Фактически приложения выполняются в рабочих ролях. При вертикальном масштабировании планов службы приложений используются рабочие процессы в соответствующем рабочем пуле.

* Мгновенно исполнителей добавить нельзя. Их подготовка может занять до часа.
* Размер вычислительного ресурса для любого пула масштабируется менее 1 часа на каждый домен обновления. В среде ASE присутствует 20 доменов обновления. Масштабирование размера вычислительных ресурсов для рабочего пула с 10 экземплярами занимает до 10 часов.
* Изменение объема вычислительных ресурсов, используемых в рабочем пуле, может привести к холодному запуску приложений, запущенных в этом пуле.

Чтобы изменить объем вычислительных ресурсов для рабочего пула, в котором не выполняются никакие приложения, максимально быстро, необходимо выполнить следующие действия:

* Уменьшите количество рабочих ролей до 2.  Минимальный масштаб на портале — 2. Отмена распределения экземпляров займет несколько минут. 
* Выбрать новый объем вычислений и число экземпляров. Масштабирование займет около 2 часов.

Описанный выше способ не подходит, если объем вычислительных ресурсов для приложений нужно увеличить. Вместо того чтобы менять размер рабочего пула, в котором находятся приложения, можно заполнить другой рабочий пул рабочими ролями желаемого размера и переместить приложения в новый пул.

* Создать дополнительные экземпляры с необходимым объемом вычислений в другом рабочем пуле. Это займет около часа.
* Переназначить планы службы приложений, в которых размещаются приложения, требующие увеличения объема вычислений, во вновь созданный рабочий пул. Эта операция выполняется быстро и занимает меньше минуты.  
* Уменьшить размер первого рабочего пула, если неиспользуемые экземпляры вам больше не требуются. Эта операция занимает несколько минут.

**Автомасштабирование.** Одним из средств, помогающих управлять использованием вычислительных ресурсов, является автоматическое масштабирование. Его можно применять к рабочему пулу и к интерфейсному пулу. Оно позволяет увеличивать число экземпляров в любом типе пула утром и уменьшать его вечером. Кроме того, таким образом можно добавлять экземпляры, если число рабочих ролей, доступных в рабочем пуле, становится меньше установленного порога.

При настройке правил автомасштабирования необходимо учитывать требуемое время на подготовку. Дополнительные сведения об автомасштабировании в средах службы приложений см. в статье [Автоматическое масштабирование и среда службы приложений][ASEAutoscale].

### <a name="storage"></a>Хранилище
Каждая среда ASE предоставляется с хранилищем емкостью 500 ГБ. Это пространство используют все размещенные в среде ASE приложения. Хранилище является частью среды ASE, и в настоящее время вы не можете использовать вместо него пространство хранилища. Изменяя маршрутизацию или защиту виртуальной сети, необходимо поддерживать доступ к службе хранилища Azure, иначе ASE работать не будет.

### <a name="database"></a>База данных
Информация о среде и выполняющихся в ней приложениях хранится в базе данных. Эта база данных также предоставляется в рамках подписки Azure. Однако пользователи не могут выполнять с ней какие-либо действия напрямую. Изменяя маршрутизацию или защиту виртуальной сети, необходимо поддерживать доступ к SQL Azure, иначе ASE работать не будет.

### <a name="network"></a>Сеть
С ASE можно использовать имеющуюся виртуальную сеть или ту, которая была создана одновременно со средой. Если одновременно с ASE создается и подсеть, ASE попадает в ту же группу ресурсов, что и виртуальная сеть. Если вам нужно, чтобы группа ресурсов, используемая ASE, отличалась от виртуальной сети, создайте ASE с помощью шаблона Resource Manager.

В отношении виртуальной сети для ASE действуют некоторые ограничения:

* Виртуальная сеть должна быть региональной виртуальной сетью.
* В месте развертывания ASE должна существовать подсеть с 8 или более адресами.
* Если подсеть используется для размещения ASE, диапазон адресов подсети изменять нельзя. Для дальнейшего расширения ASE рекомендуется включать в подсеть не меньше 64 адресов.
* В подсети может находиться только среда ASE.

В отличие от размещенной службы, которая содержит среду службы приложений, [виртуальной сетью][virtualnetwork] и подсетью управляет пользователь.  Администрирование виртуальной сети выполняется через пользовательский интерфейс виртуальной сети или PowerShell.  ASE можно развернуть в классической виртуальной сети или в виртуальной сети Resource Manager.  Работа с порталом и API немного отличается в классической версии виртуальной сети и в Resource Manager. Работа со средой ASE в обоих версиях сети ничем не отличается.

Виртуальная сеть, в которой размещается ASE, может использовать частные IP-адреса RFC 1918 или общедоступные IP-адреса.  Если нужно использовать диапазон IP-адресов, который не входит в RFC 1918 (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16), сначала необходимо создать виртуальную сеть и подсеть, которые будут использоваться для среды ASE, а затем создать ASE.

Так как благодаря этой возможности служба приложений Azure помещается в виртуальную сеть, это значит, что приложения, размещенные в ASE, теперь могут получать доступ к ресурсам, которые обычно доступны через ExpressRoute или напрямую через VPN типа "сеть — сеть". Чтобы использовать ресурсы, доступные в сети, в которой размещена среда службы приложений, приложениям этой среды не нужны дополнительные сетевые компоненты. Это означает, что для размещения ресурсов в виртуальной сети или их подключения к этой сети вам не нужно выполнять интеграцию с виртуальной сетью или использовать гибридные подключения. Тем не менее эти функции можно использовать для доступа к ресурсам в сетях, которые не подключены к используемой виртуальной сети.

Например, можно выполнить интеграцию с виртуальной сетью, которая доступна в рамках подписки, но не подключена к виртуальной сети, в которой размещена среда ASE. Гибридные подключения можно использовать для получения доступа к ресурсам в других сетях в стандартном режиме.  

Если для виртуальной сети настроено использование VPN типа ExpressRoute, следует учитывать некоторые требования к маршрутизации в среде ASE. Некоторые конфигурации определяемых пользователем маршрутов не поддерживаются в среде ASE. Дополнительные сведения о настройке виртуальной сети с ExpressRoute для среды службы приложений см. в [этой статье][ExpressRoute].

#### <a name="securing-inbound-traffic"></a>Защита входящего трафика
Существует два основных метода управления входящим трафиком ASE.  Можно использовать группы безопасности сети (NSG) для управления доступом IP-адресов к среде ASE, как описано в статье [Как управлять входящим трафиком в среде службы приложений](app-service-app-service-environment-control-inbound-traffic.md). Кроме того, можно настроить среду ASE с внутренним балансировщиком нагрузки.  Эти возможности можно также использовать вместе, если нужно ограничить доступ к среде ASE с внутренним балансировщиком нагрузки с помощью групп безопасности сети.

При создании ASE в виртуальной сети создается виртуальный IP-адрес.  Существует два типа виртуальных IP-адресов: внешние и внутренние.  При создании ASE с внешним виртуальным IP-адресом приложения в ASE будут доступны в Интернете по маршрутизируемому IP-адресу. При выборе внутреннего IP-адреса для среды ASE будет настроен внутренний балансировщик нагрузки и к ней невозможно будет получить доступ напрямую через Интернет.  Среде ASE с внутренним балансировщиком нагрузки по-прежнему требуется внешний виртуальный IP-адрес, но он используется только для доступа к управлению и обслуживанию Azure.  

Во время создания среды ASE с внутренним балансировщиком нагрузки для нее нужно указать поддомен. При этом также понадобится управлять DNS для указанного поддомена.  Так как указывается имя поддомена, необходимо также управлять сертификатом, используемым для доступа по протоколу HTTPS.  После создания ASE будет предложено указать сертификат.  Дополнительные сведения о создании и использовании сред службы приложений с внутренней подсистемой балансировки нагрузки см. в статье [Использование внутренней подсистемы балансировки нагрузки в среде службы приложений][ILBASE]. 

## <a name="portal"></a>Microsoft Azure
Для мониторинга среды ASE и управления ею можно использовать пользовательский интерфейс на портале Azure. Если у вас есть среда ASE, возможно, вы захотите, чтобы на боковой панели отображался значок службы приложений. Этот значок используется для обозначения сред ASE на портале Azure.

![Символ среды службы приложений Azure][1]

Чтобы открыть пользовательский интерфейс, в котором указаны все среды службы приложений, можно использовать значок. Кроме того, можно выбрать значок шеврона (">") в нижней части боковой панели, чтобы выбрать среду службы приложений. Если выбрать одну из указанных сред ASE, откроется пользовательский интерфейс для мониторинга и управления.

![Пользовательский интерфейс для мониторинга среды службы приложений и управления ею][2]

В первой колонке отображаются некоторые свойства среды ASE, а также диаграмма с метриками для пула ресурсов. Некоторые свойства представлены в разделе **Основные компоненты** в виде гиперссылок. Если щелкнуть какую-либо из них, откроется связанная колонка. Например, можно щелкнуть имя **виртуальной сети**, чтобы открыть пользовательский интерфейс виртуальной сети, в которой выполняется среда ASE. Если щелкнуть **Планы службы приложений** и **Приложения**, откроются колонки со списком соответствующих элементов, размещенных в среде ASE.  

### <a name="monitoring"></a>Мониторинг
На диаграммах отображены разные метрики производительности для каждого пула ресурсов. Что касается интерфейсного пула, можно отслеживать средние показатели использования ЦП и памяти. Кроме того, можно отслеживать используемое и доступное количество пулов рабочих ролей.

Рабочие роли, входящие в рабочий пул, могут использоваться несколькими планами службы приложений. Рабочая нагрузка распространяется не так, как внешние серверы, поэтому данные по использованию ЦП и памяти не дают столько же ценной информации. Важнее отслеживать количество используемых и доступных рабочих ролей, особенно если вы управляете этой системой для других пользователей.  

Все метрики, которые можно отслеживать на диаграммах, можно также использовать для настройки оповещений. Настройка оповещений является стандартной процедурой в рамках службы приложений. Настроить оповещение можно с помощью пользовательского интерфейса **оповещений**. Кроме того, вы можете выбрать команду **Добавить оповещение** в пользовательском интерфейсе нужной метрики.

![Пользовательский интерфейс метрик][3]

Упомянутые выше метрики — это метрики среды ASE. Но метрики также доступны на уровне плана службы приложений. Именно на этом уровне целесообразно отслеживать показатели использования ЦП и памяти.

В среде ASE все планы службы приложений являются выделенными. Это значит, что в план службы приложений включены только те приложения, которые запущены на выделенных этому плану узлах. Чтобы просмотреть подробную информацию о плане службы приложений, щелкните нужный план в любом списке в пользовательском интерфейсе среды ASE или выберите его в полном списке планов в разделе **Browse App Service plans** (Обзор планов службы приложений).   

### <a name="settings"></a>данных
В колонке ASE есть раздел **Параметры** , содержащий несколько важных функций.

**Параметры** > **Свойства**. Колонка **Параметры** автоматически открывается при переходе в колонку ASE. В верхней части колонки находится раздел **Свойства**. Наряду с элементами, которые повторяют данные из раздела **Основные компоненты**, здесь также отображены и другие полезные сведения, включая **виртуальный IP-адрес** и **исходящий IP-адрес**.

![Колонка "Параметры" и "Свойства"][4]

**Параметры** > **IP-адреса**. При создании приложения SSL на основе IP в ASE должен присутствовать адрес SSL на основе IP. Чтобы получить его, в среде ASE должны быть адреса SSL на основе IP, которые можно выделить. Для этой цели в ASE добавляется 1 адрес SSL на основе IP, но позже можно добавить дополнительные адреса. Дополнительные адреса SSL на основе IP предоставляются на платной основе, как указано на странице [цен на службу приложений][AppServicePricing] в разделе "SSL-подключения". Дополнительные цена — цена за SSL на основе IP.

**Параметры** > **Интерфейсный пул** / **Рабочие пулы**. В каждой из колонок пулов ресурсов можно просмотреть информацию об определенном пуле ресурсов и воспользоваться элементами управления, позволяющими полностью масштабировать этот пул ресурсов.  

В основной колонке каждого пула ресурсов приведена диаграмма с метриками для этого пула. Как и с диаграммами в колонке ASE, вы можете перейти к параметрам диаграммы и настроить оповещения. Настройка оповещений для определенного пула ресурсов в колонке ASE аналогична настройке оповещений непосредственно в параметрах пула ресурсов. В колонке **Параметры** рабочего пула можно выбрать отображение списка всех приложений или планов ASP, запущенных в этом рабочем пуле.

![Пользовательский интерфейс параметров рабочего пула][5]

### <a name="portal-scale-capabilities"></a>Возможности масштабирования портала
Существует три типа операций масштабирования:

* изменение количества IP-адресов, доступных в ASE для использования SSL на основе IP;
* изменение объема вычислительных ресурсов, используемых в пуле ресурсов;
* изменение объема вычислительных ресурсов, используемых в пуле ресурсов, вручную либо с помощью автоматического масштабирования.

На портале доступны три способа управления количеством серверов в пулах ресурсов:

* Операция масштабирования в главной колонке ASE, которая расположена вверху. Вы можете изменять конфигурации масштабирования интерфейсных пулов и рабочих пулов. Все они применяются в рамках одной операции.
* Операция ручного масштабирования в колонке **Масштаб** отдельного пула ресурсов, которая расположена в разделе **Параметры**.
* Автомасштабирование, которое настраивается в колонке **Масштаб** отдельного пула ресурсов.

Чтобы выполнить масштабирование в колонке ASE, перетащите ползунок до требуемого количества и сохраните изменения. Здесь можно также изменить объем.  

![Пользовательский интерфейс "Масштаб"][6]

Чтобы воспользоваться функциями ручного или автоматического масштабирования определенного пула ресурсов, выберите **Параметры** > **Интерфейсный пул** / **Рабочие пулы** (в зависимости от ситуации). Затем откройте пул, который требуется изменить. Выберите пункты **Параметры** > **Развернуть** или **Параметры** > **Увеличение масштаба**. Колонка **Горизонтальное масштабирование** позволяет контролировать число экземпляров. **Увеличение масштаба** позволяет контролировать размер ресурса.  

![Пользовательский интерфейс "Настройки масштабирования"][7]

## <a name="fault-tolerance-considerations"></a>Рекомендации относительно отказоустойчивости
Среду службы приложений можно настроить для использования до 55 вычислительных ресурсов. Из этих 55 вычислительных ресурсов только 50 можно использовать для размещения рабочих нагрузок. Это объясняется двумя причинами. Существует как минимум 2 вычислительных ресурса для интерфейсов.  Остается максимум 53 ресурса для поддержки распределения рабочего пула. При этом для обеспечения отказоустойчивости требуются дополнительные вычислительные ресурсы, распределенные в соответствии со следующими правилами:

* Для каждого рабочего пула требуется по крайней мере один дополнительный вычислительный ресурс, которому нельзя назначать рабочую нагрузку.
* Если количество вычислительных ресурсов в рабочем пуле превышает определенное значение, для обеспечения отказоустойчивости требуется другой вычислительный ресурс. С интерфейсным пулом дела обстоят иначе.

Согласно требованиям к отказоустойчивости любого рабочего пула данное значение X ресурсов назначается рабочему пулу при таких условиях:

* если переменная X — это число от 2 до 20, количество доступных вычислительных ресурсов, которые можно использовать для рабочих нагрузок, равно X-1;
* если переменная X — это число от 21 до 40, количество доступных вычислительных ресурсов, которые можно использовать для рабочих нагрузок, равно X-2;
* если переменная X — это число от 41 до 53, количество доступных вычислительных ресурсов, которые можно использовать для рабочих нагрузок, равно X-3.

Минимальная конфигурация включает 2 внешних сервера и 2 рабочих роли.  Вот несколько примеров, объясняющих описанное выше.  

* Если в одном пуле есть 30 рабочих ролей, для размещения рабочих нагрузок можно использовать 28.
* Если в одном пуле есть 2 рабочих роли, для размещения рабочих нагрузок можно использовать одну.
* Если в одном пуле есть 20 рабочих ролей, для размещения рабочих нагрузок можно использовать 19.  
* Если в одном пуле есть 21 рабочая роль, для размещения рабочих нагрузок можно использовать только 19.  

Обеспечение отказоустойчивости — это важный аспект, однако при выполнении масштабирования сверх определенных пороговых значений следует помнить о приведенных выше условиях. Если требуется увеличить емкость, имея 20 экземпляров, нужно использовать 22 экземпляра и более, так как вы не добьетесь увеличения емкости, используя 21 экземпляр. Аналогично, чтобы увеличить емкость, имея 40 экземпляров, нужно 42 экземпляра.  

## <a name="deleting-an-app-service-environment"></a>Удаление среды службы приложений
Если нужно удалить среду службы приложений, просто воспользуйтесь действием **Удалить** в верхней части колонки среды. После этого появится запрос на ввод имени среды ASE, чтобы вы могли подтвердить удаление. Обратите внимание, что при удалении среды ASE также удаляется все ее содержимое.  

![Пользовательский интерфейс удаления среды службы приложений][9]  

## <a name="getting-started"></a>Приступая к работе
Чтобы начать работу со средами службы приложений, см. статью [Создание среды службы приложений](app-service-web-how-to-create-an-app-service-environment.md).

[!INCLUDE [app-service-web-try-app-service](../../../includes/app-service-web-try-app-service.md)]

<!--Image references-->
[1]: ./media/app-service-web-configure-an-app-service-environment/ase-icon.png
[2]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-aseblade.png
[3]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-poolchart.png
[4]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-properties.png
[5]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-poolblade.png
[6]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-scalecommand.png
[7]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-poolscale.png
[8]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-pricingtiers.png
[9]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-deletease.png

<!--Links-->
[WhatisASE]: app-service-app-service-environment-intro.md
[Appserviceplans]: ../azure-web-sites-web-hosting-plans-in-depth-overview.md
[HowtoCreateASE]: app-service-web-how-to-create-an-app-service-environment.md
[HowtoScale]: app-service-web-scale-a-web-app-in-an-app-service-environment.md
[ControlInbound]: app-service-app-service-environment-control-inbound-traffic.md
[virtualnetwork]: https://azure.microsoft.com/documentation/articles/virtual-networks-faq/
[AppServicePricing]: http://azure.microsoft.com/pricing/details/app-service/
[ASEAutoscale]: app-service-environment-auto-scale.md
[ExpressRoute]: app-service-app-service-environment-network-configuration-expressroute.md
[ILBASE]: app-service-environment-with-internal-load-balancer.md
