---
title: "Общие сведения об архитектуре сетевых сред службы приложений"
description: "Общие сведения об архитектуре топологии сети сред службы приложений."
services: app-service
documentationcenter: 
author: stefsch
manager: erikre
editor: 
ms.assetid: 13d03a37-1fe2-4e3e-9d57-46dfb330ba52
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/04/2016
ms.author: stefsch
ms.openlocfilehash: 3362a55524da42914681db06b8d2c0da8df773d8
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="network-architecture-overview-of-app-service-environments"></a>Общие сведения об архитектуре сетевых сред службы приложений
## <a name="introduction"></a>Введение
Среда службы приложений всегда создается в подсети [виртуальной сети][virtualnetwork]. Приложения, работающие в среде службы приложений, могут взаимодействовать с частными конечными точками, расположенными в пределах той же топологии виртуальной сети.  Поскольку клиенты могут заблокировать части инфраструктуры виртуальной сети, важно понять типы потоков сетевой связи, которые возникают в среде службы приложений.

## <a name="general-network-flow"></a>Общий поток сетевого трафика
Когда среда службы приложений (ASE) использует общедоступный виртуальный IP-адрес для приложений, на него поступает весь входящий трафик.  Он включает в себя трафик HTTP и HTTPS приложений, а также прочий трафик FTP, удаленной отладки и операций управления Azure.  Полный список всех портов (обязательных и необязательных) для общедоступного виртуального IP-адреса см. в статье [Как управлять входящим трафиком в среде службы приложений][controllinginboundtraffic]. 

Кроме того, среда службы приложений поддерживают работающие приложения, которые привязаны только к внутреннему адресу виртуальной сети, также называемому адресом внутреннего балансировщика нагрузки (ILB).  В ASE с внутренним балансировщиком нагрузки весь трафик HTTP и HTTPS приложений и вызовы удаленной отладки поступают на адрес ILB.  В наиболее распространенных конфигурациях ASE с внутренним балансировщиком нагрузки трафик FTP или FTPS также будет поступать на адрес ILB.  Тем не менее операции управления Azure по-прежнему будут поступать через порты 454 и 455 на общедоступный виртуальный IP-адрес ASE с внутренним балансировщиком нагрузки.

На схеме ниже показаны общие сведения о различных входящих и исходящих сетевых трафиках для среды службы приложений, в которой приложения привязаны к общедоступному виртуальному IP-адресу.

![Общие потоки сетевого трафика][GeneralNetworkFlows]

Среда службы приложений может взаимодействовать с разными конечными точками частных клиентов.  Например приложения, выполняющиеся в среде службы приложений, можно подключить к серверам баз данных, работающих на виртуальных машинах IaaS в виртуальной сети той же топологии.

> [!IMPORTANT]
> Согласно схеме сети, "Другие ресурсы компьютера" развертываются в другой подсети по сравнению со средой службы приложений. Развертывание ресурсов в одной подсети со средой службы приложений заблокирует подключения среды службы приложений к этим ресурсам (за исключением определенной маршрутизации внутри среды службы приложений). Вместо этого выполните развертывание в другую подсеть (в той же виртуальной сети). После этого среда службы приложений сможет выполнить подключение. Никаких дополнительных настроек не требуется.
> 
> 

Среды служб приложений также взаимодействуют с базами данных SQL и ресурсами хранилищ Azure, необходимыми для работы сред и управления ими.  Некоторые ресурсы SQL и хранилищ, с которыми взаимодействует среда службы приложений, находятся в одном регионе со средой службы приложений, тогда как другие расположены в удаленных регионах Azure.  Следовательно, для правильной работы среды службы приложений необходимо исходящее подключение к Интернету. 

Поскольку среда службы приложений развертывается в подсети, группы безопасности сети можно использовать для управления входящим трафиком подсети.  Дополнительные сведения об управлении входящим трафиком в среде службы приложений см. в следующей [статье][controllinginboundtraffic].

Дополнительную информацию о разрешении исходящего подключения к Интернету в среде службы приложений см. в статье о работе с [Express Route][ExpressRoute].  Метод, описанный в статье, применяется также при работе с подключением «сеть — сеть» и при использовании принудительного туннелирования.

## <a name="outbound-network-addresses"></a>Исходящие сетевые адреса
Когда среда службы приложений отправляет исходящие вызовы, с ними всегда ассоциирован IP-адрес.  Используемый IP-адрес определяется расположением вызываемой конечной точки — в виртуальной сети или за ее пределами.

Если вызываемая конечная точка расположена **за пределами** виртуальной сети, используемый исходящий адрес (или исходящий адрес NAT), является общедоступным виртуальным IP-адресом среды службы приложений.  Этот адрес можно найти в пользовательском интерфейсе портала для среды службы приложений в колонке «Свойства».

![Исходящий IP-адрес][OutboundIPAddress]

Данный адрес можно также определить для сред службы приложений, имеющих только общедоступный виртуальный IP-адрес, создав приложение в среде службы приложений, а затем выполнив команду *nslookup* для адреса этого приложения. Полученный IP-адрес является общедоступным виртуальным IP-адресом и исходящим адресом NAT среды службы приложений.

Если вызываемая конечная точка расположена **внутри** виртуальной сети, исходящим адресом вызывающего приложения будет внутренний IP-адрес отдельного вычислительного ресурса, на котором запущено приложение.  Однако постоянное сопоставление внутренних IP-адресов виртуальной сети с приложениями не происходит.  Приложения можно перемещать между различными вычислительными ресурсами, но из-за операций масштабирования размер пула доступных вычислительных ресурсов в среде службы приложений может меняться.

Но поскольку среда службы приложений всегда расположена в подсети, внутренний IP-адрес вычислительного ресурса, на котором работает приложение, будет всегда находиться в диапазоне подсети CIDR.  Поэтому при использовании детальных списков управления доступом или групп безопасности сети для защиты доступа к другим конечным точкам в виртуальной сети необходимо предоставить доступ к подсети, содержащей среду службы приложений.

На следующей схеме эти понятия показаны более подробно.

![Исходящие сетевые адреса][OutboundNetworkAddresses]

Расшифровка схемы выше.

* Так как общедоступный виртуальный IP-адрес среды службы приложений — 192.23.1.2, он является исходящим IP-адресом, используемым при отправке вызовов к конечным точкам в «Интернете».
* Диапазон CIDR подсети, содержащей среду службы приложений — 10.0.1.0/26.  Другие конечные точки в пределах инфраструктуры той же виртуальной сети будут «видеть» вызовы из приложений как исходящие из какого-то адреса в этом диапазоне.

## <a name="calls-between-app-service-environments"></a>Вызовы между средами службы приложений
Более сложный сценарий может наблюдаться в случае, если несколько сред службы приложений развернуты в одной и той же виртуальной сети, при этом из одной среды службы приложений в другую выполняются исходящие вызовы.  Такие типы вызовов между разными средами службы приложений также рассматриваются как «интернет-вызовы».

На схеме ниже показан пример многоуровневой архитектуры с приложениями в одной среде службы приложений (например,  веб-приложения «входной двери»), которые вызывают приложения во второй среде службы приложений (например, внутренние приложения API серверной части, которые не должны быть доступны из Интернета). 

![Вызовы между средами службы приложений][CallsBetweenAppServiceEnvironments] 

В приведенном выше примере среда службы приложений «ASE 1» имеет исходящий IP-адрес 192.23.1.2.  Если приложение, запущенное в этой среде службы приложений, выполняет исходящий вызов приложения, запущенного во второй среде службы приложений («ASE 2»), которая расположена в той же виртуальной сети, то исходящий вызов будет считаться «обращением к Интернету».  В результате сетевой трафик, поступающий во вторую среду службы приложений, будет выглядеть так, как будто он поступает с IP-адреса 192.23.1.2 (т. е. с адреса, не входящего в диапазон адресов подсети первой среды службы приложений).

Даже несмотря на то, что вызовы между различными средами службы приложений считаются вызовами «через Интернет», если обе среды службы приложений находятся в одном регионе Azure, сетевой трафик будет оставаться в региональной сети Azure и физически не будет проходить через общедоступный Интернет.  В итоге вы можете использовать сетевую группу безопасности в подсети второй среды службы приложений, чтобы разрешить только входящие вызовы с адреса первой среды службы приложений (исходящий IP-адрес которой 192.23.1.2). Тем самым вы обеспечите защищенный обмен данными между средами службы приложений.

## <a name="additional-links-and-information"></a>Дополнительные ссылки и сведения
Подробные сведения о входящих портах, используемых средами службы приложений, и о регулировании входящего трафика с помощью групп безопасности сети см. [здесь][controllinginboundtraffic].

Подробные сведения о том, как использовать определенные пользователями маршруты для предоставления средам службы приложений исходящего доступа к Интернету, см. в этой [статье][ExpressRoute]. 

<!-- LINKS -->
[virtualnetwork]: http://azure.microsoft.com/services/virtual-network/
[controllinginboundtraffic]:  app-service-app-service-environment-control-inbound-traffic.md
[ExpressRoute]:  app-service-app-service-environment-network-configuration-expressroute.md

<!-- IMAGES -->
[GeneralNetworkFlows]: ./media/app-service-app-service-environment-network-architecture-overview/NetworkOverview-1.png
[OutboundIPAddress]: ./media/app-service-app-service-environment-network-architecture-overview/OutboundIPAddress-1.png
[OutboundNetworkAddresses]: ./media/app-service-app-service-environment-network-architecture-overview/OutboundNetworkAddresses-1.png
[CallsBetweenAppServiceEnvironments]: ./media/app-service-app-service-environment-network-architecture-overview/CallsBetweenEnvironments-1.png

