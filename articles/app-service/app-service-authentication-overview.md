---
title: "Проверка подлинности и авторизация в службе приложений Azure | Документация Майкрософт"
description: "Принципы использования и обзор функции проверки подлинности и авторизации в службе приложений Azure"
services: app-service
documentationcenter: 
author: mattchenderson
manager: erikre
editor: 
ms.assetid: b7151b57-09e5-4c77-a10c-375a262f17e5
ms.service: app-service
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/29/2016
ms.author: mahender
ms.openlocfilehash: f0d2644903181cd2e20166feae4f90ddd4037fa8
ms.sourcegitcommit: b979d446ccbe0224109f71b3948d6235eb04a967
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2017
---
# <a name="authentication-and-authorization-in-azure-app-service"></a>Проверка подлинности и авторизация в службе приложений Azure
## <a name="what-is-app-service-authentication--authorization"></a>Что такое проверка подлинности и авторизация службы приложений?
Проверка подлинности и авторизация службы приложений — это функция, которая позволяет приложению выполнять вход пользователей, не требуя изменения кода в серверной части приложения. Она является простым способом обеспечения защиты приложения и работы с данными пользователей.

Служба приложений использует федеративную идентификацию, при которой сторонний поставщик удостоверений сохраняет учетные записи и проводит аутентификацию пользователей. Приложение использует информацию об удостоверении поставщика вместо того, чтобы хранить ее самостоятельно. Служба приложений поддерживает пять поставщиков удостоверений по умолчанию: Azure Active Directory, Facebook, Google, учетная запись Майкрософт и Twitter. Приложение может использовать любое количество поставщиков удостоверений, позволяя пользователям выбрать способ входа. Чтобы расширить встроенную поддержку, можно добавить другой поставщик удостоверений или [собственное настраиваемое решение для идентификации][custom-auth].

Если вы планируете начать работу прямо сейчас, ознакомьтесь с одной из указанных ниже статей, например с руководством по [проверке подлинности и в приложении iOS][iOS] ([Android], [Windows], [Xamarin.iOS], [Xamarin.Android], [Xamarin.Forms] или [Cordova]).

## <a name="how-authentication-works-in-app-service"></a>Как устроена проверка подлинности в службе приложений
Чтобы выполнять проверку подлинности с помощью одного из поставщиков удостоверений, сначала необходимо настроить поставщик удостоверений так, чтобы ему было известно о вашем приложении. Затем поставщик удостоверений предоставит идентификаторы и секреты, которые необходимо передать службе приложений. На этом отношение доверия завершается, и после этого служба приложений может проверять утверждения пользователей от поставщика удостоверений, например маркеры проверки подлинности.

Для входа с использованием одного из этих поставщиков пользователь должен быть перенаправлен на конечную точку входа для этого поставщика. Если клиенты используют веб-браузер, можно сделать так, чтобы служба приложений автоматически перенаправляла на конечную точку входа всех пользователей, не прошедших проверку подлинности. В противном случае необходимо перенаправить клиентов в `{your App Service base URL}/.auth/login/<provider>`, где параметру `<provider>` задано одно из таких значений: aad, facebook, google, microsoft или twitter. Сценарии для мобильных устройств и API рассматриваются в следующих разделах этой статьи.

У пользователей, которые взаимодействуют с приложением через веб-браузер, файл cookie будет настроен таким образом, чтобы при просмотре приложения они оставались аутентифицированными. Для других типов клиентов, например мобильных устройств, клиенту будет выдан веб-маркер JSON (JWT), который должен присутствовать в заголовке `X-ZUMO-AUTH` . В пакетах SDK для клиента мобильных приложений это будет сделано автоматически. Кроме того, в заголовок `Authorization` можно напрямую включить маркер идентификации Azure Active Directory или маркер доступа в качестве [токена носителя](https://tools.ietf.org/html/rfc6750).

Служба приложений будет проверять все файлы cookie и маркеры, выпущенные вашим приложением, для проверки подлинности пользователей. Сведения о том, как ограничить доступ к приложению, см. в разделе [Принцип действия авторизации в службе приложений](#authorization) ниже.

### <a name="mobile-authentication-with-a-provider-sdk"></a>Мобильная проверка подлинности с пакетом SDK поставщика
Выполнив все настройки на серверной стороне, можно изменить мобильные клиенты для входа в службу приложений. Существует два подхода:

* использование пакета SDK, опубликованного указанным поставщиком удостоверений, для определения удостоверения и последующего получения доступа к службе приложений;
* использование одной строки кода для входа пользователей с помощью пакета SDK клиента для мобильных приложений.

> [!TIP]
> Большинству приложений следует использовать пакет SDK поставщика, чтобы обеспечить согласованное взаимодействие с пользователями во время входа, получать поддержку обновлений и другие преимущества, указанные поставщиком.
> 
> 

При использовании пакета SDK поставщика пользователи могут входить в интерфейс, который теснее интегрируется с операционной системой, в которой запущено приложение. При этом вы также получаете маркер поставщика и некоторые сведения о пользователях на стороне клиента, что упрощает использование Graph API и настройку пользовательского интерфейса. Иногда в блогах и на форумах это может называться "клиентским потоком" или "управляемым клиентом потоком", так как управление входом на клиенте выполняет код, и код клиента имеет доступ к маркеру поставщика.

Полученный маркер поставщика необходимо отправить в службу приложений для проверки. После того как служба приложений проверит маркер, она создает новый маркер службы приложений, который возвращается клиенту. Пакет SDK для клиента мобильных приложений содержит вспомогательные методы, которые управляют этим обменом и автоматически присоединяют маркеры ко всем запросам к серверной части приложения. Если необходимо, разработчики также могут сохранить ссылку на маркер поставщика.

### <a name="mobile-authentication-without-a-provider-sdk"></a>Мобильная проверка подлинности без пакета SDK поставщика
Вместо настройки пакета SDK можно настроить выполнение входа с помощью функции мобильных приложений службы приложений Azure. Клиентский пакет SDK мобильных приложений будет открывать выбранному вами поставщику веб-представление и осуществлять процедуру входа. Иногда в блогах и на форумах это называется "серверным потоком" или "управляемым сервером потоком", так как процедурой входа управляет сервер, а пакет SDK клиента никогда не получает маркер поставщика.

Код, необходимый для запуска этого потока, рассматривается в руководстве по проверке подлинности для каждой платформы. В конце потока у клиентского пакета SDK есть маркер службы приложений, и маркер автоматически присоединяется ко всем запросам, отправляемым к серверной части приложения.

### <a name="service-to-service-authentication"></a>Взаимодействие между службами
Помимо предоставления пользователям прямого доступа к своему приложению, можно также доверить другому приложению вызывать API вашего приложения. Например, одно веб-приложение может вызывать API в другом веб-приложении. В этом случае для получения маркера используются учетные данные службы, а не учетные данные пользователя. Учетная запись службы в терминологии Azure Active Directory также называется *субъектом-службой* , а проверка подлинности с использованием такой учетной записи называется сценарием взаимодействия между службами.

> [!IMPORTANT]
> Так как мобильные приложения работают на клиентских устройствах, эти приложения *не* считаются доверенными и не должны использовать поток субъекта-службы. Вместо этого они должны использовать пользовательский поток, описанный выше.
> 
> 

В сценариях взаимодействия между службами служба приложений может защитить приложение с помощью Azure Active Directory. Вызывающее приложение просто предоставляет маркер авторизации субъекта-службы Azure Active Directory, полученный после предоставления идентификатора клиента и секрета клиента от Azure Active Directory. Пример такого сценария для приложений API ASP.NET приводится в руководстве [Проверка подлинности с использованием субъекта-службы для приложений API в службе приложений Azure][apia-service].

Если в сценарии взаимодействия между службами нужно выполнить проверку подлинности службы приложений, используйте сертификаты клиентов или обычную проверку подлинности. Сведения о клиентских сертификатах в Azure см. в статье [Настройка взаимной проверки подлинности TLS для веб-приложения](app-service-web-configure-tls-mutual-auth.md). Сведения об обычной проверке подлинности в ASP.NET см. в статье [Authentication Filters in ASP.NET Web API 2](http://www.asp.net/web-api/overview/security/authentication-filters) (Фильтры проверки подлинности в веб-API ASP.NET 2).

Проверка подлинности учетной записи службы из приложения логики службы приложений в приложение API — это особый вариант проверки подлинности, который описан в статье [Использование настраиваемого интерфейса API, размещенного в службе приложений, с приложениями логики](../logic-apps/logic-apps-custom-hosted-api.md).

## <a name="authorization"></a>Принцип действия авторизации в службе приложений
Вы полностью контролируете, какие запросы могут быть отправлены приложению. Проверку подлинности и авторизацию службы приложений можно настроить для любого из следующих вариантов:

* Приложению могут отправляться только запросы, прошедшие проверку подлинности.
  
    Если из браузера поступает анонимный запрос, служба приложений перенаправляет его на страницу входа выбранного поставщика удостоверений. Если запрос приходит с мобильного устройства, будет возвращен ответ HTTP *401 — Не санкционировано*.
  
    В этом случае в клиентском приложении не нужен никакой код для проверки подлинности. Если требуется более контролируемая авторизация, можно воспользоваться сведениями о пользователе в коде.
* Приложению могут отправляться все запросы, но запросы проверки подлинности нужно проверять и передавать сведения о проверке подлинности в заголовках HTTP.
  
    В этом случае решение об авторизации должно приниматься в коде приложения. Такая схема обеспечивает большую гибкость в обработке анонимных запросов, но требует написания кода.
* Приложению могут отправляться все запросы. Сведения о проверке подлинности в запросах не используются.
  
    В этом случае функция аутентификации и авторизации отключена. Все задачи проверки подлинности и авторизации полностью ложатся на код приложения.

Выбрать выполняемое действие можно с помощью параметра **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** на портале Azure. Если выбрать параметр **Войти как *имя_поставщика***, все запросы будут проходить проверку подлинности. Если выбрать параметр **Разрешить запрос (нет действия)**, решение об авторизации выполняется в коде, но сведения о проверке подлинности по-прежнему предоставляются. Если вы хотите выполнять всю обработку в коде, функцию проверки подлинности и авторизации компонента можно отключить.

## <a name="working-with-user-identities-in-your-application"></a>Работа с удостоверениями пользователей в приложении
Служба приложений передает некоторые сведения о пользователе в приложение с помощью специальных заголовков. Эти заголовки не могут использоваться во внешних запросах. Они могут присутствовать, только если были установлены службой приложений при проверке подлинности или авторизации. Некоторые примеры заголовков включают:

* X-MS-CLIENT-PRINCIPAL-NAME
* X-MS-CLIENT-PRINCIPAL-ID
* X-MS-TOKEN-FACEBOOK-ACCESS-TOKEN
* X-MS-TOKEN-FACEBOOK-EXPIRES-ON

Сведения из этих заголовков можно получить с помощью кода, написанного на любом языке или в любой платформе. Для приложений ASP.NET 4.6 автоматически настраивается класс **ClaimsPrincipal** с соответствующими значениями.

Приложение может получить дополнительные сведения о пользователях, отправив запрос HTTP GET на конечную точку приложения `/.auth/me` . Если в запрос был включен допустимый маркер, будут возвращены полезные данные JSON со сведениями об используемом поставщике, маркером базового поставщика и другими данными пользователя. Пакеты SDK для серверной части мобильных приложений предоставляют вспомогательные методы для работы с этими данными  Дополнительные сведения см. Дополнительные сведения см. в разделах [Практическое руководство. Использование утверждений аутентификации для таблиц](../app-service-mobile/app-service-mobile-node-backend-how-to-use-server-sdk.md#howto-tables-getidentity) и [Практическое руководство. Получение сведений о пользователе, прошедшем проверку подлинности](../app-service-mobile/app-service-mobile-dotnet-backend-how-to-use-server-sdk.md#user-info).

## <a name="documentation-and-additional-resources"></a>Документация и дополнительные ресурсы
### <a name="identity-providers"></a>Поставщики удостоверений
В следующих руководствах содержатся сведения о том, как настроить службу приложений для использования различных поставщиков проверки подлинности.

* [Настройка приложения службы приложений для использования службы входа Azure Active Directory][AAD]
* [Как настроить приложение службы приложений для использования имени для входа Facebook][Facebook]
* [Как настроить приложение службы приложений для использования имени для входа Google][Google]
* [Настройка приложения службы приложений для использования входа по учетной записи Майкрософт][MSA]
* [Как настроить приложение службы приложений для использования имени для входа Twitter][Twitter]

Если вам нужна система удостоверений, отличная от указанных здесь, можете использовать [предварительную версию поддержки настраиваемой проверки подлинности в серверном пакете SDK .NET для мобильных приложений][custom-auth]. Ее можно использовать с веб-приложениями, мобильными приложениями или приложениями API.

### <a name="mobile-applications"></a>Мобильные приложения
В следующих руководствах показано, как добавить проверку подлинности в мобильные клиенты с использованием управляемого сервером потока.

* [Добавление проверки подлинности в приложение iOS][iOS]
* [Добавление проверки подлинности в приложение Android][Android]
* [Добавление проверки подлинности в приложение Windows][Windows]
* [Добавление проверки подлинности в приложение Xamarin.Android][Xamarin.iOS]
* [Добавление проверки подлинности в приложение Xamarin.Android][Xamarin.Android]
* [Добавление проверки подлинности в приложение Xamarin.iOS][Xamarin.Forms]
* [Добавление проверки подлинности в приложение Cordova][Cordova]

Если вы хотите использовать управляемый клиентом поток для Azure Active Directory, см. следующие ресурсы:

* [Использование клиентской библиотеки iOS для мобильных приложений Azure][ADAL-iOS]
* [Использование клиентской библиотеки Android для мобильных приложений][ADAL-Android]
* [Использование управляемого клиента для мобильных приложений Azure][ADAL-dotnet]

Если вы хотите использовать управляемый клиентом поток для Facebook, см. следующий раздел.

* [Практическое руководство: проверка подлинности пользователей с помощью пакета SDK Facebook для iOS](../app-service-mobile/app-service-mobile-ios-how-to-use-client-library.md#facebook-sdk)

Если вы хотите использовать управляемый клиентом поток для Twitter, см. следующий раздел.

* [Практическое руководство: проверка подлинности пользователей с помощью структуры Twitter для iOS](../app-service-mobile/app-service-mobile-ios-how-to-use-client-library.md#twitter-fabric)

Если вы хотите использовать управляемый клиентом поток для Google, см. следующий раздел.

* [How to: Authenticate users with the Google Sign-In SDK for iOS](../app-service-mobile/app-service-mobile-ios-how-to-use-client-library.md#google-sdk)

<!-- ### API applications
The following tutorials show how to protect your API apps:

* [User authentication for API Apps in Azure App Service][apia-user]
* [Service principal authentication for API Apps in Azure App Service][apia-service] -->

[iOS]: ../app-service-mobile/app-service-mobile-ios-get-started-users.md
[Android]: ../app-service-mobile/app-service-mobile-android-get-started-users.md
[Xamarin.iOS]: ../app-service-mobile/app-service-mobile-xamarin-ios-get-started-users.md
[Xamarin.Android]: ../app-service-mobile/app-service-mobile-xamarin-android-get-started-users.md
[Xamarin.Forms]: ../app-service-mobile/app-service-mobile-xamarin-forms-get-started-users.md
[Windows]: ../app-service-mobile/app-service-mobile-windows-store-dotnet-get-started-users.md
[Cordova]: ../app-service-mobile/app-service-mobile-cordova-get-started-users.md

[AAD]: app-service-mobile-how-to-configure-active-directory-authentication.md
[Facebook]: app-service-mobile-how-to-configure-facebook-authentication.md
[Google]: app-service-mobile-how-to-configure-google-authentication.md
[MSA]: app-service-mobile-how-to-configure-microsoft-authentication.md
[Twitter]: app-service-mobile-how-to-configure-twitter-authentication.md

[custom-auth]: ../app-service-mobile/app-service-mobile-dotnet-backend-how-to-use-server-sdk.md#custom-auth

[ADAL-Android]: ../app-service-mobile/app-service-mobile-android-how-to-use-client-library.md#adal
[ADAL-iOS]: ../app-service-mobile/app-service-mobile-ios-how-to-use-client-library.md#adal
[ADAL-dotnet]: ../app-service-mobile/app-service-mobile-dotnet-how-to-use-client-library.md#adal
