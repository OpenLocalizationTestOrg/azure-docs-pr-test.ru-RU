---
title: "Создание среды службы приложений Azure, используя шаблон Resource Manager"
description: "Описание способов создания внешнего или внутреннего балансировщика нагрузки среды службы приложений Azure с помощью шаблона Resource Manager"
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 6eb7d43d-e820-4a47-818c-80ff7d3b6f8e
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/13/2017
ms.author: ccompy
ms.openlocfilehash: e6b21086488352c1da914b4656ad1d216fd6de85
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="create-an-ase-by-using-an-azure-resource-manager-template"></a><span data-ttu-id="40a73-103">Создание среды ASE с помощью шаблона Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="40a73-103">Create an ASE by using an Azure Resource Manager template</span></span>

## <a name="overview"></a><span data-ttu-id="40a73-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="40a73-104">Overview</span></span>
<span data-ttu-id="40a73-105">Среды службы приложений Azure (ASE) создаются с помощью конечной точки с доступом к Интернету или конечной точки с внутренним адресом в виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="40a73-105">Azure App Service environments (ASEs) can be created with an internet-accessible endpoint or an endpoint on an internal address in an Azure virtual network (VNet).</span></span> <span data-ttu-id="40a73-106">Если при создании внутренней конечной точки эта конечная точка предоставляется компонентом Azure, она называется внутренним балансировщиком нагрузки.</span><span class="sxs-lookup"><span data-stu-id="40a73-106">When created with an internal endpoint, that endpoint is provided by an Azure component called an internal load balancer (ILB).</span></span> <span data-ttu-id="40a73-107">ASE с внутренним IP-адресом называется ASE с внутренним балансировщиком нагрузки.</span><span class="sxs-lookup"><span data-stu-id="40a73-107">The ASE on an internal IP address is called an ILB ASE.</span></span> <span data-ttu-id="40a73-108">ASE с общедоступной конечной точкой называется внешним ASE.</span><span class="sxs-lookup"><span data-stu-id="40a73-108">The ASE with a public endpoint is called an External ASE.</span></span> 

<span data-ttu-id="40a73-109">ASE можно создать на портале Azure или с помощью шаблона Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="40a73-109">An ASE can be created by using the Azure portal or an Azure Resource Manager template.</span></span> <span data-ttu-id="40a73-110">В этой статье описаны действия и синтаксис, необходимые для создания внешнего ASE или ASE с внутренним балансировщиком нагрузки с помощью шаблонов Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="40a73-110">This article walks through the steps and syntax you need to create an External ASE or ILB ASE with Resource Manager templates.</span></span> <span data-ttu-id="40a73-111">Дополнительные сведения о создании ASE на портале Azure см. в статьях [Создание внешней среды службы приложений][MakeExternalASE] или [Создание и использование внутренней подсистемы балансировки нагрузки со средой службы приложений][MakeILBASE].</span><span class="sxs-lookup"><span data-stu-id="40a73-111">To learn how to create an ASE in the Azure portal, see [Make an External ASE][MakeExternalASE] or [Make an ILB ASE][MakeILBASE].</span></span>

<span data-ttu-id="40a73-112">При создании ASE на портале Azure можно одновременно создать виртуальную сеть либо выбрать для развертывания уже имеющуюся виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="40a73-112">When you create an ASE in the Azure portal, you can create your VNet at the same time or choose a preexisting VNet to deploy into.</span></span> <span data-ttu-id="40a73-113">При создании ASE из шаблона необходимо:</span><span class="sxs-lookup"><span data-stu-id="40a73-113">When you create an ASE from a template, you must start with:</span></span> 

* <span data-ttu-id="40a73-114">Создать виртуальную сеть Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="40a73-114">A Resource Manager VNet.</span></span>
* <span data-ttu-id="40a73-115">Создать подсеть в этой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="40a73-115">A subnet in that VNet.</span></span> <span data-ttu-id="40a73-116">Рекомендуемый размер подсети ASE — `/25` со 128 адресами для расширения в будущем.</span><span class="sxs-lookup"><span data-stu-id="40a73-116">We recommend an ASE subnet size of `/25` with 128 addresses to accomodate future growth.</span></span> <span data-ttu-id="40a73-117">Ее размер невозможно изменить после создания ASE.</span><span class="sxs-lookup"><span data-stu-id="40a73-117">After the ASE is created, you can't change the size.</span></span>
* <span data-ttu-id="40a73-118">Идентификатор ресурса виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="40a73-118">The resource ID from your VNet.</span></span> <span data-ttu-id="40a73-119">Эти сведения можно получить на портале Azure в списке свойств виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="40a73-119">You can get this information from the Azure portal under your virtual network properties.</span></span>
* <span data-ttu-id="40a73-120">Подписка, которая будет использоваться.</span><span class="sxs-lookup"><span data-stu-id="40a73-120">The subscription you want to deploy into.</span></span>
* <span data-ttu-id="40a73-121">Расположение для развертывания.</span><span class="sxs-lookup"><span data-stu-id="40a73-121">The location you want to deploy into.</span></span>

<span data-ttu-id="40a73-122">Для автоматизации создания ASE сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="40a73-122">To automate your ASE creation:</span></span>

1. <span data-ttu-id="40a73-123">Создайте ASE с помощью шаблона.</span><span class="sxs-lookup"><span data-stu-id="40a73-123">Create the ASE from a template.</span></span> <span data-ttu-id="40a73-124">При создании внешнего ASE это последний шаг.</span><span class="sxs-lookup"><span data-stu-id="40a73-124">If you create an External ASE, you're finished after this step.</span></span> <span data-ttu-id="40a73-125">Если создается ASE с внутренним балансировщиком нагрузки, необходимо выполнить несколько дополнительных действий.</span><span class="sxs-lookup"><span data-stu-id="40a73-125">If you create an ILB ASE, there are a few more things to do.</span></span>

2. <span data-ttu-id="40a73-126">После создания ASE с внутренним балансировщиком нагрузки отправляется SSL-сертификат, соответствующий домену ASE с внутренним балансировщиком нагрузки.</span><span class="sxs-lookup"><span data-stu-id="40a73-126">After your ILB ASE is created, an SSL certificate that matches your ILB ASE domain is uploaded.</span></span>

3. <span data-ttu-id="40a73-127">Переданный SSL-сертификат назначается ASE с внутренним балансировщиком нагрузки в качестве SSL-сертификата по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="40a73-127">The uploaded SSL certificate is assigned to the ILB ASE as its "default" SSL certificate.</span></span>  <span data-ttu-id="40a73-128">Этот сертификат используется для передачи трафика SSL в приложения в среде службы приложений с внутренним балансировщиком нагрузки, если они используют общий корневой домен, назначенный этой среде (например, https://someapp.mycustomrootcomain.com).</span><span class="sxs-lookup"><span data-stu-id="40a73-128">This certificate is used for SSL traffic to apps on the ILB ASE when they use the common root domain that's assigned to the ASE (for example, https://someapp.mycustomrootcomain.com).</span></span>


## <a name="create-the-ase"></a><span data-ttu-id="40a73-129">Создание ASE</span><span class="sxs-lookup"><span data-stu-id="40a73-129">Create the ASE</span></span>
<span data-ttu-id="40a73-130">Шаблон Resource Manager, с помощью которого создается ASE, и соответствующий файл параметров доступны [в примере][quickstartasev2create], размещенном на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="40a73-130">A Resource Manager template that creates an ASE and its associated parameters file is available [in an example][quickstartasev2create] on GitHub.</span></span>

<span data-ttu-id="40a73-131">Если вы хотите создать ASE с внутренним балансировщиком нагрузки, используйте эти [примеры][quickstartilbasecreate] шаблона Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="40a73-131">If you want to make an ILB ASE, use these Resource Manager template [examples][quickstartilbasecreate].</span></span> <span data-ttu-id="40a73-132">Они ориентированы на данный вариант использования.</span><span class="sxs-lookup"><span data-stu-id="40a73-132">They cater to that use case.</span></span> <span data-ttu-id="40a73-133">Большинство параметров в файле *azuredeploy.parameters.json* используются при создании как ASE с внутренним балансировщиком нагрузки, так и с внешними ASE.</span><span class="sxs-lookup"><span data-stu-id="40a73-133">Most of the parameters in the *azuredeploy.parameters.json* file are common to the creation of ILB ASEs and External ASEs.</span></span> <span data-ttu-id="40a73-134">Ниже приведены параметры с особыми примечаниями и уникальные параметры, используемые при создании ASE с внутренним балансировщиком нагрузки.</span><span class="sxs-lookup"><span data-stu-id="40a73-134">The following list calls out parameters of special note, or that are unique, when you create an ILB ASE:</span></span>

* <span data-ttu-id="40a73-135">*interalLoadBalancingMode*. В большинстве случаев для этого параметра нужно задать значение 3. В таком случае трафик HTTP и HTTPS на портах 80 и 443 и порты канала данных и канала управления, прослушиваемые FTP-службой в среде службы приложений, будут привязаны к внутреннему адресу в виртуальной сети, выделенному внутренним балансировщиком нагрузки.</span><span class="sxs-lookup"><span data-stu-id="40a73-135">*interalLoadBalancingMode*: In most cases, set this to 3, which means both HTTP/HTTPS traffic on ports 80/443, and the control/data channel ports listened to by the FTP service on the ASE, will be bound to an ILB-allocated virtual network internal address.</span></span> <span data-ttu-id="40a73-136">Если задать для этого свойства значение 2, к адресу внутреннего балансировщика нагрузки будут привязаны только порты, связанные со службой FTP (канала данных и канала управления),</span><span class="sxs-lookup"><span data-stu-id="40a73-136">If this property is set to 2, only the FTP service-related ports (both control and data channels) are bound to an ILB address.</span></span> <span data-ttu-id="40a73-137">а HTTP- и HTTP-трафик останется привязанным к общедоступному виртуальному IP-адресу.</span><span class="sxs-lookup"><span data-stu-id="40a73-137">The HTTP/HTTPS traffic remains on the public VIP.</span></span>
* <span data-ttu-id="40a73-138">*dnsSuffix*. Этот параметр определяет корневой домен по умолчанию, который назначен среде службы приложений.</span><span class="sxs-lookup"><span data-stu-id="40a73-138">*dnsSuffix*: This parameter defines the default root domain that's assigned to the ASE.</span></span> <span data-ttu-id="40a73-139">В общедоступной версии службы приложений Azure корневой домен по умолчанию для всех веб-приложений — *azurewebsites.net*.</span><span class="sxs-lookup"><span data-stu-id="40a73-139">In the public variation of Azure App Service, the default root domain for all web apps is *azurewebsites.net*.</span></span> <span data-ttu-id="40a73-140">Так как ASE с внутренним балансировщиком нагрузки является внутренней для виртуальной сети пользователя, бессмысленно использовать корневой домен по умолчанию общедоступной службы.</span><span class="sxs-lookup"><span data-stu-id="40a73-140">Because an ILB ASE is internal to a customer's virtual network, it doesn't make sense to use the public service's default root domain.</span></span> <span data-ttu-id="40a73-141">Вместо этого ASE с внутренним балансировщиком нагрузки необходимо назначить корневой домен по умолчанию, который целесообразно использовать в пределах внутренней виртуальной сети компании.</span><span class="sxs-lookup"><span data-stu-id="40a73-141">Instead, an ILB ASE should have a default root domain that makes sense for use within a company's internal virtual network.</span></span> <span data-ttu-id="40a73-142">Например, компания Contoso может использовать корневой домен по умолчанию *internal-contoso.com* для приложений, которые должны быть разрешаемыми и доступными только в виртуальной сети компании Contoso.</span><span class="sxs-lookup"><span data-stu-id="40a73-142">For example, Contoso Corporation might use a default root domain of *internal-contoso.com* for apps that are intended to be resolvable and accessible only within Contoso's virtual network.</span></span> 
* <span data-ttu-id="40a73-143">*ipSslAddressCount*. Для этого параметра в файле *azuredeploy.json* автоматически задается значение 0, так как средам службы приложений с внутренним балансировщиком нагрузки назначен только адрес этого балансировщика.</span><span class="sxs-lookup"><span data-stu-id="40a73-143">*ipSslAddressCount*: This parameter automatically defaults to a value of 0 in the *azuredeploy.json* file because ILB ASEs only have a single ILB address.</span></span> <span data-ttu-id="40a73-144">Для ASE с внутренним балансировщиком нагрузки нет явно заданных адресов SSL на основе IP,</span><span class="sxs-lookup"><span data-stu-id="40a73-144">There are no explicit IP-SSL addresses for an ILB ASE.</span></span> <span data-ttu-id="40a73-145">поэтому для пула этих адресов необходимо задать значение 0.</span><span class="sxs-lookup"><span data-stu-id="40a73-145">Hence, the IP-SSL address pool for an ILB ASE must be set to zero.</span></span> <span data-ttu-id="40a73-146">В противном случае произойдет ошибка подготовки.</span><span class="sxs-lookup"><span data-stu-id="40a73-146">Otherwise, a provisioning error occurs.</span></span> 

<span data-ttu-id="40a73-147">Когда файл *azuredeploy.parameters.json* будет заполнен, можно приступить к созданию ASE с помощью приведенного ниже фрагмента кода PowerShell.</span><span class="sxs-lookup"><span data-stu-id="40a73-147">After the *azuredeploy.parameters.json* file is filled in, create the ASE by using the PowerShell code snippet.</span></span> <span data-ttu-id="40a73-148">Измените пути к файлам в соответствии с расположением файлов шаблонов Resource Manager на вашем компьютере.</span><span class="sxs-lookup"><span data-stu-id="40a73-148">Change the file paths to match the Resource Manager template-file locations on your machine.</span></span> <span data-ttu-id="40a73-149">Введите собственные значения для имени развертывания Resource Manager и группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="40a73-149">Remember to supply your own values for the Resource Manager deployment name and the resource group name:</span></span>

    $templatePath="PATH\azuredeploy.json"
    $parameterPath="PATH\azuredeploy.parameters.json"

    New-AzureRmResourceGroupDeployment -Name "CHANGEME" -ResourceGroupName "YOUR-RG-NAME-HERE" -TemplateFile $templatePath -TemplateParameterFile $parameterPath

<span data-ttu-id="40a73-150">Для создания ASE потребуется около часа.</span><span class="sxs-lookup"><span data-stu-id="40a73-150">It takes about an hour for the ASE to be created.</span></span> <span data-ttu-id="40a73-151">Созданная ASE появится на портале в списке сред службы приложений для подписки, использованной для развертывания.</span><span class="sxs-lookup"><span data-stu-id="40a73-151">Then the ASE shows up in the portal in the list of ASEs for the subscription that triggered the deployment.</span></span>

## <a name="upload-and-configure-the-default-ssl-certificate"></a><span data-ttu-id="40a73-152">Загрузка и настройка SSL-сертификата по умолчанию</span><span class="sxs-lookup"><span data-stu-id="40a73-152">Upload and configure the "default" SSL certificate</span></span>
<span data-ttu-id="40a73-153">Среде ASE необходимо назначить SSL-сертификат по умолчанию, который будет использоваться для установки SSL-подключений к приложениям.</span><span class="sxs-lookup"><span data-stu-id="40a73-153">An SSL certificate must be associated with the ASE as the "default" SSL certificate that's used to establish SSL connections to apps.</span></span> <span data-ttu-id="40a73-154">Если DNS-суффикс по умолчанию среды службы приложений — *internal-contoso.com*, для подключения к https://случайному_приложению.internal-contoso.com требуется сертификат SSL, действительный для домена *.internal-contoso.com*.</span><span class="sxs-lookup"><span data-stu-id="40a73-154">If the ASE's default DNS suffix is *internal-contoso.com*, a connection to https://some-random-app.internal-contoso.com requires an SSL certificate that's valid for **.internal-contoso.com*.</span></span> 

<span data-ttu-id="40a73-155">Можно получить действительный SSL-сертификат от внутреннего центра сертификации, приобрести у внешнего поставщика или использовать самозаверяющий сертификат.</span><span class="sxs-lookup"><span data-stu-id="40a73-155">Obtain a valid SSL certificate by using internal certificate authorities, purchasing a certificate from an external issuer, or using a self-signed certificate.</span></span> <span data-ttu-id="40a73-156">Независимо от источника SSL-сертификата для него необходимо соответствующим образом настроить следующие атрибуты:</span><span class="sxs-lookup"><span data-stu-id="40a73-156">Regardless of the source of the SSL certificate, the following certificate attributes must be configured properly:</span></span>

* <span data-ttu-id="40a73-157">**Subject** — для этого атрибута необходимо задать значение *.имя_корневого_домена.com*.</span><span class="sxs-lookup"><span data-stu-id="40a73-157">**Subject**: This attribute must be set to **.your-root-domain-here.com*.</span></span>
* <span data-ttu-id="40a73-158">**Subject Alternative Name** — этот атрибут должен содержать два значения: *.имя_корневого_домена.com* и *.scm.имя_корневого_домена.com*.</span><span class="sxs-lookup"><span data-stu-id="40a73-158">**Subject Alternative Name**: This attribute must include both **.your-root-domain-here.com* and **.scm.your-root-domain-here.com*.</span></span> <span data-ttu-id="40a73-159">Для SSL-подключений к сайту SCM или Kudu, связанному с каждым приложением, используется адрес в формате *имя_приложения.scm.имя_корневого_домена.com*.</span><span class="sxs-lookup"><span data-stu-id="40a73-159">SSL connections to the SCM/Kudu site associated with each app use an address of the form *your-app-name.scm.your-root-domain-here.com*.</span></span>

<span data-ttu-id="40a73-160">После получения действительного SSL-сертификата требуется выполнить еще два дополнительных подготовительных действия.</span><span class="sxs-lookup"><span data-stu-id="40a73-160">With a valid SSL certificate in hand, two additional preparatory steps are needed.</span></span> <span data-ttu-id="40a73-161">SSL-сертификат необходимо преобразовать в PFX-файл и сохранить в таком формате.</span><span class="sxs-lookup"><span data-stu-id="40a73-161">Convert/save the SSL certificate as a .pfx file.</span></span> <span data-ttu-id="40a73-162">PFX-файл должен содержать все промежуточные и корневые сертификаты.</span><span class="sxs-lookup"><span data-stu-id="40a73-162">Remember that the .pfx file must include all intermediate and root certificates.</span></span> <span data-ttu-id="40a73-163">Защитите его паролем.</span><span class="sxs-lookup"><span data-stu-id="40a73-163">Secure it with a password.</span></span>

<span data-ttu-id="40a73-164">PFX-файл необходимо преобразовать в строку Base64, так как SSL-сертификат будет загружен с использованием шаблона Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="40a73-164">The .pfx file needs to be converted into a base64 string because the SSL certificate is uploaded by using a Resource Manager template.</span></span> <span data-ttu-id="40a73-165">Такое преобразование требуется, так как шаблоны Resource Manager представлены в виде текстовых файлов.</span><span class="sxs-lookup"><span data-stu-id="40a73-165">Because Resource Manager templates are text files, the .pfx file must be converted into a base64 string.</span></span> <span data-ttu-id="40a73-166">Это позволит добавить PFX-файл в качестве параметра шаблона.</span><span class="sxs-lookup"><span data-stu-id="40a73-166">This way it can be included as a parameter of the template.</span></span>

<span data-ttu-id="40a73-167">В приведенном ниже фрагменте кода PowerShell показано, как:</span><span class="sxs-lookup"><span data-stu-id="40a73-167">Use the following PowerShell code snippet to:</span></span>

* <span data-ttu-id="40a73-168">создать самозаверяющий сертификат;</span><span class="sxs-lookup"><span data-stu-id="40a73-168">Generate a self-signed certificate.</span></span>
* <span data-ttu-id="40a73-169">экспортировать его в формате PFX-файла;</span><span class="sxs-lookup"><span data-stu-id="40a73-169">Export the certificate as a .pfx file.</span></span>
* <span data-ttu-id="40a73-170">преобразовать PFX-файл в строку в кодировке Base64;</span><span class="sxs-lookup"><span data-stu-id="40a73-170">Convert the .pfx file into a base64-encoded string.</span></span>
* <span data-ttu-id="40a73-171">сохранить эту строку в отдельном файле.</span><span class="sxs-lookup"><span data-stu-id="40a73-171">Save the base64-encoded string to a separate file.</span></span> 

<span data-ttu-id="40a73-172">Код PowerShell для преобразования в строку в кодировке Base64 взят из [блога скриптов PowerShell][examplebase64encoding].</span><span class="sxs-lookup"><span data-stu-id="40a73-172">This PowerShell code for base64 encoding was adapted from the [PowerShell scripts blog][examplebase64encoding]:</span></span>

        $certificate = New-SelfSignedCertificate -certstorelocation cert:\localmachine\my -dnsname "*.internal-contoso.com","*.scm.internal-contoso.com"

        $certThumbprint = "cert:\localMachine\my\" + $certificate.Thumbprint
        $password = ConvertTo-SecureString -String "CHANGETHISPASSWORD" -Force -AsPlainText

        $fileName = "exportedcert.pfx"
        Export-PfxCertificate -cert $certThumbprint -FilePath $fileName -Password $password     

        $fileContentBytes = get-content -encoding byte $fileName
        $fileContentEncoded = [System.Convert]::ToBase64String($fileContentBytes)
        $fileContentEncoded | set-content ($fileName + ".b64")

<span data-ttu-id="40a73-173">Когда SSL-сертификат будет создан и преобразован в строку в кодировке Base64, можно приступить к [настройке сертификата SSL по умолчанию][quickstartconfiguressl] с использованием шаблона Resource Manager, размещенного на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="40a73-173">After the SSL certificate is successfully generated and converted to a base64-encoded string, use the example Resource Manager template [Configure the default SSL certificate][quickstartconfiguressl] on GitHub.</span></span> 

<span data-ttu-id="40a73-174">Ниже перечислены параметры, содержащиеся в файле *azuredeploy.parameters.json*.</span><span class="sxs-lookup"><span data-stu-id="40a73-174">The parameters in the *azuredeploy.parameters.json* file are listed here:</span></span>

* <span data-ttu-id="40a73-175">*appServiceEnvironmentName*— имя настраиваемой ASE с внутренним балансировщиком нагрузки.</span><span class="sxs-lookup"><span data-stu-id="40a73-175">*appServiceEnvironmentName*: The name of the ILB ASE being configured.</span></span>
* <span data-ttu-id="40a73-176">*existingAseLocation*— текстовая строка, содержащая регион Azure, где развернута ASE с внутренним балансировщиком нагрузки.</span><span class="sxs-lookup"><span data-stu-id="40a73-176">*existingAseLocation*: Text string containing the Azure region where the ILB ASE was deployed.</span></span>  <span data-ttu-id="40a73-177">Например, South Central US.</span><span class="sxs-lookup"><span data-stu-id="40a73-177">For example: "South Central US".</span></span>
* <span data-ttu-id="40a73-178">*pfxBlobString* — представление PFX-файла в виде строки в кодировке Base64.</span><span class="sxs-lookup"><span data-stu-id="40a73-178">*pfxBlobString*: The based64-encoded string representation of the .pfx file.</span></span> <span data-ttu-id="40a73-179">Используйте приведенный выше фрагмент кода и скопируйте строку, содержащуюся в файле exportedcert.pfx.b64.</span><span class="sxs-lookup"><span data-stu-id="40a73-179">Use the code snippet shown earlier and copy the string contained in "exportedcert.pfx.b64".</span></span> <span data-ttu-id="40a73-180">Вставьте ее в качестве значения атрибута *pfxBlobString*.</span><span class="sxs-lookup"><span data-stu-id="40a73-180">Paste it in as the value of the *pfxBlobString* attribute.</span></span>
* <span data-ttu-id="40a73-181">*password*— пароль, используемый для защиты PFX-файла.</span><span class="sxs-lookup"><span data-stu-id="40a73-181">*password*: The password used to secure the .pfx file.</span></span>
* <span data-ttu-id="40a73-182">*certificateThumbprint*— отпечаток сертификата.</span><span class="sxs-lookup"><span data-stu-id="40a73-182">*certificateThumbprint*: The certificate's thumbprint.</span></span> <span data-ttu-id="40a73-183">Если вы получите это значение из PowerShell (например, значение *$certificate.Thumbprint* в приведенном выше фрагменте кода), его можно использовать без каких-либо изменений.</span><span class="sxs-lookup"><span data-stu-id="40a73-183">If you retrieve this value from PowerShell (for example, *$certificate.Thumbprint* from the earlier code snippet), you can use the value as is.</span></span> <span data-ttu-id="40a73-184">Если вы скопируете это значение в диалоговом окне сертификатов Windows, в нем нужно удалить лишние пробелы.</span><span class="sxs-lookup"><span data-stu-id="40a73-184">If you copy the value from the Windows certificate dialog box, remember to strip out the extraneous spaces.</span></span> <span data-ttu-id="40a73-185">Значение атрибута *certificateThumbprint* должно выглядеть следующим образом: AF3143EB61D43F6727842115BB7F17BBCECAECAE.</span><span class="sxs-lookup"><span data-stu-id="40a73-185">The *certificateThumbprint* should look something like  AF3143EB61D43F6727842115BB7F17BBCECAECAE.</span></span>
* <span data-ttu-id="40a73-186">*certificateName*— понятный идентификатор строки для идентификации сертификата, который пользователь может выбрать по своему усмотрению.</span><span class="sxs-lookup"><span data-stu-id="40a73-186">*certificateName*: A friendly string identifier of your own choosing used to identity the certificate.</span></span> <span data-ttu-id="40a73-187">Это имя используется как часть уникального идентификатора Resource Manager для сущности *Microsoft.Web/certificates*, представляющей SSL-сертификат.</span><span class="sxs-lookup"><span data-stu-id="40a73-187">The name is used as part of the unique Resource Manager identifier for the *Microsoft.Web/certificates* entity that represents the SSL certificate.</span></span> <span data-ttu-id="40a73-188">Имя *должно* заканчиваться таким суффиксом: \_имя_ASE_InternalLoadBalancingASE.</span><span class="sxs-lookup"><span data-stu-id="40a73-188">The name *must* end with the following suffix: \_yourASENameHere_InternalLoadBalancingASE.</span></span> <span data-ttu-id="40a73-189">Этот суффикс сообщает порталу Azure о том, что для обеспечения безопасности ASE с поддержкой ILB используется сертификат.</span><span class="sxs-lookup"><span data-stu-id="40a73-189">The Azure portal uses this suffix as an indicator that the certificate is used to secure an ILB-enabled ASE.</span></span>

<span data-ttu-id="40a73-190">Ниже приведен сокращенный пример файла *azuredeploy.parameters.json*.</span><span class="sxs-lookup"><span data-stu-id="40a73-190">An abbreviated example of *azuredeploy.parameters.json* is shown here:</span></span>

    {
         "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json",
         "contentVersion": "1.0.0.0",
         "parameters": {
              "appServiceEnvironmentName": {
                   "value": "yourASENameHere"
              },
              "existingAseLocation": {
                   "value": "East US 2"
              },
              "pfxBlobString": {
                   "value": "MIIKcAIBAz...snip...snip...pkCAgfQ"
              },
              "password": {
                   "value": "PASSWORDGOESHERE"
              },
              "certificateThumbprint": {
                   "value": "AF3143EB61D43F6727842115BB7F17BBCECAECAE"
              },
              "certificateName": {
                   "value": "DefaultCertificateFor_yourASENameHere_InternalLoadBalancingASE"
              }
         }
    }

<span data-ttu-id="40a73-191">Когда файл *azuredeploy.parameters.json* будет заполнен, переходите к настройке SSL-сертификата по умолчанию, используя фрагмент кода PowerShell.</span><span class="sxs-lookup"><span data-stu-id="40a73-191">After the *azuredeploy.parameters.json* file is filled in, configure the default SSL certificate by using the PowerShell code snippet.</span></span> <span data-ttu-id="40a73-192">Измените пути к файлам в соответствии с расположением файлов шаблонов Resource Manager на вашем компьютере.</span><span class="sxs-lookup"><span data-stu-id="40a73-192">Change the file paths to match where the Resource Manager template files are located on your machine.</span></span> <span data-ttu-id="40a73-193">Введите собственные значения для имени развертывания Resource Manager и группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="40a73-193">Remember to supply your own values for the Resource Manager deployment name and the resource group name:</span></span>

     $templatePath="PATH\azuredeploy.json"
     $parameterPath="PATH\azuredeploy.parameters.json"

     New-AzureRmResourceGroupDeployment -Name "CHANGEME" -ResourceGroupName "YOUR-RG-NAME-HERE" -TemplateFile $templatePath -TemplateParameterFile $parameterPath

<span data-ttu-id="40a73-194">Применение изменений для одного внешнего интерфейса ASE занимает примерно 40 минут.</span><span class="sxs-lookup"><span data-stu-id="40a73-194">It takes roughly 40 minutes per ASE front end to apply the change.</span></span> <span data-ttu-id="40a73-195">Например, для среды ASE с размером по умолчанию, содержащей два внешних интерфейса, реализация шаблона займет примерно один час и двадцать минут.</span><span class="sxs-lookup"><span data-stu-id="40a73-195">For example, for a default-sized ASE that uses two front ends, the template takes around one hour and 20 minutes to complete.</span></span> <span data-ttu-id="40a73-196">Во время выполнения шаблона нельзя масштабировать среду ASE.</span><span class="sxs-lookup"><span data-stu-id="40a73-196">While the template is running, the ASE can't scale.</span></span>  

<span data-ttu-id="40a73-197">Когда шаблон будет реализован, к приложениям в среде ASE с внутренним балансировщиком нагрузки можно будет получать доступ по протоколу HTTPS,</span><span class="sxs-lookup"><span data-stu-id="40a73-197">After the template finishes, apps on the ILB ASE can be accessed over HTTPS.</span></span> <span data-ttu-id="40a73-198">а подключения будут защищены с помощью SSL-сертификата по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="40a73-198">The connections are secured by using the default SSL certificate.</span></span> <span data-ttu-id="40a73-199">SSL-сертификат по умолчанию будет использоваться, если обращение к приложениям в ASE с внутренним балансировщиком нагрузки осуществляется с помощью сочетания имени приложения и имени узла по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="40a73-199">The default SSL certificate is used when apps on the ILB ASE are addressed by using a combination of the application name plus the default host name.</span></span> <span data-ttu-id="40a73-200">Например, в https://mycustomapp.internal-contoso.com используется сертификат SSL по умолчанию для *.internal-contoso.com*.</span><span class="sxs-lookup"><span data-stu-id="40a73-200">For example, https://mycustomapp.internal-contoso.com uses the default SSL certificate for **.internal-contoso.com*.</span></span>

<span data-ttu-id="40a73-201">Так же как и для приложений в общедоступной мультитенантной службе, разработчики могут настроить для отдельных приложений пользовательские имена узлов</span><span class="sxs-lookup"><span data-stu-id="40a73-201">However, just like apps that run on the public multitenant service, developers can configure custom host names for individual apps.</span></span> <span data-ttu-id="40a73-202">и уникальные привязки сертификатов SNI SSL.</span><span class="sxs-lookup"><span data-stu-id="40a73-202">They also can configure unique SNI SSL certificate bindings for individual apps.</span></span>

## <a name="app-service-environment-v1"></a><span data-ttu-id="40a73-203">Среда службы приложений версии 1</span><span class="sxs-lookup"><span data-stu-id="40a73-203">App Service Environment v1</span></span> ##
<span data-ttu-id="40a73-204">Среда службы приложений имеет две версии: ASEv1 и ASEv2.</span><span class="sxs-lookup"><span data-stu-id="40a73-204">App Service Environment has two versions: ASEv1 and ASEv2.</span></span> <span data-ttu-id="40a73-205">Приведенные выше сведения относятся к версии ASEv2.</span><span class="sxs-lookup"><span data-stu-id="40a73-205">The preceding information was based on ASEv2.</span></span> <span data-ttu-id="40a73-206">В этом разделе показаны различия между ASEv1 и ASEv2.</span><span class="sxs-lookup"><span data-stu-id="40a73-206">This section shows you the differences between ASEv1 and ASEv2.</span></span>

<span data-ttu-id="40a73-207">В ASEv1 можно управлять всеми ресурсами вручную,</span><span class="sxs-lookup"><span data-stu-id="40a73-207">In ASEv1, you manage all of the resources manually.</span></span> <span data-ttu-id="40a73-208">включая внешние интерфейсы, рабочие процессы и IP-адреса, использованные для SSL на основе IP.</span><span class="sxs-lookup"><span data-stu-id="40a73-208">That includes the front ends, workers, and IP addresses used for IP-based SSL.</span></span> <span data-ttu-id="40a73-209">Перед масштабированием плана службы приложений необходимо выполнить масштабирование пула рабочих процессов, в котором необходимо разместить план.</span><span class="sxs-lookup"><span data-stu-id="40a73-209">Before you can scale out your App Service plan, you must scale out the worker pool that you want to host it.</span></span>

<span data-ttu-id="40a73-210">ASEv1 использует модель ценообразования отличную от ASEv2.</span><span class="sxs-lookup"><span data-stu-id="40a73-210">ASEv1 uses a different pricing model from ASEv2.</span></span> <span data-ttu-id="40a73-211">В ASEv1 вы платите за каждое выделенное ядро,</span><span class="sxs-lookup"><span data-stu-id="40a73-211">In ASEv1, you pay for each core allocated.</span></span> <span data-ttu-id="40a73-212">включая ядра, используемые для внешних интерфейсов и рабочих процессов, которые не содержат рабочие нагрузки.</span><span class="sxs-lookup"><span data-stu-id="40a73-212">That includes cores that are used for front ends or workers that aren't hosting any workloads.</span></span> <span data-ttu-id="40a73-213">В ASEv1 максимально возможное масштабирование ASE по умолчанию — 55 узлов,</span><span class="sxs-lookup"><span data-stu-id="40a73-213">In ASEv1, the default maximum-scale size of an ASE is 55 total hosts.</span></span> <span data-ttu-id="40a73-214">включая рабочие роли и внешние интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="40a73-214">That includes workers and front ends.</span></span> <span data-ttu-id="40a73-215">Одним из преимуществ ASEv1 является возможность развертывания в классической виртуальной сети, а также в виртуальной сети Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="40a73-215">One advantage to ASEv1 is that it can be deployed in a classic virtual network and a Resource Manager virtual network.</span></span> <span data-ttu-id="40a73-216">Сведения об ASEv1 см. в статье [Введение в среду службы приложения][ASEv1Intro].</span><span class="sxs-lookup"><span data-stu-id="40a73-216">To learn more about ASEv1, see [App Service Environment v1 introduction][ASEv1Intro].</span></span>

<span data-ttu-id="40a73-217">Сведения о создании ASEv1 с помощью шаблона Resource Manager см. в статье [Создание среды службы приложений с внутренним балансировщиком нагрузки с помощью шаблонов Azure Resource Manager][ILBASEv1Template].</span><span class="sxs-lookup"><span data-stu-id="40a73-217">To create an ASEv1 by using a Resource Manager template, see [Create an ILB ASE v1 with a Resource Manager template][ILBASEv1Template].</span></span>


<!--Links-->
[quickstartilbasecreate]: http://azure.microsoft.com/documentation/templates/201-web-app-asev2-ilb-create
[quickstartasev2create]: http://azure.microsoft.com/documentation/templates/201-web-app-asev2-create
[quickstartconfiguressl]: http://azure.microsoft.com/documentation/templates/201-web-app-ase-ilb-configure-default-ssl
[quickstartwebapponasev2create]: http://azure.microsoft.com/documentation/templates/201-web-app-asp-app-on-asev2-create
[examplebase64encoding]: http://powershellscripts.blogspot.com/2007/02/base64-encode-file.html 
[configuringDefaultSSLCertificate]: https://azure.microsoft.com/documentation/templates/201-web-app-ase-ilb-configure-default-ssl/
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ILBASEv1Template]: ../../app-service-web/app-service-app-service-environment-create-ilb-ase-resourcemanager.md
