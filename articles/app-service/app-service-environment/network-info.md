---
title: "aaaNetworking вопросы, связанные с среду службы приложений Azure"
description: "Объясняет hello ASE сетевой трафик и как tooset Nsg и UDRs с вашей ASE"
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 955a4d84-94ca-418d-aa79-b57a5eb8cb85
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2017
ms.author: ccompy
ms.openlocfilehash: d4d3000f4d4d75814b1e6d47079d967334eb1a3b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="networking-considerations-for-an-app-service-environment"></a>Рекомендации по работе с сетями в среде службы приложений #

## <a name="overview"></a>Обзор ##

 [Среда службы приложений][Intro] — это развернутая служба приложений Azure в подсети виртуальной сети Azure. Есть два типа развертывания для среды службы приложений (ASE):

- **Внешние ASE**: предоставляет hello приложений, размещаемых ASE на IP-адресе, доступном через Интернет. Дополнительные сведения см. в разделе о [создании внешней среды ASE][MakeExternalASE].
- **ILB ASE**: предоставляет hello приложений, размещаемых ASE на IP-адрес в виртуальной сети. Внутренняя конечная точка Hello является внутренней подсистемы балансировки нагрузки (ILB), поэтому он называется ILB ASE. Дополнительные сведения см. в статье о [создании и использовании ILB для ASE][MakeILBASE].

В настоящее время существует две версии среды службы приложений: ASEv1 и ASEv2. Сведения о ASEv1 см. в разделе [tooApp введение v1 среды службы][ASEv1Intro]. ASEv1 можно развернуть в классической виртуальной сети или в виртуальной сети Resource Manager. ASEv2 можно развернуть только в виртуальной сети Resource Manager.

Все вызовы ASE, которые выходят toohello Интернет оставить виртуальной сети через виртуальный IP-адрес, назначенный для hello ASE hello. Hello общедоступный IP-адрес из этого виртуального IP-адреса будет hello исходный IP-адрес для всех вызовов hello ASE, которые выходят toohello Интернета. Если в вашей ASE приложения hello tooresources вызовы виртуальной сети или через виртуальную частную сеть, hello исходный IP-адрес является одним из hello IP-адресов в подсети hello, используемых вашей ASE. Поскольку hello ASE находится в пределах hello виртуальной сети, он может также доступ к ресурсам в пределах hello виртуальной сети без дополнительной настройки. Hello виртуальной сети в случае подключенной tooyour локальную сеть, приложения в вашей ASE также имеют доступ tooresources существует. Не нужно tooconfigure hello ASE или приложения любые дополнительные.

![Внешняя среда ASE][1] 

При наличии внешних ASE hello общедоступный VIP-адрес также является hello конечной точки, что приложениям ASE решения toofor:

* HTTP/S; 
* FTP/S; 
* веб-развертывания;
* удаленной отладки.

![Среда ASE с ILB][2]

При наличии ILB ASE hello IP-адрес hello ILB — hello конечной точкой HTTP/S, FTP/S, веб-развертывания и удаленной отладки.

Ниже приведены порты доступа обычного приложения Hello.

| Использование | Из | слишком|
|----------|---------|-------------|
|  HTTP/HTTPS  | Настраивается пользователем |  80, 443 |
|  FTP/FTPS    | Настраивается пользователем |  21, 990, 10001-10020 |
|  Удаленная отладка в Visual Studio  |  Настраивается пользователем |  4016, 4018, 4020, 4022 |

Эти порты применимы, если используется внешняя среда ASE или ASE с ILB. Если вы на внешних ASE попадании порты hello общедоступный VIP-адрес. Если вы ILB ASE, попадании порты hello ILB. Если вы блокируете порт 443, может быть влияют на некоторые свойства, представленные в портале hello. Дополнительные сведения см. в разделе [Зависимости портала](#portaldep).

## <a name="ase-dependencies"></a>Зависимости ASE ##

Зависимости ASE для входящего трафика:

| Использование | Из | слишком|
|-----|------|----|
| управления | Адреса управления службой приложений | Подсеть ASE: 454, 455 |
|  Внутренний обмен данными ASE | Подсеть ASE: все порты | Подсеть ASE: все порты
|  Разрешение входящего трафика Azure Load Balancer | Azure Load Balancer | Подсеть ASE: все порты
|  IP-адреса, присвоенные приложению | Адреса, присвоенные приложению | Подсеть ASE: все порты

Hello входящий трафик предоставляет команды и управление ASE hello в мониторинге toosystem сложения. Источник Hello IP-адресов для трафика, перечислены в hello [управления ASE адреса] [ ASEManagement] документа. Конфигурация сетевой безопасности Hello необходим доступ tooallow от всех IP-адресов через порты 454 и 455.

В пределах hello ASE подсети, существует много порты, используемые для взаимодействия с внутренним компонентом, и они могут изменяться.  Это необходимо, чтобы все порты hello hello ASE подсети toobe доступен из подсети ASE hello. 

Для взаимодействия hello балансировки нагрузки Azure hello и hello ASE подсети hello порты, открытые toobe необходимость являются 454 и 455 16001. 16001 порт Hello используется keep alive трафик между hello балансировки нагрузки и hello ASE. Если вы используете ILB ASE можно заблокировать трафик вниз toojust hello 454, 455, 16001 портов.  При использовании внешних ASE требуется tootake в порты доступа обычного приложения hello учетной записи.  Если вы используете приложение, назначенное адреса необходимо tooopen его tooall портов.  Если адрес назначается tooa определенное приложение, hello балансировки нагрузки будет использовать порты, которые не известны заранее toosend HTTP и HTTPS трафика toohello ASE.

Если вы используете приложение, назначенное IP-адреса необходимо tooallow трафик от hello подсети ASE toohello приложений tooyour назначен IP-адресов.

Что касается доступа исходящего трафика, среда ASE зависит от различных внешних систем. Эти зависимости системы определяются с DNS-имена и не сопоставляйте tooa фиксированной набор IP-адресов. Таким образом, hello ASE требуется исходящий доступ из подсети tooall hello ASE внешние IP-адреса через различные порты. ASE имеет следующие исходящие зависимости hello.

| Использование | Из | слишком|
|-----|------|----|
| Хранилище Azure | Подсеть ASE | table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 необходим только для ASEv1) |
| База данных SQL Azure | Подсеть ASE | database.windows.net: 1433, 11000-11999, 14000-14999 (дополнительные сведения см. в статье об [использовании портов Базы данных SQL версии 12](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md))|
| Управление Azure | Подсеть ASE | management.core.windows.net, management.azure.com: 443 
| Проверка сертификатов SSL |  Подсеть ASE            |  ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443
| Azure Active Directory        | Подсеть ASE            |  Интернет: 443
| Управление службой приложений        | Подсеть ASE            |  Интернет: 443
| Azure DNS                     | Подсеть ASE            |  Интернет: 53
| Внутренний обмен данными ASE    | Подсеть ASE: все порты |  Подсеть ASE: все порты

Если hello ASE теряет доступ toothese зависимости, он перестает работать. Когда это происходит долго недостаточно, hello ASE приостанавливается.

### <a name="customer-dns"></a>DNS пользователя ###

Если hello виртуальная сеть настроена на DNS-сервере, определяемых пользователем, рабочие нагрузки клиентов hello использовать ее. Hello ASE по-прежнему должен toocommunicate с помощью Azure DNS для целей управления. 

Если hello виртуальная сеть настроена с клиента DNS на hello другом конце VPN-Подключение, hello DNS-сервер должен быть доступен из подсети hello, содержащей hello ASE.

<a name="portaldep"></a>

## <a name="portal-dependencies"></a>Зависимости портала ##

В дополнение toohello ASE функциональной зависимости существует несколько дополнительных элементов связанных toohello взаимодействие с порталом. Некоторые возможности hello в hello портал Azure зависят от site_ too_SCM прямой доступ. Для каждого приложения в службе приложений Azure предусмотрено два URL-адреса. Первый Hello URL-адрес является tooaccess приложения. Hello второй URL-адрес — tooaccess hello SCM сайта, которая также называется hello _Kudu консоли_. Функции, использующие hello SCM сайта:

-   Веб-задания
-   Функции
-   Потоковая передача журналов
-   Kudu
-   расширения.
-   Обозреватель процессов
-   Консоль

При использовании ILB ASE hello SCM сайта не доступен вне hello виртуальной сети Интернет. Если приложение размещается на ILB ASE, некоторые возможности не будет работать с портала hello.  

Многие из этих возможностей, зависящих от hello SCM узла также доступны непосредственно в консоль Kudu hello. Tooit можно подключиться напрямую, а не с помощью портала hello. Если приложение размещается в ILB ASE, используйте вашей публикации toosign учетные данные в. Hello URL-адрес tooaccess hello SCM сайт приложения, размещенного в ILB ASE имеет hello следующий формат: 

```
<appname>.scm.<domain name hello ILB ASE was created with> 
```

Если ваш ASE ILB hello доменным именем *contoso.net* и имя вашего приложения — *testapp*, по достижении приложение hello *testapp.contoso.net*. Hello SCM сайт, который перемещается вместе с ним достигается в *testapp.scm.contoso.net*.

### <a name="functions-and-web-jobs"></a>Служба "Функции" и "Веб-задания" ###

Функции и веб-задания, зависят от узла SCM hello, но поддерживаются для использования на портале hello, даже если приложений находятся в ILB ASE, при условии, что браузер может достигать hello SCM сайта.  Если вы используете самозаверяющий сертификат с вашей ASE ILB, необходимо будет tooenable вашей tootrust браузера, сертификатов.  Для IE и границей, значит hello сертификат имеет toobe в компьютере доверия hello хранения.  Если вы используете Chrome, то это означает, что вы приняли сертификат hello в браузере hello ранее предположительно щелчком hello scm сайта непосредственно.  Hello наилучшим решением является toouse коммерческих сертификат, который находится в цепочки hello браузера.  

## <a name="ase-ip-addresses"></a>IP-адреса ASE ##

ASE имеет несколько toobe адресов IP, учитывать. К ним относятся:

- **Общедоступный IP-адрес для входящего трафика**. Используется для трафика приложений во внешней среде ASE и трафика управления в обоих средах (внешняя ASE и ASE с ILB).
- **Исходящие общедоступный IP-адрес**: использовать в качестве hello «с «IP-адреса для исходящие подключения из hello ASE, оставьте hello виртуальной сети, которых не направлено вниз VPN-Подключение.
- **IP-адрес ILB**. Применяется при использовании среды ASE с ILB.
- **Присвоенные приложению адреса с SSL на основе IP**. Могут применяться, только если используется внешняя ASE и настроен SSL на основе IP-адреса.

Эти IP-адреса, легко отображаются в ASEv2 в hello портал Azure, из пользовательского интерфейса ASE hello. Если у вас есть ILB ASE, перечисляется hello IP-адрес для hello ILB.

![IP-адреса;][3]

### <a name="app-assigned-ip-addresses"></a>Присвоенные приложению IP-адреса ###

Внешние ASE позволяет назначать IP-адреса tooindividual приложений. В ASE с ILB такая возможность не предусмотрена. Дополнительные сведения о том, как tooconfigure toohave вашего приложения собственный IP-адрес в разделе [привязать существующие пользовательские SSL сертификат tooAzure веб-приложения](../../app-service-web/app-service-web-tutorial-custom-ssl.md).

Если приложение имеет собственный SSL на основе IP-адрес, hello ASE резервирует два порты toomap toothat IP-адрес. Один порт для трафика HTTP, а hello другой порт для протокола HTTPS. Порты, перечислены в hello ASE пользовательского интерфейса в hello IP-адреса разделе. Трафик должен быть доступ tooreach порты из приложений hello или hello виртуальных IP-адресов недоступны. Это требование является важным tooremember при настройке группы безопасности сети (Nsg).

## <a name="network-security-groups"></a>группы сетевой безопасности; ##

[Сетевых групп безопасности] [ NSGs] обеспечить hello возможность toocontrol сетевого доступа в виртуальной сети. При использовании портала hello, имеется неявный deny правила с наименьшим приоритетом toodeny hello все данные. Поэтому необходимо создать правила разрешения.

В ASE у вас нет доступа toohello использовать виртуальные машины toohost hello ASE сам. Они входят в подписку, управляемую корпорацией Майкрософт. Toorestrict доступа toohello приложений на hello ASE, установите Nsg из подсети ASE hello. При этом Обратите пристальное внимание toohello ASE зависимости. Блокирование всех зависимостей hello ASE перестает работать.

Nsg можно настроить через портал Azure hello или с помощью PowerShell. здесь сведения Hello показывает hello портал Azure. Для создания и управления Nsg hello портале как ресурс верхнего уровня под **сети**.

После hello входящий и исходящий требования учитываются, hello Nsg должна выглядеть примерно toohello Nsg, показано в следующем примере. Hello диапазон адресов виртуальной сети является _192.168.250.0/16_, и подсеть hello, hello ASE _192.168.251.128/25_.

hello верхней части списка hello в этом примере показаны Hello первых двух входящих требования к hello ASE toofunction. Они включить управление ASE и позволяют toocommunicate ASE hello с самим собой. Hello другие записи всех клиента можно настроить и может управлять сетевого доступа toohello ASE-приложений. 

![Правила безопасности для входящего трафика][4]

Правило по умолчанию включает hello IP-адресов в подсети, ASE toohello tootalk hello виртуальной сети. Другое правило по умолчанию включает hello балансировки нагрузки, также известные как общедоступный VIP hello, toocommunicate с hello ASE. Выберите правила по умолчанию hello toosee, **по умолчанию правила** Далее toohello **добавить** значок. Если поместить все остальные правила после hello NSG правила показано deny, можно предотвратить передачу трафика между hello виртуальных IP-адресов и hello ASE. tooprevent трафик, поступающий из hello виртуальной сети, добавьте в пределах tooallow собственные правила входящего трафика. Использовать tooAzureLoadBalancer равно источника с адресом назначения **любой** и диапазон портов  **\*** . Поскольку правило NSG hello примененных toohello ASE подсети, не требуется определенного toobe в конечном hello.

Если для назначения приложения tooyour IP адрес, убедитесь, что обеспечили hello необходимые порты. Выберите порты toosee hello, **среды службы приложений** > **IP-адреса**.  

Требуются все hello пунктов в hello следующие правила для исходящих подключений, за исключением последнего элемента hello. Они позволяют зависимости ASE toohello доступа к сети, записанные ранее в этой статье. При блокировке любого из этих элементов ASE прекратит работу. Hello последнего элемента в списке hello позволяет вашей ASE toocommunicate с другими ресурсами в виртуальной сети.

![Правила безопасности для исходящего трафика][5]

После определения Nsg назначьте их toohello подсети, к ASE на. Если вы не помните hello ASE виртуальную сеть или подсеть, найдите его с портала управления ASE hello. tooassign hello подсети tooyour NSG, go toohello подсети пользовательского интерфейса и выберите hello NSG.

## <a name="routes"></a>Маршруты ##

При настройке виртуальной сети с помощью Azure ExpressRoute маршрутизация зачастую сопровождается проблемами. В виртуальной сети существует три типа маршрутов:

-   Системные маршруты
-   Маршруты BGP
-   Определяемые пользователем маршруты

Маршруты BGP переопределяют системные маршруты. Определяемые пользователем маршруты переопределяют маршруты BGP. Дополнительные сведения о маршрутах в виртуальных сетях Azure см. в статье [Определяемые пользователем маршруты и IP-пересылка][UDRs].

Hello базы данных Azure SQL, hello ASE использует систему hello toomanage оснащен брандмауэром. Он требует toooriginate связи из hello ASE общедоступный VIP-адрес. Базы данных SQL toohello подключений из hello ASE будут отклонены, если они отправляются вниз hello подключение ExpressRoute и другой IP-адрес.

Отправки запросов управления tooincoming ответов вниз hello ExpressRoute hello обратный адрес отличается от hello исходное расположение. Это несоответствие разрывает связь по протоколу TCP hello.

Для вашего toowork ASE пока виртуальная сеть настроена с ExpressRoute, является простым самое toodo hello:

-   Настройка ExpressRoute tooadvertise _0.0.0.0/0_. Это по умолчанию приведет к принудительному туннелированию всего исходящего трафика в локальную среду.
-   Создайте определяемый пользователем маршрут. Применить его toohello подсети, содержащей ASE hello с префикс адреса _0.0.0.0/0_ и тип из следующего прыжка _Internet_.

Если эти два изменения предназначенные Интернет трафик, отправленный из подсети ASE hello не принудительно вниз hello ExpressRoute и hello ASE работает. 

> [!IMPORTANT]
> Hello маршрутов, указанных в UDR должна быть достаточно точным, tootake приоритет через все маршруты, объявленные hello ExpressRoute конфигурацией. Hello в предыдущем примере диапазон адресов широкий 0.0.0.0/0 hello. Он может быть случайно заменен объявлениями маршрутов с более узкими диапазонами адресов.
>
> ASEs не поддерживаются с ExpressRoute конфигурациями, которые кросс объявлять маршруты из hello общедоступного пиринга toohello пиринг закрытый путь. Конфигурации ExpressRoute с настроенным общедоступным пирингом получают объявления маршрутов от корпорации Майкрософт. объявления Hello содержит большой набор Microsoft Azure диапазонов адресов. Диапазоны адресов hello, объявленных между hello пиринг частного пути всех исходящих сетевых пакетов из подсети hello в ASE, Принудительное туннелирование tooa клиента в локальной сети. В настоящее время этот сетевой поток не поддерживается в средах ASE. Одна проблема toothis решение — toostop маршруты между рекламу от hello общедоступного пиринга toohello пиринг закрытый путь.

toocreate UDR, выполните следующие действия.

1. Go toohello портал Azure. Последовательно выберите **Cети** > **Таблицы маршрутов**.

2. Создать новую таблицу маршрутов в hello же регионе, что виртуальная сеть.

3. В пользовательском интерфейсе таблицы маршрутов последовательно выберите **Маршруты** > **Добавить**.

4. Набор hello **тип следующего прыжка** слишком**Internet** и hello **префикс адреса** слишком**0.0.0.0/0**. Щелкните **Сохранить**.

    После этого отображается примерно hello следующим образом:

    ![Функциональные маршруты][6]

5. После создания новой таблицы маршрутов hello перейдите toohello подсети, которая содержит ваш ASE. Выберите таблицы маршрутизации из списка hello в портале hello. После сохранения изменений hello, затем появится Nsg hello и маршрутов, указанных с подсети.

    ![Группы безопасности сети и маршруты][7]

### <a name="deploy-into-existing-azure-virtual-networks-that-are-integrated-with-expressroute"></a>Развертывание в существующих виртуальных сетях Azure, интегрированных с ExpressRoute ###

toodeploy вашей ASE в виртуальную сеть, интегрированных с ExpressRoute, предварительной настройки hello подсети, где требуется развернуть ASE hello. Затем с помощью шаблона диспетчера ресурсов toodeploy его. toocreate ASE в виртуальной сети, где уже есть настроен ExpressRoute:

- Создание подсети toohost hello ASE.

    > [!NOTE]
    > Никаких других могут находиться в подсети hello, но hello ASE. Быть toochoose убедиться, что адресное пространство, позволяющий роста в будущем. Впоследствии этот параметр уже нельзя изменить. Рекомендуемый размер — `/25` с 128 адресами.

- Создание UDRs (например, таблицы маршрутов), как описано выше, а также задать в подсети hello.
- Создание с помощью шаблона диспетчера ресурсов, как описано в hello ASE [создать с помощью шаблона диспетчера ресурсов ASE][MakeASEfromTemplate].

<!--Image references-->
[1]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow.png
[2]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow2.png
[3]: ./media/network_considerations_with_an_app_service_environment/networkase-ipaddresses.png
[4]: ./media/network_considerations_with_an_app_service_environment/networkase-inboundnsg.png
[5]: ./media/network_considerations_with_an_app_service_environment/networkase-outboundnsg.png
[6]: ./media/network_considerations_with_an_app_service_environment/networkase-udr.png
[7]: ./media/network_considerations_with_an_app_service_environment/networkase-subnet.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ASEManagement]: ./management-addresses.md
