---
title: "aaaNetworking вопросы, связанные с среду службы приложений Azure"
description: "Объясняет hello ASE сетевой трафик и как tooset Nsg и UDRs с вашей ASE"
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 955a4d84-94ca-418d-aa79-b57a5eb8cb85
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2017
ms.author: ccompy
ms.openlocfilehash: d4d3000f4d4d75814b1e6d47079d967334eb1a3b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="networking-considerations-for-an-app-service-environment"></a><span data-ttu-id="67b3d-103">Рекомендации по работе с сетями в среде службы приложений</span><span class="sxs-lookup"><span data-stu-id="67b3d-103">Networking considerations for an App Service environment</span></span> #

## <a name="overview"></a><span data-ttu-id="67b3d-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="67b3d-104">Overview</span></span> ##

 <span data-ttu-id="67b3d-105">[Среда службы приложений][Intro] — это развернутая служба приложений Azure в подсети виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="67b3d-105">Azure [App Service Environment][Intro] is a deployment of Azure App Service into a subnet in your Azure virtual network (VNet).</span></span> <span data-ttu-id="67b3d-106">Есть два типа развертывания для среды службы приложений (ASE):</span><span class="sxs-lookup"><span data-stu-id="67b3d-106">There are two deployment types for an App Service environment (ASE):</span></span>

- <span data-ttu-id="67b3d-107">**Внешние ASE**: предоставляет hello приложений, размещаемых ASE на IP-адресе, доступном через Интернет.</span><span class="sxs-lookup"><span data-stu-id="67b3d-107">**External ASE**: Exposes hello ASE-hosted apps on an internet-accessible IP address.</span></span> <span data-ttu-id="67b3d-108">Дополнительные сведения см. в разделе о [создании внешней среды ASE][MakeExternalASE].</span><span class="sxs-lookup"><span data-stu-id="67b3d-108">For more information, see [Create an External ASE][MakeExternalASE].</span></span>
- <span data-ttu-id="67b3d-109">**ILB ASE**: предоставляет hello приложений, размещаемых ASE на IP-адрес в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="67b3d-109">**ILB ASE**: Exposes hello ASE-hosted apps on an IP address inside your VNet.</span></span> <span data-ttu-id="67b3d-110">Внутренняя конечная точка Hello является внутренней подсистемы балансировки нагрузки (ILB), поэтому он называется ILB ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-110">hello internal endpoint is an internal load balancer (ILB), which is why it's called an ILB ASE.</span></span> <span data-ttu-id="67b3d-111">Дополнительные сведения см. в статье о [создании и использовании ILB для ASE][MakeILBASE].</span><span class="sxs-lookup"><span data-stu-id="67b3d-111">For more information, see [Create and use an ILB ASE][MakeILBASE].</span></span>

<span data-ttu-id="67b3d-112">В настоящее время существует две версии среды службы приложений: ASEv1 и ASEv2.</span><span class="sxs-lookup"><span data-stu-id="67b3d-112">There are now two versions of App Service Environment: ASEv1 and ASEv2.</span></span> <span data-ttu-id="67b3d-113">Сведения о ASEv1 см. в разделе [tooApp введение v1 среды службы][ASEv1Intro].</span><span class="sxs-lookup"><span data-stu-id="67b3d-113">For information on ASEv1, see [Introduction tooApp Service Environment v1][ASEv1Intro].</span></span> <span data-ttu-id="67b3d-114">ASEv1 можно развернуть в классической виртуальной сети или в виртуальной сети Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="67b3d-114">ASEv1 can be deployed in a classic or Resource Manager VNet.</span></span> <span data-ttu-id="67b3d-115">ASEv2 можно развернуть только в виртуальной сети Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="67b3d-115">ASEv2 can only be deployed into a Resource Manager VNet.</span></span>

<span data-ttu-id="67b3d-116">Все вызовы ASE, которые выходят toohello Интернет оставить виртуальной сети через виртуальный IP-адрес, назначенный для hello ASE hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-116">All calls from an ASE that go toohello internet leave hello VNet through a VIP assigned for hello ASE.</span></span> <span data-ttu-id="67b3d-117">Hello общедоступный IP-адрес из этого виртуального IP-адреса будет hello исходный IP-адрес для всех вызовов hello ASE, которые выходят toohello Интернета.</span><span class="sxs-lookup"><span data-stu-id="67b3d-117">hello public IP of this VIP is then hello source IP for all calls from hello ASE that go toohello internet.</span></span> <span data-ttu-id="67b3d-118">Если в вашей ASE приложения hello tooresources вызовы виртуальной сети или через виртуальную частную сеть, hello исходный IP-адрес является одним из hello IP-адресов в подсети hello, используемых вашей ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-118">If hello apps in your ASE make calls tooresources in your VNet or across a VPN, hello source IP is one of hello IPs in hello subnet used by your ASE.</span></span> <span data-ttu-id="67b3d-119">Поскольку hello ASE находится в пределах hello виртуальной сети, он может также доступ к ресурсам в пределах hello виртуальной сети без дополнительной настройки.</span><span class="sxs-lookup"><span data-stu-id="67b3d-119">Because hello ASE is within hello VNet, it can also access resources within hello VNet without any additional configuration.</span></span> <span data-ttu-id="67b3d-120">Hello виртуальной сети в случае подключенной tooyour локальную сеть, приложения в вашей ASE также имеют доступ tooresources существует.</span><span class="sxs-lookup"><span data-stu-id="67b3d-120">If hello VNet is connected tooyour on-premises network, apps in your ASE also have access tooresources there.</span></span> <span data-ttu-id="67b3d-121">Не нужно tooconfigure hello ASE или приложения любые дополнительные.</span><span class="sxs-lookup"><span data-stu-id="67b3d-121">You don't need tooconfigure hello ASE or your app any further.</span></span>

![Внешняя среда ASE][1] 

<span data-ttu-id="67b3d-123">При наличии внешних ASE hello общедоступный VIP-адрес также является hello конечной точки, что приложениям ASE решения toofor:</span><span class="sxs-lookup"><span data-stu-id="67b3d-123">If you have an External ASE, hello public VIP is also hello endpoint that your ASE apps resolve toofor:</span></span>

* <span data-ttu-id="67b3d-124">HTTP/S;</span><span class="sxs-lookup"><span data-stu-id="67b3d-124">HTTP/S.</span></span> 
* <span data-ttu-id="67b3d-125">FTP/S;</span><span class="sxs-lookup"><span data-stu-id="67b3d-125">FTP/S.</span></span> 
* <span data-ttu-id="67b3d-126">веб-развертывания;</span><span class="sxs-lookup"><span data-stu-id="67b3d-126">Web deployment.</span></span>
* <span data-ttu-id="67b3d-127">удаленной отладки.</span><span class="sxs-lookup"><span data-stu-id="67b3d-127">Remote debugging.</span></span>

![Среда ASE с ILB][2]

<span data-ttu-id="67b3d-129">При наличии ILB ASE hello IP-адрес hello ILB — hello конечной точкой HTTP/S, FTP/S, веб-развертывания и удаленной отладки.</span><span class="sxs-lookup"><span data-stu-id="67b3d-129">If you have an ILB ASE, hello IP address of hello ILB is hello endpoint for HTTP/S, FTP/S, web deployment, and remote debugging.</span></span>

<span data-ttu-id="67b3d-130">Ниже приведены порты доступа обычного приложения Hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-130">hello normal app access ports are:</span></span>

| <span data-ttu-id="67b3d-131">Использование</span><span class="sxs-lookup"><span data-stu-id="67b3d-131">Use</span></span> | <span data-ttu-id="67b3d-132">Из</span><span class="sxs-lookup"><span data-stu-id="67b3d-132">From</span></span> | <span data-ttu-id="67b3d-133">слишком</span><span class="sxs-lookup"><span data-stu-id="67b3d-133">too</span></span>|
|----------|---------|-------------|
|  <span data-ttu-id="67b3d-134">HTTP/HTTPS</span><span class="sxs-lookup"><span data-stu-id="67b3d-134">HTTP/HTTPS</span></span>  | <span data-ttu-id="67b3d-135">Настраивается пользователем</span><span class="sxs-lookup"><span data-stu-id="67b3d-135">User configurable</span></span> |  <span data-ttu-id="67b3d-136">80, 443</span><span class="sxs-lookup"><span data-stu-id="67b3d-136">80, 443</span></span> |
|  <span data-ttu-id="67b3d-137">FTP/FTPS</span><span class="sxs-lookup"><span data-stu-id="67b3d-137">FTP/FTPS</span></span>    | <span data-ttu-id="67b3d-138">Настраивается пользователем</span><span class="sxs-lookup"><span data-stu-id="67b3d-138">User configurable</span></span> |  <span data-ttu-id="67b3d-139">21, 990, 10001-10020</span><span class="sxs-lookup"><span data-stu-id="67b3d-139">21, 990, 10001-10020</span></span> |
|  <span data-ttu-id="67b3d-140">Удаленная отладка в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="67b3d-140">Visual Studio remote debugging</span></span>  |  <span data-ttu-id="67b3d-141">Настраивается пользователем</span><span class="sxs-lookup"><span data-stu-id="67b3d-141">User configurable</span></span> |  <span data-ttu-id="67b3d-142">4016, 4018, 4020, 4022</span><span class="sxs-lookup"><span data-stu-id="67b3d-142">4016, 4018, 4020, 4022</span></span> |

<span data-ttu-id="67b3d-143">Эти порты применимы, если используется внешняя среда ASE или ASE с ILB.</span><span class="sxs-lookup"><span data-stu-id="67b3d-143">This is true if you're on an External ASE or on an ILB ASE.</span></span> <span data-ttu-id="67b3d-144">Если вы на внешних ASE попадании порты hello общедоступный VIP-адрес.</span><span class="sxs-lookup"><span data-stu-id="67b3d-144">If you're on an External ASE, you hit those ports on hello public VIP.</span></span> <span data-ttu-id="67b3d-145">Если вы ILB ASE, попадании порты hello ILB.</span><span class="sxs-lookup"><span data-stu-id="67b3d-145">If you're on an ILB ASE, you hit those ports on hello ILB.</span></span> <span data-ttu-id="67b3d-146">Если вы блокируете порт 443, может быть влияют на некоторые свойства, представленные в портале hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-146">If you lock down port 443, there can be an effect on some features exposed in hello portal.</span></span> <span data-ttu-id="67b3d-147">Дополнительные сведения см. в разделе [Зависимости портала](#portaldep).</span><span class="sxs-lookup"><span data-stu-id="67b3d-147">For more information, see [Portal dependencies](#portaldep).</span></span>

## <a name="ase-dependencies"></a><span data-ttu-id="67b3d-148">Зависимости ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-148">ASE dependencies</span></span> ##

<span data-ttu-id="67b3d-149">Зависимости ASE для входящего трафика:</span><span class="sxs-lookup"><span data-stu-id="67b3d-149">An ASE inbound access dependency is:</span></span>

| <span data-ttu-id="67b3d-150">Использование</span><span class="sxs-lookup"><span data-stu-id="67b3d-150">Use</span></span> | <span data-ttu-id="67b3d-151">Из</span><span class="sxs-lookup"><span data-stu-id="67b3d-151">From</span></span> | <span data-ttu-id="67b3d-152">слишком</span><span class="sxs-lookup"><span data-stu-id="67b3d-152">too</span></span>|
|-----|------|----|
| <span data-ttu-id="67b3d-153">управления</span><span class="sxs-lookup"><span data-stu-id="67b3d-153">Management</span></span> | <span data-ttu-id="67b3d-154">Адреса управления службой приложений</span><span class="sxs-lookup"><span data-stu-id="67b3d-154">App Service management addresses</span></span> | <span data-ttu-id="67b3d-155">Подсеть ASE: 454, 455</span><span class="sxs-lookup"><span data-stu-id="67b3d-155">ASE subnet: 454, 455</span></span> |
|  <span data-ttu-id="67b3d-156">Внутренний обмен данными ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-156">ASE internal communication</span></span> | <span data-ttu-id="67b3d-157">Подсеть ASE: все порты</span><span class="sxs-lookup"><span data-stu-id="67b3d-157">ASE subnet: All ports</span></span> | <span data-ttu-id="67b3d-158">Подсеть ASE: все порты</span><span class="sxs-lookup"><span data-stu-id="67b3d-158">ASE subnet: All ports</span></span>
|  <span data-ttu-id="67b3d-159">Разрешение входящего трафика Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="67b3d-159">Allow Azure load balancer inbound</span></span> | <span data-ttu-id="67b3d-160">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="67b3d-160">Azure load balancer</span></span> | <span data-ttu-id="67b3d-161">Подсеть ASE: все порты</span><span class="sxs-lookup"><span data-stu-id="67b3d-161">ASE subnet: All ports</span></span>
|  <span data-ttu-id="67b3d-162">IP-адреса, присвоенные приложению</span><span class="sxs-lookup"><span data-stu-id="67b3d-162">App assigned IP addresses</span></span> | <span data-ttu-id="67b3d-163">Адреса, присвоенные приложению</span><span class="sxs-lookup"><span data-stu-id="67b3d-163">App assigned addresses</span></span> | <span data-ttu-id="67b3d-164">Подсеть ASE: все порты</span><span class="sxs-lookup"><span data-stu-id="67b3d-164">ASE subnet: All ports</span></span>

<span data-ttu-id="67b3d-165">Hello входящий трафик предоставляет команды и управление ASE hello в мониторинге toosystem сложения.</span><span class="sxs-lookup"><span data-stu-id="67b3d-165">hello inbound traffic provides command and control of hello ASE in addition toosystem monitoring.</span></span> <span data-ttu-id="67b3d-166">Источник Hello IP-адресов для трафика, перечислены в hello [управления ASE адреса] [ ASEManagement] документа.</span><span class="sxs-lookup"><span data-stu-id="67b3d-166">hello source IPs for this traffic are listed in hello [ASE Management addresses][ASEManagement] document.</span></span> <span data-ttu-id="67b3d-167">Конфигурация сетевой безопасности Hello необходим доступ tooallow от всех IP-адресов через порты 454 и 455.</span><span class="sxs-lookup"><span data-stu-id="67b3d-167">hello network security configuration needs tooallow access from all IPs on ports 454 and 455.</span></span>

<span data-ttu-id="67b3d-168">В пределах hello ASE подсети, существует много порты, используемые для взаимодействия с внутренним компонентом, и они могут изменяться.</span><span class="sxs-lookup"><span data-stu-id="67b3d-168">Within hello ASE subnet there are many ports used for internal component communication and they can change.</span></span>  <span data-ttu-id="67b3d-169">Это необходимо, чтобы все порты hello hello ASE подсети toobe доступен из подсети ASE hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-169">This requires all of hello ports in hello ASE subnet toobe accessible from hello ASE subnet.</span></span> 

<span data-ttu-id="67b3d-170">Для взаимодействия hello балансировки нагрузки Azure hello и hello ASE подсети hello порты, открытые toobe необходимость являются 454 и 455 16001.</span><span class="sxs-lookup"><span data-stu-id="67b3d-170">For hello communication between hello Azure load balancer and hello ASE subnet hello minimum ports that need toobe open are 454, 455 and 16001.</span></span> <span data-ttu-id="67b3d-171">16001 порт Hello используется keep alive трафик между hello балансировки нагрузки и hello ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-171">hello 16001 port is used for keep alive traffic between hello load balancer and hello ASE.</span></span> <span data-ttu-id="67b3d-172">Если вы используете ILB ASE можно заблокировать трафик вниз toojust hello 454, 455, 16001 портов.</span><span class="sxs-lookup"><span data-stu-id="67b3d-172">If you are using an ILB ASE then you can lock traffic down toojust hello 454, 455, 16001 ports.</span></span>  <span data-ttu-id="67b3d-173">При использовании внешних ASE требуется tootake в порты доступа обычного приложения hello учетной записи.</span><span class="sxs-lookup"><span data-stu-id="67b3d-173">If you are using an External ASE then you need tootake into account hello normal app access ports.</span></span>  <span data-ttu-id="67b3d-174">Если вы используете приложение, назначенное адреса необходимо tooopen его tooall портов.</span><span class="sxs-lookup"><span data-stu-id="67b3d-174">If you are using app assigned addresses you need tooopen it tooall ports.</span></span>  <span data-ttu-id="67b3d-175">Если адрес назначается tooa определенное приложение, hello балансировки нагрузки будет использовать порты, которые не известны заранее toosend HTTP и HTTPS трафика toohello ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-175">When an address is assigned tooa specific app, then hello load balancer will use ports that are not known of in advance toosend HTTP and HTTPS traffic toohello ASE.</span></span>

<span data-ttu-id="67b3d-176">Если вы используете приложение, назначенное IP-адреса необходимо tooallow трафик от hello подсети ASE toohello приложений tooyour назначен IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="67b3d-176">If you are using app assigned IP addresses you need tooallow traffic from hello IPs assigned tooyour apps toohello ASE subnet.</span></span>

<span data-ttu-id="67b3d-177">Что касается доступа исходящего трафика, среда ASE зависит от различных внешних систем.</span><span class="sxs-lookup"><span data-stu-id="67b3d-177">For outbound access, an ASE depends on multiple external systems.</span></span> <span data-ttu-id="67b3d-178">Эти зависимости системы определяются с DNS-имена и не сопоставляйте tooa фиксированной набор IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="67b3d-178">Those system dependencies are defined with DNS names and don't map tooa fixed set of IP addresses.</span></span> <span data-ttu-id="67b3d-179">Таким образом, hello ASE требуется исходящий доступ из подсети tooall hello ASE внешние IP-адреса через различные порты.</span><span class="sxs-lookup"><span data-stu-id="67b3d-179">Thus, hello ASE requires outbound access from hello ASE subnet tooall external IPs across a variety of ports.</span></span> <span data-ttu-id="67b3d-180">ASE имеет следующие исходящие зависимости hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-180">An ASE has hello following outbound dependencies:</span></span>

| <span data-ttu-id="67b3d-181">Использование</span><span class="sxs-lookup"><span data-stu-id="67b3d-181">Use</span></span> | <span data-ttu-id="67b3d-182">Из</span><span class="sxs-lookup"><span data-stu-id="67b3d-182">From</span></span> | <span data-ttu-id="67b3d-183">слишком</span><span class="sxs-lookup"><span data-stu-id="67b3d-183">too</span></span>|
|-----|------|----|
| <span data-ttu-id="67b3d-184">Хранилище Azure</span><span class="sxs-lookup"><span data-stu-id="67b3d-184">Azure Storage</span></span> | <span data-ttu-id="67b3d-185">Подсеть ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-185">ASE subnet</span></span> | <span data-ttu-id="67b3d-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 необходим только для ASEv1)</span><span class="sxs-lookup"><span data-stu-id="67b3d-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 is only needed for ASEv1.)</span></span> |
| <span data-ttu-id="67b3d-187">База данных SQL Azure</span><span class="sxs-lookup"><span data-stu-id="67b3d-187">Azure SQL Database</span></span> | <span data-ttu-id="67b3d-188">Подсеть ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-188">ASE subnet</span></span> | <span data-ttu-id="67b3d-189">database.windows.net: 1433, 11000-11999, 14000-14999 (дополнительные сведения см. в статье об [использовании портов Базы данных SQL версии 12](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md))</span><span class="sxs-lookup"><span data-stu-id="67b3d-189">database.windows.net: 1433, 11000-11999, 14000-14999 (For more information, see [SQL Database V12 port usage](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).)</span></span>|
| <span data-ttu-id="67b3d-190">Управление Azure</span><span class="sxs-lookup"><span data-stu-id="67b3d-190">Azure management</span></span> | <span data-ttu-id="67b3d-191">Подсеть ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-191">ASE subnet</span></span> | <span data-ttu-id="67b3d-192">management.core.windows.net, management.azure.com: 443</span><span class="sxs-lookup"><span data-stu-id="67b3d-192">management.core.windows.net, management.azure.com: 443</span></span> 
| <span data-ttu-id="67b3d-193">Проверка сертификатов SSL</span><span class="sxs-lookup"><span data-stu-id="67b3d-193">SSL certificate verification</span></span> |  <span data-ttu-id="67b3d-194">Подсеть ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-194">ASE subnet</span></span>            |  <span data-ttu-id="67b3d-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span><span class="sxs-lookup"><span data-stu-id="67b3d-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span></span>
| <span data-ttu-id="67b3d-196">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="67b3d-196">Azure Active Directory</span></span>        | <span data-ttu-id="67b3d-197">Подсеть ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-197">ASE subnet</span></span>            |  <span data-ttu-id="67b3d-198">Интернет: 443</span><span class="sxs-lookup"><span data-stu-id="67b3d-198">Internet: 443</span></span>
| <span data-ttu-id="67b3d-199">Управление службой приложений</span><span class="sxs-lookup"><span data-stu-id="67b3d-199">App Service management</span></span>        | <span data-ttu-id="67b3d-200">Подсеть ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-200">ASE subnet</span></span>            |  <span data-ttu-id="67b3d-201">Интернет: 443</span><span class="sxs-lookup"><span data-stu-id="67b3d-201">Internet: 443</span></span>
| <span data-ttu-id="67b3d-202">Azure DNS</span><span class="sxs-lookup"><span data-stu-id="67b3d-202">Azure DNS</span></span>                     | <span data-ttu-id="67b3d-203">Подсеть ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-203">ASE subnet</span></span>            |  <span data-ttu-id="67b3d-204">Интернет: 53</span><span class="sxs-lookup"><span data-stu-id="67b3d-204">Internet: 53</span></span>
| <span data-ttu-id="67b3d-205">Внутренний обмен данными ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-205">ASE internal communication</span></span>    | <span data-ttu-id="67b3d-206">Подсеть ASE: все порты</span><span class="sxs-lookup"><span data-stu-id="67b3d-206">ASE subnet: All ports</span></span> |  <span data-ttu-id="67b3d-207">Подсеть ASE: все порты</span><span class="sxs-lookup"><span data-stu-id="67b3d-207">ASE subnet: All ports</span></span>

<span data-ttu-id="67b3d-208">Если hello ASE теряет доступ toothese зависимости, он перестает работать.</span><span class="sxs-lookup"><span data-stu-id="67b3d-208">If hello ASE loses access toothese dependencies, it stops working.</span></span> <span data-ttu-id="67b3d-209">Когда это происходит долго недостаточно, hello ASE приостанавливается.</span><span class="sxs-lookup"><span data-stu-id="67b3d-209">When that happens long enough, hello ASE is suspended.</span></span>

### <a name="customer-dns"></a><span data-ttu-id="67b3d-210">DNS пользователя</span><span class="sxs-lookup"><span data-stu-id="67b3d-210">Customer DNS</span></span> ###

<span data-ttu-id="67b3d-211">Если hello виртуальная сеть настроена на DNS-сервере, определяемых пользователем, рабочие нагрузки клиентов hello использовать ее.</span><span class="sxs-lookup"><span data-stu-id="67b3d-211">If hello VNet is configured with a customer-defined DNS server, hello tenant workloads use it.</span></span> <span data-ttu-id="67b3d-212">Hello ASE по-прежнему должен toocommunicate с помощью Azure DNS для целей управления.</span><span class="sxs-lookup"><span data-stu-id="67b3d-212">hello ASE still needs toocommunicate with Azure DNS for management purposes.</span></span> 

<span data-ttu-id="67b3d-213">Если hello виртуальная сеть настроена с клиента DNS на hello другом конце VPN-Подключение, hello DNS-сервер должен быть доступен из подсети hello, содержащей hello ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-213">If hello VNet is configured with a customer DNS on hello other side of a VPN, hello DNS server must be reachable from hello subnet that contains hello ASE.</span></span>

<a name="portaldep"></a>

## <a name="portal-dependencies"></a><span data-ttu-id="67b3d-214">Зависимости портала</span><span class="sxs-lookup"><span data-stu-id="67b3d-214">Portal dependencies</span></span> ##

<span data-ttu-id="67b3d-215">В дополнение toohello ASE функциональной зависимости существует несколько дополнительных элементов связанных toohello взаимодействие с порталом.</span><span class="sxs-lookup"><span data-stu-id="67b3d-215">In addition toohello ASE functional dependencies, there are a few extra items related toohello portal experience.</span></span> <span data-ttu-id="67b3d-216">Некоторые возможности hello в hello портал Azure зависят от site_ too_SCM прямой доступ.</span><span class="sxs-lookup"><span data-stu-id="67b3d-216">Some of hello capabilities in hello Azure portal depend on direct access too_SCM site_.</span></span> <span data-ttu-id="67b3d-217">Для каждого приложения в службе приложений Azure предусмотрено два URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="67b3d-217">For every app in Azure App Service, there are two URLs.</span></span> <span data-ttu-id="67b3d-218">Первый Hello URL-адрес является tooaccess приложения.</span><span class="sxs-lookup"><span data-stu-id="67b3d-218">hello first URL is tooaccess your app.</span></span> <span data-ttu-id="67b3d-219">Hello второй URL-адрес — tooaccess hello SCM сайта, которая также называется hello _Kudu консоли_.</span><span class="sxs-lookup"><span data-stu-id="67b3d-219">hello second URL is tooaccess hello SCM site, which is also called hello _Kudu console_.</span></span> <span data-ttu-id="67b3d-220">Функции, использующие hello SCM сайта:</span><span class="sxs-lookup"><span data-stu-id="67b3d-220">Features that use hello SCM site include:</span></span>

-   <span data-ttu-id="67b3d-221">Веб-задания</span><span class="sxs-lookup"><span data-stu-id="67b3d-221">Web jobs</span></span>
-   <span data-ttu-id="67b3d-222">Функции</span><span class="sxs-lookup"><span data-stu-id="67b3d-222">Functions</span></span>
-   <span data-ttu-id="67b3d-223">Потоковая передача журналов</span><span class="sxs-lookup"><span data-stu-id="67b3d-223">Log streaming</span></span>
-   <span data-ttu-id="67b3d-224">Kudu</span><span class="sxs-lookup"><span data-stu-id="67b3d-224">Kudu</span></span>
-   <span data-ttu-id="67b3d-225">расширения.</span><span class="sxs-lookup"><span data-stu-id="67b3d-225">Extensions</span></span>
-   <span data-ttu-id="67b3d-226">Обозреватель процессов</span><span class="sxs-lookup"><span data-stu-id="67b3d-226">Process Explorer</span></span>
-   <span data-ttu-id="67b3d-227">Консоль</span><span class="sxs-lookup"><span data-stu-id="67b3d-227">Console</span></span>

<span data-ttu-id="67b3d-228">При использовании ILB ASE hello SCM сайта не доступен вне hello виртуальной сети Интернет.</span><span class="sxs-lookup"><span data-stu-id="67b3d-228">When you use an ILB ASE, hello SCM site isn't internet accessible from outside hello VNet.</span></span> <span data-ttu-id="67b3d-229">Если приложение размещается на ILB ASE, некоторые возможности не будет работать с портала hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-229">When your app is hosted on an ILB ASE, some capabilities will not work from hello portal.</span></span>  

<span data-ttu-id="67b3d-230">Многие из этих возможностей, зависящих от hello SCM узла также доступны непосредственно в консоль Kudu hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-230">Many of those capabilities that depend upon hello SCM site are also available directly in hello Kudu console.</span></span> <span data-ttu-id="67b3d-231">Tooit можно подключиться напрямую, а не с помощью портала hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-231">You can connect tooit directly rather than by using hello portal.</span></span> <span data-ttu-id="67b3d-232">Если приложение размещается в ILB ASE, используйте вашей публикации toosign учетные данные в.</span><span class="sxs-lookup"><span data-stu-id="67b3d-232">If your app is hosted in an ILB ASE, use your publishing credentials toosign in.</span></span> <span data-ttu-id="67b3d-233">Hello URL-адрес tooaccess hello SCM сайт приложения, размещенного в ILB ASE имеет hello следующий формат:</span><span class="sxs-lookup"><span data-stu-id="67b3d-233">hello URL tooaccess hello SCM site of an app hosted in an ILB ASE has hello following format:</span></span> 

```
<appname>.scm.<domain name hello ILB ASE was created with> 
```

<span data-ttu-id="67b3d-234">Если ваш ASE ILB hello доменным именем *contoso.net* и имя вашего приложения — *testapp*, по достижении приложение hello *testapp.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="67b3d-234">If your ILB ASE is hello domain name *contoso.net* and your app name is *testapp*, hello app is reached at *testapp.contoso.net*.</span></span> <span data-ttu-id="67b3d-235">Hello SCM сайт, который перемещается вместе с ним достигается в *testapp.scm.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="67b3d-235">hello SCM site that goes with it is reached at *testapp.scm.contoso.net*.</span></span>

### <a name="functions-and-web-jobs"></a><span data-ttu-id="67b3d-236">Служба "Функции" и "Веб-задания"</span><span class="sxs-lookup"><span data-stu-id="67b3d-236">Functions and Web jobs</span></span> ###

<span data-ttu-id="67b3d-237">Функции и веб-задания, зависят от узла SCM hello, но поддерживаются для использования на портале hello, даже если приложений находятся в ILB ASE, при условии, что браузер может достигать hello SCM сайта.</span><span class="sxs-lookup"><span data-stu-id="67b3d-237">Both Functions and Web jobs depend on hello SCM site but are supported for use in hello portal, even if your apps are in an ILB ASE, so long as your browser can reach hello SCM site.</span></span>  <span data-ttu-id="67b3d-238">Если вы используете самозаверяющий сертификат с вашей ASE ILB, необходимо будет tooenable вашей tootrust браузера, сертификатов.</span><span class="sxs-lookup"><span data-stu-id="67b3d-238">If you are using a self-signed certificate with your ILB ASE, you will need tooenable your browser tootrust that certificate.</span></span>  <span data-ttu-id="67b3d-239">Для IE и границей, значит hello сертификат имеет toobe в компьютере доверия hello хранения.</span><span class="sxs-lookup"><span data-stu-id="67b3d-239">For IE and Edge that means hello certificate has toobe in hello computer trust store.</span></span>  <span data-ttu-id="67b3d-240">Если вы используете Chrome, то это означает, что вы приняли сертификат hello в браузере hello ранее предположительно щелчком hello scm сайта непосредственно.</span><span class="sxs-lookup"><span data-stu-id="67b3d-240">If you are using Chrome then that means you accepted hello certificate in hello browser earlier by presumably hitting hello scm site directly.</span></span>  <span data-ttu-id="67b3d-241">Hello наилучшим решением является toouse коммерческих сертификат, который находится в цепочки hello браузера.</span><span class="sxs-lookup"><span data-stu-id="67b3d-241">hello best solution is toouse a commercial certificate that is in hello browser chain of trust.</span></span>  

## <a name="ase-ip-addresses"></a><span data-ttu-id="67b3d-242">IP-адреса ASE</span><span class="sxs-lookup"><span data-stu-id="67b3d-242">ASE IP addresses</span></span> ##

<span data-ttu-id="67b3d-243">ASE имеет несколько toobe адресов IP, учитывать.</span><span class="sxs-lookup"><span data-stu-id="67b3d-243">An ASE has a few IP addresses toobe aware of.</span></span> <span data-ttu-id="67b3d-244">К ним относятся:</span><span class="sxs-lookup"><span data-stu-id="67b3d-244">They are:</span></span>

- <span data-ttu-id="67b3d-245">**Общедоступный IP-адрес для входящего трафика**. Используется для трафика приложений во внешней среде ASE и трафика управления в обоих средах (внешняя ASE и ASE с ILB).</span><span class="sxs-lookup"><span data-stu-id="67b3d-245">**Public inbound IP address**: Used for app traffic in an External ASE, and management traffic in both an External ASE and an ILB ASE.</span></span>
- <span data-ttu-id="67b3d-246">**Исходящие общедоступный IP-адрес**: использовать в качестве hello «с «IP-адреса для исходящие подключения из hello ASE, оставьте hello виртуальной сети, которых не направлено вниз VPN-Подключение.</span><span class="sxs-lookup"><span data-stu-id="67b3d-246">**Outbound public IP**: Used as hello "from" IP for outbound connections from hello ASE that leave hello VNet, which aren't routed down a VPN.</span></span>
- <span data-ttu-id="67b3d-247">**IP-адрес ILB**. Применяется при использовании среды ASE с ILB.</span><span class="sxs-lookup"><span data-stu-id="67b3d-247">**ILB IP address**: If you use an ILB ASE.</span></span>
- <span data-ttu-id="67b3d-248">**Присвоенные приложению адреса с SSL на основе IP**. Могут применяться, только если используется внешняя ASE и настроен SSL на основе IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="67b3d-248">**App-assigned IP-based SSL addresses**: Only possible with an External ASE and when IP-based SSL is configured.</span></span>

<span data-ttu-id="67b3d-249">Эти IP-адреса, легко отображаются в ASEv2 в hello портал Azure, из пользовательского интерфейса ASE hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-249">All these IP addresses are easily visible in an ASEv2 in hello Azure portal from hello ASE UI.</span></span> <span data-ttu-id="67b3d-250">Если у вас есть ILB ASE, перечисляется hello IP-адрес для hello ILB.</span><span class="sxs-lookup"><span data-stu-id="67b3d-250">If you have an ILB ASE, hello IP for hello ILB is listed.</span></span>

![IP-адреса;][3]

### <a name="app-assigned-ip-addresses"></a><span data-ttu-id="67b3d-252">Присвоенные приложению IP-адреса</span><span class="sxs-lookup"><span data-stu-id="67b3d-252">App-assigned IP addresses</span></span> ###

<span data-ttu-id="67b3d-253">Внешние ASE позволяет назначать IP-адреса tooindividual приложений.</span><span class="sxs-lookup"><span data-stu-id="67b3d-253">With an External ASE, you can assign IP addresses tooindividual apps.</span></span> <span data-ttu-id="67b3d-254">В ASE с ILB такая возможность не предусмотрена.</span><span class="sxs-lookup"><span data-stu-id="67b3d-254">You can't do that with an ILB ASE.</span></span> <span data-ttu-id="67b3d-255">Дополнительные сведения о том, как tooconfigure toohave вашего приложения собственный IP-адрес в разделе [привязать существующие пользовательские SSL сертификат tooAzure веб-приложения](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span><span class="sxs-lookup"><span data-stu-id="67b3d-255">For more information on how tooconfigure your app toohave its own IP address, see [Bind an existing custom SSL certificate tooAzure web apps](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span></span>

<span data-ttu-id="67b3d-256">Если приложение имеет собственный SSL на основе IP-адрес, hello ASE резервирует два порты toomap toothat IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="67b3d-256">When an app has its own IP-based SSL address, hello ASE reserves two ports toomap toothat IP address.</span></span> <span data-ttu-id="67b3d-257">Один порт для трафика HTTP, а hello другой порт для протокола HTTPS.</span><span class="sxs-lookup"><span data-stu-id="67b3d-257">One port is for HTTP traffic, and hello other port is for HTTPS.</span></span> <span data-ttu-id="67b3d-258">Порты, перечислены в hello ASE пользовательского интерфейса в hello IP-адреса разделе.</span><span class="sxs-lookup"><span data-stu-id="67b3d-258">Those ports are listed in hello ASE UI in hello IP addresses section.</span></span> <span data-ttu-id="67b3d-259">Трафик должен быть доступ tooreach порты из приложений hello или hello виртуальных IP-адресов недоступны.</span><span class="sxs-lookup"><span data-stu-id="67b3d-259">Traffic must be able tooreach those ports from hello VIP or hello apps are inaccessible.</span></span> <span data-ttu-id="67b3d-260">Это требование является важным tooremember при настройке группы безопасности сети (Nsg).</span><span class="sxs-lookup"><span data-stu-id="67b3d-260">This requirement is important tooremember when you configure Network Security Groups (NSGs).</span></span>

## <a name="network-security-groups"></a><span data-ttu-id="67b3d-261">группы сетевой безопасности;</span><span class="sxs-lookup"><span data-stu-id="67b3d-261">Network Security Groups</span></span> ##

<span data-ttu-id="67b3d-262">[Сетевых групп безопасности] [ NSGs] обеспечить hello возможность toocontrol сетевого доступа в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="67b3d-262">[Network Security Groups][NSGs] provide hello ability toocontrol network access within a VNet.</span></span> <span data-ttu-id="67b3d-263">При использовании портала hello, имеется неявный deny правила с наименьшим приоритетом toodeny hello все данные.</span><span class="sxs-lookup"><span data-stu-id="67b3d-263">When you use hello portal, there's an implicit deny rule at hello lowest priority toodeny everything.</span></span> <span data-ttu-id="67b3d-264">Поэтому необходимо создать правила разрешения.</span><span class="sxs-lookup"><span data-stu-id="67b3d-264">What you build are your allow rules.</span></span>

<span data-ttu-id="67b3d-265">В ASE у вас нет доступа toohello использовать виртуальные машины toohost hello ASE сам.</span><span class="sxs-lookup"><span data-stu-id="67b3d-265">In an ASE, you don't have access toohello VMs used toohost hello ASE itself.</span></span> <span data-ttu-id="67b3d-266">Они входят в подписку, управляемую корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="67b3d-266">They're in a Microsoft-managed subscription.</span></span> <span data-ttu-id="67b3d-267">Toorestrict доступа toohello приложений на hello ASE, установите Nsg из подсети ASE hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-267">If you want toorestrict access toohello apps on hello ASE, set NSGs on hello ASE subnet.</span></span> <span data-ttu-id="67b3d-268">При этом Обратите пристальное внимание toohello ASE зависимости.</span><span class="sxs-lookup"><span data-stu-id="67b3d-268">In doing so, pay careful attention toohello ASE dependencies.</span></span> <span data-ttu-id="67b3d-269">Блокирование всех зависимостей hello ASE перестает работать.</span><span class="sxs-lookup"><span data-stu-id="67b3d-269">If you block any dependencies, hello ASE stops working.</span></span>

<span data-ttu-id="67b3d-270">Nsg можно настроить через портал Azure hello или с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="67b3d-270">NSGs can be configured through hello Azure portal or via PowerShell.</span></span> <span data-ttu-id="67b3d-271">здесь сведения Hello показывает hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="67b3d-271">hello information here shows hello Azure portal.</span></span> <span data-ttu-id="67b3d-272">Для создания и управления Nsg hello портале как ресурс верхнего уровня под **сети**.</span><span class="sxs-lookup"><span data-stu-id="67b3d-272">You create and manage NSGs in hello portal as a top-level resource under **Networking**.</span></span>

<span data-ttu-id="67b3d-273">После hello входящий и исходящий требования учитываются, hello Nsg должна выглядеть примерно toohello Nsg, показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="67b3d-273">When hello inbound and outbound requirements are taken into account, hello NSGs should look similar toohello NSGs shown in this example.</span></span> <span data-ttu-id="67b3d-274">Hello диапазон адресов виртуальной сети является _192.168.250.0/16_, и подсеть hello, hello ASE _192.168.251.128/25_.</span><span class="sxs-lookup"><span data-stu-id="67b3d-274">hello VNet address range is _192.168.250.0/16_, and hello subnet that hello ASE is in is _192.168.251.128/25_.</span></span>

<span data-ttu-id="67b3d-275">hello верхней части списка hello в этом примере показаны Hello первых двух входящих требования к hello ASE toofunction.</span><span class="sxs-lookup"><span data-stu-id="67b3d-275">hello first two inbound requirements for hello ASE toofunction are shown at hello top of hello list in this example.</span></span> <span data-ttu-id="67b3d-276">Они включить управление ASE и позволяют toocommunicate ASE hello с самим собой.</span><span class="sxs-lookup"><span data-stu-id="67b3d-276">They enable ASE management and allow hello ASE toocommunicate with itself.</span></span> <span data-ttu-id="67b3d-277">Hello другие записи всех клиента можно настроить и может управлять сетевого доступа toohello ASE-приложений.</span><span class="sxs-lookup"><span data-stu-id="67b3d-277">hello other entries are all tenant configurable and can govern network access toohello ASE-hosted applications.</span></span> 

![Правила безопасности для входящего трафика][4]

<span data-ttu-id="67b3d-279">Правило по умолчанию включает hello IP-адресов в подсети, ASE toohello tootalk hello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="67b3d-279">A default rule enables hello IPs in hello VNet tootalk toohello ASE subnet.</span></span> <span data-ttu-id="67b3d-280">Другое правило по умолчанию включает hello балансировки нагрузки, также известные как общедоступный VIP hello, toocommunicate с hello ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-280">Another default rule enables hello load balancer, also known as hello public VIP, toocommunicate with hello ASE.</span></span> <span data-ttu-id="67b3d-281">Выберите правила по умолчанию hello toosee, **по умолчанию правила** Далее toohello **добавить** значок.</span><span class="sxs-lookup"><span data-stu-id="67b3d-281">toosee hello default rules, select **Default rules** next toohello **Add** icon.</span></span> <span data-ttu-id="67b3d-282">Если поместить все остальные правила после hello NSG правила показано deny, можно предотвратить передачу трафика между hello виртуальных IP-адресов и hello ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-282">If you put a deny everything else rule after hello NSG rules shown, you prevent traffic between hello VIP and hello ASE.</span></span> <span data-ttu-id="67b3d-283">tooprevent трафик, поступающий из hello виртуальной сети, добавьте в пределах tooallow собственные правила входящего трафика.</span><span class="sxs-lookup"><span data-stu-id="67b3d-283">tooprevent traffic coming from inside hello VNet, add your own rule tooallow inbound.</span></span> <span data-ttu-id="67b3d-284">Использовать tooAzureLoadBalancer равно источника с адресом назначения **любой** и диапазон портов  **\*** .</span><span class="sxs-lookup"><span data-stu-id="67b3d-284">Use a source equal tooAzureLoadBalancer with a destination of **Any** and a port range of **\***.</span></span> <span data-ttu-id="67b3d-285">Поскольку правило NSG hello примененных toohello ASE подсети, не требуется определенного toobe в конечном hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-285">Because hello NSG rule is applied toohello ASE subnet, you don't need toobe specific in hello destination.</span></span>

<span data-ttu-id="67b3d-286">Если для назначения приложения tooyour IP адрес, убедитесь, что обеспечили hello необходимые порты.</span><span class="sxs-lookup"><span data-stu-id="67b3d-286">If you assigned an IP address tooyour app, make sure you keep hello ports open.</span></span> <span data-ttu-id="67b3d-287">Выберите порты toosee hello, **среды службы приложений** > **IP-адреса**.</span><span class="sxs-lookup"><span data-stu-id="67b3d-287">toosee hello ports, select **App Service Environment** > **IP addresses**.</span></span>  

<span data-ttu-id="67b3d-288">Требуются все hello пунктов в hello следующие правила для исходящих подключений, за исключением последнего элемента hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-288">All hello items shown in hello following outbound rules are needed, except for hello last item.</span></span> <span data-ttu-id="67b3d-289">Они позволяют зависимости ASE toohello доступа к сети, записанные ранее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="67b3d-289">They enable network access toohello ASE dependencies that were noted earlier in this article.</span></span> <span data-ttu-id="67b3d-290">При блокировке любого из этих элементов ASE прекратит работу.</span><span class="sxs-lookup"><span data-stu-id="67b3d-290">If you block any of them, your ASE stops working.</span></span> <span data-ttu-id="67b3d-291">Hello последнего элемента в списке hello позволяет вашей ASE toocommunicate с другими ресурсами в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="67b3d-291">hello last item in hello list enables your ASE toocommunicate with other resources in your VNet.</span></span>

![Правила безопасности для исходящего трафика][5]

<span data-ttu-id="67b3d-293">После определения Nsg назначьте их toohello подсети, к ASE на.</span><span class="sxs-lookup"><span data-stu-id="67b3d-293">After your NSGs are defined, assign them toohello subnet that your ASE is on.</span></span> <span data-ttu-id="67b3d-294">Если вы не помните hello ASE виртуальную сеть или подсеть, найдите его с портала управления ASE hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-294">If you don’t remember hello ASE VNet or subnet, you can see it from hello ASE management portal.</span></span> <span data-ttu-id="67b3d-295">tooassign hello подсети tooyour NSG, go toohello подсети пользовательского интерфейса и выберите hello NSG.</span><span class="sxs-lookup"><span data-stu-id="67b3d-295">tooassign hello NSG tooyour subnet, go toohello subnet UI and select hello NSG.</span></span>

## <a name="routes"></a><span data-ttu-id="67b3d-296">Маршруты</span><span class="sxs-lookup"><span data-stu-id="67b3d-296">Routes</span></span> ##

<span data-ttu-id="67b3d-297">При настройке виртуальной сети с помощью Azure ExpressRoute маршрутизация зачастую сопровождается проблемами.</span><span class="sxs-lookup"><span data-stu-id="67b3d-297">Routes become problematic most commonly when you configure your VNet with Azure ExpressRoute.</span></span> <span data-ttu-id="67b3d-298">В виртуальной сети существует три типа маршрутов:</span><span class="sxs-lookup"><span data-stu-id="67b3d-298">There are three types of routes in a VNet:</span></span>

-   <span data-ttu-id="67b3d-299">Системные маршруты</span><span class="sxs-lookup"><span data-stu-id="67b3d-299">System routes</span></span>
-   <span data-ttu-id="67b3d-300">Маршруты BGP</span><span class="sxs-lookup"><span data-stu-id="67b3d-300">BGP routes</span></span>
-   <span data-ttu-id="67b3d-301">Определяемые пользователем маршруты</span><span class="sxs-lookup"><span data-stu-id="67b3d-301">User-defined routes (UDRs)</span></span>

<span data-ttu-id="67b3d-302">Маршруты BGP переопределяют системные маршруты.</span><span class="sxs-lookup"><span data-stu-id="67b3d-302">BGP routes override system routes.</span></span> <span data-ttu-id="67b3d-303">Определяемые пользователем маршруты переопределяют маршруты BGP.</span><span class="sxs-lookup"><span data-stu-id="67b3d-303">UDRs override BGP routes.</span></span> <span data-ttu-id="67b3d-304">Дополнительные сведения о маршрутах в виртуальных сетях Azure см. в статье [Определяемые пользователем маршруты и IP-пересылка][UDRs].</span><span class="sxs-lookup"><span data-stu-id="67b3d-304">For more information about routes in Azure virtual networks, see [User-defined routes overview][UDRs].</span></span>

<span data-ttu-id="67b3d-305">Hello базы данных Azure SQL, hello ASE использует систему hello toomanage оснащен брандмауэром.</span><span class="sxs-lookup"><span data-stu-id="67b3d-305">hello Azure SQL database that hello ASE uses toomanage hello system has a firewall.</span></span> <span data-ttu-id="67b3d-306">Он требует toooriginate связи из hello ASE общедоступный VIP-адрес.</span><span class="sxs-lookup"><span data-stu-id="67b3d-306">It requires communication toooriginate from hello ASE public VIP.</span></span> <span data-ttu-id="67b3d-307">Базы данных SQL toohello подключений из hello ASE будут отклонены, если они отправляются вниз hello подключение ExpressRoute и другой IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="67b3d-307">Connections toohello SQL database from hello ASE will be denied if they are sent down hello ExpressRoute connection and out another IP address.</span></span>

<span data-ttu-id="67b3d-308">Отправки запросов управления tooincoming ответов вниз hello ExpressRoute hello обратный адрес отличается от hello исходное расположение.</span><span class="sxs-lookup"><span data-stu-id="67b3d-308">If replies tooincoming management requests are sent down hello ExpressRoute, hello reply address is different than hello original destination.</span></span> <span data-ttu-id="67b3d-309">Это несоответствие разрывает связь по протоколу TCP hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-309">This mismatch breaks hello TCP communication.</span></span>

<span data-ttu-id="67b3d-310">Для вашего toowork ASE пока виртуальная сеть настроена с ExpressRoute, является простым самое toodo hello:</span><span class="sxs-lookup"><span data-stu-id="67b3d-310">For your ASE toowork while your VNet is configured with an ExpressRoute, hello easiest thing toodo is:</span></span>

-   <span data-ttu-id="67b3d-311">Настройка ExpressRoute tooadvertise _0.0.0.0/0_.</span><span class="sxs-lookup"><span data-stu-id="67b3d-311">Configure ExpressRoute tooadvertise _0.0.0.0/0_.</span></span> <span data-ttu-id="67b3d-312">Это по умолчанию приведет к принудительному туннелированию всего исходящего трафика в локальную среду.</span><span class="sxs-lookup"><span data-stu-id="67b3d-312">By default, it force tunnels all outbound traffic on-premises.</span></span>
-   <span data-ttu-id="67b3d-313">Создайте определяемый пользователем маршрут.</span><span class="sxs-lookup"><span data-stu-id="67b3d-313">Create a UDR.</span></span> <span data-ttu-id="67b3d-314">Применить его toohello подсети, содержащей ASE hello с префикс адреса _0.0.0.0/0_ и тип из следующего прыжка _Internet_.</span><span class="sxs-lookup"><span data-stu-id="67b3d-314">Apply it toohello subnet that contains hello ASE with an address prefix of _0.0.0.0/0_ and a next hop type of _Internet_.</span></span>

<span data-ttu-id="67b3d-315">Если эти два изменения предназначенные Интернет трафик, отправленный из подсети ASE hello не принудительно вниз hello ExpressRoute и hello ASE работает.</span><span class="sxs-lookup"><span data-stu-id="67b3d-315">If you make these two changes, internet-destined traffic that originates from hello ASE subnet isn't forced down hello ExpressRoute and hello ASE works.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="67b3d-316">Hello маршрутов, указанных в UDR должна быть достаточно точным, tootake приоритет через все маршруты, объявленные hello ExpressRoute конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="67b3d-316">hello routes defined in a UDR must be specific enough tootake precedence over any routes advertised by hello ExpressRoute configuration.</span></span> <span data-ttu-id="67b3d-317">Hello в предыдущем примере диапазон адресов широкий 0.0.0.0/0 hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-317">hello preceding example uses hello broad 0.0.0.0/0 address range.</span></span> <span data-ttu-id="67b3d-318">Он может быть случайно заменен объявлениями маршрутов с более узкими диапазонами адресов.</span><span class="sxs-lookup"><span data-stu-id="67b3d-318">It can potentially be accidentally overridden by route advertisements that use more specific address ranges.</span></span>
>
> <span data-ttu-id="67b3d-319">ASEs не поддерживаются с ExpressRoute конфигурациями, которые кросс объявлять маршруты из hello общедоступного пиринга toohello пиринг закрытый путь.</span><span class="sxs-lookup"><span data-stu-id="67b3d-319">ASEs aren't supported with ExpressRoute configurations that cross-advertise routes from hello public-peering path toohello private-peering path.</span></span> <span data-ttu-id="67b3d-320">Конфигурации ExpressRoute с настроенным общедоступным пирингом получают объявления маршрутов от корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="67b3d-320">ExpressRoute configurations with public peering configured receive route advertisements from Microsoft.</span></span> <span data-ttu-id="67b3d-321">объявления Hello содержит большой набор Microsoft Azure диапазонов адресов.</span><span class="sxs-lookup"><span data-stu-id="67b3d-321">hello advertisements contain a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="67b3d-322">Диапазоны адресов hello, объявленных между hello пиринг частного пути всех исходящих сетевых пакетов из подсети hello в ASE, Принудительное туннелирование tooa клиента в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="67b3d-322">If hello address ranges are cross-advertised on hello private-peering path, all outbound network packets from hello ASE's subnet are force tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="67b3d-323">В настоящее время этот сетевой поток не поддерживается в средах ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-323">This network flow is currently not supported with ASEs.</span></span> <span data-ttu-id="67b3d-324">Одна проблема toothis решение — toostop маршруты между рекламу от hello общедоступного пиринга toohello пиринг закрытый путь.</span><span class="sxs-lookup"><span data-stu-id="67b3d-324">One solution toothis problem is toostop cross-advertising routes from hello public-peering path toohello private-peering path.</span></span>

<span data-ttu-id="67b3d-325">toocreate UDR, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="67b3d-325">toocreate a UDR, follow these steps:</span></span>

1. <span data-ttu-id="67b3d-326">Go toohello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="67b3d-326">Go toohello Azure portal.</span></span> <span data-ttu-id="67b3d-327">Последовательно выберите **Cети** > **Таблицы маршрутов**.</span><span class="sxs-lookup"><span data-stu-id="67b3d-327">Select **Networking** > **Route Tables**.</span></span>

2. <span data-ttu-id="67b3d-328">Создать новую таблицу маршрутов в hello же регионе, что виртуальная сеть.</span><span class="sxs-lookup"><span data-stu-id="67b3d-328">Create a new route table in hello same region as your VNet.</span></span>

3. <span data-ttu-id="67b3d-329">В пользовательском интерфейсе таблицы маршрутов последовательно выберите **Маршруты** > **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="67b3d-329">From within your route table UI, select **Routes** > **Add**.</span></span>

4. <span data-ttu-id="67b3d-330">Набор hello **тип следующего прыжка** слишком**Internet** и hello **префикс адреса** слишком**0.0.0.0/0**.</span><span class="sxs-lookup"><span data-stu-id="67b3d-330">Set hello **Next hop type** too**Internet** and hello **Address prefix** too**0.0.0.0/0**.</span></span> <span data-ttu-id="67b3d-331">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="67b3d-331">Select **Save**.</span></span>

    <span data-ttu-id="67b3d-332">После этого отображается примерно hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="67b3d-332">You then see something like hello following:</span></span>

    ![Функциональные маршруты][6]

5. <span data-ttu-id="67b3d-334">После создания новой таблицы маршрутов hello перейдите toohello подсети, которая содержит ваш ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-334">After you create hello new route table, go toohello subnet that contains your ASE.</span></span> <span data-ttu-id="67b3d-335">Выберите таблицы маршрутизации из списка hello в портале hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-335">Select your route table from hello list in hello portal.</span></span> <span data-ttu-id="67b3d-336">После сохранения изменений hello, затем появится Nsg hello и маршрутов, указанных с подсети.</span><span class="sxs-lookup"><span data-stu-id="67b3d-336">After you save hello change, you should then see hello NSGs and routes noted with your subnet.</span></span>

    ![Группы безопасности сети и маршруты][7]

### <a name="deploy-into-existing-azure-virtual-networks-that-are-integrated-with-expressroute"></a><span data-ttu-id="67b3d-338">Развертывание в существующих виртуальных сетях Azure, интегрированных с ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="67b3d-338">Deploy into existing Azure virtual networks that are integrated with ExpressRoute</span></span> ###

<span data-ttu-id="67b3d-339">toodeploy вашей ASE в виртуальную сеть, интегрированных с ExpressRoute, предварительной настройки hello подсети, где требуется развернуть ASE hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-339">toodeploy your ASE into a VNet that's integrated with ExpressRoute, preconfigure hello subnet where you want hello ASE deployed.</span></span> <span data-ttu-id="67b3d-340">Затем с помощью шаблона диспетчера ресурсов toodeploy его.</span><span class="sxs-lookup"><span data-stu-id="67b3d-340">Then use a Resource Manager template toodeploy it.</span></span> <span data-ttu-id="67b3d-341">toocreate ASE в виртуальной сети, где уже есть настроен ExpressRoute:</span><span class="sxs-lookup"><span data-stu-id="67b3d-341">toocreate an ASE in a VNet that already has ExpressRoute configured:</span></span>

- <span data-ttu-id="67b3d-342">Создание подсети toohost hello ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-342">Create a subnet toohost hello ASE.</span></span>

    > [!NOTE]
    > <span data-ttu-id="67b3d-343">Никаких других могут находиться в подсети hello, но hello ASE.</span><span class="sxs-lookup"><span data-stu-id="67b3d-343">Nothing else can be in hello subnet but hello ASE.</span></span> <span data-ttu-id="67b3d-344">Быть toochoose убедиться, что адресное пространство, позволяющий роста в будущем.</span><span class="sxs-lookup"><span data-stu-id="67b3d-344">Be sure toochoose an address space that allows for future growth.</span></span> <span data-ttu-id="67b3d-345">Впоследствии этот параметр уже нельзя изменить.</span><span class="sxs-lookup"><span data-stu-id="67b3d-345">You can't change this setting later.</span></span> <span data-ttu-id="67b3d-346">Рекомендуемый размер — `/25` с 128 адресами.</span><span class="sxs-lookup"><span data-stu-id="67b3d-346">We recommend a size of `/25` with 128 addresses.</span></span>

- <span data-ttu-id="67b3d-347">Создание UDRs (например, таблицы маршрутов), как описано выше, а также задать в подсети hello.</span><span class="sxs-lookup"><span data-stu-id="67b3d-347">Create UDRs (for example, route tables) as described earlier, and set that on hello subnet.</span></span>
- <span data-ttu-id="67b3d-348">Создание с помощью шаблона диспетчера ресурсов, как описано в hello ASE [создать с помощью шаблона диспетчера ресурсов ASE][MakeASEfromTemplate].</span><span class="sxs-lookup"><span data-stu-id="67b3d-348">Create hello ASE by using a Resource Manager template as described in [Create an ASE by using a Resource Manager template][MakeASEfromTemplate].</span></span>

<!--Image references-->
[1]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow.png
[2]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow2.png
[3]: ./media/network_considerations_with_an_app_service_environment/networkase-ipaddresses.png
[4]: ./media/network_considerations_with_an_app_service_environment/networkase-inboundnsg.png
[5]: ./media/network_considerations_with_an_app_service_environment/networkase-outboundnsg.png
[6]: ./media/network_considerations_with_an_app_service_environment/networkase-udr.png
[7]: ./media/network_considerations_with_an_app_service_environment/networkase-subnet.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ASEManagement]: ./management-addresses.md
