---
title: "Экспорт размещенного в Azure API в PowerApps и Microsoft Flow | Документация Майкрософт"
description: "Общие сведения о предоставлении API, размещенного в службе приложений, для PowerApps и Microsoft Flow"
services: app-service
documentationcenter: 
author: mattchenderson
manager: erikre
editor: 
ms.assetid: 
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 06/20/2017
ms.author: mahender
ms.openlocfilehash: 0d166a2e5b60c3b9f911f9fc3ad49ad7f252abb4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="exporting-an-azure-hosted-api-to-powerapps-and-microsoft-flow"></a>Экспорт размещенного в Azure API в PowerApps и Microsoft Flow

## <a name="creating-custom-connectors-for-powerapps-and-microsoft-flow"></a>Создание настраиваемых соединителей для PowerApps и Microsoft Flow

[PowerApps](https://powerapps.com) — это служба для создания и использования пользовательских бизнес-приложений, которые подключаются к данным и работают на различных платформах. [Microsoft Flow](https://flow.microsoft.com) позволяет легко автоматизировать рабочие и бизнес-процессы между избранными приложениями и службами. PowerApps и Microsoft Flow содержат ряд встроенных соединителей для источников данных, таких как Office 365, Dynamics 365, Salesforce и т д. Тем не менее пользователи также должны иметь возможность использовать источники данных и API, созданные в их организации.

Аналогичным образом разработчикам, которым необходимо расширить возможности совместного использования API внутри организации, может потребоваться предоставить доступ к своим API пользователям PowerApps и Microsoft Flow. В этой статье показано, как предоставить API, созданный с помощью службы приложений Azure или Функций Azure, для PowerApps и Microsoft Flow. [Служба приложений Azure](https://azure.microsoft.com/services/app-service/) — это предложение "платформа как услуга", которое позволяет разработчикам быстро и легко создавать корпоративные мобильные, веб-приложения и приложения API. [Функции Azure](https://azure.microsoft.com/services/functions/) — это независимое от сервера решение для вычислений на основе событий, позволяющее быстро создавать код, который может реагировать на другие части системы и масштабироваться по запросу.

Дополнительные сведения об этих службах см. в следующих статьях:
- [Guided Learning for PowerApps](https://powerapps.microsoft.com/guided-learning/learning-introducing-powerapps/) (Пошаговое изучение PowerApps) 
- [Интерактивное обучение Microsoft Flow](https://flow.microsoft.com/guided-learning/learning-introducing-flow/)
- [Что такое служба приложений?](https://docs.microsoft.com/azure/app-service/app-service-value-prop-what-is)
- [Обзор функций Azure](https://docs.microsoft.com/azure/azure-functions/functions-overview)

## <a name="sharing-an-api-definition"></a>Предоставление общего доступа к определению API

Интерфейсы API часто описываются с помощью [документа OpenAPI](https://www.openapis.org/) (иногда называемого документом Swagger). Он содержит все сведения о доступных операциях и о том, как необходимо структурировать данные. С помощью PowerApps и Microsoft Flow можно создавать настраиваемые соединители для любого документа OpenAPI 2.0. После создания настраиваемого соединителя его можно использовать точно так же, как один из встроенных соединителей, и быстро интегрировать в приложение.

Служба приложений Azure и Функции Azure имеют [встроенную поддержку](https://docs.microsoft.com/azure/app-service-api/app-service-api-metadata) создания и размещения документа OpenAPI, а также управления им. Чтобы создать настраиваемый соединитель для приложения-функции, приложения API, веб- или мобильных приложений PowerApps и Flow необходимо предоставить копию определения.

> [!NOTE]
> Так как используется копия определения API, PowerApps и Microsoft Flow не будут немедленно уведомлены об обновлениях или критических изменениях приложения. При появлении новой версии API эти шаги необходимо выполнить для новой версии. 

Чтобы предоставить PowerApps и Microsoft Flow определение размещенного API для вашего приложения, выполните следующие действия:

1. Откройте [портал Azure](https://portal.azure.com) и перейдите к службе приложений или приложению Функций Azure.

    При использовании службы приложений Azure в списке параметров выберите **Определение API**. 
    
    При использовании Функции Azure, щелкните приложение-функцию и выберите **Platform features** (Функции платформы), а затем — **Определение API**. Вместо этого также можно открыть вкладку **API definition (preview)** (Определение API (предварительная версия)).

2. Если определение API было предоставлено, вы увидите кнопку **Export to PowerApps + Microsoft Flow** (Экспорт в PowerApps + Microsoft Flow). Нажмите эту кнопку, чтобы начать процесс экспорта.

3. Выберите **Режим экспорта**. Это определяет, какие действия необходимо выполнить для создания соединителя. Службы приложений предлагают два варианта предоставления PowerApps и Microsoft Flow с определением API:

    **Экспресс**: позволяет создавать пользовательский соединитель в портале Azure. Для этого требуется, чтобы текущий вошедший в систему пользователь имел разрешение на создание соединителей в целевой среде. Это рекомендуемый вариант, если это требование может быть выполнено. При использовании этого режима следуйте инструкциям, приведенным в разделе [Экспресс экспорт](#express) ниже.

    **Вручную**: позволяет экспортировать копию определения API, которую можно импортировать с помощью порталов PowerApps или Microsoft Flow. Это рекомендуемый вариант, если пользователь Azure и пользователь с разрешением на создание соединителей — это разные пользователи или соединитель необходимо создать в другом клиенте. При использовании этого режима, следуйте инструкциям, приведенным в разделе [Экспорт и импорт вручную](#manual) ниже.

<a name="express"></a>
## <a name="express-export"></a>Экспресс экспорт

В этом разделе вы создадите настраиваемый соединитель в портале Azure. Необходимо войти в клиент, куда вы хотите произвести экспорт и обладать разрешением на создание настраиваемого соединителя в целевой среде.

1. Выберите среду, в которой вы хотите создать соединитель. Затем введите имя для вашего настраиваемого соединителя.

2. Если определение API содержит какие-либо параметры безопасности, они будут вызваны на шаге 2. При необходимости предоставьте сведения о конфигурации системы безопасности, необходимые для предоставления пользователям доступа к вашему API. Дополнительные сведения см. в разделе [Проверка подлинности](#auth) ниже. 

3. Щелкните **ОК** для создания настраиваемого соединителя.


<a name="manual"></a>
## <a name="manual-export-and-import"></a>Экспорт и импорт вручную

Чтобы создать настраиваемый соединитель для приложения-функции, приложения API, веб- или мобильных приложений, требуются два этапа:

1. [Получение определения API из службы приложений или Функций Azure.](#export)
2. [Импорт определения API в PowerApps и Microsoft Flow](#import)

Возможно эти два шага придется выполнить разным сотрудникам организации, так как у определенного пользователя может отсутствовать разрешение на выполнение обоих действий. В таком случае разработчик, имеющий доступ с правами участника к службе приложений или к приложению Функций Azure, должен получить определение API (JSON-файл) или ссылку на него. Они понадобятся, чтобы предоставить это определение владельцу PowerApps или Microsoft Flow. Владелец может использовать эти метаданные для создания настраиваемого соединителя.

<a name="export"></a>
### <a name="retrieving-the-api-definition-from-app-service-or-azure-functions"></a>Получение определения API из службы приложений или Функций Azure

В этом разделе вы экспортируете определение API для API службы приложений для последующего использования в PowerApps или Microsoft Flow.

1. Вы можете выбрать **Download the API definition** (Скачать определение API) или **Получить ссылку**. Независимо от выбранного варианта результат будет предоставлен в следующем разделе. Выберите один из этих вариантов и следуйте инструкциям.
 
2. Если определение API содержит какие-либо параметры безопасности, они будут вызваны на шаге 2. Во время импорта PowerApps и Microsoft Flow обнаружат их и предложат ввести сведения о безопасности. Получите учетные данные, связанные с определениями. Они понадобятся в следующем разделе. Дополнительные сведения см. в разделе [Проверка подлинности](#auth) ниже. 

<a name="import"></a>
### <a name="importing-the-api-definition-into-powerapps-and-microsoft-flow"></a>Импорт определения API в PowerApps и Microsoft Flow

В этом разделе вы создадите настраиваемый соединитель в PowerApps и Microsoft Flow с помощью определения API, полученного ранее. Настраиваемые соединители совместно используются двумя службами, поэтому импортировать определение необходимо один раз. Дополнительные сведения о настраиваемых соединителях см. в статьях [Регистрация и использование настраиваемых соединителей в PowerApps] и [Регистрация и использование настраиваемых соединителей в Microsoft Flow].

1. Откройте [веб-портал PowerApps](https://web.powerapps.com) или [веб-портал Microsoft Flowl](https://flow.microsoft.com/) и выполните вход. 

2. Нажмите кнопку **Параметры** (значок шестеренки), расположенную в правом верхнем углу страницы, и выберите **Настраиваемые соединители**. 

3. Щелкните **Создать настраиваемый соединитель**.

4. На вкладке **Общие** укажите имя API, а затем передайте определение OpenAPI или вставьте URL-адрес метаданных. Нажмите кнопку **Продолжить**.

4. Если появится запрос на предоставление сведений о проверке подлинности, на вкладке **Общие** введите значения, полученные в предыдущем разделе. В противном случае перейдите к следующему шагу.

5. На вкладке **Определения** все операции, определенные в файле OpenAPI, заполняются автоматически. Если определены все необходимые операции, можно перейти к следующему шагу. Если нет, вы можете добавить и изменить операции здесь.

6. Нажмите кнопку **Создать соединитель**. Если вы хотите протестировать вызовы API, перейдите к следующему шагу.

7. На вкладке **Тестирование** создайте подключение, выберите операцию для тестирования и введите данные, которые требуются для операции.

8. Нажмите кнопку **Тестировать операцию**.


<a name="auth"></a>
## <a name="authentication"></a>Аутентификация

PowerApps и Microsoft Flow имеют встроенную поддержку коллекции поставщиков удостоверений, которые можно использовать для входа пользователей настраиваемого соединителя. Если для API требуется проверка подлинности, это определение должно быть записано в виде _определения безопасности_ в документе OpenAPI. Во время экспорта необходимо предоставить значения конфигурации, позволяющие PowerApps и Microsoft Flow выполнять действия входа.

В этом разделе описаны типы проверки подлинности, поддерживаемые потоком экспресс: ключ API, Azure Active Directory и универсальная OAuth 2.0. Дополнительные сведения о полном списке поставщиков и учетных данных, которые им необходимы см. в статьях [Регистрация и использование настраиваемых соединителей в PowerApps] и [Регистрация и использование настраиваемых соединителей в Microsoft Flow].

### <a name="api-key"></a>Ключ API
При использовании этой схемы безопасности, пользователям соединителя будет предложено указать ключ при создании подключения. Вы можете предоставить имя ключа API, чтобы помочь им понять, какой ключ нужен. Для Функций Azure это, как правило, один из ключей узла, охватывающий несколько функций внутри приложения-функции.

### <a name="azure-active-directory"></a>Azure Active Directory
При настройке настраиваемого соединителя, требующего входа в AAD, требуется две регистрации в приложении AAD: одна для моделирования API серверной части, а вторая — для соединителя в PowerApps и Flow.

API должен быть настроен для работы с первой регистрацией. При использовании функции [проверки подлинности и авторизации в службе приложений](https://docs.microsoft.com/azure/app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication) это уже будет сделано.

Вам потребуется вручную создать вторую регистрацию для соединителя, используя шаги, приведенные в разделе [Добавление приложения](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications#adding-an-application). Регистрации требуется делегированный доступ к вашему API и URL-адресу ответа из `https://msmanaged-na.consent.azure-apim.net/redirect`. Дополнительные сведения см. в [этой статье](
https://powerapps.microsoft.com/tutorials/customapi-azure-resource-manager-tutorial/). Вместо Azure Resource Manager здесь нужно использовать API.

Требуются следующие значения конфигурации:
- **Идентификатор клиента**: идентификатор клиента регистрации соединителя AAD.
- **Секрет клиента**: секрет клиента регистрации соединителя AAD.
- **Login URL** (URL-адрес входа): базовый URL-адрес для AAD. В общедоступной версии Azure это, как правило, будет `https://login.windows.net`.
- **Идентификатор клиента**: идентификатор клиента, используемый для входа. Он должен быть "общим" или идентификатором клиента, в котором создается соединитель.
- **URL-адрес ресурса**: URL-адрес ресурса регистрации AAD серверной части API.

> [!IMPORTANT]
> Если импортировать определение API в PowerApps и Microsoft Flow в качестве ручного потока будет другой пользователь, помимо файла определения API предоставьте ему идентификатор и секрет клиента **регистрации соединителя**. Обеспечьте безопасное управление этими секретами. **Не предоставляйте учетные данные безопасности самого API.**

### <a name="generic-oauth-20"></a>Универсальная OAuth 2.0
Универсальная OAuth 2.0 позволяет интегрироваться с любыми поставщиками OAuth 2.0. Это позволяет использовать любой настраиваемый поставщик, который изначально не поддерживается.

Требуются следующие значения конфигурации:
- **Идентификатор клиента**: идентификатор клиента OAuth 2.0
- **Секрет клиента**: секрет клиента OAuth 2.0.
- **Authorization URL** (URL-адрес для авторизации) URL-адрес для авторизации OAuth 2.0.
- **Token URL** (URL-адрес токена): URL-адрес токена OAuth 2.0.
- **Refresh URL** (URL-адрес обновления): URL-адрес обновления OAuth 2.0.



[Регистрация и использование настраиваемых соединителей в PowerApps]: https://powerapps.microsoft.com/tutorials/register-custom-api/
[Регистрация и использование настраиваемых соединителей в Microsoft Flow]: https://flow.microsoft.com/documentation/register-custom-api/
