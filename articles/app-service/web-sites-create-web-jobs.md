---
title: "Выполнение фоновых задач с помощью веб-заданий в службе приложений Azure"
description: "Узнайте, как использовать веб-задания для выполнения фоновых задач в веб-приложениях службы приложений Azure, приложениях API и мобильных приложениях."
services: app-service
documentationcenter: 
author: ggailey777
manager: erikre
editor: jimbe
ms.assetid: af01771e-54eb-4aea-af5f-f883ff39572b
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/09/2017
ms.author: glenga
ms.openlocfilehash: 5517581f929ffce9e9184848049ce9832013277e
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="run-background-tasks-with-webjobs-in-azure-app-service"></a>Выполнение фоновых задач с помощью веб-заданий в службе приложений Azure

## <a name="overview"></a>Обзор
[Веб-задания](https://docs.microsoft.com/azure/app-service/) — это функция службы приложений Azure, которая позволяет запускать программу или сценарий в том же контексте, что и веб-приложение, приложение API или мобильное приложение. Для использования веб-заданий дополнительные затраты не требуются.

В этой статье показано, как развертывать веб-задания с помощью [портала Azure](https://portal.azure.com) для отправки исполняемого файла или сценария. Дополнительные сведения о том, как разрабатывать и развертывать веб-задания с помощью Visual Studio см. в статье [Develop and deploy WebJobs using Visual Studio - Azure App Service](websites-dotnet-deploy-webjobs.md) (Разработка и развертывание веб-заданий с помощью Visual Studio в службе приложений Azure).

Пакет SDK веб-заданий Azure может использоваться с веб-заданиями для упрощения многих задач программирования. Дополнительные сведения см. в разделе [Информация о пакете SDK веб-заданий](https://github.com/Azure/azure-webjobs-sdk/wiki).

Функции Azure предоставляют еще один способ запуска программ и сценариев. Сравнение веб-заданий и функций см. в статье [Сравнение Microsoft Flow, Logic Apps, функций и веб-заданий Azure](../azure-functions/functions-compare-logic-apps-ms-flow-webjobs.md).

## <a name="webjob-types"></a>Типы веб-заданий

В следующей таблице описаны различия между *непрерывными* и *активируемыми* веб-заданиями.


|Непрерывные  |Активируемые  |
|---------|---------|
| Запускается сразу после создания веб-задания. Чтобы предотвратить завершение задания, программа или сценарий обычно выполняют свою работу в бесконечном цикле. Если задание завершается, его можно перезапустить. | Запускается только при активации вручную или по расписанию. |
| Запускается на всех экземплярах, где выполняется веб-приложение. При необходимости можно ограничить веб-задание одним экземпляром. |Запускается на одном экземпляре, который выбран Azure для балансировки нагрузки.|
| Поддерживает удаленную отладку. | Не поддерживает удаленную отладку.|

> [!NOTE]
> Время ожидания веб-приложения может истечь после 20 минут бездействия. Только запросы к сайту диспетчера служб (развертывания) или страницам веб-приложения на портале сбрасывают таймер. Запросы к фактическому сайту не сбрасывают таймер. Если приложение выполняет непрерывные веб-задания или веб-задания по расписанию, включите **Всегда включено** для обеспечения надежного выполнения веб-заданий. Эта функция доступна только в [ценовых категориях](https://azure.microsoft.com/pricing/details/app-service/) "Базовый", "Стандартный" и "Премиум".

## <a name="acceptablefiles"></a>Поддерживаемые типы файлов для сценариев и программ

Поддерживаются следующие типы файлов:

* .cmd, .bat, .exe (с использованием командной строки Windows)
* .ps1 (с использованием PowerShell)
* .sh (с использованием Bash)
* .php (с использованием PHP)
* .py (с использованием Python)
* .js (с использованием Node.js)
* .jar (с использованием Java)

## <a name="CreateContinuous"></a>Создание непрерывного веб-задания

<!-- 
Several steps in the three "Create..." sections are identical; 
when making changes in one don't forget the other two.
-->

1. На [портале Azure](https://portal.azure.com) перейдите на страницу **Служба приложений** веб-приложения службы приложений, приложения API или мобильного приложения.

2. Выберите **Веб-задания**.

   ![Выбор веб-заданий](./media/web-sites-create-web-jobs/select-webjobs.png)

2. На странице **Веб-задания** выберите **Добавить**.

    ![Страница веб-задания](./media/web-sites-create-web-jobs/wjblade.png)

3. В окне **Добавление веб-задания** задайте значения параметров, указанные в таблице.

   ![Страница добавления веб-задания](./media/web-sites-create-web-jobs/addwjcontinuous.png)

   | Настройка      | Образец значения   | Описание  |
   | ------------ | ----------------- | ------------ |
   | **Имя** | myContinuousWebJob | Имя, которое является уникальным в пределах приложения службы приложений. Оно должно начинаться с буквы или цифры и не может содержать специальные символы, отличные от "-" и "_". |
   | **Передача файла** | ConsoleApp.zip | *ZIP*-файл, который содержит исполняемый файл или файл сценария, а также все вспомогательные файлы, необходимые для запуска программы или сценария. Поддерживаемые типы исполняемых файлов или файлов сценариев перечислены в разделе [Поддерживаемые типы файлов](#acceptablefiles). |
   | **Тип** | Непрерывные | [Типы веб-заданий](#webjob-types) описаны ранее в этой статье. |
   | **Масштабирование** | Несколько экземпляров | Доступно только для непрерывных веб-заданий. Определяет, будет ли программа или сценарий выполняться на всех экземплярах или только на одном экземпляре. Вариант для запуска на нескольких экземплярах не применяется в [ценовых категориях](https://azure.microsoft.com/pricing/details/app-service/) "Бесплатный" или "Общий". |

4. Нажмите кнопку **ОК**.

   Новое веб-задание появится на странице **Веб-задания**.

   ![Список веб-заданий](./media/web-sites-create-web-jobs/listallwebjobs.png)

2. Чтобы остановить или перезапустить непрерывное веб-задание, щелкните правой кнопкой мыши веб-задание в списке и выберите **Остановить** или **Запустить**.

    ![Остановка непрерывного веб-задания](./media/web-sites-create-web-jobs/continuousstop.png)

## <a name="CreateOnDemand"></a>Создание активируемого вручную веб-задания

<!-- 
Several steps in the three "Create..." sections are identical; 
when making changes in one don't forget the other two.
-->

1. На [портале Azure](https://portal.azure.com) перейдите на страницу **Служба приложений** веб-приложения службы приложений, приложения API или мобильного приложения.

2. Выберите **Веб-задания**.

   ![Выбор веб-заданий](./media/web-sites-create-web-jobs/select-webjobs.png)

2. На странице **Веб-задания** выберите **Добавить**.

    ![Страница веб-задания](./media/web-sites-create-web-jobs/wjblade.png)

3. В окне **Добавление веб-задания** задайте значения параметров, указанные в таблице.

   ![Страница добавления веб-задания](./media/web-sites-create-web-jobs/addwjtriggered.png)

   | Настройка      | Образец значения   | Описание  |
   | ------------ | ----------------- | ------------ |
   | **Имя** | myTriggeredWebJob | Имя, которое является уникальным в пределах приложения службы приложений. Оно должно начинаться с буквы или цифры и не может содержать специальные символы, отличные от "-" и "_".|
   | **Передача файла** | ConsoleApp.zip | *ZIP*-файл, который содержит исполняемый файл или файл сценария, а также все вспомогательные файлы, необходимые для запуска программы или сценария. Поддерживаемые типы исполняемых файлов или файлов сценариев перечислены в разделе [Поддерживаемые типы файлов](#acceptablefiles). |
   | **Тип** | Активируемые | [Типы веб-заданий](#webjob-types) описаны ранее в этой статье. |
   | **Триггеры** | Руководство | |

4. Нажмите кнопку **ОК**.

   Новое веб-задание появится на странице **Веб-задания**.

   ![Список веб-заданий](./media/web-sites-create-web-jobs/listallwebjobs.png)

7. Чтобы запустить веб-задание, щелкните правой кнопкой мыши его имя в списке и нажмите **Запустить**.
   
    ![Запуск веб-задания](./media/web-sites-create-web-jobs/runondemand.png)

## <a name="CreateScheduledCRON"></a> Создание запланированного веб-задания

<!-- 
Several steps in the three "Create..." sections are identical; 
when making changes in one don't forget the other two.
-->

1. На [портале Azure](https://portal.azure.com) перейдите на страницу **Служба приложений** веб-приложения службы приложений, приложения API или мобильного приложения.

2. Выберите **Веб-задания**.

   ![Выбор веб-заданий](./media/web-sites-create-web-jobs/select-webjobs.png)

2. На странице **Веб-задания** выберите **Добавить**.

   ![Страница веб-задания](./media/web-sites-create-web-jobs/wjblade.png)

3. В окне **Добавление веб-задания** задайте значения параметров, указанные в таблице.

   ![Страница добавления веб-задания](./media/web-sites-create-web-jobs/addwjscheduled.png)

   | Настройка      | Образец значения   | Описание  |
   | ------------ | ----------------- | ------------ |
   | **Имя** | myScheduledWebJob | Имя, которое является уникальным в пределах приложения службы приложений. Оно должно начинаться с буквы или цифры и не может содержать специальные символы, отличные от "-" и "_". |
   | **Передача файла** | ConsoleApp.zip | *ZIP*-файл, который содержит исполняемый файл или файл сценария, а также все вспомогательные файлы, необходимые для запуска программы или сценария. Поддерживаемые типы исполняемых файлов или файлов сценариев перечислены в разделе [Поддерживаемые типы файлов](#acceptablefiles). |
   | **Тип** | Активируемые | [Типы веб-заданий](#webjob-types) описаны ранее в этой статье. |
   | **Триггеры** | По расписанию | Для надежной работы расписания включите функцию Always On. Она доступна только в ценовых категориях "Базовый", "Стандартный" и "Премиум".|
   | **Выражение CRON** | 0 0/20 * * * * | Выражения [CRON](#cron-expressions) описаны в следующем разделе. |

4. Нажмите кнопку **ОК**.

   Новое веб-задание появится на странице **Веб-задания**.

   ![Список веб-заданий](./media/web-sites-create-web-jobs/listallwebjobs.png)

## <a name="cron-expressions"></a>Выражения CRON

[Выражения CRON](https://en.wikipedia.org/wiki/Cron) состоят из шести полей: `{second} {minute} {hour} {day} {month} {day of the week}`.  Ниже приведены некоторые примеры:

* Каждые 15 минут: `0 */15 * * * *`
* Каждый час (т. е. когда количество минут — 0): `0 0 * * * *` 
* Каждый час с 9:00 до 17:00: `0 0 9-17 * * *` 
* Каждый день в 9:30: `0 30 9 * * *`
* Каждый рабочий день в 9:30: `0 30 9 * * 1-5`

Выражение CRON можно ввести на портале или включить в файл `settings.job` в корне *ZIP*-файла веб-задания, как показано в следующем примере:

```json
{
    "schedule": "0 */15 * * * *"
}
``` 

> [!NOTE]
> При развертывании веб-задания из Visual Studio для свойств файла `settings.job` установите значение **Копировать, если новее**.

## <a name="ViewJobHistory"></a>Просмотр журнала заданий

1. Выберите веб-задание, журнал которого необходимо просмотреть, а затем нажмите кнопку **Журналы**.
   
   ![Кнопка "Журналы"](./media/web-sites-create-web-jobs/wjbladelogslink.png)

2. На странице **WebJob Details** (Подробности веб-задания) выберите время, чтобы просмотреть подробные сведения об одном выполнении.
   
   ![Подробности веб-задания](./media/web-sites-create-web-jobs/webjobdetails.png)

3. На странице **WebJob Details** (Подробности веб-задания) выберите **Переключить выходные данные**, чтобы увидеть текст содержимого журнала.
   
    ![Сведения о выполнении веб-задания](./media/web-sites-create-web-jobs/webjobrundetails.png)

   Чтобы просмотреть текст вывода в отдельном окне браузера, щелкните ссылку **скачать**. Чтобы скачать текст, щелкните ссылку **скачать** правой кнопкой мыши и выберите команду для сохранения содержимого файла в контекстном меню браузера.
   
5. Выберите ссылку навигации **Веб-задания** в верхней части страницы, чтобы перейти к списку веб-заданий.

    ![Навигация веб-заданий](./media/web-sites-create-web-jobs/breadcrumb.png)
   
    ![Список веб-заданий на панели мониторинга журнала](./media/web-sites-create-web-jobs/webjobslist.png)
   
## <a name="NextSteps"></a> Дальнейшие действия

Пакет SDK веб-заданий Azure может использоваться с веб-заданиями для упрощения многих задач программирования. Дополнительные сведения см. в разделе [Информация о пакете SDK веб-заданий](https://github.com/Azure/azure-webjobs-sdk/wiki).
