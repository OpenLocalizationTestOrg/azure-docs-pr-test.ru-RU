---
title: "aaaDesign Azure шаблоны для сложных решений | Документы Microsoft"
description: "Содержит советы и рекомендации по разработке шаблонов Azure Resource Manager для сложных сценариев."
services: azure-resource-manager
documentationcenter: 
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ce1141d6-ece7-4976-acea-1db1f775409e
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/19/2016
ms.author: tomfitz
ms.openlocfilehash: aa45e9a46d79a6336b696cff8fd37f65fa449f11
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="design-patterns-for-azure-resource-manager-templates-when-deploying-complex-solutions"></a>Приемы разработки шаблонов Azure Resource Manager при развертывании сложных решений
Гибкий подход, основывающийся на использовании шаблонов Azure Resource Manager, позволяет быстро и согласованно развертывать сложные топологии. Вы можете адаптировать эти развертывания легко, как основные предложения развивать или tooaccommodate варианты для выброс сценарии или клиентов.

Данная тема является частью другого технического документа. загрузить полной бумага hello tooread [соображения шаблонов диспетчера ресурсов Azure World классов и проверенные методики](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).

Шаблоны сочетать преимущества hello hello базового диспетчера ресурсов Azure с адаптируемости hello и удобочитаемости кода JavaScript Object Notation (JSON). Шаблоны можно использовать следующим образом.

* Последовательное развертывание топологий и рабочих нагрузок.
* Управление всеми ресурсами в приложении с помощью групп ресурсов.
* Примените соответствующие права доступа toogrant toousers для доступом на основе ролей (RBAC), групп и служб.
* Использование тегов задачи toostreamline ассоциации, например выставления счетов накопительные пакеты обновления.

В этой статье приводятся сведения об использовании сценариев, архитектуры и шаблонов реализации, определенных во время сеансов разработки и реализации шаблона в реальных условиях с клиентами группы консультирования клиентов Azure (AzureCAT). Далеко от academic, эти подходы проверенных извещен по hello разработки шаблонов для 12 hello верхней операционные системы на основе Linux технологий, включая рекомендации: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise на платформе Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis и Nagios. 

В этой статье использует эти toohelp проверенные архитектора шаблоны Azure Resource Manager класс мира.  

При работе с клиентами мы определили объемы использования шаблонов Resource Manager предприятиями, системными интеграторами и поставщиками облачных служб. Hello следующие разделы содержат обобщенный Обзор распространенных сценариев и шаблоны для различных типов клиентов.

## <a name="enterprises-and-system-integrators"></a>Предприятия и системные интеграторы
Пользователи шаблонов Resource Manager в рамках крупных организаций чаще всего представлены двумя типами: группами разработчиков программного обеспечения для внутреннего пользования и корпоративными ИТ-отделами. Мы обнаружили, что сценарии hello hello SIs сопоставление toohello сценариев для предприятий, поэтому hello же соображения.

### <a name="internal-software-development-teams"></a>Группы разработчиков программного обеспечения для внутреннего пользования
Если группа разрабатывает toosupport программного обеспечения вашего бизнеса, шаблоны позволяют легко tooquickly развертывание технологий для использования в деловых решений. Также можно использовать шаблоны toorapidly создания сред обучения, позволяющие team члены toogain необходимые навыки.

Можно использовать шаблоны в качестве- или расширить или создать их tooaccommodate вашим потребностям. Добавляя теги в шаблоны, вы можете отображать сводку по выставленным счетам с использованием разных представлений — уровня отдельного пользователя, группы или проекта — включая обучающие представления.

Организациям часто необходимо групп разработчиков toocreate шаблон для развертывания решения. шаблон Hello облегчает ограничения, поэтому некоторые элементы в этой среде остаются фиксированными и не может быть переопределен. Например, банк могут потребовать шаблона tooinclude RBAC так, что программист не может изменить решение банковских операций tooa личным хранилищем toosend данных счета.

### <a name="corporate-it"></a>Корпоративные ИТ-отделы
Корпоративные ИТ-отделы обычно используют шаблоны для доставки емкости облака и возможностей размещения в облаке.

#### <a name="cloud-capacity"></a>Емкость облака
Чаще всего для корпоративных ИТ группы tooprovide емкость облака в плане для команды — «футболки размеры», являющиеся стандартные предложения размеры например малых, средних и больших. Hello размер футболки предложений можно смешивать разных типов ресурсов и количестве то же время предоставляя уровень стандартизации, делающую возможных toouse шаблонов. шаблоны Hello доставлять емкости согласованным образом применяет корпоративной политики, использующий разметку tooprovide о гибком управлении ресурсами tooconsuming организаций.

Например может потребоваться tooprovide разработки, тестирования или рабочей среде, в течение которого hello разработчики программного обеспечения можно развернуть их решения. Hello среда имеет стандартные сетевые топологии и не может изменять элементы, которые Здравствуйте, разработчики программного обеспечения, например правила, касающиеся доступа toohello открытый Интернет и пакетов проверки. Также возможно, организация ролей для этих сред с правами доступа, уникальные для среды hello.

#### <a name="cloud-hosted-capabilities"></a>Возможности размещения в облаке
Можно использовать шаблоны toosupport облаке возможности, включая отдельные пакеты или составного предложения, которые предлагаются toointernal сфер деятельности. Пример составного предложения — это аналитика как услуга — технологии аналитики, визуализации и пр. Такие предложения реализуются в оптимизированной и подключенной конфигурации в рамках предопределенной сетевой топологии.

Возможности, размещенных в облаке и оказывают влияние на hello безопасности роли вопросы, заданные в предложение, на которой они выполняется построение мощности облака hello. Эти возможности предоставляются как есть или в качестве управляемой службы. Для второй hello, ограниченного доступа роли требуются tooenable доступ в среду hello для целей управления.

## <a name="cloud-service-vendors"></a>Поставщики облачных служб
После переговоров toomany общих томов кластера, мы определили несколько подходов, которые можно предпринять toodeploy служб для клиентов и соответствующим требованиям.

### <a name="csv-hosted-offering"></a>Предложения, размещаемые поставщиками облачных служб
При размещении предложения в подписке Azure обычно используется два подхода: отдельное развертывание для каждого клиента и развертывание единиц масштабирования, которые обеспечивают общую инфраструктуру, используемую для всех клиентов.

* **Отдельные развертывания для каждого клиента.** Отдельные развертывания для каждого клиента требуют наличия фиксированной топологии разных известных конфигураций. Эти развертывания могут быть представлены разными размерами виртуальных машин, разным количеством узлов, а также разными объемами связанного хранилища. Добавление тегов развертываний используется для сведенного выставления счетов каждому клиенту. RBAC может быть включено tooallow tooaspects доступ клиентов облачной среды.
* **Единицы масштабирования в общей среде с несколькими клиентами.** Шаблон может представлять единицу масштабирования для сред с несколькими клиентами. В этом случае hello одной инфраструктуре является используется toosupport всех клиентов. Hello развертываний представляет группу ресурсов, которые обеспечивают уровень производительности для hello размещенных предложения, например количество пользователей и число транзакций. Эти единицы масштабирования увеличиваются или уменьшаются по запросу.

### <a name="csv-offering-injected-into-customer-subscription"></a>Внедрение предложений поставщиков облачных служб в подписку клиента
Вы можете toodeploy программного обеспечения в подписок, принадлежащих конечным пользователям. Можно использовать шаблоны toodeploy различных развертываний в Azure учетной записи клиента.

Эти способы развертывания используют RBAC, поэтому можно обновлять и управлять развертыванием hello в учетной записи клиента hello.

### <a name="azure-marketplace"></a>Azure Marketplace
tooadvertise и продавать ваших предложений через marketplace, например Azure Marketplace, можно разработать шаблоны toodeliver различных типов развертывания, работающих в Azure учетной записи клиента. Эти разные развертывания обычно можно описать с помощью "размеров футболки" (малый, средний, большой), типа продукта и аудитории (сообщество, разработчики, предприятие) или типа функции (базовый, высокий уровень доступности).  В некоторых случаях эти типы позволяют toospecify определенные атрибуты hello развертывания, такие как тип виртуальной Машины или число дисков.

## <a name="oss-projects"></a>Программные проекты с открытым исходным кодом
В рамках проектов с открытым исходным кодом шаблоны диспетчера ресурсов включить toodeploy сообщества решения быстро с использованием проверенные. Шаблоны можно хранить в репозитории GitHub, hello сообщества можно просмотреть и изменить их во времени. Пользователи могут развертывать эти шаблоны в своих подписках Azure.

Hello следующих разделах описываются hello необходимые tooconsider перед проектирования решения.

## <a name="identifying-what-is-outside-and-inside-a-vm"></a>Определение внутренних и внешних возможностей виртуальной машины
При создании шаблона весьма полезно toolook на требования hello с точки зрения за пределами и внутри hello виртуальных машин (ВМ):

* За пределами означает hello виртуальные машины и другие ресурсы развертывания, таких как топология сети hello, добавление тегов, toohello ссылки на сертификаты и секреты, а также управление доступом на основе ролей. Все эти ресурсы являются частью шаблона.
* Внутри означает hello установленного программного обеспечения и в целом требуемого состояния конфигурации. Другие механизмы, включая расширения виртуальной машины или сценарии, используются целиком или частично. Эти механизмы может идентифицировать и исполнен hello шаблона, но не в нем.

Распространенные примеры действий, которые необходимо выполнить «в поле hello»-  

* установка и удаление ролей и компонентов сервера;
* Установка и настройка программного обеспечения на уровне узла или кластера hello
* развертывание веб-сайтов на веб-сервере;
* развертывание схем базы данных;
* управление реестром или другими типами параметров конфигурации;
* управление файлами и каталогами;
* запуск и остановка процессов и служб, а также управление ими;
* управление локальными группами и учетными записями пользователей;
* установка пакетов и управление ими (файлы MSI и ЕХЕ, yum и т. д.);
* настройка переменных среды;
* запуск собственных скриптов (Windows PowerShell, bash и т. д.).

### <a name="desired-state-configuration-dsc"></a>Настройка требуемого состояния
Размышления о hello внутреннее состояние виртуальных машин после развертывания, необходимо, чтобы toomake убедиться, что это развертывание не «смещения» из конфигурации hello, определены и возвращены в систему управления версиями. Такой подход гарантирует разработчиков или сотрудникам не делают ad-hoc изменения tooan среды, не являются экспертизу, тестирование или записи в системе управления версиями. Этот элемент управления важна, так как в системе управления версиями не hello изменения вручную. Они также не являются частью стандартного развертывания hello и повлияет на будущие автоматизированное развертывание программного обеспечения hello.

Помимо управления доступом внутренних сотрудников настройка требуемого состояния имеет большое значение для безопасности. Хакеров регулярно пытаетесь toocompromise и воспользоваться программных систем. При успешном выполнении это общие файлы tooinstall, который в противном случае изменения состояния hello скомпрометированных системы. Конфигурации требуемого состояния можно определить различия между требуемого hello и фактическим состоянием и восстановление известной конфигурации.

Существуют расширения ресурсов hello наиболее популярных механизма DSC — PowerShell DSC, Chef и Puppet. Каждый из этих расширений можно развернуть hello начальное состояние виртуальной Машины и быть действительно hello требуемого состояния, используемые toomake.

## <a name="common-template-scopes"></a>Общие области действия шаблона
На практике мы сталкиваемся с тремя ключевыми областями действия шаблонов. Эти три области — емкости, возможностей и решения с начала до конца — описаны в следующих разделах hello.

### <a name="capacity-scope"></a>Область определения емкости
Емкость область предоставляет набор ресурсов в стандартной топологии, предварительно настроенных toobe в соответствии с правилами и политик. наиболее типичный пример Hello — развертывание стандартной среде разработки в сценарии ИТ предприятия или SI.

### <a name="capability-scope"></a>Область определения возможностей
Область определения возможностей фокусируется на развертывании и настройке топологии для данной технологии. Типичные сценарии включают такие технологии, как SQL Server, Cassandra, Hadoop и т. д.

### <a name="end-to-end-solution-scope"></a>Область законченного решения
Область решения конца в конец целевой за пределы одного возможностей и вместо сконцентрирована на реализации tooend решениям, состоящей из нескольких возможностей.  

Область действия шаблона, определяющего решение, представляет собой некий набор. Этот набор состоит из одного или нескольких шаблонов, определяющих возможности, со специальными ресурсами, логикой и требуемым состоянием конкретного решения. Пример решения области шаблона — шаблон решения tooend данных конец конвейера. шаблон Hello может смешивать топологии конкретного решения и состояния с несколькими шаблонами решением из области функции, такие как Kafka, Storm и Hadoop.

## <a name="choosing-free-form-vs-known-configurations"></a>Конфигурации свободной формы и известные конфигурации
Изначально может показаться шаблона следует предоставить потребителей hello обеспечить гибкость, но учесть множество факторов, влияющих на hello выбрать, следует ли toouse конфигураций свободной формы и известных конфигураций. В этом разделе определяет hello ключа клиентские требования и технические вопросы, которые были сформированы подход hello совместно в этом документе.

### <a name="free-form-configurations"></a>Конфигурации свободной формы
На первый взгляд hello произвольных конфигураций звук идеальным. Они позволяют tooselect тип виртуальной Машины и обеспечивают произвольное число узлов и подключенные диски для тех узлов, и сделать это в качестве параметров шаблона tooa. Тем не менее этот подход не подходит для некоторых сценариев.

В [размеры виртуальных машин](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), определяются hello разных типов ВМ и доступные размеры и каждого hello число устойчивой диски (2, 4, 8, 16 или 32), который может быть присоединен. Каждый подключенный диск выполняет 500 операций ввода-вывода в секунду; несколько таких дисков могут быть объединены для увеличения этого показателя. Например, 16 дисков может быть пула tooprovide 8 000 операций ввода-ВЫВОДА. Создание пулов выполняется с помощью конфигурации в hello операционной системы, с помощью дисковых пространств Microsoft Windows или дисковый массив недорогих дисков (RAID) в Linux.

Конфигурации произвольный выбор hello несколько экземпляров виртуальных Машин, ВМ различные типы и размеры для этих экземпляров различных дисков для hello типа виртуальной Машины, и один или несколько сценариев tooconfigure hello ВМ содержимое.

Чаще всего развертывание может иметь несколько типов узлов, включая главные узлы и узлы данных, поэтому гибкое использование обеспечивается для каждого типа узла.

Как только вы начнете toodeploy кластеры любого значимости, сначала toowork на этих сложных сценариях. При развертывании кластера Hadoop, например, с 8 главных узлов и узлов 200 данных, а пул 4 присоединенные диски на каждом главном узле и пула 16 присоединенные диски на узле данных, потребовалось бы 208 виртуальные машины и toomanage 3,232 дисков.

Учетная запись хранения будет регулировать запросы выше ограничить его идентифицированных 20 000 транзакций в секунду, поэтому необходимо рассмотреть секционирование учетной записи хранилища и использовать вычисления toodetermine hello достаточное количество хранилища учетных записей tooaccommodate этой топологии. Получает множество hello сочетания поддерживаемых подход hello произвольной формы, динамические вычисления необходимые toodetermine hello соответствующие секционирование. Hello язык шаблонов диспетчера ресурсов Azure не предоставляет в настоящее время математические функции, поэтому необходимо выполнять эти вычисления в коде, создания уникальных, жестко шаблон с hello необходимые сведения.

В корпоративных ИТ и SI сценариев кто-то Ведение hello шаблонов и поддержки топологии развертывания hello для одного или нескольких организаций. Эти дополнительные издержки — наличие разных конфигураций и шаблонов для каждого клиента — сложно назвать идеальным вариантом.

Можно использовать эти шаблоны toodeploy среды в Azure подписки клиента, но корпоративных ИТ-отделов и CSV обычно их развертывания в своих подписок toobill функция гибкого управления ресурсами с помощью своих клиентов. В этих сценариях hello цель — toodeploy емкости для нескольких клиентов, через пул подписки и сохранить развертываний плотно включаются в центрах подписки toominimize подписки hello — то есть дополнительные toomanage подписки. Размеры настоящему динамическое развертывание достижения этого типа плотность требует тщательного планирования и дополнительная разработка для формирования шаблонов работы от имени организации hello.

Кроме того невозможно создать подписки через вызов API, но необходимо сделать вручную через портал hello. При увеличении hello количество подписок, все результирующие центрах подписки требует вмешательства человека, не могут быть автоматизированы. С так много вариативности в hello размеры развертываний пришлось бы toopre подготовки подписок вручную tooensure подписки доступны.

Учитывая все эти факторы, конфигурации свободной формы являются в реальности менее привлекательным решением, чем на первый взгляд.

### <a name="known-configurations--hello-t-shirt-sizing-approach"></a>Удачной конфигурации — hello подход футболки изменения размера
А не реализует шаблон, который обеспечивает общее гибкость и множество вариантов, опыт распространенный подход заключается в tooprovide hello возможность tooselect удачной конфигурации, в сущности, стандартная футболки размеров, таких как "песочницы", небольшой, средний и большой. Другие примеры использования этого подхода включают такие продукты, как Community Edition или Enterprise Edition.  Другие случаи могут быть представлены конфигурациями технологий, зависящими от рабочей нагрузки, включая решения Map/Reduce или NoSQL.

Многие корпоративные ИТ-отделы, поставщики программного обеспечения с открытым исходным кодом и системные интеграторы предоставляют свои продукты локально, в виртуализованных средах (предприятия) или в качестве программного обеспечения как услуги (SaaS) (поставщики облачных служб и поставщики решений с открытым исходным кодом).

Такой подход позволяет использовать хорошие и известные конфигурации разных размеров, предварительно настроенные для клиентов. Без известных конфигураций конечных пользователей необходимо определить изменения размера кластера по отдельности, учитывать ограничения ресурсов платформы и выполнять математические tooidentify hello возникающие секционирование учетные записи хранения и другие ресурсы (из-за размера toocluster и ресурсов ограничения). Удачной конфигурации включить неправильный размер футболки клиентов tooeasily выберите hello — то есть конкретного развертывания. Кроме toomaking для повышения удобства для клиента hello небольшое количество известной конфигурации будет проще toosupport и может помочь вам предоставлять более высокий уровень плотности.

Подход с применением известной конфигурации по методу «размер футболки» также характеризуется переменным количеством узлов одного размера. Например, «футболка» малого размера может включать от 3 до 10 узлов.  размер футболки Hello будут спроектированный tooaccommodate too10 узлов и предоставить hello потребителя возможность hello toomake выбранных элементов в свободной форме toohello максимальный размер определяемого.  

Размер футболки, в зависимости от типа рабочей нагрузки может быть несколько произвольной формы по своей природе с точки зрения hello число узлов, которые могут быть развернуты, но будет иметь размер distinct узел рабочей нагрузки и конфигурации hello программного обеспечения на узле hello.

Размеры футболки основании предложения продуктов, например community или Enterprise, могут иметь типы различных ресурсов и максимальное количество узлов, которые могут быть развернуты, обычно привязаны toolicensing вопросы или доступность функций по hello разных предложений.

Можно также обеспечивает возможность проведения клиентов с уникальным вариантов с помощью шаблонов на основе JSON hello. При работе с выбросы, можно включить соответствующий план hello и рекомендации для разработки, поддержки и расчет затрат.

На основе шаблона потребления hello клиентских сценариев и требованиям, определенным в начале hello этого документа, мы определили шаблон для развернутого шаблона.

## <a name="capacity-and-capability-scoped-solution-templates"></a>Шаблоны решений, определяющие емкость и возможности
Развернутое предоставляет разработка tootemplate Модульный подход, поддерживающий многократного использования, расширяемость, тестирования и работы с проектами. Этот раздел содержит сведения о как развернутого подход может быть применен tootemplates с областью возможностей.

При таком подходе основной шаблон получает значения параметров из шаблона объекта-получателя, а затем связывает нижестоящим tooseveral типов шаблонов и сценариев, как показано ниже. Параметры, статические переменные и переменные, созданные являются значениями используется tooprovide и из него hello связанных шаблонов.

![Параметры шаблона](./media/best-practices-resource-manager-design-templates/template-parameters.png)

**Параметры передаются tooa главного шаблона, а затем toolinked шаблонов**

следующие разделы фокус на hello типов шаблонов и сценариев, в одном шаблоне разлагаются на Hello. Hello разделах представлены подходы для передачи сведений о состоянии из шаблонов hello. Каждый шаблон и hello типы скрипт в образе hello описаны вместе с примерами. Контекстные примеры см. в разделе «Сборка: пример реализации» далее в этом документе.

### <a name="template-metadata"></a>Метаданные шаблона
Метаданные шаблона (hello metadata.json-файл) содержит пары ключ значение, описание шаблона в формате JSON, который может быть прочитан человека и программных систем.

![Метаданные шаблона](./media/best-practices-resource-manager-design-templates/template-metadata.png)

**Метаданные шаблона описан в файле metadata.json hello**

Для установки агентов можно извлечь файл metadata.json hello и публикации информации hello и шаблон toohello ссылку в веб-страницы или каталога. Элементы включают: *itemDisplayName*, *description*, *summary*, *githubUsername* и *dateUpdated*.

Ниже приведен пример файла целиком.

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. hello database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### <a name="main-template"></a>Основной шаблон
основной шаблон Hello получает параметры пользователя, использует toopopulate сложный объект сведения о переменных и выполняет hello связанных шаблонов.

![Основной шаблон](./media/best-practices-resource-manager-design-templates/main-template.png)

**основной шаблон Hello получает параметры пользователя**

Один параметр, который предоставляется является типом известной конфигурации также называется hello параметр размер футболки, из-за его стандартных значений, таких как малых, средних и больших. На практике этот параметр можно использовать разными способами. Дополнительные сведения см. в разделе «Шаблоны ресурсов известной конфигурации» далее в этом документе.

Некоторые ресурсы развертываются независимо от известных конфигурации hello, заданного параметром пользователя. Эти ресурсы, подготовленные с помощью шаблона одного общего ресурса и могут совместно использоваться другими шаблонами, поэтому hello общего ресурса шаблона выполняется первым.

Некоторые ресурсы развертываются при необходимости независимо от указанного известной конфигурации hello.

### <a name="shared-resources-template"></a>Шаблон общих ресурсов
Этот шаблон предоставляет ресурсы, которые являются общими для всех известных конфигураций. В нем hello виртуальной сети, группы доступности и другие ресурсы, которые требуются независимо от hello известной конфигурации шаблона, который развертывается.

![Ресурсы шаблона](./media/best-practices-resource-manager-design-templates/template-resources.png)

**Шаблон общих ресурсов**

Имена ресурсов, такие как имя виртуальной сети hello, основанные на шаблоне основной hello. Можно указать их в качестве переменной в этом шаблоне или получать их в виде параметра от пользователя hello, согласно требованиям вашей организации.

### <a name="optional-resources-template"></a>Шаблон дополнительных ресурсов
шаблон Hello необязательно ресурсов содержит ресурсы, которые развертываются программным способом на основе значения параметра или переменной hello.

![Дополнительные ресурсы](./media/best-practices-resource-manager-design-templates/optional-resources.png)

**Шаблон дополнительных ресурсов**

Например, можно использовать необязательный ресурсов шаблона tooconfigure jumpbox, позволяющий среды развертывания tooa косвенный доступ из hello общедоступный Интернет. Используется параметр или переменную tooidentify Включение hello jumpbox и hello *concat* toobuild hello целевой имя для шаблона hello функции например *jumpbox_enabled.json*. Связывание шаблона будет использоваться hello полученный переменной tooinstall hello jumpbox.

Можно связать шаблон hello дополнительные ресурсы из нескольких мест:

* Если применимо tooevery развертывания, создать ссылку на основании параметров из шаблона hello общих ресурсов.
* При применимо tooselect удачной конфигурации — например, установить только на крупных развертываний — создать ссылку на основании параметров или управляемых переменной из шаблона hello известной конфигурации.

Данному ресурсу необязателен может не влияют hello шаблон потребителя, а шаблон поставщиком hello. Например, может потребоваться toosatisfy требования конкретного продукта или надстройками продуктов (общее для общих томов кластера) или политики tooenforce (обычно хранилище единственных копий и корпоративных ИТ группы). В этих случаях можно использовать переменной tooidentify ли развертываться hello ресурсов.

### <a name="known-configuration-resources-template"></a>Шаблон известной конфигурации ресурсов
В главном шаблоне hello параметр может быть предоставляется tooallow hello шаблон потребителя toospecify toodeploy известной требуемой конфигурации. Зачастую эта известная конфигурация использует подход "размер футболки" с набором фиксированных размеров конфигураций песочницы: малый, средний и большой.

![Ресурсы известной конфигурации](./media/best-practices-resource-manager-design-templates/known-config.png)

**Шаблон известной конфигурации ресурсов**

обычно используется подход размер футболки Hello, но параметры hello могут представлять любой набор известных конфигураций. Например, вы можете указать набор сред для корпоративного приложения, включая среды для разработки, тестирования и производства. Или можно использовать для облачной службы toorepresent различных масштабирование единиц, версии продукта или конфигурации продукта, такие как сообщества, Developer или Enterprise.

С помощью шаблона hello общего ресурса, передаются переменные toohello известной конфигурации шаблон либо из:

* Конечный пользователь — то есть, параметры hello передавать toohello основного шаблона.
* Организации, то есть hello переменных в шаблоне основной hello, которые представляют внутренние требованиям или политик.

### <a name="member-resources-template"></a>Шаблон элемента ресурсов
В известную конфигурацию часто включены один или несколько типов элементов узла. Например, при работе с Hadoop у вас есть основные узлы и узлы данных. При установке MongoDB у вас будут узлы данных и арбитр. При развертывании DataStax у вас будут узлы данных, а также ВМ с установленной службой OpsCenter.

![Ресурсы элементов](./media/best-practices-resource-manager-design-templates/member-resources.png)

**Шаблон элемента ресурсов**

Каждый тип узлов можно имеют разные размеры виртуальных машин, количество присоединенные диски, сценарии tooinstall и настроить узлы hello, конфигурации порта для виртуальных машин hello, число экземпляров и другие сведения. Поэтому каждый тип узла получает свой собственный ресурсов шаблона элемента, который содержит hello сведения для развертывание и Настройка инфраструктуры, а также выполнения сценариев toodeploy и настройка программного обеспечения в пределах hello виртуальной Машины.

Для виртуальной машины обычно используется два типа скриптов: повторно используемые и пользовательские.

### <a name="widely-reusable-scripts"></a>Повторно используемые скрипты
Повторно используемые скрипты можно использовать для нескольких типов шаблонов. Один из примеров лучше hello этих скриптов, широко многократно используемых настраивает RAID на дисках toopool Linux и получения большого количества операций ввода-ВЫВОДА. Независимо от программного обеспечения hello, устанавливаемый в hello виртуальной Машины этот сценарий обеспечивает повторное использование проверенные для распространенных сценариев.

![Скрипты повторного использования](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

**Шаблоны элементов ресурсов могут вызывать повторно используемые скрипты**

### <a name="custom-scripts"></a>Пользовательские скрипты
Шаблоны часто вызывают один или несколько скриптов, отвечающих за установку и настройку программного обеспечения в виртуальной машине. Общий шаблон используется с большими топологиями, в которых развернуто несколько экземпляров одного или нескольких типов элементов. Скрипт установки инициируется для каждой виртуальной машины, которая может быть запущена параллельно. Затем выполняется скрипт установки, который вызывается после развертывания всех виртуальных машин (или всех виртуальных машин данного типа элемента).

![Пользовательские скрипты](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

**Шаблоны элементов ресурсов могут вызывать скрипты для выполнения определенных задач, например, конфигурации виртуальной машины**

## <a name="capability-scoped-solution-template-example---redis"></a>Пример шаблона решения, определяющего возможности — Redis
tooshow как реализация может работать нормально, давайте взглянем на практический пример создания шаблона, которая позволяет hello развертывание и настройку Redis в стандартные размеры футболки.  

Для развертывания hello существует ряд общих ресурсов (виртуальной сети, учетная запись хранения, группы доступности) и необязательно ресурсов (jumpbox). Существует несколько известных конфигураций, представленных в рамках подхода «размеры футболки» (малая, средняя, большая), каждая с одним типом узла. Кроме того, есть два соответствующих задаче скрипта (установка и настройка).

### <a name="creating-hello-template-files"></a>Создание файлов шаблонов hello
Будет создан основной шаблон с именем azuredeploy.json.

Создание шаблона общих ресурсов с именем resources.json

Создайте дополнительный шаблон ресурсов развертывания hello tooenable jumpbox, с именем jumpbox_enabled.json

Redis использует только один тип узла, поэтому создается один шаблон элемента ресурсов с именем node-resources.json.

С помощью Redis tooinstall каждого отдельного узла, а затем задать hello кластера.  Сценарии tooaccommodate hello Установка и настройка, redis кластера install.sh и redis кластера setup.sh.

### <a name="linking-hello-templates"></a>Связывание шаблонов hello
Ссылки позволяют шаблона hello основной шаблон связывает out toohello общих ресурсов шаблона, который устанавливает hello виртуальной сети.

Логика добавляется внутри hello основного шаблона tooenable потребителей toospecify шаблона hello ли jumpbox должны развертываться. *Включен* значение hello *EnableJumpbox* параметр указывает, что hello клиенту toodeploy jumpbox. Если это значение указано, объединяет hello шаблона *_enabled* как суффикс tooa базовый шаблон для возможности jumpbox hello.

Hello основной шаблон применяется hello *больших* значение параметра как суффикс tooa базовый шаблон для размер футболки, а затем использует это значение в ссылке шаблона out слишком*technology_on_os_large.json*.

Топология Hello будет выглядеть следующим образом на этом рисунке.

![Шаблон Redis](./media/best-practices-resource-manager-design-templates/redis-template.png)

**Структура шаблона для шаблона Redis**

### <a name="configuring-state"></a>Настройка состояния
Для hello узлов в кластере hello состоит из двух этапов состояние tooconfiguring hello, оба представленных скриптами определенной цели.  Redis устанавливает «install.sh redis кластера» и «setup.sh redis кластера» устанавливает hello кластера.

### <a name="supporting-different-size-deployments"></a>Поддержка развертываний разных размеров
В переменных, шаблон размер футболки hello указывает hello количество узлов каждого типа toodeploy для hello указанный размер (*больших*). Затем он развертывает соответствующее количество экземпляров виртуальных Машин с помощью ресурсов циклы, предоставляя tooresources уникальные имена путем добавления имени узла с номером числовой последовательности из *copyIndex()*. Как и следующие действия для обоих горячие "и" горячего зоны ВМ, как определено в шаблоне имя футболки hello

## <a name="decomposition-and-end-to-end-solution-scoped-templates"></a>Декомпозиция и шаблоны законченных решений
Шаблон решения, определяющий законченные решения, отвечает за предоставление законченного решения.  Обычно такой шаблон представляет собой сочетание нескольких шаблонов заданных возможностей с дополнительными ресурсами, логикой и состоянием.

Как видно в приведенном ниже рисунке hello hello одной модели используется для возможности в области шаблонов расширяется для шаблонов с начала до конца область решения.

Общие ресурсы шаблон и дополнительные ресурсы, шаблоны служат hello одной функции, как и hello емкость и возможности области шаблона подходов, но относятся к tooend hello решениям.

Как решение tooend области шаблоны также обычно могут иметь размер футболки, hello известных ресурсов для настройки шаблона отражает то, которое требуется для заданной конфигурации известного решения hello.

tooone ссылки Hello известные ресурсы шаблон конфигурации и дополнительные возможности в области Шаблоны решений, соответствующих toohello tooend решение, а также hello шаблоны членов ресурсов, которые необходимы для hello tooend решение.

Как размер футболки hello hello решения могут отличаться от hello отдельного шаблона уровня возможностей, переменные внутри hello известные шаблон конфигурации ресурсы, используемые tooprovide hello соответствующие значения для подчиненных возможность область решения шаблоны toodeploy hello соответствующий размер футболки.

![Законченное решение](./media/best-practices-resource-manager-design-templates/end-to-end.png)

**используемая модель Hello емкости или возможность области Шаблоны решений можно легко расширена для области шаблона решения tooend end**

## <a name="preparing-templates-for-hello-marketplace"></a>Подготовка шаблонов для hello Marketplace
Hello легко предшествующий подход включает сценарии, где предприятий и хранилище единственных копий, Общие тома кластера должна tooeither развертывать шаблоны hello самостоятельно или включить их клиентам toodeploy сами по себе.

Другой требуемый сценарий выполняет развертывание шаблона через hello marketplace.  Такой подход развернутого работает для marketplace hello, а также с некоторыми незначительными изменениями.

Как упоминалось ранее, шаблоны могут быть типами distinct развертывания используется toooffer для продажи в hello marketplace. Разные типы развертываний могут быть представлены разными "размерами футболки" (малый, средний, большой), типом продукта и аудитории (сообщества, разработчики, организации) или типом функции (базовый, высокий уровень доступности).

Как показано ниже, hello существующих конечных tooend решения или возможность использования шаблонов в заданной области могут быть легко загруженные toolist hello различных известных конфигураций hello marketplace.

Hello главного шаблона toohello параметров сначала изменяются tooremove hello входящего параметра с именем tshirtSize.

Хотя hello развертывания различных типов сопоставления toohello известные шаблон конфигурации ресурсов, им также необходимо hello общих ресурсов и конфигурация найдена в hello шаблон общих ресурсов и, возможно, их необязательно шаблонов ресурсов.

Следует toopublish ваш marketplace toohello шаблона вы устанавливаете различных копий шаблоне Main, заменяет hello ранее доступный параметр входящих переменной tooa tshirtSize внедрен в шаблон hello.

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

**Адаптация решения области шаблона для hello marketplace**

## <a name="next-steps"></a>Дальнейшие действия
* toolearn о общее состояние в действие и из шаблонов, в разделе [совместного использования состояния в шаблоны Azure Resource Manager](best-practices-resource-manager-state.md).
* Для получения рекомендаций по как предприятия могут использовать диспетчер ресурсов tooeffectively управление подписками см. в разделе [корпоративные функции формирования шаблонов - управление конкретные подписки](resource-manager-subscription-governance.md).

