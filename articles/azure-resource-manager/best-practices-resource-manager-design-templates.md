---
title: "Проектирование шаблонов Azure для сложных решений | Документация Майкрософт"
description: "Содержит советы и рекомендации по разработке шаблонов Azure Resource Manager для сложных сценариев."
services: azure-resource-manager
documentationcenter: 
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ce1141d6-ece7-4976-acea-1db1f775409e
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/19/2016
ms.author: tomfitz
ms.openlocfilehash: dcc31f7a8c85a8f7fbd554371a66fb1e348bca17
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="design-patterns-for-azure-resource-manager-templates-when-deploying-complex-solutions"></a><span data-ttu-id="391de-103">Приемы разработки шаблонов Azure Resource Manager при развертывании сложных решений</span><span class="sxs-lookup"><span data-stu-id="391de-103">Design patterns for Azure Resource Manager templates when deploying complex solutions</span></span>
<span data-ttu-id="391de-104">Гибкий подход, основывающийся на использовании шаблонов Azure Resource Manager, позволяет быстро и согласованно развертывать сложные топологии.</span><span class="sxs-lookup"><span data-stu-id="391de-104">Using a flexible approach based on Azure Resource Manager templates, you can deploy complex topologies quickly and consistently.</span></span> <span data-ttu-id="391de-105">Эти развертывания можно с легкостью адаптировать по мере развития основных предложений. Кроме того, можно работать с вариантами для сценариев выбросов или клиентов.</span><span class="sxs-lookup"><span data-stu-id="391de-105">You can adapt these deployments easily as core offerings evolve or to accommodate variants for outlier scenarios or customers.</span></span>

<span data-ttu-id="391de-106">Данная тема является частью другого технического документа.</span><span class="sxs-lookup"><span data-stu-id="391de-106">This topic is part of a larger whitepaper.</span></span> <span data-ttu-id="391de-107">Чтобы ознакомиться с полным текстом этого документа, скачайте файл [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf) (Рекомендации по работе с шаблонами Azure Resource Manager мирового класса).</span><span class="sxs-lookup"><span data-stu-id="391de-107">To read the full paper, download [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span></span>

<span data-ttu-id="391de-108">Шаблоны сочетают преимущества базового диспетчера ресурсов Azure с адаптивностью и удобочитаемостью нотации объектов JavaScript (JSON).</span><span class="sxs-lookup"><span data-stu-id="391de-108">Templates combine the benefits of the underlying Azure Resource Manager with the adaptability and readability of JavaScript Object Notation (JSON).</span></span> <span data-ttu-id="391de-109">Шаблоны можно использовать следующим образом.</span><span class="sxs-lookup"><span data-stu-id="391de-109">Using templates, you can:</span></span>

* <span data-ttu-id="391de-110">Последовательное развертывание топологий и рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="391de-110">Deploy topologies and their workloads consistently.</span></span>
* <span data-ttu-id="391de-111">Управление всеми ресурсами в приложении с помощью групп ресурсов.</span><span class="sxs-lookup"><span data-stu-id="391de-111">Manage all your resources in an application together using resource groups.</span></span>
* <span data-ttu-id="391de-112">Управление доступом на основе ролей (RBAC) для предоставления соответствующего доступа пользователям, группам и службам.</span><span class="sxs-lookup"><span data-stu-id="391de-112">Apply role-based access control (RBAC) to grant appropriate access to users, groups, and services.</span></span>
* <span data-ttu-id="391de-113">Использование сопоставления добавления тегов для упрощения задач, включая сведение при выставлении счетов.</span><span class="sxs-lookup"><span data-stu-id="391de-113">Use tagging associations to streamline tasks such as billing rollups.</span></span>

<span data-ttu-id="391de-114">В этой статье приводятся сведения об использовании сценариев, архитектуры и шаблонов реализации, определенных во время сеансов разработки и реализации шаблона в реальных условиях с клиентами группы консультирования клиентов Azure (AzureCAT).</span><span class="sxs-lookup"><span data-stu-id="391de-114">This article provides details on consumption scenarios, architecture, and implementation patterns identified during our design sessions and real-world template implementations with Azure Customer Advisory Team (AzureCAT) customers.</span></span> <span data-ttu-id="391de-115">Далеко не теоретические, эти проверенные методики подкреплены опытом разработки шаблонов для 12 популярных программных решений с открытым исходным кодом на основе ОС Linux, включая Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise, управляемых Apache-Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis и Nagios.</span><span class="sxs-lookup"><span data-stu-id="391de-115">Far from academic, these approaches are proven practices informed by the development of templates for 12 of the top Linux-based OSS technologies, including: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis, and Nagios.</span></span> 

<span data-ttu-id="391de-116">В статье приводятся эти проверенные методики, помогающие проектировать шаблоны диспетчера ресурсов Azure мирового класса.</span><span class="sxs-lookup"><span data-stu-id="391de-116">This article shares these proven practices to help you architect world class Azure Resource Manager templates.</span></span>  

<span data-ttu-id="391de-117">При работе с клиентами мы определили объемы использования шаблонов Resource Manager предприятиями, системными интеграторами и поставщиками облачных служб.</span><span class="sxs-lookup"><span data-stu-id="391de-117">In our work with customers, we have identified several Resource Manager template consumption experiences across enterprises, System Integrators (SI)s, and CSVs.</span></span> <span data-ttu-id="391de-118">В следующих разделах приведен высокоуровневый обзор распространенных сценариев и шаблонов для разных типов клиентов.</span><span class="sxs-lookup"><span data-stu-id="391de-118">The following sections provide a high-level overview of common scenarios and patterns for different customer types.</span></span>

## <a name="enterprises-and-system-integrators"></a><span data-ttu-id="391de-119">Предприятия и системные интеграторы</span><span class="sxs-lookup"><span data-stu-id="391de-119">Enterprises and system integrators</span></span>
<span data-ttu-id="391de-120">Пользователи шаблонов Resource Manager в рамках крупных организаций чаще всего представлены двумя типами: группами разработчиков программного обеспечения для внутреннего пользования и корпоративными ИТ-отделами.</span><span class="sxs-lookup"><span data-stu-id="391de-120">Within large organizations, we commonly see two consumers of Resource Manager templates: internal software development teams and corporate IT.</span></span> <span data-ttu-id="391de-121">Мы обнаружили, что сценарии для системных интеграторов сопоставлены с таковыми для предприятий, поэтому для двух типов клиентов действительны одинаковые условия.</span><span class="sxs-lookup"><span data-stu-id="391de-121">We've found that the scenarios for the SIs map to the scenarios for Enterprises, so the same considerations apply.</span></span>

### <a name="internal-software-development-teams"></a><span data-ttu-id="391de-122">Группы разработчиков программного обеспечения для внутреннего пользования</span><span class="sxs-lookup"><span data-stu-id="391de-122">Internal software development teams</span></span>
<span data-ttu-id="391de-123">Если группа разрабатывает программное обеспечение для поддержки бизнеса, шаблоны позволяют быстро и просто развертывать технологии для использования в бизнес-решениях.</span><span class="sxs-lookup"><span data-stu-id="391de-123">If your team develops software to support your business, templates provide an easy way to quickly deploy technologies for use in business-specific solutions.</span></span> <span data-ttu-id="391de-124">Вы также можете использовать шаблоны для быстрого создания сред обучения, с помощью которых участники группы могут получить необходимые навыки.</span><span class="sxs-lookup"><span data-stu-id="391de-124">You can also use templates to rapidly create training environments that enable team members to gain necessary skills.</span></span>

<span data-ttu-id="391de-125">Вы можете использовать шаблоны как есть, расширять их или создавать в соответствии со своими потребностями.</span><span class="sxs-lookup"><span data-stu-id="391de-125">You can use templates as-is or extend or compose them to accommodate your needs.</span></span> <span data-ttu-id="391de-126">Добавляя теги в шаблоны, вы можете отображать сводку по выставленным счетам с использованием разных представлений — уровня отдельного пользователя, группы или проекта — включая обучающие представления.</span><span class="sxs-lookup"><span data-stu-id="391de-126">Using tagging within templates, you can provide a billing summary with various views such as team, project, individual, and education.</span></span>

<span data-ttu-id="391de-127">Часто в организациях группам разработчиков программного обеспечения требуется создать шаблон для согласованного развертывания решения.</span><span class="sxs-lookup"><span data-stu-id="391de-127">Businesses often want software development teams to create a template for consistent deployment of a solution.</span></span> <span data-ttu-id="391de-128">Шаблон обеспечивает ограничения, благодаря которым определенные элементы в среде остаются фиксированными и не могут быть переопределены.</span><span class="sxs-lookup"><span data-stu-id="391de-128">The template facilitates constraints so certain items within that environment remain fixed and can't be overridden.</span></span> <span data-ttu-id="391de-129">Например, банку может потребоваться шаблон для включения RBAC, который запрещает программисту настраивать в банковском решении отправку данных на личную учетную запись хранения.</span><span class="sxs-lookup"><span data-stu-id="391de-129">For example, a bank might require a template to include RBAC so a programmer can’t revise a banking solution to send data to a personal storage account.</span></span>

### <a name="corporate-it"></a><span data-ttu-id="391de-130">Корпоративные ИТ-отделы</span><span class="sxs-lookup"><span data-stu-id="391de-130">Corporate IT</span></span>
<span data-ttu-id="391de-131">Корпоративные ИТ-отделы обычно используют шаблоны для доставки емкости облака и возможностей размещения в облаке.</span><span class="sxs-lookup"><span data-stu-id="391de-131">Corporate IT organizations typically use templates for delivering cloud capacity and cloud-hosted capabilities.</span></span>

#### <a name="cloud-capacity"></a><span data-ttu-id="391de-132">Емкость облака</span><span class="sxs-lookup"><span data-stu-id="391de-132">Cloud capacity</span></span>
<span data-ttu-id="391de-133">Чаще всего ИТ-группы предоставляют емкость облака для групп в виде "размеров футболки", где речь идет о малом, среднем и большом размерах конфигурации.</span><span class="sxs-lookup"><span data-stu-id="391de-133">A common way for corporate IT groups to provide cloud capacity for teams is with "t-shirt sizes", which are standard offering sizes such as small, medium, and large.</span></span> <span data-ttu-id="391de-134">Предложения в виде «размеров футболки» позволяют не только комбинировать разные типы и количества ресурсов, но и обеспечивают уровень стандартизации, который позволяет использовать шаблоны.</span><span class="sxs-lookup"><span data-stu-id="391de-134">The t-shirt sized offerings can mix different resource types and quantities while providing a level of standardization that makes it possible to use templates.</span></span> <span data-ttu-id="391de-135">Шаблоны предоставляют емкость согласованно, применяя корпоративные политики и используя теги. Это позволяет организациям-потребителям использовать возвратный платеж.</span><span class="sxs-lookup"><span data-stu-id="391de-135">The templates deliver capacity in a consistent way that enforces corporate policies and uses tagging to provide chargeback to consuming organizations.</span></span>

<span data-ttu-id="391de-136">Например, вам необходимо предоставить среды для разработки, тестирования или производства, в которых группы разработчиков программного обеспечения смогут развернуть свои решения.</span><span class="sxs-lookup"><span data-stu-id="391de-136">For example, you may need to provide development, test, or production environments within which the software development teams can deploy their solutions.</span></span> <span data-ttu-id="391de-137">Среда содержит предопределенную сетевую топологию и элементы, которые группы разработчиков программного обеспечения не могут изменять. Сюда входят правила, определяющие общий доступ в Интернет и проверку пакетов.</span><span class="sxs-lookup"><span data-stu-id="391de-137">The environment has a predefined network topology and elements that the software development teams cannot change, such as rules governing access to the public internet and packet inspection.</span></span> <span data-ttu-id="391de-138">Этим средам также можно назначить роли конкретной организации, предоставляющие уникальные права доступа.</span><span class="sxs-lookup"><span data-stu-id="391de-138">You may also have organization-specific roles for these environments with distinct access rights for the environment.</span></span>

#### <a name="cloud-hosted-capabilities"></a><span data-ttu-id="391de-139">Возможности размещения в облаке</span><span class="sxs-lookup"><span data-stu-id="391de-139">Cloud-hosted capabilities</span></span>
<span data-ttu-id="391de-140">Шаблоны можно использовать для поддержки возможностей размещения в облаке. Эти возможности представлены отдельными пакетами программного обеспечения или составными предложениями для внутренних бизнес-процессов.</span><span class="sxs-lookup"><span data-stu-id="391de-140">You can use templates to support cloud-hosted capabilities, including individual software packages or composite offerings that are offered to internal lines of business.</span></span> <span data-ttu-id="391de-141">Пример составного предложения — это аналитика как услуга — технологии аналитики, визуализации и пр. Такие предложения реализуются в оптимизированной и подключенной конфигурации в рамках предопределенной сетевой топологии.</span><span class="sxs-lookup"><span data-stu-id="391de-141">An example of a composite offering would be analytics-as-a-service—analytics, visualization, and other technologies—delivered in an optimized, connected configuration on a predefined network topology.</span></span>

<span data-ttu-id="391de-142">Возможности размещения в облаке зависят от условий безопасности и ролей, определенных предложением емкости облака и используемых при их создании.</span><span class="sxs-lookup"><span data-stu-id="391de-142">Cloud-hosted capabilities are affected by the security and role considerations established by the cloud capacity offering on which they’re built.</span></span> <span data-ttu-id="391de-143">Эти возможности предоставляются как есть или в качестве управляемой службы.</span><span class="sxs-lookup"><span data-stu-id="391de-143">These capabilities are offered as is or as a managed service.</span></span> <span data-ttu-id="391de-144">Во втором случае для предоставления доступа к среде с целью управления требуются роли, ограничивающие доступ.</span><span class="sxs-lookup"><span data-stu-id="391de-144">For the latter, access-constrained roles are required to enable access into the environment for management purposes.</span></span>

## <a name="cloud-service-vendors"></a><span data-ttu-id="391de-145">Поставщики облачных служб</span><span class="sxs-lookup"><span data-stu-id="391de-145">Cloud service vendors</span></span>
<span data-ttu-id="391de-146">После общения со многими поставщиками облачных служб мы определили несколько подходов, которые можно использовать при развертывании служб для клиентов в соответствии с их требованиями.</span><span class="sxs-lookup"><span data-stu-id="391de-146">After talking to many CSVs, we identified multiple approaches you can take to deploy services for your customers and associated requirements.</span></span>

### <a name="csv-hosted-offering"></a><span data-ttu-id="391de-147">Предложения, размещаемые поставщиками облачных служб</span><span class="sxs-lookup"><span data-stu-id="391de-147">CSV-hosted offering</span></span>
<span data-ttu-id="391de-148">При размещении предложения в подписке Azure обычно используется два подхода: отдельное развертывание для каждого клиента и развертывание единиц масштабирования, которые обеспечивают общую инфраструктуру, используемую для всех клиентов.</span><span class="sxs-lookup"><span data-stu-id="391de-148">If you host your offering in your own Azure subscription, two hosting approaches are common: deploying a distinct deployment for every customer or deploying scale units that underpin a shared infrastructure used for all customers.</span></span>

* <span data-ttu-id="391de-149">**Отдельные развертывания для каждого клиента.**</span><span class="sxs-lookup"><span data-stu-id="391de-149">**Distinct deployments for each customer.**</span></span> <span data-ttu-id="391de-150">Отдельные развертывания для каждого клиента требуют наличия фиксированной топологии разных известных конфигураций.</span><span class="sxs-lookup"><span data-stu-id="391de-150">Distinct deployments per customer require fixed topologies of different known configurations.</span></span> <span data-ttu-id="391de-151">Эти развертывания могут быть представлены разными размерами виртуальных машин, разным количеством узлов, а также разными объемами связанного хранилища.</span><span class="sxs-lookup"><span data-stu-id="391de-151">These deployments may have different virtual machine (VM) sizes, varying numbers of nodes, and different amounts of associated storage.</span></span> <span data-ttu-id="391de-152">Добавление тегов развертываний используется для сведенного выставления счетов каждому клиенту.</span><span class="sxs-lookup"><span data-stu-id="391de-152">Tagging of deployments is used for roll-up billing of each customer.</span></span> <span data-ttu-id="391de-153">Функция RBAC может быть включена для предоставления клиентам доступа к компонентам облачной среды.</span><span class="sxs-lookup"><span data-stu-id="391de-153">RBAC may be enabled to allow customers access to aspects of their cloud environment.</span></span>
* <span data-ttu-id="391de-154">**Единицы масштабирования в общей среде с несколькими клиентами.**</span><span class="sxs-lookup"><span data-stu-id="391de-154">**Scale units in shared multi-tenant environments.**</span></span> <span data-ttu-id="391de-155">Шаблон может представлять единицу масштабирования для сред с несколькими клиентами.</span><span class="sxs-lookup"><span data-stu-id="391de-155">A template can represent a scale unit for multi-tenant environments.</span></span> <span data-ttu-id="391de-156">В этом случае одна инфраструктура используется для поддержки всех клиентов.</span><span class="sxs-lookup"><span data-stu-id="391de-156">In this case, the same infrastructure is used to support all customers.</span></span> <span data-ttu-id="391de-157">Развертывания представляют группу ресурсов, которые определяют емкость размещенных предложений, например количество пользователей и количество транзакций.</span><span class="sxs-lookup"><span data-stu-id="391de-157">The deployments represent a group of resources that deliver a level of capacity for the hosted offering, such as number of users and number of transactions.</span></span> <span data-ttu-id="391de-158">Эти единицы масштабирования увеличиваются или уменьшаются по запросу.</span><span class="sxs-lookup"><span data-stu-id="391de-158">These scale units are increased or decreased as demand requires.</span></span>

### <a name="csv-offering-injected-into-customer-subscription"></a><span data-ttu-id="391de-159">Внедрение предложений поставщиков облачных служб в подписку клиента</span><span class="sxs-lookup"><span data-stu-id="391de-159">CSV offering injected into customer subscription</span></span>
<span data-ttu-id="391de-160">Вам может потребоваться развернуть программное обеспечение в подписки, принадлежащие клиентам.</span><span class="sxs-lookup"><span data-stu-id="391de-160">You may want to deploy your software into subscriptions owned by end customers.</span></span> <span data-ttu-id="391de-161">Вы можете использовать шаблоны для развертывания отдельных развертываний в клиентской учетной записи Azure.</span><span class="sxs-lookup"><span data-stu-id="391de-161">You can use templates to deploy distinct deployments into a customer’s Azure account.</span></span>

<span data-ttu-id="391de-162">Эти развертывания используют RBAC, поэтому вы можете обновлять развертывания и управлять ими в рамках учетной записи клиента.</span><span class="sxs-lookup"><span data-stu-id="391de-162">These deployments use RBAC so you can update and manage the deployment within the customer’s account.</span></span>

### <a name="azure-marketplace"></a><span data-ttu-id="391de-163">Azure Marketplace</span><span class="sxs-lookup"><span data-stu-id="391de-163">Azure Marketplace</span></span>
<span data-ttu-id="391de-164">Если вы хотите рекламировать и продавать предложения через магазин (например, Azure Marketplace), можно разработать шаблоны для предоставления разных типов развертывания, которые будут выполняться в клиентской учетной записи Azure.</span><span class="sxs-lookup"><span data-stu-id="391de-164">To advertise and sell your offerings through a marketplace, such as Azure Marketplace, you can develop templates to deliver distinct types of deployments that run in a customer’s Azure account.</span></span> <span data-ttu-id="391de-165">Эти разные развертывания обычно можно описать с помощью "размеров футболки" (малый, средний, большой), типа продукта и аудитории (сообщество, разработчики, предприятие) или типа функции (базовый, высокий уровень доступности).</span><span class="sxs-lookup"><span data-stu-id="391de-165">These distinct deployments can be typically described as a t-shirt size (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>  <span data-ttu-id="391de-166">В некоторых случаях эти типы позволяют задавать несколько атрибутов развертывания, включая тип виртуальной машины или количество дисков.</span><span class="sxs-lookup"><span data-stu-id="391de-166">In some cases, these types allow you to specify certain attributes of the deployment, such as VM type or number of disks.</span></span>

## <a name="oss-projects"></a><span data-ttu-id="391de-167">Программные проекты с открытым исходным кодом</span><span class="sxs-lookup"><span data-stu-id="391de-167">OSS projects</span></span>
<span data-ttu-id="391de-168">В рамках проектов с открытым исходным кодом шаблоны диспетчера ресурсов позволяют сообществам быстро развертывать решения с использованием проверенных методик.</span><span class="sxs-lookup"><span data-stu-id="391de-168">Within open source projects, Resource Manager templates enable a community to deploy a solution quickly using proven practices.</span></span> <span data-ttu-id="391de-169">Шаблоны можно хранить в репозитории GitHub, чтобы участники сообщества могли изменять их со временем.</span><span class="sxs-lookup"><span data-stu-id="391de-169">You can store templates in a GitHub repository so the community can revise them over time.</span></span> <span data-ttu-id="391de-170">Пользователи могут развертывать эти шаблоны в своих подписках Azure.</span><span class="sxs-lookup"><span data-stu-id="391de-170">Users deploy these templates in their own Azure subscriptions.</span></span>

<span data-ttu-id="391de-171">В следующих разделах описываются моменты, которые следует принять во внимание перед разработкой решения.</span><span class="sxs-lookup"><span data-stu-id="391de-171">The following sections identify the things you need to consider before designing your solution.</span></span>

## <a name="identifying-what-is-outside-and-inside-a-vm"></a><span data-ttu-id="391de-172">Определение внутренних и внешних возможностей виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="391de-172">Identifying what is outside and inside a VM</span></span>
<span data-ttu-id="391de-173">При разработке шаблона полезно оценивать требования ко внешним и внутренним характеристикам виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="391de-173">As you design your template, it’s helpful to look at the requirements in terms of what's outside and inside the virtual machines (VMs):</span></span>

* <span data-ttu-id="391de-174">Внешние характеристики означают саму виртуальную машину и другие ресурсы развертывания, включая топологию сети, теги, ссылки на сертификаты и секреты, а также управление доступом на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="391de-174">Outside means the VMs and other resources of your deployment, such as the network topology, tagging, references to the certs/secrets, and role-based access control.</span></span> <span data-ttu-id="391de-175">Все эти ресурсы являются частью шаблона.</span><span class="sxs-lookup"><span data-stu-id="391de-175">All these resources are part of your template.</span></span>
* <span data-ttu-id="391de-176">Внутренние характеристики включают установленное программное обеспечение и настройку требуемого состояния.</span><span class="sxs-lookup"><span data-stu-id="391de-176">Inside means the installed software and overall desired state configuration.</span></span> <span data-ttu-id="391de-177">Другие механизмы, включая расширения виртуальной машины или сценарии, используются целиком или частично.</span><span class="sxs-lookup"><span data-stu-id="391de-177">Other mechanisms, such as VM extensions or scripts, are used in whole or in part.</span></span> <span data-ttu-id="391de-178">Шаблон может определять и выполнять эти механизмы, но только как внешние по отношению к себе объекты.</span><span class="sxs-lookup"><span data-stu-id="391de-178">These mechanisms may be identified and executed by the template but aren’t in it.</span></span>

<span data-ttu-id="391de-179">Среди наиболее распространенных примеров стандартных выполняемых действий:</span><span class="sxs-lookup"><span data-stu-id="391de-179">Common examples of activities you would do “inside the box” include -</span></span>  

* <span data-ttu-id="391de-180">установка и удаление ролей и компонентов сервера;</span><span class="sxs-lookup"><span data-stu-id="391de-180">Install or remove server roles and features</span></span>
* <span data-ttu-id="391de-181">установка и настройка программного обеспечения на уровне узла или кластера;</span><span class="sxs-lookup"><span data-stu-id="391de-181">Install and configure software at the node or cluster level</span></span>
* <span data-ttu-id="391de-182">развертывание веб-сайтов на веб-сервере;</span><span class="sxs-lookup"><span data-stu-id="391de-182">Deploy websites on a web server</span></span>
* <span data-ttu-id="391de-183">развертывание схем базы данных;</span><span class="sxs-lookup"><span data-stu-id="391de-183">Deploy database schemas</span></span>
* <span data-ttu-id="391de-184">управление реестром или другими типами параметров конфигурации;</span><span class="sxs-lookup"><span data-stu-id="391de-184">Manage registry or other types of configuration settings</span></span>
* <span data-ttu-id="391de-185">управление файлами и каталогами;</span><span class="sxs-lookup"><span data-stu-id="391de-185">Manage files and directories</span></span>
* <span data-ttu-id="391de-186">запуск и остановка процессов и служб, а также управление ими;</span><span class="sxs-lookup"><span data-stu-id="391de-186">Start, stop, and manage processes and services</span></span>
* <span data-ttu-id="391de-187">управление локальными группами и учетными записями пользователей;</span><span class="sxs-lookup"><span data-stu-id="391de-187">Manage local groups and user accounts</span></span>
* <span data-ttu-id="391de-188">установка пакетов и управление ими (файлы MSI и ЕХЕ, yum и т. д.);</span><span class="sxs-lookup"><span data-stu-id="391de-188">Install and manage packages (.msi, .exe, yum, etc.)</span></span>
* <span data-ttu-id="391de-189">настройка переменных среды;</span><span class="sxs-lookup"><span data-stu-id="391de-189">Manage environment variables</span></span>
* <span data-ttu-id="391de-190">запуск собственных скриптов (Windows PowerShell, bash и т. д.).</span><span class="sxs-lookup"><span data-stu-id="391de-190">Run native scripts (Windows PowerShell, bash, etc.)</span></span>

### <a name="desired-state-configuration-dsc"></a><span data-ttu-id="391de-191">Настройка требуемого состояния</span><span class="sxs-lookup"><span data-stu-id="391de-191">Desired state configuration (DSC)</span></span>
<span data-ttu-id="391de-192">Внутреннее состояние виртуальных машин после развертывания предполагает выполнение проверки, которая определяет расхождения с конфигурацией, определенной и отправленной в систему управления версиями.</span><span class="sxs-lookup"><span data-stu-id="391de-192">Thinking about the internal state of your VMs beyond deployment, you want to make sure this deployment doesn’t "drift" from the configuration that you have defined and checked into source control.</span></span> <span data-ttu-id="391de-193">Этот подход предотвращает появление ситуаций, когда разработчики или сотрудники вносят в среду ad-hoc-изменения, которые не были просмотрены, протестированы или записаны в системе управления версиями.</span><span class="sxs-lookup"><span data-stu-id="391de-193">This approach ensures your developers or operations staff don’t make ad-hoc changes to an environment that are not vetted, tested, or recorded in source control.</span></span> <span data-ttu-id="391de-194">Это важно, так как вносимые вручную изменения не регистрируются в системе управления версиями.</span><span class="sxs-lookup"><span data-stu-id="391de-194">This control is important, because the manual changes are not in source control.</span></span> <span data-ttu-id="391de-195">Кроме того, что они не являются частью стандартного развертывания, такие изменения влияют на будущие автоматические развертывания программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="391de-195">They are also not part of the standard deployment and will impact future automated deployments of the software.</span></span>

<span data-ttu-id="391de-196">Помимо управления доступом внутренних сотрудников настройка требуемого состояния имеет большое значение для безопасности.</span><span class="sxs-lookup"><span data-stu-id="391de-196">Beyond your internal employees, desired state configuration is also important from a security perspective.</span></span> <span data-ttu-id="391de-197">Злоумышленники постоянно пытаются нарушить конфиденциальность и воспользоваться программными системами.</span><span class="sxs-lookup"><span data-stu-id="391de-197">Hackers are regularly trying to compromise and exploit software systems.</span></span> <span data-ttu-id="391de-198">Когда им это удается, они, как правило, устанавливают файлы или другим образом изменяют состояние системы, к которой они получили доступ.</span><span class="sxs-lookup"><span data-stu-id="391de-198">When successful, it's common to install files and otherwise change the state of a compromised system.</span></span> <span data-ttu-id="391de-199">С помощью настройки требуемого состояния вы можете определить разницу между требуемым и фактическим состоянием, а также восстановить известную конфигурацию.</span><span class="sxs-lookup"><span data-stu-id="391de-199">Using desired state configuration, you can identify deltas between the desired and actual state and restore a known configuration.</span></span>

<span data-ttu-id="391de-200">Существуют расширения ресурсов для самых популярных механизмов настройки требуемого состояния — PowerShell DSC, Puppet и Chef.</span><span class="sxs-lookup"><span data-stu-id="391de-200">There are resource extensions for the most popular mechanisms for DSC - PowerShell DSC, Chef, and Puppet.</span></span> <span data-ttu-id="391de-201">Каждое из этих расширений может развернуть начальное состояние виртуальной машины. С их помощью также можно проверить, поддерживается ли требуемое состояние.</span><span class="sxs-lookup"><span data-stu-id="391de-201">Each of these extensions can deploy the initial state of your VM and also be used to make sure the desired state is maintained.</span></span>

## <a name="common-template-scopes"></a><span data-ttu-id="391de-202">Общие области действия шаблона</span><span class="sxs-lookup"><span data-stu-id="391de-202">Common template scopes</span></span>
<span data-ttu-id="391de-203">На практике мы сталкиваемся с тремя ключевыми областями действия шаблонов.</span><span class="sxs-lookup"><span data-stu-id="391de-203">In our experience, we’ve seen three key solution templates scopes emerge.</span></span> <span data-ttu-id="391de-204">Эти три области, определяющие емкость, возможности и законченное решение, описаны в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="391de-204">These three scopes – capacity, capability, and end-to-end solution – are described in the following sections.</span></span>

### <a name="capacity-scope"></a><span data-ttu-id="391de-205">Область определения емкости</span><span class="sxs-lookup"><span data-stu-id="391de-205">Capacity scope</span></span>
<span data-ttu-id="391de-206">Область определения емкости предоставляет набор ресурсов в стандартной топологии, который предварительно настроен в соответствии с правилами и политиками.</span><span class="sxs-lookup"><span data-stu-id="391de-206">A capacity scope delivers a set of resources in a standard topology that is pre-configured to be in compliance with regulations and policies.</span></span> <span data-ttu-id="391de-207">Наиболее распространенный пример — это развертывание стандартной среды разработки в сценарии корпоративного ИТ-отдела или системного интегратора.</span><span class="sxs-lookup"><span data-stu-id="391de-207">The most common example is deploying a standard development environment in an Enterprise IT or SI scenario.</span></span>

### <a name="capability-scope"></a><span data-ttu-id="391de-208">Область определения возможностей</span><span class="sxs-lookup"><span data-stu-id="391de-208">Capability scope</span></span>
<span data-ttu-id="391de-209">Область определения возможностей фокусируется на развертывании и настройке топологии для данной технологии.</span><span class="sxs-lookup"><span data-stu-id="391de-209">A capability scope is focused on deploying and configuring a topology for a given technology.</span></span> <span data-ttu-id="391de-210">Типичные сценарии включают такие технологии, как SQL Server, Cassandra, Hadoop и т. д.</span><span class="sxs-lookup"><span data-stu-id="391de-210">Common scenarios including technologies such as SQL Server, Cassandra, Hadoop.</span></span>

### <a name="end-to-end-solution-scope"></a><span data-ttu-id="391de-211">Область законченного решения</span><span class="sxs-lookup"><span data-stu-id="391de-211">End-to-end solution scope</span></span>
<span data-ttu-id="391de-212">Область законченного решения не ограничивается каким-то одним типом возможностей, а задает законченному решению набор возможностей.</span><span class="sxs-lookup"><span data-stu-id="391de-212">An End-to-End Solution Scope is targeted beyond a single capability, and instead focused on delivering an end to end solution comprised of multiple capabilities.</span></span>  

<span data-ttu-id="391de-213">Область действия шаблона, определяющего решение, представляет собой некий набор. Этот набор состоит из одного или нескольких шаблонов, определяющих возможности, со специальными ресурсами, логикой и требуемым состоянием конкретного решения.</span><span class="sxs-lookup"><span data-stu-id="391de-213">A solution-scoped template scope manifests itself as a set of one or more capability-scoped templates with solution-specific resources, logic, and desired state.</span></span> <span data-ttu-id="391de-214">Пример шаблона, определяющего решение, — шаблон законченного решения конвейера данных.</span><span class="sxs-lookup"><span data-stu-id="391de-214">An example of a solution-scoped template is an end to end data pipeline solution template.</span></span> <span data-ttu-id="391de-215">Этот шаблон может сочетать топологию и состояние конкретного решения с несколькими шаблонами решений, определяющими возможности, включая Kafka, Storm и Hadoop.</span><span class="sxs-lookup"><span data-stu-id="391de-215">The template might mix solution-specific topology and state with multiple capability-scoped solution templates such as Kafka, Storm, and Hadoop.</span></span>

## <a name="choosing-free-form-vs-known-configurations"></a><span data-ttu-id="391de-216">Конфигурации свободной формы и известные конфигурации</span><span class="sxs-lookup"><span data-stu-id="391de-216">Choosing free-form vs. known configurations</span></span>
<span data-ttu-id="391de-217">Может показаться, что использование шаблона обеспечивает клиентам наибольшую гибкость. Тем не менее, выбор между использованием конфигураций свободной формы или известных конфигураций зависит от множества факторов.</span><span class="sxs-lookup"><span data-stu-id="391de-217">You might initially think a template should give consumers the utmost flexibility, but many considerations affect the choice of whether to use free-form configurations vs. known configurations.</span></span> <span data-ttu-id="391de-218">В этом разделе указаны ключевые требования клиента и технические вопросы, которые формируют описанный в этом документе подход.</span><span class="sxs-lookup"><span data-stu-id="391de-218">This section identifies the key customer requirements and technical considerations that shaped the approach shared in this document.</span></span>

### <a name="free-form-configurations"></a><span data-ttu-id="391de-219">Конфигурации свободной формы</span><span class="sxs-lookup"><span data-stu-id="391de-219">Free-form configurations</span></span>
<span data-ttu-id="391de-220">На первый взгляд, конфигурации свободной формы являются идеальным решением.</span><span class="sxs-lookup"><span data-stu-id="391de-220">On the surface, free-form configurations sound ideal.</span></span> <span data-ttu-id="391de-221">Они позволяют выбрать тип виртуальной машины и использовать произвольное количество узлов и подключенных дисков для этих узлов, реализуя эти действия в качестве параметров шаблона.</span><span class="sxs-lookup"><span data-stu-id="391de-221">They allow you to select a VM type and provide an arbitrary number of nodes and attached disks for those nodes — and do so as parameters to a template.</span></span> <span data-ttu-id="391de-222">Тем не менее этот подход не подходит для некоторых сценариев.</span><span class="sxs-lookup"><span data-stu-id="391de-222">However, this approach is not ideal for some scenarios.</span></span>

<span data-ttu-id="391de-223">В статье [Размеры виртуальных машин](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) определяются разные типы виртуальных машин, доступные размеры и количество надежных дисков (2, 4, 8, 16 или 32), которые можно подключить.</span><span class="sxs-lookup"><span data-stu-id="391de-223">In [Sizes for virtual machines](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), the different VM types and available sizes are identified, and each of the number of durable disks (2, 4, 8, 16, or 32) that can be attached.</span></span> <span data-ttu-id="391de-224">Каждый подключенный диск выполняет 500 операций ввода-вывода в секунду; несколько таких дисков могут быть объединены для увеличения этого показателя.</span><span class="sxs-lookup"><span data-stu-id="391de-224">Each attached disk provides 500 IOPS and multiples of these disks can be pooled for a multiplier of that number of IOPS.</span></span> <span data-ttu-id="391de-225">Например, 16 объединенных дисков выполняют 8000 операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="391de-225">For example, 16 disks can be pooled to provide 8,000 IOPS.</span></span> <span data-ttu-id="391de-226">Настройка параметров объединения в операционной системе выполняется с помощью дисковых пространств (Майкрософт) в ОС Windows или избыточного массива независимых дисков (RAID) в ОС Linux.</span><span class="sxs-lookup"><span data-stu-id="391de-226">Pooling is done with configuration in the operating system, using Microsoft Windows Storage Spaces or redundant array of inexpensive disks (RAID) in Linux.</span></span>

<span data-ttu-id="391de-227">Конфигурации свободной формы позволяют выбирать количество экземпляров виртуальных машин, количество разных типов виртуальных машин и размеры этих экземпляров, количество дисков по типу виртуальной машины, а также один или несколько сценариев для настройки содержимого виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="391de-227">A free-form configuration enables the selection several VM instances, various VM types and sizes for those instances, various disks for the VM type, and one or more scripts to configure the VM contents.</span></span>

<span data-ttu-id="391de-228">Чаще всего развертывание может иметь несколько типов узлов, включая главные узлы и узлы данных, поэтому гибкое использование обеспечивается для каждого типа узла.</span><span class="sxs-lookup"><span data-stu-id="391de-228">It is common that a deployment may have multiple types of nodes, such as master and data nodes, so this flexibility is often provided for every node type.</span></span>

<span data-ttu-id="391de-229">Прежде чем развернуть кластер любой значимости, начните работу с этими сложными сценариями.</span><span class="sxs-lookup"><span data-stu-id="391de-229">As you start to deploy clusters of any significance, you begin to work with these complex scenarios.</span></span> <span data-ttu-id="391de-230">Например, при развертывании кластера Hadoop с 8 главными узлами и 200 узлами данных, а также 4 объединенными дисками, подключенными к каждому главному узлу, и 16 объединенными дисками, подключенными к каждому узлу данных, вам необходимо управлять 208 виртуальными машинами и 3232 дисками.</span><span class="sxs-lookup"><span data-stu-id="391de-230">If you were deploying a Hadoop cluster, for example, with 8 master nodes and 200 data nodes, and pooled 4 attached disks on each master node and pooled 16 attached disks per data node, you would have 208 VMs and 3,232 disks to manage.</span></span>

<span data-ttu-id="391de-231">Поскольку учетная запись хранения будет регулировать запросы, превышающие определенный лимит в 20 000 транзакций в секунду, рассмотрите возможность разделения учетной записи хранилища и использования вычислений, чтобы определить соответствующее количество учетных записей хранилища для размещения этой топологии.</span><span class="sxs-lookup"><span data-stu-id="391de-231">A storage account will throttle requests above its identified 20,000 transactions/second limit, so you should look at storage account partitioning and use calculations to determine the appropriate number of storage accounts to accommodate this topology.</span></span> <span data-ttu-id="391de-232">Учитывая множество сочетаний, поддерживаемых подходом с использованием свободной формы, для определения соответствующих разделов требуются динамические вычисления.</span><span class="sxs-lookup"><span data-stu-id="391de-232">Given the multitude of combinations supported by the free-form approach, dynamic calculations are required to determine the appropriate partitioning.</span></span> <span data-ttu-id="391de-233">Поскольку язык шаблона диспетчера ресурсов Azure в настоящее время не позволяет использовать математические функции, вам необходимо выполнить эти вычисления в коде, создав уникальный жестко заданный шаблон с соответствующими свойствами.</span><span class="sxs-lookup"><span data-stu-id="391de-233">The Azure Resource Manager Template Language does not presently provide mathematical functions, so you must perform these calculations in code, generating a unique, hard-coded template with the appropriate details.</span></span>

<span data-ttu-id="391de-234">В сценариях корпоративных ИТ-отделов и системных интеграторов кто-то должен обслуживать шаблоны и обеспечивать поддержку для развернутых топологий для одной или нескольких организаций.</span><span class="sxs-lookup"><span data-stu-id="391de-234">In enterprise IT and SI scenarios, someone must maintain the templates and support the deployed topologies for one or more organizations.</span></span> <span data-ttu-id="391de-235">Эти дополнительные издержки — наличие разных конфигураций и шаблонов для каждого клиента — сложно назвать идеальным вариантом.</span><span class="sxs-lookup"><span data-stu-id="391de-235">This additional overhead — different configurations and templates for each customer — is far from desirable.</span></span>

<span data-ttu-id="391de-236">Эти шаблоны можно использовать для развертывания сред в рамках подписки клиента Azure. Корпоративные ИТ-отделы и поставщики облачных служб обычно развертывают их в своих подписках, используя функцию взимания средств за использование для выставления счетов клиентам.</span><span class="sxs-lookup"><span data-stu-id="391de-236">You can use these templates to deploy environments in your customer’s Azure subscription, but both corporate IT teams and CSVs typically deploy them into their own subscriptions, using a chargeback function to bill their customers.</span></span> <span data-ttu-id="391de-237">Цель этих сценариев — развертывание ресурсов для нескольких клиентов в рамках пула подписок, а также плотное заполнение подписок развертываниями во избежание разрастания инфраструктуры, требующей управления.</span><span class="sxs-lookup"><span data-stu-id="391de-237">In these scenarios, the goal is to deploy capacity for multiple customers across a pool of subscriptions and keep deployments densely populated into the subscriptions to minimize subscription sprawl—that is, more subscriptions to manage.</span></span> <span data-ttu-id="391de-238">Из-за действительно динамических размеров развертывания реализация этого типа плотности требует тщательного планирования и дополнительной разработки для скаффолдинга от имени организации.</span><span class="sxs-lookup"><span data-stu-id="391de-238">With truly dynamic deployment sizes, achieving this type of density requires careful planning and additional development for scaffolding work on behalf of the organization.</span></span>

<span data-ttu-id="391de-239">Более того, так как создавать подписки через вызов API невозможно, это необходимо делать на портале вручную.</span><span class="sxs-lookup"><span data-stu-id="391de-239">In addition, you can’t create subscriptions via an API call but must do so manually through the portal.</span></span> <span data-ttu-id="391de-240">Разрастание инфраструктуры из-за роста количества подписок требует вмешательства пользователя. Это регулирование не может быть автоматизировано.</span><span class="sxs-lookup"><span data-stu-id="391de-240">As the number of subscriptions increases, any resulting subscription sprawl requires human intervention—it can’t be automated.</span></span> <span data-ttu-id="391de-241">Из-за большого разнообразия размеров развертываний вам потребуется выполнять предварительную подготовку множества подписок вручную для обеспечения их доступности.</span><span class="sxs-lookup"><span data-stu-id="391de-241">With so much variability in the sizes of deployments, you would have to pre-provision a number of subscriptions manually to ensure subscriptions are available.</span></span>

<span data-ttu-id="391de-242">Учитывая все эти факторы, конфигурации свободной формы являются в реальности менее привлекательным решением, чем на первый взгляд.</span><span class="sxs-lookup"><span data-stu-id="391de-242">Considering all these factors, a truly free-form configuration is less appealing than at first blush.</span></span>

### <a name="known-configurations--the-t-shirt-sizing-approach"></a><span data-ttu-id="391de-243">Известные конфигурации — подход «размер футболки»</span><span class="sxs-lookup"><span data-stu-id="391de-243">Known configurations — the t-shirt sizing approach</span></span>
<span data-ttu-id="391de-244">Распространенной альтернативой использованию шаблона, который обеспечивает гибкость и множество вариантов, является предоставление возможности выбора известных конфигураций. Фактически размеры песочницы определяются по аналогии со стандартными размерами футболки (малый, средний и большой).</span><span class="sxs-lookup"><span data-stu-id="391de-244">Rather than offer a template that provides total flexibility and countless variations, in our experience a common pattern is to provide the ability to select known configurations — in effect, standard t-shirt sizes such as sandbox, small, medium, and large.</span></span> <span data-ttu-id="391de-245">Другие примеры использования этого подхода включают такие продукты, как Community Edition или Enterprise Edition.</span><span class="sxs-lookup"><span data-stu-id="391de-245">Other examples of t-shirt sizes are product offerings, such as community edition or enterprise edition.</span></span>  <span data-ttu-id="391de-246">Другие случаи могут быть представлены конфигурациями технологий, зависящими от рабочей нагрузки, включая решения Map/Reduce или NoSQL.</span><span class="sxs-lookup"><span data-stu-id="391de-246">In other cases, it may be workload-specific configurations of a technology – such as map reduce or no sql.</span></span>

<span data-ttu-id="391de-247">Многие корпоративные ИТ-отделы, поставщики программного обеспечения с открытым исходным кодом и системные интеграторы предоставляют свои продукты локально, в виртуализованных средах (предприятия) или в качестве программного обеспечения как услуги (SaaS) (поставщики облачных служб и поставщики решений с открытым исходным кодом).</span><span class="sxs-lookup"><span data-stu-id="391de-247">Many enterprise IT organizations, OSS vendors, and SIs make their offerings available today in this way in on-premises, virtualized environments (enterprises) or as software-as-a-service (SaaS) offerings (CSVs and OSVs).</span></span>

<span data-ttu-id="391de-248">Такой подход позволяет использовать хорошие и известные конфигурации разных размеров, предварительно настроенные для клиентов.</span><span class="sxs-lookup"><span data-stu-id="391de-248">This approach provides good, known configurations of varying sizes that are preconfigured for customers.</span></span> <span data-ttu-id="391de-249">Если пользователи не используют известные конфигурации, им необходимо определять размеры кластеров самостоятельно, учитывая ограничения ресурсов платформы и выполняя математические вычисления для определения итогового разделения учетных записей хранилища и других ресурсов (из-за ограничений, связанных с размерами кластеров и ресурсами).</span><span class="sxs-lookup"><span data-stu-id="391de-249">Without known configurations, end customers must determine cluster sizing on their own, factor in platform resource constraints, and do math to identify the resulting partitioning of storage accounts and other resources (due to cluster size and resource constraints).</span></span> <span data-ttu-id="391de-250">Известные конфигурации позволяют пользователям легко выбирать нужный размер по аналогии с выбором размера футболки, в данном случае — конкретного развертывания.</span><span class="sxs-lookup"><span data-stu-id="391de-250">Known configurations enable customers to easily select the right t-shirt size—that is, a given deployment.</span></span> <span data-ttu-id="391de-251">Кроме оптимизации возможностей для клиента, небольшое количество известных конфигураций также проще обслуживать. Кроме того, вы получаете более высокий уровень плотности.</span><span class="sxs-lookup"><span data-stu-id="391de-251">In addition to making a better experience for the customer, a small number of known configurations is easier to support and can help you deliver a higher level of density.</span></span>

<span data-ttu-id="391de-252">Подход с применением известной конфигурации по методу «размер футболки» также характеризуется переменным количеством узлов одного размера.</span><span class="sxs-lookup"><span data-stu-id="391de-252">A known configuration approach focused on t-shirt sizes may also have varying number of nodes within a size.</span></span> <span data-ttu-id="391de-253">Например, «футболка» малого размера может включать от 3 до 10 узлов.</span><span class="sxs-lookup"><span data-stu-id="391de-253">For example, a small t-shirt size may be between 3 and 10 nodes.</span></span>  <span data-ttu-id="391de-254">Подход «размер футболки» позволяет включать до 10 узлов, предоставляя клиенту возможность выбора свободной формы вплоть до максимального определенного размера.</span><span class="sxs-lookup"><span data-stu-id="391de-254">The t-shirt size would be designed to accommodate up to 10 nodes and provide the consumer the ability to make free form selections up to the maximum size identified.</span></span>  

<span data-ttu-id="391de-255">Задаваемый по этому методу размер, основывающийся на типе рабочей нагрузки, может иметь гораздо более произвольный характер с точки зрения количества узлов, которые могут быть развернуты. При этом вы получите определенный размер узла рабочей нагрузки и конфигурацию программного обеспечения, установленного на этом узле.</span><span class="sxs-lookup"><span data-stu-id="391de-255">A t-shirt size based on workload type, may be more free form in nature in terms of the number of nodes that can be deployed but will have workload distinct node size and configuration of the software on the node.</span></span>

<span data-ttu-id="391de-256">Зависящие от особенностей продукта (Community Edition или Enterprise Edition) «размеры футболки» могут включать разные типы ресурсов и максимальное количество узлов, которые могут быть развернуты. Обычно это связано с особенностями лицензирования или доступностью функций разных продуктов.</span><span class="sxs-lookup"><span data-stu-id="391de-256">T-shirt sizes based on product offerings, such as community or Enterprise, may have distinct resource types and maximum number of nodes that can be deployed, typically tied to licensing considerations or feature availability across the different offerings.</span></span>

<span data-ttu-id="391de-257">Вы также можете предложить клиентам уникальные варианты с использованием шаблонов на основе JSON.</span><span class="sxs-lookup"><span data-stu-id="391de-257">You can also accommodate customers with unique variants using the JSON-based templates.</span></span> <span data-ttu-id="391de-258">При работе с выбросами можно включить соответствующее планирование и рекомендации по разработке, поддержке и учету затрат.</span><span class="sxs-lookup"><span data-stu-id="391de-258">When dealing with outliers, you can incorporate the appropriate planning and considerations for development, support, and costing.</span></span>

<span data-ttu-id="391de-259">Подход к декомпозиции шаблонов мы определили на основе сценариев использования шаблона клиентом, а также требований, описанных в начале этого документа.</span><span class="sxs-lookup"><span data-stu-id="391de-259">Based on the customer template consumption scenarios, and requirements identified at the start of this document, we identified a pattern for template decomposition.</span></span>

## <a name="capacity-and-capability-scoped-solution-templates"></a><span data-ttu-id="391de-260">Шаблоны решений, определяющие емкость и возможности</span><span class="sxs-lookup"><span data-stu-id="391de-260">Capacity and capability-scoped solution templates</span></span>
<span data-ttu-id="391de-261">Декомпозиция предоставляет модульный подход к разработке шаблонов, поддерживая возможности повторного использования, расширяемости, тестирования и применения средств.</span><span class="sxs-lookup"><span data-stu-id="391de-261">Decomposition provides a modular approach to template development that supports reuse, extensibility, testing, and tooling.</span></span> <span data-ttu-id="391de-262">В этом разделе содержится подробное описание применения декомпозиции к шаблонам, определяющим возможности или емкость.</span><span class="sxs-lookup"><span data-stu-id="391de-262">This section provides detail on how a decomposition approach can be applied to templates with a Capacity or Capability scope.</span></span>

<span data-ttu-id="391de-263">В рамках этого подхода основной шаблон получает значения параметров из шаблона клиента, связывая их затем с несколькими типами шаблонов и скриптами на более низком уровне, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="391de-263">In this approach, a main template receives parameter values from a template consumer, then links to several types of templates and scripts downstream as shown below.</span></span> <span data-ttu-id="391de-264">Параметры, а также статические и созданные переменные используются для предоставления значений связанным шаблонам и за их пределами.</span><span class="sxs-lookup"><span data-stu-id="391de-264">Parameters, static variables, and generated variables are used to provide values in and out of the linked templates.</span></span>

![Параметры шаблона](./media/best-practices-resource-manager-design-templates/template-parameters.png)

<span data-ttu-id="391de-266">**Параметры передаются в основной шаблон, а затем в связанные шаблоны**</span><span class="sxs-lookup"><span data-stu-id="391de-266">**Parameters are passed to a main template then to linked templates**</span></span>

<span data-ttu-id="391de-267">В следующих разделах подробно описаны типы шаблонов и скриптов, на которые можно разложить один шаблон.</span><span class="sxs-lookup"><span data-stu-id="391de-267">The following sections focus on the types of templates and scripts that a single template is decomposed into.</span></span> <span data-ttu-id="391de-268">Кроме того, здесь рассматриваются подходы к передаче шаблонам сведений о состоянии.</span><span class="sxs-lookup"><span data-stu-id="391de-268">The sections present approaches for passing state information among the templates.</span></span> <span data-ttu-id="391de-269">Каждый описанный тип шаблонов и скриптов приводится вместе с примерами.</span><span class="sxs-lookup"><span data-stu-id="391de-269">Each template and the script types in the image are described along with examples.</span></span> <span data-ttu-id="391de-270">Контекстные примеры см. в разделе «Сборка: пример реализации» далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="391de-270">For a contextual example, see "Putting it together: a sample implementation" later in this document.</span></span>

### <a name="template-metadata"></a><span data-ttu-id="391de-271">Метаданные шаблона</span><span class="sxs-lookup"><span data-stu-id="391de-271">Template metadata</span></span>
<span data-ttu-id="391de-272">Метаданные шаблона (файл metadata.json) содержат пары «ключ — значение», описывающие шаблон в формате JSON, который может быть прочитан человеком и программными системами.</span><span class="sxs-lookup"><span data-stu-id="391de-272">Template metadata (the metadata.json file) contains key/value pairs that describe a template in JSON, which can be read by humans and software systems.</span></span>

![Метаданные шаблона](./media/best-practices-resource-manager-design-templates/template-metadata.png)

<span data-ttu-id="391de-274">**Метаданные шаблона описываются в файле metadata.json**</span><span class="sxs-lookup"><span data-stu-id="391de-274">**Template metadata is described in the metadata.json file**</span></span>

<span data-ttu-id="391de-275">Агенты программного обеспечения могут получить файл metadata.json и опубликовать сведения и ссылку на шаблон на веб-странице или в каталоге.</span><span class="sxs-lookup"><span data-stu-id="391de-275">Software agents can retrieve the metadata.json file and publish the information and a link to the template in a web page or directory.</span></span> <span data-ttu-id="391de-276">Элементы включают: *itemDisplayName*, *description*, *summary*, *githubUsername* и *dateUpdated*.</span><span class="sxs-lookup"><span data-stu-id="391de-276">Elements include *itemDisplayName*, *description*, *summary*, *githubUsername*, and *dateUpdated*.</span></span>

<span data-ttu-id="391de-277">Ниже приведен пример файла целиком.</span><span class="sxs-lookup"><span data-stu-id="391de-277">An example file is shown below in its entirety.</span></span>

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### <a name="main-template"></a><span data-ttu-id="391de-278">Основной шаблон</span><span class="sxs-lookup"><span data-stu-id="391de-278">Main template</span></span>
<span data-ttu-id="391de-279">Основной шаблон получает параметры от пользователя, использует эти сведения для заполнения переменных сложного объекта, а также выполняет связанные шаблоны.</span><span class="sxs-lookup"><span data-stu-id="391de-279">The main template receives parameters from a user, uses that information to populate complex object variables, and executes the linked templates.</span></span>

![Основной шаблон](./media/best-practices-resource-manager-design-templates/main-template.png)

<span data-ttu-id="391de-281">**Основной шаблон получает параметры от пользователя**</span><span class="sxs-lookup"><span data-stu-id="391de-281">**The main template receives parameters from a user**</span></span>

<span data-ttu-id="391de-282">Один из предоставляемых параметров — это тип известной конфигурации, также известный как параметр «размер футболки» из-за его стандартизированных значений (малый, средний и большой).</span><span class="sxs-lookup"><span data-stu-id="391de-282">One parameter that is provided is a known configuration type also known as the t-shirt size parameter because of its standardized values such as small, medium, or large.</span></span> <span data-ttu-id="391de-283">На практике этот параметр можно использовать разными способами.</span><span class="sxs-lookup"><span data-stu-id="391de-283">In practice, you can use this parameter in multiple ways.</span></span> <span data-ttu-id="391de-284">Дополнительные сведения см. в разделе «Шаблоны ресурсов известной конфигурации» далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="391de-284">For details, see "Known configuration resources template" later in this document.</span></span>

<span data-ttu-id="391de-285">Некоторые ресурсы развертываются независимо от известной конфигурации, задаваемой указанным пользователем параметром.</span><span class="sxs-lookup"><span data-stu-id="391de-285">Some resources are deployed regardless of the known configuration specified by a user parameter.</span></span> <span data-ttu-id="391de-286">Эти ресурсы настраиваются с помощью одного шаблона общих ресурсов и совместно используются другими шаблонами, при этом шаблон общих ресурсов выполняется первым.</span><span class="sxs-lookup"><span data-stu-id="391de-286">These resources are provisioned using a single shared resource template and are shared by other templates, so the shared resource template is run first.</span></span>

<span data-ttu-id="391de-287">Некоторые ресурсы будут развернуты при необходимости независимо от указанной известной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="391de-287">Some resources are deployed optionally regardless of the specified known configuration.</span></span>

### <a name="shared-resources-template"></a><span data-ttu-id="391de-288">Шаблон общих ресурсов</span><span class="sxs-lookup"><span data-stu-id="391de-288">Shared resources template</span></span>
<span data-ttu-id="391de-289">Этот шаблон предоставляет ресурсы, которые являются общими для всех известных конфигураций.</span><span class="sxs-lookup"><span data-stu-id="391de-289">This template delivers resources that are common across all known configurations.</span></span> <span data-ttu-id="391de-290">Он содержит виртуальную сеть, группы доступности и другие ресурсы, которые требуются независимо от развертываемого шаблона известной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="391de-290">It contains the virtual network, availability sets, and other resources that are required regardless of the known configuration template that is deployed.</span></span>

![Ресурсы шаблона](./media/best-practices-resource-manager-design-templates/template-resources.png)

<span data-ttu-id="391de-292">**Шаблон общих ресурсов**</span><span class="sxs-lookup"><span data-stu-id="391de-292">**Shared resources template**</span></span>

<span data-ttu-id="391de-293">Имена ресурсов, включая имя виртуальной сети, основываются на основном шаблоне.</span><span class="sxs-lookup"><span data-stu-id="391de-293">Resource names, such as the virtual network name, are based on the main template.</span></span> <span data-ttu-id="391de-294">Можно указать их в качестве переменной в рамках этого шаблона или получить их в качестве параметра от пользователя в соответствии с требованиями вашей организации.</span><span class="sxs-lookup"><span data-stu-id="391de-294">You can specify them as a variable within that template or receive them as a parameter from the user, as required by your organization.</span></span>

### <a name="optional-resources-template"></a><span data-ttu-id="391de-295">Шаблон дополнительных ресурсов</span><span class="sxs-lookup"><span data-stu-id="391de-295">Optional resources template</span></span>
<span data-ttu-id="391de-296">Шаблон дополнительных ресурсов содержит ресурсы, которые развертываются программным способом на основе значения параметра или переменной.</span><span class="sxs-lookup"><span data-stu-id="391de-296">The optional resources template contains resources that are programmatically deployed based on the value of a parameter or variable.</span></span>

![Дополнительные ресурсы](./media/best-practices-resource-manager-design-templates/optional-resources.png)

<span data-ttu-id="391de-298">**Шаблон дополнительных ресурсов**</span><span class="sxs-lookup"><span data-stu-id="391de-298">**Optional resources template**</span></span>

<span data-ttu-id="391de-299">Например, вы можете использовать шаблон дополнительных ресурсов для настройки основной виртуальной машины, предоставляющей непрямой доступ к развернутой среде из общедоступного сегмента Интернета.</span><span class="sxs-lookup"><span data-stu-id="391de-299">For example, you can use an optional resources template to configure a jumpbox that enables indirect access to a deployed environment from the public Internet.</span></span> <span data-ttu-id="391de-300">Параметр или переменную можно использовать, чтобы определить необходимость включения основной виртуальной машины и функции *concat* для создания целевого имени шаблона, такого как *jumpbox_enabled.json*.</span><span class="sxs-lookup"><span data-stu-id="391de-300">You would use a parameter or variable to identify whether the jumpbox should be enabled and the *concat* function to build the target name for the template, such as *jumpbox_enabled.json*.</span></span> <span data-ttu-id="391de-301">Для установки основной виртуальной машины связывание шаблона будет использовать результирующую переменную.</span><span class="sxs-lookup"><span data-stu-id="391de-301">Template linking would use the resulting variable to install the jumpbox.</span></span>

<span data-ttu-id="391de-302">Вы можете связать шаблон дополнительных ресурсов из нескольких мест.</span><span class="sxs-lookup"><span data-stu-id="391de-302">You can link the optional resources template from multiple places:</span></span>

* <span data-ttu-id="391de-303">Если это применимо, создавайте для каждого развертывания управляемую параметрами ссылку из шаблона общих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="391de-303">When applicable to every deployment, create a parameter-driven link from the shared resources template.</span></span>
* <span data-ttu-id="391de-304">Если это применимо, выбирайте известные конфигурации — например, устанавливайте решения только в больших развертываниях — создавайте управляемые параметрами или переменными ссылки из шаблона известной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="391de-304">When applicable to select known configurations—for example, only install on large deployments—create a parameter-driven or variable-driven link from the known configuration template.</span></span>

<span data-ttu-id="391de-305">Если данный ресурс является дополнительным, он может управляться не пользователем шаблона, а его поставщиком.</span><span class="sxs-lookup"><span data-stu-id="391de-305">Whether a given resource is optional may not be driven by the template consumer but instead by the template provider.</span></span> <span data-ttu-id="391de-306">Например, вам может потребоваться удовлетворить конкретные требования к продукту или его надстройке (поставщики облачных служб) либо соблюсти политики (системные интеграторы и корпоративные ИТ-отделы).</span><span class="sxs-lookup"><span data-stu-id="391de-306">For example, you may need to satisfy a particular product requirement or product add-on (common for CSVs) or to enforce policies (common for SIs and enterprise IT groups).</span></span> <span data-ttu-id="391de-307">В этих случаях можно использовать переменную, чтобы определить необходимость развертывания ресурса.</span><span class="sxs-lookup"><span data-stu-id="391de-307">In these cases, you can use a variable to identify whether the resource should be deployed.</span></span>

### <a name="known-configuration-resources-template"></a><span data-ttu-id="391de-308">Шаблон известной конфигурации ресурсов</span><span class="sxs-lookup"><span data-stu-id="391de-308">Known configuration resources template</span></span>
<span data-ttu-id="391de-309">В основном шаблоне параметр может быть доступен для предоставления пользователю шаблона возможности указывать требуемую известную конфигурацию для развертывания.</span><span class="sxs-lookup"><span data-stu-id="391de-309">In the main template, a parameter can be exposed to allow the template consumer to specify a desired known configuration to deploy.</span></span> <span data-ttu-id="391de-310">Зачастую эта известная конфигурация использует подход "размер футболки" с набором фиксированных размеров конфигураций песочницы: малый, средний и большой.</span><span class="sxs-lookup"><span data-stu-id="391de-310">Often, this known configuration uses a t-shirt size approach with a set of fixed configuration sizes such as sandbox, small, medium, and large.</span></span>

![Ресурсы известной конфигурации](./media/best-practices-resource-manager-design-templates/known-config.png)

<span data-ttu-id="391de-312">**Шаблон известной конфигурации ресурсов**</span><span class="sxs-lookup"><span data-stu-id="391de-312">**Known configuration resources template**</span></span>

<span data-ttu-id="391de-313">Подход «размер футболки» используется повсеместно; при этом параметры могут представлять любой набор известных конфигураций.</span><span class="sxs-lookup"><span data-stu-id="391de-313">The t-shirt size approach is commonly used, but the parameters can represent any set of known configurations.</span></span> <span data-ttu-id="391de-314">Например, вы можете указать набор сред для корпоративного приложения, включая среды для разработки, тестирования и производства.</span><span class="sxs-lookup"><span data-stu-id="391de-314">For example, you can specify a set of environments for an enterprise application such as Development, Test, and Product.</span></span> <span data-ttu-id="391de-315">Или же вы можете использовать его для облачной службы, чтобы представлять разные единицы масштабирования, версии или конфигурации продукта для сообщества, разработчиков или организаций.</span><span class="sxs-lookup"><span data-stu-id="391de-315">Or you could use it for a cloud service to represent different scale units, product versions, or product configurations such as Community, Developer, or Enterprise.</span></span>

<span data-ttu-id="391de-316">Как и в случае с шаблоном общих ресурсов, переменные передаются шаблону известных конфигураций следующим образом.</span><span class="sxs-lookup"><span data-stu-id="391de-316">As with the shared resource template, variables are passed to the known configurations template from either:</span></span>

* <span data-ttu-id="391de-317">От конечного пользователя — параметры передаются основному шаблону.</span><span class="sxs-lookup"><span data-stu-id="391de-317">An end user—that is, the parameters sent to the main template.</span></span>
* <span data-ttu-id="391de-318">От организации — переменные в основном шаблоне представляют внутренние требования или политики.</span><span class="sxs-lookup"><span data-stu-id="391de-318">An organization—that is, the variables in the main template that represent internal requirements or policies.</span></span>

### <a name="member-resources-template"></a><span data-ttu-id="391de-319">Шаблон элемента ресурсов</span><span class="sxs-lookup"><span data-stu-id="391de-319">Member resources template</span></span>
<span data-ttu-id="391de-320">В известную конфигурацию часто включены один или несколько типов элементов узла.</span><span class="sxs-lookup"><span data-stu-id="391de-320">Within a known configuration, one or more member node types are often included.</span></span> <span data-ttu-id="391de-321">Например, при работе с Hadoop у вас есть основные узлы и узлы данных.</span><span class="sxs-lookup"><span data-stu-id="391de-321">For example, with Hadoop you have master nodes and data nodes.</span></span> <span data-ttu-id="391de-322">При установке MongoDB у вас будут узлы данных и арбитр.</span><span class="sxs-lookup"><span data-stu-id="391de-322">If you are installing MongoDB, you have data nodes and an arbiter.</span></span> <span data-ttu-id="391de-323">При развертывании DataStax у вас будут узлы данных, а также ВМ с установленной службой OpsCenter.</span><span class="sxs-lookup"><span data-stu-id="391de-323">If you are deploying DataStax, you have data nodes and a VM with OpsCenter installed.</span></span>

![Ресурсы элементов](./media/best-practices-resource-manager-design-templates/member-resources.png)

<span data-ttu-id="391de-325">**Шаблон элемента ресурсов**</span><span class="sxs-lookup"><span data-stu-id="391de-325">**Member resources template**</span></span>

<span data-ttu-id="391de-326">Каждый тип узлов может иметь разные размеры виртуальной машины, некоторое количество подключенных дисков, скрипты для установки и настройки узлов, конфигурации порта для виртуальной машины, некоторое количество экземпляров и другие сведения.</span><span class="sxs-lookup"><span data-stu-id="391de-326">Each type of nodes can have different sizes of VMs, numbers of attached disks, scripts to install and set up the nodes, port configurations for the VMs, number of instances, and other details.</span></span> <span data-ttu-id="391de-327">Поэтому каждый тип узла получает свой собственный шаблон элемента ресурсов, который содержит сведения о развертывании и настройке инфраструктуры, а также о выполнении скриптов для развертывания и настройки программного обеспечения в виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="391de-327">So each node type gets its own member resource template, which contains the details for deploying and configuring an infrastructure as well as executing scripts to deploy and configure software within the VM.</span></span>

<span data-ttu-id="391de-328">Для виртуальной машины обычно используется два типа скриптов: повторно используемые и пользовательские.</span><span class="sxs-lookup"><span data-stu-id="391de-328">For VMs, typically two types of scripts are used, widely reusable and custom scripts.</span></span>

### <a name="widely-reusable-scripts"></a><span data-ttu-id="391de-329">Повторно используемые скрипты</span><span class="sxs-lookup"><span data-stu-id="391de-329">Widely reusable scripts</span></span>
<span data-ttu-id="391de-330">Повторно используемые скрипты можно использовать для нескольких типов шаблонов.</span><span class="sxs-lookup"><span data-stu-id="391de-330">Widely reusable scripts can be used across multiple types of templates.</span></span> <span data-ttu-id="391de-331">Один из лучших примеров — повторное использование скриптов, настраивающих RAID в ОС Linux для объединения дисков и увеличения частоты операций ввода-вывода в секунду.</span><span class="sxs-lookup"><span data-stu-id="391de-331">One of the better examples of these widely reusable scripts sets up RAID on Linux to pool disks and gain a greater number of IOPS.</span></span> <span data-ttu-id="391de-332">Независимо от программного обеспечения, установленного в виртуальной машине, этот скрипт обеспечивает повторное использование проверенных методик для распространенных сценариев.</span><span class="sxs-lookup"><span data-stu-id="391de-332">Regardless of the software being installed in the VM, this script provides reuse of proven practices for common scenarios.</span></span>

![Скрипты повторного использования](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

<span data-ttu-id="391de-334">**Шаблоны элементов ресурсов могут вызывать повторно используемые скрипты**</span><span class="sxs-lookup"><span data-stu-id="391de-334">**Member resources templates can call widely reusable scripts**</span></span>

### <a name="custom-scripts"></a><span data-ttu-id="391de-335">Пользовательские скрипты</span><span class="sxs-lookup"><span data-stu-id="391de-335">Custom scripts</span></span>
<span data-ttu-id="391de-336">Шаблоны часто вызывают один или несколько скриптов, отвечающих за установку и настройку программного обеспечения в виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="391de-336">Templates commonly call one or more scripts that install and configure software within VMs.</span></span> <span data-ttu-id="391de-337">Общий шаблон используется с большими топологиями, в которых развернуто несколько экземпляров одного или нескольких типов элементов.</span><span class="sxs-lookup"><span data-stu-id="391de-337">A common pattern is seen with large topologies where multiple instances of one or more member types are deployed.</span></span> <span data-ttu-id="391de-338">Скрипт установки инициируется для каждой виртуальной машины, которая может быть запущена параллельно. Затем выполняется скрипт установки, который вызывается после развертывания всех виртуальных машин (или всех виртуальных машин данного типа элемента).</span><span class="sxs-lookup"><span data-stu-id="391de-338">An installation script is initiated for every VM that can be run in parallel, followed by a setup script that is called after all VMs (or all VMs of a given member type) are deployed.</span></span>

![Пользовательские скрипты](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

<span data-ttu-id="391de-340">**Шаблоны элементов ресурсов могут вызывать скрипты для выполнения определенных задач, например, конфигурации виртуальной машины**</span><span class="sxs-lookup"><span data-stu-id="391de-340">**Member resources templates can call scripts for a specific purpose such as VM configuration**</span></span>

## <a name="capability-scoped-solution-template-example---redis"></a><span data-ttu-id="391de-341">Пример шаблона решения, определяющего возможности — Redis</span><span class="sxs-lookup"><span data-stu-id="391de-341">Capability-scoped solution template example - Redis</span></span>
<span data-ttu-id="391de-342">В качестве примера работы реализации рассмотрим практический случай создания шаблона, который облегчает развертывание и настройку Redis с использованием стандартных "размеров футболки".</span><span class="sxs-lookup"><span data-stu-id="391de-342">To show how an implementation might work, let's look at a practical example of building a template that facilitates the deployment and configuration of Redis in standard t-shirt sizes.</span></span>  

<span data-ttu-id="391de-343">Для развертывания доступен набор общих ресурсов (виртуальная сеть, учетная запись хранилища, группы доступности) и необязательные ресурсы (основная виртуальная машина).</span><span class="sxs-lookup"><span data-stu-id="391de-343">For the deployment, there are a set of shared resources (virtual network, storage account, availability sets) and an optional resource (jumpbox).</span></span> <span data-ttu-id="391de-344">Существует несколько известных конфигураций, представленных в рамках подхода «размеры футболки» (малая, средняя, большая), каждая с одним типом узла.</span><span class="sxs-lookup"><span data-stu-id="391de-344">There are multiple known configurations represented as t-shirt sizes (small, medium, large) but each with a single node type.</span></span> <span data-ttu-id="391de-345">Кроме того, есть два соответствующих задаче скрипта (установка и настройка).</span><span class="sxs-lookup"><span data-stu-id="391de-345">There are also two purpose-specific scripts (installation, configuration).</span></span>

### <a name="creating-the-template-files"></a><span data-ttu-id="391de-346">Создание файлов шаблона</span><span class="sxs-lookup"><span data-stu-id="391de-346">Creating the template files</span></span>
<span data-ttu-id="391de-347">Будет создан основной шаблон с именем azuredeploy.json.</span><span class="sxs-lookup"><span data-stu-id="391de-347">You would create a Main Template named azuredeploy.json.</span></span>

<span data-ttu-id="391de-348">Создание шаблона общих ресурсов с именем resources.json</span><span class="sxs-lookup"><span data-stu-id="391de-348">You create Shared Resources Template named shared-resources.json</span></span>

<span data-ttu-id="391de-349">Создание шаблона дополнительных ресурсов, включающего развертывание основной виртуальной машины, с именем jumpbox_enabled.json</span><span class="sxs-lookup"><span data-stu-id="391de-349">You create an Optional Resource Template to enable the deployment of a jumpbox, named jumpbox_enabled.json</span></span>

<span data-ttu-id="391de-350">Redis использует только один тип узла, поэтому создается один шаблон элемента ресурсов с именем node-resources.json.</span><span class="sxs-lookup"><span data-stu-id="391de-350">Redis uses just a single node type, so you create a single Member Resource Template named node-resources.json.</span></span>

<span data-ttu-id="391de-351">С помощью Redis необходимо установить каждый отдельный узел, а затем настроить кластер.</span><span class="sxs-lookup"><span data-stu-id="391de-351">With Redis, you want to install each individual node, and then set up the cluster.</span></span>  <span data-ttu-id="391de-352">Для этого у вас есть соответствующие скрипты redis-cluster-install.sh и redis-cluster-setup.sh.</span><span class="sxs-lookup"><span data-stu-id="391de-352">You have scripts to accommodate the installation and set up, redis-cluster-install.sh and redis-cluster-setup.sh.</span></span>

### <a name="linking-the-templates"></a><span data-ttu-id="391de-353">Связывание шаблонов</span><span class="sxs-lookup"><span data-stu-id="391de-353">Linking the templates</span></span>
<span data-ttu-id="391de-354">Вы можете связать основной шаблон с шаблоном общих ресурсов, который определяет виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="391de-354">Using template linking, the main template links out to the shared resources template, which establishes the virtual network.</span></span>

<span data-ttu-id="391de-355">Логика добавляется в основной шаблон, позволяя пользователям шаблона определять необходимость развертывания основной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="391de-355">Logic is added within the main template to enable consumers of the template to specify whether a jumpbox should be deployed.</span></span> <span data-ttu-id="391de-356">Значение *enabled* для параметра *EnableJumpbox* означает, что клиент хочет развернуть основную виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="391de-356">An *enabled* value for the *EnableJumpbox* parameter indicates that the customer wants to deploy a jumpbox.</span></span> <span data-ttu-id="391de-357">Если указано это значение, шаблон присоединяет значение *_enabled* в качестве суффикса к имени базового шаблона возможности основной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="391de-357">When this value is provided, the template concatenates *_enabled* as a suffix to a base template name for the jumpbox capability.</span></span>

<span data-ttu-id="391de-358">Основной шаблон присоединяет значение *large* в качестве суффикса к имени базового шаблона (по методу "размер футболки"), а затем использует это значение для связывания шаблона *technology_on_os_large.json*.</span><span class="sxs-lookup"><span data-stu-id="391de-358">The main template applies the *large* parameter value as a suffix to a base template name for t-shirt sizes, and then uses that value in a template link out to *technology_on_os_large.json*.</span></span>

<span data-ttu-id="391de-359">Пример топологии приведен на этом рисунке.</span><span class="sxs-lookup"><span data-stu-id="391de-359">The topology would resemble this illustration.</span></span>

![Шаблон Redis](./media/best-practices-resource-manager-design-templates/redis-template.png)

<span data-ttu-id="391de-361">**Структура шаблона для шаблона Redis**</span><span class="sxs-lookup"><span data-stu-id="391de-361">**Template structure for a Redis template**</span></span>

### <a name="configuring-state"></a><span data-ttu-id="391de-362">Настройка состояния</span><span class="sxs-lookup"><span data-stu-id="391de-362">Configuring state</span></span>
<span data-ttu-id="391de-363">Для узлов кластера существуют два этапа настройки состояния, представленные скриптами особого назначения.</span><span class="sxs-lookup"><span data-stu-id="391de-363">For the nodes in the cluster, there are two steps to configuring the state, both represented by Purpose Specific Scripts.</span></span>  <span data-ttu-id="391de-364">Скрипт redis-cluster-install.sh выполнит установку Redis, а скрипт redis-cluster-setup.sh настроит кластер.</span><span class="sxs-lookup"><span data-stu-id="391de-364">"redis-cluster-install.sh" installs Redis and "redis-cluster-setup.sh" sets up the cluster.</span></span>

### <a name="supporting-different-size-deployments"></a><span data-ttu-id="391de-365">Поддержка развертываний разных размеров</span><span class="sxs-lookup"><span data-stu-id="391de-365">Supporting Different Size Deployments</span></span>
<span data-ttu-id="391de-366">Шаблон "размер футболки" определяет в переменных количество узлов для каждого типа развертывания указанного размера (*большой*).</span><span class="sxs-lookup"><span data-stu-id="391de-366">Inside variables, the t-shirt size template specifies the number of nodes of each type to deploy for the specified size (*large*).</span></span> <span data-ttu-id="391de-367">Он также развертывает соответствующее количество экземпляров виртуальной машины с помощью циклов ресурсов и предоставляет уникальные имена для ресурсов, добавляя имя узла с номером числовой последовательности из *copyIndex()*.</span><span class="sxs-lookup"><span data-stu-id="391de-367">It then deploys that number of VM instances using resource loops, providing unique names to resources by appending a node name with a numeric sequence number from *copyIndex()*.</span></span> <span data-ttu-id="391de-368">Это происходит для виртуальных машин горячей и теплой зон в соответствии с определением имени шаблона "размер футболки".</span><span class="sxs-lookup"><span data-stu-id="391de-368">It does these steps for both hot and warm zone VMs, as defined in the t-shirt name template</span></span>

## <a name="decomposition-and-end-to-end-solution-scoped-templates"></a><span data-ttu-id="391de-369">Декомпозиция и шаблоны законченных решений</span><span class="sxs-lookup"><span data-stu-id="391de-369">Decomposition and end-to-end solution scoped templates</span></span>
<span data-ttu-id="391de-370">Шаблон решения, определяющий законченные решения, отвечает за предоставление законченного решения.</span><span class="sxs-lookup"><span data-stu-id="391de-370">A solution template with an end-to-end solution scope is focused on delivering an end-to-end solution.</span></span>  <span data-ttu-id="391de-371">Обычно такой шаблон представляет собой сочетание нескольких шаблонов заданных возможностей с дополнительными ресурсами, логикой и состоянием.</span><span class="sxs-lookup"><span data-stu-id="391de-371">This approach is typically a composition of multiple capability-scoped templates with additional resources, logic, and state.</span></span>

<span data-ttu-id="391de-372">Как видно на рисунке ниже, одна и та же модель, используемая для шаблонов с заданными возможностями, расширяется для использования с шаблонами в рамках области законченного решения.</span><span class="sxs-lookup"><span data-stu-id="391de-372">As highlighted in the image below, the same model used for capability scoped templates is extended for templates with an End-to-End Solution Scope.</span></span>

<span data-ttu-id="391de-373">Шаблон общих ресурсов и шаблоны дополнительных ресурсов выполняют одинаковую функцию в рамках подходов с использованием шаблонов, определяющих емкость и возможности. При этом они ограничены областью применения законченного решения.</span><span class="sxs-lookup"><span data-stu-id="391de-373">A Shared Resources Template and Optional Resources Templates serve the same function as in the capacity and capability scoped template approaches, but are scoped for the end to end solution.</span></span>

<span data-ttu-id="391de-374">Поскольку шаблоны, определяющие законченные решения, как правило, также могут использовать подход «размер футболки», шаблон ресурсов известной конфигурации отражает требования к заданной известной конфигурации решения.</span><span class="sxs-lookup"><span data-stu-id="391de-374">As end to end solution scoped templates also can typically have t-shirt sizes, the Known Configuration Resources template reflects what is required for a given known configuration of the solution.</span></span>

<span data-ttu-id="391de-375">Шаблон ресурсов известной конфигурации свяжется с одним или несколькими шаблонами решения, определяющими возможности и относящимися к законченному решению, — как и шаблоны элементов ресурсов, которые необходимы для создания законченного решения.</span><span class="sxs-lookup"><span data-stu-id="391de-375">The Known Configuration Resources Template links to one or more capability scoped solution templates that are relevant to the end to end solution as well as the Member Resource Templates that are required for the end to end solution.</span></span>

<span data-ttu-id="391de-376">Значение "размера футболки" решения может отличаться от размера отдельного шаблона, определяющего возможности. Поэтому переменные шаблона ресурсов известной конфигурации должны предоставить соответствующие значения для подчиненных шаблонов решений, определяющих возможности. Благодаря этому шаблоны развертывают правильный "размер футболки".</span><span class="sxs-lookup"><span data-stu-id="391de-376">As the t-shirt size of the solution may be different than the individual capability-scoped template, variables within the Known Configuration Resources Template are used to provide the appropriate values for downstream capability scoped solution templates to deploy the appropriate t-shirt size.</span></span>

![Законченное решение](./media/best-practices-resource-manager-design-templates/end-to-end.png)

<span data-ttu-id="391de-378">**Модель, используемую для шаблонов решений, определяющих возможности или емкость, можно легко расширить для областей действия шаблона, определяющих законченное решение**</span><span class="sxs-lookup"><span data-stu-id="391de-378">**The model used for capacity or capability scoped solution templates can be readily extended for end to end solution template scopes**</span></span>

## <a name="preparing-templates-for-the-marketplace"></a><span data-ttu-id="391de-379">Подготовка шаблонов для размещения в Marketplace</span><span class="sxs-lookup"><span data-stu-id="391de-379">Preparing templates for the Marketplace</span></span>
<span data-ttu-id="391de-380">Описанный выше подход позволяет использовать сценарии, в рамках которых организации, системные интеграторы и поставщики облачных служб развертывают шаблоны самостоятельно или делегируют это развертывание своим пользователям.</span><span class="sxs-lookup"><span data-stu-id="391de-380">The preceding approach readily accommodates scenarios where Enterprises, SIs, and CSVs want to either deploy the templates themselves or enable their customers to deploy on their own.</span></span>

<span data-ttu-id="391de-381">Еще одним требуемым сценарием является развертывание шаблона через магазин.</span><span class="sxs-lookup"><span data-stu-id="391de-381">Another desired scenario is deploying a template via the marketplace.</span></span>  <span data-ttu-id="391de-382">Этот подход к декомпозиции также будет работать с магазином с некоторыми незначительными изменениями.</span><span class="sxs-lookup"><span data-stu-id="391de-382">This decomposition approach works for the marketplace as well, with some minor changes.</span></span>

<span data-ttu-id="391de-383">Как упоминалось ранее, шаблоны можно использовать, предлагая для продажи в магазине развертывания разных типов.</span><span class="sxs-lookup"><span data-stu-id="391de-383">As mentioned previously, templates can be used to offer distinct deployment types for sale in the marketplace.</span></span> <span data-ttu-id="391de-384">Разные типы развертываний могут быть представлены разными "размерами футболки" (малый, средний, большой), типом продукта и аудитории (сообщества, разработчики, организации) или типом функции (базовый, высокий уровень доступности).</span><span class="sxs-lookup"><span data-stu-id="391de-384">Distinct deployment types may be t-shirt sizes (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>

<span data-ttu-id="391de-385">Как показано ниже, существующие шаблоны, определяющие законченные решения или возможности, можно легко использовать для создания в магазине списка различных известных конфигураций.</span><span class="sxs-lookup"><span data-stu-id="391de-385">As shown below, the existing end to end solution or capability scoped templates can be readily utilized to list the different known configurations in the marketplace.</span></span>

<span data-ttu-id="391de-386">Параметры основного шаблона изменяются первыми для удаления входящего параметра с именем tshirtSize.</span><span class="sxs-lookup"><span data-stu-id="391de-386">The parameters to the main template are first modified to remove the inbound parameter named tshirtSize.</span></span>

<span data-ttu-id="391de-387">Во время сопоставления разных типов развертывания с шаблоном ресурсов известной конфигурации также необходимы общие ресурсы и конфигурация, включенные в шаблон общих ресурсов и, возможно, в шаблоны дополнительных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="391de-387">While the distinct deployment types map to the Known Configuration Resources Template, they also need the common resources and configuration found in the Shared Resources Template and potentially those in Optional Resource Templates.</span></span>

<span data-ttu-id="391de-388">Чтобы опубликовать шаблон в магазине, установите отдельные копии общего шаблона, который заменяет ранее доступный входящий параметр tshirtSize переменной, внедренной в шаблон.</span><span class="sxs-lookup"><span data-stu-id="391de-388">If you want to publish your template to the marketplace, you establish distinct copies of your Main template that replaces the previously available inbound parameter of tshirtSize to a variable embedded within the template.</span></span>

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

<span data-ttu-id="391de-390">**Адаптация шаблона заданного решения к магазину**</span><span class="sxs-lookup"><span data-stu-id="391de-390">**Adapting a solution scoped template for the marketplace**</span></span>

## <a name="next-steps"></a><span data-ttu-id="391de-391">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="391de-391">Next steps</span></span>
* <span data-ttu-id="391de-392">Дополнительные сведения о состоянии общего доступа в рамках шаблонов и за их пределами см. в статье [Sharing state in Azure Resource Manager templates](best-practices-resource-manager-state.md) (Состояние общего доступа в шаблонах Azure Resource Manager).</span><span class="sxs-lookup"><span data-stu-id="391de-392">To learn about sharing state into and out of templates, see [Sharing state in Azure Resource Manager templates](best-practices-resource-manager-state.md).</span></span>
* <span data-ttu-id="391de-393">Руководство по использованию Resource Manager для эффективного управления подписками в организациях см [Azure enterprise scaffold - prescriptive subscription governance](resource-manager-subscription-governance.md) (Шаблон Azure для организаций. Рекомендуемая система управления подпиской).</span><span class="sxs-lookup"><span data-stu-id="391de-393">For guidance on how enterprises can use Resource Manager to effectively manage subscriptions, see [Azure enterprise scaffold - prescriptive subscription governance](resource-manager-subscription-governance.md).</span></span>

