---
title: "ошибки развертывания Azure aaaUnderstand | Документы Microsoft"
description: "Описывает способ toolearn об ошибках развертывания Azure."
services: azure-resource-manager
documentationcenter: 
tags: top-support-issue
author: tfitzmac
manager: timlt
editor: tysonn
keywords: "Ошибка развертывания, развертывания azure, развертывание tooazure"
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: support-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/12/2017
ms.author: tomfitz
ms.openlocfilehash: a335e121e9b908a763374907e34b1f6e823d6e96
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="understand-azure-deployment-errors"></a>Основные сведения об ошибках развертывания Azure
В этой статье описаны ошибки развертывания и объясняется, как можно получить подробности ошибки. Ошибки развертывания toocommon решения, в разделе [Устранение общих ошибок развертывания Azure с помощью диспетчера ресурсов Azure](resource-manager-common-deployment-errors.md).

## <a name="two-types-of-errors"></a>Два типа ошибок
Существует два типа ошибок, которые могут произойти:

* ошибки проверки;
* ошибки развертывания.

Следующие изображения Hello показывает hello журнал действий для подписки. Он представляет два развертывания. В одно развертывание сбой проверки шаблона hello (**проверки**) и не продолжить работу. В Здравствуйте других развертываний, шаблон hello прошла проверку, но ошибка при создании ресурсов hello (**записи развертываний**). 

![Отображение кода ошибки](./media/resource-manager-troubleshoot-tips/show-activity-log.png)

Ошибки проверки возникают в сценариях, которые можно определить перед развертыванием. Они включают синтаксические ошибки в шаблоне или идет toodeploy ресурсов, приведет к превышению квоты вашей подписки. Ошибки развертывания, проистекают из условий, возникающих в процессе развертывания hello. Они включают попытки tooaccess ресурс, который развертывается в параллельном режиме.

Оба типа ошибок Вернуть код ошибки, использовать tootroubleshoot hello развертывания. Обоих типов ошибок отображаются в hello [журнал действий](resource-group-audit.md). Тем не менее ошибки не обнаружены в журнале развертывания так, как развертывание hello никогда не запускался.

## <a name="determine-error-code"></a>Определение кода ошибки

Вы узнаете об ошибке, просмотрев сообщение hello и кодом ошибки hello. Hello [Устранение общих ошибок развертывания Azure с помощью диспетчера ресурсов Azure](resource-manager-common-deployment-errors.md) статье перечислены решения с кодом ошибки. В этом разделе показано, как toouse hello код ошибки hello Azure toodiscover портала.

### <a name="validation-errors"></a>Ошибки проверки

При развертывании через портал hello, можно увидеть ошибку проверки после отправки этих значений.

![Показ ошибки проверки через портал](./media/resource-manager-troubleshoot-tips/validation-error.png)

Выберите приветственных сообщений для получения дополнительных сведений. Появится после изображения hello, **InvalidTemplateDeployment** ошибки и сообщение, которое указывает политику заблокированных развертывания.

![Отображение сведений о проверке](./media/resource-manager-troubleshoot-tips/validation-details.png)

### <a name="deployment-errors"></a>Ошибки развертывания

При операции hello проходит проверку, но завершается ошибкой во время развертывания, отобразится ошибка hello в уведомлениях hello. Выберите уведомления hello.

![уведомление об ошибке](./media/resource-manager-troubleshoot-tips/notification.png)

Вы см. Дополнительные сведения о развертывании hello. Выберите параметр toofind hello Дополнительные сведения об ошибке hello.

![сбой развертывания](./media/resource-manager-troubleshoot-tips/deployment-failed.png)

Появиться hello ошибки сообщения и коды ошибок. Обратите внимание, что имеется два кода ошибки. Здравствуйте, первый код ошибки (**DeploymentFailed**) — это общая ошибка, которая не поддерживает hello сведений вы нужно toosolve hello ошибки. Здравствуйте, второй код ошибки (**StorageAccountNotFound**) предоставляет необходимые сведения hello. 

![Сведения об ошибке](./media/resource-manager-troubleshoot-tips/error-details.png)

## <a name="enable-debug-logging"></a>Включение ведения журнала отладки
Иногда требуются дополнительные сведения о toodiscover запроса и ответа hello что пошло не так. С помощью PowerShell или Azure CLI вы можете запросить, чтобы во время развертывания в журнал записывались дополнительные сведения.

- PowerShell

   В PowerShell, задайте hello **DeploymentDebugLogLevel** параметр tooAll, ResponseContent или RequestContent.

  ```powershell
  New-AzureRmResourceGroupDeployment -ResourceGroupName examplegroup -TemplateFile c:\Azure\Templates\storage.json -DeploymentDebugLogLevel All
  ```

   Проверьте содержимое запроса hello с hello, выполнив командлет:

  ```powershell
  (Get-AzureRmResourceGroupDeploymentOperation -DeploymentName storageonly -ResourceGroupName startgroup).Properties.request | ConvertTo-Json
  ```

   Или hello содержимого с ответа:

  ```powershell
  (Get-AzureRmResourceGroupDeploymentOperation -DeploymentName storageonly -ResourceGroupName startgroup).Properties.response | ConvertTo-Json
  ```

   Эти сведения помогают определить, является ли значение в шаблоне hello неправильно задано.

- Инфраструктура CLI Azure

   Проверьте hello операции развертывания с hello следующую команду:

  ```azurecli
  az group deployment operation list --resource-group ExampleGroup --name vmlinux
  ```

- Вложенный шаблон

   toolog отладочную информацию для вложенных шаблонов использования hello **debugSetting** элемента.

  ```json
  {
      "apiVersion": "2016-09-01",
      "name": "nestedTemplate",
      "type": "Microsoft.Resources/deployments",
      "properties": {
          "mode": "Incremental",
          "templateLink": {
              "uri": "{template-uri}",
              "contentVersion": "1.0.0.0"
          },
          "debugSetting": {
             "detailLevel": "requestContent, responseContent"
          }
      }
  }
  ```


## <a name="create-a-troubleshooting-template"></a>Создание шаблона для устранения неполадок
В некоторых случаях hello простым способом tootroubleshoot шаблона — tootest его части. Можно создать шаблон упрощенный, позволяющая toofocus, со стороны hello, который вы считаете, что является причиной ошибки hello. Для примера предположим, что вы получили сообщение об ошибке при указании ссылки на ресурс. Вместо того чтобы иметь дело с шаблоном целиком, создайте шаблон, который возвращает hello часть, которая может быть причиной возникновения проблемы. Это позволит определить ли передаются в hello нужные параметры, с помощью функции шаблона правильно, и получение сведений о ресурсе hello предполагается, что.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "storageName": {
        "type": "string"
    },
    "storageResourceGroup": {
        "type": "string"
    }
  },
  "variables": {},
  "resources": [],
  "outputs": {
    "exampleOutput": {
        "value": "[reference(resourceId(parameters('storageResourceGroup'), 'Microsoft.Storage/storageAccounts', parameters('storageName')), '2016-05-01')]",
        "type" : "object"
    }
  }
}
```

Или Предположим, что появляются ошибки развертывания, которые вы считаете, что связанные tooincorrectly набора зависимостей. Проверьте шаблон, разбив его на более простые шаблоны. Сначала создайте шаблон, который развертывает только один ресурс (например, SQL Server). Когда вы убедитесь, что этот ресурс определен правильно, добавьте зависящий от него ресурс (например, базу данных SQL). Проверив правильность определения этих двух ресурсов, добавьте другие зависимые ресурсы (например, политики аудита). Между каждой тестовое развертывание удаление hello группы toomake убедиться, что вы правильно тестирования hello зависимостей ресурсов. 

## <a name="check-deployment-sequence"></a>Проверка последовательности развертывания

Многие ошибки развертывания происходят, когда ресурсы развертываются в непредвиденном порядке. Такие ошибки возникают, когда зависимости заданы неправильно. Если отсутствуют необходимые зависимости, один ресурс предпринимает toouse значение для другой ресурс, но другие hello еще не существует. Произойдет ошибка и отобразится сообщение о том, что ресурс не найден. Такие ошибки могут возникнуть периодически поскольку hello время развертывания для каждого ресурса, могут различаться. Например ваш первый toodeploy попытки ресурсам завершается успешно, поскольку требуемый ресурс случайным образом завершается за время. Тем не менее на второй попытка завершается неудачно, поскольку hello необходимые ресурса не была завершена в момент. 

Однако желательно tooavoid параметр зависимости, которые не требуются. При наличии ненужные зависимости, можно увеличить продолжительность hello hello развертывания, так как ресурсы, которые не зависят друг с другом, развертывание в параллельном режиме. Кроме того можно создать циклические зависимости, блокировать развертывание hello. Hello [ссылки](resource-group-template-functions-resource.md#reference) функция создает зависимость неявное hello ссылка на ресурс, при развертывании этого ресурса в hello того же шаблона. Таким образом, может иметь дополнительные зависимости, чем hello зависимости, указанные в hello **dependsOn** свойство. Hello [resourceId](resource-group-template-functions-resource.md#resourceid) функция не создает зависимость неявные и проверить, существует ресурс hello.

При возникновении проблемы зависимостей, необходимо понять toogain hello порядок развертывания ресурсов. порядок hello tooview операции развертывания:

1. Выберите журнал hello развертывания для группы ресурсов.

   ![Выбор журнала развертывания](./media/resource-manager-troubleshoot-tips/select-deployment.png)

2. Выберите развертывание из журнала hello и выберите **события**.

   ![Выбор событий развертывания](./media/resource-manager-troubleshoot-tips/select-deployment-events.png)

3. Изучите hello последовательность событий для каждого ресурса. Обратите внимание toohello состояние каждой операции. Например hello рисунке показаны три учетные записи хранения, которые развернуты в параллельном режиме. Обратите внимание, что hello три учетные записи хранения запускаемых hello то же время.

   ![Параллельное развертывание](./media/resource-manager-troubleshoot-tips/deployment-events-parallel.png)

   Hello следующее изображение показывает три учетные записи хранения, которые не развертываются в параллельном режиме. Hello вторую учетную запись хранилища зависит от hello первой учетной записи хранения, а третий учетной записи хранилища hello зависит от hello вторую учетную запись хранилища. Таким образом hello первой учетной записи хранения запущена, принимается и завершены перед выполнением hello Далее.

   ![Последовательное развертывание](./media/resource-manager-troubleshoot-tips/deployment-events-sequence.png)

Даже для более сложных сценариев можно использовать hello toodiscover же способ, при развертывания запускается и выполняется для каждого ресурса. Просмотрите toosee события вашего развертывания, если последовательность hello отличается, чем ожидалось. В этом случае пересчитать hello зависимостей для этого ресурса.

Resource Manager выявляет циклические зависимости во время проверки шаблона. Он возвращает сообщение об ошибке, в котором специально сообщается о наличии циклической зависимости. toosolve циклическую зависимость:

1. В шаблоне найти hello ресурс, указанный в hello циклическую зависимость. 
2. Для этого ресурса проверьте hello **dependsOn** свойство и все варианты использования hello **ссылки** toosee, какие ресурсы он зависит от функции. 
3. Изучите эти ресурсы toosee, какие ресурсы, они зависят. Выполните hello зависимости, пока ресурс, который зависит от исходного ресурса hello.
5. Hello ресурсов, вовлеченных в hello циклическую зависимость, тщательно изучить все случаи использования hello **dependsOn** свойство tooidentify все зависимости, которые не требуются. Удалите эти зависимости. Если вы не уверены, нужна ли зависимость, попробуйте удалить ее. 
6. Повторное развертывание шаблона hello.

Удаление значений из hello **dependsOn** свойство может привести к ошибкам при развертывании шаблона hello. Если возникнет сообщение об ошибке, добавьте зависимость hello обратно в шаблон hello. 

Если после этого подхода hello циклическую зависимость, рекомендуется переместить часть логику развертывания в дочерние ресурсы (например, расширения или параметры конфигурации). Настройте эти дочерние ресурсы toodeploy после hello ресурсов, вовлеченных в hello циклическую зависимость. Предположим, например, две виртуальные машины развертываются, но необходимо задать свойства для каждого из них, которые ссылаются другие toohello. Их можно развернуть в hello следующий порядок:

1. vm1.
2. vm2.
3. Расширение на vm1 зависит от vm1 и vm2. расширение Hello задает значения по vm1, получаемый от vm2.
4. Расширение на vm2 зависит от vm1 и vm2. расширение Hello задает значения по vm2, получаемый от vm1.

Здравствуйте, такой подход работает для приложений служб приложений. Рекомендуется переместить значения конфигурации в дочерний ресурс ресурса приложения hello. Вы можете развернуть два веб-приложений в hello следующий порядок:

1. webapp1.
2. webapp2.
3. Конфигурация webapp1 зависит от webapp1 и webapp2. Она содержит параметры приложения со значениями из webapp2.
4. Конфигурация webapp2 зависит от webapp1 и webapp2. Она содержит параметры приложения со значениями из webapp1.


## <a name="next-steps"></a>Дальнейшие действия
* Ошибки развертывания toocommon решения, в разделе [Устранение общих ошибок развертывания Azure с помощью диспетчера ресурсов Azure](resource-manager-common-deployment-errors.md).
* toolearn об аудите действий, в разделе [аудит операций с помощью диспетчера ресурсов](resource-group-audit.md).
* toolearn об ошибках hello toodetermine действия во время развертывания, в разделе [просмотреть операции развертывания](resource-manager-deployment-operations.md).
