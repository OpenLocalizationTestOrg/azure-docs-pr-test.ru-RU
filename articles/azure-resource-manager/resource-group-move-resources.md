---
title: "Перемещение ресурсов Azure в новую подписку или группу ресурсов | Документация Майкрософт"
description: "Перемещайте ресурсы в новую группу ресурсов или новую подписку с помощью Azure Resource Manager."
services: azure-resource-manager
documentationcenter: 
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ab7d42bd-8434-4026-a892-df4a97b60a9b
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/25/2017
ms.author: tomfitz
ms.openlocfilehash: e138f80e808968ab4bf5c11cfd5fd46fe4a1bcce
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="move-resources-to-new-resource-group-or-subscription"></a>Перемещение ресурсов в новую группу ресурсов или подписку
В этой статье показано, как переместить ресурсы в новую подписку или в новую группу ресурсов в той же подписке. Для перемещения ресурса можно использовать портал, PowerShell, интерфейс командной строки Azure или REST API. Операции по перемещению, описанные в этой статье, вы можете выполнить самостоятельно, без помощи службы поддержки Azure.

При перемещении ресурсов группа источника и группа назначения блокируются на время операции. Операции записи и удаления для групп ресурсов блокируются до завершения перемещения. Эта блокировка означает, что невозможно добавить, обновить или удалить ресурсы в группах ресурсов, но не означает, что эти ресурсы закреплены. Например, если переместить в новую группу ресурсов экземпляр SQL Server и его базу данных, то приложение, использующее эту базу данных, не будет испытывать простоев в работе. Оно по-прежнему сможет считывать данные из базы данных и записывать их в нее.

Расположение ресурса изменить невозможно. При перемещении ресурс всего лишь перемещается в новую группу ресурсов. Даже если новая группа ресурсов находится в другом расположении, расположение ресурса не меняется.

> [!NOTE]
> В этой статье описывается, как перемещать ресурсы в рамках существующего предложения для учетной записи Azure. Если вы действительно хотите изменить предложение для своей учетной записи Azure (например, перейти с оплаты по мере использования на предоплату), продолжая работать с существующими ресурсами, см. статью [Переключение подписки Azure на другое предложение](../billing/billing-how-to-switch-azure-offer.md).
>
>

## <a name="checklist-before-moving-resources"></a>Рекомендации перед перемещением ресурсов
Вот некоторые важные особенности, которые следует учитывать перед перемещением ресурса. Проверив эти условия, можно избежать ошибок.

1. Исходная и целевая подписка должны существовать в пределах одного [клиента Azure Active Directory](../active-directory/active-directory-howto-tenant.md). Используя Azure PowerShell или командную строку Azure, можно убедиться, что обе подписки имеют один и тот же идентификатор клиента.

  Для Azure PowerShell:

  ```powershell
  (Get-AzureRmSubscription -SubscriptionName "Example Subscription").TenantId
  ```

  В Azure CLI 2.0 используйте следующую команду.

  ```azurecli
  az account show --subscription "Example Subscription" --query tenantId
  ```

  Если идентификаторы клиентов для исходной и целевой подписок не совпадают, можно попробовать изменить каталог для подписки. Но эта возможность доступна только для администраторов службы, которые вошли в учетную запись Майкрософт (не корпоративную учетную запись). Чтобы попробовать изменить каталог, войдите на [классический портал](https://manage.windowsazure.com/), щелкните **Параметры** и выберите подписку. Если значок **Изменить каталог** доступен, щелкните его, чтобы изменить связанный Azure Active Directory.

  ![Изменение каталога](./media/resource-group-move-resources/edit-directory.png)

  Если значок недоступен, обратитесь в службу поддержки. Вам помогут переместить ресурсы в новый клиент.

2. Служба должна иметь возможность перемещения ресурсов. В этом разделе перечислено, какие службы позволяют перемещать ресурсы, а какие — нет.
3. Подписка назначения должна быть зарегистрирована для перемещаемого поставщика ресурсов. В противном случае отображается сообщение о том, что **подписка не зарегистрирована для типа ресурса**. Эта проблема может возникнуть при перемещении ресурса в новую подписку, которая никогда не использовалась с этим типом ресурса. Сведения о регистрации поставщиков ресурсов и проверке состояния регистрации см. в разделе [Поставщики и типы ресурсов](resource-manager-supported-services.md).

## <a name="when-to-call-support"></a>Когда обращаться в службу поддержки
Большинство ресурсов можно самостоятельно переместить с помощью операций, описанных в этой статье. С помощью этих операций можно выполнять такие действия:

* перемещение ресурсов Resource Manager;
* перемещение классических ресурсов с учетом [ограничений классического развертывания](#classic-deployment-limitations).

Обратитесь в службу поддержки, если необходимо выполнить такие действия:

* перемещение ресурсов в новую учетную запись Azure (и клиент Azure Active Directory);
* перемещение классических ресурсов, осложненное проблемами с ограничениями.

## <a name="services-that-enable-move"></a>Службы, поддерживающие перемещение
Указанные ниже службы сейчас поддерживают перемещение в новую группу ресурсов и подписку.

* Управление API
* Приложения службы приложений (веб-приложения) — см. раздел [Ограничения службы приложений](#app-service-limitations).
* Application Insights
* Автоматизация
* Пакетная служба
* Карты Bing
* CDN
* Облачные службы — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Cognitive Services
* Content Moderator
* Каталог данных
* Фабрика данных
* Аналитика озера данных
* Хранилище озера данных
* DNS
* Azure Cosmos DB
* Концентраторы событий
* Кластеры HDInsight — см. раздел [Ограничения HDInsight](#hdinsight-limitations).
* Центры Интернета вещей;
* Хранилище ключей
* Балансировщики нагрузки
* Приложения логики
* Машинное обучение
* Службы мультимедиа
* Службы мобильного взаимодействия
* Центры уведомлений
* Operational Insights;
* Пакет Operations Management
* Power BI
* Кэш Redis
* Планировщик
* Поиск
* Управление сервером
* Служебная шина
* Service Fabric
* Хранилище
* Служба хранилища (классическая) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Stream Analytics — задание Stream Analytics в состоянии выполнения нельзя переместить.
* Сервер базы данных SQL — база данных и сервер должны находиться в одной группе ресурсов. При перемещении сервера SQL Server все его базы данных также перемещаются.
* Диспетчер трафика
* Виртуальные машины
* Виртуальные машины с сертификатами, хранящимися в Key Vault — переход на новую группу ресурсов в одной подписке включен, но перемещение между подписками не доступно.
* Виртуальные машины (классические) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Наборы для масштабирования виртуальных машин
* Виртуальные сети. В настоящее время невозможно переместить пиринговую виртуальную сеть, пока не будет отключен ее пиринг. После этого ее можно переместить и включить пиринг. Кроме того, виртуальную сеть невозможно переместить в другую подписку, если эта сеть содержит какую-либо подсеть со ссылками перехода к ресурсам. Например, подсеть виртуальной сети содержит ссылку перехода к ресурсу, когда ресурс Redis Microsoft.Cache развертывается в этой подсети.
* VPN-шлюз


## <a name="services-that-do-not-enable-move"></a>Службы, не поддерживающие перемещение
Службы, которые в настоящее время не поддерживают перемещение ресурсов:

* доменные службы Active Directory;
* служба работоспособности гибридного AD;
* Шлюз приложений
* Группы доступности, содержащие виртуальные машины с управляемыми дисками.
* Службы BizTalk
* Служба контейнеров
* ExpressRoute
* DevTest Labs — переход на новую группу ресурсов в одной подписке включен, но перемещение между подписками не доступно.
* Dynamics LCS.
* Образы, созданные из управляемых дисков.
* Управляемые диски
* Управляемые приложения.
* Хранилище служб восстановления. Не перемещайте ресурсы хранилища, а также вычислительные и сетевые ресурсы, связанные с хранилищем служб восстановления. См. раздел [Ограничения служб восстановления](#recovery-services-limitations).
* Безопасность
* Моментальные снимки, созданные из управляемых дисков.
* Диспетчер устройств StorSimple
* Виртуальные машины с Управляемыми дисками
* Виртуальные сети (классические) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Виртуальные машины, созданные из ресурсов Marketplace, невозможно переместить между подписками. Необходимо отозвать ресурс в текущей подписке и развернуть его в новой подписке.

## <a name="app-service-limitations"></a>Ограничения службы приложений
При работе с приложениями службы приложений невозможно переместить только план службы приложений. Далее приводятся варианты перемещения приложений службы приложений.

* Перемещение плана службы приложений и всех других ресурсов службы приложений из этой группы ресурсов в новую группу ресурсов, которая еще не содержит ресурсы службы приложений. Это требование означает, что необходимо переместить даже те ресурсы службы приложений, которые не связаны с планом службы приложений.
* Перемещение приложений в другую группу ресурсов, но сохранение планов службы приложений в исходной группе ресурсов.

Для корректной работы приложения план службы приложений и приложение не должны обязательно находиться в одной группе ресурсов.

Например, если группа ресурсов содержит:

* ресурс **web-a**, связанный с **plan-a**;
* ресурс **web-b**, связанный с **plan-b**.

Вам доступны следующие действия:

* перемещение **web-a**, **plan-a**, **web-b**, и **plan-b**;
* перемещение **web-a** и **web-b**;
* перемещение **web-a**
* перемещение **web-b**

Все другие сочетания включают необходимость оставить тип ресурса, который нельзя оставлять при перемещении плана службы приложений (любой тип ресурса службы приложений).

Если веб-приложение находится в одной группе ресурсов, а его план службы приложений — в другой, но в новую группу ресурсов требуется переместить и веб-приложение, и план, то необходимо выполнить перемещение в два этапа. Например:

* **web-a** находится в группе **web-group**;
* **plan-a** находится в группе **plan-group**;
* вы хотите поместить **web-a** и **plan-a** в объединенную группу **combined-group**.

Чтобы осуществить это перемещение, выполните две отдельные операции перемещения в следующей последовательности:

1. Переместите **web-a** в группу **plan-group**.
2. Переместите **web-a** и **plan-a** в объединенную группу **combined-group**.

Сертификат службы приложений можно без проблем переместить в новую группу ресурсов или подписку. Но если веб-приложение включает сертификат SSL, приобретенный у стороннего поставщика и переданный в приложение, необходимо удалить сертификат перед перемещением веб-приложения. Например, можно выполнить следующие действия:

1. Удалить отправленный сертификат из веб-приложения.
2. Переместить веб-приложение.
3. Добавить сертификат в веб-приложение.

## <a name="recovery-services-limitations"></a>Ограничения служб восстановления
Перемещение не поддерживается для ресурсов хранилища, сетевых и вычислительных ресурсов, используемых для настройки аварийного восстановления с помощью Azure Site Recovery.

Предположим, что вы настроили репликацию своих локальных компьютеров в учетную запись хранения (Storage1) и хотите, чтобы защищенный компьютер восстанавливался после отработки отказа в Azure как виртуальная машина (VM1), подключенная к виртуальной сети (Network1). Ни один из этих ресурсов Azure (Storage1, VM1 и Network1) нельзя перемещать между группами ресурсов в пределах одной подписки или между подписками.

## <a name="hdinsight-limitations"></a>Ограничения HDInsight

Кластеры HDInsight можно переместить в новую подписку или группу ресурсов. Однако перемещение между подписками недоступно для сетевых ресурсов, связанных с кластером HDInsight (таких как виртуальная сеть, сетевая карта или балансировщик нагрузки). Также невозможно переместить в новую группу ресурсов сетевую карту, которая подключена к виртуальной машине кластера.

При перемещении кластера HDInsight в новую подписку сначала необходимо переместить другие ресурсы (такие как учетная запись хранения). А затем переместить сам кластер HDInsight.

## <a name="classic-deployment-limitations"></a>Ограничения классического развертывания
Процедуры перемещения ресурсов, развернутых с помощью классической модели, отличаются в зависимости от того, перемещаются ли ресурсы в пределах одной подписки, или они переносятся в новую подписку.

### <a name="same-subscription"></a>Та же подписка
При перемещении ресурсов из одной группы ресурсов в другую в пределах одной подписки действуют следующие ограничения.

* Нельзя перемещать виртуальные сети (классические).
* Виртуальные машины (классические) необходимо перемещать с облачной службой.
* Облачную службу можно перемещать только в тех случаях, когда перемещение включает в себя все виртуальные машины этой службы.
* Одновременно можно перемещать только одну облачную службу.
* Одновременно можно перемещать только одну учетную запись хранения (классическую).
* Нельзя перемещать учетную запись хранения (классическую) в рамках одной операции с виртуальной машиной или облачной службой.

Для перемещения классических ресурсов в новую группу ресурсов в пределах одной подписки используйте стандартные операции перемещения на [портале](#use-portal), в [Azure PowerShell](#use-powershell), [интерфейсе командной строки Azure](#use-azure-cli) или интерфейсе [REST API](#use-rest-api). При этом используются те же операции, что и для перемещения ресурсов Resource Manager.

### <a name="new-subscription"></a>Новая подписка
При перемещении ресурсов в новую подписку действуют следующие ограничения.

* Все классические ресурсы в подписке необходимо переместить в рамках одной операции.
* Целевая подписка не должна содержать никаких других классических ресурсов.
* Перемещение можно запросить только через отдельный интерфейс REST API для классических перемещений. Стандартные команды перемещения Resource Manager не работают, если перемещение классических ресурсов осуществляется в новую подписку.

Для перемещения классических ресурсов в новую подписку используйте операции REST, предназначенные для классических ресурсов. Чтобы воспользоваться REST, выполните следующие действия:

1. Проверьте, может ли исходная подписка участвовать в перемещении между подписками. Выполните такую операцию:

  ```HTTP   
  POST https://management.azure.com/subscriptions/{sourceSubscriptionId}/providers/Microsoft.ClassicCompute/validateSubscriptionMoveAvailability?api-version=2016-04-01
  ```

     Включите в текст запроса такой код:

  ```json
  {
    "role": "source"
  }
  ```

     Ответ на операцию проверки имеет следующий формат:

  ```json
  {
    "status": "{status}",
    "reasons": [
      "reason1",
      "reason2"
    ]
  }
  ```

2. Проверьте, может ли целевая подписка участвовать в перемещении между подписками. Выполните такую операцию:

  ```HTTP
  POST https://management.azure.com/subscriptions/{destinationSubscriptionId}/providers/Microsoft.ClassicCompute/validateSubscriptionMoveAvailability?api-version=2016-04-01
  ```

     Включите в текст запроса такой код:

  ```json
  {
    "role": "target"
  }
  ```

     Ответ будет в том же формате, что и проверка исходной подписки.
3. Если обе подписки пройдут проверку, переместите все классические ресурсы из одной подписки в другую, выполнив следующее действие:

  ```HTTP
  POST https://management.azure.com/subscriptions/{subscription-id}/providers/Microsoft.ClassicCompute/moveSubscriptionResources?api-version=2016-04-01
  ```

    Включите в текст запроса такой код:

  ```json
  {
    "target": "/subscriptions/{target-subscription-id}"
  }
  ```

Операция может занять несколько минут.

## <a name="use-portal"></a>С помощью портала
Чтобы переместить ресурсы, выберите группу ресурсов, которая содержит эти ресурсы, а затем нажмите кнопку **Переместить**.

![перемещение ресурсов](./media/resource-group-move-resources/select-move.png)

Укажите, куда будут перемещены ресурсы: в новую группу ресурсов или новую подписку.

Выберите ресурсы, которые необходимо переместить, и целевую группу ресурсов. Подтвердите обновление сценариев для этих ресурсов и нажмите кнопку **ОК**. Если на предыдущем шаге был выбран значок редактирования подписки, то также необходимо выбрать целевую подписку.

![выбор места назначения](./media/resource-group-move-resources/select-destination.png)

В области **уведомлений**вы увидите, что операция перемещения выполняется.

![отображение состояния перемещения](./media/resource-group-move-resources/show-status.png)

После ее завершения отобразится уведомление о результате.

![отображение результата перемещения](./media/resource-group-move-resources/show-result.png)

## <a name="use-powershell"></a>Использование PowerShell
Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, выполните команду `Move-AzureRmResource`.

В первом примере показано, как переместить один ресурс в новую группу ресурсов.

```powershell
$resource = Get-AzureRmResource -ResourceName ExampleApp -ResourceGroupName OldRG
Move-AzureRmResource -DestinationResourceGroupName NewRG -ResourceId $resource.ResourceId
```

Во втором примере показано, как переместить несколько ресурсов в новую группу ресурсов.

```powershell
$webapp = Get-AzureRmResource -ResourceGroupName OldRG -ResourceName ExampleSite
$plan = Get-AzureRmResource -ResourceGroupName OldRG -ResourceName ExamplePlan
Move-AzureRmResource -DestinationResourceGroupName NewRG -ResourceId $webapp.ResourceId, $plan.ResourceId
```

Чтобы переместить ресурс в новую подписку, добавьте значение параметра `DestinationSubscriptionId`.

Появится запрос на подтверждение перемещения указанных ресурсов.

```powershell
Confirm
Are you sure you want to move these resources to the resource group
'/subscriptions/{guid}/resourceGroups/newRG' the resources:

/subscriptions/{guid}/resourceGroups/destinationgroup/providers/Microsoft.Web/serverFarms/exampleplan
/subscriptions/{guid}/resourceGroups/destinationgroup/providers/Microsoft.Web/sites/examplesite
[Y] Yes  [N] No  [S] Suspend  [?] Help (default is "Y"): y
```

## <a name="use-azure-cli-20"></a>Использование Azure CLI 2.0
Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, выполните команду `az resource move`. Укажите идентификаторы перемещаемых ресурсов. Чтобы получить идентификаторы ресурсов, воспользуйтесь следующей командой.

```azurecli
az resource show -g sourceGroup -n storagedemo --resource-type "Microsoft.Storage/storageAccounts" --query id
```

В следующем примере показано, как переместить учетную запись хранения в новую группу ресурсов. В параметре `--ids` укажите перемещаемый список идентификаторов ресурсов с разделителями-пробелами.

```azurecli
az resource move --destination-group newgroup --ids "/subscriptions/{guid}/resourceGroups/sourceGroup/providers/Microsoft.Storage/storageAccounts/storagedemo"
```

Для перемещения в новую подписку нужно указать параметр `--destination-subscription-id`.

## <a name="use-azure-cli-10"></a>Использование Azure CLI 1.0
Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, выполните команду `azure resource move`. Укажите идентификаторы перемещаемых ресурсов. Чтобы получить идентификаторы ресурсов, воспользуйтесь следующей командой.

```azurecli
azure resource list -g sourceGroup --json
```

Она вернет ответ в следующем формате:

```azurecli
[
  {
    "id": "/subscriptions/{guid}/resourceGroups/sourceGroup/providers/Microsoft.Storage/storageAccounts/storagedemo",
    "name": "storagedemo",
    "type": "Microsoft.Storage/storageAccounts",
    "location": "southcentralus",
    "tags": {},
    "kind": "Storage",
    "sku": {
      "name": "Standard_RAGRS",
      "tier": "Standard"
    }
  }
]
```

В следующем примере показано, как переместить учетную запись хранения в новую группу ресурсов. В параметре `-i` укажите перемещаемый список идентификаторов ресурсов с разделителями-запятыми.

```azurecli
azure resource move -i "/subscriptions/{guid}/resourceGroups/sourceGroup/providers/Microsoft.Storage/storageAccounts/storagedemo" -d "destinationGroup"
```

Появится запрос на подтверждение перемещения указанного ресурса.

## <a name="use-rest-api"></a>Использование REST API
Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, выполните следующую команду:

```HTTP
POST https://management.azure.com/subscriptions/{source-subscription-id}/resourcegroups/{source-resource-group-name}/moveResources?api-version={api-version}
```

В тексте запроса укажите целевую группу ресурсов и ресурсы для перемещения. Дополнительные сведения об операции перемещения в REST см. в статье [Move resources](https://msdn.microsoft.com/library/azure/mt218710.aspx) (Перемещение ресурсов).

## <a name="next-steps"></a>Дальнейшие действия
* Сведения о командлетах PowerShell для управления подпиской см. в статье [Использование Azure PowerShell с Resource Manager](powershell-azure-resource-manager.md).
* Сведения о командах интерфейса командной строки Azure для управления подпиской см. в статье [Управление ресурсами и группами ресурсов Azure с помощью интерфейса командной строки Azure](xplat-cli-azure-resource-manager.md).
* Сведения о функциях портала для управления подпиской см. в статье [Управление ресурсами Azure через портал](resource-group-portal.md).
* Сведения о логической организации ресурсов см. в разделе [Использование тегов для организации ресурсов в Azure](resource-group-using-tags.md).
