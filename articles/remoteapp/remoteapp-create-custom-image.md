---
title: "aaaHow toocreate образ пользовательский шаблон для Azure RemoteApp | Документы Microsoft"
description: "Узнайте, как изображения toocreate пользовательский шаблон для Azure RemoteApp. Этот шаблон можно использовать для гибридной или облачной коллекции."
services: remoteapp
documentationcenter: 
author: msmbaldwin
manager: mbaldwin
editor: 
ms.assetid: b9ec5b51-f7cd-470b-8545-d0fd714c5982
ms.service: remoteapp
ms.workload: compute
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/26/2017
ms.author: mbaldwin
ms.openlocfilehash: 9e3a0b2d3cc56177ea51406e6cecfe19ff235340
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-toocreate-a-custom-template-image-for-azure-remoteapp"></a>Как изображений toocreate пользовательский шаблон для Azure RemoteApp
> [!IMPORTANT]
> Мы выводим службу Azure RemoteApp из эксплуатации 31 августа 2017 года. Чтение hello [объявления](https://go.microsoft.com/fwlink/?linkid=821148) подробные сведения.
> 
> 

Azure RemoteApp использует toohost образа Windows Server 2012 R2 шаблона все программы hello требуется tooshare с вашими пользователями. toocreate пользовательского образа шаблона RemoteApp, можно начать с существующего образа или создайте новую. 

> [!TIP]
> Вы знаете, что можно создать образ из виртуальной машины Azure? Значение true, материал, который сократит hello количество времени, он принимает tooimport hello изображения. Извлечение шагов hello [здесь](remoteapp-image-on-azurevm.md).
> 
> 

Существуют следующие требования Hello для hello образ, который можно загрузить для использования с Azure RemoteApp.

* размер образа Hello должно быть кратно МБ. При попытке tooupload изображение, которое не является точным кратным hello отправка завершается ошибкой.
* Hello размер изображения должен быть 127 ГБ или меньше.
* Он должен быть помещен в VHD-файл (файлы VHDX [виртуальные жесткие диски Hyper-V] в настоящее время не поддерживаются).
* Hello виртуального жесткого диска не должен быть виртуальной машины поколения 2.
* Hello виртуального жесткого диска может быть фиксированного размера или динамически расширяемых. Динамически расширяемый виртуальный жесткий ДИСК рекомендуется, так как он принимает tooAzure tooupload меньше времени, чем файл VHD фиксированного размера.
* Hello диск должен быть инициализирован с помощью стиля разделов hello основная загрузочная запись (MBR). Hello стилем разделов таблицы Разделов GUID разделов не поддерживается.
* Hello виртуальный жесткий ДИСК должен содержать одной установке Windows Server 2012 R2. Он может содержать несколько томов, но только один из них может содержать установку Windows.
* необходимо установить роль узла сеансов удаленных рабочих столов (RDSH) Hello и возможности рабочего стола hello.
* Hello роли посредника подключений к удаленному рабочему столу необходимо *не* установить.
* необходимо отключить Hello шифрованной файловой системы (EFS).
* Hello изображение должно быть обработанной командой Sysprep, используя параметры hello **/oobe / generalize/shutdown** (hello, не используйте **/mode:vm** параметр).
* Отправка VHD из цепочки моментальных снимков не поддерживается.

**Перед началом работы**

Необходимы следующие hello toodo перед созданием hello службы:

* [Зарегистрироваться](https://azure.microsoft.com/services/remoteapp/) в RemoteApp.
* Создание учетной записи пользователя в Active Directory toouse как hello учетной записи службы RemoteApp. Ограничения hello разрешения для этой учетной записи, таким образом, чтобы его можно только домену машины toohello. Дополнительные сведения см. в статье [Требования Azure AD + Active Directory для Azure RemoteApp](remoteapp-ad.md).
* Соберите сведения о локальной сети, а именно получить информацию об IP-адресе и VPN-устройстве.
* Установка hello [Azure PowerShell](/powershell/azure/overview) модуля.
* Сбор сведений о пользователях hello, которым требуется доступ toogrant. Это могут быть либо данные учетной записи Майкрософт, либо данные рабочей учетной записи Active Directory пользователя.

## <a name="create-a-template-image"></a>Создание образа шаблона
Ниже приведены шаги на высоком уровне hello toocreate новый образ шаблона с нуля:

1. найти DVD или ISO-образ с Windows Server 2012 R2 Update;
2. создать VHD-файл;
3. установить Windows Server 2012 R2;
4. Установите роль узла сеансов удаленных рабочих столов (RDSH) hello и возможности рабочего стола hello.
5. установить дополнительные функции, необходимые для приложений;
6. установить и настроить ваши приложения; приложения управления доступом toomake проще, добавить всех приложений и программ, которые должны tooshare toohello **запустить** меню hello изображения, в частности в **%systemdrive%\ProgramData\Microsoft\Windows\Start Menu\Programs.
7. Выполните любые дополнительные настройки Windows, необходимые для приложений.
8. Отключите hello шифрованной файловой системы (EFS).
9. **ТРЕБУЕТСЯ:** перейдите tooWindows обновлений и установите все важные обновления.
10. Образ SYSPREP hello.

Hello подробные инструкции по созданию нового образа являются:

1. найти DVD или ISO-образ с Windows Server 2012 R2 Update;
2. создайте VHD-файл с помощью управления дисками;
   
   1. запустите управление дисками (diskmgmt.msc);
   2. создайте динамически расширяющийся VHD размером 40 ГБ или более; (Оценка hello объем пространства, необходимого для Windows, приложений и настроек. Windows Server с ролью RDSH hello и возможностями рабочего стола потребуется около 10 ГБ пространства).
      
      1. Щелкните **Действие > Создать виртуальный жесткий диск**.
      2. Укажите расположение hello, размер и формат виртуального жесткого диска. Выберите **Динамически расширяемый** и щелкните **ОК**.
      
      Процесс создания диска занимает несколько секунд. По завершении hello создания виртуального жесткого диска вы увидите новый диск без любую букву диска и находятся в состоянии «Не инициализирован» в консоли управления дисками hello.
      
      * Щелкните правой кнопкой мыши диск hello (не hello нераспределенное пространство) и нажмите кнопку **инициализировать диск**. Выберите **MBR** (Master Boot Record) как hello стиль раздела, а затем щелкните **ОК**.
      * Создайте новый том: щелкните правой кнопкой мыши нераспределенное пространство hello и нажмите кнопку **создать простой том**. Можно принять значения по умолчанию hello в мастере hello, но убедитесь, что назначение буквы диска tooavoid потенциальные проблемы при загрузке образа шаблона hello.
      * Щелкните правой кнопкой мыши диск hello и нажмите кнопку **отсоединить виртуальный жесткий ДИСК**.
3. Установите Windows Server 2012 R2.
   
   1. Создайте новую виртуальную машину. Здравствуйте, используйте мастер создания виртуальной машины в диспетчере Hyper-V или клиента Hyper-V.
      1. На странице приветствия укажите поколение выберите **поколение 1**.
      2. На странице приветствия подключить виртуальный жесткий диск, выберите **использовать существующий виртуальный жесткий диск**и найдите toohello виртуальный жесткий ДИСК, созданный на предыдущем шаге hello.
      3. На странице параметров установки hello выберите **установить операционную систему с загрузочного компакт-диска или DVD_ROM**и затем выберите hello расположение установочного носителя Windows Server 2012 R2.
      4. Выберите другие параметры в необходимости tooinstall мастер приветствия Windows и приложений. Завершите работу мастера hello.
   2. После завершения работы мастера hello, изменить параметры hello hello виртуальной машины и внесите другие изменения необходимые tooinstall Windows и других программ, например hello число виртуальных процессоров и нажмите кнопку **ОК**.
   3. Подключите toohello виртуальную машину и установите Windows Server 2012 R2.
4. Установите роль узла сеансов удаленных рабочих столов (RDSH) hello и возможности рабочего стола hello:
   1. Запустите диспетчер сервера.
   2. Нажмите кнопку **Добавить роли и компоненты** на экране приветствия hello или из hello **управление** меню.
   3. Нажмите кнопку **Далее** на странице перед началом hello.
   4. Выберите **Установка ролей или компонентов**, а затем нажмите кнопку **Далее**.
   5. Выберите из списка hello hello локального компьютера и нажмите кнопку **Далее**.
   6. Выберите **Службы удаленных рабочих столов**, а затем щелкните **Далее**.
   7. Разверните список **Пользовательские интерфейсы и инфраструктура** и выберите **Возможности рабочего стола**.
   8. Щелкните **Добавить компоненты**, а затем — **Далее**.
   9. На странице приветствия служб удаленных рабочих столов, нажмите кнопку **Далее**.
   10. Нажмите **Remote Desktop Session Host**(Узел сеансов удаленных рабочих столов).
   11. Щелкните **Добавить компоненты**, а затем — **Далее**.
   12. На странице выбора hello подтверждение установки выберите **перезапустите hello целевой сервер автоматически, если необходимо**и нажмите кнопку **Да** на hello перезапустите предупреждение.
   13. Щелкните **Install**(Установить). Hello компьютер будет перезагружен.
5. Установите дополнительные компоненты, необходимые для приложений, таких как hello .NET Framework 3.5. tooinstall функции hello, запустите мастер hello добавления ролей и компонентов.
6. Установите и настройте приветствия программы и приложения, toopublish через RemoteApp.

> [!IMPORTANT]
> Установка роли RDSH hello перед установкой приложений tooensure обнаруженных проблем с совместимостью приложений перед изображение hello отправлен tooRemoteApp.
> 
> Убедитесь, что в приложении tooyour ярлык (**.lnk** файла) отображается в hello **запустить** меню для всех пользователей (%systemdrive%\ProgramData\Microsoft\Windows\Start Menu\Programs). Также убедитесь, этот значок hello в hello **запустить** меню — это то, что нужно toosee пользователей. Если это не так, измените значок. (Нет *имеют* tooadd hello приложения toohello меню "Пуск", но он становится гораздо проще приложения hello toopublish в RemoteApp. Иначе необходимо установить путь установки hello tooprovide для приложения hello при публикации приложения hello.)
> 
> 

1. Выполните любые дополнительные настройки Windows, необходимые для приложений.
2. Отключите hello шифрованной файловой системы (EFS). Выполните следующую команду в командное hello.
   
     Fsutil behavior set disableencryption 1
   
   Кроме того можно задать или добавить следующие значения DWORD в реестре hello hello:
   
     HKLM\System\CurrentControlSet\Control\FileSystem\NtfsDisableEncryption = 1
3. При создании образа в виртуальной машине Azure, переименуйте hello  **\%windir%\Panther\Unattend.xml** файла, как это заблокирует сценарий отправки hello позже использовать работу. Изменить имя hello tooUnattend.old этот файл, чтобы по-прежнему имеется hello файла на случай необходимости toorevert развертывания.
4. Перейдите tooWindows обновлений и установите все важные обновления. Все обновления может потребоваться toorun несколько раз tooget центра обновления Windows. (Иногда после установки само обновление необходимо обновить.)
5. Образ SYSPREP hello. В командной строке с повышенными привилегиями выполните следующую команду hello.
   
   **C:\Windows\System32\sysprep\sysprep.exe /generalize /oobe /shutdown**.
   
   **Примечание:** используют hello **/mode:vm** переключателю hello команды SYSPREP, несмотря на то, что это — это виртуальная машина.

## <a name="next-steps"></a>Дальнейшие действия
У вас есть образ пользовательский шаблон, необходимо tooupload tooyour этого образа коллекции RemoteApp. Используйте сведения hello в следующие статьи toocreate hello вашей коллекции.

* [Как toocreate гибридной коллекции RemoteApp,](remoteapp-create-hybrid-deployment.md)
* [Как toocreate облака коллекцию RemoteApp](remoteapp-create-cloud-deployment.md)

