---
title: "Создание настраиваемого образа шаблона для Azure RemoteApp | Документация Майкрософт"
description: "Узнайте о том, как создать настраиваемый образ шаблона для Azure RemoteApp. Этот шаблон можно использовать для гибридной или облачной коллекции."
services: remoteapp
documentationcenter: 
author: msmbaldwin
manager: mbaldwin
editor: 
ms.assetid: b9ec5b51-f7cd-470b-8545-d0fd714c5982
ms.service: remoteapp
ms.workload: compute
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/26/2017
ms.author: mbaldwin
ms.openlocfilehash: f529a5526f266c7dbac3c719b244d05ab7705941
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-create-a-custom-template-image-for-azure-remoteapp"></a><span data-ttu-id="a48de-104">Создание настраиваемого образа шаблона для Azure RemoteApp</span><span class="sxs-lookup"><span data-stu-id="a48de-104">How to create a custom template image for Azure RemoteApp</span></span>
> [!IMPORTANT]
> <span data-ttu-id="a48de-105">Мы выводим службу Azure RemoteApp из эксплуатации 31 августа 2017 года.</span><span class="sxs-lookup"><span data-stu-id="a48de-105">Azure RemoteApp is being discontinued on August 31, 2017.</span></span> <span data-ttu-id="a48de-106">Дополнительные сведения см. в [объявлении](https://go.microsoft.com/fwlink/?linkid=821148).</span><span class="sxs-lookup"><span data-stu-id="a48de-106">Read the [announcement](https://go.microsoft.com/fwlink/?linkid=821148) for details.</span></span>
> 
> 

<span data-ttu-id="a48de-107">Azure RemoteApp использует образ шаблона Windows Server 2012 R2 для размещения всех программ, которыми вы планируете делиться с пользователями.</span><span class="sxs-lookup"><span data-stu-id="a48de-107">Azure RemoteApp uses a Windows Server 2012 R2 template image to host all the programs that you want to share with your users.</span></span> <span data-ttu-id="a48de-108">Чтобы создать образ шаблона RemoteApp, можно использовать существующий образ или создать новый.</span><span class="sxs-lookup"><span data-stu-id="a48de-108">To create a custom RemoteApp template image, you can start with an existing image or create a new one.</span></span> 

> [!TIP]
> <span data-ttu-id="a48de-109">Вы знаете, что можно создать образ из виртуальной машины Azure?</span><span class="sxs-lookup"><span data-stu-id="a48de-109">Did you know you can create an image from an Azure VM?</span></span> <span data-ttu-id="a48de-110">Это факт, и теперь импорт образа занимает меньше времени.</span><span class="sxs-lookup"><span data-stu-id="a48de-110">True story, and it cuts down on the amount of time it takes to import the image.</span></span> <span data-ttu-id="a48de-111">Узнайте [здесь](remoteapp-image-on-azurevm.md), как это сделать.</span><span class="sxs-lookup"><span data-stu-id="a48de-111">Check out the steps [here](remoteapp-image-on-azurevm.md).</span></span>
> 
> 

<span data-ttu-id="a48de-112">К образу, который может быть передан для использования с Azure RemoteApp, предъявляются следующие требования:</span><span class="sxs-lookup"><span data-stu-id="a48de-112">The requirements for the image that can be uploaded for use with Azure RemoteApp are:</span></span>

* <span data-ttu-id="a48de-113">Размер образа должен быть кратен 1 МБ.</span><span class="sxs-lookup"><span data-stu-id="a48de-113">The image size should be a multiple of MBs.</span></span> <span data-ttu-id="a48de-114">В противном случае при попытке отправить образ произойдет сбой.</span><span class="sxs-lookup"><span data-stu-id="a48de-114">If you try to upload an image that is not an exact multiple, the upload will fail.</span></span>
* <span data-ttu-id="a48de-115">Размер образа не должен превышать 127 ГБ.</span><span class="sxs-lookup"><span data-stu-id="a48de-115">The image size must be 127 GB or smaller.</span></span>
* <span data-ttu-id="a48de-116">Он должен быть помещен в VHD-файл (файлы VHDX [виртуальные жесткие диски Hyper-V] в настоящее время не поддерживаются).</span><span class="sxs-lookup"><span data-stu-id="a48de-116">It must be on a VHD file (VHDX files [Hyper-V virtual hard drives] are not currently supported).</span></span>
* <span data-ttu-id="a48de-117">Виртуальный жесткий диск VHD не должен быть виртуальной машиной 2 поколения.</span><span class="sxs-lookup"><span data-stu-id="a48de-117">The VHD must not be a generation 2 virtual machine.</span></span>
* <span data-ttu-id="a48de-118">виртуальный жесткий диск VHD должен быть либо фиксированного размера, либо иметь возможность динамического расширения.</span><span class="sxs-lookup"><span data-stu-id="a48de-118">The VHD can be either fixed-size or dynamically expanding.</span></span> <span data-ttu-id="a48de-119">Рекомендуется использовать VHD с динамическим расширением, поскольку на его передачу в Azure уходит меньше времени, чем на передачу VHD-файла с фиксированным размером.</span><span class="sxs-lookup"><span data-stu-id="a48de-119">A dynamically expanding VHD is recommended because it takes less time to upload to Azure than a fixed-size VHD file.</span></span>
* <span data-ttu-id="a48de-120">Диск должен быть инициализирован с использованием стиля разделов основной загрузочной записи (MBR).</span><span class="sxs-lookup"><span data-stu-id="a48de-120">The disk must be initialized using the Master Boot Record (MBR) partitioning style.</span></span> <span data-ttu-id="a48de-121">Стиль разделов (GPT) таблицы разделов GUID не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="a48de-121">The GUID partition table (GPT) partition style is not supported.</span></span>
* <span data-ttu-id="a48de-122">VHD должен содержать одну установку Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="a48de-122">The VHD must contain a single installation of Windows Server 2012 R2.</span></span> <span data-ttu-id="a48de-123">Он может содержать несколько томов, но только один из них может содержать установку Windows.</span><span class="sxs-lookup"><span data-stu-id="a48de-123">It can contain multiple volumes, but only one that contains an installation of Windows.</span></span>
* <span data-ttu-id="a48de-124">Должны быть установлены роль узла сеансов удаленных рабочих столов (RDSH) и компонент «Возможности рабочего стола».</span><span class="sxs-lookup"><span data-stu-id="a48de-124">The Remote Desktop Session Host (RDSH) role and the Desktop Experience feature must be installed.</span></span>
* <span data-ttu-id="a48de-125">Роль посредника подключений к удаленному рабочему столу *не* должна быть установлена.</span><span class="sxs-lookup"><span data-stu-id="a48de-125">The Remote Desktop Connection Broker role must *not* be installed.</span></span>
* <span data-ttu-id="a48de-126">Шифрующая файловая система (EFS) должна быть выключена.</span><span class="sxs-lookup"><span data-stu-id="a48de-126">The Encrypting File System (EFS) must be disabled.</span></span>
* <span data-ttu-id="a48de-127">Образ должен быть обработан командой SYSPREP с использованием параметров **/oobe /generalize /shutdown** (запуск при первом включении компьютера/ обобщить/ выключить). (Не используйте параметр **/mode:vm**.)</span><span class="sxs-lookup"><span data-stu-id="a48de-127">The image must be SYSPREPed using the parameters **/oobe /generalize /shutdown** (DO NOT use the **/mode:vm** parameter).</span></span>
* <span data-ttu-id="a48de-128">Отправка VHD из цепочки моментальных снимков не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="a48de-128">Uploading your VHD from a snapshot chain is not supported.</span></span>

<span data-ttu-id="a48de-129">**Перед началом работы**</span><span class="sxs-lookup"><span data-stu-id="a48de-129">**Before you begin**</span></span>

<span data-ttu-id="a48de-130">Перед созданием службы необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="a48de-130">You need to do the following before creating the service:</span></span>

* <span data-ttu-id="a48de-131">[Зарегистрироваться](https://azure.microsoft.com/services/remoteapp/) в RemoteApp.</span><span class="sxs-lookup"><span data-stu-id="a48de-131">[Sign up](https://azure.microsoft.com/services/remoteapp/) for RemoteApp.</span></span>
* <span data-ttu-id="a48de-132">Создайте учетную запись пользователя в Active Directory для использования в качестве учетной записи службы RemoteApp.</span><span class="sxs-lookup"><span data-stu-id="a48de-132">Create a user account in Active Directory to use as the RemoteApp service account.</span></span> <span data-ttu-id="a48de-133">Ограничьте разрешения для этой учетной записи, чтобы она могла только присоединять машины к домену.</span><span class="sxs-lookup"><span data-stu-id="a48de-133">Restrict the permissions for this account so that it can only join machines to the domain.</span></span> <span data-ttu-id="a48de-134">Дополнительные сведения см. в статье [Требования Azure AD + Active Directory для Azure RemoteApp](remoteapp-ad.md).</span><span class="sxs-lookup"><span data-stu-id="a48de-134">See [Configure Azure Active Directory for RemoteApp](remoteapp-ad.md) for more information.</span></span>
* <span data-ttu-id="a48de-135">Соберите сведения о локальной сети, а именно получить информацию об IP-адресе и VPN-устройстве.</span><span class="sxs-lookup"><span data-stu-id="a48de-135">Gather information about your on-premises network: IP address information and VPN device details.</span></span>
* <span data-ttu-id="a48de-136">установить модуль [Azure PowerShell](/powershell/azure/overview) .</span><span class="sxs-lookup"><span data-stu-id="a48de-136">Install the [Azure PowerShell](/powershell/azure/overview) module.</span></span>
* <span data-ttu-id="a48de-137">Соберите сведения о пользователях, которым нужно предоставить доступ.</span><span class="sxs-lookup"><span data-stu-id="a48de-137">Gather information about the users that you want to grant access to.</span></span> <span data-ttu-id="a48de-138">Это могут быть либо данные учетной записи Майкрософт, либо данные рабочей учетной записи Active Directory пользователя.</span><span class="sxs-lookup"><span data-stu-id="a48de-138">This can be either Microsoft account information or Active Directory work account information for users.</span></span>

## <a name="create-a-template-image"></a><span data-ttu-id="a48de-139">Создание образа шаблона</span><span class="sxs-lookup"><span data-stu-id="a48de-139">Create a template image</span></span>
<span data-ttu-id="a48de-140">Ниже приведены шаги высокого уровня по созданию образа шаблона с самого начала.</span><span class="sxs-lookup"><span data-stu-id="a48de-140">These are the high level steps to create a new template image from scratch:</span></span>

1. <span data-ttu-id="a48de-141">найти DVD или ISO-образ с Windows Server 2012 R2 Update;</span><span class="sxs-lookup"><span data-stu-id="a48de-141">Locate a Windows Server 2012 R2 Update DVD or ISO image.</span></span>
2. <span data-ttu-id="a48de-142">создать VHD-файл;</span><span class="sxs-lookup"><span data-stu-id="a48de-142">Create a VHD file.</span></span>
3. <span data-ttu-id="a48de-143">установить Windows Server 2012 R2;</span><span class="sxs-lookup"><span data-stu-id="a48de-143">Install Windows Server 2012 R2.</span></span>
4. <span data-ttu-id="a48de-144">установить роль узла сеансов удаленных рабочих столов (RDSH) и компонент «Возможности рабочего стола»;</span><span class="sxs-lookup"><span data-stu-id="a48de-144">Install the Remote Desktop Session Host (RDSH) role and the Desktop Experience feature.</span></span>
5. <span data-ttu-id="a48de-145">установить дополнительные функции, необходимые для приложений;</span><span class="sxs-lookup"><span data-stu-id="a48de-145">Install additional features required by your applications.</span></span>
6. <span data-ttu-id="a48de-146">установить и настроить ваши приложения;</span><span class="sxs-lookup"><span data-stu-id="a48de-146">Install and configure your applications.</span></span> <span data-ttu-id="a48de-147">Чтобы упростить совместное использование приложений, добавьте соответствующие приложения или программы в меню **Пуск** образа, в частности в раздел **%systemdrive%\ProgramData\Microsoft\Windows\Start Menu\Programs.</span><span class="sxs-lookup"><span data-stu-id="a48de-147">To make sharing apps easier, add any apps or programs that you want to share to the **Start** menu of the image, specifically in **%systemdrive%\ProgramData\Microsoft\Windows\Start Menu\Programs.</span></span>
7. <span data-ttu-id="a48de-148">Выполните любые дополнительные настройки Windows, необходимые для приложений.</span><span class="sxs-lookup"><span data-stu-id="a48de-148">Perform any additional Windows configurations required by your applications.</span></span>
8. <span data-ttu-id="a48de-149">Выключите шифрующую файловую систему (EFS).</span><span class="sxs-lookup"><span data-stu-id="a48de-149">Disable the Encrypting File System (EFS).</span></span>
9. <span data-ttu-id="a48de-150">**ОБЯЗАТЕЛЬНО.** Перейдите в Центр обновления Windows и установите все важные обновления.</span><span class="sxs-lookup"><span data-stu-id="a48de-150">**REQUIRED:** Go to Windows Update and install all important updates.</span></span>
10. <span data-ttu-id="a48de-151">Обработайте образ командой SYSPREP.</span><span class="sxs-lookup"><span data-stu-id="a48de-151">SYSPREP the image.</span></span>

<span data-ttu-id="a48de-152">Ниже приводится подробное описание шагов для создания нового образа:</span><span class="sxs-lookup"><span data-stu-id="a48de-152">The detailed steps for creating a new image are:</span></span>

1. <span data-ttu-id="a48de-153">найти DVD или ISO-образ с Windows Server 2012 R2 Update;</span><span class="sxs-lookup"><span data-stu-id="a48de-153">Locate a Windows Server 2012 R2 Update DVD or ISO image.</span></span>
2. <span data-ttu-id="a48de-154">создайте VHD-файл с помощью управления дисками;</span><span class="sxs-lookup"><span data-stu-id="a48de-154">Create a VHD file by using Disk Management.</span></span>
   
   1. <span data-ttu-id="a48de-155">запустите управление дисками (diskmgmt.msc);</span><span class="sxs-lookup"><span data-stu-id="a48de-155">Launch Disk Management (diskmgmt.msc).</span></span>
   2. <span data-ttu-id="a48de-156">создайте динамически расширяющийся VHD размером 40 ГБ или более;</span><span class="sxs-lookup"><span data-stu-id="a48de-156">Create a dynamically expanding VHD of 40 GB or more in size.</span></span> <span data-ttu-id="a48de-157">(Оцените объем дискового пространства, необходимый для Windows, ваших приложений и настроек.</span><span class="sxs-lookup"><span data-stu-id="a48de-157">(Estimate the amount of space needed for Windows, your applications, and customizations.</span></span> <span data-ttu-id="a48de-158">Установленный Windows Server с ролью RDSH и компонент «Возможности рабочего стола» требуют приблизительно 10 ГБ дискового пространства.)</span><span class="sxs-lookup"><span data-stu-id="a48de-158">Windows Server with the RDSH role and Desktop Experience feature installed will require about 10 GB of space).</span></span>
      
      1. <span data-ttu-id="a48de-159">Щелкните **Действие > Создать виртуальный жесткий диск**.</span><span class="sxs-lookup"><span data-stu-id="a48de-159">Click **Action > Create VHD**.</span></span>
      2. <span data-ttu-id="a48de-160">определите местоположение, размер и формат VHD;</span><span class="sxs-lookup"><span data-stu-id="a48de-160">Specify the location, size, and VHD format.</span></span> <span data-ttu-id="a48de-161">Выберите **Динамически расширяемый** и щелкните **ОК**.</span><span class="sxs-lookup"><span data-stu-id="a48de-161">Select **Dynamically expanding**, and then click **OK**.</span></span>
      
      <span data-ttu-id="a48de-162">Процесс создания диска занимает несколько секунд.</span><span class="sxs-lookup"><span data-stu-id="a48de-162">This will run for several seconds.</span></span> <span data-ttu-id="a48de-163">После окончания создания VHD вы должны увидеть новый диск без буквы диска в состоянии Not initialized (Не инициализирован) на консоли управления дисками.</span><span class="sxs-lookup"><span data-stu-id="a48de-163">When the VHD creation is complete, you should see a new disk without any drive letter and in “Not initialized" state in the Disk Management console.</span></span>
      
      * <span data-ttu-id="a48de-164">Щелкните диск правой кнопкой мыши (а не свободное место) и нажмите **Initialize Disk**(Инициализировать диск).</span><span class="sxs-lookup"><span data-stu-id="a48de-164">Right-click the disk (not the unallocated space), and then click **Initialize Disk**.</span></span> <span data-ttu-id="a48de-165">Выберите **MBR** (Основная загрузочная запись) в качестве стиля разделов и щелкните **ОК**.</span><span class="sxs-lookup"><span data-stu-id="a48de-165">Select **MBR** (Master Boot Record) as the partition style, and then click **OK**.</span></span>
      * <span data-ttu-id="a48de-166">Создайте том. Для этого щелкните правой кнопкой мыши незанятое пространство, а затем выберите **Создать простой том**.</span><span class="sxs-lookup"><span data-stu-id="a48de-166">Create a new volume: right-click the unallocated space, and then click **New Simple Volume**.</span></span> <span data-ttu-id="a48de-167">В мастере можно принять параметры по умолчанию, однако не забудьте присвоить букву диска, чтобы избежать возможных проблем при передаче образа шаблона.</span><span class="sxs-lookup"><span data-stu-id="a48de-167">You can accept the defaults in the wizard, but make sure you assign a drive letter to avoid potential problems when you upload the template image.</span></span>
      * <span data-ttu-id="a48de-168">Щелкните диск правой кнопкой мыши, а затем нажмите **Detach VHD**(Отсоединить VHD).</span><span class="sxs-lookup"><span data-stu-id="a48de-168">Right-click the disk, and then click **Detach VHD**.</span></span>
3. <span data-ttu-id="a48de-169">Установите Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="a48de-169">Install Windows Server 2012 R2:</span></span>
   
   1. <span data-ttu-id="a48de-170">Создайте новую виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="a48de-170">Create a new virtual machine.</span></span> <span data-ttu-id="a48de-171">Используйте Мастер новой виртуальной машины в диспетчере Hyper-V или клиент Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="a48de-171">Use the New Virtual Machine Wizard in Hyper-V Manager or Client Hyper-V.</span></span>
      1. <span data-ttu-id="a48de-172">На странице "Укажите поколение" выберите **Поколение 1**.</span><span class="sxs-lookup"><span data-stu-id="a48de-172">On the Specify Generation page, choose  **Generation 1**.</span></span>
      2. <span data-ttu-id="a48de-173">На странице «Подключить виртуальный жесткий диск» выберите параметр **Use an existing virtual hard disk**(Использовать существующий виртуальный жесткий диск) и перейдите к VHD, который был создан на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="a48de-173">On the Connect Virtual Hard Disk page, select **Use an existing virtual hard disk**, and browse to the VHD you created in the previous step.</span></span>
      3. <span data-ttu-id="a48de-174">На странице "Параметры установки" выберите **Установить операционную систему с загрузочного CD или DVD-диска**, а затем выберите расположение установочного носителя Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="a48de-174">On the Installation Options page, select **Install an operating system from a boot CD/DVD_ROM**, and then select the location of your Windows Server 2012 R2 installation media.</span></span>
      4. <span data-ttu-id="a48de-175">Выберите другие параметры в мастере, которые необходимы для установки Windows и ваших приложений.</span><span class="sxs-lookup"><span data-stu-id="a48de-175">Choose other options in the wizard necessary to install Windows and your applications.</span></span> <span data-ttu-id="a48de-176">Завершите работу мастера.</span><span class="sxs-lookup"><span data-stu-id="a48de-176">Finish the wizard.</span></span>
   2. <span data-ttu-id="a48de-177">После завершения работы мастера измените параметры виртуальной машины и внесите другие необходимые изменения для установки Windows и ваших программ (например, количество виртуальных машин), а затем нажмите **OK**.</span><span class="sxs-lookup"><span data-stu-id="a48de-177">After the wizard finishes, edit the settings of the virtual machine and make any other changes necessary to install Windows and your programs, such as the number of virtual processors, and then click **OK**.</span></span>
   3. <span data-ttu-id="a48de-178">Подключитесь к виртуальной машине и установите Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="a48de-178">Connect to the virtual machine and install Windows Server 2012 R2.</span></span>
4. <span data-ttu-id="a48de-179">Установите роль узла сеансов удаленных рабочих столов (RDSH) и компонент «Возможности рабочего стола»:</span><span class="sxs-lookup"><span data-stu-id="a48de-179">Install the Remote Desktop Session Host (RDSH) role and the Desktop Experience feature:</span></span>
   1. <span data-ttu-id="a48de-180">Запустите диспетчер сервера.</span><span class="sxs-lookup"><span data-stu-id="a48de-180">Launch Server Manager.</span></span>
   2. <span data-ttu-id="a48de-181">Щелкните **Добавить роли и компоненты** на экране приветствия или в меню **Управление**.</span><span class="sxs-lookup"><span data-stu-id="a48de-181">Click **Add Roles and features** on the Welcome screen or from the **Manage** menu.</span></span>
   3. <span data-ttu-id="a48de-182">Нажмите **Next** (Далее) на странице «Перед началом работы».</span><span class="sxs-lookup"><span data-stu-id="a48de-182">Click **Next** on the Before You Begin page.</span></span>
   4. <span data-ttu-id="a48de-183">Выберите **Установка ролей или компонентов**, а затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="a48de-183">Select **Role-based or feature-based installation**, and then click **Next**.</span></span>
   5. <span data-ttu-id="a48de-184">Выберите локальный компьютер из списка и нажмите **Next**.</span><span class="sxs-lookup"><span data-stu-id="a48de-184">Select the local machine from the list, and then click **Next**.</span></span>
   6. <span data-ttu-id="a48de-185">Выберите **Службы удаленных рабочих столов**, а затем щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="a48de-185">Select **Remote Desktop Services**, and then click **Next**.</span></span>
   7. <span data-ttu-id="a48de-186">Разверните список **Пользовательские интерфейсы и инфраструктура** и выберите **Возможности рабочего стола**.</span><span class="sxs-lookup"><span data-stu-id="a48de-186">Expand **User Interfaces and Infrastructure** and select **Desktop Experience**.</span></span>
   8. <span data-ttu-id="a48de-187">Щелкните **Добавить компоненты**, а затем — **Далее**.</span><span class="sxs-lookup"><span data-stu-id="a48de-187">Click **Add Features**, and then click **Next**.</span></span>
   9. <span data-ttu-id="a48de-188">На странице служб удаленных рабочих столов нажмите **Next**.</span><span class="sxs-lookup"><span data-stu-id="a48de-188">On the Remote Desktop Services page, click **Next**.</span></span>
   10. <span data-ttu-id="a48de-189">Нажмите **Remote Desktop Session Host**(Узел сеансов удаленных рабочих столов).</span><span class="sxs-lookup"><span data-stu-id="a48de-189">Click **Remote Desktop Session Host**.</span></span>
   11. <span data-ttu-id="a48de-190">Щелкните **Добавить компоненты**, а затем — **Далее**.</span><span class="sxs-lookup"><span data-stu-id="a48de-190">Click **Add Features**, and then click **Next**.</span></span>
   12. <span data-ttu-id="a48de-191">На странице "Подтверждение установки компонентов" выберите **Автоматический перезапуск конечного сервера, если требуется**, а затем щелкните **Да** в предупреждении о перезапуске.</span><span class="sxs-lookup"><span data-stu-id="a48de-191">On the Confirm installation selections page, select **Restart the destination server automatically if required**, and then click **Yes** on the restart warning.</span></span>
   13. <span data-ttu-id="a48de-192">Щелкните **Install**(Установить).</span><span class="sxs-lookup"><span data-stu-id="a48de-192">Click **Install**.</span></span> <span data-ttu-id="a48de-193">Компьютер перезапустится.</span><span class="sxs-lookup"><span data-stu-id="a48de-193">The computer will restart.</span></span>
5. <span data-ttu-id="a48de-194">Установите такие необходимые для приложений дополнительные компоненты, как .NET Framework 3.5.</span><span class="sxs-lookup"><span data-stu-id="a48de-194">Install additional features required by your applications, such as the .NET Framework 3.5.</span></span> <span data-ttu-id="a48de-195">Чтобы установить компоненты, запустите мастер добавления ролей и компонентов.</span><span class="sxs-lookup"><span data-stu-id="a48de-195">To install the features, run the Add Roles and Features Wizard.</span></span>
6. <span data-ttu-id="a48de-196">Установите и настройте программы и приложения, которые будут публиковаться через RemoteApp.</span><span class="sxs-lookup"><span data-stu-id="a48de-196">Install and configure the programs and applications you want to publish through RemoteApp.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a48de-197">Установите роль RDSH перед началом установки приложений, чтобы обнаружить все проблемы с совместимостью приложений до передачи образа в RemoteApp.</span><span class="sxs-lookup"><span data-stu-id="a48de-197">Install the RDSH role before installing applications to ensure that any issues with application compatibility are discovered before the image is uploaded to RemoteApp.</span></span>
> 
> <span data-ttu-id="a48de-198">Убедитесь, что ярлык приложения (файл **LNK**) отображается в меню **Пуск** для всех пользователей (%systemdrive%\ProgramData\Microsoft\Windows\Start Menu\Programs).</span><span class="sxs-lookup"><span data-stu-id="a48de-198">Make sure a shortcut to your application (**.lnk** file) appears in the **Start** menu for all users (%systemdrive%\ProgramData\Microsoft\Windows\Start Menu\Programs).</span></span> <span data-ttu-id="a48de-199">Кроме того, убедитесь, что в меню **Пуск** отображается тот значок, который должны видеть пользователи.</span><span class="sxs-lookup"><span data-stu-id="a48de-199">Also ensure that the icon you see in the **Start** menu is what you want users to see.</span></span> <span data-ttu-id="a48de-200">Если это не так, измените значок.</span><span class="sxs-lookup"><span data-stu-id="a48de-200">If not, change it.</span></span> <span data-ttu-id="a48de-201">(Добавлять приложения в меню "Пуск" *необязательно* , но это упростит публикацию приложения в RemoteApp.</span><span class="sxs-lookup"><span data-stu-id="a48de-201">(You do not *have* to add the application to the Start menu, but it makes it much easier to publish the application in RemoteApp.</span></span> <span data-ttu-id="a48de-202">В противном случае при публикации приложения потребуется указать путь установки.)</span><span class="sxs-lookup"><span data-stu-id="a48de-202">Otherwise, you have to provide the installation path for the application when you publish the app.)</span></span>
> 
> 

1. <span data-ttu-id="a48de-203">Выполните любые дополнительные настройки Windows, необходимые для приложений.</span><span class="sxs-lookup"><span data-stu-id="a48de-203">Perform any additional Windows configurations required by your applications.</span></span>
2. <span data-ttu-id="a48de-204">Выключите шифрующую файловую систему (EFS).</span><span class="sxs-lookup"><span data-stu-id="a48de-204">Disable the Encrypting File System (EFS).</span></span> <span data-ttu-id="a48de-205">Выполните следующую команду в окне команд с повышенными привилегиями:</span><span class="sxs-lookup"><span data-stu-id="a48de-205">Run the following command at an elevated command window:</span></span>
   
     <span data-ttu-id="a48de-206">Fsutil behavior set disableencryption 1</span><span class="sxs-lookup"><span data-stu-id="a48de-206">Fsutil behavior set disableencryption 1</span></span>
   
   <span data-ttu-id="a48de-207">Вместо этого можно задать или добавить следующее значение DWORD в реестре:</span><span class="sxs-lookup"><span data-stu-id="a48de-207">Alternatively, you can set or add the following DWORD value in the registry:</span></span>
   
     <span data-ttu-id="a48de-208">HKLM\System\CurrentControlSet\Control\FileSystem\NtfsDisableEncryption = 1</span><span class="sxs-lookup"><span data-stu-id="a48de-208">HKLM\System\CurrentControlSet\Control\FileSystem\NtfsDisableEncryption = 1</span></span>
3. <span data-ttu-id="a48de-209">Если сборка образа выполняется внутри виртуальной машины Azure, переименуйте файл **\%windir%\Panther\Unattend.xml**, так как он будет блокировать скрипт отправки, который используется позже во время работы.</span><span class="sxs-lookup"><span data-stu-id="a48de-209">If you are building your image inside an Azure virtual machine, rename the **\%windir%\Panther\Unattend.xml** file, as this will block the upload script used later from working.</span></span> <span data-ttu-id="a48de-210">Измените имя этого файла на Unattend.old, чтобы его можно было найти в случае, если потребуется вернуться к предыдущему развертыванию.</span><span class="sxs-lookup"><span data-stu-id="a48de-210">Change the name of this file to Unattend.old so that you will still have the file in case you need to revert your deployment.</span></span>
4. <span data-ttu-id="a48de-211">Перейдите в Центр обновления Windows и установите все важные обновления.</span><span class="sxs-lookup"><span data-stu-id="a48de-211">Go to Windows Update and install all important updates.</span></span> <span data-ttu-id="a48de-212">Центр обновления Windows может потребоваться запустить несколько раз, чтобы скачать все обновления.</span><span class="sxs-lookup"><span data-stu-id="a48de-212">You might need to run Windows Update multiple times to get all updates.</span></span> <span data-ttu-id="a48de-213">(Иногда после установки само обновление необходимо обновить.)</span><span class="sxs-lookup"><span data-stu-id="a48de-213">(Sometimes you install an update, and that update itself requires an update.)</span></span>
5. <span data-ttu-id="a48de-214">Обработайте образ командой SYSPREP.</span><span class="sxs-lookup"><span data-stu-id="a48de-214">SYSPREP the image.</span></span> <span data-ttu-id="a48de-215">В командной строке с повышенными привилегиями выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="a48de-215">At an elevated command prompt, run the following command:</span></span>
   
   <span data-ttu-id="a48de-216">**C:\Windows\System32\sysprep\sysprep.exe /generalize /oobe /shutdown**.</span><span class="sxs-lookup"><span data-stu-id="a48de-216">**C:\Windows\System32\sysprep\sysprep.exe /generalize /oobe /shutdown**</span></span>
   
   <span data-ttu-id="a48de-217">**Примечание.** Не используйте параметр команды SYSPREP **/mode:vm**, несмотря на то что это виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="a48de-217">**Note:** Do not use the **/mode:vm** switch of the SYSPREP command even though this is a virtual machine.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a48de-218">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a48de-218">Next steps</span></span>
<span data-ttu-id="a48de-219">Созданный настраиваемый образ шаблона необходимо добавить в коллекцию RemoteApp.</span><span class="sxs-lookup"><span data-stu-id="a48de-219">Now that you have your custom template image, you need to upload that image to your RemoteApp collection.</span></span> <span data-ttu-id="a48de-220">Чтобы создать коллекцию, воспользуйтесь информацией в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="a48de-220">Use the information in the following articles to create your collection:</span></span>

* [<span data-ttu-id="a48de-221">Создание гибридной коллекции RemoteApp</span><span class="sxs-lookup"><span data-stu-id="a48de-221">How to create a hybrid collection of RemoteApp</span></span>](remoteapp-create-hybrid-deployment.md)
* [<span data-ttu-id="a48de-222">Создание облачной коллекции RemoteApp</span><span class="sxs-lookup"><span data-stu-id="a48de-222">How to create a cloud collection of RemoteApp</span></span>](remoteapp-create-cloud-deployment.md)

