---
title: "Решение Office 365 в Operations Management Suite (OMS) | Документация Майкрософт"
description: "В этой статье представлены сведения о настройке и использовании решения Office 365 в OMS.  Она содержит подробное описание записей Office 365, создаваемых в службе Log Analytics."
services: operations-management-suite
documentationcenter: 
author: bwren
manager: carmonm
editor: 
ms.service: operations-management-suite
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: bwren
ms.openlocfilehash: 711071eaff7ab5e5199793663aa3cbb36a1e8d8a
ms.sourcegitcommit: 5735491874429ba19607f5f81cd4823e4d8c8206
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2017
---
# <a name="office-365-solution-in-operations-management-suite-oms"></a>Решение Office 365 в Operations Management Suite (OMS)

![Логотип Office 365](media/oms-solution-office-365/icon.png)

Решение Office 365 для Operations Management Suite (OMS) позволяет выполнять мониторинг среды Office 365 в Log Analytics.  

- Отслеживать действия пользователей в учетных записях Office 365 для анализа шаблонов использования, а также определять поведенческие тенденции. Например, можно извлечь конкретные сценарии использования, такие как файлы, к которым предоставлен общий доступ за пределами организации, или самые популярные сайты SharePoint.
- Отслеживать действия администратора, чтобы контролировать изменения конфигурации или операции с высоким уровнем привилегий.
- Выявлять и анализировать нежелательное поведение пользователей, которое можно настраивать, исходя из потребностей организации.
- Выполнять аудит и проверку соответствия. Например, можно отслеживать операции доступа к файлам для конфиденциальных файлов, что поможет в процессе аудита и проверки соответствия.
- Оперативно устранять неполадки с помощью поиска OMS на основе данных о действиях Office 365 в вашей организации.

## <a name="prerequisites"></a>Предварительные требования
Прежде чем устанавливать и настраивать это решение, необходимо иметь в наличии следующие компоненты.

- Подписка Office 365 организации.
- Учетные данные для учетной записи пользователя с правами глобального администратора.
- Для получения данных аудита необходимо [настроить аудит](https://support.office.com/en-us/article/Search-the-audit-log-in-the-Office-365-Security-Compliance-Center-0d4d0f35-390b-4518-800e-0c7ec95e946c?ui=en-US&rs=en-US&ad=US#PickTab=Before_you_begin) в подписке Office 365.  Обратите внимание, что [аудит почтовых ящиков](https://technet.microsoft.com/library/dn879651.aspx) настраивается отдельно.  Если аудит не настроен, вы все равно можете установить решение и собирать другие данные.
 


## <a name="management-packs"></a>Пакеты управления
В этом решении не предусматривается установка пакетов управления в подключенных группах управления.
  

## <a name="configuration"></a>Конфигурация
После [добавления решения Office 365 в подписку](../log-analytics/log-analytics-add-solutions.md) необходимо подключить его к подписке Office 365.

1. Добавьте решение управления оповещениями в рабочую область OMS, как описано в статье [Добавление решений](../log-analytics/log-analytics-add-solutions.md).
2. На портале OMS перейдите в меню **Параметры**.
3. В разделе **Подключенные источники** выберите **Office 365**.
4. Щелкните **Подключить Office 365**.<br>![Подключить Office 365](media/oms-solution-office-365/configure.png)
5. Войдите в Office 365 с помощью учетной записи глобального администратора вашей подписки. 
6. Напротив подписки отобразится список рабочих нагрузок, которые будут отслеживаться решением.<br>![Подключить Office 365](media/oms-solution-office-365/connected.png) 


## <a name="data-collection"></a>Сбор данных
### <a name="supported-agents"></a>Поддерживаемые агенты
Решение Office 365 не извлекает данные из каких-либо [агентов OMS](../log-analytics/log-analytics-data-sources.md).  Оно извлекает данные непосредственно из Office 365.

### <a name="collection-frequency"></a>Частота сбора
При создании каждой записи Office 365 отправляет в службу Log Analytics [уведомление веб-перехватчика](https://msdn.microsoft.com/office-365/office-365-management-activity-api-reference#receiving-notifications) с подробными данными.

## <a name="using-the-solution"></a>Использование решения
При добавлении решения Office 365 в рабочую область OMS на панель мониторинга OMS добавляется элемент **Office 365**. На этой плитке отображается количество и графическое представление количества компьютеров в вашей среде и соответствие обновлений.<br><br>
![Элемент сводки Office 365](media/oms-solution-office-365/tile.png)  

Щелкните элемент **Office 365**, чтобы открыть панель мониторинга **Office 365**.

![Панель мониторинга Office 365](media/oms-solution-office-365/dashboard.png)  

Панель мониторинга содержит столбцы, перечисленные в приведенной ниже таблице. Каждый столбец содержит десять ведущих оповещений с числом, показывающим соответствие оповещения критериям данного столбца, таким как область действия и диапазон времени. Можно выполнить поиск журналов, выводящий весь список, щелкнув элемент "Просмотреть все" внизу столбца или заголовок этого столбца.

| столбец | Описание |
|:--|:--|
| Операции | Предоставляет сведения об активных пользователях из всех отслеживаемых подписок Office 365. Также можно просмотреть количество действий, выполненных за определенный период времени.
| Exchange | Отображает разбивку по действиям Exchange Server, таким как Add-MailboxPermission (Добавление разрешения для почтового ящика) или Set-Mailbox (Настройка почтового ящика). |
| SharePoint | Отображает основные действия, выполняемые пользователями в отношении документов SharePoint. Если выполнить детализацию из этого элемента, то на странице поиска отобразятся сведения об этих действиях, такие как целевой документ и расположение действия. Например, для события доступа к файлу отобразится сам документ, к которому осуществляется доступ, связанное с ним имя учетной записи и IP-адрес. |
| Azure Active Directory | Включает в себя основные действия пользователей, такие как сброс пароля пользователя и попытка входа в систему. Если выполнить детализацию, то можно просмотреть подробные сведения об этих действиях, такие как состояние результата. Это полезно, в основном, для отслеживания подозрительных действий в Azure Active Directory. |




## <a name="log-analytics-records"></a>Записи Log Analytics

У всех записей, создаваемых решением Office 365 в рабочей области Log Analytics, свойство **Type** (Тип) имеет значение **OfficeActivity**.  Свойство **OfficeWorkload** определяет, к какой службе Office 365 относится запись — Exchange, Azure Active Directory, SharePoint или OneDrive.  Свойство **RecordType** указывает тип операции.  Эти свойства будут отличаться для каждого типа операции. Их описание приводится в таблице ниже.

### <a name="common-properties"></a>Общие свойства
Следующие свойства являются общими для всех записей Office 365.

| Свойство | Описание |
|:--- |:--- |
| Тип | *OfficeActivity* |
| ClientIP | IP-адрес устройства, которое использовалось при записи действия в журнал. IP-адрес отображается в формате IPv4- или IPv6-адреса. |
| OfficeWorkload | Служба Office 365, к которой относится запись.<br><br>AzureActiveDirectory<br>Exchange<br>SharePoint|
| Операция | Имя действия пользователя или администратора.  |
| OrganizationId | Идентификатор GUID для клиента Office 365 организации. Это значение для вашей организации всегда будет одинаковым независимо от службы Office 365, в которой оно встречается. |
| RecordType | Тип выполняемой операции. |
| ResultStatus | Указывает, было ли успешным действие (указанное в свойстве Operation). Возможные значения: Succeeded (Успешно), PartiallySucceded (Выполнено частично) и Failed (Сбой). Для действий администратора Exchange возможные значения — True (Истина) или False (Ложь). |
| UserId | Имя участника-пользователя (UPN) для пользователя, который выполнил действие, приведшее к регистрации в журнале данной записи. Например, my_name@my_domain_name. Обратите внимание, что сюда также включаются записи для действий, выполняемых системными учетными записями (такими как SHAREPOINT\system или NTAUTHORITY\SYSTEM). | 
| UserKey | Альтернативный идентификатор пользователя, определенного в свойстве UserId.  Например, значение этого свойства может заполняться уникальным идентификатором Passport (PUID) для событий, выполняемых пользователями в SharePoint, OneDrive для бизнеса и Exchange. Это свойство также может указывать то же значение, что и свойство UserID событий, происходящих в других службах, и событий, выполняемых системными учетными записями.|
| UserType | Тип пользователя, выполнившего операцию.<br><br>Администратор<br>Приложение<br>DcAdmin<br>Регулярное, <br>Reserved<br>ServicePrincipal<br>системный; |


### <a name="azure-active-directory-base"></a>Основа Azure Active Directory
Следующие свойства являются общими для всех записей Azure Active Directory.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | AzureActiveDirectory |
| RecordType     | AzureActiveDirectory |
| AzureActiveDirectory_EventType | Тип события Azure AD. |
| ExtendedProperties | Расширенные свойства события Azure AD. |


### <a name="azure-active-directory-account-logon"></a>Вход в учетную запись Azure Active Directory
Эти записи создаются при попытке пользователя Active Directory войти в систему.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | AzureActiveDirectory |
| RecordType     | AzureActiveDirectoryAccountLogon |
| Приложение | Приложение, которое активирует событие входа в учетную запись, например Office 15. |
| Клиент | Подробные сведения о клиентском устройстве, операционной системе устройства и браузере устройства, который использовался при событии входа в учетную запись. |
| LoginStatus | Это свойство получается непосредственно из параметра OrgIdLogon.LoginStatus. Сопоставление различных неудачных попыток входа в систему можно выполнить с помощью алгоритмов оповещения. |
| UserDomain | Сведения об идентификации клиента (TII). | 


### <a name="azure-active-directory"></a>Azure Active Directory
Эти записи создаются при внесении изменений или дополнений в объекты Azure Active Directory.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | AzureActiveDirectory |
| RecordType     | AzureActiveDirectory |
| AADTarget | Пользователь, в отношении которого было выполнено действие (указанное в свойстве Operation). |
| Субъект | Пользователь или субъект-служба, которые выполнили действие. |
| ActorContextId | Идентификатор GUID организации, к которой принадлежит субъект. |
| ActorIpAddress | IP-адрес субъекта в формате IPv4- или IPv6-адреса. |
| InterSystemsId | Идентификатор GUID, который отслеживает действия по компонентам в службе Office 365. |
| IntraSystemId |   Идентификатор GUID, который создается Azure Active Directory для отслеживания действия. |
| SupportTicketId | Идентификатор запроса пользователя в службу поддержки для действия в ситуациях "действовать от имени". |
| TargetContextId | Идентификатор GUID организации, к которой принадлежит целевой пользователь. |


### <a name="data-center-security"></a>Безопасность центра обработки данных
Эти записи создаются на основе данных аудита безопасности центра обработки данных.  

| Свойство | Описание |
|:--- |:--- |
| EffectiveOrganization | Имя клиента, в отношении которого выполнялось повышение прав или командлет. |
| ElevationApprovedTime | Метка времени, когда был утвержден запрос на повышение прав. |
| ElevationApprover | Имя представителя корпорации Майкрософт. |
| ElevationDuration | Период, в течение которого действовало повышение прав. |
| ElevationRequestId |  Уникальный идентификатор запроса на повышение прав. |
| ElevationRole | Роль, для которой было запрошено повышение прав. |
| ElevationTime | Время начала повышения прав. |
| Start_Time | Время начала выполнения командлета. |


### <a name="exchange-admin"></a>Администратор Exchange
Эти записи создаются при внесении изменений в конфигурацию Exchange.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | Exchange |
| RecordType     | ExchangeAdmin |
| ExternalAccess |  Указывает, кем выполнялся командлет (пользователем организации, персоналом центра обработки данных корпорации Майкрософт, учетной записью службы центра обработки данных или делегированным администратором). Значение False указывает на то, что командлет выполнялся пользователем вашей организации. Значение True означает, что командлет выполнялся персоналом центра обработки данных, учетной записью службы центра обработки данных или делегированным администратором. |
| ModifiedObjectResolvedName |  Это понятное имя объекта, который был изменен с помощью командлета. Эта запись вносится в журнал только в том случае, если командлет изменяет объект. |
| OrganizationName | Имя клиента. |
| OriginatingServer | Имя сервера, из которого выполнялся командлет. |
| Параметры | Имя и значение для всех параметров, которые использовались с командлетом, указанным в свойстве Operations. |


### <a name="exchange-mailbox"></a>Почтовый ящик Exchange
Эти записи создаются при внесении изменений или дополнений в почтовые ящики Exchange.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | Exchange |
| RecordType     | ExchangeItem |
| ClientInfoString | Сведения о почтовом клиенте, который использовался для выполнения операции, такие как версия браузера, версия Outlook или сведения о мобильном устройстве. |
| Client_IPAddress | IP-адрес устройства, которое использовалось при записи операции в журнал. IP-адрес отображается в формате IPv4- или IPv6-адреса. |
| ClientMachineName | Имя компьютера, на котором размещен клиент Outlook. |
| ClientProcessName | Клиент электронной почты, который использовался для доступа к почтовому ящику. |
| ClientVersion | Версия клиента электронной почты. |
| InternalLogonType | Зарезервировано для внутреннего использования. |
| Logon_Type | Указывает тип пользователя, который осуществил доступ к почтовому ящику и выполнил операцию, записанную в журнал. |
| LogonUserDisplayName |    Понятное имя пользователя, который выполнил операцию. |
| LogonUserSid | ИД безопасности пользователя, который выполнил операцию. |
| MailboxGuid | Идентификатор GUID Exchange почтового ящика, к которому осуществлялся доступ. |
| MailboxOwnerMasterAccountSid | ИД безопасности главной учетной записи для учетной записи владельца почтового ящика. |
| MailboxOwnerSid | ИД безопасности владельца почтового ящика. |
| MailboxOwnerUPN | Адрес электронной почты пользователя, владеющего почтовым ящиком, к которому осуществлялся доступ. |


### <a name="exchange-mailbox-audit"></a>Аудит почтового ящика Exchange
Эти записи создаются при создании записей аудита почтового ящика.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | Exchange |
| RecordType     | ExchangeItem |
| Элемент | Представляет элемент, в отношении которого выполнялась операция. | 
| SendAsUserMailboxGuid | Идентификатор GUID Exchange почтового ящика, к которому осуществлялся доступ для отправки почты с помощью команды "Отправить как". |
| SendAsUserSmtp | SMTP-адрес пользователя, олицетворяемого при отправке. |
| SendonBehalfOfUserMailboxGuid | Идентификатор GUID Exchange почтового ящика, к которому осуществлялся доступ для отправки почты с помощью команды "Отправить от имени". |
| SendOnBehalfOfUserSmtp | SMTP-адрес пользователя, от имени которого отправлялась почта. |


### <a name="exchange-mailbox-audit-group"></a>Группа аудита почтового ящика Exchange
Эти записи создаются при внесении изменений или дополнений в группы Exchange.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | Exchange |
| OfficeWorkload | ExchangeItemGroup |
| AffectedItems | Сведения о каждом элементе в группе. |
| CrossMailboxOperations | Указывает, задействовано ли в операции более одного почтового ящика. |
| DestMailboxId | Используется только в том случае, если параметр CrossMailboxOperations имеет значение True. Указывает GUID целевого почтового ящика. |
| DestMailboxOwnerMasterAccountSid | Используется только в том случае, если параметр CrossMailboxOperations имеет значение True. Указывает ИД безопасности главной учетной записи владельца целевого почтового ящика. |
| DestMailboxOwnerSid | Используется только в том случае, если параметр CrossMailboxOperations имеет значение True. Указывает ИД безопасности целевого почтового ящика. |
| DestMailboxOwnerUPN | Используется только в том случае, если параметр CrossMailboxOperations имеет значение True. Указывает имя участника-пользователя (UPN) владельца целевого почтового ящика. |
| DestFolder | Папка назначения для операций, таких как перемещение. |
| Папка | Папка, где находится группа элементов. |
| Папки |     Сведения об исходных папках, задействованных в операции. Например, если папки выбираются, а затем удаляются. |


### <a name="sharepoint-base"></a>Основа SharePoint
Эти свойства являются общими для всех записей SharePoint.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | SharePoint |
| OfficeWorkload | SharePoint |
| EventSource | Указывает, что событие произошло в SharePoint. Возможные значения: SharePoint или ObjectModel. |
| ItemType | Тип объекта, к которому осуществлялся доступ или который был изменен. Подробные сведения о типах объектов см. в таблице ItemType. |
| MachineDomainInfo | Сведения об операциях синхронизации устройств. Эти сведения сообщаются только в том случае, если они присутствуют в запросе. |
| MachineId |   Сведения об операциях синхронизации устройств. Эти сведения сообщаются только в том случае, если они присутствуют в запросе. |
| Site_ | Идентификатор GUID сайта, где расположен файл или папка, к которым осуществляется доступ пользователя. |
| Source_Name | Сущность, которая активировала отслеживаемую операцию. Возможные значения: SharePoint или ObjectModel. |
| UserAgent | Сведения о клиенте или браузере пользователя. Эти сведения предоставляются клиентом или браузером. |


### <a name="sharepoint-schema"></a>Схема SharePoint
Эти записи создаются при внесении изменений в конфигурацию SharePoint.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | SharePoint |
| OfficeWorkload | SharePoint |
| CustomEvent | Необязательная строка для пользовательских событий. |
| Event_Data |  Необязательные полезные данные для пользовательских событий. |
| ModifiedProperties | Свойство включено для событий администрирования, таких как добавление пользователя в качестве участника сайта или группы администраторов семейства веб-сайтов. Это свойство включает в себя имя свойства, которое было изменено (например, группа администраторов сайта), новое значение измененного свойства (такое как пользователь, добавленный в качестве администратора сайта) и предыдущее значение измененного объекта. |


### <a name="sharepoint-file-operations"></a>Операции с файлами SharePoint
Эти записи создаются в ответ на операции с файлами в SharePoint.

| Свойство | Описание |
|:--- |:--- |
| OfficeWorkload | SharePoint |
| OfficeWorkload | SharePointFileOperation |
| DestinationFileExtension | Расширение файла, который копируется или перемещается. Это свойство отображается только для событий FileCopied и FileMoved. |
| DestinationFileName | Имя файла, который копируется или перемещается. Это свойство отображается только для событий FileCopied и FileMoved. |
| DestinationRelativeUrl | URL-адрес папки назначения, в которую копируется или перемещается файл. Сочетание значений параметров SiteURL, DestinationRelativeURL и DestinationFileName совпадает со значением свойства ObjectID, которое является полным именем пути для скопированного файла. Это свойство отображается только для событий FileCopied и FileMoved. |
| SharingType | Тип разрешений на совместное использование, назначенных пользователю, которому был предоставлен доступ к ресурсу. Пользователь идентифицируется с помощью параметра UserSharedWith. |
| Site_Url | URL-адрес сайта, где расположен файл или папка, к которым осуществляется доступ пользователя. |
| SourceFileExtension | Расширение файла, к которому осуществлялся доступ пользователя. Это свойство остается пустым, если объект, к которому осуществлялся доступ, является папкой. |
| SourceFileName |  Имя файла или папки, к которым осуществляется доступ пользователя. |
| SourceRelativeUrl | URL-адрес папки, содержащей файл, к которому осуществляется доступ пользователя. Сочетание значений параметров SiteURL, SourceRelativeURL и SourceFileName совпадает со значением свойства ObjectID. Это свойство является полным именем пути для файла, к которому осуществляется доступ пользователя. |
| UserSharedWith |  Пользователь, которому был предоставлен доступ к ресурсу. |




## <a name="sample-log-searches"></a>Пример поисков журналов
Следующая таблица содержит примеры запросов поиска по журналу для получения записей обновлений, собранных этим решением.

| Запрос | Описание |
| --- | --- |
|Количество всех операций для подписки Office 365 |Type = OfficeActivity &#124; measure count() by Operation |
|Использование сайтов SharePoint|Type=OfficeActivity OfficeWorkload=sharepoint &#124; measure count() as Count by SiteUrl &#124; sort Count asc|
|Операции доступа к файлам по типу пользователя|Type=OfficeActivity OfficeWorkload=sharepoint Operation=FileAccessed &#124; measure count() by UserType|
|Поиск по определенному ключевому слову|Type=OfficeActivity OfficeWorkload=azureactivedirectory "MyTest"|
|Мониторинг внешних действий в отношении Exchange|Type=OfficeActivity OfficeWorkload=exchange ExternalAccess = true|



## <a name="troubleshooting"></a>Устранение неполадок

Если решение Office 365 не собирает данные, как ожидалось, то проверьте его состояние на портале OMS: **Параметры** -> **Подключенные источники** -> **Office 365**. В приведенной ниже таблице описывается каждое состояние.

| Status | Описание |
|:--|:--|
| Активна | Подписка Office 365 активна, а рабочая нагрузка успешно подключена к рабочей области OMS. |
| Ожидает | Подписка Office 365 активна, но рабочая нагрузка еще не подключена к рабочей области OMS. При первом подключении к подписке Office 365 все рабочие нагрузки будут находиться в этом состоянии, пока не выполнено их подключение. Переход всех рабочих нагрузок в состояние "Активно" может занять до 24 часов. |
| Неактивно | Подписка Office 365 неактивна. Дополнительные сведения смотрите на странице администрирования Office 365. После активации подписки Office 365 удалите ее связь с рабочей областью OMS, а затем снова свяжите, чтобы начать получать данные. |



## <a name="next-steps"></a>Дальнейшие действия
* Используйте поиск по журналам в [Log Analytics](../log-analytics/log-analytics-log-searches.md), чтобы просматривать подробные данные об обновлениях.
* [Создайте собственные панели мониторинга](../log-analytics/log-analytics-dashboards.md) для отображения избранных поисковых запросов Office 365.
* [Создайте оповещения](../log-analytics/log-analytics-alerts.md), чтобы заранее получать уведомления о важных действиях в Office 365.  
