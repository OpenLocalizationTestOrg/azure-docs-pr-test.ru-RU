---
title: "Использование репозитория Git в проекте Azure Machine Learning Workbench | Документация Майкрософт"
description: "В этой статье объясняется, как использовать репозиторий Git в сочетании с проектом Azure Machine Learning Workbench."
services: machine-learning
author: hning86
ms.author: haining
manager: haining
ms.reviewer: garyericson, jasonwhowell, mldocs
ms.service: machine-learning
ms.workload: data-services
ms.topic: article
ms.date: 11/18/2017
ms.openlocfilehash: f4f1112fe68bdb2a26f68b3da08fe97f9d22d3b7
ms.sourcegitcommit: 5d3e99478a5f26e92d1e7f3cec6b0ff5fbd7cedf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/06/2017
---
# <a name="use-a-git-repo-with-a-machine-learning-workbench-project"></a>Использование репозитория Git в проекте Azure Machine Learning Workbench
Узнайте, как в Azure Machine Learning Workbench используется Git для управления версиями и обеспечения повторяемости эксперимента по обработке и анализу данных. Узнайте, как связать проект с облачным репозиторием Git.

Проект Machine Learning Workbench предназначен для интеграции с Git. При создании проекта папка для него автоматически создается как локальный репозиторий Git. Кроме того, создается скрытый локальный репозиторий Git с ветвью AzureMLHistory /\<project GUID\>. Ветвь сохраняет сведения об изменениях папки проекта после каждого выполнения. 

За счет связывания проекта Машинного обучения Azure с репозиторием Git включается автоматическое управление версиями, как локально, так и удаленно. Репозиторий Git находится в Visual Studio Team Services (Team Services). Так как проект Машинного обучения связан с репозиторием Git, все, кто имеет доступ к удаленному репозиторию, могут скачать последний исходный код на другой компьютер (роуминг).  

> [!NOTE]
> Служба Team Services поддерживает собственный список управления доступом (ACL), который не зависит от службы "Экспериментирование в Машинном обучении Azure". Для разных репозиториев Git, рабочих областей или проектов Машинного обучения Azure может использоваться разный режим доступа пользователей. Вам может потребоваться управлять этим доступом. 
> 
> Независимо от того, хотите ли вы предоставить доступ к проекту Машинного обучения членам команды на уровне кода или просто предоставить общий доступ к рабочей области, вы должны предоставить им явные права для доступа к репозиторию Team Services Git. 

Вы можете управлять системой управления версиями Git, используя главную ветвь или создавая другие ветви в репозитории. Вы также можете использовать локальный репозиторий Git и передавать данные в удаленный репозиторий Git, если он предоставлен.

Следующая схема демонстрирует связь между проектом Машинного обучения Azure и репозиторием Team Services Git.

![Машинное обучение Azure и Git](media/using-git-ml-project/aml_git.png)

Чтобы начать работу с удаленным репозиторием Git, выполните действия, описанные в следующих разделах.

> [!NOTE]
> В настоящее время Машинное обучение Azure поддерживает репозитории Git только с учетными записями Team Services. В будущем планируется реализовать поддержку для общих репозиториев Git, таких как GitHub.

## <a name="step-1-create-a-machine-learning-experimentation-account"></a>Шаг 1. Создание учетной записи службы "Экспериментирование в Машинном обучении"
Создайте учетную запись службы "Экспериментирование в Машинном обучении" и установите приложение Machine Learning Workbench. Дополнительные сведения см. в статье [Создание учетной записи для предварительной версии службы "Машинное обучение Azure" и установка Azure Machine Learning Workbench](quickstart-installation.md).

## <a name="step-2-create-a-team-project-or-use-an-existing-team-project"></a>Шаг 2. Создание командного проекта или использование существующего командного проекта
На [портале Azure](https://portal.azure.com/) создайте командный проект.
1. Выберите **+**.
2. Выполните поиск по запросу **Командный проект**.
3. Введите необходимые сведения:
    - **Имя.** Имя команды.
    - **Управление версиями.** Выберите **Git**.
    - **Подписка.** Выберите подписку с учетной записью службы "Экспериментирование в Машинном обучении".
    - **Расположение.** Выберите регион, который находится близко к ресурсам службы "Экспериментирование в Машинном обучении".
4. Нажмите кнопку **Создать**. 

![Создание командного проекта на портале Azure](media/using-git-ml-project/create_vsts_team.png)

Убедитесь, что вы вошли в систему с использованием учетной записи Azure Active Directory (AAD), с помощью которой вы входили в Machine Learning Workbench, иначе система не сможет получить доступ к Azure Machine Learning Workbench с помощью учетных данных AAD. Исключением является создание проекта Машинного обучения с помощью командной строки и предоставление личного маркера доступа для доступа к репозиторию Git. Этот вопрос рассматривается более подробно далее в этом документе.

Чтобы перейти прямо к новому командному проекту, используйте URL-адрес https://\<team project name\>. visualstudio.com.

## <a name="step-3-set-up-a-machine-learning-project-and-git-repo"></a>Шаг 3. Настройка проекта Машинного обучения и репозитория Git

Чтобы настроить проект Машинного обучения, вам нужно сделать следующее:
- Создайте проект Машинного обучения, который содержит удаленный репозиторий Git.
- Свяжите имеющийся проект Машинного обучения с репозиторием Git Team Services.

### <a name="create-a-machine-learning-project-that-has-a-remote-git-repo"></a>Создание проекта Машинного обучения, который содержит удаленный репозиторий Git
Запустите Machine Learning Workbench и создайте проект. В **репозитории Git** введите URL-адрес репозитория Git Team Services из шага 2. Обычно этот адрес выглядит так: http://\<Team Services account name\>.visualstudio.com/_git/\<project name\>

![Создание проекта машинного обучения, который содержит репозиторий Git](media/using-git-ml-project/create_project_with_git_rep.png)

Кроме того, вы можете создать проект с помощью программы командной строки (Azure CLI). Вы можете указать личный маркер доступа. В службе "Машинное обучение Azure" этот маркер может использоваться для доступа к репозиторию Git вместо учетных данных Azure AD:

```
# Create a new project that has a Git repo by using a personal access token.
$ az ml project create -a <Experimentation account name> -n <project name> -g <resource group name> -w <workspace name> -r <Git repo URL> --vststoken <Team Services personal access token>
```

> [!IMPORTANT]
> При выборе пустого шаблона проекта в выбранном репозитории Git уже может быть главная ветвь. Служба "Машинное обучение" просто клонирует главную ветвь локально. Она добавляет папку aml_config и другие файлы метаданных проекта в папку локального проекта. 
>
> Но при выборе любого другого шаблона проекта в репозитории Git *не может* быть главной ветви. Если такая ветвь есть, появится сообщение об ошибке. В качестве альтернативы можно с помощью команды `az ml project create` создать проект с параметром `--force`. После этого файлы в исходной главной ветви удаляются и заменяются новыми файлами в выбранном шаблоне.

Теперь у вас есть новый проект Машинного обучения Azure с интегрированным удаленным репозиторием Git. Папка проекта всегда инициализируется для использования Git в локальном репозитории Git. Для удаленного репозитория Git Team Services устанавливается признак Git remote для передачи фиксаций в удаленный репозиторий Git.

### <a name="associate-an-existing-machine-learning-project-with-a-team-services-git-repo"></a>Связывание имеющегося проекта машинного обучения с репозиторием Git Team Services
Вы можете создать проект машинного обучения без репозитория Git Team Services, ограничившись локальным репозиторием Git для сохранения моментальных снимков журнала выполнения. Позже можно связать репозиторий Git Team Services с этим проектом с помощью следующей команды:

```azurecli
# Ensure that you are in the project path so Azure CLI has the context of your current project.
$ az ml project update --repo https://<Team Services account name>.visualstudio.com/_git/<project name>
```

> [!NOTE] 
> В проекте машинного обучения, с которым не связан ни один репозиторий Git, можно выполнить только обновление репозитория. Кроме того, когда репозиторий Git будет связан с проектом, его нельзя будет удалить.

## <a name="step-4-capture-a-project-snapshot-in-the-git-repo"></a>Шаг 4. Сохранение моментального снимка проекта в репозитории Git
Вы можете выполнить несколько запусков скриптов и внести между ними изменения. Для этого можно использовать классическое приложение или команду `az ml experiment submit` в интерфейсе командной строки Azure. Дополнительные сведения см. в статье [Часть 1. Классификация цветков ириса: подготовка данных](tutorial-classifying-iris-part-1.md). После каждого запуска (если в файлы в папке проекта внесены изменения) создается моментальный снимок всей папки проекта, который передается в удаленный репозиторий Git в ветвь с именем AzureMLHistory/\<project GUID\>. Для просмотра ветвей и фиксаций, в том числе ветви AzureMLHistory /\<project GUID\>, перейдите по URL-адресу репозитория Git Team Services. 

> [!NOTE] 
> Моментальный снимок фиксируется только до выполнения скрипта. Сейчас подготовка данных или выполнение ячеек Notebook не активирует создание моментального снимка.

![Ветвь журнала выполнений](media/using-git-ml-project/run_history_branch.png)

> [!IMPORTANT] 
> Мы не рекомендуем использовать команды Git в ветви журнала. Они могут повлиять на работу журнала выполнения. Вместо этого для собственных операций Git используйте главную ветвь или другие ветви.

## <a name="step-5-restore-a-previous-project-snapshot"></a>Шаг 5. Восстановление из предыдущего моментального снимка проекта 
В Machine Learning Workbench вы можете восстановить целиком всю папку проекта до состояния, сохраненного в журнале выполнения в виде моментального снимка.
1. На панели действия (значок в виде песочных часов) выберите **Запуски**.
2. В представлении **Список запусков** выберите запуск, который нужно восстановить.
3. В представлении **сведений о запуске** выберите **Восстановить**.

![Ветвь журнала выполнений](media/using-git-ml-project/restore_project.png)

При необходимости вы можете выполнить следующие команды из окна интерфейса командной строки Azure в Machine Learning Workbench.

```azurecli
# Discover the run I want to restore a snapshot from.
$ az ml history list -o table

# Restore the snapshot from a specific run.
$ az ml project restore --run-id <run ID>
```

Выполняйте эту команду с осторожностью. Она целиком перезапишет всю папку проекта данными из моментального снимка, который был создан в начале этого отдельного запуска. Ваш проект остается в текущей ветви. Вы **потеряете все изменения**, внесенные с тех пор в папке текущего проекта.  

Перед выполнением описанной выше операции вам может потребоваться зафиксировать изменения в текущей ветви репозитория Git.

## <a name="step-6-use-the-master-branch"></a>Шаг 6. Использование главной ветви
Чтобы избежать случайной потери данных состояния для текущего проекта, зафиксируйте проект в главную ветвь репозитория Git (или любую созданную вами ветвь). Действия с главной ветвью Git можно выполнять из командной строки (или с помощью любого удобного клиентского средства Git). Например:

```sh
# Check status to make sure you are on the master branch (or branch of your choice).
$ git status

# Stage all changes.
$ git add -A

# Commit all changes locally on the master branch.
$ git commit -m 'these are my updates so far'

# Push changes to the remote Team Services Git repo master branch.
$ git push origin master
```

Теперь вы можете безопасно восстановить проект на основе созданного ранее моментального снимка, как описано в шаге 5. Все последние изменения в проекте вы сможете восстановить из фиксации, которую вы только что сохранили в главной ветви.

## <a name="authentication"></a>Аутентификация
Если вы используете функции журнала выполнения в Машинном обучении только для создания и восстановления моментальных снимков проекта, можно не беспокоиться о проверке подлинности для репозитория Git. Эта задача решается на уровне службы "Экспериментирование в Машинном обучении".

Но если вы применяете собственные средства Git для управления версиями, важно правильно обрабатывать аутентификацию в удаленном репозитории Git в Team Services. В службе "Машинное обучение" удаленный репозиторий Git добавляется в локальный репозиторий в качестве удаленного с использованием протокола HTTPS. Это означает, что при отправке команд Git к удаленному репозиторию (например, push или pull), необходимо указать имя пользователя и пароль или личный маркер доступа. Выполните [эти инструкции](https://docs.microsoft.com/vsts/accounts/use-personal-access-tokens-to-authenticate), чтобы создать личный маркер доступа в репозитории Team Services Git.

## <a name="next-steps"></a>Дальнейшие действия
- Ознакомьтесь со статьей [Структурирование проектов с помощью шаблона процесса обработки и анализа данных группы](how-to-use-tdsp-in-azure-ml.md).
