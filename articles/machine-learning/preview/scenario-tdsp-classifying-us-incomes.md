---
title: "Классификация доходов: командный процесс обработки и анализа данных в службе \"Машинное обучение Microsoft Azure\" | Документация Майкрософт"
description: "Использование шаблона командного процесса обработки и анализа данных для создания проекта по классификации доходов граждан США в службе \"Машинное обучение Microsoft Azure\"."
services: machine-learning
documentationcenter: 
author: bradsev
manager: cgronlun
editor: cgronlun
ms.assetid: 
ms.reviewer: garyericson, jasonwhowell, mldocs
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/17/2017
ms.author: bradsev
ms.openlocfilehash: dc6279a1bac230146f4f0cebf2fbdbb6333cb7a1
ms.sourcegitcommit: 68aec76e471d677fd9a6333dc60ed098d1072cfc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/18/2017
---
# <a name="income-classification-with-team-data-science-process-tdsp-project"></a>Проект по классификации доходов с использованием командного процесса обработки и анализа данных (TDSP)

## <a name="introduction"></a>Общие сведения

Стандартизация структуры и документации проектов по обработке и анализу данных, которые привязаны к стабильному [жизненному циклу обработки и анализа данных](https://github.com/Azure/Microsoft-TDSP/blob/master/Docs/lifecycle-detail.md), — это главное условие успешной совместной работы в команде специалистов по обработке и анализу данных. Создавая проекты в службе "Машинное обучение Microsoft Azure" на основе шаблона [командного процесса обработки и анализа данных (TDSP)](https://github.com/Azure/Microsoft-TDSP), вы формируете платформу для стандартизации.

Ранее мы выпустили [репозиторий GitHub для структуры и шаблонов проектов TDSP](https://github.com/Azure/Azure-TDSP-ProjectTemplate). Однако до этого момента нам не удавалось создать экземпляры структуры и шаблонов TDSP в средстве обработки и анализа данных. Теперь, наконец, появилась возможность создавать экземпляры проектов службы "Машинное обучение Microsoft Azure" на основе [шаблонов структуры и документации TDSP для службы "Машинное обучение Microsoft Azure"](https://github.com/amlsamples/tdsp). Инструкции по использованию структуры и шаблонов TDSP в службе "Машинное обучение Microsoft Azure" вы найдете [здесь](https://aka.ms/how-to-use-tdsp-in-aml). В этой статье мы расскажем о том, как фактический проект машинного обучения создается на основе структуры TDSP, заполняется кодом, артефактами и документами, а затем выполняется в службе "Машинное обучение Microsoft Azure".

## <a name="link-to-github-repository"></a>Ссылка на репозиторий GitHub
Сводная документация по этому примеру размещена [здесь](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome). Более подробную документацию можно найти на сайте GitHub.

### <a name="purpose"></a>Назначение
Пример демонстрирует, как создается и выполняется проект машинного обучения на основе структуры и шаблонов [командного процесса обработки и анализа данных (TDSP)](https://github.com/Azure/Microsoft-TDSP) в службе "Машинное обучение Microsoft Azure". Для этого мы используем хорошо известный [набор данных о переписи населения США за 1994 год, размещенный в репозитории машинного обучения UCI](https://archive.ics.uci.edu/ml/datasets/adult). Задача моделирования — спрогнозировать распределение годового дохода граждан США по классам на основе данных из переписи населения (таких как возраст, этническая принадлежность, уровень образования, страна происхождения и пр.).

### <a name="scope"></a>Область
 * Изучение данных, обучение и развертывание модели машинного обучения для выполнения задачи прогнозирования. Задача описана в обзоре вариантов использования. 
 * Выполнение проекта в службе "Машинное обучение Microsoft Azure" на основе предоставляемого службой шаблона для командного процесса обработки и анализа данных (TDSP). Для выполнения проекта и создания отчетов мы будем использовать жизненный цикл TDSP.
 * Ввод решения в эксплуатацию напрямую из службы "Машинное обучение Microsoft Azure" в Службе контейнеров Azure.

 Проект демонстрирует использование ряда возможностей службы "Машинное обучение Microsoft Azure", например: создание и использование экземпляра структуры TDSP, выполнение кода в записных книжках Jupyter и файлов Python, простая процедура ввода в эксплуатацию в Службе контейнеров Azure с использованием Docker и Kubernetes.


## <a name="team-data-science-process-tdsp-lifecycle"></a>Жизненный цикл командного процесса обработки и анализа данных (TDSP)
См. статью о [жизненном цикле командного процесса обработки и анализа данных (TDSP)](https://github.com/Azure/Microsoft-TDSP/blob/master/Docs/lifecycle-detail.md).

![](./media/scenario-tdsp-classifying-us-incomes/tdsp-lifecycle.jpg)

## <a name="prerequisites"></a>Технические условия
### <a name="required-subscription-hardware-software"></a>Вам потребуются: подписка, оборудование и программное обеспечение
1. [Подписка](https://azure.microsoft.com) Azure. Для выполнения этого примера вы можете получить [бесплатную подписку](https://azure.microsoft.com/free/?v=17.16&WT.srch=1&WT.mc_id=AID559320_SEM_cZGgGOIg).
2. [Виртуальная машина Azure для обработки и анализа данных под управлением Windows Server 2016](https://azuremarketplace.microsoft.com/marketplace/apps/microsoft-ads.windows-data-science-vm) (размер виртуальной машины: [DS3_V2](https://docs.microsoft.com/azure/virtual-machines/windows/sizes), 4 виртуальных процессора и 14 ГБ ОЗУ). Решение тестировалось на виртуальной машине Azure для обработки и анализа данных, но, вероятнее всего, будет успешно работать на любом компьютере под управлением Windows 10.
3. Просмотрите документацию по службе "Машинное обучение Microsoft Azure" и связанным с ней службам (см. ссылки ниже).
4. Установите службу "Машинное обучение Microsoft Azure" в точном соответствии с инструкциями в [кратком руководстве по установке](quickstart-installation.md).

Набор данных для этого примера взят из репозитория ML UCI [[ссылка]](https://archive.ics.uci.edu/ml/datasets/adult). Это фрагмент базы данных для переписи населения США за 1994 год. Он содержит демографические сведения и суммы дохода примерно для 50 000 физических лиц. Это структурированный набор данных с числовыми и категориальными компонентами и категориальным целевым объектом, содержащим две категории дохода ("более 50 тысяч" или "не более 50 тысяч"). 

### <a name="optional-version-control-repository"></a>Необязательно: репозиторий с контролем версий
Если вам нужно сохранить проект и его содержимое с возможностью контроля версий, потребуется хранилище, которое поддерживает такую функциональность. При создании проекта с помощью шаблона TDSP вы сможете сохранить расположение репозитория Git в службе "Машинное обучение Microsoft Azure". Дополнительные сведения см. в статье об [использовании Git в службе "Машинное обучение Microsoft Azure"](using-git-ml-project.md).

### <a name="informational-about-azure-machine-learning"></a>Сведения о службе "Машинное обучение Microsoft Azure"
* [Часто задаваемые вопросы: как приступить к работе](frequently-asked-questions.md).
* [Обзор](overview-what-is-azure-ml.md)
* [Установка](quickstart-installation.md)
* [Выполнение](experimentation-service-configuration.md).
* [Использование TDSP](https://aka.ms/how-to-use-tdsp-in-aml).
* [Чтение и запись файлов](how-to-read-write-files.md).
* [Использование Git со службой "Машинное обучение Microsoft Azure"](using-git-ml-project.md).
* [Развертывание модели ML в качестве веб-службы](model-management-service-deploy.md).

### <a name="create-a-new-workbench-project"></a>Создание проекта в Workbench

Создайте проект, используя в качестве шаблона следующий пример:
1.  Откройте Azure Machine Learning Workbench.
2.  На странице **Projects** (Проекты) щелкните знак **+** и выберите **New Project** (Создать проект).
3.  В области **Create New Project** (Создание проекта) введите информацию о новом проекте.
4.  В поле поиска **Search Project Templates** (Поиск шаблонов проектов) введите Classify US incomes - TDSP project (Классификация доходов граждан США — проект TDSP) и выберите шаблон.
5.  Нажмите кнопку **Создать**.

Если во время создания проекта вы указали пустое расположение репозитория Git (в соответствующем поле), после создания проекта в репозитории будет размещена структура и содержимое проекта.

## <a name="use-case-overview"></a>Обзор вариантов использования
Необходимо использовать социально-экономические данные из переписи населения США, чтобы спрогнозировать годовой доход физических лиц в США. Задача машинного обучения — на основе этих данных переписи спрогнозировать категорию, в которую войдет доход физического лица: не более 50 000 долларов США или выше (задача двоичной классификации).

## <a name="data-description"></a>Описание данных
Подробные сведения о данных см. в [описании](https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.names) в репозитории UCI. 

Эти данные извлечены из базы данных Бюро переписи по адресу https://www.census.gov/en.html. 


* Набор данных включает 48 842 экземпляра (без фильтрации), как непрерывных, так и дискретных (32 561 для обучения и 16 281 для тестирования)
* Вероятность для метки "более 50 тысяч": 23,93 % или 24,78 % (без неизвестных)
* Вероятность для метки "не более 50 тысяч": 76,07 % или 75,22 % (без неизвестных)  

* **ЦЕЛЕВОЙ ОБЪЕКТ**: класс дохода "более 50 тысяч" или "не более 50 тысяч". На этапе подготовки данных эти категории заменяются значениями 1 и 0 соответственно.
* **КОМПОНЕНТЫ**: возраст, класс работы, уровень образования, этническая принадлежность, пол, часы работы в неделю и т. д.


## <a name="project-structure-execution-and-reporting"></a>Структура проекта, выполнение и отчетность

### <a name="structure"></a>structure
Для этого проекта мы используем шаблоны структуры папок и документации TDSP (см. ниже), которые соответствуют [жизненному циклу TDSP](https://github.com/Azure/Microsoft-TDSP/blob/master/Docs/lifecycle-detail.md). 

Проект создан с полным соблюдением инструкций, которые приведены [здесь](https://aka.ms/how-to-use-tdsp-in-aml). Когда он заполняется кодом и артефактами проекта, структура выглядит примерно так, как показано ниже (на приведенном ниже изображении см. структуру проекта в красном прямоугольнике).


<img src="./media/scenario-tdsp-classifying-us-incomes/instantiation-4.png" width="900" height="700">

### <a name="execution"></a>Выполнение
В этом примере мы выполняем код в **локальной вычислительной среде**. Дополнительные сведения о [параметрах выполнения](experimentation-service-configuration.md) вы найдете в документации по службе "Машинное обучение Microsoft Azure".

Выполнить скрипт Python в локальной среде вычислений Python очень легко:

    az ml experiment submit -c local my_script.py

Дважды щелкните файлы записной книжки IPython в структуре проекта. Она отображается в левой части пользовательского интерфейса службы "Машинное обучение Microsoft Azure". Файлы запустятся на сервере Jypyter.


Использовался следующий рабочий процесс обработки и анализа данных:

* [**Получение и анализ данных**](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome/tree/master/code/01_data_acquisition_and_understanding).

Данные загружались в CSV-файл с URL-адресов репозитория ML UCI [[ссылка]](https://archive.ics.uci.edu/ml/datasets/adult). Компоненты, целевой объект и их трансформации подробно описаны в файле ProjectReport.md.

Код для получения и анализа данных расположен в каталоге /code/01_data_acquisition_and_understanding.

Анализ данных выполняется с помощью [служебной программы IDEAR (интерактивное исследование данных и создание отчетов)](https://github.com/Azure/Azure-TDSP-Utilities/tree/master/DataScienceUtilities/DataReport-Utils/Python) для Python 3, которая входит в [набор средств TDSP для обработки и анализа данных](https://github.com/Azure/Azure-TDSP-Utilities). Эта программа позволяет создавать стандартизированные отчеты об исследовании данных, содержащих числовые и категориальные компоненты, а также целевой объект. Сведения об использовании программы IDEAR для Python 3 приведены ниже. 

Окончательный отчет об исследовании данных размещается с именем [IDEAR.html](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome/tree/master/docs/deliverable_docs). Ниже представлен пример отчета IDEAR:

![](./media/scenario-tdsp-classifying-us-incomes/idear.png)

* [**Моделирование**](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome/tree/master/code/02_modeling)

Мы создали две модели с трехкратной перекрестной проверкой: эластичная сетка и случайный лес. Мы использовали [выборку по 59 точкам](http://www.jmlr.org/papers/volume13/bergstra12a/bergstra12a.pdf) для поиска по случайной сетке (стратегия перекрестной проверки) и оптимизации параметров модели. Точность моделей оценивались по методу AUC (площадь под кривой) на тестовом наборе данных. 

Код для моделирования размещается в каталоге /code/02_modeling.

Для обоих вариантов (эластичная сетка и случайный лес) значение AUC превысило 0,85. Обе модели сохранены в файлах pickled.pkl, а на выходе созданы графики ROC для обеих моделей. Значение AUC для модели случайного леса составило 0,92, а для модели эластичной сетки — 0,90. Кроме того, для интерпретации моделей мы поместили показатели важности компонентов для модели случайного леса в отдельный CSV-файл. Также они представлены на графике в документе PDF (только 20 основных прогнозирующих компонентов).

Ниже представлен график ROC для **модели случайного леса** на основе тестовых данных. Именно эта модель была выбрана для развертывания.

![](./media/scenario-tdsp-classifying-us-incomes/rf-auc.png)

Ниже приведены показатели важности компонентов (основные 20) для модели случайного леса. Здесь мы видим, что наибольшее значение имеют такие компоненты, как прирост капитала, образование и семейное положение.

![](./media/scenario-tdsp-classifying-us-incomes/featImportance.png)

* [**Развертывание**](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome/tree/master/code/03_deployment)

Мы развернули модель случайного леса в качестве кластерной веб-службы в [Службе контейнеров Azure (ACS)](https://azure.microsoft.com/services/container-service/). Среда ввода в эксплуатацию подготавливает в кластере Docker и Kubernetes для управления развертыванием веб службы. Дополнительные сведения о вводе в эксплуатацию вы найдете [здесь](model-management-service-deploy.md). 

Код для развертывания размещен в каталоге /code/03_deployment.


### <a name="final-project-reporthttpsgithubcomazuremachinelearningsamples-tdspuciadultincomeblobmasterdocsdeliverabledocsprojectreportmd"></a>[Итоговый отчет по проекту](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome/blob/master/docs/deliverable_docs/ProjectReport.md)
Подробная информация по каждому из описанных выше разделов включена в подготовленный [итоговый отчет по проекту](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome/blob/master/docs/deliverable_docs/ProjectReport.md). Этот отчет содержит ряд дополнительных сведений о вариантах использования, метриках производительности модели, развертывании и инфраструктуре, в которой разрабатывался и развертывался проект.

Мы готовы предоставить клиентам отчет о проекте со всем содержимым папки проекта и репозиторий с контролем версий.


## <a name="conclusion"></a>Заключение

В этом примере мы продемонстрировали использование структуры и шаблонов TDSP в службе "Машинное обучение Microsoft Azure". Шаблоны документов и артефактов помогут вам:
1. правильно определить задачи и масштаб проекта;
2. создать проектную группу с распределением ролей и обязанностей;
3. структурировать и выполнить проект в соответствии с этапами жизненного цикла TDSP;
4. разработать стандартизированные отчеты с помощью служебных программ TDSP для обработки и анализа данных (например, IDEAR для исследования данных и визуализации отчетов);
5. подготовить окончательный отчет о проекте обработки и анализа данных, который можно передать клиенту.

Мы надеемся, что эта функция службы "Машинное обучение Microsoft Azure" поможет вам в стандартизации и организации совместной работы для команды обработки и анализа данных.

## <a name="next-steps"></a>Следующие шаги

Чтобы приступить к работе, изучите сведения по ссылкам ниже:

[Использование командного процесса обработки и анализа данных (TDSP) в службе "Машинное обучение Microsoft Azure"](https://aka.ms/how-to-use-tdsp-in-aml).

[Командный процесс обработки и анализа данных (TDSP)](https://github.com/Azure/Microsoft-TDSP).

[Шаблон проекта TDSP для службы "Машинное обучение Microsoft Azure"](https://aka.ms/tdspamlgithubrepo).

[Набор данных о доходах граждан США из репозитория ML UCI](https://archive.ics.uci.edu/ml/datasets/adult).