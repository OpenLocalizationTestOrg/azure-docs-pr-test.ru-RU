---
title: "Установка и настройка службы управления моделями Машинного обучения Azure | Документация Майкрософт"
description: "В этом документе описываются действия и основные понятия, использующиеся при установке и настройке службы управления моделями в Машинном обучении Azure."
services: machine-learning
author: raymondlaghaeian
ms.author: raymondl
manager: neerajkh
ms.reviewer: garyericson, jasonwhowell, mldocs
ms.service: machine-learning
ms.workload: data-services
ms.topic: article
ms.date: 08/29/2017
ms.openlocfilehash: 61ecea71874b05c2c5f7572aa6128fc320422b1f
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="model-management-setup"></a>Установка службы управления моделями

Этот документ содержит вводные сведения об использовании службы управления моделями Машинного обучения Azure для развертывания моделей машинного обучения в качестве веб-служб и управления ими. 

Используя управление моделями Машинного обучения Azure, можно эффективно развертывать модели машинного обучения, созданные с помощью нескольких платформ, включая SparkML, Keras, TensorFlow, Microsoft Cognitive Toolkit или Python, а также управлять ими. 

Выполнив инструкции в этом документе, вы сможете настроить среду управления моделями и подготовить ее к развертыванию моделей машинного обучения.

## <a name="what-you-need-to-get-started"></a>Что необходимо для начала работы
Для получения оптимального результата вам понадобятся права владельца на доступ к подписке Azure, в которую вы сможете развернуть модели.
Интерфейс командной строки поставляется предварительно установленным в Azure Machine Learning Workbench и на [виртуальных машинах Azure для обработки и анализа данных](https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-data-science-virtual-machine-overview).

## <a name="using-the-cli"></a>Использование интерфейса командной строки
Чтобы использовать интерфейсы командной строки (CLI) на платформе Workbench, щелкните **Файл** -> **Открыть командную строку**. 

На виртуальной машине для обработки и анализа данных подключитесь к командной строке и откройте ее. Введите `az ml -h` для просмотра параметров. Чтобы получить дополнительные сведения о командах, используйте параметр --help.

В остальных системах необходимо установить CLI.

### <a name="installing-or-updating-on-windows"></a>Установка (или обновление) в Windows

Установите Python с сайта https://www.python.org/. Убедитесь, что выбрана установка pip.

Откройте командную строку, используя запуск от имени администратора, а затем выполните следующие команды:

```cmd
pip install azure-cli
pip install azure-cli-ml
```
 
>[!NOTE]
>Если у вас установлена более ранняя версия, сначала удалите ее с помощью следующей команды:
>

```cmd
pip uninstall azure-cli-ml
```

### <a name="installing-or-updating-on-linux"></a>Установка (или обновление) в Linux
Выполните следующую команду из командной строки и следуйте указаниям.

```bash
sudo -i
pip install azure-cli
pip install azure-cli-ml
```

### <a name="configuring-docker-on-linux"></a>Настройка Docker в Linux
Чтобы настроить Docker в Linux для непривилегированных пользователей, следуйте приведенным здесь инструкциям: [Post-installation steps for Linux](https://docs.docker.com/engine/installation/linux/linux-postinstall/) (Шаги после установки для Linux).

>[!NOTE]
> На виртуальной машине для обработки и анализа данных под управлением Linux можно выполнить приведенный ниже скрипт, чтобы настроить Docker надлежащим образом. **Обязательно выйдите из системы и войдите снова после выполнения скрипта.**
>```
>sudo /opt/microsoft/azureml/initial_setup.sh
>```

## <a name="deploying-your-model"></a>Развертывание модели
Используйте CLI для развертывания моделей в качестве веб-служб. Их можно развернуть локально или в кластере.

Начните с локального развертывания, убедитесь, что модель и код работают, затем выполните развертывание в кластер для использования в производственных масштабах.

Чтобы начать, необходимо настроить среду развертывания. Это необходимо сделать всего лишь один раз. После настройки среду можно повторно использовать для последующих развертываний. Дополнительные сведения см. в следующем разделе.

Действия после настройки среды:
- Вам будет предложено войти в Azure. Чтобы войти, откройте в веб-браузере страницу https://aka.ms/devicelogin и введите предоставленный код для проверки подлинности.
- В процессе проверки подлинности вам будет предложена учетная запись, с помощью которой будет выполнена проверка подлинности. Важно! Выберите учетную запись с действительной подпиской Azure и необходимыми разрешениями для создания ресурсов. После входа вам предоставляются сведения о подписке и запрос на продолжение с выбранной учетной записью.

### <a name="environment-setup"></a>Настройка среды
Чтобы начать процесс установки, необходимо зарегистрировать поставщика среды, введя следующую команду:

```azurecli
az provider register -n Microsoft.MachineLearningCompute
```
#### <a name="local-deployment"></a>Локальное развертывание
Чтобы развернуть и протестировать веб-службу на локальном компьютере, настройте локальную среду, используя следующую команду. Имя группы ресурсов является необязательным.

```azurecli
az ml env setup -l [Azure Region, e.g. eastus2] -n [your environment name] [-g [existing resource group]]
```
>[!NOTE] 
>Для локального развертывания веб-службы необходимо установить Docker на локальном компьютере. 
>

Команда настройки локальной среды создает следующие ресурсы в подписке:
- группу ресурсов (если не указана или если указанное имя не существует);
- учетную запись хранения;
- реестр контейнеров Azure (ACR);
- учетную запись Application Insights.

После успешного завершения настройки настройте среду для использования с помощью следующей команды:

```azurecli
az ml env set -n [environment name] -g [resource group]
```

#### <a name="cluster-deployment"></a>Развертывание кластера
Используйте развертывание кластера для крупномасштабных рабочих сред. В этом случае кластер ACS настраивается с Kubernetes в качестве оркестратора. Кластер ACS можно масштабировать для обработки большей пропускной способности для вызовов вашей веб-службы.

Чтобы развернуть веб-службу в рабочей среде, сначала настройте среду, используя следующую команду:

```azurecli
az ml env setup --cluster -n [your environment name] -l [Azure region e.g. eastus2] [-g [resource group]]
```

Команда установки среды кластера создает следующие ресурсы в подписке:
- группу ресурсов (если не указана или если указанное имя не существует);
- учетную запись хранения;
- Реестр контейнеров Azure (ACR).
- развертывание Kubernetes в кластере Службы контейнеров Azure (ACS);
- учетную запись Application Insights.

>[!IMPORTANT]
> Для успешного создания кластерной среды необходимо быть владельцем подписки Azure, а также иметь возможность создать субъект-службу. Чтобы проверить наличие необходимых прав, выполните указания в этой статье: [Создание приложения Azure Active Directory и субъекта-службы с доступом к ресурсам с помощью портала](https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal).

Группа ресурсов, учетная запись хранения и запись контроля доступа создаются быстро. Развертывание ACS может занять до 20 минут. 

Чтобы проверить состояние подготовки текущего кластера, используйте следующую команду:

```azurecli
az ml env show -n [environment name] -g [resource group]
```

После завершения настройки необходимо настроить среду, которая будет использоваться в этом развертывании. Используйте следующую команду:

```azurecli
az ml env set -n [environment name] -g [resource group]
```

>[!NOTE] 
> После создания среды для последующих развертываний необходимо использовать только приведенную выше команду set.
>

### <a name="create-a-model-management-account"></a>Создание учетной записи управления моделями
Учетная запись Управления моделями необходима для развертывания моделей. Вам понадобится создать одну учетную запись для каждой подписки, а одну и ту же учетную запись можно использовать в нескольких развертываниях.

Создайте учетную запись с помощью следующей команды:

```azurecli
az ml account modelmanagement create -l [Azure region, e.g. eastus2] -n [your account name] -g [resource group name] --sku-instances [number of instances, e.g. 1] --sku-name [Pricing tier for example S1]
```

Чтобы использовать имеющуюся учетную запись, воспользуйтесь следующей командой:
```azurecli
az ml account modelmanagement set -n [your account name] -g [resource group it was created in]
```

### <a name="deploy-your-model"></a>Развертывание модели
Теперь вы готовы к развертыванию сохраненной модели в качестве веб-службы. 

```azurecli
az ml service create realtime --model-file [model file/folder path] -f [scoring file e.g. score.py] -n [your service name] -s [schema file e.g. service_schema.json] -r [runtime for the Docker container e.g. spark-py or python] -c [conda dependencies file for additional python packages]
```

## <a name="next-steps"></a>Дальнейшие действия
Воспользуйтесь одним из многих примеров в коллекции.
