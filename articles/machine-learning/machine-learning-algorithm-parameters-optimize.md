---
title: "Оптимизация алгоритмов в Машинном обучении Azure | Документация Майкрософт"
description: "В этой статье содержится информация о том, как выбрать оптимальный набор параметров для алгоритма в Машинном обучении Azure."
services: machine-learning
documentationcenter: 
author: bradsev
manager: jhubbard
editor: cgronlun
ms.assetid: 6717e30e-b8d8-4cc1-ad0b-1d4727928d32
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/29/2017
ms.author: bradsev
ms.openlocfilehash: b3be7f31ac31c656744fb809e3972af0ac4ad4f1
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="choose-parameters-to-optimize-your-algorithms-in-azure-machine-learning"></a><span data-ttu-id="13d1c-103">Выбор параметров для оптимизации алгоритмов в машинном обучении Azure</span><span class="sxs-lookup"><span data-stu-id="13d1c-103">Choose parameters to optimize your algorithms in Azure Machine Learning</span></span>
<span data-ttu-id="13d1c-104">В этой статье описывается, как выбрать правильный набор гиперпараметров для алгоритма в Машинном обучении Azure.</span><span class="sxs-lookup"><span data-stu-id="13d1c-104">This topic describes how to choose the right hyperparameter set for an algorithm in Azure Machine Learning.</span></span> <span data-ttu-id="13d1c-105">В большинстве алгоритмов машинного обучения есть параметры, которые необходимо настроить.</span><span class="sxs-lookup"><span data-stu-id="13d1c-105">Most machine learning algorithms have parameters to set.</span></span> <span data-ttu-id="13d1c-106">Например, это требуется сделать при обучении модели.</span><span class="sxs-lookup"><span data-stu-id="13d1c-106">When you train a model, you need to provide values for those parameters.</span></span> <span data-ttu-id="13d1c-107">Эффективность обученной модели зависит от выбранных для нее параметров.</span><span class="sxs-lookup"><span data-stu-id="13d1c-107">The efficacy of the trained model depends on the model parameters that you choose.</span></span> <span data-ttu-id="13d1c-108">Процесс определения оптимального набора параметров называется *выбором модели*.</span><span class="sxs-lookup"><span data-stu-id="13d1c-108">The process of finding the optimal set of parameters is known as *model selection*.</span></span>

[!INCLUDE [machine-learning-free-trial](../../includes/machine-learning-free-trial.md)]

<span data-ttu-id="13d1c-109">Выбор модели осуществляется разными способами.</span><span class="sxs-lookup"><span data-stu-id="13d1c-109">There are various ways to do model selection.</span></span> <span data-ttu-id="13d1c-110">В машинном обучении чаще всего используется перекрестная проверка (которая также представляет стандартный способ выбора модели в машинном обучении Azure).</span><span class="sxs-lookup"><span data-stu-id="13d1c-110">In machine learning, cross-validation is one of the most widely used methods for model selection, and it is the default model selection mechanism in Azure Machine Learning.</span></span> <span data-ttu-id="13d1c-111">Так как в машинном обучении Azure поддерживаются языки R и Python, вы всегда можете реализовать свой механизм выбора модели, используя привычные вам средства.</span><span class="sxs-lookup"><span data-stu-id="13d1c-111">Because Azure Machine Learning supports both R and Python, you can always implement their own model selection mechanisms by using either R or Python.</span></span>

<span data-ttu-id="13d1c-112">Оптимальный набор параметров подбирается в четыре этапа.</span><span class="sxs-lookup"><span data-stu-id="13d1c-112">There are four steps in the process of finding the best parameter set:</span></span>

1. <span data-ttu-id="13d1c-113">**Определение пространства параметров**. Сначала мы определяем точные значения параметров, которые будут учитываться алгоритмом.</span><span class="sxs-lookup"><span data-stu-id="13d1c-113">**Define the parameter space**: For the algorithm, first decide the exact parameter values you want to consider.</span></span>
2. <span data-ttu-id="13d1c-114">**Определение параметров перекрестной проверки**. Затем нам нужно определить, как будут выбираться свертки перекрестной проверки для набора данных.</span><span class="sxs-lookup"><span data-stu-id="13d1c-114">**Define the cross-validation settings**: Decide how to choose cross-validation folds for the dataset.</span></span>
3. <span data-ttu-id="13d1c-115">**Определение метрики**. Также нужно выбрать метрику, которая будет использоваться для определения оптимального набора параметров, включая правильность, среднеквадратическую погрешность, точность, полноту и F-оценку.</span><span class="sxs-lookup"><span data-stu-id="13d1c-115">**Define the metric**: Decide what metric to use for determining the best set of parameters, such as accuracy, root mean squared error, precision, recall, or f-score.</span></span>
4. <span data-ttu-id="13d1c-116">**Обучение, оценка и сравнение**. После этого для каждого уникального сочетания значений параметров на основе выбранной пользователем метрики погрешности выполняется перекрестная проверка.</span><span class="sxs-lookup"><span data-stu-id="13d1c-116">**Train, evaluate, and compare**: For each unique combination of the parameter values, cross-validation is carried out by and based on the error metric you define.</span></span> <span data-ttu-id="13d1c-117">После оценки и сравнения можно выбрать оптимальную модель.</span><span class="sxs-lookup"><span data-stu-id="13d1c-117">After evaluation and comparison, you can choose the best-performing model.</span></span>

<span data-ttu-id="13d1c-118">На следующем рисунке показано, как это осуществляется в машинном обучении Azure.</span><span class="sxs-lookup"><span data-stu-id="13d1c-118">The following image illustrates shows how this can be achieved in Azure Machine Learning.</span></span>

![Поиск оптимального набора параметров](./media/machine-learning-algorithm-parameters-optimize/fig1.png)

## <a name="define-the-parameter-space"></a><span data-ttu-id="13d1c-120">Определение пространства параметров</span><span class="sxs-lookup"><span data-stu-id="13d1c-120">Define the parameter space</span></span>
<span data-ttu-id="13d1c-121">Набор параметров можно определить на этапе инициализации модели.</span><span class="sxs-lookup"><span data-stu-id="13d1c-121">You can define the parameter set at the model initialization step.</span></span> <span data-ttu-id="13d1c-122">На панели параметров всех алгоритмов машинного обучения доступны два режима обучения: *Single Parameter* (Один параметр) и *Parameter Range* (Диапазон параметров).</span><span class="sxs-lookup"><span data-stu-id="13d1c-122">The parameter pane of all machine learning algorithms has two trainer modes: *Single Parameter* and *Parameter Range*.</span></span> <span data-ttu-id="13d1c-123">Выберите режим с диапазоном параметров.</span><span class="sxs-lookup"><span data-stu-id="13d1c-123">Choose Parameter Range mode.</span></span> <span data-ttu-id="13d1c-124">В этом режиме каждому параметру можно присвоить несколько значений.</span><span class="sxs-lookup"><span data-stu-id="13d1c-124">In Parameter Range mode, you can enter multiple values for each parameter.</span></span> <span data-ttu-id="13d1c-125">В текстовое поле можно ввести разделенные запятыми значения.</span><span class="sxs-lookup"><span data-stu-id="13d1c-125">You can enter comma-separated values in the text box.</span></span>

![Двухклассовое увеличивающееся дерево принятия решений](./media/machine-learning-algorithm-parameters-optimize/fig2.png)

 <span data-ttu-id="13d1c-127">Или же можно с помощью параметра **Use Range Builder** (Использовать построитель диапазонов) можно определить минимальное, максимальное и общее число создаваемых в сетке точек.</span><span class="sxs-lookup"><span data-stu-id="13d1c-127">Alternately, you can define the maximum and minimum points of the grid and the total number of points to be generated with **Use Range Builder**.</span></span> <span data-ttu-id="13d1c-128">По умолчанию значения параметров отображаются на линейной шкале.</span><span class="sxs-lookup"><span data-stu-id="13d1c-128">By default, the parameter values are generated on a linear scale.</span></span> <span data-ttu-id="13d1c-129">Но если установлен флажок **Log Scale** (Логарифмическая шкала), значения будут отображаться на логарифмической шкале (т. е. соотношение соседних точек останется неизменным).</span><span class="sxs-lookup"><span data-stu-id="13d1c-129">But if **Log Scale** is checked, the values are generated in the log scale (that is, the ratio of the adjacent points is constant instead of their difference).</span></span> <span data-ttu-id="13d1c-130">Диапазон для целочисленных параметров можно определить с помощью дефиса.</span><span class="sxs-lookup"><span data-stu-id="13d1c-130">For integer parameters, you can define a range by using a hyphen.</span></span> <span data-ttu-id="13d1c-131">Например, значение "1–10" указывает, что набор параметров образован всеми целыми числами от 1 до 10 (включая крайние).</span><span class="sxs-lookup"><span data-stu-id="13d1c-131">For example, “1-10” means that all integers between 1 and 10 (both inclusive) form the parameter set.</span></span> <span data-ttu-id="13d1c-132">Также поддерживается смешанный режим.</span><span class="sxs-lookup"><span data-stu-id="13d1c-132">A mixed mode is also supported.</span></span> <span data-ttu-id="13d1c-133">Например, набор параметров "1–10, 20, 50" будет включать целые числа от 1 до 10, а также 20 и 50.</span><span class="sxs-lookup"><span data-stu-id="13d1c-133">For example, the parameter set “1-10, 20, 50” would include integers 1-10, 20, and 50.</span></span>

![Двухклассовое увеличивающееся дерево принятия решений, диапазон параметров](./media/machine-learning-algorithm-parameters-optimize/fig3.png)

## <a name="define-cross-validation-folds"></a><span data-ttu-id="13d1c-135">Определение сверток перекрестной проверки</span><span class="sxs-lookup"><span data-stu-id="13d1c-135">Define cross-validation folds</span></span>
<span data-ttu-id="13d1c-136">Модуль [Partition and Sample][partition-and-sample] (Секционирование и выборка) используется для назначения сверток данным в случайном порядке.</span><span class="sxs-lookup"><span data-stu-id="13d1c-136">The [Partition and Sample][partition-and-sample] module can be used to randomly assign folds to the data.</span></span> <span data-ttu-id="13d1c-137">Ниже приведен пример с конфигурацией модуля, где задано пять сверток и выбран параметр случайного присвоения номеров сверток экземплярам выборки.</span><span class="sxs-lookup"><span data-stu-id="13d1c-137">In the following sample configuration for the module, we define five folds and randomly assign a fold number to the sample instances.</span></span>

![Секционирование и выборка](./media/machine-learning-algorithm-parameters-optimize/fig4.png)

## <a name="define-the-metric"></a><span data-ttu-id="13d1c-139">Определение метрики</span><span class="sxs-lookup"><span data-stu-id="13d1c-139">Define the metric</span></span>
<span data-ttu-id="13d1c-140">Модуль [Tune Model Hyperparameters][tune-model-hyperparameters] (Настройка гиперпараметров модели) позволяет эмпирически выбрать оптимальный набор параметров для заданного алгоритма и набора данных.</span><span class="sxs-lookup"><span data-stu-id="13d1c-140">The [Tune Model Hyperparameters][tune-model-hyperparameters] module provides support for empirically choosing the best set of parameters for a given algorithm and dataset.</span></span> <span data-ttu-id="13d1c-141">Вместе с другими сведениями об обучении модели на панели **свойств** этого модуля доступна метрика, которая позволяет определить оптимальный набор параметров.</span><span class="sxs-lookup"><span data-stu-id="13d1c-141">In addition to other information regarding training the model, the **Properties** pane of this module includes the metric for determining the best parameter set.</span></span> <span data-ttu-id="13d1c-142">На этой панели также есть два раскрывающихся списка для выбора алгоритмов классификации и регрессии.</span><span class="sxs-lookup"><span data-stu-id="13d1c-142">It has two different drop-down list boxes for classification and regression algorithms, respectively.</span></span> <span data-ttu-id="13d1c-143">Если рассматривается алгоритм классификации, то метрика регрессии игнорируется и наоборот.</span><span class="sxs-lookup"><span data-stu-id="13d1c-143">If the algorithm under consideration is a classification algorithm, the regression metric is ignored and vice versa.</span></span> <span data-ttu-id="13d1c-144">В этом примере метрика отображает значение **правильности**.</span><span class="sxs-lookup"><span data-stu-id="13d1c-144">In this specific example, the metric is **Accuracy**.</span></span>   

![Параметры анализа](./media/machine-learning-algorithm-parameters-optimize/fig5.png)

## <a name="train-evaluate-and-compare"></a><span data-ttu-id="13d1c-146">Обучение, оценка и сравнение</span><span class="sxs-lookup"><span data-stu-id="13d1c-146">Train, evaluate, and compare</span></span>
<span data-ttu-id="13d1c-147">Тот же модуль [настройки гиперпараметров модели][tune-model-hyperparameters] обучает все модели, соответствующие набору параметров, оценивает разные метрики, а затем создает оптимально обученную модель на основе выбранной вами метрики.</span><span class="sxs-lookup"><span data-stu-id="13d1c-147">The same [Tune Model Hyperparameters][tune-model-hyperparameters] module trains all the models that correspond to the parameter set, evaluates various metrics, and then creates the best-trained model based on the metric you choose.</span></span> <span data-ttu-id="13d1c-148">Для этого модуля необходимо обязательно предоставить следующие входные данные:</span><span class="sxs-lookup"><span data-stu-id="13d1c-148">This module has two mandatory inputs:</span></span>

* <span data-ttu-id="13d1c-149">необученный обучаемый объект;</span><span class="sxs-lookup"><span data-stu-id="13d1c-149">The untrained learner</span></span>
* <span data-ttu-id="13d1c-150">набор данных.</span><span class="sxs-lookup"><span data-stu-id="13d1c-150">The dataset</span></span>

<span data-ttu-id="13d1c-151">Для модуля также можно указать дополнительный набор данных.</span><span class="sxs-lookup"><span data-stu-id="13d1c-151">The module also has an optional dataset input.</span></span> <span data-ttu-id="13d1c-152">Подключите набор данных со сведениями о свертке к обязательному набору данных.</span><span class="sxs-lookup"><span data-stu-id="13d1c-152">Connect the dataset with fold information to the mandatory dataset input.</span></span> <span data-ttu-id="13d1c-153">Если для набора данных не назначены сведения о свертке, по умолчанию будет автоматически выполняться перекрестная проверка 10 сверток.</span><span class="sxs-lookup"><span data-stu-id="13d1c-153">If the dataset is not assigned any fold information, then a 10-fold cross-validation is automatically executed by default.</span></span> <span data-ttu-id="13d1c-154">Если свертка не назначена, а на дополнительный порт набора данных подан проверочный набор данных, будет выбран режим тестового обучения. В этом случае первый набор данных используется для обучения модели с каждой комбинацией параметров.</span><span class="sxs-lookup"><span data-stu-id="13d1c-154">If the fold assignment is not done and a validation dataset is provided at the optional dataset port, then a train-test mode is chosen and the first dataset is used to train the model for each parameter combination.</span></span>

![Классификатор увеличивающегося дерева решений](./media/machine-learning-algorithm-parameters-optimize/fig6a.png)

<span data-ttu-id="13d1c-156">Затем в проверочном наборе данных выполняется оценка модели.</span><span class="sxs-lookup"><span data-stu-id="13d1c-156">The model is then evaluated on the validation dataset.</span></span> <span data-ttu-id="13d1c-157">Левый порт вывода модуля отображает разные метрики как функции значений параметров.</span><span class="sxs-lookup"><span data-stu-id="13d1c-157">The left output port of the module shows different metrics as functions of parameter values.</span></span> <span data-ttu-id="13d1c-158">Правый порт вывода отображает обученную модель в соответствии с оптимальной моделью и выбранной метрикой (в нашем примере — метрикой **правильности**).</span><span class="sxs-lookup"><span data-stu-id="13d1c-158">The right output port gives the trained model that corresponds to the best-performing model according to the chosen metric (**Accuracy** in this case).</span></span>  

![Проверочный набор данных](./media/machine-learning-algorithm-parameters-optimize/fig6b.png)

<span data-ttu-id="13d1c-160">Чтобы просмотреть выбранные параметры, визуализируйте правый порт вывода.</span><span class="sxs-lookup"><span data-stu-id="13d1c-160">You can see the exact parameters chosen by visualizing the right output port.</span></span> <span data-ttu-id="13d1c-161">Эту модель можно использовать для оценки проверочного набора или в развернутой веб-службе после сохранения обученной модели.</span><span class="sxs-lookup"><span data-stu-id="13d1c-161">This model can be used in scoring a test set or in an operationalized web service after saving as a trained model.</span></span>

<!-- Module References -->
[partition-and-sample]: https://msdn.microsoft.com/library/azure/a8726e34-1b3e-4515-b59a-3e4a475654b8/
[tune-model-hyperparameters]: https://msdn.microsoft.com/library/azure/038d91b6-c2f2-42a1-9215-1f2c20ed1b40/
