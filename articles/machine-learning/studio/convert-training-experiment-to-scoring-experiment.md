---
title: "Как подготовить модель к развертыванию в студии машинного обучения Azure | Документация Майкрософт"
description: "Как подготовить обученную модель для развертывания в виде веб-службы, преобразовав обучающий эксперимент студии машинного обучения в прогнозный эксперимент."
services: machine-learning
documentationcenter: 
author: garyericson
manager: jhubbard
editor: cgronlun
ms.assetid: eb943c45-541a-401d-844a-c3337de82da6
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/28/2017
ms.author: garye
ms.openlocfilehash: 96434d6c5a2cf73e425c02d35d546ab33b7ac13d
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="how-to-prepare-your-model-for-deployment-in-azure-machine-learning-studio"></a>Как подготовить модель к развертыванию в студии машинного обучения Azure

Студия машинного обучения предоставляет все необходимые средства для разработки модели прогнозной аналитики и ее ввода в эксплуатацию с помощью развертывания в виде веб-службы Azure.

С помощью студии вы создадите *обучающий эксперимент*. С его помощью можно обучать, оценивать и редактировать создаваемую модель. Когда модель будет полностью вас устраивать, вы подготовите ее к развертыванию, преобразовав обучающий эксперимент в *прогнозный*, который предназначен для обработки пользовательских данных.

Полностью этот процесс описан в статье [Пошаговое руководство по разработке решения для прогнозной аналитики в службе машинного обучения Azure для оценки кредитных рисков](walkthrough-develop-predictive-solution.md).

В этой статье глубже и подробнее рассматриваются этапы преобразования обучающего эксперимента в прогнозный и последующего развертывания этого прогнозного эксперимента. Ознакомившись с этой информацией, вы сможете повысить эффективность своей модели, изменяя настройки развертывания.

[!INCLUDE [machine-learning-free-trial](../../../includes/machine-learning-free-trial.md)]

## <a name="overview"></a>Обзор 

Процесс преобразования обучающего эксперимента в прогностический эксперимент состоит из трех этапов.

1. Замените модули алгоритмов машинного обучения новой обученной моделью.
2. Ограничьте эксперимент только теми модулями, которые необходимы для оценки. Обучающий эксперимент включает несколько модулей, которые нужны только для обучения и бесполезны в готовой обученной модели.
3. Определите, как ваша модель будет принимать данные от пользователей веб-службы и какие данные она будет возвращать.

> [!TIP]
> В обучающем эксперименте все процессы обучения и оценки модели выполнялись с использованием готовых данных. Но после развертывания модель будет принимать от пользователей новые данные и возвращать им результаты прогноза. Поэтому при преобразовании обучающего эксперимента в прогнозный эксперимент и при последующем развертывании следует помнить о том, как эта модель будет использоваться.
> 
> 

## <a name="set-up-web-service-button"></a>Кнопка «Настроить веб-службу»
Когда вы успешно запустите эксперимент (для этого щелкните **Run** (Выполнить) в нижней части холста эксперимента), нажмите кнопку **Set Up Web Service** (Настроить веб-службу) и выберите вариант **Predictive Web Service** (Прогнозная веб-служба). Действие **Set Up Web Service** (Настройка веб-службы) выполняет следующие три шага по преобразованию обучающего эксперимента в прогнозный.

1. Сохраняет обученную модель в разделе **Trained Models** (обученные модели) на палитре модулей (слева от холста эксперимента). Заменяет алгоритм машинного обучения и модели [Train Model][train-model] (Обучение модели) сохраненной обученной моделью.
2. Анализирует эксперимент и удаляет модули, которые явным образом использовались только для обучения и потребность в которых отпала.
3. Добавляет в эксперимент стандартные модули _входных_ и _выходных_ данных веб-службы (эти модули принимают данные пользователя и возвращают ему результаты).

Например, следующий эксперимент предусматривает обучение модели двухклассового увеличивающегося дерева принятия решений с использованием примера данных переписи:

![эксперимент по обучению][figure1]

Модули в этом эксперименте в сущности выполняют четыре разные функции:

![Функции модуля][figure2]

Когда вы преобразуете этот обучающий эксперимент в прогнозный, некоторые из этих модулей станут ненужными или будут переназначены для других задач.

* **Данные.** Данные в этом примере набора данных не используются при оценке. Пользователь веб-службы предоставит данные, которые необходимо оценить. Однако обученная модель использует из этого набора данных метаданные, такие как типы данных. Поэтому в прогностическом эксперименте необходимо сохранить набор данных, чтобы он мог предоставлять эти метаданные.

* **Подготовка.** Возможно, эти модули понадобятся для обработки входных данных, которые пользователь отправит для оценки. Действие **Set Up Web Service** (Настройка веб-службы) не затрагивает эти модули. Вам нужно самостоятельно решить, что с ними делать.
  
    Например, в нашем примере образец набора данных может содержать записи с неполными данными, и для работы с ними добавлен модуль [Clean Missing Data][clean-missing-data] (Очистка недостающих данных). Кроме того, этот образец набора данных содержит столбцы, не используемые для обучения модели. Чтобы исключить эти дополнительные столбцы из потока данных, добавляется модуль [Select Columns in Dataset][select-columns] (Выбор столбцов в наборе данных). Если известно, что в данных, которые будут отправлены для оценки через веб-службу, не будет недостающих значений, можно удалить модуль [Clean Missing Data][clean-missing-data] (Очистка недостающих данных). Но модуль [Select Columns in Dataset][select-columns] (Выбор столбцов в наборе данных) необходимо оставить, так как он помогает определить набор столбцов, ожидаемых на входе обученной модели.

* **Обучение.** Эти модули используются для обучения модели. Когда вы выбираете действие **Set Up Web Service** (Настроить веб-службу), все эти модули заменяются одним модулем, который содержит обученную модель. Этот новый модуль сохраняется в разделе **Trained Models** (Обученные модели) в палитре модулей.

* **Оценка.** В нашем примере используется модуль [Split Data][split] (Разделение данных), который разделяет поток данных на два набора: обучающие данные и проверочные данные. В прогнозном эксперименте обучение не выполняется, поэтому модуль [Split Data][split] (Разделение данных) можно удалить. Аналогичным образом, можно удалить второй модуль [Score Model][score-model] (Оценка модели) и модуль [Evaluate Model][evaluate-model] (Анализ модели), которые используются для сравнения результатов обработки проверочных данных. Однако оставшийся модуль [Оценка модели][score-model] необходим для возврата результатов оценки через веб-службу.

После нажатия кнопки **Настроить веб-службу**наш пример выглядит следующим образом:

![Преобразованный прогностический эксперимент][figure3]

Вполне возможно, что действие **Set Up Web Service** (Настройка веб-службы) автоматически выполнит все необходимое для подготовки эксперимента к развертыванию в качестве веб-службы. Однако в зависимости от эксперимента могут потребоваться дополнительные действия.

### <a name="adjust-input-and-output-modules"></a>Настройка модулей входных и выходных данных
В своем эксперименте по обучению вы использовали набор данных для обучения, а затем выполнили обработку, чтобы получить данные в формате, необходимом для алгоритма машинного обучения. Если вы ожидаете, что веб-служба будет получать данные, для которых такая обработка не требуется, ее можно обойти. Для этого соедините выход модуля **Web service input** (Входные данные веб-службы) с другим модулем эксперимента. Теперь данные пользователя будут передаваться в модель именно через этот модуль.

Например, действие **Set Up Web Service** (Настройка веб-службы) по умолчанию размещает модуль **Web service input** (Входные данные веб-службы) в верхней части потока данных, как показано на рисунке выше. Но мы можем вручную переместить **Web service input** (Входные данные веб-службы) ниже и разместить его после модулей обработки данных.

![Перемещение входных данных веб-службы][figure4]

Теперь входные данные, предоставленные через веб-службу, будут передаваться непосредственно в модуль «Оценка модели» без предварительной обработки.

Аналогичным образом при нажатии кнопки **Настройка веб-службы** модуль выходных данных веб-службы по умолчанию помещается в нижнюю часть потока данных. В этом примере веб-служба будет возвращать пользователю выходные данные модуля [Score Model][score-model] (Оценка модели), то есть полный вектор входных данных и полные результаты оценки.
Однако, если вам необходимо, чтобы возвращались другие данные, добавьте дополнительные модули перед модулем **Web service output** (Выходные данные веб-службы). 

Например, если нужно возвращать только результаты оценки без вектора входных данных, можно добавить модуль [Select Columns in Dataset][select-columns] (Выбор столбцов в наборе данных), чтобы исключить все столбцы, кроме результатов оценки. Затем подключите модуль **Web service output** (Выходные данные веб-службы) к выходу модуля [Select Columns in Dataset][select-columns] (Выбор столбцов в наборе данных). Измененный эксперимент будет выглядеть так:

![Перемещение выходных данных веб-службы][figure5]

### <a name="add-or-remove-additional-data-processing-modules"></a>Добавление и удаление дополнительных модулей обработки данных
Если вам известно, что в эксперименте есть модули, которые не будут нужны при оценке, их можно удалить. Теперь, когда мы поместили модуль **Web service input** (Входные данные веб-службы) ниже модулей обработки данных, из прогнозного эксперимента можно удалить модуль [Clean Missing Data][clean-missing-data] (Очистка недостающих данных).

Теперь наш прогностический эксперимент выглядит следующим образом:

![Удаление дополнительного модуля][figure6]


### <a name="add-optional-web-service-parameters"></a>Добавление дополнительных параметров веб-службы
В некоторых случаях необходимо разрешить пользователю веб-службы менять поведение модулей при получении доступа к службе. *Параметры веб-службы* позволяют это сделать.

Например, часто используется модуль [Import Data][import-data] (Импорт данных), который позволяет пользователю развернутой веб-службы указать другой источник данных при обращении к веб-службе. Или настройка модуля [Экспорт данных][export-data], позволяющего указать другое назначение.

Можно определить параметры веб-службы и связать их с одним или несколькими параметрами модуля. Вы также можете указать, являются они обязательными или нет. Тогда при обращении к веб-службе пользователь сможет указать значения для этих параметров, чтобы изменить поведение модуля.

Дополнительные сведения о параметрах веб-службы и об их использовании см. в статье [Параметры веб-службы машинного обучения Azure][webserviceparameters].

[webserviceparameters]: web-service-parameters.md


## <a name="deploy-the-predictive-experiment-as-a-web-service"></a>Развертывание прогностического эксперимента в качестве веб-службы
Теперь, когда прогностический эксперимент был необходимым образом подготовлен, его можно развернуть в качестве веб-службы Azure. С помощью веб-службы пользователи могут отправлять данные модели, которая, в свою очередь, будет возвращать свои прогнозы.

Дополнительные сведения обо всем процессе развертывания см. в статье [Развертывание веб-службы машинного обучения Azure][deploy].

[deploy]: publish-a-machine-learning-web-service.md


<!-- Images -->
[figure1]:./media/convert-training-experiment-to-scoring-experiment/figure1.png
[figure2]:./media/convert-training-experiment-to-scoring-experiment/figure2.png
[figure3]:./media/convert-training-experiment-to-scoring-experiment/figure3.png
[figure4]:./media/convert-training-experiment-to-scoring-experiment/figure4.png
[figure5]:./media/convert-training-experiment-to-scoring-experiment/figure5.png
[figure6]:./media/convert-training-experiment-to-scoring-experiment/figure6.png


<!-- Module References -->
[clean-missing-data]: https://msdn.microsoft.com/library/azure/d2c5ca2f-7323-41a3-9b7e-da917c99f0c4/
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[select-columns]: https://msdn.microsoft.com/library/azure/1ec722fa-b623-4e26-a44e-a50c6d726223/
[import-data]: https://msdn.microsoft.com/library/azure/4e1b0fe6-aded-4b3f-a36f-39b8862b9004/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[split]: https://msdn.microsoft.com/library/azure/70530644-c97a-4ab6-85f7-88bf30a8be5f/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[export-data]: https://msdn.microsoft.com/library/azure/7a391181-b6a7-4ad4-b82d-e419c0d6522c/
