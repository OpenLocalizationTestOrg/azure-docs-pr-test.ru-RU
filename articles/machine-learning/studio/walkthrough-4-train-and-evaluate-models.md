---
title: "Шаг 4. Обучение и анализ моделей прогнозирующей аналитики | Документация Майкрософт"
description: "Четвертый этап пошагового руководства по разработке прогнозного решения: обучение и оценка нескольких моделей в студии машинного обучения Azure."
services: machine-learning
documentationcenter: 
author: garyericson
manager: jhubbard
editor: cgronlun
ms.assetid: d905f6b3-9201-4117-b769-5f9ed5ee1cac
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/23/2017
ms.author: garye
ms.openlocfilehash: 5a545b9f9f7f935be91fed743779ebd6b4d930a6
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="walkthrough-step-4-train-and-evaluate-the-predictive-analytic-models"></a>Шаг 4. Обучение и анализ моделей прогнозирующей аналитики
Это четвертая часть пошагового руководства [по разработке решения для прогнозной аналитики в Машинном обучении Azure](walkthrough-develop-predictive-solution.md).

1. [Создание рабочей области машинного обучения](walkthrough-1-create-ml-workspace.md)
2. [Отправка существующих данных](walkthrough-2-upload-data.md)
3. [Создание нового эксперимента](walkthrough-3-create-new-experiment.md)
4. **Обучение и анализ моделей**
5. [Развертывание веб-службы](walkthrough-5-publish-web-service.md)
6. [Доступ к веб-службе](walkthrough-6-access-web-service.md)

- - -
Одно из преимуществ использования студии машинного обучения Azure для создания моделей машинного обучения заключается в том, что вы можете проверить несколько типов моделей и сравнить их результаты в рамках одного эксперимента. Этот тип экспериментов помогает найти наилучшее решение проблемы.

В эксперименте, разрабатываемом в этом пошаговом руководстве, мы создадим два разных типа модели и сравним результаты их оценки, чтобы решить, какой алгоритм мы хотим использовать в нашем финальном эксперименте.  

Существует множество моделей, которые можно выбрать. Чтобы просмотреть доступные модели, разверните узел **Машинное обучение** в палитре модулей, а затем **Initialize Model** (Инициализация модели) и узлы под ним. Для этого эксперимента мы выберем модули [Two-Class Support Vector Machine][two-class-support-vector-machine] (Двухклассовый метод опорных векторов) и [Two-Class Boosted Decision Tree][two-class-boosted-decision-tree] (Двухклассовое увеличивающееся дерево решений).    

> [!TIP]
> Чтобы решить, какой алгоритм машинного обучения лучше всего подойдет для решения конкретной задачи, изучите статью [Выбор алгоритмов Машинного обучения Microsoft Azure](algorithm-choice.md).
> 
> 

## <a name="train-the-models"></a>Обучение моделей

В этот эксперимент мы добавим модули [Two-Class Support Vector Machine][two-class-boosted-decision-tree] (Двухклассовый метод опорных векторов) и [Two-Class Boosted Decision Tree][two-class-support-vector-machine] (Двухклассовое увеличивающееся дерево решений).

### <a name="two-class-boosted-decision-tree"></a>Двухклассовое увеличивающееся дерево принятия решений;

Сначала давайте настроим модуль увеличивающегося дерева решений.

1. Найдите модуль [Two-Class Boosted Decision Tree][two-class-boosted-decision-tree] (Двухклассовое увеличивающееся дерево решений) на палитре модулей и перетащите его на холст.

2. Найдите модуль [Train Model][train-model] (Обучение модели), перетащите его на холст, а затем подключите точку вывода модуля [Two-Class Boosted Decision Tree][two-class-boosted-decision-tree] (Двухклассовое увеличивающееся дерево решений) к левому порту ввода модуля [Train Model][train-model] (Обучение модели).
   
   Модуль [Two-Class Boosted Decision Tree][two-class-boosted-decision-tree] (Двухклассовое увеличивающееся дерево решений) инициализирует универсальную модель, а модуль [Train Model][train-model] (Обучение модели) использует обучающие данные для обучения модели. 

3. Соедините левый выход левого модуля [Execute R Script][execute-r-script] (Выполнение скрипта R) с правым портом ввода модуля [Train Model][train-model] (Обучение модели). Напомним, что на [шаге 3](walkthrough-3-create-new-experiment.md) этого руководства мы решили использовать для обучения данные, поступающие от левой стороны модуля разделения данных.
   
   > [!TIP]
   > Для этого эксперимента нам не нужны два входа и один выход модуля [Execute R Script][execute-r-script] (Выполнение скрипта R), поэтому мы просто оставим их неподключенными. 
   > 
   > 

Теперь эта часть эксперимента выглядит следующим образом.  

![Обучение модели][1]

Теперь мы сообщим модулю [Train Model][train-model] (Обучение модели), что наша модель должна прогнозировать значения кредитного риска (поле Credit Risk).

1. Выберите модуль [Train Model][train-model] (Обучение модели). В области **Properties** (Свойства) щелкните **Launch column selector** (Запустить средство выбора столбцов).

2. В диалоговом окне **Select a single column** (Выберите один столбец) введите в разделе **Available Columns** (Доступные столбцы) в поле поиска значение "Credit Risk", выберите внизу столбец Credit Risk (Кредитный риск) и нажмите кнопку со стрелкой вправо (**>**), чтобы переместить столбец "Credit Risk" (Кредитный риск) в раздел **Selected Columns** (Выбранные столбцы). 

    ![Выбор столбца "Credit Risk" (Кредитный риск) для модуля "Train Model" (Обучение модели)][0]

3. Нажмите кнопку с флажком (**ОК**).

### <a name="two-class-support-vector-machine"></a>Двухклассовая машина опорных векторов;

Теперь настроим модель SVM.  

Сначала немного информации о SVM. "Повышенные" деревья принятия решения хорошо работают с атрибутами любого типа. Однако поскольку модуль SVM создает линейный классификатор, генерируемая им модель имеет наименьшую ошибку при проверке среди всех атрибутов одного масштаба. Чтобы свести все числовые признаки к одному масштабу, мы используем преобразование "Tanh" (с помощью модуля [Normalize Data][normalize-data] (Нормализация данных)). Этот алгоритм преобразует все числа в значения, лежащие в интервале [0,1]. Модуль SVM преобразовывает строковые признаки в категориальные, а затем в бинарные признаки 0/1, поэтому вручную их преобразовывать не нужно. Кроме того, мы не хотим преобразовывать столбец кредитного риска (столбец 21) — он числовой, но мы обучаем модель прогнозировать именно его значение, поэтому нам не нужно его трогать.  

Чтобы настроить модель SVM, выполните следующие действия:

1. Найдите модуль [Two-Class Support Vector Machine][two-class-support-vector-machine] (Двухклассовый метод опорных векторов) на палитре модулей и перетащите его на холст.

2. Щелкните правой кнопкой мыши модуль [Train Model][train-model] (Обучение модели), выберите команду **Copy** (Копировать), а затем щелкните холст правой кнопкой мыши и выберите **Paste** (Вставить). Обратите внимание, что копия модуля [Train Model][train-model] (Обучение модели) имеет тот же набор выбранных столбцов, что и оригинал.

3. Соедините вывод модуля [Two-Class Support Vector Machine][two-class-support-vector-machine] (Двухклассовый метод опорных векторов) с левым портом ввода второго модуля [Train Model][train-model] (Обучение модели).

4. Найдите модуль [Normalize Data][normalize-data] (Нормализация данных) и перетащите его на холст.

5. Соедините ввод этого модуля с левым портом вывода левого модуля [Execute R Script][execute-r-script] (Выполнение скрипта R). Обратите внимание, что порт вывода любого модуля может быть подключен к нескольким модулям.

6. Соедините левый выходной порт модуля [Normalize Data][normalize-data] (Нормализация данных) с правым входным портом второго модуля [Train Model][train-model] (Обучение модели).

Теперь эта часть эксперимента должна выглядеть следующим образом.  

![Обучение второй модели][2]  

Теперь настройте модуль [Normalize Data][normalize-data] (Нормализация данных).

1. Щелкните модуль [Normalize Data][normalize-data] (Нормализация данных), чтобы выбрать его. На панели **Properties** (Свойства) выберите для параметра **Transformation method** (Метод преобразования) значение **Tanh**.

2. Щелкните **Запустить средство выбора столбцов** (Launch column selector), укажите для параметра **Begin With** (Начало с) значение No columns (Без столбцов). В первом раскрывающемся списке выберите пункт **Включение**, во втором — **column type** (тип столбца), а в третьем — **Числовой**. Это указывает, что будут преобразованы все числовые столбцы (и только числовые).

3. Щелкните знак плюса (+) в правой части этой строки. Это позволит создать строку с раскрывающимися списками. Выберите в первом раскрывающемся списке значение **Exclude** (Исключить), во втором раскрывающемся списке выберите **column names** (Имена столбцов), затем введите текст "Credit risk" в текстовом поле. Так мы сообщим модулю, что столбец "Credit Risk" (Кредитный риск) нужно игнорировать. В противном случае этот столбец будет преобразован, так как является числовым.

4. Нажмите кнопку с флажком (**ОК**).  

    ![Выбор столбцов для модуля "Normalize Data" (Нормализация данных)][5]

Теперь модуль [Normalize Data][normalize-data] (Нормализация данных) настроен для выполнения преобразования "Tanh" для всех числовых столбцов, за исключением столбца "Credit Risk" (Кредитный риск).  

## <a name="score-and-evaluate-the-models"></a>Оценка и анализ моделей

Мы будем использовать для оценки обученных моделей данные тестирования, которые были отделены модулем [Split Data][split] (Разделение данных). Затем можно сравнить результаты двух моделей, чтобы увидеть, которая модель создает лучший результат.  

### <a name="add-the-score-model-modules"></a>Добавление модулей "Score Model" (Оценка модели)

1. Найдите модуль [Score Model][score-model] (Оценка модели) и перетащите его на холст.

2. Подключите модуль [Train Model][train-model] (Обучение модели), который подключен к модулю [Two-Class Support Vector Machine][two-class-boosted-decision-tree] (Двухклассовый метод опорных векторов), к левому порту ввода нового модуля [Score Model][score-model] (Оценка модели).

3. Соедините правый модуль [Execute R Script][execute-r-script] (Выполнение скрипта R), который возвращает данные для тестирования, с правым входным портом модуля [Score Model][score-model] (Оценка модели).

    ![Модуль "Score Model" (Оценка модели) подключен][6]
   
   Теперь модуль [Score Model][score-model] (Оценка модели) может получить сведения о кредите из тестовых данных, обработать их с помощью модели и сравнить созданные моделью прогнозы с фактическими данными столбца кредитного риска из тестовых данных.

4. Скопируйте и вставьте модуль [Score Model][score-model] (Оценка модели), чтобы создать вторую копию.

5. Соедините выход модуля SVM (т. е. порт вывода модуля [Train Model][train-model] (Обучение модели), подключенного к модулю [Two-Class Support Vector Machine][two-class-support-vector-machine] (Двухклассовый метод опорных векторов)) со входным портом второго модуля [Score Model][score-model] (Оценка модели).

6. Для модели SVM необходимо выполнить то же самое преобразование тестовых данных, которое делалось для обучающих данных. Поэтому скопируйте и вставьте модуль [Normalize Data][normalize-data] (Нормализация данных), чтобы создать второй его экземпляр, и подключите его к выходу правого модуля [Execute R Script][execute-r-script] (Выполнение скрипта R).

7. Соедините левый выход второго модуля [Normalize Data][normalize-data] (Нормализация данных) с правым входным портом второго модуля [Score Model][score-model] (Оценка модели).

    ![Оба модуля "Score Model" (Оценка модели) подключены][7]

### <a name="add-the-evaluate-model-module"></a>Добавление модуля "Evaluate Model" (Анализ модели)

Чтобы проанализировать и сравнить два результата оценки, мы будем использовать модуль [Evaluate Model ][evaluate-model] (Анализ модели).  

1. Найдите модуль [Evaluate Model][evaluate-model] (Анализ модели) и перетащите его на холст.

2. Подключите порт вывода модуля [Score Model][score-model] (Оценка модели), связанного с модулем увеличивающегося дерева решений, к левому входному порту модуля [Evaluate Model][evaluate-model] (Анализ модели).

3. Соедините второй модуль [Score Model][score-model] (Оценка модели) с левым входным портом.  

    ![Модуль "Evaluate Model" (Анализ модели) подключен][8]

### <a name="run-the-experiment-and-check-the-results"></a>Запуск эксперимента и проверка результатов

Нажмите кнопку **ЗАПУСТИТЬ** внизу холста, чтобы запустить эксперимент. Это может занять несколько минут. В каждом модуле будет отображаться вращающийся индикатор, показывающий, что модуль выполняется. Когда модуль завершит работу, появится зеленый флажок. Если эта галочка появилась во всех модулях, значит эксперимент завершил выполнение.

Теперь наш эксперимент должен выглядеть следующим образом:  

![Сравнение обеих моделей][3]

Чтобы проверить результаты, щелкните правой кнопкой мыши порт вывода модуля [Evaluate Model][evaluate-model] (Анализ модели) и выберите **Visualize** (Визуализировать).  

Модуль [Evaluate Model][evaluate-model] (Анализ модели) создает пару кривых и метрики, которые позволяют сравнить результаты двух оцениваемых моделей. Результаты можно видеть в виде кривых ROC (рабочих характеристик приемника), кривых точности/полноты или кривых точности прогноза. Дополнительные отображаемые данные включают матрицу несоответствий, накопительные значения для области под кривой (AUC) и другие метрики. Вы можете изменить пороговое значение, перемещая ползунок влево или вправо, чтобы посмотреть, как это влияет на набор метрик.  

В правой части графика щелкните **Scored dataset** (Оцененный набор данных) или **Scored dataset to compare** (Оцененный набор данных для сравнения), чтобы выделить соответствующую кривую и отобразить внизу соответствующие метрики. В условных обозначениях для кривых "Scored dataset" (Оцененный набор данных) соответствует левому порту ввода модуля [Evaluate Model][evaluate-model] (Оценка модели). В нашем случае это модель увеличивающегося дерева решений. "Оцененный набор данных для сравнения" соответствует правому входному порту — в нашем случае это модель SVM. Щелкните одну из этих меток, чтобы выделить кривую и отобразить внизу метрики для соответствующей модели, как показано на рисунке ниже.  

![Кривые ROC для моделей][4]

Изучив эти значения, можно определить, какая модель обеспечивает более точные результаты. Можно вернуться назад и повторить эксперимент, изменяя значения параметров в моделях. 

Наука и искусство интерпретации результатов и настройки производительности моделей выходит за рамки этого руководства. Для получения дополнительной информации ознакомьтесь со следующими статьями.
- [Оценка эффективности модели в машинном обучении Microsoft Azure](evaluate-model-performance.md)
- [Выбор параметров для оптимизации алгоритмов в машинном обучении Azure](algorithm-parameters-optimize.md)
- [Интерпретация результатов модели в машинном обучении Azure](interpret-model-results.md)

> [!TIP]
> При каждом выполнении эксперимента запись об этой итерации сохраняется в журнале выполнения. Эти итерации можно просмотреть и вернуться к любой из них, нажав кнопку **ПРОСМОТР ЖУРНАЛА ВЫПОЛНЕНИЯ** под холстом. Можно также щелкнуть **Prior Run** (Предыдущее выполнение) на панели **Свойства**, чтобы открыть результаты предыдущей попытки сравнения.
> 
> Можно сделать копию любой итерации эксперимента, нажав кнопку **SAVE AS** (Сохранить как) под холстом. 
> Чтобы отслеживать, какие данные вы сравнивали на каждом этапе выполнения эксперимента, используйте свойства эксперимента **Сводка** и **Описание**.
> 
> Дополнительные сведения см. в статье [Управление итерациями экспериментов в Студии машинного обучения Azure](manage-experiment-iterations.md).  
> 
> 

- - -
**Дальнейшие действия: [Развертывание веб-службы](walkthrough-5-publish-web-service.md)**

[0]: ./media/walkthrough-4-train-and-evaluate-models/train-model-select-column.png
[1]: ./media/walkthrough-4-train-and-evaluate-models/experiment-with-train-model.png
[2]: ./media/walkthrough-4-train-and-evaluate-models/svm-model-added.png
[3]: ./media/walkthrough-4-train-and-evaluate-models/final-experiment.png
[4]: ./media/walkthrough-4-train-and-evaluate-models/roc-curves.png
[5]: ./media/walkthrough-4-train-and-evaluate-models/normalize-data-select-column.png
[6]: ./media/walkthrough-4-train-and-evaluate-models/score-model-connected.png
[7]: ./media/walkthrough-4-train-and-evaluate-models/both-score-models-added.png
[8]: ./media/walkthrough-4-train-and-evaluate-models/evaluate-model-added.png


<!-- Module References -->
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/
[split]: https://msdn.microsoft.com/library/azure/70530644-c97a-4ab6-85f7-88bf30a8be5f/
