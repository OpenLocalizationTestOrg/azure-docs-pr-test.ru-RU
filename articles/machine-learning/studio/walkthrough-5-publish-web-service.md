---
title: "Шаг 5. Развертывание веб-службы машинного обучения | Документация Майкрософт"
description: "Шаг 5 пошагового руководства по разработке прогностического решения. Развертывание прогностического эксперимента в студии машинного обучения в качестве веб-службы."
services: machine-learning
documentationcenter: 
author: garyericson
manager: jhubbard
editor: cgronlun
ms.assetid: 3fca74a3-c44b-4583-a218-c14c46ee5338
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/23/2017
ms.author: garye
ms.openlocfilehash: ba8f1678d87159088c58cf0e05e0fe5a6579b358
ms.sourcegitcommit: 5a6e943718a8d2bc5babea3cd624c0557ab67bd5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/01/2017
---
# <a name="walkthrough-step-5-deploy-the-azure-machine-learning-web-service"></a>Шаг 5. Развертывание веб-службы машинного обучения Azure
Это пятый этап пошагового руководства [Разработка решения для прогнозной аналитики в машинном обучении Azure](walkthrough-develop-predictive-solution.md)

1. [Создание рабочей области машинного обучения](walkthrough-1-create-ml-workspace.md)
2. [Отправка существующих данных](walkthrough-2-upload-data.md)
3. [Создание нового эксперимента](walkthrough-3-create-new-experiment.md)
4. [Обучение и анализ моделей](walkthrough-4-train-and-evaluate-models.md)
5. **Развертывание веб-службы**
6. [Доступ к веб-службе](walkthrough-6-access-web-service.md)

- - -
Чтобы другие пользователи могли применить прогнозную модель, которую мы создали в этом руководстве, мы развернем ее как веб-службу в Azure.

Вплоть до этого момента мы экспериментировали с обучением нашей модели. Но развернутая служба больше не будет обучаться. Теперь она создает новые прогнозы на основе нашей модели, оценивая введенные пользователем данные. Поэтому мы собираемся выполнить некоторую подготовку для преобразования этого эксперимента из ***обучающего*** в ***прогнозный***. 

Этот процесс состоит из трех этапов.  

1. Удаление одной из моделей
2. Преобразование *обучающего эксперимента* в *прогнозный эксперимент*
3. Развертывание прогностического эксперимента в качестве веб-службы

## <a name="remove-one-of-the-models"></a>Удаление одной из моделей

Прежде всего нам нужно немного сократить этот эксперимент. Сейчас в эксперименте есть две разные модели, но для развертывания в качестве веб-службы используется только одна.  

Допустим, мы решили, что модель увеличивающегося дерева подходит нам лучше, чем модель опорных векторов. Поэтому сначала мы удалим модуль [Two-Class Support Vector Machine][two-class-support-vector-machine] (Двухклассовый метод опорных векторов) и все модули, которые использовались для его обучения. Сначала создайте копию эксперимента, нажав кнопку **Сохранить как** в нижней части полотна эксперимента.

Необходимо удалить следующие модули:  

* [Two-Class Support Vector Machine][two-class-support-vector-machine] (Двухклассовый метод опорных векторов);
* модули [Train Model][train-model] (Обучение модели) и [Score Model][score-model] (Оценка модели), которые были к нему подключены;
* оба модуля [Normalize Data][normalize-data] (Нормализация данных);
* [Evaluate Model][evaluate-model] (Анализ модели) — так как процесс анализа уже завершен.

Поочередно выберите каждый из этих модулей и нажмите клавишу DELETE или щелкните модуль правой кнопкой мыши и выберите **Delete** (Удалить). 

![После удаления модели SVM][3a]

Теперь ваша модель должна выглядеть примерно так:

![После удаления модели SVM][3]

Теперь мы готовы к развертыванию этой модели с помощью модуля [Two-Class Boosted Decision Tree][two-class-boosted-decision-tree] (Двухклассовое увеличивающееся дерево принятия решений).

## <a name="convert-the-training-experiment-to-a-predictive-experiment"></a>Преобразование обучающего эксперимента в прогностический эксперимент

Чтобы подготовить модель к развертыванию, следует преобразовать обучающий эксперимент в прогнозный. Этот процесс состоит из трех этапов.

1. Сохраните обученную модуль и замените обучающие модули.
2. удаление из эксперимента модулей, которые были необходимы только для обучения;
3. Определение расположений для получения входных данных и создания выходных данных веб-службы.

Эти действия можно выполнять вручную, вы также можете выполнить все три шага автоматически. Для этого щелкните в нижней части холста эксперимента **Set Up Web Service** (Настроить веб-службу) и выберите **Predictive Web Service** (Прогнозная веб-служба).

> [!TIP]
> Процесс преобразовании обучающего эксперимента в прогнозный эксперимент подробно описан в [этой статье](convert-training-experiment-to-scoring-experiment.md).

При щелчке **Set Up Web Service**(Настроить веб-службу) происходит следующее.

* Обученная модель сохраняется как отдельный модуль **Trained Model** (Обученная модель) и доступна в палитре модулей слева от холста эксперимента (в разделе **Trained Models** (Обученные модели)).
* Удаляются следующие модули, которые мы использовали для обучения:
  * [Two-Class Boosted Decision Tree][two-class-boosted-decision-tree] (Двухклассовое увеличивающееся дерево принятия решений);
  * [Train Model][train-model] (Обучение модели);
  * [Split Data][split] (Разделение данных);
  * второй модуль [Execute R Script][execute-r-script] (Выполнение скрипта R), который использовался для тестовых данных.
* Сохраненная обученная модель добавляется обратно в эксперимент.
* Добавляются модули **Web service input** (Входные данные веб-службы) и **Web service output** (Выходные данные веб-службы). Они определяют, откуда поступают пользовательские данные при обращении к веб-службе и какие данные возвращаются.

> [!NOTE]
> Как можно заметить, эксперимент сохраняется на двух вкладках, которые добавляются в верхней части холста эксперимента. Исходный обучающий эксперимент теперь размещается на вкладке **Training experiment** (Обучающий эксперимент), а только что созданный прогнозный эксперимент — на вкладке **Predictive experiment** (Прогнозный эксперимент). В качестве веб-службы мы будем развертывать именно прогнозный эксперимент.

С этим экспериментом необходимо выполнить одно дополнительное действие.
Ранее мы добавили два модуля [Execute R Script][execute-r-script] (Выполнение скрипта R), чтобы реализовать функцию взвешивания данных. Этот маневр нам был нужен только для обучения и тестирования, поэтому из итоговой модели эти модули можно удалить.
Студия машинного обучения уже удалила один из модулей [Execute R Script][execute-r-script] (Выполнение скрипта R) при удалении модуля [Split][split] (Разделение данных). Теперь можно удалить второй модуль и подключить модуль [Metadata Editor][metadata-editor] (Редактор метаданных) непосредственно к модулю [Score Model][score-model] (Оценка модели).    

Теперь наш эксперимент должен выглядеть следующим образом:  

![Оценка обученной модели][4]  

> [!NOTE]
> Возможно, вас удивляет, почему мы оставили набор данных UCI German Credit Card Data в прогностическом эксперименте. Служба будет использовать только данные пользователя. Изначальный набор данных больше не используется, зачем же оставлять его в модели?
> 
> Действительно, службе не нужны исходные данные кредитных карт. Но по-прежнему нужна схема для этих данных, включающая такие сведения, как общее число столбцов, а также какие столбцы являются числовыми. Эти данные схемы необходимы для интерпретации пользовательских данных. Мы оставили эти компоненты подключенными, чтобы модуль оценки имел схему набора данных при запуске службы. Данные не используются, используется только схема.  
> 
> 

Запустите эксперимент в последний раз (нажмите **Выполнить**). Чтобы убедиться в том, что модуль по-прежнему работает, щелкните по выходным данным модуля [Score Model][score-model] (Оценка модели) и выберите **View Results** (Показать результаты). Вы увидите, что изначальные данные отображаются вместе со значением кредитного риска (расчетные метки) и оценочным значением вероятности (расчетные вероятности). 

## <a name="deploy-the-web-service"></a>Развертывание веб-службы
Эксперимент можно развернуть в виде классической веб-службы или новой веб-службы на основе Azure Resource Manager.

### <a name="deploy-as-a-classic-web-service"></a>Развертывание в виде классической веб-службы
Чтобы развернуть классическую веб-службу на основе нашего эксперимента, щелкните **Deploy Web Service** (Развернуть веб-службу) под холстом и выберите пункт **Deploy Web Service [Classic]** (Развернуть веб-службу [классическую]). Студия машинного обучения развернет эксперимент как веб-службу и откроет панель мониторинга для этой веб-службы. Отсюда можно вернуться к эксперименту (**View snapshot** (Просмотр снимка) или **View latest** (Просмотр последних)) и выполнить простой тест веб-службы (см. раздел **Тестирование веб-службы** ниже). На ней также приведены сведения о создании приложений, которые могут обращаться к веб-службе (подробнее об этом в следующем шаге пошагового руководства).

![Панель мониторинга веб-службы][6]

Службу можно настраивать на вкладке **КОНФИГУРАЦИЯ** . На этой вкладке можно изменить имя службы (по умолчанию она получает имя эксперимента) и предоставить ее описание. Можно также задать более удобочитаемые метки для входных и выходных данных.  

![Настройка веб-службы][5]  

### <a name="deploy-as-a-new-web-service"></a>Развертывание в качестве новой веб-службы

> [!NOTE] 
> Для развертывания новой веб-службы у вас должен быть достаточный уровень разрешений в подписке, в которую выполняется развертывание веб-службы. Дополнительные сведения см. в статье [Управление веб-службой с помощью портала веб-служб машинного обучения Azure](manage-new-webservice.md). 

Чтобы развернуть новую веб-службу на основе нашего эксперимента, выполните следующее.

1. Щелкните под холстом действие **Deploy Web Service** (Развернуть веб-службу) и выберите **Deploy Web Service [New]** (Развернуть веб-службу [новую]). Студия машинного обучения направит вас на страницу **развертывания эксперимента** в веб-службах машинного обучения Azure.

2. Введите имя этой веб-службы. 

3. Выберите **план ценообразования** в списке существующих планов. Также можно нажать кнопку "Create new" (Создать), а затем ввести имя и выбрать вариант ежемесячной оплаты для нового плана. По умолчанию указаны уровни плана для вашего региона по умолчанию, и веб-служба развертывается именно в этом регионе.

4. Щелкните **Развернуть**.

Через несколько минут откроется **страница быстрого запуска** для новой веб-службы.

Службу можно настраивать на вкладке **Configure** (Конфигурация). Здесь вы можете изменить заголовок службы или ввести для нее описание. 

Чтобы проверить работу веб-службы, щелкните вкладку **Test** (Тестирование) (см. раздел **Тестирование веб-службы** ниже). Чтобы получить сведения о создании приложений, которые могут обращаться к веб-службе, щелкните вкладку **Consume** (Использование) (дополнительные сведения см. в следующем шаге этого руководства).

> [!TIP]
> После развертывания веб-службы ее можно обновить. Например, если требуется скорректировать модель, измените обучающий эксперимент, настройте параметры модели и нажмите кнопку **Deploy Web Service** (Развернуть веб-службу), а затем выберите вариант **Deploy Web Service [Classic]** (Развернуть веб-службу [классическую]) или **Deploy Web Service [New]** (Развернуть веб-службу [новую]). При повторном развертывании эксперимента веб-служба заменяется обновленной моделью.  
> 
> 

## <a name="test-the-web-service"></a>Тестирование веб-службы

При обращении к веб-службе пользовательские данные поступают в модуль **Web service input** (Входные данные веб-службы), а оттуда передаются для оценки в модуль [Score Model][score-model] (Оценка модели). Мы настроили наш прогнозный эксперимент так, чтобы модель ожидала поступления данных в том же формате, в котором был исходный набор данных о кредитных рисках.
Результаты возвращаются из веб-службы пользователю через модуль **Web service output** (Выходные данные веб-службы).

> [!TIP]
> Мы настроили наш прогнозный эксперимент так, чтобы возвращались полные результаты из модуля [Score Model][score-model] (Оценка модели). Они включают все входные данные, а также значение кредитного риска и оценку вероятности. Но если нужно, вы можете возвращать что-нибудь другое, например только значение кредитного риска. Для этого добавьте модуль [Project Columns][project-columns] (Столбцы проекта) между модулями [Score Model][score-model] (Оценка модели) и **Web service output** (Выходные данные веб-службы), чтобы исключить ненужные столбцы из возвращаемых данных веб-службы. 
> 
> 

Классическую веб-службу можно протестировать **в студии машинного обучения** или на портале **веб-служб машинного обучения Azure**.
Новую веб-службу можно протестировать только на портале **веб-служб машинного обучения Azure**.

> [!TIP]
> При тестировании на портале веб-служб машинного обучения Azure можно подготовить с помощью портала образец данных для проверки службы "запрос-ответ". Для этого на странице **Настройка** выберите "Да" для параметра **Sample Data Enabled?** (Использовать образец данных?). Теперь, когда вы откроете вкладку "Запрос-ответ" на странице **Тестирование**, портал создаст образец данных на основе исходного набора данных о кредитных рисках.

### <a name="test-a-classic-web-service"></a>Тестирование классической веб-службы

Классическую веб-службу можно протестировать в студии машинного обучения или на портале веб-служб машинного обучения. 

#### <a name="test-in-machine-learning-studio"></a>Тестирование в студии машинного обучения

1. На странице **DASHBOARD** (Панель мониторинга) нажмите кнопку **Test** (Тестировать) в разделе **Default Endpoint** (Конечная точка по умолчанию). Появится диалоговое окно, предлагающее ввести входные данные для службы. Это те же столбцы, которые были в исходном наборе данных о кредитных рисках.  

2. Введите набор данных и нажмите кнопку **ОК**. 

#### <a name="test-in-the-machine-learning-web-services-portal"></a>Тестирование на портале веб-служб машинного обучения

1. На странице **DASHBOARD** (Панель мониторинга) нажмите кнопку **Test preview** (Предварительный просмотр теста) в разделе **Default Endpoint** (Конечная точка по умолчанию). На портале веб-служб машинного обучения Azure откроется страница тестирования конечной точки веб-службы, где будет предложено ввести входные данные для службы. Это те же столбцы, которые были в исходном наборе данных о кредитных рисках.

2. Щелкните **Test Request-Response** (Тестировать "запрос-ответ"). 

### <a name="test-a-new-web-service"></a>Тестирование новой веб-службы

Новую веб-службу можно протестировать только на портале веб-служб машинного обучения Azure.

1. На портале [веб-служб машинного обучения Azure](https://services.azureml.net/quickstart) щелкните **Test** (Тестировать) в верхней части страницы. Откроется страница **Test** (Тестирование), на которой можно ввести данные для службы. Отображаемые поля ввода соответствуют столбцам, которые существовали в исходном наборе данных о кредитных рисках. 

2. Введите набор данных и щелкните **Test Request-Response**(Тестировать "запрос-ответ").

Результаты теста отображаются в правой части страницы, в столбце выходных данных. 


## <a name="manage-the-web-service"></a>Управление веб-службой

Развернутой веб-службой (классической или новой) можно управлять с помощью портала [веб-служб Машинного обучения Microsoft Azure](https://services.azureml.net/quickstart).

Вот как можно отслеживать производительность веб-службы.

1. Войдите на портал [веб-служб Машинного обучения Microsoft Azure](https://services.azureml.net/quickstart).
2. Щелкните **Веб-службы**.
3. Щелкните нужную веб-службу.
4. Щелкните **Панель мониторинга**.

- - -
**Далее: [доступ к веб-службе](walkthrough-6-access-web-service.md)**

[3]: ./media/walkthrough-5-publish-web-service/publish3.png
[3a]: ./media/walkthrough-5-publish-web-service/publish3a.png
[4]: ./media/walkthrough-5-publish-web-service/publish4.png
[5]: ./media/walkthrough-5-publish-web-service/publish5.png
[6]: ./media/walkthrough-5-publish-web-service/publish6.png


<!-- Module References -->
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[metadata-editor]: https://msdn.microsoft.com/library/azure/370b6676-c11c-486f-bf73-35349f842a66/
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[split]: https://msdn.microsoft.com/library/azure/70530644-c97a-4ab6-85f7-88bf30a8be5f/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/
[project-columns]: https://msdn.microsoft.com/en-us/library/azure/1ec722fa-b623-4e26-a44e-a50c6d726223/
