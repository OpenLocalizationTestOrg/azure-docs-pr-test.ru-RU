---
title: "Переобучение классической веб-службы | Документация Майкрософт"
description: "Узнайте о том, как осуществить программное переобучение модели и обновить веб-службу так, чтобы она использовала переобученную модель при задействовании функций машинного обучения Azure."
services: machine-learning
documentationcenter: 
author: garyericson
manager: raymondlaghaeian
editor: 
ms.assetid: e36e1961-9e8b-4801-80ef-46d80b140452
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: v-donglo
ms.openlocfilehash: ad18d82109e3048625f32d90af9677956350fb84
ms.sourcegitcommit: 1d423a8954731b0f318240f2fa0262934ff04bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/05/2018
---
# <a name="retrain-a-classic-web-service"></a>Переобучение классической веб-службы
Развернутая прогнозная веб-служба является конечной точкой оценки по умолчанию. Конечные точки по умолчанию синхронизируются с исходными экспериментами по обучению и оценке, поэтому обученную модель конечной точки по умолчанию нельзя заменить. Чтобы переобучить веб-службу, необходимо добавить в нее новую конечную точку. 

## <a name="prerequisites"></a>Технические условия
Вы уже настроили обучающий и прогнозный эксперименты, как показано в статье [Программное переобучение моделей машинного обучения](retrain-models-programmatically.md). 

> [!IMPORTANT]
> Прогнозный эксперимент развернут в виде классической веб-службы машинного обучения. 
> 
> 

Дополнительную информацию о развертывании веб-служб см. в статье [Развертывание веб-службы машинного обучения Azure](publish-a-machine-learning-web-service.md).

## <a name="add-a-new-endpoint"></a>Добавление новой конечной точки
Прогнозная веб-служба, которую вы развернули, содержит конечную точку по умолчанию, синхронизированную с исходной обученной моделью обучающего и оценивающего экспериментов. Чтобы обновить веб-службу с помощью новой обученной модели, необходимо создать конечную точку оценки. 

Чтобы создать конечную точку оценки, в прогнозной веб-службе, которую можно обновить с помощью обученной модели, выполните действия ниже.

> [!NOTE]
> Важно добавить конечную точку к прогнозной веб-службе, а не к обучающей. Если вы правильно установили обучающую и прогнозную веб-службы, вы увидите две отдельные веб-службы. Имя прогнозной веб-службы должно заканчиваться на [predictive exp.].
> 
> 

Новую конечную точку можно добавить в веб-службу двумя способами:

1. Программным образом
2. С помощью портала веб-служб Microsoft Azure

### <a name="programmatically-add-an-endpoint"></a>Добавление конечной точки программно
Конечные точки оценки можно добавить с помощью примера кода, приведенного в этом [репозитории GitHub](https://github.com/raymondlaghaeian/AML_EndpointMgmt/blob/master/Program.cs).

### <a name="use-the-microsoft-azure-web-services-portal-to-add-an-endpoint"></a>Добавление конечной точки с помощью портала веб-служб Microsoft Azure
1. В Студии машинного обучения в левой области навигации щелкните "Web Services" (Веб-службы).
2. В нижней части панели мониторинга веб-служб щелкните **Manage endpoints preview**(Управление конечными точками (предварительная версия)).
3. Щелкните **Добавить**.
4. Введите имя и описание новой конечной точки. Выберите уровень ведения журнала и укажите, включать ли образцы данных. Дополнительные сведения о ведении журнала см. в статье [Включение функции ведения журналов для веб-служб машинного обучения](web-services-logging.md).

## <a name="update-the-added-endpoints-trained-model"></a>Обновление обученной модели добавленной конечной точки
Чтобы завершить процесс переобучения, необходимо обновить обученную модель добавленной конечной точки.

При добавлении конечной точки с помощью примера кода он также включает расположение URL-адреса справки, заданного в свойстве *HelpLocationURL* в выходных данных.

Чтобы извлечь URL-адрес:

1. Скопируйте и вставьте этот URL-адрес в адресную строку браузера.
2. Щелкните ссылку "Обновить ресурс".
3. Скопируйте URL-адрес POST запроса PATCH. Например: 
   
     URL-адрес запроса PATCH: https://management.azureml.net/workspaces/00bf70534500b34rebfa1843d6/webservices/af3er32ad393852f9b30ac9a35b/endpoints/newendpoint2

Теперь обученную модель можно использовать для обновления созданной конечной точки оценки.

В следующем примере кода показано, как использовать параметры *BaseLocation*, *RelativeLocation*, *SasBlobToken* и URL-адрес исправления для обновления конечной точки.

    private async Task OverwriteModel()
    {
        var resourceLocations = new
        {
            Resources = new[]
            {
                new
                {
                    Name = "Census Model [trained model]",
                    Location = new AzureBlobDataReference()
                    {
                        BaseLocation = "https://esintussouthsus.blob.core.windows.net/",
                        RelativeLocation = "your endpoint relative location", //from the output, for example: “experimentoutput/8946abfd-79d6-4438-89a9-3e5d109183/8946abfd-79d6-4438-89a9-3e5d109183.ilearner”
                        SasBlobToken = "your endpoint SAS blob token" //from the output, for example: “?sv=2013-08-15&sr=c&sig=37lTTfngRwxCcf94%3D&st=2015-01-30T22%3A53%3A06Z&se=2015-01-31T22%3A58%3A06Z&sp=rl”
                    }
                }
            }
        };

        using (var client = new HttpClient())
        {
            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", apiKey);

            using (var request = new HttpRequestMessage(new HttpMethod("PATCH"), endpointUrl))
            {
                request.Content = new StringContent(JsonConvert.SerializeObject(resourceLocations), System.Text.Encoding.UTF8, "application/json");
                HttpResponseMessage response = await client.SendAsync(request);

                if (!response.IsSuccessStatusCode)
                {
                    await WriteFailedResponse(response);
                }

                // Do what you want with a successful response here.
            }
        }
    }

Параметры *apiKey* и *endpointUrl* для этого вызова можно получить на панели мониторинга конечной точки.

Значение параметра *Имя* в *ресурсах* должно соответствовать имени ресурса сохраненной обученной модели в прогнозном эксперименте. Чтобы получить имя ресурса:

1. Войдите на [портале Azure](https://portal.azure.com).
2. В меню слева щелкните **Машинное обучение**.
3. В поле "Имя" выберите рабочую область, а затем щелкните **Веб-службы**.
4. В поле "Имя" щелкните **Модель ценза [predictive exp.]**.
5. Щелкните новую добавленную конечную точку.
6. На панели мониторинга конечной точки щелкните **Обновить ресурс**.
7. На странице документации по API обновления ресурсов для веб-службы можно найти **имя ресурса** в разделе **обновляемых ресурсов**.

Если срок действия маркера SAS истекает до завершения обновления конечной точки, необходимо выполнить операцию GET с использованием идентификатора задания, чтобы получить новый маркер.

Если код выполнен успешно, новая конечная точка начнет использовать переобученную модель примерно через 30 секунд.

## <a name="summary"></a>Сводка
Используя интерфейсы API переобучения, можно обновить обученную модель прогнозной веб-службы, что позволяет выполнять следующие сценарии:

* Периодическое переобучение модели с использованием новых данных.
* Распределение модели клиентам, чтобы они могли переобучить ее с использованием собственных данных.

## <a name="next-steps"></a>Дальнейшие действия
[Устранение неполадок при повторном обучении классической веб-службы машинного обучения Azure](troubleshooting-retraining-models.md)

