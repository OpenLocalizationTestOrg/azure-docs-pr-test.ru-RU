---
title: "Использование линейной регрессии в машинном обучении | Документация Майкрософт"
description: "Сравнение моделей линейной регрессии в Excel и Студии машинного обучения Azure"
metakeywords: 
services: machine-learning
documentationcenter: 
author: garyericson
manager: jhubbard
editor: cgronlun
ms.assetid: 417ae6ab-de4f-4bdd-957a-d96133234656
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/20/2017
ms.author: kbaroni;garye
ms.openlocfilehash: 218f2b141e3551180a2152570f99fdb427980dd7
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="using-linear-regression-in-azure-machine-learning"></a>Использование линейной регрессии в Машинном обучении Azure
> *Кейт Барони* (Kate Baroni) и *Бен Боутмен* (Ben Boatman) — архитекторы корпоративных решений в Научно-инновационном центре анализа данных корпорации Майкрософт. В этой статье они описывают свой опыт миграции существующего набора для регрессионного анализа в облачное решение с помощью Машинного обучения Azure. 
> 
> 

&nbsp; 

[!INCLUDE [machine-learning-free-trial](../../../includes/machine-learning-free-trial.md)]

## <a name="goal"></a>Цель
У нашего проекта было две цели: 

1. Использование прогнозной аналитики для увеличения точности проекции ежемесячных доходов организации. 
2. Использование Машинного обучения Azure для подтверждения, оптимизации и увеличения скорости получения результатов, а также увеличения их масштаба. 

Как и множество других компаний, наша организация прогнозирует свой ежемесячный доход. Задача нашей небольшой группы бизнес-аналитиков состояла в использовании Машинного обучения Azure для поддержки процесса прогнозирования и увеличения точности прогноза. Несколько месяцев группа занималась сбором данных из нескольких источников и статистическим анализом атрибутов данных, который позволил определить ключевые атрибуты, относящиеся к прогнозированию продаж услуг. Дальнейшие действия состояли в создании прототипов моделей статистической регрессии для данных в Excel. Спустя несколько недель мы получили модель регрессии для Excel, которая превзошла возможности современных процессов отраслевого и финансового прогнозирования. Это стало базовым результатом прогноза. 

Затем мы предприняли дальнейшие действия по перемещению прогнозной аналитики в Машинное обучение Azure, чтобы выяснить, как эта служба может повысить производительность прогнозирования.

## <a name="achieving-predictive-performance-parity"></a>Достижение соответствия производительности прогнозирования
Основным приоритетом было достижение соответствия моделей регрессии машинного обучения и Excel. Нам нужно было добиться соответствия производительности прогнозирования машинного обучения и Excel, используя одни и те же данные, которые разделены на одинаковые наборы данных для обучения и тестирования. Сначала нам не удалось выполнить эту задачу. Модель Excel превзошла модель машинного обучения. Это произошло из-за неполного понимания требований к базовым параметрам инструментов в машинном обучении. Связавшись с группой разработки машинного обучения, мы лучше поняли принцип действия базовых параметров, требуемых для наборов данных, и добились соответствия двух моделей. 

### <a name="create-regression-model-in-excel"></a>Создание регрессионной модели в Excel
Наш метод регрессии в Excel использует стандартную модель линейной регрессии, доступную в пакете анализа Excel. 

Мы вычислили *среднюю абсолютную погрешность в процентах* и использовали это значение в качестве меры производительности модели. Создание рабочей модели с использованием Excel заняло 3 месяца. Мы использовали многие методы обучения в эксперименте Студии машинного обучения, что в конечном счете помогло нам лучше понять требования.

### <a name="create-comparable-experiment-in-azure-machine-learning"></a>Создание сравнительного эксперимента в Машинном обучении Azure
Чтобы создать эксперимент в Студии машинного обучения, мы выполнили такие шаги: 

1. Передача набора данных в виде CSV-файла (очень маленького размера) в Студии машинного обучения.
2. Создание эксперимента и использование модуля [Select Columns in Dataset][select-columns] (Выбор столбцов в наборе данных) для выбора тех же признаков данных, что используются в Excel. 
3. Использование модуля [Split Data][split] (Разделение данных) в режиме *относительного выражения*, чтобы разделить данные на точно такие же наборы данных для обучения, как в Excel. 
4. Проведение эксперимента с модулем [Линейная регрессия][linear-regression] (только с параметрами по умолчанию), документирование и сравнение результатов с результатами модели регрессии Excel.

### <a name="review-initial-results"></a>Просмотр изначальных результатов
Сначала модель Excel явно превзошла модель Студии машинного обучения: 

|  | Excel | Студия |
| --- |:---:|:---:|
| Производительность | | |
| <ul style="list-style-type: none;"><li>Скорректированный коэффициент детерминации R-квадрат</li></ul> |0,96 |Недоступно |
| <ul style="list-style-type: none;"><li>Коэффициент <br />определения</li></ul> |Недоступно |0,78<br />(низкая точность) |
| Средняя абсолютная погрешность |9 500 000 долл. США |19 400 000 долл. США |
| Средняя абсолютная погрешность (в %) |6,03 % |12,2 % |

Когда мы объяснили принцип выполнения процесса и показали полученные результаты разработчикам и специалистам по обработке и анализу данных из группы разработки машинного обучения, они нам тут же дали несколько полезных советов. 

* При использовании модуля [Линейная регрессия][linear-regression] в Студии машинного обучения доступно два метода:
  * метод градиентного спуска в режиме онлайн — может подойти для крупномасштабных проблем;
  * метод наименьших квадратов — наиболее распространенный метод линейной регрессии. Это самый оптимальный выбор для небольших наборов данных.
* Для повышения производительности следует рассмотреть возможность изменения параметра «Вес регуляризации L2». Его значение по умолчанию — 0,001. Чтобы повысить производительность, для небольшого набора данных мы установили значение 0,005. 

### <a name="mystery-solved"></a>Решение найдено!
Последовав рекомендациям, нам удалось добиться тех же базовых показателей производительности в Студии машинного обучения, что и в Excel: 

|  | Excel | Студия (первоначальная версия) | Студия с методом наименьших квадратов |
| --- |:---:|:---:|:---:|
| Значение с подписью |Фактические значения (числовые) |—||— |—||— |
| Ученик |Excel -> "Анализ данных" -> "Регрессия" |Линейная регрессия |Линейная регрессия |
| Параметры ученика |Недоступно |Значения по умолчанию |Метод наименьших квадратов<br />L2 = 0,005 |
| Набор данных |26 строк, 3 признака, 1 метка. Все значения числовые. |—||— |—||— |
| Разделение: обучение |Обучение Excel выполнено по первым 18 строкам, тестирование — по последним 8 строкам. |—||— |—||— |
| Разделение: тестирование |Формула регрессии Excel применяется к последним 8 строкам. |—||— |—||— |
| **Производительность** | | | |
| Скорректированный коэффициент детерминации R-квадрат |0,96 |Недоступно | |
| Коэффициент детерминации |Недоступно |0,78 |0,952049 |
| Средняя абсолютная погрешность |9 500 000 долл. США |19 400 000 долл. США |9 500 000 долл. США |
| Средняя абсолютная погрешность (в %) |<span style="background-color: 00FF00;"> 6,03 %</span> |12,2 % |<span style="background-color: 00FF00;"> 6,03 %</span> |

Кроме того, мы получили хорошие результаты сравнения коэффициентов Excel и веса признаков в обученной модели Azure:

|  | Коэффициенты Excel | Весовые коэффициенты компонентов Azure |
| --- |:---:|:---:|
| Отрезок/смещение |19470209,88 |19328500 |
| Признак А |0,832653063 |0,834156 |
| Признак Б |11071967,08 |11007300 |
| Признак В |25383318,09 |25140800 |

## <a name="next-steps"></a>Дальнейшие действия
Мы хотели использовать веб-службу машинного обучения в Excel. Наши бизнес-аналитики полагаются на Excel, и нам нужно было найти способ вызвать веб-службу машинного обучения из строки данных Excel, чтобы она вернула спрогнозированное значение в Excel. 

Мы также поставили перед собой задачу оптимизировать модель, используя параметры и алгоритмы, доступные в Студии машинного обучения.

### <a name="integration-with-excel"></a>Интеграция с Excel
Наше решение должно было привести в действие модель регрессии машинного обучения за счет создания веб-службы из обученной модели. Мы создали веб-службу за несколько минут и смогли вызвать ее прямо из Excel, чтобы получить спрогнозированное значение дохода. 

В разделе *Web Services Dashboard* (Панель мониторинга веб-служб) содержится книга Excel, которую можно скачать. Эта книга предварительно отформатирована с помощью API веб-службы, и в нее внедрена информация о схемах. Чтобы скачать книгу, щелкните *Download Excel Workbook* (Скачать книгу Excel). Она откроется, и ее можно будет сохранить на локальном компьютере. 

![][1]

Пока книга открыта, скопируйте предопределенные параметры в синий раздел «Параметры», показанный ниже. После ввода параметров Excel вызовет веб-службу машинного обучения, а в зеленом разделе "Спрогнозированные значения" отобразятся спрогнозированные оцененные метки. Книга продолжит создавать спрогнозированные значения параметров для всех элементов строк, введенных в разделе «Параметры», на основе обученной модели. Дополнительные сведения об использовании этой функции см. в статье [Использование веб-службы Машинного обучения Azure в Excel](consuming-from-excel.md). 

![][2]

### <a name="optimization-and-further-experiments"></a>Оптимизация и дальнейшие эксперименты
Определив необходимую модель Excel, мы приступили к оптимизации модели линейной регрессии машинного обучения. Мы использовали модуль [Filter-Based Feature Selection][filter-based-feature-selection] (Выбор признаков на основе фильтра), чтобы усовершенствовать выбор исходных элементов данных, и это помогло нам добиться повышения производительности — коэффициент средней абсолютной погрешности достиг отметки 4,6 %. Мы будем использовать эту функцию в будущих проектах, что позволит нам сэкономить несколько недель выполнения итерации атрибутов данных для поиска правильного набора признаков, которые будут использоваться для моделирования. 

Далее мы планируем включить в эксперимент дополнительные алгоритмы, такие как [байесовский][bayesian-linear-regression] алгоритм или [увеличивающиеся деревья принятия решений][boosted-decision-tree-regression], для сравнения производительности. 

Если вы хотите поэкспериментировать с регрессией, попробуйте использовать пример набора данных регрессии энергетического КПД. Он отлично подходит для этого и содержит множество числовых атрибутов. Этот набор данных входит в состав примеров наборов данных Студии машинного обучения. Вы можете использовать множество модулей обучения для прогнозирования отопительной нагрузки или нагрузки по охлаждению. В таблице ниже сравнена производительность различных регрессионных моделей обучения и набора данных энергетического КПД для прогнозирования целевой переменной нагрузки по охлаждению: 

| Модель | Средняя абсолютная погрешность | Среднеквадратическая погрешность | Относительная абсолютная погрешность | Относительная среднеквадратическая погрешность | Коэффициент детерминации |
| --- | --- | --- | --- | --- | --- |
| Увеличивающееся дерево принятия решений |0,930113 |1,4239 |0,106647 |0,021662 |0,978338 |
| Линейная регрессия (метод градиентного спуска) |2,035693 |2,98006 |0,233414 |0,094881 |0,905119 |
| Регрессия нейронной сети |1,548195 |2,114617 |0,177517 |0,047774 |0,952226 |
| Линейная регрессия (метод наименьших квадратов) |1,428273 |1,984461 |0,163767 |0,042074 |0,957926 |

## <a name="key-takeaways"></a>Общие выводы
Параллельное выполнение экспериментов Машинного обучения Azure и регрессии Excel позволило узнать много нового. Создание базовой модели в Excel и ее сравнение с моделями с использованием [линейной регрессии][linear-regression] машинного обучения помогло нам изучить Машинное обучение Azure. Кроме того, мы обнаружили возможности усовершенствования выбора данных и повышения производительности модели. 

Мы также поняли, что в будущем для более быстрого получения результатов по проектам прогнозирования целесообразно использовать модуль [Filter-Based Feature Selection][filter-based-feature-selection] (Выбор признаков на основе фильтра). Применив выбор признаков к данным, можно создать улучшенную модель машинного обучения с более высокой общей производительностью. 

Возможность систематической передачи аналитических прогнозов из машинного обучения в Excel позволяет значительно увеличить способность успешного предоставления результатов широкой аудитории бизнес-пользователей. 

## <a name="resources"></a>Ресурсы
Ниже перечислены некоторые ресурсы, которые помогут вам в работе с регрессией. 

* Регрессия в Excel. Если вы никогда не работали с регрессией в Excel, этот учебник упростит задачу: [http://www.excel-easy.com/examples/regression.html](http://www.excel-easy.com/examples/regression.html)
* Сравнение регрессии и прогнозирования. Тайлер Чессмен (Tyler Chessman) написал статью в блоге, в которой он рассказывает, как спрогнозировать временные ряды в Excel. Здесь также представлено хорошее описание линейной регрессии для начинающих: [http://sqlmag.com/sql-server-analysis-services/understanding-time-series-forecasting-concepts](http://sqlmag.com/sql-server-analysis-services/understanding-time-series-forecasting-concepts). 
* Линейная регрессия по методу наименьших квадратов. Недостатки, проблемы и ошибки. Введение в регрессию и ее обсуждение см. по адресу [http://www.clockbackward.com/2009/06/18/ordinary-least-squares-linear-regression-flaws-problems-and-pitfalls/](http://www.clockbackward.com/2009/06/18/ordinary-least-squares-linear-regression-flaws-problems-and-pitfalls/).

[1]: ./media/linear-regression-in-azure/machine-learning-linear-regression-in-azure-1.png
[2]: ./media/linear-regression-in-azure/machine-learning-linear-regression-in-azure-2.png


<!-- Module References -->
[bayesian-linear-regression]: https://msdn.microsoft.com/library/azure/ee12de50-2b34-4145-aec0-23e0485da308/
[boosted-decision-tree-regression]: https://msdn.microsoft.com/library/azure/0207d252-6c41-4c77-84c3-73bdf1ac5960/
[filter-based-feature-selection]: https://msdn.microsoft.com/library/azure/918b356b-045c-412b-aa12-94a1d2dad90f/
[linear-regression]: https://msdn.microsoft.com/library/azure/31960a6f-789b-4cf7-88d6-2e1152c0bd1a/
[select-columns]: https://msdn.microsoft.com/library/azure/1ec722fa-b623-4e26-a44e-a50c6d726223/
[split]: https://msdn.microsoft.com/library/azure/70530644-c97a-4ab6-85f7-88bf30a8be5f/

