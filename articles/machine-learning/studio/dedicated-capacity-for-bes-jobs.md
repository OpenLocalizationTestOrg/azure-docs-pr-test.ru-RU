---
title: "Выделение ресурсов для обработки заданий службы пакетного выполнения машинного обучения | Документация Майкрософт"
description: "Обзор пакетных служб Azure для обработки заданий машинного обучения"
services: machine-learning
documentationcenter: 
author: garyericson
manager: raymondl
editor: 
ms.service: machine-learning
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: v-donglo
ms.openlocfilehash: 7f7498c63db89a77121d33afc9d48a4132b1a51d
ms.sourcegitcommit: 42ee5ea09d9684ed7a71e7974ceb141d525361c9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2017
---
# <a name="azure-batch-service-for-machine-learning-jobs"></a>Пакетные службы Azure для обработки заданий машинного обучения

Обработка в пуле пакетной службы машинного обучения предоставляет пользователям управление масштабированием службы выполнения пакетов машинного обучения Azure. Классическая пакетная обработка для машинного обучения выполняется в мультитенантной среде. Это связано с определенными ограничениями числа одновременно отправляемых заданий, которые при этом помещаются в очередь по принципу FIFO. Эта неопределенность, в свою очередь, означает, что время запуска задания предсказать невозможно.

Обработка в пуле пакетной службы связана с возможностью создавать пулы, куда можно отправлять соответствующие задания. Вы управляете размером пула и определяете, в какой пул будет отправлено то или иное задание. Задание BES выполняется в отдельной области обработки, обеспечивая прогнозируемую производительность и возможность создавать пулы ресурсов, которые соответствуют отправляемой вычислительной нагрузке.

## <a name="how-to-use-batch-pool-processing"></a>Как выполняется обработка в пуле пакетной службы

Сейчас настройка обработки в пуле пакетной службы на портале Azure недоступна. Для выполнения обработки в пуле пакетной службы вам понадобится:

-   вызвать CSS, чтобы создать учетную запись пула пакетной службы и получить URL-адрес службы пула и ключ авторизации;
-   создать веб-службу и план выставления счетов на основе новой версии Resource Manager.

Чтобы создать учетную запись, обратитесь в служба поддержки пользователей Майкрософт (CSS) и предоставьте свой идентификатор подписки. Служба CSS поможет вам определить ресурсы, соответствующие вашему сценарию. Затем служба CSS определит для вашей учетной записи максимальное число пулов, которые вы можете создать, а также максимальное число виртуальных машин, которые можно включить в каждый пул. Когда ваша учетная запись будет настроена, вам будет назначен URL-адрес службы пула и ключ авторизации,

которые будут использоваться для выполнения операций управления пулом в пуле пакетной службы.

![Архитектура пула пакетной службы](./media/dedicated-capacity-for-bes-jobs/pool-architecture.png)

Вы можете создавать пулы, вызывая операцию "Создание пула" и используя URL-адрес службы пула, предоставленный службой CSS. Создавая пул, укажите число виртуальных машин и URL-адрес веб-службы машинного обучения на основе новой версии Resource Manager (файл swagger.json). Эта веб-служба позволяет установить связь с конфигурацией для выставления счетов. Пул пакетной службы использует файл swagger.json для связывания пула с планом выставления счетов. Вы можете запустить любую веб-службу BES (на основе новой версии Resource Manager или классическую) из пула.

Вы можете использовать любую веб-службу на основе новой версии Resource Manager, но помните, что тарификация обработки заданий производится на основе плана выставления счетов, связанного с этой службой. Вы также можете создать веб-службу и план выставления счетов специально для запуска заданий пула пакетной службы.

См. дополнительные сведения о [развертывании веб-службы машинного обучения Azure](publish-a-machine-learning-web-service.md).

Создав пул, вы можете отправить задание BES, используя URL-адрес запросов пакетной службы для веб-службы. Задание можно отправить для классической пакетной обработки или обработки в пуле. Чтобы отправить задание для обработки в пуле пакетной службы, добавьте следующий параметр в текст запроса на отправку задания:

"AzureBatchPoolId":"&lt;pool ID&gt;"

Если вы не добавите этот параметр, задание запустится в среде для классической пакетной обработки. Если у пула есть доступные ресурсы, задание запустится немедленно. Если у пула нет свободных ресурсов, задание будет помещено в очередь, пока ресурсы не станут доступными.

Если вы регулярно расходуете ресурсы, выделяемые для пулов, и вам нужно увеличить их объем, обратитесь в службу CSS. Ее сотрудники помогут вам увеличить квоты.

Пример запроса:

https://ussouthcentral.services.azureml.net/subscriptions/80c77c7674ba4c8c82294c3b2957990c/services/9fe659022c9747e3b9b7b923c3830623/jobs?api-version=2.0

```json
{

    "Input":{
    
        "ConnectionString":"DefaultEndpointsProtocol=https;BlobEndpoint=https://sampleaccount.blob.core.windows.net/;TableEndpoint
        =https://sampleaccount.table.core.windows.net/;QueueEndpoint=https://sampleaccount.queue.core.windows.net/;FileEndpoint=https://zhguim
        l.file.core.windows.net/;AccountName=sampleaccount;AccountKey=&lt;Key&gt;;",
        
        "BaseLocation":null,
        
        "RelativeLocation":"testint/AdultCensusIncomeBinaryClassificationDataset.csv",
        
        "SasBlobToken":null
    
    },
    
    "GlobalParameters":{ },
    
    "Outputs":{
    
        "output1":{
        
            "ConnectionString":"DefaultEndpointsProtocol=https;BlobEndpoint=https://sampleaccount.blob.core.windows.net/;TableEndpo
            int=https://sampleaccount.table.core.windows.net/;QueueEndpoint=https://sampleaccount.queue.core.windows.net/;FileEndpoint=https://sampleaccount.file.core.windows.net/;AccountName=sampleaccount;AccountKey=&lt;Key&gt;",
            "BaseLocation":null,
            "RelativeLocation":"testintoutput/testint\_results.csv",
            
            "SasBlobToken":null
        
        }
    
    },
    
    "AzureBatchPoolId":"8dfc151b0d3e446497b845f3b29ef53b"

}
```

## <a name="considerations-when-using-batch-pool-processing"></a>Рекомендации по обработке в пуле пакетной службы

Обработка в пуле пакетной службы предусматривает непрерывную тарификацию. Эту конфигурацию необходимо связать с планом выставления счетов на основе Resource Manager. Плата взимается только за часы вычислений (работы пула) — независимо от числа заданий, выполняемых в это время. Создав пул, вы оплачиваете часы вычислений для каждой виртуальной машины в пуле до удаления пула, даже если в пуле нет запущенных заданий пакетной службы. Выставление счетов для виртуальных машин начинается после завершения их подготовки и останавливается при их удалении. Можно использовать любой план из перечисленных на [странице с ценами на машинное обучение](https://azure.microsoft.com/pricing/details/machine-learning/).

Пример выставления счетов

Если вы создадите пул пакетной службы с двумя виртуальными машинами, а спустя 24 часа удалите его, согласно плану выставления счетов оплата будет начислена за 48 часов вычислений, независимо от того, сколько заданий выполнялось в это время.

Если вы создадите пул пакетной службы с четырьмя виртуальными машинами, а спустя 12 часов удалите его, согласно плану выставления счетов оплата также будет начислена за 48 часов вычислений.

Мы рекомендуем выполнять опрос состояния заданий, чтобы определять время их завершения. Когда все задания будут выполнены, вызовите операцию "Изменение размера пула", чтобы изменить число виртуальных машин в пуле, указав значение 0. Если вам не хватает ресурсов для пула и нужно создать другой пул (например, для тарификации в соответствии с другим планом выставления счетов), вы можете просто удалить пул после выполнения всех заданий.


| **Используйте обработку, выполняемую пулом пакетной службы в таких случаях**    | **Используйте классическую пакетную обработку в таких случаях**  |
|---|---|
|Необходимо выполнить большое число заданий.<br>или<br/>Необходимо запускать задания немедленно.<br/>или<br/>Требуется гарантированная пропускная способность. Например, за определенное время вам нужно выполнить ряд заданий, и вы хотите масштабировать требуемые вычислительные ресурсы.    | Вы выполняете несколько заданий.<br/>и<br/> Вам не нужно немедленно запускать эти задания. |
