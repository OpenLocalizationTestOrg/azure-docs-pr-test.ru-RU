---
title: "Интерпретация результатов модели в машинном обучении | Документация Майкрософт"
description: "Выбор оптимального набора параметров для использования алгоритмов и визуализации выходных данных модели оценки."
services: machine-learning
documentationcenter: 
author: bradsev
manager: jhubbard
editor: cgronlun
ms.assetid: 6230e5ab-a5c0-4c21-a061-47675ba3342c
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/24/2017
ms.author: bradsev
ms.openlocfilehash: 394c3e4a0feda0b4943b479cf00edf6d6b5a265b
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="interpret-model-results-in-azure-machine-learning"></a>Интерпретация результатов модели в машинном обучении Azure
В этой статье объясняется, как визуализировать и интерпретировать результаты прогнозирования в студии машинного обучения Azure. Когда вы обучите модель и получите с ее помощью прогнозы (оценки модели), этот результат нужно интерпретировать.

[!INCLUDE [machine-learning-free-trial](../../../includes/machine-learning-free-trial.md)]

Существует четыре основных типа машинного обучения моделей в Студии машинного обучения Azure:

* классификация;
* кластеризация;
* регрессия;
* системы рекомендаций.

Модули, используемые для прогнозирования на основе этих моделей:

* модуль [Score Model][score-model] (Оценка модели) для классификации и регрессии;
* модуль [Assign to Clusters][assign-to-clusters] (Назначить в кластеры) для кластеризации;
* модуль [Score Matchbox Recommender][score-matchbox-recommender] (Оценка модели рекомендаций Matchbox) для систем рекомендаций.

В этом документе объясняется интерпретация результатов прогнозирования для каждого из этих модулей. Обзор этих модулей см. в статье [Как выбрать параметры для оптимизации алгоритмов в машинном обучении Azure](algorithm-parameters-optimize.md).

В этом разделе рассматривается интерпретация прогноза, а не оценка модели. Дополнительные сведения об оценке модели см. в статье [Оценка эффективности модели в машинном обучении Microsoft Azure](evaluate-model-performance.md).

Если вы не работали с машинным обучением Azure и хотите узнать, как создавать эксперименты, см. статью [Руководство по машинному обучению. Создание первого эксперимента по обработке и анализу данных в студии машинного обучения Azure](create-experiment.md).

## <a name="classification"></a>классификация;
Существует две подкатегории задач классификации:

* задачи только с двумя классами (двухклассовая или двоичная классификация);
* задачи более чем с двумя классами (многоклассовая классификация).

Хотя машинное обучение Azure содержит различные модули для работы с этими типами классификации, методы интерпретации прогнозных результатов для всех модулей похожи.

### <a name="two-class-classification"></a>Двуклассовая классификация
**Пример эксперимента**

Пример проблемы с двухклассовой классификацией — классификация цветов ириса. Задача — классификация цветов ириса по их признакам. Набор данных Iris в машинном обучении Azure — это часть популярного набора [Ирисы Фишера](http://en.wikipedia.org/wiki/Iris_flower_data_set), которая содержит экземпляры только двух видов цветов (классы 0 и 1). Для каждого цветка можно выделить четыре признака: длина наружной доли околоцветника, ширина наружной доли околоцветника, длина внутренней доли околоцветника и ширина внутренней доли околоцветника.

![Снимок экрана для эксперимента Iris](./media/interpret-model-results/1.png)

Рисунок 1. Рис. 1. Эксперимент с задачей двухклассовой классификации цветков ириса

Эксперимент для решения этой задачи проведен, как показано на рис. 1. Модель повышенного дерева принятия решений двухклассовой классификации обучена и оценена. Теперь результаты прогноза модуля [Score Model][score-model] (Оценка модели) можно визуализировать. Для этого щелкните порт вывода модуля [Score Model][score-model] (Оценка модели) и в раскрывшемся меню выберите команду **Визуализировать**.

![Модуль оценки модели](./media/interpret-model-results/1_1.png)

Это действие приводит к отображению результатов оценки, как показано на рис. 2.

![Результаты эксперимента с двухклассовой классификацией цветков ириса](./media/interpret-model-results/2.png)

Рис. 2. Визуализация результата оценки модели для задачи двухклассовой классификации

**Интерпретация результатов**

В таблице результатов представлены шесть столбцов. Четыре столбца слева соответствуют четырем признакам. Два правых столбца — "Scored Labels" (Оцененные метки) и "Scored Probabilities" (Оцененные вероятности) — представляют результаты прогнозирования. Столбец "Scored Probabilities" (Оцененные вероятности) отражает вероятность того, что цветок принадлежит к положительному классу (класс 1). Например, первое число в этом столбце (0,028571) означает, что первый цветок принадлежит классу 1 с вероятностью 0,028571. Столбец «Метки оценки» содержит прогнозируемый класс для каждого из цветков. Этот прогноз основывается на столбце оценки вероятности. Если оцененная вероятность составляет больше 0,5, прогнозируется принадлежность к классу 1. В противном случае прогнозируется принадлежность к классу 0.

**Публикация в веб-службе**

Если результаты прогнозирования выглядят понятными и убедительными, эксперимент можно опубликовать как веб-службу. Так вы сможете развертывать его в разных приложениях и прогнозировать принадлежность к классам новых цветков ириса. Сведения о том, как превратить обучающий эксперимент в оценивающий эксперимент и опубликовать его в виде веб-службы, см. здесь: [Шаг 5. Развертывание веб-службы машинного обучения Azure](walkthrough-5-publish-web-service.md). Выполнив эту процедуру, вы получите оценивающий эксперимент, как показано на рис. 3.

![Снимок экрана с оценивающим экспериментом](./media/interpret-model-results/3.png)

Рис. 3. Оценка эксперимента с задачей двухклассовой классификации цветков ириса

Теперь вам нужно определить вход и выход для веб-службы. Очевидно, что входные данные — правый входной порт модуля [Score Model][score-model] (Оценка модели), представляющий входные данные о признаках цветков ириса. Выбор выхода зависит от того, что мы хотим получить: оцененную метку (прогнозируемый класс), оцененную вероятность или оба значения сразу. В этом примере нас интересуют оба значения. Чтобы выбрать нужные выходные столбцы, используйте модуль [Select Columns in Data set][select-columns] (Выбор столбцов в наборе данных). Щелкните модуль [Select Columns in Data set][select-columns] (Выбор столбцов в наборе данных), затем — **Launch column selector** (Запустить средство выбора столбцов) и выберите столбцы **Scored Labels** (Оцененные метки) и **Scored Probabilities** (Оцененные вероятности). Настроив порт вывода модуля [Select Columns in Data set][select-columns] (Выбор столбцов в наборе данных) и запустив эксперимент еще раз, можно приступать к публикации оценивающего эксперимента в виде веб-службы. Для этого нажмите кнопку **Опубликовать веб-службу**. Окончательный эксперимента выглядит как показано на рис. 4.

![Эксперимент с двухклассовой классификацией цветков ириса](./media/interpret-model-results/4.png)

Рис. Окончательный оценивающий эксперимент в задаче двухклассовой классификации цветков ириса

Запустив веб-службу, вы можете ввести некоторые значения признаков для тестового экземпляра и получить ответ в виде двух чисел. Первое число — это оцененная метка, а второе — оцененная вероятность. Прогноз относит этот цветок к классу 1 с вероятностью 0,9655.

![Тестирование интерпретирующего модуля оценки](./media/interpret-model-results/4_1.png)

![Результаты тестовой оценки](./media/interpret-model-results/5.png)

Рис. 5. Результат, возвращаемый веб-службой для двухклассовой классификации цветков ириса

### <a name="multi-class-classification"></a>Многоклассовая классификация
**Пример эксперимента**

В этом эксперименте в качестве примера многоклассовой классификации выполняется задача по распознаванию букв. Классификатор пытается предсказать определенную букву (класс) по некоторым значениям атрибутов, извлеченным из изображений рукописных символов.

![Пример распознавания букв](./media/interpret-model-results/5_1.png)

В обучающих данных предусмотрено 16 признаков, извлеченных из изображений рукописных букв. У нас есть 26 букв, которые образуют 26 классов. На рис. 6 представлен эксперимент, который обучает модель многоклассовой классификации распознавать буквы. Кроме того, он прогнозирует результаты по тому же набору признаков для тестового набора данных.

![Эксперимент с многоклассовой классификацией — распознавание букв](./media/interpret-model-results/6.png)

Рис. 6. Эксперимент с задачей многоклассовой классификации — распознавание букв

Отобразите результаты модуля [Score Model][score-model] (Оценка модели), щелкнув порт вывода модуля [Score Model][score-model] (Оценка модели) и выбрав команду **Визуализировать**. Вы увидите данные, представленные на рис. 7.

![Результаты оценки модели](./media/interpret-model-results/7.png)

Рис. 7. Визуализация результата оценки модели для задачи многоклассовой классификации

**Интерпретация результатов**

16 столбцов слева представляют значения признаков тестового набора. Столбцы с такими именами, как "Scored Probabilities for Class «XX»" (Оцененные вероятности для класса "XX") аналогичны столбцу со значениями оцененной вероятности в двухклассовом эксперименте. Они показывают вероятность того, что соответствующая запись будет принадлежать определенному классу. Например, для первой записи число 0,003571 представляет вероятность принадлежности к классу А, число 0,000451 — к классу В и т. д. Последний столбец (с оцененными метками) полностью соответствует одноименному столбцу в двухклассовом эксперименте. Класс с наибольшим показателем вероятности выбирается в качестве прогнозируемого класса соответствующей записи. Например, для первой записи меткой оценки является «F», так у нее наибольшая вероятность быть «F» (0,916995).

**Публикация в веб-службе**

Здесь вы также можете получить для каждой записи значение оцененной метки и оцененной вероятности. Задача состоит в нахождении наибольшей вероятности среди всех оценок вероятностей. Для этого вам потребуется модуль [Выполнить сценарий R][execute-r-script]. Код для скрипта R представлен на рис. 8, а на рис. 9 показан результат эксперимента.

![Пример кода R](./media/interpret-model-results/8.png)

Рис. 8. Код R для извлечения оцененных меток и оцененных вероятностей

![Результат эксперимента](./media/interpret-model-results/9.png)

Рис. 9. Окончательный оценивающий эксперимент с задачей многоклассовой классификации — распознавание букв

Когда вы опубликуете эту веб-службу и введете некоторые входные значения признаков, вы получите результат, который выглядит как на рис. 10. Эта рукописная буква согласно 16 извлеченным признакам будет буквой "T" с вероятностью 0,9715.

![Тестирование интерпретирующего модуля оценки](./media/interpret-model-results/9_1.png)

![Результат проверки](./media/interpret-model-results/10.png)

Рис. Возвращаемый веб-службой результат задачи многоклассовой классификации

## <a name="regression"></a>регрессия;
Регрессионная задача отличается от задачи классификации. В задаче классификации мы пытаемся прогнозировать дискретные классы, определяя, например, к какому классу принадлежит цветок ириса. А в следующем примере представлена регрессионная задача, в которой мы пробуем спрогнозировать значение непрерывной переменной, например стоимости автомобиля.

**Пример эксперимента**

В нашем примере регрессивной задачи прогнозируется стоимость автомобиля. Вы будете прогнозировать цену автомобиля на основе таких его признаков, как производитель, тип топлива, тип кузова, типа привода и т. д. Этот эксперимент показан на рис. 11.

![Регрессионный эксперимент по оценке стоимости автомобиля](./media/interpret-model-results/11.png)

Рис. 11. Регрессионный эксперимент с задачей оценки стоимости автомобиля

Результаты работы модуля [Score Model][score-model] (Оценка модели) показаны на рис. 12.

![Оценка результатов для задачи прогноза стоимости автомобилей](./media/interpret-model-results/12.png)

Рис. 12. Оценка результата для задачи прогноза стоимости автомобилей

**Интерпретация результатов**

В этом эксперименте результаты оценки представлены в столбце оцененных меток. Числа являются прогнозируемой стоимостью для каждого автомобиля.

**Публикация в веб-службе**

Вы можете опубликовать эксперимент регрессии в веб-службе и вызывать его для прогнозирования стоимости автомобиля, как в двухклассовом эксперименте.

![Оценивающий эксперимент для регрессионной задачи оценки стоимости автомобилей](./media/interpret-model-results/13.png)

Рис. 13. Оценивающий эксперимент для регрессионной задачи оценки стоимости автомобилей

Выполняющаяся веб-служба возвращает результат, как показано на рис. 14. Прогнозируемая стоимость этого автомобиля — 15 085,52 долларов США.

![Тестирование интерпретирующего модуля оценки](./media/interpret-model-results/13_1.png)

![Результаты модуля оценки](./media/interpret-model-results/14.png)

Рис. 14. Результат веб-службы для регрессионной задачи оценки стоимости автомобиля

## <a name="clustering"></a>кластеризация;
**Пример эксперимента**

Воспользуемся набором данных Iris еще раз, чтобы создать эксперимент кластеризации. Здесь вы можете отфильтровать метки классов в наборе данных, чтобы они включали только признаки и их можно было использовать для кластеризации. В этом примере обучения с использованием набора данных Iris мы укажем два кластера. Это означает, что цветки будут разделены на два класса. Этот эксперимент показан на рис. 15.

![Эксперимент с задачей кластеризации цветков ириса](./media/interpret-model-results/15.png)

Рис. 15. Эксперимент с задачей кластеризации цветков ириса

Кластеризация отличается от классификации тем, что обучающий набор данных не имеет собственных меток. При кластеризации экземпляры обучающего набора данных группируются в несколько кластеров. В процессе обучения модель помечает записи по мере изучения различий между их признаками. После этого обученная модель может классифицировать новые записи. В задаче кластеризации нас интересуют результаты по двум направлениям. Сначала мы создадим метки для обучающего набора данных, а затем классифицируем новый набор данных с помощью обученной модели.

Первую часть результатов можно визуализировать, щелкнув левый порт вывода модуля [Train Clustering Model][train-clustering-model] (Обучение модели кластеризации) и выбрав команду **Визуализировать**. Визуализация представлена на рис. 16.

![Результат кластеризации](./media/interpret-model-results/16.png)

Рис. 16. Визуализация результата кластеризации для обучающего набора данных

Вторая часть результатов, кластеризация новых записей с помощью обученной модели кластеризации, показана на рис. 17.

![Визуализация результата кластеризации](./media/interpret-model-results/17.png)

Рис. 17. Визуализация результата кластеризации для нового набора данных

**Интерпретация результатов**

Хотя результаты двух подмножеств получены на разных этапах эксперимента, они выглядят похожими и интерпретируются одинаково. Первые четыре столбца — это признаки. Последний столбец "Assignments" (Назначения) представляет результат прогнозирования. Записи, которым назначены одинаковые числа, по прогнозу отнесены в один кластер. Это означает, что у них есть определенные сходства (в этом эксперименте использовалась стандартная формула Евклидовой метрики для оценки расстояния). Так как вы указали, что кластеров должно быть 2, в этом столбце встречаются только значения 0 и 1.

**Публикация в веб-службе**

Вы можете опубликовать эксперимент кластеризации в веб-службе и вызывать его для прогнозирования кластеризации так же, как и эксперимент двухклассовой классификации.

![Оценивающий эксперимент с задачей кластеризации набора данных Iris](./media/interpret-model-results/18.png)

Рис. 18. Оценивающий эксперимент с задачей кластеризации набора данных Iris

Запустив веб-службу, вы получите результат, представленный на рис. 19. Согласно прогнозу этот цветок относится к кластеру 0.

![Тестирование интерпретирующего модуля оценки](./media/interpret-model-results/18_1.png)

![Результаты модуля оценки](./media/interpret-model-results/19.png)

Рис. 19. Результат, возвращаемый веб-службой для двухклассовой классификации цветков ириса

## <a name="recommender-system"></a>Система рекомендаций
**Пример эксперимента**

Чтобы ознакомиться с системой рекомендаций, в качестве примера рассмотрим задачу рекомендации ресторана: вы будете рекомендовать клиентам рестораны на основе их оценок. Входные данные делятся на три части:

* клиентские оценки ресторанов;
* данные о характеристиках клиентов;
* Данные об услугах ресторанов

С помощью встроенного модуля машинного обучения Azure [Train Matchbox Recommender][train-matchbox-recommender] (Обучение системы Matchbox Recommender) можно выполнять несколько задач.

* прогнозировать оценки для данного пользователя и объекта;
* рекомендовать объект данному пользователю;
* искать пользователей, связанных с данным пользователем;
* искать объекты, связанные с данным объектом.

Вы можете выбрать нужную задачу в меню **Recommender prediction kind** (Тип прогноза системы рекомендаций), где есть четыре варианта. Здесь мы рассмотрим все четыре сценария.

![Рекомендации Matchbox](./media/interpret-model-results/19_1.png)

Типичный эксперимент машинного обучения Azure для системы рекомендаций представлен на рис. 20. Дополнительные сведения об использовании этих модулей системы рекомендаций см. на странице справки в статьях [Train matchbox recommender][train-matchbox-recommender] (Обучение модели рекомендаций Matchbox) и [Score matchbox recommender][score-matchbox-recommender] (Оценка модели рекомендаций Matchbox).

![Эксперимент с системой рекомендаций](./media/interpret-model-results/20.png)

Рис. 20. Эксперимент с системой рекомендаций

**Интерпретация результатов**

**Прогноз оценки для указанных пользователя и объекта**

Выбрав пункт **Rating Prediction** (Прогноз оценки) в меню **Recommender prediction kind** (Тип прогноза системы рекомендаций), мы запросим у системы рекомендаций создать прогнозную оценку для указанных пользователя и объекта. Визуализация результатов модуля [Score Matchbox Recommender][score-matchbox-recommender] (Оценка модели рекомендаций Matchbox) показана на рис. 21.

![Результат оценки системы рекомендаций — прогнозная оценка](./media/interpret-model-results/21.png)

Рис. 21. Визуализация результата оценки системы рекомендаций — прогнозная оценка

Первые два столбца — это пары пользователь-объект, представленные во входных данных. Третий столбец является прогнозируемой оценкой пользователя для определенного объекта. Например в первой строке клиент U1048 вероятно даст ресторану 135026 оценку 2.

**Рекомендация объекта указанному пользователю**

Выбрав пункт **Item Recommendation** (Рекомендация объекта) в меню **Recommender prediction kind** (Тип прогноза системы рекомендаций), мы запросим систему рекомендаций найти рекомендуемые объекты для указанного пользователя. В этом сценарии нужно указать значение еще одного параметра: *Recommended item selection* (Выбор рекомендуемого объекта). Параметр **From Rated Items (for model evaluation)** (Из оцененных объектов — для оценки модели) используется преимущественно для оценки модели при обучении. На этом этапе прогнозирования мы выбираем **From All Items** (Из всех объектов). Визуализация результатов модуля [Score Matchbox Recommender][score-matchbox-recommender] (Оценка модели рекомендаций Matchbox) показана на рис. 22.

![Результат оценки системы рекомендаций — рекомендуемый объект](./media/interpret-model-results/22.png)

Рис. 22. Визуализация результата оценки системы рекомендаций — рекомендуемый объект

Первый из шести столбцов содержит идентификаторы пользователей, которым будут рекомендованы объекты. Они получены из входных данных. Остальные пять столбцов содержат объекты, рекомендуемые каждому пользователю. Они перечислены в порядке убывания релевантности. Например, в первой строке для клиента U1048 первый рекомендуемый ресторан представлен значением 134986; за ним следуют 135018, 134975, 135021 и 132862.

**Поиск пользователей, связанных с указанным пользователем**

Выбрав пункт **Related Users** (Связанные пользователи) в меню **Recommender prediction kind** (Тип прогноза системы рекомендаций), мы запросим систему рекомендаций найти пользователей, связанных с указанным пользователем. Связанными пользователями являются пользователи с аналогичными параметрами. В этом сценарии нужно выбрать значение еще одного параметра: *Related user selection* (Выбор связанных пользователей). Параметр **From Users That Rated Items (for model evaluation)**(Из пользователей, которые оценили объекты — для оценки модели) используется преимущественно для оценки модели при обучении. На этом этапе прогнозирования мы выбираем **From All Users** (Из всех пользователей). Визуализация результатов модуля [Score Matchbox Recommender][score-matchbox-recommender] (Оценка модели рекомендаций Matchbox) показана на рис. 23.

![Результат оценки системы рекомендаций — связанные пользователи](./media/interpret-model-results/23.png)

Рис. 23. Визуализация результатов оценки системы рекомендаций — связанные пользователи

Первый из шести столбцов содержит идентификаторы пользователей, для которых ищутся связанные пользователи. Они получены из входных данных. Остальные пять столбцов содержат прогнозы по связанным пользователям. Они перечислены в порядке убывания релевантности. Например, в первой строке для клиента U1048 наиболее соответствующий клиент представлен значением U1051; за ним следуют U1066, U1044, U1017 и U1072.

**Поиск объектов, связанных с данным объектом**

Выбрав пункт **Related Items** (Связанные объекты) в меню **Recommender prediction kind** (Тип прогноза системы рекомендаций), мы запросим систему рекомендаций найти объекты, связанные с указанным объектом. Связанные объекты — это те объекты, которые скорее всего понравятся тем же пользователям. В этом сценарии нужно выбрать значение еще одного параметра: *Related item selection* (Выбор связанных объектов). Параметр **From Rated Items (for model evaluation)** (Из оцененных объектов — для оценки модели) используется преимущественно для оценки модели при обучении. На этом этапе прогнозирования мы выбираем **From All Items** (Из всех объектов). Визуализация результатов модуля [Score Matchbox Recommender][score-matchbox-recommender] (Оценка модели рекомендаций Matchbox) показана на рис. 24.

![Результат оценки системы рекомендаций — связанные объекты](./media/interpret-model-results/24.png)

Рис. 24. Визуализация результатов оценки системы рекомендаций — связанные объекты

Первый из шести столбцов содержит идентификаторы объектов, для которых ищутся связанные объекты. Они получены из входных данных. Остальные пять столбцов содержат прогнозы по связанным объектам. Они перечислены в порядке убывания релевантности. Например, в первой строке для объекта 135026 наиболее соответствующий объект представлен значением 135074; за ним следуют 135035, 132875, 135055 и 134992.

**Публикация в веб-службе**

Процесс публикации этих экспериментов как веб-служб для получения прогнозов аналогичен для каждого из четырех сценариев. В качестве примера мы возьмем второй сценарий, в котором объекты рекомендуются указанному пользователю. Ту же процедуру необходимо повторить и для трех остальных сценариев.

Сохранив обученную систему рекомендаций в качестве обученной модели и преобразовав входные данные в один столбец идентификаторов пользователей, мы можем подключить эксперимент, как показано на рис. 25, и опубликовать его как веб-службу.

![Оценивающий эксперимент с задачей рекомендации ресторана](./media/interpret-model-results/25.png)

Рис. 25. Оценивающий эксперимент с задачей рекомендации ресторана

Запустив эту веб-службу, мы получим результат, представленный на рис. 26. Пользователю U1048 рекомендуются пять ресторанов: 134986, 135018, 134975, 135021 и 132862.

![Пример службы системы рекомендаций](./media/interpret-model-results/25_1.png)

![Пример результатов эксперимента](./media/interpret-model-results/26.png)

Рис. 26. Результаты веб-службы для задачи рекомендации ресторана

<!-- Module References -->
[assign-to-clusters]: https://msdn.microsoft.com/library/azure/eed3ee76-e8aa-46e6-907c-9ca767f5c114/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[select-columns]: https://msdn.microsoft.com/library/azure/1ec722fa-b623-4e26-a44e-a50c6d726223/
[score-matchbox-recommender]: https://msdn.microsoft.com/library/azure/55544522-9a10-44bd-884f-9a91a9cec2cd/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[train-clustering-model]: https://msdn.microsoft.com/library/azure/bb43c744-f7fa-41d0-ae67-74ae75da3ffd/
[train-matchbox-recommender]: https://msdn.microsoft.com/library/azure/fa4aa69d-2f1c-4ba4-ad5f-90ea3a515b4c/
