---
title: "Использование импорта и экспорта данных в веб-службах машинного обучения Azure | Документация Майкрософт"
description: "Узнайте, как использовать модули импорта и экспорта данных для отправки и получения данных из веб-службы."
services: machine-learning
documentationcenter: 
author: garyericson
manager: raymondlaghaeian
editor: 
ms.assetid: 3a7ac351-ebd3-43a1-8c5d-18223903d08e
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/28/2017
ms.author: v-donglo
ms.openlocfilehash: 54b0434cb753484bdb8300f4b9c4f7f7ca75c7c8
ms.sourcegitcommit: 42ee5ea09d9684ed7a71e7974ceb141d525361c9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2017
---
# <a name="deploying-azure-ml-web-services-that-use-data-import-and-data-export-modules"></a>Развертывание веб-служб машинного обучения Azure, использующих модули импорта и экспорта данных

При создании прогнозного эксперимента обычно добавляются вход и выход веб-службы. Если вы развернете эксперимент, то пользователи смогут отправлять и получать данные из веб-службы через входы и выходы. В некоторых приложениях данные пользователя могут быть доступны через веб-канал данных или уже находиться во внешнем источнике данных, таком как хранилище BLOB-объектов Azure. В этих случаях для чтения и записи данных им не требуются входы и выходы веб-службы. Вместо этого они могут использовать службу выполнения пакетов (BES) для чтения из источника данных с помощью модуля импорта данных, а записывать результаты оценки в другое расположение с помощью модуля экспорта данных.

Модули импорта и экспорта данных могут выполнять чтение и запись в различные расположения данных, такие как URL-адрес с использованием протокола HTTP, запрос Hive, база данных SQL Azure, хранилище таблиц Azure, хранилище BLOB-объектов Azure, поставщик веб-канала данных или локальная база данных SQL.

В данной статье используется пример "Sample 5: Train, Test, Evaluate for Binary Classification: Adult Dataset" (Образец 5. Обучение, тестирование, оценка для классификации бинарных файлов: набор данных с контентом для взрослых). Предполагается, что набор данных уже загружен в таблицу Azure SQL с именем censusdata.

## <a name="create-the-training-experiment"></a>Создание обучающего эксперимента
При открытии примера "Sample 5: Train, Test, Evaluate for Binary Classification: Adult Dataset" (Образец 5. Обучение, тестирование, оценка для классификации бинарных файлов: набор данных с контентом для взрослых) используется пример набора данных Adult Census Income Binary Classification. На холсте эксперимент должен выглядеть так, как показано на рисунке ниже.

![Начальная настройка эксперимента.](./media/web-services-that-use-import-export-modules/initial-look-of-experiment.png)

Для чтения данных из таблицы Azure SQL выполните следующие действия:

1. Удалите модуль набора данных.
2. В поле поиска компонентов введите "import".
3. В списке результатов найдите модуль *Import Data* (Импорт данных) и добавьте его на холст эксперимента.
4. Соедините выходные данные модуля *Импорт данных* и входные данные модуля *Clean Missing Data* (Очистка недостающих данных).
5. На панели свойств в раскрывающемся списке **Azure SQL Database** in the **Azure SQL Database** (База данных SQL Azure).
6. В полях **Имя сервера базы данных**, **Имя базы данных**, **Имя пользователя** и **Пароль** введите сведения, соответствующие базе данных.
7. В поле запросов базы данных введите следующий запрос:
   
     select [age],
   
        [workclass],
        [fnlwgt],
        [education],
        [education-num],
        [marital-status],
        [occupation],
        [relationship],
        [race],
        [sex],
        [capital-gain],
        [capital-loss],
        [hours-per-week],
        [native-country],
        [income]
     from dbo.censusdata;
8. В нижней части холста эксперимента нажмите кнопку **Run**(Выполнить).

## <a name="create-the-predictive-experiment"></a>Создание прогнозного эксперимента
На следующем шаге необходимо настроить прогнозной эксперимент, из которого будет развернута веб-служба.

1. В нижней части холста эксперимента щелкните **Set Up Web Service** (Настроить веб-службу) и выберите **Predictive Web Service [Recommended]** (Веб-служба прогнозной аналитики [рекомендуется]).
2. Удалите из прогнозного эксперимента модули *Web Service Input* (Входные данные веб-службы) и *Web Service Output* (Выходные данные веб-службы). 
3. В поле поиска компонентов введите "export".
4. В списке результатов найдите модуль *Export Data* (Экспорт данных) и добавьте его на холст эксперимента.
5. Соедините выходные данные модуля *Score Model* (Оценка модели) и входные данные модуля *Экспорт данных*. 
6. На панели свойств в раскрывающемся списке назначения данных выберите **Azure SQL Database** (База данных SQL Azure).
7. В полях **Имя сервера базы данных**, **Имя базы данных**, **Server user account name** (Имя учетной записи пользователя сервера) и **Server user account password** (Пароль учетной записи пользователя сервера) введите сведения, соответствующие базе данных.
8. В поле **Comma separated list of columns to be saved** (Разделенный запятыми список столбцов для сохранения) введите "Scored Labels".
9. В поле **Data table name**(Имя таблицы данных), введите dbo.ScoredLabels. Если таблица не существует, то она создается при запуске эксперимента или при вызове веб-службы.
10. В поле **Comma separated list of datatable columns** (Разделенный запятыми список столбцов таблицы данных) введите "ScoredLabels".

При написании приложения, которое вызывает окончательную веб-службу, может потребоваться указать другой входной запрос или целевую таблицу во время выполнения. Чтобы настроить эти входные и выходные данные, воспользуйтесь функцией "Web Service Parameters" (Параметры веб-службы). С ее помощью можно задать свойство *Data source* (Источник данных) модуля *Import Data* (Импорт данных) и свойство "Data destination" (Назначение данных) модуля *Export Data* (Экспорт данных).  Дополнительные сведения о параметрах веб-службы см. в публикации [AzureML Web Service Parameters](https://blogs.technet.microsoft.com/machinelearning/2014/11/25/azureml-web-service-parameters/) (Параметры веб-службы AzureML) блога, посвященного Cortana Intelligence и машинному обучению Azure.

Чтобы настроить параметры веб-службы для запроса импорта и целевой таблицы, выполните следующие действия:

1. На панели свойств модуля *Импорт данных* щелкните значок в правом верхнем углу поля **Запрос к базе данных** и выберите **Set as web service parameter** (Установить как параметр веб-службы).
2. На панели свойств модуля *Экспорт данных* щелкните значок в правом верхнем углу поля **Имя таблицы данных** и выберите **Set as web service parameter** (Установить как параметр веб-службы).
3. В нижней части панели свойств модуля *Export Data* (Экспорт данных) в разделе **Web Service Parameters** (Параметры веб-службы) щелкните пункт "Database query" (Запрос к базе данных) и переименуйте его в "Query" (Запрос).
4. Щелкните **Имя таблицы данных** и измените его имя на **Таблица**.

По завершении эксперимент должен выглядеть так, как показано на рисунке ниже.

![Окончательный вид эксперимента.](./media/web-services-that-use-import-export-modules/experiment-with-import-data-added.png)

Теперь можно развернуть прогнозный эксперимент как веб-службу.

## <a name="deploy-the-web-service"></a>Развертывание веб-службы
Развертывание можно выполнить как в классическую, так и в новую веб-службу.

### <a name="deploy-a-classic-web-service"></a>Развертывание классической веб-службы
Для развертывания классической веб-службы и создания использующего ее приложения выполните следующие действия:

1. В нижней части холста эксперимента нажмите кнопку "Run" (Выполнить).
2. По завершении выполнения щелкните **Deploy Web Service** (Развернуть веб-службу) и выберите **Deploy Web Service [Classic]** (Развернуть веб-службу [классическую]).
3. На панели мониторинга веб-службы найдите ключ API. Скопируйте и сохраните его для последующего использования.
4. В таблице **Default Endpoint** (Конечная точка по умолчанию) щелкните ссылку **Выполнение пакета**, чтобы открыть страницу справки API.
5. В Visual Studio создайте консольное приложение C# в Visual Studio (**Создать** > **Проект** > **Visual C#** > **Классический рабочий стол Windows** > **Консольное приложение (.NET Framework**).
6. На странице справки API в нижней части страницы найдите раздел **Sample Code** (Пример кода).
7. Скопируйте пример кода C# и вставьте его в файл Program.cs, а также удалите все ссылки на хранилище BLOB-объектов.
8. Обновите значение переменной *apiKey* , заменив его на ключ API, сохраненный ранее.
9. Найдите объявление запроса и обновите значения параметров веб-службы, которые передаются в модули *Импорт данных* и *Экспорт данных*. В этом случае используется исходный запрос, но определяется имя новой таблицы.
   
        var request = new BatchExecutionRequest() 
        {           
            GlobalParameters = new Dictionary<string, string>() {
                { "Query", @"select [age], [workclass], [fnlwgt], [education], [education-num], [marital-status], [occupation], [relationship], [race], [sex], [capital-gain], [capital-loss], [hours-per-week], [native-country], [income] from dbo.censusdata" },
                { "Table", "dbo.ScoredTable2" },
            }
        };
10. Запустите приложение. 

По завершении выполнения новая таблица добавляется в базу данных, содержащую результаты оценки.

### <a name="deploy-a-new-web-service"></a>Развертывание новой веб-службы

> [!NOTE] 
> Для развертывания новой веб-службы у вас должен быть достаточный уровень разрешений в подписке, в которую выполняется развертывание веб-службы. Дополнительные сведения см. в статье [Управление веб-службой с помощью портала веб-служб машинного обучения Azure](manage-new-webservice.md). 

Для развертывания новой веб-службы и создания использующего ее приложения выполните следующие действия:

1. В нижней части холста эксперимента нажмите кнопку **Run**(Выполнить).
2. По завершении выполнения щелкните **Deploy Web Service** (Развернуть веб-службу) и выберите **Deploy Web Service [New]** (Развернуть веб-службу [новую]).
3. На странице "Deploy Experiment" (Развертывание эксперимента) введите имя веб-службы и выберите ценовой план, а затем нажмите кнопку **Deploy** (Развернуть).
4. На странице **Быстрый запуск** щелкните **Consume** (Использование).
5. В разделе **Sample Code** (Пример кода) щелкните **Пакетная служба**.
6. В Visual Studio создайте консольное приложение C# в Visual Studio (**Создать** > **Проект** > **Visual C#** > **Классический рабочий стол Windows** > **Консольное приложение (.NET Framework**).
7. Скопируйте пример кода C# и вставьте его в файл Program.cs.
8. Обновите значение переменной *apiKey*, заменив его на **Первичный ключ**, указанный в разделе **Basic consumption info** (Основные сведения об использовании).
9. Найдите объявление *scoreRequest* и обновите значения параметров веб-службы, которые передаются в модули *Импорт данных* и *Экспорт данных*. В этом случае используется исходный запрос, но определяется имя новой таблицы.
   
        var scoreRequest = new
        {       
            Inputs = new Dictionary<string, StringTable>()
            {
            },
            GlobalParameters = new Dictionary<string, string>() {
                { "Query", @"select [age], [workclass], [fnlwgt], [education], [education-num], [marital-status], [occupation], [relationship], [race], [sex], [capital-gain], [capital-loss], [hours-per-week], [native-country], [income] from dbo.censusdata" },
                { "Table", "dbo.ScoredTable3" },
            }
        };
10. Запустите приложение. 

