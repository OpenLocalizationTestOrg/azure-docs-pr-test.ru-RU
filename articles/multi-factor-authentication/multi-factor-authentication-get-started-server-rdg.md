---
title: "aaaRDG и с помощью RADIUS сервера Azure MFA | Документы Microsoft"
description: "Это является hello Azure многофакторной проверки подлинности, будет полезен при развертывании шлюза удаленных рабочих столов (RD) и с помощью RADIUS сервера Azure Multi-factor Authentication."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: f2354ac4-a3a7-48e5-a86d-84a9e5682b42
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/27/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: fd280e9b6ff90c82927cffe593c4f1fda7047842
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="remote-desktop-gateway-and-azure-multi-factor-authentication-server-using-radius"></a><span data-ttu-id="640a8-103">Шлюз удаленных рабочих столов и сервер Azure Multi-Factor Authentication, использующие проверку подлинности RADIUS</span><span class="sxs-lookup"><span data-stu-id="640a8-103">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span></span>
<span data-ttu-id="640a8-104">Часто шлюза удаленных рабочих столов (RD) использует hello локальных пользователей tooauthenticate служб политики сети (NPS).</span><span class="sxs-lookup"><span data-stu-id="640a8-104">Often, Remote Desktop (RD) Gateway uses hello local Network Policy Services (NPS) tooauthenticate users.</span></span> <span data-ttu-id="640a8-105">В этой статье описывается, как tooroute RADIUS запрашивает hello шлюза удаленных рабочих столов (через локальный NPS hello) toohello многофакторной проверки подлинности сервера.</span><span class="sxs-lookup"><span data-stu-id="640a8-105">This article describes how tooroute RADIUS requests out from hello Remote Desktop Gateway (through hello local NPS) toohello Multi-Factor Authentication Server.</span></span> <span data-ttu-id="640a8-106">Hello сочетание многофакторной проверки Подлинности Azure и шлюза удаленных рабочих Столов означает, что из любой точки доступа их рабочих сред при выполнении строгой проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="640a8-106">hello combination of Azure MFA and RD Gateway means that your users can access their work environments from anywhere while performing strong authentication.</span></span> 

<span data-ttu-id="640a8-107">Поскольку проверка подлинности Windows для служб терминалов не поддерживается для Server 2012 R2, используйте toointegrate шлюза удаленных рабочих Столов и RADIUS с многофакторной проверки Подлинности сервера.</span><span class="sxs-lookup"><span data-stu-id="640a8-107">Since Windows Authentication for terminal services is not supported for Server 2012 R2, use RD Gateway and RADIUS toointegrate with MFA Server.</span></span> 

<span data-ttu-id="640a8-108">Установите hello сервера Azure Multi-factor Authentication на отдельном сервере, какие учетные записи-посредники, запросить hello RADIUS обратно toohello NPS на приветствия сервера шлюза удаленных рабочих столов.</span><span class="sxs-lookup"><span data-stu-id="640a8-108">Install hello Azure Multi-Factor Authentication Server on a separate server, which proxies hello RADIUS request back toohello NPS on hello Remote Desktop Gateway Server.</span></span> <span data-ttu-id="640a8-109">Сервер политики сети проверяет hello имя пользователя и пароль, он возвращает ответ toohello многофакторной проверки подлинности сервера.</span><span class="sxs-lookup"><span data-stu-id="640a8-109">After NPS validates hello username and password, it returns a response toohello Multi-Factor Authentication Server.</span></span> <span data-ttu-id="640a8-110">Затем hello многофакторной проверки Подлинности сервера выполняет второй фактор проверки подлинности hello и возвращает результат toohello шлюз.</span><span class="sxs-lookup"><span data-stu-id="640a8-110">Then, hello MFA Server performs hello second factor of authentication and returns a result toohello gateway.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="640a8-111">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="640a8-111">Prerequisites</span></span>

- <span data-ttu-id="640a8-112">Присоединенный к домену сервер Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="640a8-112">A domain-joined Azure MFA Server.</span></span> <span data-ttu-id="640a8-113">Если у вас нет уже установлена, выполните действия hello в [Приступая к работе с сервера Azure Multi-factor Authentication hello](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="640a8-113">If you don't have one installed already, follow hello steps in [Getting started with hello Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
- <span data-ttu-id="640a8-114">Шлюз удаленных рабочих столов, который выполняет проверку подлинности с помощью служб политик сети.</span><span class="sxs-lookup"><span data-stu-id="640a8-114">A Remote Desktop Gateway that authenticates with Network Policy Services.</span></span>

## <a name="configure-hello-remote-desktop-gateway"></a><span data-ttu-id="640a8-115">Настройка шлюза удаленных рабочих столов hello</span><span class="sxs-lookup"><span data-stu-id="640a8-115">Configure hello Remote Desktop Gateway</span></span>
<span data-ttu-id="640a8-116">Настройка проверки подлинности RADIUS tooan сервера Azure Multi-factor Authentication hello шлюза удаленных рабочих Столов toosend.</span><span class="sxs-lookup"><span data-stu-id="640a8-116">Configure hello RD Gateway toosend RADIUS authentication tooan Azure Multi-Factor Authentication Server.</span></span> 

1. <span data-ttu-id="640a8-117">В диспетчере шлюза удаленных рабочих Столов, щелкните правой кнопкой мыши имя сервера hello и выберите **свойства**.</span><span class="sxs-lookup"><span data-stu-id="640a8-117">In RD Gateway Manager, right-click hello server name and select **Properties**.</span></span>
2. <span data-ttu-id="640a8-118">Go toohello **хранилище политики Авторизации удаленных рабочих Столов** и выберите **центрального сервера политики сети**.</span><span class="sxs-lookup"><span data-stu-id="640a8-118">Go toohello **RD CAP Store** tab and select **Central server running NPS**.</span></span> 
3. <span data-ttu-id="640a8-119">Добавьте один или несколько серверов многофакторной проверки подлинности Azure в качестве серверов RADIUS, введя hello имя или IP-адрес каждого сервера.</span><span class="sxs-lookup"><span data-stu-id="640a8-119">Add one or more Azure Multi-Factor Authentication Servers as RADIUS servers by entering hello name or IP address of each server.</span></span> 
4. <span data-ttu-id="640a8-120">Создайте для каждого сервера общий секрет.</span><span class="sxs-lookup"><span data-stu-id="640a8-120">Create a shared secret for each server.</span></span>

## <a name="configure-nps"></a><span data-ttu-id="640a8-121">Настройка NPS</span><span class="sxs-lookup"><span data-stu-id="640a8-121">Configure NPS</span></span>
<span data-ttu-id="640a8-122">Hello шлюза удаленных рабочих Столов использует запрос RADIUS tooAzure многофакторной проверки подлинности сервера политики сети toosend hello.</span><span class="sxs-lookup"><span data-stu-id="640a8-122">hello RD Gateway uses NPS toosend hello RADIUS request tooAzure Multi-Factor Authentication.</span></span> <span data-ttu-id="640a8-123">tooconfigure сервера политики сети, сначала в настройках hello время ожидания tooprevent hello шлюза удаленных рабочих Столов, по истечении времени ожидания до завершения hello двухшаговую проверку.</span><span class="sxs-lookup"><span data-stu-id="640a8-123">tooconfigure NPS, first you change hello timeout settings tooprevent hello RD Gateway from timing out before hello two-step verification has completed.</span></span> <span data-ttu-id="640a8-124">Затем обновить проверок подлинности RADIUS NPS tooreceive с многофакторной проверки Подлинности сервера.</span><span class="sxs-lookup"><span data-stu-id="640a8-124">Then, you update NPS tooreceive RADIUS authentications from your MFA Server.</span></span> <span data-ttu-id="640a8-125">Используйте следующие процедуры tooconfigure NPS hello.</span><span class="sxs-lookup"><span data-stu-id="640a8-125">Use hello following procedure tooconfigure NPS:</span></span>

### <a name="modify-hello-timeout-policy"></a><span data-ttu-id="640a8-126">Изменение политики времени ожидания hello</span><span class="sxs-lookup"><span data-stu-id="640a8-126">Modify hello timeout policy</span></span>

1. <span data-ttu-id="640a8-127">На сервере политики сети, откройте hello **клиенты и серверы RADIUS** в hello слева столбца и выберите команду меню **удаленных групп серверов RADIUS**.</span><span class="sxs-lookup"><span data-stu-id="640a8-127">In NPS, open hello **RADIUS Clients and Server** menu in hello left column and select **Remote RADIUS Server Groups**.</span></span> 
2. <span data-ttu-id="640a8-128">Выберите hello **TS GATEWAY SERVER GROUP**.</span><span class="sxs-lookup"><span data-stu-id="640a8-128">Select hello **TS GATEWAY SERVER GROUP**.</span></span> 
3. <span data-ttu-id="640a8-129">Go toohello **балансировки нагрузки** вкладки.</span><span class="sxs-lookup"><span data-stu-id="640a8-129">Go toohello **Load Balancing** tab.</span></span> 
4. <span data-ttu-id="640a8-130">Изменение обоих hello **число секунд без ответа, после которого запрос считается отброшенным** и hello **число секунд между запросами, после которого сервер считается недоступным** toobetween 30 до 60 количество секунд.</span><span class="sxs-lookup"><span data-stu-id="640a8-130">Change both hello **Number of seconds without response before request is considered dropped** and hello **Number of seconds between requests when server is identified as unavailable** toobetween 30 and 60 seconds.</span></span> <span data-ttu-id="640a8-131">(Если обнаружится, что этот сервер hello по-прежнему время ожидания во время проверки подлинности, можно вернитесь сюда и увеличьте hello число секунд.)</span><span class="sxs-lookup"><span data-stu-id="640a8-131">(If you find that hello server still times out during authentication, you can come back here and increase hello number of seconds.)</span></span>
5. <span data-ttu-id="640a8-132">Go toohello **учетная запись проверки подлинности** вкладку и проверьте, что порты RADIUS hello указано соответствие hello порты, Здравствуй прослушивает сервер многофакторной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="640a8-132">Go toohello **Authentication/Account** tab and check that hello RADIUS ports specified match hello ports that hello Multi-Factor Authentication Server is listening on.</span></span>

### <a name="prepare-nps-tooreceive-authentications-from-hello-mfa-server"></a><span data-ttu-id="640a8-133">Подготовка проверки подлинности tooreceive NPS из hello многофакторной проверки Подлинности сервера</span><span class="sxs-lookup"><span data-stu-id="640a8-133">Prepare NPS tooreceive authentications from hello MFA Server</span></span>

1. <span data-ttu-id="640a8-134">Щелкните правой кнопкой мыши **клиентов RADIUS** под RADIUS-клиентов и серверов в hello слева столбца и выберите команду **New**.</span><span class="sxs-lookup"><span data-stu-id="640a8-134">Right-click **RADIUS Clients** under RADIUS Clients and Servers in hello left column and select **New**.</span></span>
2. <span data-ttu-id="640a8-135">Добавьте hello сервера Azure Multi-factor Authentication в качестве клиента RADIUS.</span><span class="sxs-lookup"><span data-stu-id="640a8-135">Add hello Azure Multi-Factor Authentication Server as a RADIUS client.</span></span> <span data-ttu-id="640a8-136">Выберите понятное имя и укажите общий секретный ключ.</span><span class="sxs-lookup"><span data-stu-id="640a8-136">Choose a Friendly name and specify a shared secret.</span></span>
3. <span data-ttu-id="640a8-137">Откройте hello **политики** в hello слева столбца и выберите команду меню **политики запросов на подключение**.</span><span class="sxs-lookup"><span data-stu-id="640a8-137">Open hello **Policies** menu in hello left column and select **Connection Request Policies**.</span></span> <span data-ttu-id="640a8-138">Вы должны увидеть политику с именем TS GATEWAY AUTHORIZATION POLICY (Политика аутентификации шлюза службы терминалов), которая была создана при настройке шлюза удаленных рабочих столов.</span><span class="sxs-lookup"><span data-stu-id="640a8-138">You should see a policy called TS GATEWAY AUTHORIZATION POLICY that was created when RD Gateway was configured.</span></span> <span data-ttu-id="640a8-139">Эта политика направляет запросы RADIUS toohello многофакторной проверки подлинности сервера.</span><span class="sxs-lookup"><span data-stu-id="640a8-139">This policy forwards RADIUS requests toohello Multi-Factor Authentication Server.</span></span>
4. <span data-ttu-id="640a8-140">Щелкните правой кнопкой мыши политику **TS GATEWAY AUTHORIZATION POLICY** (Политика аутентификации шлюза службы терминалов) и выберите пункт **Повторяющаяся политика**.</span><span class="sxs-lookup"><span data-stu-id="640a8-140">Right-click **TS GATEWAY AUTHORIZATION POLICY** and select **Duplicate Policy**.</span></span> 
5. <span data-ttu-id="640a8-141">Откройте hello новой политики» и «перейти toohello **условия** вкладки.</span><span class="sxs-lookup"><span data-stu-id="640a8-141">Open hello new policy and go toohello **Conditions** tab.</span></span>
6. <span data-ttu-id="640a8-142">Добавьте условие, которое соответствует hello понятного имени клиента hello понятное имя, установленное на шаге 2 для клиента RADIUS сервера Azure Multi-factor Authentication hello.</span><span class="sxs-lookup"><span data-stu-id="640a8-142">Add a condition that matches hello Client Friendly Name with hello Friendly name set in step 2 for hello Azure Multi-Factor Authentication Server RADIUS client.</span></span> 
7. <span data-ttu-id="640a8-143">Go toohello **параметры** и выберите **проверки подлинности**.</span><span class="sxs-lookup"><span data-stu-id="640a8-143">Go toohello **Settings** tab and select **Authentication**.</span></span>
8. <span data-ttu-id="640a8-144">Изменить hello поставщика проверки подлинности слишком**проверки подлинности запросов на этом сервере**.</span><span class="sxs-lookup"><span data-stu-id="640a8-144">Change hello Authentication Provider too**Authenticate requests on this server**.</span></span> <span data-ttu-id="640a8-145">Эта политика гарантирует, что если сервер политики сети получает запрос RADIUS из hello Azure многофакторной проверки Подлинности сервера, hello проверки подлинности происходить локально вместо отправки задней toohello каталога запрос RADIUS Azure многофакторной проверки подлинности сервера, что привело бы к возникновению цикла.</span><span class="sxs-lookup"><span data-stu-id="640a8-145">This policy ensures that when NPS receives a RADIUS request from hello Azure MFA Server, hello authentication occurs locally instead of sending a RADIUS request back toohello Azure Multi-Factor Authentication Server, which would result in a loop condition.</span></span> 
9. <span data-ttu-id="640a8-146">tooprevent условия цикла, убедитесь в том, упорядочивание новая политика hello выше исходной политики hello в hello **политики запросов на подключение** области.</span><span class="sxs-lookup"><span data-stu-id="640a8-146">tooprevent a loop condition, make sure that hello new policy is ordered ABOVE hello original policy in hello **Connection Request Policies** pane.</span></span>

## <a name="configure-azure-multi-factor-authentication"></a><span data-ttu-id="640a8-147">Настройка Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="640a8-147">Configure Azure Multi-Factor Authentication</span></span>

<span data-ttu-id="640a8-148">Hello сервера Azure Multi-factor Authentication настраивается как прокси-сервер RADIUS между шлюзом удаленных рабочих Столов и сервера политики сети.</span><span class="sxs-lookup"><span data-stu-id="640a8-148">hello Azure Multi-Factor Authentication Server is configured as a RADIUS proxy between RD Gateway and NPS.</span></span>  <span data-ttu-id="640a8-149">Он должен устанавливаться на сервере, отличном от сервера шлюза удаленных рабочих Столов hello присоединенных к домену.</span><span class="sxs-lookup"><span data-stu-id="640a8-149">It should be installed on a domain-joined server that is separate from hello RD Gateway server.</span></span> <span data-ttu-id="640a8-150">Используйте следующие процедуры tooconfigure hello сервера Azure Multi-factor Authentication hello.</span><span class="sxs-lookup"><span data-stu-id="640a8-150">Use hello following procedure tooconfigure hello Azure Multi-Factor Authentication Server.</span></span>

1. <span data-ttu-id="640a8-151">Откройте сервер Azure Multi-factor Authentication hello и нажмите значок проверки подлинности RADIUS "hello".</span><span class="sxs-lookup"><span data-stu-id="640a8-151">Open hello Azure Multi-Factor Authentication Server and select hello RADIUS Authentication icon.</span></span> 
2. <span data-ttu-id="640a8-152">Проверьте hello **включить проверку подлинности RADIUS** флажок.</span><span class="sxs-lookup"><span data-stu-id="640a8-152">Check hello **Enable RADIUS authentication** checkbox.</span></span>
3. <span data-ttu-id="640a8-153">На вкладке "Клиенты" hello, обеспечить hello порты соответствуют настроенным на сервере политики сети, затем выберите **добавить**.</span><span class="sxs-lookup"><span data-stu-id="640a8-153">On hello Clients tab, ensure hello ports match what is configured in NPS then select **Add**.</span></span>
4. <span data-ttu-id="640a8-154">Добавьте IP-адрес сервера шлюза удаленных рабочих Столов hello, имя приложения (необязательно) и общий секрет.</span><span class="sxs-lookup"><span data-stu-id="640a8-154">Add hello RD Gateway server IP address, application name (optional), and a shared secret.</span></span> <span data-ttu-id="640a8-155">Hello общего секрета потребностей toobe hello же на приветствия сервера Azure Multi-factor Authentication и шлюза удаленных рабочих Столов.</span><span class="sxs-lookup"><span data-stu-id="640a8-155">hello shared secret needs toobe hello same on both hello Azure Multi-Factor Authentication Server and RD Gateway.</span></span>
3. <span data-ttu-id="640a8-156">Go toohello **целевой** вкладку и выберите hello **серверы RADIUS** переключатель.</span><span class="sxs-lookup"><span data-stu-id="640a8-156">Go toohello **Target** tab and select hello **RADIUS server(s)** radio button.</span></span>
4. <span data-ttu-id="640a8-157">Выберите **добавить** и введите hello IP-адрес, общий секрет и порты сервера политики сети hello.</span><span class="sxs-lookup"><span data-stu-id="640a8-157">Select **Add** and enter hello IP address, shared secret, and ports of hello NPS server.</span></span> <span data-ttu-id="640a8-158">Если используется центральный сервер политики сети, hello RADIUS-клиента и целевого объекта RADIUS hello же.</span><span class="sxs-lookup"><span data-stu-id="640a8-158">Unless using a central NPS, hello RADIUS client and RADIUS target are hello same.</span></span> <span data-ttu-id="640a8-159">Hello общий секрет должен соответствовать hello был задан в разделе клиентов RADIUS сервера политики сети hello hello.</span><span class="sxs-lookup"><span data-stu-id="640a8-159">hello shared secret must match hello one setup in hello RADIUS client section of hello NPS server.</span></span>

![Проверка подлинности RADIUS](./media/multi-factor-authentication-get-started-server-rdg/radius.png)

## <a name="next-steps"></a><span data-ttu-id="640a8-161">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="640a8-161">Next steps</span></span>

- <span data-ttu-id="640a8-162">Интеграция Многофакторной идентификации Azure и [веб-приложений IIS](multi-factor-authentication-get-started-server-iis.md)</span><span class="sxs-lookup"><span data-stu-id="640a8-162">Integrate Azure MFA and [IIS web apps](multi-factor-authentication-get-started-server-iis.md)</span></span>

- <span data-ttu-id="640a8-163">Получите ответы в hello [Azure многофакторной проверки подлинности, часто задаваемые вопросы](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="640a8-163">Get answers in hello [Azure Multi-Factor Authentication FAQ](multi-factor-authentication-faq.md)</span></span>
