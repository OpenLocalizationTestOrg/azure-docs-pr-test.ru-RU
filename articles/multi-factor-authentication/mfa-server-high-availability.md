---
title: "aaaConfigure сервера Azure MFA для обеспечения высокой доступности | Документы Microsoft"
description: "Разверните несколько экземпляров сервера службы \"Многофакторная идентификация Azure\" в конфигурациях, обеспечивающих высокую доступность."
services: multi-factor-authentication
keywords: Azure MFA
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/23/2017
ms.author: joflore
ms.reviewer: alexwe
ms.custom: it-pro
ms.openlocfilehash: 8c6b1921c734c7a7273e443b3591fbbb15cd5e6c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-for-high-availability"></a>Настройка сервера службы "Многофакторная идентификация Azure" для обеспечения высокой доступности

tooachieve высокого уровня доступности с развертыванием сервера Azure MFA, необходимо toodeploy несколько серверов многофакторной проверки Подлинности. В этом разделе сведения о tooachieve конструктора с балансировкой нагрузки предназначена ваша высокого уровня доступности в вашем развертывании MFS сервера Azure.

## <a name="mfa-server-overview"></a>Обзор сервера MFA

Hello архитектура службы сервера Azure MFA состоит из нескольких компонентов, как показано в hello, следующая схема:

 ![Архитектура сервера MFA](./media/mfa-server-high-availability/mfa-ha-architecture.png)

Сервер многофакторной проверки Подлинности — Windows Server, который установлена программа hello многофакторной проверки подлинности Azure. необходимо активировать экземпляр Hello многофакторной проверки Подлинности сервера, hello служба многофакторной проверки Подлинности в Azure toofunction. В локальной среде можно установить несколько серверов MFA.

Привет, когда первый сервер многофакторной проверки Подлинности, который установлен hello главный сервер многофакторной проверки Подлинности при активации по hello Azure многофакторной проверки Подлинности службы по умолчанию. главный сервер многофакторной проверки Подлинности Hello имеет копию базы данных PhoneFactor.pfdata hello, доступные для записи. Последующие устанавливаемые экземпляры сервера MFA называются ведомыми. Hello многофакторной проверки Подлинности подчиненными имеют реплицированной только для чтения копия базы данных PhoneFactor.pfdata hello. Серверы MFA выполняют репликацию данных с помощью удаленного вызова процедур (RPC). Все серверы многофакторной проверки Подлинности совместно необходимо домену, так и автономные tooreplicate сведения.

Многофакторной проверки Подлинности главного и подчиненного многофакторной проверки Подлинности серверов взаимодействуют с hello многофакторной проверки Подлинности службы, если двухфакторная проверка подлинности не требуется. Например когда пользователь пытается toogain доступа tooan приложения, которое требует двухфакторной проверки подлинности, hello пользователя будет сначала выполнить проверку подлинности поставщика удостоверений, например Active Directory (AD).

После успешной проверки подлинности с AD hello многофакторной проверки Подлинности сервера будут взаимодействовать с hello многофакторной проверки Подлинности службы. Hello многофакторной проверки Подлинности сервера ожидает уведомления от tooallow hello многофакторной проверки Подлинности службы или запретить доступ toohello hello пользовательского приложения.

Если главный сервер многофакторной проверки Подлинности hello переходит в автономный режим, проверки подлинности по-прежнему могут быть обработаны, но операции, требующие изменения toohello многофакторной проверки Подлинности, базы данных не удается обработать. (Примеры: hello Добавление пользователей самообслуживания изменение PIN-кода и изменение сведений о пользователе)

## <a name="deployment"></a>Развертывание

Рассмотрите следующие важные моменты для балансировки нагрузки сервера Azure MFA и связанными компонентами hello.

* **С помощью RADIUS standard tooachieve высокого уровня доступности**. При использовании серверов MFA Azure в качестве серверов RADIUS потенциально можно настроить один сервер MFA как основной целевой объект проверки подлинности RADIUS, а другие серверы MFA Azure — как дополнительные целевые объекты проверки подлинности. Тем не менее этот метод tooachieve высокого уровня доступности может оказаться практические так как необходимо дождаться toooccur периода времени ожидания при сбое проверки подлинности на целевом сервере hello основной проверки подлинности, прежде чем может проверяться для hello вторичной проверки подлинности целевой объект. Это более эффективно tooload баланс hello RADIUS-трафика между клиентом RADIUS hello и hello RADIUS-серверов (в данном случае hello Azure многофакторной проверки Подлинности серверов, выступающего в качестве RADIUS-серверов), чтобы вы можете настроить клиенты RADIUS hello, они могут указывать на одну ссылку.
* **Требуется toomanually promote подчиненными многофакторной проверки Подлинности**. Если главный сервер многофакторной проверки Подлинности Azure hello переходит в автономный режим, hello многофакторной проверки Подлинности серверов-получателей Azure по-прежнему tooprocess многофакторной проверки Подлинности запросов. Тем не менее пока главный сервер многофакторной проверки Подлинности не найдено, администраторы не могут добавлять пользователей или изменить параметры многофакторной проверки Подлинности, и пользователи не могут вносить изменения, с помощью пользовательского портала hello. Повышение уровня многофакторной проверки Подлинности ведомый toohello хозяином выполняется всегда вручную.
* **Возможность разделения компонентов.** Hello Azure многофакторной проверки Подлинности сервера состоит из нескольких компонентов, которые могут быть установлены на hello того же экземпляра сервера Windows или на разных экземплярах. Эти компоненты включают hello пользовательского портала, веб-служба мобильного приложения и адаптер ADFS hello (агент). Это separability упрощает возможных toouse hello прокси веб-приложения toopublish hello пользовательского портала и мобильного приложения веб-сервер из сети периметра hello. Такая конфигурация добавляет toohello общую безопасность проектирования, как показано в hello следующие схемы. Hello многофакторной проверки Подлинности пользовательского портала и мобильного приложения веб-сервера также могут быть развернуты в конфигурации балансировки нагрузки высокого уровня ДОСТУПНОСТИ.

   ![Сервер MFA с сетью периметра](./media/mfa-server-high-availability/mfasecurity.png)

* **Одноразовый пароль (OTP) через SMS (также называемого односторонних SMS) требует использования hello прикрепленные сеансы, если трафик с балансировкой нагрузки**. Односторонних SMS является возможностью проверки подлинности, при toosend hello hello Server многофакторной проверки Подлинности пользователей текстовое сообщение с помощью одноразового ПАРОЛЯ. Hello пользователь вводит hello OTP в строке toocomplete hello многофакторной проверки Подлинности запроса. При загрузке баланс многофакторной проверки Подлинности серверов Azure hello же сервер, обработавшего запрос hello начальной проверки подлинности должен быть hello, получающий сообщение hello OTP hello пользователя; Если другой сервер многофакторной проверки Подлинности получает ответ OTP hello, hello запрос проверки подлинности завершается ошибкой. Дополнительные сведения см. в разделе [один пароль времени через SMS добавлены tooAzure многофакторной проверки Подлинности сервера](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).
* **Балансировки нагрузки развертываний hello пользовательского портала и веб-служба мобильного приложения требуют прикрепленные сеансы**. Если балансировки нагрузки hello многофакторной проверки Подлинности пользовательского портала и веб-служба мобильного приложения hello каждого сеанса должен toostay на hello того же сервера.

## <a name="high-availability-deployment"></a>Развертывание с высоким уровнем доступности

Hello следующей схеме показана завершения высокой ДОСТУПНОСТИ с балансировкой нагрузки реализация многофакторной проверки Подлинности Azure и его компонентов, вместе с ADFS для ссылки.

 ![Реализация высокой доступности сервера MFA Azure](./media/mfa-server-high-availability/mfa-ha-deployment.png)

Обратите внимание, hello следующих элементов для области hello соответственно номерами hello предшествующей схеме.

1. приветствия двух серверов многофакторной проверки Подлинности Azure (MFA1 и MFA2) Загрузите Сбалансированный (mfaapp.contoso.com) и являются настроенных toouse статический порт hello (4443) tooreplicate PhoneFactor.pfdata базы данных. Hello Web Service SDK установлено на всех hello многофакторной проверки Подлинности сервера tooenable взаимодействия через TCP-порт 443 с серверов AD FS hello. Hello многофакторной проверки Подлинности серверы развернуты в конфигурации балансировки нагрузки без отслеживания состояния. Тем не менее если требуется toouse одноразового ПАРОЛЯ по SMS, необходимо использовать балансировку нагрузки с отслеживанием состояния.
   ![Высокая доступность сервера приложений MFA Azure](./media/mfa-server-high-availability/mfaapp.png)

   > [!NOTE]
   > Так как RPC использует динамические порты, брандмауэры tooopen диапазон toohello динамические порты RPC потенциально могут использовать не рекомендуется. Если вы используете брандмауэр **между** серверах приложений многофакторной проверки Подлинности необходимо настроить toocommunicate hello многофакторной проверки Подлинности сервера на статический порт для hello репликации трафика между серверами ведомый и образец и открыть порт в брандмауэре. Можно принудительно hello статический порт, создав реестра типа DWORD в ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` вызывается ```Pfsvc_ncan_ip_tcp_port``` и присвоение значения hello tooan доступных статический порт. Подключения всегда инициируются многофакторной проверки Подлинности серверов toohello hello ведомый образец, hello статический порт требуется только на основных hello, но поскольку главного hello toobe ведомый можно преобразовать в любое время, следует задать статический порт hello на всех серверах многофакторной проверки Подлинности.

2. Hello двух серверов мобильного приложения портала и многофакторной проверки Подлинности пользователя (многофакторной проверки Подлинности, UP, MAS1 и многофакторной проверки Подлинности, UP, MAS2), распределяются в **с отслеживанием состояния** конфигурации (mfa.contoso.com). Помните, что прикрепленные сеансы являются обязательными для балансировки нагрузки hello портал многофакторной проверки Подлинности пользователей и служба мобильного приложения.
   ![Сервер MFA Azure. Высокая доступность пользовательского портала и службы мобильных приложений](./media/mfa-server-high-availability/mfaportal.png)
3. Ферма серверов служб федерации Active Directory Hello — сбалансированы по загрузке и опубликованы toohello Интернет через прокси-сервер ADFS балансировки нагрузки в сети периметра hello. Каждый сервер служб федерации Active Directory использует toocommunicate агент служб федерации Active Directory hello с hello Azure многофакторной проверки Подлинности серверов с помощью одного балансировкой нагрузки URL-адрес (mfaapp.contoso.com) через TCP-порт 443.

## <a name="next-steps"></a>Дальнейшие действия

* [Приступая к работе с сервером службы "Многофакторная идентификация Azure"](multi-factor-authentication-get-started-server.md)
