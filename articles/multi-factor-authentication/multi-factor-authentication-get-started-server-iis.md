---
title: "Аутентификация IIS и сервер Azure MFA | Документация Майкрософт"
description: "Это страница Azure Multi-Factor Authentication, которая будет полезна при развертывании проверки подлинности IIS для сервера Azure Multi-Factor Authentication."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: d1bf1c8a-2c10-4ae6-9f4b-75f0c3df43eb
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: H1Hack27Feb2017,it-pro
ms.openlocfilehash: ab6f9110dccd3cfc15092f535650e8d8cb1af13c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="configure-azure-multi-factor-authentication-server-for-iis-web-apps"></a><span data-ttu-id="51154-103">Настройка Многофакторной идентификации Azure для веб-приложений IIS</span><span class="sxs-lookup"><span data-stu-id="51154-103">Configure Azure Multi-Factor Authentication Server for IIS web apps</span></span>

<span data-ttu-id="51154-104">С помощью раздела аутентификации IIS для сервера Многофакторной идентификации Azure (MFA) можно включить и настроить аутентификацию IIS для интеграции с веб-приложениями Microsoft IIS.</span><span class="sxs-lookup"><span data-stu-id="51154-104">Use the IIS Authentication section of the Azure Multi-Factor Authentication (MFA) Server to enable and configure IIS authentication for integration with Microsoft IIS web applications.</span></span> <span data-ttu-id="51154-105">Сервер Azure MFA устанавливает подключаемый модуль, который может фильтровать запросы к веб-серверу IIS, для добавления Многофакторной идентификации Azure.</span><span class="sxs-lookup"><span data-stu-id="51154-105">The Azure MFA Server installs a plug-in that can filter requests being made to the IIS web server to add Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="51154-106">Подключаемый модуль IIS обеспечивает поддержку проверки подлинности на основе форм и встроенной проверки подлинности HTTP Windows.</span><span class="sxs-lookup"><span data-stu-id="51154-106">The IIS plug-in provides support for Form-Based Authentication and Integrated Windows HTTP Authentication.</span></span> <span data-ttu-id="51154-107">Также можно настроить доверенные IP-адреса для исключения внутренних IP-адресов из двухфакторной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="51154-107">Trusted IPs can also be configured to exempt internal IP addresses from two-factor authentication.</span></span>

![Проверка подлинности IIS](./media/multi-factor-authentication-get-started-server-iis/iis.png)

## <a name="using-form-based-iis-authentication-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="51154-109">Использование проверки подлинности IIS на основе форм с сервером Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="51154-109">Using Form-Based IIS Authentication with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="51154-110">Чтобы защитить веб-приложение IIS, использующее аутентификацию на основе форм, установите сервер Многофакторной идентификации Azure на веб-сервер IIS и настройте его согласно следующей процедуре.</span><span class="sxs-lookup"><span data-stu-id="51154-110">To secure an IIS web application that uses form-based authentication, install the Azure Multi-Factor Authentication Server on the IIS web server and configure the Server per the following procedure:</span></span>

1. <span data-ttu-id="51154-111">На сервере Многофакторной идентификации Azure щелкните значок аутентификации IIS в меню слева.</span><span class="sxs-lookup"><span data-stu-id="51154-111">In the Azure Multi-Factor Authentication Server, click the IIS Authentication icon in the left menu.</span></span>
2. <span data-ttu-id="51154-112">Щелкните вкладку **На основе форм**.</span><span class="sxs-lookup"><span data-stu-id="51154-112">Click the **Form-Based** tab.</span></span>
3. <span data-ttu-id="51154-113">Щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="51154-113">Click **Add**.</span></span>
4. <span data-ttu-id="51154-114">Чтобы автоматически определить такие переменные, как имя пользователя, пароль и домен, введите URL-адрес входа (например, https://localhost/contoso/auth/login.aspx) в диалоговом окне "Автоматическая настройка веб-сайта на основе форм" и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="51154-114">To detect username, password and domain variables automatically, enter the Login URL (like https://localhost/contoso/auth/login.aspx) within the Auto-Configure Form-Based Website dialog box and click **OK**.</span></span>
5. <span data-ttu-id="51154-115">Установите флажок **Требуется сопоставление пользователей многофакторной проверки подлинности**, если все пользователи, который были или будут импортированы на сервер, подлежат Многофакторной идентификации.</span><span class="sxs-lookup"><span data-stu-id="51154-115">Check the **Require Multi-Factor Authentication user match** box if all users have been or will be imported into the Server and subject to multi-factor authentication.</span></span> <span data-ttu-id="51154-116">Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.</span><span class="sxs-lookup"><span data-stu-id="51154-116">If a significant number of users have not yet been imported into the Server and/or will be exempt from multi-factor authentication, leave the box unchecked.</span></span>
6. <span data-ttu-id="51154-117">Если переменные страницы не удается обнаружить автоматически, щелкните **Указать вручную** в диалоговом окне "Автоматическая настройка веб-сайта на основе форм".</span><span class="sxs-lookup"><span data-stu-id="51154-117">If the page variables cannot be detected automatically, click **Specify Manually** in the Auto-Configure Form-Based Website dialog box.</span></span>
7. <span data-ttu-id="51154-118">В диалоговом окне «Добавление веб-сайта на основе форм» URL-адрес страницы входа в поле «URL-адрес для отправки» и введите имя приложения (необязательно).</span><span class="sxs-lookup"><span data-stu-id="51154-118">In the Add Form-Based Website dialog box, enter the URL to the login page in the Submit URL field and enter an Application name (optional).</span></span> <span data-ttu-id="51154-119">Имя приложения отображается в отчетах сервера Azure Multi-Factor Authentication. Кроме того, оно может отображаться в SMS-сообщениях и сообщениях о проверке подлинности мобильного приложения.</span><span class="sxs-lookup"><span data-stu-id="51154-119">The Application name appears in Azure Multi-Factor Authentication reports and may be displayed within SMS or Mobile App authentication messages.</span></span>
8. <span data-ttu-id="51154-120">Выберите правильный формат запроса.</span><span class="sxs-lookup"><span data-stu-id="51154-120">Select the correct Request format.</span></span> <span data-ttu-id="51154-121">Для большинства веб-приложений это **POST или GET**.</span><span class="sxs-lookup"><span data-stu-id="51154-121">This is set to **POST or GET** for most web applications.</span></span>
9. <span data-ttu-id="51154-122">Введите значения переменных имени пользователя, пароля и домена (если он отображается на странице входа).</span><span class="sxs-lookup"><span data-stu-id="51154-122">Enter the Username variable, Password variable, and Domain variable (if it appears on the login page).</span></span> <span data-ttu-id="51154-123">Чтобы найти имена полей ввода, перейдите на страницу входа в веб-браузере, щелкните ее правой кнопкой мыши и выберите пункт **Просмотр источника**.</span><span class="sxs-lookup"><span data-stu-id="51154-123">To find the names of the input boxes, navigate to the login page in a web browser, right-click on the page, and select **View Source**.</span></span>
10. <span data-ttu-id="51154-124">Установите флажок **Require Azure Multi-Factor Authentication user match** (Требуется сопоставление пользователей Многофакторной идентификации), если все пользователи, которые были или будут импортированы на сервер, подлежат Многофакторной идентификации.</span><span class="sxs-lookup"><span data-stu-id="51154-124">Check the **Require Azure Multi-Factor Authentication user match** box if all users have been or will be imported into the Server and subject to multi-factor authentication.</span></span> <span data-ttu-id="51154-125">Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.</span><span class="sxs-lookup"><span data-stu-id="51154-125">If a significant number of users have not yet been imported into the Server and/or will be exempt from multi-factor authentication, leave the box unchecked.</span></span>
11. <span data-ttu-id="51154-126">Щелкните **Дополнительно**, чтобы просмотреть дополнительные параметры, позволяющие:</span><span class="sxs-lookup"><span data-stu-id="51154-126">Click **Advanced** to review advanced settings, including:</span></span>

  - <span data-ttu-id="51154-127">выбрать специальный файл страницы отказа;</span><span class="sxs-lookup"><span data-stu-id="51154-127">Select a custom denial page file</span></span>
  - <span data-ttu-id="51154-128">поместить в кэш данные успешных операциях аутентификации на веб-сайте на определенный период времени с помощью файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="51154-128">Cache successful authentications to the website for a period of time using cookies</span></span>
  - <span data-ttu-id="51154-129">Выберите способ аутентификации основных учетных данных в домене Windows, каталоге LDAP</span><span class="sxs-lookup"><span data-stu-id="51154-129">Select whether to authenticate the primary credentials against a Windows Domain, LDAP directory.</span></span> <span data-ttu-id="51154-130">или сервере RADIUS.</span><span class="sxs-lookup"><span data-stu-id="51154-130">or RADIUS server.</span></span>

12. <span data-ttu-id="51154-131">Нажмите кнопку **ОК**, чтобы вернуться к диалоговому окну "Добавление веб-сайта на основе форм".</span><span class="sxs-lookup"><span data-stu-id="51154-131">Click **OK** to return to the Add Form-Based Website dialog box.</span></span>
13. <span data-ttu-id="51154-132">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="51154-132">Click **OK**.</span></span>
14. <span data-ttu-id="51154-133">Когда переменные для URL-адреса и страницы будут введены или обнаружены, данные веб-сайта отобразятся на панели "На основе форм".</span><span class="sxs-lookup"><span data-stu-id="51154-133">Once the URL and page variables have been detected or entered, the website data displays in the Form-Based panel.</span></span>

## <a name="using-integrated-windows-authentication-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="51154-134">Использование встроенной проверки подлинности Windows с сервером Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="51154-134">Using Integrated Windows Authentication with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="51154-135">Чтобы защитить веб-приложение IIS, использующее встроенную проверку подлинности HTTP Windows, установите сервер Azure MFA на веб-сервере IIS и настройте его согласно следующим инструкциям.</span><span class="sxs-lookup"><span data-stu-id="51154-135">To secure an IIS web application that uses Integrated Windows HTTP authentication, install the Azure MFA Server on the IIS web server, then configure the Server with the following steps:</span></span>

1. <span data-ttu-id="51154-136">На сервере Многофакторной идентификации Azure щелкните значок аутентификации IIS в меню слева.</span><span class="sxs-lookup"><span data-stu-id="51154-136">In the Azure Multi-Factor Authentication Server, click the IIS Authentication icon in the left menu.</span></span>
2. <span data-ttu-id="51154-137">Перейдите на вкладку **HTTP**.</span><span class="sxs-lookup"><span data-stu-id="51154-137">Click the **HTTP** tab.</span></span>
3. <span data-ttu-id="51154-138">Щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="51154-138">Click **Add**.</span></span>
4. <span data-ttu-id="51154-139">В диалоговом окне "Добавить базовый URL-адрес" введите URL-адрес веб-сайта, на котором выполняется аутентификация HTTP (например, http://localhost/owa), и введите имя приложения (необязательно).</span><span class="sxs-lookup"><span data-stu-id="51154-139">In the Add Base URL dialogue box, enter the URL for the website where HTTP authentication is performed (like http://localhost/owa) and provide an Application name (optional).</span></span> <span data-ttu-id="51154-140">Имя приложения отображается в отчетах сервера Azure Multi-Factor Authentication. Кроме того, оно может отображаться в SMS-сообщениях и сообщениях о проверке подлинности мобильного приложения.</span><span class="sxs-lookup"><span data-stu-id="51154-140">The Application name appears in Azure Multi-Factor Authentication reports and may be displayed within SMS or Mobile App authentication messages.</span></span>
5. <span data-ttu-id="51154-141">Задайте параметры «Время ожидания простоя» и «Максимальное время сеанса», если заданные по умолчанию значения этих параметров недостаточны.</span><span class="sxs-lookup"><span data-stu-id="51154-141">Adjust the Idle timeout and Maximum session times if the default is not sufficient.</span></span>
6. <span data-ttu-id="51154-142">Установите флажок **Требуется сопоставление пользователей многофакторной проверки подлинности**, если все пользователи, который были или будут импортированы на сервер, подлежат Многофакторной идентификации.</span><span class="sxs-lookup"><span data-stu-id="51154-142">Check the **Require Multi-Factor Authentication user match** box if all users have been or will be imported into the Server and subject to multi-factor authentication.</span></span> <span data-ttu-id="51154-143">Если значительное число пользователей еще не импортировано на сервер и/или будет исключено из многофакторной проверки подлинности, не устанавливайте флажок.</span><span class="sxs-lookup"><span data-stu-id="51154-143">If a significant number of users have not yet been imported into the Server and/or will be exempt from multi-factor authentication, leave the box unchecked.</span></span>
7. <span data-ttu-id="51154-144">При необходимости установите флажок **Cookie cache** (Кэш для файлов cookie).</span><span class="sxs-lookup"><span data-stu-id="51154-144">Check the **Cookie cache** box if desired.</span></span>
8. <span data-ttu-id="51154-145">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="51154-145">Click **OK**.</span></span>

## <a name="enable-iis-plug-ins-for-azure-multi-factor-authentication-server"></a><span data-ttu-id="51154-146">Включение подключаемых модулей IIS для сервера Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="51154-146">Enable IIS Plug-ins for Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="51154-147">После настройки URL-адресов и параметров аутентификации на основе форм или HTTP необходимо выбрать расположения, в которые будут загружены подключаемые модули IIS для сервера Многофакторной идентификации Azure, которые затем будут включены в IIS.</span><span class="sxs-lookup"><span data-stu-id="51154-147">After configuring the Form-Based or HTTP authentication URLs and settings, select the locations where the Azure Multi-Factor Authentication IIS plug-ins should be loaded and enabled in IIS.</span></span> <span data-ttu-id="51154-148">Выполните перечисленные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="51154-148">Use the following procedure:</span></span>

1. <span data-ttu-id="51154-149">В среде IIS 6 выберите вкладку **ISAPI**.</span><span class="sxs-lookup"><span data-stu-id="51154-149">If running on IIS 6, click the **ISAPI** tab.</span></span> <span data-ttu-id="51154-150">Выберите веб-сайт, на котором выполняется веб-приложение (например, Default Web Site), для включения подключаемого модуля фильтра ISAPI Многофакторной идентификации Azure для этого сайта.</span><span class="sxs-lookup"><span data-stu-id="51154-150">Select the website that the web application is running under (e.g. Default Web Site) to enable the Azure Multi-Factor Authentication ISAPI filter plug-in for that site.</span></span>
2. <span data-ttu-id="51154-151">В среде IIS 7 или более поздней версии выберите вкладку **Собственный модуль**.</span><span class="sxs-lookup"><span data-stu-id="51154-151">If running on IIS 7 or higher, click the **Native Module** tab.</span></span> <span data-ttu-id="51154-152">Выберите сервер, веб-сайты или приложения, чтобы включить подключаемый модуль IIS на нужном уровне.</span><span class="sxs-lookup"><span data-stu-id="51154-152">Select the server, websites, or applications to enable the IIS plug-in at the desired levels.</span></span>
3. <span data-ttu-id="51154-153">Установите флажок **Включить проверку подлинности IIS** в верхней части экрана.</span><span class="sxs-lookup"><span data-stu-id="51154-153">Click the **Enable IIS authentication** box at the top of the screen.</span></span> <span data-ttu-id="51154-154">Теперь выбранное приложение IIS защищено Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="51154-154">Azure Multi-Factor Authentication is now securing the selected IIS application.</span></span> <span data-ttu-id="51154-155">Убедитесь, что пользователи были импортированы на сервер.</span><span class="sxs-lookup"><span data-stu-id="51154-155">Ensure that users have been imported into the Server.</span></span>

## <a name="trusted-ips"></a><span data-ttu-id="51154-156">Надежные IP-адреса</span><span class="sxs-lookup"><span data-stu-id="51154-156">Trusted IPs</span></span>
<span data-ttu-id="51154-157">Список «Надежные IP-адреса» позволяет обойти службу Azure Multi-Factor Authentication при обработке таких запросов на веб-сайты, которые исходят от определенных IP-адресов или подсетей.</span><span class="sxs-lookup"><span data-stu-id="51154-157">The Trusted IPs allows users to bypass Azure Multi-Factor Authentication for website requests originating from specific IP addresses or subnets.</span></span> <span data-ttu-id="51154-158">Например, вам может понадобиться исключить пользователей из проверки Azure Multi-Factor Authentication, если они входят с офисного компьютера.</span><span class="sxs-lookup"><span data-stu-id="51154-158">For example, you may want to exempt users from Azure Multi-Factor Authentication while logging in from the office.</span></span> <span data-ttu-id="51154-159">Для этого офисную подсеть нужно внести в список "Надежные IP-адреса".</span><span class="sxs-lookup"><span data-stu-id="51154-159">For this, you would specify the office subnet as a Trusted IPs entry.</span></span> <span data-ttu-id="51154-160">Для настройки надежных IP-адресов используйте следующую процедуру.</span><span class="sxs-lookup"><span data-stu-id="51154-160">To configure Trusted IPs, use the following procedure:</span></span>

1. <span data-ttu-id="51154-161">В разделе проверки подлинности IIS перейдите на вкладку **Надежные IP-адреса**.</span><span class="sxs-lookup"><span data-stu-id="51154-161">In the IIS Authentication section, click the **Trusted IPs** tab.</span></span>
2. <span data-ttu-id="51154-162">Щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="51154-162">Click **Add**.</span></span>
3. <span data-ttu-id="51154-163">Когда появится диалоговое окно "Добавление надежных IP-адресов", с помощью переключателя выберите **один IP-адрес**, **диапазон IP-адресов** или **подсеть**.</span><span class="sxs-lookup"><span data-stu-id="51154-163">When the Add Trusted IPs dialog box appears, select the **Single IP**, **IP range**, or **Subnet** radio button.</span></span>
4. <span data-ttu-id="51154-164">Укажите IP-адрес, диапазон IP-адресов или подсеть, которые следует внести в список разрешений.</span><span class="sxs-lookup"><span data-stu-id="51154-164">Enter the IP address, range of IP addresses or subnet that should be whitelisted.</span></span> <span data-ttu-id="51154-165">Указывая подсеть, выберите соответствующую маску сети, затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="51154-165">If entering a subnet, select the appropriate Netmask and click **OK**.</span></span> <span data-ttu-id="51154-166">После этого список разрешений будет добавлен.</span><span class="sxs-lookup"><span data-stu-id="51154-166">The whitelist has now been added.</span></span>
