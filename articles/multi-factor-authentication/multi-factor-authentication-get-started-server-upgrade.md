---
title: "Переход с PhoneFactor на сервер Многофакторной идентификации Azure | Документация Майкрософт"
description: "Начало работы с сервером Многофакторной идентификации Azure и замена старой версии агента PhoneFactor."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 42838ff7-bdf2-4d06-bacc-b3839a00cd76
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/06/2017
ms.author: kgremban
ms.openlocfilehash: 7ab7e693909f807781744ae53eed75d425096590
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-the-phonefactor-agent-to-azure-multi-factor-authentication-server"></a><span data-ttu-id="7f2e0-103">Переход с агента PhoneFactor на сервер Многофакторной идентификации Azure</span><span class="sxs-lookup"><span data-stu-id="7f2e0-103">Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="7f2e0-104">Чтобы перейти с агента PhoneFactor версии 5.x или более ранней версии на сервер Многофакторной идентификации Azure, сначала удалите агент PhoneFactor и связанные с ним компоненты.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-104">To upgrade the PhoneFactor Agent v5.x or older to Azure Multi-Factor Authentication Server, uninstall the PhoneFactor Agent and affiliated components first.</span></span> <span data-ttu-id="7f2e0-105">После этого можно установить сервер Многофакторной идентификации и его компоненты.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-105">Then the Multi-Factor Authentication Server and its affiliated components can be installed.</span></span>

## <a name="uninstall-the-phonefactor-agent"></a><span data-ttu-id="7f2e0-106">Удаление агента PhoneFactor</span><span class="sxs-lookup"><span data-stu-id="7f2e0-106">Uninstall the PhoneFactor Agent</span></span>

1. <span data-ttu-id="7f2e0-107">Сначала создайте резервную копию файла данных PhoneFactor.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-107">First, back up the PhoneFactor data file.</span></span> <span data-ttu-id="7f2e0-108">По умолчанию файл хранится в расположении C:\Program Files\PhoneFactor\Data\Phonefactor.pfdata.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-108">The default installation location is C:\Program Files\PhoneFactor\Data\Phonefactor.pfdata.</span></span>

2. <span data-ttu-id="7f2e0-109">Если установлен пользовательский портал, сделайте вот что:</span><span class="sxs-lookup"><span data-stu-id="7f2e0-109">If the User Portal is installed:</span></span>
  1. <span data-ttu-id="7f2e0-110">Перейдите в папку установки и создайте резервную копию файла web.config.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-110">Navigate to the install folder and back up the web.config file.</span></span> <span data-ttu-id="7f2e0-111">По умолчанию файл хранится в расположении C:\inetpub\wwwroot\PhoneFactor.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-111">The default installation location is C:\inetpub\wwwroot\PhoneFactor.</span></span>

  2. <span data-ttu-id="7f2e0-112">Если вы добавили на портал настраиваемые темы, создайте резервную копию настраиваемой папки, которая хранится в каталоге C:\inetpub\wwwroot\PhoneFactor\App_Themes.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-112">If you have added custom themes to the portal, back up your custom folder below the C:\inetpub\wwwroot\PhoneFactor\App_Themes directory.</span></span>

  3. <span data-ttu-id="7f2e0-113">Удалите пользовательский портал с помощью агента PhoneFactor (если портал установлен на том же сервере, что и агент PhoneFactor) или с помощью компонента «Программы и компоненты» в ОС Windows.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-113">Uninstall the User Portal either through the PhoneFactor Agent (only available if installed on the same server as the PhoneFactor Agent) or through Windows Programs and Features.</span></span>

3. <span data-ttu-id="7f2e0-114">Если веб-служба мобильного приложения установлена:</span><span class="sxs-lookup"><span data-stu-id="7f2e0-114">If the Mobile App Web Service is installed:</span></span>

  1. <span data-ttu-id="7f2e0-115">Перейдите в папку установки и создайте резервную копию файла web.config.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-115">Go to the install folder and back up the web.config file.</span></span> <span data-ttu-id="7f2e0-116">По умолчанию файл хранится в расположении C:\inetpub\wwwroot\PhoneFactorPhoneAppWebService.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-116">The default installation location is C:\inetpub\wwwroot\PhoneFactorPhoneAppWebService.</span></span>

  2. <span data-ttu-id="7f2e0-117">Удалите веб-службу мобильного приложения через компонент "Программы и компоненты" в ОС Windows.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-117">Uninstall the Mobile App Web Service through Windows Programs and Features.</span></span>

4. <span data-ttu-id="7f2e0-118">Если установлен пакет SDK для веб-службы, удалите его либо с помощью агента PhoneFactor, либо с помощью компонента «Программы и компоненты» в ОС Windows.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-118">If the Web Service SDK is installed, uninstall it either through the PhoneFactor Agent or through Windows Programs and Features.</span></span>

5. <span data-ttu-id="7f2e0-119">Удалите агент PhoneFactor с помощью компонента «Программы и компоненты» в ОС Windows.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-119">Uninstall the PhoneFactor Agent through Windows Programs and Features.</span></span>

## <a name="install-the-multi-factor-authentication-server"></a><span data-ttu-id="7f2e0-120">Установка сервера Многофакторной идентификации</span><span class="sxs-lookup"><span data-stu-id="7f2e0-120">Install the Multi-Factor Authentication Server</span></span>

<span data-ttu-id="7f2e0-121">Путь установки берется из реестра предыдущей установки агента PhoneFactor, поэтому сервер должен установиться в то же расположение (например, C:\Program Files\PhoneFactor).</span><span class="sxs-lookup"><span data-stu-id="7f2e0-121">The installation path is picked up from the registry from the previous PhoneFactor Agent installation, so it should install in the same location (for example, C:\Program Files\PhoneFactor).</span></span> <span data-ttu-id="7f2e0-122">В случае новой установки будет создан другой путь (например, C:\Program Files\Multi-Factor Authentication Server).</span><span class="sxs-lookup"><span data-stu-id="7f2e0-122">New installations have a different default install path (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> <span data-ttu-id="7f2e0-123">Файл данных, оставшийся от агента PhoneFactor, будет обновлен во время установки, поэтому после установки нового сервера Multi-Factor Authentication ваши пользователи и параметры будут в сохранности.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-123">The data file left by the previous PhoneFactor Agent should be upgraded during installation, so your users and settings should still be there after installing the new Multi-Factor Authentication Server.</span></span>

1. <span data-ttu-id="7f2e0-124">При появлении запроса активируйте сервер Multi-Factor Authentication и убедитесь, что он назначен правильной группе репликации.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-124">If prompted, activate the Multi-Factor Authentication Server and ensure it is assigned to the correct replication group.</span></span>

2. <span data-ttu-id="7f2e0-125">Если ранее был установлен пакет SDK для веб-службы, установите новый пакет SDK через пользовательский интерфейс сервера Многофакторной идентификации.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-125">If the Web Service SDK was previously installed, install the new Web Service SDK through the Multi-Factor Authentication Server User Interface.</span></span>

  <span data-ttu-id="7f2e0-126">Теперь у виртуального каталога по умолчанию будет имя **MultiFactorAuthWebServiceSdk**, а не **PhoneFactorWebServiceSdk**.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-126">The default virtual directory name is now **MultiFactorAuthWebServiceSdk** instead of **PhoneFactorWebServiceSdk**.</span></span> <span data-ttu-id="7f2e0-127">Если вы хотите использовать предыдущее имя, измените имя виртуального каталога на этапе установки.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-127">If you want to use the previous name, you must change the name of the virtual directory during installation.</span></span> <span data-ttu-id="7f2e0-128">Если во время установки не изменять имя каталога по умолчанию, вам придется изменить URL-адрес во всех приложениях, которые ссылаются на пакет SDK для веб-службы (например, пользовательский портал и веб-служба мобильного приложения). Новый URL-адрес должен ссылаться на правильное расположение.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-128">Otherwise, if you allow the install to use the new default name, you have to change the URL in any applications that reference the Web Service SDK (like the User Portal and Mobile App Web Service) to point at the correct location.</span></span>

3. <span data-ttu-id="7f2e0-129">Если пользовательский портал был ранее установлен на сервере с агентом PhoneFactor, установите новый пользовательский портал Multi-Factor Authentication через пользовательский интерфейс сервера Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-129">If the User Portal was previously installed on the PhoneFactor Agent Server, install the new Multi-Factor Authentication User Portal through the Multi-Factor Authentication Server User Interface.</span></span>

  <span data-ttu-id="7f2e0-130">Теперь у виртуального каталога по умолчанию будет имя **MultiFactorAuth**, а не **PhoneFactor**.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-130">The default virtual directory name is now **MultiFactorAuth** instead of **PhoneFactor**.</span></span> <span data-ttu-id="7f2e0-131">Если вы хотите использовать предыдущее имя, измените имя виртуального каталога на этапе установки.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-131">If you want to use the previous name, you must change the name of the virtual directory during installation.</span></span> <span data-ttu-id="7f2e0-132">Если во время установки не изменять имя каталога по умолчанию, щелкните значок пользовательского портала на сервере Multi-Factor Authentication и измените URL-адрес пользовательского портала на вкладке «Параметры».</span><span class="sxs-lookup"><span data-stu-id="7f2e0-132">Otherwise, if you allow the install to use the new default name, you should click the User Portal icon in the Multi-Factor Authentication Server and update the User Portal URL on the Settings tab.</span></span>

4. <span data-ttu-id="7f2e0-133">Если пользовательский портал или веб-служба мобильного приложения были ранее установлены на другом сервере (не на том, где установлен агент PhoneFactor):</span><span class="sxs-lookup"><span data-stu-id="7f2e0-133">If the User Portal and/or Mobile App Web Service was previously installed on a different server from the PhoneFactor Agent:</span></span>

  1. <span data-ttu-id="7f2e0-134">Перейдите в папку установки (например, C:\Program Files\PhoneFactor) и скопируйте один или несколько установщиков на другой сервер.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-134">Go to the install location (for example, C:\Program Files\PhoneFactor) and copy one or more installers to the other server.</span></span> <span data-ttu-id="7f2e0-135">Для пользовательского портала и веб-службы мобильного приложения существуют 32- и 64-разрядные установщики.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-135">There are 32-bit and 64-bit installers for both the User Portal and Mobile App Web Service.</span></span> <span data-ttu-id="7f2e0-136">Файлы имеют имена MultiFactorAuthenticationUserPortalSetupXX.msi и MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-136">They are called MultiFactorAuthenticationUserPortalSetupXX.msi and MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi.</span></span>

  2. <span data-ttu-id="7f2e0-137">Чтобы установить пользовательский портал на веб-сервер, откройте командную строку от имени администратора и запустите файл MultiFactorAuthenticationUserPortalSetupXX.msi.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-137">To install the User Portal on the web server, open a command prompt as an administrator and run MultiFactorAuthenticationUserPortalSetupXX.msi.</span></span>

    <span data-ttu-id="7f2e0-138">Теперь у виртуального каталога по умолчанию будет имя **MultiFactorAuth**, а не **PhoneFactor**.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-138">The default virtual directory name is now **MultiFactorAuth** instead of **PhoneFactor**.</span></span> <span data-ttu-id="7f2e0-139">Если вы хотите использовать предыдущее имя, измените имя виртуального каталога на этапе установки.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-139">If you want to use the previous name, you must change the name of the virtual directory during installation.</span></span> <span data-ttu-id="7f2e0-140">Если во время установки не изменять имя каталога по умолчанию, щелкните значок пользовательского портала на сервере Multi-Factor Authentication и измените URL-адрес пользовательского портала на вкладке «Параметры».</span><span class="sxs-lookup"><span data-stu-id="7f2e0-140">Otherwise, if you allow the install to use the new default name, you should click the User Portal icon in the Multi-Factor Authentication Server and update the User Portal URL on the Settings tab.</span></span> <span data-ttu-id="7f2e0-141">Новый URL-адрес следует сообщить всем существующим пользователям.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-141">Existing users need to be informed of the new URL.</span></span>

  3. <span data-ttu-id="7f2e0-142">Перейдите в папку установки пользовательского портала (например, C:\inetpub\wwwroot\MultiFactorAuth) и внесите изменения в файл web.config.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-142">Go to the User Portal install location (for example, C:\inetpub\wwwroot\MultiFactorAuth) and edit the web.config file.</span></span> <span data-ttu-id="7f2e0-143">Скопируйте значения в разделах appSettings и applicationSettings из исходного файла web.config, резервная копия которого была создана до появления нового файла web.config.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-143">Copy the values in the appSettings and applicationSettings sections from your original web.config file that was backed up before the upgrade into the new web.config file.</span></span> <span data-ttu-id="7f2e0-144">Если при установке пакета SDK для веб-службы вы оставили новое имя виртуального каталога по умолчанию, измените URL-адрес в разделе applicationSettings так, чтобы он указывал на правильное расположение.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-144">If the new default virtual directory name was kept when installing the Web Service SDK, change the URL in the applicationSettings section to point to the correct location.</span></span> <span data-ttu-id="7f2e0-145">Если в предыдущем файле web.config были изменены еще какие-то значения по умолчанию, внесите такие же изменения в новый файл web.config.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-145">If any other defaults were changed in the previous web.config file, apply those same changes to the new web.config file.</span></span>

  4. <span data-ttu-id="7f2e0-146">Чтобы установить веб-службу мобильного приложения на веб-сервер, откройте командную строку от имени администратора и запустите файл MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-146">To install the Mobile App Web Service on the web server, open a command prompt as an administrator and run the MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi.</span></span>

    <span data-ttu-id="7f2e0-147">Теперь у виртуального каталога, используемого по умолчанию, будет имя **MultiFactorAuthMobileAppWebService**, а не **PhoneFactorPhoneAppWebService**.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-147">The default virtual directory name is now **MultiFactorAuthMobileAppWebService** instead of **PhoneFactorPhoneAppWebService**.</span></span> <span data-ttu-id="7f2e0-148">Если вы хотите использовать предыдущее имя, измените имя виртуального каталога на этапе установки.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-148">If you want to use the previous name, you must change the name of the virtual directory during installation.</span></span> <span data-ttu-id="7f2e0-149">Вы можете выбрать более короткое имя. Так пользователям было проще вводить его на своих мобильных устройствах.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-149">You may want to choose a shorter name to make it easy for end users to type in on their mobile devices.</span></span> <span data-ttu-id="7f2e0-150">Если во время установки вы не хотите изменять имя каталога по умолчанию, щелкните значок мобильного приложения на сервере Multi-Factor Authentication и измените URL-адрес веб-службы мобильного приложения.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-150">Otherwise, if you allow the install to use the new default name, you should click the Mobile App icon in the Multi-Factor Authentication Server and update the Mobile App Web Service URL.</span></span>

  5. <span data-ttu-id="7f2e0-151">Перейдите в папку установки веб-службы мобильного приложения (например, C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService) и отредактируйте файл web.config.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-151">Go to the Mobile App Web Service install location (for example, C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService) and edit the web.config file.</span></span> <span data-ttu-id="7f2e0-152">Скопируйте значения в разделах appSettings и applicationSettings из исходного файла web.config, резервная копия которого была создана до появления нового файла web.config.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-152">Copy the values in the appSettings and applicationSettings sections from your original web.config file that was backed up before the upgrade into the new web.config file.</span></span> <span data-ttu-id="7f2e0-153">Если при установке пакета SDK для веб-службы вы оставили новое имя виртуального каталога по умолчанию, измените URL-адрес в разделе applicationSettings так, чтобы он указывал на правильное расположение.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-153">If the new default virtual directory name was kept when installing the Web Service SDK, change the URL in the applicationSettings section to point to the correct location.</span></span> <span data-ttu-id="7f2e0-154">Если в предыдущем файле web.config были изменены еще какие-то значения по умолчанию, внесите такие же изменения в новый файл web.config.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-154">If any other defaults were changed in the previous web.config file, apply those same changes to the new web.config file.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7f2e0-155">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="7f2e0-155">Next steps</span></span>

- <span data-ttu-id="7f2e0-156">[Установите пользовательский портал](multi-factor-authentication-get-started-portal.md) для сервера Многофакторной идентификации Azure.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-156">[Install the users portal](multi-factor-authentication-get-started-portal.md) for the Azure Multi-Factor Authentication Server.</span></span>

- <span data-ttu-id="7f2e0-157">[Настройте проверку подлинности Windows](multi-factor-authentication-get-started-server-windows.md) для приложений.</span><span class="sxs-lookup"><span data-stu-id="7f2e0-157">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications.</span></span> 
