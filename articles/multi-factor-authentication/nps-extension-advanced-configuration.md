---
title: "hello aaaConfigure расширения NPS многофакторной проверки Подлинности Azure | Документы Microsoft"
description: "После установки расширения NPS hello, выполните эти действия для дополнительной настройки, такие как утвержденный список IP и замены имени участника-пользователя."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/14/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: c3aed077b23c95f874861eb00c8e6dca668329c1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-configuration-options-for-hello-nps-extension-for-multi-factor-authentication"></a><span data-ttu-id="866ad-103">Дополнительные параметры конфигурации для расширения NPS hello многофакторной проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="866ad-103">Advanced configuration options for hello NPS extension for Multi-Factor Authentication</span></span>

<span data-ttu-id="866ad-104">Hello расширения сервера политики сети (NPS) расширяет ваши возможности облачных многофакторной проверки подлинности Azure в вашей локальной инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="866ad-104">hello Network Policy Server (NPS) extension extends your cloud-based Azure Multi-Factor Authentication features into your on-premises infrastructure.</span></span> <span data-ttu-id="866ad-105">В этой статье предполагается, что уже после установки расширения hello и теперь хотите tooknow как расширение hello toocustomize должен.</span><span class="sxs-lookup"><span data-stu-id="866ad-105">This article assumes that you already have hello extension installed, and now want tooknow how toocustomize hello extension for you needs.</span></span> 

## <a name="alternate-login-id"></a><span data-ttu-id="866ad-106">Альтернативное имя пользователя</span><span class="sxs-lookup"><span data-stu-id="866ad-106">Alternate login ID</span></span>

<span data-ttu-id="866ad-107">Поскольку hello расширения NPS подключается tooboth локальных и облачных каталогов, может возникать проблема, где ваш локальных имен участника-пользователя (UPN) не совпадают с именами hello в облаке hello.</span><span class="sxs-lookup"><span data-stu-id="866ad-107">Since hello NPS extension connects tooboth your on-premises and cloud directories, you might encounter an issue where your on-premises user principal names (UPNs) don't match hello names in hello cloud.</span></span> <span data-ttu-id="866ad-108">toosolve эту проблему, используйте альтернативные идентификаторы входа.</span><span class="sxs-lookup"><span data-stu-id="866ad-108">toosolve this problem, use alternate login IDs.</span></span> 

<span data-ttu-id="866ad-109">В рамках hello расширения сервера политики сети можно назначить toobe атрибут Active Directory, используемый вместо hello имени участника-пользователя для многофакторной проверки подлинности Azure.</span><span class="sxs-lookup"><span data-stu-id="866ad-109">Within hello NPS extension, you can designate an Active Directory attribute toobe used in place of hello UPN for Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="866ad-110">Благодаря этому вы tooprotect локальных ресурсов, с помощью двухэтапной проверки без изменения имен участников-пользователей вашей локальной.</span><span class="sxs-lookup"><span data-stu-id="866ad-110">This enables you tooprotect your on-premises resources with two-step verification without modifying your on-premises UPNs.</span></span> 

<span data-ttu-id="866ad-111">tooconfigure альтернативных имен идентификаторов, перейдите в слишком`HKLM\SOFTWARE\Microsoft\AzureMfa` и редактировать hello следующие значения реестра:</span><span class="sxs-lookup"><span data-stu-id="866ad-111">tooconfigure alternate login IDs, go too`HKLM\SOFTWARE\Microsoft\AzureMfa` and edit hello following registry values:</span></span>

| <span data-ttu-id="866ad-112">Имя</span><span class="sxs-lookup"><span data-stu-id="866ad-112">Name</span></span> | <span data-ttu-id="866ad-113">Тип</span><span class="sxs-lookup"><span data-stu-id="866ad-113">Type</span></span> | <span data-ttu-id="866ad-114">Значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="866ad-114">Default value</span></span> | <span data-ttu-id="866ad-115">Описание</span><span class="sxs-lookup"><span data-stu-id="866ad-115">Description</span></span> |
| ---- | ---- | ------------- | ----------- |
| <span data-ttu-id="866ad-116">LDAP_ALTERNATE_LOGINID_ATTRIBUTE</span><span class="sxs-lookup"><span data-stu-id="866ad-116">LDAP_ALTERNATE_LOGINID_ATTRIBUTE</span></span> | <span data-ttu-id="866ad-117">string</span><span class="sxs-lookup"><span data-stu-id="866ad-117">string</span></span> | <span data-ttu-id="866ad-118">Empty</span><span class="sxs-lookup"><span data-stu-id="866ad-118">Empty</span></span> | <span data-ttu-id="866ad-119">Назначить hello имя атрибута Active Directory, что требуется toouse вместо hello имени участника-пользователя.</span><span class="sxs-lookup"><span data-stu-id="866ad-119">Designate hello name of Active Directory attribute that you want toouse instead of hello UPN.</span></span> <span data-ttu-id="866ad-120">Этот атрибут используется в качестве атрибута AlternateLoginId hello.</span><span class="sxs-lookup"><span data-stu-id="866ad-120">This attribute is used as hello AlternateLoginId attribute.</span></span> <span data-ttu-id="866ad-121">Если это значение реестра установлено tooa [допустимый атрибут Active Directory](https://msdn.microsoft.com/library/ms675090.aspx) (например для почты или отображаемое имя), затем значение атрибута hello используется вместо UPN hello пользователя для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="866ad-121">If this registry value is set tooa [valid Active Directory attribute](https://msdn.microsoft.com/library/ms675090.aspx) (for example, mail or displayName), then hello attribute's value is used in place of hello user's UPN for authentication.</span></span> <span data-ttu-id="866ad-122">Если это значение реестра пуст или не настроена, затем AlternateLoginId отключена и участника-пользователя hello используется для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="866ad-122">If this registry value is empty or not configured, then AlternateLoginId is disabled and hello user's UPN is used for authentication.</span></span> |
| <span data-ttu-id="866ad-123">LDAP_FORCE_GLOBAL_CATALOG</span><span class="sxs-lookup"><span data-stu-id="866ad-123">LDAP_FORCE_GLOBAL_CATALOG</span></span> | <span data-ttu-id="866ad-124">Логическое</span><span class="sxs-lookup"><span data-stu-id="866ad-124">boolean</span></span> | <span data-ttu-id="866ad-125">Ложь</span><span class="sxs-lookup"><span data-stu-id="866ad-125">False</span></span> | <span data-ttu-id="866ad-126">Используйте этот флаг tooforce hello использование глобального каталога для поиска LDAP, при поиске AlternateLoginId.</span><span class="sxs-lookup"><span data-stu-id="866ad-126">Use this flag tooforce hello use of Global Catalog for LDAP searches when looking up AlternateLoginId.</span></span> <span data-ttu-id="866ad-127">Настройка контроллера домена в качестве глобального каталога, добавьте hello AlternateLoginId атрибута toohello глобального каталога, а затем включите этот флаг.</span><span class="sxs-lookup"><span data-stu-id="866ad-127">Configure a domain controller as a Global Catalog, add hello AlternateLoginId attribute toohello Global Catalog, and then enable this flag.</span></span> <br><br> <span data-ttu-id="866ad-128">Если LDAP_LOOKUP_FORESTS настроен (не пустое значение), **принудительно этот флаг устанавливается как true**, независимо от значения параметра реестра hello hello.</span><span class="sxs-lookup"><span data-stu-id="866ad-128">If LDAP_LOOKUP_FORESTS is configured (not empty), **this flag is enforced as true**, regardless of hello value of hello registry setting.</span></span> <span data-ttu-id="866ad-129">В этом случае hello NPS расширения требуется toobe hello глобального каталога, настроен с атрибутом AlternateLoginId hello для каждого леса.</span><span class="sxs-lookup"><span data-stu-id="866ad-129">In this case, hello NPS extension requires hello Global Catalog toobe configured with hello AlternateLoginId attribute for each forest.</span></span> |
| <span data-ttu-id="866ad-130">LDAP_LOOKUP_FORESTS</span><span class="sxs-lookup"><span data-stu-id="866ad-130">LDAP_LOOKUP_FORESTS</span></span> | <span data-ttu-id="866ad-131">string</span><span class="sxs-lookup"><span data-stu-id="866ad-131">string</span></span> | <span data-ttu-id="866ad-132">Empty</span><span class="sxs-lookup"><span data-stu-id="866ad-132">Empty</span></span> | <span data-ttu-id="866ad-133">Укажите список разделенных точкой с запятой toosearch лесов.</span><span class="sxs-lookup"><span data-stu-id="866ad-133">Provide a semi-colon separated list of forests toosearch.</span></span> <span data-ttu-id="866ad-134">Например, *contoso.com;foobar.com*. Если это значение реестра настроен, hello NPS расширения итеративно выполняет поиск всех лесах hello hello порядке, в которой они были явно перечислены возвращает первое успешное значение AlternateLoginId hello.</span><span class="sxs-lookup"><span data-stu-id="866ad-134">For example, *contoso.com;foobar.com*. If this registry value is configured, hello NPS extension iteratively searches all hello forests in hello order in which they were listed, and returns hello first successful AlternateLoginId value.</span></span> <span data-ttu-id="866ad-135">Если это значение реестра не настроен, уточняющий запрос AlternateLoginId hello является ограниченной toohello текущего домена.</span><span class="sxs-lookup"><span data-stu-id="866ad-135">If this registry value is not configured, hello AlternateLoginId lookup is confined toohello current domain.</span></span>|

<span data-ttu-id="866ad-136">tootroubleshoot проблемы с альтернативных имен идентификаторов, используйте рекомендуемые действия для hello [альтернативные ошибки идентификатора входа](multi-factor-authentication-nps-errors.md#alternate-login-id-errors).</span><span class="sxs-lookup"><span data-stu-id="866ad-136">tootroubleshoot problems with alternate login IDs, use hello recommended steps for [Alternate login ID errors](multi-factor-authentication-nps-errors.md#alternate-login-id-errors).</span></span>

## <a name="ip-exceptions"></a><span data-ttu-id="866ad-137">Исключения IP-адресов</span><span class="sxs-lookup"><span data-stu-id="866ad-137">IP exceptions</span></span>

<span data-ttu-id="866ad-138">Если вам нужна toomonitor доступность сервера, например если подсистемы балансировки нагрузки убедитесь, какие серверы запущены перед отправкой рабочих нагрузок, вы не хотите toobe этих проверок, блокировано запросов проверки.</span><span class="sxs-lookup"><span data-stu-id="866ad-138">If you need toomonitor server availability, like if load balancers verify which servers are running before sending workloads, you don't want these checks toobe blocked by verification requests.</span></span> <span data-ttu-id="866ad-139">Вместо этого создайте список IP-адресов, которые используются учетными записями служб, и отключите для него требования Многофакторной идентификации.</span><span class="sxs-lookup"><span data-stu-id="866ad-139">Instead, create a list of IP addresses that you know are used by service accounts, and disable Multi-Factor Authentication requirements for that list.</span></span> 

<span data-ttu-id="866ad-140">tooconfigure белого списка IP, перейдите в слишком`HKLM\SOFTWARE\Microsoft\AzureMfa` и настройте hello следующий параметр реестра:</span><span class="sxs-lookup"><span data-stu-id="866ad-140">tooconfigure an IP whitelist, go too`HKLM\SOFTWARE\Microsoft\AzureMfa` and configure hello following registry value:</span></span> 

| <span data-ttu-id="866ad-141">Имя</span><span class="sxs-lookup"><span data-stu-id="866ad-141">Name</span></span> | <span data-ttu-id="866ad-142">Тип</span><span class="sxs-lookup"><span data-stu-id="866ad-142">Type</span></span> | <span data-ttu-id="866ad-143">Значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="866ad-143">Default value</span></span> | <span data-ttu-id="866ad-144">Описание</span><span class="sxs-lookup"><span data-stu-id="866ad-144">Description</span></span> |
| ---- | ---- | ------------- | ----------- |
| <span data-ttu-id="866ad-145">IP_WHITELIST</span><span class="sxs-lookup"><span data-stu-id="866ad-145">IP_WHITELIST</span></span> | <span data-ttu-id="866ad-146">string</span><span class="sxs-lookup"><span data-stu-id="866ad-146">string</span></span> | <span data-ttu-id="866ad-147">Empty</span><span class="sxs-lookup"><span data-stu-id="866ad-147">Empty</span></span> | <span data-ttu-id="866ad-148">Предоставьте список разделенных точкой с запятой IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="866ad-148">Provide a semi-colon separated list of IP addresses.</span></span> <span data-ttu-id="866ad-149">Включить hello IP-адреса компьютеров, где создаются запросы на обслуживание, как hello NAS или VPN-сервера.</span><span class="sxs-lookup"><span data-stu-id="866ad-149">Include hello IP addresses of machines where service requests originate, like hello NAS/VPN server.</span></span> <span data-ttu-id="866ad-150">Диапазон IP-адресов подсети не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="866ad-150">IP ranges are subnets are not supported.</span></span> <br><br> <span data-ttu-id="866ad-151">Например, *10.0.0.1;10.0.0.2;10.0.0.3*.</span><span class="sxs-lookup"><span data-stu-id="866ad-151">For example, *10.0.0.1;10.0.0.2;10.0.0.3*.</span></span>

<span data-ttu-id="866ad-152">При поступлении запроса с IP-адреса, который существует в белом списке hello, пропускается двухшаговую проверку.</span><span class="sxs-lookup"><span data-stu-id="866ad-152">When a request comes in from an IP address that exists in hello whitelist, two-step verification is skipped.</span></span> <span data-ttu-id="866ad-153">Hello утвержденный список IP является сравниваемых toohello IP-адрес, предоставленный в hello *ratNASIPAddress* атрибут запроса RADIUS hello.</span><span class="sxs-lookup"><span data-stu-id="866ad-153">hello IP whitelist is compared toohello IP address that is provided in hello *ratNASIPAddress* attribute of hello RADIUS request.</span></span> <span data-ttu-id="866ad-154">При поступлении запроса RADIUS без атрибута ratNASIPAddress hello, регистрируется hello следующие предупреждения: «Белый список P_WHITE_LIST_WARNING::IP игнорируется как исходный IP-адрес отсутствует в запросе RADIUS в атрибуте NasIpAddress.»</span><span class="sxs-lookup"><span data-stu-id="866ad-154">If a RADIUS request comes in without hello ratNASIPAddress attribute, hello following warning is logged: "P_WHITE_LIST_WARNING::IP Whitelist is being ignored as source IP is missing in RADIUS request in NasIpAddress attribute."</span></span>

## <a name="next-steps"></a><span data-ttu-id="866ad-155">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="866ad-155">Next steps</span></span>

[<span data-ttu-id="866ad-156">Разрешить сообщения об ошибках из hello NPS расширения для многофакторной проверки подлинности Azure</span><span class="sxs-lookup"><span data-stu-id="866ad-156">Resolve error messages from hello NPS extension for Azure Multi-Factor Authentication</span></span>](multi-factor-authentication-nps-errors.md)
