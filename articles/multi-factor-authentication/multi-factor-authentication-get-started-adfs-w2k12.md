---
title: "aaaMFA сервера с AD FS в Windows Server | Документы Microsoft"
description: "В этой статье описывается, как tooget работу с Azure Multi-factor Authentication и AD FS в Windows Server 2012 R2 и 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 656785abcc63a020add765a86670b488a3b84b51
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-toowork-with-ad-fs-in-windows-server"></a><span data-ttu-id="ea6ea-103">Настроить toowork сервера Azure Multi-factor Authentication с AD FS в Windows Server</span><span class="sxs-lookup"><span data-stu-id="ea6ea-103">Configure Azure Multi-Factor Authentication Server toowork with AD FS in Windows Server</span></span>
<span data-ttu-id="ea6ea-104">Если использование служб федерации Active Directory (AD FS) и требуется toosecure облачные или локальные ресурсы, можно настроить toowork сервера Azure Multi-factor Authentication с AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-104">If you use Active Directory Federation Services (AD FS) and want toosecure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server toowork with AD FS.</span></span> <span data-ttu-id="ea6ea-105">Эта конфигурация активирует двухфакторную проверку подлинности для важных конечных точек.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="ea6ea-106">Эта статья содержит сведения об использовании сервера Многофакторной идентификации Azure с AD FS на платформе Windows Server 2012 R2 или Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="ea6ea-107">Дополнительные сведения, узнайте, как слишком[защита облачных и локальных ресурсов с помощью сервера Azure Multi-factor Authentication с AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="ea6ea-107">For more information, read about how too[secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="ea6ea-108">Защита AD FS в Windows Server с помощью сервера Многофакторной идентификации Azure</span><span class="sxs-lookup"><span data-stu-id="ea6ea-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="ea6ea-109">При установке сервера Azure Multi-factor Authentication, имеются следующие варианты hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-109">When you install Azure Multi-Factor Authentication Server, you have hello following options:</span></span>

* <span data-ttu-id="ea6ea-110">Установите сервер Azure Multi-factor Authentication локально на hello сервере AD FS</span><span class="sxs-lookup"><span data-stu-id="ea6ea-110">Install Azure Multi-Factor Authentication Server locally on hello same server as AD FS</span></span>
* <span data-ttu-id="ea6ea-111">Установка адаптера Azure Multi-factor Authentication hello локально на приветствия сервера AD FS, а затем установите многофакторной проверки подлинности сервера на другой компьютер</span><span class="sxs-lookup"><span data-stu-id="ea6ea-111">Install hello Azure Multi-Factor Authentication adapter locally on hello AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="ea6ea-112">Прежде чем начать, помните о hello следующую информацию:</span><span class="sxs-lookup"><span data-stu-id="ea6ea-112">Before you begin, be aware of hello following information:</span></span>

* <span data-ttu-id="ea6ea-113">Не требуется tooinstall сервера Azure Multi-factor Authentication на сервере AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-113">You are not required tooinstall Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="ea6ea-114">Тем не менее необходимо установить адаптер hello многофакторной проверки подлинности для AD FS на Windows Server 2012 R2 или Windows Server 2016, на котором выполняется AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-114">However, you must install hello Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="ea6ea-115">Можно установить сервер hello на другом компьютере, если он является одной из поддерживаемых версий и установить адаптер AD FS hello отдельно на сервере федерации AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-115">You can install hello server on a different computer if it is a supported version and you install hello AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="ea6ea-116">В разделе hello следующие процедуры toolearn как tooinstall hello адаптера отдельно.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-116">See hello following procedures toolearn how tooinstall hello adapter separately.</span></span>
* <span data-ttu-id="ea6ea-117">Если ваша организация использует текстовое сообщение или способов проверки подлинности мобильного приложения, hello строки, определенные в параметрах компании содержать заполнитель, <$*имя_приложения*$>.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-117">If your organization is using text message or mobile app verification methods, hello strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="ea6ea-118">На сервере MFA версии 7.1 вы можете указать имя приложения, которое заменит этот заполнитель.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="ea6ea-119">В v7.0 или старую этот заполнитель не заменяется автоматически при использовании hello AD FS-адаптера.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-119">In v7.0 or older, this placeholder is not automatically replaced when you use hello AD FS adapter.</span></span> <span data-ttu-id="ea6ea-120">Для этих более старых версий удалите заполнитель hello из hello соответствующие строки при защите AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-120">For those older versions, remove hello placeholder from hello appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="ea6ea-121">Hello учетной записи, используемой toosign в должен иметь права toocreate групп безопасности в службе Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-121">hello account that you use toosign in must have user rights toocreate security groups in your Active Directory service.</span></span>
* <span data-ttu-id="ea6ea-122">Мастер установки адаптера Hello многофакторной проверки подлинности AD FS создает группу безопасности под названием PhoneFactor Admins в вашем экземпляре Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-122">hello Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="ea6ea-123">Затем добавляется учетная запись службы AD FS hello группы toothis службы федерации.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-123">It then adds hello AD FS service account of your federation service toothis group.</span></span> <span data-ttu-id="ea6ea-124">Проверьте на контроллере домена, hello группы PhoneFactor Admins на самом деле создана и что учетной записи службы hello AD FS является членом этой группы.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-124">Verify on your domain controller that hello PhoneFactor Admins group is indeed created and that hello AD FS service account is a member of this group.</span></span> <span data-ttu-id="ea6ea-125">При необходимости вручную добавьте toohello учетной записи службы AD FS hello группы PhoneFactor Admins на контроллере домена.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-125">If necessary, manually add hello AD FS service account toohello PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="ea6ea-126">Сведения об установке hello Web Service SDK с пользовательского портала hello статье [развертывание hello пользовательского портала для сервера Azure Multi-factor Authentication.](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="ea6ea-126">For information about installing hello Web Service SDK with hello user portal, read about [deploying hello user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-hello-ad-fs-server"></a><span data-ttu-id="ea6ea-127">Установите сервер Azure Multi-factor Authentication локально на сервере AD FS hello</span><span class="sxs-lookup"><span data-stu-id="ea6ea-127">Install Azure Multi-Factor Authentication Server locally on hello AD FS server</span></span>
1. <span data-ttu-id="ea6ea-128">Скачайте и установите сервер многофакторной идентификации Azure на сервере AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="ea6ea-129">Сведения об установке см. в статье [Приступая к работе с сервером многофакторной идентификации Azure](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="ea6ea-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="ea6ea-130">В консоли управления hello сервера Azure Multi-factor Authentication щелкните hello **AD FS** значок.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-130">In hello Azure Multi-Factor Authentication Server management console, click hello **AD FS** icon.</span></span> <span data-ttu-id="ea6ea-131">Выберите параметры hello **разрешить регистрацию пользователей** и **пользователи tooselect метод**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-131">Select hello options **Allow user enrollment** and **Allow users tooselect method**.</span></span>
3. <span data-ttu-id="ea6ea-132">Выберите любые дополнительные параметры, которые вы хотите toospecify для вашей организации.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-132">Select any additional options you'd like toospecify for your organization.</span></span>
4. <span data-ttu-id="ea6ea-133">Щелкните **Установить AD FS-адаптер**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="ea6ea-134"><center>![Облако](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="ea6ea-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="ea6ea-135">Если откроется окно hello Active Directory, это означает следующее.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-135">If hello Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="ea6ea-136">Добавление компьютера домена tooa присоединены к домену, и hello Настройка Active Directory для обеспечения безопасной связи между адаптером hello AD FS и службой многофакторной проверки подлинности hello не была завершена.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-136">Your computer is joined tooa domain, and hello Active Directory configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="ea6ea-137">Нажмите кнопку **Далее** tooautomatically выполнить эту настройку, или выберите hello **пропустить автоматическую настройку Active Directory и настроить параметры вручную** флажок.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-137">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="ea6ea-138">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-138">Click **Next**.</span></span>
6. <span data-ttu-id="ea6ea-139">Если локальная группа windows hello отображается, значит две вещи.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-139">If hello Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="ea6ea-140">Компьютер не присоединены к домену tooa домена и настройка локальной группы hello для обеспечения безопасной связи между адаптером hello AD FS и службой многофакторной проверки подлинности hello не была завершена.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-140">Your computer is not joined tooa domain, and hello local group configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="ea6ea-141">Нажмите кнопку **Далее** tooautomatically выполнить эту настройку, или выберите hello **пропустить автоматическую настройку локальной группы и настроить параметры вручную** флажок.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-141">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="ea6ea-142">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-142">Click **Next**.</span></span>
7. <span data-ttu-id="ea6ea-143">В мастере установки hello, нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-143">In hello installation wizard, click **Next**.</span></span> <span data-ttu-id="ea6ea-144">Сервер Azure Multi-factor Authentication создает группы PhoneFactor Admins hello и добавляет toohello учетной записи службы AD FS hello группы PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-144">Azure Multi-Factor Authentication Server creates hello PhoneFactor Admins group and adds hello AD FS service account toohello PhoneFactor Admins group.</span></span>
   <span data-ttu-id="ea6ea-145"><center>![Облако](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="ea6ea-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="ea6ea-146">На hello **запуска установщика** щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-146">On hello **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="ea6ea-147">В установщике адаптера hello многофакторной проверки подлинности AD FS щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-147">In hello Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="ea6ea-148">Нажмите кнопку **закрыть** после завершения установки hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-148">Click **Close** when hello installation is finished.</span></span>
11. <span data-ttu-id="ea6ea-149">После установки адаптера hello, необходимо зарегистрировать его с AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-149">When hello adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="ea6ea-150">Откройте Windows PowerShell и выполните следующую команду hello:</span><span class="sxs-lookup"><span data-stu-id="ea6ea-150">Open Windows PowerShell and run hello following command:</span></span><br><span data-ttu-id="ea6ea-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Облако](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="ea6ea-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="ea6ea-152">toouse только что зарегистрированный адаптер, изменить hello глобальной политики поверки подлинности в AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-152">toouse your newly registered adapter, edit hello global authentication policy in AD FS.</span></span> <span data-ttu-id="ea6ea-153">В консоли управления hello AD FS, перейдите toohello **политики проверки подлинности** узла.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-153">In hello AD FS management console, go toohello **Authentication Policies** node.</span></span> <span data-ttu-id="ea6ea-154">В hello **многофакторной проверки подлинности** щелкните hello **изменить** ссылку Далее toohello **глобальные параметры** раздела.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-154">In hello **Multi-factor Authentication** section, click hello **Edit** link next toohello **Global Settings** section.</span></span> <span data-ttu-id="ea6ea-155">В hello **изменение глобальной политики проверки подлинности** выберите **многофакторной проверки подлинности** качестве дополнительного метода проверки подлинности, а затем щелкните **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-155">In hello **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="ea6ea-156">Hello адаптер регистрируется как WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-156">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="ea6ea-157">Перезапустите службу hello AD FS для эффекта tootake регистрации hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-157">Restart hello AD FS service for hello registration tootake effect.</span></span>

<span data-ttu-id="ea6ea-158"><center>![Облако](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="ea6ea-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="ea6ea-159">На этом этапе сервер Multi-factor Authentication настраивается toobe toouse поставщика дополнительной проверки подлинности с AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-159">At this point, Multi-Factor Authentication Server is set up toobe an additional authentication provider toouse with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-hello-ad-fs-adapter-by-using-hello-web-service-sdk"></a><span data-ttu-id="ea6ea-160">Установка с помощью отдельного экземпляра адаптера hello AD FS с помощью hello Web Service SDK</span><span class="sxs-lookup"><span data-stu-id="ea6ea-160">Install a standalone instance of hello AD FS adapter by using hello Web Service SDK</span></span>
1. <span data-ttu-id="ea6ea-161">Установите hello Web Service SDK на приветствия сервера, на котором работает сервер Multi-factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-161">Install hello Web Service SDK on hello server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="ea6ea-162">Следующие hello копирования файлов из hello \Program Files\Multi-Factor Authentication Server каталог toohello server плана tooinstall hello AD FS-адаптер:</span><span class="sxs-lookup"><span data-stu-id="ea6ea-162">Copy hello following files from hello \Program Files\Multi-Factor Authentication Server directory toohello server on which you plan tooinstall hello AD FS adapter:</span></span>
   * <span data-ttu-id="ea6ea-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="ea6ea-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="ea6ea-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="ea6ea-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="ea6ea-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="ea6ea-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="ea6ea-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="ea6ea-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="ea6ea-167">Запустите файл установки файлы MultiFactorAuthenticationAdfsAdapterSetup64.msi hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-167">Run hello MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="ea6ea-168">В установщике адаптера hello многофакторной проверки подлинности AD FS щелкните **Далее** toostart hello установки.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-168">In hello Multi-Factor Authentication AD FS adapter installer, click **Next** toostart hello installation.</span></span>
5. <span data-ttu-id="ea6ea-169">Нажмите кнопку **закрыть** после завершения установки hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-169">Click **Close** when hello installation is finished.</span></span>

## <a name="edit-hello-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="ea6ea-170">Отредактируйте файл MultiFactorAuthenticationAdfsAdapter.config hello</span><span class="sxs-lookup"><span data-stu-id="ea6ea-170">Edit hello MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="ea6ea-171">Выполните эти шаги файл MultiFactorAuthenticationAdfsAdapter.config hello tooedit.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-171">Follow these steps tooedit hello MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="ea6ea-172">Набор hello **UseWebServiceSdk** узла слишком**true**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-172">Set hello **UseWebServiceSdk** node too**true**.</span></span>  
2. <span data-ttu-id="ea6ea-173">Задайте значение hello **WebServiceSdkUrl** toohello URL-адрес hello SDK многофакторной проверки подлинности веб-службы.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-173">Set hello value for **WebServiceSdkUrl** toohello URL of hello Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="ea6ea-174">Например: *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, где *certificatename* hello имя сертификата.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is hello name of your certificate.</span></span>  
3. <span data-ttu-id="ea6ea-175">Измените скрипт hello Register-MultiFactorAuthenticationAdfsAdapter.ps1, добавив *параметр - ConfigurationFilePath &lt;путь&gt;*  toohello конец hello `Register-AdfsAuthenticationProvider` команду, где  *&lt;путь&gt;*  toohello MultiFactorAuthenticationAdfsAdapter.config hello полный путь файла.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-175">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* toohello end of hello `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="ea6ea-176">Настройка hello Web Service SDK с помощью имени пользователя и пароля</span><span class="sxs-lookup"><span data-stu-id="ea6ea-176">Configure hello Web Service SDK with a username and password</span></span>
<span data-ttu-id="ea6ea-177">Существует два варианта для настройки hello Web Service SDK.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-177">There are two options for configuring hello Web Service SDK.</span></span> <span data-ttu-id="ea6ea-178">Hello сначала с помощью имени пользователя и пароля, hello, второй — с помощью сертификата клиента.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-178">hello first is with a username and password, hello second is with a client certificate.</span></span> <span data-ttu-id="ea6ea-179">Выполните следующие действия для первого параметра hello, или сразу перейти для hello секунды.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-179">Follow these steps for hello first option, or skip ahead for hello second.</span></span>  

1. <span data-ttu-id="ea6ea-180">Задайте значение hello **параметра WebServiceSdkUsername** tooan учетную запись, которая является членом группы безопасности PhoneFactor Admins hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-180">Set hello value for **WebServiceSdkUsername** tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="ea6ea-181">Используйте hello &lt;домена&gt;&#92;&lt; имя пользователя&gt; формат.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-181">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="ea6ea-182">Задайте значение hello **WebServiceSdkPassword** toohello пароль соответствующей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-182">Set hello value for **WebServiceSdkPassword** toohello appropriate account password.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="ea6ea-183">Настройка hello Web Service SDK с помощью сертификата клиента</span><span class="sxs-lookup"><span data-stu-id="ea6ea-183">Configure hello Web Service SDK with a client certificate</span></span>
<span data-ttu-id="ea6ea-184">Если вы не хотите toouse имя пользователя и пароль, выполните эти шаги tooconfigure hello Web Service SDK с помощью сертификата клиента.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-184">If you don't want toouse a username and password, follow these steps tooconfigure hello Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="ea6ea-185">Получите клиентский сертификат из центра сертификации для hello сервера, на котором выполняется hello Web Service SDK.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-185">Obtain a client certificate from a certificate authority for hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="ea6ea-186">Узнайте, каким образом слишком[получать сертификаты клиента](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="ea6ea-186">Learn how too[obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="ea6ea-187">Импорт hello хранилище сертификатов клиента toohello локального компьютера личных сертификатов на сервере hello, на котором выполняется hello Web Service SDK.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-187">Import hello client certificate toohello local computer personal certificate store on hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="ea6ea-188">Убедитесь, что этот центр сертификации hello открытый сертификат находится в хранилище сертификатов доверенных корневых сертификатов.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-188">Make sure that hello certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="ea6ea-189">Экспорт hello открытый и закрытый ключи hello клиентского сертификата tooa PFX-файла.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-189">Export hello public and private keys of hello client certificate tooa .pfx file.</span></span>  
4. <span data-ttu-id="ea6ea-190">Экспортируйте открытый ключ hello в файл .cer tooa формат Base64.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-190">Export hello public key in Base64 format tooa .cer file.</span></span>  
5. <span data-ttu-id="ea6ea-191">В диспетчере серверов убедитесь, что установлена, функция проверки подлинности с сопоставлением сертификата клиента hello \Web Server\Security\IIS веб-сервер (IIS).</span><span class="sxs-lookup"><span data-stu-id="ea6ea-191">In Server Manager, verify that hello Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="ea6ea-192">Если он не установлен, установите **Добавить роли и компоненты** tooadd эту функцию.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-192">If it is not installed, select **Add Roles and Features** tooadd this feature.</span></span>  
6. <span data-ttu-id="ea6ea-193">В диспетчере служб IIS дважды щелкните **редактор конфигурации** hello веб-сайте, который содержит виртуальный каталог Web Service SDK hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-193">In IIS Manager, double-click **Configuration Editor** in hello website that contains hello Web Service SDK virtual directory.</span></span> <span data-ttu-id="ea6ea-194">Веб-сайт важные tooselect hello, hello виртуального каталога.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-194">It is important tooselect hello website, not hello virtual directory.</span></span>  
7. <span data-ttu-id="ea6ea-195">Go toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** раздела.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-195">Go toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="ea6ea-196">Набор включены слишком**true**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-196">Set enabled too**true**.</span></span>  
9. <span data-ttu-id="ea6ea-197">Установите параметр oneToOneCertificateMappingsEnabled слишком**true**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-197">Set oneToOneCertificateMappingsEnabled too**true**.</span></span>  
10. <span data-ttu-id="ea6ea-198">Нажмите кнопку hello **...**  toooneToOneMappings Далее, а затем нажмите hello **добавить** ссылку.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-198">Click hello **...** button next toooneToOneMappings, and then click hello **Add** link.</span></span>  
11. <span data-ttu-id="ea6ea-199">Откройте hello Base64 CER-файл, экспортированный ранее.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-199">Open hello Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="ea6ea-200">Удалите *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----* и все разрывы строк.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="ea6ea-201">Скопируйте результирующую строку hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-201">Copy hello resulting string.</span></span>  
12. <span data-ttu-id="ea6ea-202">Строка сертификата toohello набор скопированному предшествующего шаг hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-202">Set certificate toohello string copied in hello preceding step.</span></span>  
13. <span data-ttu-id="ea6ea-203">Набор включены слишком**true**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-203">Set enabled too**true**.</span></span>  
14. <span data-ttu-id="ea6ea-204">Задать tooan имя пользователя учетной записи, которая является членом группы безопасности PhoneFactor Admins hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-204">Set userName tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="ea6ea-205">Используйте hello &lt;домена&gt;&#92;&lt; имя пользователя&gt; формат.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-205">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="ea6ea-206">Задать toohello hello пароль соответствующей учетной записи, а затем закройте редактор конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-206">Set hello password toohello appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="ea6ea-207">Нажмите кнопку hello **применить** ссылку.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-207">Click hello **Apply** link.</span></span>  
17. <span data-ttu-id="ea6ea-208">Дважды щелкните в виртуальный каталог Web Service SDK hello **проверки подлинности**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-208">In hello Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="ea6ea-209">Убедитесь, что олицетворение ASP.NET и обычную проверку подлинности выбрано слишком**включено**, и все прочие элементы заданы слишком**отключено**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-209">Verify that ASP.NET Impersonation and Basic Authentication are set too**Enabled**, and that all other items are set too**Disabled**.</span></span>  
19. <span data-ttu-id="ea6ea-210">Дважды щелкните в виртуальный каталог Web Service SDK hello **параметры SSL**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-210">In hello Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="ea6ea-211">Задать сертификаты клиентов слишком**Accept**, а затем нажмите кнопку **применить**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-211">Set Client Certificates too**Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="ea6ea-212">Скопируйте hello PFX-файл, экспортированный ранее toohello сервера, на котором работает адаптер AD FS hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-212">Copy hello .pfx file you exported earlier toohello server that is running hello AD FS adapter.</span></span>  
22. <span data-ttu-id="ea6ea-213">Импортировать в хранилище личных сертификатов локального компьютера toohello файл hello PFX-файл.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-213">Import hello .pfx file toohello local computer personal certificate store.</span></span>  
23. <span data-ttu-id="ea6ea-214">Щелкните правой кнопкой мыши и выберите **управление закрытыми ключами**и затем предоставьте доступ на чтение toohello использованная учетная запись toosign в службе toohello AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-214">Right-click and select **Manage Private Keys**, and then grant read access toohello account you used toosign in toohello AD FS service.</span></span>  
24. <span data-ttu-id="ea6ea-215">Откройте hello сертификата и скопируйте hello отпечаток клиента из hello **сведения** вкладки.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-215">Open hello client certificate and copy hello thumbprint from hello **Details** tab.</span></span>  
25. <span data-ttu-id="ea6ea-216">В файле MultiFactorAuthenticationAdfsAdapter.config hello присвойте **параметра WebServiceSdkCertificateThumbprint** toohello строки копируются в предыдущем шаге hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-216">In hello MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** toohello string copied in hello previous step.</span></span>  

<span data-ttu-id="ea6ea-217">Наконец, tooregister hello адаптера, запустите hello \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 сценарий в PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-217">Finally, tooregister hello adapter, run hello \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="ea6ea-218">Hello адаптер регистрируется как WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-218">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="ea6ea-219">Перезапустите службу hello AD FS для эффекта tootake регистрации hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-219">Restart hello AD FS service for hello registration tootake effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="ea6ea-220">Защита ресурсов Azure AD с помощью AD FS</span><span class="sxs-lookup"><span data-stu-id="ea6ea-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="ea6ea-221">toosecure ресурса облака, настроить правило для утверждений, чтобы службы федерации Active Directory выдает утверждение multipleauthn hello, когда пользователь успешно выполняет двухшаговую проверку.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-221">toosecure your cloud resource, set up a claims rule so that Active Directory Federation Services emits hello multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="ea6ea-222">Это утверждение будет передано в tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-222">This claim is passed on tooAzure AD.</span></span> <span data-ttu-id="ea6ea-223">Выполните это процедура toowalk шаги hello.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-223">Follow this procedure toowalk through hello steps:</span></span>

1. <span data-ttu-id="ea6ea-224">Откройте оснастку управления AD FS.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="ea6ea-225">В левой части экрана приветствия выберите **доверия с проверяющей стороной**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-225">On hello left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="ea6ea-226">Щелкните правой кнопкой мыши **Microsoft Office 365 Identity Platform** (Платформа удостоверений Microsoft Office 365) и выберите **Изменить правила утверждений...**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Облако](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="ea6ea-228">На вкладке "Правила преобразования выдачи" выберите **Добавить правило**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Облако](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="ea6ea-230">На Здравствуйте преобразования мастера добавления правила утверждения, выберите **пропуск или Фильтрация входящего утверждения** из hello раскрывающегося списка и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-230">On hello Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from hello drop-down and click **Next**.</span></span>

   ![Облако](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="ea6ea-232">Укажите имя правила.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-232">Give your rule a name.</span></span>
7. <span data-ttu-id="ea6ea-233">Выберите **ссылки на методы проверки подлинности** тип hello входящего утверждения.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-233">Select **Authentication Methods References** as hello Incoming claim type.</span></span>
8. <span data-ttu-id="ea6ea-234">Щелкните **Пройти по всем значениям утверждений**.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="ea6ea-235">![Мастер добавления правила преобразования утверждений](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="ea6ea-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="ea6ea-236">Нажмите кнопку **Готово**</span><span class="sxs-lookup"><span data-stu-id="ea6ea-236">Click **Finish**.</span></span> <span data-ttu-id="ea6ea-237">Закройте консоль управления FS hello AD.</span><span class="sxs-lookup"><span data-stu-id="ea6ea-237">Close hello AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ea6ea-238">Связанные разделы</span><span class="sxs-lookup"><span data-stu-id="ea6ea-238">Related topics</span></span>
<span data-ttu-id="ea6ea-239">Справка по устранению неполадок в разделе hello [Azure многофакторной проверки подлинности, часто задаваемые вопросы](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="ea6ea-239">For troubleshooting help, see hello [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>
