---
title: "обновление сервера многофакторной проверки Подлинности aaaAzure | Документы Microsoft"
description: "Шаги и рекомендации tooupgrade hello сервера Azure Multi-factor Authentication tooa новой версии."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: aaa8d400e0e5f1c6be3a6d22cde6dd893ef4d546
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-toohello-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="c3426-103">Обновление toohello последнего Azure многофакторной проверки подлинности сервера</span><span class="sxs-lookup"><span data-stu-id="c3426-103">Upgrade toohello latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="c3426-104">В этой статье рассматриваются hello процесса обновления сервера Azure Multi-factor Authentication (MFA) версии 6.0 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="c3426-104">This article walks you through hello process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="c3426-105">Если вам требуется tooupgrade старой версии hello PhoneFactor Agent, см. слишком[обновления hello tooAzure PhoneFactor Agent многофакторной проверки подлинности сервера](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="c3426-105">If you need tooupgrade an old version of hello PhoneFactor Agent, refer too[Upgrade hello PhoneFactor Agent tooAzure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="c3426-106">Если вы обновления с v6.x или toov7.x старую или более поздней версии, все компоненты измените с .NET 2.0 too.NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="c3426-106">If you're upgrading from v6.x or older toov7.x or newer, all components change from .NET 2.0 too.NET 4.5.</span></span> <span data-ttu-id="c3426-107">Для всех компонентов также требуется распространяемый компонент Microsoft Visual C++ 2015, обновление 1 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="c3426-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="c3426-108">Hello многофакторной проверки Подлинности сервера установщик устанавливает обе hello x86- и x64 версии этих компонентов, если они еще не установлены.</span><span class="sxs-lookup"><span data-stu-id="c3426-108">hello MFA Server installer installs both hello x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="c3426-109">Если hello пользовательского портала и веб-служба мобильного приложения работают на разных серверах, необходимо tooinstall эти пакеты перед установкой этих компонентов.</span><span class="sxs-lookup"><span data-stu-id="c3426-109">If hello User Portal and Mobile App Web Service run on separate servers, you need tooinstall those packages before upgrading those components.</span></span> <span data-ttu-id="c3426-110">Можно выполнить поиск последнее обновление Visual C++ 2015 распространяемый компонент Microsoft hello на hello [центра загрузки Майкрософт](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="c3426-110">You can search for hello latest Microsoft Visual C++ 2015 Redistributable update on hello [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-hello-latest-version-of-azure-mfa-server"></a><span data-ttu-id="c3426-111">Установить последнюю версию сервера Azure MFA hello</span><span class="sxs-lookup"><span data-stu-id="c3426-111">Install hello latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="c3426-112">Используйте инструкции hello в [hello загрузки сервера Azure Multi-factor Authentication](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) tooget hello hello Azure многофакторной проверки Подлинности сервера в последнюю версию.</span><span class="sxs-lookup"><span data-stu-id="c3426-112">Use hello instructions in [Download hello Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) tooget hello latest version of hello Azure MFA Server.</span></span>
2. <span data-ttu-id="c3426-113">Создайте резервную копию файла данных сервера многофакторной проверки Подлинности hello, расположенный в C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (если предполагается, что hello каталог установки по умолчанию) на главном сервере многофакторной проверки Подлинности.</span><span class="sxs-lookup"><span data-stu-id="c3426-113">Make a backup of hello MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming hello default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="c3426-114">Если выполняется несколько серверов для обеспечения высокой доступности, измените hello клиентских систем, которые проходят проверку подлинности toohello многофакторной проверки Подлинности сервера, чтобы они останавливали отправки трафика toohello серверов, для обновления.</span><span class="sxs-lookup"><span data-stu-id="c3426-114">If you run multiple servers for high availability, change hello client systems that authenticate toohello MFA Server so that they stop sending traffic toohello servers that are upgrading.</span></span> <span data-ttu-id="c3426-115">При использовании подсистемы балансировки нагрузки, удалите многофакторной проверки Подлинности сервера из балансировки нагрузки hello, hello обновления и затем добавить сервер hello обратно в ферму hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-115">If you use a load balancer, remove a MFA Server from hello load balancer, do hello upgrade, and then add hello server back into hello farm.</span></span>
4. <span data-ttu-id="c3426-116">Запустите установщик новый hello на каждом сервере многофакторной проверки Подлинности.</span><span class="sxs-lookup"><span data-stu-id="c3426-116">Run hello new installer on each MFA Server.</span></span> <span data-ttu-id="c3426-117">Сначала обновите подчиненные серверы, так как они смогут прочесть hello реплицируются в главный hello старого файла данных.</span><span class="sxs-lookup"><span data-stu-id="c3426-117">Upgrade subordinate servers first because they can read hello old data file being replicated by hello master.</span></span> 

  <span data-ttu-id="c3426-118">Необязательно toouninstall к текущему серверу многофакторной проверки Подлинности, прежде чем выполнение установщика hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-118">You do not need toouninstall your current MFA Server before running hello installer.</span></span> <span data-ttu-id="c3426-119">Установщик Hello выполняет обновление на месте.</span><span class="sxs-lookup"><span data-stu-id="c3426-119">hello installer performs an in-place upgrade.</span></span> <span data-ttu-id="c3426-120">Hello путь установки берется из реестра hello из предыдущей установки hello, поэтому устанавливается в hello же расположение (например, C:\Program Files\Multi-Factor Authentication Server).</span><span class="sxs-lookup"><span data-stu-id="c3426-120">hello installation path is picked up from hello registry from hello previous installation, so it installs in hello same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="c3426-121">Если вы запрашиваемые tooinstall Microsoft Visual C++ 2015 с обновлением распространяемый пакет пакета напоминание hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-121">If you're prompted tooinstall a Microsoft Visual C++ 2015 Redistributable update package, accept hello prompt.</span></span> <span data-ttu-id="c3426-122">Установлены обе версии x86- и x64 hello hello пакета.</span><span class="sxs-lookup"><span data-stu-id="c3426-122">Both hello x86 and x64 versions of hello package are installed.</span></span>
5. <span data-ttu-id="c3426-123">Если вы используете hello Web Service SDK, будет предложено tooinstall hello новый Web Service SDK.</span><span class="sxs-lookup"><span data-stu-id="c3426-123">If you use hello Web Service SDK, you are prompted tooinstall hello new Web Service SDK.</span></span> <span data-ttu-id="c3426-124">При установке Здравствуйте новый SDK веб-службы, убедитесь, что имя виртуального каталога, hello соответствует hello ранее установленные виртуальный каталог (например, MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="c3426-124">When you install hello new Web Service SDK, make sure that hello virtual directory name matches hello previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="c3426-125">Повторите шаги hello на все подчиненные серверы.</span><span class="sxs-lookup"><span data-stu-id="c3426-125">Repeat hello steps on all subordinate servers.</span></span> <span data-ttu-id="c3426-126">Повысить уровень одного из нового образца hello toobe hello подчиненных объектов, а затем обновления hello старого главного сервера.</span><span class="sxs-lookup"><span data-stu-id="c3426-126">Promote one of hello subordinates toobe hello new master, then upgrade hello old master server.</span></span> 

## <a name="upgrade-hello-user-portal"></a><span data-ttu-id="c3426-127">Обновление hello пользовательского портала</span><span class="sxs-lookup"><span data-stu-id="c3426-127">Upgrade hello User Portal</span></span>

1. <span data-ttu-id="c3426-128">Создайте резервную копию файла web.config hello в виртуальный каталог hello hello расположение установки пользовательского портала (например, C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="c3426-128">Make a backup of hello web.config file that is in hello virtual directory of hello User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="c3426-129">Если тема по умолчанию toohello были сделаны изменения, создайте резервную копию папки App_Themes\Default hello также.</span><span class="sxs-lookup"><span data-stu-id="c3426-129">If any changes were made toohello default theme, make a backup of hello App_Themes\Default folder as well.</span></span> <span data-ttu-id="c3426-130">Лучше toocreate копию папки по умолчанию hello и создать новую тему, чем toochange тему по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-130">It is better toocreate a copy of hello Default folder and create a new theme than toochange hello Default theme.</span></span>
2. <span data-ttu-id="c3426-131">Если hello пользовательский портал работает на одном сервере как hello другие компоненты многофакторной проверки Подлинности сервера hello hello установки многофакторной проверки Подлинности сервера отобразится tooupdate hello пользовательского портала.</span><span class="sxs-lookup"><span data-stu-id="c3426-131">If hello User Portal runs on hello same server as hello other MFA Server components, hello MFA Server installation prompts you tooupdate hello User Portal.</span></span> <span data-ttu-id="c3426-132">Напоминание hello и установите обновление hello пользовательского портала.</span><span class="sxs-lookup"><span data-stu-id="c3426-132">Accept hello prompt and install hello User Portal update.</span></span> <span data-ttu-id="c3426-133">Убедитесь, что имя виртуального каталога, hello соответствует hello ранее установленные виртуальный каталог (например, MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="c3426-133">Check that hello virtual directory name matches hello previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="c3426-134">Если hello пользовательского портала на отдельном сервере, копировать файл MultiFactorAuthenticationUserPortalSetup64.msi hello из hello расположение одного hello многофакторной проверки Подлинности серверов установки и сохраните его на веб-сервере пользовательского портала hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-134">If hello User Portal is on its own server, copy hello MultiFactorAuthenticationUserPortalSetup64.msi file from hello install location of one of hello MFA Servers and put it onto hello User Portal web server.</span></span> <span data-ttu-id="c3426-135">Запустите установщик hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-135">Run hello installer.</span></span> 

  <span data-ttu-id="c3426-136">При возникновении ошибки сообщение о, «Microsoft Visual C++ 2015 распространяемый пакет обновления 1 или более поздней версии требуется,» загрузить и установить последний пакет обновления для hello из hello [центра загрузки Майкрософт](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="c3426-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="c3426-137">Установка обеих версий x86- и x64 hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-137">Install both hello x86 and x64 versions.</span></span>

4. <span data-ttu-id="c3426-138">После обновления программного обеспечения установлен пользовательский портал hello Сравните web.config hello резервного копирования, сделанных в шаге 1 со hello новый файл web.config.</span><span class="sxs-lookup"><span data-stu-id="c3426-138">After hello updated User Portal software is installed, compare hello web.config backup you made in step 1 with hello new web.config file.</span></span> <span data-ttu-id="c3426-139">Если новые атрибуты отсутствуют в файле web.config новый hello, скопируйте файл web.config резервного копирования в hello виртуальный каталог toooverwrite hello новый.</span><span class="sxs-lookup"><span data-stu-id="c3426-139">If no new attributes exist in hello new web.config, copy your backup web.config into hello virtual directory toooverwrite hello new one.</span></span> <span data-ttu-id="c3426-140">Другой вариант — toocopy и вставки hello appSettings значения и hello URL веб-службы SDK из файла резервной копии hello в новый файл web.config hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-140">Another option is toocopy/paste hello appSettings values and hello Web Service SDK URL from hello backup file into hello new web.config.</span></span>

<span data-ttu-id="c3426-141">Если у вас есть hello пользовательского портала на нескольких серверах, повторите установку hello на всех из них.</span><span class="sxs-lookup"><span data-stu-id="c3426-141">If you have hello User Portal on multiple servers, repeat hello installation on all of them.</span></span> 


## <a name="upgrade-hello-mobile-app-web-service"></a><span data-ttu-id="c3426-142">Обновление веб-служба мобильного приложения hello</span><span class="sxs-lookup"><span data-stu-id="c3426-142">Upgrade hello Mobile App Web Service</span></span>

1. <span data-ttu-id="c3426-143">Создайте резервную копию файла web.config hello, который находится в виртуальный каталог hello hello расположение установки веб-служба мобильного приложения (например, C:\inetpub\wwwroot\app или C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="c3426-143">Make a backup of hello web.config file that is in hello virtual directory of hello Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="c3426-144">Копировать файл MultiFactorAuthenticationMobileAppWebServiceSetup64.msi hello из hello размещение hello многофакторной проверки Подлинности серверов и поместить его в hello мобильное приложение регистрации веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="c3426-144">Copy hello MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from hello install location of hello MFA Servers and put it onto hello Mobile App registration web server.</span></span>
3. <span data-ttu-id="c3426-145">Запустите установщик hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-145">Run hello installer.</span></span> 

  <span data-ttu-id="c3426-146">Если возникает ошибка, о том, что требуется Microsoft Visual C++ 2015 распространяемый пакет обновления 1 или более поздней версии, загрузите и установите последний пакет обновления для hello из hello [центра загрузки Майкрософт](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="c3426-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="c3426-147">Установка обеих версий x86- и x64 hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-147">Install both hello x86 and x64 versions.</span></span>

4. <span data-ttu-id="c3426-148">После установки программного обеспечения веб-служба мобильного приложения hello обновлены Сравните файл web.config hello архивов, созданных на шаге 1, с новым файлом web.config hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-148">After hello updated Mobile App Web Service software installs, compare hello web.config file that was backed up in step 1 with hello new web.config file.</span></span> <span data-ttu-id="c3426-149">Если новые атрибуты отсутствуют в файле web.config новый hello, можно скопировать сохраненного файла web.config обратно в виртуальный каталог hello и перезаписать hello новый.</span><span class="sxs-lookup"><span data-stu-id="c3426-149">If no new attributes exist in hello new web.config, you can copy your saved web.config back into hello virtual directory and overwrite hello new one.</span></span> <span data-ttu-id="c3426-150">Другой вариант — toocopy и вставки hello appSettings значения и hello URL веб-службы SDK из файла резервной копии hello в новый файл web.config hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-150">Another option is toocopy/paste hello appSettings values and hello Web Service SDK URL from hello backup file into hello new web.config.</span></span>

<span data-ttu-id="c3426-151">Если у вас есть hello веб-служба мобильного приложения на нескольких серверах, повторите установку hello на всех из них.</span><span class="sxs-lookup"><span data-stu-id="c3426-151">If you have hello Mobile App Web Service on multiple servers, repeat hello installation on all of them.</span></span> 

## <a name="upgrade-hello-ad-fs-adapters"></a><span data-ttu-id="c3426-152">Обновление hello адаптера AD FS</span><span class="sxs-lookup"><span data-stu-id="c3426-152">Upgrade hello AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="c3426-153">Если MFA и службы AD FS работают на разных серверах</span><span class="sxs-lookup"><span data-stu-id="c3426-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="c3426-154">Эти инструкции применяются только в том случае, если сервер Многофакторной идентификации используется отдельно от серверов AD FS.</span><span class="sxs-lookup"><span data-stu-id="c3426-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="c3426-155">Если обе службы работают hello серверы, пропустите этот раздел и перейти toohello действия по установке.</span><span class="sxs-lookup"><span data-stu-id="c3426-155">If both services run on hello same servers, skip this section and go toohello installation steps.</span></span> 

1. <span data-ttu-id="c3426-156">Сохранить копию hello файл MultiFactorAuthenticationAdfsAdapter.config, который был зарегистрирован в Службах федерации Active Directory или экспортировать конфигурацию hello, используя следующую команду PowerShell hello: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path tooconfig file]`.</span><span class="sxs-lookup"><span data-stu-id="c3426-156">Save a copy of hello MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export hello configuration using hello following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path tooconfig file]`.</span></span> <span data-ttu-id="c3426-157">имя адаптера Hello — «WindowsAzureMultiFactorAuthentication» или «AzureMfaServerAuthentication» в зависимости от ранее установленной версии hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-157">hello adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on hello version previously installed.</span></span>
2. <span data-ttu-id="c3426-158">Скопируйте следующие файлы из серверов hello Server многофакторной проверки Подлинности установки расположение toohello AD FS hello:</span><span class="sxs-lookup"><span data-stu-id="c3426-158">Copy hello following files from hello MFA Server installation location toohello AD FS servers:</span></span>

  - <span data-ttu-id="c3426-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="c3426-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="c3426-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="c3426-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="c3426-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="c3426-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="c3426-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="c3426-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="c3426-163">Измените скрипт hello Register-MultiFactorAuthenticationAdfsAdapter.ps1, добавив `-ConfigurationFilePath [path]` toohello конец hello `Register-AdfsAuthenticationProvider` команды.</span><span class="sxs-lookup"><span data-stu-id="c3426-163">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` toohello end of hello `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="c3426-164">Замените *[путь]* с toohello полный путь hello MultiFactorAuthenticationAdfsAdapter.config файл или файл конфигурации hello экспортируются в предыдущем шаге hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-164">Replace *[path]* with hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file or hello configuration file exported in hello previous step.</span></span> 

  <span data-ttu-id="c3426-165">Проверьте атрибуты hello в новый MultiFactorAuthenticationAdfsAdapter.config toosee hello, если они соответствуют hello старый файл конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c3426-165">Check hello attributes in hello new MultiFactorAuthenticationAdfsAdapter.config toosee if they match hello old config file.</span></span> <span data-ttu-id="c3426-166">Если какие-либо атрибуты были добавлены или удалены в новой версии hello, скопируйте значения атрибутов hello из файла toohello hello старой конфигурации нового или изменения hello старой конфигурации файла toomatch.</span><span class="sxs-lookup"><span data-stu-id="c3426-166">If any attributes were added or removed in hello new version, copy hello attribute values from hello old configuration file toohello new one or modify hello old configuration file toomatch.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="c3426-167">Установка новых AD FS-адаптеров</span><span class="sxs-lookup"><span data-stu-id="c3426-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="c3426-168">Пользователям не будет обязательным tooperform двухшаговую проверку во время действия 3 – 8 этого раздела.</span><span class="sxs-lookup"><span data-stu-id="c3426-168">Your users will not be required tooperform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="c3426-169">При наличии AD FS, настроенный в несколько кластеров, можно удалить, обновления и восстановления каждого кластера в hello фермы независимо от hello простоя tooavoid других кластеров.</span><span class="sxs-lookup"><span data-stu-id="c3426-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in hello farm independently of hello other clusters tooavoid downtime.</span></span>

1. <span data-ttu-id="c3426-170">Удалите некоторые серверы AD FS из фермы hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-170">Remove some AD FS servers from hello farm.</span></span> <span data-ttu-id="c3426-171">Обновите эти серверы при приветствия другие ВМ продолжают работать.</span><span class="sxs-lookup"><span data-stu-id="c3426-171">Update these servers while hello others are still running.</span></span>
2. <span data-ttu-id="c3426-172">Установите новый адаптер AD FS hello на каждом сервере, удалены из фермы hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="c3426-172">Install hello new AD FS adapter on each server removed from hello AD FS farm.</span></span> <span data-ttu-id="c3426-173">Hello многофакторной проверки Подлинности сервера установлена на каждом сервере AD FS, можно изменить, если через Здравствуйте, администратор сервера MFA UI.</span><span class="sxs-lookup"><span data-stu-id="c3426-173">If hello MFA Server is installed on each AD FS server, you can update through hello MFA Server admin UX.</span></span> <span data-ttu-id="c3426-174">Если нет, то выполните обновление, запустив файл MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="c3426-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="c3426-175">При возникновении ошибки сообщение о, «Microsoft Visual C++ 2015 распространяемый пакет обновления 1 или более поздней версии требуется,» загрузить и установить последний пакет обновления для hello из hello [центра загрузки Майкрософт](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="c3426-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install hello latest update package from hello [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="c3426-176">Установка обеих версий x86- и x64 hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-176">Install both hello x86 and x64 versions.</span></span>

3. <span data-ttu-id="c3426-177">Go слишком**AD FS** > **политики проверки подлинности** > **изменение глобальной политики проверки подлинности многофакторный**.</span><span class="sxs-lookup"><span data-stu-id="c3426-177">Go too**AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="c3426-178">Снимите флажок **WindowsAzureMultiFactorAuthentication** или **AzureMFAServerAuthentication** (в зависимости от hello текущей установленной версии).</span><span class="sxs-lookup"><span data-stu-id="c3426-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on hello current version installed).</span></span> 

  <span data-ttu-id="c3426-179">По завершении этого шага двухфакторная проверка подлинности через сервер Mногофакторной идентификации станет доступна в этом кластере AD FS, пока вы не выполните шаг 8.</span><span class="sxs-lookup"><span data-stu-id="c3426-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="c3426-180">Отменить регистрацию hello старую версию адаптера hello AD FS путем выполнения сценария PowerShell Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-180">Unregister hello older version of hello AD FS adapter by running hello Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="c3426-181">Убедитесь, что hello *-имя* параметр («WindowsAzureMultiFactorAuthentication» или «AzureMFAServerAuthentication») соответствует hello имя, которое отображается на шаге 3.</span><span class="sxs-lookup"><span data-stu-id="c3426-181">Ensure that hello *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches hello name that was displayed in step 3.</span></span> <span data-ttu-id="c3426-182">Это относится tooall серверы в кластере hello же AD FS, так как нет центральная база данных конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c3426-182">This applies tooall servers in hello same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="c3426-183">Зарегистрируйте новый адаптер AD FS hello путем выполнения сценария PowerShell Register-MultiFactorAuthenticationAdfsAdapter.ps1 hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-183">Register hello new AD FS adapter by running hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="c3426-184">Это относится tooall серверы в кластере hello же AD FS, так как нет центральная база данных конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c3426-184">This applies tooall servers in hello same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="c3426-185">Hello перезапуск службы AD FS на каждом сервере удалены из hello фермы AD FS.</span><span class="sxs-lookup"><span data-stu-id="c3426-185">Restart hello AD FS service on each server removed from hello AD FS farm.</span></span>
7. <span data-ttu-id="c3426-186">Добавьте серверы hello обновлены резервное фермы toohello AD FS и удалить hello других серверов из фермы hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-186">Add hello updated servers back toohello AD FS farm and remove hello other servers from hello farm.</span></span>
8. <span data-ttu-id="c3426-187">Go слишком**AD FS** > **политики проверки подлинности** > **изменение глобальной политики проверки подлинности многофакторный**.</span><span class="sxs-lookup"><span data-stu-id="c3426-187">Go too**AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="c3426-188">Установите флажок **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="c3426-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="c3426-189">Повторите шаг 2 tooupdate hello серверы удален из фермы hello AD FS и перезапустите службу hello AD FS на этих серверах.</span><span class="sxs-lookup"><span data-stu-id="c3426-189">Repeat step 2 tooupdate hello servers now removed from hello AD FS farm and restart hello AD FS service on those servers.</span></span>
10. <span data-ttu-id="c3426-190">Добавьте эти серверы в ферме AD FS hello.</span><span class="sxs-lookup"><span data-stu-id="c3426-190">Add those servers back into hello AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c3426-191">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c3426-191">Next steps</span></span>

- <span data-ttu-id="c3426-192">Ознакомьтесь с примерами, приведенными в статье [Расширенные сценарии с использованием Многофакторной идентификации Azure и VPN-решений сторонних поставщиков](multi-factor-authentication-advanced-vpn-configurations.md).</span><span class="sxs-lookup"><span data-stu-id="c3426-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- <span data-ttu-id="c3426-193">[Интеграция каталогов между сервером Azure Multi-Factor Authentication и Active Directory](multi-factor-authentication-get-started-server-dirint.md).</span><span class="sxs-lookup"><span data-stu-id="c3426-193">[Synchronize MFA Server with Windows Server Active Directory](multi-factor-authentication-get-started-server-dirint.md)</span></span>

- <span data-ttu-id="c3426-194">Настройте для своих приложений проверку подлинности Windows, как описано в статье [Проверка подлинности Windows и сервер Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server-windows.md).</span><span class="sxs-lookup"><span data-stu-id="c3426-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
