---
title: "Непрерывная отправка для облачных служб с помощью Visual Studio Online | Документация Майкрософт"
description: "Настройка непрерывной доставки для облачных приложений Azure без сохранения ключа к хранилищу данных диагностики в файлах конфигурации службы"
services: cloud-services
documentationcenter: 
author: cawa
manager: paulyuk
editor: 
ms.assetid: 148b2959-c5db-4e4a-a7e9-fccb252e7e8a
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 11/02/2016
ms.author: cawa
ms.openlocfilehash: 7e70f92d4d1333ca6cbac5876e5ccbc763bd915c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="securely-save-cloud-services-diagnostics-storage-key-and-setup-continuous-integration-and-deployment-to-azure-using-visual-studio-online"></a>Безопасное сохранение ключа к хранилищу данных диагностики облачных служб и настройка непрерывной интеграции и развертывания в Azure с помощью Visual Studio Online
 В настоящее время этот подход часто используется в проектах с открытым кодом. Сохранять секреты приложения в файлах конфигурации теперь опасно, так как утечка секретов из общедоступной системы управления версиями ставит под угрозу безопасность. Сохранять секрет виде открытого текста в файле конвейера непрерывной интеграции тоже рискованно, так как серверы сборки могут быть общими ресурсами в облачной среде. В этой статье объясняется, как с помощью Visual Studio и Visual Studio Online устранить угрозы безопасности во время разработки и непрерывной интеграции.

## <a name="remove-diagnostics-storage-key-secret-in-project-configuration-file"></a>Удаление секрета ключа к хранилищу данных диагностики из файла конфигурации проекта
Расширению диагностики облачных служб необходимо хранилище Azure, чтобы сохранять результаты диагностики. Раньше строка подключения к хранилищу указывалась в файлах конфигурации (CSCFG) облачных служб, и ее можно было увидеть в системе управления версиями. В последнем выпуске пакета SDK для Azure сохраняется только частичная строка подключения с маркером вместо ключа. Следующие инструкции объясняют, как работают новые средства облачных служб.

### <a name="1-open-the-role-designer"></a>1. Открытие конструктора ролей
* Чтобы открыть конструктор ролей, дважды щелкните или щелкните правой кнопкой мыши роль облачных служб.

![Открытие конструктора ролей][0]

### <a name="2-under-diagnostics-section-a-new-check-box-dont-remove-storage-key-secret-from-project-is-added"></a>2. В разделе "Диагностика" добавлен новый флажок "Не удалять секрет ключа хранилища из файла конфигурации проекта (CSCFG-файла)"
* Если вы используете эмулятор локального хранилища, этот флажок недоступен, так как для строки локального подключения UseDevelopmentStorage = true отсутствует секрет, которым можно управлять.

![Строка подключения к эмулятору локального хранилища не является секретом][1]

* Если вы создаете новый проект, по умолчанию этот флажок снят. В результате раздел ключа к хранилищу данных в выбранной строке подключения заменяется маркером. Значение маркера находится в папке AppData\Roaming текущего пользователя (например, C:\Users\contosouser\AppData\Roaming\Microsoft\CloudService).

> Обратите внимание, что доступ к папке user\AppData контролируется с помощью входа пользователя и она считается надежным местом для хранения конфиденциальных данных разработки.
> 
> 

![Ключ к хранилищу данных сохранен в папке профиля пользователя][2]

### <a name="3-select-a-diagnostics-storage-account"></a>3. Выбор учетной записи хранения для диагностики
* Нажмите кнопку "…" и в открывшемся диалоговом окне выберите учетную запись хранения. . Обратите внимание, что создаваемая строка подключения к хранилищу не будет содержать ключ учетной записи хранения.
* Например, DefaultEndpointsProtocol=https;AccountName=contosostorage;AccountKey=$(*clouddiagstrg.key*)

### <a name="4----debugging-the-project"></a>4.    Отладка проекта
* Нажмите клавишу F5, чтобы запустить отладку в Visual Studio. Все должно работать, как раньше.
  ![Локальный запуск отладки][3]

### <a name="5-publish-project-from-visual-studio"></a>5. Публикация проекта из Visual Studio
* Откройте диалоговое окно публикации и следуйте инструкциям, чтобы войти и опубликовать приложение в Azure.

### <a name="6-additional-information"></a>6. Дополнительная информация
> Примечание. На панели параметров конструктор ролей пока что будет оставаться без изменений. Если вы хотите использовать функцию управления секретом для диагностики, перейдите на вкладку конфигурации.
> 
> 

![Добавление параметров][4]

> Примечание. Если ключ Application Insights включен, он будет храниться как обычный текст. Этот ключ используется только для передачи содержимого, поэтому риск раскрытия конфиденциальных данных отсутствует.
> 
> 

## <a name="build-and-publish-a-cloud-services-project-using-visual-studio-online-task-templates"></a>Создание и публикация проекта облачных служб с помощью шаблонов задач Visual Studio Online
* Ниже показано, как настроить непрерывную интеграцию для проекта облачных служб с помощью задач Visual Studio Online.
  ### <a name="1----obtain-a-vso-account"></a>1.    Получение учетной записи VSO
* [Создайте учетную запись Visual Studio Online] [ Create Visual Studio Online account] Если вы их еще нет
* [Создание командного проекта] [ Create team project] своей учетной записи Visual Studio online

### <a name="2----setup-source-control-in-visual-studio"></a>2.    Настройка системы управления версиями в Visual Studio
* Подключитесь к командному проекту.

![Подключение к командному проекту][5]

![Выбор командного проекта для подключения][6]

* Добавьте проект в систему управления версиями.

![Добавление проекта в систему управления версиями][7]

![Сопоставление проекта с папкой системы управления версиями][8]

* Запишите проект после изменения из Team Explorer.

![Запись проекта после изменения в систему управления версиями][9]

### <a name="3----configure-build-process"></a>3.    Настройка процесса сборки
* Откройте командный проект и добавьте новые шаблоны процесса сборки.

![Добавление новой сборки][10]

* Выберите задачу сборки.

![Добавление задачи сборки][11]

![Выбор шаблона задачи сборки в Visual Studio][12]

* Измените входные данные задачи сборки. Настройте параметры сборки по своему усмотрению.

![Настройка задачи сборки][13]

`/t:Publish /p:TargetProfile=$(targetProfile) /p:DebugType=None /p:SkipInvalidConfigurations=true /p:OutputPath=bin\ /p:PublishDir="$(build.artifactstagingdirectory)\\"`

* Настройте переменные сборки.

![Настройка переменных сборки.][14]

* Добавьте задачу отправки в заданное место сборки.

![Выбор задачи публикации в заданном месте сборки][15]

![Настройка задачи публикации в заданном месте сборки][16]

* Запустите сборку.

![Постановка новой сборки в очередь][17]

![Просмотр сводки сборки][18]

* Если сборка выполнена успешно, вы увидите примерно такой результат:

![Результат сборки][19]

### <a name="4----configure-release-process"></a>4.    Процесса настройки выпуска
* Создайте новый выпуск.

![Создание нового выпуска][20]

* Выберите задачу развертывания облачных служб Azure

![Выбор задачи развертывания облачных служб Azure][21]

* Так как ключ учетной записи хранения не записан после изменения в систему управления версиями, необходимо указать секретный ключ для настройки расширений диагностики. Разверните раздел **Дополнительные параметры для создания новой службы** и измените входные данные параметра **Diagnostics Storage Account Keys** (Ключи учетной записи хранения диагностических данных). Эти выходные данные включают несколько строк пары "ключ — значение" в формате **[имя_роли]:$(ключ_учетной_записи_хранения)**.

> Примечание. Если ваша учетная запись хранения диагностических данных находится в подписке, в которой будет опубликовано приложение облачных служб, не нужно указывать ключ во входных данных задачи развертывания. Развертывание программно получит информацию о хранилище из подписки.
> 
> 

![Настройка задачи развертывания облачных служб][22]

* Используйте секретные переменные сборки, чтобы сохранить ключи к хранилищу данных. Чтобы маскировать переменную как секрет, щелкните значок блокировки справа от входных данных переменных.

![Сохранение ключей к хранилищу данных в секретных переменных сборки][23]

* Создайте выпуск и разверните проект в Azure

![Создание нового выпуска][24]

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о настройке расширений диагностики для облачных служб Azure см. в разделе [включение диагностики в облачных службах Azure с помощью PowerShell][Enable diagnostics in Azure Cloud Services using PowerShell]

[Create Visual Studio Online account]:https://www.visualstudio.com/team-services/
[Create team project]: https://www.visualstudio.com/it-it/docs/setup-admin/team-services/connect-to-visual-studio-team-services
[Enable diagnostics in Azure Cloud Services using PowerShell]:https://azure.microsoft.com/en-us/documentation/articles/cloud-services-diagnostics-powershell/

[0]: ./media/cloud-services-vs-ci/vs-01.png
[1]: ./media/cloud-services-vs-ci/vs-02.png
[2]: ./media/cloud-services-vs-ci/file-01.png
[3]: ./media/cloud-services-vs-ci/vs-03.png
[4]: ./media/cloud-services-vs-ci/vs-04.png
[5]: ./media/cloud-services-vs-ci/vs-05.png
[6]: ./media/cloud-services-vs-ci/vs-06.png
[7]: ./media/cloud-services-vs-ci/vs-07.png
[8]: ./media/cloud-services-vs-ci/vs-08.png
[9]: ./media/cloud-services-vs-ci/vs-09.png
[10]: ./media/cloud-services-vs-ci/vso-01.png
[11]: ./media/cloud-services-vs-ci/vso-02.png
[12]: ./media/cloud-services-vs-ci/vso-03.png
[13]: ./media/cloud-services-vs-ci/vso-04.png
[14]: ./media/cloud-services-vs-ci/vso-05.png
[15]: ./media/cloud-services-vs-ci/vso-06.png
[16]: ./media/cloud-services-vs-ci/vso-07.png
[17]: ./media/cloud-services-vs-ci/vso-08.png
[18]: ./media/cloud-services-vs-ci/vso-09.png
[19]: ./media/cloud-services-vs-ci/vso-10.png
[20]: ./media/cloud-services-vs-ci/vso-11.png
[21]: ./media/cloud-services-vs-ci/vso-12.png
[22]: ./media/cloud-services-vs-ci/vso-13.png
[23]: ./media/cloud-services-vs-ci/vso-14.png
[24]: ./media/cloud-services-vs-ci/vso-15.png
