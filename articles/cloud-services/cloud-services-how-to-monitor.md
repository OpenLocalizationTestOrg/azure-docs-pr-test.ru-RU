---
title: "Мониторинг облачной службы | Документация Майкрософт"
description: "Узнайте, как осуществлять мониторинг облачных служб с помощью классического портала Azure."
services: cloud-services
documentationcenter: 
author: thraka
manager: timlt
editor: 
ms.assetid: 5c48d2fb-b8ea-420f-80df-7aebe2b66b1b
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/07/2015
ms.author: adegeo
ms.openlocfilehash: c369b22cf068a473343b006eb1b06fdd350d31db
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="how-to-monitor-cloud-services"></a><span data-ttu-id="390ac-103">Мониторинг облачных служб</span><span class="sxs-lookup"><span data-stu-id="390ac-103">How to Monitor Cloud Services</span></span>
[!INCLUDE [disclaimer](../../includes/disclaimer.md)]

<span data-ttu-id="390ac-104">Вы можете отслеживать метрики производительности `key` облачных служб на классическом портале Azure.</span><span class="sxs-lookup"><span data-stu-id="390ac-104">You can monitor `key` performance metrics for your cloud services in the Azure classic portal.</span></span> <span data-ttu-id="390ac-105">Для каждой роли службы можно задать минимальный или подробный уровень, а также настроить отображение данных мониторинга.</span><span class="sxs-lookup"><span data-stu-id="390ac-105">You can set the level of monitoring to minimal and verbose for each service role, and can customize the monitoring displays.</span></span> <span data-ttu-id="390ac-106">Подробные данные мониторинга размещаются в учетной записи хранения, которая доступна вне портала.</span><span class="sxs-lookup"><span data-stu-id="390ac-106">Verbose monitoring data is stored in a storage account, which you can access outside the portal.</span></span> 

<span data-ttu-id="390ac-107">Классический портал Azure предоставляет широкие возможности для настройки отображения данных мониторинга.</span><span class="sxs-lookup"><span data-stu-id="390ac-107">Monitoring displays in the Azure classic portal are highly configurable.</span></span> <span data-ttu-id="390ac-108">Метрики для мониторинга можно выбрать в соответствующем списке на странице **Мониторинг**. Также можно указать метрики, которые будут строиться на диаграмме на странице **Мониторинг** или панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="390ac-108">You can choose the metrics you want to monitor in the metrics list on the **Monitor** page, and you can choose which metrics to plot in metrics charts on the **Monitor** page and the dashboard.</span></span> 

## <a name="concepts"></a><span data-ttu-id="390ac-109">Основные понятия</span><span class="sxs-lookup"><span data-stu-id="390ac-109">Concepts</span></span>
<span data-ttu-id="390ac-110">По умолчанию в новой облачной службе настроен минимальный уровень мониторинга, основанный на данных счетчиков производительности из основной операционной системы для экземпляров роли (виртуальные машины).</span><span class="sxs-lookup"><span data-stu-id="390ac-110">By default, minimal monitoring is provided for a new cloud service using performance counters gathered from the host operating system for the roles instances (virtual machines).</span></span> <span data-ttu-id="390ac-111">В этом режиме отслеживаются следующие метрики: «Процент ЦП», «Входящие данные», «Исходящие данные», «Скорость чтения с диска» и «Скорость записи на диск».</span><span class="sxs-lookup"><span data-stu-id="390ac-111">The minimal metrics are limited to CPU Percentage, Data In, Data Out, Disk Read Throughput, and Disk Write Throughput.</span></span> <span data-ttu-id="390ac-112">Для просмотра дополнительных метрик на основе данных о производительности виртуальных машин (экземпляры роли) необходимо настроить подробный мониторинг.</span><span class="sxs-lookup"><span data-stu-id="390ac-112">By configuring verbose monitoring, you can receive additional metrics based on performance data within the virtual machines (role instances).</span></span> <span data-ttu-id="390ac-113">В этом режиме обеспечивается более тщательный анализ проблем, возникающих во время работы приложений.</span><span class="sxs-lookup"><span data-stu-id="390ac-113">The verbose metrics enable closer analysis of issues that occur during application operations.</span></span>

<span data-ttu-id="390ac-114">По умолчанию выборка и передача данных счетчиков производительности из экземпляра роли осуществляется с интервалом в 3 минуты.</span><span class="sxs-lookup"><span data-stu-id="390ac-114">By default performance counter data from role instances is sampled and transferred from the role instance at 3-minute intervals.</span></span> <span data-ttu-id="390ac-115">Если включен подробный мониторинг, для каждого отдельного экземпляра роли и всех экземпляров каждой роли необработанные данные счетчиков собираются с интервалами 5 минут, 1 час и 12 часов.</span><span class="sxs-lookup"><span data-stu-id="390ac-115">When you enable verbose monitoring, the raw performance counter data is aggregated for each role instance and across role instances for each role at intervals of 5 minutes, 1 hour, and 12 hours.</span></span> <span data-ttu-id="390ac-116">Сводные данные хранятся 10 дней, после чего удаляются.</span><span class="sxs-lookup"><span data-stu-id="390ac-116">The aggregated data is purged after 10 days.</span></span>

<span data-ttu-id="390ac-117">После включения подробного мониторинга сводные данные размещаются в таблицах учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="390ac-117">After you enable verbose monitoring, the aggregated monitoring data is stored in tables in your storage account.</span></span> <span data-ttu-id="390ac-118">Чтобы включить подробный мониторинг, необходимо настроить строку подключения диагностики для связи с учетной записью хранения.</span><span class="sxs-lookup"><span data-stu-id="390ac-118">To enable verbose monitoring for a role, you must configure a diagnostics connection string that links to the storage account.</span></span> <span data-ttu-id="390ac-119">Для каждой роли можно использовать собственную учетную запись хранения.</span><span class="sxs-lookup"><span data-stu-id="390ac-119">You can use different storage accounts for different roles.</span></span>

<span data-ttu-id="390ac-120">При включенном подробном мониторинге возрастают затраты, связанные с хранением, передачей данных и выполнением транзакций хранилища.</span><span class="sxs-lookup"><span data-stu-id="390ac-120">Enabling verbose monitoring increases your storage costs related to data storage, data transfer, and storage transactions.</span></span> <span data-ttu-id="390ac-121">При минимальном уровне мониторинга учетная запись хранения не требуется.</span><span class="sxs-lookup"><span data-stu-id="390ac-121">Minimal monitoring does not require a storage account.</span></span> <span data-ttu-id="390ac-122">Данные метрик, доступных на этом уровне, не добавляются в учетную запись хранения, даже если включен подробный мониторинг.</span><span class="sxs-lookup"><span data-stu-id="390ac-122">The data for the metrics that are exposed at the minimal monitoring level are not stored in your storage account, even if you set the monitoring level to verbose.</span></span>

## <a name="how-to-configure-monitoring-for-cloud-services"></a><span data-ttu-id="390ac-123">Практическое руководство. Настройка мониторинга для облачных служб</span><span class="sxs-lookup"><span data-stu-id="390ac-123">How to: Configure monitoring for cloud services</span></span>
<span data-ttu-id="390ac-124">Чтобы настроить минимальный или подробный уровень мониторинга на классическом портале Azure, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="390ac-124">Use the following procedures to configure verbose or minimal monitoring in the Azure classic portal.</span></span> 

### <a name="before-you-begin"></a><span data-ttu-id="390ac-125">Перед началом работы</span><span class="sxs-lookup"><span data-stu-id="390ac-125">Before you begin</span></span>
* <span data-ttu-id="390ac-126">Создайте *классическую* учетную запись хранения, в которой будут размещаться данные мониторинга.</span><span class="sxs-lookup"><span data-stu-id="390ac-126">Create a *classic* storage account to store the monitoring data.</span></span> <span data-ttu-id="390ac-127">Для каждой роли можно использовать собственную учетную запись хранения.</span><span class="sxs-lookup"><span data-stu-id="390ac-127">You can use different storage accounts for different roles.</span></span> <span data-ttu-id="390ac-128">Дополнительные сведения см. в статье [Создание учетной записи хранения](../storage/common/storage-create-storage-account.md#create-a-storage-account).</span><span class="sxs-lookup"><span data-stu-id="390ac-128">For more information, see [How to create a storage account](../storage/common/storage-create-storage-account.md#create-a-storage-account).</span></span>
* <span data-ttu-id="390ac-129">Включите систему диагностики Azure для ролей облачной службы.</span><span class="sxs-lookup"><span data-stu-id="390ac-129">Enable Azure Diagnostics for your cloud service roles.</span></span> <span data-ttu-id="390ac-130">См. в разделе [Настройки диагностики для облачных служб](cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="390ac-130">See [Configuring Diagnostics for Cloud Services](cloud-services-dotnet-diagnostics.md).</span></span>

<span data-ttu-id="390ac-131">Убедитесь, что строка подключения диагностики находится в имеющейся настройке роли.</span><span class="sxs-lookup"><span data-stu-id="390ac-131">Ensure that the diagnostics connection string is present in the Role configuration.</span></span> <span data-ttu-id="390ac-132">Вы не можете включить подробный уровень мониторинга, пока не включите систему диагностики Azure и строку подключения диагностики в настройке роли.</span><span class="sxs-lookup"><span data-stu-id="390ac-132">You cannot turn on verbose monitoring until you enable Azure Diagnostics and include a diagnostics connection string in the Role configuration.</span></span>   

> [!NOTE]
> <span data-ttu-id="390ac-133">Проекты, предназначенные для пакета SDK 2.5 Azure, не содержат по умолчанию строку подключения диагностики в шаблоне проекта.</span><span class="sxs-lookup"><span data-stu-id="390ac-133">Projects targeting Azure SDK 2.5 did not automatically include the diagnostics connection string in the project template.</span></span> <span data-ttu-id="390ac-134">В эти проекты необходимо вручную добавить строку подключения диагностики в настройке роли.</span><span class="sxs-lookup"><span data-stu-id="390ac-134">For these projects, you need to manually add the diagnostics connection string to the Role configuration.</span></span>
> 
> 

<span data-ttu-id="390ac-135">**Чтобы добавить строку подключения диагностики в настройке роли вручную**</span><span class="sxs-lookup"><span data-stu-id="390ac-135">**To manually add diagnostics connection string to Role configuration**</span></span>

1. <span data-ttu-id="390ac-136">Откройте проект облачной службы в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="390ac-136">Open the Cloud Service project in Visual Studio</span></span>
2. <span data-ttu-id="390ac-137">Дважды щелкните **Роли**, чтобы открыть конструктор роли, и выберите вкладку **Параметры**.</span><span class="sxs-lookup"><span data-stu-id="390ac-137">Double-click on the **Role** to open the Role designer and select the **Settings** tab</span></span>
3. <span data-ttu-id="390ac-138">Найдите параметр с именем **Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString**.</span><span class="sxs-lookup"><span data-stu-id="390ac-138">Look for a setting named **Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString**.</span></span> 
4. <span data-ttu-id="390ac-139">Если этот параметр отсутствует, щелкните **Добавить параметр**, чтобы добавить его в конфигурацию и изменить тип нового параметра для **ConnectionString**.</span><span class="sxs-lookup"><span data-stu-id="390ac-139">If this setting is not present, click on the **Add Setting** button to add it to the configuration and change the type for the new setting to **ConnectionString**</span></span>
5. <span data-ttu-id="390ac-140">Задайте значение для строки подключения, щелкнув **...** .</span><span class="sxs-lookup"><span data-stu-id="390ac-140">Set the value for connection string the by clicking on the **...** button.</span></span> <span data-ttu-id="390ac-141">Откроется диалоговое окно, позволяющее выбрать учетную запись хранилища.</span><span class="sxs-lookup"><span data-stu-id="390ac-141">This will open up a dialog allowing you to select a storage account.</span></span>
   
    ![Настройки Visual Studio](./media/cloud-services-how-to-monitor/CloudServices_Monitor_VisualStudioDiagnosticsConnectionString.png)

### <a name="to-change-the-monitoring-level-to-verbose-or-minimal"></a><span data-ttu-id="390ac-143">Изменение уровня мониторинга на подробный или минимальный</span><span class="sxs-lookup"><span data-stu-id="390ac-143">To change the monitoring level to verbose or minimal</span></span>
1. <span data-ttu-id="390ac-144">Войдите на [классический портал Azure](https://manage.windowsazure.com/)и откройте страницу **Настройка** для развертывания облачной службы.</span><span class="sxs-lookup"><span data-stu-id="390ac-144">In the [Azure classic portal](https://manage.windowsazure.com/), open the **Configure** page for the cloud service deployment.</span></span>
2. <span data-ttu-id="390ac-145">В поле **Уровень** выберите **Подробно** или **Минимальный**.</span><span class="sxs-lookup"><span data-stu-id="390ac-145">In **Level**, click **Verbose** or **Minimal**.</span></span> 
3. <span data-ttu-id="390ac-146">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="390ac-146">Click **Save**.</span></span>

<span data-ttu-id="390ac-147">После включения подробного мониторинга соответствующие данные появляются на классическом портале Azure в течение часа.</span><span class="sxs-lookup"><span data-stu-id="390ac-147">After you turn on verbose monitoring, you should start seeing the monitoring data in the Azure classic portal within the hour.</span></span>

<span data-ttu-id="390ac-148">Необработанные данные счетчиков производительности и сводные данные мониторинга размещаются в таблицах учетной записи хранения, определяемых идентификатором развертывания для ролей.</span><span class="sxs-lookup"><span data-stu-id="390ac-148">The raw performance counter data and aggregated monitoring data are stored in the storage account in tables qualified by the deployment ID for the roles.</span></span> 

## <a name="how-to-receive-alerts-for-cloud-service-metrics"></a><span data-ttu-id="390ac-149">Практическое руководство. Получение оповещений для метрик облачных служб</span><span class="sxs-lookup"><span data-stu-id="390ac-149">How to: Receive alerts for cloud service metrics</span></span>
<span data-ttu-id="390ac-150">Вы можете настроить получение оповещений на основе метрик мониторинга облачной службы.</span><span class="sxs-lookup"><span data-stu-id="390ac-150">You can receive alerts based on your cloud service monitoring metrics.</span></span> <span data-ttu-id="390ac-151">На странице **Службы управления** классического портала Azure можно создать правило, которое инициирует оповещение при достижении заданного значения выбранной метрики.</span><span class="sxs-lookup"><span data-stu-id="390ac-151">On the **Management Services** page of the Azure classic portal, you can create a rule to trigger an alert when the metric you choose reaches a value that you specify.</span></span> <span data-ttu-id="390ac-152">Кроме того, вы можете настроить отправку сообщения электронной почты с оповещением.</span><span class="sxs-lookup"><span data-stu-id="390ac-152">You can also choose to have email sent when the alert is triggered.</span></span> <span data-ttu-id="390ac-153">Дополнительные сведения см. в статье [Создание оповещений для служб Azure с помощью портала Azure](http://go.microsoft.com/fwlink/?LinkId=309356).</span><span class="sxs-lookup"><span data-stu-id="390ac-153">For more information, see [How to: Receive Alert Notifications and Manage Alert Rules in Azure](http://go.microsoft.com/fwlink/?LinkId=309356).</span></span>

## <a name="how-to-add-metrics-to-the-metrics-table"></a><span data-ttu-id="390ac-154">Практическое руководство. Добавление метрик в таблицу метрик</span><span class="sxs-lookup"><span data-stu-id="390ac-154">How to: Add metrics to the metrics table</span></span>
1. <span data-ttu-id="390ac-155">Войдите на [классический портал Azure](http://manage.windowsazure.com/)и откройте страницу **Мониторинг** для облачной службы.</span><span class="sxs-lookup"><span data-stu-id="390ac-155">In the [Azure classic portal](http://manage.windowsazure.com/), open the **Monitor** page for the cloud service.</span></span>
   
    <span data-ttu-id="390ac-156">По умолчанию в таблице отображается лишь часть доступных метрик.</span><span class="sxs-lookup"><span data-stu-id="390ac-156">By default, the metrics table displays a subset of the available metrics.</span></span> <span data-ttu-id="390ac-157">На этом рисунке показаны метрики подробного мониторинга, устанавливаемые по умолчанию для облачной службы. К ним относятся сводные данные сведения о свободной памяти и доступном хранилище (в мегабайтах) на уровне роли.</span><span class="sxs-lookup"><span data-stu-id="390ac-157">The illustration shows the default verbose metrics for a cloud service, which is limited to the Memory\Available MBytes performance counter, with data aggregated at the role level.</span></span> <span data-ttu-id="390ac-158">Чтобы выбрать дополнительные сводные метрики и метрики на уровне роли для мониторинга на классическом портале Azure, используйте команду **Добавить метрики**.</span><span class="sxs-lookup"><span data-stu-id="390ac-158">Use **Add Metrics** to select additional aggregate and role-level metrics to monitor in the Azure classic portal.</span></span>
   
    ![Подробные данные мониторинга](./media/cloud-services-how-to-monitor/CloudServices_DefaultVerboseDisplay.png)
2. <span data-ttu-id="390ac-160">Добавление метрик в таблицу метрик:</span><span class="sxs-lookup"><span data-stu-id="390ac-160">To add metrics to the metrics table:</span></span>
   
   1. <span data-ttu-id="390ac-161">Щелкните **Добавить метрики**. Откроется представленное ниже окно **Выберите метрики**.</span><span class="sxs-lookup"><span data-stu-id="390ac-161">Click **Add Metrics** to open **Choose Metrics**, shown below.</span></span>
      
       <span data-ttu-id="390ac-162">Первая доступная метрика будет представлена в развернутом виде со всеми доступными параметрами.</span><span class="sxs-lookup"><span data-stu-id="390ac-162">The first available metric is expanded to show options that are available.</span></span> <span data-ttu-id="390ac-163">Верхний параметр для каждой метрики позволяет отобразить сводные данные мониторинга по всем ролям.</span><span class="sxs-lookup"><span data-stu-id="390ac-163">For each metric, the top option displays aggregated monitoring data for all roles.</span></span> <span data-ttu-id="390ac-164">Также вы можете выбрать отдельные роли, для которых требуется отображать данные.</span><span class="sxs-lookup"><span data-stu-id="390ac-164">In addition, you can choose individual roles to display data for.</span></span>
      
       ![Добавить метрики](./media/cloud-services-how-to-monitor/CloudServices_AddMetrics.png)
   2. <span data-ttu-id="390ac-166">Выберите отображаемые метрики. Для этого выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="390ac-166">To select metrics to display</span></span>
      
      * <span data-ttu-id="390ac-167">Щелкните стрелку вниз рядом с метрикой, чтобы развернуть параметры мониторинга.</span><span class="sxs-lookup"><span data-stu-id="390ac-167">Click the down arrow by the metric to expand the monitoring options.</span></span>
      * <span data-ttu-id="390ac-168">Установите флажки рядом с параметрами, которые требуется отображать.</span><span class="sxs-lookup"><span data-stu-id="390ac-168">Select the check box for each monitoring option you want to display.</span></span>
        
        <span data-ttu-id="390ac-169">В таблице метрик может отображаться до 50 метрик.</span><span class="sxs-lookup"><span data-stu-id="390ac-169">You can display up to 50 metrics in the metrics table.</span></span>
        
        > [!TIP]
        > <span data-ttu-id="390ac-170">При подробном мониторинге в списке может отображаться несколько десятков метрик.</span><span class="sxs-lookup"><span data-stu-id="390ac-170">In verbose monitoring, the metrics list can contain dozens of metrics.</span></span> <span data-ttu-id="390ac-171">Чтобы отобразить полосу прокрутки, наведите указатель мыши на правый край диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="390ac-171">To display a scrollbar, hover over the right side of the dialog box.</span></span> <span data-ttu-id="390ac-172">Чтобы отфильтровать список, щелкните значок поиска и введите необходимый текст (см. ниже).</span><span class="sxs-lookup"><span data-stu-id="390ac-172">To filter the list, click the search icon, and enter text in the search box, as shown below.</span></span>
        > 
        > 
        
        ![Настройка поиска по метрикам](./media/cloud-services-how-to-monitor/CloudServices_AddMetrics_Search.png)
3. <span data-ttu-id="390ac-174">Выбрав все нужные метрики, нажмите кнопку «ОК» (флажок).</span><span class="sxs-lookup"><span data-stu-id="390ac-174">After you finish selecting metrics, click OK (checkmark).</span></span>
   
    <span data-ttu-id="390ac-175">Выбранные метрики добавляются в таблицу метрик (см. ниже).</span><span class="sxs-lookup"><span data-stu-id="390ac-175">The selected metrics are added to the metrics table, as shown below.</span></span>
   
    ![Метрики мониторинга](./media/cloud-services-how-to-monitor/CloudServices_Monitor_UpdatedMetrics.png)
4. <span data-ttu-id="390ac-177">Чтобы удалить метрику из таблицы, выберите ее и щелкните **Удалить метрики**.</span><span class="sxs-lookup"><span data-stu-id="390ac-177">To delete a metric from the metrics table, click the metric to select it, and then click **Delete Metric**.</span></span> <span data-ttu-id="390ac-178">(Команда **Удалить метрики** доступна только в том случае, если выбрана хотя бы одна метрика.)</span><span class="sxs-lookup"><span data-stu-id="390ac-178">(You only see **Delete Metric** when you have a metric selected.)</span></span>

### <a name="to-add-custom-metrics-to-the-metrics-table"></a><span data-ttu-id="390ac-179">Добавление пользовательских метрик в таблицу метрик</span><span class="sxs-lookup"><span data-stu-id="390ac-179">To add custom metrics to the metrics table</span></span>
<span data-ttu-id="390ac-180">Уровень мониторинга **Подробно** предоставляет список показателей по умолчанию, которые вы можете отслеживать на портале.</span><span class="sxs-lookup"><span data-stu-id="390ac-180">The **Verbose** monitoring level provides a list of default metrics that you can monitor on the portal.</span></span> <span data-ttu-id="390ac-181">Дополнительно вы можете отслеживать все пользовательские метрики или счетчики производительности, определяемые приложением через портал.</span><span class="sxs-lookup"><span data-stu-id="390ac-181">In addition to these you can monitor any custom metrics or performance counters defined by your application through the portal.</span></span>

<span data-ttu-id="390ac-182">Следующие действия предполагают, что включен уровень мониторинга **Подробно** и приложение настроено для сбора и передачи данных пользовательских счетчиков производительности.</span><span class="sxs-lookup"><span data-stu-id="390ac-182">The following steps assume that you have turned on **Verbose** monitoring level and have configured your application to collect and transfer custom performance counters.</span></span> 

<span data-ttu-id="390ac-183">Для отображения пользовательских счетчиков производительности на портале, необходимо обновить конфигурацию в wad-control-container:</span><span class="sxs-lookup"><span data-stu-id="390ac-183">To display the custom performance counters in the portal you need to update the configuration in wad-control-container:</span></span>

1. <span data-ttu-id="390ac-184">Откройте wad-control-container больших двоичных объектов в вашей учетной записи хранилища диагностики.</span><span class="sxs-lookup"><span data-stu-id="390ac-184">Open the wad-control-container blob in your diagnostics storage account.</span></span> <span data-ttu-id="390ac-185">Для этого можно использовать Visual Studio или любой другой обозреватель хранилищ.</span><span class="sxs-lookup"><span data-stu-id="390ac-185">You can use Visual Studio or any other storage explorer to do this.</span></span>
   
    ![Обозреватель серверов в Visual Studio.](./media/cloud-services-how-to-monitor/CloudServices_Monitor_VisualStudioBlobExplorer.png)
2. <span data-ttu-id="390ac-187">Введите путь к большим двоичным объектам, используя шаблон **DeploymentId/RoleName/RoleInstance** , чтобы найти настройки для вашего экземпляра роли.</span><span class="sxs-lookup"><span data-stu-id="390ac-187">Navigate the blob path using the pattern **DeploymentId/RoleName/RoleInstance** to find the configuration for your role instance.</span></span> 
   
    ![Обозреватель хранилищ Visual Studio](./media/cloud-services-how-to-monitor/CloudServices_Monitor_VisualStudioStorage.png)
3. <span data-ttu-id="390ac-189">Скачайте файл конфигурации для экземпляра роли и обновите его, чтобы задействовать все пользовательские счетчики производительности.</span><span class="sxs-lookup"><span data-stu-id="390ac-189">Download the configuration file for your role instance and update it to include any custom performance counters.</span></span> <span data-ttu-id="390ac-190">Например, для мониторинга *скорости записи на диск (байт/с)* для *диска C* добавьте в узел **PerformanceCounters\Subscriptions** следующий код:</span><span class="sxs-lookup"><span data-stu-id="390ac-190">For example to monitor *Disk Write Bytes/sec* for the *C drive* add the following under **PerformanceCounters\Subscriptions** node</span></span>
   
    ```xml
    <PerformanceCounterConfiguration>
    <CounterSpecifier>\LogicalDisk(C:)\Disk Write Bytes/sec</CounterSpecifier>
    <SampleRateInSeconds>180</SampleRateInSeconds>
    </PerformanceCounterConfiguration>
    ```
4. <span data-ttu-id="390ac-191">Сохраните изменения и отправьте файл конфигурации обратно в то же расположение, перезаписывая существующий файл в большом двоичном объекте.</span><span class="sxs-lookup"><span data-stu-id="390ac-191">Save the changes and upload the configuration file back to the same location overwriting the existing file in the blob.</span></span>
5. <span data-ttu-id="390ac-192">Переключитесь в режим подробного протоколирования в настройках классического портала Azure.</span><span class="sxs-lookup"><span data-stu-id="390ac-192">Toggle to Verbose mode in the Azure classic portal configuration.</span></span> <span data-ttu-id="390ac-193">Если вы уже были в режиме подробного протоколирования, вам необходимо переключиться на минимальный уровень и затем назад на подробный.</span><span class="sxs-lookup"><span data-stu-id="390ac-193">If you were in Verbose mode already you will have to toggle to minimal and back to verbose.</span></span>
6. <span data-ttu-id="390ac-194">Пользовательский счетчик производительности будет доступен в диалоговом окне **Добавить метрики** .</span><span class="sxs-lookup"><span data-stu-id="390ac-194">The custom performance counter will now be available in the **Add Metrics** dialog box.</span></span> 

## <a name="how-to-customize-the-metrics-chart"></a><span data-ttu-id="390ac-195">Практическое руководство. Настройка диаграммы метрик</span><span class="sxs-lookup"><span data-stu-id="390ac-195">How to: Customize the metrics chart</span></span>
1. <span data-ttu-id="390ac-196">В таблице метрик можно выбрать до 6 метрик, на основе которых будет построена диаграмма.</span><span class="sxs-lookup"><span data-stu-id="390ac-196">In the metrics table, select up to 6 metrics to plot on the metrics chart.</span></span> <span data-ttu-id="390ac-197">Чтобы выбрать метрику, установите флажок слева от нее.</span><span class="sxs-lookup"><span data-stu-id="390ac-197">To select a metric, click the check box on its left side.</span></span> <span data-ttu-id="390ac-198">Чтобы удалить метрику с диаграммы, снимите соответствующий флажок в таблице метрик.</span><span class="sxs-lookup"><span data-stu-id="390ac-198">To remove a metric from the metrics chart, clear its check box in the metrics table.</span></span>
   
    <span data-ttu-id="390ac-199">Метрики, выбранные в таблице, добавляются на диаграмму.</span><span class="sxs-lookup"><span data-stu-id="390ac-199">As you select metrics in the metrics table, the metrics are added to the metrics chart.</span></span> <span data-ttu-id="390ac-200">При ограниченном размере окна отображается раскрывающийся список **Еще n** , в котором представлены заголовки метрик, не умещающихся на экране.</span><span class="sxs-lookup"><span data-stu-id="390ac-200">On a narrow display, an **n more** drop-down list contains metric headers that won't fit the display.</span></span>
2. <span data-ttu-id="390ac-201">Для переключения между относительными (только итоговые значения) и абсолютными (значения по оси Y) значениями метрики щелкните «Относительные» или «Абсолютные» вверху диаграммы.</span><span class="sxs-lookup"><span data-stu-id="390ac-201">To switch between displaying relative values (final value only for each metric) and absolute values (Y axis displayed), select Relative or Absolute at the top of the chart.</span></span>
   
    ![Относительные или абсолютные](./media/cloud-services-how-to-monitor/CloudServices_Monitor_RelativeAbsolute.png)
3. <span data-ttu-id="390ac-203">Чтобы изменить временной диапазон для отображения метрик на диаграмме, щелкните «1 час», «24 часа» или «7 дней» вверху диаграммы.</span><span class="sxs-lookup"><span data-stu-id="390ac-203">To change the time range the metrics chart displays, select 1 hour, 24 hours, or 7 days at the top of the chart.</span></span>
   
    ![Период отображения данных мониторинга](./media/cloud-services-how-to-monitor/CloudServices_Monitor_DisplayPeriod.png)
   
    <span data-ttu-id="390ac-205">На диаграмме метрик в панели мониторинга применяется другой способ построения метрик.</span><span class="sxs-lookup"><span data-stu-id="390ac-205">On the dashboard metrics chart, the method for plotting metrics is different.</span></span> <span data-ttu-id="390ac-206">Вы можете использовать метрики из стандартного набора, а также добавлять и удалять метрики, выбирая их заголовки.</span><span class="sxs-lookup"><span data-stu-id="390ac-206">A standard set of metrics is available, and metrics are added or removed by selecting the metric header.</span></span>

### <a name="to-customize-the-metrics-chart-on-the-dashboard"></a><span data-ttu-id="390ac-207">Настройка диаграммы метрик на панели мониторинга</span><span class="sxs-lookup"><span data-stu-id="390ac-207">To customize the metrics chart on the dashboard</span></span>
1. <span data-ttu-id="390ac-208">Откройте панель мониторинга облачной службы.</span><span class="sxs-lookup"><span data-stu-id="390ac-208">Open the dashboard for the cloud service.</span></span>
2. <span data-ttu-id="390ac-209">Добавьте или удалите метрики для диаграммы:</span><span class="sxs-lookup"><span data-stu-id="390ac-209">Add or remove metrics from the chart:</span></span>
   
   * <span data-ttu-id="390ac-210">Чтобы построить новую метрику, установите соответствующий ей флажок в заголовках диаграммы.</span><span class="sxs-lookup"><span data-stu-id="390ac-210">To plot a new metric, select the check box for the metric in the chart headers.</span></span> <span data-ttu-id="390ac-211">При ограниченном размере окна щелкните стрелку вниз в раскрывающемся списке ***n*??metrics**, чтобы построить метрику, которая не отображается в области заголовка диаграммы.</span><span class="sxs-lookup"><span data-stu-id="390ac-211">On a narrow display, click the down arrow by ***n*??metrics** to plot a metric the chart header area can't display.</span></span>
   * <span data-ttu-id="390ac-212">Чтобы удалить построенную на диаграмме метрику, снимите флажок рядом с ее заголовком.</span><span class="sxs-lookup"><span data-stu-id="390ac-212">To delete a metric that is plotted on the chart, clear the check box by its header.</span></span>
   
3. <span data-ttu-id="390ac-213">Выберите режим отображения значений: **Относительные** или **Абсолютные**.</span><span class="sxs-lookup"><span data-stu-id="390ac-213">Switch between **Relative** and **Absolute** displays.</span></span>
4. <span data-ttu-id="390ac-214">Выберите период отображения данных: «1 час», «24 часа» или «7 дней».</span><span class="sxs-lookup"><span data-stu-id="390ac-214">Choose 1 hour, 24 hours, or 7 days of data to display.</span></span>

## <a name="how-to-access-verbose-monitoring-data-outside-the-azure-classic-portal"></a><span data-ttu-id="390ac-215">Практическое руководство. Доступ к данным подробного мониторинга вне классического портала Azure</span><span class="sxs-lookup"><span data-stu-id="390ac-215">How to: Access verbose monitoring data outside the Azure classic portal</span></span>
<span data-ttu-id="390ac-216">Подробные данные мониторинга размещаются в таблицах учетных записей хранения, определенных для каждой роли.</span><span class="sxs-lookup"><span data-stu-id="390ac-216">Verbose monitoring data is stored in tables in the storage accounts that you specify for each role.</span></span> <span data-ttu-id="390ac-217">В каждом развертывании облачной службы для роли создается шесть таблиц:</span><span class="sxs-lookup"><span data-stu-id="390ac-217">For each cloud service deployment, six tables are created for the role.</span></span> <span data-ttu-id="390ac-218">по две для каждого интервала (5 минут, 1 час и 12 часов).</span><span class="sxs-lookup"><span data-stu-id="390ac-218">Two tables are created for each (5 minutes, 1 hour, and 12 hours).</span></span> <span data-ttu-id="390ac-219">В одной из них хранятся сводные данные на уровне роли, а в другой — сводные данные для экземпляров роли.</span><span class="sxs-lookup"><span data-stu-id="390ac-219">One of these tables stores role-level aggregations; the other table stores aggregations for role instances.</span></span> 

<span data-ttu-id="390ac-220">Имена таблиц имеют следующий формат:</span><span class="sxs-lookup"><span data-stu-id="390ac-220">The table names have the following format:</span></span>

```
WAD*deploymentID*PT*aggregation_interval*[R|RI]Table
```

<span data-ttu-id="390ac-221">где:</span><span class="sxs-lookup"><span data-stu-id="390ac-221">where:</span></span>

* <span data-ttu-id="390ac-222">*deploymentID* — это GUID развертывания облачной службы;</span><span class="sxs-lookup"><span data-stu-id="390ac-222">*deploymentID* is the GUID assigned to the cloud service deployment</span></span>
* <span data-ttu-id="390ac-223">*aggregation_interval* = 5M (5 мин), 1H (1 ч) или 12H (12 ч);</span><span class="sxs-lookup"><span data-stu-id="390ac-223">*aggregation_interval* = 5M, 1H, or 12H</span></span>
* <span data-ttu-id="390ac-224">сводные данные на уровне роли = R;</span><span class="sxs-lookup"><span data-stu-id="390ac-224">role-level aggregations = R</span></span>
* <span data-ttu-id="390ac-225">сводные данные для экземпляров роли = RI.</span><span class="sxs-lookup"><span data-stu-id="390ac-225">aggregations for role instances = RI</span></span>

<span data-ttu-id="390ac-226">Например, в следующих таблицах размещаются сводные данные подробного мониторинга, собираемые с интервалом в 1 час:</span><span class="sxs-lookup"><span data-stu-id="390ac-226">For example, the following tables would store verbose monitoring data aggregated at 1-hour intervals:</span></span>

```
WAD8b7c4233802442b494d0cc9eb9d8dd9fPT1HRTable (hourly aggregations for the role)

WAD8b7c4233802442b494d0cc9eb9d8dd9fPT1HRITable (hourly aggregations for role instances)
```
