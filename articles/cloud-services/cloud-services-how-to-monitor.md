---
title: "Мониторинг облачной службы | Документация Майкрософт"
description: "Узнайте, как осуществлять мониторинг облачных служб с помощью классического портала Azure."
services: cloud-services
documentationcenter: 
author: thraka
manager: timlt
editor: 
ms.assetid: 5c48d2fb-b8ea-420f-80df-7aebe2b66b1b
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/07/2015
ms.author: adegeo
ms.openlocfilehash: c369b22cf068a473343b006eb1b06fdd350d31db
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="how-to-monitor-cloud-services"></a>Мониторинг облачных служб
[!INCLUDE [disclaimer](../../includes/disclaimer.md)]

Вы можете отслеживать метрики производительности `key` облачных служб на классическом портале Azure. Для каждой роли службы можно задать минимальный или подробный уровень, а также настроить отображение данных мониторинга. Подробные данные мониторинга размещаются в учетной записи хранения, которая доступна вне портала. 

Классический портал Azure предоставляет широкие возможности для настройки отображения данных мониторинга. Метрики для мониторинга можно выбрать в соответствующем списке на странице **Мониторинг**. Также можно указать метрики, которые будут строиться на диаграмме на странице **Мониторинг** или панели мониторинга. 

## <a name="concepts"></a>Основные понятия
По умолчанию в новой облачной службе настроен минимальный уровень мониторинга, основанный на данных счетчиков производительности из основной операционной системы для экземпляров роли (виртуальные машины). В этом режиме отслеживаются следующие метрики: «Процент ЦП», «Входящие данные», «Исходящие данные», «Скорость чтения с диска» и «Скорость записи на диск». Для просмотра дополнительных метрик на основе данных о производительности виртуальных машин (экземпляры роли) необходимо настроить подробный мониторинг. В этом режиме обеспечивается более тщательный анализ проблем, возникающих во время работы приложений.

По умолчанию выборка и передача данных счетчиков производительности из экземпляра роли осуществляется с интервалом в 3 минуты. Если включен подробный мониторинг, для каждого отдельного экземпляра роли и всех экземпляров каждой роли необработанные данные счетчиков собираются с интервалами 5 минут, 1 час и 12 часов. Сводные данные хранятся 10 дней, после чего удаляются.

После включения подробного мониторинга сводные данные размещаются в таблицах учетной записи хранения. Чтобы включить подробный мониторинг, необходимо настроить строку подключения диагностики для связи с учетной записью хранения. Для каждой роли можно использовать собственную учетную запись хранения.

При включенном подробном мониторинге возрастают затраты, связанные с хранением, передачей данных и выполнением транзакций хранилища. При минимальном уровне мониторинга учетная запись хранения не требуется. Данные метрик, доступных на этом уровне, не добавляются в учетную запись хранения, даже если включен подробный мониторинг.

## <a name="how-to-configure-monitoring-for-cloud-services"></a>Практическое руководство. Настройка мониторинга для облачных служб
Чтобы настроить минимальный или подробный уровень мониторинга на классическом портале Azure, выполните следующие действия. 

### <a name="before-you-begin"></a>Перед началом работы
* Создайте *классическую* учетную запись хранения, в которой будут размещаться данные мониторинга. Для каждой роли можно использовать собственную учетную запись хранения. Дополнительные сведения см. в статье [Создание учетной записи хранения](../storage/common/storage-create-storage-account.md#create-a-storage-account).
* Включите систему диагностики Azure для ролей облачной службы. См. в разделе [Настройки диагностики для облачных служб](cloud-services-dotnet-diagnostics.md).

Убедитесь, что строка подключения диагностики находится в имеющейся настройке роли. Вы не можете включить подробный уровень мониторинга, пока не включите систему диагностики Azure и строку подключения диагностики в настройке роли.   

> [!NOTE]
> Проекты, предназначенные для пакета SDK 2.5 Azure, не содержат по умолчанию строку подключения диагностики в шаблоне проекта. В эти проекты необходимо вручную добавить строку подключения диагностики в настройке роли.
> 
> 

**Чтобы добавить строку подключения диагностики в настройке роли вручную**

1. Откройте проект облачной службы в Visual Studio
2. Дважды щелкните **Роли**, чтобы открыть конструктор роли, и выберите вкладку **Параметры**.
3. Найдите параметр с именем **Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString**. 
4. Если этот параметр отсутствует, щелкните **Добавить параметр**, чтобы добавить его в конфигурацию и изменить тип нового параметра для **ConnectionString**.
5. Задайте значение для строки подключения, щелкнув **...** . Откроется диалоговое окно, позволяющее выбрать учетную запись хранилища.
   
    ![Настройки Visual Studio](./media/cloud-services-how-to-monitor/CloudServices_Monitor_VisualStudioDiagnosticsConnectionString.png)

### <a name="to-change-the-monitoring-level-to-verbose-or-minimal"></a>Изменение уровня мониторинга на подробный или минимальный
1. Войдите на [классический портал Azure](https://manage.windowsazure.com/)и откройте страницу **Настройка** для развертывания облачной службы.
2. В поле **Уровень** выберите **Подробно** или **Минимальный**. 
3. Щелкните **Сохранить**.

После включения подробного мониторинга соответствующие данные появляются на классическом портале Azure в течение часа.

Необработанные данные счетчиков производительности и сводные данные мониторинга размещаются в таблицах учетной записи хранения, определяемых идентификатором развертывания для ролей. 

## <a name="how-to-receive-alerts-for-cloud-service-metrics"></a>Практическое руководство. Получение оповещений для метрик облачных служб
Вы можете настроить получение оповещений на основе метрик мониторинга облачной службы. На странице **Службы управления** классического портала Azure можно создать правило, которое инициирует оповещение при достижении заданного значения выбранной метрики. Кроме того, вы можете настроить отправку сообщения электронной почты с оповещением. Дополнительные сведения см. в статье [Создание оповещений для служб Azure с помощью портала Azure](http://go.microsoft.com/fwlink/?LinkId=309356).

## <a name="how-to-add-metrics-to-the-metrics-table"></a>Практическое руководство. Добавление метрик в таблицу метрик
1. Войдите на [классический портал Azure](http://manage.windowsazure.com/)и откройте страницу **Мониторинг** для облачной службы.
   
    По умолчанию в таблице отображается лишь часть доступных метрик. На этом рисунке показаны метрики подробного мониторинга, устанавливаемые по умолчанию для облачной службы. К ним относятся сводные данные сведения о свободной памяти и доступном хранилище (в мегабайтах) на уровне роли. Чтобы выбрать дополнительные сводные метрики и метрики на уровне роли для мониторинга на классическом портале Azure, используйте команду **Добавить метрики**.
   
    ![Подробные данные мониторинга](./media/cloud-services-how-to-monitor/CloudServices_DefaultVerboseDisplay.png)
2. Добавление метрик в таблицу метрик:
   
   1. Щелкните **Добавить метрики**. Откроется представленное ниже окно **Выберите метрики**.
      
       Первая доступная метрика будет представлена в развернутом виде со всеми доступными параметрами. Верхний параметр для каждой метрики позволяет отобразить сводные данные мониторинга по всем ролям. Также вы можете выбрать отдельные роли, для которых требуется отображать данные.
      
       ![Добавить метрики](./media/cloud-services-how-to-monitor/CloudServices_AddMetrics.png)
   2. Выберите отображаемые метрики. Для этого выполните следующие действия.
      
      * Щелкните стрелку вниз рядом с метрикой, чтобы развернуть параметры мониторинга.
      * Установите флажки рядом с параметрами, которые требуется отображать.
        
        В таблице метрик может отображаться до 50 метрик.
        
        > [!TIP]
        > При подробном мониторинге в списке может отображаться несколько десятков метрик. Чтобы отобразить полосу прокрутки, наведите указатель мыши на правый край диалогового окна. Чтобы отфильтровать список, щелкните значок поиска и введите необходимый текст (см. ниже).
        > 
        > 
        
        ![Настройка поиска по метрикам](./media/cloud-services-how-to-monitor/CloudServices_AddMetrics_Search.png)
3. Выбрав все нужные метрики, нажмите кнопку «ОК» (флажок).
   
    Выбранные метрики добавляются в таблицу метрик (см. ниже).
   
    ![Метрики мониторинга](./media/cloud-services-how-to-monitor/CloudServices_Monitor_UpdatedMetrics.png)
4. Чтобы удалить метрику из таблицы, выберите ее и щелкните **Удалить метрики**. (Команда **Удалить метрики** доступна только в том случае, если выбрана хотя бы одна метрика.)

### <a name="to-add-custom-metrics-to-the-metrics-table"></a>Добавление пользовательских метрик в таблицу метрик
Уровень мониторинга **Подробно** предоставляет список показателей по умолчанию, которые вы можете отслеживать на портале. Дополнительно вы можете отслеживать все пользовательские метрики или счетчики производительности, определяемые приложением через портал.

Следующие действия предполагают, что включен уровень мониторинга **Подробно** и приложение настроено для сбора и передачи данных пользовательских счетчиков производительности. 

Для отображения пользовательских счетчиков производительности на портале, необходимо обновить конфигурацию в wad-control-container:

1. Откройте wad-control-container больших двоичных объектов в вашей учетной записи хранилища диагностики. Для этого можно использовать Visual Studio или любой другой обозреватель хранилищ.
   
    ![Обозреватель серверов в Visual Studio.](./media/cloud-services-how-to-monitor/CloudServices_Monitor_VisualStudioBlobExplorer.png)
2. Введите путь к большим двоичным объектам, используя шаблон **DeploymentId/RoleName/RoleInstance** , чтобы найти настройки для вашего экземпляра роли. 
   
    ![Обозреватель хранилищ Visual Studio](./media/cloud-services-how-to-monitor/CloudServices_Monitor_VisualStudioStorage.png)
3. Скачайте файл конфигурации для экземпляра роли и обновите его, чтобы задействовать все пользовательские счетчики производительности. Например, для мониторинга *скорости записи на диск (байт/с)* для *диска C* добавьте в узел **PerformanceCounters\Subscriptions** следующий код:
   
    ```xml
    <PerformanceCounterConfiguration>
    <CounterSpecifier>\LogicalDisk(C:)\Disk Write Bytes/sec</CounterSpecifier>
    <SampleRateInSeconds>180</SampleRateInSeconds>
    </PerformanceCounterConfiguration>
    ```
4. Сохраните изменения и отправьте файл конфигурации обратно в то же расположение, перезаписывая существующий файл в большом двоичном объекте.
5. Переключитесь в режим подробного протоколирования в настройках классического портала Azure. Если вы уже были в режиме подробного протоколирования, вам необходимо переключиться на минимальный уровень и затем назад на подробный.
6. Пользовательский счетчик производительности будет доступен в диалоговом окне **Добавить метрики** . 

## <a name="how-to-customize-the-metrics-chart"></a>Практическое руководство. Настройка диаграммы метрик
1. В таблице метрик можно выбрать до 6 метрик, на основе которых будет построена диаграмма. Чтобы выбрать метрику, установите флажок слева от нее. Чтобы удалить метрику с диаграммы, снимите соответствующий флажок в таблице метрик.
   
    Метрики, выбранные в таблице, добавляются на диаграмму. При ограниченном размере окна отображается раскрывающийся список **Еще n** , в котором представлены заголовки метрик, не умещающихся на экране.
2. Для переключения между относительными (только итоговые значения) и абсолютными (значения по оси Y) значениями метрики щелкните «Относительные» или «Абсолютные» вверху диаграммы.
   
    ![Относительные или абсолютные](./media/cloud-services-how-to-monitor/CloudServices_Monitor_RelativeAbsolute.png)
3. Чтобы изменить временной диапазон для отображения метрик на диаграмме, щелкните «1 час», «24 часа» или «7 дней» вверху диаграммы.
   
    ![Период отображения данных мониторинга](./media/cloud-services-how-to-monitor/CloudServices_Monitor_DisplayPeriod.png)
   
    На диаграмме метрик в панели мониторинга применяется другой способ построения метрик. Вы можете использовать метрики из стандартного набора, а также добавлять и удалять метрики, выбирая их заголовки.

### <a name="to-customize-the-metrics-chart-on-the-dashboard"></a>Настройка диаграммы метрик на панели мониторинга
1. Откройте панель мониторинга облачной службы.
2. Добавьте или удалите метрики для диаграммы:
   
   * Чтобы построить новую метрику, установите соответствующий ей флажок в заголовках диаграммы. При ограниченном размере окна щелкните стрелку вниз в раскрывающемся списке ***n*??metrics**, чтобы построить метрику, которая не отображается в области заголовка диаграммы.
   * Чтобы удалить построенную на диаграмме метрику, снимите флажок рядом с ее заголовком.
   
3. Выберите режим отображения значений: **Относительные** или **Абсолютные**.
4. Выберите период отображения данных: «1 час», «24 часа» или «7 дней».

## <a name="how-to-access-verbose-monitoring-data-outside-the-azure-classic-portal"></a>Практическое руководство. Доступ к данным подробного мониторинга вне классического портала Azure
Подробные данные мониторинга размещаются в таблицах учетных записей хранения, определенных для каждой роли. В каждом развертывании облачной службы для роли создается шесть таблиц: по две для каждого интервала (5 минут, 1 час и 12 часов). В одной из них хранятся сводные данные на уровне роли, а в другой — сводные данные для экземпляров роли. 

Имена таблиц имеют следующий формат:

```
WAD*deploymentID*PT*aggregation_interval*[R|RI]Table
```

где:

* *deploymentID* — это GUID развертывания облачной службы;
* *aggregation_interval* = 5M (5 мин), 1H (1 ч) или 12H (12 ч);
* сводные данные на уровне роли = R;
* сводные данные для экземпляров роли = RI.

Например, в следующих таблицах размещаются сводные данные подробного мониторинга, собираемые с интервалом в 1 час:

```
WAD8b7c4233802442b494d0cc9eb9d8dd9fPT1HRTable (hourly aggregations for the role)

WAD8b7c4233802442b494d0cc9eb9d8dd9fPT1HRITable (hourly aggregations for role instances)
```
