---
title: "Настройка гибридного кластера пакета HPC в Azure | Документация Майкрософт"
description: "Узнайте, как использовать пакет Microsoft HPC и Azure для настройки небольшого гибридного кластера высокопроизводительных вычислений (HPC)"
services: cloud-services
documentationcenter: 
author: dlepow
manager: timlt
editor: 
tags: hpc-pack
ms.assetid: 
ms.service: cloud-services
ms.workload: big-compute
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/22/2017
ms.author: danlep
ms.openlocfilehash: ad5c13723eef352148a40e3e7f4f2ff616867296
ms.sourcegitcommit: 3df3fcec9ac9e56a3f5282f6c65e5a9bc1b5ba22
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2017
---
# <a name="set-up-a-hybrid-high-performance-computing-hpc-cluster-with-microsoft-hpc-pack-and-on-demand-azure-compute-nodes"></a>Настройка гибридного кластера высокопроизводительных вычислительных систем (HPC) с помощью пакета Microsoft HPC и вычислительных узлов Azure по требованию
Используйте пакет Microsoft HPC Pack 2012 R2 и Azure для настройки небольшого гибридного кластера высокопроизводительных вычислительных систем (HPC). Приведенный в этой статье кластер состоит из локального головного узла пакета HPC и нескольких вычислительных узлов, развертываемых по требованию в облачной службе Azure. Затем вы сможете выполнять вычислительные задания в гибридном кластере.

![Гибридный кластер высокопроизводительных вычислений (HPC)][Overview] 

В этом руководстве демонстрируется один из способов использования масштабируемых ресурсов в Azure, доступных по требованию, для запуска ресурсоемких приложений, который также называют "ускорением в облако".

В этом учебнике предполагается, что у читателя нет опыта работы с вычислительными кластерами или пакетом HPC. Оно предназначено только для того, чтобы помочь вам быстро развернуть кластер вычислений для демонстрационных целей. Рекомендации и инструкции по развертыванию гибридного кластера с пакетом HPC большего масштаба в рабочей среде и использованию пакета HPC 2016 см. в [подробном руководстве](http://go.microsoft.com/fwlink/p/?LinkID=200493). Другие сценарии использования пакета HPC, включая автоматизированное развертывание кластера в виртуальных машинах Azure, см. в статье [Варианты создания в Azure кластера HPC под управлением Windows и управления им с помощью пакета HPC](../virtual-machines/windows/hpcpack-cluster-options.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

## <a name="prerequisites"></a>Предварительные требования
* **Подписка Azure.** Если ее нет, можно за пару минут создать [бесплатную учетную запись](https://azure.microsoft.com/free/).
* **Локальный компьютер под управлением Windows Server 2012 R2 или Windows Server 2012.** Используйте этот компьютер как головной узел кластера HPC. Если вы еще не установили Windows Server, вы можете скачать и установить [ознакомительную версию](https://www.microsoft.com/evalcenter/evaluate-windows-server-2012-r2).
  
  * Компьютер должен быть присоединен к домену Active Directory. Для тестирования можно настроить компьютер головного узла в качестве контроллера домена. Чтобы добавить роль сервера доменных служб Active Directory и повысить уровень головного узла до контроллера домена, ознакомьтесь с документацией по Windows Server.
  * Для поддержки пакета HPC необходимо установить операционную систему на одном из следующих языков: английский, японский или китайский (упрощенное письмо).
  * Убедитесь, что установлены важные и критические обновления.
* **Пакет HPC 2012 R2** - Бесплатно [скачайте](http://go.microsoft.com/fwlink/p/?linkid=328024) установочный пакет последней версии и скопируйте файлы на компьютер головного узла. Выберите установочные файлы на языке установленной системы Windows Server.

    >[!NOTE]
    > Если вы хотите использовать пакет HPC 2016 вместо пакета HPC 2012 R2, потребуется дополнительная настройка, о которой можно узнать из [подробного руководства](http://go.microsoft.com/fwlink/p/?LinkID=200493).
    > 
* **Учетная запись домена.** Для установки пакета HPC эта учетная запись должна быть настроена с разрешениями локального администратора на головном узле.
* **Подключение по протоколу TCP через порт 443** от головного узла к Azure.

## <a name="install-hpc-pack-on-the-head-node"></a>Установка пакета HPC на головном узле
Сначала установите пакет Microsoft HPC на локальном компьютере под управлением Windows Server, который будет головным узлом кластера.

1. Войдите на головной узел с помощью доменной учетной записи с правами локального администратора.

2. Откройте мастер установки пакета HPC, запустив файл Setup.exe из пакета HPC.

3. На экране **Установка пакета HPC 2012 R2** щелкните **Новая изолированная установка или добавление новых компонентов к существующему экземпляру**.

    ![Установка пакета HPC 2012][install_hpc1]

4. На **странице пользовательского соглашения по программному обеспечению Microsoft** нажмите кнопку **Далее**.

5. На странице **Выбор типа установки** выберите вариант **Создание кластера HPC с головным узлом** и нажмите кнопку **Далее**.

6. Мастер выполняет несколько тестов перед установкой. Нажмите кнопку **Далее** on the **Правила установки** , если все тесты пройдены. В противном случае ознакомьтесь с предоставленной информацией и внесите необходимые изменения в вашей среде. Затем повторите тесты или, при необходимости, запустите мастер установки еще раз.
7. На странице **Настройки базы данных HPC** убедитесь, что выбран **Головной узел** для всех баз данных HPC, а затем нажмите кнопку **Далее**. 

    ![Конфигурация базы данных][install_hpc4]

8. Примите параметры по умолчанию на оставшихся страницах мастера. На странице **Установка обязательных компонентов** нажмите кнопку **Установить**.
   
    ![Install][install_hpc6]

9. После завершения установки снимите флажок **Запустить диспетчер кластеров HPC** и нажмите кнопку **Готово**. (Вы запустите диспетчер кластеров HPC позднее.)
   
    ![Готово][install_hpc7]

## <a name="prepare-the-azure-subscription"></a>Подготовка подписки Azure
Выполните указанные ниже действия на [портале Azure](https://portal.azure.com) с подпиской Azure. После этого вы можете развернуть узлы Azure из локального головного узла. 
  
  > [!NOTE]
  > Также запишите идентификатор подписки Azure, который понадобится позже. Его можно найти на портале в разделе **Подписки**.
  > 

### <a name="upload-the-default-management-certificate"></a>Загрузка сертификата управления по умолчанию
Пакет HPC устанавливает самозаверяющий сертификат на головном узле с именем "Сертификат управления Microsoft HPC Azure по умолчанию", который можно загрузить как сертификат управления Azure. Этот сертификат предназначен для тестирования и экспериментальных развертываний для защиты соединений между головным узлом и Azure.

1. На компьютере головного узла войдите на [портал Azure](https://portal.azure.com).

2. Выберите **Подписки** > *имя_вашей_подписки*.

3. Выберите **Сертификаты управления** > **Отправить**.

4. На головном узле перейдите к файлу C:\Program Files\Microsoft HPC Pack 2012\Bin\hpccert.cer. Затем выберите **Отправить**.

   
В списке сертификатов управления вы увидите **сертификат управления Azure HPC по умолчанию**.

### <a name="create-an-azure-cloud-service"></a>Создание облачной службы Azure
> [!NOTE]
> Для лучшей производительности рекомендуется создавать облачные службы и учетную запись хранения (позднее) в одном географическом регионе.
> 
> 

1. На портале щелкните **Облачные службы (классические)** > **+Добавить**.

2.  Введите DNS-имя службы, выберите группу ресурсов и расположение, а затем щелкните **Создать**.


### <a name="create-an-azure-storage-account"></a>Создание учетной записи хранения Azure
1. На портале щелкните **Учетные записи хранения (классика)** > **+Добавить**.

2. Введите имя учетной записи и выберите **классическую** модель развертывания.

3. Выберите группу ресурсов и расположение. Для остальных параметров оставьте значения по умолчанию. Затем щелкните **Создать**.

## <a name="configure-the-head-node"></a>Настройка головного узла
Чтобы развернуть узлы Azure с помощью диспетчера кластеров HPC и отправлять задания, необходимо выполните некоторые действия для настройки кластера.

1. На головном узле запустите диспетчер кластеров HPC. Если откроется диалоговое окно **Выбор головного узла**, щелкните **Локальный компьютер**. Появится **список дел развертывания** .

2. В разделе **Необходимые задачи развертывания** щелкните **Настроить сеть**.
   
    ![Настройка сети][config_hpc2]

3. В мастере настройки сети выберите параметр **Все узлы только в корпоративной сети** (топология 5). Это самая простая конфигурация сети для демонстрации.
   
    ![Топология 5][config_hpc3]
   
4. Нажмите кнопку **Далее** , чтобы принять значения по умолчанию на оставшихся страницах мастера. Затем на вкладке **Просмотр** щелкните **Настройка** для завершения настройки сети.

5. В **список дел развертывания**щелкните **Ввести учетные данные установки**.

6. В диалоговом окне **Учетные данные установки** введите учетные данные доменной учетной записи, которая использовалась для установки пакета HPC. Нажмите кнопку **ОК**. 
   
    ![Учетные данные установки][config_hpc6]
   
7. В **список дел развертывания**щелкните **Настроить именование новых узлов**.

8. В диалоговом окне **Указать серию именования узлов** примите значения по умолчанию и нажмите кнопку **ОК**. Выполните это действие, даже если имена добавленных в этом руководстве узлов Azure задаются автоматически.
   
    ![Именование узлов][config_hpc8]
   
9. В **список дел развертывания**щелкните **Создать шаблон узла**. Далее в этом руководстве для добавления узлов Azure в кластер будет использоваться шаблон узла.

10. В окне мастера создания узла шаблона выполните следующие действия.
    
    а. На странице **выбора типа шаблона узла** щелкните **Windows Azure node template** (Шаблон узла Windows Azure), а затем нажмите кнопку **Далее**.
    
    ![Шаблон узла][config_hpc10]
    
    b. Щелкните **Далее** , чтобы использовать имя шаблона по умолчанию.
    
    c. На странице **Provide Subscription Information** (Укажите сведения о подписке) введите свой идентификатор подписки Azure (он доступен в сведениях об учетной записи Azure). Затем в разделе **Сертификат управления** найдите **сертификат управления Microsoft HPC Azure по умолчанию.** Нажмите кнопку **Далее**.
    
    ![Шаблон узла][config_hpc12]
    
    d. На странице **Укажите сведения о службе** выберите облачную службу и учетную запись хранения, созданные на предыдущем шаге. Нажмите кнопку **Далее**.
    
    ![Шаблон узла][config_hpc13]
    
    д. Нажмите кнопку **Далее** , чтобы принять значения по умолчанию на оставшихся страницах мастера. Затем на вкладке **Просмотр** нажмите кнопку **Создать**, чтобы создать шаблон узла.
    
    > [!NOTE]
    > По умолчанию шаблон узла Azure содержит параметры для запуска (подготовки) и остановки узлов вручную с помощью диспетчера кластеров HPC. При желании можно настроить расписание для автоматического запуска и остановки узлов Azure.
    > 
    > 

## <a name="add-azure-nodes-to-the-cluster"></a>Добавление узлов Azure в кластер
Теперь этот шаблон будет использоваться для добавления узлов Azure в кластер. При добавлении узлов в кластер сведения об их конфигурации сохраняются, что позволяет запускать (подготавливать) их в любое время в облачной службе. Плата за узлы Azure взимается с вашей подписки только после запуска экземпляров в облачной службе.

Выполните следующие действия для добавления двух мелких узлов.

1. В диспетчере кластеров HPC выберите **Node Management** (Управление узлами) (в текущей версии пакета HPC **Управление ресурсами**) > **Добавить узел**.
   
    ![Добавить узел][add_node1]

2. В окне мастера добавления узла на странице **Select Deployment Method** (Выбор метода развертывания) установите переключатель **Add Windows Azure nodes** (Добавить узлы Windows Azure), а затем **Далее**.
   
    ![Добавление узла Azure][add_node1_1]

3. На странице **Укажите новые узлы** выберите созданный ранее шаблон узла Azure (который по умолчанию называется **шаблоном узла Azure по умолчанию**). Затем укажите **2** **мелких** узла и нажмите кнопку **Далее**.
   
    ![Указание узлов][add_node2]
   
4. На **последней странице мастера добавления узла** нажмите кнопку **Готово**.
    
     Два узла Azure с именем **AzureCN-0001** и **AzureCN-0002** появятся в диспетчере кластеров HPC. Они находятся в состоянии **Не развернуто** .
   
    ![Добавленные узлы][add_node3]

## <a name="start-the-azure-nodes"></a>Запуск узлов Azure
При необходимости использовать ресурсы кластера в Azure используйте диспетчер кластеров HPC, чтобы запустить (подготовить) узлы Azure и перевести их в оперативный режим.

1. В диспетчере кластеров HPC выберите **Node Management** (Управление узлами) (в текущей версии пакета HPC **Управление ресурсами**) и выберите узлы Azure.

2. Выберите **Запустить**, а затем нажмите кнопку **ОК**.
   
   ![Запуск узлов][add_node4]
   
    Узлы перейдут в состояние **подготовки** . Для отслеживания хода подготовки можно просматривать журнал подготовки.
   
    ![Подготовка узлов][add_node6]

3. Через несколько минут подготовка узлов Azure завершится, и они перейдут в **автономное** состояние. В этом состоянии экземпляры ролей выполняются, но еще не принимают задания кластера.

4. Чтобы убедиться, что экземпляры ролей выполняются, на портале Azure щелкните **Облачные службы (классические)** > *имя_вашей_облачной_службы*.
   
   Должны отобразиться два экземпляра (узла) **HpcWorkerRole**, запущенные в службе. Пакет HPC также автоматически развертывает два экземпляра **HpcProxy** (среднего размера) для обработки взаимодействия между головным узлом и Azure.

   ![Выполняющиеся экземпляры][view_instances1]

5. Чтобы перевести узлы Azure в оперативный режим для выполнения заданий кластера, выберите узлы, щелкните правой кнопкой мыши и выберите команду **Перевести в оперативный режим**.
   
    ![Автономные узлы][add_node7]
   
    Диспетчер кластеров HPC покажет, что узлы находятся в **оперативном** состоянии.

## <a name="run-a-command-across-the-cluster"></a>Выполнение команды в кластере
Чтобы проверить установку, воспользуйтесь командой **clusrun** пакета HPC для выполнения команды или запуска приложения в одном или нескольких узлах кластера. В качестве простого примера выполните команду **clusrun** , чтобы получить конфигурацию IP-адресов узлов Azure.

1. На головном узле запустите командную строку от имени администратора.

2. Введите следующую команду:
   
    `clusrun /nodes:azurecn* ipconfig`

3. При появлении запроса введите пароль администратора кластера. Должен отобразиться похожий результат выполнения команды:
   
    ![clusrun][clusrun1]

## <a name="run-a-test-job"></a>Выполнение тестового задания
Теперь отправьте тестовое задание, которое выполняется на гибридном кластере. Этот пример является простым заданием параметрического анализа (тип классических параллельных вычислений). В этом примере выполняются подзадачи, добавляющие целое число с помощью команды **set /a** . Все узлы в кластере участвуют в выполнения подзадач для целых чисел от 1 до 100.

1. В диспетчере кластеров HPC выберите **Управление заданиями** > **New Parametric Sweep Job** (Создать задание параметрического анализа).
   
    ![Новое задание][test_job1]

2. В диалоговом окне **Создание задания параметрического анализа** в **командной строке** введите `set /a *+*` (замените командную строку, которая отображается по умолчанию). Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **Отправить** , чтобы отправить задание.
   
    ![Параметрический анализ][param_sweep1]

3. После завершения задания дважды нажмите задание **Моя задача анализа** .

4. Нажмите кнопку **Просмотреть задачи**, затем нажмите подзадачу, чтобы просмотреть результаты ее выполнения.
   
    ![Результаты выполнения задачи][view_job361]

5. Для просмотра узла, который выполняет расчет для этой подзадачи, нажмите **Выделенные узлы**. (Кластер может показывать другое имя узла).
   
    ![Результаты выполнения задачи][view_job362]

## <a name="stop-the-azure-nodes"></a>Остановка узлов Azure
После тестирования кластера остановите узлы Azure, чтобы избежать ненужных расходов для вашей учетной записи. При этом облачная служба будет остановлена, а экземпляры ролей Azure будут удалены.

1. В диспетчере кластеров HPC в разделе **Node Management** (Управление узлами) (в предыдущих версиях пакета HPC он называется **Управление ресурсами**) выберите оба узла Azure. Затем щелкните **Остановить**.
   
    ![Остановка узлов][stop_node1]

2. В диалоговом окне **Stop Windows Azure nodes** (Остановка узлов Windows Azure) нажмите кнопку **Stop** (Остановить). 
   
3. Узлы перейдут в состояние **Остановка** . Через несколько минут диспетчер кластеров HPC покажет, что узлы находятся в состоянии **Не развернуто**.
   
    ![Неразвернутые узлы][stop_node4]

4. Чтобы убедиться, что экземпляры ролей больше не выполняются в Azure, на портале Azure щелкните **Облачные службы (классические)** > *имя_вашей_облачной_службы*. В рабочей среде будут отсутствовать развернутые экземпляры. 
   
    На этом учебник завершен.

## <a name="next-steps"></a>Дальнейшие действия
* Изучите документацию по [пакету HPC](https://technet.microsoft.com/library/cc514029).
* Сведения о настройке гибридного развертывания кластера пакета HPC в большом масштабе см. в статье [Ускорение в экземпляры рабочих ролей Azure с помощью пакета Microsoft HPC](http://go.microsoft.com/fwlink/p/?LinkID=200493).
* Другие способы создания кластера пакета HPC в Azure, включая использование шаблонов Azure Resource Manager, см. в статье [Варианты создания в Azure кластера HPC под управлением Windows и управления им с помощью пакета HPC](../virtual-machines/windows/hpcpack-cluster-options.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).


[Overview]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/hybrid_cluster_overview.png
[install_hpc1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc1.png
[install_hpc4]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc4.png
[install_hpc6]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc6.png
[install_hpc7]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc7.png
[install_hpc10]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc10.png
[config_hpc2]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc2.png
[config_hpc3]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc3.png
[config_hpc6]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc6.png
[config_hpc8]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc8.png
[config_hpc10]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc10.png
[config_hpc12]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc12.png
[config_hpc13]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc13.png
[add_node1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node1.png
[add_node1_1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node1_1.png
[add_node2]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node2.png
[add_node3]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node3.png
[add_node4]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node4.png
[add_node6]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node6.png
[add_node7]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node7.png
[view_instances1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/view_instances1.png
[clusrun1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/clusrun1.png
[test_job1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/test_job1.png
[param_sweep1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/param_sweep1.png
[view_job361]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/view_job361.png
[view_job362]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/view_job362.png
[stop_node1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/stop_node1.png
[stop_node4]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/stop_node4.png
[view_instances2]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/view_instances2.png
