---
title: "Облачные службы с помощью Application Insights aaaTroubleshoot | Документы Microsoft"
description: "Узнайте, как проблемы tootroubleshoot облачной службы с помощью Application Insights tooprocess данных из системы диагностики Azure."
services: cloud-services
documentationcenter: .net
author: sbtron
manager: timlt
editor: tysonn
ms.assetid: e93f387b-ef29-4731-ae41-0676722accb6
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/23/2017
ms.author: saurabh
ms.openlocfilehash: 972924d9e6d1fe33d5c19b006d482de52ffb0ef7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-cloud-services-using-application-insights"></a><span data-ttu-id="5562d-103">Устранение неполадок облачных служб с помощью Application Insights</span><span class="sxs-lookup"><span data-stu-id="5562d-103">Troubleshoot Cloud Services using Application Insights</span></span>
<span data-ttu-id="5562d-104">С [Azure SDK 2.8](https://azure.microsoft.com/downloads/) и расширения службы диагностики Azure 1.5, можно отправить данные системы диагностики Azure для облачной службы напрямую tooApplication аналитики.</span><span class="sxs-lookup"><span data-stu-id="5562d-104">With [Azure SDK 2.8](https://azure.microsoft.com/downloads/) and Azure diagnostics extension 1.5, you can send Azure Diagnostics data for your Cloud Service directly tooApplication Insights.</span></span> <span data-ttu-id="5562d-105">Здравствуйте, журналы, собранные системой диагностики Azure&mdash;включая журналы приложений, журналы событий Windows, журналы трассировки событий Windows и счетчики производительности&mdash;могут отправляться tooApplication аналитики.</span><span class="sxs-lookup"><span data-stu-id="5562d-105">hello logs collected by Azure Diagnostics&mdash;including application logs, Windows Event Logs, ETW Logs, and performance counters&mdash;can be sent tooApplication Insights.</span></span> <span data-ttu-id="5562d-106">Затем можно отобразить эту информацию в пользовательском Интерфейсе портала Application Insights hello.</span><span class="sxs-lookup"><span data-stu-id="5562d-106">You can then visualize this information in hello Application Insights portal UI.</span></span> <span data-ttu-id="5562d-107">Затем можно использовать hello пакет SDK Application Insights tooget анализировать метрики и журналов, полученные из приложения, а также hello системы и данных на уровне инфраструктуры, поступающие из системы диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="5562d-107">You can then use hello Application Insights SDK tooget insights into metrics and logs that come from your application, as well as hello system and infrastructure-level data that comes from Azure Diagnostics.</span></span>

## <a name="configure-azure-diagnostics-toosend-data-tooapplication-insights"></a><span data-ttu-id="5562d-108">Настройка системы диагностики Azure toosend данных tooApplication аналитики</span><span class="sxs-lookup"><span data-stu-id="5562d-108">Configure Azure Diagnostics toosend data tooApplication Insights</span></span>
<span data-ttu-id="5562d-109">Выполните эти шаги tooset копирование вашей облачной службы проекта toosend диагностики Azure данные tooApplication аналитики.</span><span class="sxs-lookup"><span data-stu-id="5562d-109">Follow these steps tooset up your cloud service project toosend Azure Diagnostics data tooApplication Insights.</span></span>

1. <span data-ttu-id="5562d-110">В обозревателе решений Visual Studio, щелкните правой кнопкой мыши роль и выберите **свойства** конструктор ролей tooopen hello.</span><span class="sxs-lookup"><span data-stu-id="5562d-110">In Visual Studio Solution Explorer, right-click a role and select **Properties** tooopen hello Role designer.</span></span>

    ![Свойства роли обозревателя решений][1]

2. <span data-ttu-id="5562d-112">В hello **диагностики** раздел конструктора ролей hello, выберите hello **отправка данных диагностики tooApplication аналитики** параметр.</span><span class="sxs-lookup"><span data-stu-id="5562d-112">In hello **Diagnostics** section of hello Role designer, select hello **Send diagnostics data tooApplication Insights** option.</span></span>

    ![Конструктор ролей отправке диагностических данных tooapplication аналитики][2]

3. <span data-ttu-id="5562d-114">В hello диалоговым окном, которое появляется выберите ресурс Application Insights hello, вы хотите toosend hello диагностики Azure данные.</span><span class="sxs-lookup"><span data-stu-id="5562d-114">In hello dialog box that pops up, select hello Application Insights resource that you want toosend hello Azure diagnostics data to.</span></span> <span data-ttu-id="5562d-115">диалоговое окно «Hello» позволяет tooselect существующий ресурс Application Insights из подписки или toomanually укажите ключ инструментирования для ресурса Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5562d-115">hello dialog box allows you tooselect an existing Application Insights resource from your subscription or toomanually specify an instrumentation key for an Application Insights resource.</span></span> <span data-ttu-id="5562d-116">Дополнительные сведения о создании ресурса Application Insights см. в статье [Создание ресурса Application Insights](../application-insights/app-insights-create-new-resource.md).</span><span class="sxs-lookup"><span data-stu-id="5562d-116">For more information on creating an Application Insights resource, see [Create a new Application Insights resource](../application-insights/app-insights-create-new-resource.md).</span></span>

    ![выберите ресурс application insights][3]

    <span data-ttu-id="5562d-118">После добавления ресурса Application Insights hello hello ключ инструментирования этого ресурса сохраняется как параметры конфигурации службы с именем hello **APPINSIGHTS_INSTRUMENTATIONKEY**.</span><span class="sxs-lookup"><span data-stu-id="5562d-118">Once you have added hello Application Insights resource, hello instrumentation key for that resource is stored as a service configuration setting with hello name **APPINSIGHTS_INSTRUMENTATIONKEY**.</span></span> <span data-ttu-id="5562d-119">Этот параметр конфигурации можно изменить для каждой конфигурации службы или окружения.</span><span class="sxs-lookup"><span data-stu-id="5562d-119">You can change this configuration setting for each service configuration or environment.</span></span> <span data-ttu-id="5562d-120">toodo таким образом, выберите другую конфигурацию из hello **конфигурации службы** списка и укажите новый ключ инструментирования для этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5562d-120">toodo so, select a different configuration from hello **Service Configuration** list and specify a new instrumentation key for that configuration.</span></span>

    ![выберите конфигурацию службы][4]

    <span data-ttu-id="5562d-122">Hello **APPINSIGHTS_INSTRUMENTATIONKEY** параметр конфигурации используется для расширения Visual Studio tooconfigure hello диагностики соответствующие сведения ресурсов Application Insights hello во время публикации.</span><span class="sxs-lookup"><span data-stu-id="5562d-122">hello **APPINSIGHTS_INSTRUMENTATIONKEY** configuration setting is used by Visual Studio tooconfigure hello diagnostics extension with hello appropriate Application Insights resource information during publishing.</span></span> <span data-ttu-id="5562d-123">параметр конфигурации Hello является удобным способом определения различных инструментария ключей для различных конфигураций службы.</span><span class="sxs-lookup"><span data-stu-id="5562d-123">hello configuration setting is a convenient way of defining different instrumentation keys for different service configurations.</span></span> <span data-ttu-id="5562d-124">Visual Studio преобразует эту настройку и вставить его в общедоступной конфигурации hello диагностики расширения во время hello процесса публикации.</span><span class="sxs-lookup"><span data-stu-id="5562d-124">Visual Studio will translate that setting and insert it into hello diagnostics extension public configuration during hello publish process.</span></span> <span data-ttu-id="5562d-125">toosimplify hello процесс настройки расширения системы диагностики hello с помощью PowerShell, hello выходные данные пакета Visual Studio также содержит hello открытый XML-ФАЙЛ конфигурации с hello соответствующий ключ инструментирования Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5562d-125">toosimplify hello process of configuring hello diagnostics extension with PowerShell, hello package output from Visual Studio also contains hello public configuration XML with hello appropriate Application Insights instrumentation key.</span></span> <span data-ttu-id="5562d-126">файлы общедоступной конфигурации Hello создаются в папку Extensions hello и следовать шаблону hello *PaaSDiagnostics.&lt; RoleName&gt;. PubConfig.xml*.</span><span class="sxs-lookup"><span data-stu-id="5562d-126">hello public config files are created in hello Extensions folder and follow hello pattern *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span></span> <span data-ttu-id="5562d-127">Все развертывания на основе PowerShell можно использовать этот шаблон toomap каждой роли tooa конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5562d-127">Any PowerShell-based deployments can use this pattern toomap each configuration tooa role.</span></span>

4) <span data-ttu-id="5562d-128">toosend tooconfigure диагностики Azure, все счетчики производительности и журналы уровня ошибок собранные tooApplication агент Azure diagnostics hello аналитики, включите hello **отправка данных диагностики tooApplication аналитики** параметр.</span><span class="sxs-lookup"><span data-stu-id="5562d-128">tooconfigure Azure diagnostics toosend all performance counters and error-level logs collected by hello Azure diagnostics agent tooApplication Insights, enable hello **Send diagnostics data tooApplication Insights** option.</span></span> 

    <span data-ttu-id="5562d-129">Если требуется, чтобы toofurther настроить, какие данные будут отправлены tooApplication аналитики, необходимо вручную изменить hello *diagnostics.wadcfgx* файл для каждой роли.</span><span class="sxs-lookup"><span data-stu-id="5562d-129">If you want toofurther configure what data is sent tooApplication Insights, you must manually edit hello *diagnostics.wadcfgx* file for each role.</span></span> <span data-ttu-id="5562d-130">В разделе [tooApplication данных аналитики для настройки диагностики Azure toosend](#configure-azure-diagnostics-to-send-data-to-application-insights) toolearn Дополнительные сведения о конфигурации hello, обновление вручную.</span><span class="sxs-lookup"><span data-stu-id="5562d-130">See [Configure Azure Diagnostics toosend data tooApplication Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) toolearn more about manually updating hello configuration.</span></span>

<span data-ttu-id="5562d-131">При анализу tooapplication данных диагностики Azure настроенных toosend hello облачной службы можно развернуть его tooAzure как правило, убедившись, что включен hello расширения службы диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="5562d-131">When hello cloud service is configured toosend Azure diagnostics data tooapplication insights, you can deploy it tooAzure normally, making sure hello Azure diagnostics extension is enabled.</span></span> <span data-ttu-id="5562d-132">Дополнительные сведения см. в статье [Публикация облачной службы с помощью Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span><span class="sxs-lookup"><span data-stu-id="5562d-132">For more information, see  [Publishing a Cloud Service using Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span></span>  

## <a name="viewing-azure-diagnostics-data-in-application-insights"></a><span data-ttu-id="5562d-133">Просмотр данных диагностики Azure в Application Insights</span><span class="sxs-lookup"><span data-stu-id="5562d-133">Viewing Azure diagnostics data in Application Insights</span></span>
<span data-ttu-id="5562d-134">Hello Azure телеметрии диагностики отображается в hello Application Insights ресурс настроен для облачной службы.</span><span class="sxs-lookup"><span data-stu-id="5562d-134">hello Azure diagnostic telemetry shows up in hello Application Insights resource configured for your cloud service.</span></span>

<span data-ttu-id="5562d-135">Типы журналов диагностики Azure сопоставления понятий аналитики tooApplication следующими способами:</span><span class="sxs-lookup"><span data-stu-id="5562d-135">Azure diagnostics log types map tooApplication Insights concepts in these ways:</span></span>

* <span data-ttu-id="5562d-136">Счетчики производительности отображаются в Application Insights в виде пользовательских метрик.</span><span class="sxs-lookup"><span data-stu-id="5562d-136">Performance counters are displayed as Custom Metrics in Application Insights.</span></span>
* <span data-ttu-id="5562d-137">Журналы событий Windows отображаются в Application Insights в виде трассировок и пользовательских событий.</span><span class="sxs-lookup"><span data-stu-id="5562d-137">Windows Event Logs are shown as Traces and Custom Events in Application Insights.</span></span>
* <span data-ttu-id="5562d-138">Журналы приложений, журналы ETW и все журналы инфраструктуры диагностики отображаются в Application Insights в виде трассировок.</span><span class="sxs-lookup"><span data-stu-id="5562d-138">Application logs, ETW logs, and any Diagnostics Infrastructure logs are shown as Traces in Application Insights.</span></span>

<span data-ttu-id="5562d-139">tooview данные диагностики Azure в Application Insights, выполните одно из следующих hello.</span><span class="sxs-lookup"><span data-stu-id="5562d-139">tooview Azure diagnostics data in Application Insights, do one of hello following:</span></span>

* <span data-ttu-id="5562d-140">Используйте [обозревателя метрик](../application-insights/app-insights-metrics-explorer.md) toovisualize любые пользовательские счетчики производительности, либо количество различных типов событий в журнал событий Windows.</span><span class="sxs-lookup"><span data-stu-id="5562d-140">Use [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) toovisualize any custom performance counters or counts of different types of Windows Event Log events.</span></span>

    ![Пользовательские метрики в обозревателе метрик][5]

* <span data-ttu-id="5562d-142">Используйте [поиска](../application-insights/app-insights-diagnostic-search.md) toosearch через журналы трассировки hello, отправленных диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="5562d-142">Use [Search](../application-insights/app-insights-diagnostic-search.md) toosearch across hello  trace logs sent by Azure Diagnostics.</span></span> <span data-ttu-id="5562d-143">Например, если необработанное исключение вызвало роль toocrash hello и повторный запуск, сведения об исключении hello отображается в hello *приложения* канал *журнал событий Windows*.</span><span class="sxs-lookup"><span data-stu-id="5562d-143">For example, if an unhandled exception has caused hello role toocrash and recycle, information about hello exception shows up in hello *Application* channel of *Windows Event Log*.</span></span> <span data-ttu-id="5562d-144">Можно использовать toolook поиска на ошибки в журнале событий Windows hello и получить hello полную трассировку стека для hello исключение toohelp поиска hello причиной проблемы hello.</span><span class="sxs-lookup"><span data-stu-id="5562d-144">You can use search toolook at hello Windows Event Log error and get hello full stack trace for hello exception toohelp find hello cause of hello issue.</span></span>

    ![Поиск трассировок][6]

## <a name="next-steps"></a><span data-ttu-id="5562d-146">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="5562d-146">Next Steps</span></span>
* <span data-ttu-id="5562d-147">[Добавить hello пакет SDK Application Insights tooyour облачной службы](../application-insights/app-insights-cloudservices.md) toosend данные о запросах, исключения, зависимости и любые пользовательские данные телеметрии из приложения.</span><span class="sxs-lookup"><span data-stu-id="5562d-147">[Add hello Application Insights SDK tooyour cloud service](../application-insights/app-insights-cloudservices.md) toosend data about requests, exceptions, dependencies, and any custom telemetry from your application.</span></span> <span data-ttu-id="5562d-148">В сочетании с данными диагностики Azure hello, эти сведения можно получить полное представление о приложения и системы, все в hello того же ресурса Application Insight.</span><span class="sxs-lookup"><span data-stu-id="5562d-148">When combined with hello Azure Diagnostics data, this information you can get a complete view of your application and system, all in hello same Application Insight resource.</span></span>  

<!--Image references-->
[1]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/solution-explorer-properties.png
[2]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-sendtoappinsights.png
[3]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/select-appinsights-resource.png
[4]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-appinsights-serviceconfig.png
[5]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/metrics-explorer-custom-metrics.png
[6]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/search-windowseventlog-error.png
