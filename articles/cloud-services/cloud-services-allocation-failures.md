---
title: "aaaTroubleshooting ошибка выделения облачные службы | Документы Microsoft"
description: "Устранение ошибки выделения при развертывании облачных служб в Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: dfd5cc4663ccc6ed1b27ca9df579182737363b0e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a>Устранение ошибки выделения при развертывании облачных служб в Azure
## <a name="summary"></a>Сводка
При развертывании экземпляров tooa облачной службы или Добавление нового веб-узла или экземпляров рабочей роли, Microsoft Azure выделяет вычислительные ресурсы. Иногда может получать ошибки, при выполнении этих операций, даже в том случае, прежде чем достигнет hello ограничения подписки Azure. В этой статье объясняется причины hello некоторых распространенных ошибок выделения hello и предлагает возможные исправления. Hello сведения также можно использовать при планировании развертывания hello служб.

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a>Общая информация — принцип выделения ресурсов
Hello серверов в центрах обработки данных Azure разбиваются на кластеры. Запрос о выделении новой облачной службы отправляется в несколько кластеров. Когда первый экземпляр hello — развернутой tooa облачная служба (в промежуточной или производственной), облачная служба возвращает закрепленные tooa кластера. Любые дополнительные развертывания для hello облачной службы будет происходить в hello же кластера. В этой статье мы называем toothis как «закрепленных tooa кластер». Рис. 1 ниже показан случай hello обычного выделения, который выполняется в несколько кластеров; Схема 2 показан случай hello с закрепленных tooCluster 2, поскольку, где находится hello существующей облачной службы CS_1 размещенной выделения ресурсов.

![Схема выделения ресурсов](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a>Причины возникновения ошибок выделения ресурсов
Когда запрос на выделение памяти кластера закрепленных tooa, нет выше вероятность сбои toofind освободить ресурсы, так, как hello доступный пул ресурсов — ограниченный tooa кластер. Кроме того Если запроса на выделение закрепленных tooa кластера, но тип hello запрошенного ресурса не поддерживается в этом кластере, запрос завершится ошибкой, даже если кластера hello бесплатных ресурсов. 3 показан на следующем рисунке показан случай hello, где закрепленных выделение завершается неудачей, так как только Кандидат в кластеры hello не имеет свободных ресурсов. На рис. 4 показан случай hello, где закрепленных выделение завершается неудачей, поскольку только Кандидат в кластеры hello не поддерживает hello запрошенный размер виртуальной Машины, даже если кластер hello имеет освободить ресурсы.

![Ошибка выделения прикрепленных ресурсов](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a>Устранение ошибок выделения для облачных служб
### <a name="error-message"></a>Сообщение об ошибке
Может появиться сообщение об ошибке после hello:

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable toosatisfy constraints in request. hello requested new service deployment is bound tooan Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains hello new deployment toospecific Azure resources. Please retry later or try reducing hello VM size or number of role instances. Alternatively, if possible, remove hello aforementioned constraints or try deploying tooa different region."

### <a name="common-issues"></a>Распространенные проблемы
Здесь приведены распространенные выделения сценарии hello, вызывающие распределения запроса toobe закрепленных tooa одного кластера.

* Развертывание tooStaging слот — Если развертывание облачной службы в любой ячейке, то hello всей облачной службы является закрепленных tooa конкретному кластеру.  Это означает, что если развертывания уже существует в производственный слот hello, затем новое промежуточное развертывание может быть размещена только в hello же кластера в качестве hello производственный слот. Если кластер hello почти заполнена, hello запрос может завершиться ошибкой.
* Масштабирование — Добавление новых экземпляров tooan существующей облачной службы необходимо выделить в hello же кластера.  Для мелких запросов масштабирования ресурсы обычно выделяются, но это происходит не всегда. Если кластер hello почти заполнена, hello запрос может завершиться ошибкой.
* Территориальная группа - новый пустой облачной службе tooan развертывания может быть выделен структуры hello в любой кластер в этой области, если hello облачная служба — закрепленных tooan территориальную группу. Toohello развертываний же территориальная группа будет предпринята в hello одного кластера. Если кластер hello почти заполнена, hello запрос может завершиться ошибкой.
* Территориальная группа виртуальной сети - старые виртуальные сети были группы равноценных tooaffinity вместо областей и облачных служб в эти виртуальные сети будет закрепленных toohello территориальную группу кластера. Тип toothis развертывания виртуальной сети будет предпринята в закрепленных hello кластера. Если кластер hello почти заполнена, hello запрос может завершиться ошибкой.

## <a name="solutions"></a>Решения
1. Повторное развертывание tooa новая облачная служба — это решение является скорее всего toobe наиболее успешных разрешается toochoose платформы hello из всех кластеров в этом регионе.

   * Развертывание hello рабочей нагрузки tooa новой облачной службы  
   * Обновить hello CNAME и A записей toopoint трафика toohello новой облачной службы
   * После нулевой трафик будет toohello старого веб-сайта, можно удалить старые облачную службу hello. В этом случае время простоя должно быть нулевым.
2. Удаление рабочей и промежуточных слотов - это решение позволяет сохранить существующий DNS-имени, но приводит к созданию приложения tooyour время простоя.

   * Удаление рабочей hello и промежуточные слоты существующей облачной службы, чтобы hello облачной службы является пустым, а затем
   * Создайте новое развертывание в существующую облачную службу hello. Это попытается повторно tooallocation во всех кластерах в регионе hello. Убедитесь, что облачная служба hello не равноценных tooan территориальную группу.
3. Зарезервированный IP-адрес - это решение позволяет сохранить существующий IP-адресов, но приводит к созданию приложения tooyour время простоя.  

   * Создайте адрес ReservedIP для существующего развертывания с помощью Powershell.

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * Выполните #2 выше, делая убедиться, что toospecify hello новый зарезервированный IP-адрес в hello службы CSCFG.
4. Удалите территориальную группу для новых развертываний. Использовать территориальные группы больше не рекомендуются. Выполните действия для #1 выше toodeploy новой облачной службы. Убедитесь, что облачная служба не входит в территориальную группу.
5. Преобразовать tooa региональной виртуальной сети — см. в разделе [как toomigrate из tooa Территориальные группы региональной виртуальной сети (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).
