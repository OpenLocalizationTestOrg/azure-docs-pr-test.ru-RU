---
title: "aaaTroubleshooting ошибка выделения облачные службы | Документы Microsoft"
description: "Устранение ошибки выделения при развертывании облачных служб в Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: dfd5cc4663ccc6ed1b27ca9df579182737363b0e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="86555-103">Устранение ошибки выделения при развертывании облачных служб в Azure</span><span class="sxs-lookup"><span data-stu-id="86555-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="86555-104">Сводка</span><span class="sxs-lookup"><span data-stu-id="86555-104">Summary</span></span>
<span data-ttu-id="86555-105">При развертывании экземпляров tooa облачной службы или Добавление нового веб-узла или экземпляров рабочей роли, Microsoft Azure выделяет вычислительные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="86555-105">When you deploy instances tooa Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="86555-106">Иногда может получать ошибки, при выполнении этих операций, даже в том случае, прежде чем достигнет hello ограничения подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="86555-106">You may occasionally receive errors when performing these operations even before you reach hello Azure subscription limits.</span></span> <span data-ttu-id="86555-107">В этой статье объясняется причины hello некоторых распространенных ошибок выделения hello и предлагает возможные исправления.</span><span class="sxs-lookup"><span data-stu-id="86555-107">This article explains hello causes of some of hello common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="86555-108">Hello сведения также можно использовать при планировании развертывания hello служб.</span><span class="sxs-lookup"><span data-stu-id="86555-108">hello information may also be useful when you plan hello deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="86555-109">Общая информация — принцип выделения ресурсов</span><span class="sxs-lookup"><span data-stu-id="86555-109">Background – How allocation works</span></span>
<span data-ttu-id="86555-110">Hello серверов в центрах обработки данных Azure разбиваются на кластеры.</span><span class="sxs-lookup"><span data-stu-id="86555-110">hello servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="86555-111">Запрос о выделении новой облачной службы отправляется в несколько кластеров.</span><span class="sxs-lookup"><span data-stu-id="86555-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="86555-112">Когда первый экземпляр hello — развернутой tooa облачная служба (в промежуточной или производственной), облачная служба возвращает закрепленные tooa кластера.</span><span class="sxs-lookup"><span data-stu-id="86555-112">When hello first instance is deployed tooa cloud service(in either staging or production), that cloud service gets pinned tooa cluster.</span></span> <span data-ttu-id="86555-113">Любые дополнительные развертывания для hello облачной службы будет происходить в hello же кластера.</span><span class="sxs-lookup"><span data-stu-id="86555-113">Any further deployments for hello cloud service will happen in hello same cluster.</span></span> <span data-ttu-id="86555-114">В этой статье мы называем toothis как «закрепленных tooa кластер».</span><span class="sxs-lookup"><span data-stu-id="86555-114">In this article, we'll refer toothis as "pinned tooa cluster".</span></span> <span data-ttu-id="86555-115">Рис. 1 ниже показан случай hello обычного выделения, который выполняется в несколько кластеров; Схема 2 показан случай hello с закрепленных tooCluster 2, поскольку, где находится hello существующей облачной службы CS_1 размещенной выделения ресурсов.</span><span class="sxs-lookup"><span data-stu-id="86555-115">Diagram 1 below illustrates hello case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates hello case of an allocation that's pinned tooCluster 2 because that's where hello existing Cloud Service CS_1 is hosted.</span></span>

![Схема выделения ресурсов](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="86555-117">Причины возникновения ошибок выделения ресурсов</span><span class="sxs-lookup"><span data-stu-id="86555-117">Why allocation failure happens</span></span>
<span data-ttu-id="86555-118">Когда запрос на выделение памяти кластера закрепленных tooa, нет выше вероятность сбои toofind освободить ресурсы, так, как hello доступный пул ресурсов — ограниченный tooa кластер.</span><span class="sxs-lookup"><span data-stu-id="86555-118">When an allocation request is pinned tooa cluster, there's a higher chance of failing toofind free resources since hello available resource pool is limited tooa cluster.</span></span> <span data-ttu-id="86555-119">Кроме того Если запроса на выделение закрепленных tooa кластера, но тип hello запрошенного ресурса не поддерживается в этом кластере, запрос завершится ошибкой, даже если кластера hello бесплатных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="86555-119">Furthermore, if your allocation request is pinned tooa cluster but hello type of resource you requested is not supported by that cluster, your request will fail even if hello cluster has free resource.</span></span> <span data-ttu-id="86555-120">3 показан на следующем рисунке показан случай hello, где закрепленных выделение завершается неудачей, так как только Кандидат в кластеры hello не имеет свободных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="86555-120">Diagram 3 below illustrates hello case where a pinned allocation fails because hello only candidate cluster does not have free resources.</span></span> <span data-ttu-id="86555-121">На рис. 4 показан случай hello, где закрепленных выделение завершается неудачей, поскольку только Кандидат в кластеры hello не поддерживает hello запрошенный размер виртуальной Машины, даже если кластер hello имеет освободить ресурсы.</span><span class="sxs-lookup"><span data-stu-id="86555-121">Diagram 4 illustrates hello case where a pinned allocation fails because hello only candidate cluster does not support hello requested VM size, even though hello cluster has free resources.</span></span>

![Ошибка выделения прикрепленных ресурсов](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="86555-123">Устранение ошибок выделения для облачных служб</span><span class="sxs-lookup"><span data-stu-id="86555-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="86555-124">Сообщение об ошибке</span><span class="sxs-lookup"><span data-stu-id="86555-124">Error Message</span></span>
<span data-ttu-id="86555-125">Может появиться сообщение об ошибке после hello:</span><span class="sxs-lookup"><span data-stu-id="86555-125">You may see hello following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable toosatisfy constraints in request. hello requested new service deployment is bound tooan Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains hello new deployment toospecific Azure resources. Please retry later or try reducing hello VM size or number of role instances. Alternatively, if possible, remove hello aforementioned constraints or try deploying tooa different region."

### <a name="common-issues"></a><span data-ttu-id="86555-126">Распространенные проблемы</span><span class="sxs-lookup"><span data-stu-id="86555-126">Common Issues</span></span>
<span data-ttu-id="86555-127">Здесь приведены распространенные выделения сценарии hello, вызывающие распределения запроса toobe закрепленных tooa одного кластера.</span><span class="sxs-lookup"><span data-stu-id="86555-127">Here are hello common allocation scenarios that cause an allocation request toobe pinned tooa single cluster.</span></span>

* <span data-ttu-id="86555-128">Развертывание tooStaging слот — Если развертывание облачной службы в любой ячейке, то hello всей облачной службы является закрепленных tooa конкретному кластеру.</span><span class="sxs-lookup"><span data-stu-id="86555-128">Deploying tooStaging Slot - If a cloud service has a deployment in either slot, then hello entire cloud service is pinned tooa specific cluster.</span></span>  <span data-ttu-id="86555-129">Это означает, что если развертывания уже существует в производственный слот hello, затем новое промежуточное развертывание может быть размещена только в hello же кластера в качестве hello производственный слот.</span><span class="sxs-lookup"><span data-stu-id="86555-129">This means that if a deployment already exists in hello production slot, then a new staging deployment can only be allocated in hello same cluster as hello production slot.</span></span> <span data-ttu-id="86555-130">Если кластер hello почти заполнена, hello запрос может завершиться ошибкой.</span><span class="sxs-lookup"><span data-stu-id="86555-130">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="86555-131">Масштабирование — Добавление новых экземпляров tooan существующей облачной службы необходимо выделить в hello же кластера.</span><span class="sxs-lookup"><span data-stu-id="86555-131">Scaling - Adding new instances tooan existing cloud service must allocate in hello same cluster.</span></span>  <span data-ttu-id="86555-132">Для мелких запросов масштабирования ресурсы обычно выделяются, но это происходит не всегда.</span><span class="sxs-lookup"><span data-stu-id="86555-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="86555-133">Если кластер hello почти заполнена, hello запрос может завершиться ошибкой.</span><span class="sxs-lookup"><span data-stu-id="86555-133">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="86555-134">Территориальная группа - новый пустой облачной службе tooan развертывания может быть выделен структуры hello в любой кластер в этой области, если hello облачная служба — закрепленных tooan территориальную группу.</span><span class="sxs-lookup"><span data-stu-id="86555-134">Affinity Group - A new deployment tooan empty cloud service can be allocated by hello fabric in any cluster in that region, unless hello cloud service is pinned tooan affinity group.</span></span> <span data-ttu-id="86555-135">Toohello развертываний же территориальная группа будет предпринята в hello одного кластера.</span><span class="sxs-lookup"><span data-stu-id="86555-135">Deployments toohello same affinity group will be attempted on hello same cluster.</span></span> <span data-ttu-id="86555-136">Если кластер hello почти заполнена, hello запрос может завершиться ошибкой.</span><span class="sxs-lookup"><span data-stu-id="86555-136">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="86555-137">Территориальная группа виртуальной сети - старые виртуальные сети были группы равноценных tooaffinity вместо областей и облачных служб в эти виртуальные сети будет закрепленных toohello территориальную группу кластера.</span><span class="sxs-lookup"><span data-stu-id="86555-137">Affinity Group vNet - Older Virtual Networks were tied tooaffinity groups instead of regions, and cloud services in these Virtual Networks would be pinned toohello affinity group cluster.</span></span> <span data-ttu-id="86555-138">Тип toothis развертывания виртуальной сети будет предпринята в закрепленных hello кластера.</span><span class="sxs-lookup"><span data-stu-id="86555-138">Deployments toothis type of virtual network will be attempted on hello pinned cluster.</span></span> <span data-ttu-id="86555-139">Если кластер hello почти заполнена, hello запрос может завершиться ошибкой.</span><span class="sxs-lookup"><span data-stu-id="86555-139">If hello cluster is nearing capacity, hello request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="86555-140">Решения</span><span class="sxs-lookup"><span data-stu-id="86555-140">Solutions</span></span>
1. <span data-ttu-id="86555-141">Повторное развертывание tooa новая облачная служба — это решение является скорее всего toobe наиболее успешных разрешается toochoose платформы hello из всех кластеров в этом регионе.</span><span class="sxs-lookup"><span data-stu-id="86555-141">Redeploy tooa new cloud service - This solution is likely toobe most successful as it allows hello platform toochoose from all clusters in that region.</span></span>

   * <span data-ttu-id="86555-142">Развертывание hello рабочей нагрузки tooa новой облачной службы</span><span class="sxs-lookup"><span data-stu-id="86555-142">Deploy hello workload tooa new cloud service</span></span>  
   * <span data-ttu-id="86555-143">Обновить hello CNAME и A записей toopoint трафика toohello новой облачной службы</span><span class="sxs-lookup"><span data-stu-id="86555-143">Update hello CNAME or A record toopoint traffic toohello new cloud service</span></span>
   * <span data-ttu-id="86555-144">После нулевой трафик будет toohello старого веб-сайта, можно удалить старые облачную службу hello.</span><span class="sxs-lookup"><span data-stu-id="86555-144">Once zero traffic is going toohello old site, you can delete hello old cloud service.</span></span> <span data-ttu-id="86555-145">В этом случае время простоя должно быть нулевым.</span><span class="sxs-lookup"><span data-stu-id="86555-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="86555-146">Удаление рабочей и промежуточных слотов - это решение позволяет сохранить существующий DNS-имени, но приводит к созданию приложения tooyour время простоя.</span><span class="sxs-lookup"><span data-stu-id="86555-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime tooyour application.</span></span>

   * <span data-ttu-id="86555-147">Удаление рабочей hello и промежуточные слоты существующей облачной службы, чтобы hello облачной службы является пустым, а затем</span><span class="sxs-lookup"><span data-stu-id="86555-147">Delete hello production and staging slots of an existing cloud service so that hello cloud service is empty, and then</span></span>
   * <span data-ttu-id="86555-148">Создайте новое развертывание в существующую облачную службу hello.</span><span class="sxs-lookup"><span data-stu-id="86555-148">Create a new deployment in hello existing cloud service.</span></span> <span data-ttu-id="86555-149">Это попытается повторно tooallocation во всех кластерах в регионе hello.</span><span class="sxs-lookup"><span data-stu-id="86555-149">This will re-attempt tooallocation on all clusters in hello region.</span></span> <span data-ttu-id="86555-150">Убедитесь, что облачная служба hello не равноценных tooan территориальную группу.</span><span class="sxs-lookup"><span data-stu-id="86555-150">Ensure hello cloud service is not tied tooan affinity group.</span></span>
3. <span data-ttu-id="86555-151">Зарезервированный IP-адрес - это решение позволяет сохранить существующий IP-адресов, но приводит к созданию приложения tooyour время простоя.</span><span class="sxs-lookup"><span data-stu-id="86555-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime tooyour application.</span></span>  

   * <span data-ttu-id="86555-152">Создайте адрес ReservedIP для существующего развертывания с помощью Powershell.</span><span class="sxs-lookup"><span data-stu-id="86555-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="86555-153">Выполните #2 выше, делая убедиться, что toospecify hello новый зарезервированный IP-адрес в hello службы CSCFG.</span><span class="sxs-lookup"><span data-stu-id="86555-153">Follow #2 from above, making sure toospecify hello new ReservedIP in hello service's CSCFG.</span></span>
4. <span data-ttu-id="86555-154">Удалите территориальную группу для новых развертываний. Использовать территориальные группы больше не рекомендуются.</span><span class="sxs-lookup"><span data-stu-id="86555-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="86555-155">Выполните действия для #1 выше toodeploy новой облачной службы.</span><span class="sxs-lookup"><span data-stu-id="86555-155">Follow steps for #1 above toodeploy a new cloud service.</span></span> <span data-ttu-id="86555-156">Убедитесь, что облачная служба не входит в территориальную группу.</span><span class="sxs-lookup"><span data-stu-id="86555-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="86555-157">Преобразовать tooa региональной виртуальной сети — см. в разделе [как toomigrate из tooa Территориальные группы региональной виртуальной сети (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="86555-157">Convert tooa Regional Virtual Network - See [How toomigrate from Affinity Groups tooa Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
