---
title: "события жизненного цикла облачной службы aaaHandle | Документы Microsoft"
description: "Узнайте, как можно использовать методы жизненного цикла hello роли облачной службы в .NET"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: cc0ccc5f055b965202b6e081a6ab72ad5d39b034
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="customize-hello-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="cfd61-103">Настройка hello жизненным циклом рабочих и веб-роли в .NET</span><span class="sxs-lookup"><span data-stu-id="cfd61-103">Customize hello Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="cfd61-104">При создании рабочей роли, можно расширить hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) класс, который предоставляет методы для вас toooverride, которые позволяют реагировать toolifecycle события.</span><span class="sxs-lookup"><span data-stu-id="cfd61-104">When you create a worker role, you extend hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you toooverride that let you respond toolifecycle events.</span></span> <span data-ttu-id="cfd61-105">Для веб-ролей этот класс является необязательным, поэтому вы должны использовать toorespond toolifecycle события.</span><span class="sxs-lookup"><span data-stu-id="cfd61-105">For web roles this class is optional, so you must use it toorespond toolifecycle events.</span></span>

## <a name="extend-hello-roleentrypoint-class"></a><span data-ttu-id="cfd61-106">Расширение класса RoleEntryPoint hello</span><span class="sxs-lookup"><span data-stu-id="cfd61-106">Extend hello RoleEntryPoint class</span></span>
<span data-ttu-id="cfd61-107">Hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) класс содержит методы, которые вызываются Azure при его **запускает**, **выполняется**, или **останавливает** рабочих и веб-роли.</span><span class="sxs-lookup"><span data-stu-id="cfd61-107">hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="cfd61-108">При необходимости можно переопределить эти методы toomanage роли инициализации, последовательность завершения работы роли или hello потоком выполнения роли hello.</span><span class="sxs-lookup"><span data-stu-id="cfd61-108">You can optionally override these methods toomanage role initialization, role shutdown sequences, or hello execution thread of hello role.</span></span> 

<span data-ttu-id="cfd61-109">При расширении **RoleEntryPoint**, следует помнить о следующих поведений методов hello hello:</span><span class="sxs-lookup"><span data-stu-id="cfd61-109">When extending **RoleEntryPoint**, you should be aware of hello following behaviors of hello methods:</span></span>

* <span data-ttu-id="cfd61-110">Hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) и [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) методы возвращают логическое значение, поэтому вполне возможно tooreturn **false** из этих методов.</span><span class="sxs-lookup"><span data-stu-id="cfd61-110">hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible tooreturn **false** from these methods.</span></span>
  
   <span data-ttu-id="cfd61-111">Если код возвращает **false**, hello роль процесса немедленно завершается, запуская любая последовательность завершения работы имеется на месте.</span><span class="sxs-lookup"><span data-stu-id="cfd61-111">If your code returns **false**, hello role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="cfd61-112">В общем случае следует возвращать **false** из hello **OnStart** метод.</span><span class="sxs-lookup"><span data-stu-id="cfd61-112">In general, you should avoid returning **false** from hello **OnStart** method.</span></span>
* <span data-ttu-id="cfd61-113">При любом неперехваченном исключении при перегрузке **RoleEntryPoint** метод рассматривается как необработанное исключение.</span><span class="sxs-lookup"><span data-stu-id="cfd61-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="cfd61-114">При возникновении исключения в одном из методов жизненного цикла hello Azure отправит событие hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) события, и затем hello процесс завершается.</span><span class="sxs-lookup"><span data-stu-id="cfd61-114">If an exception occurs within one of hello lifecycle methods, Azure will raise hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then hello process is terminated.</span></span> <span data-ttu-id="cfd61-115">После перевода вашей роли в автономный режим Azure перезапустит ее.</span><span class="sxs-lookup"><span data-stu-id="cfd61-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="cfd61-116">При возникновении необработанного исключения, hello [остановка](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) событие не возникает и hello **OnStop** метод не вызывается.</span><span class="sxs-lookup"><span data-stu-id="cfd61-116">When an unhandled exception occurs, hello [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and hello **OnStop** method is not called.</span></span>

<span data-ttu-id="cfd61-117">Если ваша роль не запускается или перезапуска между hello инициализации, занятости и остановки состояния, код может вызывает необработанное исключение в одном из событий жизненного цикла hello каждой роли hello время перезагрузки компьютера.</span><span class="sxs-lookup"><span data-stu-id="cfd61-117">If your role does not start, or is recycling between hello initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of hello lifecycle events each time hello role restarts.</span></span> <span data-ttu-id="cfd61-118">В этом случае использовать hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) toodetermine событий hello причиной исключения hello и выполнить соответствующую обработку.</span><span class="sxs-lookup"><span data-stu-id="cfd61-118">In this case, use hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event toodetermine hello cause of hello exception and handle it appropriately.</span></span> <span data-ttu-id="cfd61-119">Роли могут также возвращает значение из hello [запуска](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) метод, который вызывает toorestart роли hello.</span><span class="sxs-lookup"><span data-stu-id="cfd61-119">Your role may also be returning from hello [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes hello role toorestart.</span></span> <span data-ttu-id="cfd61-120">Дополнительные сведения о состоянии развертывания см. в разделе [tooRecycle типичных проблем которой причина ролей](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="cfd61-120">For more information about deployment states, see [Common Issues Which Cause Roles tooRecycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="cfd61-121">Если вы используете hello **средства Azure для Microsoft Visual Studio** toodevelop приложения hello шаблоны проекта роли автоматически расширяют hello **RoleEntryPoint** класса, в hello *WebRole.cs* и *WorkerRole.cs* файлов.</span><span class="sxs-lookup"><span data-stu-id="cfd61-121">If you are using hello **Azure Tools for Microsoft Visual Studio** toodevelop your application, hello role project templates automatically extend hello **RoleEntryPoint** class for you, in hello *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="cfd61-122">Метод OnStart</span><span class="sxs-lookup"><span data-stu-id="cfd61-122">OnStart method</span></span>
<span data-ttu-id="cfd61-123">Hello **OnStart** метод вызывается, когда экземпляр роли переводится в оперативный режим в Azure.</span><span class="sxs-lookup"><span data-stu-id="cfd61-123">hello **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="cfd61-124">Пока hello код метода OnStart, экземпляр роли hello помечен как **Busy** и внешний трафик не будет направленной tooit подсистемой балансировки нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="cfd61-124">While hello OnStart code is executing, hello role instance is marked as **Busy** and no external traffic will be directed tooit by hello load balancer.</span></span> <span data-ttu-id="cfd61-125">Можно переопределить этот метод tooperform инициализации работы, например реализации обработчиков событий и запуска [диагностики Azure](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="cfd61-125">You can override this method tooperform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="cfd61-126">Если **OnStart** возвращает **true**, hello экземпляр инициализирован успешно и Azure вызывает метод hello **RoleEntryPoint.Run** метод.</span><span class="sxs-lookup"><span data-stu-id="cfd61-126">If **OnStart** returns **true**, hello instance is successfully initialized and Azure calls hello **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="cfd61-127">Если **OnStart** возвращает **false**, hello роль немедленно завершается без выполнения любой запланированных последовательностей завершения работы.</span><span class="sxs-lookup"><span data-stu-id="cfd61-127">If **OnStart** returns **false**, hello role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="cfd61-128">Здравствуйте, следуя примере кода показано, как toooverride hello **OnStart** метод.</span><span class="sxs-lookup"><span data-stu-id="cfd61-128">hello following code example shows how toooverride hello **OnStart** method.</span></span> <span data-ttu-id="cfd61-129">Этот метод настраивает и запускает монитор диагностики при запуске экземпляра роли hello и передачу данных учетной записи хранилища tooa ведения журнала:</span><span class="sxs-lookup"><span data-stu-id="cfd61-129">This method configures and starts a diagnostic monitor when hello role instance starts and sets up a transfer of logging data tooa storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="cfd61-130">Метод OnStop</span><span class="sxs-lookup"><span data-stu-id="cfd61-130">OnStop method</span></span>
<span data-ttu-id="cfd61-131">Hello **OnStop** метод вызывается после экземпляра роли переведены в автономный режим Azure и до завершения процесса hello.</span><span class="sxs-lookup"><span data-stu-id="cfd61-131">hello **OnStop** method is called after a role instance has been taken offline by Azure and before hello process exits.</span></span> <span data-ttu-id="cfd61-132">Можно переопределить этот метод toocall код, требуемый для вашей роли экземпляра toocleanly, завершение работы.</span><span class="sxs-lookup"><span data-stu-id="cfd61-132">You can override this method toocall code required for your role instance toocleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="cfd61-133">Код, выполняющийся в hello **OnStop** метод имеет toofinish ограниченное время, когда он вызывается по причине остановки, инициированной пользователем.</span><span class="sxs-lookup"><span data-stu-id="cfd61-133">Code running in hello **OnStop** method has a limited time toofinish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="cfd61-134">По истечении этого времени hello процесс завершается, поэтому вы должны убедиться, что этот код в hello **OnStop** метод выполняется быстро и допускает toocompletion не запущена.</span><span class="sxs-lookup"><span data-stu-id="cfd61-134">After this time elapses, hello process is terminated, so you must make sure that code in hello **OnStop** method can run quickly or tolerates not running toocompletion.</span></span> <span data-ttu-id="cfd61-135">Hello **OnStop** метод вызывается после hello **остановки** события.</span><span class="sxs-lookup"><span data-stu-id="cfd61-135">hello **OnStop** method is called after hello **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="cfd61-136">Метод Run</span><span class="sxs-lookup"><span data-stu-id="cfd61-136">Run method</span></span>
<span data-ttu-id="cfd61-137">Можно переопределить hello **запуска** метод tooimplement длительно выполняемого потока для экземпляра роли.</span><span class="sxs-lookup"><span data-stu-id="cfd61-137">You can override hello **Run** method tooimplement a long-running thread for your role instance.</span></span>

<span data-ttu-id="cfd61-138">Переопределение hello **запуска** метод не является обязательным; реализация по умолчанию hello запускает постоянно спящий поток.</span><span class="sxs-lookup"><span data-stu-id="cfd61-138">Overriding hello **Run** method is not required; hello default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="cfd61-139">При переопределении hello **запуска** метод, код должен блокироваться бесконечно.</span><span class="sxs-lookup"><span data-stu-id="cfd61-139">If you do override hello **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="cfd61-140">Если hello **запуска** методом hello роль автоматически перезапускается; другими словами, Azure отправляет hello **остановка** событий и вызовов hello **OnStop** метод, может выполнить последовательность завершения работы до выключения роли hello.</span><span class="sxs-lookup"><span data-stu-id="cfd61-140">If hello **Run** method returns, hello role is automatically gracefully recycled; in other words, Azure raises hello **Stopping** event and calls hello **OnStop** method so that your shutdown sequences may be executed before hello role is taken offline.</span></span>

### <a name="implementing-hello-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="cfd61-141">Реализация методов жизненного цикла ASP.NET hello для веб-роли</span><span class="sxs-lookup"><span data-stu-id="cfd61-141">Implementing hello ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="cfd61-142">Можно использовать методы жизненного цикла ASP.NET hello, кроме предоставляемых hello toothose **RoleEntryPoint** класса toomanage последовательности инициализации и завершения работы для веб-роли.</span><span class="sxs-lookup"><span data-stu-id="cfd61-142">You can use hello ASP.NET lifecycle methods, in addition toothose provided by hello **RoleEntryPoint** class, toomanage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="cfd61-143">Это может быть полезным для обеспечения совместимости при переносе существующего tooAzure приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="cfd61-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application tooAzure.</span></span> <span data-ttu-id="cfd61-144">Hello методы жизненного цикла ASP.NET вызываются из внутри hello **RoleEntryPoint** методы.</span><span class="sxs-lookup"><span data-stu-id="cfd61-144">hello ASP.NET lifecycle methods are called from within hello **RoleEntryPoint** methods.</span></span> <span data-ttu-id="cfd61-145">Hello **приложения\_запустить** метод вызывается после hello **RoleEntryPoint.OnStart** метод завершения.</span><span class="sxs-lookup"><span data-stu-id="cfd61-145">hello **Application\_Start** method is called after hello **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="cfd61-146">Hello **приложения\_окончания** метод вызывается перед hello **RoleEntryPoint.OnStop** вызывается метод.</span><span class="sxs-lookup"><span data-stu-id="cfd61-146">hello **Application\_End** method is called before hello **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="cfd61-147">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="cfd61-147">Next steps</span></span>
<span data-ttu-id="cfd61-148">Узнайте, каким образом слишком[создать пакет облачной службы](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="cfd61-148">Learn how too[create a cloud service package](cloud-services-model-and-package.md).</span></span>

