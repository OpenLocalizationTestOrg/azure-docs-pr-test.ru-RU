---
title: "Распространенные причины перезапуска ролей облачных служб | Документация Майкрософт"
description: "Внезапный перезапуск роли облачной службы может привести к длительному простою. Ниже приведены некоторые распространенные проблемы, вызывающие перезапуск ролей. Эти сведения могут помочь сократить время простоя."
services: cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 533930d1-8035-4402-b16a-cf887b2c4f85
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: tbd
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: e55009c72b977ee4a30f6c71043bde483849f78f
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="common-issues-that-cause-roles-to-recycle"></a><span data-ttu-id="d718d-104">Распространенные проблемы, вызывающие перезапуск ролей</span><span class="sxs-lookup"><span data-stu-id="d718d-104">Common issues that cause roles to recycle</span></span>
<span data-ttu-id="d718d-105">В этой статье рассматриваются некоторые распространенные причины проблем с развертыванием, а также советы по их устранению.</span><span class="sxs-lookup"><span data-stu-id="d718d-105">This article discusses some of the common causes of deployment problems and provides troubleshooting tips to help you resolve these problems.</span></span> <span data-ttu-id="d718d-106">На наличие проблем с приложением указывает то, что экземпляр роли не запускается или циклически переключается между состояниями "Инициализация", "Занято" и "Остановлено".</span><span class="sxs-lookup"><span data-stu-id="d718d-106">An indication that a problem exists with an application is when the role instance fails to start, or it cycles between the initializing, busy, and stopping states.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="missing-runtime-dependencies"></a><span data-ttu-id="d718d-107">Отсутствующие зависимости среды выполнения</span><span class="sxs-lookup"><span data-stu-id="d718d-107">Missing runtime dependencies</span></span>
<span data-ttu-id="d718d-108">Если роль в приложении использует какую-либо сборку, которая не является частью управляемой библиотеки Azure или платформы .NET Framework, необходимо явно включить эту сборку в пакет приложения.</span><span class="sxs-lookup"><span data-stu-id="d718d-108">If a role in your application relies on any assembly that is not part of the .NET Framework or the Azure managed library, you must explicitly include that assembly in the application package.</span></span> <span data-ttu-id="d718d-109">Имейте в виду, что другие платформы Майкрософт недоступны в Azure по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="d718d-109">Keep in mind that other Microsoft frameworks are not available on Azure by default.</span></span> <span data-ttu-id="d718d-110">Если ваша роль использует такую платформу, необходимо добавить эти сборки в пакет приложения.</span><span class="sxs-lookup"><span data-stu-id="d718d-110">If your role relies on such a framework, you must add those assemblies to the application package.</span></span>

<span data-ttu-id="d718d-111">Перед сборкой и упаковкой приложения проверьте следующее.</span><span class="sxs-lookup"><span data-stu-id="d718d-111">Before you build and package your application, verify the following:</span></span>

* <span data-ttu-id="d718d-112">При работе в Visual Studio убедитесь, что свойство **Копировать локально** имеет значение **True** для каждой упоминаемой в проекте сборки, которая не является частью пакета SDK для Azure или платформы .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d718d-112">If using Visual studio, make sure the **Copy Local** property is set to **True** for each referenced assembly in your project that is not part of the Azure SDK or the .NET Framework.</span></span>
* <span data-ttu-id="d718d-113">Убедитесь, что файл web.config не ссылается на любые неиспользуемые сборки в элементе compilation.</span><span class="sxs-lookup"><span data-stu-id="d718d-113">Make sure the web.config file does not reference any unused assemblies in the compilation element.</span></span>
* <span data-ttu-id="d718d-114">Параметр **Действие при сборке** для каждого CSHTML-файла имеет значение **Содержимое**.</span><span class="sxs-lookup"><span data-stu-id="d718d-114">The **Build Action** of every .cshtml file is set to **Content**.</span></span> <span data-ttu-id="d718d-115">Это обеспечивает правильное отображение файлов в пакете, а также позволяет указать в этом пакете другие файлы, на которые есть ссылки.</span><span class="sxs-lookup"><span data-stu-id="d718d-115">This ensures that the files will appear correctly in the package and enables other referenced files to appear in the package.</span></span>

## <a name="assembly-targets-wrong-platform"></a><span data-ttu-id="d718d-116">Сборка нацелена на неверную платформу.</span><span class="sxs-lookup"><span data-stu-id="d718d-116">Assembly targets wrong platform</span></span>
<span data-ttu-id="d718d-117">Azure является 64-разрядной средой.</span><span class="sxs-lookup"><span data-stu-id="d718d-117">Azure is a 64-bit environment.</span></span> <span data-ttu-id="d718d-118">Таким образом, сборки .NET, скомпилированные для 32-разрядной среды, не будут работать в Azure.</span><span class="sxs-lookup"><span data-stu-id="d718d-118">Therefore, .NET assemblies compiled for a 32-bit target won't work on Azure.</span></span>

## <a name="role-throws-unhandled-exceptions-while-initializing-or-stopping"></a><span data-ttu-id="d718d-119">Роль вызывает необработанные исключения во время инициализации или остановки.</span><span class="sxs-lookup"><span data-stu-id="d718d-119">Role throws unhandled exceptions while initializing or stopping</span></span>
<span data-ttu-id="d718d-120">Любые исключения, выдаваемые методами класса [RoleEntryPoint], к которым относятся [OnStart], [OnStop], и [Run], являются необработанными.</span><span class="sxs-lookup"><span data-stu-id="d718d-120">Any exceptions that are thrown by the methods of the [RoleEntryPoint] class, which includes the [OnStart], [OnStop], and [Run] methods, are unhandled exceptions.</span></span> <span data-ttu-id="d718d-121">В случае возникновения необработанного исключения в одном из этих методов роль будет перезапущена.</span><span class="sxs-lookup"><span data-stu-id="d718d-121">If an unhandled exception occurs in one of these methods, the role will recycle.</span></span> <span data-ttu-id="d718d-122">Если роль постоянно перезапускается, возможно, она вызывает необработанное исключение при каждой попытке запуска.</span><span class="sxs-lookup"><span data-stu-id="d718d-122">If the role is recycling repeatedly, it may be throwing an unhandled exception each time it tries to start.</span></span>

## <a name="role-returns-from-run-method"></a><span data-ttu-id="d718d-123">Роль возвращается из метода Run.</span><span class="sxs-lookup"><span data-stu-id="d718d-123">Role returns from Run method</span></span>
<span data-ttu-id="d718d-124">Метод [Run] должен работать постоянно.</span><span class="sxs-lookup"><span data-stu-id="d718d-124">The [Run] method is intended to run indefinitely.</span></span> <span data-ttu-id="d718d-125">Если ваш код переопределяет метод [Run] , он должен постоянно находиться в режиме ожидания.</span><span class="sxs-lookup"><span data-stu-id="d718d-125">If your code overrides the [Run] method, it should sleep indefinitely.</span></span> <span data-ttu-id="d718d-126">В случае возврата метода [Run] роль перезапускается.</span><span class="sxs-lookup"><span data-stu-id="d718d-126">If the [Run] method returns, the role recycles.</span></span>

## <a name="incorrect-diagnosticsconnectionstring-setting"></a><span data-ttu-id="d718d-127">Неверный параметр DiagnosticsConnectionString</span><span class="sxs-lookup"><span data-stu-id="d718d-127">Incorrect DiagnosticsConnectionString setting</span></span>
<span data-ttu-id="d718d-128">Если приложение использует систему диагностики Azure, то в CSCFG-файле необходимо указать параметр конфигурации `DiagnosticsConnectionString` .</span><span class="sxs-lookup"><span data-stu-id="d718d-128">If application uses Azure Diagnostics, your service configuration file must specify the `DiagnosticsConnectionString` configuration setting.</span></span> <span data-ttu-id="d718d-129">Этот параметр должен указывать HTTPS-подключение к вашей учетной записи хранения в Azure.</span><span class="sxs-lookup"><span data-stu-id="d718d-129">This setting should specify an HTTPS connection to your storage account in Azure.</span></span>

<span data-ttu-id="d718d-130">Чтобы убедиться в правильности параметра `DiagnosticsConnectionString` перед развертыванием пакета приложения в Azure, проверьте следующее.</span><span class="sxs-lookup"><span data-stu-id="d718d-130">To ensure that your `DiagnosticsConnectionString` setting is correct before you deploy your application package to Azure, verify the following:</span></span>  

* <span data-ttu-id="d718d-131">Параметр `DiagnosticsConnectionString` указывает на действительную учетную запись хранения в Azure.</span><span class="sxs-lookup"><span data-stu-id="d718d-131">The `DiagnosticsConnectionString` setting points to a valid storage account in Azure.</span></span>  
  <span data-ttu-id="d718d-132">По умолчанию этот параметр указывает на эмулированную учетную запись хранения, поэтому необходимо явным образом изменить его перед развертыванием пакета приложения.</span><span class="sxs-lookup"><span data-stu-id="d718d-132">By default, this setting points to the emulated storage account, so you must explicitly change this setting before you deploy your application package.</span></span> <span data-ttu-id="d718d-133">Если этого не сделать, то при попытке экземпляра роли запустить монитор диагностики возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="d718d-133">If you do not change this setting, an exception is thrown when the role instance attempts to start the diagnostic monitor.</span></span> <span data-ttu-id="d718d-134">Это может вызвать бесконечный перезапуск экземпляра роли.</span><span class="sxs-lookup"><span data-stu-id="d718d-134">This may cause the role instance to recycle indefinitely.</span></span>
* <span data-ttu-id="d718d-135">Строку подключения следует указывать в определенном [формате](../storage/common/storage-configure-connection-string.md).</span><span class="sxs-lookup"><span data-stu-id="d718d-135">The connection string is specified in the following [format](../storage/common/storage-configure-connection-string.md).</span></span> <span data-ttu-id="d718d-136">(необходимо задать протокол HTTPS). Замените *MyAccountName* именем своей учетной записи хранения, а *MyAccountKey* — своим ключом доступа:</span><span class="sxs-lookup"><span data-stu-id="d718d-136">(The protocol must be specified as HTTPS.) Replace *MyAccountName* with the name of your storage account, and *MyAccountKey* with your access key:</span></span>    

        DefaultEndpointsProtocol=https;AccountName=MyAccountName;AccountKey=MyAccountKey

  <span data-ttu-id="d718d-137">Если вы разрабатываете приложение с помощью инструментов Azure для Microsoft Visual Studio, чтобы задать это значение, можно использовать страницы свойств.</span><span class="sxs-lookup"><span data-stu-id="d718d-137">If you are developing your application by using Azure Tools for Microsoft Visual Studio, you can use the property pages to set this value.</span></span>

## <a name="exported-certificate-does-not-include-private-key"></a><span data-ttu-id="d718d-138">Экспортированный сертификат не содержит закрытый ключ.</span><span class="sxs-lookup"><span data-stu-id="d718d-138">Exported certificate does not include private key</span></span>
<span data-ttu-id="d718d-139">Чтобы запустить веб-роль с SSL, необходимо убедиться, что экспортированный сертификат управления содержит закрытый ключ.</span><span class="sxs-lookup"><span data-stu-id="d718d-139">To run a web role under SSL, you must ensure that your exported management certificate includes the private key.</span></span> <span data-ttu-id="d718d-140">При использовании *диспетчера сертификатов Windows* для экспорта сертификата обязательно выберите **Да** в качестве значения параметра **Экспорт закрытого ключа**.</span><span class="sxs-lookup"><span data-stu-id="d718d-140">If you use the *Windows Certificate Manager* to export the certificate, be sure to select **Yes** for the **Export the private key** option.</span></span> <span data-ttu-id="d718d-141">Сертификат следует экспортировать в формате PFX, так как в настоящее время поддерживается только он.</span><span class="sxs-lookup"><span data-stu-id="d718d-141">The certificate must be exported in the PFX format, which is the only format currently supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d718d-142">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="d718d-142">Next steps</span></span>
<span data-ttu-id="d718d-143">Просмотрите дополнительные [статьи об устранении неполадок](https://azure.microsoft.com/documentation/articles/?tag=top-support-issue&product=cloud-services) в облачных службах.</span><span class="sxs-lookup"><span data-stu-id="d718d-143">View more [troubleshooting articles](https://azure.microsoft.com/documentation/articles/?tag=top-support-issue&product=cloud-services) for cloud services.</span></span>

<span data-ttu-id="d718d-144">Дополнительные сценарии перезапуска ролей см. в [серии статей в блоге Кевина Уильямсона](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span><span class="sxs-lookup"><span data-stu-id="d718d-144">View more role recycling scenarios at [Kevin Williamson's blog series](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span></span>

[RoleEntryPoint]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx
[OnStart]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx
[OnStop]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx
[Run]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx
