---
title: "aaaHow tooupdate облачной службы | Документы Microsoft"
description: "Узнайте, как tooupdate облачных служб в Azure. Узнайте, как обновления в облачной службе происходит tooensure доступности."
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 7e4c8bd46e51a555b4309ea8927d120e8efcf0ea
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooupdate-a-cloud-service"></a><span data-ttu-id="b8406-104">Как tooupdate облачной службы</span><span class="sxs-lookup"><span data-stu-id="b8406-104">How tooupdate a cloud service</span></span>

<span data-ttu-id="b8406-105">Обновление облачной службы, включая ее роли или гостевую ОС, состоит их трех этапов.</span><span class="sxs-lookup"><span data-stu-id="b8406-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="b8406-106">Во-первых hello двоичные файлы и файлы конфигурации для hello новой облачной службы или версия ОС необходимо передать.</span><span class="sxs-lookup"><span data-stu-id="b8406-106">First, hello binaries and configuration files for hello new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="b8406-107">Далее Azure зарезервирует вычислительных и сетевых ресурсов для hello облачной службы в соответствии с требованиями hello hello новой версии облачной службы.</span><span class="sxs-lookup"><span data-stu-id="b8406-107">Next, Azure reserves compute and network resources for hello cloud service based on hello requirements of hello new cloud service version.</span></span> <span data-ttu-id="b8406-108">Наконец Azure выполняет последовательного обновления tooincrementally hello клиента toohello новые версии обновления или гостевой ОС, сохраняя доступность.</span><span class="sxs-lookup"><span data-stu-id="b8406-108">Finally, Azure performs a rolling upgrade tooincrementally update hello tenant toohello new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="b8406-109">В этой статье рассматриваются hello сведения об этом последнем шаге — hello последовательное обновление.</span><span class="sxs-lookup"><span data-stu-id="b8406-109">This article discusses hello details of this last step – hello rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="b8406-110">Обновление службы Azure</span><span class="sxs-lookup"><span data-stu-id="b8406-110">Update an Azure Service</span></span>
<span data-ttu-id="b8406-111">Azure распределяет экземпляры роли по логическим группам, которые называются доменами обновления.</span><span class="sxs-lookup"><span data-stu-id="b8406-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="b8406-112">Домены обновления — это логические наборы экземпляров ролей, которые обновляются одновременно.</span><span class="sxs-lookup"><span data-stu-id="b8406-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="b8406-113">Обновляет Azure облачной службы один UD одновременно, что позволит экземпляры других toocontinue доменам обновления, обслуживающий трафик.</span><span class="sxs-lookup"><span data-stu-id="b8406-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs toocontinue serving traffic.</span></span>

<span data-ttu-id="b8406-114">по умолчанию Hello, количество доменов обновления — 5.</span><span class="sxs-lookup"><span data-stu-id="b8406-114">hello default number of upgrade domains is 5.</span></span> <span data-ttu-id="b8406-115">Можно указать другое количество доменов обновления, включив атрибут upgradeDomainCount hello в файл определения hello службы (csdef).</span><span class="sxs-lookup"><span data-stu-id="b8406-115">You can specify a different number of upgrade domains by including hello upgradeDomainCount attribute in hello service’s definition file (.csdef).</span></span> <span data-ttu-id="b8406-116">Дополнительные сведения об атрибуте upgradeDomainCount hello см. в разделе [схема WebRole](https://msdn.microsoft.com/library/azure/gg557553.aspx) или [схема WorkerRole](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8406-116">For more information about hello upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="b8406-117">При выполнении обновления на месте одной или нескольких ролей в службе Azure обновляет наборы экземпляров ролей в соответствии с toowhich toohello домен обновления, которые они входят.</span><span class="sxs-lookup"><span data-stu-id="b8406-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according toohello upgrade domain toowhich they belong.</span></span> <span data-ttu-id="b8406-118">Обновления Azure, все экземпляры hello в заданном домене обновления — останавливает их, обновляет их, их снова делает доступными, перемещается на следующий домен hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-118">Azure updates all of hello instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto hello next domain.</span></span> <span data-ttu-id="b8406-119">Остановив только hello экземпляров, работающих в hello текущий домен обновления, Azure проверяет, выполнять обновление с минимальное возможное влияние toohello hello службой.</span><span class="sxs-lookup"><span data-stu-id="b8406-119">By stopping only hello instances running in hello current upgrade domain, Azure makes sure that an update occurs with hello least possible impact toohello running service.</span></span> <span data-ttu-id="b8406-120">Дополнительные сведения см. в разделе [как происходит обновление hello](#howanupgradeproceeds) далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="b8406-120">For more information, see [How hello update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="b8406-121">Хотя условия hello **обновление** и **обновление** имеют несколько различный смысл в контексте hello Azure, они взаимозаменяемы процессы hello и описание функций hello в этом документе.</span><span class="sxs-lookup"><span data-stu-id="b8406-121">While hello terms **update** and **upgrade** have slightly different meaning in hello context Azure, they can be used interchangeably for hello processes and descriptions of hello features in this document.</span></span>
>
>

<span data-ttu-id="b8406-122">Служба должна определять по крайней мере двух экземпляров роли для этой роли toobe обновление на месте без простоя.</span><span class="sxs-lookup"><span data-stu-id="b8406-122">Your service must define at least two instances of a role for that role toobe updated in-place without downtime.</span></span> <span data-ttu-id="b8406-123">Если служба hello состоит только из одного экземпляра одной роли, службы будет недоступна, пока hello обновления на месте завершения.</span><span class="sxs-lookup"><span data-stu-id="b8406-123">If hello service consists of only one instance of one role, your service will be unavailable until hello in-place update has finished.</span></span>

<span data-ttu-id="b8406-124">В этом разделе рассматриваются hello следующую информацию об обновлениях Azure:</span><span class="sxs-lookup"><span data-stu-id="b8406-124">This topic covers hello following information about Azure updates:</span></span>

* [<span data-ttu-id="b8406-125">Допустимые изменения службы во время обновления</span><span class="sxs-lookup"><span data-stu-id="b8406-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="b8406-126">Как происходит обновление</span><span class="sxs-lookup"><span data-stu-id="b8406-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="b8406-127">Откат обновления</span><span class="sxs-lookup"><span data-stu-id="b8406-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="b8406-128">Запуск нескольких операций изменения в текущем развертывании</span><span class="sxs-lookup"><span data-stu-id="b8406-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="b8406-129">Распределение ролей в доменах обновления</span><span class="sxs-lookup"><span data-stu-id="b8406-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="b8406-130">Допустимые изменения службы во время обновления</span><span class="sxs-lookup"><span data-stu-id="b8406-130">Allowed service changes during an update</span></span>
<span data-ttu-id="b8406-131">Hello следующей таблице показаны hello допускается изменения tooa службы во время обновления.</span><span class="sxs-lookup"><span data-stu-id="b8406-131">hello following table shows hello allowed changes tooa service during an update:</span></span>

| <span data-ttu-id="b8406-132">Разрешенные изменения toohosting, службы и роли</span><span class="sxs-lookup"><span data-stu-id="b8406-132">Changes permitted toohosting, services, and roles</span></span> | <span data-ttu-id="b8406-133">Обновление "на месте"</span><span class="sxs-lookup"><span data-stu-id="b8406-133">In-place update</span></span> | <span data-ttu-id="b8406-134">Промежуточная среда (переключение виртуального IP-адреса)</span><span class="sxs-lookup"><span data-stu-id="b8406-134">Staged (VIP swap)</span></span> | <span data-ttu-id="b8406-135">Удаление и повторное развертывание</span><span class="sxs-lookup"><span data-stu-id="b8406-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="b8406-136">Версия операционной системы</span><span class="sxs-lookup"><span data-stu-id="b8406-136">Operating system version</span></span> |<span data-ttu-id="b8406-137">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-137">Yes</span></span> |<span data-ttu-id="b8406-138">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-138">Yes</span></span> |<span data-ttu-id="b8406-139">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-139">Yes</span></span> |
| <span data-ttu-id="b8406-140">Уровень доверия .NET</span><span class="sxs-lookup"><span data-stu-id="b8406-140">.NET trust level</span></span> |<span data-ttu-id="b8406-141">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-141">Yes</span></span> |<span data-ttu-id="b8406-142">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-142">Yes</span></span> |<span data-ttu-id="b8406-143">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-143">Yes</span></span> |
| <span data-ttu-id="b8406-144">Размер виртуальной машины <sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="b8406-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="b8406-145">Да <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b8406-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="b8406-146">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-146">Yes</span></span> |<span data-ttu-id="b8406-147">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-147">Yes</span></span> |
| <span data-ttu-id="b8406-148">Параметры хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="b8406-148">Local storage settings</span></span> |<span data-ttu-id="b8406-149">Только увеличение <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b8406-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="b8406-150">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-150">Yes</span></span> |<span data-ttu-id="b8406-151">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-151">Yes</span></span> |
| <span data-ttu-id="b8406-152">Добавление и удаление ролей в службе</span><span class="sxs-lookup"><span data-stu-id="b8406-152">Add or remove roles in a service</span></span> |<span data-ttu-id="b8406-153">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-153">Yes</span></span> |<span data-ttu-id="b8406-154">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-154">Yes</span></span> |<span data-ttu-id="b8406-155">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-155">Yes</span></span> |
| <span data-ttu-id="b8406-156">Количество экземпляров определенной роли</span><span class="sxs-lookup"><span data-stu-id="b8406-156">Number of instances of a particular role</span></span> |<span data-ttu-id="b8406-157">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-157">Yes</span></span> |<span data-ttu-id="b8406-158">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-158">Yes</span></span> |<span data-ttu-id="b8406-159">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-159">Yes</span></span> |
| <span data-ttu-id="b8406-160">Количество и тип конечных точек службы</span><span class="sxs-lookup"><span data-stu-id="b8406-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="b8406-161">Да <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b8406-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="b8406-162">Нет</span><span class="sxs-lookup"><span data-stu-id="b8406-162">No</span></span> |<span data-ttu-id="b8406-163">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-163">Yes</span></span> |
| <span data-ttu-id="b8406-164">Имена и значения параметров конфигурации</span><span class="sxs-lookup"><span data-stu-id="b8406-164">Names and values of configuration settings</span></span> |<span data-ttu-id="b8406-165">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-165">Yes</span></span> |<span data-ttu-id="b8406-166">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-166">Yes</span></span> |<span data-ttu-id="b8406-167">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-167">Yes</span></span> |
| <span data-ttu-id="b8406-168">Только значения параметров конфигурации</span><span class="sxs-lookup"><span data-stu-id="b8406-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="b8406-169">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-169">Yes</span></span> |<span data-ttu-id="b8406-170">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-170">Yes</span></span> |<span data-ttu-id="b8406-171">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-171">Yes</span></span> |
| <span data-ttu-id="b8406-172">Добавление сертификатов</span><span class="sxs-lookup"><span data-stu-id="b8406-172">Add new certificates</span></span> |<span data-ttu-id="b8406-173">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-173">Yes</span></span> |<span data-ttu-id="b8406-174">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-174">Yes</span></span> |<span data-ttu-id="b8406-175">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-175">Yes</span></span> |
| <span data-ttu-id="b8406-176">Изменение существующих сертификатов</span><span class="sxs-lookup"><span data-stu-id="b8406-176">Change existing certificates</span></span> |<span data-ttu-id="b8406-177">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-177">Yes</span></span> |<span data-ttu-id="b8406-178">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-178">Yes</span></span> |<span data-ttu-id="b8406-179">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-179">Yes</span></span> |
| <span data-ttu-id="b8406-180">Развертывание нового кода</span><span class="sxs-lookup"><span data-stu-id="b8406-180">Deploy new code</span></span> |<span data-ttu-id="b8406-181">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-181">Yes</span></span> |<span data-ttu-id="b8406-182">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-182">Yes</span></span> |<span data-ttu-id="b8406-183">Да</span><span class="sxs-lookup"><span data-stu-id="b8406-183">Yes</span></span> |

<span data-ttu-id="b8406-184"><sup>1</sup> toohello подмножество размеры, доступные для облачной службы hello ограниченные изменения размера.</span><span class="sxs-lookup"><span data-stu-id="b8406-184"><sup>1</sup> Size change limited toohello subset of sizes available for hello cloud service.</span></span>

<span data-ttu-id="b8406-185"><sup>2</sup> Требуется пакет SDK Azure 1.5 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="b8406-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="b8406-186">Изменение размера виртуальной машины hello разрушит локальные данные.</span><span class="sxs-lookup"><span data-stu-id="b8406-186">Changing hello virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="b8406-187">во время обновления не поддерживаются Hello следующих элементов:</span><span class="sxs-lookup"><span data-stu-id="b8406-187">hello following items are not supported during an update:</span></span>

* <span data-ttu-id="b8406-188">Изменение имени роли hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-188">Changing hello name of a role.</span></span> <span data-ttu-id="b8406-189">Удалите, а затем добавьте hello роль с новым именем hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-189">Remove and then add hello role with hello new name.</span></span>
* <span data-ttu-id="b8406-190">Изменение счетчика доменов обновления hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-190">Changing of hello Upgrade Domain count.</span></span>
* <span data-ttu-id="b8406-191">Уменьшение размера hello hello локальных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="b8406-191">Decreasing hello size of hello local resources.</span></span>

<span data-ttu-id="b8406-192">Если производятся другие обновления определения tooyour службы, например уменьшается размер локального ресурса hello вместо этого необходимо выполнить обновление с переключением виртуальных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="b8406-192">If you are making other updates tooyour service's definition, such as decreasing hello size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="b8406-193">Дополнительные сведения см. в статье о [переключении развертывания](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8406-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="b8406-194">Как происходит обновление</span><span class="sxs-lookup"><span data-stu-id="b8406-194">How an upgrade proceeds</span></span>
<span data-ttu-id="b8406-195">Можно решить, следует ли tooupdate все роли hello в службе или в одной роли в службе hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-195">You can decide whether you want tooupdate all of hello roles in your service or a single role in hello service.</span></span> <span data-ttu-id="b8406-196">В любом случае все экземпляры каждой роли, которая обновляется и принадлежат toohello первый домен обновления останавливаются, обновить и возвращается в оперативный режим.</span><span class="sxs-lookup"><span data-stu-id="b8406-196">In either case, all instances of each role that is being upgraded and belong toohello first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="b8406-197">После их вернется в оперативный режим, hello экземпляров в hello втором домене обновления останавливаются, обновить и вернется в оперативный режим.</span><span class="sxs-lookup"><span data-stu-id="b8406-197">Once they are back online, hello instances in hello second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="b8406-198">Для каждой облачной службы в один момент времени выполняется только один процесс обновления.</span><span class="sxs-lookup"><span data-stu-id="b8406-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="b8406-199">Обновление Hello всегда выполняется для последней версии hello hello облачной службы.</span><span class="sxs-lookup"><span data-stu-id="b8406-199">hello upgrade is always performed against hello latest version of hello cloud service.</span></span>

<span data-ttu-id="b8406-200">Hello следующей схеме показана как hello обновление происходит при обновлении все роли hello в службе hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-200">hello following diagram illustrates how hello upgrade proceeds if you are upgrading all of hello roles in hello service:</span></span>

<span data-ttu-id="b8406-201">![Обновление службы](media/cloud-services-update-azure-service/IC345879.png "Обновление службы")</span><span class="sxs-lookup"><span data-stu-id="b8406-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="b8406-202">На следующей диаграмме показано, как происходит обновление hello при обновлении одной роли:</span><span class="sxs-lookup"><span data-stu-id="b8406-202">This next diagram illustrates how hello update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="b8406-203">![Обновление роли](media/cloud-services-update-azure-service/IC345880.png "Обновление роли")</span><span class="sxs-lookup"><span data-stu-id="b8406-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="b8406-204">Во время автоматического обновления hello Azure Fabric Controller периодически оценивает работоспособность hello hello облачной службы toodetermine при безопасном toowalk hello UD Далее.</span><span class="sxs-lookup"><span data-stu-id="b8406-204">During an automatic update, hello Azure Fabric Controller periodically evaluates hello health of hello cloud service toodetermine when it’s safe toowalk hello next UD.</span></span> <span data-ttu-id="b8406-205">Этой оценки работоспособности выполняется для каждой роли отдельно и рассматривает только экземпляры в последней версии hello (т. е. экземпляры из доменам обновления, которые уже были рассмотреть).</span><span class="sxs-lookup"><span data-stu-id="b8406-205">This health evaluation is performed on a per-role basis and considers only instances in hello latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="b8406-206">Чтобы служба считалась работоспособной, удовлетворительного конечного состояния должно достичь минимальное заданное количество экземпляров каждой роли.</span><span class="sxs-lookup"><span data-stu-id="b8406-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="b8406-207">Время ожидания запуска экземпляра роли</span><span class="sxs-lookup"><span data-stu-id="b8406-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="b8406-208">Hello контроллер структуры будет ожидать 30 минут для каждой роли экземпляра tooreach состоянии Started.</span><span class="sxs-lookup"><span data-stu-id="b8406-208">hello Fabric Controller will wait 30 minutes for each role instance tooreach a Started state.</span></span> <span data-ttu-id="b8406-209">Если истекает время ожидания hello, hello Fabric Controller продолжит проходу toohello следующего экземпляра роли.</span><span class="sxs-lookup"><span data-stu-id="b8406-209">If hello timeout duration elapses, hello Fabric Controller will continue walking toohello next role instance.</span></span>

### <a name="impact-toodrive-data-during-cloud-service-upgrades"></a><span data-ttu-id="b8406-210">Данные влияния toodrive во время обновления облачной службы</span><span class="sxs-lookup"><span data-stu-id="b8406-210">Impact toodrive data during Cloud Service upgrades</span></span>

<span data-ttu-id="b8406-211">При обновлении службы из toomultiple единственных экземпляров службы будет отключена время hello обновления из-за способа toohello Azure обновляет по службами.</span><span class="sxs-lookup"><span data-stu-id="b8406-211">When upgrading a service from a single instance toomultiple instances your service will be brought down while hello upgrade is performed due toohello way Azure upgrades services.</span></span> <span data-ttu-id="b8406-212">гарантирующее доступность службы Hello службы соглашения об уровне применяется только tooservices, которые развертываются с более чем одним экземпляром.</span><span class="sxs-lookup"><span data-stu-id="b8406-212">hello service level agreement guaranteeing service availability only applies tooservices that are deployed with more than one instance.</span></span> <span data-ttu-id="b8406-213">Hello следующий список описывает влияние hello данные на каждом диске сценариев обновления службы Azure:</span><span class="sxs-lookup"><span data-stu-id="b8406-213">hello following list describes how hello data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="b8406-214">Сценарий</span><span class="sxs-lookup"><span data-stu-id="b8406-214">Scenario</span></span>|<span data-ttu-id="b8406-215">Диск C</span><span class="sxs-lookup"><span data-stu-id="b8406-215">C Drive</span></span>|<span data-ttu-id="b8406-216">Диск D</span><span class="sxs-lookup"><span data-stu-id="b8406-216">D Drive</span></span>|<span data-ttu-id="b8406-217">Диск Е</span><span class="sxs-lookup"><span data-stu-id="b8406-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="b8406-218">Перезагрузка виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="b8406-218">VM reboot</span></span>|<span data-ttu-id="b8406-219">Сохраняются</span><span class="sxs-lookup"><span data-stu-id="b8406-219">Preserved</span></span>|<span data-ttu-id="b8406-220">Сохраняются</span><span class="sxs-lookup"><span data-stu-id="b8406-220">Preserved</span></span>|<span data-ttu-id="b8406-221">Сохраняются</span><span class="sxs-lookup"><span data-stu-id="b8406-221">Preserved</span></span>|
|<span data-ttu-id="b8406-222">Перезагрузка портала</span><span class="sxs-lookup"><span data-stu-id="b8406-222">Portal reboot</span></span>|<span data-ttu-id="b8406-223">Сохраняются</span><span class="sxs-lookup"><span data-stu-id="b8406-223">Preserved</span></span>|<span data-ttu-id="b8406-224">Сохраняются</span><span class="sxs-lookup"><span data-stu-id="b8406-224">Preserved</span></span>|<span data-ttu-id="b8406-225">Уничтожаются</span><span class="sxs-lookup"><span data-stu-id="b8406-225">Destroyed</span></span>|
|<span data-ttu-id="b8406-226">Пересоздание образа портала</span><span class="sxs-lookup"><span data-stu-id="b8406-226">Portal reimage</span></span>|<span data-ttu-id="b8406-227">Сохраняются</span><span class="sxs-lookup"><span data-stu-id="b8406-227">Preserved</span></span>|<span data-ttu-id="b8406-228">Уничтожаются</span><span class="sxs-lookup"><span data-stu-id="b8406-228">Destroyed</span></span>|<span data-ttu-id="b8406-229">Уничтожаются</span><span class="sxs-lookup"><span data-stu-id="b8406-229">Destroyed</span></span>|
|<span data-ttu-id="b8406-230">Обновление «на месте»</span><span class="sxs-lookup"><span data-stu-id="b8406-230">In-Place Upgrade</span></span>|<span data-ttu-id="b8406-231">Сохраняются</span><span class="sxs-lookup"><span data-stu-id="b8406-231">Preserved</span></span>|<span data-ttu-id="b8406-232">Сохраняются</span><span class="sxs-lookup"><span data-stu-id="b8406-232">Preserved</span></span>|<span data-ttu-id="b8406-233">Уничтожаются</span><span class="sxs-lookup"><span data-stu-id="b8406-233">Destroyed</span></span>|
|<span data-ttu-id="b8406-234">Миграция узла</span><span class="sxs-lookup"><span data-stu-id="b8406-234">Node migration</span></span>|<span data-ttu-id="b8406-235">Уничтожаются</span><span class="sxs-lookup"><span data-stu-id="b8406-235">Destroyed</span></span>|<span data-ttu-id="b8406-236">Уничтожаются</span><span class="sxs-lookup"><span data-stu-id="b8406-236">Destroyed</span></span>|<span data-ttu-id="b8406-237">Уничтожаются</span><span class="sxs-lookup"><span data-stu-id="b8406-237">Destroyed</span></span>|

<span data-ttu-id="b8406-238">Обратите внимание, что, в hello над списком hello диск E: представляет корневой диск роли hello не следует жестко.</span><span class="sxs-lookup"><span data-stu-id="b8406-238">Note that, in hello above list, hello E: drive represents hello role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="b8406-239">Вместо этого используйте hello **% RoleRoot %** диск hello toorepresent переменной среды.</span><span class="sxs-lookup"><span data-stu-id="b8406-239">Instead, use hello **%RoleRoot%** environment variable toorepresent hello drive.</span></span>

<span data-ttu-id="b8406-240">toominimize hello простоя при обновлении экземпляра службы, развертывание нового нескольких экземпляров службы toohello промежуточного сервера и выполнить переключение виртуального IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="b8406-240">toominimize hello downtime when upgrading a single-instance service, deploy a new multi-instance service toohello staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="b8406-241">Откат обновления</span><span class="sxs-lookup"><span data-stu-id="b8406-241">Rollback of an update</span></span>
<span data-ttu-id="b8406-242">Azure предоставляет гибкость в управлении службами во время обновления, позволяя проводить дополнительные действия для службы, после hello первый запрос изменения принимается hello Azure Fabric Controller.</span><span class="sxs-lookup"><span data-stu-id="b8406-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after hello initial update request is accepted by hello Azure Fabric Controller.</span></span> <span data-ttu-id="b8406-243">Откат может выполняться, только когда обновление (изменение конфигурации), а также обновление находится в hello **выполняется** состояния hello в развертывании.</span><span class="sxs-lookup"><span data-stu-id="b8406-243">A rollback can only be performed when an update (configuration change) or upgrade is in hello **in progress** state on hello deployment.</span></span> <span data-ttu-id="b8406-244">Установка обновления или обновления считается toobe выполняется при условии, что по крайней мере один экземпляр службы hello, которая еще не обновленные toohello новой версии.</span><span class="sxs-lookup"><span data-stu-id="b8406-244">An update or upgrade is considered toobe in-progress as long as there is at least one instance of hello service which has not yet been updated toohello new version.</span></span> <span data-ttu-id="b8406-245">tootest запрет на откат, проверьте hello значение флага RollbackAllowed hello, возвращенных [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) и [получение свойств облачной службы](https://msdn.microsoft.com/library/azure/ee460806.aspx) операций, имеет значение tootrue.</span><span class="sxs-lookup"><span data-stu-id="b8406-245">tootest whether a rollback is allowed, check hello value of hello RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set tootrue.</span></span>

> [!NOTE]
> <span data-ttu-id="b8406-246">Только делает toocall смысле Rollback на **на месте** обновления или обновления, поскольку виртуальных IP-адресов вызывают замену одного работающего экземпляра службы с другим.</span><span class="sxs-lookup"><span data-stu-id="b8406-246">It only makes sense toocall Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="b8406-247">Откат выполняющегося обновления имеет следующие эффекты в развертывании hello hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-247">Rollback of an in-progress update has hello following effects on hello deployment:</span></span>

* <span data-ttu-id="b8406-248">Все экземпляры ролей, которые еще не выполнялось toohello обновленные или обновить новую версию не обновляются или обновлены, поскольку в этих экземплярах уже выполняется целевая версия службы hello hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-248">Any role instances which had not yet been updated or upgraded toohello new version are not updated or upgraded, because those instances are already running hello target version of hello service.</span></span>
* <span data-ttu-id="b8406-249">Любой роли экземпляров, которая уже была обновлена или обновленные toohello новой версии пакета обновления hello (\*.cspkg) файла или hello конфигурации службы (\*.cscfg) файла (или оба файла), возвращенной toohello до обновления версии Эти файлы.</span><span class="sxs-lookup"><span data-stu-id="b8406-249">Any role instances which had already been updated or upgraded toohello new version of hello service package (\*.cspkg) file or hello service configuration (\*.cscfg) file (or both files) are reverted toohello pre-upgrade version of these files.</span></span>

<span data-ttu-id="b8406-250">Эта функциональность предоставляется с hello следующие атрибуты:</span><span class="sxs-lookup"><span data-stu-id="b8406-250">This functionally is provided by hello following features:</span></span>

* <span data-ttu-id="b8406-251">Hello [отката обновления или обновления](https://msdn.microsoft.com/library/azure/hh403977.aspx) операцию, которая может быть вызван для обновления конфигурации (срабатывает при вызове [изменение конфигурации развертывания](https://msdn.microsoft.com/library/azure/ee460809.aspx)) или обновления (срабатывает при вызове [ Обновление развертывания](https://msdn.microsoft.com/library/azure/ee460793.aspx)) при условии, что имеется по крайней мере один экземпляр в службе hello которого еще не был обновлен toohello новой версии.</span><span class="sxs-lookup"><span data-stu-id="b8406-251">hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in hello service which has not yet been updated toohello new version.</span></span>
* <span data-ttu-id="b8406-252">Здравствуйте, Locked и hello RollbackAllowed элементы, которые возвращаются в составе hello в тексте ответа hello [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) и [получение свойств облачной службы](https://msdn.microsoft.com/library/azure/ee460806.aspx) операций:</span><span class="sxs-lookup"><span data-stu-id="b8406-252">hello Locked element and hello RollbackAllowed element, which are returned as part of hello response body of hello [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="b8406-253">элемент заблокирован Hello позволяет toodetect при операции изменения можно вызвать в заданном развертывании.</span><span class="sxs-lookup"><span data-stu-id="b8406-253">hello Locked element allows you toodetect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="b8406-254">Hello RollbackAllowed элемент позволяет toodetect при hello [отката обновления](https://msdn.microsoft.com/library/azure/hh403977.aspx) операция может быть вызвана в заданном развертывании.</span><span class="sxs-lookup"><span data-stu-id="b8406-254">hello RollbackAllowed element allows you toodetect when hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="b8406-255">В tooperform порядок откат у вас toocheck hello Locked и hello RollbackAllowed элементов.</span><span class="sxs-lookup"><span data-stu-id="b8406-255">In order tooperform a rollback, you do not have toocheck both hello Locked and hello RollbackAllowed elements.</span></span> <span data-ttu-id="b8406-256">Будет достаточным tooconfirm, что RollbackAllowed имеет значение tootrue.</span><span class="sxs-lookup"><span data-stu-id="b8406-256">It suffices tooconfirm that RollbackAllowed is set tootrue.</span></span> <span data-ttu-id="b8406-257">Эти элементы возвращаются только в том случае, если эти методы вызываются с помощью слишком набор заголовков запроса hello "x-ms-version: 2011-10-01» или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="b8406-257">These elements are only returned if these methods are invoked by using hello request header set too“x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="b8406-258">Подробнее о заголовках управления версиями см. в статье [Работа с версиями при управлении службами](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8406-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="b8406-259">Существуют ситуации, когда откат обновления невозможен. Примеры таких ситуаций представлены ниже.</span><span class="sxs-lookup"><span data-stu-id="b8406-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="b8406-260">Сокращение на локальных ресурсах — Если hello обновления увеличивается hello локальных ресурсов для роли hello платформы Azure разрешает откат.</span><span class="sxs-lookup"><span data-stu-id="b8406-260">Reduction in local resources - If hello update increases hello local resources for a role hello Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="b8406-261">Ограничения квоты — Если hello обновление было операцией масштабирования вниз, у вас может не иметь достаточно вычислительные операции отката hello квоты toocomplete.</span><span class="sxs-lookup"><span data-stu-id="b8406-261">Quota limitations - If hello update was a scale down operation you may no longer have sufficient compute quota toocomplete hello rollback operation.</span></span> <span data-ttu-id="b8406-262">Каждая подписка Azure имеет квоту, связанные с ним, указывающее максимальное количество ядер, которые могут использоваться всеми размещенными службами, которые принадлежат toothat подписки hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-262">Each Azure subscription has a quota associated with it that specifies hello maximum number of cores which can be consumed by all hosted services that belong toothat subscription.</span></span> <span data-ttu-id="b8406-263">Если для выполнения отката обновления требуется превысить квоту подписки, такой откат будет запрещен.</span><span class="sxs-lookup"><span data-stu-id="b8406-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="b8406-264">Гонки — Если hello начальное Обновление завершено, откат невозможен.</span><span class="sxs-lookup"><span data-stu-id="b8406-264">Race condition - If hello initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="b8406-265">Пример когда hello откат обновления может быть полезным — Если вы используете hello [обновление развертывания](https://msdn.microsoft.com/library/azure/ee460793.aspx) распространен операции в ручной режим toocontrol hello скорость, с которой основных tooyour обновления на месте Azure размещенной службы.</span><span class="sxs-lookup"><span data-stu-id="b8406-265">An example of when hello rollback of an update might be useful is if you are using hello [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode toocontrol hello rate at which a major in-place upgrade tooyour Azure hosted service is rolled out.</span></span>

<span data-ttu-id="b8406-266">Во время этого этапа hello обновления hello вызвать [обновление развертывания](https://msdn.microsoft.com/library/azure/ee460793.aspx) в ручном режиме и начать toowalk доменов обновления.</span><span class="sxs-lookup"><span data-stu-id="b8406-266">During hello rollout of hello upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin toowalk upgrade domains.</span></span> <span data-ttu-id="b8406-267">Если в определенный момент при наблюдении за обновление hello, можно выполнить некоторые экземпляры роли в hello первые обновления домены, которые вы рассматриваете, перестали отвечать, вы можете вызвать hello [отката обновления](https://msdn.microsoft.com/library/azure/hh403977.aspx) операции hello в развертывании, который останется без изменений hello экземпляров, которые еще не были обновлены и откатит экземпляры, которые бы была обновлена toohello предыдущего пакета служб и конфигурации.</span><span class="sxs-lookup"><span data-stu-id="b8406-267">If at some point, as you monitor hello upgrade, you note some role instances in hello first upgrade domains that you examine have become unresponsive, you can call hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on hello deployment, which will leave untouched hello instances which had not yet been upgraded and rollback instances which had been upgraded toohello previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="b8406-268">Запуск нескольких операций изменения в текущем развертывании</span><span class="sxs-lookup"><span data-stu-id="b8406-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="b8406-269">В некоторых случаях может понадобиться tooinitiate множественных одновременных операций изменения в текущем развертывании.</span><span class="sxs-lookup"><span data-stu-id="b8406-269">In some cases you may want tooinitiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="b8406-270">Например может выполнить обновление службы и, хотя это обновление разворачивается в службе, требуется toomake некоторые изменения, например tooroll hello обновление назад, применить другое обновление или даже удалить развертывание hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want toomake some change, e.g. tooroll hello update back, apply a different update, or even delete hello deployment.</span></span> <span data-ttu-id="b8406-271">Случай, в котором такая необходимость может возникнуть — если обновление службы содержит дефектный код, который вызывает сбой toorepeatedly обновленного роли экземпляра.</span><span class="sxs-lookup"><span data-stu-id="b8406-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance toorepeatedly crash.</span></span> <span data-ttu-id="b8406-272">В этом случае hello Azure Fabric Controller не будет возможности toomake продолжить применение этого обновления из-за недостаточного количества экземпляров в домене обновления hello находятся в работоспособном состоянии.</span><span class="sxs-lookup"><span data-stu-id="b8406-272">In this case, hello Azure Fabric Controller will not be able toomake progress in applying that upgrade because an insufficient number of instances in hello upgraded domain are healthy.</span></span> <span data-ttu-id="b8406-273">Это состояние является ссылка tooas *застрявшее развертывание*.</span><span class="sxs-lookup"><span data-stu-id="b8406-273">This state is referred tooas a *stuck deployment*.</span></span> <span data-ttu-id="b8406-274">Откат обновления hello или применения свежего обновления поверх hello сбой одного можно запуске развертывания hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-274">You can unstick hello deployment by rolling back hello update or applying a fresh update over top of hello failing one.</span></span>

<span data-ttu-id="b8406-275">После получения hello начального запроса обновления или tooupdate hello службы по hello Azure Fabric Controller можно начинать последующие операции изменения.</span><span class="sxs-lookup"><span data-stu-id="b8406-275">Once hello initial request tooupdate or upgrade hello service has been received by hello Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="b8406-276">То есть у вас toowait для начальной операции toocomplete hello перед началом другой операции изменения.</span><span class="sxs-lookup"><span data-stu-id="b8406-276">That is, you do not have toowait for hello initial operation toocomplete before you can start another mutating operation.</span></span>

<span data-ttu-id="b8406-277">Запуск второй операции обновления, во время первого обновления hello будет выполнять аналогичные операции отката toohello.</span><span class="sxs-lookup"><span data-stu-id="b8406-277">Initiating a second update operation while hello first update is ongoing will perform similar toohello rollback operation.</span></span> <span data-ttu-id="b8406-278">Если hello второе обновление проводится в автоматическом режиме, hello первый домен обновления будет обновлен немедленно, могущие привести tooinstances из нескольких доменов обновления, находится в автономном режиме на hello же момент времени.</span><span class="sxs-lookup"><span data-stu-id="b8406-278">If hello second update is in automatic mode, hello first upgrade domain will be upgraded immediately, possibly leading tooinstances from multiple upgrade domains being offline at hello same point in time.</span></span>

<span data-ttu-id="b8406-279">Hello изменяющаяся протоколируются следующие операции: [изменение конфигурации развертывания](https://msdn.microsoft.com/library/azure/ee460809.aspx), [обновление развертывания](https://msdn.microsoft.com/library/azure/ee460793.aspx), [состояние развертывания обновлений](https://msdn.microsoft.com/library/azure/ee460808.aspx), [удалить Развертывание](https://msdn.microsoft.com/library/azure/ee460815.aspx), и [отката обновления или модернизации](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8406-279">hello mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="b8406-280">Две операции [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) и [получение свойств облачной службы](https://msdn.microsoft.com/library/azure/ee460806.aspx), возвращают флаг заблокирована hello, который может быть проверенных toodetermine ли предпринять операцию можно вызвать в заданном развертывании.</span><span class="sxs-lookup"><span data-stu-id="b8406-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return hello Locked flag which can be examined toodetermine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="b8406-281">В порядке toocall hello версии этих методов возвращающий флаг hello заблокирована, необходимо установить заголовок запроса слишком "x-ms-version: 2011-10-01» или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="b8406-281">In order toocall hello version of these methods which returns hello Locked flag, you must set request header too“x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="b8406-282">Подробнее о заголовках управления версиями см. в статье [Работа с версиями при управлении службами](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8406-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="b8406-283">Распределение ролей в доменах обновления</span><span class="sxs-lookup"><span data-stu-id="b8406-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="b8406-284">Azure распределяет экземпляры роли равномерно по определенному набору доменов обновления, которые могут быть настроены как часть файла определения службы(.csdef) hello службы.</span><span class="sxs-lookup"><span data-stu-id="b8406-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of hello service definition (.csdef) file.</span></span> <span data-ttu-id="b8406-285">Hello максимальное количество доменов обновления — 20 и hello по умолчанию равно 5.</span><span class="sxs-lookup"><span data-stu-id="b8406-285">hello max number of upgrade domains is 20 and hello default is 5.</span></span> <span data-ttu-id="b8406-286">Дополнительные сведения о том, как toomodify hello файла определения службы см. в разделе [схема определения службы Azure (.csdef файла)](cloud-services-model-and-package.md#csdef).</span><span class="sxs-lookup"><span data-stu-id="b8406-286">For more information about how toomodify hello service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="b8406-287">Например, для роли с 10 экземплярами к каждому домену обновления по умолчанию будет отнесено 2 экземпляра.</span><span class="sxs-lookup"><span data-stu-id="b8406-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="b8406-288">Если ваша роль содержит 14 экземпляров, то четыре hello доменов обновления содержат 3 экземпляра, а пятый домен содержит 2.</span><span class="sxs-lookup"><span data-stu-id="b8406-288">If your role has 14 instances, then four of hello upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="b8406-289">Домены обновления определяются с отсчетом от нуля: hello первый домен обновления имеет идентификатор 0, а hello второй домен обновления имеет идентификатор 1 и т. д.</span><span class="sxs-lookup"><span data-stu-id="b8406-289">Upgrade domains are identified with a zero-based index: hello first upgrade domain has an ID of 0, and hello second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="b8406-290">Hello следующая диаграмма иллюстрирует как служба, содержащая две роли распределяются при hello службы определяется в двух доменах обновления.</span><span class="sxs-lookup"><span data-stu-id="b8406-290">hello following diagram illustrates how a service than contains two roles are distributed when hello service defines two upgrade domains.</span></span> <span data-ttu-id="b8406-291">запущена служба Hello восьми экземпляров hello веб-роли и 9 экземпляров рабочей роли hello.</span><span class="sxs-lookup"><span data-stu-id="b8406-291">hello service is running eight instances of hello web role and nine instances of hello worker role.</span></span>

<span data-ttu-id="b8406-292">![Распределение доменов обновления](media/cloud-services-update-azure-service/IC345533.png "Распределение доменов обновления")</span><span class="sxs-lookup"><span data-stu-id="b8406-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="b8406-293">Обратите внимание, что распределением экземпляров в домены обновления управляет Azure.</span><span class="sxs-lookup"><span data-stu-id="b8406-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="b8406-294">Это не возможные toospecify экземпляры, которые выделяются toowhich домена.</span><span class="sxs-lookup"><span data-stu-id="b8406-294">It's not possible toospecify which instances are allocated toowhich domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="b8406-295">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b8406-295">Next steps</span></span>
[<span data-ttu-id="b8406-296">Как tooManage облачных служб</span><span class="sxs-lookup"><span data-stu-id="b8406-296">How tooManage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="b8406-297">Как tooMonitor облачных служб</span><span class="sxs-lookup"><span data-stu-id="b8406-297">How tooMonitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="b8406-298">Как tooConfigure облачных служб</span><span class="sxs-lookup"><span data-stu-id="b8406-298">How tooConfigure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
