---
title: "Рекомендации по настройке производительности Hive в Azure Data Lake Store | Документация Майкрософт"
description: "Рекомендации по настройке производительности Hive в Azure Data Lake Store"
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: e10bf8f7cbae2b81d22823ff74fe652c6bcb2da3
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="performance-tuning-guidance-for-hive-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="e8d78-103">Рекомендации по настройке производительности Hive в HDInsight и Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="e8d78-103">Performance tuning guidance for Hive on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="e8d78-104">По умолчанию устанавливаются параметры, которые должны обеспечить оптимальную производительность для самых разных сценариев использования.</span><span class="sxs-lookup"><span data-stu-id="e8d78-104">The default settings have been set to provide good performance across many different use cases.</span></span>  <span data-ttu-id="e8d78-105">Но для запросов, предполагающих интенсивное выполнение операций ввода-вывода, производительность Hive в Azure Data Lake Store можно повысить, изменив некоторые настройки.</span><span class="sxs-lookup"><span data-stu-id="e8d78-105">For I/O intensive queries, Hive can be tuned to get better performance with ADLS.</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="e8d78-106">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="e8d78-106">Prerequisites</span></span>

* <span data-ttu-id="e8d78-107">**Подписка Azure**.</span><span class="sxs-lookup"><span data-stu-id="e8d78-107">**An Azure subscription**.</span></span> <span data-ttu-id="e8d78-108">Ознакомьтесь с [бесплатной пробной версией Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="e8d78-108">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="e8d78-109">**Учетная запись Azure Data Lake Store.**</span><span class="sxs-lookup"><span data-stu-id="e8d78-109">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="e8d78-110">Инструкции по созданию учетной записи см. в статье [Начало работы с Azure Data Lake Store с помощью портала Azure](data-lake-store-get-started-portal.md).</span><span class="sxs-lookup"><span data-stu-id="e8d78-110">For instructions on how to create one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md)</span></span>
* <span data-ttu-id="e8d78-111">**Кластер Azure HDInsight** с доступом к учетной записи Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="e8d78-111">**Azure HDInsight cluster** with access to a Data Lake Store account.</span></span> <span data-ttu-id="e8d78-112">См. статью [Создание кластера HDInsight с Data Lake Store с помощью портала Azure](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="e8d78-112">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="e8d78-113">Убедитесь, что вы включили удаленный рабочий стол для кластера.</span><span class="sxs-lookup"><span data-stu-id="e8d78-113">Make sure you enable Remote Desktop for the cluster.</span></span>
* <span data-ttu-id="e8d78-114">**Запустите Hive в HDInsight**.</span><span class="sxs-lookup"><span data-stu-id="e8d78-114">**Running Hive on HDInsight**.</span></span>  <span data-ttu-id="e8d78-115">Дополнительные сведения о выполнении заданий Hive в HDInsight см. в статье [Использование Hive и HiveQL с Hadoop в HDInsight для анализа примера файла Apache log4j] (https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-use-hive)</span><span class="sxs-lookup"><span data-stu-id="e8d78-115">To learn about running Hive jobs on HDInsight, see [Use Hive on HDInsight] (https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-use-hive)</span></span>
* <span data-ttu-id="e8d78-116">**Рекомендации по настройке производительности в Azure Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="e8d78-116">**Performance tuning guidelines on ADLS**.</span></span>  <span data-ttu-id="e8d78-117">См. [рекомендации по настройке производительности для Azure Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="e8d78-117">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance)</span></span>

## <a name="parameters"></a><span data-ttu-id="e8d78-118">Параметры</span><span class="sxs-lookup"><span data-stu-id="e8d78-118">Parameters</span></span>

<span data-ttu-id="e8d78-119">Ниже приведены наиболее важные параметры, которые помогут повысить производительность Azure Data Lake Store:</span><span class="sxs-lookup"><span data-stu-id="e8d78-119">Here are the most important settings to tune for improved ADLS performance:</span></span>

* <span data-ttu-id="e8d78-120">**hive.tez.container.size** — объем памяти, используемой для каждой задачи;</span><span class="sxs-lookup"><span data-stu-id="e8d78-120">**hive.tez.container.size** – the amount of memory used by each tasks</span></span>

* <span data-ttu-id="e8d78-121">**tez.grouping.min-size** — минимальный размер каждого модуля сопоставления;</span><span class="sxs-lookup"><span data-stu-id="e8d78-121">**tez.grouping.min-size** – minimum size of each mapper</span></span>

* <span data-ttu-id="e8d78-122">**tez.grouping.max-size** — максимальный размер каждого модуля сопоставления;</span><span class="sxs-lookup"><span data-stu-id="e8d78-122">**tez.grouping.max-size** – maximum size of each mapper</span></span>

* <span data-ttu-id="e8d78-123">**hive.exec.reducer.bytes.per.reducer** — размер каждого модуля уменьшения.</span><span class="sxs-lookup"><span data-stu-id="e8d78-123">**hive.exec.reducer.bytes.per.reducer** – size of each reducer</span></span>

<span data-ttu-id="e8d78-124">**hive.tez.container.size** — размер контейнера, который определяет объем доступной памяти для каждого задания.</span><span class="sxs-lookup"><span data-stu-id="e8d78-124">**hive.tez.container.size** - The container size determines how much memory is available for each task.</span></span>  <span data-ttu-id="e8d78-125">Это главный параметр для управления параллелизмом в Hive.</span><span class="sxs-lookup"><span data-stu-id="e8d78-125">This is the main input for controlling the concurrency in Hive.</span></span>  

<span data-ttu-id="e8d78-126">**tez.grouping.min-size** — этот параметр позволяет задать минимальный размер каждого модуля сопоставления.</span><span class="sxs-lookup"><span data-stu-id="e8d78-126">**tez.grouping.min-size** – This parameter allows you to set the minimum size of each mapper.</span></span>  <span data-ttu-id="e8d78-127">Если число модулей сопоставления, которые выбирает Tez, окажется меньше, чем значение этого параметра, Tez будет использовать заданное здесь значение.</span><span class="sxs-lookup"><span data-stu-id="e8d78-127">If the number of mappers that Tez chooses is smaller than the value of this parameter, then Tez will use the value set here.</span></span>  

<span data-ttu-id="e8d78-128">**tez.grouping.max-size** — этот параметр позволяет задать максимальный размер каждого модуля сопоставления.</span><span class="sxs-lookup"><span data-stu-id="e8d78-128">**tez.grouping.max-size** – The parameter allows you to set the maximum size of each mapper.</span></span>  <span data-ttu-id="e8d78-129">Если число модулей сопоставления, которые выбирает Tez, окажется больше, чем значение этого параметра, Tez будет использовать заданное здесь значение.</span><span class="sxs-lookup"><span data-stu-id="e8d78-129">If the number of mappers that Tez chooses is larger than the value of this parameter, then Tez will use the value set here.</span></span>  

<span data-ttu-id="e8d78-130">**hive.exec.reducer.bytes.per.reducer** — этот параметр задает размер каждого модуля уменьшения.</span><span class="sxs-lookup"><span data-stu-id="e8d78-130">**hive.exec.reducer.bytes.per.reducer** – This parameter sets the size of each reducer.</span></span>  <span data-ttu-id="e8d78-131">По умолчанию используется размер 256 МБ.</span><span class="sxs-lookup"><span data-stu-id="e8d78-131">By default, each reducer is 256MB.</span></span>  

## <a name="guidance"></a><span data-ttu-id="e8d78-132">Руководство</span><span class="sxs-lookup"><span data-stu-id="e8d78-132">Guidance</span></span>

<span data-ttu-id="e8d78-133">**Задайте hive.exec.reducer.bytes.per.reducer** — значение по умолчанию хорошо работает для несжатых данных.</span><span class="sxs-lookup"><span data-stu-id="e8d78-133">**Set hive.exec.reducer.bytes.per.reducer** – The default value works well when the data is uncompressed.</span></span>  <span data-ttu-id="e8d78-134">Если используются сжатые данные, попробуйте сократить размер модуля уменьшения редукции.</span><span class="sxs-lookup"><span data-stu-id="e8d78-134">For data that is compressed, you should reduce the size of the reducer.</span></span>  

<span data-ttu-id="e8d78-135">**Задайте hive.tez.container.size** — объем памяти для каждого узла, который определяется параметром yarn.nodemanager.resource.memory-mb (должен быть правильно определен для кластера HDI по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="e8d78-135">**Set hive.tez.container.size** – In each node, memory is specified by yarn.nodemanager.resource.memory-mb and should be correctly set on HDI cluster by default.</span></span>  <span data-ttu-id="e8d78-136">Дополнительные сведения о настройке памяти в YARN см. в этой [записи блога](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-hive-out-of-memory-error-oom).</span><span class="sxs-lookup"><span data-stu-id="e8d78-136">For additional information on setting the appropriate memory in YARN, see this [post](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-hive-out-of-memory-error-oom).</span></span>

<span data-ttu-id="e8d78-137">Для интенсивных нагрузок ввода-вывода будет полезным увеличить параллелизм, снижая размер контейнера Tez.</span><span class="sxs-lookup"><span data-stu-id="e8d78-137">I/O intensive workloads can benefit from more parallelism by decreasing the Tez container size.</span></span> <span data-ttu-id="e8d78-138">Это предоставит пользователю дополнительные контейнеры, то есть увеличит параллелизм.</span><span class="sxs-lookup"><span data-stu-id="e8d78-138">This gives the user more containers which increases concurrency.</span></span>  <span data-ttu-id="e8d78-139">Но некоторые запросы Hive требуют значительного объема памяти (например, MapJoin).</span><span class="sxs-lookup"><span data-stu-id="e8d78-139">However, some Hive queries require a significant amount of memory (e.g. MapJoin).</span></span>  <span data-ttu-id="e8d78-140">Если задача не получит достаточного объема памяти, во время выполнения возникнет соответствующее исключение.</span><span class="sxs-lookup"><span data-stu-id="e8d78-140">If the task does not have enough memory, you will get an out of memory exception during runtime.</span></span>  <span data-ttu-id="e8d78-141">Если вы заметите такие исключения, увеличьте объем памяти.</span><span class="sxs-lookup"><span data-stu-id="e8d78-141">If you receive out of memory exceptions, then you should increase the memory.</span></span>   

<span data-ttu-id="e8d78-142">Число одновременно выполняемых задач для параллелизма ограничивается общим объемом памяти YARN.</span><span class="sxs-lookup"><span data-stu-id="e8d78-142">The concurrent number of tasks running or parallelism will be bounded by the total YARN memory.</span></span>  <span data-ttu-id="e8d78-143">Число контейнеров YARN определяет, сколько параллельных задач можно запустить.</span><span class="sxs-lookup"><span data-stu-id="e8d78-143">The number of YARN containers will dictate how many concurrent tasks can run.</span></span>  <span data-ttu-id="e8d78-144">Чтобы узнать, сколько памяти YARN доступно для каждого узла, зайдите в Ambari.</span><span class="sxs-lookup"><span data-stu-id="e8d78-144">To find the YARN memory per node, you can go to Ambari.</span></span>  <span data-ttu-id="e8d78-145">Перейдите к YARN и откройте вкладку конфигураций.</span><span class="sxs-lookup"><span data-stu-id="e8d78-145">Navigate to YARN and view the Configs tab.</span></span>  <span data-ttu-id="e8d78-146">Объем памяти YARN отобразится в этом окне.</span><span class="sxs-lookup"><span data-stu-id="e8d78-146">The YARN memory is displayed in this window.</span></span>  

        Total YARN memory = nodes * YARN memory per node
        # of YARN containers = Total YARN memory / Tez container size
<span data-ttu-id="e8d78-147">При использовании Azure Data Lake Store повышение производительности достигается за счет максимально возможного уровня параллелизма.</span><span class="sxs-lookup"><span data-stu-id="e8d78-147">The key to improving performance using ADLS is to increase the concurrency as much as possible.</span></span>  <span data-ttu-id="e8d78-148">Tez автоматически вычисляет число задач, которые нужно создать, поэтому нет необходимости настраивать этот параметр.</span><span class="sxs-lookup"><span data-stu-id="e8d78-148">Tez automatically calculates the number of tasks that should be created so you do not need to set it.</span></span>   

## <a name="example-calculation"></a><span data-ttu-id="e8d78-149">Пример вычисления</span><span class="sxs-lookup"><span data-stu-id="e8d78-149">Example Calculation</span></span>

<span data-ttu-id="e8d78-150">Предположим, что у вас есть кластер D14 с 8 узлами.</span><span class="sxs-lookup"><span data-stu-id="e8d78-150">Let’s say you have an 8 node D14 cluster.</span></span>  

    Total YARN memory = nodes * YARN memory per node
    Total YARN memory = 8 nodes * 96GB = 768GB
    # of YARN containers = 768GB / 3072MB = 256

## <a name="limitations"></a><span data-ttu-id="e8d78-151">Ограничения</span><span class="sxs-lookup"><span data-stu-id="e8d78-151">Limitations</span></span>
<span data-ttu-id="e8d78-152">**Регулирование Azure Data Lake Store**</span><span class="sxs-lookup"><span data-stu-id="e8d78-152">**ADLS throttling**</span></span> 

<span data-ttu-id="e8d78-153">Если вы достигнете пределов пропускной способности, предоставляемой Azure Data Lake Store, начнут происходить сбои задач.</span><span class="sxs-lookup"><span data-stu-id="e8d78-153">UIf you hit the limits of bandwidth provided by ADLS, you would start to see task failures.</span></span> <span data-ttu-id="e8d78-154">Это можно заметить, отслеживая ошибки регулирования в журналах задач.</span><span class="sxs-lookup"><span data-stu-id="e8d78-154">This could be identified by observing throttling errors in task logs.</span></span>  <span data-ttu-id="e8d78-155">Можно уменьшить параллелизм, увеличив размер контейнера Tez.</span><span class="sxs-lookup"><span data-stu-id="e8d78-155">You can decrease the parallelism by increasing Tez container size.</span></span>  <span data-ttu-id="e8d78-156">Если для обработки задания требуется больший параллелизм, свяжитесь с нами.</span><span class="sxs-lookup"><span data-stu-id="e8d78-156">If you need more concurrency for your job, please contact us.</span></span>   

<span data-ttu-id="e8d78-157">Чтобы проверить, применяется ли для вас регулирование, включите ведение журнала отладки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="e8d78-157">To check if you are getting throttled, you need to enable the debug logging on the client side.</span></span> <span data-ttu-id="e8d78-158">Вот как это сделать.</span><span class="sxs-lookup"><span data-stu-id="e8d78-158">Here’s how you can do that:</span></span>

1. <span data-ttu-id="e8d78-159">Поместите следующее свойство в окно свойств log4j в файле конфигурации Hive.</span><span class="sxs-lookup"><span data-stu-id="e8d78-159">Put the following property in the log4j properties in Hive config.</span></span> <span data-ttu-id="e8d78-160">Это можно сделать из представления Ambari: log4j.logger.com.microsoft.azure.datalake.store=DEBUG. Перезагрузите все узлы или службу, чтобы изменения конфигурации вступили в силу.</span><span class="sxs-lookup"><span data-stu-id="e8d78-160">This can be done from Ambari view: log4j.logger.com.microsoft.azure.datalake.store=DEBUG Restart all the nodes/service for the config to take effect.</span></span>

2. <span data-ttu-id="e8d78-161">Если регулирование выполняется, вы увидите код ошибки HTTP 429 в файле журнала Hive.</span><span class="sxs-lookup"><span data-stu-id="e8d78-161">If you are getting throttled, you’ll see the HTTP 429 error code in the hive log file.</span></span> <span data-ttu-id="e8d78-162">Файл журнала находится в каталоге /tmp/&lt;имя_пользователя&gt;/hive.log</span><span class="sxs-lookup"><span data-stu-id="e8d78-162">The hive log file is in /tmp/&lt;user&gt;/hive.log</span></span>

## <a name="further-information-on-hive-tuning"></a><span data-ttu-id="e8d78-163">Дополнительные сведения о настройке Hive</span><span class="sxs-lookup"><span data-stu-id="e8d78-163">Further information on Hive tuning</span></span>

<span data-ttu-id="e8d78-164">Ниже приведены некоторые блоги, которые помогут в настройке производительности запросов Hive.</span><span class="sxs-lookup"><span data-stu-id="e8d78-164">Here are a few blogs that will help tune your Hive queries:</span></span>
* [<span data-ttu-id="e8d78-165">Оптимизация запросов Hive для Hadoop в HDInsight</span><span class="sxs-lookup"><span data-stu-id="e8d78-165">Optimize Hive queries for Hadoop in HDInsight</span></span>](https://azure.microsoft.com/en-us/documentation/articles/hdinsight-hadoop-optimize-hive-query/)
* <span data-ttu-id="e8d78-166">[Troubleshooting Hive query performance](https://blogs.msdn.microsoft.com/bigdatasupport/2015/08/13/troubleshooting-hive-query-performance-in-hdinsight-hadoop-cluster/) (Устранение неполадок с производительностью запросов Hive)</span><span class="sxs-lookup"><span data-stu-id="e8d78-166">[Troubleshooting Hive query performance](https://blogs.msdn.microsoft.com/bigdatasupport/2015/08/13/troubleshooting-hive-query-performance-in-hdinsight-hadoop-cluster/)</span></span>
* [<span data-ttu-id="e8d78-167">Примите участие в дискуссии об оптимизации Hive на HDInsight</span><span class="sxs-lookup"><span data-stu-id="e8d78-167">Ignite talk on optimize Hive on HDInsight</span></span>](https://channel9.msdn.com/events/Machine-Learning-and-Data-Sciences-Conference/Data-Science-Summit-2016/MSDSS25)
