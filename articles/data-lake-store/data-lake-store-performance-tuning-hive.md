---
title: "aaaAzure данных Озера хранилища Hive производительности рекомендации по настройке | Документы Microsoft"
description: "Рекомендации по настройке производительности Hive в Azure Data Lake Store"
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: e44daeb6ad3b64e893c709df63b56444a330729f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="performance-tuning-guidance-for-hive-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="5f7e2-103">Рекомендации по настройке производительности Hive в HDInsight и Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="5f7e2-103">Performance tuning guidance for Hive on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="5f7e2-104">параметры по умолчанию Hello были заданы tooprovide хорошую производительность для многих различных вариантов использования.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-104">hello default settings have been set tooprovide good performance across many different use cases.</span></span>  <span data-ttu-id="5f7e2-105">Для запросов, большим объемом операций ввода-вывода куст может быть настраиваемой tooget более высокую производительность с ADLS.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-105">For I/O intensive queries, Hive can be tuned tooget better performance with ADLS.</span></span>  

## <a name="prerequisites"></a><span data-ttu-id="5f7e2-106">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="5f7e2-106">Prerequisites</span></span>

* <span data-ttu-id="5f7e2-107">**Подписка Azure**.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-107">**An Azure subscription**.</span></span> <span data-ttu-id="5f7e2-108">Ознакомьтесь с [бесплатной пробной версией Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="5f7e2-108">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="5f7e2-109">**Учетная запись Azure Data Lake Store.**</span><span class="sxs-lookup"><span data-stu-id="5f7e2-109">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="5f7e2-110">Инструкции о том, как один, см. в разделе toocreate [Приступая к работе с хранилища Озера данных Azure](data-lake-store-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="5f7e2-110">For instructions on how toocreate one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md)</span></span>
* <span data-ttu-id="5f7e2-111">**Кластер Azure HDInsight** с tooa доступа к учетной записи хранилища Озера данных.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-111">**Azure HDInsight cluster** with access tooa Data Lake Store account.</span></span> <span data-ttu-id="5f7e2-112">См. статью [Создание кластера HDInsight с Data Lake Store с помощью портала Azure](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="5f7e2-112">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="5f7e2-113">Убедитесь, что включить удаленный рабочий стол для кластера hello.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-113">Make sure you enable Remote Desktop for hello cluster.</span></span>
* <span data-ttu-id="5f7e2-114">**Запустите Hive в HDInsight**.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-114">**Running Hive on HDInsight**.</span></span>  <span data-ttu-id="5f7e2-115">toolearn о выполнении задания Hive в HDInsight, в разделе [используйте Hive в HDInsight] (https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-use-hive)</span><span class="sxs-lookup"><span data-stu-id="5f7e2-115">toolearn about running Hive jobs on HDInsight, see [Use Hive on HDInsight] (https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-use-hive)</span></span>
* <span data-ttu-id="5f7e2-116">**Рекомендации по настройке производительности в Azure Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-116">**Performance tuning guidelines on ADLS**.</span></span>  <span data-ttu-id="5f7e2-117">См. [рекомендации по настройке производительности для Azure Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="5f7e2-117">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance)</span></span>

## <a name="parameters"></a><span data-ttu-id="5f7e2-118">Параметры</span><span class="sxs-lookup"><span data-stu-id="5f7e2-118">Parameters</span></span>

<span data-ttu-id="5f7e2-119">Ниже приведены параметры tootune hello для наиболее важных для повышения производительности ADLS.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-119">Here are hello most important settings tootune for improved ADLS performance:</span></span>

* <span data-ttu-id="5f7e2-120">**Hive.tez.Container.Size** — hello объем памяти, используемой каждой задачи</span><span class="sxs-lookup"><span data-stu-id="5f7e2-120">**hive.tez.container.size** – hello amount of memory used by each tasks</span></span>

* <span data-ttu-id="5f7e2-121">**tez.grouping.min-size** — минимальный размер каждого модуля сопоставления;</span><span class="sxs-lookup"><span data-stu-id="5f7e2-121">**tez.grouping.min-size** – minimum size of each mapper</span></span>

* <span data-ttu-id="5f7e2-122">**tez.grouping.max-size** — максимальный размер каждого модуля сопоставления;</span><span class="sxs-lookup"><span data-stu-id="5f7e2-122">**tez.grouping.max-size** – maximum size of each mapper</span></span>

* <span data-ttu-id="5f7e2-123">**hive.exec.reducer.bytes.per.reducer** — размер каждого модуля уменьшения.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-123">**hive.exec.reducer.bytes.per.reducer** – size of each reducer</span></span>

<span data-ttu-id="5f7e2-124">**Hive.tez.Container.Size** -размер контейнера hello определяет объем памяти доступен для каждой задачи.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-124">**hive.tez.container.size** - hello container size determines how much memory is available for each task.</span></span>  <span data-ttu-id="5f7e2-125">Это основной вход hello для управления параллелизмом hello в кусте.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-125">This is hello main input for controlling hello concurrency in Hive.</span></span>  

<span data-ttu-id="5f7e2-126">**размер tez.GROUPING.Min** — этот параметр позволяет tooset hello минимальный размер каждого сопоставления.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-126">**tez.grouping.min-size** – This parameter allows you tooset hello minimum size of each mapper.</span></span>  <span data-ttu-id="5f7e2-127">Если количество hello модули сопоставления, которые выбирает Tez меньше, чем значение этого параметра hello, Tez будет использовать заданное здесь значение hello.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-127">If hello number of mappers that Tez chooses is smaller than hello value of this parameter, then Tez will use hello value set here.</span></span>  

<span data-ttu-id="5f7e2-128">**размер tez.GROUPING.max** — параметр hello позволяет tooset hello максимальный размер каждого сопоставления.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-128">**tez.grouping.max-size** – hello parameter allows you tooset hello maximum size of each mapper.</span></span>  <span data-ttu-id="5f7e2-129">Если количество hello модули сопоставления, которые выбирает Tez больше, чем значение этого параметра hello, Tez будет использовать заданное здесь значение hello.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-129">If hello number of mappers that Tez chooses is larger than hello value of this parameter, then Tez will use hello value set here.</span></span>  

<span data-ttu-id="5f7e2-130">**Hive.Exec.reducer.Bytes.per.reducer** — этот параметр задает размер hello каждого редуктора.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-130">**hive.exec.reducer.bytes.per.reducer** – This parameter sets hello size of each reducer.</span></span>  <span data-ttu-id="5f7e2-131">По умолчанию используется размер 256 МБ.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-131">By default, each reducer is 256MB.</span></span>  

## <a name="guidance"></a><span data-ttu-id="5f7e2-132">Руководство</span><span class="sxs-lookup"><span data-stu-id="5f7e2-132">Guidance</span></span>

<span data-ttu-id="5f7e2-133">**Задать hive.exec.reducer.bytes.per.reducer** — значение по умолчанию hello работает хорошо, когда hello данных без сжатия.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-133">**Set hive.exec.reducer.bytes.per.reducer** – hello default value works well when hello data is uncompressed.</span></span>  <span data-ttu-id="5f7e2-134">Для данных, сжимается необходимо уменьшить размер hello hello редуктора.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-134">For data that is compressed, you should reduce hello size of hello reducer.</span></span>  

<span data-ttu-id="5f7e2-135">**Задайте hive.tez.container.size** — объем памяти для каждого узла, который определяется параметром yarn.nodemanager.resource.memory-mb (должен быть правильно определен для кластера HDI по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="5f7e2-135">**Set hive.tez.container.size** – In each node, memory is specified by yarn.nodemanager.resource.memory-mb and should be correctly set on HDI cluster by default.</span></span>  <span data-ttu-id="5f7e2-136">Дополнительные сведения об установке соответствующих памяти hello в YARN разделе [учет](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-hive-out-of-memory-error-oom).</span><span class="sxs-lookup"><span data-stu-id="5f7e2-136">For additional information on setting hello appropriate memory in YARN, see this [post](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-hive-out-of-memory-error-oom).</span></span>

<span data-ttu-id="5f7e2-137">Интенсивных рабочих нагрузок ввода-вывода можно повысить степень параллелизма, уменьшив размер контейнера Tez hello.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-137">I/O intensive workloads can benefit from more parallelism by decreasing hello Tez container size.</span></span> <span data-ttu-id="5f7e2-138">Это дает пользователю hello дополнительные контейнеры, которые, увеличивает параллелизм.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-138">This gives hello user more containers which increases concurrency.</span></span>  <span data-ttu-id="5f7e2-139">Но некоторые запросы Hive требуют значительного объема памяти (например, MapJoin).</span><span class="sxs-lookup"><span data-stu-id="5f7e2-139">However, some Hive queries require a significant amount of memory (e.g. MapJoin).</span></span>  <span data-ttu-id="5f7e2-140">Если задачу hello не имеет достаточно памяти, вы получите исключению нехватки памяти во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-140">If hello task does not have enough memory, you will get an out of memory exception during runtime.</span></span>  <span data-ttu-id="5f7e2-141">При получении исключений нехватки памяти, следует увеличить hello памяти.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-141">If you receive out of memory exceptions, then you should increase hello memory.</span></span>   

<span data-ttu-id="5f7e2-142">общий объем памяти YARN hello будут привязаны Hello числа параллельных задач, выполняющихся или параллелизма.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-142">hello concurrent number of tasks running or parallelism will be bounded by hello total YARN memory.</span></span>  <span data-ttu-id="5f7e2-143">Hello число контейнеров YARN будет указывать, сколько параллельные задачи могут выполняться.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-143">hello number of YARN containers will dictate how many concurrent tasks can run.</span></span>  <span data-ttu-id="5f7e2-144">toofind hello YARN памяти на узел, вы можете перейти tooAmbari.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-144">toofind hello YARN memory per node, you can go tooAmbari.</span></span>  <span data-ttu-id="5f7e2-145">Перейти tooYARN и открыть вкладку конфигураций hello.  в этом окне отображается Hello YARN памяти.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-145">Navigate tooYARN and view hello Configs tab.  hello YARN memory is displayed in this window.</span></span>  

        Total YARN memory = nodes * YARN memory per node
        # of YARN containers = Total YARN memory / Tez container size
<span data-ttu-id="5f7e2-146">Hello ключа tooimproving производительности с помощью ADLS — максимальной степени параллелизма hello tooincrease.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-146">hello key tooimproving performance using ADLS is tooincrease hello concurrency as much as possible.</span></span>  <span data-ttu-id="5f7e2-147">Tez автоматически вычисляет hello число задач, которые должны быть созданы, поэтому нет необходимости tooset его.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-147">Tez automatically calculates hello number of tasks that should be created so you do not need tooset it.</span></span>   

## <a name="example-calculation"></a><span data-ttu-id="5f7e2-148">Пример вычисления</span><span class="sxs-lookup"><span data-stu-id="5f7e2-148">Example Calculation</span></span>

<span data-ttu-id="5f7e2-149">Предположим, что у вас есть кластер D14 с 8 узлами.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-149">Let’s say you have an 8 node D14 cluster.</span></span>  

    Total YARN memory = nodes * YARN memory per node
    Total YARN memory = 8 nodes * 96GB = 768GB
    # of YARN containers = 768GB / 3072MB = 256

## <a name="limitations"></a><span data-ttu-id="5f7e2-150">Ограничения</span><span class="sxs-lookup"><span data-stu-id="5f7e2-150">Limitations</span></span>
<span data-ttu-id="5f7e2-151">**Регулирование Azure Data Lake Store**</span><span class="sxs-lookup"><span data-stu-id="5f7e2-151">**ADLS throttling**</span></span> 

<span data-ttu-id="5f7e2-152">UIf попаданий hello ограничения пропускной способности, предоставляемых по ADLS, будет начинаться toosee неудачно завершившихся задач.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-152">UIf you hit hello limits of bandwidth provided by ADLS, you would start toosee task failures.</span></span> <span data-ttu-id="5f7e2-153">Это можно заметить, отслеживая ошибки регулирования в журналах задач.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-153">This could be identified by observing throttling errors in task logs.</span></span>  <span data-ttu-id="5f7e2-154">Hello параллелизма можно уменьшить путем увеличения размера контейнеров Tez.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-154">You can decrease hello parallelism by increasing Tez container size.</span></span>  <span data-ttu-id="5f7e2-155">Если для обработки задания требуется больший параллелизм, свяжитесь с нами.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-155">If you need more concurrency for your job, please contact us.</span></span>   

<span data-ttu-id="5f7e2-156">toocheck, если вы начало регулируются, необходимо tooenable hello ведение журнала отладки на клиентской стороне hello.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-156">toocheck if you are getting throttled, you need tooenable hello debug logging on hello client side.</span></span> <span data-ttu-id="5f7e2-157">Вот как это сделать.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-157">Here’s how you can do that:</span></span>

1. <span data-ttu-id="5f7e2-158">Поместите следующие свойства в конфигурации куст свойства log4j hello hello. Это можно сделать из представления Ambari: log4j.logger.com.microsoft.azure.datalake.store=DEBUG перезапустите все hello узлов или службу hello config tootake эффект.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-158">Put hello following property in hello log4j properties in Hive config. This can be done from Ambari view: log4j.logger.com.microsoft.azure.datalake.store=DEBUG Restart all hello nodes/service for hello config tootake effect.</span></span>

2. <span data-ttu-id="5f7e2-159">Если вы начало регулируются, вы увидите код ошибки HTTP 429 hello в файле журнала hive hello.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-159">If you are getting throttled, you’ll see hello HTTP 429 error code in hello hive log file.</span></span> <span data-ttu-id="5f7e2-160">файл журнала hive Hello находится в /tmp/&lt;пользователя&gt;/hive.log</span><span class="sxs-lookup"><span data-stu-id="5f7e2-160">hello hive log file is in /tmp/&lt;user&gt;/hive.log</span></span>

## <a name="further-information-on-hive-tuning"></a><span data-ttu-id="5f7e2-161">Дополнительные сведения о настройке Hive</span><span class="sxs-lookup"><span data-stu-id="5f7e2-161">Further information on Hive tuning</span></span>

<span data-ttu-id="5f7e2-162">Ниже приведены некоторые блоги, которые помогут в настройке производительности запросов Hive.</span><span class="sxs-lookup"><span data-stu-id="5f7e2-162">Here are a few blogs that will help tune your Hive queries:</span></span>
* [<span data-ttu-id="5f7e2-163">Оптимизация запросов Hive для Hadoop в HDInsight</span><span class="sxs-lookup"><span data-stu-id="5f7e2-163">Optimize Hive queries for Hadoop in HDInsight</span></span>](https://azure.microsoft.com/en-us/documentation/articles/hdinsight-hadoop-optimize-hive-query/)
* <span data-ttu-id="5f7e2-164">[Troubleshooting Hive query performance](https://blogs.msdn.microsoft.com/bigdatasupport/2015/08/13/troubleshooting-hive-query-performance-in-hdinsight-hadoop-cluster/) (Устранение неполадок с производительностью запросов Hive)</span><span class="sxs-lookup"><span data-stu-id="5f7e2-164">[Troubleshooting Hive query performance](https://blogs.msdn.microsoft.com/bigdatasupport/2015/08/13/troubleshooting-hive-query-performance-in-hdinsight-hadoop-cluster/)</span></span>
* [<span data-ttu-id="5f7e2-165">Примите участие в дискуссии об оптимизации Hive на HDInsight</span><span class="sxs-lookup"><span data-stu-id="5f7e2-165">Ignite talk on optimize Hive on HDInsight</span></span>](https://channel9.msdn.com/events/Machine-Learning-and-Data-Sciences-Conference/Data-Science-Summit-2016/MSDSS25)
