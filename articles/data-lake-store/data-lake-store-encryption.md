---
title: "Шифрование в Azure Data Lake Store | Документация Майкрософт"
description: "Сведения о механизме шифрования и смены ключей в Azure Data Lake Store"
services: data-lake-store
documentationcenter: 
author: yagupta
manager: 
editor: 
ms.assetid: 
ms.service: data-lake-store
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 4/14/2017
ms.author: yagupta
ms.openlocfilehash: 20444d368c568ee716ff242e33323b91ffd198eb
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="encryption-of-data-in-azure-data-lake-store"></a>Шифрование данных в Azure Data Lake Store

Шифрование в Azure Data Lake Store помогает защищать данные, реализовывать корпоративные политики безопасности и соблюдать соответствие нормативным требованиям. В этой статье рассматриваются вопросы, связанные с проектированием и некоторыми техническими аспектами реализации.

Data Lake Store поддерживает шифрование данных при хранении (неактивные данные) и передаче. Data Lake Store поддерживает прозрачное шифрование неактивных данных, включенное по умолчанию. Далее упомянутые термины представлены подробнее.

* **Включено по умолчанию**. При создании учетной записи Azure Data Lake Store параметр по умолчанию включает шифрование. Поэтому данные, хранящиеся в Data Lake Store, всегда шифруются перед сохранением на постоянный носитель. Это поведение распространяется на все данные, и его нельзя изменить после создания учетной записи.
* **Прозрачность**. Data Lake Store автоматически шифрует данные перед сохранением и расшифровывает их до извлечения. За настройку шифрования и управление им на уровне Data Lake Store отвечает администратор. API-интерфейсы доступа к данным не изменяются. Таким образом, при шифровании изменять приложения и службы, взаимодействующие с Data Lake Store, не требуется.

Передаваемые (перемещаемые) данные также всегда шифруются в Data Lake Store. Данные не только шифруются перед сохранением на постоянный носитель. Они также всегда защищены при передаче благодаря использованию протокола HTTPS. HTTPS — единственный протокол, который поддерживают интерфейсы REST в Data Lake Store. На следующей схеме представлено шифрование данных в Data Lake Store:

![Схема шифрования данных в Data Lake Store](./media/data-lake-store-encryption/fig1.png)


## <a name="set-up-encryption-with-data-lake-store"></a>Настройка шифрования с помощью Data Lake Store

Шифрование для Data Lake Store настраивается во время создания учетной записи. Эта функция всегда включена по умолчанию. Вы можете управлять ключами самостоятельно или разрешить Data Lake Store управлять ими (настройка по умолчанию).

Дополнительные сведения см. в [руководстве по началу работы](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).

## <a name="how-encryption-works-in-data-lake-store"></a>Механизм шифрования в Data Lake Store

Ниже объясняется, как управлять главными ключами шифрования, а также рассматриваются три типа ключей, которые могут использоваться при шифровании данных для Data Lake Store.

### <a name="master-encryption-keys"></a>Главные ключи шифрования

В Data Lake Store предусмотрено два режима управления главными ключами шифрования. Сейчас давайте предположим, что главный ключ шифрования является ключом верхнего уровня. Для расшифровки любых данных, хранящихся в Data Lake Store, требуется доступ к главному ключу шифрования.

Ниже приведены два режима управления главным ключом шифрования.

*   Ключами управляет служба
*   Ключами управляет пользователь

В двух этих режимах защита главного ключа шифрования обеспечивается при его хранении в Azure Key Vault. Azure Key Vault — полностью управляемая служба высокого уровня безопасности в Azure, которую можно использовать для защиты криптографических ключей. Дополнительные сведения см. в [документации по Key Vault](https://azure.microsoft.com/services/key-vault).

Вот краткое сравнение возможностей, предоставляемых в двух режимах управления главными ключами шифрования.

|  | Ключами управляет служба | Ключами управляет пользователь |
| --- | --- | --- |
|Способ хранения данных|Шифрование перед сохранением (всегда)|Шифрование перед сохранением (всегда)|
|Где хранится главный ключ шифрования?|хранилище ключей;|хранилище ключей;|
|Хранятся ли ключи шифрования в незашифрованном виде за пределами Azure Key Vault? |Нет|Нет|
|Можно ли извлечь главный ключ шифрования из Key Vault?|Нет. Главный ключ шифрования, сохраненный в Key Vault, можно использовать только для шифрования и расшифровки.|Нет. Главный ключ шифрования, сохраненный в Key Vault, можно использовать только для шифрования и расшифровки.|
|Кто является владельцем экземпляра Key Vault и главного ключа шифрования?|Служба Azure Data Lake Store.|Вы являетесь владельцем экземпляра Key Vault, который принадлежит к подписке Azure. Главным ключом шифрования в Key Vault может управлять программное обеспечение или оборудование.|
|Может ли пользователь отменить доступ службы Azure Data Lake Store к главному ключу шифрования?|Нет|Да. Вы можете управлять списками управления доступом в Azure Key Vault и удалять записи управления доступом в удостоверении службы Data Lake Store.|
|Может ли пользователь окончательно удалить главный ключ шифрования?|Нет|Да. Если вы удалите главный ключ шифрования из Key Vault, данные в учетной записи Data Lake Store невозможно будет расшифровать даже службе Data Lake Store. <br><br> Если вы явным образом создали резервную копию главного ключа шифрования до его удаления из Key Vault, такой ключ и данные можно будет восстановить. Если же копия не была создана, данные в учетной записи Data Lake Store невозможно будет расшифровать.|


Эти два режима отличаются только тем, кто управляет главным ключом шифрования и в каком экземпляре Key Vault этот ключ хранится.

При выборе режима для работы с главными ключами шифрования важно учитывать следующее:

*   Режим управления ключами (ключи, управляемые службой либо пользователем) можно выбрать при подготовке учетной записи Data Lake Store.
*   После подготовки учетной записи Data Lake Store этот режим изменить невозможно.

### <a name="encryption-and-decryption-of-data"></a>Шифрование и расшифровка данных

При шифровании данных используется три вида ключей. В таблице ниже приведены сводные сведения.

| Ключ                   | Сокращение | С чем связан | Расположение хранения                             | Тип       | Примечания                                                                                                   |
|-----------------------|--------------|-----------------|----------------------------------------------|------------|---------------------------------------------------------------------------------------------------------|
| Главный ключ шифрования | MEK          | Учетная запись Data Lake Store | хранилище ключей;                              | Асимметричный | Может управляться Data Lake Store или пользователем.                                                              |
| Ключ шифрования данных   | DEK          | Учетная запись Data Lake Store | Постоянное хранилище; управляется Data Lake Store | Симметричный  | Ключ шифрования данных, зашифрованный главным ключом шифрования. Зашифрованный ключ шифрования данных, хранимый на постоянном носителе. |
| Ключ блочного шифрования  | BEK          | Блок данных | None                                         | Симметричный  | Ключ блочного шифрования, получаемый на основе ключа шифрования данных и блока данных.                                                      |

Эти концепции представлены на схеме ниже.

![Ключи в шифровании данных](./media/data-lake-store-encryption/fig2.png)

#### <a name="pseudo-algorithm-when-a-file-is-to-be-decrypted"></a>Псевдоалгоритм расшифровки файла:
1.  Проверьте, кэширован ли ключ шифрования данных для учетной записи Data Lake Store и готов ли он к использованию.
    - Если нет, получите зашифрованный ключ шифрования данных из постоянного хранилища и отправьте его в Key Vault для расшифровки. Кэшируйте расшифрованный ключ шифрования данных в памяти. Теперь ключ готов к использованию.
2.  Для каждого блока данных в файле сделайте следующее:
    - Получите зашифрованный блок данных из постоянного хранилища.
    - Создайте ключ блочного шифрования на основе ключа шифрования данных и зашифрованного блока данных.
    - Используйте ключ блочного шифрования для расшифровки данных.


#### <a name="pseudo-algorithm-when-a-block-of-data-is-to-be-encrypted"></a>Псевдоалгоритм шифрования блока данных:
1.  Проверьте, кэширован ли ключ шифрования данных для учетной записи Data Lake Store и готов ли он к использованию.
    - Если нет, получите зашифрованный ключ шифрования данных из постоянного хранилища и отправьте его в Key Vault для расшифровки. Кэшируйте расшифрованный ключ шифрования данных в памяти. Теперь ключ готов к использованию.
2.  Создайте уникальный ключ блочного шифрования для блока данных на основе ключа шифрования данных.
3.  Зашифруйте блок данных с помощью ключа блочного шифрования, используя шифрование AES-256.
4.  Сохраните зашифрованный блок данных в постоянном хранилище.

> [!NOTE] 
> Для повышения производительности ключ шифрования данных в незашифрованном виде кэшируется в памяти на непродолжительное время, после чего удаляется. Ключ шифрования данных на постоянном носителе всегда хранится в зашифрованном виде (с помощью главного ключа шифрования).

## <a name="key-rotation"></a>Смена ключей

Если ключами управляет пользователь, главный ключ шифрования можно менять. Дополнительные сведения о настройке учетной записи Data Lake Store с использованием ключей, управляемых пользователем, см. в [руководстве по началу работы](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).

### <a name="prerequisites"></a>Предварительные требования

При настройке учетной записи Data Lake Store вы можете выбрать свои ключи. Этот параметр нельзя изменить после создания учетной записи. Ниже предполагается, что вы используете ключи, управляемые пользователем (этот параметр доступен, если вы выбрали свои ключи из Key Vault).

Обратите внимание: когда для шифрования данных используются стандартные параметры, данные всегда шифруются с помощью ключей, управляемых Data Lake Store. В этом случае вам не нужна возможность менять ключи, так как они управляются Data Lake Store.

### <a name="how-to-rotate-the-mek-in-data-lake-store"></a>Как сменить главный ключ шифрования в Data Lake Store

1. Выполните вход на [портал Azure](https://portal.azure.com/).
2. Перейдите в экземпляр Key Vault, где хранятся ключи, связанные с вашей учетной записью Data Lake Store. Выберите **Ключи**.

    ![Снимок экрана с Key Vault](./media/data-lake-store-encryption/keyvault.png)

3.  Выберите ключ, связанный с учетной записью Data Lake Store, и создайте его новую версию. Обратите внимание, что в Data Lake Store сейчас можно менять ключ только на его новую версию. Вы не можете использовать для смены другой ключ.

   ![Снимок экрана с окном "Ключи" и выделенным пунктом "Новая версия"](./media/data-lake-store-encryption/keynewversion.png)

4.  Перейдите к учетной записи хранения Data Lake Store и выберите **Шифрование**.

    ![Снимок экрана с окном учетной записи хранения Data Lake Store с выделенным пунктом "Шифрование"](./media/data-lake-store-encryption/select-encryption.png)

5.  Появится сообщение, уведомляющее о доступности новой версии ключа. Щелкните **Сменить ключ**, чтобы обновить ключ до новой версии.

    ![Снимок экрана с окном Data Lake Store с сообщением и выделенным пунктом "Сменить ключ"](./media/data-lake-store-encryption/rotatekey.png)

Операция по смене ключа занимает меньше двух минут и не вызывает простоя. После завершения операции будет использоваться новая версия ключа.
