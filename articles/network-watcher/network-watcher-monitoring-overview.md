---
title: "Общие сведения о Наблюдателе за сетями Azure | Документация Майкрософт"
description: "На этой странице представлен обзор службы Наблюдателя за сетями, предназначенной для мониторинга и визуализации сетевых ресурсов в Azure."
services: network-watcher
documentationcenter: na
author: jimdial
manager: timlt
editor: 
ms.assetid: 14bc2266-99e3-42a2-8d19-bd7257fec35e
ms.service: network-watcher
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/11/2017
ms.author: jdial
ms.openlocfilehash: eecb20d4a53478471c238018d8fbd5a5f9cb79d8
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="azure-network-monitoring-overview"></a>Обзор мониторинга сети Azure

Клиенты создают комплексную сеть в Azure, администрируя и сочетая различные отдельные сетевые ресурсы, в том числе виртуальные сети, каналы ExpressRoute, шлюзы приложений, подсистемы балансировки нагрузки и многое другое. Мониторинг доступен для всех сетевых ресурсов. Мы называем его мониторингом на уровне ресурса.

Комплексная сеть может использовать сложные конфигурации и взаимодействия между ресурсами, формируя сложные сценарии, требующие соответствующего отслеживания с помощью Наблюдателя за сетями.

В этой статье описывается подобный сценарий и мониторинг на уровне ресурса. Мониторинг сети в Azure является исчерпывающим и охватывает две обширные категории.

* [**Наблюдатель за сетями**](#network-watcher). Мониторинг на основе сценариев обеспечивается с помощью функций Наблюдателя за сетями. Эта служба включает в себя запись пакетов, определение следующего прыжка, проверку IP-потока, представление групп безопасности и журналы потоков NSG. В отличие от мониторинга отдельных сетевых ресурсов, мониторинг на уровне сценария обеспечивает комплексное представление сетевых ресурсов.
* [**Мониторинг ресурсов**](#network-resource-level-monitoring). Мониторинг на уровне ресурса базируется на четырех компонентах. Это журналы диагностики, метрики, устранение неполадок и работоспособность ресурсов. Все эти компоненты создаются на уровне сетевого ресурса.

## <a name="network-watcher"></a>Наблюдатель за сетями

Наблюдатель за сетями — это региональная служба, обеспечивающая мониторинг и диагностику условий на уровне сетевого сценария на платформе Azure. Инструменты диагностики сети и визуализации, доступные в Наблюдателе за сетями, помогают понять, как работает сеть в Azure, диагностировать ее и получить ценную информацию.

В настоящее время Наблюдатель за сетями имеет следующие возможности.

* **[Топология](network-watcher-topology-overview.md)**. Обеспечивает представление уровня сети, в котором показаны различные взаимодействия и связи между сетевыми ресурсами в группе ресурсов.
* **[Изменяемая запись пакетов](network-watcher-packet-capture-overview.md)**. Позволяет записывать входящие и исходящие пакеты данных для виртуальной машины. Дополнительные параметры фильтрации и элементы управления для тонкой настройки, такие как возможность установить ограничения времени и размера, обеспечивают гибкость в работе. Данные пакетов могут храниться в хранилище BLOB-объектов или на локальном диске в виде CAP-файлов.
* **[Проверка IP-потока](network-watcher-ip-flow-verify-overview.md)**. Позволяет проверить, разрешен или запрещен пакет, на основе информации о пакете, указанной в пяти кортежах (конечный IP-адрес, исходный IP-адрес, конечный порт, исходный порт и протокол). Если пакет отклонен группой безопасности, возвращаются правило и группа, которые запретили этот пакет.
* **[Определение следующего прыжка](network-watcher-next-hop-overview.md)**. Позволяет определить следующий прыжок для пакетов, маршрутизируемых в сетевой структуре Azure, что позволяет диагностировать любые неправильные определяемые пользователем маршруты.
* **[Представление групп безопасности](network-watcher-security-group-view-overview.md)**. Возвращает действующие и примененные правила безопасности, которые применяются к виртуальной машине.
* **[Ведение журнала потоков NSG](network-watcher-nsg-flow-logging-overview.md)**. Журналы потоков для групп безопасности сети позволяют записывать журналы, относящиеся к трафику, который разрешают или запрещают правила безопасности в группе. Поток определяется данными пяти кортежей: исходный IP-адрес, конечный IP-адрес, исходный порт, конечный порт и протокол.
* **[Устранение неполадок шлюза виртуальной сети и подключений](network-watcher-troubleshoot-manage-rest.md)**. Дает возможность устранять неполадки шлюза виртуальной сети и подключений.
* **[Ограничения сетевых ресурсов подписки](#network-subscription-limits)**. Возможность просмотреть данные об использовании сетевых ресурсов относительно установленных ограничений.
* **[Настройка журналов диагностики](#diagnostic-logs)**. Предоставляет отдельную область для включения или отключения журналов диагностики сетевых ресурсов в группе ресурсов.
* **[Возможность подключения (предварительная версия)](network-watcher-connectivity-overview.md)**. Позволяет проверить возможность прямого подключения TCP между виртуальной машиной и определенной конечной точкой.

### <a name="role-based-access-control-rbac-in-network-watcher"></a>Управление доступом на основе ролей (RBAC) в Наблюдателе за сетями

Наблюдатель за сетями использует [модель управления доступом на основе ролей Azure](../active-directory/role-based-access-control-what-is.md). Для Наблюдателя за сетями необходимы указанные ниже разрешения. Важно убедиться, что у роли, которая используется для вызова интерфейсов API Наблюдателя за сетями или для работы с Наблюдателем за сетями на портале, имеется необходимый уровень доступа.

|Ресурс| Разрешение|
|---|---| 
|Microsoft.Storage/ |чтение|
|Microsoft.Authorization/| чтение| 
|Microsoft.Resources/subscriptions/resourceGroups/| чтение|
|Microsoft.Storage/storageAccounts/listServiceSas/ | Действие|
|Microsoft.Storage/storageAccounts/listAccountSas/ |Действие|
|Microsoft.Storage/storageAccounts/listKeys/ | Действие|
|Microsoft.Compute/virtualMachines/ |чтение|
|Microsoft.Compute/virtualMachines/ |запись|
|Microsoft.Compute/virtualMachineScaleSets/ |чтение|
|Microsoft.Compute/virtualMachineScaleSets/ |запись|
|Microsoft.Network/networkWatchers/packetCaptures/ |чтение|
|Microsoft.Network/networkWatchers/packetCaptures/| запись|
|Microsoft.Network/networkWatchers/packetCaptures/| Удалить|
|Microsoft.Network/networkWatchers/ |запись |
|Microsoft.Network/networkWatchers/| чтение |
|Microsoft.Insights/alertRules/ |*|
|Microsoft.Support/ | *|

### <a name="network-subscription-limits"></a>Ограничения сетевых ресурсов подписки

Ограничения сетевых ресурсов подписки позволяют узнать об использовании каждого сетевого ресурса подписки в регионе и сравнить эти данные с максимальным количеством доступных ресурсов.

![Ограничения сетевых ресурсов подписки][nsl]

## <a name="network-resource-level-monitoring"></a>Мониторинг уровня сетевого ресурса

Ниже приведены функции мониторинга уровня ресурса.

### <a name="audit-log"></a>Журнал аудита

Регистрируются операции, выполняемые при настройке сетей. Эти журналы можно просмотреть на портале Azure или получить с помощью инструментов Майкрософт, таких как Power BI, или сторонних инструментов. Журналы аудита можно получить с помощью портала, PowerShell, интерфейса командной строки и REST API. Дополнительные сведения о журналах аудита см. в статье [Просмотр журналов действий для аудита действий с ресурсами](../resource-group-audit.md).

Доступны журналы аудита для операций, выполненных со всеми сетевыми ресурсами.

### <a name="metrics"></a>Метрики

Метрики представляют собой измерения производительности и счетчики, значения которых собираются за определенный период времени. В настоящее время доступны метрики для шлюза приложений. Метрики можно использовать для активации оповещений по пороговому значению. Прочитайте раздел [Диагностика шлюза приложений](../application-gateway/application-gateway-diagnostics.md), чтобы узнать, как можно использовать метрики для создания оповещений.

![Представление метрик][metrics]

### <a name="diagnostic-logs"></a>Журналы диагностики

Периодические и спонтанные события, создаваемые сетевыми ресурсами, регистрируются в журналах в учетных записях хранения, отправляются в концентратор событий или в Log Analytics. Эти журналы содержат подробные сведения о работоспособности ресурса. Их можно просматривать в таких инструментах, как Power BI и Log Analytics. Чтобы узнать, как просматривать журналы диагностики, посетите страницу [Log Analytics](../log-analytics/log-analytics-azure-networking-analytics.md).

Доступны журналы диагностики для [подсистемы балансировки нагрузки](../load-balancer/load-balancer-monitor-log.md), [групп безопасности сети](../virtual-network/virtual-network-nsg-manage-log.md), маршрутов и [шлюза приложений](../application-gateway/application-gateway-diagnostics.md).

Наблюдатель за сетями содержит представление журналов диагностики. Оно содержит все сетевые ресурсы, поддерживающие ведение журналов диагностики. В этом представлении можно удобно и быстро включать и отключать сетевые ресурсы.

![журналы][logs]

### <a name="troubleshooting"></a>Устранение неполадок

В настоящее время для сетевых ресурсов на портале предоставляется колонка устранения неполадок. С ее помощью можно диагностировать распространенные проблемы, связанные с отдельным ресурсом. Эта функция доступна для следующих сетевых ресурсов: ExpressRoute, VPN-шлюз, шлюз приложений, журналы безопасности сети, маршруты, DNS, подсистема балансировки нагрузки и диспетчер трафика. Чтобы узнать больше об устранении неполадок на уровне ресурса, ознакомьтесь со статьей [Diagnose and resolve issues with Azure Troubleshooting](https://azure.microsoft.com/blog/azure-troubleshoot-diagonse-resolve-issues/) (Диагностика и устранение проблем с помощью функции устранения неполадок Azure).

![Информация об устранении неполадок][TS]

### <a name="resource-health"></a>Работоспособность ресурса

Данные работоспособности сетевых ресурсов предоставляются периодически. К таким ресурсам относятся VPN-шлюз и VPN-туннель. Работоспособность ресурсов можно просмотреть на портале Azure. Чтобы узнать больше о работоспособности ресурсов, ознакомьтесь со статьей [Обзор службы работоспособности ресурсов Azure](../resource-health/resource-health-overview.md)

## <a name="next-steps"></a>Дальнейшие действия

После изучения Наблюдателя за сетями можно ознакомиться со следующими темами.

Запись пакетов виртуальной машины (см. раздел [Управление записью пакетов с помощью Наблюдателя за сетями Azure на портале Azure](network-watcher-packet-capture-manage-portal.md)).

Упреждающий мониторинг и диагностика с помощью [записи пакетов, активируемой оповещениями](network-watcher-alert-triggered-packet-capture.md).

Обнаружение уязвимостей путем [анализа записываемых пакетов с помощью Wireshark](network-watcher-deep-packet-inspection.md) и использования инструментов с открытым кодом.

Дополнительные сведения о некоторых других ключевых [сетевых возможностях](../networking/networking-overview.md) Azure.

<!--Image references-->
[TS]: ./media/network-watcher-monitoring-overview/troubleshooting.png
[logs]: ./media/network-watcher-monitoring-overview/logs.png
[metrics]: ./media/network-watcher-monitoring-overview/metrics.png
[nsl]: ./media/network-watcher-monitoring-overview/nsl.png











