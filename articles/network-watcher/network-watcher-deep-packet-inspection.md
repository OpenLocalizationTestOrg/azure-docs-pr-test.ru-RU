---
title: "aaaPacket проверок с использованием Наблюдатель сети Azure | Документы Microsoft"
description: "В этой статье описывается, как собирает toouse Наблюдатель сети tooperform глубокую проверку пакетов из виртуальной Машины"
services: network-watcher
documentationcenter: na
author: georgewallace
manager: timlt
editor: 
ms.assetid: 7b907d00-9c35-40f5-a61e-beb7b782276f
ms.service: network-watcher
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/22/2017
ms.author: gwallace
ms.openlocfilehash: 4aeddcd482edc4df3d63e87b5c4b0788c540850b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="packet-inspection-with-azure-network-watcher"></a>Проверка пакетов в службе наблюдения за сетями Azure

С помощью функции отслеживания пакетов hello Наблюдатель сети, можно инициировать и управления сеансами снимки виртуальных машин Azure hello портале PowerShell, CLI и программно через hello SDK и API-интерфейса REST. Захват пакетов позволяет tooaddress сценариев, требующих данных на уровне пакетов, предоставляя информацию hello в формате легче работать. Использование средств tooinspect hello данных, можно проверить связям tooand из виртуальных машин и проанализировать сетевой трафик. Вот некоторые примеры использования данных о собранных пакетах: анализ проблем с сетью или приложениями, обнаружение попыток вторжения и нарушений в сети, поддержание соответствия нормативным требованиям. В этой статье показано, как tooopen файл записи пакетов предоставляемые Наблюдатель сети с помощью средства с открытым исходным кодом. Корпорация Майкрософт также предоставляет примеры, показывающие, как идентифицировать нестандартных трафика toocalculate с задержкой подключения и изучить сетевой статистики.

## <a name="before-you-begin"></a>Перед началом работы

В этой статье рассматривается несколько предварительно настроенных сценариев на основе ранее выполненной операции записи пакетов. Эти сценарии демонстрируют возможности, связанные с использованием функции записи пакетов. В этом сценарии используется [WireShark](https://www.wireshark.org/) захват пакетов tooinspect hello.

Предполагается, что вы уже выполнили запись пакетов на виртуальной машине. как см захват пакетов toocreate toolearn [hello портале снимки пакетов управление](network-watcher-packet-capture-manage-portal.md) или с REST, посетив [управление снимки пакетов с помощью REST API](network-watcher-packet-capture-manage-rest.md).

## <a name="scenario"></a>Сценарий

В рамках этого сценария вы выполните:

* анализ записи пакетов;

## <a name="calculate-network-latency"></a>расчет задержки в сети.

В этом сценарии показано, как tooview hello начальной кругового пути время Передачи между двумя конечными точками диалога протокола управления передачей (TCP).

При установлении соединения TCP hello первые три пакетов, отправленных в соединении hello выполните шаблон часто называется tooas hello трехэтапного. При этом соединение было установлено, изучив hello отправленных этой подтверждения, начального запроса от клиента hello и ответа от сервера hello первых двух пакетов, можно вычислить hello задержки. Эта задержка — ссылка tooas hello времени кругового пути (Передачи). Дополнительные сведения о TCP-протокол hello и hello трехэтапного ссылаться toohello следующих ресурсов. https://support.microsoft.com/en-us/help/172983/explanation-of-the-three-way-handshake-via-tcp-ip

### <a name="step-1"></a>Шаг 1

Запустите WireShark

### <a name="step-2"></a>Шаг 2

Hello нагрузки **.cap** файл из получения пакетов. Этот файл можно найти в большом двоичном объекте hello, он был сохранен в нашем локально на hello виртуальной машины, в зависимости от того, как настроить.

### <a name="step-3"></a>Шаг 3.

tooview Здравствуйте начальной кругового пути время Передачи в диалогах TCP, мы только увидите приветственных первых двух пакетов, участвующих в подтверждение TCP hello. Мы будем использовать приветственных первых двух пакетов в hello трехэтапного, являющиеся hello [SYN], [SYN, ACK] пакеты. Они были указаны флаги, установленные в заголовке TCP hello. последний пакет приветствия в подтверждении hello, пакет приветствия [ACK], не будет использоваться в этом сценарии. При отправке пакета Hello [SYN] hello клиента. После получения hello сервер отправляет пакет приветствия [ACK] как подтверждение получения hello SYN от клиента hello. Используя hello том, что ответ сервера hello минимальными накладными расходами, вычислять приветствия времени приема-Передачи путем вычитания hello раз, когда пакет приветствия [SYN, ACK] было получено клиентом hello hello времени [SYN] пакетов отправлено клиентом hello.

Это значение мы можем получить с помощью средства WireShark.

toomore просматривать первых двух пакетов приветствия в hello TCP трехэтапного, мы будет использовать фильтрацию возможности, предоставляемые WireShark hello.

Фильтр tooapply hello в WireShark, разверните hello сегмент «Протокол» пакета [SYN] в вашей записи и просмотрите hello флаги, установленные в заголовке TCP hello.

Поскольку мы ищем toofilter на всех [SYN] и [SYN, ACK] пакеты в группе флаги cofirm что hello Syn бита too1, а затем щелкните правой кнопкой мыши на бит Syn hello -> применить как фильтр -> выбранные.

![Рис. 7.][7]

### <a name="step-4"></a>Шаг 4.

Теперь, когда фильтрации пакетов см. в разделе tooonly окно приветствия с hello [SYN] бит, можно легко выбрать диалогов, которые вас интересуют tooview hello начального времени приема-Передачи. Простой способ tooview hello времени приема-Передачи в WireShark просто откройте раскрывающийся список hello, помеченные анализа «SEQ/ACK». Вы увидите hello отображения времени приема-Передачи. В этом случае hello времени приема-Передачи было 0.0022114 секунд или 2.211 мс.

![Рис. 8.][8]

## <a name="unwanted-protocols"></a>Нежелательные протоколы

На вашем экземпляре виртуальной машины, развернутом в Azure, может работать множество приложений. Многие из этих приложений обмениваются данными по сети hello, возможно без явного разрешения. С помощью пакета отслеживания toostore сетевого взаимодействия, мы рассмотрим как приложения, идет речь в сети hello и найдите все проблемы.

В этом примере мы проанализируем уже выполненный захват пакетов, чтобы проверить наличие нежелательных протоколов, которые могут указывать на несанкционированное сетевое взаимодействие запущенных на компьютере приложений.

### <a name="step-1"></a>Шаг 1

С помощью hello же выделение в предыдущем сценарии щелкните hello **статистики** > **протокола иерархии**

![Пункт меню "Иерархия протоколов"][2]

Появится окно иерархии протокола Hello. Это представление содержит список всех hello протоколы, используемые во время сеанса захвата hello и hello число пакетов, отправленных и полученных с помощью протоколов hello. Это представление позволяет обнаруживать нежелательный трафик на виртуальных машинах или в сети.

![Открытое представление иерархии протоколов][3]

Как видно в следующий снимок экрана приветствия произошла трафика с помощью протокола отправляемому BitTorrent hello, который используется для одноранговых toopeer общий доступ к файлам. Как администратор предполагается, что трафик отправляемому BitTorrent toosee этой конкретной виртуальных машинах. Теперь можно учитывать трафик, можно будет удалить hello одноранговых toopeer по, установленный на этой виртуальной машины или блок hello трафика с помощью групп безопасности сети или брандмауэра. Кроме того вы можете еще toorun захват пакетов по расписанию, что использование протокола hello регулярно можно просмотреть на виртуальных машинах. Пример на выполнение задач tooautomate сети в azure посещение [отслеживать ресурсы сети со службой автоматизации azure](network-watcher-monitor-with-azure-automation.md)

## <a name="finding-top-destinations-and-ports"></a>Поиск самых активных адресов назначения и портов

Основные сведения о hello типы трафика, hello конечные точки и порты hello по является очень важным при отслеживании и устранения неполадок приложений и ресурсов в сети. Использование файла записи пакетов выше, можно быстро узнать hello основные пункты назначения нашей виртуальной Машины взаимодействует и порты используемого hello.

### <a name="step-1"></a>Шаг 1

С помощью hello же выделение в предыдущем сценарии щелкните hello **статистики** > **статистику IPv4** > **назначения и порты**

![Окно захвата пакетов][4]

### <a name="step-2"></a>Шаг 2

Как мы будем по результатам hello строки важные моменты, было несколько подключений через порт 111. наиболее используемых Hello порт был 3389, удаленный рабочий стол, а оставшиеся hello являются динамические порты RPC.

Этот трафик может ничего не значат, но это порт, который использовался для количества подключений и Неизвестный toohello администратором.

![Рис. 5.][5]

### <a name="step-3"></a>Шаг 3.

Теперь, после определения недостаточно, можно отфильтровать нашей отслеживания учетом hello порта порта месте.

Фильтр Hello в этом сценарии будет выглядеть так:

```
tcp.port == 111
```

Мы введите текст фильтра hello выше в текстовом поле фильтра hello и нажмите клавишу ВВОД.

![Рис. 6.][6]

На основе результатов hello видно hello трафик поступает от локальной виртуальной машины на hello одной подсети. Если мы по-прежнему не понять, почему происходит этот трафик, мы дальнейшей проверки toodetermine пакетов hello, почему он выполняет эти вызовы на порту 111. Эта информация может занять hello соответствующее действие.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о hello других возможностей отладки Наблюдатель сети, посетив [Обзор монитора сети Azure](network-watcher-monitoring-overview.md)

[1]: ./media/network-watcher-deep-packet-inspection/figure1.png
[2]: ./media/network-watcher-deep-packet-inspection/figure2.png
[3]: ./media/network-watcher-deep-packet-inspection/figure3.png
[4]: ./media/network-watcher-deep-packet-inspection/figure4.png
[5]: ./media/network-watcher-deep-packet-inspection/figure5.png
[6]: ./media/network-watcher-deep-packet-inspection/figure6.png
[7]: ./media/network-watcher-deep-packet-inspection/figure7.png
[8]: ./media/network-watcher-deep-packet-inspection/figure8.png













