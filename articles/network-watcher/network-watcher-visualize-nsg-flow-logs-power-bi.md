---
title: "Визуализация журналов потоков для групп безопасности сети с помощью Power BI | Документация Майкрософт"
description: "В этой статье описывается визуализация журналов потоков для групп безопасности сети с помощью Power BI."
services: network-watcher
documentationcenter: na
author: jimdial
manager: timlt
editor: 
ms.assetid: 1e4f95fa-f5f0-4e03-bc25-008fbfc4934c
ms.service: network-watcher
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/22/2017
ms.author: jdial
ms.openlocfilehash: f32c8cd6e32e99bc34d62435bcd1883ba957e716
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="visualizing-network-security-group-flow-logs-with-power-bi"></a>Визуализация журналов потоков для групп безопасности сети с помощью Power BI

Журналы потоков для групп безопасности сети позволяют просматривать информацию о входящем и исходящем IP-трафике групп безопасности сети. Эти журналы потоков отображают для каждого входящего и исходящего потока применимые правила, сетевой адаптер, к которому относится поток, информацию о 5 кортежах (исходный IP-адрес и порт, конечный IP-адрес и порт, тип протокола), а также информацию о запрете или разрешении трафика.

Ручной поиск по файлам журналов невозможно использовать для анализа информации. В этой статье описано решение, позволяющее визуализировать свежие записи журналов потоков и выполнять анализ трафика в сети.

## <a name="scenario"></a>Сценарий

В следующем сценарии мы подключим Power BI Desktop к учетной записи хранения, которую мы настроили в качестве приемника для данных журнала потоков для групп безопасности сети. Подключившись к учетной записи хранения, Power BI выполняет загрузку и синтаксический анализ журналов, а затем наглядно отображает весь трафик, зарегистрированный для групп безопасности сети.

Предложенные в шаблоне визуальные элементы позволяют изучить следующие аспекты информации:

* наиболее активные источники трафика;
* данные потоков временных рядов по направлениям и типам правил;
* потоки по MAC-адресам сетевых интерфейсов;
* потоки по группам безопасности сети и правилам;
* потоки по конечным портам.

Вы можете изменить предложенный шаблон, чтобы добавить в него новые данные и визуальные элементы или изменять запросы в соответствии со своими задачами.

## <a name="setup"></a>Настройка

Прежде чем мы начнем работу, вам необходимо включить журналы потоков для одной или нескольких групп безопасности сети в вашей учетной записи. Инструкции по включению журналов потоков для групп безопасности сети есть в статье [Introduction to flow logging for Network Security Groups](network-watcher-nsg-flow-logging-overview.md) (Введение в журналы потоков для групп безопасности сети).

Также вам потребуется компьютер с установленным клиентом Power BI Desktop и достаточным объемом дискового пространства для хранения и загрузки данных журналов, сохраненных в учетной записи хранения.

![Схема Visio][1]

### <a name="steps"></a>Действия

1. Скачайте и откройте следующий шаблон Power BI в приложении Power BI Desktop: [шаблон журнала потоков Наблюдателя за сетями Power BI](https://aka.ms/networkwatcherpowerbiflowlogstemplate).
1. Введите обязательные параметры запроса.
    1. **StorageAccountName** — указывает имя учетной записи хранения, содержащей журналы потоков для групп безопасности сети, которые вы хотите загрузить и визуализировать.
    1. **NumberOfLogFiles** — указывает количество файлов журнала, которые нужно скачать и визуализировать в Power BI. Например, если указано значение 50, используются 50 последних файлов журнала. Если в этой учетной записи мы настроили отправку журналов потоков от двух групп безопасности сети, то мы сможем просмотреть журналы за последние 25 часов.

    ![Главный экран Power BI][2]

1. Введите ключ доступа к учетной записи хранения. Чтобы найти нужный ключ доступа, перейдите на портале Azure к учетной записи хранения и выберите пункт **Ключи доступа** в меню "Параметры". Щелкните **Подключить** и примените изменения.

    ![ключи доступа][3]

    ![Ключи доступа (2)][4]

4.  Теперь начнется загрузка и анализ журналов, а затем вы сможете использовать заранее настроенные визуальные элементы.

## <a name="understanding-the-visuals"></a>Основные сведения о визуальных элементах

В шаблоне описан набор визуальных элементов, которые помогают анализировать данные журнала потоков для групп безопасности сети. На следующих изображениях показаны примеры того, как выглядит панель мониторинга, заполненная данными. Ниже мы подробнее рассмотрим каждый визуальный элемент. 

![Power BI][5]
 
Визуальный элемент Top Talkers (Наиболее активные источники трафика) отображает IP-адреса, от которых за исследуемый период исходило больше всего количество подключений. Размер прямоугольников соответствует относительному количеству подключений. 

![Наиболее активные источники трафика][6]

На следующих диаграммах временных рядов отображается число потоков за исследуемый период. Верхний граф сегментируется по направлению потока, а нижний — по принятым решениям в отношении потока (разрешен или запрещен). Этот визуальный элемент позволяет изучить тенденции изменения трафика во времени, выявить необычные всплески активности, а также отклонения или сегментацию трафика.

![Потоки по периодам][7]

На следующих диаграммах показано количество потоков по сетевым интерфейсам. Верхняя сегментируется по направлению потока, а нижняя — по принятым решениям. Эта информация позволяет проанализировать, какая из виртуальных машин передает больше трафика по сравнению с другими и разрешен или запрещен трафик на конкретную виртуальную машину.

![Потоки по сетевым интерфейсам][8]

На следующей кольцевой диаграмме представлено распределение потоков по портам назначения. Эти данные позволяют выяснить наиболее часто используемые порты назначения за исследуемый период.

![Кольцевая диаграмма][9]

На следующей линейчатой диаграмме потоки представлены по группам безопасности сети и правилам. Эта информация позволяет выяснить, какие группы безопасности сети отвечают за большую часть трафика, а также изучить распределение трафика в группе безопасности сети по отдельным правилам.

![Линейчатая диаграмма][10]
 
На следующих информационных диаграммах отображаются сведения о группах безопасности сети, которые встречаются в журналах, число потоков за исследуемый период, а также дата самой ранней записи в журналах. Эти сведения позволяют понять, какие группы безопасности сети и какие периоды включены в журнал.

![Информационная диаграмма 1][11]

![Информационная диаграмма 2][12]

Этот шаблон включает следующие срезы, которые позволяют просматривать только интересующие вас данные. Вы можете использовать фильтры по группам ресурсов, группам безопасности сети и правилам. Также вы можете фильтровать данные по 5 кортежам, по решениям и времени записи данных в журнал.

![Срезы][13]

## <a name="conclusion"></a>Заключение

В этом сценарии мы продемонстрировали, как визуализировать и анализировать трафик, используя журналы потоков для групп безопасности сети, Наблюдатель за сетями и Power BI. На основе предложенного шаблона Power BI скачивает журналы непосредственно из хранилища и обрабатывает их локально. Время, которое потребуется для загрузки шаблона, зависит от числа запрошенных файлов и общего объема скачанных файлов.

Вы можете настроить этот шаблон в соответствии с конкретными потребностями. Есть очень много способов применить Power BI в сочетании с журналами потоков для групп безопасности сети. 

## <a name="notes"></a>Примечания

* Журналы по умолчанию хранятся в следующем расположении: `https://{storageAccountName}.blob.core.windows.net/insights-logs-networksecuritygroupflowevent/`

    * Если у вас есть другие данные, которые хранятся в другом каталоге, следует соответствующим образом изменить запросы на получение и обработку данных.

* Мы не рекомендуем применять этот шаблон, если объем журналов превышает 1 ГБ.

* Если у вас очень много журналов для анализа, мы рекомендуем использовать другое хранилище данных, например Data Lake или SQL Server.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как визуализировать журналы потоков для групп безопасности сети с помощью Elastick Stack, прочитав статью [Visualize network traffic patterns to and from your VMs using open source tools](network-watcher-using-open-source-tools.md) (Визуализация сетевого трафика на виртуальных машинах с помощью средств с открытым кодом).

[1]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure1.png
[2]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure2.png
[3]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure3.png
[4]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure4.png
[5]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure5.png
[6]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure6.png
[7]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure7.png
[8]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure8.png
[9]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure9.png
[10]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure10.png
[11]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure11.png
[12]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure12.png
[13]: ./media/network-watcher-visualize-nsg-flow-logs-power-bi/figure13.png
