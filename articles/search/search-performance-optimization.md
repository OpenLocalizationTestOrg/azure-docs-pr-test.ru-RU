---
title: "вопросы производительности и оптимизации поиска aaaAzure | Документы Microsoft"
description: "Настройка производительности Поиска Azure и выбор оптимального масштаба"
services: search
documentationcenter: 
author: LiamCavanagh
manager: pablocas
editor: 
ms.assetid: 4d3cd864-29d2-4921-be0d-a3f1a819de46
ms.service: search
ms.devlang: rest-api
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 05/01/2017
ms.author: liamca
ms.openlocfilehash: 725149ba32773ab6b4c9d4b441424aba78db7c42
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-search-performance-and-optimization-considerations"></a>Рекомендации по производительности и оптимизации Поиска Azure
Значительные поисковый интерфейс является ключа toosuccess многих мобильных и веб-приложений. Из недвижимость tooused автомобиль рынков tooonline каталогов, быстрый поиск и соответствующие запросу результаты повлияет hello качества. Данный документ является предполагаемым toohelp, ознакомьтесь с рекомендациями для как hello tooget наиболее эффективно использовать службы поиска Azure, особенно для сложных сценариев с сложные требования к масштабируемости, поддержка нескольких языков или пользовательские ранжирования.  Кроме того, в этом документе описаны внутренние механизмы и рассмотрены подходы, которые эффективно работают в реальных клиентских приложениях.

## <a name="performance-and-scale-tuning-for-search-services"></a>Настройка производительности и масштабирования для служб поиска
Не все используемые toosearch ядра, например Bing и Google и hello высокая производительность, они предоставляют.  В результате, когда клиенты используют ваше мобильное или веб-приложение с функцией поиска, они ожидают подобных характеристик производительности.  При оптимизации для повышения производительности поиска одним из оптимальных способов hello является toofocus на задержки — hello время, затрачиваемое toocomplete и возврат результатов запроса.  При оптимизации задержки при поиске важно следующее.

1. Выберите целевой задержкой (или максимальное количество времени), запрос на поиск типичных требуемого toocomplete.
2. Создайте и протестируйте эти курсы задержки реальными рабочими нагрузками для службы поиска с toomeasure реалистичный набор данных.
3. Начните с небольшое количество запросов в секунду (QPS) и продолжить число hello tooincrease, выполненных в тесте hello, пока целевой задержкой запроса hello задержки падает ниже hello.  Это важные тестирования toohelp, спланируйте горизонтальное масштабирование по мере роста приложения в использовании.
4. По возможности повторно используйте подключения HTTP.  Если вы используете пакет SDK Azure Search .NET hello, это означает, следует использовать экземпляр или [SearchIndexClient](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchindexclient) экземпляром и если вы используете hello REST API, следует использовать один HttpClient.

При создании этих проверка рабочих нагрузок, существуют некоторые характеристики tookeep поиска Azure в виду.

1. Это возможно, toopush поиска такого большого количества запросов за один раз, будет переполниться hello доступные ресурсы в службе поиска Azure.  В этом случае вы увидите коды ответов HTTP 503.  По этой причине это лучший toostart с различными диапазонами различия hello toosee запросов поиска курсов задержки при добавлении нескольких запросов на поиск.
2. Передача содержимого tooAzure, которые влияют на поиск hello общую производительность и задержка hello службы поиска Azure.  Если ожидается, что toosend данных при выполнении поиска пользователей, это важные tootake этой рабочей нагрузки в учетной записи в тестах.
3. Не каждый запрос поиска будет выполнять на hello же уровни производительности.  Например, поиск документа или предложение по поиску обычно будет выполняться быстрее, чем запрос со значительным количеством аспектов и фильтров.  Это наиболее hello tootake различных запросов, которые предполагается, что toosee в учетной записи при построении тестов.  
4. Вариант поисковых запросов важен, поскольку при выполнении постоянно hello же поиска запросов, кэширование данных производительности toomake начала выглядит лучше, чем они могут с помощью запроса более разнородных заданы.

> [!NOTE]
> [Тестирование нагрузки Visual Studio](https://www.visualstudio.com/docs/test/performance-testing/run-performance-tests-app-before-release) является очень удобным способом tooperform вашего теста производительности тесты как с ее помощью можно tooexecute HTTP-запросов, чем потребовалось для выполнения запросов к поиска Azure и позволяет осуществлять параллельный запросов.
> 
> 

## <a name="scaling-azure-search-for-high-query-rates-and-throttled-requests"></a>Масштабирование Поиска Azure для обработки высокой частоты запросов и регулируемых запросов
При получают слишком много регулируемые запросы или превышать целевой тарифы задержки загрузки запроса на повышение ставки toodecrease задержки могут быть одним из двух способов:

1. **Увеличение реплики:** реплика является как копия разрешение запросов баланс tooload поиска Azure для hello несколько копий данных.  Все Балансировка нагрузки и репликация данных между репликами управляется поиска Azure и hello число реплик, выделенные для службы в любое время можно изменить.  Можно выделить too12 реплик в стандартную службу поиска и 3 реплик службы Basic поиска. Реплики может быть скорректирована, либо из hello [портал Azure](search-create-service-portal.md) или [PowerShell](search-manage-powershell.md).
2. **Повысьте уровень поиска**. Поиск Azure поставляется на [нескольких уровнях](https://azure.microsoft.com/pricing/details/search/), и каждый из них предлагает различные уровни производительности.  В некоторых случаях возможно этого уровня hello, на которые не может предоставить ставки достаточно низкой задержкой, даже в том случае, если израсходован реплик такого большого количества запросов.  В этом случае вы можете tooconsider, используя один из hello более высоких уровней поиска, такие как уровень hello S3 поиска Azure, который хорошо подходит для сценариев с большим количеством документов и рабочих нагрузок очень большое число запросов.

## <a name="scaling-azure-search-for-slow-individual-queries"></a>Масштабирование Поиска Azure для медленных отдельных запросов
Другая причина, почему ставки задержка может быть медленным состоит из одного запроса занимает слишком много времени toocomplete.  В этом случае добавление реплик не понизит задержки.  Доступны два варианта.

1. **Увеличьте число секций**. Секция представляет собой механизм разделения данных между дополнительными ресурсами.  Поэтому при добавлении второй секции данные делятся на две части.  Третья секция разделит ваш индекс на три и т. д.  Это также приводит hello, в некоторых случаях медленных запросов выполняется быстрее из-за toohello параллелизации вычислений.  Существует ряд примеров, в которых распараллеливание было чрезвычайно эффективно при выполнении запросов, содержащих запросы с низкой селективностью.  Сюда входят запросы, задающие большое число документов или необходимости аспекты tooprovide подсчитывает через большое количество документов.  Так как она большой объем вычислений нужен релевантности hello tooscore hello документов или toocount hello количеством документов, для добавления дополнительных секций может помочь tooprovide дополнительных вычислений.  
   
   Может быть более 12 разделов в стандартную службу поиска и 1 раздела в службе поиска basic hello.  Секции могут быть изменены из hello [портал Azure](search-create-service-portal.md) или [PowerShell](search-manage-powershell.md).
2. **Ограничение высокий уровень количества элементов поля:** поле большого количества элементов состоит из facetable или фильтруемых поля, со значительным числом уникальных значений и в результате его место занимает большую часть ресурсов toocompute результаты.   Например настройкой поля Product ID или описание поддерживает фильтрацию или facetable сделает для большого количества элементов потому, что большинство значений hello из документа toodocument являются уникальными. По возможности ограничить количество hello полей большого количества элементов.
3. **Увеличьте уровень поиска:** движении tooa выше уровня поиска Azure может быть другим способом tooimprove производительность медленных запросов.  Более высокий уровень также предоставляет более быстрые процессоры и больше памяти, что может положительно повлиять на производительность запросов.

## <a name="scaling-for-availability"></a>Масштабирование для обеспечения доступности
Реплики не только уменьшают задержки при обработке запросов, но и могут обеспечить высокий уровень доступности.  С одной реплики следует ожидать периодического время простоя из-за перезагрузки tooserver после обновления программного обеспечения или для других событий обслуживания, которые будут внесены.  В результате является важным tooconsider приложению требуется высокий уровень доступности поисковых запросов (запросов) и записи (индексирования событий).  Поиск Azure предоставляет параметры соглашения об уровне ОБСЛУЖИВАНИЯ на всех hello платной поиска предложений с hello следующие атрибуты.

* 2 реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
* 3 или более реплики для обеспечения высокой доступности рабочих нагрузок чтения и записи (запросов и индексирования).

Дополнительные сведения об этой веб-сайте hello [соглашении об уровне обслуживания Azure поиска](https://azure.microsoft.com/support/legal/sla/search/v1_0/).

Поскольку реплик копии данных, имеющих несколько реплик позволяет после перезагрузки компьютера toodo поиска Azure и обслуживания с одной реплики, одновременно поддерживая запрашивает toobe toocontinue выполняться hello другими репликами.  По этой причине необходимо также tooconsider влияние перерыву hello запросы, которые теперь имеют toobe выполняться меньше одной копии данных hello.

## <a name="scaling-geo-distributed-workloads-and-provide-geo-redundancy"></a>Масштабирование геораспределенных рабочих нагрузок и обеспечение геоизбыточности
Для географически распределенных рабочих нагрузок вы обнаружите, у пользователей, расположенный далеко от hello центра обработки данных, где службы поиска Azure высокоскоростных задержки.  По этой причине часто бывает важные toohave поиска несколько служб в области, которые находятся в ближе близости toothese пользователей.  Поиск Azure в настоящее время не предоставить метод автоматических географическая репликация индексов поиска Azure по регионам, но существуют некоторые методы, которые можно использовать, можно сделать это tooimplement простой процесс и управлять ими. Они показаны на hello следующие несколько разделов.

Hello цель набор географически распределенных служб поиска — toohave два или несколько индексов, доступных в два или несколько областей, где пользователь не будет направлено toohello службы поиска Azure, которая обеспечивает наименьшую задержку hello, как показано в этом примере:

   ![Перекрестные запросы к службам по региону][1]

### <a name="keeping-data-in-sync-across-multiple-azure-search-services"></a>Синхронизация данных между несколькими службами Поиска Azure
Существует два варианта хранения распределенной службы поиска синхронизацию которых состоит из либо с помощью hello [индексатор поиска Azure](search-indexer-overview.md) или hello Push-API (также называется tooas hello [REST API поиска Azure](https://docs.microsoft.com/rest/api/searchservice/)).  

### <a name="azure-search-indexers"></a>Индексаторы Поиска Azure
При использовании hello индексатор поиска Azure уже выполняется импорт изменений данных из центрального хранилища данных, таких как база данных SQL Azure или Azure Cosmos DB. При создании нового поиска службы, можно просто создать новый индексатор поиска Azure для этой службы, toothis точки же хранилище данных. Таким образом, каждый раз, когда поступают новые изменения в хранилище данных hello, они вновь будут проиндексирован hello различных индексаторов.  

Ниже приведен пример этой архитектуры.

   ![Один источник данных с сочетаниями распределенного индексатора и службы][2]

### <a name="push-api"></a>API Push
Если вы используете hello Push API поиска Azure слишком[обновление содержимого в индекс поиска Azure](https://docs.microsoft.com/rest/api/searchservice/update-index), можно сохранить различными службами поиска синхронизацию с помощью принудительной отправки изменений служб поиска tooall всякий раз, когда требуется выполнить обновление.  При этом это toomake важно убедиться, что toohandle случаев, когда служба поиска tooone обновления не и успешного выполнения одного или нескольких обновлений.

## <a name="leveraging-azure-traffic-manager"></a>Использование диспетчера трафика Azure
[Диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) позволяет tooroute запросов toomultiple расположенный geo веб-сайтов, затем поддерживаемый несколько служб поиска Azure.  Одно из преимуществ hello диспетчера трафика является можно производить tooensure поиска Azure, что он доступен и маршрутизации пользователей служб поиска tooalternate hello события времени простоя.  Кроме того если маршрутизация выполняется поиск запросы через веб-сайтов Azure, диспетчер трафика Azure позволяет tooload баланс случаях, когда веб-сайт hello копии, но не для поиска Azure.  Ниже приведен пример какие hello архитектуру, которая использует диспетчера трафика.

   ![Перекрестные запросы к службам по региону с использованием диспетчера трафика][3]

## <a name="monitoring-performance"></a>Мониторинг производительности
Поиск Azure обеспечивает hello возможность tooanalyze и монитор hello производительность службы с помощью [аналитика трафика поиска (STA)](search-traffic-analytics.md). Через STA вы можете при необходимости войти hello поиска отдельных операций, а также учетную запись хранилища Azure сводные показатели tooan, затем можно обработать для анализа или визуализации Power BI.  С помощью метрик STA можно просмотреть статистику производительности, например среднее количество запросов или время ответа на запрос.  Кроме того ведение журнала hello операции можно toodrill в подробные сведения об операциях поиска.

STA является ставки задержки ценным инструментом toounderstand с этой точки зрения поиска Azure.  Поскольку журнал метрики производительности запросов hello основаны на времени hello запрос выполняется toobe полностью обработан в поиске Azure (от hello времени это запрошенный toowhen отправкой), то может toouse этот toodetermine одинаковых проблемы задержки с hello службы поиска Azure параллельное или за пределами hello service, например, от задержки в сети.  

## <a name="next-steps"></a>Дальнейшие действия
toolearn Дополнительные сведения о hello цены уровни и ограничения служб для каждого из них, в разделе [службы ограничения в поиске Azure](search-limits-quotas-capacity.md).

Посетите [планирования емкости](search-capacity-planning.md) toolearn Дополнительные сведения о сочетаниях секции и реплики.

Дополнительные углубленной детализации на производительность и toosee некоторые демонстрации tooimplement Здравствуйте оптимизации, как описано в этом разделе можно отслеживать следующие видео hello:

> [!VIDEO https://channel9.msdn.com/Events/Microsoft-Azure/AzureCon-2015/ACON319/player]
> 
> 

<!--Image references-->
[1]: ./media/search-performance-optimization/geo-redundancy.png
[2]: ./media/search-performance-optimization/scale-indexers.png
[3]: ./media/search-performance-optimization/geo-search-traffic-mgr.png
