---
title: "Моделирование мультитенантности в службе поиска Azure | Документация Майкрософт"
description: "Узнайте о распространенных шаблонах разработки мультитенантных приложений SaaS с использованием Поиска Azure."
services: search
manager: jhubbard
author: ashmaka
documentationcenter: 
ms.assetid: 72e9696a-553b-47dc-9e05-a82db0ebf094
ms.service: search
ms.devlang: NA
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 10/26/2016
ms.author: ashmaka
ms.openlocfilehash: fd1b0c7cc8210d27fdc500bf4e5641bedfe93cff
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="design-patterns-for-multitenant-saas-applications-and-azure-search"></a><span data-ttu-id="ae7ca-103">Шаблоны разработки для мультитенантных приложений SaaS и Поиска Azure</span><span class="sxs-lookup"><span data-stu-id="ae7ca-103">Design patterns for multitenant SaaS applications and Azure Search</span></span>
<span data-ttu-id="ae7ca-104">Мультитенантным называется приложение, предоставляющее одинаковые службы и возможности любому числу клиентов, каждый из которых не может видеть или совместно использовать данные любого другого клиента.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-104">A multitenant application is one that provides the same services and capabilities to any number of tenants who cannot see or share the data of any other tenant.</span></span> <span data-ttu-id="ae7ca-105">В этом документе рассматриваются стратегии изоляции клиентов в мультитенантных приложениях на основе Поиска Azure.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-105">This document discusses tenant isolation strategies for multitenant applications built with Azure Search.</span></span>

## <a name="azure-search-concepts"></a><span data-ttu-id="ae7ca-106">Основные понятия Поиска Azure</span><span class="sxs-lookup"><span data-stu-id="ae7ca-106">Azure Search concepts</span></span>
<span data-ttu-id="ae7ca-107">Являясь решением поиска как услуги, Поиск Azure позволяет разработчикам добавлять широкие возможности поиска в приложения без необходимости управлять какой-либо инфраструктурой или становиться экспертом в области поиска.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-107">As a search-as-a-service solution, Azure Search allows developers to add rich search experiences to applications without managing any infrastructure or becoming an expert in search.</span></span> <span data-ttu-id="ae7ca-108">Данные передаются в службу и затем сохраняются в облаке.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-108">Data is uploaded to the service and then stored in the cloud.</span></span> <span data-ttu-id="ae7ca-109">С помощью простых запросов к API Поиска Azure можно изменять и искать данные.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-109">Using simple requests to the Azure Search API, the data can then be modified and searched.</span></span> <span data-ttu-id="ae7ca-110">Обзор данной службы можно найти в [этой статье](http://aka.ms/whatisazsearch).</span><span class="sxs-lookup"><span data-stu-id="ae7ca-110">An overview of the service can be found in [this article](http://aka.ms/whatisazsearch).</span></span> <span data-ttu-id="ae7ca-111">Прежде чем перейти к обсуждению шаблонов разработки, важно усвоить некоторые основные понятия, используемые в Поиске Azure.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-111">Before discussing design patterns, it is important to understand some concepts in Azure Search.</span></span>

### <a name="search-services-indexes-fields-and-documents"></a><span data-ttu-id="ae7ca-112">Службы поиска, индексы, поля и документы</span><span class="sxs-lookup"><span data-stu-id="ae7ca-112">Search services, indexes, fields, and documents</span></span>
<span data-ttu-id="ae7ca-113">При использовании Поиска Azure пользователь подписывается на *службу поиска*.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-113">When using Azure Search, one subscribes to a *search service*.</span></span> <span data-ttu-id="ae7ca-114">После передачи в Поиск Azure данные сохраняются в *индексе* в службе поиска.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-114">As data is uploaded to Azure Search, it is stored in an *index* within the search service.</span></span> <span data-ttu-id="ae7ca-115">В одной службе может существовать множество индексов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-115">There can be a number of indexes within a single service.</span></span> <span data-ttu-id="ae7ca-116">Чтобы оперировать привычными понятиями баз данных, службу поиска можно сравнить с базой данных, а индексы в службе — с таблицами в базе данных.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-116">To use the familiar concepts of databases, the search service can be likened to a database while the indexes within a service can be likened to tables within a database.</span></span>

<span data-ttu-id="ae7ca-117">Каждый индекс в службе поиска имеет свою собственную схему, которая определяется рядом настраиваемых *полей*.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-117">Each index within a search service has its own schema, which is defined by a number of customizable *fields*.</span></span> <span data-ttu-id="ae7ca-118">Данные добавляются в индекс Поиска Azure в виде отдельных *документов*.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-118">Data is added to an Azure Search index in the form of individual *documents*.</span></span> <span data-ttu-id="ae7ca-119">Каждый документ необходимо передать в определенный индекс, при этом данный документ должен соответствовать схеме индекса.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-119">Each document must be uploaded to a particular index and must fit that index's schema.</span></span> <span data-ttu-id="ae7ca-120">При поиске данных с использованием Поиска Azure выполняются запросы полнотекстового поиска в определенном индексе.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-120">When searching data using Azure Search, the full-text search queries are issued against a particular index.</span></span>  <span data-ttu-id="ae7ca-121">Чтобы провести аналогию этих понятий с базой данных, поля можно сравнить со столбцами в таблице, а документы — со строками.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-121">To compare these concepts to those of a database, fields can be likened to columns in a table and documents can be likened to rows.</span></span>

### <a name="scalability"></a><span data-ttu-id="ae7ca-122">Масштабируемость</span><span class="sxs-lookup"><span data-stu-id="ae7ca-122">Scalability</span></span>
<span data-ttu-id="ae7ca-123">Любую службу Поиска Azure в [ценовой категории](https://azure.microsoft.com/pricing/details/search/) "Стандартный" можно масштабировать по двум измерениям: хранилищу и доступности.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-123">Any Azure Search service in the Standard [pricing tier](https://azure.microsoft.com/pricing/details/search/) can scale in two dimensions: storage and availability.</span></span>

* <span data-ttu-id="ae7ca-124">*секции* для увеличения хранилища службы поиска.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-124">*Partitions* can be added to increase the storage of a search service.</span></span>
* <span data-ttu-id="ae7ca-125">*реплики* .</span><span class="sxs-lookup"><span data-stu-id="ae7ca-125">*Replicas* can be added to a service to increase the throughput of requests that a search service can handle.</span></span>

<span data-ttu-id="ae7ca-126">Добавление и удаление секций и реплик в любое время позволяет увеличивать емкость службы поиска по мере роста объема данных и трафика, необходимых приложению.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-126">Adding and removing partitions and replicas at will allow the capacity of the search service to grow with the amount of data and traffic the application demands.</span></span> <span data-ttu-id="ae7ca-127">Чтобы служба поиска выполняла [соглашение об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/search/v1_0/)чтения, требуется две реплики.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-127">In order for a search service to achieve a read [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/), it requires two replicas.</span></span> <span data-ttu-id="ae7ca-128">Чтобы служба поиска выполняла [соглашение об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/search/v1_0/)чтения и записи, требуется три реплики.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-128">In order for a service to achieve a read-write [SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/), it requires three replicas.</span></span>

### <a name="service-and-index-limits-in-azure-search"></a><span data-ttu-id="ae7ca-129">Ограничения служб и индексов в Поиске Azure</span><span class="sxs-lookup"><span data-stu-id="ae7ca-129">Service and index limits in Azure Search</span></span>
<span data-ttu-id="ae7ca-130">В Поиске Azure существует несколько разных [ценовых категорий](https://azure.microsoft.com/pricing/details/search/), каждая из которых имеет свои [ограничения и квоты](search-limits-quotas-capacity.md).</span><span class="sxs-lookup"><span data-stu-id="ae7ca-130">There are a few different [pricing tiers](https://azure.microsoft.com/pricing/details/search/) in Azure Search, each of the tiers has different [limits and quotas](search-limits-quotas-capacity.md).</span></span> <span data-ttu-id="ae7ca-131">Некоторые из этих ограничений действуют на уровне службы, некоторые — на уровне индекса, а некоторые — на уровне секции.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-131">Some of these limits are at the service-level, some are at the index-level, and some are at the partition-level.</span></span>

|  | <span data-ttu-id="ae7ca-132">базовая;</span><span class="sxs-lookup"><span data-stu-id="ae7ca-132">Basic</span></span> | <span data-ttu-id="ae7ca-133">Standard1</span><span class="sxs-lookup"><span data-stu-id="ae7ca-133">Standard1</span></span> | <span data-ttu-id="ae7ca-134">Standard2</span><span class="sxs-lookup"><span data-stu-id="ae7ca-134">Standard2</span></span> | <span data-ttu-id="ae7ca-135">Standard3</span><span class="sxs-lookup"><span data-stu-id="ae7ca-135">Standard3</span></span> | <span data-ttu-id="ae7ca-136">Standard3 HD</span><span class="sxs-lookup"><span data-stu-id="ae7ca-136">Standard3 HD</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="ae7ca-137">Максимальное число реплик на службу</span><span class="sxs-lookup"><span data-stu-id="ae7ca-137">Maximum Replicas per Service</span></span> |<span data-ttu-id="ae7ca-138">3</span><span class="sxs-lookup"><span data-stu-id="ae7ca-138">3</span></span> |<span data-ttu-id="ae7ca-139">12</span><span class="sxs-lookup"><span data-stu-id="ae7ca-139">12</span></span> |<span data-ttu-id="ae7ca-140">12</span><span class="sxs-lookup"><span data-stu-id="ae7ca-140">12</span></span> |<span data-ttu-id="ae7ca-141">12</span><span class="sxs-lookup"><span data-stu-id="ae7ca-141">12</span></span> |<span data-ttu-id="ae7ca-142">12</span><span class="sxs-lookup"><span data-stu-id="ae7ca-142">12</span></span> |
| <span data-ttu-id="ae7ca-143">Максимальное число секций на службу</span><span class="sxs-lookup"><span data-stu-id="ae7ca-143">Maximum Partitions per Service</span></span> |<span data-ttu-id="ae7ca-144">1</span><span class="sxs-lookup"><span data-stu-id="ae7ca-144">1</span></span> |<span data-ttu-id="ae7ca-145">12</span><span class="sxs-lookup"><span data-stu-id="ae7ca-145">12</span></span> |<span data-ttu-id="ae7ca-146">12</span><span class="sxs-lookup"><span data-stu-id="ae7ca-146">12</span></span> |<span data-ttu-id="ae7ca-147">12</span><span class="sxs-lookup"><span data-stu-id="ae7ca-147">12</span></span> |<span data-ttu-id="ae7ca-148">1</span><span class="sxs-lookup"><span data-stu-id="ae7ca-148">1</span></span> |
| <span data-ttu-id="ae7ca-149">Максимальное число единиц поиска ((число реплик) * (число секций)) на службу</span><span class="sxs-lookup"><span data-stu-id="ae7ca-149">Maximum Search Units (Replicas*Partitions) per Service</span></span> |<span data-ttu-id="ae7ca-150">3</span><span class="sxs-lookup"><span data-stu-id="ae7ca-150">3</span></span> |<span data-ttu-id="ae7ca-151">36</span><span class="sxs-lookup"><span data-stu-id="ae7ca-151">36</span></span> |<span data-ttu-id="ae7ca-152">36</span><span class="sxs-lookup"><span data-stu-id="ae7ca-152">36</span></span> |<span data-ttu-id="ae7ca-153">36</span><span class="sxs-lookup"><span data-stu-id="ae7ca-153">36</span></span> |<span data-ttu-id="ae7ca-154">36 (максимум 3 секции)</span><span class="sxs-lookup"><span data-stu-id="ae7ca-154">36 (max 3 partitions)</span></span> |
| <span data-ttu-id="ae7ca-155">Максимальное число документов на службу</span><span class="sxs-lookup"><span data-stu-id="ae7ca-155">Maximum Documents per Service</span></span> |<span data-ttu-id="ae7ca-156">1 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-156">1 million</span></span> |<span data-ttu-id="ae7ca-157">180 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-157">180 million</span></span> |<span data-ttu-id="ae7ca-158">720 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-158">720 million</span></span> |<span data-ttu-id="ae7ca-159">1,4 млрд</span><span class="sxs-lookup"><span data-stu-id="ae7ca-159">1.4 billion</span></span> |<span data-ttu-id="ae7ca-160">600 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-160">600 million</span></span> |
| <span data-ttu-id="ae7ca-161">Максимальный объем хранилища на службу</span><span class="sxs-lookup"><span data-stu-id="ae7ca-161">Maximum Storage per Service</span></span> |<span data-ttu-id="ae7ca-162">2 ГБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-162">2 GB</span></span> |<span data-ttu-id="ae7ca-163">300 ГБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-163">300 GB</span></span> |<span data-ttu-id="ae7ca-164">1,2 ТБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-164">1.2 TB</span></span> |<span data-ttu-id="ae7ca-165">2,4 ТБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-165">2.4 TB</span></span> |<span data-ttu-id="ae7ca-166">600 ГБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-166">600 GB</span></span> |
| <span data-ttu-id="ae7ca-167">Максимальное число документов на секцию</span><span class="sxs-lookup"><span data-stu-id="ae7ca-167">Maximum Documents per Partition</span></span> |<span data-ttu-id="ae7ca-168">1 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-168">1 million</span></span> |<span data-ttu-id="ae7ca-169">15 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-169">15 million</span></span> |<span data-ttu-id="ae7ca-170">60 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-170">60 million</span></span> |<span data-ttu-id="ae7ca-171">120 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-171">120 million</span></span> |<span data-ttu-id="ae7ca-172">200 млн</span><span class="sxs-lookup"><span data-stu-id="ae7ca-172">200 million</span></span> |
| <span data-ttu-id="ae7ca-173">Максимальный объем хранилища на секцию</span><span class="sxs-lookup"><span data-stu-id="ae7ca-173">Maximum Storage per Partition</span></span> |<span data-ttu-id="ae7ca-174">2 ГБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-174">2 GB</span></span> |<span data-ttu-id="ae7ca-175">25 ГБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-175">25 GB</span></span> |<span data-ttu-id="ae7ca-176">100 ГБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-176">100 GB</span></span> |<span data-ttu-id="ae7ca-177">200 ГБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-177">200 GB</span></span> |<span data-ttu-id="ae7ca-178">200 ГБ</span><span class="sxs-lookup"><span data-stu-id="ae7ca-178">200 GB</span></span> |
| <span data-ttu-id="ae7ca-179">Максимальное число индексов на службу</span><span class="sxs-lookup"><span data-stu-id="ae7ca-179">Maximum Indexes per Service</span></span> |<span data-ttu-id="ae7ca-180">5</span><span class="sxs-lookup"><span data-stu-id="ae7ca-180">5</span></span> |<span data-ttu-id="ae7ca-181">50</span><span class="sxs-lookup"><span data-stu-id="ae7ca-181">50</span></span> |<span data-ttu-id="ae7ca-182">200</span><span class="sxs-lookup"><span data-stu-id="ae7ca-182">200</span></span> |<span data-ttu-id="ae7ca-183">200</span><span class="sxs-lookup"><span data-stu-id="ae7ca-183">200</span></span> |<span data-ttu-id="ae7ca-184">3000 (максимум 1000 индексов на секцию)</span><span class="sxs-lookup"><span data-stu-id="ae7ca-184">3000 (max 1000 indexes/partition)</span></span> |

#### <a name="s3-high-density"></a><span data-ttu-id="ae7ca-185">S3, высокая плотность</span><span class="sxs-lookup"><span data-stu-id="ae7ca-185">S3 High Density'</span></span>
<span data-ttu-id="ae7ca-186">В ценовой категории S3 Поиска Azure существует вариант с режимом высокой плотности (HD), специально предназначенный для мультитенантных сценариев.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-186">In Azure Search’s S3 pricing tier, there is an option for the High Density (HD) mode designed specifically for multitenant scenarios.</span></span> <span data-ttu-id="ae7ca-187">Во многих случаях, чтобы использовать преимущества упрощения и экономичности, требуется поддерживать большое количество небольших клиентов в отдельной службе.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-187">In many cases, it is necessary to support a large number of smaller tenants under a single service to achieve the benefits of simplicity and cost efficiency.</span></span>

<span data-ttu-id="ae7ca-188">Уровень S3 HD позволяет собрать множество небольших индексов под управлением отдельной службы поиска, жертвуя возможностью разворачивать индексы посредством секций ради возможности разместить большее число индексов в отдельной службе.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-188">S3 HD allows for the many small indexes to be packed under the management of a single search service by trading the ability to scale out indexes using partitions for the ability to host more indexes in a single service.</span></span>

<span data-ttu-id="ae7ca-189">Точнее, служба S3 может содержать от 1 до 200 индексов, что позволяет одновременно размещать до 1,4 млрд документов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-189">Concretely, an S3 service could have between 1 and 200 indexes that together could host up to 1.4 billion documents.</span></span> <span data-ttu-id="ae7ca-190">С другой стороны, уровень S3 HD позволит отдельным индексам содержать только до 1 млн документов, но даст возможность обрабатывать до 1000 индексов на секцию (до 3000 на службу). Тогда общее число документов составит 200 млн на секцию (до 600 миллионов на службу).</span><span class="sxs-lookup"><span data-stu-id="ae7ca-190">An S3 HD on the other hand would allow individual indexes to only go up to 1 million documents, but it can handle up to 1000 indexes per partition (up to 3000 per service) with a total document count of 200 million per partition (up to 600 million per service).</span></span>

## <a name="considerations-for-multitenant-applications"></a><span data-ttu-id="ae7ca-191">Рекомендации для мультитенантных приложений</span><span class="sxs-lookup"><span data-stu-id="ae7ca-191">Considerations for multitenant applications</span></span>
<span data-ttu-id="ae7ca-192">Мультитенантные приложения должны эффективно распределять ресурсы между клиентами, сохраняя при этом определенный уровень конфиденциальности между различными клиентами.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-192">Multitenant applications must effectively distribute resources among the tenants while preserving some level of privacy between the various tenants.</span></span> <span data-ttu-id="ae7ca-193">Существует несколько рекомендаций по проектированию архитектуры подобного приложения.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-193">There are a few considerations when designing the architecture for such an application:</span></span>

* <span data-ttu-id="ae7ca-194">*Изоляция клиентов*. Разработчики приложений должны принять соответствующие меры, чтобы клиенты не имели возможности получить неавторизованный или нежелательный доступ к данным других клиентов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-194">*Tenant isolation:* Application developers need to take appropriate measures to ensure that no tenants have unauthorized or unwanted access to the data of other tenants.</span></span> <span data-ttu-id="ae7ca-195">Помимо реализации конфиденциальности данных, стратегии изоляции клиентов требуют эффективного управления общими ресурсами и защиты от "шумных соседей".</span><span class="sxs-lookup"><span data-stu-id="ae7ca-195">Beyond the perspective of data privacy, tenant isolation strategies require effective management of shared resources and protection from noisy neighbors.</span></span>
* <span data-ttu-id="ae7ca-196">*Стоимость облачных ресурсов.* Как и любое другое приложение, программные решения должны обладать конкурентоспособной ценой в составе мультитенантного приложения.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-196">*Cloud resource cost:* As with any other application, software solutions must remain cost competitive as a component of a multitenant application.</span></span>
* <span data-ttu-id="ae7ca-197">*Простота эксплуатации.* При разработке мультитенантной архитектуры важно учесть влияние на эксплуатацию и сложность приложения.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-197">*Ease of Operations:* When developing a multitenant architecture, the impact on the application's operations and complexity is an important consideration.</span></span> <span data-ttu-id="ae7ca-198">Поиск Azure реализует [соглашение об уровне обслуживания 99,9 %](https://azure.microsoft.com/support/legal/sla/search/v1_0/).</span><span class="sxs-lookup"><span data-stu-id="ae7ca-198">Azure Search has a [99.9% SLA](https://azure.microsoft.com/support/legal/sla/search/v1_0/).</span></span>
* <span data-ttu-id="ae7ca-199">*Размещение по всему миру*. Мультитенантным приложениям может потребоваться эффективно обслуживать клиенты по всему миру.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-199">*Global footprint:* Multitenant applications may need to effectively serve tenants which are distributed across the globe.</span></span>
* <span data-ttu-id="ae7ca-200">*Масштабируемость*. Разработчики приложений должны решить, как сохранить относительно низкий уровень сложности приложения и спроектировать приложение, которое можно масштабировать, чтобы обслуживать множество клиентов с учетом их размера данных и рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-200">*Scalability:* Application developers need to consider how they reconcile between maintaining a sufficiently low level of application complexity and designing the application to scale with number of tenants and the size of tenants' data and workload.</span></span>

<span data-ttu-id="ae7ca-201">Поиск Azure предлагает несколько границ, с помощью которых можно изолировать данные и рабочую нагрузку клиентов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-201">Azure Search offers a few boundaries that can be used to isolate tenants’ data and workload.</span></span>

## <a name="modeling-multitenancy-with-azure-search"></a><span data-ttu-id="ae7ca-202">Моделирование мультитенантности с использованием Поиска Azure</span><span class="sxs-lookup"><span data-stu-id="ae7ca-202">Modeling multitenancy with Azure Search</span></span>
<span data-ttu-id="ae7ca-203">В случае мультитенантого сценария разработчик приложений использует одну или несколько служб поиска и разделяет их клиентов между службами и индексами.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-203">In the case of a multitenant scenario, the application developer consumes one or more search services and divide their tenants among services, indexes, or both.</span></span> <span data-ttu-id="ae7ca-204">При моделировании мультитенантного сценария для Поиска Azure применяется несколько распространенных шаблонов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-204">Azure Search has a few common patterns when modeling a multitenant scenario:</span></span>

1. <span data-ttu-id="ae7ca-205">*Индекс на каждого клиента*. Каждый клиент имеет собственный индекс в службе поиска, используемой совместно с другими клиентами.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-205">*Index per tenant:* Each tenant has its own index within a search service that is shared with other tenants.</span></span>
2. <span data-ttu-id="ae7ca-206">*Служба на каждого клиента*. Каждый клиент имеет собственную выделенную службу Поиска Azure, что обеспечивает высочайший уровень разделения данных и рабочих нагрузок.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-206">*Service per tenant:* Each tenant has its own dedicated Azure Search service, offering highest level of data and workload separation.</span></span>
3. <span data-ttu-id="ae7ca-207">*Сочетание обоих вариантов*. Более активным клиентам большого размера назначаются выделенные службы, а небольшим клиентам назначаются отдельные индексы в общих службах.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-207">*Mix of both:* Larger, more-active tenants are assigned dedicated services while smaller tenants are assigned individual indexes within shared services.</span></span>

## <a name="1-index-per-tenant"></a><span data-ttu-id="ae7ca-208">1. Индекс на каждого клиента</span><span class="sxs-lookup"><span data-stu-id="ae7ca-208">1. Index per tenant</span></span>
![Изображение модели с индексом на каждого клиента](./media/search-modeling-multitenant-saas-applications/azure-search-index-per-tenant.png)

<span data-ttu-id="ae7ca-210">В модели с индексом на каждого клиента несколько клиентов занимают одну службу Поиска Azure, в которой у каждого клиента есть собственный индекс.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-210">In an index-per-tenant model, multiple tenants occupy a single Azure Search service where each tenant has their own index.</span></span>

<span data-ttu-id="ae7ca-211">Это обеспечивает изоляцию данных клиентов, так как все запросы на поиск и операции с документами выполняются на уровне индекса в Поиске Azure.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-211">Tenants achieve data isolation because all search requests and document operations are issued at an index level in Azure Search.</span></span> <span data-ttu-id="ae7ca-212">На прикладном уровне имеется понимание необходимости перенаправлять трафик различных клиентов к соответствующим индексам, управляя при этом ресурсами всех клиентов на уровне службы.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-212">In the application layer, there is the need awareness to direct the various tenants’ traffic to the proper indexes while also managing resources at the service level across all tenants.</span></span>

<span data-ttu-id="ae7ca-213">Ключевой атрибут модели с индексом на каждого клиента заключается в том, что разработчик приложений может неравномерно распределить емкость службы поиска между подписанными на нее клиентами приложения.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-213">A key attribute of the index-per-tenant model is the ability for the application developer to oversubscribe the capacity of a search service among the application’s tenants.</span></span> <span data-ttu-id="ae7ca-214">Если рабочая нагрузка неравномерно распределена между клиентами, то можно распределить оптимальное сочетание клиентов между индексами службы поиска, чтобы обслуживать ресурсоемкие высокоактивные клиенты, одновременно обслуживая длинную очередь менее активных клиентов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-214">If the tenants have an uneven distribution of workload, the optimal combination of tenants can be distributed across a search service’s indexes to accommodate a number of highly active, resource-intensive tenants while simultaneously serving a long tail of less active tenants.</span></span> <span data-ttu-id="ae7ca-215">Недостаток модели заключается в том, что она не подходит для ситуаций, в которых все клиенты одновременно являются высокоактивными.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-215">The trade-off is the inability of the model to handle situations where each tenant is concurrently highly active.</span></span>

<span data-ttu-id="ae7ca-216">Модель с индексом на каждого клиента служит основой для модели с переменными затратами, в которой вся служба Поиска Azure приобретается предварительно, а затем последовательно заполняется клиентами.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-216">The index-per-tenant model provides the basis for a variable cost model, where an entire Azure Search service is bought up-front and then subsequently filled with tenants.</span></span> <span data-ttu-id="ae7ca-217">Это позволяет выделить неиспользуемую емкость для пробных и бесплатных учетных записей.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-217">This allows for unused capacity to be designated for trials and free accounts.</span></span>

<span data-ttu-id="ae7ca-218">Для приложений, развертываемых по всему миру, модель с индексом на каждого клиента может быть не самой эффективной.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-218">For applications with a global footprint, the index-per-tenant model may not be the most efficient.</span></span> <span data-ttu-id="ae7ca-219">Если клиенты приложения распределены по всему миру, то может потребоваться отдельная служба в каждом регионе, что может привести к повторным затратам в каждом из них.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-219">If an application's tenants are distributed across the globe, a separate service may be necessary for each region which may duplicate costs across each of them.</span></span>

<span data-ttu-id="ae7ca-220">Поиск Azure позволяет масштабировать емкость за счет увеличения как отдельных индексов, так и общего числа индексов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-220">Azure Search allows for the scale of both the individual indexes and the total number of indexes to grow.</span></span> <span data-ttu-id="ae7ca-221">Если выбрана соответствующая ценовая категория, то во всю службу поиска можно будет добавить секции и реплики, когда какой-либо индекс в службе станет слишком большим с точки зрения потребляемых ресурсов хранения или трафика.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-221">If an appropriate pricing tier is chosen, partitions and replicas can be added to the entire search service when an individual index within the service grows too large in terms of storage or traffic.</span></span>

<span data-ttu-id="ae7ca-222">Если общее число индексов для одной службы становится слишком большим, то для обработки новых клиентов следует подготовить еще одну службу.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-222">If the total number of indexes grows too large for a single service, another service has to be provisioned to accommodate the new tenants.</span></span> <span data-ttu-id="ae7ca-223">Если требуется перемещать индексы между службами поиска по мере добавления новых служб, то данные из индекса нужно вручную копировать в другой индекс, так как Поиск Azure не разрешает перемещать индексы.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-223">If indexes have to be moved between search services as new services are added, the data from the index has to be manually copied from one index to the other as Azure Search does not allow for an index to be moved.</span></span>

## <a name="2-service-per-tenant"></a><span data-ttu-id="ae7ca-224">2) Служба на каждого клиента</span><span class="sxs-lookup"><span data-stu-id="ae7ca-224">2. Service per tenant</span></span>
![Изображение модели со службой на каждого клиента](./media/search-modeling-multitenant-saas-applications/azure-search-service-per-tenant.png)

<span data-ttu-id="ae7ca-226">В архитектуре со службой на каждого клиента каждый клиент имеет свою собственную службу поиска.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-226">In a service-per-tenant architecture, each tenant has its own search service.</span></span>

<span data-ttu-id="ae7ca-227">В этой модели приложение обеспечивает максимальный уровень изоляции своих клиентов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-227">In this model, the application achieves the maximum level of isolation for its tenants.</span></span> <span data-ttu-id="ae7ca-228">Каждая служба имеет выделенное хранилище и пропускную способность для обработки запросов на поиск, а также отдельные ключи API.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-228">Each service has dedicated storage and throughput for handling search request as well as separate API keys.</span></span>

<span data-ttu-id="ae7ca-229">Модель со службой на каждого клиента отлично подойдет для приложений, в которых каждому клиенту требуется много ресурсов или рабочие нагрузки клиентов мало отличаются между собой, так как ресурсы не являются общими для рабочих нагрузок разных клиентов.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-229">For applications where each tenant has a large footprint or the workload has little variability from tenant to tenant, the service-per-tenant model is an effective choice as resources are not shared across various tenants’ workloads.</span></span>

<span data-ttu-id="ae7ca-230">Данная модель также дает преимущества модели с прогнозируемыми, фиксированными затратами.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-230">A service per tenant model also offers the benefit of a predictable, fixed cost model.</span></span> <span data-ttu-id="ae7ca-231">Какие-либо первоначальные вложения во всю службу поиска отсутствуют, пока она не заполнится клиентами, однако затраты на каждого клиента выше, чем в модели с индексом на каждого клиента.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-231">There is no up-front investment in an entire search service until there is a tenant to fill it, however the cost-per-tenant is higher than an index-per-tenant model.</span></span>

<span data-ttu-id="ae7ca-232">Модель со службой на каждого клиента — удачный выбор для приложений, развертываемых по всему миру.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-232">The service-per-tenant model is an efficient choice for applications with a global footprint.</span></span> <span data-ttu-id="ae7ca-233">С помощью географически распределенных клиентов легко разместить службу для каждого клиента в соответствующем регионе.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-233">With geographically-distributed tenants, it is easy to have each tenant's service in the appropriate region.</span></span>

<span data-ttu-id="ae7ca-234">При такой схеме трудности масштабирования возникают, когда отдельным клиентам перестает хватать емкости их службы.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-234">The challenges in scaling this pattern arise when individual tenants outgrow their service.</span></span> <span data-ttu-id="ae7ca-235">Поиск Azure в настоящее время не поддерживает изменение ценовой категории для службы поиска, поэтому все данные придется вручную скопировать в новую службу.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-235">Azure Search does not currently support upgrading the pricing tier of a search service, so all data would have to be manually copied to a new service.</span></span>

## <a name="3-mixing-both-models"></a><span data-ttu-id="ae7ca-236">3. Совмещение обеих моделей</span><span class="sxs-lookup"><span data-stu-id="ae7ca-236">3. Mixing both models</span></span>
<span data-ttu-id="ae7ca-237">Еще один шаблон для моделирования мультитенантности подразумевает совмещение модели с индексом на каждый клиента и модели со службой на каждый клиент.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-237">Another pattern for modeling multitenancy is mixing both index-per-tenant and service-per-tenant strategies.</span></span>

<span data-ttu-id="ae7ca-238">При совмещении двух шаблонов наибольшие клиенты приложения могут занимать выделенные службы, а длинная очередь менее активных клиентов меньшего размера может занимать индексы в общей службе.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-238">By mixing the two patterns, an application's largest tenants can occupy dedicated services while the long tail of less active, smaller tenants can occupy indexes in a shared service.</span></span> <span data-ttu-id="ae7ca-239">Эта модель обеспечивает наибольшим клиентам постоянную высокую производительность обслуживания службой, помогая при этом защитить небольшие клиенты от "шумных соседей".</span><span class="sxs-lookup"><span data-stu-id="ae7ca-239">This model ensures that the largest tenants have consistently high performance from the service while helping to protect the smaller tenants from any noisy neighbors.</span></span>

<span data-ttu-id="ae7ca-240">Тем не менее, для реализации этой стратегии понадобится спрогнозировать, каким клиентам потребуется выделенная служба, а каким — индекс в общей службе.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-240">However, implementing this strategy relies foresight in predicting which tenants will require a dedicated service versus an index in a shared service.</span></span> <span data-ttu-id="ae7ca-241">Повышается сложность приложения, так как необходимо управлять обеими моделям мультитенантности.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-241">Application complexity increases with the need to manage both of these multitenancy models.</span></span>

## <a name="achieving-even-finer-granularity"></a><span data-ttu-id="ae7ca-242">Достижение большей степени детализации</span><span class="sxs-lookup"><span data-stu-id="ae7ca-242">Achieving even finer granularity</span></span>
<span data-ttu-id="ae7ca-243">Приведенные выше шаблоны проектирования для моделирования мультитенантных сценариев в Поиске Azure рассчитаны на универсальную область применения, в которой каждый клиент — это целый экземпляр приложения.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-243">The above design patterns to model multitenant scenarios in Azure Search assume a uniform scope where each tenant is a whole instance of an application.</span></span> <span data-ttu-id="ae7ca-244">Однако иногда приложения могут обрабатывать несколько областей меньшего размера.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-244">However, applications can sometimes handle many smaller scopes.</span></span>

<span data-ttu-id="ae7ca-245">Если область применения модели со службой на каждого клиента и модели с индексом на каждого клиента недостаточно мала, можно смоделировать индекс для повышения степени детализации.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-245">If service-per-tenant and index-per-tenant models are not sufficiently small scopes, it is possible to model an index to achieve an even finer degree of granularity.</span></span>

<span data-ttu-id="ae7ca-246">Чтобы один индекс функционировал по-разному для разных клиентских конечных точек, в него можно добавить поля, которые задают определенное значение для каждого возможного клиента.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-246">To have a single index behave differently for different client endpoints, a field can be added to an index which designates a certain value for each possible client.</span></span> <span data-ttu-id="ae7ca-247">Каждый раз, когда клиент вызывает Поиск Azure для запроса или изменения индекса, код из клиентского приложения определяет соответствующее значение этого поля с использованием [фильтра](https://msdn.microsoft.com/library/azure/dn798921.aspx) Поиска Azure. Это осуществляется во время выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-247">Each time a client calls Azure Search to query or modify an index, the code from the client application specifies the appropriate value for that field using Azure Search's [filter](https://msdn.microsoft.com/library/azure/dn798921.aspx) capability at query time.</span></span>

<span data-ttu-id="ae7ca-248">Данный метод может использоваться для реализации отдельных учетных записей пользователей, отдельных уровней разрешений и даже полностью отдельных приложений.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-248">This method can be used to achieve functionality of separate user accounts, separate permission levels, and even completely separate applications.</span></span>

> [!NOTE]
> <span data-ttu-id="ae7ca-249">Использование описанного выше подхода для настройки одного индекса, обслуживающего несколько клиентов, влияет на релевантность результатов поиска.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-249">Using the approach described above to configure a single index to serve multiple tenants affects the relevance of search results.</span></span> <span data-ttu-id="ae7ca-250">Показатели релевантности поиска вычисляются на уровне индекса, а не на уровне клиента, поэтому все данные клиентов включаются в базовую статистику показателей релевантности (например, частота встречаемости термина).</span><span class="sxs-lookup"><span data-stu-id="ae7ca-250">Search relevance scores are computed at an index-level scope, not a tenant-level scope, so all tenants' data is incorporated in the relevance scores' underlying statistics such as term frequency.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="ae7ca-251">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ae7ca-251">Next steps</span></span>
<span data-ttu-id="ae7ca-252">Поиск Azure — привлекательное решение для многих приложений. Вы можете прочитать [больше о надежных возможностях этой службы](http://aka.ms/whatisazsearch).</span><span class="sxs-lookup"><span data-stu-id="ae7ca-252">Azure Search is a compelling choice for many applications, [read more about the service's robust capabilities](http://aka.ms/whatisazsearch).</span></span> <span data-ttu-id="ae7ca-253">При оценке различных шаблонов разработки для мультитенантных приложений рассмотрите [различные ценовые категории](https://azure.microsoft.com/pricing/details/search/) и соответствующие [ограничения служб](search-limits-quotas-capacity.md), чтоб подобрать наилучшее решение Поиска Azure для рабочих нагрузок приложений и архитектур любого размера.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-253">When evaluating the various design patterns for multitenant applications, consider the [various pricing tiers](https://azure.microsoft.com/pricing/details/search/) and the respective [service limits](search-limits-quotas-capacity.md) to best tailor Azure Search to fit application workloads and architectures of all sizes.</span></span>

<span data-ttu-id="ae7ca-254">Любые вопросы о службе поиска Azure и мультитенантных сценариях можно отправить на электронный адрес azuresearch_contact@microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="ae7ca-254">Any questions about Azure Search and multitenant scenarios can be directed to azuresearch_contact@microsoft.com.</span></span>

