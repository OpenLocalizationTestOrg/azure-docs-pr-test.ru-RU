---
title: "Планирование загрузки для Поиска Azure | Документация Майкрософт"
description: "Настройка вычислительных ресурсов секций и реплик в Поиске Azure, в которых каждый ресурс оценивается в оплачиваемых единицах поиска."
services: search
documentationcenter: 
author: HeidiSteen
manager: jhubbard
editor: 
tags: azure-portal
ms.assetid: 1dc16afe-56f9-439d-8874-1733ae1a2b74
ms.service: search
ms.devlang: NA
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 02/08/2017
ms.author: heidist
ms.openlocfilehash: 26f5e71f3d00161a92de702209e224008ec8a5ae
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="scale-resource-levels-for-query-and-indexing-workloads-in-azure-search"></a>Масштабирование уровней ресурсов для рабочих нагрузок запросов и индексирования в Поиске Azure
После [выбора ценовой категории](search-sku-tier.md) и [подготовки службы поиска](search-create-service-portal.md) следующим шагом является необязательное увеличение количества реплик или секций, используемых службой. Каждый уровень предоставляет фиксированное число единиц выставления счетов. В этой статье объясняется, как выделять эти единицы для достижения оптимальной конфигурации, позволяющей сбалансировать ваши требования к для выполнению запросов, индексированию и хранению данных.

Конфигурация ресурсов доступна при настройке службы на уровне [Базовый](http://aka.ms/azuresearchbasic) или на одном из уровней [Стандартный](search-limits-quotas-capacity.md). Для всех платных служб на этих уровнях емкость приобретается в *единицах поиска*, где каждая секция и реплика принимается за одну единицу поиска. 

Чем меньше используется единиц поиска, тем меньше выставляется счет. Оплата осуществляется на протяжении всего периода настройки службы. Чтобы не платить за службу, которую вы временно не используете, вам нужно удалить ее, а затем при необходимости создать снова.

> [!Note]
> Удаление службы приводит к удалению всех связанных с ней компонентов. В службе поиска Azure отсутствуют возможности резервного копирования и восстановления сохраненных данных для поиска. Чтобы повторно развернуть существующий индекс в новой службе, необходимо запустить программу, которая изначально использовалась для его создания и загрузки. 

## <a name="terminology-partitions-and-replicas"></a>Терминология: секции и реплики
Разделы и реплики — это основные ресурсы, на которых работает служба поиска.

| Ресурс | Определение |
|----------|------------|
|*Секции* | Служат для хранения индексов и ввода-вывода данных для операций чтения и записи (например, при повторном создании или обновлении индексов).|
|*Реплики* | Экземпляры службы поиска, используемые главным образом для распределения операций запросов. На каждой реплике всегда размещается одна копия индекса. Если у вас есть 12 реплик, в службу будет загружено 12 копий каждого индекса.|

> [!NOTE]
> Невозможно напрямую выбрать или определить, какие индексы будут запущены в реплике. Одна копия каждого индекса в каждой реплике является частью архитектуры службы.
>

## <a name="how-to-allocate-partitions-and-replicas"></a>Как выделять секции и реплики
В Поиске Azure для службы поиска изначально выделяется минимальный уровень ресурсов, состоящий из одного раздела и одной реплики. Для уровней, которые поддерживают службу, вы можете постепенно корректировать вычислительные ресурсы, увеличивая количество секций, если вам нужно больше места для хранения и операций ввода-вывода, или добавляя реплики, чтобы увеличить объем запросов или повысить производительность. Одна служба должна иметь достаточно ресурсов для обработки всех рабочих нагрузок (индексирования и запросов). Нельзя разделить рабочие нагрузки между несколькими службами.

Для увеличения или изменения количества выделенных реплик или секций мы рекомендуем использовать портал Azure. Он принудительно применяет ограничения для допустимых сочетаний, которые не превышают верхний предел.

1. Войдите на [портал Azure](https://portal.azure.com/) и выберите службу поиска.
2. В разделе **Параметры** откройте колонку **Масштаб** и с помощью ползунков укажите количество секций и реплик.

Кроме того, если требуется подготовка на основе скрипта или кода, вместо портала можно использовать [REST API управления](https://msdn.microsoft.com/library/azure/dn832687.aspx).

Как правило, приложениям поиска требуется больше реплик, чем секций, особенно если операции службы смещаются в сторону рабочей нагрузки запросов. В разделе, посвященном [высокой доступности](#HA) , объясняется, почему так происходит.

> [!NOTE]
> После подготовки службы ее невозможно обновить до более высокого SKU. Вам нужно будет создать службу поиска на новом уровне и перезагрузить индексы. Инструкции по подготовке службы см. в статье [Создание службы Поиска Azure с помощью портала Azure](search-create-service-portal.md).
>
>

<a id="HA"></a>

## <a name="high-availability"></a>высокую доступность;
Поскольку задача масштабирования решается достаточно легко и быстро, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов. Для многих служб уровня "Базовый" или S1 будет достаточно места для хранения одной секции и операций ввода-вывода (15 миллионов документов на раздел).

Рабочие нагрузки запросов в основном выполняются с репликами. Для повышения пропускной способности или обеспечения высокого уровня доступности вам, скорее всего, потребуется больше реплик.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

* Две реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
* Три или более реплик для обеспечения высокого уровня доступности рабочих нагрузок чтения и записи (запросов и индексирования по мере добавления, обновления или удаления отдельных документов).

Соглашения об уровне обслуживания для Поиска Azure используются для операций запросов и обновления индекса, которые состоят из добавления, обновления или удаления документов.

### <a name="index-availability-during-a-rebuild"></a>Доступность индексов во время повторного создания

Высокий уровень доступности для Поиска Azure относится к запросам и обновлению индексов, не требующих повторного создания индексов. Если вы удалите, переименуете поле или измените тип данных, индекс потребуется перестроить. Для этого его необходимо удалить, затем создать заново и повторно загрузить данные.

> [!NOTE]
> Можно добавить новые поля в индекс Поиска Azure, не перестраивая его. Значение нового поля будет равно NULL для всех документов, уже добавленных в индекс.

Чтобы обеспечить доступность индекса во время повторного создания, необходимо иметь копию индекса с другим именем в той же службе или копию индекса с таким же именем в другой службе, а затем обеспечить перенаправление или логику отработки отказа в коде.

## <a name="disaster-recovery"></a>Аварийное восстановление
В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Наиболее распространенным подходом является добавление избыточности на уровне службы за счет настройки второй службы поиска в другом регионе. Как и в случае с доступностью при повторном создании индекса, перенаправление и логику отработки отказа должен обеспечивать ваш код.

## <a name="increase-query-performance-with-replicas"></a>Увеличение производительности запросов с помощью реплик
Признаком необходимости добавления дополнительных реплик является задержка обработки запросов. Как правило, первым шагом к повышению производительности запросов является добавление этого ресурса. При добавлении новых реплик вы подключаете дополнительные копии индексов. В результате увеличивается допустимая рабочая нагрузка и обеспечивается распределение запросов между большим количеством реплик.

Мы не можем указать точное количество запросов в секунду (QPS), так как выполнение запроса во многом зависит от его сложности и конкурирующих рабочих нагрузок. В среднем реплика на SKU уровня "Базовый" или S1 обслуживает около 15 запросов в секунду, но фактическая пропускная способность будет немного выше или ниже в зависимости от сложности запросов (фасетные запросы являются более сложными) и задержки сети. Кроме того, необходимо учитывать, что зависимость роста мощности и производительности от количества реплик не обязательно является линейной. Например, добавление трех реплик не гарантирует трехкратный рост пропускной способности.

Дополнительные сведения о количестве запросов в секунду (QPS), включая способы оценки QPS для рабочих нагрузок, см. в статье [Управление службой поиска в Microsoft Azure](search-manage.md).

## <a name="increase-indexing-performance-with-partitions"></a>Увеличение производительности индексирования с помощью секций
Приложениям поиска, которым требуется обновления данных в режиме, близком к реальному времени, понадобится пропорционально больше секций, чем реплик. При добавлении секций операции чтения-записи распределяются среди большего количества вычислительных ресурсов. Оно также обеспечивает больше дискового пространства для хранения дополнительных индексов и документов.

Запрос больших индексов выполняется дольше. Поэтому может оказаться, что каждое добавочное увеличение числа секций потребует меньшего, но пропорционального увеличения числа реплик. Сложность запросов и их объем обусловливают скорость выполнения запросов.

## <a name="basic-tier-partition-and-replica-combinations"></a>Уровень "Базовый": сочетания разделов и реплик
На уровне "Базовый" служба может иметь только одну секцию и до трех реплик. Таким образом, максимальное количество единиц поиска составляет три. Единственным ресурсом, который можно изменять, являются реплики. Требуется не менее двух реплик, чтобы обеспечить высокий уровень доступности при обработке запросов.

<a id="chart"></a>

## <a name="standard-tiers-partition-and-replica-combinations"></a>Уровень "Стандартный": сочетания разделов и реплик
В этой таблице показаны единицы поиска для всех стандартных уровней, необходимые для поддержки сочетаний реплик и секций, с ограничением в 36 единиц поиска.

|   | **1 секция** | **2 секции** | **3 секции** | **4 секции** | **6 секций** | **12 секций** |
| --- | --- | --- | --- | --- | --- | --- |
| **1 реплика** |1 ЕП |2 ЕП |3 ЕП |4 ЕП |6 ЕП |12 ЕП |
| **2 реплики** |2 ЕП |4 ЕП |6 ЕП |8 ЕП |12 ЕП |24 ЕП |
| **3 реплики** |3 ЕП |6 ЕП |9 ЕП |12 ЕП |18 ЕП |36 ЕП |
| **4 реплики** |4 ЕП |8 ЕП |12 ЕП |16 ЕП |24 ЕП |Недоступно |
| **5 реплик** |5 ЕП |10 ЕП |15 ЕП |20 ЕП |30 ЕП |Недоступно |
| **6 реплик** |6 ЕП |12 ЕП |18 ЕП |24 ЕП |36 ЕП |Недоступно |
| **12 реплик** |12 ЕП |24 ЕП |36 ЕП |Недоступно |Недоступно |Недоступно |

Подробные сведения о единицах поиска, ценах и объемах приведены на веб-сайте Azure. Дополнительные сведения см. на [странице с ценами](https://azure.microsoft.com/pricing/details/search/).

> [!NOTE]
> Количество реплик и секций должно быть делителем 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что Поиск Azure предварительно делит каждый индекс на 12 сегментов, которые можно распределить равными частями по разделам. Например, если в вашей службе есть три секции и вы создаете индекс, то каждая секция будет содержать по четыре сегмента индекса. Способ, используемый службой поиска Azure для сегментации индекса, является задачей оптимизации и может быть изменен в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.
>
>

## <a name="billing-formula-for-replica-and-partition-resources"></a>Формула выставления счетов за ресурсы реплик и секций
Формула для расчета единиц поиска, используемых в определенных сочетаниях, основана на произведении количества реплик и секций, т. е. (R X P = SU). Например, три реплики, умноженные на три секции, оплачиваются как девять единиц поиска.

Стоимость единицы поиска определяется уровнем. Например, единица для уровня "Базовый" стоит меньше, чем для уровня "Стандартный". Расценки для каждого уровня см. в разделе [Сведения о ценах](https://azure.microsoft.com/pricing/details/search/).
