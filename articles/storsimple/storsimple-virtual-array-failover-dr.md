---
title: "Аварийное восстановление и отработка отказа устройств для виртуального массива StorSimple | Документация Майкрософт"
description: "Дополнительные сведения об отработке отказа виртуального массива StorSimple."
services: storsimple
documentationcenter: NA
author: alkohli
manager: timlt
editor: 
ms.assetid: 3c1f9c62-af57-4634-a0d8-435522d969aa
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 02/27/2017
ms.author: alkohli
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 12079f8dbc409afe5acc274fa08bda878c90b76e
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="disaster-recovery-and-device-failover-for-your-storsimple-virtual-array-via-azure-portal"></a>Аварийное восстановление и отработка отказа устройства для виртуального массива StorSimple на портале Azure

## <a name="overview"></a>Обзор
В этой статье описывается аварийное восстановление виртуального массива Microsoft Azure StorSimple, в том числе пошаговая отработка отказа с переходом на другой виртуальный массив. Отработка отказа позволяет переносить данные с *исходного* устройства в центре обработки данных на *целевое* устройство. Целевое устройство может находиться в том же или другом географическом регионе. Отработка отказа выполняется для всего устройства. При отработке отказа изменяется владелец облачных данных. После переноса они будут принадлежать владельцу целевого устройства.

Эта статья относится только к виртуальным массивам StorSimple. Чтобы выполнить отработку отказа для устройства серии 8000, см. статью [Отработка отказа и аварийное восстановление для устройства StorSimple](storsimple-device-failover-disaster-recovery.md).

## <a name="what-is-disaster-recovery-and-device-failover"></a>Что такое аварийное восстановление и отработка отказа устройства?

В сценарии аварийного восстановления основное устройство прекращает функционировать. В этом случае вы можете переместить облачные данные, связанные с неисправным устройством, на другое устройство. Можно указать основное устройство в качестве *исходного* и выбрать другое *целевое* устройство. Этот процесс называется *отработка отказа*. Во время отработки отказа меняется владелец томов или общих папок с исходного устройства, а сами они перемещаются на целевое устройство. Фильтрация данных запрещена.

Аварийное восстановление моделируется как полное восстановление устройства с распределением по уровням и отслеживанием на основе тепловой карты. Тепловая карта определяется путем присвоения данным значения уровня активности на основе шаблонов чтения и записи. Затем эта тепловая карта распределяет блоки данных нижнего уровня активности в облаке, сохраняя блоки данных высокого уровня активности (самые используемые) на локальном уровне. Во время аварийного восстановления StorSimple использует тепловую карту для восстановления данных из облака. Устройство извлекает все тома или общие папки из последней резервной копии (согласно внутреннему определению) и использует ее для восстановления. Виртуальный массив координирует весь процесс аварийного восстановления.

> [!IMPORTANT]
> После отработки отказа исходное устройство удаляется, поэтому восстановление размещения не поддерживается.
> 
> 

Аварийное восстановление координируется с помощью функции отработки отказа устройства и инициируется в колонке **Устройства**. В этой колонке представлены все устройства StorSimple, подключенные к службе диспетчера устройств StorSimple. Для каждого устройства отображается понятное имя, состояние устройства, выделенная и максимальная емкость, тип и модель.

## <a name="prerequisites-for-device-failover"></a>Предварительные требования для отработки отказа устройства

### <a name="prerequisites"></a>Предварительные требования

При любой отработке отказа устройства должны выполняться следующие предварительные требования.

* Исходное устройство должно находиться в состоянии **Отключено** .
* На портале Azure для целевого устройства должно отображаться состояние **Готово к настройке**. Подготовьте целевой виртуальный массив такой же или большей емкости. Используйте локальный веб-интерфейс для настройки и регистрации виртуального массива.
  
  > [!IMPORTANT]
  > Не пытайтесь настроить зарегистрированное виртуальное устройство в этой службе. Не следует выполнять конфигурацию устройства в службе.
  > 
  > 
* Целевое и исходное устройства должны иметь разные имена.
* Исходное и целевое устройство должны быть одного типа. Отработку отказа виртуального массива, настроенного в качестве файлового сервера, можно выполнить только на другой файловый сервер. То же самое касается и сервера iSCSI.
* Для аварийного восстановления файлового сервера мы рекомендуем присоединить целевое устройство к домену, в котором находится исходное устройство. Такая конфигурация гарантирует, что будут автоматически применены разрешения на общие ресурсы. Поддерживается отработка отказа с переходом только на целевое устройство в том же домене.
* Целевыми устройствами, доступными для аварийного восстановления, считаются устройства с такой же емкостью как у исходного устройства или более высокой. Подключенные к службе устройства, на которых недостаточно пространства, не будут доступны в качестве целевых устройств.

### <a name="other-considerations"></a>Дополнительные рекомендации

* Для плановой отработки отказа 
  
  * Рекомендуется перевести все тома или общие папки на исходном устройстве в автономный режим.
  * Перед отработкой отказа рекомендуем выполнить резервное копирование устройства, чтобы свести потерю данных к минимуму. 
* При выполнении внеплановой отработки отказа для восстановления данных устройства будет использована самая свежая резервная копия.

### <a name="device-failover-prechecks"></a>Проверки перед отработкой отказа устройства

До начала аварийного восстановления устройство выполняет предварительные проверки. Это позволяет избежать некоторых ошибок, которые могут возникнуть в процессе аварийного восстановления. Выполняются следующие предварительные проверки:

* проверка учетной записи хранения;
* проверка подключения к облаку Azure;
* проверка доступного места на целевом устройстве;
* проверка в томе устройства исходного сервера iSCSI:
  
  * допустимых имен ACR;
  * допустимых значений IQN (не более 220 символов);
  * правильных паролей CHAP (12–16 символов).

Если любая из этих проверок завершится сбоем, вы не сможете продолжить аварийное восстановление. Устраните обнаруженные проблемы и повторно запустите аварийное восстановление.

После успешного завершения аварийного восстановления права владения облачными данными на исходном устройстве переходят к целевому устройству. С этого момента исходное устройство становится недоступным на портале. Доступ ко всем томам и общим папкам на исходном устройстве блокируется, а целевое устройство становится активным.

> [!IMPORTANT]
> Хотя устройство больше недоступно, виртуальная машина, подготовленная в главной системе, по-прежнему потребляет ресурсы. После успешного завершения аварийного восстановления ее можно удалить из главной системы.
> 
> 

## <a name="fail-over-to-a-virtual-array"></a>Отработка отказа на виртуальный массив

Прежде чем выполнять эту процедуру, рекомендуем подготовить, настроить и зарегистрировать в службе диспетчера StorSimple еще один виртуальный массив StorSimple.

> [!IMPORTANT]
> 
> * Нельзя выполнять отработку отказа устройства StorSimple серии 8000 на виртуальное устройство серии 1200.
> * Можно выполнить отработку отказа из виртуального устройства с поддержкой FIPS (федеральный стандарт обработки информации) на другое устройство без поддержки FIPS, развернутое на портале для государственных организаций.


Вот как можно восстановить устройство на целевом виртуальном устройстве StorSimple.

1. Подготовьте и настройте целевое устройство, которое удовлетворяет [предварительным требованиям для отработки отказа устройства](#prerequisites). Завершите настройку устройства через локальный веб-интерфейс и зарегистрируйте устройство в службе диспетчера устройств StorSimple. Если создается файловый сервер, перейдите к шагу 1 [настройки в качестве файлового сервера](storsimple-virtual-array-deploy3-fs-setup.md#step-1-complete-the-local-web-ui-setup-and-register-your-device). Если создается сервер iSCSI, перейдите к шагу 1 [настройки в качестве сервера iSCSI](storsimple-virtual-array-deploy3-iscsi-setup.md#step-1-complete-the-local-web-ui-setup-and-register-your-device).

2. Переведите тома и общие папки на узле в автономный режим. Используйте инструкции для конкретной операционной системы, установленной на узле. Если тома и общие папки на устройстве еще не переведены в автономный режим, сделайте это следующим образом.
   
    1. Перейдите в колонку **Устройства** и выберите нужное устройство.
   
    2. Последовательно выберите элементы **Параметры > Управление > Общие файловые ресурсы** (или **Параметры > Управление > Тома**). 
   
    3. Выберите общую папку или том, щелкните правой кнопкой мыши и выберите пункт **Отключить**. 
   
    4. Когда появится запрос на подтверждение, установите флажок **Я понимаю последствия отключения этого общего файлового ресурса**. 
   
    5. Щелкните **Отключить**.

3. В службе диспетчера устройств StorSimple выберите **Управление > Устройства**. В колонке **Устройства** выберите и щелкните исходное устройство.

4. В колонке **Device dashboard** (Панель мониторинга устройства) щелкните **Отключить**.

5. В колонке **Отключение** вы увидите запрос подтверждения. Деактивация (отключение) устройства является *необратимой* операцией. Также отобразится напоминание о том, что нужно перевести общие папки или тома на узле в автономный режим. Введите для подтверждения имя устройства и щелкните **Отключить**.
   
    ![](./media/storsimple-virtual-array-failover-dr/failover1.png)
6. Начнется процесс деактивации. После успешного завершения отобразится соответствующее уведомление.
   
    ![](./media/storsimple-virtual-array-failover-dr/failover2.png)
7. На странице "Устройства" состояние устройства изменится на **Отключено**.
    ![](./media/storsimple-virtual-array-failover-dr/failover3.png)
8. В колонке **Устройства** выберите отключенное исходное устройство для отработки отказа. 
9. В колонке **Панель мониторинга устройства** щелкните **Отработка отказа**. 
10. В колонке **Устройство для отработки отказа** выполните следующие действия:
    
    1. Поле "Исходное устройство" заполняется автоматически. Обратите внимание на общий объем данных на исходном устройстве. Он должен быть меньше, чем доступная емкость на целевом устройстве. Просмотрите сведения, связанные с исходным устройством, такие как имя устройства, общая емкость и имена общих папок, для которых будет выполнена отработка отказа.

    2. Выберите **целевое устройство** в раскрывающемся списке доступных устройств. В этом списке отображаются только устройства с достаточной емкостью.

    3. Установите флажок **Я понимаю, что эта операция приведет к отработке отказа с переносом данных на целевое устройство**. 

    4. Нажмите кнопку **Отработка отказа**.
    
        ![](./media/storsimple-virtual-array-failover-dr/failover4.png)
11. Будет запущено задание отработки отказа, и вы получите соответствующее уведомление. Последовательно выберите элементы **Устройства > Задания**, чтобы отслеживать процесс отработки отказа.
    
     ![](./media/storsimple-virtual-array-failover-dr/failover5.png)
12. В колонке **Задания** будет создано задание отработки отказа для исходного устройства. Это задание выполняет предварительные проверки при аварийном восстановлении.
    
    ![](./media/storsimple-virtual-array-failover-dr/failover6.png)
    
     После успешного выполнения предварительных проверок при аварийном восстановлении задание отработки отказа запустит задания восстановления для каждой общей папки или каждого тома на исходном устройстве.
    
    ![](./media/storsimple-virtual-array-failover-dr/failover7.png)
13. После завершения отработки отказа перейдите в колонку **Устройства**.
    
    1. Щелкните устройство StorSimple, которое было выбрано в качестве целевого устройства для отработки отказа.
    2. Последовательно выберите элементы **Параметры > Управление > Общие файловые ресурсы** (или **Тома**, если это сервер iSCSI). В колонке **Общие файловые ресурсы** вы увидите все общие папки (или тома) со старого устройства.
        ![](./media/storsimple-virtual-array-failover-dr/failover9.png)
14. Вам потребуется [создать DNS-псевдоним](https://support.microsoft.com/kb/168322), чтобы все приложения при попытке подключения перенаправлялись на новое устройство.

## <a name="errors-during-dr"></a>Ошибки во время аварийного восстановления

**Сбой подключения к облаку во время аварийного восстановления**

Если в период от запуска до завершения аварийного восстановления устройства будет прервано подключение к облаку, произойдет сбой. Вы получите уведомление об ошибке. Устройство, которое использовалось как целевое для аварийного восстановления, будет помечено как *непригодное для использования*. Его нельзя будет использовать для аварийного восстановления в дальнейшем.

**Нет совместимых целевых устройств**

Если на доступных целевых устройствах недостаточно места, появится сообщение об ошибке, указывающее на отсутствие совместимых целевых устройств.

**Сбои предварительных проверок**

Если одна из предварительных проверок не будет успешно пройдена, появится сообщение об ошибке предварительной проверки.

## <a name="business-continuity-disaster-recovery-bcdr"></a>Аварийное восстановление непрерывности бизнеса (BCDR)

Сценарий аварийного восстановления непрерывности бизнеса (BCDR) реализуется, когда весь центр обработки данных Azure прекращает работу. Это может повлиять на службу диспетчера устройств StorSimple и связанные устройства StorSimple.

Если есть устройства StorSimple, зарегистрированные непосредственно перед сбоем, возможно, их потребуется удалить. После аварии можно повторно создать и настроить эти устройства.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как осуществлять [администрирование виртуального массива StorSimple, используя локальный пользовательский веб-интерфейс](storsimple-ova-web-ui-admin.md).

