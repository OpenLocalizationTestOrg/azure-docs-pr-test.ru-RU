---
title: "Развертывание службы диспетчера устройств StorSimple в Azure | Документация Майкрософт"
description: "Сведения о создании и удалении службы диспетчера устройств StorSimple на портале Azure, а также об управлении ключом регистрации службы."
services: storsimple
documentationcenter: 
author: alkohli
manager: timlt
editor: 
ms.assetid: 
ms.service: storsimple
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 10/04/2017
ms.author: alkohli
ms.openlocfilehash: 96dcda25cde2473387842fd01421b6bb619e4ece
ms.sourcegitcommit: 48fce90a4ec357d2fb89183141610789003993d2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2018
---
# <a name="deploy-the-storsimple-device-manager-service-for-storsimple-8000-series-devices"></a>Развертывание службы диспетчера устройств StorSimple для устройств StorSimple серии 8000

## <a name="overview"></a>Обзор

Служба диспетчера устройств StorSimple выполняется в Microsoft Azure и подключается к нескольким устройствам StorSimple. После создания службы можно управлять всеми устройствами, которые подключены к службе диспетчера устройств StorSimple из одного центрального расположения, таким образом, снизив административную нагрузку.

В этом руководстве описаны шаги по созданию, удалению, переносу службы и управление ключом регистрации службы. Сведения в этой статье применимы только к устройствам StorSimple серии 8000. Дополнительные сведения о виртуальных массивах StorSimple см. в статье [Развертывание службы диспетчера устройств StorSimple для виртуального массива StorSimple](storsimple-virtual-array-manage-service.md).

> [!NOTE]
> Все классические диспетчеры устройств StorSimple автоматически переведены на новый портал Azure. Если у вас возникли вопросы, см. статью [Перемещение службы диспетчера устройств StorSimple с классического портала на портал Azure. Часто задаваемые вопросы](storsimple-8000-move-azure-portal-faq.md). Командлеты PowerShell для управления службами Azure (ASM) не поддерживаются после перехода на новый портал Azure. Обновите скрипты для управления устройствами и ознакомьтесь со статьей [Использование сценариев Azure Resource Manager для управления устройствами StorSimple на основе пакета SDK](storsimple-8000-automation-azurerm-scripts.md). Новый портал Azure поддерживает устройства под управлением обновления 5.0 или более поздней версии. Если устройство не обновлено, немедленно установите обновление 5. Дополнительные сведения см. в статье [Установка обновления 5 на устройство StorSimple](storsimple-8000-install-update-5.md). Если вы используете облачное устройстве StorSimple (8010/8020), то не сможете обновить его. Используйте последнюю версию программного обеспечения для создания облачного устройства с обновлением 5.0, а затем выполните отработку отказа в созданное облачное устройство. Функциональность управления всеми устройствами с обновлением 4.0 или более ранней версии будет [ограничена](storsimple-8000-manage-service.md#supported-operations-on-devices-running-versions-prior-to-update-5.0). 

## <a name="create-a-service"></a>создание службы;
Чтобы создать службу диспетчера устройств StorSimple, необходимо иметь следующее:

* подписка с соглашением Enterprise;
* активная учетная запись хранения Microsoft Azure;
* сведения о выставлении счетов, которые используются для управления доступом.

Допускается использование только подписок с соглашением Enterprise. Спонсорские подписки Майкрософт, которые были разрешены на классическом портале Azure, на портале Azure не поддерживаются. При использовании подписки, которая не поддерживается, вы увидите следующее сообщение:

![Недопустимая подписка](./media/storsimple-8000-manage-service/subscription-not-valid.jpg)

Вы также можете создать учетную запись хранения по умолчанию во время создания службы.

Одна служба может управлять несколькими устройствами. Однако устройство не может охватить несколько служб. В большую организацию может входить несколько экземпляров служб для работы с разными подписками, организациями или даже местоположениями развернутых служб. 

> [!NOTE]
> Для управления виртуальными массивами StorSimple и устройствами StorSimple серии 8000 необходимо создать отдельные экземпляры службы диспетчера устройств StorSimple.

Выполните следующие действия, чтобы создать службу.

[!INCLUDE [storsimple-create-new-service](../../includes/storsimple-8000-create-new-service.md)]


Для каждой службы диспетчера устройств StorSimple существуют следующие атрибуты:

* **Имя** — имя, назначенное вашей службе диспетчера устройств StorSimple при ее создании. **Имя службы невозможно изменить после ее создания. Это также верно для других сущностей, таких как устройства, тома, контейнеры томов и политики резервного копирования, которые не могут быть переименованы на портале Azure.**
* **Состояние** — состояние службы. Оно может иметь значение **Работает**, **Идет создание** или **В сети**.
* **Местоположение** — географическое местоположение, в котором будет развернуто устройство StorSimple.
* **Подписка** — подписка выставления счетов, связанная с вашей службой.

## <a name="delete-a-service"></a>удаление службы;

Перед удалением службы убедитесь в отсутствии подключенных устройств, которые используют ее. Если служба используется, деактивируйте подключенные устройства. Операция деактивации разорвет подключение между устройством и службой, но сохранит данные устройства в облаке.

> [!IMPORTANT]
> Операцию удаления службы невозможно обратить. На всех устройствах, где использовалась служба, потребуется сброс до заводских настроек перед тем, как на них можно будет использовать другие службы. В этом случае локальные данные на устройстве, а также конфигурация будут потеряны.

Чтобы удалить службу, выполните указанные ниже действия.

### <a name="to-delete-a-service"></a>Удаление службы

1. Найдите службу, которую требуется удалить. Щелкните значок **Ресурсы**, а затем введите имя нужной службы. В результатах поиска выберите службу, которую требуется удалить.

    ![Поиск службы, которую необходимо удалить](./media/storsimple-8000-manage-service/deletessdevman1.png)

2. Откроется колонка службы диспетчера устройств StorSimple. Нажмите кнопку **Delete**(Удалить).

    ![Удаление службы](./media/storsimple-8000-manage-service/deletessdevman2.png)

3. Щелкните **Да** в уведомлении о подтверждении. Удаление службы может занять несколько минут.

    ![Подтверждение удаления](./media/storsimple-8000-manage-service/deletessdevman3.png)

## <a name="get-the-service-registration-key"></a>Получение регистрационного ключа службы

После успешного создания службы потребуется зарегистрировать устройство StorSimple в службе. Для регистрации первого устройства StorSimple необходим ключ регистрации службы. Для регистрации дополнительных устройств в существующей службе StorSimple потребуется ключ регистрации и ключ шифрования данных службы (который создается на первом устройстве во время регистрации). Дополнительные сведения о ключе шифрования данных службы см. в разделе [Безопасность StorSimple](storsimple-8000-security.md). Ключ регистрации можно получить в разделе **Ключи** колонки диспетчера устройств StorSimple.

Выполните следующие действия, чтобы получить ключ регистрации.

[!INCLUDE [storsimple-8000-get-service-registration-key](../../includes/storsimple-8000-get-service-registration-key.md)]

Сохраните ключ регистрации в безопасном расположении. Этот ключ, а также ключ шифрования данных службы потребуется для регистрации дополнительных устройств в службе. После получения ключа регистрации службы вам потребуется настроить устройство в интерфейсе Windows PowerShell для StorSimple.

Дополнительные сведения о том, как использовать этот ключ регистрации см. в разделе [Шаг 3. Настройка и регистрация устройства в Windows PowerShell для StorSimple](storsimple-8000-deployment-walkthrough-u2.md#step-3-configure-and-register-the-device-through-windows-powershell-for-storsimple).

## <a name="regenerate-the-service-registration-key"></a>повторное создание ключа регистрации службы.
Если вам необходимо сменить ключ или при изменении списка администраторов службы потребуется повторно создать ключ регистрации службы. При повторном создании ключа новый ключ используется только для регистрации последующих устройств. Этот процесс не затронет уже зарегистрированные устройства.

Выполните следующие действия, чтобы повторно создать ключ регистрации службы.

### <a name="to-regenerate-the-service-registration-key"></a>Повторное создание ключа регистрации службы
1. В колонке **Диспетчер устройств StorSimple** выберите **Управление &gt;** **Ключи**.
    
    ![Колонка "Ключи"](./media/storsimple-8000-manage-service/regenregkey2.png)

2. В колонке **Ключи** нажмите кнопку **Повторно создать**.

    ![Кнопка повторного создания](./media/storsimple-8000-manage-service/regenregkey3.png)
3. В колонке **Повторное создание ключа регистрации службы** просмотрите действие, необходимое при повторном создании ключей. Все последующие устройства, зарегистрированные в этой службе, будут использовать новый ключ регистрации. Для подтверждения нажмите кнопку **Повторно создать**. После завершения повторного создания вы получите уведомление.

    ![Подтверждение повторного создания](./media/storsimple-8000-manage-service/regenregkey4.png)

4. Появится новый ключ регистрации службы.

5. Скопируйте этот ключ и сохраните его для регистрации новых устройств в службе.



## <a name="change-the-service-data-encryption-key"></a>Изменить ключ шифрования данных службы
Ключи шифрования данных службы используются для шифрования конфиденциальных данных клиентов, например учетных данных учетной записи, которые отправляются из службы StorSimple Manager к устройству StorSimple. Необходимо будет периодически менять эти ключи, если у ИТ-организации есть политика ротации ключей на устройствах хранения. Процесс изменения ключа может немного отличаться в зависимости от того, имеется ли одно или несколько устройств, управляемых службой StorSimple Manager. Дополнительные сведения см. в статье [Защита устройства StorSimple и данных](storsimple-8000-security.md).

Процесс изменения ключа шифрования данных службы включает 3 шага.

1. С помощью скриптов Windows PowerShell для Azure Resource Manager авторизуйте устройство, чтобы изменить ключ шифрования данных службы.
2. С помощью Windows PowerShell для StorSimple инициируйте изменение ключа шифрования данных службы.
3. Если у вас более одного устройства StorSimple, обновите ключ шифрования данных службы на других устройствах.

### <a name="step-1-use-windows-powershell-script-to-authorize-a-device-to-change-the-service-data-encryption-key"></a>Шаг 1. Использование скрипта Windows PowerShell для авторизации изменения ключа шифрования данных службы на устройстве
Как правило, администратор устройства отправляет администратору службы запрос на авторизацию устройство, чтобы изменить ключи шифрования данных службы. Администратор службы авторизует устройство для изменения ключа.

Этот шаг выполняется с помощью скрипта на основе Azure Resource Manager. Администратор служб может выбрать устройство для авторизации. Устройство авторизуется для начала изменения ключа шифрования данных службы. 

Дополнительные сведения об использовании скрипта см. в статье [Authorize-ServiceEncryptionRollover.ps1](https://github.com/anoobbacker/storsimpledevicemgmttools/blob/master/Authorize-ServiceEncryptionRollover.ps1)

#### <a name="which-devices-can-be-authorized-to-change-service-data-encryption-keys"></a>Какие устройства можно авторизовать для изменения ключей шифрования данных службы?
Чтобы устройству можно было разрешить инициировать изменение ключа шифрования данных службы, оно должно удовлетворять следующим условиям.

* Устройство должно быть подключено к сети для авторизации изменения ключа шифрования данных службы.
* Одно устройство можно авторизовать еще раз через 30 минут, если изменение ключа не было запрошено.
* Можно авторизовать другое устройство, если изменение ключа не было инициировано ранее авторизованным устройством. После авторизации нового устройства старое не сможет инициировать изменение.
* Невозможно авторизовать устройство во время смены ключа шифрования данных службы.
* Можно авторизовать устройство, если некоторые из зарегистрированных в службе устройств изменили шифрование, а другие — нет. 

### <a name="step-2-use-windows-powershell-for-storsimple-to-initiate-the-service-data-encryption-key-change"></a>Шаге 2. Использование Windows PowerShell для StorSimple для изменения ключа шифрования данных службы
Этот шаг выполняется в интерфейсе Windows PowerShell для StorSimple на авторизованном устройстве StorSimple.

> [!NOTE]
> До завершения смены ключей на портале Azure службы StorSimple Manager не могут выполняться никакие операции.
> 
> 

Если вы используете последовательную консоль устройства выполните следующие действия для подключения к интерфейсу Windows PowerShell.

#### <a name="to-initiate-the-service-data-encryption-key-change"></a>Запуск изменения ключа шифрования данных службы
1. Выберите вариант 1, чтобы войти на устройство с правами на полный доступ.
2. В командной строке выполните следующую команду:
   
     `Invoke-HcsmServiceDataEncryptionKeyChange`
3. После успешного завершения работы командлета вы получите новый ключ шифрования данных службы. Скопируйте и сохраните этот ключ для использования на шаге 3. Этот ключ будет использоваться для обновления всех остальных устройств, зарегистрированных в службе StorSimple Manager.
   
   > [!NOTE]
   > Этот процесс должен быть запущен в течение четырех часов авторизации устройства StorSimple.
   > 
   > 
   
   Затем новый ключ отправляется службе для распространения на всех зарегистрированных устройствах. На панели мониторинга службы появится предупреждение. Служба отключит все операция на зарегистрированных устройствах, а администратору устройств потребуется обновить ключ шифрования данных службы на других устройствах. Однако операции ввода-вывода (компьютеры, отправляющие данные в облако) не будет прерваны.
   
   Если в службе зарегистрировано одно устройство, процесс замены завершен, а следующий шаг можно пропустить. Если в службе зарегистрировано несколько устройств, перейдите к шагу 3.

### <a name="step-3-update-the-service-data-encryption-key-on-other-storsimple-devices"></a>Шаг 3. Обновление ключа шифрования данных службы на других устройствах StorSimple
Эти действия необходимо выполнить в интерфейсе Windows PowerShell устройства StorSimple при наличии нескольких устройств, зарегистрированных в службе StorSimple Manager. Ключ, полученный на шаге 2, следует использовать для обновления остальных устройств StorSimple, зарегистрированных в службе StorSimple Manager.

Выполните следующие действия для обновления шифрования данных службы на устройстве.

#### <a name="to-update-the-service-data-encryption-key-on-physical-devices"></a>Обновление ключа шифрования данных службы на физических устройствах
1. Используйте Windows PowerShell для StorSimple, чтобы подключиться к консоли. Выберите вариант 1, чтобы войти на устройство с правами на полный доступ.
2. В командной строке введите следующий текст: `Invoke-HcsmServiceDataEncryptionKeyChange – ServiceDataEncryptionKey`.
3. Укажите ключ шифрования данных службы, полученный на [Шаге 2. Использование Windows PowerShell для StorSimple для изменения ключа шифрования данных службы](#to-initiate-the-service-data-encryption-key-change).

#### <a name="to-update-the-service-data-encryption-key-on-all-the-80108020-cloud-appliances"></a>Обновление ключа шифрования данных службы на всех облачных устройствах 8010/8020
1. Скачайте и установите сценарий PowerShell [Update-CloudApplianceServiceEncryptionKey.ps1](https://github.com/anoobbacker/storsimpledevicemgmttools/blob/master/Update-CloudApplianceServiceEncryptionKey.ps1). 
2. Откройте PowerShell и введите следующую команду в командной строке: `Update-CloudApplianceServiceEncryptionKey.ps1 -SubscriptionId [subscription] -TenantId [tenantid] -ResourceGroupName [resource group] -ManagerName [device manager]`

Этот сценарий гарантирует, что ключ шифрования служебных данных будет установлен на всех облачных устройствах 8010/8020 в диспетчере устройств.

## <a name="supported-operations-on-devices-running-versions-prior-to-update-50"></a>Поддерживаемые операции на устройствах под управлением версий, предшествующих обновлению 5.0
На портале Azure поддерживаются только устройства StorSimple с обновлениями 5.0 и более поздних версий. Устройства под управлением более старых версий имеют ограниченную поддержку. В следующей таблице указаны операции, которые будут поддерживаться на устройствах с обновлением ниже версии 5.0 после переноса на портал Azure.

| Операция                                                                                                                       | Поддерживаются      |
|---------------------------------------------------------------------------------------------------------------------------------|----------------|
| Регистрация устройства                                                                                                               | Yes            |
| Настройка параметров устройства (например, общие параметры, сети и безопасность)                                                                | Yes            |
| Проверка, скачивание и установка обновлений                                                                                             | Yes            |
| Отключение устройства                                                                                                               | Yes            |
| Удаление устройства                                                                                                                   | Yes            |
| Создание, изменение и удаление контейнера томов                                                                                   | Нет              |
| Создание, изменение и удаление тома                                                                                             | Нет              |
| Создание, изменение и удаление политики архивации                                                                                      | Нет              |
| Создание резервной копии вручную                                                                                                            | Нет              |
| Выполнение запланированного резервного копирования                                                                                                         | Не применяется |
| Восстановление из набора резервных данных                                                                                                        | Нет              |
| Клонирование на устройство под управлением обновления 3.0 и более поздней версии <br> На исходном устройстве установлено обновление ниже версии 3.0                                | Yes            |
| Клонирование на устройство с обновлением ниже версии 3.0                                                                          | Нет              |
| Отработка отказа в качестве исходного устройства <br> (с устройства с обновлением ниже версии 3.0 на устройство с обновлением 3.0 и более поздней версии)                                                               | Yes            |
| Отработка отказа в качестве целевого устройства <br> (на устройство с обновлением ниже версии 3.0)                                                                                   | Нет              |
| Очистка оповещений                                                                                                                  | Yes            |
| Просмотр политик резервного копирования, каталога резервных копий, томов, контейнеров томов, диаграмм мониторинга заданий и предупреждений, созданных на классическом портале | Yes            |
| Включение и выключение контроллеров устройства                                                                                              | Yes            |


## <a name="next-steps"></a>Дополнительная информация
* Узнайте больше о [процессе развертывания StorSimple](storsimple-8000-deployment-walkthrough-u2.md).
* Узнайте больше об [управлении учетной записью хранения StorSimple](storsimple-8000-manage-storage-accounts.md).
* Узнайте больше об [использовании службы диспетчера устройств StorSimple для администрирования устройства StorSimple](storsimple-8000-manager-service-administration.md).
