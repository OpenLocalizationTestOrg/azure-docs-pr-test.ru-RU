---
title: "Настройка MPIO на узле, подключенном к виртуальному массиву StorSimple | Документация Майкрософт"
description: "Сведения о настройке функции Multipath I/O (MPIO) для виртуального массива StorSimple, подключенного к узлу под управлением Windows Server 2012 R2."
services: storsimple
documentationcenter: 
author: alkohli
manager: carmonm
editor: 
ms.assetid: 5b7a7f99-ee5b-4b7d-ab32-483a5a1fa504
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/01/2017
ms.author: alkohli
ms.openlocfilehash: c75c6ed40754aee964e2b68f4f569dc1422507f2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="configure-multipath-io-on-windows-server-host-for-the-storsimple-virtual-array"></a>Настройка MPIO на узле Windows Server для виртуального массива StorSimple
## <a name="overview"></a>Обзор
В этой статье описывается, как установить функцию многопутевого ввода-вывода (MPIO) на узле Windows Server, применить определенные параметры конфигурации для томов, используемых только для StorSimple, и затем проверить работу MPIO для томов StorSimple. Процедура предполагает, что виртуальный массив StorSimple 1200 с двумя сетевыми интерфейсами подключен к узлу Windows Server с двумя сетевыми интерфейсами. Сведения в этой статье применимы только к виртуальному массиву. Сведения об устройствах серии StorSimple 8000 см. в статье [Настройка MPIO для узла StorSimple](storsimple-configure-mpio-windows-server.md). 

Функция MPIO в Windows Server помогает создавать высокодоступные, отказоустойчивые хранилища. С помощью избыточных компонентов физических путей — адаптеров, кабелей и коммутаторов — функция MPIO создает логические пути между сервером и устройством хранения. Если возникает сбой компонента, который вызывает отказ логического пути, многопутевая логика использует альтернативный путь для ввода-вывода, а приложения при этом сохранят доступ к данным. Кроме того, в зависимости от конфигурации MPIO также может повысить производительность путем повторной балансировки нагрузки по всем путям. Дополнительные сведения см. в статье [Обзор многопутевого ввода-вывода](https://technet.microsoft.com/library/cc725907.aspx "Общие сведения о MPIO и компоненты").

Чтобы обеспечить высокий уровень доступности решения StorSimple, настройте MPIO на узлах Windows Server, подключенных к виртуальному массиву StorSimple (модель 1200). В результате серверы узлов смогут выдерживать сбои подключения, сети и интерфейса. 

Чтобы настроить MPIO, выполните следующие действия: 

* Предварительные требования для настройки
* Шаг 1. Установка MPIO на узле Windows Server
* Шаг 2. Настройка MPIO для томов StorSimple
* Шаг 3. Подключение томов StorSimple на узле

В следующих разделах каждое действие рассматривается более подробно.

## <a name="prerequisites"></a>Предварительные требования
В этом разделе подробно описываются предварительные требования к узлу Windows Server и виртуальному массиву.

### <a name="on-windows-server-host"></a>На узле Windows Server
* Убедитесь, что у узла Windows Server есть 2 активных сетевых интерфейса.

### <a name="on-storsimple-virtual-array"></a>На виртуальном массиве StorSimple
* Виртуальный массив должен быть настроен как сервер iSCSI. Дополнительные сведения см. в статье [Развертывание виртуального массива StorSimple — настройка виртуального устройства в качестве сервера iSCSI](storsimple-virtual-array-deploy3-iscsi-setup.md). В массиве должны быть включены один или несколько сетевых интерфейсов.   
* Сетевые интерфейсы в виртуальном массиве должны быть доступны с узла Windows Server.
* В виртуальном массиве StorSimple необходимо создать один или несколько томов. Дополнительные сведения см. в разделе [Шаг 3. Добавление тома](storsimple-virtual-array-deploy3-iscsi-setup.md#step-3-add-a-volume) для виртуального массива StorSimple. В этой процедуре мы создали в виртуальном массиве 3 тома (1 локально закрепленный и 2 многоуровневых, как показано ниже).
  
    ![mpio0](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio0.png)

### <a name="hardware-configuration-for-storsimple-virtual-array"></a>Конфигурация оборудования для виртуального массива StorSimple
На рисунке ниже изображена конфигурация оборудования для реализации поддержки нескольких каналов ввода-вывода с высоким уровнем доступности и балансировкой нагрузки для узла Windows Server и виртуального массива StorSimple, которая используется в этом примере.

![конфигурация оборудования mpio](./media/storsimple-virtual-array-configure-mpio-windows-server/1200hardwareconfig.png)

Пояснения к рисунку.

* Виртуальный массив StorSimple, выделенный в Hyper-V, — это активное устройство с одним узлом, настроенное в качестве сервера iSCSI.
* В массиве активировано два виртуальных сетевых интерфейса. В локальном веб-интерфейсе виртуального массива включите два сетевых интерфейса. Для этого перейдите в раздел **Параметры сети**, как показано ниже.
  
    ![сетевые интерфейсы, включенные в 1200](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio9.png)
  
    Найдите IPv4-адреса включенных сетевых интерфейсов (Ethernet, Ethernet 2 по умолчанию) и выпишите их для последующего использования на узле.
* На узле Windows Server активировано два сетевых интерфейса. Если подключенные интерфейсы для узла и массива находятся в одной подсети, будет доступно 4 канала. Это наблюдается в данном примере. Если же интерфейс передачи данных на устройстве и интерфейс узла расположены в подсетях с разными IP-адресами и эти IP-адреса не поддерживают маршрутизацию, будут доступны только 2 канала.

## <a name="step-1-install-mpio-on-the-windows-server-host"></a>Шаг 1. Установка MPIO на узле Windows Server
MPIO представляет собой дополнительный компонент, который по умолчанию не устанавливается в Windows Server. Его необходимо устанавливать в качестве отдельного компонента через диспетчер сервера. Чтобы установить этот компонент на узле Windows Server, выполните следующую процедуру.

[!INCLUDE [storsimple-install-mpio-windows-server-host](../../includes/storsimple-install-mpio-windows-server-host.md)]

## <a name="step-2-configure-mpio-for-storsimple-volumes"></a>Шаг 2. Настройка MPIO для томов StorSimple
MPIO необходимо настроить для идентификации томов StorSimple. Чтобы настроить MPIO для распознавания томов StorSimple, выполните следующие действия.

[!INCLUDE [storsimple-configure-mpio-volumes](../../includes/storsimple-configure-mpio-volumes.md)]

## <a name="step-3-mount-storsimple-volumes-on-the-host"></a>Шаг 3. Подключение томов StorSimple на узле
После настройки MPIO на Windows Server созданные в массиве StorSimple тома можно будет подключить и они смогут воспользоваться преимуществами MPIO для обеспечения избыточности. Чтобы подключить том, выполните следующие действия.

#### <a name="to-mount-volumes-on-the-host"></a>Подключение томов на узле
1. Откройте окно **Свойства инициатора iSCSI** на узле Windows Server. Выберите **Диспетчер серверов > Панель мониторинга > Сервис > Инициатор iSCSI**.
2. В диалоговом окне **iSCSI Initiator Properties** (Свойства инициатора iSCSI) перейдите на вкладку **Обнаружение** и щелкните **Обнаружение целевого портала**.
3. В диалоговом окне **Обнаружение целевого портала** выполните следующие действия.
   
    1. Введите IP-адрес первого включенного сетевого интерфейса в виртуальном массиве StorSimple. По умолчанию это **Ethernet**. 
    2. Щелкните **ОК** для возврата в диалоговое окно **iSCSI Initiator Properties** (Свойства инициатора iSCSI).
     
    > [!IMPORTANT]
    > При использовании частной сети для подключения iSCSI введите IP-адрес порта данных, подключенного к частной сети.
     
4. Повторите шаги 2–3 для второго сетевого интерфейса (например Ethernet 2) в массиве. 
5. Перейдите на вкладку **Целевые объекты** в диалоговом окне **iSCSI Initiator Properties** (Свойства инициатора iSCSI). Для виртуального массива в разделе **Обнаруженные конечные объекты**каждый том будет отображаться как конечный объект. В нашем случае будут обнаружены три конечных объекта (соответствующие трем томам).
   
    ![mpio1](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio1.png)
6. Щелкните **Подключить**, чтобы установить сеанс подключения iSCSI с виртуальным массивом StorSimple. Появится диалоговое окно **Подключение к целевому объекту** . Установите флажок **Включить поддержку многопутевых устройств** . Нажмите кнопку **Дополнительно**.
   
    ![mpio2](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio2.png)
7. В диалоговом окне **Дополнительные параметры** выполните следующие действия.                                        
   
    1. В раскрывающемся списке **Локальный адаптер** выберите **Microsoft iSCSI инициатор**.
    2. Из раскрывающегося списка **IP-адрес инициатора** выберите IP-адрес узла.
    3. Из раскрывающегося списка **Целевой IP-адрес портала** выберите IP-адрес интерфейса массива.
    4. Щелкните **ОК** для возврата в диалоговое окно **iSCSI Initiator Properties** (Свойства инициатора iSCSI).
     
        ![mpio3](./media/storsimple-ova-configure-mpio-windows-server/mpio3.png)

8. Щелкните **Свойства**. 
   
    ![mpio4](./media/storsimple-ova-configure-mpio-windows-server/mpio4.png)

9. В диалоговом окне **Свойства** нажмите кнопку **Добавить сеанс**.
   
   ![mpio5](./media/storsimple-ova-configure-mpio-windows-server/mpio5.png)
10. В диалоговом окне **Подключение к конечному объекту** установите флажок **Включить поддержку многопутевых накопителей**. Нажмите кнопку **Дополнительно**.
11. В диалоговом окне **Дополнительные параметры** выполните следующие действия.                                        
    
    1. В раскрывающемся списке **Локальный адаптер** выберите "Инициатор iSCSI (Майкрософт)".

    2. Из раскрывающегося списка **IP-адрес инициатора** выберите IP-адрес узла. В данном случае выполняется подключение двух сетевых интерфейсов в массиве к одному сетевому интерфейсу на узле. Таким образом, этот интерфейс является таким же, как для первого сеанса.

    3. Из раскрывающегося списка **Целевой IP-адрес портала** выберите IP-адрес для второго интерфейса данных массива.

    4. Щелкните **ОК** для возврата в диалоговое окно "Свойства инициатора iSCSI". В целевой объект был добавлен второй сеанс.
      
       ![mpio11](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio11.png)
    
    5. После добавления сеансов (путей) в диалоговом окне **iSCSI Initiator Properties** (Свойства инициатора iSCSI) выберите целевой объект и нажмите кнопку **Свойства**. На вкладке "Сеансы" диалогового окна **Свойства** обратите внимание на четыре идентификатора сеансов, которые соответствуют возможным перестановкам путей. Чтобы отменить сеанс, установите флаг рядом с идентификатором сеанса и нажмите кнопку **Отключить**.

    6. Чтобы просмотреть устройства, представленные в сеансах, выберите вкладку **Устройства** . Чтобы настроить политику MPIO для выбранного устройства, щелкните **MPIO**.

    7. Откроется диалоговое окно **Сведения**. На вкладке **MPIO** можно выбрать параметры **Политики балансировки нагрузки**. Можно также просмотреть тип пути **Активный** или **Ожидание**.
12. Повторите шаги 8–11, чтобы добавить дополнительные сеансы (пути) в целевой объект. С двумя интерфейсами на узле и двумя в виртуальном массиве можно добавить четыре сеанса для каждого конечного объекта. 
    
    ![mpio14](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio14.png)
13. Эти шаги необходимо повторить для каждого тома (отображаются в качестве конечного объекта).
    
    ![mpio15](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio15.png)
14. Откройте **Управление компьютером**, для чего выберите **Диспетчер серверов > Панель мониторинга > Управление компьютером**. В левой области щелкните **Хранилище > Управление дисками**. Тома, созданные в виртуальном массиве StorSimple, видимые для этого узла, будут отображены на вкладке **Управление дисками** в качестве новых дисков.
15. Инициализируйте диск и создайте новый том. Во время форматирования выберите размер кластера (AUS) 64 КБ. Повторите этот процесс для всех доступных томов.
    
    ![Управление дисками](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio20.png)
16. В разделе **Управление дисками** щелкните правой кнопкой мыши **Диск** и выберите **Свойства**.
17. В диалоговом окне **Multi-Path Disk Device Properties** (Свойства устройства многопутевого диска) перейдите на вкладку **MPIO**.
    
    ![Свойства диска](./media/storsimple-virtual-array-configure-mpio-windows-server/mpio21.png)
18. В разделе **Имя DSM** щелкните **Сведения** и убедитесь, что заданы параметры по умолчанию. Используются следующие параметры по умолчанию.
    
    * Период проверки пути = 30.
    * Счетчик попыток = 3.
    * Период удаления PDO = 20.
    * Интервал попытки = 1.
    * Проверка пути включена = флажок снят.
    
    > [!NOTE]
    > **Не изменяйте параметры по умолчанию.**
   
## <a name="next-steps"></a>Дальнейшие действия
Узнайте больше об [использовании службы диспетчера устройств StorSimple для администрирования виртуального массива StorSimple](storsimple-virtual-array-manager-service-administration.md).

