---
title: "Использование StorSimple серии 8000 в качестве целевого объекта архивации с помощью Veeam | Документация Майкрософт"
description: "Описание настройки целевого объекта архивации StorSimple с помощью Veeam."
services: storsimple
documentationcenter: 
author: harshakirank
manager: matd
editor: 
ms.assetid: 
ms.service: storsimple
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/06/2016
ms.author: hkanna
ms.openlocfilehash: cc1c7a3f77af76c451bb6e97a081a01c119333b5
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="storsimple-as-a-backup-target-with-veeam"></a>Использование StorSimple в качестве целевого объекта архивации с помощью Veeam

## <a name="overview"></a>Обзор

Azure StorSimple — это решение гибридного облачного хранилища от Майкрософт. StorSimple позволяет устранить проблемы, связанные с экспоненциальным увеличением объема данных. Для этого учетная запись хранения Azure используется в качестве расширения локального решения, а данные автоматически распределяются по уровням в локальном и облачном хранилище.

В этой статье представлены сведения об интеграции StorSimple с Veeam и рекомендации по интеграции этих решений. Вы также найдете здесь рекомендации по настройке Veeam для эффективной интеграции со StorSimple. Мы обратились к экспертам, специалистам по архивации и администраторам Veeam, чтобы узнать, как лучше всего настроить Veeam в соответствии с отдельными требованиями к архивации и соглашениями об уровне обслуживания.

В этой статье представлена процедура настройки и основные понятия. Однако она отнюдь не является пошаговым руководством по настройке или установке. Здесь предполагается, что основные компоненты и инфраструктура работоспособны и подготовлены для поддержки описываемых компонентов.

### <a name="who-should-read-this"></a>Для кого предназначена эта статья?

Эта статья предназначена для администраторов архивации, администраторов и архитекторов хранилища с опытом работы с хранилищами, Windows Server 2012 R2, Ethernet, облачными службами и Veeam.

### <a name="supported-versions"></a>Поддерживаемые версии

-   Veeam 9 и более поздних версий
-   [StorSimple с обновлением 3 и более поздних версий](storsimple-overview.md#storsimple-workload-summary)


## <a name="why-storsimple-as-a-backup-target"></a>Причины использования StorSimple в качестве целевого объекта архивации

StorSimple оптимально подходит для целевого объекта архивации по следующим причинам.

-   Это решение предоставляет стандартное локальное хранилище для приложений архивации, которое можно использовать, ничего не изменяя. Таким образом, вы быстро получаете расположение для резервных копий. StorSimple также обеспечивает быстрое восстановление последних резервных копий.
-   Возможность распределения по уровням облака без проблем интегрируется с учетной записью облачного хранилища Azure, благодаря чему вы можете воспользоваться экономичной службой хранилища Azure.
-   Это решение автоматически предоставляет автономное хранилище для аварийного восстановления.


## <a name="key-concepts"></a>Основные понятия

Для успешной работы этого решения, как и для любого другого решения хранилища, крайне важно провести тщательный анализ производительности решения хранилища, соглашения об уровне обслуживания, скорости изменений и потребности относительно увеличения емкости. Основная мысль состоит в том, что при реализации облачного уровня важную роль в работе StorSimple играют время доступа и пропускная способность облака.

Решение StorSimple предназначено для предоставления хранилища для приложений, работающих с четко определенным набором рабочих данных ("горячие данные"). В этой модели набор рабочих данных хранится на локальном уровне, а остальные наборы нерабочих, "холодных" и архивированных данных распределяются по уровням в облаке. Эта модель показана на рисунке ниже. Практически плоская зеленая линия представляет собой данные, хранящиеся на локальных уровнях устройства StorSimple. Красная линия представляет собой общий объем данных, хранящихся на всех уровнях в решении StorSimple. Расстояние между плоский зеленой линией и экспоненциальной красной кривой представляет собой общий объем данных, хранящихся в облаке.

**Распределение по уровням в StorSimple**
![Схема распределения по уровням в StorSimple](./media/storsimple-configure-backup-target-using-veeam/image1.jpg)

Благодаря такой архитектуре StorSimple идеально подходит для использования в качестве целевого объекта архивации. Вы можете использовать StorSimple, чтобы:

-   часто восстанавливать локальный рабочий набор данных;
-   использовать облако для автономного хранения и аварийного восстановления старых данных, которое выполняется не так часто.

## <a name="storsimple-benefits"></a>Преимущества StorSimple

StorSimple предоставляет локальное решение, без проблем интегрирующееся с Microsoft Azure за счет простого доступа к локальному и облачному хранилищу.

StorSimple использует автоматическое распределение по уровням между локальным устройством, содержащим устройство с твердотельными накопителями (SSD) и хранилище с последовательным подключением SCSI (SAS), и службой хранилища Azure. Благодаря автоматическому распределению по уровням часто используемые данные хранятся локально, на уровнях SSD и SAS, а редко используемые данные перемещаются в службу хранилища Azure.

StorSimple предоставляет следующие преимущества:

-   Уникальные алгоритмы дедупликации и сжатия, использующие облако для обеспечения беспрецедентного уровня дедупликации.
-   высокую доступность;
-   Георепликация на основе технологий Azure.
-   Интеграция Azure.
-   Шифрование данных в облаке.
-   Усовершенствованное аварийное восстановление и соответствие

Хотя StorSimple представляет два основных сценария развертывания (основной и дополнительный целевой объект архивации), это просто обычное устройство блочного хранилища. StorSimple выполняет сжатие и дедупликацию. Это решение также 	беспроблемно получает данные из облака и отправляет их в приложение и файловую систему.

Дополнительные сведения о StorSimple см. в статье [Серия StorSimple 8000: решение гибридного облачного хранилища](storsimple-overview.md). Кроме того, вы можете просмотреть статью [Технические характеристики и информация о соответствии нормативным требованиям для устройства StorSimple](storsimple-technical-specifications-and-compliance.md).

> [!IMPORTANT]
> Использование устройства StorSimple в качестве целевого объекта архивации поддерживается только для StorSimple 8000 с обновлением 3 или более поздней версии.

## <a name="architecture-overview"></a>Общие сведения об архитектуре

В следующих таблицах представлены основные рекомендации по моделям и архитектуре устройства.

**Емкость StorSimple для локального и облачного хранилища**

| Емкость хранилища | 8100 | 8600 |
|---|---|---|
| Емкость локального хранилища | &lt;10 ТиБ\*  | &lt;20 ТиБ\*  |
| Емкость облачного хранилища | &gt;200 ТиБ\* | &gt;500 ТиБ\* |

\* В размере хранилища предполагается, что дедупликация и сжатие не используются.

**Емкость StorSimple для основных и дополнительных резервных копий**

| Сценарий архивации  | Емкость локального хранилища  | Емкость облачного хранилища  |
|---|---|---|
| Основная резервная копия  | Последние резервные копии содержатся в локальном хранилище для быстрого восстановления, чтобы соответствовать целевой точке восстановления (RPO). | Журнал архивации (RPO) помещается в облаке. |
| Дополнительная резервная копия | Дополнительную копию резервных данных можно хранить в облаке.  | Недоступно  |

## <a name="storsimple-as-a-primary-backup-target"></a>Использование StorSimple в качестве основного целевого объекта архивации

В этом случае тома StorSimple предоставляются приложению архивации в качестве единственного хранилища резервных копий. На этом рисунке показана архитектура решения, где все резервные копии используют многоуровневые тома StorSimple для архивации и восстановления.

![Логическая схема использования StorSimple в качестве основного целевого объекта архивации](./media/storsimple-configure-backup-target-using-veeam/primarybackuptargetlogicaldiagram.png)

### <a name="primary-target-backup-logical-steps"></a>Логическая процедура архивации основного целевого объекта

1.  Сервер архивации обращается к целевому агенту архивации, который передает ему данные.
2.  Сервер архивации записывает данные на многоуровневые тома StorSimple.
3.  Сервер архивации обновляет базу данных каталога и завершает задание архивации.
4.  Скрипт создания моментальных снимков активирует диспетчер облачных моментальных снимков StorSimple (запуск и удаление).
5.  В зависимости от политики периода удержания сервер архивации удаляет недействительные резервные копии.

### <a name="primary-target-restore-logical-steps"></a>Логическая процедура восстановления основного целевого объекта

1.  Сервер архивации начинает восстанавливать соответствующие данные из репозитория хранилища.
2.  Агент архивации получает данные с сервера архивации.
3.  Сервер архивации завершает задание восстановления.

## <a name="storsimple-as-a-secondary-backup-target"></a>Использование StorSimple в качестве дополнительного целевого объекта архивации

В этом случае тома StorSimple в основном используются для долгосрочного хранения и архивирования.

На следующем рисунке показана архитектура, где исходные резервные копии и восстанавливаемые данные сохраняются в высокопроизводительном томе. Эти резервные копии по заданному расписанию копируются и архивируются в многоуровневый том StorSimple.

Очень важно определить размер высокопроизводительного тома в соответствии с требованиями политики периода удержания к емкости и производительности.

![Логическая схема использования StorSimple в качестве дополнительного целевого объекта архивации](./media/storsimple-configure-backup-target-using-veeam/secondarybackuptargetlogicaldiagram.png)

### <a name="secondary-target-backup-logical-steps"></a>Логическая процедура архивации дополнительного целевого объекта

1.  Сервер архивации обращается к целевому агенту архивации, который передает ему данные.
2.  Сервер архивации записывает данные в высокопроизводительное хранилище.
3.  Сервер архивации обновляет базу данных каталога и завершает задание архивации.
4.  В зависимости от политики периода удержания сервер архивации копирует резервные копии в StorSimple.
5.  Скрипт создания моментальных снимков активирует диспетчер облачных моментальных снимков StorSimple (запуск и удаление).
6.  В зависимости от политики периода удержания сервер архивации удаляет недействительные резервные копии.

### <a name="secondary-target-restore-logical-steps"></a>Логическая процедура восстановления дополнительного целевого объекта

1.  Сервер архивации начинает восстанавливать соответствующие данные из репозитория хранилища.
2.  Агент архивации получает данные с сервера архивации.
3.  Сервер архивации завершает задание восстановления.

## <a name="deploy-the-solution"></a>Развертывание решения

Развертывание решения состоит из трех шагов.

1. Подготовка сетевой инфраструктуры.
2. Развертывание устройства StorSimple в качестве целевого объекта архивации.
3. Развертывание Veeam

Каждый этап подробно описан в следующих разделах.

### <a name="set-up-the-network"></a>Настройка сети

StorSimple является решением, интегрированным с облаком Azure, и поэтому ему требуется активное действующее подключение к этому облаку. Это подключение используется для создания облачных моментальных снимков, управления данными, передачи метаданных и распределения старых, редко используемых данных по уровням в облачном хранилище Azure.

Для оптимальной работы решения мы советуем придерживаться следующих рекомендаций по сетям.

-   Канал связи между распределением по уровням StorSimple и Azure должен соответствовать требованиям к пропускной способности. Для этого необходимо, чтобы качество обслуживания параметров инфраструктуры было таким, как указано в соглашениях об уровне обслуживания для RPO и целевого времени восстановления (RTO).
-   Максимальная задержка доступа к хранилищу BLOB-объектов Azure должна находиться в пределах 80 мс.

### <a name="deploy-storsimple"></a>Развертывание StorSimple

Пошаговое руководство по развертыванию StorSimple см. в статье [Развертывание локального устройства StorSimple (с обновлением 2)](storsimple-deployment-walkthrough-u2.md).

### <a name="deploy-veeam"></a>Развертывание Veeam

Рекомендации по установке Veeam см. [здесь](https://bp.veeam.expert/). Руководство пользователя см. в [технической документации в центре справки Veeam](https://www.veeam.com/documentation-guides-datasheets.html).

## <a name="set-up-the-solution"></a>Настройка решения

В этом разделе представлены некоторые примеры настройки. В следующих рекомендациях и примерах продемонстрирована простейшая базовая реализация. Эта реализация может не соответствовать конкретным требованиям к архивации.

### <a name="set-up-storsimple"></a>Настройка StorSimple

| Задачи развертывания StorSimple  | Дополнительные комментарии |
|---|---|
| Развертывание локального устройства StorSimple | Поддерживаемые версии: обновление 3 и более поздних версий. |
| Включение целевого объекта архивации | Используйте следующие команды, чтобы включить или отключить режим целевого объекта архивации и получить информацию о состоянии. Дополнительные сведения см. в статье [Удаленное подключение к устройству StorSimple](storsimple-remote-connect.md).</br> Чтобы включить режим архивации, выполните следующую команду: `Set-HCSBackupApplianceMode -enable`. </br> Чтобы отключить режим архивации, выполните следующую команду: `Set-HCSBackupApplianceMode -disable`. </br> Для получения текущего состояния параметров режима архивации выполните следующую команду: `Get-HCSBackupApplianceMode`. |
| Создайте общий контейнер томов для тома, на котором хранятся резервные данные. Все данные в контейнере томов дедуплицируются | Контейнеры томов StorSimple определяют домены дедупликации.  |
| Создание тома StorSimple | Создайте тома с размерами, максимально соответствующими тому, который предположительно будет использоваться, так как от размера тома зависит время создания облачных моментальных снимков. Дополнительные сведения об определении размера тома см. в разделе [Политики периода удержания](#retention-policies).</br> </br> Используйте многоуровневые тома StorSimple и установите флажок **Используйте этот том для архивных данных, доступ к которым осуществляется нечасто**. </br> Использование только локально закрепленных томов не поддерживается. |
| Создайте уникальную политику архивации StorSimple для всех целевых томов архивации. | Политика архивации StorSimple определяет группу согласованности томов. |
| Отключение расписания при истечении срока действия моментальных снимков | Моментальные снимки активируются в качестве операции постобработки. |

### <a name="set-up-the-host-backup-server-storage"></a>Настройка хранилища сервера архивации узла

Настройте хранилище сервера архивации узла, следуя указанным ниже рекомендациям.  

- Не используйте составные тома (созданные с помощью службы Windows Disk Management). Составные тома не поддерживаются.
- Отформатируйте тома с помощью NTFS с размером кластера 64 КБ.
- Сопоставьте тома StorSimple с сервером Veeam.
    - Используйте iSCSI для физических серверов.


## <a name="best-practices-for-storsimple-and-veeam"></a>Рекомендации для StorSimple и Veeam

Настройте решение согласно рекомендациям в следующих разделах.

### <a name="operating-system-best-practices"></a>Рекомендации по операционной системе

-   Отключите шифрование и дедупликацию Windows Server для файловой системы NTFS.
-   Отключите дефрагментацию Windows Server для томов StorSimple.
-   Отключите индексацию Windows Server для томов StorSimple.
-   Выполните антивирусное сканирование исходного узла (не для томов StorSimple).
-   Отключите [обслуживание Windows Server](https://msdn.microsoft.com/library/windows/desktop/hh848037.aspx), включенное по умолчанию, в диспетчере задач. Выполните это действие одним из следующих способов.
    - Отключите средство настройки обслуживания в планировщике заданий Windows.
    - Скачайте программу [PsExec](https://technet.microsoft.com/sysinternals/bb897553.aspx) из Windows Sysinternals. После этого запустите Windows PowerShell от имени администратора и введите следующее:
      ```powershell
      psexec \\%computername% -s schtasks /change /tn “MicrosoftWindowsTaskSchedulerMaintenance Configurator" /disable
      ```

### <a name="storsimple-best-practices"></a>Рекомендации по StorSimple

-   Убедитесь, что для устройства StorSimple установлено [обновление 3 или более поздней версии](storsimple-install-update-3.md).
-   Изолируйте трафик iSCSI и облака. Используйте выделенное подключение iSCSI для трафика между StorSimple и сервером архивации.
-   Проверьте, является ли устройство StorSimple выделенным целевым объектом архивации. Смешанные рабочие нагрузки не поддерживаются, так как они влияют на RTO и RPO.

### <a name="veeam-best-practices"></a>Рекомендации по использованию Veeam

-   База данных Veeam должна быть локальной на сервере и не располагаться на томе StorSimple.
-   Для аварийного восстановления создайте резервную копию базы данных Veeam на томе StorSimple.
-   Для этого решения мы поддерживаем полные и добавочные резервные копии Veeam. Мы не рекомендуем использовать синтетические и разностные резервные копии.
-   Файлы резервных данных должны содержать только данные для конкретного задания. Например, запрещено добавлять носители для разных заданий.
-   Отключение проверки заданий. При необходимости запланируйте ее после последнего задания архивации. Важно понимать, что это задание влияет на окно архивации.
-   Включите предварительное выделение носителей.
-   Включите параллельную обработку.
-   Отключите сжатие.
-   Отключите дедупликацию в задании архивации.
-   Задайте оптимизацию на уровне **LAN Target** (Целевой объект LAN).
-   Включите **создание активных полных резервных копий** (каждые 2 недели).
-   В репозитории архивов настройте **использование файлов резервных копий для каждой виртуальной машины**.
-   Настройте **использование** **8** потоков передачи на каждое задание (максимальное значение — 16). Увеличьте или уменьшите это количество в зависимости от использования ресурсов ЦП на устройстве StorSimple.

## <a name="retention-policies"></a>Политики хранения

Чаще всего используется такая политика хранения резервных копий, как "дед-отец-сын" (GFS). В политике GFS добавочное резервное копирование выполняется ежедневно, а полное — еженедельно и ежемесячно. В результате вы получаете 6 многоуровневых томов StorSimple. Один том содержит полные еженедельные, ежемесячные и ежегодные резервные копии. На 5 других томах хранятся ежедневные добавочные резервные копии.

В следующем примере мы используем схему архивации GFS. В нем предполагается следующее:

-   Используются не дедуплицированные или не сжатые данные.
-   Размер полных резервных копий — 1 ТиБ.
-   Размер ежедневных добавочных резервных копий — 500 ГиБ.
-   Четыре еженедельные резервные копии хранятся в течение месяца.
-   12 ежемесячных резервных копий хранятся в течение года.
-   Одна ежегодная резервная копия хранится в течение 10 лет.

С учетом предыдущих предположений создайте многоуровневый том StorSimple на 26 ТиБ для полных ежемесячных и ежегодных резервных копий. Создайте многоуровневый том StorSimple на 5 ТиБ для каждой из добавочных ежедневных резервных копий.

| Период удержания и тип резервной копии | Размер (ТиБ) | Множитель GFS\* | Общая емкость (ТиБ)  |
|---|---|---|---|
| Еженедельная полная | 1 | 4  | 4 |
| Ежедневная добавочная | 0,5 | 20 (число циклов соответствует числу недель в месяце) | 12 (2 для дополнительной квоты) |
| Полная ежемесячная | 1 | 12 | 12 |
| Полная ежегодная | 1  | 10 | 10 |
| Требование GFS |   | 38 |   |
| Дополнительная квота  | 4  |   | Всего: 42 (в соответствии с требованиями GFS)  |
\* Коэффициент GFS — это количество копий, которые требуется защитить и сохранить в соответствии с требованиями политики архивации.

## <a name="set-up-veeam-storage"></a>Настройка хранилища Veeam

### <a name="to-set-up-veeam-storage"></a>Чтобы настроить хранилище Veeam, сделайте следующее:

1.  В консоли Veeam Backup and Replication (Архивация и репликация Veeam) в разделе **Repository Tools** (Инструменты репозиториев) выберите **Backup Infrastructure** (Инфраструктура архивации). Щелкните правой кнопкой мыши **Backup Repositories** (Репозитории архивов) и выберите **Add Backup Repository** (Добавить репозиторий архивов).

    ![Страница Backup Repository (Репозиторий архивов) в консоли управления Veeam](./media/storsimple-configure-backup-target-using-veeam/veeamimage1.png)

2.  В диалоговом окне **New Backup Repository** (Создание репозитория архивов) введите имя и описание репозитория. Щелкните **Далее**.

    ![Страница ввода имени и описания в консоли управления Veeam](./media/storsimple-configure-backup-target-using-veeam/veeamimage2.png)

3.  Выберите тип **Microsoft Windows server**. Выберите сервер Veeam. Щелкните **Далее**.

    ![Выбор типа репозитория архивации в консоли управления Veeam](./media/storsimple-configure-backup-target-using-veeam/veeamimage3.png)

4.  Чтобы указать **расположение**, найдите и выберите необходимый том. Установите флажок **Limit maximum concurrent tasks to:** (Ограничить максимальное количество параллельных задач) и задайте для этого параметра значение **4**. Это гарантирует, что при обработке каждой виртуальной машины одновременно будут обрабатываться только четыре виртуальных диска. Нажмите кнопку **Advanced** (Дополнительно).

    ![Консоль управления NetBackup, выбор тома](./media/storsimple-configure-backup-target-using-veeam/veeamimage4.png)


5.  В диалоговом окне **Storage Compatibility Settings** (Параметры совместимости хранилища) установите флажок **Use per-VM backup files** (Использовать файлы архивации для каждой виртуальной машины).

    ![Консоль управления Veeam, окно Storage Compatibility Settings (Параметры совместимости хранилища)](./media/storsimple-configure-backup-target-using-veeam/veeamimage5.png)

6.  В диалоговом окне **New Backup Repository** (Создание репозитория архивов) установите флажок **Enable vPower NFS service on the mount server (recommended)** (Включить службу vPower NFS на сервере подключения (рекомендуется)). Щелкните **Далее**.

    ![Страница Backup Repository (Репозиторий архивов) в консоли управления Veeam](./media/storsimple-configure-backup-target-using-veeam/veeamimage6.png)

7.  Проверьте параметры и нажмите кнопку **Далее**.

    ![Страница Backup Repository (Репозиторий архивов) в консоли управления Veeam](./media/storsimple-configure-backup-target-using-veeam/veeamimage7.png)

    Репозиторий добавлен на сервер Veeam.

## <a name="set-up-storsimple-as-a-primary-backup-target"></a>Настройка StorSimple в качестве основного целевого объекта архивации

> [!IMPORTANT]
> Восстановление данных из резервной копии, распределенной по уровням в облако, происходит со скоростью облака.

На следующем рисунке представлено сопоставление типичного тома с заданием архивации. В этом случае все еженедельные резервные копии сопоставляются с диском "Полное копирование, суббота", а добавочные резервные копии — с дисками "Понедельник — пятница". Архивация и восстановление выполняются на многоуровневом томе StorSimple.

![Логическая схема конфигурации основного целевого объекта архивации](./media/storsimple-configure-backup-target-using-veeam/primarybackuptargetdiagram.png)

### <a name="storsimple-as-a-primary-backup-target-gfs-schedule-example"></a>Пример расписания с использованием схемы "дед-отец-сын" (GFS) для StorSimple в качестве основного целевого объекта архивации

Ниже приведен пример схемы архивации GFS на 4 недели, месяц и год.

| Периодичность и тип архивации | Полное | Добавочная (день 1–5)  |   
|---|---|---|
| Еженедельная (неделя 1–4) | Суббота | Понедельник — пятница |
| Ежемесячная  | Суббота  |   |
| Ежегодная | Суббота  |   |   |


### <a name="assign-storsimple-volumes-to-a-veeam-backup-job"></a>Назначение томов StorSimple заданию архивации Veeam

При выполнении архивации основного целевого объекта архивации создайте ежедневное задание с основным томом StorSimple Veeam. Если же выполняется архивация дополнительного целевого объекта архивации, создайте ежедневное задание с непосредственно подключенным хранилищем (DAS), запоминающим устройством, подключаемым к сети (NAS), или дисковым массивом JBOD.

#### <a name="to-assign-storsimple-volumes-to-a-veeam-backup-job"></a>Чтобы назначить тома StorSimple заданию архивации Veeam, сделайте следующее:

1.  В консоли Veeam Backup and Replication (Архивация и репликация Veeam) выберите **Backup & Replication** (Архивация и репликация). Щелкните правой кнопкой мыши **Backup** (Архивация) и выберите **VMware** или **Hyper-V** (в зависимости от используемой среды).

    ![Консоль управления Veeam, создание задания архивации](./media/storsimple-configure-backup-target-using-veeam/veeamimage8.png)

2.  В диалоговом окне **New Backup Job** (Создание задания архивации) введите имя и описание ежедневного задания архивации.

    ![Консоль управления Veeam, страница создания задания архивации](./media/storsimple-configure-backup-target-using-veeam/veeamimage9.png)

3.  Выберите виртуальную машину, на которую выполняется архивация.

    ![Консоль управления Veeam, страница создания задания архивации](./media/storsimple-configure-backup-target-using-veeam/veeamimage10.png)

4.  Выберите необходимый **прокси-сервер архивации** и **репозиторий архивов**. Задайте необходимое количество **точек восстановления, которое нужно хранить на диске**, в соответствии с определениями RPO и RTO для среды в локальном хранилище. Нажмите кнопку **Advanced** (Дополнительно).

    ![Консоль управления Veeam, страница создания задания архивации](./media/storsimple-configure-backup-target-using-veeam/veeamimage11.png)

5. В диалоговом окне **Advanced Settings** (Дополнительные параметры) на вкладке **Backup** (Архивация) установите флажок **Incremental** (Добавочная). Снимите флажок **Create synthetic full backups periodically** (Периодически создавать искусственные полные резервные копии). Установите флажок **Create active full backups periodically** (Периодически создавать активные полные резервные копии). В разделе **Active full backup** (Активная полная архивация) установите флажок **Weekly on selected days** (Еженедельно по выбранным дням) и задайте для этого параметра значение "Суббота".

    ![Консоль управления Veeam, страница дополнительных параметров создания задания архивации](./media/storsimple-configure-backup-target-using-veeam/veeamimage12.png)

6. На вкладке **Storage** (Хранилище) снимите флажок **Enable inline data deduplication** (Включить встроенную дедупликацию данных). Установите флажки **Exclude swap file blocks** (Исключить блоки файлов подкачки) и **Exclude deleted file blocks** (Исключить блоки удаленных файлов). Для параметра **Compression level** (Уровень сжатия) задайте значение **None**. Чтобы обеспечить сбалансированную производительность и дедупликацию, для параметра **Storage optimization** (Оптимизация хранилища) задайте значение **LAN Target** (Целевой объект LAN). Нажмите кнопку **ОК**.

    ![Консоль управления Veeam, страница дополнительных параметров создания задания архивации](./media/storsimple-configure-backup-target-using-veeam/veeamimage13.png)

    Дополнительные сведения о параметрах дедупликации и сжатия Veeam см. в [этой статье](https://helpcenter.veeam.com/backup/vsphere/compression_deduplication.html).

7.  В диалоговом окне **Edit Backup Job** (Изменение задания архивации) при необходимости установите флажок **Enable application-aware processing** (Включить обработку с учетом приложения).

    ![Консоль управления Veeam, создание задания архивации, страница обработки гостевой операционной системы](./media/storsimple-configure-backup-target-using-veeam/veeamimage14.png)

8.  Определите расписание выполнения задания для запуска каждый день в указанное время.

    ![Консоль управления Veeam, страница создания расписания задания архивации](./media/storsimple-configure-backup-target-using-veeam/veeamimage15.png)

## <a name="set-up-storsimple-as-a-secondary-backup-target"></a>Настройка StorSimple в качестве дополнительного целевого объекта архивации

> [!NOTE]
> Восстановление данных из резервной копии, распределенной по уровням в облако, происходит со скоростью облака.

В этой модели необходим носитель для хранения (кроме StorSimple), который будет использоваться в качестве временного кэша. Например, том RAID может обеспечивать место, операции ввода-вывода и пропускную способность. Мы рекомендуем использовать RAID 5, 50 и 10.

На следующем рисунке представлены типичные локальные тома (на сервере) с кратким периодом удержания и архивные тома с длительным периодом удержания. В этом сценарии все резервные копии создаются на локальном томе RAID (на сервере). Эти резервные копии периодически копируются и архивируются на архивный том. Очень важно определить размер локального тома RAID (на сервере) в соответствии с требованиями к емкости и производительности для короткого периода удержания.

![Логическая схема использования StorSimple в качестве дополнительного целевого объекта архивации](./media/storsimple-configure-backup-target-using-veeam/secondarybackuptargetdiagram.png)

### <a name="storsimple-as-a-secondary-backup-target-gfs-example"></a>Пример использования схемы GFS для StorSimple в качестве дополнительного целевого объекта архивации

В следующей таблице показано, как настроить резервные копии для запуска на локальных дисках и дисках StorSimple. Сюда входят требования к емкости отдельного диска и общей емкости.

| Период удержания и тип резервной копии | Настроенное хранилище | Размер (ТиБ) | Множитель GFS | Общая емкость\* (ТиБ) |
|---|---|---|---|---|
| 1-я неделя (полная и добавочная) |Локальный диск (с коротким периодом удержания)| 1 | 1 | 1 |
| StorSimple, со 2-ой по 4-ю неделю |Диск StorSimple (с длительным периодом удержания) | 1 | 4 | 4 |
| Полная ежемесячная |Диск StorSimple (с длительным периодом удержания) | 1 | 12 | 12 |
| Полная ежегодная |Диск StorSimple (с длительным периодом удержания) | 1 | 1 | 1 |
|Размер тома в соответствии с GFS |  |  |  | 18*|
\* Общая емкость включает 17 ТиБ для дисков StorSimple и 1 ТиБ для локального тома RAID.


### <a name="gfs-example-schedule"></a>Примеры расписания GFS

Еженедельное, ежемесячное и ежегодное расписание по схеме GFS

| Неделя | Полное | Добавочная, день 1 | Добавочная, день 2 | Добавочная, день 3 | Добавочная, день 4 | Добавочная, день 5 |
|---|---|---|---|---|---|---|
| 1-я неделя | Локальный том RAID  | Локальный том RAID | Локальный том RAID | Локальный том RAID | Локальный том RAID | Локальный том RAID |
| 2-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| 3-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| 4-я неделя | StorSimple, со 2-ой по 4-ю неделю |   |   |   |   |   |
| Ежемесячная | StorSimple, ежемесячная |   |   |   |   |   |
| Ежегодная | StorSimple, ежегодная  |   |   |   |   |   |   |

### <a name="assign-storsimple-volumes-to-a-veeam-copy-job"></a>Назначение томов StorSimple заданию копирования Veeam

#### <a name="to-assign-storsimple-volumes-to-a-veeam-copy-job"></a>Чтобы назначить тома StorSimple заданию копирования Veeam, сделайте следующее:

1.  В консоли Veeam Backup and Replication (Архивация и репликация Veeam) выберите **Backup & Replication** (Архивация и репликация). Щелкните правой кнопкой мыши **Backup** (Архивация) и выберите **VMware** или **Hyper-V** (в зависимости от используемой среды).

    ![Консоль управления Veeam, страница создания задания копирования резервных копий](./media/storsimple-configure-backup-target-using-veeam/veeamimage16.png)

2.  В диалоговом окне **New Backup Copy Job** (Создание задания копирования резервных копий) введите имя и описание задания.

    ![Консоль управления Veeam, страница создания задания копирования резервных копий](./media/storsimple-configure-backup-target-using-veeam/veeamimage17.png)

3.  Выберите виртуальные машины для обработки. Выберите резервные копии и ежедневную резервную копию, созданную ранее.

    ![Консоль управления Veeam, страница создания задания копирования резервных копий](./media/storsimple-configure-backup-target-using-veeam/veeamimage18.png)

4.  При необходимости исключите объекты из задания копирования резервных копий.

5.  Выберите репозиторий архивов и определите количество **сохраняемых точек восстановления**. Установите флажок **Keep the following restore points for archival purposes** (Сохранить следующие точки восстановления для архивации). Определите частоту архивации и нажмите кнопку **Дополнительно**.

    ![Консоль управления Veeam, страница создания задания копирования резервных копий](./media/storsimple-configure-backup-target-using-veeam/veeamimage19.png)

6.  Укажите следующие дополнительные параметры:

    * На вкладке **Maintenance** (Обслуживание) отключите защиту от повреждения данных на уровне хранилища.

    ![Консоль управления Veeam, страница дополнительных параметров создания задания копирования резервных копий](./media/storsimple-configure-backup-target-using-veeam/veeamimage20.png)

    * На вкладке **Storage** (Хранилище) отключите дедупликацию и сжатие данных.

    ![Консоль управления Veeam, страница дополнительных параметров создания задания копирования резервных копий](./media/storsimple-configure-backup-target-using-veeam/veeamimage21.png)

7.  Настройте прямую передачу данных.

8.  Определите окно копирования резервных копий в соответствии со своими потребностями и завершите работу мастера.

Дополнительные сведения см. в руководстве по [созданию заданий копирования резервных копий](https://helpcenter.veeam.com/backup/hyperv/backup_copy_create.html).

## <a name="storsimple-cloud-snapshots"></a>Облачные моментальные снимки StorSimple

Облачные моментальные снимки StorSimple обеспечивают защиту данных на устройстве StorSimple. Создание облачного моментального снимка эквивалентно доставке лент локального резервного копирования в удаленное помещение. При использовании геоизбыточного хранилища Azure оно эквивалентно доставке лент резервного копирования на несколько сайтов. Если после сбоя нужно восстановить устройство, можно запустить другое устройство StorSimple и выполнить отработку отказа. После отработки отказа вы сможете получить доступ к данным (со скоростью облака) из последнего облачного моментального снимка.

В разделе ниже показано, как создать короткий скрипт для запуска и удаления облачных моментальных снимков StorSimple во время постобработки резервной копии.

> [!NOTE]
> На созданные вручную или с помощью программных средств моментальные снимки не распространяется политика истечения срока действия моментальных снимков StorSimple. Их нужно удалять вручную или программным способом.

### <a name="start-and-delete-cloud-snapshots-by-using-a-script"></a>Запуск и удаление облачных моментальных снимков с помощью скрипта

> [!NOTE]
> Перед удалением моментального снимка StorSimple тщательно оцените последствия для соответствия требованиям и хранения данных. Дополнительные сведения о выполнении скрипта после архивации см. в документации по Veeam.


### <a name="backup-lifecycle"></a>Жизненный цикл резервной копии

![Схема жизненного цикла резервной копии](./media/storsimple-configure-backup-target-using-veeam/backuplifecycle.png)

### <a name="requirements"></a>Требования

-   Сервер, на котором выполняется скрипт, должен иметь доступ к облачным ресурсам Azure.
-   У учетной записи пользователя должны быть необходимые разрешения.
-   Для политики архивации StorSimple должны быть настроены, но не включены связанные тома StorSimple.
-   Вам понадобится имя ресурса, регистрационный ключ, имя устройства и идентификатор политики архивации StorSimple.

### <a name="to-start-or-delete-a-cloud-snapshot"></a>Запуск или удаление моментального снимка облака

1. [Установите Azure PowerShell](/powershell/azure/overview).
2. Скачайте и установите скрипт [Manage-CloudSnapshots.ps1](https://github.com/anoobbacker/storsimpledevicemgmttools/blob/master/Manage-CloudSnapshots.ps1) PowerShell.
3. На сервере, на котором запускается скрипт, запустите PowerShell от имени администратора. Запустите скрипт с параметром `-WhatIf $true`, чтобы просмотреть внесенные изменения. Когда проверка будет завершена, передайте параметр `-WhatIf $false`. Выполните следующую команду:
```powershell
.\Manage-CloudSnapshots.ps1 -SubscriptionId [Subscription Id] -TenantId [Tenant ID] -ResourceGroupName [Resource Group Name] -ManagerName [StorSimple Device Manager Name] -DeviceName [device name] -BackupPolicyName [backup policyname] -RetentionInDays [Retention days] -WhatIf [$true or $false]
```
4. Чтобы добавить скрипт в задание архивации, измените дополнительные параметры своего задания Veeam.

    ![Вкладка Scripts (Скрипты) в окне дополнительных параметров архивации Veeam](./media/storsimple-configure-backup-target-using-veeam/veeamimage22.png)

Мы советуем запустить политику архивации облачных моментальных снимков StorSimple в качестве скрипта постобработки по завершении задания ежедневной архивации. Дополнительные сведения об архивации и восстановлении среды приложения архивации в соответствии с RPO и RTO можно получить у архитектора по архивации.

## <a name="storsimple-as-a-restore-source"></a>Использование StorSimple в качестве источника восстановления

Восстановление из устройства StorSimple действует аналогично восстановлению из любого устройства блочного хранилища. Восстановление данных, распределенных по уровням в облаке, выполняется со скоростью облака. Восстановление локальных данных выполняется со скоростью локального диска устройства.

Veeam позволяет выполнять быстрое, точное восстановление на уровне файлов на портале StorSimple с помощью встроенных на консоли Veeam представлений обозревателя. Используйте инструменты Veeam Explorer для восстановления отдельных элементов, таких как сообщения электронной почты, объекты Active Directory и элементы SharePoint, из резервных копий. Восстановление можно выполнять, не прерывая работу локальной виртуальной машины. Кроме того, вы можете выполнять восстановление баз данных SQL Azure и Oracle на определенный момент времени. Veeam и StorSimple упрощают и ускоряют процесс восстановления на уровне элементов из Azure. Дополнительные сведения о выполнении восстановления см. в документации по Veeam:

- для [Exchange Server](https://www.veeam.com/microsoft-exchange-recovery.html);
- для [Active Directory](https://www.veeam.com/microsoft-active-directory-explorer.html);
- для [SQL Server](https://www.veeam.com/microsoft-sql-server-explorer.html);
- для [SharePoint](https://www.veeam.com/microsoft-sharepoint-recovery-explorer.html);
- для [Oracle](https://www.veeam.com/oracle-backup-recovery-explorer.html).


## <a name="storsimple-failover-and-disaster-recovery"></a>Отработка отказа и аварийное восстановление для устройства StorSimple

> [!NOTE]
> Для сценариев с использованием целевого объекта архивации облачное устройство StorSimple не поддерживается в качестве целевого объекта восстановления.

Сбой может быть вызван множеством факторов. В следующей таблице перечислены распространенные сценарии аварийного восстановления.

| Сценарий | Влияние | Восстановление | Примечания |
|---|---|---|---|
| Сбой устройства StorSimple | Операции архивации и восстановления будут прерваны. | Замените неисправное устройство и выполните [отработку отказа и аварийное восстановление StorSimple](storsimple-device-failover-disaster-recovery.md). | Если после восстановления устройства требуется выполнить восстановление, все рабочие наборы данных извлекаются из облака на новое устройство. Все операции будут выполняться со скоростью облака. При повторном сканировании во время индексации и каталогизации все наборы резервных копий будут отсканированы и извлечены из облачного уровня на уровень локального устройства, что может занять много времени. |
| Сбой сервера Veeam | Операции архивации и восстановления будут прерваны. | Создайте сервер архивации повторно и восстановите базу данных, как описано в [технической документации в центре справки Veeam](https://www.veeam.com/documentation-guides-datasheets.html).  | На сайте аварийного восстановления необходимо повторно создать или восстановить сервер Veeam. Восстановите базу данных до последней точки. Если восстановленная база данных Veeam не синхронизирована с последним заданием архивации, требуется индексирование и каталогизация. При повторном сканировании во время индексации и каталогизации все наборы резервных копий будут отсканированы и извлечены из облачного уровня на уровень локального устройства. Поэтому следует учитывать ограничения по времени. |
| Сбой узла, который приводит к потере сервера архивации и StorSimple | Операции архивации и восстановления будут прерваны. | Сначала восстановите StorSimple, а затем — Veeam. | Сначала восстановите StorSimple, а затем — Veeam. Если после восстановления устройства требуется выполнить восстановление, все рабочие наборы данных извлекаются из облака на новое устройство. Все операции будут выполняться со скоростью облака. |


## <a name="references"></a>Ссылки

В этой статье содержатся ссылки на следующие документы:

- [Настройка функции Multipath I/O для устройства StorSimple](storsimple-configure-mpio-windows-server.md)
- [Storage scenarios: Thin provisioning](http://msdn.microsoft.com/library/windows/hardware/dn265487.aspx) (Сценарии хранилища: тонкая подготовка)
- [Using GPT drives](http://msdn.microsoft.com/windows/hardware/gg463524.aspx#EHD) (Использование дисков GPT)
- [Включение и настройка теневых копий общих папок](http://technet.microsoft.com/library/cc771893.aspx)

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как выполнить [восстановление из набора резервных копий](storsimple-restore-from-backup-set-u2.md).
- Узнайте, как выполнить [отработку отказа и аварийное восстановление устройства](storsimple-device-failover-disaster-recovery.md).
