---
title: "Рекомендации по использованию виртуального массива StorSimple | Документация Майкрософт"
description: "В этой статье описываются рекомендации по развертыванию виртуального массива StorSimple и управлению им."
services: storsimple
documentationcenter: NA
author: alkohli
manager: timlt
editor: 
ms.assetid: 57ac6eeb-c47c-442d-a5f4-b360d81a76a6
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/08/2017
ms.author: alkohli
ms.openlocfilehash: 264764c5e9c32574d97beb2cc3c1bb1cfb555568
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="storsimple-virtual-array-best-practices"></a>Рекомендации по использованию виртуального массива StorSimple
## <a name="overview"></a>Обзор
Виртуальный массив Microsoft Azure StorSimple — это интегрированное решение хранилища, которое управляет задачами хранилища на локальном виртуальном устройстве, выполняющемся в низкоуровневой оболочке, и в облачном хранилище Microsoft Azure. Виртуальный массив StorSimple представляет собой эффективную и экономичную альтернативу физическому массиву серии 8000. Его можно запускать в имеющейся инфраструктуре низкоуровневой оболочки. Кроме того, он поддерживает протоколы iSCSI и SMB и хорошо подходит для сценариев, применяемых в удаленных офисах и филиалах. Дополнительные сведения о решениях StorSimple см. в [обзоре решения Microsoft Azure StorSimple](https://www.microsoft.com/en-us/server-cloud/products/storsimple/overview.aspx).

В этой статье приведены рекомендации по виртуальному массиву StorSimple, касающиеся начальной настройки, развертывания и управления. Это проверенные инструкции по настройке виртуального массива и управлению им. Эта статья предназначена для ИТ-администраторов, ответственных за развертывание и контроль виртуальных массивов в центрах данных.

Мы советуем периодически пересматривать эти рекомендации. Так вы сможете обеспечивать соответствие устройства текущим требованиям в случае изменения процедуры настройки или обслуживания. Если у вас возникнут проблемы при реализации этих рекомендаций для виртуального массива, [обратитесь за помощью в службу технической поддержки Майкрософт](storsimple-virtual-array-log-support-ticket.md).

## <a name="configuration-best-practices"></a>Рекомендации по настройке
Здесь приведены рекомендации, которым необходимо следовать во время начальной настройки и развертывания виртуальных массивов. Сюда входят советы относительно подготовки виртуальной машины, настройки параметров групповой политики, сети и учетных записей хранения, а также изменения размера и создания общих папок и томов для виртуального массива. 

### <a name="provisioning"></a>Подготовка
Виртуальный массив StorSimple — это виртуальная машина, подготовленная на низкоуровневой оболочке (Hyper-V или VMware) сервера узла. При подготовке виртуальной машины следует удостовериться, что узел может выделить достаточно ресурсов. Дополнительные сведения см. в разделе с [минимальными требованиями к ресурсам](storsimple-virtual-array-deploy2-provision-hyperv.md#step-1-ensure-that-the-host-system-meets-minimum-virtual-array-requirements) для подготовки массива.

При подготовке виртуального массива следуйте приведенным ниже рекомендациям.

|  | Hyper-V. | VMware |
| --- | --- | --- |
| **Тип виртуальной машины** |**поколения 2** для Windows Server 2012 или более поздней версии и *VHDX* -файла образа. <br></br> **поколения 1** для Windows Server 2008 или более поздней версии и *VHD* -файла образа. |Используйте виртуальную машину версии 8–11 для *VMDK* -файла образа |
| **Тип памяти** |Задайте тип памяти **Статическая**. <br></br> Не используйте параметр **Динамическая память** | |
| **Тип диска данных** |При подготовке настройте диск как **динамически расширяемый**.<br></br> **фиксированного размера** занимает много времени. <br></br> Не используйте параметр **Разностный** . |Используйте параметр **Тонкая подготовка** . |
| **Изменение диска данных** |Расширение и сжатие не допускаются. Попытка сделать это приведет к потере всех локальных данных на устройстве. |Расширение и сжатие не допускаются. Попытка сделать это приведет к потере всех локальных данных на устройстве. |

### <a name="sizing"></a>Определение размера
При планировании размера виртуального массива StorSimple учтите такие факторы:

* Зарезервированное пространство для общих папок или томов на локальном уровне. Примерно 12 % места резервируется на локальном уровне для каждого подготовленного многоуровневого тома или общей папки. Примерно 10 % места резервируется также для локально закрепленного тома для файловой системы.
* Пространство для моментальных снимков. Примерно 15 % пространства на локальном уровне резервируется для моментальных снимков.
* Необходимость в восстановлении. При определении размера следует учитывать пространство, необходимое для восстановления, выполняемого в качестве новой операции. Восстановление выполняется в общий ресурс или на том такого же размера.
* Необходимо выделить некоторый объем пространства на случай непредвиденного роста.

На основе приведенных выше факторов требования к размеру можно представить с помощью следующей формулы:

`Total usable local disk size = (Total provisioned locally pinned volume/share size including space for file system) + (Max (local reservation for a volume/share) for all tiered volumes/share) + (Local reservation for all tiered volumes/shares)`

`Data disk size = Total usable local disk size + Snapshot overhead + buffer for unexpected growth or new share or volume`

Приведенные ниже примеры иллюстрируют, как определить размер для виртуального массива в зависимости от требований.

#### <a name="example-1"></a>Пример 1
На виртуальном массиве необходимо:

* подготовить многоуровневый том или общую папку объемом 2 ТБ;
* подготовить многоуровневый том или общую папку объемом 1 ТБ;
* подготовить локально закрепленный том или общую папку объемом 300 ГБ.

Давайте определим требования к пространству на локальном уровне для приведенных выше томов или общих папок.

Во-первых, локально зарезервированное пространство для каждого многоуровневого тома или общей папки будет составлять 12 % от их размера. Для локально закрепленного тома или общей папки локально зарезервированное пространство составляет 10 % от их размера (помимо подготовленного размера). В этом примере требуется:

* 240 ГБ локально зарезервированного пространства (для многоуровневого тома и общей папки объемом 2 ТБ);
* 120 ГБ локально зарезервированного пространства (для многоуровневого тома и общей папки объемом 1 ТБ);
* 330 ГБ для локально закрепленного тома или общей папки (добавляя 10 % локально зарезервированного пространства к подготовленному размеру в 300 ГБ);

На данный момент общее пространство, требуемое на локальном уровне, составляет 690 ГБ (240 + 120 + 330 ГБ).

Во-вторых, на локальном уровне понадобится дополнительное пространство, соответствующее наибольшему зарезервированному пространству или превышающее его. Этот дополнительный объем резервируется на случай, если потребуется выполнить восстановление из облачного моментального снимка. В этом примере наибольшее локально зарезервированное пространство составляет 330 ГБ (включая пространство для файловой системы). Этот объем и нужно добавить к 690 ГБ. Таким образом, мы получаем 1020 ГБ (690 + 330 ГБ).
После выполнения дополнительных операций восстановления можно освободить пространство, удалив данные предыдущей операции восстановления.

В-третьих, на данном этапе нам нужно 15 % от общего локального пространства для хранения локальных моментальных снимков, так что доступными остаются только 85 %. В этом примере это составит около 1020 ГБ — 0,85&ast; ТБ на подготовленном диске данных. Таким образом, объем подготовленного диска данных будет равен 1200 ГБ (1020 &ast; (1/0,85)), т. е. примерно 1,20–1,25 ТБ (округление к наиболее близкому значению квартиля).

Учитывая возможность непредвиденного роста и дополнительные операции восстановления, следует подготовить локальный диск емкостью примерно 1,25–1,5 ТБ.

> [!NOTE]
> Кроме того, рекомендуется применять к локальному диску метод тонкой подготовки. Это связано с тем, что место для восстановления требуется только в случае, если необходимо восстановить данные, хранящиеся дольше пяти дней. Восстановление на уровне элементов позволяет восстановить данные за последние пять дней, при этом не нужно дополнительное место.


#### <a name="example-2"></a>Пример 2
На виртуальном массиве необходимо:

* подготовить многоуровневый том объемом 2 ТБ;
* подготовить локально закрепленный том объемом 300 ГБ.

Так как 12 % локального пространства зарезервировано для многоуровневых томов и общих папок, а 10 % — для локально закрепленных томов и общих папок, нам понадобится:

* 240 ГБ локально зарезервированного пространства (для многоуровневого тома и общей папки объемом 2 ТБ);
* 330 ГБ для локально закрепленного тома или общей папки (добавляя 10 % локально резервированного пространства к подготовленному пространству в 300 ГБ);

Общее пространство, требуемое на локальном уровне, составляет 570 ГБ (240 + 330 ГБ).

Минимальное локальное пространство, необходимое для восстановления, составляет 330 ГБ.

15 % от общего места на диске используется для хранения моментальных снимков, поэтому доступно только 0,85 объема. Таким образом, размер диска составляет примерно 1,06–1,25 ТБ (900 &ast; (1/0,85)) (с округлением к ближайшему квартилю).

Учитывая непредвиденный рост, можно подготовить локальный диск объемом 1,25–1,5 ТБ.

### <a name="group-policy"></a>Групповая политика
Групповая политика — это инфраструктура, которая позволяет реализовать определенные настройки для пользователей и компьютеров. Параметры групповой политики содержатся в объектах групповой политики, которые связаны с такими контейнерами доменных служб Active Directory (AD DS): сайты, домены и подразделения. 

Если виртуальный массив присоединен к домену, к нему можно применить объекты групповой политики. Эти объекты могут устанавливать приложения, например антивирусные программы, что может отрицательно сказаться на работе виртуального массива StorSimple.

Поэтому следует учитывать следующие рекомендации:

* Убедитесь, что виртуальный массив находится в собственном подразделении Active Directory.
* Убедитесь, что к виртуальному массиву не применяются какие-либо объекты групповой политики. Для виртуального массива (дочерний узел) можно заблокировать наследование, чтобы предотвратить автоматическое наследование объектов групповой политики от родительского узла. Дополнительные сведения см. в статье [Блокирование наследования](https://technet.microsoft.com/library/cc731076.aspx).

### <a name="networking"></a>Сеть
Настройка сети виртуального массива осуществляется с помощью локального веб-интерфейса. Виртуальный сетевой интерфейс предоставляется в низкоуровневой оболочке, где подготовлен виртуальный массив. На странице [Параметры сети](storsimple-virtual-array-deploy3-fs-setup.md) можно настроить IP-адрес, подсеть и шлюз для этого сетевого интерфейса.  Можно также настроить основной и дополнительный DNS-серверы, параметры времени и необязательные параметры прокси-сервера для вашего устройства. Большую часть параметров сети можно настроить только один раз. Прежде чем развернуть виртуальный массив, ознакомьтесь с [требованиями к сети для StorSimple](storsimple-ova-system-requirements.md#networking-requirements) .

При развертывании виртуального массива нужно следовать таким рекомендациям:

* Сеть, в которой развертывается виртуальный массив, должна постоянно обеспечивать интернет-канал с пропускной способностью не менее 5 Мбит/с.
  
  * Требования к пропускной способности зависят от особенностей рабочей нагрузки и скорости изменения данных.
  * Изменение данных, которое можно обработать, прямо пропорционально пропускной способности интернет-канала. Например, при создании резервной копии интернет-канал с пропускной способностью 5 Мбит/с позволяет выполнить операцию изменения данных объемом 18 ГБ за 8 часов. Если пропускная способность будет выше в четыре раза (20 Мбит/с), можно будет обработать изменение данных с четырехкратным объемом (72 ГБ).
* Обязательно наличие постоянного подключения к Интернету. Прерывающееся или ненадежное подключение к Интернету на устройствах может привести к потере доступа к данным в облаке и к неподдерживаемой конфигурации.
* Если планируется развернуть устройство в качестве сервера iSCSI:
  
  * Рекомендуется отключить параметр **Получить IP-адрес автоматически** (DHCP).
  * Настройте статические IP-адреса. Необходимо настроить основной и дополнительный DNS-серверы.
  * При определении нескольких сетевых интерфейсов в виртуальном массиве учтите, что только первый сетевой интерфейс (по умолчанию — **Ethernet**) имеет доступ к облаку. Чтобы управлять типом трафика, в виртуальном массиве (настроенном в качестве сервера iSCSI) необходимо создать несколько виртуальных сетевых интерфейсов и подключить их к различным подсетям.
* Для регулировки пропускной способности облака (используемой виртуальным массивом) соответствующие настройки необходимо задать в параметрах маршрутизатора или брандмауэра. Если настроить регулирование в параметрах низкоуровневой оболочки, будет регулироваться не только пропускная способность облака, но и все протоколы, включая iSCSI и SMB.
* Включите синхронизацию времени для низкоуровневых оболочек. При использовании Hyper-V необходимо выбрать виртуальный массив в диспетчере Hyper-V, щелкнуть **Параметры &gt; Службы интеграции** и установить флажок **Синхронизация времени**.

### <a name="storage-accounts"></a>учетные записи хранения;
Виртуальный массив StorSimple можно связать с одной учетной записью хранения. Это может быть автоматически созданная учетная запись хранения, учетная запись в той же подписке, что и служба, и учетная запись хранения, связанная с другой подпиской. Дополнительные сведения см. в статье [Управление учетными записями хранения для виртуального массива StorSimple с помощью службы диспетчера StorSimple](storsimple-virtual-array-manage-storage-accounts.md).

Следуйте рекомендациям ниже для учетных записей хранения, связанных с виртуальным массивом.

* При связывании нескольких виртуальных массивов с одной учетной записью следует учитывать максимальную емкость виртуальных массивов (64 ТБ) и максимальный размер учетной записи хранения (500 ТБ). Таким образом, число полноразмерных виртуальных массивов, которые можно связать с этой учетной записью хранения, равно 7.
* При создании учетной записи хранения учитывайте следующее:
  
  * Для минимизации задержек рекомендуется создать учетную запись в регионе, который ближе всего к удаленному офису или филиалу, где развернут виртуальный массив StorSimple.
  * Обратите внимание, что учетные записи хранения нельзя переносить из одного региона в другой. То же самое касается переноса службы в другую подписку.
  * Используйте учетную запись хранения, которая обеспечивает избыточность между центрами обработки данных. Для виртуального массива можно использовать геоизбыточное хранилище (GRS), хранилище, избыточное в пределах зоны, (ZRS) и локально избыточное хранилище (LRS). Дополнительные сведения о различных типах учетных записей хранения см. в статье [Репликация службы хранилища Azure](../storage/common/storage-redundancy.md).

### <a name="shares-and-volumes"></a>Общие папки и тома
Общие папки для виртуального массива StorSimple можно подготовить, если он настроен как файловый сервер, а тома — если он настроен как сервер iSCSI. Рекомендации, которые следует учитывать при создании общих папок и томов, касаются размера и типа.

#### <a name="volumeshare-size"></a>Размер томов и общих папок
Общие папки для виртуального массива можно подготовить, если он настроен как файловый сервер, а для тома — если он настроен как сервер iSCSI. Рекомендации, которые следует учитывать при создании общих папок и томов, касаются размера и типа. 

При подготовке общих папок или томов на виртуальном устройстве примите во внимание следующее:

* Размер файлов относительно размера подготовленной многоуровневой общей папки может влиять на производительность распределения по уровням. Иногда при работе с большими файлами распределение по уровням выполняется очень медленно. При работе с файлами большого размера рекомендуется, чтобы размер самого большого файла составлял не более 3 % от размера общей папки.
* На виртуальном массиве можно создать не более 16 томов или общих папок. Сведения об ограничении размера локально закрепленных многоуровневых томов и общих ресурсов см. в статье об [ограничениях виртуальных массивов StorSimple](storsimple-ova-limits.md).
* При создании тома следует учитывать уровень ожидаемого использования данных, а также будущий рост. Расширить том будет невозможно.
* После создания тома на устройстве StorSimple его размер нельзя уменьшить.
* Когда многоуровневый том на устройстве StorSimple, на который выполняется запись, достигает определенного порогового значения объема (по отношению к локальному пространству, зарезервированному для тома), начинается регулирование операций ввода-вывода. Если продолжить запись на этот том, скорость ввода-вывода значительно снизится. Хотя вы можете продолжить запись на многоуровневый том после превышения подготовленной емкости (мы не блокируем запись в таком случае), появится оповещение о том, что лимит по подписке превышен. Как только вы увидите это оповещение, необходимо принять меры по исправлению, например удалить данные на томе (в настоящее время расширение тома не поддерживается).
* Что касается случаев аварийного восстановления, то их количество не влияет на целевую точку и целевое время восстановления, так как допустимое число общих папок или томов равно 16 и максимальное число общих папок или томов, которые могут обрабатываться параллельно, тоже 16.

#### <a name="volumeshare-type"></a>Тип томов и общих папок
StorSimple поддерживает два типа томов и общих папок в зависимости от использования: локально закрепленные и многоуровневые. Для локально закрепленных томов и общих папок выполняется фиксированная подготовка, а для многоуровневых томов и общих папок — тонкая подготовка. После создания локально закрепленного тома или общей папки их уже невозможно преобразовать в многоуровневые или *наоборот*.

При настройке томов или общих папок StorSimple следует учитывать приведенные ниже рекомендации.

* Перед созданием определите тип тома в зависимости от рабочих нагрузок, которые планируется развернуть. Локально закрепленные тома подходят для рабочих нагрузок, данные для которых должны все время быть доступными локально (даже при сбое в облаке) и которые требуют низкой задержки в облаке. После создания тома в виртуальном массиве его тип нельзя изменить с локально закрепленного на многоуровневый и *наоборот*. Например, локально закрепленные тома следует использовать при развертывании рабочих нагрузок SQL или размещении виртуальных машин, а многоуровневые тома — для рабочих нагрузок файловых ресурсов.
* При работе с файлами большого размера следует выбрать параметр для не слишком часто используемых архивных данных. Если выбран этот параметр, для ускорения передачи данных в облако используется блок дедупликации размером 512 КБ.

#### <a name="volume-format"></a>Формат тома
После создания томов StorSimple на сервере iSCSI их необходимо инициализировать, подключить и отформатировать. Эта операция выполняется на узле, подключенном к устройству StorSimple. При подключении и форматировании томов на узле StorSimple следует учитывать приведенные ниже советы и рекомендации.

* Выполняйте для всех томов StorSimple быстрое форматирование.
* При форматировании тома StorSimple рекомендуемый размер единицы выделения — 64 КБ (размер по умолчанию — 4 КБ). Этот размер выбран в результате тестирования, выполненного с использованием распространенных рабочих нагрузок StorSimple, а также других рабочих нагрузок.
* В виртуальном массиве StorSimple, настроенном в качестве сервера iSCSI, не следует использовать составные тома или динамические диски, так как они не поддерживаются.

#### <a name="share-access"></a>Общий доступ
При создании общих папок на виртуальном массиве, настроенном в качестве файлового сервера, следует придерживаться приведенных ниже рекомендаций.

* При создании общей папки настройте администраторские права не для одного пользователя, а для группы пользователей.
* После создания общей папки можно управлять разрешениями NTFS с помощью проводника Windows.

#### <a name="volume-access"></a>Доступ к тому
При настройке томов iSCSI на виртуальном массиве StorSimple необходимо позаботиться об управлении доступом. Чтобы определить, какие серверы узлов могут получать доступ к томам, создайте и свяжите записи контроля доступа (ACR) с томами StorSimple.

При настройке записей контроля доступа для томов StorSimple учитывайте следующие рекомендации:

* Всегда связывайте с томом по крайней мере одну запись контроля доступа.

* При назначении тому нескольких записей контроля доступа убедитесь, что доступ к тому не могут получить одновременно несколько некластеризованных узлов. Если тому назначено несколько записей контроля доступа, отобразится сообщение с предупреждением о проверке конфигурации.

### <a name="data-security-and-encryption"></a>Шифрование и обеспечение защиты данных
Виртуальный массив StorSimple содержит функции шифрования и обеспечения защиты данных, которые гарантируют конфиденциальность и целостность данных. При использовании этих функций следует учитывать приведенные ниже рекомендации. 

* Определите ключ шифрования облачного хранилища для использования алгоритма шифрования AES-256 перед отправкой данных из вашего виртуального массива в облако. Этот ключ не требуется, если данные изначально зашифрованы. Для формирования и хранения ключа в безопасном месте можно использовать систему управления ключами, например [хранилище ключей Azure](../key-vault/key-vault-whatis.md).
* При настройке учетной записи хранения с помощью службы диспетчера StorSimple необходимо включить режим SSL, чтобы создать безопасный канал для обмена данными между устройством StorSimple и облаком по сети.
* Периодически следует повторно создавать ключи для учетных записей хранения (с помощью службы хранилища Azure), чтобы обеспечить отражение любых изменений доступа в связи с изменением списка администраторов.
* Перед отправкой в Azure данные на виртуальном массиве подвергаются сжатию и дедупликации. Мы не рекомендуем использовать службу роли дедупликации данных на узле Windows Server.

## <a name="operational-best-practices"></a>Рекомендации по использованию
Рекомендаций, приведенных в этом разделе, следует придерживаться при управлении виртуальным массивом и его повседневном использовании. Сюда относятся определенные задачи управления, например создание резервных копий, восстановление из набора архивации, выполнение отработки отказа, отключение и удаление массива, мониторинг использования и состояния работоспособности системы, а также проверка виртуального массива на вирусы.

### <a name="backups"></a>Резервные копии
Для данных на виртуальном массиве можно осуществлять резервное копирование в облако двумя способами: с помощью автоматической ежедневной архивации данных всего устройства по умолчанию, которая начинается в 22:30, или архивации вручную по требованию. По умолчанию устройство ежедневно автоматически создает облачные моментальные снимки всех хранящихся на нем данных. Дополнительные сведения см. в статье [Резервное копирование виртуального массива StorSimple (предварительная версия)](storsimple-virtual-array-backup.md).

Частоту создания и срок хранения резервных копий по умолчанию изменить нельзя, однако можно настроить время начала ежедневной архивации. При настройке времени начала автоматической архивации нужно следовать приведенным ниже рекомендациям.

* Планируйте архивацию на часы наименьшей нагрузки. Время начала резервного копирования не должно совпадать с периодом интенсивных рабочих нагрузок ввода-вывода на узле.
* Чтобы защитить данные на виртуальном массиве, при планировании отработки отказа устройства или перед периодом обслуживания следует инициировать ручную архивацию по требованию.

### <a name="restore"></a>Восстановление
Выполнить восстановление из набора архивации можно двумя способами: восстановить в другой том или общую папку или выполнить восстановление на уровне элементов (если виртуальный массив настроен в качестве файлового сервера). Восстановление на уровне элементов позволяет выполнять фрагментарное восстановление файлов и папок из облачной резервной копии всех общих папок на устройстве StorSimple. Дополнительные сведения см. в статье [Восстановление из резервной копии виртуального массива StorSimple (предварительная версия)](storsimple-virtual-array-clone.md).

При выполнении восстановления учитывайте следующие рекомендации:

* Виртуальный массив StorSimple не поддерживает восстановление на месте. Однако такое восстановление можно выполнить в два этапа: освободите место на виртуальном массиве и выполните восстановление на другой том или в другую общую папку.
* Восстановление из локального тома — длительная операция. Хотя том может быстро перейти в оперативный режим, расконсервация данных еще будет выполняться в фоновом режиме.
* Тип тома не изменяется в процессе восстановления. Многоуровневый том будет восстановлен в многоуровневый том, а локально закрепленный том — в локально закрепленный.
* Если при попытке восстановить том или общую папку из набора архивации происходит сбой задания восстановления, на портале все равно может быть создан целевой том или общая папка. Важно удалить этот неиспользуемый целевой том или общую папку на портале, чтобы свести к минимуму проблемы, которые могут возникнуть из-за этого элемента.

### <a name="failover-and-disaster-recovery"></a>Отработка отказа и аварийное восстановление
Отработка отказа для устройства позволяет перенести данные c *исходного* устройства в центре обработки данных на *целевое* устройство, которое находится в том же или другом географическом расположении. Отработка отказа выполняется для всего устройства. При отработке отказа изменяется владелец облачных данных. После переноса они будут принадлежать владельцу целевого устройства.

Для виртуального массива StorSimple можно выполнить отработку отказа на другой виртуальный массив, управляемый той же службой диспетчера StorSimple. Отработка отказа на устройство серии 8000 или массив, управляемый другой службой диспетчера StorSimple (в сравнении с исходным устройством), не разрешена. Дополнительные рекомендации по отработке отказа см. в статье [Аварийное восстановление и отработка отказа устройства для виртуального массива StorSimple](storsimple-virtual-array-failover-dr.md).

При выполнении отработки отказа для виртуального массива нужно учитывать следующее:

* Перед плановой отработкой отказа рекомендуется перевести все тома и общие папки в автономный режим. Следуйте инструкциям для конкретной операционной системы и переведите в автономный режим тома и общие папки сначала на узле, а затем на виртуальном устройстве.
* При аварийном восстановлении файлового сервера рекомендуется присоединить целевое устройство к тому же домену, на котором находится исходное устройство. Это предотвратит конфликт разрешений общих папок. В этом выпуске поддерживается отработка отказа с переносом только в целевое устройство в том же домене.
* После успешного завершения аварийного восстановления исходное устройство будет автоматически удалено. Хотя устройство больше недоступно, виртуальная машина, подготовленная в главной системе, по-прежнему потребляет ресурсы. Рекомендуется удалить эту виртуальную машину из главной системы, чтобы избежать начисления платы.
* Обратите внимание, что даже если отработка отказа завершилась неудачно, **данные остаются сохраненными в облаке**. Рассмотрим следующие три сценария, в которых отработка отказа завершилась неудачно:
  
  * Сбой произошел на начальной стадии отработки отказа, например при выполнении предварительных проверок для аварийного восстановления. В этом случае целевое устройство все еще можно использовать. Можно повторить попытку выполнить отработку отказа на том же целевом устройстве.
  * Сбой произошел во время фактического перехода на другой ресурс. В этом случае целевое устройство помечается как непригодное для использования. Необходимо подготовить и настроить для отработки отказа другой целевой виртуальный массив.
  * Отработка отказа завершена, в результате чего исходное устройство было удалено, но с целевым устройством возникли проблемы и вы не можете получить доступ к данным. Данные по-прежнему безопасно сохранены в облаке, и их можно с легкостью получить, создав другой виртуальный массив и использовав его в качестве целевого устройства для аварийного восстановления.

### <a name="deactivate"></a>Отключение
При отключении виртуального массива StorSimple вы разрываете подключение между устройством и соответствующей службой диспетчера StorSimple. Отключение является **необратимой** операцией. Отключенное устройство нельзя зарегистрировать в службе диспетчера StorSimple повторно. Дополнительные сведения см. в статье [Отключение и удаление устройства StorSimple](storsimple-virtual-array-deactivate-and-delete-device.md).

При отключении виртуального массива необходимо учитывать следующие рекомендации:

* Прежде чем отключать виртуальное устройство, сделайте облачный моментальный снимок всех данных. При отключении виртуального массива все локальные данные устройства теряются. С помощью моментального снимка облака вы сможете восстановить все данные в дальнейшем.
* Перед отключением виртуального массива StorSimple обязательно удалите зависящие от него клиенты и узлы или остановите их работу.
* Если отключенное устройство больше не используется, удалите его, чтобы с вас не взималась плата.

### <a name="monitoring"></a>Мониторинг
Чтобы гарантировать постоянное работоспособное состояние виртуального массива StorSimple, необходимо выполнять его мониторинг и следить за получением сведений из системы, в том числе оповещений. Для мониторинга общей работоспособности виртуального массива необходимо следовать приведенным ниже рекомендациям.

* Настройте мониторинг для отслеживания использования диска операционной системы и диска данных виртуального массива. При использовании Hyper-V для мониторинга узлов виртуализации можно совместно использовать System Center Virtual Machine Manager и System Center Operations Manager.
* Настройте отправку уведомлений по электронной почте при достижении определенных уровней использования виртуального массива.                                                                                                                                                                                                

### <a name="index-search-and-virus-scan-applications"></a>Приложения поиска по индексу и проверки на вирусы
Виртуальный массив StorSimple может автоматически перемещать данные из локального уровня на уровень облака Microsoft Azure. При использовании приложения поиска по индексу или проверки на вирусы для данных, хранящихся на устройстве StorSimple, необходимо позаботиться о том, чтобы к данным в облаке не было доступа и они не могли быть перемещены обратно на локальный уровень.

При настройке поиска по индексу и проверки на вирусы на виртуальном массиве нужно следовать приведенным ниже рекомендациям.

* Отключите все автоматически настроенные операции полной проверки.
* На многоуровневых томах настройте в приложениях поиска по индексу и проверки на вирусы выполнение добавочного сканирования. Таким образом, будут проверяться только новые данные, которые, скорее всего, расположены на локальном уровне. Во время операции добавочного сканирования данные, перемещенные в облако, недоступны.
* Настройте подходящие фильтры и параметры поиска, чтобы проверялись только нужные типы файлов. Например, изображения (JPEG, GIF и TIFF) и чертежи не следует проверять во время добавочного или полного перестроения индекса.

Если используется индексирование Windows, придерживайтесь следующих рекомендаций.

* Не используйте индексатор Windows для многоуровневых томов. Если индекс нужно часто перестраивать, из облака перемещаются большие объемы данных (измеряемые в ТБ). При перестроении индекса файлы всех типов извлекаются для индексирования их содержимого.
* Индексирование Windows можно использовать для локально закрепленных томов, так как при этом для создания индекса используются данные только на локальных уровнях (облачные данные не затрагиваются).

### <a name="byte-range-locking"></a>Блокировка диапазона байтов
Приложения могут блокировать заданный диапазон байтов в файлах. Если блокировка диапазона байтов включена в приложениях, которые осуществляют запись в StorSimple, распределение по уровням в виртуальном массиве не работает. Для распределения по уровням все области файлов, к которым осуществляется доступ, должны быть разблокированы. Блокировка диапазона байтов не поддерживается для многоуровневых томов на виртуальном массиве.

Ниже приведены рекомендации, позволяющие обойти блокировку диапазона байтов.

* Отключите блокировку диапазона байтов в логике приложения.
* Используйте локально закрепленные тома (вместо многоуровневых) для данных, связанных с этим приложением. Данные локально закрепленных томов не перемещаются в облако.
* Если при использовании локально закрепленных томов включена блокировка диапазона байтов, том может перейти в оперативный режим до завершения восстановления. В таком случае необходимо дождаться завершения восстановления.

## <a name="multiple-arrays"></a>Несколько массивов
Чтобы предупредить рост рабочего набора данных, которые могут быть перенесены в облако, что приведет к ухудшению производительности устройства, может потребоваться развернуть несколько виртуальных массивов. В таких случаях лучше всего масштабировать устройства по мере роста рабочего набора. Для этого требуется добавить одно или несколько устройств в локальный центр обработки данных. При добавлении этих устройств можно выполнить следующее:

* Разделить текущий набор данных.
* Развернуть новые рабочие нагрузки для новых устройств.
* При развертывании нескольких виртуальных массивов с точки зрения балансировки нагрузки рекомендуется распределить массив между разными узлами низкоуровневой оболочки.
* В пространстве имен распределенной файловой системы можно развернуть несколько виртуальных массивов (настроенных в качестве файлового сервера или сервера iSCSI). Подробные указания см. в [руководстве по развертыванию пространства имен распределенной файловой системы с помощью гибридного облачного хранилища](https://www.microsoft.com/download/details.aspx?id=45507). В настоящее время для виртуального массива не рекомендуется применять репликацию распределенной файловой системы. 

## <a name="see-also"></a>Дополнительные материалы
Узнайте, как [администрировать виртуальный массив StorSimple](storsimple-virtual-array-manager-service-administration.md) с помощью службы диспетчера StorSimple.

