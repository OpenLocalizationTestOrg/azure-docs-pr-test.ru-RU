---
title: "aaaAzure концентраторы уведомлений - инструкций диагностики"
description: "Рекомендации по как toodiagnose распространенные проблемы с концентраторами уведомлений Azure."
services: notification-hubs
documentationcenter: Mobile
author: ysxu
manager: erikre
editor: 
ms.assetid: b5c89a2a-63b8-46d2-bbed-924f5a4cce61
ms.service: notification-hubs
ms.workload: mobile
ms.tgt_pltfrm: NA
ms.devlang: multiple
ms.topic: article
ms.date: 10/03/2016
ms.author: yuaxu
ms.openlocfilehash: e374278f2bfdfad36ba091e8846059cd184c17ef
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-notification-hubs---diagnosis-guidelines"></a>Центры уведомлений Azure — рекомендации по диагностике
## <a name="overview"></a>Обзор
Один из наиболее распространенных вопросов hello получаем от клиентов концентраторов уведомлений Azure — как toofigure, они не видят уведомлений, отправленных из их внутренняя служба приложения должны отображаться на клиентском устройстве hello - где и почему уведомления о были удалены и как toofix это. В этой статье мы рассмотрим hello различных причин, почему уведомлений, возможно получение, удален или не попадут в устройствах hello. Мы также рассмотрим способами, в котором можно анализировать и выявить основную причину hello. 

Во-первых Это критическое toounderstand как концентраторы уведомлений Azure применяет уведомления toohello устройств.
![][0]

В потоке типичные отправить уведомление отправляется приветственное сообщение hello **внутренняя служба приложения** слишком**концентратор уведомлений Azure (NH)** которой в свою очередь выполняет некоторую обработку для всех регистраций hello, учитывая hello учетная запись настроена теги & toodetermine выражения тег «цели» т. е. все регистрации hello, требующих tooreceive hello push-уведомлений. Эти операции регистрации могут распространяться на любые из поддерживаемых нами платформ - iOS, Google, Windows, Windows Phone, Kindle и Baidu для China Android. После установления hello целевые объекты NH отправлений уведомлений, а затем разбиты на несколько пакета регистрации, конкретной платформе устройства toohello **службы Push-уведомлений (PNS)** -например, APNS для Apple, GCM для Google и т. д. Выполняет проверку подлинности NH с hello соответствующих PNS на основании hello учетные данные, заданные в hello классический портал Azure на странице приветствия Настройка концентратора уведомлений. Hello PNS пересылает hello уведомления toohello соответствующих **клиентских устройств**. Это платформа hello рекомендованные способом toodeliver push-уведомлений и обратите внимание, что заключительный сегмент hello доставки уведомлений производится между hello платформы PNS и hello устройства. Таким образом, у нас есть четыре основных компонента: *клиент*, *серверная часть приложения*, *центры уведомлений Azure* и *службы push-уведомлений (PNS)*, и любой из этих компонентов может стать причиной удаления уведомлений. Дополнительные сведения об этой архитектуре см. в статье [Центры уведомлений Azure].

Toodeliver сбой уведомления могло произойти во время начального приветствия, что тест или промежуточный этап, который может указывать на проблемы конфигурации или он может произойти в рабочей среде, где все или некоторые из hello уведомления могут быть разрываются, указывающее, какое-либо приложение более глубокого или проблема шаблон обмена сообщениями. В разделе "hello" ниже мы рассмотрим различные сценарии удаленного уведомления от общих toohello реже вид, некоторые из которых, возможно очевидным и другие не так много. 

## <a name="azure-notifications-hub-mis-configuration"></a>Неправильная настройка центров уведомлений Azure
Концентраторы уведомлений Azure должен tooauthenticate себя в контексте hello объекта hello разработчик приложения toobe toosuccessfully может отправить уведомления toohello соответствующих PNS. Это стало возможным создание учетной записи разработчика с hello соответствующей платформы (Google, Apple, Windows и т. д.) и регистрации своих приложений, где они получить учетные данные, которым требуется toobe настроены на портале hello в области уведомлений разработчиком hello Раздел конфигурации концентраторов. Если нет уведомлений, производимых через сначала должен быть tooensure, что hello правильные учетные данные настраиваются в концентратор уведомлений, сопоставление их с приложением hello hello создан их учетной записи конкретного разработчика платформы. Вы найдете нашей [учебными руководствами для начинающих] полезно toogo на этот процесс в виде шаг за шагом. Ниже приведены некоторые распространенные сценарии неправильной настройки.

1. **Общие сведения**
   
    ) убедитесь том, что имя концентратора уведомлений (без опечаток) hello же:
   
   * Где вы регистрируете в клиенте hello 
   * Где выполняется отправка уведомлений с серверной hello  
   * Когда вы настроили учетные данные PNS hello и 
   * Учетные данные которого SAS, настроенные на hello клиента и hello серверной части. 
     
     б) создание, необходимо использовать hello правильных строк конфигурации SAS на клиенте hello и внутренняя служба приложения hello. Как правило, необходимо использовать hello **DefaultListenSharedAccessSignature** на клиенте hello и **DefaultFullSharedAccessSignature** серверную часть приложения hello (который предоставляет разрешение toobe toohello уведомление может toosend NH)
2. **Конфигурация службы push-уведомлений Apple (APNS)**
   
    Необходимо использовать два разных центра - один для рабочей среды и другой для тестирования. Это означает, что Загрузка сертификата hello, которые будут toouse в концентратора отдельной tooa среда "песочницы" и hello сертификатов, которые будут toouse в отдельном концентраторе tooa рабочей. Не предпринимайте tooupload различных типов сертификатов toohello одном концентраторе, как это может привести к потере уведомления строку hello вниз. Если вы находитесь в позицию, где вы случайно отправили различных типов сертификатов toohello одном концентраторе рекомендуется toodelete hello концентратора и запуск нового. Если по некоторым причинам вы не концентратора hello toodelete может затем во hello бы очень, необходимо удалить все существующие регистрации hello hello концентратора. 
3. **Конфигурация Google Cloud Messaging (GCM)** 
   
    а. Убедитесь, что в облачном проекте включен параметр "Google Cloud Messaging для Android". 
   
    ![][2]
   
    (б) Создание необходимо создать «Ключ сервера» при получении учетных данных hello какие NH, будет использовать tooauthenticate GCM. 
   
    ![][3]
   
    c) убедитесь, что настройки «Идентификатор проекта» на приветствия клиента, который является полностью числовые сущности, которую можно получить из панели мониторинга hello:
   
    ![][1]

## <a name="application-issues"></a>Проблемы с приложением
1) **Теги и выражения тегов**

При использовании тегов или тег выражения toosegment аудиторию, это всегда возможно, что при отправке уведомления hello существует, цель не найден на основе выражений теги или тег hello, который вы указываете при выполнении отправки вызова. Проще всего tooreview вашей tooensure регистрации отсутствуют теги какие совпадения при отправке уведомления и затем проверьте hello уведомление о доставке только от клиентов hello с регистрации. Например:  Если ваши регистрации с NH были сделать с помощью утверждают тег «Политика» и отправке уведомлений с тегом «Спортивных», оно не будет отправлено tooany устройства. В более сложном случае могут использоваться выражения тегов. Например, вы выполнили регистрацию, указав «Тег A» или «Тег Б», но во время отправки уведомлений используете «Тег А && тег Б». В hello самостоятельно диагностировать советы ниже, существуют способы, в котором можно просмотреть ваши регистрации вместе с hello теги, которые имеют. 

2) **Проблемы с шаблонами**

Если используются шаблоны, а затем убедитесь, что вы следуете hello, описанным в [руководство шаблона]. 

3) **Недопустимые регистрации**

Предположим, что hello концентратора уведомлений настроена правильно и все выражения тегов или тег использовались правильно в результате чего поиска hello допустимых целевых объектов toowhich hello уведомлений требуется toobe отправлено, NH запускает несколько пакетов обработки параллельно - каждого пакета Отправка сообщений tooa набора регистраций. 

> [!NOTE]
> Поскольку мы hello обработке параллельно, мы не гарантируют какие hello доставить уведомления о порядке hello. 
> 
> 

Теперь центр уведомлений Azure оптимизирован для модели доставки сообщений «не более одного». Это означает, что мы будем стараться удаления дубликатов, чтобы не доставляются уведомления более одного раза tooa устройства. tooensure это мы просмотрите регистраций hello и убедитесь в том, что только одно сообщение отправляется через каждый идентификатор устройства, прежде чем фактически отправку toohello сообщение hello PNS. Каждый пакет отправляется toohello PNS, который в свою очередь принимает и проверки регистрации hello, возможна ситуация, hello PNS обнаруживает ошибку с одним или несколькими регистраций hello в пакете, возвращает ошибки tooAzure NH и останавливает обработку таким образом, удаление пакетные полностью. Это касается в особенности APNS, которая использует протокол потока TCP. Несмотря на то, что мы оптимизированы для большинства на один раз доставки, в этом случае мы удаляем hello сбоя регистрации из нашей базу данных, а затем повторите попытку доставки уведомлений для hello rest hello устройств в пакете.

Можно получить сведения об ошибке для сбоя доставки hello попытка регистрации, с помощью API-интерфейсов REST концентраторов уведомлений Azure hello: [каждого сообщения телеметрии: получение телеметрии сообщения уведомления](https://msdn.microsoft.com/library/azure/mt608135.aspx) и [PNS отзывы](https://msdn.microsoft.com/library/azure/mt705560.aspx). В разделе hello [SendRESTExample](https://github.com/Azure/azure-notificationhubs-samples/tree/master/dotnet/SendRestExample) пример кода.

## <a name="pns-issues"></a>Проблемы со службой PNS
Получено сообщение hello уведомления, соответствующих hello PNS, то оно после его ответственности toodeliver hello toohello устройства создания уведомлений. Концентраторы уведомлений Azure находится за пределами рисунок hello и не может управлять при или если hello уведомление будет доставлено устройства toohello toobe. Поскольку службы уведомлений платформы hello довольно надежным, уведомления, как правило, tooreach hello устройств через несколько секунд из hello PNS. Если hello PNS Однако регулирует концентраторов уведомлений Azure применяются экспоненциальной стратегии и если hello PNS по-прежнему недоступен в течение 30 минут у нас есть политики в поместите tooexpire и удалять эти сообщения без возможности восстановления. 

Если PNS пытается toodeliver уведомление, но hello устройство находится в автономном режиме, уведомление hello хранимых hello PNS для ограниченного периода времени и доставить toohello устройства, когда они станут доступны. Хранится только одно последнее уведомление для конкретного приложения. Если несколько уведомления отправляются в том случае, когда устройство hello отключен от сети, каждый новое уведомление приводит hello предварительного уведомления toobe отменены. Такое поведение поддерживать уведомления hello новейшие является ссылка tooas объединение уведомления в APNS и свертывание в GCM (с использованием свертываемых ключ). Если устройство hello остается в автономном режиме в течение долгого времени, уведомления, сохраненные для него будут удалены. Источник — [руководство по APNS] и  & [руководство по GCM].

С концентраторы уведомлений Azure - объединяющую ключ можно передать через HTTP-заголовка, с помощью универсального hello `SendNotification` API (например, для пакета SDK для .NET — `SendNotificationAsync`) принимающий заголовки HTTP, которые передаются как является toohello соответствующих PNS. 

## <a name="self-diagnose-tips"></a>Советы по самостоятельной диагностике
Здесь мы рассмотрим hello различные toodiagnose пути и корневого вызвать проблемы концентратора уведомлений:

### <a name="verify-credentials"></a>Проверка учетных данных
1. **Портал разработчиков PNS**
   
    Проверить их на hello соответствующих PNS разработчика портала (APNS, GCM, WNS и т. д) с помощью наших [учебными руководствами для начинающих].
2. **Классический портал Azure**
   
    Перейдите на вкладку tooreview toohello Настройка и совпадают с идентификаторами, полученными с портала разработчиков PNS hello hello учетные данные. 
   
    ![][4]

### <a name="verify-registrations"></a>Проверка регистраций
1. **Visual Studio**
   
    При использовании Visual Studio для разработки можно подключения tooMicrosoft Azure и просмотр и управление множество служб Azure, включая центр уведомлений из «Обозревателя серверов». Это особенно удобно при работе в среде разработки или тестирования. 
   
    ![][9]
   
    Можно просматривать и управлять регистраций hello на концентраторе, которые разделены удобное для регистрации платформы, собственный или шаблона, все теги, идентификатор PNS, Дата окончания срока действия идентификатором и hello регистрации. Можно также редактировать регистрацию на лету hello - это полезно, скажем в том случае, если требуется tooedit теги. 
   
    ![][8]
   
   > [!NOTE]
   > Регистрации tooedit функциональные возможности Visual Studio должен использоваться только во время разработки и тестирования с ограниченное количество регистраций. Если возникает toofix необходимость учитывать ваши регистрации в пакетном режиме, с помощью функции регистрации экспорта и импорта hello, описанные здесь - [экспорта и импорта регистраций](https://msdn.microsoft.com/library/dn790624.aspx)
   > 
   > 
2. **Обозреватель служебной шины**
   
    Многие клиенты используют обозреватель ServiceBus, описанный в разделе [Обозреватель ServiceBus] , для просмотра центра уведомлений и управления им. Это проект с открытым исходным кодом, который доступен на странице code.microsoft.com — [Код обозревателя ServiceBus]

### <a name="verify-message-notifications"></a>Проверка уведомлений о сообщениях
1. **классический портал Azure**
   
    Вы можете перейти toohello toosend вкладку «Отладка» тестовых клиентов tooyour уведомления без необходимости копирования любой серверной службы и запуск. 
   
    ![][7]
2. **Visual Studio**
   
    Также можно отправить тестовые уведомления из comforts hello из Visual Studio:
   
    ![][10]
   
    Можно прочитать в hello Azure концентратора уведомлений Visual Studio обозреватель функциональности- 
   
   * [Обзор обозревателя сервера VS]
   * [Запись блога об обозревателе сервера VS — 1]
   * [Запись блога об обозревателе сервера VS — 2]

### <a name="debug-failed-notifications-review-notification-outcome"></a>Уведомления о сбоях отладки и просмотр результатов уведомлений
**Свойство EnableTestSend**

При отправке уведомлений через концентраторы уведомлений, изначально он просто возвращает в очередь для обработки toofigure out все целевые объекты toodo NH и в конечном итоге NH отправляет toohello PNS. Это означает, что при использовании REST API или любой из пакета SDK клиента hello hello удачном возвращении вашей отправки вызова только означает, что сообщение hello было успешно помещено с концентратором уведомлений. Он не дает понять события при NH со временем получил сообщение tooPNS toosend hello. Если уведомления не приходит на клиентском устройстве hello, вероятность того, что при попытке NH tooPNS сообщение hello toodeliver произошла ошибка например hello размер полезных данных превышает максимальное hello hello PNS или hello учетными данными, настроенными NH т. д. Недопустимый tooget на анализ ошибок PNS hello, мы разработали свойство с именем [EnableTestSend функция]. Это свойство включается автоматически при отправке тестового сообщения с портала hello или клиента Visual Studio и таким образом позволяет toosee подробные отладочную информацию. Можно использовать через интерфейс API, выполнив пример hello hello .NET SDK, где она находится сейчас и будут добавлены tooall клиентских пакетов SDK со временем. toouse это с помощью вызова REST hello, просто добавить параметр строки запроса, например вызове «test» в конце hello отправки вызова 

    https://mynamespace.servicebus.windows.net/mynotificationhub/messages?api-version=2013-10&test

*Пример (пакет SDK для .NET)*

Предположим, что вы используете .NET SDK toosend собственного всплывающее уведомление:

    NotificationHubClient hub = NotificationHubClient.CreateClientFromConnectionString(connString, hubName);
    var result = await hub.SendWindowsNativeNotificationAsync(toast);
    Console.WriteLine(result.State);

`result.State`будет просто состояния `Enqueued` конце hello hello выполнения без подсказать, что произошло tooyour push. Теперь вы можете использовать hello `EnableTestSend` логическое свойство во время инициализации hello `NotificationHubClient` и может получить подробное состояние hello PNS произошли ошибки при отправке уведомления hello. Здесь вызова отправки Hello займет tooreturn дополнительное время, так как он только возвращает после NH доставке выходное hello уведомление tooPNS toodetermine hello. 

    bool enableTestSend = true;
    NotificationHubClient hub = NotificationHubClient.CreateClientFromConnectionString(connString, hubName, enableTestSend);

    var outcome = await hub.SendWindowsNativeNotificationAsync(toast);
    Console.WriteLine(outcome.State);

    foreach (RegistrationResult result in outcome.Results)
    {
        Console.WriteLine(result.ApplicationPlatform + "\n" + result.RegistrationId + "\n" + result.Outcome);
    }

*Пример выходных данных*

    DetailedStateAvailable
    windows
    7619785862101227384-7840974832647865618-3
    hello Token obtained from hello Token Provider is wrong

Это сообщение указывает на неправильные учетные данные настраиваются в концентраторе уведомлений hello или проблема с hello регистраций на концентраторе hello и hello рекомендуется курса будут toodelete регистрация и позволить создать его повторно перед отправкой hello клиента hello Сообщение. 

> [!NOTE]
> Обратите внимание, что использование этого свойства hello сильно регулируется таким образом необходимо только использовать это в среде разработки и тестирования для ограниченного набора регистраций. Мы только отправлять уведомления отладки too10 устройств. Мы также имеют ограничение в обработке toobe отправляет отладки 10 в минуту. 
> 
> 

### <a name="review-telemetry"></a>Просмотр телеметрии
1. **Использование классического портала Azure**
   
    Hello портал позволяет tooget краткий обзор всех действий hello на концентратор уведомлений. 
   
    ) на вкладке «панель мониторинга» hello можно просмотреть Агрегированное представление hello регистраций, уведомления, а также ошибки каждой платформы. 
   
    ![][5]
   
    (б) можно также добавить многие другие платформы определенных метрик из tootake вкладка «Монитор» hello более подробное рассмотрение особенно PNS определенные ошибки, возвращенные при NH toosend hello уведомления toohello PNS. 
   
    ![][6]
   
    c) следует начинать с просмотра hello **входящих сообщений**, **операции регистрации**, **успешные уведомления** и перейдите на вкладку tooreview tooper платформы hello PNS конкретных ошибок. 
   
    d) Если у вас есть уведомления hello концентратора неправильно настроены параметры проверки подлинности hello затем вы увидите ошибки проверки подлинности PNS. Это свидетельствует о учетные данные PNS toocheck hello. 

2) **Программный доступ**

Дополнительную информацию см. здесь: 

* [Программный доступ к телеметрии]
* [Доступ к телеметрии с помощью образца API] 

> [!NOTE]
> Несколько функций, связанных с телеметрией, например **экспорт и импорт регистраций**, **доступ к телеметрии с помощью API** и т. д., доступны только для уровня "Стандартный". При попытке toouse эти функции, если вы находитесь в бесплатном или базового уровня затем вы получите эффект toothis сообщение исключения при использовании hello SDK и HTTP 403 (запрещено), при использовании их непосредственно из hello API-интерфейсов REST. Убедитесь, что вы переместили копирование уровня tooStandard классическом портале Azure.  
> 
> 

<!-- IMAGES -->
[0]: ./media/notification-hubs-diagnosing/Architecture.png
[1]: ./media/notification-hubs-diagnosing/GCMConfigure.png
[2]: ./media/notification-hubs-diagnosing/GCMEnable.png
[3]: ./media/notification-hubs-diagnosing/GCMServerKey.png
[4]: ./media/notification-hubs-diagnosing/PortalConfigure.png
[5]: ./media/notification-hubs-diagnosing/PortalDashboard.png
[6]: ./media/notification-hubs-diagnosing/PortalMonitoring.png
[7]: ./media/notification-hubs-diagnosing/PortalTestNotification.png
[8]: ./media/notification-hubs-diagnosing/VSRegistrations.png
[9]: ./media/notification-hubs-diagnosing/VSServerExplorer.png
[10]: ./media/notification-hubs-diagnosing/VSTestNotification.png

<!-- LINKS -->
[Центры уведомлений Azure]: notification-hubs-push-notification-overview.md
[учебными руководствами для начинающих]: notification-hubs-windows-store-dotnet-get-started-wns-push-notification.md
[руководство шаблона]: https://msdn.microsoft.com/library/dn530748.aspx 
[руководство по APNS]: https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html#//apple_ref/doc/uid/TP40008194-CH100-SW4
[руководство по GCM]: http://developer.android.com/google/gcm/adv.html
[Export/Import Registrations]: http://msdn.microsoft.com/library/dn790624.aspx
[Обозреватель ServiceBus]: http://msdn.microsoft.com/library/dn530751.aspx
[Код обозревателя ServiceBus]: https://code.msdn.microsoft.com/windowsazure/Service-Bus-Explorer-f2abca5a
[Обзор обозревателя сервера VS]: http://msdn.microsoft.com/library/windows/apps/xaml/dn792122.aspx 
[Запись блога об обозревателе сервера VS — 1]: http://azure.microsoft.com/blog/2014/04/09/deep-dive-visual-studio-2013-update-2-rc-and-azure-sdk-2-3/#NotificationHubs 
[Запись блога об обозревателе сервера VS — 2]: http://azure.microsoft.com/blog/2014/08/04/announcing-release-of-visual-studio-2013-update-3-and-azure-sdk-2-4/ 
[EnableTestSend функция]: http://msdn.microsoft.com/library/microsoft.servicebus.notifications.notificationhubclient.enabletestsend.aspx
[Программный доступ к телеметрии]: http://msdn.microsoft.com/library/azure/dn458823.aspx
[Доступ к телеметрии с помощью образца API]: https://github.com/Azure/azure-notificationhubs-samples/tree/master/FetchNHTelemetryInExcel

