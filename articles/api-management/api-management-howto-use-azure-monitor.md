---
title: "Мониторинг опубликованных API-интерфейсов в службе управления API Azure | Документация Майкрософт"
description: "Следуйте инструкциям из этого руководства, чтобы узнать, как выполнять мониторинг API в службе управления API Azure."
services: api-management
documentationcenter: 
author: juliako
manager: cfowler
editor: 
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.custom: mvc
ms.topic: tutorial
ms.date: 11/19/2017
ms.author: apimpm
ms.openlocfilehash: bdca9d4968e9e68314f350787907f15e417821f7
ms.sourcegitcommit: b854df4fc66c73ba1dd141740a2b348de3e1e028
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2017
---
# <a name="monitor-published-apis"></a>Мониторинг опубликованных API-интерфейсов

Azure Monitor — это служба Azure, которая предоставляет единый источник данных для наблюдения за всеми ресурсами Azure. С помощью Azure Monitor можно визуализировать, запрашивать, маршрутизировать, архивировать метрики и журналы, полученные от ресурсов Azure, таких как управление API, а также реагировать на них. 

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * просмотр журналов действий;
> * просмотр журналов диагностики;
> * просмотр метрик API; 
> * настройка правила генерации оповещений на случай несанкционированных вызовов API.

В следующем видео показано, как отслеживать управление API с помощью Azure Monitor. 

> [!VIDEO https://channel9.msdn.com/Blogs/AzureApiMgmt/Monitor-API-Management-with-Azure-Monitor/player]
>
>

## <a name="prerequisites"></a>Предварительные требования

+ Выполните задачи в кратком руководстве по [созданию экземпляра службы управления API Azure](get-started-create-service-instance.md).
+ Кроме того, выполните задачи из руководства по [импорту и публикации первого API](import-and-publish.md).

[!INCLUDE [api-management-navigate-to-instance.md](../../includes/api-management-navigate-to-instance.md)]

## <a name="diagnostic-logs"></a>Просмотр журналов действий

Журналы действий позволяют подробно проанализировать операции, выполненные в службах управления API. С помощью журналов изменений можно ответить на вопросы "что? кто? когда?" о любой операции записи (PUT, POST, DELETE) в службах управления API. 

> [!NOTE]
> Журналы действий не содержат операций чтения (GET), операций, выполненных на классическом портале издателя или с помощью исходных API управления.

Вы можете получить доступ к журналам действий в службе управления API или получить доступ к журналам всех ресурсов Azure в Azure Monitor. 

Чтобы просмотреть журналы действий, сделайте следующее:

1. В своем экземпляре **службы управления API** щелкните **Журнал действий**.

## <a name="view-diagnostic-logs"></a>Просмотр журналов диагностики

Журналы диагностики предоставляют подробные сведения об операциях и ошибках, которые важны для аудита, а также для устранения неполадок. Журналы диагностики отличаются от журналов действий. Журналы действий позволяют подробно проанализировать операции, выполненные с ресурсами Azure. Журналы диагностики дают представление об операциях, выполняемых самим ресурсом.

Для доступа к журналам диагностики сделайте следующее:

1. В своем экземпляре **службы управления API** щелкните **Журнал диагностики**.

## <a name="view-metrics-of-your-apis"></a>Просмотр метрик API

Служба управления API каждую минуту передает метрики, позволяя отслеживать состояние и работоспособность API-интерфейсов практически в реальном времени. Ниже приведено описание некоторых доступных метрик.

* Емкость (предварительная версия): позволяет принимать решения о необходимости повышения или понижения уровня служб управления API. Метрика отправляется каждую минуту и отражает емкость шлюза в момент создания отчета. Значение метрики колеблется в диапазоне от 0 до 100 и вычисляется на основе ресурсов шлюза, таких как загрузка центрального процессора и использование памяти.
* Общее количество запросов к шлюзу. Количество запросов API за период. 
* Успешные запросы к шлюзу. Количество запросов API, которые успешно получили коды ответов HTTP, включая 304, 307 и все, что меньше, чем 301 (например, 200). 
* Неудачные запросы к шлюзу. Количество запросов API, которые получили ошибочные коды ответов HTTP, включая 400 и все, что больше, чем 500.
* Неавторизованные запросы к шлюзу. Количество запросов API, которые получили коды ответов HTTP, включая 401, 403 и 429. 
* Другие запросы к шлюзу. Количество запросов API, которые получили коды ответов HTTP, не принадлежащие ни к одной из указанных выше категорий (например, 418).

Для доступа к метрике сделайте следующее:

1. В меню внизу страницы выберите пункт **Метрика**.
2. В раскрывающемся списке выберите метрики, которые вас интересуют (можно добавить несколько метрик). 
    
    Например, выберите из списка доступных метрик **Total Gateway Requests** (Общее количество запросов через шлюз) и **Failed Gateway Requests** (Неудачные запросы через шлюз).
3. Просмотрите диаграмму с общим числом вызовов API. Кроме того, на не показано число неудачных вызовов API. 

## <a name="set-up-an-alert-rule-for-unauthorized-request"></a>Настройка правила генерации оповещений на случай несанкционированного запроса

Вы можете настроить получение уведомлений на основе метрик и журналов действий. Azure Monitor позволяет настроить действие, выполняемое при активации оповещения:

* Отправка уведомления по электронной почте.
* Вызов webhook.
* Вызов приложения логики Azure.

Чтобы настроить оповещения, сделайте следующее:

1. В меню внизу страницы выберите пункт **Правила оповещений**.
2. Выберите **Добавить оповещение метрики**.
3. Укажите **имя** для оповещения.
4. Выберите **Unauthorized Gateway Requests** (Несанкционированные запросы через шлюз) в качестве метрики для мониторинга.
5. Выберите **Участники, читатели и владельцы электронной почты**.
6. Нажмите кнопку **ОК**.
7. Попытайтесь вызвать Conference API без ключа API. Как владелец этого экземпляра службы управления API вы получите оповещение по электронной почте. 

    > [!TIP]
    > При срабатывании правило генерации оповещений может также вызывать веб-перехватчик или приложение логики Azure.

    ![set-up-alert](./media/api-management-azure-monitor/set-up-alert.png)

## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как выполнять такие задачи:

> [!div class="checklist"]
> * просмотр журналов действий;
> * просмотр журналов диагностики;
> * просмотр метрик API; 
> * настройка правила генерации оповещений на случай несанкционированных вызовов API.

Перейдите к следующему руководству:

> [!div class="nextstepaction"]
> [Трассировка вызовов](api-management-howto-api-inspector.md)