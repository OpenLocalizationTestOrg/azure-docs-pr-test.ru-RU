---
title: "Конструктивный шаблон Azure Cosmos DB: приложения социальных сетей | Документация Майкрософт"
description: "Дополнительные сведения о шаблон проектирования для социальных сетей за счет использования hello гибкость хранения Azure Cosmos DB и другими службами Azure."
keywords: "Приложения социальных сетей"
services: cosmos-db
author: ealsur
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 2dbf83a7-512a-4993-bf1b-ea7d72e095d9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/29/2017
ms.author: mimig
ms.openlocfilehash: 47a22f2c5762d62b176921c8052e7bd75d8cf6ae
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="going-social-with-azure-cosmos-db"></a>Использование социальных сетей с помощью Azure Cosmos DB
Жизнь в сильно взаимосвязанном обществе означает, что в определенный момент вы присоединяетесь к **социальной сети**. Мы используем tookeep социальных сетей, связь с друзьями, коллегами, семейства и иногда tooshare нашей энтузиазм сотрудникам с общими интересами.

Как инженеры или разработчики мы может задумывались как этих сетей хранения и соединений наши данные или может иметь даже были назначены toocreate или архитектор новый социальной сети для определенного сегмента рынок себя. То есть возникает вопрос больших hello: каким образом хранятся эти данные?

Предположим, что мы создаем новую яркую социальную сеть, где наши пользователи могут публиковать статьи с сопутствующими материалами, например изображениями, видео или даже музыкой. Пользователи могут комментировать записи и оценивать их с помощью очков. Это подразумевает быть веб-канал сообщений, которые будут доступны пользователям, а может toointeract с на целевой странице hello основного веб-сайта. Это не показаться очень сложным (на первом), но ради hello простоты давайте останавливаться (удалось углубиться в пользовательский веб-каналы, влияют связи, но он превышает hello цель этой статьи).

Итак, как все это хранить и где?

Многие из вас есть опыт работы с базами данных SQL по крайней мере у отсутствовать понятие [реляционной модели данных](https://en.wikipedia.org/wiki/Relational_model) и может быть удобным средством toostart Рисование примерно следующим образом:

![Схема, иллюстрирующая относительную реляционную модель](./media/social-media-apps/social-media-apps-sql.png) 

Идеально нормализованная и аккуратная структура данных… которая не масштабируется. 

Не поймите меня неправильно, я всю жизнь работал с базами данных SQL. Они удобны, но, как и в случае с любой методикой, практикой и программной платформой, они не подходят идеально для всех сценариев.

Почему hello подходящим SQL в этом случае? Давайте рассмотрим структуру hello один post, если мне tooshow, разместить на веб-сайт или приложение, следовало бы toodo запрос с помощью... 8 таблицы соединения (!) просто tooshow один один post, теперь рисунок потока сообщений, которые динамически загружаться и отображаются на экране приветствия, а также может появиться я.

Можно Конечно, использовать humongous экземпляра SQL Server с недостаточно питания toosolve тысячи запросов с этим многие tooserve соединения контент, но действительно, почему бы мы при решении проще существует?

## <a name="hello-nosql-road"></a>дорожные NoSQL Hello
В этой статье помогут вам в моделирования данных на платформе социальных сетей с базой данных NoSQL Azure [Azure Cosmos DB](https://azure.microsoft.com/services/cosmos-db/) в экономичное решение при использовании других функций Azure Cosmos DB как hello [Gremlin Graph API ](../cosmos-db/graph-introduction.md). Используя [NoSQL](https://en.wikipedia.org/wiki/NoSQL), храня данные в формате JSON и применяя [денормализацию](https://en.wikipedia.org/wiki/Denormalization), нашу запись, которая ранее представлялась сложной, можно преобразовать в один [документ](https://en.wikipedia.org/wiki/Document-oriented_database).


    {
        "id":"ew12-res2-234e-544f",
        "title":"post title",
        "date":"2016-01-01",
        "body":"this is an awesome post stored on NoSQL",
        "createdBy":User,
        "images":["http://myfirstimage.png","http://mysecondimage.png"],
        "videos":[
            {"url":"http://myfirstvideo.mp4", "title":"hello first video"},
            {"url":"http://mysecondvideo.mp4", "title":"hello second video"}
        ],
        "audios":[
            {"url":"http://myfirstaudio.mp3", "title":"hello first audio"},
            {"url":"http://mysecondaudio.mp3", "title":"hello second audio"}
        ]
    }

И его можно получить с помощью одного запроса без каких-либо операций соединения. Это намного более простым и понятным и budget-wise, она требует меньше ресурсов tooachieve наилучшего результата.

Azure Cosmos DB гарантирует, что все свойства hello индексируются с его автоматическое индексирование возможно даже [настраиваемые](indexing-policies.md). Привет, без схемы подход позволяет хранить документы с различными и динамических структур, может быть завтра мы хотим toohave сообщения, который будет обрабатывать список категорий или связанных с ними Cosmos DB хэш hello новые документы с hello добавлены атрибуты с без дополнительных объем работ, выполняемых нам.

Комментарии к записи можно считать такими же записями, но со свойством родительской записи (это упрощает сопоставление объектов). 

    {
        "id":"1234-asd3-54ts-199a",
        "title":"Awesome post!",
        "date":"2016-01-02",
        "createdBy":User2,
        "parent":"ew12-res2-234e-544f"
    }

    {
        "id":"asd2-fee4-23gc-jh67",
        "title":"Ditto!",
        "date":"2016-01-03",
        "createdBy":User3,
        "parent":"ew12-res2-234e-544f"
    }

И все взаимодействия в социальной сети могут храниться в отдельном объекте как счетчики.

    {
        "id":"dfe3-thf5-232s-dse4",
        "post":"ew12-res2-234e-544f",
        "comments":2,
        "likes":10,
        "points":200
    }

Создание веб-каналов — это просто создание документов, которые могут содержать список идентификаторов записей в указанном порядке релевантности.

    [
        {"relevance":9, "post":"ew12-res2-234e-544f"},
        {"relevance":8, "post":"fer7-mnb6-fgh9-2344"},
        {"relevance":7, "post":"w34r-qeg6-ref6-8565"}
    ]

Это может быть «последнюю» поток с сообщения, упорядоченные по дате создания, «теплого» потока с этими учитывает с дополнительные отзывы в hello последние 24 часа, даже бы установить пользовательского потока для каждого пользователя на основе логики как последователи и интересы и по-прежнему будет список  в блогах. Это делается путем как toobuild этих списков, но производительность чтения hello остается нормально. После мы получить один из этих списков, мы выполните tooCosmos один запрос базы данных с помощью hello [в операторе](documentdb-sql-query.md#WhereClause) tooobtain страницы записей за раз.

Hello канала потоков может быть построена с использованием [службы приложений Azure](https://azure.microsoft.com/services/app-service/) фоновые процессы: [веб-задания](../app-service-web/web-sites-create-web-jobs.md). После создания post фоновой обработки может вызываться с помощью [хранилища Azure](https://azure.microsoft.com/services/storage/) [очереди](../storage/queues/storage-dotnet-how-to-use-queues.md) и веб-заданий запускается с помощью hello [SDK веб-заданий Azure](../app-service-web/websites-dotnet-webjobs-sdk.md), реализующего Hello post распространения внутри потоков в зависимости от собственную пользовательскую логику. 

Отложенным способом, используя этот же способ toocreate согласованным среды могут обрабатываться точек и отзывы по post.

С читателями все сложнее. Cosmos DB документа максимальный размер ограничен и чтения или записи больших документов может повлиять на масштабируемость приложения hello. Поэтому можно рассмотреть хранение читателей в документе со следующей структурой.

    {
        "id":"234d-sd23-rrf2-552d",
        "followersOf": "dse4-qwe2-ert4-aad2",
        "followers":[
            "ewr5-232d-tyrg-iuo2",
            "qejh-2345-sdf1-ytg5",
            //...
            "uie0-4tyg-3456-rwjh"
        ]
    }

Он может подойти для пользователя, имеющего несколько тысяч последователи, но если некоторые знаменитость соединяет нашей ранги, этот подход приводит tooa размер больших документов и может ограничить размер документа в конечном итоге попаданий hello.

toosolve это, мы используем смешанный подход. Как часть документа Статистика пользователей hello сохраняем hello число последователи:

    {
        "id":"234d-sd23-rrf2-552d",
        "user": "dse4-qwe2-ert4-aad2",
        "followers":55230,
        "totalPosts":452,
        "totalPoints":11342
    }

Граф фактических hello последователи могут храниться с помощью Azure Cosmos DB [Gremlin Graph API](../cosmos-db/graph-introduction.md), toocreate [вершин](http://mathworld.wolfram.com/GraphVertex.html) для каждого пользователя и [краев](http://mathworld.wolfram.com/GraphEdge.html) , Ведение hello» Связи A-следующим B». Hello Graph API давайте вы не только получить последователи hello зависит от конкретного пользователя, но создавать более сложные запросы, tooeven общих предложить людей. Если мы добавим toohello graph hello содержимое категории людей, например или предоставляются, мы можем запустить встраивания взаимодействия, включить обнаружение смарт-содержимого, предложение содержимого, с которыми связаны, которые мы выполнить как или поиск людей, с которым мы может имеют много общего.

Hello Статистика пользователей документ по-прежнему может быть карты используется toocreate в hello пользовательского интерфейса или быстрый профиль предварительного просмотра.

## <a name="hello-ladder-pattern-and-data-duplication"></a>Здравствуйте, «Лестнице» дублирования шаблон и данные
Как вы могли заметить в документе JSON hello, который ссылается на отправку, существует несколько вхождений пользователя. И вы бы догадаться справа, это означает, что сведения hello, представляющий пользователя, учитывая это Денормализация может присутствовать в нескольких местах.

В порядке tooallow для запросов быстрее мы взимается дублирования данных. Hello проблемы с побочным действием является при некоторых действиях пользователя изменения данных, нам нужно toofind все действия hello он никогда не была и обновить их все. Звучит не слишком практично, верно?

Не будет toosolve его, определяя hello атрибуты ключ пользователя, в приложении для каждого действия отображаются. Если визуального отображения post в приложении и Показать только создатель hello и изображение, почему хранить все данные пользователя hello в атрибуте hello «Кем создано»? Если для каждого комментария просто Показать рисунок hello пользователя, нам не нужно hello остальные его сведения. Это происходит, когда что-нибудь вызова hello» лестнице шаблон» вступает в действие.

Для примера рассмотрим информацию о пользователе.

    {
        "id":"dse4-qwe2-ert4-aad2",
        "name":"John",
        "surname":"Doe",
        "address":"742 Evergreen Terrace",
        "birthday":"1983-05-07",
        "email":"john@doe.com",
        "twitterHandle":"@john",
        "username":"johndoe",
        "password":"some_encrypted_phrase",
        "totalPoints":100,
        "totalPosts":24
    }

Посмотрев на эту информацию, мы можем быстро определить, какая информация важна, а какая — нет, тем самым строя "лестницу".

![Схема шаблона "Лестница"](./media/social-media-apps/social-media-apps-ladder.png)

шаг наименьшее Hello называется UserChunk, hello минимальный блок данных, идентифицирующее пользователя и используется для дублирования данных. Уменьшение размера hello дублируется tooonly hello данных мы будет «Показать» hello, мы уменьшить вероятность hello массовых обновлений.

этап средней Hello называется hello пользователя, это hello полные данные, которые будут использоваться для большинства запросов зависит от производительности на Cosmos DB hello наиболее используемых и важных. Он включает hello информацию, представленную UserChunk.

Наибольшее Hello — hello расширенного пользователя. Он включает все сведения критических пользовательских hello, а также другие данные, не требующий действительно toobe чтения быстро или его использования является окончательным (например, процесс входа в систему hello). Эти данные могут храниться за пределами Cosmos DB, в базе данных SQL Azure или таблицах хранилища Azure.

Почему мы разделить пользователя hello и даже сохранять эту информацию в разных местах? Так как с точки зрения производительности hello больше hello документы, hello costlier hello запросов. Сохранять документы, тонкий, hello, правый, toodo сведения о всех вашей производительность зависящих от запрашивает социальной сети, и хранилище hello других дополнительных сведений для окончательной сценариев, таких как полный профиль изменения, имена входа, даже интеллектуального анализа данных для анализа использования и Big Данные инициативы. Мы действительно неважно, если медленнее hello сбор данных для интеллектуального анализа данных, так как она работает на базе данных SQL Azure, мы имеют относятся хотя что наши пользователи имеют более быстрых и тонкий возможности. Данные пользователя, хранящиеся в Cosmos DB, будут выглядеть следующим образом.

    {
        "id":"dse4-qwe2-ert4-aad2",
        "name":"John",
        "surname":"Doe",
        "username":"johndoe"
        "email":"john@doe.com",
        "twitterHandle":"@john"
    }

И запрос POST будет выглядеть следующим образом.

    {
        "id":"1234-asd3-54ts-199a",
        "title":"Awesome post!",
        "date":"2016-01-02",
        "createdBy":{
            "id":"dse4-qwe2-ert4-aad2",
            "username":"johndoe"
        }
    }

При изменения возникает, когда один из атрибутов hello фрагмента hello зависит, это легко toofind hello затронутых документы с помощью запросов, указывающих toohello индексированные атрибуты (ВЫБЕРИТЕ * FROM учитывает p WHERE p.createdBy.id == «edited_user_id») и последующего обновления блоки Hello.

## <a name="hello-search-box"></a>поле поиска Hello
К счастью, пользователи будут формировать много содержимого. И мы должны toosearch возможность может tooprovide hello и найти содержимое, которое может не быть непосредственно в потоки их содержимого, может быть потому, что мы не действуют создатели hello, или может быть мы просто пытаетесь toofind, старый post, которые мы использовали на 6 месяцев назад.

К счастью и так как мы используем Azure Cosmos DB, мы легко реализовать обработчик поиска с помощью [поиска Azure](https://azure.microsoft.com/services/search/) за несколько минут и без единой строки кода ввода (кроме hello очевидно, что поиск процесса и пользовательским Интерфейсом).

Почему это так просто?

Поиск Azure реализует они вызывают [индексаторы](https://msdn.microsoft.com/library/azure/dn946891.aspx), фон обрабатывает этот обработчик в свои хранилища данных и добавить, обновить или удалить объекты в индексах hello выполнены автоматически. Они поддерживают [индексаторы базы данных SQL Azure](https://blogs.msdn.microsoft.com/kaevans/2015/03/06/indexing-azure-sql-database-with-azure-search/), [индексаторы больших двоичных объектов Azure](../search/search-howto-indexing-azure-blob-storage.md) и, к счастью, [индексаторы Azure Cosmos DB](../search/search-howto-index-documentdb.md). Hello переход информации из Cosmos DB tooAzure поиска является простым, как и информацию о хранилище в формате JSON, нам нужна лишь слишком[создание индекса](../search/search-create-index-portal.md) и сопоставить мы хотим индексированные атрибуты из наших документов, и это так, в течение нескольких минут (зависит от размера hello данных), все содержимое будет доступных toobe, поиск, наилучшим решением поиск как служба hello в облачной инфраструктуры. 

Дополнительные сведения о поиске Azure можно посетить hello [tooSearch руководство дал](https://blogs.msdn.microsoft.com/mvpawardprogram/2016/02/02/a-hitchhikers-guide-to-search/).

## <a name="hello-underlying-knowledge"></a>Hello базовых знаний
Храня все это содержимое, которое ежедневно увеличивается, мы можем задуматься: что делать с потоком информации, поступающей от моих пользователей?

Нетрудно Hello ответов: переключить его toowork и сведения из него.

Но как мы можем учиться? Некоторые простые примеры [анализ мнений](https://en.wikipedia.org/wiki/Sentiment_analysis)содержимым рекомендации в соответствии с параметрами пользователя или даже автоматических содержимого модератора гарантирует, что все hello содержимое, публикуемое социальной сети является безопасным для hello Семейство.

Теперь, когда я получил можно привязать, скорее всего, будет рассматривать требуются некоторые кандидат наук в tooextract обработки и анализа математические эти закономерности и информации из простых баз данных и файлов, но будет неправильный.

[Машинное обучение Azure](https://azure.microsoft.com/services/machine-learning/), а hello [Cortana аналитики Suite](https://www.microsoft.com/en/server-cloud/cortana-analytics-suite/overview.aspx), является полностью управляемой облачной службы, которая позволяет создавать рабочие процессы с помощью алгоритмов в простой интерфейс и перетащите, код собственных алгоритмов hello в [R](https://en.wikipedia.org/wiki/R_\(programming_language\)) или использовать некоторые построенных hello и готов toouse API-интерфейсы, такие как: [анализа текста](https://gallery.cortanaanalytics.com/MachineLearningAPI/Text-Analytics-2), [содержимого модератора](https://www.microsoft.com/moderator) или [рекомендации](https://gallery.cortanaanalytics.com/MachineLearningAPI/Recommendations-2).

tooachieve любой из этих сценариев машинного обучения, можно использовать [Озера данных Azure](https://azure.microsoft.com/services/data-lake-store/) tooingest hello информацию из разных источников, а также использовать [U-SQL](https://azure.microsoft.com/documentation/videos/data-lake-u-sql-query-execution/) tooprocess hello сведения и к формированию вывода могут обрабатываться машинного обучения Azure.

Другой доступный параметр — toouse [Когнитивных Майкрософт](https://www.microsoft.com/cognitive-services) tooanalyze содержимого; не только нам понять их пользователям более высокий уровень (через анализ они записывают с [API аналитики текст](https://www.microsoft.com/cognitive-services/en-us/text-analytics-api)), но Мы также может определять содержимое нежелательные или зрелой и действовать соответствующим образом с [компьютера концепции API](https://www.microsoft.com/cognitive-services/en-us/computer-vision-api). Когнитивных службы включают много out of box решений, которые не требуют никакого toouse знаний машинного обучения.

## <a name="a-planet-scale-social-experience"></a>Глобально масштабируемое социальное взаимодействие
Последняя, но совсем не маловажная тема, которую необходимо рассмотреть, — **масштабируемость**. При проектировании архитектуры, очень важно, что каждый компонент можно масштабировать сам по себе, либо потому, что нам требуется больше данных tooprocess или поскольку мы хотим toohave больше географических покрытия (или оба). К счастью, решение такой сложной задачи **уже заложено** в Cosmos DB.

Поддерживает Cosmos DB [динамическое секционирование](https://azure.microsoft.com/blog/10-things-to-know-about-documentdb-partitioned-collections/) out-of--box путем автоматического создания секции на основе заданного **ключ раздела** (определяется как один из атрибутов hello в документах). Определение hello правильный ключ секции, которые должны выполняться во время разработки и сохранения в виду hello [рекомендации](../cosmos-db/partition-data.md#designing-for-partitioning) доступно; в случае hello социальных взаимодействие стратегию секционирования должны быть выровнены с hello способ запроса (операций чтения в рамках hello предпочтительны одной секции) и записи (избежать «горячие точки», распределяя операций записи на несколько разделов). Некоторые параметры могут быть: секций, основанных на временных ключей (день/месяц/неделя), по категориям содержимого, по географическому региону пользователем; Это все зависит как запрашивать данные hello и показать его в работу социальных сетей. 

Один интересный момент следует упомянуть является выполнение Cosmos DB запросы (включая [статистические выражения](https://azure.microsoft.com/blog/planet-scale-aggregates-with-azure-documentdb/)) во всех разделах прозрачно, нет необходимости tooadd логики по мере роста данных.

Со временем у вас, очевидно, увеличится трафик и потребление ресурсов (измеряемое в единицах запроса, [ЕЗ](request-units.md)). Будет чтении и записи чаще при расширении вашей userbase, они будут начать создание и чтение дополнительные содержимого; Здравствуйте, возможность **масштабирование пропускную способность** крайне важно. Увеличение нашей RUs довольно прост, можно сделать это с помощью нескольких щелчков на портале Azure hello или [выполнения команд через hello API](https://docs.microsoft.com/rest/api/documentdb/replace-an-offer).

![Увеличение масштаба и определение ключа секции](./media/social-media-apps/social-media-apps-scaling.png)

Предположим, что ваши результаты улучшаются, и пользователи из другого региона, страны или континента обратили внимание на вашу платформу и начали ее использовать. Приятный сюрприз!

Подождите..., но скоро вы поймете, свой опыт работы с вашей платформы не является оптимальным; они являются пока вдали от вашей рабочей области ужасных hello задержки, что очевидно, что они вам не нужны tooquit. Было бы очень удобно иметь возможность **охватить весь мир**... И такая возможность есть!

Позволяет Cosmos DB [глобально реплицируют данные](../cosmos-db/tutorial-global-distribution-documentdb.md) и прозрачно с помощью нескольких щелчков мышью и автоматически выбрать один из доступных регионов hello из вашего [клиентский код](../cosmos-db/tutorial-global-distribution-documentdb.md). Это также означает, что у вас может быть [несколько регионов отработки отказа](regional-failover.md). 

При данных реплицируется глобально, необходимо убедиться, что клиенты могут воспользоваться преимуществами, с его toomake. Если вы используете веб-клиентом или доступ к API-интерфейсы мобильных клиентов, можно развернуть [диспетчера трафика Azure](https://azure.microsoft.com/services/traffic-manager/) и клонирования Azure приложения службы, для всех регионов требуемого hello, используя [конфигурация производительности](../app-service-web/web-sites-traffic-manager.md)toosupport расширенные глобальные действия. Если клиенты обращаются внешняя или API-интерфейсов, они будут перенаправленное toohello ближайший приложения службы, которая в свою очередь, будут подключаться к локальной реплике Cosmos DB toohello.

![Добавление платформы социальных tooyour глобального покрытия](./media/social-media-apps/social-media-apps-global-replicate.png)

## <a name="conclusion"></a>Заключение
В этой статье предпринимает tooshed некоторые светло-в альтернативных hello полностью создания социальных сетей в Azure со службами недорогие и предоставляя значительные результаты с помощью поощряя hello распространения многоуровневого хранилища решения и данных называется «Лестнице».

![Схема взаимодействия между службами Azure для социальных сетей](./media/social-media-apps/social-media-apps-azure-solution.png)

является истинность Hello наличие не панацеей для этого типа сценариев, он имеет hello взаимосвязь, созданные hello сочетание значительные службы, позволяющие качественной toobuild: hello скорости и свободы tooprovide Azure Cosmos DB существенно повышается социальных сетей, аналитики Hello решения первого класса поиска как поиск Azure, hello гибкость toohost службы приложений Azure не зависящего от языка приложений, но мощные фоновые процессы, даже и hello развертываемого хранилища Azure и базы данных SQL Azure для хранение больших объемов данных и hello Аналитические возможности toocreate машинного обучения Azure базы знаний и аналитики, которые можно отправить отзыв tooour процессы и помогают нам доставки hello справа содержимого toohello вправо пользователей.

## <a name="next-steps"></a>Дальнейшие действия
toolearn Дополнительные сведения о варианты использования для Cosmos DB. в разделе [варианты использования общих DB Cosmos](use-cases.md).
