---
title: "Советы по aaaPerformance - Azure Cosmos DB NoSQL | Документы Microsoft"
description: "Узнать базу данных Azure Cosmos клиента конфигурации параметры tooimprove производительность базы данных"
keywords: "как tooimprove производительности базы данных"
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: 4f3e82ae5048e3dbc20b0fd891a2d3aa22adf3fc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="c0adb-104">Советы по повышению производительности для Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="c0adb-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="c0adb-105">Azure Cosmos DB — быстрая и гибкая распределенная база данных, которая легко масштабируется с гарантированной задержкой и пропускной способностью.</span><span class="sxs-lookup"><span data-stu-id="c0adb-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="c0adb-106">Не toomake архитектура основных изменений и не писать сложный код tooscale базы данных с помощью Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c0adb-106">You do not have toomake major architecture changes or write complex code tooscale your database with Cosmos DB.</span></span> <span data-ttu-id="c0adb-107">Для увеличения или уменьшения масштаба достаточно вызвать один метод интерфейса API или [пакета SDK](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="c0adb-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="c0adb-108">Однако Cosmos DB осуществляется через сетевые вызовы имеют оптимизации клиентские, можно сделать tooachieve максимальной производительности.</span><span class="sxs-lookup"><span data-stu-id="c0adb-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make tooachieve peak performance.</span></span>

<span data-ttu-id="c0adb-109">Чтобы оптимизировать производительность базы данных,</span><span class="sxs-lookup"><span data-stu-id="c0adb-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="c0adb-110">Рассмотрим следующие варианты hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-110">consider hello following options:</span></span>

## <a name="networking"></a><span data-ttu-id="c0adb-111">Сеть</span><span class="sxs-lookup"><span data-stu-id="c0adb-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="c0adb-112">**Политика подключения: использование режима прямого подключения**</span><span class="sxs-lookup"><span data-stu-id="c0adb-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="c0adb-113">Как клиент связывается tooCosmos DB имеет важные последствия на производительность, особенно в части наблюдаемых клиентские задержки.</span><span class="sxs-lookup"><span data-stu-id="c0adb-113">How a client connects tooCosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="c0adb-114">Существует два параметра конфигурации ключа, доступных для настройки клиента политики подключения — подключение hello *режим* и hello [подключения *протокола*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="c0adb-114">There are two key configuration settings available for configuring client Connection Policy – hello connection *mode* and hello [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="c0adb-115">доступны два режима доступны Hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-115">hello two available modes are:</span></span>

   1. <span data-ttu-id="c0adb-116">режим шлюза (по умолчанию);</span><span class="sxs-lookup"><span data-stu-id="c0adb-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="c0adb-117">режим прямого подключения.</span><span class="sxs-lookup"><span data-stu-id="c0adb-117">Direct Mode</span></span>

      <span data-ttu-id="c0adb-118">Режим шлюз поддерживается на всех платформах SDK, hello настроен по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c0adb-118">Gateway Mode is supported on all SDK platforms and is hello configured default.</span></span>  <span data-ttu-id="c0adb-119">Если приложение работает в корпоративной сети с ограничениями strict брандмауэра, режим шлюза является наилучшим вариантом hello, поскольку он использует стандартный порт HTTPS hello и одну конечную точку.</span><span class="sxs-lookup"><span data-stu-id="c0adb-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is hello best choice since it uses hello standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="c0adb-120">Здравствуйте выигрышем в производительности, то, что шлюз режим включает в себя дополнительный сетевой прыжок каждый раз при чтении или записи tooCosmos DB данных.</span><span class="sxs-lookup"><span data-stu-id="c0adb-120">hello performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written tooCosmos DB.</span></span> <span data-ttu-id="c0adb-121">По этой причине прямой режим обеспечивает лучшую производительность из-за toofewer сетевых переходов.</span><span class="sxs-lookup"><span data-stu-id="c0adb-121">Because of this, Direct Mode offers better performance due toofewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="c0adb-122">**Политика подключение: используется протокол TCP hello**</span><span class="sxs-lookup"><span data-stu-id="c0adb-122">**Connection policy: Use hello TCP protocol**</span></span>

    <span data-ttu-id="c0adb-123">Если вы используете режим прямого подключения, вам доступны два варианта протоколов:</span><span class="sxs-lookup"><span data-stu-id="c0adb-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="c0adb-124">TCP</span><span class="sxs-lookup"><span data-stu-id="c0adb-124">TCP</span></span>
   * <span data-ttu-id="c0adb-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="c0adb-125">HTTPS</span></span>

     <span data-ttu-id="c0adb-126">Cosmos DB предлагает простую и открытую модель программирования RESTful поверх HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c0adb-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="c0adb-127">Кроме того он предоставляет эффективный протокол TCP, который также категории RESTful в модели связи и доступен через пакет SDK для клиента .NET hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through hello .NET client SDK.</span></span> <span data-ttu-id="c0adb-128">Как Direct TCP, так и HTTPS используют SSL для первоначальной аутентификации и шифрования трафика.</span><span class="sxs-lookup"><span data-stu-id="c0adb-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="c0adb-129">Для достижения оптимальной производительности используйте протокол TCP hello, когда это возможно.</span><span class="sxs-lookup"><span data-stu-id="c0adb-129">For best performance, use hello TCP protocol when possible.</span></span>

     <span data-ttu-id="c0adb-130">При использовании протокола TCP в режиме шлюза, порт TCP-порт 443 — hello порту Cosmos DB и 10255 — порт MongoDB API hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-130">When using TCP in Gateway Mode, TCP Port 443 is hello Cosmos DB port, and 10255 is hello MongoDB API port.</span></span> <span data-ttu-id="c0adb-131">При использовании протокола TCP в режиме прямого, добавление toohello шлюза порты, вам требуется порт hello tooensure диапазоне от 10000 до 20000 открыт, так как Cosmos DB использует динамические порты TCP.</span><span class="sxs-lookup"><span data-stu-id="c0adb-131">When using TCP in Direct Mode, in addition toohello Gateway ports, you need tooensure hello port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="c0adb-132">Если эти порты не открыты, и попытке toouse TCP, возникнет ошибка 503 Служба недоступна.</span><span class="sxs-lookup"><span data-stu-id="c0adb-132">If these ports are not open and you attempt toouse TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="c0adb-133">Режим подключения Hello настраивается во время построения hello hello DocumentClient экземпляра с параметром ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-133">hello Connectivity Mode is configured during hello construction of hello DocumentClient instance with hello ConnectionPolicy parameter.</span></span> <span data-ttu-id="c0adb-134">При использовании режима прямого hello протокола можно также задать в параметр ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-134">If Direct Mode is used, hello Protocol can also be set within hello ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from hello Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="c0adb-135">Так как TCP поддерживается только в режиме прямого, если используется режим шлюза, затем hello всегда равно протокола HTTPS используется toocommunicate с hello шлюза и hello значение протокола в hello ConnectionPolicy игнорируется.</span><span class="sxs-lookup"><span data-stu-id="c0adb-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then hello HTTPS protocol is always used toocommunicate with hello Gateway and hello Protocol value in hello ConnectionPolicy is ignored.</span></span>

    ![Иллюстрация hello политика подключения базы данных Azure Cosmos](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="c0adb-137">**Вызовите OpenAsync tooavoid запуска задержка при первом запросе**</span><span class="sxs-lookup"><span data-stu-id="c0adb-137">**Call OpenAsync tooavoid startup latency on first request**</span></span>

    <span data-ttu-id="c0adb-138">По умолчанию hello первый запрос имеет Высокая задержка, так как она содержит таблицы маршрутизации адресов toofetch hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-138">By default, hello first request has a higher latency because it has toofetch hello address routing table.</span></span> <span data-ttu-id="c0adb-139">Эта задержка запуска на hello tooavoid сначала запросить, OpenAsync() следующим следует вызывать один раз во время инициализации.</span><span class="sxs-lookup"><span data-stu-id="c0adb-139">tooavoid this startup latency on hello first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="c0adb-140">**Оптимизация производительности за счет размещения клиентов в одном регионе Azure**</span><span class="sxs-lookup"><span data-stu-id="c0adb-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="c0adb-141">Если возможно, все приложения, вызывающие Cosmos DB hello же регионе, что место hello Cosmos DB базы данных.</span><span class="sxs-lookup"><span data-stu-id="c0adb-141">When possible, place any applications calling Cosmos DB in hello same region as hello Cosmos DB database.</span></span> <span data-ttu-id="c0adb-142">Для сравнения, приблизительно, вызывает tooCosmos базы данных в пределах одного региона завершается в течение 1 2 мс, но hello задержка между Запад hello и восточном побережье из США — hello hello > 50 мс.</span><span class="sxs-lookup"><span data-stu-id="c0adb-142">For an approximate comparison, calls tooCosmos DB within hello same region complete within 1-2 ms, but hello latency between hello West and East coast of hello US is >50 ms.</span></span> <span data-ttu-id="c0adb-143">Эта задержка скорее всего может изменяться от toorequest запроса в зависимости от маршрута hello запросом hello, передаваемых из hello клиента toohello центра обработки данных Azure границ.</span><span class="sxs-lookup"><span data-stu-id="c0adb-143">This latency can likely vary from request toorequest depending on hello route taken by hello request as it passes from hello client toohello Azure datacenter boundary.</span></span> <span data-ttu-id="c0adb-144">Hello минимально возможные задержки достигается за счет того, вызов hello приложения находится в пределах hello же регионе Azure, что hello подготовить Cosmos DB конечной точки.</span><span class="sxs-lookup"><span data-stu-id="c0adb-144">hello lowest possible latency is achieved by ensuring hello calling application is located within hello same Azure region as hello provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="c0adb-145">Список доступных регионов см. на странице [Регионы Azure](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="c0adb-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="c0adb-146">![Иллюстрация hello политика подключения базы данных Azure Cosmos](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="c0adb-146">![Illustration of hello Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="c0adb-147">**Увеличение количества потоков или задач**</span><span class="sxs-lookup"><span data-stu-id="c0adb-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="c0adb-148">Поскольку вызовы tooAzure Cosmos DB выполняются через сеть hello, может потребоваться toovary hello степень параллелизма запросов, чтобы клиентское приложение hello тратит немного времени ожидания между запросами.</span><span class="sxs-lookup"><span data-stu-id="c0adb-148">Since calls tooAzure Cosmos DB are made over hello network, you may need toovary hello degree of parallelism of your requests so that hello client application spends very little time waiting between requests.</span></span> <span data-ttu-id="c0adb-149">Например, если вы используете. NET [библиотека параллельных задач](https://msdn.microsoft.com//library/dd460717.aspx), создайте в порядке hello сотнях задач чтения или записи tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c0adb-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in hello order of 100s of Tasks reading or writing tooCosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="c0adb-150">Использование пакета SDK</span><span class="sxs-lookup"><span data-stu-id="c0adb-150">SDK Usage</span></span>
1. <span data-ttu-id="c0adb-151">**Установка hello последнего пакета SDK**</span><span class="sxs-lookup"><span data-stu-id="c0adb-151">**Install hello most recent SDK**</span></span>

    <span data-ttu-id="c0adb-152">Hello Cosmos DB SDK постоянно вносятся улучшенные tooprovide hello наилучшей производительности.</span><span class="sxs-lookup"><span data-stu-id="c0adb-152">hello Cosmos DB SDKs are constantly being improved tooprovide hello best performance.</span></span> <span data-ttu-id="c0adb-153">В разделе hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) toodetermine страниц hello последнего пакета SDK и просмотрите усовершенствования.</span><span class="sxs-lookup"><span data-stu-id="c0adb-153">See hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages toodetermine hello most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="c0adb-154">**Использовать одноэлементный Cosmos DB клиент для hello жизненный цикл приложения**</span><span class="sxs-lookup"><span data-stu-id="c0adb-154">**Use a singleton Cosmos DB client for hello lifetime of your application**</span></span>

    <span data-ttu-id="c0adb-155">Обратите внимание, что каждый экземпляр DocumentClient является потокобезопасным, а при использовании режима прямого подключения предоставляется возможность управления подключениями и кэширования адресов.</span><span class="sxs-lookup"><span data-stu-id="c0adb-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="c0adb-156">tooallow эффективности соединения управления и повышения производительности путем DocumentClient, рекомендуется использовать toouse один экземпляр DocumentClient каждого домена приложения hello жизненного цикла приложения hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-156">tooallow efficient connection management and better performance by DocumentClient, it is recommended toouse a single instance of DocumentClient per AppDomain for hello lifetime of hello application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="c0adb-157">**Увеличение максимального количества подключений System.Net для каждого узла при использовании режима шлюза**</span><span class="sxs-lookup"><span data-stu-id="c0adb-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="c0adb-158">Cosmos DB запросы выполняются через HTTPS REST при использовании режима шлюза и являются подвергается toohello ограничение соединения по умолчанию имя узла или IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="c0adb-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected toohello default connection limit per hostname or IP address.</span></span> <span data-ttu-id="c0adb-159">Tooset hello MaxConnections tooa высокое значение (100-1000) может потребоваться, чтобы hello клиентской библиотеки можно использовать несколько одновременных подключений tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="c0adb-159">You may need tooset hello MaxConnections tooa higher value (100-1000) so that hello client library can utilize multiple simultaneous connections tooCosmos DB.</span></span> <span data-ttu-id="c0adb-160">В .NET SDK 1.8.0 hello и выше, Здравствуйте, значение по умолчанию для [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) — 50 и toochange Здравствуйте значение, можно задать hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit ](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa высокое значение.</span><span class="sxs-lookup"><span data-stu-id="c0adb-160">In hello .NET SDK 1.8.0 and above, hello default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and toochange hello value, you can set hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa higher value.</span></span>   
4. <span data-ttu-id="c0adb-161">**Настройка параллельных запросов для секционированных коллекций**</span><span class="sxs-lookup"><span data-stu-id="c0adb-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="c0adb-162">DocumentDB .NET SDK версии 1.9.0 и более поздних версиях поддержка параллельных запросов, позволяющих tooquery секционированную коллекцию параллельно (см. [работа с пакетами SDK hello](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) и связанные с hello [примеры кода](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) для Дополнительные сведения о).</span><span class="sxs-lookup"><span data-stu-id="c0adb-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you tooquery a partitioned collection in parallel (see [Working with hello SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and hello related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="c0adb-163">Параллельные запросы спроектированный tooimprove запроса задержка и пропускная способность превышают их последовательного аналога.</span><span class="sxs-lookup"><span data-stu-id="c0adb-163">Parallel queries are designed tooimprove query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="c0adb-164">Параллельные запросы предоставляют два параметра, пользователи могут настраивать toocustom размеру их требования, (a) MaxDegreeOfParallelism: toocontrol hello максимального количества секций, затем можно запросить в параллельном режиме и (б) MaxBufferedItemCount: toocontrol hello число предварительно выбранных результатов.</span><span class="sxs-lookup"><span data-stu-id="c0adb-164">Parallel queries provide two parameters that users can tune toocustom-fit their requirements, (a) MaxDegreeOfParallelism: toocontrol hello maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: toocontrol hello number of pre-fetched results.</span></span>

    <span data-ttu-id="c0adb-165">(a) ***Настройка MaxDegreeOfParallelism\:***. При параллельном запросе одновременно запрашиваются несколько секций.</span><span class="sxs-lookup"><span data-stu-id="c0adb-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="c0adb-166">Тем не менее данные из отдельных секционированных сбор выборка выполняется последовательно с учетом toohello запроса.</span><span class="sxs-lookup"><span data-stu-id="c0adb-166">However, data from an individual partitioned collect is fetched serially with respect toohello query.</span></span> <span data-ttu-id="c0adb-167">Таким образом при задании hello MaxDegreeOfParallelism toohello номера секций должна hello Максимальная вероятность достижения Здравствуйте большинство высокопроизводительных запросов, предоставляемых условиями системы остаются hello таким же.</span><span class="sxs-lookup"><span data-stu-id="c0adb-167">So, setting hello MaxDegreeOfParallelism toohello number of partitions has hello maximum chance of achieving hello most performant query, provided all other system conditions remain hello same.</span></span> <span data-ttu-id="c0adb-168">Если вы не знаете hello число секций, можно задать большое число hello MaxDegreeOfParallelism tooa и hello система выбирает минимум hello (число секций, предоставленный пользователем), которые hello MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="c0adb-168">If you don't know hello number of partitions, you can set hello MaxDegreeOfParallelism tooa high number, and hello system chooses hello minimum (number of partitions, user provided input) as hello MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="c0adb-169">Это важные toonote, который параллельные преимущества наиболее hello создают запросы, если данные hello распределяется равномерно между все секции с учетом toohello запроса.</span><span class="sxs-lookup"><span data-stu-id="c0adb-169">It is important toonote that parallel queries produce hello best benefits if hello data is evenly distributed across all partitions with respect toohello query.</span></span> <span data-ttu-id="c0adb-170">Если hello секционированные коллекции секционируется так, что все или большинство hello данных, возвращаемых запросом является концентрируются в нескольких секциях (один раздел в худшем случае), а затем hello производительность запроса hello бы быть замедляется из-за этих секций.</span><span class="sxs-lookup"><span data-stu-id="c0adb-170">If hello partitioned collection is partitioned such a way that all or a majority of hello data returned by a query is concentrated in a few partitions (one partition in worst case), then hello performance of hello query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="c0adb-171">(б) ***СУБД MaxBufferedItemCount\: *** параллельного запроса является результаты спроектированный toopre-fetch во время обработки текущего пакета hello результатов клиентом hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed toopre-fetch results while hello current batch of results is being processed by hello client.</span></span> <span data-ttu-id="c0adb-172">Здравствуйте, предварительное помогает в общую задержку улучшения запроса.</span><span class="sxs-lookup"><span data-stu-id="c0adb-172">hello pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="c0adb-173">MaxBufferedItemCount: hello параметр toolimit hello число предварительно выбранных результатов.</span><span class="sxs-lookup"><span data-stu-id="c0adb-173">MaxBufferedItemCount is hello parameter toolimit hello number of pre-fetched results.</span></span> <span data-ttu-id="c0adb-174">Установка MaxBufferedItemCount toohello ожидается число возвращаемых результатов (или более высокий номер) позволяет hello запроса tooreceive максимальные преимущества от предварительной загрузки.</span><span class="sxs-lookup"><span data-stu-id="c0adb-174">Setting MaxBufferedItemCount toohello expected number of results returned (or a higher number) allows hello query tooreceive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="c0adb-175">Обратите внимание, что предварительно извлечение works hello таким же, каким образом независимо от hello MaxDegreeOfParallelism имеется один буфер для hello данных от всех разделов.</span><span class="sxs-lookup"><span data-stu-id="c0adb-175">Note that pre-fetching works hello same way irrespective of hello MaxDegreeOfParallelism, and there is a single buffer for hello data from all partitions.</span></span>  
5. <span data-ttu-id="c0adb-176">**Включение сбора мусора на сервере**</span><span class="sxs-lookup"><span data-stu-id="c0adb-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="c0adb-177">Уменьшение частоты сбора мусора hello может помочь в некоторых случаях.</span><span class="sxs-lookup"><span data-stu-id="c0adb-177">Reducing hello frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="c0adb-178">В .NET, задайте [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span><span class="sxs-lookup"><span data-stu-id="c0adb-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span></span>
6. <span data-ttu-id="c0adb-179">**Реализация интервала задержки для RetryAfter**</span><span class="sxs-lookup"><span data-stu-id="c0adb-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="c0adb-180">Во время проверки производительности следует увеличивать нагрузку до тех пор, пока регулирование не будет выполняться при небольшой частоте запросов.</span><span class="sxs-lookup"><span data-stu-id="c0adb-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="c0adb-181">Если регулирование, hello клиентское приложение должно задержки при регулировании для hello сервер указан интервал повтора.</span><span class="sxs-lookup"><span data-stu-id="c0adb-181">If throttled, hello client application should backoff on throttle for hello server-specified retry interval.</span></span> <span data-ttu-id="c0adb-182">Этом соблюдаются отсрочки hello гарантирует затрачиваемое минимальный объем времени ожидания между повторными попытками.</span><span class="sxs-lookup"><span data-stu-id="c0adb-182">Respecting hello backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="c0adb-183">Поддержка политики повтора включено в версии 1.8.0 и выше для hello DocumentDB [.NET](documentdb-sdk-dotnet.md) и [Java](documentdb-sdk-java.md), версии 1.9.0 и выше для hello [Node.js](documentdb-sdk-node.md) и [ Python](documentdb-sdk-python.md), и для всех поддерживаемых версий hello [.NET Core](documentdb-sdk-dotnet-core.md) пакеты SDK.</span><span class="sxs-lookup"><span data-stu-id="c0adb-183">Retry policy support is included in Version 1.8.0 and above of hello DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of hello [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of hello [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="c0adb-184">Дополнительные сведения см. в разделах [Превышение лимита зарезервированной пропускной способности](request-units.md#RequestRateTooLarge) и [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0adb-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="c0adb-185">**Развертывание рабочей нагрузки клиента**</span><span class="sxs-lookup"><span data-stu-id="c0adb-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="c0adb-186">При тестировании на уровнях высокой пропускной способности (> 50 000 единиц Запросов в секунду), клиентское приложение hello могут стать узким местом hello из-за toohello машины ограниченного исходящий от загрузки ЦП или сети.</span><span class="sxs-lookup"><span data-stu-id="c0adb-186">If you are testing at high throughput levels (>50,000 RU/s), hello client application may become hello bottleneck due toohello machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="c0adb-187">При достижении этой точки можно продолжить toopush hello Cosmos DB учетной записи дальнейшей, горизонтальное масштабирование клиентские приложения по нескольким серверам.</span><span class="sxs-lookup"><span data-stu-id="c0adb-187">If you reach this point, you can continue toopush hello Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="c0adb-188">**Кэширование URI документов для снижения задержки чтения**</span><span class="sxs-lookup"><span data-stu-id="c0adb-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="c0adb-189">Кэшировать идентификаторы URI, по возможности для повышения производительности чтения hello документа.</span><span class="sxs-lookup"><span data-stu-id="c0adb-189">Cache document URIs whenever possible for hello best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="c0adb-190">**Настроить размер страницы приветствия для чтения запросы веб-каналов для повышения производительности**</span><span class="sxs-lookup"><span data-stu-id="c0adb-190">**Tune hello page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="c0adb-191">При выполнении массового чтения документов с помощью веб-канала (например, ReadDocumentFeedAsync) функциональные возможности чтения или при выдаче запроса DocumentDB SQL, hello результаты возвращаются в сегментированном режиме, при слишком большом hello результирующий набор.</span><span class="sxs-lookup"><span data-stu-id="c0adb-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, hello results are returned in a segmented fashion if hello result set is too large.</span></span> <span data-ttu-id="c0adb-192">По умолчанию результаты возвращаются в пакетах (не более 100 элементов и не более 1 МБ в каждом пакете).</span><span class="sxs-lookup"><span data-stu-id="c0adb-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="c0adb-193">tooreduce hello число сетевых циклов приема-передачи требуется tooretrieve все применимые результаты, можно увеличить размер страницы приветствия, с помощью too1000 tooup заголовок запроса x-ms-max-item-count.</span><span class="sxs-lookup"><span data-stu-id="c0adb-193">tooreduce hello number of network round trips required tooretrieve all applicable results, you can increase hello page size using x-ms-max-item-count request header tooup too1000.</span></span> <span data-ttu-id="c0adb-194">В случаях, когда необходимо toodisplay несколько результатов например, если пользовательского интерфейса или приложение API возвращает только 10 приводит время, также может сократиться hello страницы размер too10 tooreduce hello пропускной способности, использованных для операций чтения и запросы.</span><span class="sxs-lookup"><span data-stu-id="c0adb-194">In cases where you need toodisplay only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease hello page size too10 tooreduce hello throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="c0adb-195">Можно также задать размер страницы приветствия с помощью доступных пакетов SDK DB Cosmos "hello".</span><span class="sxs-lookup"><span data-stu-id="c0adb-195">You may also set hello page size using hello available Cosmos DB SDKs.</span></span>  <span data-ttu-id="c0adb-196">Например:</span><span class="sxs-lookup"><span data-stu-id="c0adb-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="c0adb-197">**Увеличение количества потоков или задач**</span><span class="sxs-lookup"><span data-stu-id="c0adb-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="c0adb-198">В разделе [увеличить число потоков или задач](#increase-threads) в hello раздел «сеть».</span><span class="sxs-lookup"><span data-stu-id="c0adb-198">See [Increase number of threads/tasks](#increase-threads) in hello Networking section.</span></span>

11. <span data-ttu-id="c0adb-199">**Использование 64-разрядных хост-процессов**</span><span class="sxs-lookup"><span data-stu-id="c0adb-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="c0adb-200">Hello DocumentDB SDK работает в 32-разрядный процесс, при использовании DocumentDB .NET SDK версии 1.11.4 и выше.</span><span class="sxs-lookup"><span data-stu-id="c0adb-200">hello DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="c0adb-201">Но если вы используете запросы между секциями, то для повышения производительности мы рекомендуем использовать 64-разрядные хост-процессы.</span><span class="sxs-lookup"><span data-stu-id="c0adb-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="c0adb-202">следующие типы приложений Hello иметь 32-разрядного сервера обработки по умолчанию hello, поэтому в порядке toochange, too64-разрядной, выполните следующие действия, на основе типа приложения hello:</span><span class="sxs-lookup"><span data-stu-id="c0adb-202">hello following types of applications have 32-bit host process as hello default, so in order toochange that too64-bit, follow these steps based on hello type of your application:</span></span>

    - <span data-ttu-id="c0adb-203">Для исполняемых приложений, это можно сделать, сняв флажок hello **предпочитать 32-разрядных** параметр в hello **свойства проекта** в hello окна **построения** вкладки.</span><span class="sxs-lookup"><span data-stu-id="c0adb-203">For Executable applications, this can be done by unchecking hello **Prefer 32-bit** option in hello **Project Properties** window, on hello **Build** tab.</span></span>

    - <span data-ttu-id="c0adb-204">VSTest создана на основе тестовых проектов, это можно сделать, выбрав **тестирования**->**параметров тестирования**->**по умолчанию архитектуру процессора, как X64**, из hello **Visual Studio Test** пункт меню.</span><span class="sxs-lookup"><span data-stu-id="c0adb-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from hello **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="c0adb-205">Для локально развернутых веб-приложений ASP.NET, это можно сделать, проверив hello **используйте hello 64-разрядной версии служб IIS Express для веб-сайтов и проектов**в разделе **средства** ->  **Параметры**->**проекты и решения**->**веб-проектов**.</span><span class="sxs-lookup"><span data-stu-id="c0adb-205">For locally deployed ASP.NET Web applications, this can be done by checking hello **Use hello 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="c0adb-206">Для веб-приложений ASP.NET развернутое в Azure, это можно сделать, выбрав hello **платформа как 64-разрядных** в hello **параметры приложения** на hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="c0adb-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing hello **Platform as 64-bit** in hello **Application Settings** on hello Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="c0adb-207">Политика индексации</span><span class="sxs-lookup"><span data-stu-id="c0adb-207">Indexing Policy</span></span>
1. <span data-ttu-id="c0adb-208">**Использование отложенного индексирования для увеличения скорости приема документов во время пиковой нагрузки**</span><span class="sxs-lookup"><span data-stu-id="c0adb-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="c0adb-209">Cosmos DB позволяет toospecify — на уровне коллекции hello — политика индексирования, благодаря чему можно toochoose, если нужно hello документы в коллекции toobe, автоматически индексируется или нет.</span><span class="sxs-lookup"><span data-stu-id="c0adb-209">Cosmos DB allows you toospecify – at hello collection level – an indexing policy, which enables you toochoose if you want hello documents in a collection toobe automatically indexed or not.</span></span>  <span data-ttu-id="c0adb-210">Кроме того, можно выбрать синхронное (согласованное) или асинхронное (отложенное) обновления индекса.</span><span class="sxs-lookup"><span data-stu-id="c0adb-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="c0adb-211">По умолчанию hello индекс обновляется синхронно для каждой вставки, замены или удаления коллекции toohello документа.</span><span class="sxs-lookup"><span data-stu-id="c0adb-211">By default, hello index is updated synchronously on each insert, replace, or delete of a document toohello collection.</span></span> <span data-ttu-id="c0adb-212">Синхронно toohonor запросы hello включает режим hello же [уровень согласованности](consistency-levels.md) , что и hello считывает документа без задержки для hello индекса слишком «Догнать».</span><span class="sxs-lookup"><span data-stu-id="c0adb-212">Synchronously mode enables hello queries toohonor hello same [consistency level](consistency-levels.md) as that of hello document reads without any delay for hello index too“catch up".</span></span>

    <span data-ttu-id="c0adb-213">Отложенного индексирования может рассматриваться как для сценариев, в которых данные записываются в пакетами и требуется tooamortize hello работ tooindex содержимого через более длительный период времени.</span><span class="sxs-lookup"><span data-stu-id="c0adb-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want tooamortize hello work required tooindex content over a longer period of time.</span></span> <span data-ttu-id="c0adb-214">Отложенного индексирования можно также toouse вашей эффективно подготовить пропускной способности serve запросов и записи в часы пик с минимальной задержкой.</span><span class="sxs-lookup"><span data-stu-id="c0adb-214">Lazy indexing also allows you toouse your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="c0adb-215">Это важные toonote, однако, при включении отложенного индексирования результаты запроса, согласованным независимо от уровня достоверности hello, настроенных для учетной записи Cosmos DB hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-215">It is important toonote, however, that when lazy indexing is enabled, query results are eventually consistent regardless of hello consistency level configured for hello Cosmos DB account.</span></span>

    <span data-ttu-id="c0adb-216">Таким образом, согласованный режим индексирования (IndexingPolicy.IndexingMode установлен tooConsistent) влечет за собой наибольшее издержки единицы запрос hello каждой операции записи во время индексирования (IndexingPolicy.IndexingMode установлен tooLazy) режиме и не индексирования Lazy (IndexingPolicy.Automatic установлен tooFalse) во время записи hello ноль индексирования стоимостью.</span><span class="sxs-lookup"><span data-stu-id="c0adb-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set tooConsistent) incurs hello highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set tooLazy) and no indexing (IndexingPolicy.Automatic is set tooFalse) have zero indexing cost at hello time of write.</span></span>
2. <span data-ttu-id="c0adb-217">**Увеличение скорости выполнения операций записи посредством исключения неиспользуемых путей из индексирования**</span><span class="sxs-lookup"><span data-stu-id="c0adb-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="c0adb-218">Политика индексирования Cosmos DB также позволяет toospecify документов tooinclude пути или исключить из индексирования за счет использования путей индексирования (IndexingPolicy.IncludedPaths и IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="c0adb-218">Cosmos DB’s indexing policy also allows you toospecify which document paths tooinclude or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="c0adb-219">Используйте Hello путей индексирования можно повысить производительность записи и уменьшить хранилище индексирования для сценариев, в какой hello шаблоны запросов известны заранее, как индексирования затраты являются напрямую друг с другом toohello число уникальных пути, проиндексированные, предлагающие.</span><span class="sxs-lookup"><span data-stu-id="c0adb-219">hello use of indexing paths can offer improved write performance and lower index storage for scenarios in which hello query patterns are known beforehand, as indexing costs are directly correlated toohello number of unique paths indexed.</span></span>  <span data-ttu-id="c0adb-220">Hello после кода показано, как tooexclude целый раздел hello документы (так)</span><span class="sxs-lookup"><span data-stu-id="c0adb-220">For example, hello following code shows how tooexclude an entire section of hello documents (a.k.a.</span></span> <span data-ttu-id="c0adb-221">поддерево) из индексирования с помощью hello «*» подстановочный знак.</span><span class="sxs-lookup"><span data-stu-id="c0adb-221">a subtree) from indexing using hello "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="c0adb-222">Дополнительные сведения см. в статье [Политики индексации DocumentDB](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="c0adb-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="c0adb-223">Пропускная способность</span><span class="sxs-lookup"><span data-stu-id="c0adb-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="c0adb-224">**Измерение и настройка расхода единиц запроса/повторного использования**</span><span class="sxs-lookup"><span data-stu-id="c0adb-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="c0adb-225">Cosmos DB предлагает широкий набор операций базы данных, включая реляционные и иерархические запросы с определяемые пользователем функции, хранимые процедуры и триггеры — все работы в документах hello в пределах базы данных коллекции.</span><span class="sxs-lookup"><span data-stu-id="c0adb-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on hello documents within a database collection.</span></span> <span data-ttu-id="c0adb-226">Hello затрат, связанных с каждым из этих операций различается в зависимости от hello ЦП, ввода-ВЫВОДА и памяти, необходимый toocomplete hello операции.</span><span class="sxs-lookup"><span data-stu-id="c0adb-226">hello cost associated with each of these operations varies based on hello CPU, IO, and memory required toocomplete hello operation.</span></span> <span data-ttu-id="c0adb-227">Вместо обдумывания и управление ресурсами оборудования можно считать запрос единицы (RU) одного измерения для tooperform необходимые ресурсы hello различные операции с базой данных и службы по запросу приложения.</span><span class="sxs-lookup"><span data-stu-id="c0adb-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for hello resources required tooperform various database operations and service an application request.</span></span>

    <span data-ttu-id="c0adb-228">[Единиц запросов](request-units.md) подготавливаются для каждой учетной записи базы данных на основе количества единиц емкости, приобретаемых в hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-228">[Request units](request-units.md) are provisioned for each database account based on hello number of capacity units that you purchase.</span></span> <span data-ttu-id="c0adb-229">Удельный расход единиц запросов оценивается в расчете на одну секунду.</span><span class="sxs-lookup"><span data-stu-id="c0adb-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="c0adb-230">Приложения, которые превышают единицы подготовленного запроса hello интенсивность для их учетных записей ограничено до частота hello падает ниже hello уровень зарезервированных для учетной записи hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-230">Applications that exceed hello provisioned request unit rate for their account is limited until hello rate drops below hello reserved level for hello account.</span></span> <span data-ttu-id="c0adb-231">Если ваше приложение требует более высокого уровня пропускной способности, вы можете приобрести дополнительные единицы емкости.</span><span class="sxs-lookup"><span data-stu-id="c0adb-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="c0adb-232">Hello сложность запроса влияет на количество единиц запроса используются для операции.</span><span class="sxs-lookup"><span data-stu-id="c0adb-232">hello complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="c0adb-233">Hello количество предикатов, характер hello предикаты, количество определяемых пользователем функций и hello размер набора данных источника hello, все влияют на стоимость hello операций запросов.</span><span class="sxs-lookup"><span data-stu-id="c0adb-233">hello number of predicates, nature of hello predicates, number of UDFs, and hello size of hello source data set all influence hello cost of query operations.</span></span>

    <span data-ttu-id="c0adb-234">издержки hello toomeasure любой операции (Создание, обновление или удаление), проверьте заголовок x-ms запрос платы hello (или hello эквивалентное свойство RequestCharge в ResourceResponse<T> или FeedResponse<T> в hello .NET SDK) toomeasure Hello количество единиц запроса, используемые в этих операций.</span><span class="sxs-lookup"><span data-stu-id="c0adb-234">toomeasure hello overhead of any operation (create, update, or delete), inspect hello x-ms-request-charge header (or hello equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in hello .NET SDK) toomeasure hello number of request units consumed by these operations.</span></span>

    ```C#
    // Measure hello performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure hello performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="c0adb-235">Hello запроса возвращается в этом заголовке взимается часть вашей пропускная способность (т. е. RUs 2000 / сек).</span><span class="sxs-lookup"><span data-stu-id="c0adb-235">hello request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="c0adb-236">Например если hello предыдущий запрос возвращает 1 КБ 1000-документы, стоимость hello hello операции — 1000.</span><span class="sxs-lookup"><span data-stu-id="c0adb-236">For example, if hello preceding query returns 1000 1KB-documents, hello cost of hello operation is 1000.</span></span> <span data-ttu-id="c0adb-237">Таким образом в течение одной секунды, hello сервер принимает только два таких запросов до регулирования последующих запросов.</span><span class="sxs-lookup"><span data-stu-id="c0adb-237">As such, within one second, hello server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="c0adb-238">Дополнительные сведения см. в разделе [единиц запросов](request-units.md) и hello [калькулятора единица запроса](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="c0adb-238">For more information, see [Request units](request-units.md) and hello [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="c0adb-239">**Обработка ограничения скорости/ слишком высокая частота запросов**</span><span class="sxs-lookup"><span data-stu-id="c0adb-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="c0adb-240">Когда клиент пытается tooexceed hello зарезервированную полосу пропускания для учетной записи, нет без снижения производительности на сервере hello и без использования пропускной способности за пределы уровня hello зарезервировано.</span><span class="sxs-lookup"><span data-stu-id="c0adb-240">When a client attempts tooexceed hello reserved throughput for an account, there is no performance degradation at hello server and no use of throughput capacity beyond hello reserved level.</span></span> <span data-ttu-id="c0adb-241">Hello server предварительно завершается запрос hello с RequestRateTooLarge (код состояния HTTP 429) и возврата hello заголовок x-ms повтора после ms, указывающий, что время ожидания перед повторным выполнением запроса hello hello количество времени, в миллисекундах, которое hello пользователя.</span><span class="sxs-lookup"><span data-stu-id="c0adb-241">hello server will preemptively end hello request with RequestRateTooLarge (HTTP status code 429) and return hello x-ms-retry-after-ms header indicating hello amount of time, in milliseconds, that hello user must wait before reattempting hello request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="c0adb-242">пакеты SDK Hello все неявно перехватывать этот ответ, учитывают hello сервер указан заголовок retry-after и повторить запрос hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-242">hello SDKs all implicitly catch this response, respect hello server-specified retry-after header, and retry hello request.</span></span> <span data-ttu-id="c0adb-243">Если ваша учетная запись осуществляется параллельно несколькими клиентами, будет успешным hello следующей попытки.</span><span class="sxs-lookup"><span data-stu-id="c0adb-243">Unless your account is being accessed concurrently by multiple clients, hello next retry will succeed.</span></span>

    <span data-ttu-id="c0adb-244">Если у вас есть несколько клиентов Суммарно постоянно превысила частота запросов hello, hello число повторов в настоящее время набор too9 внутренним образом hello клиента может оказаться недостаточно; в таком случае клиент hello создает DocumentClientException с приложением toohello 429 код состояния.</span><span class="sxs-lookup"><span data-stu-id="c0adb-244">If you have more than one client cumulatively operating consistently above hello request rate, hello default retry count currently set too9 internally by hello client may not suffice; in this case, hello client throws a DocumentClientException with status code 429 toohello application.</span></span> <span data-ttu-id="c0adb-245">можно изменить число повторных попыток по умолчанию Hello с hello параметр RetryOptions на экземпляре ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-245">hello default retry count can be changed by setting hello RetryOptions on hello ConnectionPolicy instance.</span></span> <span data-ttu-id="c0adb-246">По умолчанию hello DocumentClientException с кодом состояния 429 возвращается после совокупное время ожидания 30 секунд, если запрос hello продолжается toooperate выше частота запросов hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-246">By default, hello DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if hello request continues toooperate above hello request rate.</span></span> <span data-ttu-id="c0adb-247">Это происходит, даже если текущее число попыток hello не меньше числа повторных попыток max hello, будь то по умолчанию hello 9 или пользовательские значения.</span><span class="sxs-lookup"><span data-stu-id="c0adb-247">This occurs even when hello current retry count is less than hello max retry count, be it hello default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="c0adb-248">Во время автоматической hello характер повторения tooimprove устойчивости и удобство использования для hello большинство приложений, которые могут быть в odds при выполнении тестов производительности, особенно если измерение задержки.</span><span class="sxs-lookup"><span data-stu-id="c0adb-248">While hello automated retry behavior helps tooimprove resiliency and usability for hello most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="c0adb-249">Hello клиента наблюдается задержка будет скачки, если эксперимента hello достигает сервера регулирования hello и вызывает клиент hello повтора toosilently SDK.</span><span class="sxs-lookup"><span data-stu-id="c0adb-249">hello client-observed latency will spike if hello experiment hits hello server throttle and causes hello client SDK toosilently retry.</span></span> <span data-ttu-id="c0adb-250">Задержка tooavoid резко возрастает во время экспериментов с производительностью, издержки hello мер возвращаются при выполнении каждой операции и убедитесь, что запросы работают под зарезервированные частота hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-250">tooavoid latency spikes during performance experiments, measure hello charge returned by each operation and ensure that requests are operating below hello reserved request rate.</span></span> <span data-ttu-id="c0adb-251">Дополнительные сведения см. в статье [Единицы запросов в DocumentDB](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="c0adb-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="c0adb-252">**Использование меньших документов для более высокой пропускной способности**</span><span class="sxs-lookup"><span data-stu-id="c0adb-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="c0adb-253">Hello запроса (т. е. стоимость обработки запросов) для данной операции взимается непосредственно связанной toohello размер документа hello.</span><span class="sxs-lookup"><span data-stu-id="c0adb-253">hello request charge (i.e. request processing cost) of a given operation is directly correlated toohello size of hello document.</span></span> <span data-ttu-id="c0adb-254">За операции с большими документами взимается больше единиц запроса, чем за операции с мелкими документами.</span><span class="sxs-lookup"><span data-stu-id="c0adb-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c0adb-255">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="c0adb-255">Next steps</span></span>
<span data-ttu-id="c0adb-256">Образец приложения, используемого tooevaluate Cosmos DB для сценариев высокой производительности на нескольких клиентских компьютерах, см. [производительность и масштабируемость, тестирование с помощью Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="c0adb-256">For a sample application used tooevaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="c0adb-257">Toolearn Дополнительные сведения о разработке приложений для обеспечения масштабирования и высокой производительности см. также [секционирование и масштабирование в базе данных Azure Cosmos](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="c0adb-257">Also, toolearn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
