---
title: "Понятия и модель ресурсов в Azure Cosmos DB | Документация Майкрософт"
description: "Описание иерархической модели базы данных, коллекций, определяемых пользователем функций (UDF), документов, разрешений на управление ресурсами и т. д."
keywords: "Иерархическая модель, cosmosdb, azure, Microsoft Azure"
services: cosmos-db
documentationcenter: 
author: AndrewHoh
manager: jhubbard
editor: monicar
ms.assetid: ef9d5c0c-0867-4317-bb1b-98e219799fd5
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/24/2017
ms.author: anhoh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 8051742c7c368d1ed84bcd90ab75b20f62105e2f
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-cosmos-db-hierarchical-resource-model-and-core-concepts"></a><span data-ttu-id="93d65-104">Ключевые понятия и иерархическая модель ресурсов в Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="93d65-104">Azure Cosmos DB hierarchical resource model and core concepts</span></span>
<span data-ttu-id="93d65-105">Сущности базы данных, которыми управляет Azure Cosmos DB, называются **ресурсами**.</span><span class="sxs-lookup"><span data-stu-id="93d65-105">The database entities that Azure Cosmos DB manages are referred to as **resources**.</span></span> <span data-ttu-id="93d65-106">Каждый ресурс однозначно идентифицируется своими логическим URI.</span><span class="sxs-lookup"><span data-stu-id="93d65-106">Each resource is uniquely identified by a logical URI.</span></span> <span data-ttu-id="93d65-107">Разработчики могут взаимодействовать с ресурсами, используя стандартные команды HTTP, заголовки запросов/ответов и коды состояний.</span><span class="sxs-lookup"><span data-stu-id="93d65-107">You can interact with the resources using standard HTTP verbs, request/response headers and status codes.</span></span> 

<span data-ttu-id="93d65-108">Прочитав данную статью, вы сможете ответить на следующие вопросы.</span><span class="sxs-lookup"><span data-stu-id="93d65-108">By reading this article, you'll be able to answer the following questions:</span></span>

* <span data-ttu-id="93d65-109">Что такое модель ресурсов Cosmos DB?</span><span class="sxs-lookup"><span data-stu-id="93d65-109">What is Cosmos DB's resource model?</span></span>
* <span data-ttu-id="93d65-110">Чем ресурсы, определяемые системой, отличаются от ресурсов, определяемых пользователем?</span><span class="sxs-lookup"><span data-stu-id="93d65-110">What are system defined resources as opposed to user defined resources?</span></span>
* <span data-ttu-id="93d65-111">Как получить доступ к ресурсу?</span><span class="sxs-lookup"><span data-stu-id="93d65-111">How do I address a resource?</span></span>
* <span data-ttu-id="93d65-112">Как работать с коллекциями?</span><span class="sxs-lookup"><span data-stu-id="93d65-112">How do I work with collections?</span></span>
* <span data-ttu-id="93d65-113">Как работать с хранимыми процедурами, триггерами и пользовательскими функциями?</span><span class="sxs-lookup"><span data-stu-id="93d65-113">How do I work with stored procedures, triggers and User Defined Functions (UDFs)?</span></span>

## <a name="hierarchical-resource-model"></a><span data-ttu-id="93d65-114">Иерархическая модель ресурсов</span><span class="sxs-lookup"><span data-stu-id="93d65-114">Hierarchical resource model</span></span>
<span data-ttu-id="93d65-115">Как показано на следующей схеме, иерархическая **модель ресурсов** Cosmos DB состоит из наборов ресурсов в учетной записи базы данных, каждый из которых имеет логический постоянный идентификатор URI.</span><span class="sxs-lookup"><span data-stu-id="93d65-115">As the following diagram illustrates, the Cosmos DB hierarchical **resource model** consists of sets of resources under a database account, each addressable via a logical and stable URI.</span></span> <span data-ttu-id="93d65-116">Набор ресурсов в этой статье называется **каналом** .</span><span class="sxs-lookup"><span data-stu-id="93d65-116">A set of resources will be referred to as a **feed** in this article.</span></span> 

> [!NOTE]
> <span data-ttu-id="93d65-117">Azure Cosmos DB предлагает весьма эффективный протокол TCP, который также является API-интерфейсом RESTful в своей коммуникационной модели, доступной с помощью [клиентского API для DocumentDB .NET](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="93d65-117">Azure Cosmos DB offers a highly efficient TCP protocol which is also RESTful in its communication model, available through the [DocumentDB .NET client API](documentdb-sdk-dotnet.md).</span></span>
> 
> 

<span data-ttu-id="93d65-118">![Иерархическая модель ресурсов в Azure Cosmos DB][1]</span><span class="sxs-lookup"><span data-stu-id="93d65-118">![Azure Cosmos DB hierarchical resource model][1]</span></span>  
<span data-ttu-id="93d65-119">**Иерархическая модель ресурсов.**</span><span class="sxs-lookup"><span data-stu-id="93d65-119">**Hierarchical resource model**</span></span>   

<span data-ttu-id="93d65-120">Чтобы приступить к работе с ресурсами, необходимо [создать учетную запись базы данных](create-documentdb-dotnet.md) с помощью подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="93d65-120">To start working with resources, you must [create a database account](create-documentdb-dotnet.md) using your Azure subscription.</span></span> <span data-ttu-id="93d65-121">Учетная запись базы данных может состоять из набора **баз данных**, каждая из которых содержит несколько **коллекций**, каждая из которых, в свою очередь, содержит **хранимые процедуры, триггеры, определяемые пользователем функции, документы** и соответствующие **вложения**.</span><span class="sxs-lookup"><span data-stu-id="93d65-121">A database account can consist of a set of **databases**, each containing multiple **collections**, each of which in turn contain **stored procedures, triggers, UDFs, documents** and related **attachments**.</span></span> <span data-ttu-id="93d65-122">С базой данных также связаны **пользователи**, каждый из которых обладает набором **разрешений** для доступа к коллекциям, хранимым процедурам, триггерам, пользовательским функциям, документам или вложениям.</span><span class="sxs-lookup"><span data-stu-id="93d65-122">A database also has associated **users**, each with a set of **permissions** to access collections, stored procedures, triggers, UDFs, documents or attachments.</span></span> <span data-ttu-id="93d65-123">В то время как базы данных, пользователи, разрешения и коллекции являются определяемыми системой ресурсами с известными схемами, документы и вложения содержат произвольный, определяемый пользователем контент в формате JSON.</span><span class="sxs-lookup"><span data-stu-id="93d65-123">While databases, users, permissions and collections are system-defined resources with well-known schemas, documents and attachments contain arbitrary, user defined JSON content.</span></span>  

| <span data-ttu-id="93d65-124">Resource (Ресурс)</span><span class="sxs-lookup"><span data-stu-id="93d65-124">Resource</span></span> | <span data-ttu-id="93d65-125">Описание</span><span class="sxs-lookup"><span data-stu-id="93d65-125">Description</span></span> |
| --- | --- |
| <span data-ttu-id="93d65-126">Учетная запись базы данных</span><span class="sxs-lookup"><span data-stu-id="93d65-126">Database account</span></span> |<span data-ttu-id="93d65-127">Учетная запись базы данных связана с набором баз и определенным местом в хранилище больших двоичных объектов для хранения вложений.</span><span class="sxs-lookup"><span data-stu-id="93d65-127">A database account is associated with a set of databases and a fixed amount of blob storage for attachments.</span></span> <span data-ttu-id="93d65-128">Вы можете создать одну или несколько учетных записей базы данных с помощью подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="93d65-128">You can create one or more database accounts using your Azure subscription.</span></span> <span data-ttu-id="93d65-129">Дополнительные сведения см. на нашей [странице цен](https://azure.microsoft.com/pricing/details/cosmos-db/).</span><span class="sxs-lookup"><span data-stu-id="93d65-129">For more information, visit our [pricing page](https://azure.microsoft.com/pricing/details/cosmos-db/).</span></span> |
| <span data-ttu-id="93d65-130">База данных</span><span class="sxs-lookup"><span data-stu-id="93d65-130">Database</span></span> |<span data-ttu-id="93d65-131">База данных представляет собой логический контейнер для хранения документов, разделенных между коллекциями.</span><span class="sxs-lookup"><span data-stu-id="93d65-131">A database is a logical container of document storage partitioned across collections.</span></span> <span data-ttu-id="93d65-132">Она также является контейнером для пользователей.</span><span class="sxs-lookup"><span data-stu-id="93d65-132">It is also a users container.</span></span> |
| <span data-ttu-id="93d65-133">Пользователь</span><span class="sxs-lookup"><span data-stu-id="93d65-133">User</span></span> |<span data-ttu-id="93d65-134">Логическое пространство имен для ограничений разрешений.</span><span class="sxs-lookup"><span data-stu-id="93d65-134">The logical namespace for scoping permissions.</span></span> |
| <span data-ttu-id="93d65-135">Разрешение</span><span class="sxs-lookup"><span data-stu-id="93d65-135">Permission</span></span> |<span data-ttu-id="93d65-136">Маркер проверки подлинности, связанный с пользователем, предоставляет доступ к определенному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="93d65-136">An authorization token associated with a user for access to a specific resource.</span></span> |
| <span data-ttu-id="93d65-137">Коллекция</span><span class="sxs-lookup"><span data-stu-id="93d65-137">Collection</span></span> |<span data-ttu-id="93d65-138">Коллекция представляет собой контейнер документов JSON и связанной логики приложения на JavaScript.</span><span class="sxs-lookup"><span data-stu-id="93d65-138">A collection is a container of JSON documents and the associated JavaScript application logic.</span></span> <span data-ttu-id="93d65-139">Коллекция представляет собой тарифицируемый объект, и его [стоимость](performance-levels.md) определяется связанным с ним уровнем производительности.</span><span class="sxs-lookup"><span data-stu-id="93d65-139">A collection is a billable entity, where the [cost](performance-levels.md) is determined by the performance level associated with the collection.</span></span> <span data-ttu-id="93d65-140">Коллекции могут охватывать один или несколько разделов либо серверов и масштабироваться до практически неограниченных объемов хранилища или пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="93d65-140">Collections can span one or more partitions/servers and can scale to handle practically unlimited volumes of storage or throughput.</span></span> |
| <span data-ttu-id="93d65-141">Хранимая процедура</span><span class="sxs-lookup"><span data-stu-id="93d65-141">Stored Procedure</span></span> |<span data-ttu-id="93d65-142">Логика приложения, написанная на JavaScript, которая зарегистрирована в коллекции и выполняется в транзакции в ядре базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-142">Application logic written in JavaScript which is registered with a collection and transactionally executed within the database engine.</span></span> |
| <span data-ttu-id="93d65-143">Триггер</span><span class="sxs-lookup"><span data-stu-id="93d65-143">Trigger</span></span> |<span data-ttu-id="93d65-144">Логика приложения в виде кода JavaScript, автоматически исполняемого до или после операций вставки, замены и удаления.</span><span class="sxs-lookup"><span data-stu-id="93d65-144">Application logic written in JavaScript executed before or after either an insert, replace or delete operation.</span></span> |
| <span data-ttu-id="93d65-145">Определяемая пользователем функция</span><span class="sxs-lookup"><span data-stu-id="93d65-145">UDF</span></span> |<span data-ttu-id="93d65-146">Логика приложения на языке JavaScript.</span><span class="sxs-lookup"><span data-stu-id="93d65-146">Application logic written in JavaScript.</span></span> <span data-ttu-id="93d65-147">Определяемые пользователем функции (UDF) позволяют моделировать операторы пользовательских запросов и тем самым расширить базовый язык запросов API DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="93d65-147">UDFs enable you to model a custom query operator and thereby extend the core DocumentDB API query language.</span></span> |
| <span data-ttu-id="93d65-148">Документ</span><span class="sxs-lookup"><span data-stu-id="93d65-148">Document</span></span> |<span data-ttu-id="93d65-149">Пользовательский (произвольный) контент JSON.</span><span class="sxs-lookup"><span data-stu-id="93d65-149">User defined (arbitrary) JSON content.</span></span> <span data-ttu-id="93d65-150">По умолчанию, нет необходимости определения схемы или предоставления вторичных индексов для всех документов, добавляемых в коллекцию.</span><span class="sxs-lookup"><span data-stu-id="93d65-150">By default, no schema needs to be defined nor do secondary indices need to be provided for all the documents added to a collection.</span></span> |
| <span data-ttu-id="93d65-151">Вложение</span><span class="sxs-lookup"><span data-stu-id="93d65-151">Attachment</span></span> |<span data-ttu-id="93d65-152">Вложение — это специальный документ, содержащий ссылки и связанные с ним метаданные ко внешним большим двоичным объектам и носителям.</span><span class="sxs-lookup"><span data-stu-id="93d65-152">An attachment is a special document containing references and associated metadata for external blob/media.</span></span> <span data-ttu-id="93d65-153">Разработчик может выбрать, управлять ли большим двоичным объектом с помощью Cosmos DB или хранить его с помощью внешних поставщиков службы BLOB-объектов, таких как OneDrive, Dropbox и т. д.</span><span class="sxs-lookup"><span data-stu-id="93d65-153">The developer can choose to have the blob managed by Cosmos DB or store it with an external blob service provider such as OneDrive, Dropbox, etc.</span></span> |

## <a name="system-vs-user-defined-resources"></a><span data-ttu-id="93d65-154">Системные и пользовательские ресурсы</span><span class="sxs-lookup"><span data-stu-id="93d65-154">System vs. user defined resources</span></span>
<span data-ttu-id="93d65-155">Ресурсы (такие как учетные записи баз данных, базы данных, коллекции, пользователи, разрешения, хранимые процедуры, триггеры и определяемые пользователем функции) имеют статическую схему и называются системными ресурсами.</span><span class="sxs-lookup"><span data-stu-id="93d65-155">Resources such as database accounts, databases, collections, users, permissions, stored procedures, triggers, and UDFs - all have a fixed schema and are called system resources.</span></span> <span data-ttu-id="93d65-156">В отличие от таких ресурсов, как документы и вложения, не имеющих ограничений по схеме, которые являются примерами пользовательских ресурсов.</span><span class="sxs-lookup"><span data-stu-id="93d65-156">In contrast, resources such as documents and attachments have no restrictions on the schema and are examples of user defined resources.</span></span> <span data-ttu-id="93d65-157">В службе Cosmos DB системные и определяемые пользователем ресурсы представляются и управляются как стандартные, совместимые с JSON объекты.</span><span class="sxs-lookup"><span data-stu-id="93d65-157">In Cosmos DB, both system and user defined resources are represented and managed as standard-compliant JSON.</span></span> <span data-ttu-id="93d65-158">Все ресурсы, системные и пользовательские, имеют перечисленные ниже общие свойства.</span><span class="sxs-lookup"><span data-stu-id="93d65-158">All resources, system or user defined, have the following common properties.</span></span>

> [!NOTE]
> <span data-ttu-id="93d65-159">Обратите внимание, что все сгенерированные системой свойства в ресурсах начинаются с символа подчеркивания (_) в представлении JSON.</span><span class="sxs-lookup"><span data-stu-id="93d65-159">Note that all system generated properties in a resource are prefixed with an underscore (_) in their JSON representation.</span></span>
> 
> 

<table>
    <tbody>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-160"><strong>Свойство</strong></span><span class="sxs-lookup"><span data-stu-id="93d65-160"><strong>Property</strong></span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-161"><strong>Устанавливаемое пользователем или генерируемое системой?</strong></span><span class="sxs-lookup"><span data-stu-id="93d65-161"><strong>User settable or system generated?</strong></span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-162"><strong>Назначение</strong></span><span class="sxs-lookup"><span data-stu-id="93d65-162"><strong>Purpose</strong></span></span></p></td>
        </tr>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-163">_rid</span><span class="sxs-lookup"><span data-stu-id="93d65-163">_rid</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-164">Генерируемое системой</span><span class="sxs-lookup"><span data-stu-id="93d65-164">System generated</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-165">Генерируемый системой уникальный иерархический идентификатор ресурса</span><span class="sxs-lookup"><span data-stu-id="93d65-165">System generated, unique and hierarchical identifier of the resource</span></span></p></td>
        </tr>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-166">_etag</span><span class="sxs-lookup"><span data-stu-id="93d65-166">_etag</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-167">Генерируемое системой</span><span class="sxs-lookup"><span data-stu-id="93d65-167">System generated</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-168">etag ресурса, необходимый для управления оптимистичным параллелизмом</span><span class="sxs-lookup"><span data-stu-id="93d65-168">etag of the resource required for optimistic concurrency control</span></span></p></td>
        </tr>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-169">_ts</span><span class="sxs-lookup"><span data-stu-id="93d65-169">_ts</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-170">Генерируемое системой</span><span class="sxs-lookup"><span data-stu-id="93d65-170">System generated</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-171">Метка времени последнего обновления ресурса</span><span class="sxs-lookup"><span data-stu-id="93d65-171">Last updated timestamp of the resource</span></span></p></td>
        </tr>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-172">_self</span><span class="sxs-lookup"><span data-stu-id="93d65-172">_self</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-173">Генерируемое системой</span><span class="sxs-lookup"><span data-stu-id="93d65-173">System generated</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-174">Уникальный адресуемый URI ресурса</span><span class="sxs-lookup"><span data-stu-id="93d65-174">Unique addressable URI of the resource</span></span></p></td>
        </tr>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-175">id</span><span class="sxs-lookup"><span data-stu-id="93d65-175">id</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-176">Генерируемое системой</span><span class="sxs-lookup"><span data-stu-id="93d65-176">System generated</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-177">Определяемое пользователем уникальное имя ресурса (с тем же значением ключа секции).</span><span class="sxs-lookup"><span data-stu-id="93d65-177">User defined unique name of the resource (with the same partition key value).</span></span> <span data-ttu-id="93d65-178">Если пользователь не укажет идентификатор, идентификатор будет создан системой.</span><span class="sxs-lookup"><span data-stu-id="93d65-178">If the user does not specify an id, an id will be system generated</span></span></p></td>
        </tr>
    </tbody>
</table>

### <a name="wire-representation-of-resources"></a><span data-ttu-id="93d65-179">Сетевое представление ресурсов</span><span class="sxs-lookup"><span data-stu-id="93d65-179">Wire representation of resources</span></span>
<span data-ttu-id="93d65-180">Cosmos DB не требует никаких закрытых расширений для стандарта JSON или специальных кодировок. Служба работает со стандартными, совместимыми с JSON документами.</span><span class="sxs-lookup"><span data-stu-id="93d65-180">Cosmos DB does not mandate any proprietary extensions to the JSON standard or special encodings; it works with standard compliant JSON documents.</span></span>  

### <a name="addressing-a-resource"></a><span data-ttu-id="93d65-181">Адресация ресурса</span><span class="sxs-lookup"><span data-stu-id="93d65-181">Addressing a resource</span></span>
<span data-ttu-id="93d65-182">Все ресурсы можно адресовать по URI.</span><span class="sxs-lookup"><span data-stu-id="93d65-182">All resources are URI addressable.</span></span> <span data-ttu-id="93d65-183">Значение свойства **_self** представляет относительный универсальный код ресурса (URI) ресурса.</span><span class="sxs-lookup"><span data-stu-id="93d65-183">The value of the **_self** property of a resource represents the relative URI of the resource.</span></span> <span data-ttu-id="93d65-184">Формат универсального кода ресурса (URI) состоит из сегментов пути /\<веб-канал\>/{_rid}.</span><span class="sxs-lookup"><span data-stu-id="93d65-184">The format of the URI consists of the /\<feed\>/{_rid} path segments:</span></span>  

| <span data-ttu-id="93d65-185">Значение свойства _self</span><span class="sxs-lookup"><span data-stu-id="93d65-185">Value of the _self</span></span> | <span data-ttu-id="93d65-186">Описание</span><span class="sxs-lookup"><span data-stu-id="93d65-186">Description</span></span> |
| --- | --- |
| <span data-ttu-id="93d65-187">/dbs</span><span class="sxs-lookup"><span data-stu-id="93d65-187">/dbs</span></span> |<span data-ttu-id="93d65-188">Канал баз данных под учетной записью базы данных</span><span class="sxs-lookup"><span data-stu-id="93d65-188">Feed of databases under a database account</span></span> |
| <span data-ttu-id="93d65-189">/dbs/{dbName}</span><span class="sxs-lookup"><span data-stu-id="93d65-189">/dbs/{dbName}</span></span> |<span data-ttu-id="93d65-190">Базы данных с идентификатором, соответствующим значению {dbName}</span><span class="sxs-lookup"><span data-stu-id="93d65-190">Database with an id matching the value {dbName}</span></span> |
| <span data-ttu-id="93d65-191">/dbs/{dbName}/colls/</span><span class="sxs-lookup"><span data-stu-id="93d65-191">/dbs/{dbName}/colls/</span></span> |<span data-ttu-id="93d65-192">Канал коллекций в базе данных</span><span class="sxs-lookup"><span data-stu-id="93d65-192">Feed of collections under a database</span></span> |
| <span data-ttu-id="93d65-193">/dbs/{dbName}/colls/{collName}</span><span class="sxs-lookup"><span data-stu-id="93d65-193">/dbs/{dbName}/colls/{collName}</span></span> |<span data-ttu-id="93d65-194">Коллекция с идентификатором, соответствующим значению {collName}</span><span class="sxs-lookup"><span data-stu-id="93d65-194">Collection with an id matching the value {collName}</span></span> |
| <span data-ttu-id="93d65-195">/dbs/{dbName}/colls/{collName}/docs</span><span class="sxs-lookup"><span data-stu-id="93d65-195">/dbs/{dbName}/colls/{collName}/docs</span></span> |<span data-ttu-id="93d65-196">Канал документов в коллекции</span><span class="sxs-lookup"><span data-stu-id="93d65-196">Feed of documents under a collection</span></span> |
| <span data-ttu-id="93d65-197">/dbs/{dbName}/colls/{collName}/docs/{docId}</span><span class="sxs-lookup"><span data-stu-id="93d65-197">/dbs/{dbName}/colls/{collName}/docs/{docId}</span></span> |<span data-ttu-id="93d65-198">Документ с идентификатором, соответствующим значению {doc}</span><span class="sxs-lookup"><span data-stu-id="93d65-198">Document with an id matching the value {doc}</span></span> |
| <span data-ttu-id="93d65-199">/dbs/{dbName}/users/</span><span class="sxs-lookup"><span data-stu-id="93d65-199">/dbs/{dbName}/users/</span></span> |<span data-ttu-id="93d65-200">Канал пользователей в базе данных</span><span class="sxs-lookup"><span data-stu-id="93d65-200">Feed of users under a database</span></span> |
| <span data-ttu-id="93d65-201">/dbs/{dbName}/users/{userId}</span><span class="sxs-lookup"><span data-stu-id="93d65-201">/dbs/{dbName}/users/{userId}</span></span> |<span data-ttu-id="93d65-202">Пользователь с идентификатором, соответствующим значению {user}</span><span class="sxs-lookup"><span data-stu-id="93d65-202">User with an id matching the value {user}</span></span> |
| <span data-ttu-id="93d65-203">/dbs/{dbName}/users/{userId}/permissions</span><span class="sxs-lookup"><span data-stu-id="93d65-203">/dbs/{dbName}/users/{userId}/permissions</span></span> |<span data-ttu-id="93d65-204">Канал разрешений для пользователя</span><span class="sxs-lookup"><span data-stu-id="93d65-204">Feed of permissions under a user</span></span> |
| <span data-ttu-id="93d65-205">/dbs/{dbName}/users/{userId}/permissions/{permissionId}</span><span class="sxs-lookup"><span data-stu-id="93d65-205">/dbs/{dbName}/users/{userId}/permissions/{permissionId}</span></span> |<span data-ttu-id="93d65-206">Разрешение с идентификатором, соответствующим значению {permission}</span><span class="sxs-lookup"><span data-stu-id="93d65-206">Permission with an id matching the value {permission}</span></span> |

<span data-ttu-id="93d65-207">Каждый ресурс имеет уникальное имя, которое определяется пользователем и используется в качестве идентификатора ресурса.</span><span class="sxs-lookup"><span data-stu-id="93d65-207">Each resource has a unique user defined name exposed via the id property.</span></span> <span data-ttu-id="93d65-208">Примечание. Если пользователь не укажет идентификатор документа, то поддерживаемые пакеты SDK автоматически создадут для этого документа уникальный идентификатор.</span><span class="sxs-lookup"><span data-stu-id="93d65-208">Note: for documents, if the user does not specify an id, our supported SDKs will automatically generate a unique id for the document.</span></span> <span data-ttu-id="93d65-209">Идентификатор является определяемой пользователем строкой длиной до 256 символов, которая уникальна в контексте конкретного родительского ресурса.</span><span class="sxs-lookup"><span data-stu-id="93d65-209">The id is a user defined string, of up to 256 characters that is unique within the context of a specific parent resource.</span></span> 

<span data-ttu-id="93d65-210">Каждый ресурс также имеет иерархический идентификатор ресурсов, генерируемый системой (также известный как RID), который доступен через свойство _rid.</span><span class="sxs-lookup"><span data-stu-id="93d65-210">Each resource also has a system generated hierarchical resource identifier (also referred to as an RID), which is available via the _rid property.</span></span> <span data-ttu-id="93d65-211">RID кодирует всю иерархию данного ресурса, и это удобное внутреннее представление, которое используется для обеспечения ссылочной целостности распределенным способом.</span><span class="sxs-lookup"><span data-stu-id="93d65-211">The RID encodes the entire hierarchy of a given resource and it is a convenient internal representation used to enforce referential integrity in a distributed manner.</span></span> <span data-ttu-id="93d65-212">RID является уникальным в пределах учетной записи базы данных и используется службой Cosmos DB для эффективной маршрутизации без перекрестного поиска по секциям.</span><span class="sxs-lookup"><span data-stu-id="93d65-212">The RID is unique within a database account and it is internally used by Cosmos DB for efficient routing without requiring cross partition lookups.</span></span> <span data-ttu-id="93d65-213">Значения свойств _self и _rid являются альтернативным и каноническим представлениями ресурса.</span><span class="sxs-lookup"><span data-stu-id="93d65-213">The values of the _self and the  _rid properties are both alternate and canonical representations of a resource.</span></span> 

<span data-ttu-id="93d65-214">Интерфейсы REST API поддерживают адресацию ресурсов и маршрутизацию запросов по свойствам id и _rid.</span><span class="sxs-lookup"><span data-stu-id="93d65-214">The REST APIs support addressing of resources and routing of requests by both the id and the _rid properties.</span></span>

## <a name="database-accounts"></a><span data-ttu-id="93d65-215">Учетные записи базы данных</span><span class="sxs-lookup"><span data-stu-id="93d65-215">Database accounts</span></span>
<span data-ttu-id="93d65-216">Вы можете подготовить одну или несколько учетных записей базы данных Cosmos DB с помощью подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="93d65-216">You can provision one or more Cosmos DB database accounts using your Azure subscription.</span></span>

<span data-ttu-id="93d65-217">Вы можете создавать учетные записи базы данных Cosmos DB и управлять ими с помощью портала Azure на сайте [http://portal.azure.com/](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="93d65-217">You can create and manage Cosmos DB database accounts via the Azure Portal at [http://portal.azure.com/](https://portal.azure.com/).</span></span> <span data-ttu-id="93d65-218">Создание и управление учетной записью базы данных требует наличия административного доступа и может быть выполнено только в рамках вашей подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="93d65-218">Creating and managing a database account requires administrative access and can only be performed under your Azure subscription.</span></span> 

### <a name="database-account-properties"></a><span data-ttu-id="93d65-219">Свойства учетной записи базы данных</span><span class="sxs-lookup"><span data-stu-id="93d65-219">Database account properties</span></span>
<span data-ttu-id="93d65-220">В рамках подготовки учетной записи базы данных и управления ею можно настроить следующие свойства и ознакомиться с ними:</span><span class="sxs-lookup"><span data-stu-id="93d65-220">As part of provisioning and managing a database account you can configure and read the following properties:</span></span>  

<table border="0" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-221"><strong>Имя свойства</strong></span><span class="sxs-lookup"><span data-stu-id="93d65-221"><strong>Property Name</strong></span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-222"><strong>Описание</strong></span><span class="sxs-lookup"><span data-stu-id="93d65-222"><strong>Description</strong></span></span></p></td>
        </tr>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-223">Политика согласованности</span><span class="sxs-lookup"><span data-stu-id="93d65-223">Consistency Policy</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-224">Установите это свойство, чтобы настроить уровень согласованности по умолчанию для всех коллекций под вашей учетной записью базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-224">Set this property to configure the default consistency level for all the collections under your database account.</span></span> <span data-ttu-id="93d65-225">Вы можете переопределить уровень согласованности для каждого запроса, используя заголовок запроса x-ms-consistency-level.</span><span class="sxs-lookup"><span data-stu-id="93d65-225">You can override the consistency level on a per request basis using the [x-ms-consistency-level] request header.</span></span> <p><p><span data-ttu-id="93d65-226">Обратите внимание, что это свойство применяется только к <i>пользовательским ресурсам</i>.</span><span class="sxs-lookup"><span data-stu-id="93d65-226">Note that this property only applies to the <i>user defined resources</i>.</span></span> <span data-ttu-id="93d65-227">Все определяемые системой ресурсы настроены для поддержки чтения и запросов с сильной согласованностью.</span><span class="sxs-lookup"><span data-stu-id="93d65-227">All system defined resources are configured to support reads/queries with strong consistency.</span></span></p></td>
        </tr>
        <tr>
            <td valign="top"><p><span data-ttu-id="93d65-228">Ключи авторизации</span><span class="sxs-lookup"><span data-stu-id="93d65-228">Authorization Keys</span></span></p></td>
            <td valign="top"><p><span data-ttu-id="93d65-229">Существуют первичный и вторичный главные ключи, доступные только для чтения, которые обеспечивают административный доступ ко всем ресурсам учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-229">These are the primary and secondary master and readonly keys that provide administrative access to all of the resources under the database account.</span></span></p></td>
        </tr>
    </tbody>
</table>

<span data-ttu-id="93d65-230">Обратите внимание, что наряду с подготовкой, настройкой учетной записи базы данных и управлением ею на портале Azure, вы также можете программно создавать учетные записи базы данных Cosmos DB и управлять ими через [интерфейсы REST API Azure Cosmos DB](/rest/api/documentdb/) или [клиентские пакеты SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="93d65-230">Note that in addition to provisioning, configuring and managing your database account from the Azure Portal, you can also programmatically create and manage Cosmos DB database accounts by using the [Azure Cosmos DB REST APIs](/rest/api/documentdb/) as well as [client SDKs](documentdb-sdk-dotnet.md).</span></span>  

## <a name="databases"></a><span data-ttu-id="93d65-231">Базы данных</span><span class="sxs-lookup"><span data-stu-id="93d65-231">Databases</span></span>
<span data-ttu-id="93d65-232">База данных Cosmos DB является логическим контейнером из одного или нескольких коллекций и пользователей, как показано на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="93d65-232">A Cosmos DB database is a logical container of one or more collections and users, as shown in the following diagram.</span></span> <span data-ttu-id="93d65-233">Вы можете создать любое количество баз данных в учетной записи базы данных Cosmos DB с учетом предложенных ограничений.</span><span class="sxs-lookup"><span data-stu-id="93d65-233">You can create any number of databases under a Cosmos DB database account subject to offer limits.</span></span>  

<span data-ttu-id="93d65-234">![Учетная запись базы данных и иерархическая модель коллекций][2]</span><span class="sxs-lookup"><span data-stu-id="93d65-234">![Database account and collections hierarchical model][2]</span></span>  
<span data-ttu-id="93d65-235">**База данных представляет собой логический контейнер пользователей и коллекций**</span><span class="sxs-lookup"><span data-stu-id="93d65-235">**A Database is a logical container of users and collections**</span></span>

<span data-ttu-id="93d65-236">База данных может содержать практически неограниченное хранилище документов, секционированное внутри коллекций.</span><span class="sxs-lookup"><span data-stu-id="93d65-236">A database can contain virtually unlimited document storage partitioned within collections.</span></span>

### <a name="elastic-scale-of-a-cosmos-db-database"></a><span data-ttu-id="93d65-237">Гибкое масштабирование базы данных Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="93d65-237">Elastic scale of a Cosmos DB database</span></span>
<span data-ttu-id="93d65-238">База данных Cosmos DB по умолчанию является гибкой: ее размер варьируется от нескольких гигабайт до петабайт хранилищ документов на базе SSD и подготовленной пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="93d65-238">A Cosmos DB database is elastic by default – ranging from a few GB to petabytes of SSD backed document storage and provisioned throughput.</span></span> 

<span data-ttu-id="93d65-239">В отличие от традиционных реляционных СУБД базы данных в Cosmos DB не ограничены одним компьютером.</span><span class="sxs-lookup"><span data-stu-id="93d65-239">Unlike a database in traditional RDBMS, a database in Cosmos DB is not scoped to a single machine.</span></span> <span data-ttu-id="93d65-240">Cosmos DB позволяет создавать больше коллекций и баз данных по мере увеличения масштаба вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="93d65-240">With Cosmos DB, as your application’s scale needs to grow, you can create more collections, databases, or both.</span></span> <span data-ttu-id="93d65-241">Действительно, различные собственные приложения корпорации Майкрософт уже используют Cosmos DB в потребительском масштабе, создавая чрезвычайно большие базы данных Cosmos DB, каждая из которых содержит тысячи коллекций с терабайтами хранилищ документов.</span><span class="sxs-lookup"><span data-stu-id="93d65-241">Indeed, various first party applications within Microsoft have been using Cosmos DB at a consumer scale by creating extremely large Cosmos DB databases each containing thousands of collections with terabytes of document storage.</span></span> <span data-ttu-id="93d65-242">Вы можете увеличить или уменьшить базу данных, добавляя или удаляя коллекции для удовлетворения требований масштабности вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="93d65-242">You can grow or shrink a database by adding or removing collections to meet your application’s scale requirements.</span></span> 

<span data-ttu-id="93d65-243">Вы можете создать любое количество коллекций в пределах субъекта базы данных в рамках своего предложения.</span><span class="sxs-lookup"><span data-stu-id="93d65-243">You can create any number of collections within a database subject to the offer.</span></span> <span data-ttu-id="93d65-244">Для каждой коллекции выделяется хранилище на базе SSD-накопителей и пропускная способность с учетом выбранного уровня производительности.</span><span class="sxs-lookup"><span data-stu-id="93d65-244">Each collection has SSD backed storage and throughput provisioned for you depending on the selected performance tier.</span></span>

<span data-ttu-id="93d65-245">Cosmos DB также является контейнером пользователей.</span><span class="sxs-lookup"><span data-stu-id="93d65-245">A Cosmos DB database is also a container of users.</span></span> <span data-ttu-id="93d65-246">Пользователь, в свою очередь, является логическим пространством имен для набора разрешений, что обеспечивает детальный уровень авторизации и доступа к коллекции, документам и вложениям.</span><span class="sxs-lookup"><span data-stu-id="93d65-246">A user, in-turn, is a logical namespace for a set of permissions that provides fine-grained authorization and access to collections, documents and attachments.</span></span>  

<span data-ttu-id="93d65-247">Как и другие ресурсы в модели ресурсов Cosmos DB, базы данных могут создаваться, заменяться, удаляться, считываться или перечисляться с помощью [интерфейсов REST API](/rest/api/documentdb/) или любого [клиентского пакета SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="93d65-247">As with other resources in the Cosmos DB resource model, databases can be created, replaced, deleted, read or enumerated easily using either the [REST APIs](/rest/api/documentdb/) or any of the [client SDKs](documentdb-sdk-dotnet.md).</span></span> <span data-ttu-id="93d65-248">Cosmos DB гарантирует строгую согласованность для чтения или запроса метаданных ресурса базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-248">Cosmos DB guarantees strong consistency for reading or querying the metadata of a database resource.</span></span> <span data-ttu-id="93d65-249">Удаление базы данных автоматически означает, что вы больше не сможете получить доступ к любой из коллекций или пользователям, содержащимся в ней.</span><span class="sxs-lookup"><span data-stu-id="93d65-249">Deleting a database automatically ensures that you cannot access any of the collections or users contained within it.</span></span>   

## <a name="collections"></a><span data-ttu-id="93d65-250">Коллекции</span><span class="sxs-lookup"><span data-stu-id="93d65-250">Collections</span></span>
<span data-ttu-id="93d65-251">Коллекция Cosmos DB — это контейнер для документов JSON.</span><span class="sxs-lookup"><span data-stu-id="93d65-251">A Cosmos DB collection is a container for your JSON documents.</span></span> 

### <a name="elastic-ssd-backed-document-storage"></a><span data-ttu-id="93d65-252">Гибкое хранилище документов на базе SSD</span><span class="sxs-lookup"><span data-stu-id="93d65-252">Elastic SSD backed document storage</span></span>
<span data-ttu-id="93d65-253">Коллекция является неразрывно гибкой, она автоматически увеличивается и уменьшается по мере добавления или удаления документов.</span><span class="sxs-lookup"><span data-stu-id="93d65-253">A collection is intrinsically elastic - it automatically grows and shrinks as you add or remove documents.</span></span> <span data-ttu-id="93d65-254">Коллекции — это логические ресурсы, они могут включать в себя одну или несколько физических секций или серверов.</span><span class="sxs-lookup"><span data-stu-id="93d65-254">Collections are logical resources and can span one or more physical partitions or servers.</span></span> <span data-ttu-id="93d65-255">Число секций в коллекции определяется Cosmos DB на основе размера хранилища и подготовленной пропускной способности коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-255">The number of partitions within a collection is determined by Cosmos DB based on the storage size and the provisioned throughput of your collection.</span></span> <span data-ttu-id="93d65-256">С каждой секцией в базе данных Azure Cosmos DB связано фиксированное количество хранилищ на основе SSD, которое реплицируется для обеспечения высокого уровня доступности.</span><span class="sxs-lookup"><span data-stu-id="93d65-256">Every partition in Cosmos DB has a fixed amount of SSD-backed storage associated with it, and is replicated for high availability.</span></span> <span data-ttu-id="93d65-257">Управление секциями полностью осуществляется базой данных Azure Cosmos DB, и нет необходимости создавать сложный код или управлять секциями.</span><span class="sxs-lookup"><span data-stu-id="93d65-257">Partition management is fully managed by Azure Cosmos DB, and you do not have to write complex code or manage your partitions.</span></span> <span data-ttu-id="93d65-258">Коллекции Cosmos DB **практически не ограничены** в объеме хранилища и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="93d65-258">Cosmos DB collections are **practically unlimited** in terms of storage and throughput.</span></span> 

### <a name="automatic-indexing-of-collections"></a><span data-ttu-id="93d65-259">Автоматическое индексирование коллекций</span><span class="sxs-lookup"><span data-stu-id="93d65-259">Automatic indexing of collections</span></span>
<span data-ttu-id="93d65-260">Cosmos DB — это система баз данных без схемы.</span><span class="sxs-lookup"><span data-stu-id="93d65-260">Cosmos DB is a true schema-free database system.</span></span> <span data-ttu-id="93d65-261">Она не подразумевает и не требует указания каких-либо схем для документов JSON.</span><span class="sxs-lookup"><span data-stu-id="93d65-261">It does not assume or require any schema for the JSON documents.</span></span> <span data-ttu-id="93d65-262">По мере добавления документов в коллекцию Cosmos DB автоматически индексирует их, и они становятся доступны для выполнения запросов.</span><span class="sxs-lookup"><span data-stu-id="93d65-262">As you add documents to a collection, Cosmos DB automatically indexes them and they are available for you to query.</span></span> <span data-ttu-id="93d65-263">Автоматическая индексация документов, не требующая указания схемы или вторичных индексов, является ключевой возможностью Cosmos DB и доступна благодаря оптимизированным для записи технологиям обслуживания индексов без блокировки, которые структурированы для журнала.</span><span class="sxs-lookup"><span data-stu-id="93d65-263">Automatic indexing of documents without requiring schema or secondary indexes is a key capability of Cosmos DB and is enabled by write-optimized, lock-free and log-structured index maintenance techniques.</span></span> <span data-ttu-id="93d65-264">Cosmos DB поддерживает устойчивый объем чрезвычайно быстрых операций записи и в то же время обслуживает согласованные запросы.</span><span class="sxs-lookup"><span data-stu-id="93d65-264">Cosmos DB supports sustained volume of extremely fast writes while still serving consistent queries.</span></span> <span data-ttu-id="93d65-265">Хранилище и документов и индекса используется для расчета объема хранения, потребляемого каждой коллекцией.</span><span class="sxs-lookup"><span data-stu-id="93d65-265">Both document and index storage are used to calculate the storage consumed by each collection.</span></span> <span data-ttu-id="93d65-266">Вы можете управлять компромиссом между объемом хранения и производительностью, связанным с индексацией по настройке политики индексирования для коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-266">You can control the storage and performance trade-offs associated with indexing by configuring the indexing policy for a collection.</span></span> 

### <a name="configuring-the-indexing-policy-of-a-collection"></a><span data-ttu-id="93d65-267">Настройка политики индексирования коллекции</span><span class="sxs-lookup"><span data-stu-id="93d65-267">Configuring the indexing policy of a collection</span></span>
<span data-ttu-id="93d65-268">Политика индексирования каждой коллекции позволяет настраивать соотношения производительности и объема, связанные с индексацией.</span><span class="sxs-lookup"><span data-stu-id="93d65-268">The indexing policy of each collection allows you to make performance and storage trade-offs associated with indexing.</span></span> <span data-ttu-id="93d65-269">Для конфигурации индексирования доступны следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="93d65-269">The following options are available to you as part of indexing configuration:</span></span>  

* <span data-ttu-id="93d65-270">Выберите, будет ли коллекция автоматически индексировать все документы или нет.</span><span class="sxs-lookup"><span data-stu-id="93d65-270">Choose whether the collection automatically indexes all of the documents or not.</span></span> <span data-ttu-id="93d65-271">По умолчанию все документы индексируются автоматически.</span><span class="sxs-lookup"><span data-stu-id="93d65-271">By default, all documents are automatically indexed.</span></span> <span data-ttu-id="93d65-272">Можно отключать автоматическое индексирование и добавлять только выбранные документы в индекс.</span><span class="sxs-lookup"><span data-stu-id="93d65-272">You can choose to turn off automatic indexing and selectively add only specific documents to the index.</span></span> <span data-ttu-id="93d65-273">И наоборот, вы можете выборочно указать, какие документы необходимо исключить из индексирования.</span><span class="sxs-lookup"><span data-stu-id="93d65-273">Conversely, you can selectively choose to exclude only specific documents.</span></span> <span data-ttu-id="93d65-274">Вы можете добиться этого путем установки автоматического логического свойства indexingPolicyколлекции и с помощью заголовка запроса [x-ms-indexingdirective] при вставке, замене или удалении документа.</span><span class="sxs-lookup"><span data-stu-id="93d65-274">You can achieve this by setting the automatic property to be true or false on the indexingPolicy of a collection and using the [x-ms-indexingdirective] request header while inserting, replacing or deleting a document.</span></span>  
* <span data-ttu-id="93d65-275">Укажите, следует ли включить или исключить определенные пути или шаблоны в документах из индекса.</span><span class="sxs-lookup"><span data-stu-id="93d65-275">Choose whether to include or exclude specific paths or patterns in your documents from the index.</span></span> <span data-ttu-id="93d65-276">Вы можете добиться этого путем установки includedPaths и excludedPaths на indexingPolicy коллекции соответственно.</span><span class="sxs-lookup"><span data-stu-id="93d65-276">You can achieve this by setting includedPaths and excludedPaths on the indexingPolicy of a collection respectively.</span></span> <span data-ttu-id="93d65-277">Вы также можете настроить соотношения объема и производительности для интервала и хэш-запросов для конкретных шаблонов пути.</span><span class="sxs-lookup"><span data-stu-id="93d65-277">You can also configure the storage and performance trade-offs for range and hash queries for specific path patterns.</span></span> 
* <span data-ttu-id="93d65-278">Выбор между синхронными обновлениями (согласованные) и асинхронными обновлениями (отложенные) индекса.</span><span class="sxs-lookup"><span data-stu-id="93d65-278">Choose between synchronous (consistent) and asynchronous (lazy) index updates.</span></span> <span data-ttu-id="93d65-279">По умолчанию, индекс обновляется синхронно при каждой операции вставки, заменить или удаления документа в коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-279">By default, the index is updated synchronously on each insert, replace or delete of a document to the collection.</span></span> <span data-ttu-id="93d65-280">Это позволяет выполнять запросы с уровнем согласованности, как и в документе.</span><span class="sxs-lookup"><span data-stu-id="93d65-280">This enables the queries to honor the same consistency level as that of the document reads.</span></span> <span data-ttu-id="93d65-281">В то время как Cosmos DB является системой, оптимизированной для операций записи и поддерживающей устойчивые объемы записей документов вместе с синхронным обслуживанием индекса и согласованных запросов, вы можете настроить определенные коллекции для отложенного обновления их ​​индексов.</span><span class="sxs-lookup"><span data-stu-id="93d65-281">While Cosmos DB is write optimized and supports sustained volumes of document writes along with synchronous index maintenance and serving consistent queries, you can configure certain collections to update their index lazily.</span></span> <span data-ttu-id="93d65-282">Отложенное индексирование еще больше повышает производительность операций записи и идеально подходит для сценариев пакетной вставки, прежде всего для чтения больших коллекций.</span><span class="sxs-lookup"><span data-stu-id="93d65-282">Lazy indexing boosts the write performance further and is ideal for bulk ingestion scenarios for primarily read-heavy collections.</span></span>

<span data-ttu-id="93d65-283">Вы можете изменить политику индексирования, выполнив запрос PUT для коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-283">The indexing policy can be changed by executing a PUT on the collection.</span></span> <span data-ttu-id="93d65-284">Это можно сделать с помощью [клиентского пакета SDK](documentdb-sdk-dotnet.md), [портала Azure](https://portal.azure.com) или [интерфейсов REST API](/rest/api/documentdb/).</span><span class="sxs-lookup"><span data-stu-id="93d65-284">This can be achieved either through the [client SDK](documentdb-sdk-dotnet.md), the [Azure Portal](https://portal.azure.com) or the [REST APIs](/rest/api/documentdb/).</span></span>

### <a name="querying-a-collection"></a><span data-ttu-id="93d65-285">Запросы к коллекции</span><span class="sxs-lookup"><span data-stu-id="93d65-285">Querying a collection</span></span>
<span data-ttu-id="93d65-286">Документы в коллекции могут иметь произвольные схемы, и вы можете запрашивать их без предварительного предоставления любой схемы или вторичных индексов.</span><span class="sxs-lookup"><span data-stu-id="93d65-286">The documents within a collection can have arbitrary schemas and you can query documents within a collection without providing any schema or secondary indices upfront.</span></span> <span data-ttu-id="93d65-287">Вы можете запрашивать коллекцию, используя [справочник по синтаксису SQL-запросов API DocumentDB в Azure Cosmos DB](https://msdn.microsoft.com/library/azure/dn782250.aspx). Он предоставляет богатый выбор иерархических, реляционных и пространственных операторов, а также возможность расширения с использованием определяемых пользователем функций на основе JavaScript.</span><span class="sxs-lookup"><span data-stu-id="93d65-287">You can query the collection using the [Azure Cosmos DB DocumentDB API: SQL syntax reference](https://msdn.microsoft.com/library/azure/dn782250.aspx), which provides rich hierarchical, relational, and spatial operators and extensibility via JavaScript-based UDFs.</span></span> <span data-ttu-id="93d65-288">Грамматика JSON позволяет моделировать документы JSON в форме деревьев с метками в качестве узлов.</span><span class="sxs-lookup"><span data-stu-id="93d65-288">JSON grammar allows for modeling JSON documents as trees with labels as the tree nodes.</span></span> <span data-ttu-id="93d65-289">Этот подход используется для автоматического индексирования API DocumentDB, а также лежит в основе диалекта SQL API DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="93d65-289">This is exploited both by DocumentDB API’s automatic indexing techniques as well as DocumentDB API's SQL dialect.</span></span> <span data-ttu-id="93d65-290">Язык запросов API DocumentDB построен на следующих трех основных принципах.</span><span class="sxs-lookup"><span data-stu-id="93d65-290">The DocumetDB API query language consists of three main aspects:</span></span>   

1. <span data-ttu-id="93d65-291">Небольшой набор операций запросов, которые естественным образом отображаются в древовидной структуре в том числе иерархических запросов и проекций.</span><span class="sxs-lookup"><span data-stu-id="93d65-291">A small set of query operations that map naturally to the tree structure including hierarchical queries and projections.</span></span> 
2. <span data-ttu-id="93d65-292">Подмножество реляционных операций, включая композиции, фильтры, проекции, агрегатов и внутренние соединения.</span><span class="sxs-lookup"><span data-stu-id="93d65-292">A subset of relational operations including composition, filter, projections, aggregates and self joins.</span></span> 
3. <span data-ttu-id="93d65-293">Пользовательские функции на основе чистого JavaScript, которые работают с (1) и (2)</span><span class="sxs-lookup"><span data-stu-id="93d65-293">Pure JavaScript based UDFs that work with (1) and (2).</span></span>  

<span data-ttu-id="93d65-294">Модель запросов Cosmos DB пытается установить баланс между функциональностью, эффективностью и простотой.</span><span class="sxs-lookup"><span data-stu-id="93d65-294">The Cosmos DB query model attempts to strike a balance between functionality, efficiency and simplicity.</span></span> <span data-ttu-id="93d65-295">Ядро базы данных Cosmos DB непосредственно компилирует и выполняет инструкции SQL-запросов.</span><span class="sxs-lookup"><span data-stu-id="93d65-295">The Cosmos DB database engine natively compiles and executes the SQL query statements.</span></span> <span data-ttu-id="93d65-296">Вы можете запросить коллекцию с помощью [интерфейсов REST API](/rest/api/documentdb/) или любого из [клиентских пакетов SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="93d65-296">You can query a collection using the [REST APIs](/rest/api/documentdb/) or any of the [client SDKs](documentdb-sdk-dotnet.md).</span></span> <span data-ttu-id="93d65-297">В комплект пакета .NET SDK входит поставщик LINQ.</span><span class="sxs-lookup"><span data-stu-id="93d65-297">The .NET SDK comes with a LINQ provider.</span></span>

> [!TIP]
> <span data-ttu-id="93d65-298">Вы можете испытать API DocumentDB в действии и выполнить запросы SQL набора данных в среде [Query Playground](https://www.documentdb.com/sql/demo).</span><span class="sxs-lookup"><span data-stu-id="93d65-298">You can try out the DocumentDB API and run SQL queries against our dataset in the [Query Playground](https://www.documentdb.com/sql/demo).</span></span>
> 
> 

## <a name="multi-document-transactions"></a><span data-ttu-id="93d65-299">Операции над несколькими документами</span><span class="sxs-lookup"><span data-stu-id="93d65-299">Multi-document transactions</span></span>
<span data-ttu-id="93d65-300">Транзакции в базах данных обеспечивают безопасную и предсказуемую модель программирования для работы с одновременными изменениями данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-300">Database transactions provide a safe and predictable programming model for dealing with concurrent changes to the data.</span></span> <span data-ttu-id="93d65-301">В РСУБД традиционный способ создания бизнес-логики заключается в том, чтобы написать **хранимые процедуры** и (или) **триггеры** и передать их на сервер базы данных для выполнения в транзакциях.</span><span class="sxs-lookup"><span data-stu-id="93d65-301">In RDBMS, the traditional way to write business logic is to write **stored-procedures** and/or **triggers** and ship it to the database server for transactional execution.</span></span> <span data-ttu-id="93d65-302">В РСУБД, прикладному программисту приходится иметь дело с двумя разнородными языками программирования:</span><span class="sxs-lookup"><span data-stu-id="93d65-302">In RDBMS, the application programmer is required to deal with two disparate programming languages:</span></span> 

* <span data-ttu-id="93d65-303">Нетранзакционный язык прикладного программирования (JavaScript, Python, C#, Java и др.).</span><span class="sxs-lookup"><span data-stu-id="93d65-303">The (non-transactional) application programming language (e.g. JavaScript, Python, C#, Java, etc.)</span></span>
* <span data-ttu-id="93d65-304">Транзакционный язык T-SQL, который является "родным" для базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-304">T-SQL, the transactional programming language which is natively executed by the database</span></span>

<span data-ttu-id="93d65-305">Так как служба является оптимизированной для JavaScript и JSON непосредственно в базе данных, Cosmos DB обеспечивает интуитивную модель программирования для выполнения логики приложения на основе JavaScript непосредственно в коллекциях в виде хранимых процедур и триггеров.</span><span class="sxs-lookup"><span data-stu-id="93d65-305">By virtue of its deep commitment to JavaScript and JSON directly within the database engine, Cosmos DB provides an intuitive programming model for executing JavaScript based application logic directly on the collections in terms of stored procedures and triggers.</span></span> <span data-ttu-id="93d65-306">Это позволяет получить</span><span class="sxs-lookup"><span data-stu-id="93d65-306">This allows for both of the following:</span></span>

* <span data-ttu-id="93d65-307">с одной стороны, эффективные механизмы восстановления, управления параллелизмом и автоматической индексации графов объектов JSON прямо в ядре СУБД;</span><span class="sxs-lookup"><span data-stu-id="93d65-307">Efficient implementation of concurrency control, recovery, automatic indexing of the JSON object graphs directly in the database engine</span></span>
* <span data-ttu-id="93d65-308">с другой стороны, естественное выражение потока управления, области видимости переменных, присвоения, а также интеграцию примитивов обработки исключений с транзакциями базы данных непосредственно на JavaScript.</span><span class="sxs-lookup"><span data-stu-id="93d65-308">Naturally expressing control flow, variable scoping, assignment and integration of exception handling primitives with database transactions directly in terms of the JavaScript programming language</span></span>

<span data-ttu-id="93d65-309">Логика JavaScript, регистрируемая на уровне коллекции, может выполнять операции с базами данных на документах данной коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-309">The JavaScript logic registered at a collection level can then issue database operations on the documents of the given collection.</span></span> <span data-ttu-id="93d65-310">Cosmos DB неявно обертывает хранимые процедуры и триггеры на основе JavaScript в пределах транзакций ACID с изоляцией моментальных снимков документов в коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-310">Cosmos DB implicitly wraps the JavaScript based stored procedures and triggers within an ambient ACID transactions with snapshot isolation across documents within a collection.</span></span> <span data-ttu-id="93d65-311">В ходе его исполнения, если код JavaScript генерирует исключение, то вся транзакция прерывается.</span><span class="sxs-lookup"><span data-stu-id="93d65-311">During the course of its execution, if the JavaScript throws an exception, then the entire transaction is aborted.</span></span> <span data-ttu-id="93d65-312">Полученная модель программирования является очень простой, но мощной.</span><span class="sxs-lookup"><span data-stu-id="93d65-312">The resulting programming model is a very simple yet powerful.</span></span> <span data-ttu-id="93d65-313">Разработчики JavaScript получают "надежную" модель программирования, при этом используя привычные языковые конструкции и библиотечные примитивы.</span><span class="sxs-lookup"><span data-stu-id="93d65-313">JavaScript developers get a “durable” programming model while still using their familiar language constructs and library primitives.</span></span>   

<span data-ttu-id="93d65-314">Возможность выполнить JavaScript непосредственно в ядре базы данных в том же адресном пространстве, что буферный пул, позволяет производительное и транзакционное выполнение операций с базами данных над документами коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-314">The ability to execute JavaScript directly within the database engine in the same address space as the buffer pool enables performant and transactional execution of database operations against the documents of a collection.</span></span> <span data-ttu-id="93d65-315">Кроме того, ядро СУБД Cosmos DB оптимизировано для JSON и JavaScript, что устраняет несоответствия между системами типов приложения и базой данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-315">Furthermore, Cosmos DB database engine makes a deep commitment to the JSON and JavaScript eliminates any impedance mismatch between the type systems of application and the database.</span></span>   

<span data-ttu-id="93d65-316">После создания коллекции можно зарегистрировать хранимые процедуры, триггеры и определяемые пользователем функции с помощью [REST API](/rest/api/documentdb/) или любого [клиентского пакета SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="93d65-316">After creating a collection, you can register stored procedures, triggers and UDFs with a collection using the [REST APIs](/rest/api/documentdb/) or any of the [client SDKs](documentdb-sdk-dotnet.md).</span></span> <span data-ttu-id="93d65-317">После регистрации вы можете использовать и выполнять их.</span><span class="sxs-lookup"><span data-stu-id="93d65-317">After registration, you can reference and execute them.</span></span> <span data-ttu-id="93d65-318">Рассмотрим приведенный ниже код хранимой процедуры, написанный полностью на JavaScript. Процедура принимает два аргумента (имя книги и имя автора), создает новый документ, выполняет запрос документа и обновляет его. Все эти действия выполняются в ходе неявной транзакции ACID.</span><span class="sxs-lookup"><span data-stu-id="93d65-318">Consider the following stored procedure written entirely in JavaScript, the code below takes two arguments (book name and author name) and creates a new document, queries for a document and then updates it – all within an implicit ACID transaction.</span></span> <span data-ttu-id="93d65-319">Транзакция будет прервана в любой момент выполнения, если будет выдано исключение JavaScript.</span><span class="sxs-lookup"><span data-stu-id="93d65-319">At any point during the execution, if a JavaScript exception is thrown, the entire transaction aborts.</span></span>

    function businessLogic(name, author) {
        var context = getContext();
        var collectionManager = context.getCollection();        
        var collectionLink = collectionManager.getSelfLink()

        // create a new document.
        collectionManager.createDocument(collectionLink,
            {id: name, author: author},
            function(err, documentCreated) {
                if(err) throw new Error(err.message);

                // filter documents by author
                var filterQuery = "SELECT * from root r WHERE r.author = 'George R.'";
                collectionManager.queryDocuments(collectionLink,
                    filterQuery,
                    function(err, matchingDocuments) {
                        if(err) throw new Error(err.message);

                        context.getResponse().setBody(matchingDocuments.length);

                        // Replace the author name for all documents that satisfied the query.
                        for (var i = 0; i < matchingDocuments.length; i++) {
                            matchingDocuments[i].author = "George R. R. Martin";
                            // we don’t need to execute a callback because they are in parallel
                            collectionManager.replaceDocument(matchingDocuments[i]._self,
                                matchingDocuments[i]);   
                        }
                    })
            })
    };

<span data-ttu-id="93d65-320">Клиент может "грузить" вышеуказанную JavaScript логику в базу данных для транзакционного исполнения через HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="93d65-320">The client can “ship” the above JavaScript logic to the database for transactional execution via HTTP POST.</span></span> <span data-ttu-id="93d65-321">Дополнительные сведения об использовании методов HTTP см. в статье [Azure Cosmos DB: Azure Cosmos DB REST API](https://msdn.microsoft.com/library/azure/mt622086.aspx) (Azure Cosmos DB. REST API Azure Cosmos DB).</span><span class="sxs-lookup"><span data-stu-id="93d65-321">For more information about using HTTP methods, see [RESTful interactions with Azure Cosmos DB resources](https://msdn.microsoft.com/library/azure/mt622086.aspx).</span></span> 

    client.createStoredProcedureAsync(collection._self, {id: "CRUDProc", body: businessLogic})
       .then(function(createdStoredProcedure) {
            return client.executeStoredProcedureAsync(createdStoredProcedure.resource._self,
                "NoSQL Distilled",
                "Martin Fowler");
        })
        .then(function(result) {
            console.log(result);
        },
        function(error) {
            console.log(error);
        });


<span data-ttu-id="93d65-322">Обратите внимание, что, поскольку база данных изначально понимает JSON и JavaScript, нет проблемы несоответствия типов, нет "отображения ИЛИ" или генерации "магического" кода.</span><span class="sxs-lookup"><span data-stu-id="93d65-322">Notice that because the database natively understands JSON and JavaScript, there is no type system mismatch, no “OR mapping” or code generation magic required.</span></span>   

<span data-ttu-id="93d65-323">Хранимые процедуры и триггеры взаимодействуют с коллекцией и документами в коллекции через четко определенную объектную модель, которая отражает текущий контекст коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-323">Stored procedures and triggers interact with a collection and the documents in a collection through a well-defined object model, which exposes the current collection context.</span></span>  

<span data-ttu-id="93d65-324">Коллекции в API DocumentDB можно создавать, удалять, считывать и перечислять с помощью [интерфейсов REST API](/rest/api/documentdb/) или любого [клиентского пакета SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="93d65-324">Collections in the DocumentDB API can be created, deleted, read or enumerated easily using either the [REST APIs](/rest/api/documentdb/) or any of the [client SDKs](documentdb-sdk-dotnet.md).</span></span> <span data-ttu-id="93d65-325">API DocumentDB всегда обеспечивает строгую согласованность для чтения или запроса метаданных коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-325">The DocumentDB API always provides strong consistency for reading or querying the metadata of a collection.</span></span> <span data-ttu-id="93d65-326">Удаление коллекции автоматически гарантирует, что вы не сможете получить доступ к любому из документов, вложений, хранимых процедур, триггеров и пользовательских функций, содержащихся в ней.</span><span class="sxs-lookup"><span data-stu-id="93d65-326">Deleting a collection automatically ensures that you cannot access any of the documents, attachments, stored procedures, triggers, and UDFs contained within it.</span></span>   

## <a name="stored-procedures-triggers-and-user-defined-functions-udf"></a><span data-ttu-id="93d65-327">Хранимые процедуры, триггеры и определяемые пользователями функции (UDF)</span><span class="sxs-lookup"><span data-stu-id="93d65-327">Stored procedures, triggers and User Defined Functions (UDF)</span></span>
<span data-ttu-id="93d65-328">Как описано в предыдущем разделе, вы можете реализовать логику приложения для непосредственного исполнения в рамках транзакции ядра СУБД.</span><span class="sxs-lookup"><span data-stu-id="93d65-328">As described in the previous section, you can write application logic to run directly within a transaction inside of the database engine.</span></span> <span data-ttu-id="93d65-329">Логика приложения может быть полностью написана на JavaScript и смоделирована в виде хранимой процедуры, триггера или определяемой пользователем функции.</span><span class="sxs-lookup"><span data-stu-id="93d65-329">The application logic can be written entirely in JavaScript and can be modeled as a stored procedure, trigger or a UDF.</span></span> <span data-ttu-id="93d65-330">Код JavaScript в хранимой процедуре или триггере может вставлять, заменять, удалять, читать или формировать запросы к документам коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-330">The JavaScript code within a stored procedure or a trigger can insert, replace, delete, read or query documents within a collection.</span></span> <span data-ttu-id="93d65-331">С другой стороны, код JavaScript в определяемой пользователем функции не может добавлять, заменять или удалять документы.</span><span class="sxs-lookup"><span data-stu-id="93d65-331">On the other hand, the JavaScript within a UDF cannot insert, replace, or delete documents.</span></span> <span data-ttu-id="93d65-332">Определяемые пользователем функции перечисляют документы из результата запроса и создают новый набор результатов.</span><span class="sxs-lookup"><span data-stu-id="93d65-332">UDFs enumerate the documents of a query's result set and produce another result set.</span></span> <span data-ttu-id="93d65-333">Для мультитенантности Cosmos DB реализует управление ресурсами на основе строгого резервирования.</span><span class="sxs-lookup"><span data-stu-id="93d65-333">For multi-tenancy, Cosmos DB enforces a strict reservation based resource governance.</span></span> <span data-ttu-id="93d65-334">Для каждой хранимой процедуры, триггера или пользовательской функции выделяется фиксированный квант ресурсов операционной системы, чтобы выполнить свою задачу.</span><span class="sxs-lookup"><span data-stu-id="93d65-334">Each stored procedure, trigger or a UDF gets a fixed quantum of operating system resources to do its work.</span></span> <span data-ttu-id="93d65-335">Кроме того, хранимые процедуры, триггеры и пользовательские функции не могут подключать внешние библиотеки JavaScript и попадают в черный список, если превышают установленные для них пределы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="93d65-335">Furthermore, stored procedures, triggers or UDFs cannot link against external JavaScript libraries and are blacklisted if they exceed the resource budgets allocated to them.</span></span> <span data-ttu-id="93d65-336">Вы можете зарегистрировать или отменить регистрацию хранимых процедур, триггеров или пользовательских функций в коллекции через API REST.</span><span class="sxs-lookup"><span data-stu-id="93d65-336">You can register, unregister stored procedures, triggers or UDFs with a collection by using the REST APIs.</span></span>  <span data-ttu-id="93d65-337">После регистрации хранимая процедура, триггер или пользовательская функция предварительно компилируются и хранятся в виде байт-кода, который позже запускается на выполнение.</span><span class="sxs-lookup"><span data-stu-id="93d65-337">Upon registration a stored procedure, trigger, or a UDF is pre-compiled and stored as byte code which gets executed later.</span></span> <span data-ttu-id="93d65-338">В следующем разделе показано, как можно использовать пакет SDK JavaScript службы Cosmos DB для регистрации, выполнения и отмены регистрации хранимой процедуры, триггера и определяемой пользователем функции.</span><span class="sxs-lookup"><span data-stu-id="93d65-338">The following section illustrate how you can use the Cosmos DB JavaScript SDK to register, execute, and unregister a stored procedure, trigger, and a UDF.</span></span> <span data-ttu-id="93d65-339">Пакет SDK JavaScript является простой программой-оболочкой [интерфейсов REST API](/rest/api/documentdb/).</span><span class="sxs-lookup"><span data-stu-id="93d65-339">The JavaScript SDK is a simple wrapper over the [REST APIs](/rest/api/documentdb/).</span></span> 

### <a name="registering-a-stored-procedure"></a><span data-ttu-id="93d65-340">Регистрация хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="93d65-340">Registering a stored procedure</span></span>
<span data-ttu-id="93d65-341">Регистрация хранимой процедуры — это создание нового ресурса хранимой процедуры ресурса в коллекции с помощью HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="93d65-341">Registration of a stored procedure creates a new stored procedure resource on a collection via HTTP POST.</span></span>  

    var storedProc = {
        id: "validateAndCreate",
        body: function (documentToCreate) {
            documentToCreate.id = documentToCreate.id.toUpperCase();

            var collectionManager = getContext().getCollection();
            collectionManager.createDocument(collectionManager.getSelfLink(),
                documentToCreate,
                function(err, documentCreated) {
                    if(err) throw new Error('Error while creating document: ' + err.message;
                    getContext().getResponse().setBody('success - created ' + 
                            documentCreated.name);
                });
        }
    };

    client.createStoredProcedureAsync(collection._self, storedProc)
        .then(function (createdStoredProcedure) {
            console.log("Successfully created stored procedure");
        }, function(error) {
            console.log("Error");
        });

### <a name="executing-a-stored-procedure"></a><span data-ttu-id="93d65-342">Выполнение хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="93d65-342">Executing a stored procedure</span></span>
<span data-ttu-id="93d65-343">Выполнение хранимой процедуры осуществляется с помощью команды HTTP POST, запускаемой для существующего ресурса хранимой процедуры, с передачей параметров в теле запроса.</span><span class="sxs-lookup"><span data-stu-id="93d65-343">Execution of a stored procedure is done by issuing an HTTP POST against an existing stored procedure resource by passing parameters to the procedure in the request body.</span></span>

    var inputDocument = {id : "document1", author: "G. G. Marquez"};
    client.executeStoredProcedureAsync(createdStoredProcedure.resource._self, inputDocument)
        .then(function(executionResult) {
            assert.equal(executionResult, "success - created DOCUMENT1");
        }, function(error) {
            console.log("Error");
        });

### <a name="unregistering-a-stored-procedure"></a><span data-ttu-id="93d65-344">Отмена регистрации хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="93d65-344">Unregistering a stored procedure</span></span>
<span data-ttu-id="93d65-345">Отменить регистрацию хранимой процедуры можно с помощью команды HTTP DELETE, выполняемой для существующего ресурса хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="93d65-345">Unregistering a stored procedure is simply done by issuing an HTTP DELETE against an existing stored procedure resource.</span></span>   

    client.deleteStoredProcedureAsync(createdStoredProcedure.resource._self)
        .then(function (response) {
            return;
        }, function(error) {
            console.log("Error");
        });


### <a name="registering-a-pre-trigger"></a><span data-ttu-id="93d65-346">Регистрация триггера со срабатыванием до наступления события</span><span class="sxs-lookup"><span data-stu-id="93d65-346">Registering a pre-trigger</span></span>
<span data-ttu-id="93d65-347">Регистрация триггера осуществляется путем создания ресурса триггера в коллекции с помощью команды HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="93d65-347">Registration of a trigger is done by creating a new trigger resource on a collection via HTTP POST.</span></span> <span data-ttu-id="93d65-348">Вы можете указать тип срабатывания триггера и тип операции, с которой он может быть связан (например, создание, замена, удаление или все типы).</span><span class="sxs-lookup"><span data-stu-id="93d65-348">You can specify if the trigger is a pre or a post trigger and the type of operation it can be associated with (e.g. Create, Replace, Delete, or All).</span></span>   

    var preTrigger = {
        id: "upperCaseId",
        body: function() {
                var item = getContext().getRequest().getBody();
                item.id = item.id.toUpperCase();
                getContext().getRequest().setBody(item);
        },
        triggerType: TriggerType.Pre,
        triggerOperation: TriggerOperation.All
    }

    client.createTriggerAsync(collection._self, preTrigger)
        .then(function (createdPreTrigger) {
            console.log("Successfully created trigger");
        }, function(error) {
            console.log("Error");
        });

### <a name="executing-a-pre-trigger"></a><span data-ttu-id="93d65-349">Запуск триггера со срабатыванием до наступления события</span><span class="sxs-lookup"><span data-stu-id="93d65-349">Executing a pre-trigger</span></span>
<span data-ttu-id="93d65-350">Выполнение триггера производится путем указания в заголовке запроса имени существующего триггера в момент выдачи запроса POST/PUT/DELETE к ресурсу документа.</span><span class="sxs-lookup"><span data-stu-id="93d65-350">Execution of a trigger is done by specifying the name of an existing trigger at the time of issuing the POST/PUT/DELETE request of a document resource via the request header.</span></span>  

    client.createDocumentAsync(collection._self, { id: "doc1", key: "Love in the Time of Cholera" }, { preTriggerInclude: "upperCaseId" })
        .then(function(createdDocument) {
            assert.equal(createdDocument.resource.id, "DOC1");
        }, function(error) {
            console.log("Error");
        });

### <a name="unregistering-a-pre-trigger"></a><span data-ttu-id="93d65-351">Отмена регистрации триггера со срабатыванием до наступления события</span><span class="sxs-lookup"><span data-stu-id="93d65-351">Unregistering a pre-trigger</span></span>
<span data-ttu-id="93d65-352">Отменить регистрацию триггера можно с помощью команды HTTP DELETE, выполняемой для существующего ресурса триггера.</span><span class="sxs-lookup"><span data-stu-id="93d65-352">Unregistering a trigger is simply done via issuing an HTTP DELETE against an existing trigger resource.</span></span>  

    client.deleteTriggerAsync(createdPreTrigger._self);
        .then(function(response) {
            return;
        }, function(error) {
            console.log("Error");
        });

### <a name="registering-a-udf"></a><span data-ttu-id="93d65-353">Регистрация определяемой пользователем функции</span><span class="sxs-lookup"><span data-stu-id="93d65-353">Registering a UDF</span></span>
<span data-ttu-id="93d65-354">Регистрация определяемой пользователем функции осуществляется путем создания нового ресурса UDF в коллекции или через команду HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="93d65-354">Registration of a UDF is done by creating a new UDF resource on a collection via HTTP POST.</span></span>  

    var udf = { 
        id: "mathSqrt",
        body: function(number) {
                return Math.sqrt(number);
        },
    };
    client.createUserDefinedFunctionAsync(collection._self, udf)
        .then(function (createdUdf) {
            console.log("Successfully created stored procedure");
        }, function(error) {
            console.log("Error");
        });

### <a name="executing-a-udf-as-part-of-the-query"></a><span data-ttu-id="93d65-355">Выполнение определяемой пользователем функции как части запроса</span><span class="sxs-lookup"><span data-stu-id="93d65-355">Executing a UDF as part of the query</span></span>
<span data-ttu-id="93d65-356">Определяемая пользователем функция (UDF) указывается в SQL-запросах и позволяет расширить [язык запросов SQL API DocumentDB](https://msdn.microsoft.com/library/azure/dn782250.aspx).</span><span class="sxs-lookup"><span data-stu-id="93d65-356">A UDF can be specified as part of the SQL query and is used as a way to extend the core [SQL query language for the DocumentDB API](https://msdn.microsoft.com/library/azure/dn782250.aspx).</span></span>

    var filterQuery = "SELECT udf.mathSqrt(r.Age) AS sqrtAge FROM root r WHERE r.FirstName='John'";
    client.queryDocuments(collection._self, filterQuery).toArrayAsync();
        .then(function(queryResponse) {
            var queryResponseDocuments = queryResponse.feed;
        }, function(error) {
            console.log("Error");
        });

### <a name="unregistering-a-udf"></a><span data-ttu-id="93d65-357">Отмена регистрации определяемой пользователем функции</span><span class="sxs-lookup"><span data-stu-id="93d65-357">Unregistering a UDF</span></span>
<span data-ttu-id="93d65-358">Отменить регистрацию определяемой пользователем функции можно с помощью команды HTTP DELETE, выполняемой для существующего ресурса UDF.</span><span class="sxs-lookup"><span data-stu-id="93d65-358">Unregistering a UDF is simply done by issuing an HTTP DELETE against an existing UDF resource.</span></span>  

    client.deleteUserDefinedFunctionAsync(createdUdf._self)
        .then(function(response) {
            return;
        }, function(error) {
            console.log("Error");
        });

<span data-ttu-id="93d65-359">Хотя в примерах выше используются команды для регистрации (POST), отмены регистрации (PUT), чтения и получения списка (GET), а также выполнения (POST) с помощью [пакета SDK JavaScript](https://github.com/Azure/azure-documentdb-js), можно также использовать интерфейсы [REST API](/rest/api/documentdb/) или другие [клиентские пакеты SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="93d65-359">Although the snippets above showed the registration (POST), unregistration (PUT), read/list (GET) and execution (POST) via the [JavaScript SDK](https://github.com/Azure/azure-documentdb-js), you can also use the [REST APIs](/rest/api/documentdb/) or other [client SDKs](documentdb-sdk-dotnet.md).</span></span> 

## <a name="documents"></a><span data-ttu-id="93d65-360">Документы</span><span class="sxs-lookup"><span data-stu-id="93d65-360">Documents</span></span>
<span data-ttu-id="93d65-361">Вы можете вставлять, заменять, удалять, читать, перечислять и запрашивать произвольные документы JSON в коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-361">You can insert, replace, delete, read, enumerate and query arbitrary JSON documents in a collection.</span></span> <span data-ttu-id="93d65-362">Cosmos DB не требует указывать схему и создавать вторичные индексы для поддержки запросов к документам в коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-362">Cosmos DB does not mandate any schema and does not require secondary indexes in order to support querying over documents in a collection.</span></span> <span data-ttu-id="93d65-363">Максимальный размер документа составляет 2 МБ.</span><span class="sxs-lookup"><span data-stu-id="93d65-363">The maximum size for a document is 2 MB.</span></span>   

<span data-ttu-id="93d65-364">Являясь по-настоящему открытой службой базы данных, Cosmos DB не изобретает какие-то специализированные типы данных (например, date time) или конкретные кодировки для документов JSON.</span><span class="sxs-lookup"><span data-stu-id="93d65-364">Being a truly open database service, Cosmos DB does not invent any specialized data types (e.g. date time) or specific encodings for JSON documents.</span></span> <span data-ttu-id="93d65-365">Обратите внимание, что Cosmos DB не требует никаких специальных соглашений JSON для обозначения связей между различными документами. Реализованный в Cosmos DB синтаксис SQL предоставляет мощные иерархические и реляционные операторы для создания запросов и документов проекта. При этом вам не требуется использовать специальные примечания или выражать взаимосвязи между документами с помощью отличительных свойств.</span><span class="sxs-lookup"><span data-stu-id="93d65-365">Note that Cosmos DB does not require any special JSON conventions to codify the relationships among various documents; the SQL syntax of Cosmos DB provides very powerful hierarchical and relational query operators to query and project documents without any special annotations or need to codify relationships among documents using distinguished properties.</span></span>  

<span data-ttu-id="93d65-366">Как и для всех других ресурсов, документы могут быть созданы, заменены, удалены, прочитаны, перечислены и запрошены с использованием API REST или любого [клиентского пакета SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="93d65-366">As with all other resources, documents can be created, replaced, deleted, read, enumerated and queried easily using either REST APIs or any of the [client SDKs](documentdb-sdk-dotnet.md).</span></span> <span data-ttu-id="93d65-367">Удаление документа мгновенно освобождает квоту, соответствующую всем его вложениям.</span><span class="sxs-lookup"><span data-stu-id="93d65-367">Deleting a document instantly frees up the quota corresponding to all of the nested attachments.</span></span> <span data-ttu-id="93d65-368">Уровень согласованности для чтения документов соответствует политике согласованности для учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-368">The read consistency level of documents follows the consistency policy on the database account.</span></span> <span data-ttu-id="93d65-369">Эта политика может быть переопределена для каждого запроса в зависимости от требований к согласованности данных для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="93d65-369">This policy can be overridden on a per-request basis depending on data consistency requirements of your application.</span></span> <span data-ttu-id="93d65-370">При запросе документов согласованность чтения соответствует режиму индексирования, который задан в коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-370">When querying documents, the read consistency follows the indexing mode set on the collection.</span></span> <span data-ttu-id="93d65-371">Понятие "согласованность" следует политике согласованности для учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-371">For “consistent”, this follows the account’s consistency policy.</span></span> 

## <a name="attachments-and-media"></a><span data-ttu-id="93d65-372">Вложения и мультимедиа</span><span class="sxs-lookup"><span data-stu-id="93d65-372">Attachments and media</span></span>
<span data-ttu-id="93d65-373">Cosmos DB позволяет хранить большие двоичные объекты и мультимедийные файлы непосредственно в Cosmos DB (не более 2 ГБ на одну учетную запись) или в удаленном хранилище файлов.</span><span class="sxs-lookup"><span data-stu-id="93d65-373">Cosmos DB allows you to store binary blobs/media either with Cosmos DB (maximum of 2 GB per account) or to your own remote media store.</span></span> <span data-ttu-id="93d65-374">Она также позволяет представлять метаданные медиафайлов в виде особого документа под названием "вложение".</span><span class="sxs-lookup"><span data-stu-id="93d65-374">It also allows you to represent the metadata of a media in terms of a special document called attachment.</span></span> <span data-ttu-id="93d65-375">Вложение в Cosmos DB — это специальный документ JSON, который ссылается на медиафайлы или большие двоичные объекты, хранящиеся где угодно.</span><span class="sxs-lookup"><span data-stu-id="93d65-375">An attachment in Cosmos DB is a special (JSON) document that references the media/blob stored elsewhere.</span></span> <span data-ttu-id="93d65-376">Вложение представляет собой специальный документ, который фиксирует метаданные (например, расположение, автора и т. д.) медиафайлов, хранящихся в удаленном хранилище.</span><span class="sxs-lookup"><span data-stu-id="93d65-376">An attachment is simply a special document that captures the metadata (e.g. location, author etc.) of a media stored in a remote media storage.</span></span> 

<span data-ttu-id="93d65-377">Рассмотрим социальное приложение для чтения, которое использует Cosmos DB для хранения заметок и метаданных, включая комментарии, выделения, закладки, рейтинги, пометки "нравится" или "не нравится" и т. д., связанные с электронной книгой данного пользователя.</span><span class="sxs-lookup"><span data-stu-id="93d65-377">Consider a social reading application which uses Cosmos DB to store ink annotations, and metadata including comments, highlights, bookmarks, ratings, likes/dislikes etc. associated for an e-book of a given user.</span></span>   

* <span data-ttu-id="93d65-378">Содержание самой книги хранится в файловом хранилище, доступном как часть учетной записи базы данных Cosmos DB или как удаленное хранилище файлов.</span><span class="sxs-lookup"><span data-stu-id="93d65-378">The content of the book itself is stored in the media storage either available as part of Cosmos DB database account or a remote media store.</span></span> 
* <span data-ttu-id="93d65-379">Приложение может хранить метаданные каждого пользователя в виде отдельного документа. Например, метаданные пользователя Джо для книги Book1 можно хранить в документе, имеющем ссылку /colls/joe/docs/book1.</span><span class="sxs-lookup"><span data-stu-id="93d65-379">An application may store each user’s metadata as a distinct document -- e.g. Joe’s metadata for book1 is stored in a document referenced by /colls/joe/docs/book1.</span></span> 
* <span data-ttu-id="93d65-380">Вложения, указывающие на страницы содержимого данной книги пользователя, хранятся в соответствующем документе, например, /colls/joe/docs/book1/chapter1, /colls/joe/docs/book1/chapter2 и т. д.</span><span class="sxs-lookup"><span data-stu-id="93d65-380">Attachments pointing to the content pages of a given book of a user are stored under the corresponding document e.g. /colls/joe/docs/book1/chapter1, /colls/joe/docs/book1/chapter2 etc.</span></span> 

<span data-ttu-id="93d65-381">Обратите внимание, что в приведенных выше примерах используются мнемонические идентификаторы для передачи иерархии ресурсов.</span><span class="sxs-lookup"><span data-stu-id="93d65-381">Note that the examples listed above use friendly ids to convey the resource hierarchy.</span></span> <span data-ttu-id="93d65-382">Ресурсы доступны через API REST с помощью уникальных идентификаторов ресурсов.</span><span class="sxs-lookup"><span data-stu-id="93d65-382">Resources are accessed via the REST APIs through unique resource ids.</span></span> 

<span data-ttu-id="93d65-383">Для медиафайлов, которые управляются Cosmos DB, свойство вложения _media будет содержать ссылку на URI медиафайла.</span><span class="sxs-lookup"><span data-stu-id="93d65-383">For the media that is managed by Cosmos DB, the _media property of the attachment will reference the media by its URI.</span></span> <span data-ttu-id="93d65-384">Cosmos DB запустит уборку мусора, когда все находящиеся в коллекции ссылки на медиафайл будут удалены.</span><span class="sxs-lookup"><span data-stu-id="93d65-384">Cosmos DB will ensure to garbage collect the media when all of the outstanding references are dropped.</span></span> <span data-ttu-id="93d65-385">Cosmos DB автоматически генерирует вложение, когда вы загружаете новые медиафайлы, и заполняет свойство _media ссылками на вновь добавленные файлы.</span><span class="sxs-lookup"><span data-stu-id="93d65-385">Cosmos DB automatically generates the attachment when you upload the new media and populates the _media to point to the newly added media.</span></span> <span data-ttu-id="93d65-386">Если вы решите хранить медиафайлы в удаленном хранилище больших двоичных объектов, управляемом вами (например OneDrive, хранилище Azure, DropBox и т. д.), вы можете использовать вложения для хранения ссылок.</span><span class="sxs-lookup"><span data-stu-id="93d65-386">If you choose to store the media in a remote blob store managed by you (e.g. OneDrive, Azure Storage, DropBox etc), you can still use attachments to reference the media.</span></span> <span data-ttu-id="93d65-387">В этом случае вам придется создавать вложение и заполнять его свойство _media самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="93d65-387">In this case, you will create the attachment yourself and populate its _media property.</span></span>   

<span data-ttu-id="93d65-388">Как и все прочие ресурсы, вложения могут быть созданы, заменены, удалены, прочитаны или перечислены с помощью API REST либо любого клиентского пакета SDK.</span><span class="sxs-lookup"><span data-stu-id="93d65-388">As with all other resources, attachments can be created, replaced, deleted, read or enumerated easily using either REST APIs or any of the client SDKs.</span></span> <span data-ttu-id="93d65-389">Как и для документов, уровень согласованности для чтения вложений соответствует политике согласованности для учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-389">As with documents, the read consistency level of attachments follows the consistency policy on the database account.</span></span> <span data-ttu-id="93d65-390">Эта политика может быть переопределена для каждого запроса в зависимости от требований к согласованности данных для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="93d65-390">This policy can be overridden on a per-request basis depending on data consistency requirements of your application.</span></span> <span data-ttu-id="93d65-391">При запросе вложений согласованность чтения соответствует режиму индексирования, который задан в коллекции.</span><span class="sxs-lookup"><span data-stu-id="93d65-391">When querying for attachments, the read consistency follows the indexing mode set on the collection.</span></span> <span data-ttu-id="93d65-392">Понятие "согласованность" следует политике согласованности для учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-392">For “consistent”, this follows the account’s consistency policy.</span></span> 
 

## <a name="users"></a><span data-ttu-id="93d65-393">Пользователи</span><span class="sxs-lookup"><span data-stu-id="93d65-393">Users</span></span>
<span data-ttu-id="93d65-394">Пользователь в Cosmos DB представляет собой логическое пространство имен для группировки разрешений.</span><span class="sxs-lookup"><span data-stu-id="93d65-394">A Cosmos DB user represents a logical namespace for grouping permissions.</span></span> <span data-ttu-id="93d65-395">Пользователю в Cosmos DB может соответствовать пользователь в системе управления удостоверениями или предопределенной роли приложения.</span><span class="sxs-lookup"><span data-stu-id="93d65-395">A Cosmos DB user may correspond to a user in an identity management system or a predefined application role.</span></span> <span data-ttu-id="93d65-396">В рамках Cosmos DB пользователь представляет собой абстракцию для группировки набора разрешений в базе данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-396">For Cosmos DB, a user simply represents an abstraction to group a set of permissions under a database.</span></span>   

<span data-ttu-id="93d65-397">Чтобы реализовать для приложения многопользовательскую среду, вы можете создавать пользователей в Cosmos DB, которые будут соответствовать фактическим пользователям или клиентам приложения.</span><span class="sxs-lookup"><span data-stu-id="93d65-397">For implementing multi-tenancy in your application, you can create users in Cosmos DB which corresponds to your actual users or the tenants of your application.</span></span> <span data-ttu-id="93d65-398">Затем можно создать разрешения для данного пользователя, которые соответствуют уровням доступа к различным коллекциям, документам, приложениям и т. д.</span><span class="sxs-lookup"><span data-stu-id="93d65-398">You can then create permissions for a given user that correspond to the access control over various collections, documents, attachments, etc.</span></span>   

<span data-ttu-id="93d65-399">По мере расширения вашего приложения с ростом количества пользователей вы можете использовать различные способы для сегментирования данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-399">As your applications need to scale with your user growth, you can adopt various ways to shard your data.</span></span> <span data-ttu-id="93d65-400">Вы можете смоделировать каждого из пользователей следующим образом:</span><span class="sxs-lookup"><span data-stu-id="93d65-400">You can model each of your users as follows:</span></span>   

* <span data-ttu-id="93d65-401">каждый пользователь сопоставлен базе данных;</span><span class="sxs-lookup"><span data-stu-id="93d65-401">Each user maps to a database.</span></span>
* <span data-ttu-id="93d65-402">каждый пользователь сопоставлен коллекции;</span><span class="sxs-lookup"><span data-stu-id="93d65-402">Each user maps to a collection.</span></span> 
* <span data-ttu-id="93d65-403">документы, соответствующие нескольким пользователям, отправляются в выделенную коллекцию;</span><span class="sxs-lookup"><span data-stu-id="93d65-403">Documents corresponding to multiple users go to a dedicated collection.</span></span> 
* <span data-ttu-id="93d65-404">документы, соответствующие нескольким пользователям, отправляются в набор коллекций.</span><span class="sxs-lookup"><span data-stu-id="93d65-404">Documents corresponding to multiple users go to a set of collections.</span></span>   

<span data-ttu-id="93d65-405">Независимо от конкретной стратегии сегментирования, вы можете моделировать реальных пользователей в качестве пользователей в базе данных Cosmos DB и присваивать точные разрешения каждому.</span><span class="sxs-lookup"><span data-stu-id="93d65-405">Regardless of the specific sharding strategy you choose, you can model your actual users as users in Cosmos DB database and associate fine grained permissions to each user.</span></span>  

<span data-ttu-id="93d65-406">![Коллекции пользователей][3]</span><span class="sxs-lookup"><span data-stu-id="93d65-406">![User collections][3]</span></span>  
<span data-ttu-id="93d65-407">**Стратегии сегментирования и моделирования пользователей**</span><span class="sxs-lookup"><span data-stu-id="93d65-407">**Sharding strategies and modeling users**</span></span>

<span data-ttu-id="93d65-408">Как и все прочие ресурсы, пользователей в Cosmos DB можно создавать, заменять, удалять, считывать или перечислять с помощью интерфейсов REST API либо любого клиентского пакета SDK.</span><span class="sxs-lookup"><span data-stu-id="93d65-408">Like all other resources, users in Cosmos DB can be created, replaced, deleted, read or enumerated easily using either REST APIs or any of the client SDKs.</span></span> <span data-ttu-id="93d65-409">Cosmos DB всегда обеспечивает строгую согласованность для чтения или запроса метаданных ресурса пользователя.</span><span class="sxs-lookup"><span data-stu-id="93d65-409">Cosmos DB always provides strong consistency for reading or querying the metadata of a user resource.</span></span> <span data-ttu-id="93d65-410">Стоит отметить, что при удалении пользователя гарантируется, что вы не сможете получить доступ к любому из разрешений, входящих в его состав.</span><span class="sxs-lookup"><span data-stu-id="93d65-410">It is worth pointing out that deleting a user automatically ensures that you cannot access any of the permissions contained within it.</span></span> <span data-ttu-id="93d65-411">Удаленные разрешения станут доступны сразу же для повторного использования, несмотря на то, что Cosmos DB восстанавливает квоту разрешений удаленного пользователя в фоновом режиме.</span><span class="sxs-lookup"><span data-stu-id="93d65-411">Even though the Cosmos DB reclaims the quota of the permissions as part of the deleted user in the background, the deleted permissions is available instantly again for you to use.</span></span>  

## <a name="permissions"></a><span data-ttu-id="93d65-412">Разрешения</span><span class="sxs-lookup"><span data-stu-id="93d65-412">Permissions</span></span>
<span data-ttu-id="93d65-413">В контексте контроля доступа такие ресурсы, как учетные записи баз данных, базы данных, пользователи и разрешения, считаются *административными* ресурсами, так как для обращения к ним требуются права администратора.</span><span class="sxs-lookup"><span data-stu-id="93d65-413">From an access control perspective, resources such as database accounts, databases, users and permission are considered *administrative* resources since these require administrative permissions.</span></span> <span data-ttu-id="93d65-414">С другой стороны, ресурсы, включая коллекции, документы, вложения, хранимые процедуры, триггеры и пользовательские функции, находятся в области видимости данной базы данных и рассматриваются как *ресурсы приложения*.</span><span class="sxs-lookup"><span data-stu-id="93d65-414">On the other hand, resources including the collections, documents, attachments, stored procedures, triggers, and UDFs are scoped under a given database and considered *application resources*.</span></span> <span data-ttu-id="93d65-415">В соответствии с двумя типами ресурсов и ролями, которые обращаются к ним (администратора и пользователей), модель авторизации определяет два типа *ключей доступа*: *главный ключ* и *ключ ресурса*.</span><span class="sxs-lookup"><span data-stu-id="93d65-415">Corresponding to the two types of resources and the roles that access them (namely the administrator and user), the authorization model defines two types of *access keys*: *master key* and *resource key*.</span></span> <span data-ttu-id="93d65-416">Мастер-ключ является частью учетной записи базы данных и предоставляется разработчику (или администратору), который подготавливает учетную запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="93d65-416">The master key is a part of the database account and is provided to the developer (or administrator) who is provisioning the database account.</span></span> <span data-ttu-id="93d65-417">Этот мастер-ключ имеет семантику администратора, в том смысле, что он может быть использован для того, чтобы разрешить доступ как к административным, так и к прикладным ресурсам.</span><span class="sxs-lookup"><span data-stu-id="93d65-417">This master key has administrator semantics, in that it can be used to authorize access to both administrative and application resources.</span></span> <span data-ttu-id="93d65-418">В отличие от этого, ключ ресурса является разделенным ключом доступа, который позволяет получить доступ к *определенному* ресурсу приложения.</span><span class="sxs-lookup"><span data-stu-id="93d65-418">In contrast, a resource key is a granular access key that allows access to a *specific* application resource.</span></span> <span data-ttu-id="93d65-419">Таким образом, он охватывает отношения между пользователем базы данных и разрешениями пользователя, которые он имеет для определенного ресурса (например, коллекции, документа, вложения, хранимой процедуры, триггера или пользовательской функции).</span><span class="sxs-lookup"><span data-stu-id="93d65-419">Thus, it captures the relationship between the user of a database and the permissions the user has for a specific resource (e.g. collection, document, attachment, stored procedure, trigger, or UDF).</span></span>   

<span data-ttu-id="93d65-420">Единственным способом получить ключ ресурса является создание разрешения для ресурса под конкретного пользователя.</span><span class="sxs-lookup"><span data-stu-id="93d65-420">The only way to obtain a resource key is by creating a permission resource under a given user.</span></span> <span data-ttu-id="93d65-421">Обратите внимание, что в для создания или получения разрешения, мастер-ключ должен быть представлен в заголовке авторизации.</span><span class="sxs-lookup"><span data-stu-id="93d65-421">Note that In order to create or retrieve a permission, a master key must be presented in the authorization header.</span></span> <span data-ttu-id="93d65-422">Разрешение ресурса связывает ресурс, доступ к нему и пользователя.</span><span class="sxs-lookup"><span data-stu-id="93d65-422">A permission resource ties the resource, its access and the user.</span></span> <span data-ttu-id="93d65-423">После создания разрешения ресурса пользователю нужно только предоставить ключ, связанный с ресурсами, для того чтобы получить доступ к соответствующему ресурсу.</span><span class="sxs-lookup"><span data-stu-id="93d65-423">After creating a permission resource, the user only needs to present the associated resource key in order to gain access to the relevant resource.</span></span> <span data-ttu-id="93d65-424">Таким образом, ключ ресурса можно рассматривать как логическое и компактное представление разрешения ресурса.</span><span class="sxs-lookup"><span data-stu-id="93d65-424">Hence, a resource key can be viewed as a logical and compact representation of the permission resource.</span></span>  

<span data-ttu-id="93d65-425">Как и все прочие ресурсы, разрешения можно создать, заменить, удалить, считать или перечислить с помощью интерфейсов REST API или любого клиентского пакета SDK.</span><span class="sxs-lookup"><span data-stu-id="93d65-425">As with all other resources, permissions in Cosmos DB can be created, replaced, deleted, read or enumerated easily using either REST APIs or any of the client SDKs.</span></span> <span data-ttu-id="93d65-426">Cosmos DB всегда обеспечивает предельную согласованность для чтения или запроса метаданных разрешения.</span><span class="sxs-lookup"><span data-stu-id="93d65-426">Cosmos DB always provides strong consistency for reading or querying the metadata of a permission.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="93d65-427">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="93d65-427">Next steps</span></span>
<span data-ttu-id="93d65-428">Дополнительные сведения о работе с ресурсами с помощью команд HTTP см. в статье [Azure Cosmos DB: Azure Cosmos DB REST API](https://msdn.microsoft.com/library/azure/mt622086.aspx) (Azure Cosmos DB. REST API Azure Cosmos DB).</span><span class="sxs-lookup"><span data-stu-id="93d65-428">Learn more about working with resources by using HTTP commands in [RESTful interactions with Cosmos DB resources](https://msdn.microsoft.com/library/azure/mt622086.aspx).</span></span>

[1]: media/documentdb-resources/resources1.png
[2]: media/documentdb-resources/resources2.png
[3]: media/documentdb-resources/resources3.png

