---
title: "aaaAzure Cosmos DB модель ресурсов и понятия | Документы Microsoft"
description: "Дополнительные сведения о Azure Cosmos DB иерархическая модель базы данных, коллекций, определяемые пользователем функции (UDF), документы, разрешения toomanage ресурсы и многое другое."
keywords: "Иерархическая модель, cosmosdb, azure, Microsoft Azure"
services: cosmos-db
documentationcenter: 
author: AndrewHoh
manager: jhubbard
editor: monicar
ms.assetid: ef9d5c0c-0867-4317-bb1b-98e219799fd5
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/24/2017
ms.author: anhoh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: fc3642232b86cc27901ebd97456c386829324632
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-cosmos-db-hierarchical-resource-model-and-core-concepts"></a>Ключевые понятия и иерархическая модель ресурсов в Azure Cosmos DB
Hello сущностей базы данных, которыми управляет Azure Cosmos DB, который ссылается tooas **ресурсов**. Каждый ресурс однозначно идентифицируется своими логическим URI. Вы можете взаимодействовать с ресурсами hello, с помощью стандартных команд HTTP, заголовки запросов и ответов и коды состояния. 

Считывает в этой статье, вы будете иметь доступ tooanswer hello следующие вопросы:

* Что такое модель ресурсов Cosmos DB?
* Что такое системные ресурсам, определенным в противоположность toouser определенных ресурсов?
* Как получить доступ к ресурсу?
* Как работать с коллекциями?
* Как работать с хранимыми процедурами, триггерами и пользовательскими функциями?

## <a name="hierarchical-resource-model"></a>Иерархическая модель ресурсов
Как hello показано на рисунке, hello Cosmos DB иерархические **модель ресурсов** состоят из наборов ресурсами под учетной записью базы данных, каждый адресуемых через URI логических и стабильности. Набор ресурсов будет ссылка tooas **канала** в этой статье. 

> [!NOTE]
> Azure Cosmos DB предлагает высокоэффективные протокол TCP, который также является категории RESTful в его модель взаимодействия, доступные через hello [API клиента DocumentDB .NET](documentdb-sdk-dotnet.md).
> 
> 

![Иерархическая модель ресурсов в Azure Cosmos DB][1]  
**Иерархическая модель ресурсов.**   

Работа с ресурсами, toostart необходимо [создать учетную запись базы данных](create-documentdb-dotnet.md) с помощью вашей подписки Azure. Учетная запись базы данных может состоять из набора **баз данных**, каждая из которых содержит несколько **коллекций**, каждая из которых, в свою очередь, содержит **хранимые процедуры, триггеры, определяемые пользователем функции, документы** и соответствующие **вложения**. Базы данных также связанный **пользователей**, каждый из которых набор **разрешений** tooaccess коллекций, хранимые процедуры, триггеры, определяемые пользователем функции, документы или вложения. В то время как базы данных, пользователи, разрешения и коллекции являются определяемыми системой ресурсами с известными схемами, документы и вложения содержат произвольный, определяемый пользователем контент в формате JSON.  

| Resource (Ресурс) | Описание |
| --- | --- |
| Учетная запись базы данных |Учетная запись базы данных связана с набором баз и определенным местом в хранилище больших двоичных объектов для хранения вложений. Вы можете создать одну или несколько учетных записей базы данных с помощью подписки Azure. Дополнительные сведения см. на нашей [странице цен](https://azure.microsoft.com/pricing/details/cosmos-db/). |
| База данных |База данных представляет собой логический контейнер для хранения документов, разделенных между коллекциями. Она также является контейнером для пользователей. |
| Пользователь |Hello логического пространства имен для определения разрешений. |
| Разрешение |Маркер авторизации, связанный с пользователем для доступа tooa конкретный ресурс. |
| Коллекция |Коллекция — это контейнер документов JSON и hello связанные логика приложения JavaScript. Коллекция является оплачиваемые сущности, в котором hello [стоимость](performance-levels.md) определяется hello уровень производительности, связанных с коллекцией hello. Коллекции могут охватывать один или несколько секций или серверов и можно масштабировать toohandle практически неограниченное тома хранилища или пропускной способности. |
| Хранимая процедура |Логика приложения, написанная на языке JavaScript, который зарегистрирован в коллекции и выполняться транзакционно в компонент database engine hello. |
| Триггер |Логика приложения в виде кода JavaScript, автоматически исполняемого до или после операций вставки, замены и удаления. |
| Определяемая пользователем функция |Логика приложения на языке JavaScript. Определяемые пользователем функции, включите toomodel оператор пользовательского запроса и тем самым расширения языка запросов DocumentDB API core hello. |
| Документ |Пользовательский (произвольный) контент JSON. По умолчанию схема не требуются определенные toobe ни вторичных индексов нужен toobe условии для hello все документы добавляются tooa коллекции. |
| Вложение |Вложение — это специальный документ, содержащий ссылки и связанные с ним метаданные ко внешним большим двоичным объектам и носителям. Разработчик Hello можно выбрать hello toohave больших двоичных объектов, управляется Cosmos DB или сохранить его с поставщиком услуг внешний большой двоичный объект, таких как OneDrive, Dropbox и т. д. |

## <a name="system-vs-user-defined-resources"></a>Системные и пользовательские ресурсы
Ресурсы (такие как учетные записи баз данных, базы данных, коллекции, пользователи, разрешения, хранимые процедуры, триггеры и определяемые пользователем функции) имеют статическую схему и называются системными ресурсами. Ресурсы, такие как документы и вложения, напротив, не имеют ограничений на схему hello и приведены примеры ресурсов, определяемых пользователем. В службе Cosmos DB системные и определяемые пользователем ресурсы представляются и управляются как стандартные, совместимые с JSON объекты. Все ресурсы, системы или определяемые пользователем, имеют следующие общие свойства hello.

> [!NOTE]
> Обратите внимание, что все сгенерированные системой свойства в ресурсах начинаются с символа подчеркивания (_) в представлении JSON.
> 
> 

<table>
    <tbody>
        <tr>
            <td valign="top"><p><strong>Свойство</strong></p></td>
            <td valign="top"><p><strong>Устанавливаемое пользователем или генерируемое системой?</strong></p></td>
            <td valign="top"><p><strong>Назначение</strong></p></td>
        </tr>
        <tr>
            <td valign="top"><p>_rid</p></td>
            <td valign="top"><p>Генерируемое системой</p></td>
            <td valign="top"><p>Созданный системой уникальный, так и иерархическим идентификатор ресурса hello</p></td>
        </tr>
        <tr>
            <td valign="top"><p>_etag</p></td>
            <td valign="top"><p>Генерируемое системой</p></td>
            <td valign="top"><p>eTag ресурса hello, необходимые для управления оптимистичным параллелизмом</p></td>
        </tr>
        <tr>
            <td valign="top"><p>_ts</p></td>
            <td valign="top"><p>Генерируемое системой</p></td>
            <td valign="top"><p>Метку времени последнего обновления ресурса hello</p></td>
        </tr>
        <tr>
            <td valign="top"><p>_self</p></td>
            <td valign="top"><p>Генерируемое системой</p></td>
            <td valign="top"><p>Уникальный адресуемый URI ресурса hello</p></td>
        </tr>
        <tr>
            <td valign="top"><p>id</p></td>
            <td valign="top"><p>Генерируемое системой</p></td>
            <td valign="top"><p>Определяемые пользователем уникальное имя ресурса hello (с hello же секции для значения ключа использования). Если пользователь hello не указан идентификатор, идентификатор будет созданный системой</p></td>
        </tr>
    </tbody>
</table>

### <a name="wire-representation-of-resources"></a>Сетевое представление ресурсов
Cosmos DB не требует собственных расширений toohello JSON стандартных или специальных кодировкам; она работает с стандартных совместимые документов JSON.  

### <a name="addressing-a-resource"></a>Адресация ресурса
Все ресурсы можно адресовать по URI. Здравствуйте, значение hello **_self** свойство ресурса представляет hello относительный URI ресурса hello. Hello формат hello URI представляет hello /\<канала\>/ {_rid} сегментов пути:  

| Значение hello _self | Описание |
| --- | --- |
| /dbs |Канал баз данных под учетной записью базы данных |
| /dbs/{dbName} |Базы данных с идентификатором сопоставления hello значения {dbName} |
| /dbs/{dbName}/colls/ |Канал коллекций в базе данных |
| /dbs/{dbName}/colls/{collName} |Коллекция с идентификатором сопоставления hello значения {collName} |
| /dbs/{dbName}/colls/{collName}/docs |Канал документов в коллекции |
| /dbs/{dbName}/colls/{collName}/docs/{docId} |Документ с идентификатором, соответствующих значению hello {doc} |
| /dbs/{dbName}/users/ |Канал пользователей в базе данных |
| /dbs/{dbName}/users/{userId} |Пользователь с идентификатором, соответствующих значению hello {user} |
| /dbs/{dbName}/users/{userId}/permissions |Канал разрешений для пользователя |
| /dbs/{dbName}/users/{userId}/permissions/{permissionId} |Разрешение с идентификатором сопоставления hello значения {permission} |

Каждый ресурс имеет уникальное определено имя пользователя через свойство идентификатора hello. Примечание: для документов, если пользователь hello не указан идентификатор, то нашей поддерживаемых пакетов SDK автоматически создаст уникальный идентификатор для hello документа. Идентификатор Hello имеет определенные пользователем строку, копирование too256 символов, уникальное в пределах контекста hello определенного родительского ресурса. 

Каждый ресурс имеет генерируемый системой идентификатор ресурса иерархической (также назывались tooas RID), которая доступна через свойство _rid hello. Hello RID кодирует hello всей иерархии ресурс, и он представляет собой удобный внутреннее представление используемых tooenforce ссылочной целостности в распределенной среде. Hello RID является уникальным в пределах учетной записи базы данных и его внутренне используется Cosmos DB для эффективную маршрутизацию, не требуя уточняющие запросы перекрестного секции. значения Hello hello _self и свойств _rid hello: альтернативное и каноническое представление ресурса. 

Поддержка API-интерфейс REST Hello адресации ресурсов и маршрутизацию запросов с идентификатором hello и свойства _rid hello.

## <a name="database-accounts"></a>Учетные записи базы данных
Вы можете подготовить одну или несколько учетных записей базы данных Cosmos DB с помощью подписки Azure.

Можно создавать и управлять учетными записями базы данных Cosmos DB через портал Azure hello в [http://portal.azure.com/](https://portal.azure.com/). Создание и управление учетной записью базы данных требует наличия административного доступа и может быть выполнено только в рамках вашей подписки Azure. 

### <a name="database-account-properties"></a>Свойства учетной записи базы данных
В рамках подготовки и управления учетной записью базы данных можно настроить и чтение hello следующие свойства:  

<table border="0" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td valign="top"><p><strong>Имя свойства</strong></p></td>
            <td valign="top"><p><strong>Описание</strong></p></td>
        </tr>
        <tr>
            <td valign="top"><p>Политика согласованности</p></td>
            <td valign="top"><p>Установите этот уровень свойство tooconfigure hello по умолчанию согласованности для всех коллекций hello под учетной записью базы данных. Можно переопределить уровень согласованности hello отдельно для каждого запроса с помощью заголовка запроса hello [x-ms-consistency-level]. <p><p>Обратите внимание, что это свойство применяется только toohello <i>пользователем ресурсов</i>. Все системные ресурсы, настроенные toosupport операций чтения и запросы строго согласованная.</p></td>
        </tr>
        <tr>
            <td valign="top"><p>Ключи авторизации</p></td>
            <td valign="top"><p>Это основной hello и вторичные ключи master и только для чтения, предоставляющие административные доступа tooall hello ресурсов под учетной записью hello базы данных.</p></td>
        </tr>
    </tbody>
</table>

Обратите внимание, что в tooprovisioning сложения, настройке и управлении вашей учетной записи базы данных из hello портала Azure можно также программно создать и управление учетными записями Cosmos DB базы данных с помощью hello [API-интерфейсы DB Cosmos REST Azure](/rest/api/documentdb/) как а также [клиентских SDK](documentdb-sdk-dotnet.md).  

## <a name="databases"></a>Базы данных
Cosmos DB базы данных — это логический контейнер, один или несколько коллекций и пользователей, как показано в hello следующие схемы. Можно создать любое количество баз данных в группе toooffer субъекта Cosmos DB учетной записи базы данных ограничения.  

![Учетная запись базы данных и иерархическая модель коллекций][2]  
**База данных представляет собой логический контейнер пользователей и коллекций**

База данных может содержать практически неограниченное хранилище документов, секционированное внутри коллекций.

### <a name="elastic-scale-of-a-cosmos-db-database"></a>Гибкое масштабирование базы данных Cosmos DB
Cosmos DB базы данных, является гибким по умолчанию — в диапазоне от нескольких toopetabytes ГБ SSD резервного хранилища документов и пропускная способность. 

В отличие от базы данных в традиционных реляционной СУБД базы данных в базу данных, Cosmos не tooa области одного компьютера. С помощью Cosmos DB как масштаб приложения должен toogrow, можно создавать несколько коллекций и баз данных. Действительно, различные собственные приложения корпорации Майкрософт уже используют Cosmos DB в потребительском масштабе, создавая чрезвычайно большие базы данных Cosmos DB, каждая из которых содержит тысячи коллекций с терабайтами хранилищ документов. Вы можете увеличить или уменьшить базы данных путем добавления или удаления коллекции toomeet шкалы требования вашего приложения. 

Можно создать любое количество коллекций в предложение toohello субъекта базы данных. Каждая коллекция имеет SSD резервного хранилища и подготовленной автоматически в зависимости от уровня производительности выбранного hello пропускной способности.

Cosmos DB также является контейнером пользователей. Пользователь, в свою очередь, является логическим пространством имен для набора разрешений, предоставляющий детально toocollections авторизации и доступа, документы и вложения.  

Как базы данных создаются с другими ресурсами в модели ресурсов Cosmos DB hello, заменены, удален, чтение или перечисление легко с помощью либо hello [API-интерфейс REST](/rest/api/documentdb/) или любой hello [клиентских SDK](documentdb-sdk-dotnet.md). Cosmos DB гарантирует строгая согласованность для запроса метаданных hello ресурса базы данных или чтения. При удалении базы данных автоматически гарантирует, что получить доступ к коллекции hello или пользователей, содержащиеся в нем.   

## <a name="collections"></a>Коллекции
Коллекция Cosmos DB — это контейнер для документов JSON. 

### <a name="elastic-ssd-backed-document-storage"></a>Гибкое хранилище документов на базе SSD
Коллекция является неразрывно гибкой, она автоматически увеличивается и уменьшается по мере добавления или удаления документов. Коллекции — это логические ресурсы, они могут включать в себя одну или несколько физических секций или серверов. Hello количество разделов в коллекции определяется на основе размера хранилища hello и пропускная способность hello коллекции DB Cosmos. С каждой секцией в базе данных Azure Cosmos DB связано фиксированное количество хранилищ на основе SSD, которое реплицируется для обеспечения высокого уровня доступности. Управление секциями полностью управляются Azure Cosmos DB и управления секциями или не toowrite сложный код. Коллекции Cosmos DB **практически не ограничены** в объеме хранилища и пропускной способности. 

### <a name="automatic-indexing-of-collections"></a>Автоматическое индексирование коллекций
Cosmos DB — это система баз данных без схемы. Он не предполагают и не требует любой схемы для документов JSON hello. При добавлении tooa набор документов Cosmos DB автоматически индексирует их, и они становятся доступны для вас tooquery. Автоматическая индексация документов, не требующая указания схемы или вторичных индексов, является ключевой возможностью Cosmos DB и доступна благодаря оптимизированным для записи технологиям обслуживания индексов без блокировки, которые структурированы для журнала. Cosmos DB поддерживает устойчивый объем чрезвычайно быстрых операций записи и в то же время обслуживает согласованные запросы. Хранилище документа и индекса, используемый toocalculate хранилища hello, каждая коллекция. Можно управлять hello хранения и производительности компромиссы связанные с индексированием, настроив hello политики индексирования для коллекции. 

### <a name="configuring-hello-indexing-policy-of-a-collection"></a>Настройка политики индексирования hello коллекции
Hello индексирования политики из каждой коллекции можно toomake производительность и хранилище компромиссы связанные с индексированием. Hello доступны следующие параметры доступны tooyou как часть конфигурации индексирования:  

* Выберите, является ли коллекция hello автоматически индексирует все документы hello или не. По умолчанию все документы индексируются автоматически. Можно выбрать tooturn отключение автоматического индексирования и избирательно добавлять только индексы toohello конкретных документов. И наоборот можно выборочно выбрать tooexclude только конкретных документов. Для этого параметра toobe автоматическое свойство hello true или false в indexingPolicy hello коллекции и с помощью заголовка запроса hello [x-ms-indexingdirective] во время вставки, замены или удаления документов.  
* Выберите hello ли tooinclude или исключить определенные пути или шаблоны в документах из индекса. Этого можно добиться, параметр includedPaths и excludedPaths на indexingPolicy hello коллекции соответственно. Можно также настроить hello хранения и производительности преимущества и недостатки для диапазона и хэш-запросы для определенного пути шаблонов. 
* Выбор между синхронными обновлениями (согласованные) и асинхронными обновлениями (отложенные) индекса. По умолчанию hello индекс обновляется синхронно для каждой вставки, замены или удаления коллекции toohello документа. Это позволяет выполнять запросы hello toohonor hello уровень согласованности, hello чтения документа. Cosmos DB записи оптимизированной и поддерживает длительной тома записи документа вместе с обслуживание синхронной индекса и обслуживает запросы согласованной, можно настроить некоторые tooupdate коллекций их индекс неактивно. Отложенного индексирования повышает производительность записи hello дальнейшей и идеально подходит для сценариев массового приема в основном интенсивных коллекций.

Привет, политика индексирования можно изменить, выполнив операцию PUT в коллекцию hello. Это может быть достигнута посредством hello [пакет SDK для клиента](documentdb-sdk-dotnet.md), hello [портала Azure](https://portal.azure.com) или hello [API-интерфейс REST](/rest/api/documentdb/).

### <a name="querying-a-collection"></a>Запросы к коллекции
Hello документы в коллекции может быть произвольной схемы и документов в коллекции можно запрашивать без указания любой схемы или заранее вторичных индексов. Вы можете запрашивать hello коллекции, используя hello [Azure Cosmos DB DocumentDB API: Справочник по синтаксису SQL](https://msdn.microsoft.com/library/azure/dn782250.aspx), который играет роль форматированного операторы иерархических реляционных и Пространственные через определяемые пользователем функции на основе JavaScript. Грамматика JSON обеспечивает моделирование документов JSON в виде деревьев с метками hello узлами дерева. Этот подход используется для автоматического индексирования API DocumentDB, а также лежит в основе диалекта SQL API DocumentDB. язык запросов DocumetDB API Hello состоит из трех основных этапов:   

1. Небольшой набор операций запросов, которые естественным образом сопоставляются toohello древовидная структура, включая иерархические запросы и проекции. 
2. Подмножество реляционных операций, включая композиции, фильтры, проекции, агрегатов и внутренние соединения. 
3. Пользовательские функции на основе чистого JavaScript, которые работают с (1) и (2)  

запрос модели Hello Cosmos DB попыток toostrike баланс между функциональные возможности, эффективность и простота. Cosmos Hello СУБД базы данных в собственном коде компилирует и выполняет инструкции SQL-запроса hello. Можно выполнить запрос из коллекции с помощью hello [API-интерфейс REST](/rest/api/documentdb/) или любой hello [клиентских SDK](documentdb-sdk-dotnet.md). Hello .NET SDK поставляется с поставщиком LINQ.

> [!TIP]
> Можно испытать hello DocumentDB API и выполнения запросов SQL, используя наш набор данных в hello [площадку запросов](https://www.documentdb.com/sql/demo).
> 
> 

## <a name="multi-document-transactions"></a>Операции над несколькими документами
Транзакции базы данных предоставляют безопасные и прогнозируемых модель программирования для работы с данными toohello параллельных изменений. В реляционной СУБД, hello традиционным способом toowrite бизнес-логика является toowrite **хранимых процедур** и/или **триггеры** и отправки toohello сервера базы данных для выполнения транзакций. В реляционной СУБД программист приложения hello является обязательным toodeal с двумя различными языками программирования: 

* Hello (нетранзакционных) приложения языка программирования (например JavaScript, Python, C#, Java, и т. д.)
* T-SQL, hello транзакций программирования языке, который изначально выполняется hello базы данных

Посредством tooJavaScript глубокой обязательств и JSON непосредственно в компонент database engine hello, Cosmos DB предоставляет модель программирования интуитивно понятный, для выполнения JavaScript логику приложения непосредственно на основе hello коллекций с точки зрения хранимые процедуры и триггеры. Это позволяет для обоих hello следующее:

* Управлять эффективной реализации параллелизма, восстановления, автоматическое индексирование графов объектов JSON hello непосредственно в ядре СУБД hello
* Естественно выражения потока управления, определение областей переменных, назначения и интеграции примитивы с транзакциями баз данных непосредственно с точки зрения языка программирования JavaScript hello обработки исключений

Hello логику JavaScript, зарегистрированных на уровне коллекции, затем может выдавать операций базы данных в документах hello hello, Получает коллекцию. Cosmos DB неявно приветствия формирует оболочку для JavaScript на основе хранимых процедур и триггеров в окружения ACID-транзакции с изоляцией моментального снимка в документах в коллекции. Hello ходе его выполнения Если hello, JavaScript вызывает исключение, затем hello вся транзакция прерывается. Hello результирующей модели программирования является очень простым мощные. Разработчики JavaScript получают "надежную" модель программирования, при этом используя привычные языковые конструкции и библиотечные примитивы.   

Hello tooexecute возможности JavaScript непосредственно в базе данных hello модуль в hello же адресное пространство, поскольку hello буферного пула позволяет добиться высокой производительностью и транзакций выполнение операций базы данных с документами hello коллекции. Кроме того Cosmos базы данных СУБД делает глубокие обязательств toohello JSON и JavaScript исключает любые несогласованности между системами типов hello приложения и базы данных hello.   

После создания коллекции, можно зарегистрировать хранимые процедуры, триггеры и определяемые пользователем функции из коллекции с помощью hello [API-интерфейс REST](/rest/api/documentdb/) или любой hello [клиентских SDK](documentdb-sdk-dotnet.md). После регистрации вы можете использовать и выполнять их. Рассмотрим следующие hello хранимой процедуры, записанных полностью на языке JavaScript, приведенный ниже код hello принимает два аргумента (имя книги и имя автора) и создает новый документ запрашивает документ и затем обновляет — все в пределах неявная транзакция ACID. В любой момент во время выполнения hello Если исключение JavaScript, прерывает hello всей транзакции.

    function businessLogic(name, author) {
        var context = getContext();
        var collectionManager = context.getCollection();        
        var collectionLink = collectionManager.getSelfLink()

        // create a new document.
        collectionManager.createDocument(collectionLink,
            {id: name, author: author},
            function(err, documentCreated) {
                if(err) throw new Error(err.message);

                // filter documents by author
                var filterQuery = "SELECT * from root r WHERE r.author = 'George R.'";
                collectionManager.queryDocuments(collectionLink,
                    filterQuery,
                    function(err, matchingDocuments) {
                        if(err) throw new Error(err.message);

                        context.getResponse().setBody(matchingDocuments.length);

                        // Replace hello author name for all documents that satisfied hello query.
                        for (var i = 0; i < matchingDocuments.length; i++) {
                            matchingDocuments[i].author = "George R. R. Martin";
                            // we don’t need tooexecute a callback because they are in parallel
                            collectionManager.replaceDocument(matchingDocuments[i]._self,
                                matchingDocuments[i]);   
                        }
                    })
            })
    };

Hello клиента можно «ship» hello выше базы данных toohello логику JavaScript для выполнения транзакций через HTTP POST. Дополнительные сведения об использовании методов HTTP см. в статье [Azure Cosmos DB: Azure Cosmos DB REST API](https://msdn.microsoft.com/library/azure/mt622086.aspx) (Azure Cosmos DB. REST API Azure Cosmos DB). 

    client.createStoredProcedureAsync(collection._self, {id: "CRUDProc", body: businessLogic})
       .then(function(createdStoredProcedure) {
            return client.executeStoredProcedureAsync(createdStoredProcedure.resource._self,
                "NoSQL Distilled",
                "Martin Fowler");
        })
        .then(function(result) {
            console.log(result);
        },
        function(error) {
            console.log(error);
        });


Обратите внимание, что поскольку базы данных hello собственными средствами различает JSON и JavaScript, не несоответствие системы типов, не «Или отображение» или требуется magic формирования кода.   

Хранимые процедуры и триггеры взаимодействовать с документами коллекции и hello в коллекции через модель четко определенный объект, предоставляющий контекст текущего сбора hello.  

Коллекции в hello DocumentDB API можно создать, удалить, чтение или перечисление легко с помощью либо hello [API-интерфейс REST](/rest/api/documentdb/) или любой hello [клиентских SDK](documentdb-sdk-dotnet.md). Hello DocumentDB API всегда предоставляет строгая согласованность для запроса метаданных hello коллекции или чтения. Удаление коллекции автоматически гарантирует, что получить доступ к hello документы, вложения, хранимые процедуры, триггеры и определяемые пользователем функции, которые в нем содержатся.   

## <a name="stored-procedures-triggers-and-user-defined-functions-udf"></a>Хранимые процедуры, триггеры и определяемые пользователями функции (UDF)
Как описано в предыдущем разделе hello, можно написать toorun логику приложения непосредственно в рамках транзакции внутри компонента database engine hello. логика приложения Hello может быть написан полностью в JavaScript и могут задаваться как хранимая процедура, триггер или определяемая пользователем Функция. Hello код JavaScript в хранимой процедуре или триггере можно вставить, замените, удаление, чтение или запроса документов в коллекции. На Здравствуйте другой стороны, hello JavaScript внутри определяемой пользователем функции не может вставить, замена или удаление документов. Определяемые пользователем функции перечисления документы hello результирующего набора запроса и создания другой результирующий набор. Для мультитенантности Cosmos DB реализует управление ресурсами на основе строгого резервирования. Каждая хранимая процедура, триггер или определяемая пользователем Функция возвращает основных такта toodo ресурсы операционной системы свою работу. Кроме того хранимые процедуры, триггеры или определяемые пользователем функции не удается создать связь от внешних библиотек JavaScript и являются черный, если они превышают бюджетов hello ресурсов, распределенных toothem. Можно зарегистрировать, отмените регистрацию хранимые процедуры, триггеры или определяемые пользователем функции с помощью коллекции с помощью hello API-интерфейсов REST.  После регистрации хранимая процедура, триггер или пользовательская функция предварительно компилируются и хранятся в виде байт-кода, который позже запускается на выполнение. Hello в следующем разделе показано, как использовать Cosmos DB JavaScript SDK tooregister hello, выполнения и отмены регистрации хранимой процедуры, триггера, определяемой пользователем функции. пакет JavaScript SDK для Hello является простой оболочкой для hello [API-интерфейс REST](/rest/api/documentdb/). 

### <a name="registering-a-stored-procedure"></a>Регистрация хранимой процедуры
Регистрация хранимой процедуры — это создание нового ресурса хранимой процедуры ресурса в коллекции с помощью HTTP POST.  

    var storedProc = {
        id: "validateAndCreate",
        body: function (documentToCreate) {
            documentToCreate.id = documentToCreate.id.toUpperCase();

            var collectionManager = getContext().getCollection();
            collectionManager.createDocument(collectionManager.getSelfLink(),
                documentToCreate,
                function(err, documentCreated) {
                    if(err) throw new Error('Error while creating document: ' + err.message;
                    getContext().getResponse().setBody('success - created ' + 
                            documentCreated.name);
                });
        }
    };

    client.createStoredProcedureAsync(collection._self, storedProc)
        .then(function (createdStoredProcedure) {
            console.log("Successfully created stored procedure");
        }, function(error) {
            console.log("Error");
        });

### <a name="executing-a-stored-procedure"></a>Выполнение хранимой процедуры
Выполнение хранимой процедуры выполняется путем выдачи путем передачи параметров процедуры toohello в тексте hello запроса HTTP POST от существующего ресурса хранимой процедуры.

    var inputDocument = {id : "document1", author: "G. G. Marquez"};
    client.executeStoredProcedureAsync(createdStoredProcedure.resource._self, inputDocument)
        .then(function(executionResult) {
            assert.equal(executionResult, "success - created DOCUMENT1");
        }, function(error) {
            console.log("Error");
        });

### <a name="unregistering-a-stored-procedure"></a>Отмена регистрации хранимой процедуры
Отменить регистрацию хранимой процедуры можно с помощью команды HTTP DELETE, выполняемой для существующего ресурса хранимой процедуры.   

    client.deleteStoredProcedureAsync(createdStoredProcedure.resource._self)
        .then(function (response) {
            return;
        }, function(error) {
            console.log("Error");
        });


### <a name="registering-a-pre-trigger"></a>Регистрация триггера со срабатыванием до наступления события
Регистрация триггера осуществляется путем создания ресурса триггера в коллекции с помощью команды HTTP POST. Можно указать, если триггер hello является предварительной или post триггер и hello тип операции может быть сопоставлен (например создание, замена, Delete или все).   

    var preTrigger = {
        id: "upperCaseId",
        body: function() {
                var item = getContext().getRequest().getBody();
                item.id = item.id.toUpperCase();
                getContext().getRequest().setBody(item);
        },
        triggerType: TriggerType.Pre,
        triggerOperation: TriggerOperation.All
    }

    client.createTriggerAsync(collection._self, preTrigger)
        .then(function (createdPreTrigger) {
            console.log("Successfully created trigger");
        }, function(error) {
            console.log("Error");
        });

### <a name="executing-a-pre-trigger"></a>Запуск триггера со срабатыванием до наступления события
Выполнение триггера выполняется путем указания имени существующего триггера hello во время выполнения запроса POST, PUT и DELETE hello ресурса документа через заголовок запроса hello hello.  

    client.createDocumentAsync(collection._self, { id: "doc1", key: "Love in hello Time of Cholera" }, { preTriggerInclude: "upperCaseId" })
        .then(function(createdDocument) {
            assert.equal(createdDocument.resource.id, "DOC1");
        }, function(error) {
            console.log("Error");
        });

### <a name="unregistering-a-pre-trigger"></a>Отмена регистрации триггера со срабатыванием до наступления события
Отменить регистрацию триггера можно с помощью команды HTTP DELETE, выполняемой для существующего ресурса триггера.  

    client.deleteTriggerAsync(createdPreTrigger._self);
        .then(function(response) {
            return;
        }, function(error) {
            console.log("Error");
        });

### <a name="registering-a-udf"></a>Регистрация определяемой пользователем функции
Регистрация определяемой пользователем функции осуществляется путем создания нового ресурса UDF в коллекции или через команду HTTP POST.  

    var udf = { 
        id: "mathSqrt",
        body: function(number) {
                return Math.sqrt(number);
        },
    };
    client.createUserDefinedFunctionAsync(collection._self, udf)
        .then(function (createdUdf) {
            console.log("Successfully created stored procedure");
        }, function(error) {
            console.log("Error");
        });

### <a name="executing-a-udf-as-part-of-hello-query"></a>Выполнение определяемой пользователем функции как часть запроса hello
Определяемая пользователем Функция может быть указан как часть запроса SQL hello и используется как базовая hello tooextend способом [язык запросов SQL для hello DocumentDB API](https://msdn.microsoft.com/library/azure/dn782250.aspx).

    var filterQuery = "SELECT udf.mathSqrt(r.Age) AS sqrtAge FROM root r WHERE r.FirstName='John'";
    client.queryDocuments(collection._self, filterQuery).toArrayAsync();
        .then(function(queryResponse) {
            var queryResponseDocuments = queryResponse.feed;
        }, function(error) {
            console.log("Error");
        });

### <a name="unregistering-a-udf"></a>Отмена регистрации определяемой пользователем функции
Отменить регистрацию определяемой пользователем функции можно с помощью команды HTTP DELETE, выполняемой для существующего ресурса UDF.  

    client.deleteUserDefinedFunctionAsync(createdUdf._self)
        .then(function(response) {
            return;
        }, function(error) {
            console.log("Error");
        });

Несмотря на то, что фрагменты hello выше показал регистрации hello (POST), отмены регистрации (PUT), чтения или списка (GET) и выполнения (POST) через hello [JavaScript SDK](https://github.com/Azure/azure-documentdb-js), можно также использовать hello [API-интерфейс REST](/rest/api/documentdb/) или других [клиентских SDK](documentdb-sdk-dotnet.md). 

## <a name="documents"></a>Документы
Вы можете вставлять, заменять, удалять, читать, перечислять и запрашивать произвольные документы JSON в коллекции. Cosmos DB не требует какой-либо схемы и не требует вторичные индексы в порядке toosupport запросы к документам в коллекции. Максимальный размер документа Hello составляет 2 МБ.   

Являясь по-настоящему открытой службой базы данных, Cosmos DB не изобретает какие-то специализированные типы данных (например, date time) или конкретные кодировки для документов JSON. Обратите внимание, что Cosmos DB не требуются все специальные JSON соглашения toocodify hello связи между различных документов; синтаксис SQL Hello Cosmos DB предоставляет очень мощный иерархических и реляционные операторы документов tooquery и проекта без специальных заметок и необходимость toocodify связи между документами с помощью свойства различающееся.  

Как можно создавать документы с другими ресурсами, заменены, удалены, чтение, перечисления и запрашивать легко с помощью API-интерфейс REST или любой из hello [клиентских SDK](documentdb-sdk-dotnet.md). Удаление документа мгновенно освобождает hello квоты соответствующий tooall hello вложенные вложений. Hello чтения уровень согласованности документов следует hello согласованности политики в отношении hello учетной записи базы данных. Эта политика может быть переопределена для каждого запроса в зависимости от требований к согласованности данных для вашего приложения. Во время запроса документов, hello чтения hello следующим согласованности режим установки на семейство hello индексирования. Для «согласованность» это следует политике согласованности hello учетной записи. 

## <a name="attachments-and-media"></a>Вложения и мультимедиа
Cosmos DB позволяет toostore двоичных больших двоичных объектов или носителя с помощью DB Cosmos (не более 2 ГБ на учетную запись) или tooyour собственный носитель внешнего хранилища. Она также позволяет toorepresent hello метаданные носителя с точки зрения специальных документ вложения. Вложение в Cosmos DB является документ специальные (JSON), который ссылки hello мультимедиа или большого двоичного объекта хранятся в других местах. Вложение имеет специальные документа, который фиксирует hello метаданных (например, расположение, автора и т.д.) хранятся в хранилище носитель внешнего носителя. 

Рассмотрим приложение социальных чтения, который использует Cosmos DB toostore рукописные примечания и выделяет метаданных, включая комментарии, закладки, оценки, отзывы и предложения, т. д., электронная книга определенного пользователя, связанный.   

* Hello содержимое книги hello сам хранится в хранилище мультимедиа hello либо доступны как часть Cosmos DB учетной записи базы данных или хранилища внешнего носителя. 
* Приложение может хранить метаданные каждого пользователя в виде отдельного документа. Например, метаданные пользователя Джо для книги Book1 можно хранить в документе, имеющем ссылку /colls/joe/docs/book1. 
* Вложения, указывающий toohello страницы содержимого книги данного пользователя хранятся в соответствующий документ hello например /colls/joe/docs/book1/chapter1 /colls/joe/docs/book1/chapter2 и т. д. 

Обратите внимание, что вышеперечисленные hello примеры использования понятное идентификаторы tooconvey hello ресурсов иерархии. Доступа к ресурсам через hello API-интерфейс REST через идентификаторы ресурса. 

Для носителя hello, управляется Cosmos DB свойство _media hello hello вложения будет ссылаться hello мультимедиа по URI. Cosmos DB обеспечит toogarbage сбор hello мультимедиа при всех оставшихся ссылок hello удаляются. Cosmos DB автоматически создает hello вложения, при передаче нового носителя hello и заполняет hello _media toopoint toohello вновь добавленный носителя. При выборе toostore hello мультимедиа в хранилище BLOB-объектов, управляется вами (например OneDrive хранилища Azure, DropBox и т. д), по-прежнему можно использовать media hello tooreference вложения. В этом случае будет самостоятельно создать вложение hello и заполните его свойство _media.   

Как и другие ресурсы, вложения могут быть созданы, заменены, удален, чтение или перечисление легко с помощью API-интерфейс REST или любой из клиентских hello SDK. Как с документами, hello чтения уровень согласованности вложений следует hello согласованности политики в отношении hello учетной записи базы данных. Эта политика может быть переопределена для каждого запроса в зависимости от требований к согласованности данных для вашего приложения. При запросе для вложений hello чтения hello следующим согласованности режим установки на семейство hello индексирования. Для «согласованность» это следует политике согласованности hello учетной записи. 
 

## <a name="users"></a>Пользователи
Пользователь в Cosmos DB представляет собой логическое пространство имен для группировки разрешений. Cosmos DB пользователь может соответствовать tooa пользователя в систему управления удостоверение или роль стандартное приложение. Для Cosmos DB пользователь просто представляет абстракции toogroup набор разрешений в базе данных.   

Для реализации Многопользовательские приложения в приложении, можно создать пользователей в DB Cosmos соответствующая tooyour фактических пользователей или клиентов hello приложения. Затем можно создать разрешения для данного пользователя, которые соответствуют toohello контроля доступа к различным коллекции, документы, вложения, и т. д.   

Как приложения требуется tooscale с ростом вашего пользователя, можно применить различные способы tooshard данных. Вы можете смоделировать каждого из пользователей следующим образом:   

* Каждый пользователь сопоставляет tooa базы данных.
* Каждый пользователь сопоставляет tooa коллекции. 
* Документы соответствующих пользователей toomultiple перейдите tooa выделенной коллекции. 
* Документы соответствующих пользователей toomultiple go tooa набор коллекций.   

Независимо от hello конкретных сегментирования Выбор стратегии можно моделировать фактических пользователей как пользователи базы данных Cosmos DB и связать пользователя tooeach детально настроенные разрешения.  

![Коллекции пользователей][3]  
**Стратегии сегментирования и моделирования пользователей**

Как и другие ресурсы пользователи в Cosmos DB могут быть созданы, заменен, удалить, читать или перечисление легко с помощью API-интерфейс REST или любой из клиентских hello SDK. Cosmos DB всегда предоставляет строгая согласованность для чтения или запрос метаданных hello ресурса пользователя. Стоит обратить внимание, что при удалении пользователя автоматически обеспечивает, получить доступ к hello разрешений, содержащихся в нем. Несмотря на то, что hello Cosmos DB высвобождает квоты hello hello разрешений в рамках пользователь удален hello в фоновом режиме hello, hello удалены разрешения доступен сразу же еще раз для вас toouse.  

## <a name="permissions"></a>Разрешения
В контексте контроля доступа такие ресурсы, как учетные записи баз данных, базы данных, пользователи и разрешения, считаются *административными* ресурсами, так как для обращения к ним требуются права администратора. На hello другой стороны, включая hello коллекции, документы, вложения, хранимые процедуры, триггеры, ресурсы и определяемые пользователем функции областью действия в данной базе данных и считается *ресурсы приложения*. Соответствующая toohello два типа ресурсов и hello ролей, которые обращаются к этим (а именно: hello администратора и пользователя), модель авторизации hello определяет два типа *ключи доступа*: *главный ключ* и *ключ ресурса*. Hello главного ключа в рамках учетной записи базы данных hello и предоставляются toohello разработчика (или администратор), подготавливает hello учетной записи базы данных. Этот главный ключ имеет семантику администратора, в том, что она может быть tooboth доступа используется tooauthorize администратора и ресурсы приложения. Напротив, ключ ресурса — это ключ детального доступа, который позволяет доступ tooa *конкретных* ресурса приложения. Таким образом он получает hello связь между hello пользователя базы данных и hello разрешения hello пользователем для определенного ресурса (например коллекции, документ, вложения, хранимой процедурой, триггером или определяемой пользователем функции).   

Hello единственным способом tooobtain ключ ресурса является создание ресурс разрешение указанному пользователю. Обратите внимание, что в порядке toocreate или получить разрешение, главного ключа должна быть представлена в заголовке авторизации hello. Ресурс разрешения связывает пользователя ресурсов, доступа и hello hello. После создания ресурса разрешения, hello пользователю достаточно toopresent hello связанного ресурса ключ в порядке toogain доступа toohello соответствующего ресурса. Таким образом можно просмотреть ключ ресурса в виде логического и compact представление ресурса разрешения hello.  

Как и другие ресурсы, разрешения в Cosmos DB могут быть созданы, заменены, удален, чтение или перечисление легко с помощью API-интерфейс REST или любой из клиентских hello SDK. Cosmos DB всегда предоставляет строгая согласованность для запроса метаданных hello разрешения или чтения. 

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о работе с ресурсами с помощью команд HTTP см. в статье [Azure Cosmos DB: Azure Cosmos DB REST API](https://msdn.microsoft.com/library/azure/mt622086.aspx) (Azure Cosmos DB. REST API Azure Cosmos DB).

[1]: media/documentdb-resources/resources1.png
[2]: media/documentdb-resources/resources2.png
[3]: media/documentdb-resources/resources3.png

