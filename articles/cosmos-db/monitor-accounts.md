---
title: "Мониторинг запросов и хранилища Azure Cosmos DB | Документация Майкрософт"
description: "Узнайте, как отслеживать метрики производительности, например запросы и ошибки сервера, и метрики использования, такие как использованный объем хранилища, для учетной записи Azure Cosmos DB."
services: cosmos-db
documentationcenter: 
author: mimig1
manager: jhubbard
editor: cgronlun
ms.assetid: 4c6a2e6f-6e78-48e3-8dc6-f4498b235a9e
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/23/2017
ms.author: mimig
ms.openlocfilehash: 0ca652d31d6c50124f87916b4486d8279075f106
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="monitor-azure-cosmos-db-requests-usage-and-storage"></a>Мониторинг запросов, использования и хранилища Azure Cosmos DB
Вы можете отслеживать свои учетные записи Azure DocumentDB на [портале Azure](https://portal.azure.com/). Для каждой учетной записи Azure Cosmos DB доступны метрики производительности, такие как запросы и ошибки сервера, и использования, например потребление памяти.

Метрики можно просмотреть в колонке учетной записи, в колонке метрик или в Azure Monitor.

## <a name="view-performance-metrics-on-the-metrics-blade"></a>Просмотр метрик производительности в колонке "Метрики"
1. На [портале Azure](https://portal.azure.com/) щелкните **Больше служб**, прокрутите до пункта **Базы данных**, щелкните **Azure Cosmos DB**, а затем щелкните имя учетной записи Azure Cosmos DB, для которой требуется просмотреть метрики производительности.
2. В меню ресурсов в разделе **Мониторинг** щелкните **Метрики**.

Откроется колонка "Метрики", в которой можно выбрать коллекцию для просмотра. Вы можете просмотреть метрики доступности, запросов, пропускной способности и хранилища и сравнить их результаты с соглашениями об уровне обслуживания Azure Cosmos DB.

## <a name="view-performance-metrics-by-using-azure-monitoring"></a>Просмотр метрик производительности с помощью Azure Monitor
1. На [портале Azure](https://portal.azure.com/) на навигационной панели щелкните **Монитор**.
2. В меню ресурсов выберите **Метрики**.
3. В окне **Monitor — Metrics** (Монитор — метрики) в раскрывающемся меню **Группа ресурсов** выберите группу ресурсов, связанную с учетной записью Azure Cosmos DB, которую нужно отслеживать. 
4. В раскрывающемся меню **Ресурсы** выберите учетную запись базы данных для отслеживания.
5. В списке **доступных метрик** выберите метрики, которые нужно отобразить. Используйте клавишу CTRL, чтобы выбрать несколько элементов. 

    Метрики отображаются в окне **График**. 

## <a name="view-performance-metrics-on-the-account-blade"></a>Просмотр метрик производительности в колонке учетной записи
1. На [портале Azure](https://portal.azure.com/) щелкните **Больше служб**, прокрутите до пункта **Базы данных**, щелкните **Azure Cosmos DB**, а затем щелкните имя учетной записи Azure Cosmos DB, для которой требуется просмотреть метрики производительности.
2. В группе связанных элементов **Мониторинг** по умолчанию отображаются следующие элементы:
   
   * общее число запросов для текущего дня;
   * Используемое хранилище.
   
   Если в таблице отображается сообщение **Нет доступных данных**, но вы знаете, что в базе данных есть данные, то ознакомьтесь с разделом [Устранение неполадок](#troubleshooting).
   
   ![Снимок экрана: группа связанных элементов "Мониторинг", где показаны запросы и данные об использовании хранилища](./media/monitor-accounts/documentdb-total-requests-and-usage.png)
3. Если щелкнуть элемент **Запросы** или **Квота использования**, то откроется колонка подробных сведений **Метрика**.
4. Выноска **Метрика** содержит сведения о выбранных вами метриках.  В верхней части колонки находится часовой график запросов, а под ним — таблица статистических значений регулируемых запросов и общего числа запросов.  На выноске "Метрика" также отображается список заданных оповещений, отфильтрованных по метрикам, отображающимся в текущей выноске "Метрика" (таким образом при наличии большого числа оповещений вы увидите только те, которые относятся к представленным здесь метрикам).   
   
   ![Снимок экрана: колонка "Метрика" с отрегулированными запросами](./media/monitor-accounts/documentdb-metric-blade.png)

## <a name="customize-performance-metric-views-in-the-portal"></a>Настройка представлений метрик производительности на портале
1. Для настройки метрик, отображаемых на определенной диаграмме, щелкните диаграмму, чтобы открыть ее в колонке **Метрика**, а затем щелкните **Изменить диаграмму**.  
   ![Снимок экрана: элементы управления колонки "Метрика" с выделенным элементом "Изменить диаграмму"](./media/monitor-accounts/madocdb3.png)
2. В колонке **Правка диаграммы** присутствуют параметры для изменения метрик, отображаемых на диаграмме, и их временного диапазона.  
   ![Снимок экрана: выноска "Изменение диаграммы"](./media/monitor-accounts/madocdb4.png)
3. Чтобы изменить отображаемые в этой части метрики, просто установите или снимите флажки для доступных метрик производительности, а затем нажмите кнопку **ОК** в нижней части колонки.  
4. Чтобы изменить временной диапазон, выберите новый диапазон (например, **Другой**), а затем нажмите кнопку **ОК** внизу колонки.  
   
   ![Снимок экрана: часть диапазона времени выноски "Изменение диаграммы" с демонстрацией ввода настраиваемого временного диапазона](./media/monitor-accounts/madocdb5.png)

## <a name="create-side-by-side-charts-in-the-portal"></a>Создание параллельных диаграмм на портале
На портале Azure можно создавать параллельные диаграммы метрик.  

1. Во-первых, щелкните правой кнопкой мыши диаграмму, которую нужно скопировать, и выберите **Настроить**.
   
   ![Снимок экрана: диаграмма "Общее количество запросов" с выделенным параметром "Настроить"](./media/monitor-accounts/madocdb6.png)
2. Выберите в меню элемент **Клонировать**, чтобы скопировать раздел, а затем выберите **Настройка завершена**.
   
   ![Снимок экрана: диаграмма "Общее количество запросов" с выделенным параметрами "Клонировать" и "Готово"](./media/monitor-accounts/madocdb7.png)  

Теперь этот раздел можно использовать как любой другой раздел метрик, настраивая отображаемые в этом разделе метрики и диапазон времени.  После этого вы увидите две разные диаграммы метрики, отображаемые параллельно.  
    ![Снимок экрана: диаграмма "Общее количество запросов" и новая диаграмма "Общее количество запросов" через час](./media/monitor-accounts/madocdb8.png)  

## <a name="set-up-alerts-in-the-portal"></a>Настройка оповещений на портале
1. На [портале Azure](https://portal.azure.com/) щелкните **Больше служб**, затем **Azure Cosmos DB**, а затем щелкните имя учетной записи Azure Cosmos DB, для которой требуется настроить оповещения метрик производительности.
2. В меню ресурсов щелкните **Правила оповещения** , чтобы открыть соответствующую колонку.  
   ![Снимок экрана с выбранной частью "Правила оповещения"](./media/monitor-accounts/madocdb10.5.png)
3. В колонке **Правила оповещений** щелкните **Добавить оповещение**.  
   ![Снимок экрана: выноска "Правила оповещений" с выделенной кнопкой "Добавить оповещения"](./media/monitor-accounts/madocdb11.png)
4. На выноске **добавления правила оповещения** укажите следующее:
   
   * имя настраиваемого правила оповещения;
   * описание нового правила оповещения;
   * метрику для правила оповещения;
   * условие, пороговое значение и период для активации оповещения (например, более 5 ошибок сервера за последние 15 минут);
   * следует ли оповещать администратора службы и соадминистраторов по электронной почте при срабатывании оповещения;
   * дополнительные адреса для оповещений электронной почты.  
     ![Снимок экрана: выноска "Добавление правила оповещения"](./media/monitor-accounts/madocdb12.png)

## <a name="monitor-azure-cosmos-db-programatically"></a>Программный мониторинг Azure Cosmos DB
Доступные на портале метрики уровня учетной записи, такие как данные об использовании хранилища учетной записи и общее число запросов, недоступны через API-интерфейсы DocumentDB. Тем не менее, можно получить данные об использовании на уровне коллекции, используя интерфейсы API DocumentDB. Чтобы получить данных на уровне коллекции, выполните следующие действия:

* Чтобы использовать REST API, [выполните запрос GET к коллекции](https://msdn.microsoft.com/library/mt489073.aspx). Квота и данные об использовании коллекции возвращаются в заголовке ответа x-ms-resource-quota и x-ms-resource-usage headers.
* Чтобы использовать пакет SDK для .NET, воспользуйтесь методом [DocumentClient.ReadDocumentCollectionAsync](https://msdn.microsoft.com/library/microsoft.azure.documents.client.documentclient.readdocumentcollectionasync.aspx), возвращающим объект [ResourceResponse](https://msdn.microsoft.com/library/dn799209.aspx), который содержит ряд свойств использования, например **CollectionSizeUsage**, **DatabaseUsage**, **DocumentUsage** и прочие.

Чтобы получить дополнительные метрики, используйте [пакет SDK для Azure Monitor](https://www.nuget.org/packages/Microsoft.Azure.Insights). Доступные определения метрик можно получить с помощью следующего вызова.

    https://management.azure.com/subscriptions/{SubscriptionId}/resourceGroups/{ResourceGroup}/providers/Microsoft.DocumentDb/databaseAccounts/{DocumentDBAccountName}/metricDefinitions?api-version=2015-04-08

В запросах для извлечения отдельных метрик используется следующий формат.

    https://management.azure.com/subscriptions/{SubecriptionId}/resourceGroups/{ResourceGroup}/providers/Microsoft.DocumentDb/databaseAccounts/{DocumentDBAccountName}/metrics?api-version=2015-04-08&$filter=%28name.value%20eq%20%27Total%20Requests%27%29%20and%20timeGrain%20eq%20duration%27PT5M%27%20and%20startTime%20eq%202016-06-03T03%3A26%3A00.0000000Z%20and%20endTime%20eq%202016-06-10T03%3A26%3A00.0000000Z

Дополнительные сведения см. в записи блога [Retrieving Resource Metrics via the Azure Insights API](https://blogs.msdn.microsoft.com/cloud_solution_architect/2016/02/23/retrieving-resource-metrics-via-the-azure-insights-api/) (Получение метрик ресурсов через API Azure Insights). Обратите внимание, что служба Azure Inights была переименована в Azure Monitor.  В этой записи блога используется устаревшее название.

## <a name="troubleshooting"></a>Устранение неполадок
Если в элементах мониторинга отображается сообщение **Нет доступных данных** , при том что вы недавно выполняли запросы или добавляли данные в базу данных, то можно изменить элементы для отражения последних данных об использовании.

### <a name="edit-a-tile-to-refresh-current-data"></a>Изменение плитки для обновления текущих данных
1. Для настройки метрик, отображаемых в определенной части, щелкните диаграмму, чтобы открыть ее в колонке **Метрика**, а затем щелкните **Изменить диаграмму**.  
   ![Снимок экрана: элементы управления колонки "Метрика" с выделенным элементом "Изменить диаграмму"](./media/monitor-accounts/madocdb3.png)
2. В колонке **Правка диаграммы** в разделе **Диапазон времени** щелкните **за последний час**, а затем нажмите кнопку **ОК**.  
   ![Снимок экрана: колонка "Изменение диаграммы" с выбранным вариантом "за последний час"](./media/monitor-accounts/documentdb-no-available-data-past-hour.png)
3. Элемент должен обновиться: теперь в нем должны отображаться текущие данные и сведения об использовании.  
   ![Снимок экрана: обновленная плитка "Всего запросов" с данными за последний час](./media/monitor-accounts/documentdb-no-available-data-fixed.png)

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о планировании ресурсов DocumentDB см. на [странице калькулятора ресурсов Azure Cosmos DB](https://www.documentdb.com/capacityplanner).

