---
title: "Поддержка брандмауэра Cosmos DB aaaAzure & IP контроль доступа | Документы Microsoft"
description: "Узнайте, как поддерживать toouse IP политики управления доступом для брандмауэра на Azure Cosmos DB учетные записи баз данных."
keywords: "Контроль доступа на основе IP-адресов, поддержка брандмауэра"
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: b5cdbdb28e9d7ee0fd0ea54aad277167b699929f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="4c6b3-104">Поддержка брандмауэра для Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4c6b3-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="4c6b3-105">toosecure данные, хранящиеся в учетной записи базы данных Azure Cosmos DB, Azure Cosmos DB обеспечивает поддержку на основе секрета [модель авторизации](https://msdn.microsoft.com/library/azure/dn783368.aspx) , использует код проверки подлинности с строгого сообщений на основе хэша (HMAC).</span><span class="sxs-lookup"><span data-stu-id="4c6b3-105">toosecure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="4c6b3-106">Теперь Кроме модель авторизации на основе toohello секрет, Azure Cosmos DB поддерживает политики управляемых элементов управления доступом на основе IP для поддержки брандмауэра для входящих подключений.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-106">Now, in addition toohello secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="4c6b3-107">Эта модель является очень похожа правила брандмауэра toohello системы традиционных баз данных и обеспечивает дополнительный уровень безопасности toohello Azure Cosmos DB учетная запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-107">This model is very similar toohello firewall rules of a traditional database system and provides an additional level of security toohello Azure Cosmos DB database account.</span></span> <span data-ttu-id="4c6b3-108">С этой моделью теперь можно настроить учетную запись Azure Cosmos DB базы данных, toobe доступен только в группы утвержденных машин или облачных служб.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-108">With this model, you can now configure an Azure Cosmos DB database account toobe accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="4c6b3-109">Доступ к ресурсам Cosmos DB tooAzure из этих наборов утвержденных компьютеров и служб по-прежнему требуется toopresent вызывающего объекта hello маркер авторизации.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-109">Access tooAzure Cosmos DB resources from these approved sets of machines and services still require hello caller toopresent a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="4c6b3-110">Общие сведения о контроле доступа на основе IP-адресов</span><span class="sxs-lookup"><span data-stu-id="4c6b3-110">IP access control overview</span></span>
<span data-ttu-id="4c6b3-111">По умолчанию учетную запись базы данных Azure Cosmos DB Интернете до тех пор, пока hello запрос сопровождается маркер авторизации.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as hello request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="4c6b3-112">Управление доступом на основе политик IP tooconfigure hello пользователь должен предоставить набор hello IP-адреса или диапазоны IP-адресов в toobe форме CIDR включена как hello допускается список клиентских IP-адресов для указанной базы данных учетной записи.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-112">tooconfigure IP policy-based access control, hello user must provide hello set of IP addresses or IP address ranges in CIDR form toobe included as hello allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="4c6b3-113">После применения этой конфигурации все запросы, получаемые с машинами за пределами этого списка разрешенных блокируется сервером hello.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by hello server.</span></span>  <span data-ttu-id="4c6b3-114">поток hello управление доступом на основе IP-адресов обработки подключения Hello описан в hello следующие схемы.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-114">hello connection processing flow for hello IP-based access control is described in hello following diagram.</span></span>

![Схема, показывающая hello процесс подключения для управления доступом на основе IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="4c6b3-116">Подключения из облачных служб</span><span class="sxs-lookup"><span data-stu-id="4c6b3-116">Connections from cloud services</span></span>
<span data-ttu-id="4c6b3-117">В Azure облачные службы — это стандартный способ размещения логики службы среднего уровня с помощью Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="4c6b3-118">tooenable tooan доступа учетной записи базы данных Azure Cosmos DB из облачной службы, hello общедоступный IP-адрес облачной службы hello должны быть добавлены toohello разрешенный список IP-адресов, связанных с учетной записью базы данных Azure Cosmos DB по [Настройка Здравствуйте, политики управления доступом IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4c6b3-118">tooenable access tooan Azure Cosmos DB database account from a cloud service, hello public IP address of hello cloud service must be added toohello allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="4c6b3-119">Благодаря этому все экземпляры роли облачных служб будут иметь доступ tooyour Azure Cosmos DB учетная запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-119">This ensures that all role instances of cloud services have access tooyour Azure Cosmos DB database account.</span></span> <span data-ttu-id="4c6b3-120">Можно получить IP-адреса для облачных служб в hello портал Azure, как показано в следующий снимок экрана приветствия.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-120">You can retrieve IP addresses for your cloud services in hello Azure portal, as shown in hello following screenshot.</span></span>

![Снимок экрана, показывающий hello общедоступный IP-адрес для облачной службы, отображаемых в hello портал Azure](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="4c6b3-122">Масштабировать облачную службу путем добавления экземпляров ролях эти новые экземпляры автоматически после учетной записи базы данных Azure Cosmos DB toohello доступ, так как они являются частью hello же облачной службе.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access toohello Azure Cosmos DB database account since they are part of hello same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="4c6b3-123">Подключения из виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="4c6b3-123">Connections from virtual machines</span></span>
<span data-ttu-id="4c6b3-124">[Виртуальные машины](https://azure.microsoft.com/services/virtual-machines/) или [наборы масштабирования виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) также могут использоваться toohost служб среднего уровня, с помощью Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used toohost middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="4c6b3-125">tooconfigure hello Azure Cosmos DB базы данных учетной записи tooallow доступ из виртуальных машин, общедоступные IP-адреса виртуальной машины и/или набор масштабирования виртуальной машины должна быть настроена как один hello разрешенные IP-адреса для вашей учетной записи базы данных Azure Cosmos DB по [настройки политики управления доступом IP hello](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4c6b3-125">tooconfigure hello Azure Cosmos DB database account tooallow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of hello allowed IP addresses for your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="4c6b3-126">IP-адресов для виртуальных машин в hello портал Azure можно получить, как показано в следующий снимок экрана приветствия.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-126">You can retrieve IP addresses for virtual machines in hello Azure portal, as shown in hello following screenshot.</span></span>

![Снимок экрана, показывающий общедоступный IP-адрес для виртуальной машины, отображаемой в hello портал Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="4c6b3-128">При добавлении группы toohello экземпляров дополнительную виртуальную машину, они автоматически предоставляются учетной записи базы данных Azure Cosmos DB tooyour доступа.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-128">When you add additional virtual machine instances toohello group, they are automatically provided access tooyour Azure Cosmos DB database account.</span></span>

## <a name="connections-from-hello-internet"></a><span data-ttu-id="4c6b3-129">Здравствуйте, подключения из Интернета</span><span class="sxs-lookup"><span data-stu-id="4c6b3-129">Connections from hello internet</span></span>
<span data-ttu-id="4c6b3-130">При доступа Cosmos Azure DB базы данных учетной записи компьютера на hello Интернета, hello IP-адрес клиента или диапазон IP-адресов hello машины должны быть добавлены toohello разрешенный список IP-адресов для hello Azure Cosmos DB учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-130">When you access an Azure Cosmos DB database account from a computer on hello internet, hello client IP address or IP address range of hello machine must be added toohello allowed list of IP address for hello Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="4c6b3-131"><a id="configure-ip-policy"></a>Настройка политики управления доступом IP hello</span><span class="sxs-lookup"><span data-stu-id="4c6b3-131"><a id="configure-ip-policy"></a> Configuring hello IP access control policy</span></span>
<span data-ttu-id="4c6b3-132">Политика управления доступом Hello IP может быть задано в hello портал Azure или программным путем с помощью [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), или hello [API-интерфейса REST](/rest/api/documentdb/) , обновив hello `ipRangeFilter` свойство.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-132">hello IP access control policy can be set in hello Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or hello [REST API](/rest/api/documentdb/) by updating hello `ipRangeFilter` property.</span></span> <span data-ttu-id="4c6b3-133">IP-адреса и их диапазоны должны быть разделены запятой без пробелов.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="4c6b3-134">Пример: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="4c6b3-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="4c6b3-135">При обновлении учетной записи базы данных через эти методы, иметь toopopulate убедиться, что все свойства tooprevent hello, сброс параметров toodefault.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-135">When updating your database account through these methods, be sure toopopulate all of hello properties tooprevent resetting toodefault settings.</span></span>

> [!NOTE]
> <span data-ttu-id="4c6b3-136">Включение политики управления доступом для учетной записи базы данных Azure Cosmos DB IP, все tooyour доступа учетной записи базы данных Azure Cosmos DB из вне hello настроен допускается блокируются список диапазонов IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4c6b3-137">Посредством этой модели обзора hello данных плоскости операции из портала hello также будет целостности hello заблокированных tooensure управления доступом.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-137">By virtue of this model, browsing hello data plane operation from hello portal will also be blocked tooensure hello integrity of access control.</span></span>

<span data-ttu-id="4c6b3-138">разработки toosimplify hello портал Azure помогает идентифицировать и добавить hello IP-адрес вашего клиента toohello машины, список, разрешенных приложений, выполняющихся на компьютере доступ к учетной записи Azure Cosmos DB hello.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-138">toosimplify development, hello Azure portal helps you identify and add hello IP of your client machine toohello allowed list, so that apps running your machine can access hello Azure Cosmos DB account.</span></span> <span data-ttu-id="4c6b3-139">Обратите внимание, hello IP-адрес клиента здесь будут обнаружены, отображающееся порталом hello.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-139">Note that hello client IP address here is detected as seen by hello portal.</span></span> <span data-ttu-id="4c6b3-140">Часто бывает hello клиентского IP-адреса компьютера, но это также может быть IP-адрес hello шлюз сети.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-140">It may be hello client IP address of your machine, but it could also be hello IP address of your network gateway.</span></span> <span data-ttu-id="4c6b3-141">Не забудьте tooremove перед выходом tooproduction.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-141">Do not forget tooremove it before going tooproduction.</span></span>

<span data-ttu-id="4c6b3-142">Политика управления доступом IP hello tooset в hello портал Azure перейдите колонке учетная запись Azure Cosmos DB toohello, щелкните **брандмауэра** hello меню навигации, а затем нажмите кнопку **ON**</span><span class="sxs-lookup"><span data-stu-id="4c6b3-142">tooset hello IP access control policy in hello Azure portal, navigate toohello Azure Cosmos DB account blade, click **Firewall** in hello navigation menu, then click **ON**</span></span> 

![Снимок экрана, показывающий, каким образом tooopen hello колонке брандмауэра в hello портал Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="4c6b3-144">В новой области hello укажите ли hello портал Azure можно hello учетной записи, при необходимости добавьте другие адресов и диапазонов, а затем выберите **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-144">In hello new pane, specify whether hello Azure portal can access hello account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="4c6b3-145">При включении политики управления доступом IP для hello Azure портала toomaintain доступа требуется tooadd hello IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-145">When you enable an IP access control policy, you need tooadd hello IP address for hello Azure portal toomaintain access.</span></span> <span data-ttu-id="4c6b3-146">Hello портала IP-адреса являются:</span><span class="sxs-lookup"><span data-stu-id="4c6b3-146">hello portal IP addresses are:</span></span>
> |<span data-ttu-id="4c6b3-147">Регион</span><span class="sxs-lookup"><span data-stu-id="4c6b3-147">Region</span></span>|<span data-ttu-id="4c6b3-148">IP-адрес</span><span class="sxs-lookup"><span data-stu-id="4c6b3-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="4c6b3-149">Все области, за исключением указанных ниже</span><span class="sxs-lookup"><span data-stu-id="4c6b3-149">All regions except those specified below</span></span>| <span data-ttu-id="4c6b3-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="4c6b3-150">104.42.195.92</span></span>|
> |<span data-ttu-id="4c6b3-151">Германия</span><span class="sxs-lookup"><span data-stu-id="4c6b3-151">Germany</span></span>|<span data-ttu-id="4c6b3-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="4c6b3-152">51.4.229.218</span></span>|
> |<span data-ttu-id="4c6b3-153">Китай</span><span class="sxs-lookup"><span data-stu-id="4c6b3-153">China</span></span>|<span data-ttu-id="4c6b3-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="4c6b3-154">139.217.8.252</span></span>|
> |<span data-ttu-id="4c6b3-155">Аризона (для обслуживания государственных организаций США)</span><span class="sxs-lookup"><span data-stu-id="4c6b3-155">US Gov Arizona</span></span>|<span data-ttu-id="4c6b3-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="4c6b3-156">52.244.48.71</span></span>|
>

![Снимок экрана, показывающий, как параметры брандмауэра tooconfigure в hello портал Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-hello-ip-access-control-policy"></a><span data-ttu-id="4c6b3-158">Устранение неполадок политики управления доступом IP hello</span><span class="sxs-lookup"><span data-stu-id="4c6b3-158">Troubleshooting hello IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="4c6b3-159">Операции на портале</span><span class="sxs-lookup"><span data-stu-id="4c6b3-159">Portal operations</span></span>
<span data-ttu-id="4c6b3-160">Включение политики управления доступом для учетной записи базы данных Azure Cosmos DB IP, все tooyour доступа учетной записи базы данных Azure Cosmos DB из вне hello настроен допускается блокируются список диапазонов IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4c6b3-161">Таким образом tooenable портала данных плоскости такие операции, как просмотр коллекций и запрос документов, вы должны tooexplicitly разрешить доступ Azure портала hello **брандмауэра** колонке hello портала.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-161">Therefore if you want tooenable portal data plane operations like browsing collections and query documents, you need tooexplicitly allow Azure portal access using hello **Firewall** blade in hello portal.</span></span> 

![Снимок экрана, показывающий, как toohello tooenable доступа к порталу Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="4c6b3-163">Пакет SDK и REST API</span><span class="sxs-lookup"><span data-stu-id="4c6b3-163">SDK & Rest API</span></span>
<span data-ttu-id="4c6b3-164">Для соображениям безопасности доступ через SDK или REST API с компьютеров, не в список разрешенных hello вернет универсального 404 не найдено ответ с нет дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-164">For security reasons, access via SDK or REST API from machines not on hello allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="4c6b3-165">Убедитесь, что hello IP разрешен список настроен для конфигурации tooensure правильная политика hello Azure Cosmos DB базы данных учетной записи — примененных tooyour Azure Cosmos DB учетная запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="4c6b3-165">Please verify hello IP allowed list configured for your Azure Cosmos DB database account tooensure hello correct policy configuration is applied tooyour Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4c6b3-166">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="4c6b3-166">Next steps</span></span>
<span data-ttu-id="4c6b3-167">Советы по улучшению производительности, связанные с сетью, см. в статье [Советы по улучшению производительности DocumentDB](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="4c6b3-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

