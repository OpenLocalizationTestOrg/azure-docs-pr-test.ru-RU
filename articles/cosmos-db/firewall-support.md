---
title: "Поддержка брандмауэра Cosmos DB aaaAzure & IP контроль доступа | Документы Microsoft"
description: "Узнайте, как поддерживать toouse IP политики управления доступом для брандмауэра на Azure Cosmos DB учетные записи баз данных."
keywords: "Контроль доступа на основе IP-адресов, поддержка брандмауэра"
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: b5cdbdb28e9d7ee0fd0ea54aad277167b699929f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-cosmos-db-firewall-support"></a>Поддержка брандмауэра для Azure Cosmos DB
toosecure данные, хранящиеся в учетной записи базы данных Azure Cosmos DB, Azure Cosmos DB обеспечивает поддержку на основе секрета [модель авторизации](https://msdn.microsoft.com/library/azure/dn783368.aspx) , использует код проверки подлинности с строгого сообщений на основе хэша (HMAC). Теперь Кроме модель авторизации на основе toohello секрет, Azure Cosmos DB поддерживает политики управляемых элементов управления доступом на основе IP для поддержки брандмауэра для входящих подключений. Эта модель является очень похожа правила брандмауэра toohello системы традиционных баз данных и обеспечивает дополнительный уровень безопасности toohello Azure Cosmos DB учетная запись базы данных. С этой моделью теперь можно настроить учетную запись Azure Cosmos DB базы данных, toobe доступен только в группы утвержденных машин или облачных служб. Доступ к ресурсам Cosmos DB tooAzure из этих наборов утвержденных компьютеров и служб по-прежнему требуется toopresent вызывающего объекта hello маркер авторизации.

## <a name="ip-access-control-overview"></a>Общие сведения о контроле доступа на основе IP-адресов
По умолчанию учетную запись базы данных Azure Cosmos DB Интернете до тех пор, пока hello запрос сопровождается маркер авторизации. Управление доступом на основе политик IP tooconfigure hello пользователь должен предоставить набор hello IP-адреса или диапазоны IP-адресов в toobe форме CIDR включена как hello допускается список клиентских IP-адресов для указанной базы данных учетной записи. После применения этой конфигурации все запросы, получаемые с машинами за пределами этого списка разрешенных блокируется сервером hello.  поток hello управление доступом на основе IP-адресов обработки подключения Hello описан в hello следующие схемы.

![Схема, показывающая hello процесс подключения для управления доступом на основе IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a>Подключения из облачных служб
В Azure облачные службы — это стандартный способ размещения логики службы среднего уровня с помощью Azure Cosmos DB. tooenable tooan доступа учетной записи базы данных Azure Cosmos DB из облачной службы, hello общедоступный IP-адрес облачной службы hello должны быть добавлены toohello разрешенный список IP-адресов, связанных с учетной записью базы данных Azure Cosmos DB по [Настройка Здравствуйте, политики управления доступом IP](#configure-ip-policy).  Благодаря этому все экземпляры роли облачных служб будут иметь доступ tooyour Azure Cosmos DB учетная запись базы данных. Можно получить IP-адреса для облачных служб в hello портал Azure, как показано в следующий снимок экрана приветствия.

![Снимок экрана, показывающий hello общедоступный IP-адрес для облачной службы, отображаемых в hello портал Azure](./media/firewall-support/public-ip-addresses.png)

Масштабировать облачную службу путем добавления экземпляров ролях эти новые экземпляры автоматически после учетной записи базы данных Azure Cosmos DB toohello доступ, так как они являются частью hello же облачной службе.

## <a name="connections-from-virtual-machines"></a>Подключения из виртуальных машин
[Виртуальные машины](https://azure.microsoft.com/services/virtual-machines/) или [наборы масштабирования виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) также могут использоваться toohost служб среднего уровня, с помощью Azure Cosmos DB.  tooconfigure hello Azure Cosmos DB базы данных учетной записи tooallow доступ из виртуальных машин, общедоступные IP-адреса виртуальной машины и/или набор масштабирования виртуальной машины должна быть настроена как один hello разрешенные IP-адреса для вашей учетной записи базы данных Azure Cosmos DB по [настройки политики управления доступом IP hello](#configure-ip-policy). IP-адресов для виртуальных машин в hello портал Azure можно получить, как показано в следующий снимок экрана приветствия.

![Снимок экрана, показывающий общедоступный IP-адрес для виртуальной машины, отображаемой в hello портал Azure](./media/firewall-support/public-ip-addresses-dns.png)

При добавлении группы toohello экземпляров дополнительную виртуальную машину, они автоматически предоставляются учетной записи базы данных Azure Cosmos DB tooyour доступа.

## <a name="connections-from-hello-internet"></a>Здравствуйте, подключения из Интернета
При доступа Cosmos Azure DB базы данных учетной записи компьютера на hello Интернета, hello IP-адрес клиента или диапазон IP-адресов hello машины должны быть добавлены toohello разрешенный список IP-адресов для hello Azure Cosmos DB учетной записи базы данных. 

## <a id="configure-ip-policy"></a>Настройка политики управления доступом IP hello
Политика управления доступом Hello IP может быть задано в hello портал Azure или программным путем с помощью [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), или hello [API-интерфейса REST](/rest/api/documentdb/) , обновив hello `ipRangeFilter` свойство. IP-адреса и их диапазоны должны быть разделены запятой без пробелов. Пример: "13.91.6.132,13.91.6.1/24". При обновлении учетной записи базы данных через эти методы, иметь toopopulate убедиться, что все свойства tooprevent hello, сброс параметров toodefault.

> [!NOTE]
> Включение политики управления доступом для учетной записи базы данных Azure Cosmos DB IP, все tooyour доступа учетной записи базы данных Azure Cosmos DB из вне hello настроен допускается блокируются список диапазонов IP-адресов. Посредством этой модели обзора hello данных плоскости операции из портала hello также будет целостности hello заблокированных tooensure управления доступом.

разработки toosimplify hello портал Azure помогает идентифицировать и добавить hello IP-адрес вашего клиента toohello машины, список, разрешенных приложений, выполняющихся на компьютере доступ к учетной записи Azure Cosmos DB hello. Обратите внимание, hello IP-адрес клиента здесь будут обнаружены, отображающееся порталом hello. Часто бывает hello клиентского IP-адреса компьютера, но это также может быть IP-адрес hello шлюз сети. Не забудьте tooremove перед выходом tooproduction.

Политика управления доступом IP hello tooset в hello портал Azure перейдите колонке учетная запись Azure Cosmos DB toohello, щелкните **брандмауэра** hello меню навигации, а затем нажмите кнопку **ON** 

![Снимок экрана, показывающий, каким образом tooopen hello колонке брандмауэра в hello портал Azure](./media/firewall-support/azure-portal-firewall.png)

В новой области hello укажите ли hello портал Azure можно hello учетной записи, при необходимости добавьте другие адресов и диапазонов, а затем выберите **Сохранить**.  

> [!NOTE]
> При включении политики управления доступом IP для hello Azure портала toomaintain доступа требуется tooadd hello IP-адрес. Hello портала IP-адреса являются:
> |Регион|IP-адрес|
> |------|----------|
> |Все области, за исключением указанных ниже| 104.42.195.92|
> |Германия|51.4.229.218|
> |Китай|139.217.8.252|
> |Аризона (для обслуживания государственных организаций США)|52.244.48.71|
>

![Снимок экрана, показывающий, как параметры брандмауэра tooconfigure в hello портал Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-hello-ip-access-control-policy"></a>Устранение неполадок политики управления доступом IP hello
### <a name="portal-operations"></a>Операции на портале
Включение политики управления доступом для учетной записи базы данных Azure Cosmos DB IP, все tooyour доступа учетной записи базы данных Azure Cosmos DB из вне hello настроен допускается блокируются список диапазонов IP-адресов. Таким образом tooenable портала данных плоскости такие операции, как просмотр коллекций и запрос документов, вы должны tooexplicitly разрешить доступ Azure портала hello **брандмауэра** колонке hello портала. 

![Снимок экрана, показывающий, как toohello tooenable доступа к порталу Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a>Пакет SDK и REST API
Для соображениям безопасности доступ через SDK или REST API с компьютеров, не в список разрешенных hello вернет универсального 404 не найдено ответ с нет дополнительных сведений. Убедитесь, что hello IP разрешен список настроен для конфигурации tooensure правильная политика hello Azure Cosmos DB базы данных учетной записи — примененных tooyour Azure Cosmos DB учетная запись базы данных.

## <a name="next-steps"></a>Дальнейшие действия
Советы по улучшению производительности, связанные с сетью, см. в статье [Советы по улучшению производительности DocumentDB](performance-tips.md).

