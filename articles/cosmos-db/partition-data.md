---
title: "aaaPartitioning и горизонтальное масштабирование в Azure Cosmos DB | Документы Microsoft"
description: "Дополнительные сведения о том, как секционирования работы в базе данных Azure Cosmos как tooconfigure секционирования и ключи секций и как toopick hello справа ключ раздела для вашего приложения."
services: cosmos-db
author: arramac
manager: jhubbard
editor: monicar
documentationcenter: 
ms.assetid: cac9a8cd-b5a3-4827-8505-d40bb61b2416
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: arramac
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 87d56db8c4ccc6b94b1650baff0fcfb3db6d1777
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-toopartition-and-scale-in-azure-cosmos-db"></a>Как toopartition и масштабирования в Azure Cosmos DB

[Microsoft Azure Cosmos DB](https://azure.microsoft.com/services/cosmos-db/) является toohelp служба, предоставляющая глобальной распределенной базы данных моделей, можно добиться быстрого и предсказуемая производительность и масштабируемость без проблем вместе с приложением при увеличении его. Это статье представлен обзор как секционирование работает для всех данных hello моделей в базе данных Azure Cosmos, и описывается, как настроить приложения Azure Cosmos DB контейнеры tooeffectively шкалы.

Секционирование и ключи секций также рассматриваются в этом видео из цикла "Azure, пятница" от Скотта Хансельмана (Scott Hanselman) и главного технического руководителя базы данных Azure Cosmos DB, Ширеша Тоты (Shireesh Thota).

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Azure-DocumentDB-Elastic-Scale-Partitioning/player]
> 

## <a name="partitioning-in-azure-cosmos-db"></a>Секционирование в базе данных Azure Cosmos DB
В базе данных Azure Cosmos DB можно хранить данные без схемы и запрашивать их, получая ответ за миллисекунды вне зависимости от масштаба. База данных Cosmos DB предоставляет контейнеры для хранения данных, которые называются **коллекциями (для документов), графами или таблицами**. Контейнеры — это логические ресурсы, они могут включать в себя одну или несколько физических секций или серверов. Hello число секций, определяется на основе размера хранилища hello и пропускная способность hello контейнера hello DB Cosmos. С каждой секцией в базе данных Azure Cosmos DB связано фиксированное количество хранилищ на основе SSD, которое реплицируется для обеспечения высокого уровня доступности. Управление секциями полностью управляются Azure Cosmos DB и управления секциями или не toowrite сложный код. Контейнеры базы данных Azure Cosmos DB не ограничены в плане хранения и пропускной способности. 

![horizontal](./media/introduction/azure-cosmos-db-partitioning.png) 

Секционирование является прозрачным tooyour приложения. Cosmos DB поддерживает быстрого чтения и записи, запросы, транзакционную логику, уровни согласованности и детальное управление доступом через методы или интерфейсы API tooa один контейнер ресурсов. дескрипторы службы Hello распределения данных по секциям и маршрутизацию правой части запроса запросов toohello. 

Как работает секционирование Каждый элемент должен иметь ключ секции и ключ строки, которые однозначно идентифицируют его. Ключ секции выступает в качестве логической секции для ваших данных и предоставляет базе данных Cosmos DB естественную границу для распределения данных между секциями. Вот как работает секционирование в базе данных Azure Cosmos DB:

* Вы подготавливаете контейнер базы данных Cosmos DB с пропускной способностью `T` запросов в секунду.
* В фоновом hello секций подготавливает Cosmos DB необходимости tooserve `T` запросов в секунду. Если `T` выше, чем hello максимальная пропускная способность каждого раздела `t`, затем Cosmos DB подготавливает `N`  =  `T/t` секций
* Cosmos DB распределяет пространство hello секции ключа хэши равномерно по hello `N` секций. Таким образом, каждая секция (физическая секция) содержит значения ключа секции 1-N (логические секции).
* При физической секции `p` достигает Превышен предельный размер, Cosmos DB легко разбивает `p` на два новых раздела `p1` и `p2` и распространяет значения, соответствующие tooroughly половина hello ключи tooeach из hello секции. Операция разбиения это невидимой tooyour приложение.
* Аналогичным образом, когда подготовить пропускную способность выше, чем `t*N` пропускной способности, Cosmos DB разбивает один или несколько секций toosupport hello выше пропускную способность

Hello ключи разделов семантика семантика hello немного отличается toomatch каждый API, как показано в следующей таблице hello.

| API | Ключ раздела | Ключ строки |
| --- | --- | --- |
| DocumentDB | пользовательский путь к ключу секции | фиксированное значение `id` | 
| MongoDB | пользовательский ключ сегмента  | фиксированное значение `_id` | 
| График | свойство пользовательского ключа секции | фиксированное значение `id` | 
| Таблица | фиксированное значение `PartitionKey` | фиксированное значение `RowKey` | 

База данных Cosmos DB использует секционирование на основе хэша. При создании элемента, Cosmos DB хэширует значение ключа секции hello и используйте hello хэшированные результат toodetermine какой секции toostore hello из элементов. Здравствуйте, все элементы с одинаковым ключом секции в хранилищах Cosmos DB hello одной физической секции. Выбор Hello hello ключ раздела представляет собой важное решение, наличие toomake во время разработки. Необходимо выбрать имя свойства, которое имеет широкий диапазон значений и шаблоны доступа.

> [!NOTE]
> Это наиболее toohave рекомендаций ключ раздела с большим количеством уникальных значений (как минимум сотнях тысячах).
>

Контейнеры базы данных Azure Cosmos DB могут быть созданы как фиксированные или неограниченные. Контейнеры фиксированного размера имеют максимальный размер в 10 ГБ и пропускную способность в 10 000 ЕЗ в секунду. Некоторые интерфейсы API позволяют toobe ключа секции hello опущен для контейнеров фиксированного размера. toocreate контейнера как неограниченное необходимо указать минимальное пропускной способности 2500 единиц Запросов в секунду.

## <a name="partitioning-and-provisioned-throughput"></a>Секционирование и подготовленная пропускная способность
База данных Cosmos DB предназначена для обеспечения прогнозируемой производительности. При создании контейнера вы резервируете пропускную способность в виде **[единиц запроса](request-units.md) (ЕЗ) в секунду с потенциальной надстройкой для ЕЗ в минуту**. Каждому запросу присваивается сбор единица запроса, пропорционально toohello объем системных ресурсов, таких как ЦП, памяти и используемые hello операции ввода-ВЫВОДА. Чтение документа размером 1 КБ с согласованностью сеанса потребляет 1 единицу запроса. Read — 1 RU независимо от числа элементов в hello хранится или hello число одновременных запросов, выполняемых в hello то же время. Элементы большего размера требуется выше единиц запросов в зависимости от размера hello. Если вы знаете hello размер сущностей и hello число операций чтения toosupport для вашего приложения, можно подготовить hello точное количество пропускная способность, необходимая для приложения при этом требуется прочитать. 

> [!NOTE]
> tooachieve hello пропускную способность hello контейнера, необходимо выбрать ключ раздела, который позволяет вам tooevenly распределения запросов между некоторые ключевые значения отдельного раздела.
> 
> 

<a name="designing-for-partitioning"></a>
## <a name="working-with-hello-azure-cosmos-db-apis"></a>Работа с API-интерфейсы DB Cosmos Azure hello
Можно использовать hello портал Azure или Azure CLI toocreate контейнеров и масштабировать их в любое время. В этом разделе показано, как контейнеры toocreate и укажите hello пропускной способности и секции определение ключа в каждом hello поддерживаемые API.

### <a name="documentdb-api"></a>API DocumentDB
Следующий образец Hello показано, как контейнер (коллекция) с помощью toocreate hello DocumentDB API. Дополнительные сведения см. в статье [Секционирование, ключи секции и масштабирование в DocumentDB](partition-data.md).

```csharp
DocumentClient client = new DocumentClient(new Uri(endpoint), authKey);
await client.CreateDatabaseAsync(new Database { Id = "db" });

DocumentCollection myCollection = new DocumentCollection();
myCollection.Id = "coll";
myCollection.PartitionKey.Paths.Add("/deviceId");

await client.CreateDocumentCollectionAsync(
    UriFactory.CreateDatabaseUri("db"),
    myCollection,
    new RequestOptions { OfferThroughput = 20000 });
```

Можно прочитать элемента (документа), с помощью hello `GET` метод hello API-интерфейса REST или с помощью `ReadDocumentAsync` в одном из пакетов SDK hello.

```csharp
// Read document. Needs hello partition key and hello ID toobe specified
DeviceReading document = await client.ReadDocumentAsync<DeviceReading>(
  UriFactory.CreateDocumentUri("db", "coll", "XMS-001-FE24C"), 
  new RequestOptions { PartitionKey = new PartitionKey("XMS-0001") });
```

### <a name="mongodb-api"></a>API MongoDB
С hello MongoDB API можно создать коллекцию сегментированных посредством вашего любимого инструмента, драйвера или пакета SDK. В этом примере мы используем для создания коллекции hello hello оболочку Mongo.

В hello оболочку Mongo:

```
db.runCommand( { shardCollection: "admin.people", key: { region: "hashed" } } )
```
    
Результат:

```JSON
{
    "_t" : "ShardCollectionResponse",
    "ok" : 1,
    "collectionsharded" : "admin.people"
}
```

### <a name="table-api"></a>API таблицы

С hello API таблиц необходимо указать hello пропускную способность для таблиц в конфигурации appSettings hello для приложения:

```xml
<configuration>
    <appSettings>
      <!--Table creation options -->
      <add key="TableThroughput" value="700"/>
    </appSettings>
</configuration>
```

Создайте таблицу с помощью пакета SDK службы хранилища Azure Table hello. ключ раздела Hello неявно создается как hello `PartitionKey` значение. 

```csharp
CloudTableClient tableClient = storageAccount.CreateCloudTableClient();

CloudTable table = tableClient.GetTableReference("people");
table.CreateIfNotExists();
```

Можно получить единственную сущность, используя следующий фрагмент кода hello:

```csharp
// Create a retrieve operation that takes a customer entity.
TableOperation retrieveOperation = TableOperation.Retrieve<CustomerEntity>("Smith", "Ben");

// Execute hello retrieve operation.
TableResult retrievedResult = table.Execute(retrieveOperation);
```
В разделе [разработки с использованием API таблиц hello](tutorial-develop-table-dotnet.md) для получения дополнительных сведений.

### <a name="graph-api"></a>API Graph

С hello Graph API необходимо использовать hello портал Azure или контейнеры toocreate CLI. Кроме того поскольку Azure Cosmos DB моделей, может использовать один из hello toocreate других моделей и масштабировать graph контейнера.

Можно прочитать любой вершин или с помощью ключа секции hello и идентификатором в Gremlin edge. Например для диаграммы с регионом («США») как ключа раздела hello и «Сиэтл» в качестве ключа строки hello, можно найти вершин, используя синтаксис hello:

```
g.V(['USA', 'Seattle'])
```

Совпадают с границами, можно ссылаться на край с помощью ключа раздела hello и ключ строки.

```
g.E(['USA', 'I5'])
```

Дополнительные сведения см. в статье [Azure Cosmos DB Gremlin graph support](gremlin-support.md) (Поддержка графа Gremlin для базы данных Azure Cosmos DB).


<a name="designing-for-partitioning"></a>
## <a name="designing-for-partitioning"></a>Проектирование секционирования
tooscale эффективно с Azure Cosmos DB необходимо toopick хорошим ключом раздела при создании контейнера. Существует две основные рекомендации по выбору ключа секции.

* **Граница для запросов и транзакций**: Выбор ключа секции должны сбалансировать hello tooenable необходимость hello использование транзакций от toodistribute требование hello сущностей по несколько tooensure ключей секционирования масштабируемое решение. С одной стороны, можно задать hello одинаковым ключом секции для всех элементов, но это может ограничить масштабируемость hello решения. В hello другой стороны, можно назначить ключа секции, уникальные для каждого элемента, который бы высокую степень масштабируемости, но не позволяют выполнить с помощью перекрестного документа транзакции через хранимые процедуры и триггеры. Ключ раздела идеальной является одним, которые позволяют toouse эффективные запросы и имеет достаточно мощности tooensure масштабируемые решения. 
* **Нет узких мест хранения и производительности**: важно toopick свойство, позволяющее записывает toobe, распределенные по различным уникальных значений. Запросы toohello же ключ секционирования не может превышать hello пропускная способность отдельной секции и подавлены. В этом случае важно toopick ключа раздела, который не приводит к появлению «горячие точки» в приложении. Поскольку все данные hello для ключа одной секции должны храниться внутри секции, рекомендуется также tooavoid разделов, имеющих большие объемы данных для hello одинаковое значение. 

Давайте рассмотрим несколько реальных сценариев и подходящие ключи секции для каждого:
* При реализации серверной части профиля пользователя, идентификатор пользователя hello является хорошим выбором для ключа раздела.
* Если вы храните данные Интернета вещей, например состояние устройства, то в качестве ключа секции удобно выбрать идентификатор устройства.
* Если вы используете Azure Cosmos DB для ведения журнала данных временных рядов, затем hello имя узла или идентификатор процесса лучше всего подойдет для ключа раздела.
* Если у вас есть мультитенантной архитектуре, ИД клиента hello лучше всего подойдет для ключа раздела.

В некоторых случаях, таких как IoT и профили пользователей, hello ключ секции может быть использование Здравствуйте таким же, как ваш код (ключ документа). В других областях, например hello временного ряда данных может потребоваться ключа раздела, который отличается от идентификатора hello.

### <a name="partitioning-and-loggingtime-series-data"></a>Секционирование и ведение журнала (данные временных рядов)
Одним из наиболее распространенных случаев использования hello объекта Cosmos DB предназначен для ведения журнала и телеметрии. Это важные toopick хорошим ключом раздела является, так как может потребоваться tooread и записи большие объемы данных. Выбор Hello зависит от того, на чтение и запись ставки и типов запросов, что предполагается, что toorun. Ниже приведены некоторые советы о том, как toochoose хорошим ключом раздела.

* Если вашей включает небольшое количество записывает накоплении в течение длительного времени и необходимости tooquery по диапазонам отметки времени и другие фильтры с помощью сводных данных timestamp hello, например, даты как ключ секции, является хорошим решением. Это позволяет вам tooquery данными hello даты из одной секции. 
* Если, как это чаще бывает, рабочая нагрузка подразумевает большое число операций записи, следует использовать ключ секции, который не зависит от метки времени, чтобы база данных Cosmos DB могла выполнять равномерную запись в несколько секций. В этом случае хорошим выбором станет имя узла, идентификатор процесса, идентификатор действия или другое свойство с большим количеством элементов. 
* Третий способ — это гибрид один где имеется несколько контейнеров, по одной на каждый месяц/день и ключ раздела hello детальные свойству как имя узла. Который можно задать разные пропускной способности основании hello временное окно преимущество hello, например, контейнер hello для hello текущего месяца, предоставляется более высокую пропускную способность, так как он выполняет операции чтения и записи, в то время как предыдущие месяцы с снизить пропускную способность с момента они могут использоваться только операции чтения.

### <a name="partitioning-and-multi-tenancy"></a>Секционирование и мультитенантность
При реализации мультитенантного приложения с помощью базы данных Cosmos DB существует два популярных шаблона — один ключ секции на клиент и один контейнер на клиент. Ниже приведены hello преимуществ и недостатков каждого.

* Один ключ секции на клиент: в этой модели клиенты совместно размещены в одном контейнере. Однако запросы и операции вставки для элементов в рамках одного клиента можно выполнить с одной секцией. Кроме того, можно реализовать логику транзакций для всех элементов в пределах клиента. Так как несколько клиентов совместно используют один контейнер, можно сократить затраты на хранилище и пропускную способность, организовав пул ресурсов для клиентов в пределах одного контейнера, а не подготавливая дополнительный запас для каждого клиента. Hello недостаток заключается в том, что у вас изоляцию производительности каждого клиента. Повышает производительность и пропускную способность увеличивается vs целевые toohello всего контейнера применяются для клиентов.
* Один контейнер на клиент: каждый клиент имеет собственный контейнер. В этой модели можно резервировать производительность для каждого клиента. Благодаря новой модели ценообразования на основе резервирования для базы данных Cosmos DB, эта модель является более экономичной для мультитенантных приложений с небольшим числом клиентов.

Также можно использовать сочетание/многоуровневого подход, который collocates небольших клиентов и переносит большего размера контейнера tootheir собственных клиентов.

## <a name="next-steps"></a>Дальнейшие действия
В этой статье мы предоставили обзор концепций и рекомендации для секционирования с использованием любого API базы данных Azure Cosmos DB. 

* Дополнительные сведения о подготовленной пропускной способности в базе данных Azure Cosmos DB см. в [этой статье](request-units.md).
* Узнайте больше о [глобальном распределении в базе данных Azure Cosmos DB](distribute-data-globally.md).



