---
title: "aaaPartitioning и горизонтальное масштабирование в Azure Cosmos DB | Документы Microsoft"
description: "Дополнительные сведения о том, как секционирования работы в базе данных Azure Cosmos как tooconfigure секционирования и ключи секций и как toopick hello справа ключ раздела для вашего приложения."
services: cosmos-db
author: arramac
manager: jhubbard
editor: monicar
documentationcenter: 
ms.assetid: cac9a8cd-b5a3-4827-8505-d40bb61b2416
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: arramac
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 87d56db8c4ccc6b94b1650baff0fcfb3db6d1777
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-toopartition-and-scale-in-azure-cosmos-db"></a><span data-ttu-id="a3388-103">Как toopartition и масштабирования в Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="a3388-103">How toopartition and scale in Azure Cosmos DB</span></span>

<span data-ttu-id="a3388-104">[Microsoft Azure Cosmos DB](https://azure.microsoft.com/services/cosmos-db/) является toohelp служба, предоставляющая глобальной распределенной базы данных моделей, можно добиться быстрого и предсказуемая производительность и масштабируемость без проблем вместе с приложением при увеличении его.</span><span class="sxs-lookup"><span data-stu-id="a3388-104">[Microsoft Azure Cosmos DB](https://azure.microsoft.com/services/cosmos-db/) is a global distributed, multi-model database service designed toohelp you achieve fast, predictable performance and scale seamlessly along with your application as it grows.</span></span> <span data-ttu-id="a3388-105">Это статье представлен обзор как секционирование работает для всех данных hello моделей в базе данных Azure Cosmos, и описывается, как настроить приложения Azure Cosmos DB контейнеры tooeffectively шкалы.</span><span class="sxs-lookup"><span data-stu-id="a3388-105">This article provides an overview of how partitioning works for all hello data models in Azure Cosmos DB, and describes how you can configure Azure Cosmos DB containers tooeffectively scale your applications.</span></span>

<span data-ttu-id="a3388-106">Секционирование и ключи секций также рассматриваются в этом видео из цикла "Azure, пятница" от Скотта Хансельмана (Scott Hanselman) и главного технического руководителя базы данных Azure Cosmos DB, Ширеша Тоты (Shireesh Thota).</span><span class="sxs-lookup"><span data-stu-id="a3388-106">Partitioning and partition keys are also covered in this Azure Friday video with Scott Hanselman and Azure Cosmos DB Principal Engineering Manager, Shireesh Thota.</span></span>

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Azure-DocumentDB-Elastic-Scale-Partitioning/player]
> 

## <a name="partitioning-in-azure-cosmos-db"></a><span data-ttu-id="a3388-107">Секционирование в базе данных Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="a3388-107">Partitioning in Azure Cosmos DB</span></span>
<span data-ttu-id="a3388-108">В базе данных Azure Cosmos DB можно хранить данные без схемы и запрашивать их, получая ответ за миллисекунды вне зависимости от масштаба.</span><span class="sxs-lookup"><span data-stu-id="a3388-108">In Azure Cosmos DB, you can store and query schema-less data with order-of-millisecond response times at any scale.</span></span> <span data-ttu-id="a3388-109">База данных Cosmos DB предоставляет контейнеры для хранения данных, которые называются **коллекциями (для документов), графами или таблицами**.</span><span class="sxs-lookup"><span data-stu-id="a3388-109">Cosmos DB provides containers for storing data called **collections (for document), graphs, or tables**.</span></span> <span data-ttu-id="a3388-110">Контейнеры — это логические ресурсы, они могут включать в себя одну или несколько физических секций или серверов.</span><span class="sxs-lookup"><span data-stu-id="a3388-110">Containers are logical resources and can span one or more physical partitions or servers.</span></span> <span data-ttu-id="a3388-111">Hello число секций, определяется на основе размера хранилища hello и пропускная способность hello контейнера hello DB Cosmos.</span><span class="sxs-lookup"><span data-stu-id="a3388-111">hello number of partitions is determined by Cosmos DB based on hello storage size and hello provisioned throughput of hello container.</span></span> <span data-ttu-id="a3388-112">С каждой секцией в базе данных Azure Cosmos DB связано фиксированное количество хранилищ на основе SSD, которое реплицируется для обеспечения высокого уровня доступности.</span><span class="sxs-lookup"><span data-stu-id="a3388-112">Every partition in Cosmos DB has a fixed amount of SSD-backed storage associated with it, and is replicated for high availability.</span></span> <span data-ttu-id="a3388-113">Управление секциями полностью управляются Azure Cosmos DB и управления секциями или не toowrite сложный код.</span><span class="sxs-lookup"><span data-stu-id="a3388-113">Partition management is fully managed by Azure Cosmos DB, and you do not have toowrite complex code or manage your partitions.</span></span> <span data-ttu-id="a3388-114">Контейнеры базы данных Azure Cosmos DB не ограничены в плане хранения и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="a3388-114">Cosmos DB containers are unlimited in terms of storage and throughput.</span></span> 

![horizontal](./media/introduction/azure-cosmos-db-partitioning.png) 

<span data-ttu-id="a3388-116">Секционирование является прозрачным tooyour приложения.</span><span class="sxs-lookup"><span data-stu-id="a3388-116">Partitioning is transparent tooyour application.</span></span> <span data-ttu-id="a3388-117">Cosmos DB поддерживает быстрого чтения и записи, запросы, транзакционную логику, уровни согласованности и детальное управление доступом через методы или интерфейсы API tooa один контейнер ресурсов.</span><span class="sxs-lookup"><span data-stu-id="a3388-117">Cosmos DB supports fast reads and writes, queries, transactional logic, consistency levels, and fine-grained access control via methods/APIs tooa single container resource.</span></span> <span data-ttu-id="a3388-118">дескрипторы службы Hello распределения данных по секциям и маршрутизацию правой части запроса запросов toohello.</span><span class="sxs-lookup"><span data-stu-id="a3388-118">hello service handles distributing data across partitions and routing query requests toohello right partition.</span></span> 

<span data-ttu-id="a3388-119">Как работает секционирование</span><span class="sxs-lookup"><span data-stu-id="a3388-119">How does partitioning work?</span></span> <span data-ttu-id="a3388-120">Каждый элемент должен иметь ключ секции и ключ строки, которые однозначно идентифицируют его.</span><span class="sxs-lookup"><span data-stu-id="a3388-120">Each item must have a partition key and a row key, which uniquely identify it.</span></span> <span data-ttu-id="a3388-121">Ключ секции выступает в качестве логической секции для ваших данных и предоставляет базе данных Cosmos DB естественную границу для распределения данных между секциями.</span><span class="sxs-lookup"><span data-stu-id="a3388-121">Your partition key acts as a logical partition for your data, and provides Cosmos DB with a natural boundary for distributing data across partitions.</span></span> <span data-ttu-id="a3388-122">Вот как работает секционирование в базе данных Azure Cosmos DB:</span><span class="sxs-lookup"><span data-stu-id="a3388-122">In brief, here is how partitioning works in Azure Cosmos DB:</span></span>

* <span data-ttu-id="a3388-123">Вы подготавливаете контейнер базы данных Cosmos DB с пропускной способностью `T` запросов в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3388-123">You provision a Cosmos DB container with `T` requests/s throughput</span></span>
* <span data-ttu-id="a3388-124">В фоновом hello секций подготавливает Cosmos DB необходимости tooserve `T` запросов в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3388-124">Behind hello scenes, Cosmos DB provisions partitions needed tooserve `T` requests/s.</span></span> <span data-ttu-id="a3388-125">Если `T` выше, чем hello максимальная пропускная способность каждого раздела `t`, затем Cosmos DB подготавливает `N`  =  `T/t` секций</span><span class="sxs-lookup"><span data-stu-id="a3388-125">If `T` is higher than hello maximum throughput per partition `t`, then Cosmos DB provisions `N` = `T/t` partitions</span></span>
* <span data-ttu-id="a3388-126">Cosmos DB распределяет пространство hello секции ключа хэши равномерно по hello `N` секций.</span><span class="sxs-lookup"><span data-stu-id="a3388-126">Cosmos DB allocates hello key space of partition key hashes evenly across hello `N` partitions.</span></span> <span data-ttu-id="a3388-127">Таким образом, каждая секция (физическая секция) содержит значения ключа секции 1-N (логические секции).</span><span class="sxs-lookup"><span data-stu-id="a3388-127">So, each partition (physical partition) hosts 1-N partition key values (logical partitions)</span></span>
* <span data-ttu-id="a3388-128">При физической секции `p` достигает Превышен предельный размер, Cosmos DB легко разбивает `p` на два новых раздела `p1` и `p2` и распространяет значения, соответствующие tooroughly половина hello ключи tooeach из hello секции.</span><span class="sxs-lookup"><span data-stu-id="a3388-128">When a physical partition `p` reaches its storage limit, Cosmos DB seamlessly splits `p` into two new partitions `p1` and `p2` and distributes values corresponding tooroughly half hello keys tooeach of hello partitions.</span></span> <span data-ttu-id="a3388-129">Операция разбиения это невидимой tooyour приложение.</span><span class="sxs-lookup"><span data-stu-id="a3388-129">This split operation is invisible tooyour application.</span></span>
* <span data-ttu-id="a3388-130">Аналогичным образом, когда подготовить пропускную способность выше, чем `t*N` пропускной способности, Cosmos DB разбивает один или несколько секций toosupport hello выше пропускную способность</span><span class="sxs-lookup"><span data-stu-id="a3388-130">Similarly, when you provision throughput higher than `t*N` throughput, Cosmos DB splits one or more of your partitions toosupport hello higher throughput</span></span>

<span data-ttu-id="a3388-131">Hello ключи разделов семантика семантика hello немного отличается toomatch каждый API, как показано в следующей таблице hello.</span><span class="sxs-lookup"><span data-stu-id="a3388-131">hello semantics for partition keys are slightly different toomatch hello semantics of each API, as shown in hello following table:</span></span>

| <span data-ttu-id="a3388-132">API</span><span class="sxs-lookup"><span data-stu-id="a3388-132">API</span></span> | <span data-ttu-id="a3388-133">Ключ раздела</span><span class="sxs-lookup"><span data-stu-id="a3388-133">Partition Key</span></span> | <span data-ttu-id="a3388-134">Ключ строки</span><span class="sxs-lookup"><span data-stu-id="a3388-134">Row Key</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a3388-135">DocumentDB</span><span class="sxs-lookup"><span data-stu-id="a3388-135">DocumentDB</span></span> | <span data-ttu-id="a3388-136">пользовательский путь к ключу секции</span><span class="sxs-lookup"><span data-stu-id="a3388-136">custom partition key path</span></span> | <span data-ttu-id="a3388-137">фиксированное значение `id`</span><span class="sxs-lookup"><span data-stu-id="a3388-137">fixed `id`</span></span> | 
| <span data-ttu-id="a3388-138">MongoDB</span><span class="sxs-lookup"><span data-stu-id="a3388-138">MongoDB</span></span> | <span data-ttu-id="a3388-139">пользовательский ключ сегмента</span><span class="sxs-lookup"><span data-stu-id="a3388-139">custom shard key</span></span>  | <span data-ttu-id="a3388-140">фиксированное значение `_id`</span><span class="sxs-lookup"><span data-stu-id="a3388-140">fixed `_id`</span></span> | 
| <span data-ttu-id="a3388-141">График</span><span class="sxs-lookup"><span data-stu-id="a3388-141">Graph</span></span> | <span data-ttu-id="a3388-142">свойство пользовательского ключа секции</span><span class="sxs-lookup"><span data-stu-id="a3388-142">custom partition key property</span></span> | <span data-ttu-id="a3388-143">фиксированное значение `id`</span><span class="sxs-lookup"><span data-stu-id="a3388-143">fixed `id`</span></span> | 
| <span data-ttu-id="a3388-144">Таблица</span><span class="sxs-lookup"><span data-stu-id="a3388-144">Table</span></span> | <span data-ttu-id="a3388-145">фиксированное значение `PartitionKey`</span><span class="sxs-lookup"><span data-stu-id="a3388-145">fixed `PartitionKey`</span></span> | <span data-ttu-id="a3388-146">фиксированное значение `RowKey`</span><span class="sxs-lookup"><span data-stu-id="a3388-146">fixed `RowKey`</span></span> | 

<span data-ttu-id="a3388-147">База данных Cosmos DB использует секционирование на основе хэша.</span><span class="sxs-lookup"><span data-stu-id="a3388-147">Cosmos DB uses hash-based partitioning.</span></span> <span data-ttu-id="a3388-148">При создании элемента, Cosmos DB хэширует значение ключа секции hello и используйте hello хэшированные результат toodetermine какой секции toostore hello из элементов.</span><span class="sxs-lookup"><span data-stu-id="a3388-148">When you write an item, Cosmos DB hashes hello partition key value and use hello hashed result toodetermine which partition toostore hello item in.</span></span> <span data-ttu-id="a3388-149">Здравствуйте, все элементы с одинаковым ключом секции в хранилищах Cosmos DB hello одной физической секции.</span><span class="sxs-lookup"><span data-stu-id="a3388-149">Cosmos DB stores all items with hello same partition key in hello same physical partition.</span></span> <span data-ttu-id="a3388-150">Выбор Hello hello ключ раздела представляет собой важное решение, наличие toomake во время разработки.</span><span class="sxs-lookup"><span data-stu-id="a3388-150">hello choice of hello partition key is an important decision that you have toomake at design time.</span></span> <span data-ttu-id="a3388-151">Необходимо выбрать имя свойства, которое имеет широкий диапазон значений и шаблоны доступа.</span><span class="sxs-lookup"><span data-stu-id="a3388-151">You must pick a property name that has a wide range of values and has even access patterns.</span></span>

> [!NOTE]
> <span data-ttu-id="a3388-152">Это наиболее toohave рекомендаций ключ раздела с большим количеством уникальных значений (как минимум сотнях тысячах).</span><span class="sxs-lookup"><span data-stu-id="a3388-152">It is a best practice toohave a partition key with many distinct values (100s-1000s at a minimum).</span></span>
>

<span data-ttu-id="a3388-153">Контейнеры базы данных Azure Cosmos DB могут быть созданы как фиксированные или неограниченные.</span><span class="sxs-lookup"><span data-stu-id="a3388-153">Azure Cosmos DB containers can be created as "fixed" or "unlimited."</span></span> <span data-ttu-id="a3388-154">Контейнеры фиксированного размера имеют максимальный размер в 10 ГБ и пропускную способность в 10 000 ЕЗ в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3388-154">Fixed-size containers have a maximum limit of 10 GB and 10,000 RU/s throughput.</span></span> <span data-ttu-id="a3388-155">Некоторые интерфейсы API позволяют toobe ключа секции hello опущен для контейнеров фиксированного размера.</span><span class="sxs-lookup"><span data-stu-id="a3388-155">Some APIs allow hello partition key toobe omitted for fixed-size containers.</span></span> <span data-ttu-id="a3388-156">toocreate контейнера как неограниченное необходимо указать минимальное пропускной способности 2500 единиц Запросов в секунду.</span><span class="sxs-lookup"><span data-stu-id="a3388-156">toocreate a container as unlimited, you must specify a minimum throughput of 2500 RU/s.</span></span>

## <a name="partitioning-and-provisioned-throughput"></a><span data-ttu-id="a3388-157">Секционирование и подготовленная пропускная способность</span><span class="sxs-lookup"><span data-stu-id="a3388-157">Partitioning and provisioned throughput</span></span>
<span data-ttu-id="a3388-158">База данных Cosmos DB предназначена для обеспечения прогнозируемой производительности.</span><span class="sxs-lookup"><span data-stu-id="a3388-158">Cosmos DB is designed for predictable performance.</span></span> <span data-ttu-id="a3388-159">При создании контейнера вы резервируете пропускную способность в виде **[единиц запроса](request-units.md) (ЕЗ) в секунду с потенциальной надстройкой для ЕЗ в минуту**.</span><span class="sxs-lookup"><span data-stu-id="a3388-159">When you create a container, you reserve throughput in terms of **[request units](request-units.md) (RU) per second with a potential add-on for RU per minute**.</span></span> <span data-ttu-id="a3388-160">Каждому запросу присваивается сбор единица запроса, пропорционально toohello объем системных ресурсов, таких как ЦП, памяти и используемые hello операции ввода-ВЫВОДА.</span><span class="sxs-lookup"><span data-stu-id="a3388-160">Each request is assigned a request unit charge that is proportionate toohello amount of system resources like CPU, Memory, and IO consumed by hello operation.</span></span> <span data-ttu-id="a3388-161">Чтение документа размером 1 КБ с согласованностью сеанса потребляет 1 единицу запроса.</span><span class="sxs-lookup"><span data-stu-id="a3388-161">A read of a 1-KB document with Session consistency consumes one request unit.</span></span> <span data-ttu-id="a3388-162">Read — 1 RU независимо от числа элементов в hello хранится или hello число одновременных запросов, выполняемых в hello то же время.</span><span class="sxs-lookup"><span data-stu-id="a3388-162">A read is 1 RU regardless of hello number of items stored or hello number of concurrent requests running at hello same time.</span></span> <span data-ttu-id="a3388-163">Элементы большего размера требуется выше единиц запросов в зависимости от размера hello.</span><span class="sxs-lookup"><span data-stu-id="a3388-163">Larger items require higher request units depending on hello size.</span></span> <span data-ttu-id="a3388-164">Если вы знаете hello размер сущностей и hello число операций чтения toosupport для вашего приложения, можно подготовить hello точное количество пропускная способность, необходимая для приложения при этом требуется прочитать.</span><span class="sxs-lookup"><span data-stu-id="a3388-164">If you know hello size of your entities and hello number of reads you need toosupport for your application, you can provision hello exact amount of throughput required for your application's read needs.</span></span> 

> [!NOTE]
> <span data-ttu-id="a3388-165">tooachieve hello пропускную способность hello контейнера, необходимо выбрать ключ раздела, который позволяет вам tooevenly распределения запросов между некоторые ключевые значения отдельного раздела.</span><span class="sxs-lookup"><span data-stu-id="a3388-165">tooachieve hello full throughput of hello container, you must choose a partition key that allows you tooevenly distribute requests among some distinct partition key values.</span></span>
> 
> 

<a name="designing-for-partitioning"></a>
## <a name="working-with-hello-azure-cosmos-db-apis"></a><span data-ttu-id="a3388-166">Работа с API-интерфейсы DB Cosmos Azure hello</span><span class="sxs-lookup"><span data-stu-id="a3388-166">Working with hello Azure Cosmos DB APIs</span></span>
<span data-ttu-id="a3388-167">Можно использовать hello портал Azure или Azure CLI toocreate контейнеров и масштабировать их в любое время.</span><span class="sxs-lookup"><span data-stu-id="a3388-167">You can use hello Azure portal or Azure CLI toocreate containers and scale them at any time.</span></span> <span data-ttu-id="a3388-168">В этом разделе показано, как контейнеры toocreate и укажите hello пропускной способности и секции определение ключа в каждом hello поддерживаемые API.</span><span class="sxs-lookup"><span data-stu-id="a3388-168">This section shows how toocreate containers and specify hello throughput and partition key definition in each of hello supported APIs.</span></span>

### <a name="documentdb-api"></a><span data-ttu-id="a3388-169">API DocumentDB</span><span class="sxs-lookup"><span data-stu-id="a3388-169">DocumentDB API</span></span>
<span data-ttu-id="a3388-170">Следующий образец Hello показано, как контейнер (коллекция) с помощью toocreate hello DocumentDB API.</span><span class="sxs-lookup"><span data-stu-id="a3388-170">hello following sample shows how toocreate a container (collection) using hello DocumentDB API.</span></span> <span data-ttu-id="a3388-171">Дополнительные сведения см. в статье [Секционирование, ключи секции и масштабирование в DocumentDB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="a3388-171">You can find more details in [Partitioning with DocumentDB API](partition-data.md).</span></span>

```csharp
DocumentClient client = new DocumentClient(new Uri(endpoint), authKey);
await client.CreateDatabaseAsync(new Database { Id = "db" });

DocumentCollection myCollection = new DocumentCollection();
myCollection.Id = "coll";
myCollection.PartitionKey.Paths.Add("/deviceId");

await client.CreateDocumentCollectionAsync(
    UriFactory.CreateDatabaseUri("db"),
    myCollection,
    new RequestOptions { OfferThroughput = 20000 });
```

<span data-ttu-id="a3388-172">Можно прочитать элемента (документа), с помощью hello `GET` метод hello API-интерфейса REST или с помощью `ReadDocumentAsync` в одном из пакетов SDK hello.</span><span class="sxs-lookup"><span data-stu-id="a3388-172">You can read an item (document) using hello `GET` method in hello REST API or using `ReadDocumentAsync` in one of hello SDKs.</span></span>

```csharp
// Read document. Needs hello partition key and hello ID toobe specified
DeviceReading document = await client.ReadDocumentAsync<DeviceReading>(
  UriFactory.CreateDocumentUri("db", "coll", "XMS-001-FE24C"), 
  new RequestOptions { PartitionKey = new PartitionKey("XMS-0001") });
```

### <a name="mongodb-api"></a><span data-ttu-id="a3388-173">API MongoDB</span><span class="sxs-lookup"><span data-stu-id="a3388-173">MongoDB API</span></span>
<span data-ttu-id="a3388-174">С hello MongoDB API можно создать коллекцию сегментированных посредством вашего любимого инструмента, драйвера или пакета SDK.</span><span class="sxs-lookup"><span data-stu-id="a3388-174">With hello MongoDB API, you can create a sharded collection through your favorite tool, driver, or SDK.</span></span> <span data-ttu-id="a3388-175">В этом примере мы используем для создания коллекции hello hello оболочку Mongo.</span><span class="sxs-lookup"><span data-stu-id="a3388-175">In this example, we use hello Mongo Shell for hello collection creation.</span></span>

<span data-ttu-id="a3388-176">В hello оболочку Mongo:</span><span class="sxs-lookup"><span data-stu-id="a3388-176">In hello Mongo Shell:</span></span>

```
db.runCommand( { shardCollection: "admin.people", key: { region: "hashed" } } )
```
    
<span data-ttu-id="a3388-177">Результат:</span><span class="sxs-lookup"><span data-stu-id="a3388-177">Results:</span></span>

```JSON
{
    "_t" : "ShardCollectionResponse",
    "ok" : 1,
    "collectionsharded" : "admin.people"
}
```

### <a name="table-api"></a><span data-ttu-id="a3388-178">API таблицы</span><span class="sxs-lookup"><span data-stu-id="a3388-178">Table API</span></span>

<span data-ttu-id="a3388-179">С hello API таблиц необходимо указать hello пропускную способность для таблиц в конфигурации appSettings hello для приложения:</span><span class="sxs-lookup"><span data-stu-id="a3388-179">With hello Table API, you specify hello throughput for tables in hello appSettings configuration for your application:</span></span>

```xml
<configuration>
    <appSettings>
      <!--Table creation options -->
      <add key="TableThroughput" value="700"/>
    </appSettings>
</configuration>
```

<span data-ttu-id="a3388-180">Создайте таблицу с помощью пакета SDK службы хранилища Azure Table hello.</span><span class="sxs-lookup"><span data-stu-id="a3388-180">Then you create a table using hello Azure Table storage SDK.</span></span> <span data-ttu-id="a3388-181">ключ раздела Hello неявно создается как hello `PartitionKey` значение.</span><span class="sxs-lookup"><span data-stu-id="a3388-181">hello partition key is implicitly created as hello `PartitionKey` value.</span></span> 

```csharp
CloudTableClient tableClient = storageAccount.CreateCloudTableClient();

CloudTable table = tableClient.GetTableReference("people");
table.CreateIfNotExists();
```

<span data-ttu-id="a3388-182">Можно получить единственную сущность, используя следующий фрагмент кода hello:</span><span class="sxs-lookup"><span data-stu-id="a3388-182">You can retrieve a single entity using hello following snippet:</span></span>

```csharp
// Create a retrieve operation that takes a customer entity.
TableOperation retrieveOperation = TableOperation.Retrieve<CustomerEntity>("Smith", "Ben");

// Execute hello retrieve operation.
TableResult retrievedResult = table.Execute(retrieveOperation);
```
<span data-ttu-id="a3388-183">В разделе [разработки с использованием API таблиц hello](tutorial-develop-table-dotnet.md) для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="a3388-183">See [Developing with hello Table API](tutorial-develop-table-dotnet.md) for more details.</span></span>

### <a name="graph-api"></a><span data-ttu-id="a3388-184">API Graph</span><span class="sxs-lookup"><span data-stu-id="a3388-184">Graph API</span></span>

<span data-ttu-id="a3388-185">С hello Graph API необходимо использовать hello портал Azure или контейнеры toocreate CLI.</span><span class="sxs-lookup"><span data-stu-id="a3388-185">With hello Graph API, you must use hello Azure portal or CLI toocreate containers.</span></span> <span data-ttu-id="a3388-186">Кроме того поскольку Azure Cosmos DB моделей, может использовать один из hello toocreate других моделей и масштабировать graph контейнера.</span><span class="sxs-lookup"><span data-stu-id="a3388-186">Alternatively, since Azure Cosmos DB is multi-model, you can use one of hello other models toocreate and scale your graph container.</span></span>

<span data-ttu-id="a3388-187">Можно прочитать любой вершин или с помощью ключа секции hello и идентификатором в Gremlin edge.</span><span class="sxs-lookup"><span data-stu-id="a3388-187">You can read any vertex or edge using hello partition key and id in Gremlin.</span></span> <span data-ttu-id="a3388-188">Например для диаграммы с регионом («США») как ключа раздела hello и «Сиэтл» в качестве ключа строки hello, можно найти вершин, используя синтаксис hello:</span><span class="sxs-lookup"><span data-stu-id="a3388-188">For example, for a graph with region ("USA") as hello partition key, and "Seattle" as hello row key, you can find a vertex using hello following syntax:</span></span>

```
g.V(['USA', 'Seattle'])
```

<span data-ttu-id="a3388-189">Совпадают с границами, можно ссылаться на край с помощью ключа раздела hello и ключ строки.</span><span class="sxs-lookup"><span data-stu-id="a3388-189">Same with edges, you can reference an edge using hello partition key and row key.</span></span>

```
g.E(['USA', 'I5'])
```

<span data-ttu-id="a3388-190">Дополнительные сведения см. в статье [Azure Cosmos DB Gremlin graph support](gremlin-support.md) (Поддержка графа Gremlin для базы данных Azure Cosmos DB).</span><span class="sxs-lookup"><span data-stu-id="a3388-190">See [Gremlin support for Cosmos DB](gremlin-support.md) for more details.</span></span>


<a name="designing-for-partitioning"></a>
## <a name="designing-for-partitioning"></a><span data-ttu-id="a3388-191">Проектирование секционирования</span><span class="sxs-lookup"><span data-stu-id="a3388-191">Designing for partitioning</span></span>
<span data-ttu-id="a3388-192">tooscale эффективно с Azure Cosmos DB необходимо toopick хорошим ключом раздела при создании контейнера.</span><span class="sxs-lookup"><span data-stu-id="a3388-192">tooscale effectively with Azure Cosmos DB, you need toopick a good partition key when you create your container.</span></span> <span data-ttu-id="a3388-193">Существует две основные рекомендации по выбору ключа секции.</span><span class="sxs-lookup"><span data-stu-id="a3388-193">There are two key considerations for choosing a partition key:</span></span>

* <span data-ttu-id="a3388-194">**Граница для запросов и транзакций**: Выбор ключа секции должны сбалансировать hello tooenable необходимость hello использование транзакций от toodistribute требование hello сущностей по несколько tooensure ключей секционирования масштабируемое решение.</span><span class="sxs-lookup"><span data-stu-id="a3388-194">**Boundary for query and transactions**: Your choice of partition key should balance hello need tooenable hello use of transactions against hello requirement toodistribute your entities across multiple partition keys tooensure a scalable solution.</span></span> <span data-ttu-id="a3388-195">С одной стороны, можно задать hello одинаковым ключом секции для всех элементов, но это может ограничить масштабируемость hello решения.</span><span class="sxs-lookup"><span data-stu-id="a3388-195">At one extreme, you could set hello same partition key for all your items, but this may limit hello scalability of your solution.</span></span> <span data-ttu-id="a3388-196">В hello другой стороны, можно назначить ключа секции, уникальные для каждого элемента, который бы высокую степень масштабируемости, но не позволяют выполнить с помощью перекрестного документа транзакции через хранимые процедуры и триггеры.</span><span class="sxs-lookup"><span data-stu-id="a3388-196">At hello other extreme, you could assign a unique partition key for each item, which would be highly scalable but would prevent you from using cross document transactions via stored procedures and triggers.</span></span> <span data-ttu-id="a3388-197">Ключ раздела идеальной является одним, которые позволяют toouse эффективные запросы и имеет достаточно мощности tooensure масштабируемые решения.</span><span class="sxs-lookup"><span data-stu-id="a3388-197">An ideal partition key is one that enables you toouse efficient queries and that has sufficient cardinality tooensure your solution is scalable.</span></span> 
* <span data-ttu-id="a3388-198">**Нет узких мест хранения и производительности**: важно toopick свойство, позволяющее записывает toobe, распределенные по различным уникальных значений.</span><span class="sxs-lookup"><span data-stu-id="a3388-198">**No storage and performance bottlenecks**: It is important toopick a property that allows writes toobe distributed across various distinct values.</span></span> <span data-ttu-id="a3388-199">Запросы toohello же ключ секционирования не может превышать hello пропускная способность отдельной секции и подавлены.</span><span class="sxs-lookup"><span data-stu-id="a3388-199">Requests toohello same partition key cannot exceed hello throughput of a single partition, and are throttled.</span></span> <span data-ttu-id="a3388-200">В этом случае важно toopick ключа раздела, который не приводит к появлению «горячие точки» в приложении.</span><span class="sxs-lookup"><span data-stu-id="a3388-200">So it is important toopick a partition key that does not result in "hot spots" within your application.</span></span> <span data-ttu-id="a3388-201">Поскольку все данные hello для ключа одной секции должны храниться внутри секции, рекомендуется также tooavoid разделов, имеющих большие объемы данных для hello одинаковое значение.</span><span class="sxs-lookup"><span data-stu-id="a3388-201">Since all hello data for a single partition key must be stored within a partition, it is also recommended tooavoid partition keys that have high volumes of data for hello same value.</span></span> 

<span data-ttu-id="a3388-202">Давайте рассмотрим несколько реальных сценариев и подходящие ключи секции для каждого:</span><span class="sxs-lookup"><span data-stu-id="a3388-202">Let's look at a few real-world scenarios, and good partition keys for each:</span></span>
* <span data-ttu-id="a3388-203">При реализации серверной части профиля пользователя, идентификатор пользователя hello является хорошим выбором для ключа раздела.</span><span class="sxs-lookup"><span data-stu-id="a3388-203">If you’re implementing a user profile backend, then hello user ID is a good choice for partition key.</span></span>
* <span data-ttu-id="a3388-204">Если вы храните данные Интернета вещей, например состояние устройства, то в качестве ключа секции удобно выбрать идентификатор устройства.</span><span class="sxs-lookup"><span data-stu-id="a3388-204">If you’re storing IoT data for example, device state, a device ID is a good choice for partition key.</span></span>
* <span data-ttu-id="a3388-205">Если вы используете Azure Cosmos DB для ведения журнала данных временных рядов, затем hello имя узла или идентификатор процесса лучше всего подойдет для ключа раздела.</span><span class="sxs-lookup"><span data-stu-id="a3388-205">If you’re using Azure Cosmos DB for logging time-series data, then hello hostname or process ID is a good choice for partition key.</span></span>
* <span data-ttu-id="a3388-206">Если у вас есть мультитенантной архитектуре, ИД клиента hello лучше всего подойдет для ключа раздела.</span><span class="sxs-lookup"><span data-stu-id="a3388-206">If you have a multi-tenant architecture, hello tenant ID is a good choice for partition key.</span></span>

<span data-ttu-id="a3388-207">В некоторых случаях, таких как IoT и профили пользователей, hello ключ секции может быть использование Здравствуйте таким же, как ваш код (ключ документа).</span><span class="sxs-lookup"><span data-stu-id="a3388-207">In some use cases like IoT and user profiles, hello partition key might be hello same as your id (document key).</span></span> <span data-ttu-id="a3388-208">В других областях, например hello временного ряда данных может потребоваться ключа раздела, который отличается от идентификатора hello.</span><span class="sxs-lookup"><span data-stu-id="a3388-208">In others like hello time series data, you might have a partition key that’s different than hello id.</span></span>

### <a name="partitioning-and-loggingtime-series-data"></a><span data-ttu-id="a3388-209">Секционирование и ведение журнала (данные временных рядов)</span><span class="sxs-lookup"><span data-stu-id="a3388-209">Partitioning and logging/time-series data</span></span>
<span data-ttu-id="a3388-210">Одним из наиболее распространенных случаев использования hello объекта Cosmos DB предназначен для ведения журнала и телеметрии.</span><span class="sxs-lookup"><span data-stu-id="a3388-210">One of hello common use cases of Cosmos DB is for logging and telemetry.</span></span> <span data-ttu-id="a3388-211">Это важные toopick хорошим ключом раздела является, так как может потребоваться tooread и записи большие объемы данных.</span><span class="sxs-lookup"><span data-stu-id="a3388-211">It is important toopick a good partition key since you might need tooread/write vast volumes of data.</span></span> <span data-ttu-id="a3388-212">Выбор Hello зависит от того, на чтение и запись ставки и типов запросов, что предполагается, что toorun.</span><span class="sxs-lookup"><span data-stu-id="a3388-212">hello choice depends on your read and write rates and kinds of queries you expect toorun.</span></span> <span data-ttu-id="a3388-213">Ниже приведены некоторые советы о том, как toochoose хорошим ключом раздела.</span><span class="sxs-lookup"><span data-stu-id="a3388-213">Here are some tips on how toochoose a good partition key.</span></span>

* <span data-ttu-id="a3388-214">Если вашей включает небольшое количество записывает накоплении в течение длительного времени и необходимости tooquery по диапазонам отметки времени и другие фильтры с помощью сводных данных timestamp hello, например, даты как ключ секции, является хорошим решением.</span><span class="sxs-lookup"><span data-stu-id="a3388-214">If your use case involves a small rate of writes accumulating over a long period of time, and need tooquery by ranges of timestamps and other filters, then using a rollup of hello timestamp, for example,  date as a partition key is a good approach.</span></span> <span data-ttu-id="a3388-215">Это позволяет вам tooquery данными hello даты из одной секции.</span><span class="sxs-lookup"><span data-stu-id="a3388-215">This allows you tooquery over all hello data for a date from a single partition.</span></span> 
* <span data-ttu-id="a3388-216">Если, как это чаще бывает, рабочая нагрузка подразумевает большое число операций записи, следует использовать ключ секции, который не зависит от метки времени, чтобы база данных Cosmos DB могла выполнять равномерную запись в несколько секций.</span><span class="sxs-lookup"><span data-stu-id="a3388-216">If your workload is written heavy, which is more common, you should use a partition key that’s not based on timestamp so that Cosmos DB can distribute writes evenly across various partitions.</span></span> <span data-ttu-id="a3388-217">В этом случае хорошим выбором станет имя узла, идентификатор процесса, идентификатор действия или другое свойство с большим количеством элементов.</span><span class="sxs-lookup"><span data-stu-id="a3388-217">Here a hostname, process ID, activity ID, or another property with high cardinality is a good choice.</span></span> 
* <span data-ttu-id="a3388-218">Третий способ — это гибрид один где имеется несколько контейнеров, по одной на каждый месяц/день и ключ раздела hello детальные свойству как имя узла.</span><span class="sxs-lookup"><span data-stu-id="a3388-218">A third approach is a hybrid one where you have multiple containers, one for each day/month and hello partition key is a granular property like hostname.</span></span> <span data-ttu-id="a3388-219">Который можно задать разные пропускной способности основании hello временное окно преимущество hello, например, контейнер hello для hello текущего месяца, предоставляется более высокую пропускную способность, так как он выполняет операции чтения и записи, в то время как предыдущие месяцы с снизить пропускную способность с момента они могут использоваться только операции чтения.</span><span class="sxs-lookup"><span data-stu-id="a3388-219">This has hello benefit that you can set different throughput based on hello time window, for example, hello container for hello current month is provisioned with higher throughput since it serves reads and writes, whereas previous months with lower throughput since they only serve reads.</span></span>

### <a name="partitioning-and-multi-tenancy"></a><span data-ttu-id="a3388-220">Секционирование и мультитенантность</span><span class="sxs-lookup"><span data-stu-id="a3388-220">Partitioning and multi-tenancy</span></span>
<span data-ttu-id="a3388-221">При реализации мультитенантного приложения с помощью базы данных Cosmos DB существует два популярных шаблона — один ключ секции на клиент и один контейнер на клиент.</span><span class="sxs-lookup"><span data-stu-id="a3388-221">If you are implementing a multi-tenant application using Cosmos DB, there are two popular patterns – one partition key per tenant, and one container per tenant.</span></span> <span data-ttu-id="a3388-222">Ниже приведены hello преимуществ и недостатков каждого.</span><span class="sxs-lookup"><span data-stu-id="a3388-222">Here are hello pros and cons for each:</span></span>

* <span data-ttu-id="a3388-223">Один ключ секции на клиент: в этой модели клиенты совместно размещены в одном контейнере.</span><span class="sxs-lookup"><span data-stu-id="a3388-223">One Partition Key per tenant: In this model, tenants are collocated within a single container.</span></span> <span data-ttu-id="a3388-224">Однако запросы и операции вставки для элементов в рамках одного клиента можно выполнить с одной секцией.</span><span class="sxs-lookup"><span data-stu-id="a3388-224">But queries and inserts for items within a single tenant can be performed against a single partition.</span></span> <span data-ttu-id="a3388-225">Кроме того, можно реализовать логику транзакций для всех элементов в пределах клиента.</span><span class="sxs-lookup"><span data-stu-id="a3388-225">You can also implement transactional logic across all items within a tenant.</span></span> <span data-ttu-id="a3388-226">Так как несколько клиентов совместно используют один контейнер, можно сократить затраты на хранилище и пропускную способность, организовав пул ресурсов для клиентов в пределах одного контейнера, а не подготавливая дополнительный запас для каждого клиента.</span><span class="sxs-lookup"><span data-stu-id="a3388-226">Since multiple tenants share a container, you can save storage and throughput costs by pooling resources for tenants within a single container rather than provisioning extra headroom for each tenant.</span></span> <span data-ttu-id="a3388-227">Hello недостаток заключается в том, что у вас изоляцию производительности каждого клиента.</span><span class="sxs-lookup"><span data-stu-id="a3388-227">hello drawback is that you do not have performance isolation per tenant.</span></span> <span data-ttu-id="a3388-228">Повышает производительность и пропускную способность увеличивается vs целевые toohello всего контейнера применяются для клиентов.</span><span class="sxs-lookup"><span data-stu-id="a3388-228">Performance/throughput increases apply toohello entire container vs targeted increases for tenants.</span></span>
* <span data-ttu-id="a3388-229">Один контейнер на клиент: каждый клиент имеет собственный контейнер.</span><span class="sxs-lookup"><span data-stu-id="a3388-229">One Container per tenant: Each tenant has its own container.</span></span> <span data-ttu-id="a3388-230">В этой модели можно резервировать производительность для каждого клиента.</span><span class="sxs-lookup"><span data-stu-id="a3388-230">In this model, you can reserve performance per tenant.</span></span> <span data-ttu-id="a3388-231">Благодаря новой модели ценообразования на основе резервирования для базы данных Cosmos DB, эта модель является более экономичной для мультитенантных приложений с небольшим числом клиентов.</span><span class="sxs-lookup"><span data-stu-id="a3388-231">With Cosmos DB's new provisioning pricing model, this model is more cost-effective for multi-tenant applications with a few tenants.</span></span>

<span data-ttu-id="a3388-232">Также можно использовать сочетание/многоуровневого подход, который collocates небольших клиентов и переносит большего размера контейнера tootheir собственных клиентов.</span><span class="sxs-lookup"><span data-stu-id="a3388-232">You can also use a combination/tiered approach that collocates small tenants and migrates larger tenants tootheir own container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a3388-233">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a3388-233">Next steps</span></span>
<span data-ttu-id="a3388-234">В этой статье мы предоставили обзор концепций и рекомендации для секционирования с использованием любого API базы данных Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="a3388-234">In this article, we provided an overview for an overview of concepts and best practices for partitioning with any Azure Cosmos DB API.</span></span> 

* <span data-ttu-id="a3388-235">Дополнительные сведения о подготовленной пропускной способности в базе данных Azure Cosmos DB см. в [этой статье](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="a3388-235">Learn about [provisioned throughput in Azure Cosmos DB](request-units.md)</span></span>
* <span data-ttu-id="a3388-236">Узнайте больше о [глобальном распределении в базе данных Azure Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="a3388-236">Learn about [global distribution in Azure Cosmos DB](distribute-data-globally.md)</span></span>



