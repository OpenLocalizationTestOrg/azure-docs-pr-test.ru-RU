---
title: "Уровни согласованности в Azure Cosmos DB | Документация Майкрософт"
description: "В Azure Cosmos DB есть пять уровней согласованности, что позволяет сбалансировать компромиссы между согласованностью в конечном счете, доступностью и задержками."
keywords: "согласованность в конечном счете, azure cosmos db, azure, Microsoft Azure"
services: cosmos-db
author: mimig1
manager: jhubbard
editor: cgronlun
documentationcenter: 
ms.assetid: 3fe51cfa-a889-4a4a-b320-16bf871fe74c
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: mimig
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: a1ebec2285982c70aa9dc49950769fe18e2e2d0d
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="tunable-data-consistency-levels-in-azure-cosmos-db"></a><span data-ttu-id="5faca-104">Настраиваемые уровни согласованности данных в Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="5faca-104">Tunable data consistency levels in Azure Cosmos DB</span></span>
<span data-ttu-id="5faca-105">Служба Azure Cosmos DB была разработана "с нуля", при этом в ее основу заложены возможности глобального распространения данных для всех моделей данных.</span><span class="sxs-lookup"><span data-stu-id="5faca-105">Azure Cosmos DB is designed from the ground up with global distribution in mind for every data model.</span></span> <span data-ttu-id="5faca-106">Она предлагает гарантии прогнозируемой низкой задержки, соглашение об уровне обслуживания, обеспечивающее 99,99 % доступности, и нескольких четко определенных моделей нестрогой согласованности.</span><span class="sxs-lookup"><span data-stu-id="5faca-106">It is designed to offer predictable low latency guarantees, a 99.99% availability SLA, and multiple well-defined relaxed consistency models.</span></span> <span data-ttu-id="5faca-107">Сейчас Azure Cosmos DB поддерживает пять уровней согласованности: строгий, с ограниченным устареванием, уровня сеанса, согласованность префиксов и согласованный в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-107">Currently, Azure Cosmos DB provides five consistency levels: strong, bounded-staleness, session, consistent prefix, and eventual.</span></span> 

<span data-ttu-id="5faca-108">Помимо **строгой** модели и модели **согласованности в конечном счете**, обычно предусмотренных в распределенных базах данных, Azure Cosmos DB предлагает три тщательно кодифицированные и реализованные практически модели согласованности, эффективность которых была подтверждена реальными случаями использования.</span><span class="sxs-lookup"><span data-stu-id="5faca-108">Besides **strong** and **eventual consistency** models commonly offered by distributed databases, Azure Cosmos DB offers three more carefully codified and operationalized consistency models, and has validated their usefulness against real world use cases.</span></span> <span data-ttu-id="5faca-109">Эти уровни называются **согласованностью с ограниченным устареванием**, **согласованностью уровня сеанса** и **согласованностью префиксов**.</span><span class="sxs-lookup"><span data-stu-id="5faca-109">These are the **bounded staleness**, **session**, and **consistent prefix** consistency levels.</span></span> <span data-ttu-id="5faca-110">Все вместе эти пять уровней согласованности позволяют принимать обоснованные компромиссы между показателями согласованности, доступности и задержки.</span><span class="sxs-lookup"><span data-stu-id="5faca-110">Collectively these five consistency levels enable you to make well-reasoned trade-offs between consistency, availability, and latency.</span></span> 

## <a name="distributed-databases-and-consistency"></a><span data-ttu-id="5faca-111">Распределенные базы данных и согласованность</span><span class="sxs-lookup"><span data-stu-id="5faca-111">Distributed databases and consistency</span></span>
<span data-ttu-id="5faca-112">Коммерческие распределенные базы данных делятся на две категории: базы данных, которые вообще не предлагают точно определенные, проверяемые варианты согласованности, и базы данных, которые обеспечивают два радикальных варианта программирования (строгая и итоговая согласованность).</span><span class="sxs-lookup"><span data-stu-id="5faca-112">Commercial distributed databases fall into two categories: databases that do not offer well-defined, provable consistency choices at all, and databases which offer two extreme programmability choices (strong vs. eventual consistency).</span></span> 

<span data-ttu-id="5faca-113">Первый вариант обременяет разработчиков приложений деталями протоколов репликации и предполагает компромисс между согласованностью, доступностью, низкой задержкой и пропускной способностью.</span><span class="sxs-lookup"><span data-stu-id="5faca-113">The former burdens application developers with minutia of their replication protocols and expects them to make difficult tradeoffs between consistency, availability, latency, and throughput.</span></span> <span data-ttu-id="5faca-114">Второй заставляет выбирать одну из двух крайностей.</span><span class="sxs-lookup"><span data-stu-id="5faca-114">The latter puts a pressure to choose one of the two extremes.</span></span> <span data-ttu-id="5faca-115">Несмотря на множество исследований и более 50 предложенных моделей согласованности сообществу распределенных баз данных не удается вывести на рынок уровни согласованности, отличные от строгого и итогового.</span><span class="sxs-lookup"><span data-stu-id="5faca-115">Despite the abundance of research and proposals for more than 50 consistency models, the distributed database community has not been able to commercialize consistency levels beyond strong and eventual consistency.</span></span> <span data-ttu-id="5faca-116">Cosmos DB позволяет разработчикам выбрать одну из пяти точно определенных моделей согласованности разного уровня. Вы можете выбрать строгую согласованность, согласованность с ограниченным устареванием, [согласованность уровня сеанса](http://dl.acm.org/citation.cfm?id=383631), согласованность префиксов и согласованность в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-116">Cosmos DB allows developers to choose between five well-defined consistency models along the consistency spectrum – strong, bounded staleness, [session](http://dl.acm.org/citation.cfm?id=383631), consistent prefix, and eventual.</span></span> 

![Несколько четко определенных моделей согласованности (нестрогой) Azure Cosmos DB на ваш выбор](./media/consistency-levels/five-consistency-levels.png)

<span data-ttu-id="5faca-118">В следующей таблице представлены конкретные гарантии, предоставляемые на каждом уровне согласованности.</span><span class="sxs-lookup"><span data-stu-id="5faca-118">The following table illustrates the specific guarantees each consistency level provides.</span></span>
 
<span data-ttu-id="5faca-119">**Уровни согласованности и гарантии**</span><span class="sxs-lookup"><span data-stu-id="5faca-119">**Consistency Levels and guarantees**</span></span>

| <span data-ttu-id="5faca-120">Уровень согласованности</span><span class="sxs-lookup"><span data-stu-id="5faca-120">Consistency Level</span></span> | <span data-ttu-id="5faca-121">Гарантии</span><span class="sxs-lookup"><span data-stu-id="5faca-121">Guarantees</span></span> |
| --- | --- |
| <span data-ttu-id="5faca-122">Уровень согласованности Strong (сильная)</span><span class="sxs-lookup"><span data-stu-id="5faca-122">Strong</span></span> | <span data-ttu-id="5faca-123">Линеаризация</span><span class="sxs-lookup"><span data-stu-id="5faca-123">Linearizability</span></span> |
| <span data-ttu-id="5faca-124">Ограниченное устаревание</span><span class="sxs-lookup"><span data-stu-id="5faca-124">Bounded Staleness</span></span> | <span data-ttu-id="5faca-125">Согласованность префиксов.</span><span class="sxs-lookup"><span data-stu-id="5faca-125">Consistent Prefix.</span></span> <span data-ttu-id="5faca-126">Операции чтения могут отставать от операций записи не более чем на K префиксов или на интервал времени t.</span><span class="sxs-lookup"><span data-stu-id="5faca-126">Reads lag behind writes by k prefixes or t interval</span></span> |
| <span data-ttu-id="5faca-127">Сеанс</span><span class="sxs-lookup"><span data-stu-id="5faca-127">Session</span></span>   | <span data-ttu-id="5faca-128">Согласованность префиксов.</span><span class="sxs-lookup"><span data-stu-id="5faca-128">Consistent Prefix.</span></span> <span data-ttu-id="5faca-129">Монотонные операции чтения и записи, чтение собственных операций записи, запись после чтения.</span><span class="sxs-lookup"><span data-stu-id="5faca-129">Monotonic reads, monotonic writes, read-your-writes, write-follows-reads</span></span> |
| <span data-ttu-id="5faca-130">Согласованность префиксов</span><span class="sxs-lookup"><span data-stu-id="5faca-130">Consistent Prefix</span></span> | <span data-ttu-id="5faca-131">Обновления, которые возвращаются, содержат часть префиксов всех обновлений, без разрывов.</span><span class="sxs-lookup"><span data-stu-id="5faca-131">Updates returned are some prefix of all the updates, with no gaps</span></span> |
| <span data-ttu-id="5faca-132">Уровень согласованности Eventual (в конечном счете)</span><span class="sxs-lookup"><span data-stu-id="5faca-132">Eventual</span></span>  | <span data-ttu-id="5faca-133">Неупорядоченное чтение</span><span class="sxs-lookup"><span data-stu-id="5faca-133">Out of order reads</span></span> |

<span data-ttu-id="5faca-134">Для учетной записи Cosmos DB можно настроить уровень согласованности по умолчанию (и позже переопределить согласованность для определенного запроса на чтение).</span><span class="sxs-lookup"><span data-stu-id="5faca-134">You can configure the default consistency level on your Cosmos DB account (and later override the consistency on a specific read request).</span></span> <span data-ttu-id="5faca-135">На внутреннем уровне уровни согласованности по умолчанию применяются к данным в наборах секций, которые могут охватывать регионы.</span><span class="sxs-lookup"><span data-stu-id="5faca-135">Internally, the default consistency level applies to data within the partition sets which may span regions.</span></span> <span data-ttu-id="5faca-136">Около 73 % наших клиентов использует согласованность уровня сеанса, а 20 % предпочитают согласованность с ограниченным устареванием.</span><span class="sxs-lookup"><span data-stu-id="5faca-136">About 73% of our tenants use session consistency and 20% prefer bounded staleness.</span></span> <span data-ttu-id="5faca-137">Мы заметили, что примерно 3 % наших клиентов экспериментируют с различными уровнями согласованности, прежде чем устанавливать определенную согласованность для своего приложения.</span><span class="sxs-lookup"><span data-stu-id="5faca-137">We observe that approximately 3% of our customers experiment with various consistency levels initially before settling on a specific consistency choice for their application.</span></span> <span data-ttu-id="5faca-138">Мы также заметили, что всего 2 % наших клиентов переопределяет уровни согласованности для каждого запроса.</span><span class="sxs-lookup"><span data-stu-id="5faca-138">We also observe that only 2% of our tenants override consistency levels on a per request basis.</span></span> 

<span data-ttu-id="5faca-139">В Cosmos DB операции чтения, выполняемые с согласованностью уровня сеанса, согласованностью префиксов и согласованностью в конечном счете в два раза дешевле, чем операции чтения, выполняемые со строгой согласованностью или согласованностью с ограниченным устареванием.</span><span class="sxs-lookup"><span data-stu-id="5faca-139">In Cosmos DB, reads served at session, consistent prefix and eventual consistency are twice as cheap as reads with strong or bounded staleness consistency.</span></span> <span data-ttu-id="5faca-140">Cosmos DB обеспечивает лучшие в отрасли соглашения об уровне обслуживания (SLA) с доступностью на уровне 99,99 %, включая гарантии согласованности и доступности, высокий показатель пропускной способности и низкий уровень задержки.</span><span class="sxs-lookup"><span data-stu-id="5faca-140">Cosmos DB has industry leading comprehensive 99.99% SLAs including consistency guarantees along with availability, throughput, and latency.</span></span> <span data-ttu-id="5faca-141">Мы используем [проверку линеаризация](http://dl.acm.org/citation.cfm?id=1806634), которая постоянно анализирует телеметрию службы и открыто сообщает о любых нарушениях согласованности.</span><span class="sxs-lookup"><span data-stu-id="5faca-141">We employ a [linearizability checker](http://dl.acm.org/citation.cfm?id=1806634), which continuously operates over our service telemetry and openly reports any consistency violations to you.</span></span> <span data-ttu-id="5faca-142">При согласованности с ограниченным устареванием мы отслеживаем все нарушения ограничений k и t и сообщаем о них.</span><span class="sxs-lookup"><span data-stu-id="5faca-142">For bounded staleness, we monitor and report any violations to k and t bounds.</span></span> <span data-ttu-id="5faca-143">Для всех пяти уровней нестрогой согласованности мы также сообщаем вам напрямую [метрику вероятностного ограниченного устаревания](http://dl.acm.org/citation.cfm?id=2212359).</span><span class="sxs-lookup"><span data-stu-id="5faca-143">For all five relaxed consistency levels, we also report the [probabilistic bounded staleness metric](http://dl.acm.org/citation.cfm?id=2212359) directly to you.</span></span>  

## <a name="scope-of-consistency"></a><span data-ttu-id="5faca-144">Область действия согласованности</span><span class="sxs-lookup"><span data-stu-id="5faca-144">Scope of consistency</span></span>
<span data-ttu-id="5faca-145">Степень детализации согласованности ограничивается запросом одного пользователя.</span><span class="sxs-lookup"><span data-stu-id="5faca-145">The granularity of consistency is scoped to a single user request.</span></span> <span data-ttu-id="5faca-146">Запрос записи может соответствовать транзакции Insert, Replace, Upsert или Delete.</span><span class="sxs-lookup"><span data-stu-id="5faca-146">A write request may correspond to an insert, replace, upsert, or delete transaction.</span></span> <span data-ttu-id="5faca-147">Как и запись, транзакция чтения или запроса также ограничена одним запросом пользователя.</span><span class="sxs-lookup"><span data-stu-id="5faca-147">As with writes, a read/query transaction is also scoped to a single user request.</span></span> <span data-ttu-id="5faca-148">Пользователю может потребоваться разбить на страницы большой результирующий набор, охватывающий нескольких секций, но каждая транзакция чтения ограничена одной страницей и обслуживается в одной секции.</span><span class="sxs-lookup"><span data-stu-id="5faca-148">The user may be required to paginate over a large result-set, spanning multiple partitions, but each read transaction is scoped to a single page and served from within a single partition.</span></span>

## <a name="consistency-levels"></a><span data-ttu-id="5faca-149">Уровни согласованности</span><span class="sxs-lookup"><span data-stu-id="5faca-149">Consistency levels</span></span>
<span data-ttu-id="5faca-150">Вы можете настроить уровень согласованности по умолчанию для учетной записи базы данных, который будет распространяться на все коллекции (и базы данных) под вашей учетной записью Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5faca-150">You can configure a default consistency level on your database account that applies to all collections (and databases) under your Cosmos DB account.</span></span> <span data-ttu-id="5faca-151">По умолчанию все операции чтения и запросов к определенным пользователем ресурсам используют уровень согласованности по умолчанию, заданный в учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="5faca-151">By default, all reads and queries issued against the user-defined resources use the default consistency level specified on the database account.</span></span> <span data-ttu-id="5faca-152">Можно снизить уровень согласованности конкретного запроса (на чтение или операцию) в каждом из поддерживаемых интерфейсов API.</span><span class="sxs-lookup"><span data-stu-id="5faca-152">You can relax the consistency level of a specific read/query request using in each of the supported APIs.</span></span> <span data-ttu-id="5faca-153">Существует пять типов уровней согласованности, поддерживаемых протоколом репликации Azure Cosmos DB, которые обеспечивают четкий компромисс между определенными гарантиями целостности и производительности, как описано в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="5faca-153">There are five types of consistency levels supported by the Azure Cosmos DB replication protocol that provide a clear trade-off between specific consistency guarantees and performance, as described in this section.</span></span>

<span data-ttu-id="5faca-154">**Уровень согласованности Strong (сильная)**:</span><span class="sxs-lookup"><span data-stu-id="5faca-154">**Strong**:</span></span> 

* <span data-ttu-id="5faca-155">Строгая согласованность предлагает гарантию [линеаризации](https://aphyr.com/posts/313-strong-consistency-models), обеспечивающую возвращение самой последней версии элемента операциями чтения.</span><span class="sxs-lookup"><span data-stu-id="5faca-155">Strong consistency offers a [linearizability](https://aphyr.com/posts/313-strong-consistency-models) guarantee with the reads guaranteed to return the most recent version of an item.</span></span> 
* <span data-ttu-id="5faca-156">Сильный уровень согласованности гарантирует, что операция записи отображается только после ее завершения большинством необходимого набора реплик.</span><span class="sxs-lookup"><span data-stu-id="5faca-156">Strong consistency guarantees that a write is only visible after it is committed durably by the majority quorum of replicas.</span></span> <span data-ttu-id="5faca-157">Операция записи либо синхронно фиксируется первичной репликой и кворумом вторичных реплик, либо прерывается.</span><span class="sxs-lookup"><span data-stu-id="5faca-157">A write is either synchronously committed durably by both the primary and the quorum of secondaries, or it is aborted.</span></span> <span data-ttu-id="5faca-158">Операция чтения всегда признается большинством кворума чтения, клиент никогда не сможет увидеть незафиксированную или частичную запись и всегда гарантированно считает последние подтвержденные записанные данные.</span><span class="sxs-lookup"><span data-stu-id="5faca-158">A read is always acknowledged by the majority read quorum, a client can never see an uncommitted or partial write and is always guaranteed to read the latest acknowledged write.</span></span> 
* <span data-ttu-id="5faca-159">Учетную запись Azure Cosmos DB, настроенную для использования строгой согласованности, нельзя связать более чем с одним регионом Azure.</span><span class="sxs-lookup"><span data-stu-id="5faca-159">Azure Cosmos DB accounts that are configured to use strong consistency cannot associate more than one Azure region with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="5faca-160">Затраты на операцию чтения (в используемых [единицах запроса](request-units.md) ) при строгой согласованности выше, чем при согласованности уровня сеанса и согласованности в конечном счете, но не отличаются от затрат при согласованности с ограниченным устареванием.</span><span class="sxs-lookup"><span data-stu-id="5faca-160">The cost of a read operation (in terms of [request units](request-units.md) consumed) with strong consistency is higher than session and eventual, but the same as bounded staleness.</span></span>

<span data-ttu-id="5faca-161">**Ограниченное устаревание**</span><span class="sxs-lookup"><span data-stu-id="5faca-161">**Bounded staleness**:</span></span> 

* <span data-ttu-id="5faca-162">Согласованность с ограниченным устареванием гарантирует, что операции чтения могут отставать от записи не более чем на *K* версий или префиксов элемента или на интервал времени *t*.</span><span class="sxs-lookup"><span data-stu-id="5faca-162">Bounded staleness consistency guarantees that the reads may lag behind writes by at most *K* versions or prefixes of an item or *t* time-interval.</span></span> 
* <span data-ttu-id="5faca-163">Следовательно, при выборе ограниченного устаревания это самое "устаревание" можно настроить двумя способами: указать количество *K* версий элемента, на которое операции чтения могут отставать от операций записи, и интервал времени *t*.</span><span class="sxs-lookup"><span data-stu-id="5faca-163">Therefore, when choosing bounded staleness, the "staleness" can be configured in two ways: number of versions *K* of the item by which the reads lag behind the writes, and the time interval *t*</span></span> 
* <span data-ttu-id="5faca-164">Согласованность с ограниченным устареванием обеспечивает общий глобальный порядок в пределах "окна устаревания".</span><span class="sxs-lookup"><span data-stu-id="5faca-164">Bounded staleness offers total global order except within the "staleness window."</span></span> <span data-ttu-id="5faca-165">Гарантии монотонных операций чтения в регионе существуют как в пределах "окна устаревания", так и вне его.</span><span class="sxs-lookup"><span data-stu-id="5faca-165">The monotonic read guarantees exists within a region both inside and outside the "staleness window."</span></span> 
* <span data-ttu-id="5faca-166">Модель ограниченного устаревания обеспечивает более надежную гарантию согласованности, чем согласованность уровня сеанса и согласованность в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-166">Bounded staleness provides a stronger consistency guarantee than session or eventual consistency.</span></span> <span data-ttu-id="5faca-167">Для глобально распределенных приложений мы рекомендуем использовать ограниченное устаревание в ситуациях, где требуется строгая согласованность, но при этом необходима доступность порядка 99,99 % и низкая задержка.</span><span class="sxs-lookup"><span data-stu-id="5faca-167">For globally distributed applications, we recommend you use bounded staleness for scenarios where you would like to have strong consistency but also want 99.99% availability and low latency.</span></span> 
* <span data-ttu-id="5faca-168">С учетными записями Azure Cosmos DB, для которых настроена согласованность с ограниченным устареванием, можно связать любое количество регионов Azure.</span><span class="sxs-lookup"><span data-stu-id="5faca-168">Azure Cosmos DB accounts that are configured with bounded staleness consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="5faca-169">Затраты на операцию чтения (в используемых единицах запроса) с ограниченным устареванием выше, чем при согласованности уровня сеанса и согласованности в конечном счете, но не отличаются от затрат при строгой согласованности.</span><span class="sxs-lookup"><span data-stu-id="5faca-169">The cost of a read operation (in terms of RUs consumed) with bounded staleness is higher than session and eventual consistency, but the same as strong consistency.</span></span>

<span data-ttu-id="5faca-170">**Уровень согласованности Session (сеанс)**:</span><span class="sxs-lookup"><span data-stu-id="5faca-170">**Session**:</span></span> 

* <span data-ttu-id="5faca-171">В отличие от глобальных моделей согласованности, предлагаемых уровнями строгой согласованности и согласованности с ограниченным устареванием, согласованность уровня сеанса ограничена сеансом клиента.</span><span class="sxs-lookup"><span data-stu-id="5faca-171">Unlike the global consistency models offered by strong and bounded staleness consistency levels, session consistency is scoped to a client session.</span></span> 
* <span data-ttu-id="5faca-172">Согласованность уровня сеанса идеально подходит для всех сценариев, включающих в себя сеанс устройства или пользователя, так как она гарантирует монотонное чтение и монотонную запись, а также гарантирует чтение собственных записей (RYW).</span><span class="sxs-lookup"><span data-stu-id="5faca-172">Session consistency is ideal for all scenarios where a device or user session is involved since it guarantees monotonic reads, monotonic writes, and read your own writes (RYW) guarantees.</span></span> 
* <span data-ttu-id="5faca-173">Согласованность уровня сеанса обеспечивает предсказуемую согласованность для сеанса и максимальную пропускную способность, предлагая самые низкие задержки при записи и чтении.</span><span class="sxs-lookup"><span data-stu-id="5faca-173">Session consistency provides predictable consistency for a session, and maximum read throughput while offering the lowest latency writes and reads.</span></span> 
* <span data-ttu-id="5faca-174">С учетными записями Azure Cosmos DB, для которых настроена согласованность уровня сеанса, можно связать любое количество регионов Azure.</span><span class="sxs-lookup"><span data-stu-id="5faca-174">Azure Cosmos DB accounts that are configured with session consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="5faca-175">Затраты на операцию чтения (в используемых единицах запроса) для модели согласованности уровня сеанса меньше, чем для строгой согласованности или согласованности с ограниченным устареванием, но больше, чем для согласованности в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-175">The cost of a read operation (in terms of RUs consumed) with session consistency level is less than strong and bounded staleness, but more than eventual consistency</span></span>

<span data-ttu-id="5faca-176"><a id="consistent-prefix"></a>
**Согласованность префиксов**:</span><span class="sxs-lookup"><span data-stu-id="5faca-176"><a id="consistent-prefix"></a>
**Consistent Prefix**:</span></span> 

* <span data-ttu-id="5faca-177">Согласованность префиксов гарантирует, что в отсутствие каких-либо последующих операций записи реплики в группе в конечном счете сходятся.</span><span class="sxs-lookup"><span data-stu-id="5faca-177">Consistent prefix guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span> 
* <span data-ttu-id="5faca-178">Согласованность префиксов гарантирует, что операции чтения никогда не столкнутся с неупорядоченными операциями записи.</span><span class="sxs-lookup"><span data-stu-id="5faca-178">Consistent prefix guarantees that reads never see out of order writes.</span></span> <span data-ttu-id="5faca-179">Если операции записи выполнялись в порядке `A, B, C`, то клиент видит `A`, `A,B` или `A,B,C`, но никогда не видит неупорядоченные операции `A,C` или `B,A,C`.</span><span class="sxs-lookup"><span data-stu-id="5faca-179">If writes were performed in the order `A, B, C`, then a client sees either `A`, `A,B`, or `A,B,C`, but never out of order like `A,C` or `B,A,C`.</span></span>
* <span data-ttu-id="5faca-180">С учетными записями Azure Cosmos DB, для которых настроена согласованность префиксов, можно связать любое количество регионов Azure.</span><span class="sxs-lookup"><span data-stu-id="5faca-180">Azure Cosmos DB accounts that are configured with consistent prefix consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 

<span data-ttu-id="5faca-181">**Уровень согласованности Eventual (в конечном счете)**:</span><span class="sxs-lookup"><span data-stu-id="5faca-181">**Eventual**:</span></span> 

* <span data-ttu-id="5faca-182">Согласованность в конечном счете гарантирует, что в отсутствие каких-либо последующих операций записи реплики в группе в конечном счете сходятся.</span><span class="sxs-lookup"><span data-stu-id="5faca-182">Eventual consistency guarantees that in absence of any further writes, the replicas within the group eventually converge.</span></span> 
* <span data-ttu-id="5faca-183">Согласованность в конечном счете является самой нестрогой формой согласованности, при которой клиент может получить значения, которые являются более старыми по отношению к полученным ранее.</span><span class="sxs-lookup"><span data-stu-id="5faca-183">Eventual consistency is the weakest form of consistency where a client may get the values that are older than the ones it had seen before.</span></span>
* <span data-ttu-id="5faca-184">Согласованность «в конечном счете» оказывается самой слабо связанной согласованностью чтения, но предлагает наименьшую задержку как для чтения, так и для записи.</span><span class="sxs-lookup"><span data-stu-id="5faca-184">Eventual consistency provides the weakest read consistency but offers the lowest latency for both reads and writes.</span></span>
* <span data-ttu-id="5faca-185">С учетными записями Azure Cosmos DB, для которых настроена согласованность в конечном счете, можно связать любое количество регионов Azure.</span><span class="sxs-lookup"><span data-stu-id="5faca-185">Azure Cosmos DB accounts that are configured with eventual consistency can associate any number of Azure regions with their Azure Cosmos DB account.</span></span> 
* <span data-ttu-id="5faca-186">Затраты на операцию чтения (в используемых единицах запроса) для уровня согласованности в конечном счете являются самыми низкими среди уровней согласованности Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5faca-186">The cost of a read operation (in terms of RUs consumed) with the eventual consistency level is the lowest of all the Azure Cosmos DB consistency levels.</span></span>

## <a name="configuring-the-default-consistency-level"></a><span data-ttu-id="5faca-187">Настройка уровня согласованности по умолчанию</span><span class="sxs-lookup"><span data-stu-id="5faca-187">Configuring the default consistency level</span></span>
1. <span data-ttu-id="5faca-188">На навигационной панели [портала Azure](https://portal.azure.com/) щелкните **Azure Cosmos DB**.</span><span class="sxs-lookup"><span data-stu-id="5faca-188">In the [Azure portal](https://portal.azure.com/), in the Jumpbar, click **Azure Cosmos DB**.</span></span>
2. <span data-ttu-id="5faca-189">В колонке **Azure Cosmos DB** выберите учетную запись базы данных, которую нужно изменить.</span><span class="sxs-lookup"><span data-stu-id="5faca-189">In the **Azure Cosmos DB** blade, select the database account to modify.</span></span>
3. <span data-ttu-id="5faca-190">В колонке учетной записи щелкните **Согласованность по умолчанию**.</span><span class="sxs-lookup"><span data-stu-id="5faca-190">In the account blade, click **Default consistency**.</span></span>
4. <span data-ttu-id="5faca-191">В колонке **Согласованность по умолчанию** выберите новый уровень согласованности и щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="5faca-191">In the **Default Consistency** blade, select the new consistency level and click **Save**.</span></span>
   
    ![Снимок экрана, на котором показан значок "Параметры" и запись "Согласованность по умолчанию"](./media/consistency-levels/database-consistency-level-1.png)

## <a name="consistency-levels-for-queries"></a><span data-ttu-id="5faca-193">Уровни согласованности для запросов</span><span class="sxs-lookup"><span data-stu-id="5faca-193">Consistency levels for queries</span></span>
<span data-ttu-id="5faca-194">По умолчанию для определенных пользователем ресурсов уровень согласованности запросов совпадает с уровнем согласованности операций чтения.</span><span class="sxs-lookup"><span data-stu-id="5faca-194">By default, for user-defined resources, the consistency level for queries is the same as the consistency level for reads.</span></span> <span data-ttu-id="5faca-195">По умолчанию, индекс обновляется синхронно при каждой операции вставки, замены или удаления элемента в контейнере Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="5faca-195">By default, the index is updated synchronously on each insert, replace, or delete of an item to the Cosmos DB container.</span></span> <span data-ttu-id="5faca-196">Это позволяет выполнять запросы с уровнем согласованности, как и в операциях чтения.</span><span class="sxs-lookup"><span data-stu-id="5faca-196">This enables the queries to honor the same consistency level as that of point reads.</span></span> <span data-ttu-id="5faca-197">В то время как служба Azure Cosmos DB оптимизирована для операций записи и поддерживает устойчивые объемы операций записи, синхронное обслуживание индекса и обслуживание согласованных запросов, вы можете настроить определенные коллекции для отложенного обновления их ​​индексов.</span><span class="sxs-lookup"><span data-stu-id="5faca-197">While Azure Cosmos DB is write optimized and supports sustained volumes of writes, synchronous index maintenance and serving consistent queries, you can configure certain collections to update their index lazily.</span></span> <span data-ttu-id="5faca-198">Отложенное индексирование еще больше повышает производительность операций записи и идеально подходит для сценариев пакетной вставки, прежде всего для чтения больших объемов данных.</span><span class="sxs-lookup"><span data-stu-id="5faca-198">Lazy indexing further boosts the write performance and is ideal for bulk ingestion scenarios when a workload is primarily read-heavy.</span></span>  

| <span data-ttu-id="5faca-199">Режим индексирования</span><span class="sxs-lookup"><span data-stu-id="5faca-199">Indexing Mode</span></span> | <span data-ttu-id="5faca-200">Операции чтения</span><span class="sxs-lookup"><span data-stu-id="5faca-200">Reads</span></span> | <span data-ttu-id="5faca-201">Запросы</span><span class="sxs-lookup"><span data-stu-id="5faca-201">Queries</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5faca-202">Режим согласованности (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="5faca-202">Consistent (default)</span></span> |<span data-ttu-id="5faca-203">Можно выбрать строгую согласованность, согласованность с ограниченным устареванием, согласованность уровня сеанса, согласованность префиксов или согласованность в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-203">Select from strong, bounded staleness, session, consistent prefix, or eventual</span></span> |<span data-ttu-id="5faca-204">Можно выбрать строгую согласованность, согласованность с ограниченным устареванием, согласованность уровня сеанса и согласованность в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-204">Select from strong, bounded staleness, session, or eventual</span></span> |
| <span data-ttu-id="5faca-205">Отложенная</span><span class="sxs-lookup"><span data-stu-id="5faca-205">Lazy</span></span> |<span data-ttu-id="5faca-206">Можно выбрать строгую согласованность, согласованность с ограниченным устареванием, согласованность уровня сеанса, согласованность префиксов или согласованность в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-206">Select from strong, bounded staleness, session, consistent prefix, or eventual</span></span> |<span data-ttu-id="5faca-207">Уровень согласованности Eventual (в конечном счете)</span><span class="sxs-lookup"><span data-stu-id="5faca-207">Eventual</span></span> |
| <span data-ttu-id="5faca-208">None</span><span class="sxs-lookup"><span data-stu-id="5faca-208">None</span></span> |<span data-ttu-id="5faca-209">Можно выбрать строгую согласованность, согласованность с ограниченным устареванием, согласованность уровня сеанса, согласованность префиксов или согласованность в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-209">Select from strong, bounded staleness, session, consistent prefix, or eventual</span></span> |<span data-ttu-id="5faca-210">Не применяется</span><span class="sxs-lookup"><span data-stu-id="5faca-210">Not applicable</span></span> |

<span data-ttu-id="5faca-211">Как и для запросов на чтение, можно снизить уровень согласованности конкретного запроса в каждом API.</span><span class="sxs-lookup"><span data-stu-id="5faca-211">As with read requests, you can lower the consistency level of a specific query request in each API.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5faca-212">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="5faca-212">Next steps</span></span>
<span data-ttu-id="5faca-213">Если вы хотите получить дополнительные сведения об уровнях согласованности и компромиссах, рекомендуем ознакомиться со следующими ресурсами:</span><span class="sxs-lookup"><span data-stu-id="5faca-213">If you'd like to do more reading about consistency levels and tradeoffs, we recommend the following resources:</span></span>

* <span data-ttu-id="5faca-214">Даг Терри.</span><span class="sxs-lookup"><span data-stu-id="5faca-214">Doug Terry.</span></span> <span data-ttu-id="5faca-215">Объяснение согласованности при репликации данных на примере бейсбола (видео).</span><span class="sxs-lookup"><span data-stu-id="5faca-215">Replicated Data Consistency explained through baseball (video).</span></span>   
  [<span data-ttu-id="5faca-216">https://www.youtube.com/watch?v=gluIh8zd26I</span><span class="sxs-lookup"><span data-stu-id="5faca-216">https://www.youtube.com/watch?v=gluIh8zd26I</span></span>](https://www.youtube.com/watch?v=gluIh8zd26I)
* <span data-ttu-id="5faca-217">Даг Терри.</span><span class="sxs-lookup"><span data-stu-id="5faca-217">Doug Terry.</span></span> <span data-ttu-id="5faca-218">Объяснение согласованности при репликации данных на примере игры в бейсбол (Replicated Data Consistency explained through baseball).</span><span class="sxs-lookup"><span data-stu-id="5faca-218">Replicated Data Consistency explained through baseball.</span></span>   
  [<span data-ttu-id="5faca-219">http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf</span><span class="sxs-lookup"><span data-stu-id="5faca-219">http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf</span></span>](http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf)
* <span data-ttu-id="5faca-220">Даг Терри.</span><span class="sxs-lookup"><span data-stu-id="5faca-220">Doug Terry.</span></span> <span data-ttu-id="5faca-221">Гарантии на уровне сеанса для репликации слабо согласованных данных.</span><span class="sxs-lookup"><span data-stu-id="5faca-221">Session Guarantees for Weakly Consistent Replicated Data.</span></span>   
  [<span data-ttu-id="5faca-222">http://dl.acm.org/citation.cfm?id=383631</span><span class="sxs-lookup"><span data-stu-id="5faca-222">http://dl.acm.org/citation.cfm?id=383631</span></span>](http://dl.acm.org/citation.cfm?id=383631)
* <span data-ttu-id="5faca-223">Дэниэл Абади.</span><span class="sxs-lookup"><span data-stu-id="5faca-223">Daniel Abadi.</span></span> <span data-ttu-id="5faca-224">Компромиссы согласованности в современных распределенных системах проектирования баз данных: распределенных: ограничением является частью статьи: теорема CAP — это только начало...".</span><span class="sxs-lookup"><span data-stu-id="5faca-224">Consistency Tradeoffs in Modern Distributed Database Systems Design: CAP is only part of the story”.</span></span>   
  [<span data-ttu-id="5faca-225">http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html</span><span class="sxs-lookup"><span data-stu-id="5faca-225">http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html</span></span>](http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html)
* <span data-ttu-id="5faca-226">Питер Бейлис, Шиварам Венкатараман, Майкл Дж. Франклин, Джозеф М. Хеллерштейн, Ион Стойка (Peter Bailis, Shivaram Venkataraman, Michael J. Franklin, Joseph M. Hellerstein, Ion Stoica).</span><span class="sxs-lookup"><span data-stu-id="5faca-226">Peter Bailis, Shivaram Venkataraman, Michael J. Franklin, Joseph M. Hellerstein, Ion Stoica.</span></span> <span data-ttu-id="5faca-227">Вероятностное ограниченное запаздывание (PBS) для практических неполных кворумов.</span><span class="sxs-lookup"><span data-stu-id="5faca-227">Probabilistic Bounded Staleness (PBS) for Practical Partial Quorums.</span></span>   
  [<span data-ttu-id="5faca-228">http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf</span><span class="sxs-lookup"><span data-stu-id="5faca-228">http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf</span></span>](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)
* <span data-ttu-id="5faca-229">Вернер Вогелс.</span><span class="sxs-lookup"><span data-stu-id="5faca-229">Werner Vogels.</span></span> <span data-ttu-id="5faca-230">Возвращаясь к вопросу о согласованности в конечном счете.</span><span class="sxs-lookup"><span data-stu-id="5faca-230">Eventual Consistent - Revisited.</span></span>    
  [<span data-ttu-id="5faca-231">http://allthingsdistributed.com/2008/12/eventually_consistent.html</span><span class="sxs-lookup"><span data-stu-id="5faca-231">http://allthingsdistributed.com/2008/12/eventually_consistent.html</span></span>](http://allthingsdistributed.com/2008/12/eventually_consistent.html)
* <span data-ttu-id="5faca-232">Мони Наор, Авишаи Вул (Moni Naor, Avishai Wool). Статья "The Load, Capacity, and Availability of Quorum Systems" (Нагрузка, емкость и доступность в кворумных системах) в журнале SIAM Journal on Computing, том 27, выпуск 2, стр. 423-447, апрель 1998 г.</span><span class="sxs-lookup"><span data-stu-id="5faca-232">Moni Naor , Avishai Wool, The Load, Capacity, and Availability of Quorum Systems, SIAM Journal on Computing, v.27 n.2, p.423-447, April 1998.</span></span>
  [<span data-ttu-id="5faca-233">http://epubs.siam.org/doi/abs/10.1137/S0097539795281232</span><span class="sxs-lookup"><span data-stu-id="5faca-233">http://epubs.siam.org/doi/abs/10.1137/S0097539795281232</span></span>](http://epubs.siam.org/doi/abs/10.1137/S0097539795281232)
* <span data-ttu-id="5faca-234">Себастьян Буркхардт, Крис Дерн, Маканал Мусувати, Рой Тан (Sebastian Burckhardt, Chris Dern, Macanal Musuvathi, Roy Tan). "Line-up: a complete and automatic linearizability checker" (Line-up: полная автоматическая проверка линеаризации). Тезисы конференции 2010 ACM SIGPLAN по проектированию и реализации языков программирования, 5-10 июня 2010 г., г. Торонто, штат Онтарио, Канада [doi>10.1145/1806596.1806634] [http://dl.acm.org/citation.cfm?id=1806634](http://dl.acm.org/citation.cfm?id=1806634)</span><span class="sxs-lookup"><span data-stu-id="5faca-234">Sebastian Burckhardt, Chris Dern, Macanal Musuvathi, Roy Tan, Line-up: a complete and automatic linearizability checker, Proceedings of the 2010 ACM SIGPLAN conference on Programming language design and implementation, June 05-10, 2010, Toronto, Ontario, Canada  [doi>10.1145/1806596.1806634] [http://dl.acm.org/citation.cfm?id=1806634](http://dl.acm.org/citation.cfm?id=1806634)</span></span>
* <span data-ttu-id="5faca-235">Питер Бейлис, Шиварам Венкатараман, Майкл Дж. Франклин, Джозеф М. Хеллерштейн, Ион Стойка (Peter Bailis, Shivaram Venkataraman, Michael J. Franklin, Joseph M. Hellerstein, Ion Stoica). "Probabilistically bounded staleness for practical partial quorums" (Вероятностное ограниченное устаревание для практических неполных кворумов). Тезисы конференции VLDB Endowment, том 5, выпуск 8, стр. 776-787, апрель 2012 г. [http://dl.acm.org/citation.cfm?id=2212359](http://dl.acm.org/citation.cfm?id=2212359)</span><span class="sxs-lookup"><span data-stu-id="5faca-235">Peter Bailis, Shivaram Venkataraman, Michael J. Franklin, Joseph M. Hellerstein , Ion Stoica, Probabilistically bounded staleness for practical partial quorums, Proceedings of the VLDB Endowment, v.5 n.8, p.776-787, April 2012 [http://dl.acm.org/citation.cfm?id=2212359](http://dl.acm.org/citation.cfm?id=2212359)</span></span>
