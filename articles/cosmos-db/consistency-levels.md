---
title: "уровни aaaConsistency в базе данных Azure Cosmos | Документы Microsoft"
description: "Azure Cosmos DB имеет пять согласованности уровни toohelp баланс окончательной согласованности, доступность и задержки компромиссы."
keywords: "согласованность в конечном счете, azure cosmos db, azure, Microsoft Azure"
services: cosmos-db
author: mimig1
manager: jhubbard
editor: cgronlun
documentationcenter: 
ms.assetid: 3fe51cfa-a889-4a4a-b320-16bf871fe74c
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: mimig
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: ac399c229d0856cd811bc81568536e519af3300f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="tunable-data-consistency-levels-in-azure-cosmos-db"></a>Настраиваемые уровни согласованности данных в Azure Cosmos DB
Azure Cosmos DB предназначен из hello основание, глобальные распространения с точки зрения каждая модель данных. Это гарантирует прогнозируемый низкой задержкой спроектированный toooffer, 99,99% доступности соглашения об уровне ОБСЛУЖИВАНИЯ, и нескольких четко определенных ослаблены согласованности моделей. Сейчас Azure Cosmos DB поддерживает пять уровней согласованности: строгий, с ограниченным устареванием, уровня сеанса, согласованность префиксов и согласованный в конечном счете. 

Помимо **строгой** модели и модели **согласованности в конечном счете**, обычно предусмотренных в распределенных базах данных, Azure Cosmos DB предлагает три тщательно кодифицированные и реализованные практически модели согласованности, эффективность которых была подтверждена реальными случаями использования. Это hello **ограниченных устаревание**, **сеанса**, и **согласованное префикс** уровни согласованности. Вместе эти уровни согласованности пять включить toomake хорошо зрения компромиссы между согласованности, доступность и задержки. 

## <a name="distributed-databases-and-consistency"></a>Распределенные базы данных и согласованность
Коммерческие распределенные базы данных делятся на две категории: базы данных, которые вообще не предлагают точно определенные, проверяемые варианты согласованности, и базы данных, которые обеспечивают два радикальных варианта программирования (строгая и итоговая согласованность). 

Здравствуйте бывшая работы разработчиков приложений с детали их протоколов репликации и ожидает их toomake трудно компромисса между согласованности, доступность, задержка и пропускная способность. последний Hello помещает toochoose давление, один из крайними hello. Несмотря на множество hello исследования и предложения для более чем 50 согласованности моделей hello сообщества распределенной базы данных не было возможности toocommercialize уровни согласованности за надежный и окончательной согласованности. Cosmos DB позволяет разработчикам toochoose между пять моделей четко определенных согласованности вдоль спектра согласованности hello — надежный, ограниченных устаревание, [сеанса](http://dl.acm.org/citation.cfm?id=383631), согласованных префикс и окончательным. 

![Azure Cosmos DB предлагает несколько, хорошо определенные (ослабленной) согласованности toochoose моделей из](./media/consistency-levels/five-consistency-levels.png)

Hello в следующей таблице показано hello определенной гарантии, которые предоставляет каждый уровень согласованности.
 
**Уровни согласованности и гарантии**

| Уровень согласованности | Гарантии |
| --- | --- |
| Уровень согласованности Strong (сильная) | Линеаризация |
| Ограниченное устаревание | Согласованность префиксов. Операции чтения могут отставать от операций записи не более чем на K префиксов или на интервал времени t. |
| Сеанс   | Согласованность префиксов. Монотонные операции чтения и записи, чтение собственных операций записи, запись после чтения. |
| Согласованность префиксов | Обновления, возвращаются, некоторые префикс для всех обновлений hello с без промежутков |
| Уровень согласованности Eventual (в конечном счете)  | Неупорядоченное чтение |

Можно настроить уровень согласованности по умолчанию hello в вашей учетной записи Cosmos DB (и позже переопределение согласованности hello на конкретный запрос чтения). На внутреннем уровне уровень согласованности по умолчанию hello применяется toodata внутри hello наборы разделов, которые могут охватывать несколько регионов. Около 73 % наших клиентов использует согласованность уровня сеанса, а 20 % предпочитают согласованность с ограниченным устареванием. Мы заметили, что примерно 3 % наших клиентов экспериментируют с различными уровнями согласованности, прежде чем устанавливать определенную согласованность для своего приложения. Мы также заметили, что всего 2 % наших клиентов переопределяет уровни согласованности для каждого запроса. 

В Cosmos DB операции чтения, выполняемые с согласованностью уровня сеанса, согласованностью префиксов и согласованностью в конечном счете в два раза дешевле, чем операции чтения, выполняемые со строгой согласованностью или согласованностью с ограниченным устареванием. Cosmos DB обеспечивает лучшие в отрасли соглашения об уровне обслуживания (SLA) с доступностью на уровне 99,99 %, включая гарантии согласованности и доступности, высокий показатель пропускной способности и низкий уровень задержки. Мы [linearizability проверки](http://dl.acm.org/citation.cfm?id=1806634), который постоянно работает над нашей службы телеметрии и открыто сообщает любой tooyou нарушений целостности. Для ограниченного устаревание мы мониторинг и создание отчетов, как было нарушения и t границы. Для всех пяти уровней ослабленной согласованности мы отчетов hello [вероятностный ограниченным устареванием метрика](http://dl.acm.org/citation.cfm?id=2212359) tooyou напрямую.  

## <a name="scope-of-consistency"></a>Область действия согласованности
Гранулярность Hello согласованности — запрос с областью tooa одного пользователя. Запрос записи может соответствуют tooan вставки, замены, вставки-обновления или удаления транзакции. С помощью записи и чтения или запрос транзакция также — запрос одного пользователя с областью tooa. Hello пользователя может быть обязательным toopaginate большой результирующий набор, объединение нескольких секций, но каждое чтение транзакция с областью tooa одной страницы и предоставляемого в одной секции.

## <a name="consistency-levels"></a>Уровни согласованности
Можно настроить уровень согласованности по умолчанию в вашей учетной записи базы данных, применяющий tooall коллекций (и базы данных) в рамках учетной записи Cosmos DB. По умолчанию все операции чтения и запросах, посылаемых к hello пользовательских ресурсов, используйте заданный hello учетной записи базы данных уровень согласованности по умолчанию hello. Могут опускать уровень согласованности hello определенного запроса или чтение запроса, использование в каждом hello поддерживается API-интерфейсы. Существует пять типов уровни согласованности, поддерживаемые протоколом репликации hello Azure Cosmos DB, предоставляющие очистить компромисса между гарантии конкретных согласованности и производительности, как описано в этом разделе.

**Уровень согласованности Strong (сильная)**: 

* Строгая согласованность предлагает [linearizability](https://aphyr.com/posts/313-strong-consistency-models) гарантии с hello считывает гарантированную tooreturn hello самой последней версии элемента. 
* Надежная согласованность гарантирует, что записи будет видна только после надежной фиксации по кворума большинства hello реплик. Запись либо синхронно надежной фиксации первичной hello и hello кворум баз данных-получателей, или он будет прерван. Чтение всегда подтверждается чтения кворума большинства hello, клиент никогда не увидите незафиксированных или часть записи и гарантированно tooread hello последнего подтвержденного записи. 
* Azure Cosmos DB учетных записей, настроенных toouse строгая согласованность нельзя связать более одного региона Azure с учетной записью Azure Cosmos DB. 
* Здравствуйте, затраты на операции чтения (в виде [единиц запросов](request-units.md) потребляет) строго согласованная выше, чем сеанса и возможном, но Здравствуйте таким же, как ограниченным устареванием.

**Ограниченное устаревание** 

* Согласованность с ограниченным устареванием гарантирует, что hello операций чтения может отставать от операций записи в журнал не чаще *K* версий или префиксы элемента или *t* интервал времени. 
* Таким образом, при выборе ограниченных устаревание, hello «устаревание» можно настроить двумя способами: номеров версий *K* hello элемента, по которому считывает hello отставать от записи hello и интервал времени hello *t* 
* Ограниченная устаревание предложения общее глобального порядке, за исключением внутри hello «устаревание окно». чтение Hello монотонными гарантии существует в области внутри и снаружи hello «устаревание окно». 
* Модель ограниченного устаревания обеспечивает более надежную гарантию согласованности, чем согласованность уровня сеанса и согласованность в конечном счете. Для глобально распределенных приложений мы рекомендуем использовать ограниченным устареванием для сценариев, где должны строгая согласованность toohave но хотелось 99,99% доступности и малой задержкой. 
* С учетными записями Azure Cosmos DB, для которых настроена согласованность с ограниченным устареванием, можно связать любое количество регионов Azure. 
* Здравствуйте стоимость операции чтения (с точки зрения RUs использованы) с ограниченным устареванием больше, чем сеанс и окончательной согласованности, но Здравствуйте таким же, как надежная согласованность.

**Уровень согласованности Session (сеанс)**: 

* В отличие от моделей hello глобальной согласованности, предлагаемые уровни согласованности надежный и связанной устаревание согласованность сеансов — tooa с областью сеанса клиента. 
* Согласованность уровня сеанса идеально подходит для всех сценариев, включающих в себя сеанс устройства или пользователя, так как она гарантирует монотонное чтение и монотонную запись, а также гарантирует чтение собственных записей (RYW). 
* Согласованность сеансов обеспечивает прогнозируемого согласованности сеанса и максимально пропускная способность операций чтения при низких hello низкие задержки операций записи и чтения. 
* С учетными записями Azure Cosmos DB, для которых настроена согласованность уровня сеанса, можно связать любое количество регионов Azure. 
* Здравствуйте, затраты на операции чтения (с точки зрения RUs потребляет) с сеансом, уровень согласованности — меньше, чем надежный и связанной устаревание, но более окончательной согласованности

<a id="consistent-prefix"></a>
**Согласованность префиксов**: 

* Согласованное префикс гарантирует, что при отсутствии дополнительные операции записи hello реплики в рамках группы hello в конечном итоге совпадают. 
* Согласованность префиксов гарантирует, что операции чтения никогда не столкнутся с неупорядоченными операциями записи. Если были выполнены операции записи в порядке hello `A, B, C`, клиент видит либо `A`, `A,B`, или `A,B,C`, но никогда не по порядку как `A,C` или `B,A,C`.
* С учетными записями Azure Cosmos DB, для которых настроена согласованность префиксов, можно связать любое количество регионов Azure. 

**Уровень согласованности Eventual (в конечном счете)**: 

* Итоговая согласованность гарантирует, что при отсутствии дополнительные операции записи hello реплики в рамках группы hello в конечном итоге совпадают. 
* Итоговая согласованность является слабым формой hello согласованности, где клиент может получить hello значения, которые являются более старыми, чем hello из них раньше было.
* Итоговая согласованность обеспечивает hello наименьшую согласованность чтения, но предложения hello наименьшую задержку для операций чтения и записи.
* С учетными записями Azure Cosmos DB, для которых настроена согласованность в конечном счете, можно связать любое количество регионов Azure. 
* Здравствуйте, затраты на операции чтения (с точки зрения потребления RUs) с окончательной согласованности hello уровень — минимальный все уровни согласованности hello Azure Cosmos DB hello.

## <a name="configuring-hello-default-consistency-level"></a>Настройка уровня согласованности по умолчанию hello
1. В hello [портал Azure](https://portal.azure.com/)в hello Jumpbar, щелкнув **Azure Cosmos DB**.
2. В hello **Azure Cosmos DB** колонки, toomodify учетной записи базы данных выберите hello.
3. В колонке hello учетной записи, нажмите кнопку **по умолчанию согласованности**.
4. В hello **согласованности по умолчанию** колонки, новый уровень согласованности выберите hello и нажмите кнопку **Сохранить**.
   
    ![Снимок экрана выделения hello значок параметров и запись по умолчанию согласованности](./media/consistency-levels/database-consistency-level-1.png)

## <a name="consistency-levels-for-queries"></a>Уровни согласованности для запросов
Для определяемых пользователем ресурсов по умолчанию hello уровень согласованности для запросов — hello же как считывает уровень согласованности hello. По умолчанию hello индекс обновляется синхронно для каждой вставки, замены или удаления контейнера Cosmos DB toohello элемента. Это позволяет toohonor hello уровень согласованности, что запросы hello точки операций чтения. Azure Cosmos DB доступно для записи оптимизированной и поддерживает длительной тома операций записи, обслуживание индекса синхронной и обслуживания запросов согласованное, можно настроить некоторые коллекции tooupdate их индекс неактивно. Кроме того отложенного индексирования повышает производительность записи hello, идеально подходит для сценариев массового приема при основном чтения тяжелой рабочей нагрузки.  

| Режим индексирования | Операции чтения | Запросы |
| --- | --- | --- |
| Режим согласованности (по умолчанию) |Можно выбрать строгую согласованность, согласованность с ограниченным устареванием, согласованность уровня сеанса, согласованность префиксов или согласованность в конечном счете. |Можно выбрать строгую согласованность, согласованность с ограниченным устареванием, согласованность уровня сеанса и согласованность в конечном счете. |
| Отложенная |Можно выбрать строгую согласованность, согласованность с ограниченным устареванием, согласованность уровня сеанса, согласованность префиксов или согласованность в конечном счете. |Уровень согласованности Eventual (в конечном счете) |
| None |Можно выбрать строгую согласованность, согласованность с ограниченным устареванием, согласованность уровня сеанса, согласованность префиксов или согласованность в конечном счете. |Не применяется |

Как с помощью запросов чтения, можно понизить уровень согласованности hello конкретных запросов в каждый API.

## <a name="next-steps"></a>Дальнейшие действия
Если вы хотите toodo более чтения об уровнях согласованности и недостатки, мы рекомендуем hello следующие ресурсы:

* Даг Терри. Объяснение согласованности при репликации данных на примере бейсбола (видео).   
  [https://www.youtube.com/watch?v=gluIh8zd26I](https://www.youtube.com/watch?v=gluIh8zd26I)
* Даг Терри. Объяснение согласованности при репликации данных на примере игры в бейсбол (Replicated Data Consistency explained through baseball).   
  [http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf](http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf)
* Даг Терри. Гарантии на уровне сеанса для репликации слабо согласованных данных.   
  [http://dl.acm.org/citation.cfm?id=383631](http://dl.acm.org/citation.cfm?id=383631)
* Дэниэл Абади. Недостатки согласованности по современный дизайн системы базы данных распределенных: ограничение составляет часть истории hello».   
  [http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html](http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html)
* Питер Бейлис, Шиварам Венкатараман, Майкл Дж. Франклин, Джозеф М. Хеллерштейн, Ион Стойка (Peter Bailis, Shivaram Venkataraman, Michael J. Franklin, Joseph M. Hellerstein, Ion Stoica). Вероятностное ограниченное запаздывание (PBS) для практических неполных кворумов.   
  [http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)
* Вернер Вогелс. Возвращаясь к вопросу о согласованности в конечном счете.    
  [http://allthingsdistributed.com/2008/12/eventually_consistent.html](http://allthingsdistributed.com/2008/12/eventually_consistent.html)
* Naor входа в сам шерсть Avishai, hello нагрузки, емкость и систем доступности кворума, SIAM журнала вычислений, v.27 n.2, p.423-447 апреля 1998 года.
  [http://epubs.siam.org/doi/abs/10.1137/S0097539795281232](http://epubs.siam.org/doi/abs/10.1137/S0097539795281232)
* Себастиан Burckhardt, Крис Dern, Macanal Musuvathi, Roy Tan, линейку: linearizability завершения и автоматической проверки, событий hello 2010 конференции ACM SIGPLAN о программировании языка проектирования и реализации 05-10 июня 2010 г., Торонто, Онтарио, Канада [doi > 10.1145/1806596.1806634] [http://dl.acm.org/citation.cfm?id=1806634](http://dl.acm.org/citation.cfm?id=1806634)
* Питер Bailis, Shivaram Venkataraman, Майкл Дж. Франклин, Hellerstein M. Джозеф, Ion Stoica первопричину ограниченных устаревание для практического частичного кворумов событий hello VLDB Endowment, n.8 в.5, p.776 787, апрель 2012 г. [http:// DL.ACM.org/Citation.cfm?ID=2212359](http://dl.acm.org/citation.cfm?id=2212359)
