---
title: "Единицы запросов в минуту в базе данных Azure Cosmos DB | Документация Майкрософт"
description: "Узнайте, как tooreduce стоимость за счет использования запроса единицы в минуту."
services: cosmos-db
documentationcenter: 
author: mimig1
manager: jhubbard
editor: 
ms.assetid: 
ms.service: cosmos-db
ms.workload: 
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 05/10/2017
ms.author: mimig
ms.openlocfilehash: fcc3a92b9788750a2bfba361c3a9cebdb56eee05
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="request-units-per-minute-in-azure-cosmos-db"></a>Единицы запросов в минуту в базе данных Azure Cosmos DB

Azure Cosmos DB — спроектированный toohelp достижения быстрого и предсказуемая производительность и масштабируемость без проблем, а также роста приложения. В контейнере базы данных Cosmos DB пропускную способность можно подготавливать с ежесекундной или ежеминутной степенью детализации. Hello пропускная способность на уровне гранулярности в минуту — используется toomanage непредвиденными скачками hello рабочей нагрузки, произошедших на гранулярности в секунду. 

В этой статье содержатся общие сведения о том, как работает Подготовка hello единиц запросов в минуту (RU/m). Задача Hello в виду при подготовке RU/m — tooprovide прогнозируемую производительность вокруг непредсказуемым потребностей (в особенности, если вам нужна toorun аналитика на основе операционных данных) и высоким колебаниям рабочих нагрузок. Мы хотим toohave наших клиентов потребляют большую нагрузку hello, его подготовке, поэтому их можно легко масштабировать быстро с спокойствие.

После считывания в этой статье, можно будет tooanswer hello следующие вопросы:

* Как работают единицы запросов в минуту?
* Что такое hello различие между запроса единицах в минуту и запросов в секунду
* Как tooprovision RU/m?
* В каких ситуациях следует подготавливать единицы запросов с ежеминутной степенью детализации?
* Как toouse hello портала метрики toooptimize Мой затрат и производительности?
* Какие типы запросов используют единицы запросов с ежеминутной степенью детализации?

## <a name="provisioning-request-units-per-minute-rum"></a>Подготовка единиц запросов в минуту

При подготовке Azure Cosmos DB на втором уровне детализации hello (единиц Запросов в секунду), вы получаете hello гарантии, что запрос выполняется успешно с низкой задержкой, если пропускная способность не превышает емкость hello подготовлены в течение секунды. С RU/m гранулярность hello находится на минуту hello с hello гарантии, что запрос выполняется успешно в течение этой минуты. По сравнению с системами toobursting мы обязательно производительности hello, вы получаете прогнозируемого и можно рассчитывать на это.

способ Hello в минуту подготовки работает довольно простой.

* RU/m оплачивается каждый час и в tooRU сложения в секунду. Дополнительные сведения см. на [странице цен на базу данных Azure Cosmos DB](https://aka.ms/acdbpricing).
* Единицы запросов в минуту можно включить на уровне коллекции. Что можно сделать через hello пакетов SDK (Node.js, Java или .net) или через портал hello (также включать рабочих нагрузок MongoDB API)
* При включении RU/m для каждого 100 единиц Запросов в секунду подготовки, вы также получаете 1 000 единиц Запросов/m подготовить (отношение hello — 10 раз)
* Использование единиц запросов в минуту начинается только при превышении квоты на единицы запросов в секунду в течение заданной секунды.
* Один раз Здравствуйте заканчивается 60-секундного периода (времени UTC), заполняется hello за минуты подготовки
* Единицы запросов в минуту можно использовать только в коллекциях с максимум 5000 единицами запросов в секунду на секцию. При масштабировании пропускной способности и достижении высокого уровня подготовки на секцию вы получите предупреждающее сообщение.

Ниже приведен конкретный пример, где пользователь может подготовить 10 000 единиц запросов в секунду и 100 000 единиц запросов в минуту, что позволяет сократить расходы на 73 %, не подготавливая дополнительные единицы запросов в секунду для пиковых нагрузок (около 50 000 единиц), которые могут произойти в коллекции с таким же числом единиц запросов в течение 90 секунд.

* 1 секунду: hello RU/m бюджета составляет 100 000
* третьей секунды: во время этой второй hello потребления единицы запроса было 11,010 RUs, 1,010 RUs выше подготовки hello единиц Запросов в секунду. Таким образом 1,010 RUs вычитаются из бюджета hello RU/m. 98,990 RUs доступны для hello следующих 57 секунд в бюджете RU/m hello
* 29 секунду: во время этого второго произошло большой пик (> четыре раза выше, чем подготовки в секунду) и потребления hello единицы запрос был 46,920 RUs. 36,920 RUs вычитаются из бюджета RU/m hello, удалены из 92,323 too55 RUs (28 секунда), 403 RUs (29 сек)
* второй 61st: бюджета RU/m снова установить too100 000 RUs.
 
![График показывает потребление hello и подготовка Azure Cosmos DB](./media/request-units-per-minute/azure-cosmos-db-request-units-per-minute.png)

## <a name="specifying-request-unit-capacity-with-rum"></a>Указание количества единиц запросов с учетом резерва единиц запросов в минуту

При создании коллекции Azure Cosmos DB, можно указать номер hello единиц запросов в секунду (единиц Запросов в секунду) требуется найти, зарезервированная для hello коллекции. Можно решить, следует ли tooadd единиц Запросов в минуту. Это можно сделать с помощью hello портала или hello SDK. 

### <a name="through-hello-portal"></a>Через портал hello

Чтобы добавить единицы запросов в минуту, необходимо просто выбрать нужный параметр при подготовке коллекции. 

 ![Снимок экрана, показывающий как tooset RU/m в hello портал Azure](./media/request-units-per-minute/azure-cosmos-db-request-unit-per-minute-portal.png)

### <a name="through-hello-sdk"></a>Через hello SDK
Во-первых это важно toonote, RU-m доступен только для следующих пакетов SDK hello:

* .NET 1.14.0;
* Java 1.11.0;
* Node.js 1.12.0;
* Python 2.2.0.

Ниже приведен фрагмент кода для создания коллекции с 3 000 единиц запроса в единиц второй и 30 000 запросов в минуту, с помощью hello .NET SDK.

```csharp
// Create a collection with RU/m enabled
DocumentCollection myCollection = new DocumentCollection();
myCollection.Id = "coll";
myCollection.PartitionKey.Paths.Add("/deviceId");

// Set hello throughput too3,000 request units per second which will give you 30,000 request units per minute as hello RU/m budget
await client.CreateDocumentCollectionAsync(
    UriFactory.CreateDatabaseUri("db"),
    myCollection,
    new RequestOptions { OfferThroughput = 3000, OfferEnableRUPerMinuteThroughput = true });
```

Ниже приведен фрагмент кода для изменения hello пропускной способности too5 коллекции, 000 единиц запросов в секунду без подготовки RU за минуту с помощью hello .NET SDK.

```csharp
// Get hello current offer
Offer offer = client.CreateOfferQuery()
    .Where(r => r.ResourceLink == collection.SelfLink)    
    .AsEnumerable()
    .SingleOrDefault();

// Set hello throughput too5000 request units per second without RU/m enabled (hello last parameter tooOfferV2 constructor below)
OfferV2 offerV2 = new OfferV2(offer, 5000, false);

// Now persist these changes toohello database by replacing hello original resource
await client.ReplaceOfferAsync(offerV2);
```

## <a name="good-fit-scenarios"></a>Сценарии применения

В этом разделе рассматриваются сценарии, в которых мы советуем использовать единицы запросов в минуту.

**Среда разработки и тестирования.** На этапе разработки hello при тестировании приложения в разных рабочих нагрузок, RU-m может предоставить hello гибкость на этом этапе. При hello [эмулятор](local-emulator.md) имеет отличное бесплатное средство tootest Azure Cosmos DB. Тем не менее если требуется toostart в облачной среде, будут иметь гибкость с RU/m для вашим требованиям к производительности прямого соединения. Это позволит посвятить больше времени разработке, не заботясь о производительности. Мы рекомендуем начать с hello подготовки минимальное единиц Запросов в секунду и включите RU/m.

**Непредсказуемые события, пиковые нагрузки и потребность в ежеминутной степени детализации** (экономия расходов от 25 до 75 %). Мы рассмотрели разные сценарии, в которых единицы запросов в минуту принесли значительную пользу, и большинство рабочих сценариев входят в их число. При наличии рабочей нагрузки IoT с пик несколько раз в минуту, если у вас есть запросы, выполняемые при системы делает массовой вставки в hello же времени, вам потребуется дополнительная емкость обработку высоким колебаниям, должен. Мы советуем оптимизировать потребность в ресурсах, используя приведенный ниже подход.

 ![График выполнения запросов с пятиминутной степенью детализации](./media/request-units-per-minute/azure-cosmos-db-request-units-per-minute-consumption.png)
 
 *Рис. Результаты измерения производительности при использовании единиц запросов*

**Надежность** (экономия от 10 до 20 %). Иногда требуется toohave спокойствие и не беспокоиться о потенциальных пиковыми нагрузками и регулирования. Этот компонент является hello вправо на один для вас. В этом случае мы советуем включить единицы запросов в минуту и снизить число единиц запросов в секунду. Этот случай отличается от hello выше, как вы не будет повторять попытку toooptimize агрессивно вашей подготовки. Это подход, в большей степени ориентированный на устранение регулирования.

Критически важные операции с потребностями adhoc: иногда рекомендуется tooonly позволяют использовать RU/m бюджета, что бюджет hello не получить доступ путем прямого соединения или менее важные операции критические операции. Можно легко определить в разделе "hello" ниже.

## <a name="using-hello-portal-metrics-toooptimize-cost-and-performance"></a>С помощью hello портала метрики toooptimize затрат и производительности

**В ближайшие недели hello мы будет доработки содержимое hello вокруг мониторинга toooptimize минуты потребления RUs должен пропускную способность.**

Посредством портала метрики hello можно увидеть, сколько регулярного секунд RU, использовать и RU минут. Мониторинг этих метрик позволяет оптимизировать подготовку. 

Рекомендуемый подход шаг за шагом, о том, как toouse преимущества tooyour RU/m. Для каждого шага, должны иметь общие сведения о потреблении hello RU представляющий полного цикла рабочей нагрузки (он может быть часы, дни, или даже недель) и получить представление на использование hello выполняется развертывание.

Принцип Hello этот подход является toomake к пропускной способности подготавливать закрыть как возможные tooa, точки, соответствующее условиям производительности ниже подготовки. 

![График выполнения запросов с пятиминутной степенью детализации](./media/request-units-per-minute/azure-cosmos-db-request-units-per-minute-adjust-provisioning.png)
 
toounderstand hello оптимальной подготовки точки для рабочей нагрузки, необходимо toounderstand:

* Шаблоны потребления. Определите частоту пиковых нагрузок (частые, нечастые, отсутствуют), а также их длительность, например краткосрочные (в 2 раза меньше средних), средние или долгосрочные (в 10 раз больше средних).
* Процент отрегулированных запросов. Определите, хотите ли вы выполнять регулирование, и если да, то как часто. 

После определения целей, можно будет tooget ближе toohello оптимальной подготовки.

tooassist, мы хотим tooprovide общих рекомендаций относительно на как toooptimize вашей подготовки на основе RU/m потребления. В этом руководстве не применить вид tooall рабочих нагрузок, но основана на знаний hello личной предварительной версии. При более подробном изучении базовые показатели могут измениться.

|Использование единиц запросов в минуту (%)|Степень использования единиц запросов в минуту|Рекомендуемые действия для подготовки|
|---|---|---|
|0–1 %|Недоиспользование|Понизить дополнительные RU/m tooconsume единиц Запросов в секунду|
|1–10 %|Использование в работоспособном состоянии|Сохранить hello же подготовки уровень|
|Выше 10 %|Чрезмерное использование|Увеличьте toorely единиц Запросов в секунду не на RU/m|

## <a name="select-which-operations-can-consume-hello-rum-budget"></a>Выберите, какие операции могут потреблять hello RU/m бюджета

На уровне запроса можно также включить или отключить запрос hello tooserve RU/m бюджета независимо от типа операции. Если потребляется регулярного подготовленных бюджета RUs/сек, запрос hello не могут использовать бюджета RU/m hello будет регулироваться этого запроса. По умолчанию запрос использует единицы запросов в секунду, даже если активированы единицы запроса в минуту. 

Ниже приведен фрагмент кода для отключения бюджета RU/m, с помощью hello DocumentDB API для операций CRUD и запроса.

```csharp
// In order toodisable any CRUD request for RU/m, set DisableRUPerMinuteUsage tootrue in RequestOptions
await client.CreateDocumentAsync(
    UriFactory.CreateDocumentCollectionUri("db", "container"),
    new Document { Id = "Cosmos DB" },
    new RequestOptions { DisableRUPerMinuteUsage = true });
// In order toodisable any query request for RU/m, set DisableRUPerMinuteOnRequest tootrue in RequestOptions
FeedOptions feedOptions = new FeedOptions();
feedOptions.DisableRUPerMinuteUsage = true;
var query = client.CreateDocumentQuery<Book>(
    UriFactory.CreateDocumentCollectionUri("db", "container"),
    "select * from c",feedOptions).AsDocumentQuery();
```

## <a name="next-steps"></a>Дальнейшие действия

В этой статье мы рассмотрели, как действует секционирование в базе данных Azure Cosmos DB, а также узнали, как создать секционированные коллекции и как выбрать подходящий ключ секции для приложения.

* Выполняйте проверку масштабирования и производительности с помощью базы данных Azure Cosmos DB. Пример см. в статье [Проверка производительности и масштабирования с помощью Azure DocumentDB](performance-testing.md).
* Приступить к созданию кода с hello [пакетов SDK](documentdb-sdk-dotnet.md) или hello [API-интерфейса REST](/rest/api/documentdb/).
* Дополнительные сведения о подготовленной пропускной способности в базе данных Azure Cosmos DB см. в [этой статье](request-units.md). 

