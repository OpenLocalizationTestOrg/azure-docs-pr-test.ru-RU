---
title: "aaaSQL метрики для Azure Cosmos DB DocumentDB API | Документы Microsoft"
description: "Узнайте, как tooinstrument и отладки hello производительности запросов SQL Azure Cosmos DB запросов."
keywords: "синтаксис SQL, запрос SQL, язык запросов JSON, понятия баз данных и запросы SQL, статистические функции"
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: monicar
ms.assetid: b2fa8e8f-7291-45a3-9bd1-7284ed9077f8
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: arramac
ms.openlocfilehash: 2fee3786b7d48d254162699471943e316764b003
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="tuning-query-performance-with-azure-cosmos-db"></a><span data-ttu-id="00bbf-104">Настройка производительности запросов в Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="00bbf-104">Tuning query performance with Azure Cosmos DB</span></span>
<span data-ttu-id="00bbf-105">Azure Cosmos DB предоставляет [API SQL для запроса данных](documentdb-sql-query.md) без использования схемы или вторичных индексов.</span><span class="sxs-lookup"><span data-stu-id="00bbf-105">Azure Cosmos DB provides a [SQL API for querying data](documentdb-sql-query.md), without requiring schema or secondary indexes.</span></span> <span data-ttu-id="00bbf-106">Эта статья содержит следующие сведения для разработчиков hello:</span><span class="sxs-lookup"><span data-stu-id="00bbf-106">This article provides hello following information for developers:</span></span>

* <span data-ttu-id="00bbf-107">общие сведения о выполнении SQL-запросов в Azure Cosmos DB;</span><span class="sxs-lookup"><span data-stu-id="00bbf-107">High-level details on how Azure Cosmos DB's SQL query execution works</span></span>
* <span data-ttu-id="00bbf-108">сведения о заголовках запросов и ответов и параметры клиентского пакета SDK;</span><span class="sxs-lookup"><span data-stu-id="00bbf-108">Details on query request and response headers, and client SDK options</span></span>
* <span data-ttu-id="00bbf-109">советы и рекомендации по повышению производительности запросов.</span><span class="sxs-lookup"><span data-stu-id="00bbf-109">Tips and best practices for query performance</span></span>
* <span data-ttu-id="00bbf-110">Примеры как toodebug статистики выполнения SQL tooutilize производительности запросов</span><span class="sxs-lookup"><span data-stu-id="00bbf-110">Examples of how tooutilize SQL execution statistics toodebug query performance</span></span>

## <a name="about-sql-query-execution"></a><span data-ttu-id="00bbf-111">Сведения о выполнении SQL-запросов</span><span class="sxs-lookup"><span data-stu-id="00bbf-111">About SQL query execution</span></span>

<span data-ttu-id="00bbf-112">В базе данных Azure Cosmos, хранить данные в контейнеры, которые может увеличиваться tooany [пропускной способности размер или запрос хранилища](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="00bbf-112">In Azure Cosmos DB, you store data in containers, which can grow tooany [storage size or request throughput](partition-data.md).</span></span> <span data-ttu-id="00bbf-113">Azure Cosmos DB легко масштабируется данных через физические секции в группе роста данных toohandle деле hello или увеличение пропускная способность.</span><span class="sxs-lookup"><span data-stu-id="00bbf-113">Azure Cosmos DB seamlessly scales data across physical partitions under hello covers toohandle data growth or increase in provisioned throughput.</span></span> <span data-ttu-id="00bbf-114">Может выдавать контейнер tooany запросы SQL, с помощью API-интерфейса REST hello или один из поддерживаемых hello [пакеты SDK DocumentDB](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="00bbf-114">You can issue SQL queries tooany container using hello REST API or one of hello supported [DocumentDB SDKs](documentdb-sdk-dotnet.md).</span></span>

<span data-ttu-id="00bbf-115">Рассмотрим пример секционирования. Вы определяете ключ секции, например city, который определяет, каким образом данные разделяются на физические секции.</span><span class="sxs-lookup"><span data-stu-id="00bbf-115">A brief overview of partitioning: you define a partition key like "city", which determines how data is split across physical partitions.</span></span> <span data-ttu-id="00bbf-116">Ключ одной секции tooa принадлежность данных (например, «Город» == «Seattle») хранится в физической секции, но обычно имеет несколько ключей секционирования в одной физической секции.</span><span class="sxs-lookup"><span data-stu-id="00bbf-116">Data belonging tooa single partition key (for example, "city" == "Seattle") is stored within a physical partition, but typically a single physical partition has multiple partition keys.</span></span> <span data-ttu-id="00bbf-117">При секции достигает размера хранилища, служба hello легко разделяет hello секции на две новые секции и равномерно делит ключ раздела hello в этих секциях.</span><span class="sxs-lookup"><span data-stu-id="00bbf-117">When a partition reaches its storage size, hello service seamlessly splits hello partition into two new partitions, and divides hello partition key evenly across these partitions.</span></span> <span data-ttu-id="00bbf-118">Поскольку разделы являются временными, hello API используют абстракцию «раздела ключа диапазона», который используется для обозначения диапазоны hello хэшей ключа секции.</span><span class="sxs-lookup"><span data-stu-id="00bbf-118">Since partitions are transient, hello APIs use an abstraction of a "partition key range", which denotes hello ranges of partition key hashes.</span></span> 

<span data-ttu-id="00bbf-119">При выполнении запроса tooAzure Cosmos DB hello SDK выполняет следующие логические действия.</span><span class="sxs-lookup"><span data-stu-id="00bbf-119">When you issue a query tooAzure Cosmos DB, hello SDK performs these logical steps:</span></span>

* <span data-ttu-id="00bbf-120">Синтаксический анализ hello toodetermine запроса SQL hello плана выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-120">Parse hello SQL query toodetermine hello query execution plan.</span></span> 
* <span data-ttu-id="00bbf-121">Если hello запрос содержит фильтр по ключу секции hello, такие как `SELECT * FROM c WHERE c.city = "Seattle"`, это перенаправленное tooa одна секция.</span><span class="sxs-lookup"><span data-stu-id="00bbf-121">If hello query includes a filter against hello partition key, like `SELECT * FROM c WHERE c.city = "Seattle"`, it is routed tooa single partition.</span></span> <span data-ttu-id="00bbf-122">Если запрос hello не имеет фильтр на ключ секционирования, то выполняется во всех секциях и результаты объединяются на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="00bbf-122">If hello query does not have a filter on partition key, then it is executed in all partitions, and results are merged client side.</span></span>
* <span data-ttu-id="00bbf-123">запрос Hello выполнении в каждой секции в ряду или параллельного, зависит от конфигурации клиента.</span><span class="sxs-lookup"><span data-stu-id="00bbf-123">hello query is executed within each partition in series or parallel, based on client configuration.</span></span> <span data-ttu-id="00bbf-124">В каждой секции hello запроса может внести одно или несколько циклов приема-передачи в зависимости от сложности запросов hello, настроить размер страницы и подготовка пропускной способности hello коллекции.</span><span class="sxs-lookup"><span data-stu-id="00bbf-124">Within each partition, hello query might make one or more round trips depending on hello query complexity, configured page size, and provisioned throughput of hello collection.</span></span> <span data-ttu-id="00bbf-125">Каждое выполнение возвращает количество hello [единиц запросов](request-units.md) статистику выполнения запросов, используемого при выполнении запроса и при необходимости.</span><span class="sxs-lookup"><span data-stu-id="00bbf-125">Each execution returns hello number of [request units](request-units.md) consumed by query execution, and optionally, query execution statistics.</span></span> 
* <span data-ttu-id="00bbf-126">Hello SDK выполняет суммирование результатов запросов hello в секциях.</span><span class="sxs-lookup"><span data-stu-id="00bbf-126">hello SDK performs a summarization of hello query results across partitions.</span></span> <span data-ttu-id="00bbf-127">Например если hello запрос включает предложение ORDER BY по секциям, затем результаты из отдельных разделов являются результатами отсортированы слияния tooreturn глобально упорядоченную.</span><span class="sxs-lookup"><span data-stu-id="00bbf-127">For example, if hello query involves an ORDER BY across partitions, then results from individual partitions are merge-sorted tooreturn results in globally sorted order.</span></span> <span data-ttu-id="00bbf-128">Если запрос hello агрегат, такой как `COUNT`, hello количеств, из отдельных секций, суммарные tooproduce hello всего.</span><span class="sxs-lookup"><span data-stu-id="00bbf-128">If hello query is an aggregation like `COUNT`, hello counts from individual partitions are summed tooproduce hello overall count.</span></span>

<span data-ttu-id="00bbf-129">пакеты SDK Hello предоставляют различные параметры для выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-129">hello SDKs provide various options for query execution.</span></span> <span data-ttu-id="00bbf-130">Например, в .NET эти параметры доступны в hello `FeedOptions` класса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-130">For example, in .NET these options are available in hello `FeedOptions` class.</span></span> <span data-ttu-id="00bbf-131">Hello следующей таблице описаны эти параметры и их влияние на время выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-131">hello following table describes these options and how they impact query execution time.</span></span> 

| <span data-ttu-id="00bbf-132">Параметр</span><span class="sxs-lookup"><span data-stu-id="00bbf-132">Option</span></span> | <span data-ttu-id="00bbf-133">Описание</span><span class="sxs-lookup"><span data-stu-id="00bbf-133">Description</span></span> |
| ------ | ----------- |
| `EnableCrossPartitionQuery` | <span data-ttu-id="00bbf-134">Необходимо задать tootrue для любого запроса, требующий toobe выполняется по более чем одной секции.</span><span class="sxs-lookup"><span data-stu-id="00bbf-134">Must be set tootrue for any query that requires toobe executed across more than one partition.</span></span> <span data-ttu-id="00bbf-135">Это явные флаг tooenable вы toomake компромиссы обоснованное производительности во время разработки.</span><span class="sxs-lookup"><span data-stu-id="00bbf-135">This is an explicit flag tooenable you toomake conscious performance tradeoffs during development time.</span></span> |
| `EnableScanInQuery` | <span data-ttu-id="00bbf-136">Необходимо указать tootrue, если вы отказались от индексирования, но все равно хотите toorun hello запрос через проверку.</span><span class="sxs-lookup"><span data-stu-id="00bbf-136">Must be set tootrue if you have opted out of indexing, but want toorun hello query via a scan anyway.</span></span> <span data-ttu-id="00bbf-137">Только применяется, если индексирование для hello запрошенный путь фильтра отключена.</span><span class="sxs-lookup"><span data-stu-id="00bbf-137">Only applicable if indexing for hello requested filter path is disabled.</span></span> | 
| `MaxItemCount` | <span data-ttu-id="00bbf-138">Максимальное количество элементов tooreturn на каждом сервере toohello кругового пути Hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-138">hello maximum number of items tooreturn per round trip toohello server.</span></span> <span data-ttu-id="00bbf-139">Установив слишком-1, можно позволить hello server управлять hello количеством элементов.</span><span class="sxs-lookup"><span data-stu-id="00bbf-139">By setting too-1, you can let hello server manage hello number of items.</span></span> <span data-ttu-id="00bbf-140">Также можно понизить tooretrieve это значение только небольшое количество элементов в цикл обработки.</span><span class="sxs-lookup"><span data-stu-id="00bbf-140">Or, you can lower this value tooretrieve only a small number of items per round trip.</span></span> 
| `MaxBufferedItemCount` | <span data-ttu-id="00bbf-141">Это значение параметра клиентские и использовать потребление памяти toolimit hello, при выполнении между разделами ORDER BY.</span><span class="sxs-lookup"><span data-stu-id="00bbf-141">This is a client-side option, and used toolimit hello memory consumption when performing cross-partition ORDER BY.</span></span> <span data-ttu-id="00bbf-142">Более высокое значение помогает сократить задержку hello сортировки между разделами.</span><span class="sxs-lookup"><span data-stu-id="00bbf-142">A higher value helps reduce hello latency of cross-partition sorting.</span></span> |
| `MaxDegreeOfParallelism` | <span data-ttu-id="00bbf-143">Возвращает или задает номер hello одновременных операций запуска на стороне клиента во время выполнения параллельных запросов в hello службы базы данных Azure DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="00bbf-143">Gets or sets hello number of concurrent operations run client side during parallel query execution in hello Azure DocumentDB database service.</span></span> <span data-ttu-id="00bbf-144">Положительное значение ограничивает число одновременных операций toohello установите значение в hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-144">A positive property value limits hello number of concurrent operations toohello set value.</span></span> <span data-ttu-id="00bbf-145">Если оно задано сборки, чем 0, hello число параллельных операций toorun автоматически выбирает система hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-145">If it is set tooless than 0, hello system automatically decides hello number of concurrent operations toorun.</span></span> |
| `PopulateQueryMetrics` | <span data-ttu-id="00bbf-146">Дает возможность подробного ведения журнала статистики времени, затраченного на различных этапах выполнения запроса, например времени компиляции, цикла индекса и загрузки документа.</span><span class="sxs-lookup"><span data-stu-id="00bbf-146">Enables detailed logging of statistics of time spent in various phases of query execution like compilation time, index loop time, and document load time.</span></span> <span data-ttu-id="00bbf-147">Выходные данные статистики запросов можно предоставить проблем с производительностью запросов toodiagnose поддержки Azure.</span><span class="sxs-lookup"><span data-stu-id="00bbf-147">You can share output from query statistics with Azure Support toodiagnose query performance issues.</span></span> |
| `RequestContinuation` | <span data-ttu-id="00bbf-148">Путем передачи в токен продолжения непрозрачный hello, возвращаемый любой запрос можно возобновить выполнение запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-148">You can resume query execution by passing in hello opaque continuation token returned by any query.</span></span> <span data-ttu-id="00bbf-149">токен продолжения Hello инкапсулирует все состояния, необходимые для выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-149">hello continuation token encapsulates all state required for query execution.</span></span> |
| `ResponseContinuationTokenLimitInKb` | <span data-ttu-id="00bbf-150">Можно ограничить hello максимальный размер маркера продолжения hello, возвращаемом сервером hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-150">You can limit hello maximum size of hello continuation token returned by hello server.</span></span> <span data-ttu-id="00bbf-151">Может потребоваться tooset это если узла приложения есть ограничения на размер заголовка ответа.</span><span class="sxs-lookup"><span data-stu-id="00bbf-151">You might need tooset this if your application host has limits on response header size.</span></span> <span data-ttu-id="00bbf-152">Установка этого параметра может увеличить hello общую длительность и RUs, использованных для запроса hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-152">Setting this may increase hello overall duration and RUs consumed for hello query.</span></span>  |

<span data-ttu-id="00bbf-153">Например, рассмотрим пример запроса на ключ секционирования, запрошенное на коллекцию с `/city` как раздел hello ключа и она инициализируется посредством 100 000 единиц Запросов в секунду пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="00bbf-153">For example, let's take an example query on partition key requested on a collection with `/city` as hello partition key and provisioned with 100,000 RU/s of throughput.</span></span> <span data-ttu-id="00bbf-154">Запросить этот запрос с помощью `CreateDocumentQuery<T>` в .NET hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="00bbf-154">You request this query using `CreateDocumentQuery<T>` in .NET like hello following:</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
        MaxItemCount = -1, 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();
```

<span data-ttu-id="00bbf-155">Hello SDK фрагмент кода, показанный выше, соответствует toohello после запроса REST API:</span><span class="sxs-lookup"><span data-stu-id="00bbf-155">hello SDK snippet shown above, corresponds toohello following REST API request:</span></span>

```
POST https://arramacquerymetrics-westus.documents.azure.com/dbs/db/colls/sample/docs HTTP/1.1
x-ms-continuation: 
x-ms-documentdb-isquery: True
x-ms-max-item-count: -1
x-ms-documentdb-query-enablecrosspartition: True
x-ms-documentdb-query-parallelizecrosspartitionquery: True
x-ms-documentdb-query-iscontinuationexpected: True
x-ms-documentdb-populatequerymetrics: True
x-ms-date: Tue, 27 Jun 2017 21:52:18 GMT
authorization: type%3dmaster%26ver%3d1.0%26sig%3drp1Hi83Y8aVV5V6LzZ6xhtQVXRAMz0WNMnUuvriUv%2b4%3d
x-ms-session-token: 7:8,6:2008,5:8,4:2008,3:8,2:2008,1:8,0:8,9:8,8:4008
Cache-Control: no-cache
x-ms-consistency-level: Session
User-Agent: documentdb-dotnet-sdk/1.14.1 Host/32-bit MicrosoftWindowsNT/6.2.9200.0
x-ms-version: 2017-02-22
Accept: application/json
Content-Type: application/query+json
Host: arramacquerymetrics-westus.documents.azure.com
Content-Length: 52
Expect: 100-continue

{"query":"SELECT * FROM c WHERE c.city = 'Seattle'"}
```

<span data-ttu-id="00bbf-156">Каждая страница Выполнение запроса соответствует tooa API-интерфейса REST `POST` с hello `Accept: application/query+json` заголовок и hello SQL-запрос в тексте hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-156">Each query execution page corresponds tooa REST API `POST` with hello `Accept: application/query+json` header, and hello SQL query in hello body.</span></span> <span data-ttu-id="00bbf-157">Каждый запрос создает один или несколько округления сервер toohello приема-передачи с hello `x-ms-continuation` токен отображаться между выполнением tooresume hello клиента и сервера.</span><span class="sxs-lookup"><span data-stu-id="00bbf-157">Each query makes one or more round trips toohello server with hello `x-ms-continuation` token echoed between hello client and server tooresume execution.</span></span> <span data-ttu-id="00bbf-158">параметры конфигурации Hello в FeedOptions передаются toohello сервера в виде hello заголовков запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-158">hello configuration options in FeedOptions are passed toohello server in hello form of request headers.</span></span> <span data-ttu-id="00bbf-159">Например `MaxItemCount` соответствует слишком`x-ms-max-item-count`.</span><span class="sxs-lookup"><span data-stu-id="00bbf-159">For example, `MaxItemCount` corresponds too`x-ms-max-item-count`.</span></span> 

<span data-ttu-id="00bbf-160">Hello запрос возвращает следующие hello (усечены для удобства чтения) ответа:</span><span class="sxs-lookup"><span data-stu-id="00bbf-160">hello request returns hello following (truncated for readability) response:</span></span>

```
HTTP/1.1 200 Ok
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Server: Microsoft-HTTPAPI/2.0
Strict-Transport-Security: max-age=31536000
x-ms-last-state-change-utc: Tue, 27 Jun 2017 21:01:57.561 GMT
x-ms-resource-quota: documentSize=10240;documentsSize=10485760;documentsCount=-1;collectionSize=10485760;
x-ms-resource-usage: documentSize=1;documentsSize=884;documentsCount=2000;collectionSize=1408;
x-ms-item-count: 2000
x-ms-schemaversion: 1.3
x-ms-alt-content-path: dbs/db/colls/sample
x-ms-content-path: +9kEANVq0wA=
x-ms-xp-role: 1
x-ms-documentdb-query-metrics: totalExecutionTimeInMs=33.67;queryCompileTimeInMs=0.06;queryLogicalPlanBuildTimeInMs=0.02;queryPhysicalPlanBuildTimeInMs=0.10;queryOptimizationTimeInMs=0.00;VMExecutionTimeInMs=32.56;indexLookupTimeInMs=0.36;documentLoadTimeInMs=9.58;systemFunctionExecuteTimeInMs=0.00;userFunctionExecuteTimeInMs=0.00;retrievedDocumentCount=2000;retrievedDocumentSize=1125600;outputDocumentCount=2000;writeOutputTimeInMs=18.10;indexUtilizationRatio=1.00
x-ms-request-charge: 604.42
x-ms-serviceversion: version=1.14.34.4
x-ms-activity-id: 0df8b5f6-83b9-4493-abda-cce6d0f91486
x-ms-session-token: 2:2008
x-ms-gatewayversion: version=1.14.33.2
Date: Tue, 27 Jun 2017 21:59:49 GMT
```

<span data-ttu-id="00bbf-161">заголовки ответа ключа Hello, возвращаемых запросом hello включить hello следующие:</span><span class="sxs-lookup"><span data-stu-id="00bbf-161">hello key response headers returned from hello query include hello following:</span></span>

| <span data-ttu-id="00bbf-162">Параметр</span><span class="sxs-lookup"><span data-stu-id="00bbf-162">Option</span></span> | <span data-ttu-id="00bbf-163">Описание</span><span class="sxs-lookup"><span data-stu-id="00bbf-163">Description</span></span> |
| ------ | ----------- |
| `x-ms-item-count` | <span data-ttu-id="00bbf-164">число элементов, возвращаемых в ответе hello Hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-164">hello number of items returned in hello response.</span></span> <span data-ttu-id="00bbf-165">Это зависит от hello предоставленный `x-ms-max-item-count`, hello количество элементов, которое может уместиться в размер полезных данных ответа максимальное hello, hello пропускная способность и время выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-165">This is dependent on hello supplied `x-ms-max-item-count`, hello number of items that can be fit within hello maximum response payload size, hello provisioned throughput, and query execution time.</span></span> |  
| `x-ms-continuation:` | <span data-ttu-id="00bbf-166">Hello продолжение токена tooresume выполнение запроса hello, если доступны дополнительные результаты.</span><span class="sxs-lookup"><span data-stu-id="00bbf-166">hello continuation token tooresume execution of hello query, if additional results are available.</span></span> | 
| `x-ms-documentdb-query-metrics` | <span data-ttu-id="00bbf-167">Статистика запросов Hello для выполнения hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-167">hello query statistics for hello execution.</span></span> <span data-ttu-id="00bbf-168">Это строка с разделителями, содержащий статистику времени, затраченного в hello этапах выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-168">This is a delimited string containing statistics of time spent in hello various phases of query execution.</span></span> <span data-ttu-id="00bbf-169">Возвращается, если `x-ms-documentdb-populatequerymetrics` задано слишком`True`.</span><span class="sxs-lookup"><span data-stu-id="00bbf-169">Returned if `x-ms-documentdb-populatequerymetrics` is set too`True`.</span></span> | 
| `x-ms-request-charge` | <span data-ttu-id="00bbf-170">Здравствуйте, число [единиц запросов](request-units.md) занятая hello запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-170">hello number of [request units](request-units.md) consumed by hello query.</span></span> | 

<span data-ttu-id="00bbf-171">Дополнительные сведения о параметрах и заголовки запроса API-интерфейса REST hello. в разделе [запросы к ресурсам с помощью DocumentDB REST API hello](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span><span class="sxs-lookup"><span data-stu-id="00bbf-171">For details on hello REST API request headers and options, see [Querying resources using hello DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span></span>

## <a name="best-practices-for-query-performance"></a><span data-ttu-id="00bbf-172">Рекомендации по повышению производительности запросов</span><span class="sxs-lookup"><span data-stu-id="00bbf-172">Best practices for query performance</span></span>
<span data-ttu-id="00bbf-173">Здесь представлены Hello hello наиболее распространенные факторы, которые повлиять на производительность запроса Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="00bbf-173">hello following are hello most common factors that impact Azure Cosmos DB query performance.</span></span> <span data-ttu-id="00bbf-174">Мы подробно рассмотрим каждую из этих тем в этой статье.</span><span class="sxs-lookup"><span data-stu-id="00bbf-174">We dig deeper into each of these topics in this article.</span></span>

| <span data-ttu-id="00bbf-175">Коэффициент</span><span class="sxs-lookup"><span data-stu-id="00bbf-175">Factor</span></span> | <span data-ttu-id="00bbf-176">Подсказка</span><span class="sxs-lookup"><span data-stu-id="00bbf-176">Tip</span></span> | 
| ------ | -----| 
| <span data-ttu-id="00bbf-177">Подготовленная пропускная способность</span><span class="sxs-lookup"><span data-stu-id="00bbf-177">Provisioned throughput</span></span> | <span data-ttu-id="00bbf-178">Измерения RU каждого запроса и убедитесь, что hello требуется пропускная способность для запросов.</span><span class="sxs-lookup"><span data-stu-id="00bbf-178">Measure RU per query, and ensure that you have hello required provisioned throughput for your queries.</span></span> | 
| <span data-ttu-id="00bbf-179">Секционирование и ключи секций</span><span class="sxs-lookup"><span data-stu-id="00bbf-179">Partitioning and partition keys</span></span> | <span data-ttu-id="00bbf-180">Предпочитать запросов со значением ключа секции hello в предложении фильтрации hello для низкой задержкой.</span><span class="sxs-lookup"><span data-stu-id="00bbf-180">Favor queries with hello partition key value in hello filter clause for low latency.</span></span> |
| <span data-ttu-id="00bbf-181">Параметры пакета SDK и запроса</span><span class="sxs-lookup"><span data-stu-id="00bbf-181">SDK and query options</span></span> | <span data-ttu-id="00bbf-182">Следуйте рекомендациям по работе с пакетами SDK, таким как прямое подключение, а также настройте параметры выполнения запросов на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="00bbf-182">Follow SDK best practices like direct connectivity, and tune client-side query execution options.</span></span> |
| <span data-ttu-id="00bbf-183">Задержки сети</span><span class="sxs-lookup"><span data-stu-id="00bbf-183">Network latency</span></span> | <span data-ttu-id="00bbf-184">Учетная запись для сетевых ресурсов на измерения и использовать множественной адресацией tooread API-интерфейсы из hello ближайший регион.</span><span class="sxs-lookup"><span data-stu-id="00bbf-184">Account for network overhead in measurement, and use multi-homing APIs tooread from hello nearest region.</span></span> |
| <span data-ttu-id="00bbf-185">Политика индексации</span><span class="sxs-lookup"><span data-stu-id="00bbf-185">Indexing Policy</span></span> | <span data-ttu-id="00bbf-186">Проверьте наличие необходимых hello пути/политике индексирования для запроса hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-186">Ensure that you have hello required indexing paths/policy for hello query.</span></span> |
| <span data-ttu-id="00bbf-187">Метрики выполнения запросов</span><span class="sxs-lookup"><span data-stu-id="00bbf-187">Query execution metrics</span></span> | <span data-ttu-id="00bbf-188">Анализ hello запроса выполнения метрики tooidentify потенциальных реструктуризации запросов и данных фигуры.</span><span class="sxs-lookup"><span data-stu-id="00bbf-188">Analyze hello query execution metrics tooidentify potential rewrites of query and data shapes.</span></span>  |

### <a name="provisioned-throughput"></a><span data-ttu-id="00bbf-189">Подготовленная пропускная способность</span><span class="sxs-lookup"><span data-stu-id="00bbf-189">Provisioned throughput</span></span>
<span data-ttu-id="00bbf-190">В Cosmos DB контейнеры данных создаются c зарезервированной пропускной способностью, выраженной в единицах запроса (ЕЗ) в секунду.</span><span class="sxs-lookup"><span data-stu-id="00bbf-190">In Cosmos DB, you create containers of data, each with reserved throughput expressed in request units (RU) per-second.</span></span> <span data-ttu-id="00bbf-191">Чтение документа 1 КБ — 1 RU, а каждая операция (включая запросы) — нормализованный tooa фиксированное число RUs, в зависимости от его сложности.</span><span class="sxs-lookup"><span data-stu-id="00bbf-191">A read of a 1-KB document is 1 RU, and every operation (including queries) is normalized tooa fixed number of RUs based on its complexity.</span></span> <span data-ttu-id="00bbf-192">Например, при наличии 1000 ЕЗ в секунду, подготовленных для контейнера, и запроса, например `SELECT * FROM c WHERE c.city = 'Seattle'`, который использует 5 ЕЗ, можно выполнить 200 таких запросов в секунду ((1000 ЕЗ/с) / (5 ЕЗ/запрос) = 200 ЕЗ).</span><span class="sxs-lookup"><span data-stu-id="00bbf-192">For example, if you have 1000 RU/s provisioned for your container, and you have a query like `SELECT * FROM c WHERE c.city = 'Seattle'` that consumes 5 RUs, then you can perform (1000 RU/s) / (5 RU/query) = 200 query/s such queries per second.</span></span> 

<span data-ttu-id="00bbf-193">Если отправить более чем 200 запросов в секунду, hello служба запускает ограничение скорости входящие запросы, превышающие 200 в секунду.</span><span class="sxs-lookup"><span data-stu-id="00bbf-193">If you submit more than 200 queries/sec, hello service starts rate-limiting incoming requests above 200/s.</span></span> <span data-ttu-id="00bbf-194">Hello SDK автоматически этот случай, выполняя отсрочки и повторов, таким образом можно заметить большее время задержки для таких запросов.</span><span class="sxs-lookup"><span data-stu-id="00bbf-194">hello SDKs automatically handle this case by performing a backoff/retry, therefore you might notice a higher latency for these queries.</span></span> <span data-ttu-id="00bbf-195">Увеличение toohello пропускной способности hello подготовлены необходимые значение повышает запроса задержки и пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="00bbf-195">Increasing hello provisioned throughput toohello required value improves your query latency and throughput.</span></span> 

<span data-ttu-id="00bbf-196">toolearn Дополнительные сведения о единицах запроса см [единиц запросов](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="00bbf-196">toolearn more about request units, see [Request units](request-units.md).</span></span>

### <a name="partitioning-and-partition-keys"></a><span data-ttu-id="00bbf-197">Секционирование и ключи секций</span><span class="sxs-lookup"><span data-stu-id="00bbf-197">Partitioning and partition keys</span></span>
<span data-ttu-id="00bbf-198">С помощью DB Cosmos Azure обычно запросы выполняют в hello последовательностью из самый быстрый и наиболее эффективного tooslower или менее эффективным.</span><span class="sxs-lookup"><span data-stu-id="00bbf-198">With Azure Cosmos DB, typically queries perform in hello following order from fastest/most efficient tooslower/less efficient.</span></span> 

* <span data-ttu-id="00bbf-199">запросы GET к одному ключу секции и ключу элемента;</span><span class="sxs-lookup"><span data-stu-id="00bbf-199">GET on a single partition key and item key</span></span>
* <span data-ttu-id="00bbf-200">запрос с предложением фильтра к одному ключу секции;</span><span class="sxs-lookup"><span data-stu-id="00bbf-200">Query with a filter clause on a single partition key</span></span>
* <span data-ttu-id="00bbf-201">запрос без равенства или предложения диапазона фильтра для любого свойства;</span><span class="sxs-lookup"><span data-stu-id="00bbf-201">Query without an equality or range filter clause on any property</span></span>
* <span data-ttu-id="00bbf-202">запрос без фильтров.</span><span class="sxs-lookup"><span data-stu-id="00bbf-202">Query without filters</span></span>

<span data-ttu-id="00bbf-203">Запросы, необходимость tooconsult секции требуется большее время задержки и может использовать RUs выше.</span><span class="sxs-lookup"><span data-stu-id="00bbf-203">Queries that need tooconsult all partitions need higher latency, and can consume higher RUs.</span></span> <span data-ttu-id="00bbf-204">Поскольку каждая секция имеет автоматического индексирования для всех свойств, hello запрос может быть предоставлен эффективно из индекса hello в этом случае.</span><span class="sxs-lookup"><span data-stu-id="00bbf-204">Since each partition has automatic indexing against all properties, hello query can be served efficiently from hello index in this case.</span></span> <span data-ttu-id="00bbf-205">Можно создать запросы, охватывающие быстрее секций с помощью параметров параллелизма hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-205">You can make queries that span partitions faster by using hello parallelism options.</span></span>

<span data-ttu-id="00bbf-206">toolearn Дополнительные сведения о секционировании и разделов, в разделе [секционирования в базе данных Azure Cosmos](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="00bbf-206">toolearn more about partitioning and partition keys, see [Partitioning in Azure Cosmos DB](partition-data.md).</span></span>

### <a name="sdk-and-query-options"></a><span data-ttu-id="00bbf-207">Параметры пакета SDK и запроса</span><span class="sxs-lookup"><span data-stu-id="00bbf-207">SDK and query options</span></span>
<span data-ttu-id="00bbf-208">В разделе [советы по повышению производительности](performance-tips.md) и [тестирование производительности](performance-testing.md) для как tooget hello лучше всего производительности на стороне клиента из базы данных Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="00bbf-208">See [Performance Tips](performance-tips.md) and [Performance testing](performance-testing.md) for how tooget hello best client-side performance from Azure Cosmos DB.</span></span> <span data-ttu-id="00bbf-209">Сюда относится использование hello последние пакеты SDK, конфигурациями платформой, такими как количество подключений, частоту сбора мусора по умолчанию настройки и использования упрощенных подключения вариантах, например Direct и TCP.</span><span class="sxs-lookup"><span data-stu-id="00bbf-209">This includes using hello latest SDKs, configuring platform-specific configurations like default number of connections, frequency of garbage collection, and using lightweight connectivity options like Direct/TCP.</span></span> 


#### <a name="max-item-count"></a><span data-ttu-id="00bbf-210">Максимальное количество элементов</span><span class="sxs-lookup"><span data-stu-id="00bbf-210">Max Item Count</span></span>
<span data-ttu-id="00bbf-211">Для запросов, hello значение `MaxItemCount` может оказать значительное влияние на время конца в конец запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-211">For queries, hello value of `MaxItemCount` can have a significant impact on end-to-end query time.</span></span> <span data-ttu-id="00bbf-212">Каждое обращение toohello сервер будет возвращать не больше, чем hello число элементов в `MaxItemCount` (по умолчанию 100 элементов).</span><span class="sxs-lookup"><span data-stu-id="00bbf-212">Each round trip toohello server will return no more than hello number of items in `MaxItemCount` (Default of 100 items).</span></span> <span data-ttu-id="00bbf-213">Установка этого значения выше tooa (-1, максимальное и рекомендуемые) улучшит ваш общую длительность запроса, ограничивая hello количества циклов обмена данными между сервером и клиентом, особенно при обработке запросов с большими результирующими наборами.</span><span class="sxs-lookup"><span data-stu-id="00bbf-213">Setting this tooa higher value (-1 is maximum, and recommended) will improve your query duration overall by limiting hello number of round trips between server and client, especially for queries with large result sets.</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxItemCount = -1, 
    }).AsDocumentQuery();
```

#### <a name="max-degree-of-parallelism"></a><span data-ttu-id="00bbf-214">Максимальная степень параллелизма</span><span class="sxs-lookup"><span data-stu-id="00bbf-214">Max Degree of Parallelism</span></span>
<span data-ttu-id="00bbf-215">Для запросов, настройки hello `MaxDegreeOfParallelism` tooidentify hello наилучшие конфигурации для приложения, особенно в том случае, если выполнить запросы между разделами (без фильтра для значения ключа раздела hello).</span><span class="sxs-lookup"><span data-stu-id="00bbf-215">For queries, tune hello `MaxDegreeOfParallelism` tooidentify hello best configurations for your application, especially if you perform cross-partition queries (without a filter on hello partition-key value).</span></span> <span data-ttu-id="00bbf-216">`MaxDegreeOfParallelism`Управляет hello максимальное число параллельных задач, т. е. более hello toobe секций посетит в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="00bbf-216">`MaxDegreeOfParallelism`  controls hello maximum number of parallel tasks, i.e., hello maximum of partitions toobe visited in parallel.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();
```

<span data-ttu-id="00bbf-217">Предположим следующее:</span><span class="sxs-lookup"><span data-stu-id="00bbf-217">Let’s assume that</span></span>
* <span data-ttu-id="00bbf-218">D = по умолчанию максимальное число параллельных задач (= общее количество процессоров в hello клиентского компьютера)</span><span class="sxs-lookup"><span data-stu-id="00bbf-218">D = Default Maximum number of parallel tasks (= total number of processor in hello client machine)</span></span>
* <span data-ttu-id="00bbf-219">P — определенное пользователем максимальное число параллельных задач;</span><span class="sxs-lookup"><span data-stu-id="00bbf-219">P = User-specified maximum number of parallel tasks</span></span>
* <span data-ttu-id="00bbf-220">N = число секций, которое требуется toobe посетил ответов на запросы</span><span class="sxs-lookup"><span data-stu-id="00bbf-220">N = Number of partitions that needs  toobe visited for answering a query</span></span>

<span data-ttu-id="00bbf-221">Ниже приведены последствия как hello параллельные запросы будут работать с различными значениями P.</span><span class="sxs-lookup"><span data-stu-id="00bbf-221">Following are implications of how hello parallel queries would behave for different values of P.</span></span>
* <span data-ttu-id="00bbf-222">(P == 0) => последовательный режим;</span><span class="sxs-lookup"><span data-stu-id="00bbf-222">(P == 0) => Serial Mode</span></span>
* <span data-ttu-id="00bbf-223">(P == 1) => не более одной задачи;</span><span class="sxs-lookup"><span data-stu-id="00bbf-223">(P == 1) => Maximum of one task</span></span>
* <span data-ttu-id="00bbf-224">(P > 1) => минимум (P, N) параллельных задач;</span><span class="sxs-lookup"><span data-stu-id="00bbf-224">(P > 1) => Min (P, N) parallel tasks</span></span> 
* <span data-ttu-id="00bbf-225">(P < 1) => минимум (N, D) параллельных задач.</span><span class="sxs-lookup"><span data-stu-id="00bbf-225">(P < 1) => Min (N, D) parallel tasks</span></span>

<span data-ttu-id="00bbf-226">Заметки о выпуске пакета SDK и сведения о реализованных классах и методах см. в статье [Пакет SDK для DocumentDB .NET: скачивание и заметки о выпуске](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="00bbf-226">For SDK release notes, and details on implemented classes and methods see [DocumentDB SDKs](documentdb-sdk-dotnet.md)</span></span>

### <a name="network-latency"></a><span data-ttu-id="00bbf-227">Задержки сети</span><span class="sxs-lookup"><span data-stu-id="00bbf-227">Network latency</span></span>
<span data-ttu-id="00bbf-228">. В разделе [глобального распространения Azure Cosmos DB](tutorial-global-distribution-documentdb.md) tooset копию глобального распространения и подключения toohello ближайший регион.</span><span class="sxs-lookup"><span data-stu-id="00bbf-228">See [Azure Cosmos DB global distribution](tutorial-global-distribution-documentdb.md) for how tooset up global distribution, and connect toohello closest region.</span></span> <span data-ttu-id="00bbf-229">Задержки в сети имеет значительное влияние на производительность запроса, когда необходимо toomake несколько циклов приема-передачи или получения больших результирующих наборов из запроса hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-229">Network latency has a significant impact on query performance when you need toomake multiple round-trips or retrieve a large result set from hello query.</span></span> 

<span data-ttu-id="00bbf-230">Hello на метрик выполнения запроса объясняется, как tooretrieve hello server времени выполнения запросов ( `totalExecutionTimeInMs`), чтобы различать время, затраченное на выполнение запроса и время, затраченное в транзитной сети.</span><span class="sxs-lookup"><span data-stu-id="00bbf-230">hello section on query execution metrics explains how tooretrieve hello server execution time of queries ( `totalExecutionTimeInMs`), so that you can differentiate between time spent in query execution and time spent in network transit.</span></span>

### <a name="indexing-policy"></a><span data-ttu-id="00bbf-231">Политика индексации</span><span class="sxs-lookup"><span data-stu-id="00bbf-231">Indexing policy</span></span>
<span data-ttu-id="00bbf-232">Чтобы узнать о путях индексирования, типах, режимах и их влиянии на выполнение запроса, перейдите к статье [Как работает индексирование данных в Azure Cosmos DB?](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="00bbf-232">See [Configuring indexing policy](indexing-policies.md) for indexing paths, kinds, and modes, and how they impact query execution.</span></span> <span data-ttu-id="00bbf-233">По умолчанию hello политика индексирования использует хэш индексирования для строк, действующая для запросов равенства, но не для диапазона запросы/order запросами.</span><span class="sxs-lookup"><span data-stu-id="00bbf-233">By default, hello indexing policy uses Hash indexing for strings, which is effective for equality queries, but not for range queries/order by queries.</span></span> <span data-ttu-id="00bbf-234">Если вам требуется запросов в диапазоне строк, рекомендуется указывать hello диапазона тип индекса для всех строк.</span><span class="sxs-lookup"><span data-stu-id="00bbf-234">If you need range queries for strings, we recommend specifying hello Range index type for all strings.</span></span> 

## <a name="query-execution-metrics"></a><span data-ttu-id="00bbf-235">Метрики выполнения запросов</span><span class="sxs-lookup"><span data-stu-id="00bbf-235">Query execution metrics</span></span>
<span data-ttu-id="00bbf-236">Подробные метрики для выполнения запроса можно получить, передав ему hello необязательно `x-ms-documentdb-populatequerymetrics` заголовок (`FeedOptions.PopulateQueryMetrics` в hello .NET SDK).</span><span class="sxs-lookup"><span data-stu-id="00bbf-236">You can obtain detailed metrics on query execution by passing in hello optional `x-ms-documentdb-populatequerymetrics` header (`FeedOptions.PopulateQueryMetrics` in hello .NET SDK).</span></span> <span data-ttu-id="00bbf-237">Здравствуйте, значение, возвращаемое в `x-ms-documentdb-query-metrics` имеет hello следующие пары ключ значение, предназначенные для дополнительной диагностики выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="00bbf-237">hello value returned in `x-ms-documentdb-query-metrics` has hello following key-value pairs meant for advanced troubleshooting of query execution.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();

// Returns metrics by partition key range Id
IReadOnlyDictionary<string, QueryMetrics> metrics = result.QueryMetrics;

```

| <span data-ttu-id="00bbf-238">Метрика</span><span class="sxs-lookup"><span data-stu-id="00bbf-238">Metric</span></span> | <span data-ttu-id="00bbf-239">Единица измерения</span><span class="sxs-lookup"><span data-stu-id="00bbf-239">Unit</span></span> | <span data-ttu-id="00bbf-240">Описание</span><span class="sxs-lookup"><span data-stu-id="00bbf-240">Description</span></span> | 
| ------ | -----| ----------- |
| `totalExecutionTimeInMs` | <span data-ttu-id="00bbf-241">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-241">milliseconds</span></span> | <span data-ttu-id="00bbf-242">Время выполнения запроса</span><span class="sxs-lookup"><span data-stu-id="00bbf-242">Query execution time</span></span> | 
| `queryCompileTimeInMs` | <span data-ttu-id="00bbf-243">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-243">milliseconds</span></span> | <span data-ttu-id="00bbf-244">Время компиляции запроса</span><span class="sxs-lookup"><span data-stu-id="00bbf-244">Query compile time</span></span>  | 
| `queryLogicalPlanBuildTimeInMs` | <span data-ttu-id="00bbf-245">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-245">milliseconds</span></span> | <span data-ttu-id="00bbf-246">План логических запроса toobuild времени</span><span class="sxs-lookup"><span data-stu-id="00bbf-246">Time toobuild logical query plan</span></span> | 
| `queryPhysicalPlanBuildTimeInMs` | <span data-ttu-id="00bbf-247">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-247">milliseconds</span></span> | <span data-ttu-id="00bbf-248">План физического запроса toobuild времени</span><span class="sxs-lookup"><span data-stu-id="00bbf-248">Time toobuild physical query plan</span></span> | 
| `queryOptimizationTimeInMs` | <span data-ttu-id="00bbf-249">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-249">milliseconds</span></span> | <span data-ttu-id="00bbf-250">Время, затраченное на оптимизацию запроса</span><span class="sxs-lookup"><span data-stu-id="00bbf-250">Time spent in optimizing query</span></span> | 
| `VMExecutionTimeInMs` | <span data-ttu-id="00bbf-251">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-251">milliseconds</span></span> | <span data-ttu-id="00bbf-252">Время, затраченное в среде выполнения запроса</span><span class="sxs-lookup"><span data-stu-id="00bbf-252">Time spent in query runtime</span></span> | 
| `indexLookupTimeInMs` | <span data-ttu-id="00bbf-253">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-253">milliseconds</span></span> | <span data-ttu-id="00bbf-254">Время, затраченное на физическом уровне индекса</span><span class="sxs-lookup"><span data-stu-id="00bbf-254">Time spent in physical index layer</span></span> | 
| `documentLoadTimeInMs` | <span data-ttu-id="00bbf-255">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-255">milliseconds</span></span> | <span data-ttu-id="00bbf-256">Время, затраченное на загрузку документов</span><span class="sxs-lookup"><span data-stu-id="00bbf-256">Time spent in loading documents</span></span>  | 
| `systemFunctionExecuteTimeInMs` | <span data-ttu-id="00bbf-257">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-257">milliseconds</span></span> | <span data-ttu-id="00bbf-258">Общее время, затраченное на выполнение (встроенных) функций системы (в миллисекундах)</span><span class="sxs-lookup"><span data-stu-id="00bbf-258">Total time spent executing system (built-in) functions in milliseconds</span></span>  | 
| `userFunctionExecuteTimeInMs` | <span data-ttu-id="00bbf-259">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-259">milliseconds</span></span> | <span data-ttu-id="00bbf-260">Общее время, затраченное на выполнение определяемых пользователем функций (в миллисекундах)</span><span class="sxs-lookup"><span data-stu-id="00bbf-260">Total time spent executing user-defined functions in milliseconds</span></span> | 
| `retrievedDocumentCount` | <span data-ttu-id="00bbf-261">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-261">milliseconds</span></span> | <span data-ttu-id="00bbf-262">Общее число полученных документов</span><span class="sxs-lookup"><span data-stu-id="00bbf-262">Total number of retrieved documents</span></span>  | 
| `retrievedDocumentSize` | <span data-ttu-id="00bbf-263">Байты</span><span class="sxs-lookup"><span data-stu-id="00bbf-263">bytes</span></span> | <span data-ttu-id="00bbf-264">Общий размер полученных документов в байтах</span><span class="sxs-lookup"><span data-stu-id="00bbf-264">Total size of retrieved documents in bytes</span></span>  | 
| `outputDocumentCount` | <span data-ttu-id="00bbf-265">count</span><span class="sxs-lookup"><span data-stu-id="00bbf-265">count</span></span> | <span data-ttu-id="00bbf-266">Количество выходных документов</span><span class="sxs-lookup"><span data-stu-id="00bbf-266">Number of output documents</span></span> | 
| `writeOutputTimeInMs` | <span data-ttu-id="00bbf-267">Миллисекунды</span><span class="sxs-lookup"><span data-stu-id="00bbf-267">milliseconds</span></span> | <span data-ttu-id="00bbf-268">Время выполнения запроса в миллисекундах</span><span class="sxs-lookup"><span data-stu-id="00bbf-268">Query execution time in milliseconds</span></span> | 
| `indexUtilizationRatio` | <span data-ttu-id="00bbf-269">Коэффициент (<=1)</span><span class="sxs-lookup"><span data-stu-id="00bbf-269">ratio (<=1)</span></span> | <span data-ttu-id="00bbf-270">Отношение числа документов, совпадающих с hello фильтра toohello количество документов, загружаемых</span><span class="sxs-lookup"><span data-stu-id="00bbf-270">Ratio of number of documents matched by hello filter toohello number of documents loaded</span></span>  | 

<span data-ttu-id="00bbf-271">Hello клиенту пакетов SDK может внутренне выполнять несколько операций tooserve hello запроса в каждой секции.</span><span class="sxs-lookup"><span data-stu-id="00bbf-271">hello client SDKs may internally make multiple query operations tooserve hello query within each partition.</span></span> <span data-ttu-id="00bbf-272">Hello клиент делает более одного вызова каждого раздела Если превышен hello всего результатов `x-ms-max-item-count`, если запрос hello превышает пропускная способность hello для секции hello, или если hello полезных данных запроса достигается максимальный размер hello на каждой странице, или если hello запрос достигает hello система выделенной предельное время ожидания.</span><span class="sxs-lookup"><span data-stu-id="00bbf-272">hello client makes more than one call per-partition if hello total results exceed `x-ms-max-item-count`, if hello query exceeds hello provisioned throughput for hello partition, or if hello query payload reaches hello maximum size per page, or if hello query reaches hello system allocated timeout limit.</span></span> <span data-ttu-id="00bbf-273">Каждое частичное выполнение запроса возвращает `x-ms-documentdb-query-metrics` такой страницы.</span><span class="sxs-lookup"><span data-stu-id="00bbf-273">Each partial query execution returns a `x-ms-documentdb-query-metrics` for that page.</span></span> 

<span data-ttu-id="00bbf-274">Ниже приведены некоторые примеры запросов и как toointerpret некоторые показатели hello возвращенные при выполнении запроса:</span><span class="sxs-lookup"><span data-stu-id="00bbf-274">Here are some sample queries, and how toointerpret some of hello metrics returned from query execution:</span></span> 

| <span data-ttu-id="00bbf-275">Запрос</span><span class="sxs-lookup"><span data-stu-id="00bbf-275">Query</span></span> | <span data-ttu-id="00bbf-276">Образец метрики</span><span class="sxs-lookup"><span data-stu-id="00bbf-276">Sample Metric</span></span> | <span data-ttu-id="00bbf-277">Описание</span><span class="sxs-lookup"><span data-stu-id="00bbf-277">Description</span></span> | 
| ------ | -----| ----------- |
| `SELECT TOP 100 * FROM c` | `"RetrievedDocumentCount": 101` | <span data-ttu-id="00bbf-278">Hello количество документов, полученных 100 + 1 toomatch предложение TOP hello.</span><span class="sxs-lookup"><span data-stu-id="00bbf-278">hello number of documents retrieved is 100+1 toomatch hello TOP clause.</span></span> <span data-ttu-id="00bbf-279">Время запроса главным образом тратится на `WriteOutputTime` и `DocumentLoadTime`, так как он выполняет сканирование.</span><span class="sxs-lookup"><span data-stu-id="00bbf-279">Query time is mostly spent in `WriteOutputTime` and `DocumentLoadTime` since it is a scan.</span></span> | 
| `SELECT TOP 500 * FROM c` | `"RetrievedDocumentCount": 501` | <span data-ttu-id="00bbf-280">RetrievedDocumentCount теперь является более поздней версии (500 + 1 toomatch hello предложения TOP).</span><span class="sxs-lookup"><span data-stu-id="00bbf-280">RetrievedDocumentCount is now higher (500+1 toomatch hello TOP clause).</span></span> | 
| `SELECT * FROM c WHERE c.N = 55` | `"IndexLookupTime": "00:00:00.0009500"` | <span data-ttu-id="00bbf-281">Около 0,9 мс затрачивается IndexLookupTime на поиск ключа, так как это поиск по индексу `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="00bbf-281">About 0.9 ms is spent in IndexLookupTime for a key lookup, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT * FROM c WHERE c.N > 55` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="00bbf-282">Немного больше времени (1,7 мс) затрачивается IndexLookupTime на сканирование диапазона, так как это поиск по индексу `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="00bbf-282">Slightly more time (1.7 ms) spent in IndexLookupTime over a range scan, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT TOP 500 c.N FROM c` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="00bbf-283">На `DocumentLoadTime` затрачивается то же время, что и в предыдущих запросах, но с меньшим `WriteOutputTime`, так как мы отображаем только одно свойство.</span><span class="sxs-lookup"><span data-stu-id="00bbf-283">Same time spent on `DocumentLoadTime` as previous queries, but lower `WriteOutputTime` because we're projecting only one property.</span></span> | 
| `SELECT TOP 500 udf.toPercent(c.N) FROM c` | `"UserDefinedFunctionExecutionTime": "00:00:00.2136500"` | <span data-ttu-id="00bbf-284">Около 213 ms, затраченное на `UserDefinedFunctionExecutionTime` выполнение hello определяемой пользователем функции для каждого значения `c.N`.</span><span class="sxs-lookup"><span data-stu-id="00bbf-284">About 213 ms is spent in `UserDefinedFunctionExecutionTime` executing hello UDF on each value of `c.N`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(c.Name, 'Den')` | `"IndexLookupTime": "00:00:00.0006400", "SystemFunctionExecutionTime": "00:00:00.0074100"` | <span data-ttu-id="00bbf-285">Около 0,6 мс затрачивается `IndexLookupTime` на `/Name/?`.</span><span class="sxs-lookup"><span data-stu-id="00bbf-285">About 0.6 ms is spent in `IndexLookupTime` on `/Name/?`.</span></span> <span data-ttu-id="00bbf-286">Большая часть hello запроса времени выполнения (мс ~ 7) в `SystemFunctionExecutionTime`.</span><span class="sxs-lookup"><span data-stu-id="00bbf-286">Most of hello query execution time (~7 ms) in `SystemFunctionExecutionTime`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(LOWER(c.Name), 'den')` | `"IndexLookupTime": "00:00:00", "RetrievedDocumentCount": 2491,  "OutputDocumentCount": 500` | <span data-ttu-id="00bbf-287">Запрос выполняется как операция сканирования, так как он использует `LOWER`, и 500 из 2491 полученных документов возвращаются.</span><span class="sxs-lookup"><span data-stu-id="00bbf-287">Query is performed as a scan because it uses `LOWER`, and 500 out of 2491 retrieved documents are returned.</span></span> |


## <a name="next-steps"></a><span data-ttu-id="00bbf-288">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="00bbf-288">Next steps</span></span>
* <span data-ttu-id="00bbf-289">toolearn об операторах запросов SQL поддерживается hello и ключевые слова, в разделе [SQL-запроса](documentdb-sql-query.md).</span><span class="sxs-lookup"><span data-stu-id="00bbf-289">toolearn about hello supported SQL query operators and keywords, see [SQL query](documentdb-sql-query.md).</span></span> 
* <span data-ttu-id="00bbf-290">в разделе toolearn о единицах запроса [единиц запросов](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="00bbf-290">toolearn about request units, see [request units](request-units.md).</span></span>
* <span data-ttu-id="00bbf-291">toolearn о политике индексирования. в разделе [политика индексирования](indexing-policies.md)</span><span class="sxs-lookup"><span data-stu-id="00bbf-291">toolearn about indexing policy, see [indexing policy](indexing-policies.md)</span></span> 


