---
title: "aaaOnline резервного копирования и восстановления с помощью Azure Cosmos DB | Документы Microsoft"
description: "Узнайте, как tooperform автоматического резервного копирования и восстановления в базе данных Azure Cosmos DB."
keywords: "архивация и восстановление, оперативная архивация"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: a0b464c95681dfc7b5462b02bf04c2c43d6bc16f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a>Автоматическая оперативная архивация и восстановление с помощью Azure Cosmos DB
Azure Cosmos DB автоматически выполняет архивацию всех ваших данных с регулярными интервалами. Автоматическое создание резервных копий Hello берутся без влияния на производительность hello или доступность операции базы данных. Для обеспечения устойчивости в случае региональной аварии все архивные копии хранятся отдельно в другой службе хранилища, а также глобально реплицируются. Автоматическое создание резервных копий Hello предназначены для сценариев, если случайно удален контейнер Comos DB и более поздних версий требуется решение аварийного восстановления или восстановления данных.  

В этой статье начинается с краткое обобщение hello избыточность данных и доступности в Cosmos DB и затем рассматриваются резервные копии. 

## <a name="high-availability-with-cosmos-db---a-recap"></a>Высокая доступность в Cosmos DB — обзор
Cosmos DB является спроектированный toobe [распределенной](distribute-data-globally.md) — с ее помощью можно tooscale пропускной способности по нескольким регионам Azure, наряду с основе перехода на другой ресурс и прозрачный множественной адресацией API политики. Как это предложение системы базы данных [99,99% доступности соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/cosmos-db), все операции записи hello в Cosmos DB — устойчивую запись всех зафиксированных toolocal диски с реплики в локальном центре обработки данных до подтверждения toohello клиента. Обратите внимание, что высокий уровень доступности hello Cosmos DB зависит от локального хранилища не зависит от технологии любого внешнего хранилища. Кроме того, если ваша учетная запись базы данных связана с более чем одним регионом Azure, то ваши операции записи также реплицируются между другими регионами. tooscale пропускной способности и доступа к данных с низкой задержкой, может иметь как многие чтения областей, связанных с учетной записью базы данных, сколько пожелаете. В каждой области чтения hello (репликация) данные надежно сохраняются в наборе реплик.  

Стремительного hello, следующая схема является один контейнер Cosmos DB [горизонтально секционированные](partition-data.md). «Секции» обозначается кружком в hello, следующая схема, и каждая секция имеет высокой надежности через набор реплик. Это локальный распространяющий hello в одном регионе Azure (обозначается hello ось X). Кроме того каждой секции (с его соответствующего набора реплик) затем глобально распределяется по нескольким регионам, связанные с учетной записью базы данных (например, в этом рисунке hello три области — Восток США, Запад США и центральной Индии). Hello «набор разделов» является глобально распределенная сущности, из которых состоит из нескольких копий данных в каждом регионе (обозначается оси hello Y). Можно назначить приоритет toohello областей, связанных с учетной записью базы данных и Cosmos базы данных будут прозрачно следующую область toohello перехода на другой ресурс в случае сбоя. Вы можете также вручную имитировать отработки отказа hello tootest конца в конец доступность приложения.  

Hello на рисунке ниже показана hello высокую степень избыточности с помощью Cosmos DB.

![Высокая степень избыточности, обеспечиваемая Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Высокая степень избыточности, обеспечиваемая Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a>Полная, автоматическая и оперативная архивация
Что, если вы удалили свой контейнер или базу данных? С помощью Cosmos DB не только на данные, но hello резервные копии данных вносятся аварий tooregional высокой избыточностью и надежность. В настоящее время такая автоматическая архивация выполняется примерно каждые четыре часа, и последние 2 резервные копии всегда сохраняются. Если hello данных будет случайно удален или поврежден, то обратитесь [обратитесь в службу поддержки Azure](https://azure.microsoft.com/support/options/) в течение 8 часов. 

Hello резервные копии создаются без влияния на производительность hello или доступность операции базы данных. Cosmos DB выполняет резервное копирование hello в фоновом режиме hello, без использования вашей подготовленных RUs или влияния на производительность hello и без влияния на доступность базы данных hello. 

В отличие от данных, который хранится в Cosmos DB hello автоматическое создание резервных копий хранятся в службе хранилища больших двоичных объектов. Низкая задержка/эффективный передачи tooguarantee hello, hello моментального снимка резервной копии — отправленного tooan экземпляр хранилища больших двоичных объектов Azure в hello же регионе, что текущий регион записи hello Cosmos DB учетной записи базы данных. Для обеспечения устойчивости против региональной аварии каждый моментальный снимок резервной копии данных в хранилище больших двоичных объектов Azure снова реплицирована с помощью области tooanother географически избыточное хранилище (GRS). Hello следующей диаграмме показан весь контейнер Cosmos DB hello (со всех трех основных разделов на Западе США, в этом примере) резервного копирования в учетной записи удаленного хранилища больших двоичных объектов на Западе США, а затем GRS реплицируются tooEast нам. 

Hello на рисунке ниже показана периодических полные резервные копии всех сущностей Cosmos DB в хранилище Azure GRS.

![Периодически выполняемая полная архивация всех сущностей Cosmos DB в геоизбыточное хранилище Azure](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a>Срок хранения моментального снимка
Как описано выше, Azure Cosmos DB принимает моментальные снимки данных каждые четыре часа и сохраняет hello две последние моментальные снимки всех разделов в течение 30 дней. Согласно требованиям соответствия нормативам по истечении 90 дней моментальные снимки удаляются.

Следует toomaintain собственные моментальные снимки можно использовать параметр tooJSON экспорта hello в hello Azure Cosmos DB [средство переноса данных](import-data.md#export-to-json-file) tooschedule дополнительных резервных копий. 

## <a name="restoring-a-database-from-an-online-backup"></a>Восстановление базы данных из оперативного архива
Если вы случайно удалили базы данных или коллекции, вы можете [файл запрос в службу поддержки](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) или [обратитесь в службу поддержки Azure](https://azure.microsoft.com/support/options/) toorestore hello данные из последней автоматической архивации hello. Toorestore базы данных из-за вызвана повреждением данных, см [обработки повреждение данных](#handling-data-corruption) необходимо tootake дополнительных шагов tooprevent hello поврежденные данные из резервных копий, занимается hello. Для определенного моментального снимка к резервной копии toobe восстановлена Cosmos DB требуется hello данных был доступен для hello длительность hello цикл резервного копирования для данного снимка.

## <a name="handling-data-corruption"></a>Обработка поврежденных данных
Azure Cosmos DB сохраняет hello две последние резервные копии каждой секции в системе hello. Эта модель очень хорошо работает при контейнера (Коллекция документов, диаграммы, таблицы) или базы данных будут случайно удалены с момента последней версии hello могут быть восстановлены. Однако в hello случай, когда пользователи могут представляться вызвана повреждением данных, Azure Cosmos DB не ожидая hello повреждения данных и возможно, что hello повреждение может воздействовать hello резервных копий. Как можно скорее обнаружено повреждение, следует удалить контейнер hello поврежден (коллекции/graph или таблица), чтобы резервные копии были защищены от перезаписи с поврежденные данные. Поскольку hello последней резервной копии может быть четырех часов назад, hello пользователь может применять [изменить веб-канал](change-feed.md) toocapture и хранилище hello последние четыре часа стоит данных перед удалением hello контейнера.

## <a name="next-steps"></a>Дальнейшие действия

tooreplicate базы данных в нескольких центрах обработки данных, в разделе [распределения данных глобально с помощью Cosmos DB](distribute-data-globally.md). 

toofile обратитесь в службу поддержки Azure [файл билет hello портал Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).

