---
title: "aaaOnline резервного копирования и восстановления с помощью Azure Cosmos DB | Документы Microsoft"
description: "Узнайте, как tooperform автоматического резервного копирования и восстановления в базе данных Azure Cosmos DB."
keywords: "архивация и восстановление, оперативная архивация"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: a0b464c95681dfc7b5462b02bf04c2c43d6bc16f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="6b242-104">Автоматическая оперативная архивация и восстановление с помощью Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="6b242-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="6b242-105">Azure Cosmos DB автоматически выполняет архивацию всех ваших данных с регулярными интервалами.</span><span class="sxs-lookup"><span data-stu-id="6b242-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="6b242-106">Автоматическое создание резервных копий Hello берутся без влияния на производительность hello или доступность операции базы данных.</span><span class="sxs-lookup"><span data-stu-id="6b242-106">hello automatic backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="6b242-107">Для обеспечения устойчивости в случае региональной аварии все архивные копии хранятся отдельно в другой службе хранилища, а также глобально реплицируются.</span><span class="sxs-lookup"><span data-stu-id="6b242-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="6b242-108">Автоматическое создание резервных копий Hello предназначены для сценариев, если случайно удален контейнер Comos DB и более поздних версий требуется решение аварийного восстановления или восстановления данных.</span><span class="sxs-lookup"><span data-stu-id="6b242-108">hello automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="6b242-109">В этой статье начинается с краткое обобщение hello избыточность данных и доступности в Cosmos DB и затем рассматриваются резервные копии.</span><span class="sxs-lookup"><span data-stu-id="6b242-109">This article starts with a quick recap of hello data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="6b242-110">Высокая доступность в Cosmos DB — обзор</span><span class="sxs-lookup"><span data-stu-id="6b242-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="6b242-111">Cosmos DB является спроектированный toobe [распределенной](distribute-data-globally.md) — с ее помощью можно tooscale пропускной способности по нескольким регионам Azure, наряду с основе перехода на другой ресурс и прозрачный множественной адресацией API политики.</span><span class="sxs-lookup"><span data-stu-id="6b242-111">Cosmos DB is designed toobe [globally distributed](distribute-data-globally.md) – it allows you tooscale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="6b242-112">Как это предложение системы базы данных [99,99% доступности соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/cosmos-db), все операции записи hello в Cosmos DB — устойчивую запись всех зафиксированных toolocal диски с реплики в локальном центре обработки данных до подтверждения toohello клиента.</span><span class="sxs-lookup"><span data-stu-id="6b242-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all hello writes in Cosmos DB are durably committed toolocal disks by a quorum of replicas within a local data center before acknowledging toohello client.</span></span> <span data-ttu-id="6b242-113">Обратите внимание, что высокий уровень доступности hello Cosmos DB зависит от локального хранилища не зависит от технологии любого внешнего хранилища.</span><span class="sxs-lookup"><span data-stu-id="6b242-113">Note that hello high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="6b242-114">Кроме того, если ваша учетная запись базы данных связана с более чем одним регионом Azure, то ваши операции записи также реплицируются между другими регионами.</span><span class="sxs-lookup"><span data-stu-id="6b242-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="6b242-115">tooscale пропускной способности и доступа к данных с низкой задержкой, может иметь как многие чтения областей, связанных с учетной записью базы данных, сколько пожелаете.</span><span class="sxs-lookup"><span data-stu-id="6b242-115">tooscale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="6b242-116">В каждой области чтения hello (репликация) данные надежно сохраняются в наборе реплик.</span><span class="sxs-lookup"><span data-stu-id="6b242-116">In each read region, hello (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="6b242-117">Стремительного hello, следующая схема является один контейнер Cosmos DB [горизонтально секционированные](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="6b242-117">As illustrated in hello following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="6b242-118">«Секции» обозначается кружком в hello, следующая схема, и каждая секция имеет высокой надежности через набор реплик.</span><span class="sxs-lookup"><span data-stu-id="6b242-118">A “partition” is denoted by a circle in hello following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="6b242-119">Это локальный распространяющий hello в одном регионе Azure (обозначается hello ось X).</span><span class="sxs-lookup"><span data-stu-id="6b242-119">This is hello local distribution within a single Azure region (denoted by hello X axis).</span></span> <span data-ttu-id="6b242-120">Кроме того каждой секции (с его соответствующего набора реплик) затем глобально распределяется по нескольким регионам, связанные с учетной записью базы данных (например, в этом рисунке hello три области — Восток США, Запад США и центральной Индии).</span><span class="sxs-lookup"><span data-stu-id="6b242-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration hello three regions – East US, West US and Central India).</span></span> <span data-ttu-id="6b242-121">Hello «набор разделов» является глобально распределенная сущности, из которых состоит из нескольких копий данных в каждом регионе (обозначается оси hello Y).</span><span class="sxs-lookup"><span data-stu-id="6b242-121">hello “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by hello Y axis).</span></span> <span data-ttu-id="6b242-122">Можно назначить приоритет toohello областей, связанных с учетной записью базы данных и Cosmos базы данных будут прозрачно следующую область toohello перехода на другой ресурс в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="6b242-122">You can assign priority toohello regions associated with your database account and Cosmos DB will transparently failover toohello next region in case of disaster.</span></span> <span data-ttu-id="6b242-123">Вы можете также вручную имитировать отработки отказа hello tootest конца в конец доступность приложения.</span><span class="sxs-lookup"><span data-stu-id="6b242-123">You can also manually simulate failover tootest hello end-to-end availability of your application.</span></span>  

<span data-ttu-id="6b242-124">Hello на рисунке ниже показана hello высокую степень избыточности с помощью Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6b242-124">hello following image illustrates hello high degree of redundancy with Cosmos DB.</span></span>

![Высокая степень избыточности, обеспечиваемая Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Высокая степень избыточности, обеспечиваемая Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="6b242-127">Полная, автоматическая и оперативная архивация</span><span class="sxs-lookup"><span data-stu-id="6b242-127">Full, automatic, online backups</span></span>
<span data-ttu-id="6b242-128">Что, если вы удалили свой контейнер или базу данных?</span><span class="sxs-lookup"><span data-stu-id="6b242-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="6b242-129">С помощью Cosmos DB не только на данные, но hello резервные копии данных вносятся аварий tooregional высокой избыточностью и надежность.</span><span class="sxs-lookup"><span data-stu-id="6b242-129">With Cosmos DB, not only your data, but hello backups of your data are also made highly redundant and resilient tooregional disasters.</span></span> <span data-ttu-id="6b242-130">В настоящее время такая автоматическая архивация выполняется примерно каждые четыре часа, и последние 2 резервные копии всегда сохраняются.</span><span class="sxs-lookup"><span data-stu-id="6b242-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="6b242-131">Если hello данных будет случайно удален или поврежден, то обратитесь [обратитесь в службу поддержки Azure](https://azure.microsoft.com/support/options/) в течение 8 часов.</span><span class="sxs-lookup"><span data-stu-id="6b242-131">If hello data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="6b242-132">Hello резервные копии создаются без влияния на производительность hello или доступность операции базы данных.</span><span class="sxs-lookup"><span data-stu-id="6b242-132">hello backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="6b242-133">Cosmos DB выполняет резервное копирование hello в фоновом режиме hello, без использования вашей подготовленных RUs или влияния на производительность hello и без влияния на доступность базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="6b242-133">Cosmos DB takes hello backup in hello background without consuming your provisioned RUs or affecting hello performance and without affecting hello availability of your database.</span></span> 

<span data-ttu-id="6b242-134">В отличие от данных, который хранится в Cosmos DB hello автоматическое создание резервных копий хранятся в службе хранилища больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="6b242-134">Unlike your data that is stored inside Cosmos DB, hello automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="6b242-135">Низкая задержка/эффективный передачи tooguarantee hello, hello моментального снимка резервной копии — отправленного tooan экземпляр хранилища больших двоичных объектов Azure в hello же регионе, что текущий регион записи hello Cosmos DB учетной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="6b242-135">tooguarantee hello low latency/efficient upload, hello snapshot of your backup is uploaded tooan instance of Azure Blob storage in hello same region as hello current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="6b242-136">Для обеспечения устойчивости против региональной аварии каждый моментальный снимок резервной копии данных в хранилище больших двоичных объектов Azure снова реплицирована с помощью области tooanother географически избыточное хранилище (GRS).</span><span class="sxs-lookup"><span data-stu-id="6b242-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) tooanother region.</span></span> <span data-ttu-id="6b242-137">Hello следующей диаграмме показан весь контейнер Cosmos DB hello (со всех трех основных разделов на Западе США, в этом примере) резервного копирования в учетной записи удаленного хранилища больших двоичных объектов на Западе США, а затем GRS реплицируются tooEast нам.</span><span class="sxs-lookup"><span data-stu-id="6b242-137">hello following diagram shows that hello entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated tooEast US.</span></span> 

<span data-ttu-id="6b242-138">Hello на рисунке ниже показана периодических полные резервные копии всех сущностей Cosmos DB в хранилище Azure GRS.</span><span class="sxs-lookup"><span data-stu-id="6b242-138">hello following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Периодически выполняемая полная архивация всех сущностей Cosmos DB в геоизбыточное хранилище Azure](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="6b242-140">Срок хранения моментального снимка</span><span class="sxs-lookup"><span data-stu-id="6b242-140">Backup retention period</span></span>
<span data-ttu-id="6b242-141">Как описано выше, Azure Cosmos DB принимает моментальные снимки данных каждые четыре часа и сохраняет hello две последние моментальные снимки всех разделов в течение 30 дней.</span><span class="sxs-lookup"><span data-stu-id="6b242-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains hello last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="6b242-142">Согласно требованиям соответствия нормативам по истечении 90 дней моментальные снимки удаляются.</span><span class="sxs-lookup"><span data-stu-id="6b242-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="6b242-143">Следует toomaintain собственные моментальные снимки можно использовать параметр tooJSON экспорта hello в hello Azure Cosmos DB [средство переноса данных](import-data.md#export-to-json-file) tooschedule дополнительных резервных копий.</span><span class="sxs-lookup"><span data-stu-id="6b242-143">If you want toomaintain your own snapshots, you can use hello export tooJSON option in hello Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) tooschedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="6b242-144">Восстановление базы данных из оперативного архива</span><span class="sxs-lookup"><span data-stu-id="6b242-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="6b242-145">Если вы случайно удалили базы данных или коллекции, вы можете [файл запрос в службу поддержки](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) или [обратитесь в службу поддержки Azure](https://azure.microsoft.com/support/options/) toorestore hello данные из последней автоматической архивации hello.</span><span class="sxs-lookup"><span data-stu-id="6b242-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) toorestore hello data from hello last automatic backup.</span></span> <span data-ttu-id="6b242-146">Toorestore базы данных из-за вызвана повреждением данных, см [обработки повреждение данных](#handling-data-corruption) необходимо tootake дополнительных шагов tooprevent hello поврежденные данные из резервных копий, занимается hello.</span><span class="sxs-lookup"><span data-stu-id="6b242-146">If you need toorestore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need tootake additional steps tooprevent hello corrupted data from penetrating hello backups.</span></span> <span data-ttu-id="6b242-147">Для определенного моментального снимка к резервной копии toobe восстановлена Cosmos DB требуется hello данных был доступен для hello длительность hello цикл резервного копирования для данного снимка.</span><span class="sxs-lookup"><span data-stu-id="6b242-147">For a specific snapshot of your backup toobe restored, Cosmos DB requires that hello data was available for hello duration of hello backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="6b242-148">Обработка поврежденных данных</span><span class="sxs-lookup"><span data-stu-id="6b242-148">Handling data corruption</span></span>
<span data-ttu-id="6b242-149">Azure Cosmos DB сохраняет hello две последние резервные копии каждой секции в системе hello.</span><span class="sxs-lookup"><span data-stu-id="6b242-149">Azure Cosmos DB retains hello last two backups of every partition in hello system.</span></span> <span data-ttu-id="6b242-150">Эта модель очень хорошо работает при контейнера (Коллекция документов, диаграммы, таблицы) или базы данных будут случайно удалены с момента последней версии hello могут быть восстановлены.</span><span class="sxs-lookup"><span data-stu-id="6b242-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of hello last versions can be restored.</span></span> <span data-ttu-id="6b242-151">Однако в hello случай, когда пользователи могут представляться вызвана повреждением данных, Azure Cosmos DB не ожидая hello повреждения данных и возможно, что hello повреждение может воздействовать hello резервных копий.</span><span class="sxs-lookup"><span data-stu-id="6b242-151">However, in hello case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of hello data corruption, and it is possible that hello corruption may have penetrated hello backups.</span></span> <span data-ttu-id="6b242-152">Как можно скорее обнаружено повреждение, следует удалить контейнер hello поврежден (коллекции/graph или таблица), чтобы резервные копии были защищены от перезаписи с поврежденные данные.</span><span class="sxs-lookup"><span data-stu-id="6b242-152">As soon as corruption is detected, you should delete hello corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="6b242-153">Поскольку hello последней резервной копии может быть четырех часов назад, hello пользователь может применять [изменить веб-канал](change-feed.md) toocapture и хранилище hello последние четыре часа стоит данных перед удалением hello контейнера.</span><span class="sxs-lookup"><span data-stu-id="6b242-153">Since hello last backup could be four hours old, hello user can employ [change feed](change-feed.md) toocapture and store hello last four hours worth of data before deleting hello container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6b242-154">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="6b242-154">Next steps</span></span>

<span data-ttu-id="6b242-155">tooreplicate базы данных в нескольких центрах обработки данных, в разделе [распределения данных глобально с помощью Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="6b242-155">tooreplicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="6b242-156">toofile обратитесь в службу поддержки Azure [файл билет hello портал Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="6b242-156">toofile contact Azure Support, [file a ticket from hello Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

