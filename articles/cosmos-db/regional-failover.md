---
title: "отработка отказа aaaRegional в базе данных Azure Cosmos | Документы Microsoft"
description: "Сведения о принципах ручной и автоматической отработки отказа в Azure Cosmos DB."
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: 
ms.assetid: 446e2580-ff49-4485-8e53-ae34e08d997f
ms.service: cosmos-db
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/24/2017
ms.author: arramac
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d2fdc7b0e8958d129ab027e4b11193b12961ddae
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="automatic-regional-failover-for-business-continuity-in-azure-cosmos-db"></a>Автоматическая отработка отказа между регионами для обеспечения непрерывности бизнес-процессов в Azure Cosmos DB
Azure Cosmos DB упрощает hello глобального распределение данных, предлагая полностью управляются [учетные записи базы данных с поддержкой нескольких регионов](distribute-data-globally.md) , обеспечивающие очистить компромисса между согласованности, доступности и производительности в рамках соответствующего гарантии. Учетные записи Cosmos DB обеспечивают высокий уровень доступности, одной цифры ms задержки, [хорошо определенные уровни согласованности](consistency-levels.md), прозрачный региональной отработки отказа с множественной адресацией API и hello tooelastically возможности масштабирования, пропускную способность и хранилища по всему миру hello. 

Cosmos DB поддерживает как явные, так и переходы на основе политики, которые позволяют поведение системы конца в конец toocontrol hello в событии hello сбоев. В этой статье мы рассмотрим следующие вопросы:

* как работает ручная отработка отказа в Cosmos DB;
* как работает автоматическая отработка отказа в Cosmos DB и что происходит, когда в центре обработки данных возникает неполадка;
* как использовать ручную отработку отказа в архитектурах приложений.

Узнайте больше об отработке отказа между регионами в этом видео из цикла "Пятница с Azure" от Скотта Хенсельмана (Scott Hanselman) и главного технического руководителя Картика Рамана (Karthik Raman).

>[!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Planet-Scale-NoSQL-with-DocumentDB/player]  

## <a id="ConfigureMultiRegionApplications"></a>Настройка приложений в нескольких регионах
Прежде чем перейти к режимы отработки отказа, рассматривается, как можно настроить приложение tootake преимуществом доступности нескольких регионах и устойчивость шрифтом hello региональной отработки.

* Сначала разверните приложение в нескольких регионах.
* Настройка tooensure высокоскоростной доступ из каждого региона, в развертывании приложения hello соответствующий [список предпочтительных областей](https://msdn.microsoft.com/library/microsoft.azure.documents.client.connectionpolicy.preferredlocations.aspx#P:Microsoft.Azure.Documents.Client.ConnectionPolicy.PreferredLocations) для каждого региона через одну hello поддерживаемых пакетов SDK.

Привет, в следующем фрагменте кода показан способ tooinitialize приложения регионов. Здесь hello учетная запись Azure Cosmos DB `contoso.documents.azure.com` настроен с двумя областями - Запад США и Северной Европе. 

* приложение Hello развертывается в hello Запад США (например, с помощью службы приложений Azure) 
* Настроены `West US` как hello первой предпочтительной области для низкой задержкой считывает
* Настроены `North Europe` как второй предпочтительный области hello (для обеспечения высокой доступности во время сбоев региональные)

Эта конфигурация в hello DocumentDB API, выглядит следующим образом следующий фрагмент кода hello.

```cs
ConnectionPolicy usConnectionPolicy = new ConnectionPolicy 
{ 
    ConnectionMode = ConnectionMode.Direct,
    ConnectionProtocol = Protocol.Tcp
};

usConnectionPolicy.PreferredLocations.Add(LocationNames.WestUS);
usConnectionPolicy.PreferredLocations.Add(LocationNames.NorthEurope);

DocumentClient usClient = new DocumentClient(
    new Uri("https://contosodb.documents.azure.com"),
    "memf7qfF89n6KL9vcb7rIQl6tfgZsRt5gY5dh3BIjesarJanYIcg2Edn9uPOUIVwgkAugOb2zUdCR2h0PTtMrA==",
    usConnectionPolicy);
```

приложение Hello также развернута в регионе Северной Европе hello с hello порядок предпочтительный областей, в обратном направлении. То есть Северной Европе hello сначала указывается для операций чтения с небольшой задержкой. Затем как hello второй предпочтительный регион для обеспечения высокой доступности во время сбоев региональные указана область hello Запад США.

Hello следующей схеме архитектуры показывает, развертывание приложения с поддержкой нескольких регионов где Cosmos DB приложения hello и настроенные toobe в четырех Azure географических регионах.  

![Глобально распределенное развертывание приложений с помощью Azure Cosmos DB](./media/regional-failover/app-deployment.png)

Теперь давайте взглянем на как hello Cosmos DB службы обрабатывает региональные сбоев через автоматический переход на другой ресурс. 

## <a id="AutomaticFailovers"></a>Автоматический переход на другой ресурс
В редких случаях hello Azure региональном сбое или отключения центра обработки данных Cosmos DB автоматически запускает переход на другой ресурс Cosmos DB учетных записей с присутствия в регионе, затронутых hello. 

**Что произойдет, если произойдет сбой региона чтения?**

Cosmos DB учетных записей с областью чтения в одной из областей hello затронутых автоматически отключаются из области их записи, а помечен как отключенный. Реализуйте Cosmos DB SDK Hello региональные обнаружения протокол, который позволяет им tooautomatically обнаружить, когда область доступна и перенаправления чтения вызовы toohello Далее регион в списке предпочтительную область hello. Если ни одна из областей hello в hello основной, что доступен список регионов, вызовы автоматически выполняет откат текущей области записи toohello. Изменения не требуются в вашей приложения код toohandle региональной отработки отказа. Во время всего процесса гарантии согласованности по-прежнему обрабатывается сервером Cosmos DB toobe.

![Сбои региона чтения в Azure Cosmos DB](./media/regional-failover/read-region-failures.png)

После hello особой области восстановления после сбоя hello, все учетные записи затронуты hello Cosmos DB в регионе hello автоматическое восстановление службой hello. Cosmos DB учетные записи, имеющие область чтения в регионе hello затронутых будет затем автоматически синхронизации с текущей области записи и включить online. пакеты SDK DB Cosmos Hello обнаружение hello доступность новой области hello и оценить, выполнен ли hello области должен быть выбран hello текущей чтения области основан на списке hello предпочтительную область, настроенные с помощью приложения hello. Последующие операции чтения, перенаправленный toohello восстановленные области без необходимости изменения кода приложения tooyour.

**Что произойдет в случае сбоя региона записи?**

Если соответствующей области hello hello текущей области записи для данной учетной записи Cosmos DB, затем hello области автоматически помечается как вне сети. Затем область альтернативных повышается, hello запись области каждого соответствующего счета Cosmos DB. Можно полностью настраивать hello порядок выбора области для учетных записей Cosmos DB через портал Azure hello или [программно](https://docs.microsoft.com/rest/api/documentdbresourceprovider/databaseaccounts#DatabaseAccounts_FailoverPriorityChange). 

![Приоритеты при отработке отказа для Azure Cosmos DB](./media/regional-failover/failover-priorities.png)

Во время автоматической отработки отказа Cosmos DB автоматически выбирает следующую область записи hello для заданного DB Cosmos учетной записи на основании hello указанный приоритет. 

![Сбои региона записи в Azure Cosmos DB](./media/regional-failover/write-region-failures.png)

После hello особой области восстановления после сбоя hello, все учетные записи затронуты hello Cosmos DB в регионе hello автоматическое восстановление службой hello. 

* Даже после восстановления hello области hello Cosmos DB учетные записи с их предыдущей записи область в области hello влияет остается в автономном режиме с доступом для чтения. 
* Вы можете запрашивать этот регион toocompute нереплицированные запись во время сбоя hello путем сравнения с hello данные, доступные в текущей области записи hello. В зависимости от требований приложения hello можно выполнять разрешение конфликтов слияния и/или и записи hello последний набор изменений назад toohello текущей записи области. 
* После завершения слияния изменений, можно вернуть hello особой области сети, удаление и повторное добавление hello tooyour области Cosmos DB, учетной записи. После hello области добавляется обратно, можно настроить его обратно в качестве области записи hello, выполняя на другой ресурс вручную через портал Azure hello или [программно](https://docs.microsoft.com/rest/api/documentdbresourceprovider/databaseaccounts#DatabaseAccounts_CreateOrUpdate).

## <a id="ManualFailovers"></a>Ручной переход на другой ресурс

В дополнение к этому tooautomatic переход на другой ресурс, hello текущей записи область данной учетной записи Cosmos DB вручную динамически изменять tooone из существующих областей чтения hello. Переход на другой ресурс вручную может быть инициирована через портал Azure hello или [программно](https://docs.microsoft.com/rest/api/documentdbresourceprovider/databaseaccounts#DatabaseAccounts_CreateOrUpdate). 

Переход на другой ресурс вручную убедитесь **нуля потери данных** и **нуля доступности** потери и правильно записи состояния передачи из старого hello записать toohello области новую для hello указана учетная запись Cosmos DB. Как в автоматический переход на другой ресурс hello Cosmos DB SDK автоматически обрабатывает записи области изменяется во время отработки отказа вручную и гарантирует, что вызовы будут автоматически перенаправленный toohello новая область для записи. Вносить изменения кода или конфигурации не требуется в другой ресурс toomanage вашего приложения. 

![Ручная отработка отказа в Azure Cosmos DB](./media/regional-failover/manual-failovers.png)

Ниже приведены некоторые распространенные сценарии hello, переход на другой ресурс вручную может быть полезно.

**Выполните hello часов модели**: Если приложения должны прогнозируемого трафик на основе времени hello hello дня, можно периодически изменять hello записи состояния toohello наиболее активные географического региона по времени суток hello.

**Обновление службы**: некоторые развертывания глобально распределенное приложение может включать в себя перенаправления трафика область toodifferent через диспетчер трафика во время их обновление планового обслуживания. Развертывание таких приложений можно использовать toohello отработка отказа вручную tookeep hello записи состояния область с которой будет трафика active toobe период обновления службы hello.

**Отработки непрерывности бизнес-процессов и аварийного восстановления (BCDR) и высокого уровня доступности и аварийного восстановления (HADR).** Во время разработки и выпуска большинства корпоративных приложений выполняются тесты непрерывности бизнес-процессов. BCDR и тестирование HADR часто является важным шагом в сертификация соответствия и гарантирующее доступность службы в случае hello региональные простоев. Можно проверить готовность BCDR hello приложений, использующих Cosmos DB для хранения при активации учетной записи Cosmos DB отработки отказа вручную и/или добавление и удаление область динамически.

В этой статье мы изучили работу переход на другой ресурс вручную и автоматическое Cosmos DB и настройке вашего Cosmos DB учетные записи и приложения toobe глобально доступной. С помощью поддержка Cosmos DB глобального репликации, можно сократить задержку начала до конца и убедитесь, что высокой доступности, даже в случае hello сбоев области. 

## <a id="NextSteps"></a>Дальнейшие действия
* Дополнительные сведения о поддержке глобального распространения в Cosmos DB см. [здесь](distribute-data-globally.md).
* Дополнительные сведения о глобальной согласованности в Cosmos DB см. в [этой статье](consistency-levels.md).
* Сведения о разработке с использованием нескольких регионов см. в статье [Как настроить глобальное распределение Azure Cosmos DB с помощью API DocumentDB](../cosmos-db/tutorial-global-distribution-documentdb.md).
* Узнайте, как toobuild [записи в нескольких регионах архитектур](multi-region-writers.md) с Azure DocumentDB

