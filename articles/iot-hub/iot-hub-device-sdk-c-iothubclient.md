---
title: "устройств IoT aaaAzure пакета SDK для C - IoTHubClient | Документы Microsoft"
description: "Как библиотеки IoTHubClient toouse hello в пакет SDK устройства Azure IoT hello C toocreate для приложений для устройств, которые взаимодействуют с центра IoT."
services: iot-hub
documentationcenter: 
author: olivierbloch
manager: timlt
editor: 
ms.assetid: 828cf2bf-999d-4b8a-8a28-c7c901629600
ms.service: iot-hub
ms.devlang: cpp
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/06/2016
ms.author: obloch
ms.openlocfilehash: d1ece79e9ba6d1e5fd45cabb8fca393b24052e07
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="azure-iot-device-sdk-for-c--more-about-iothubclient"></a><span data-ttu-id="1a953-103">Пакет SDK для устройств Azure IoT для C — дополнительные сведения о библиотеке IoTHubClient</span><span class="sxs-lookup"><span data-stu-id="1a953-103">Azure IoT device SDK for C – more about IoTHubClient</span></span>
<span data-ttu-id="1a953-104">Hello [сначала статьи](iot-hub-device-sdk-c-intro.md) в этой серии появился hello **устройств Azure IoT SDK для C**. В ней объяснялось, что в пакете SDK есть два архитектурных уровня.</span><span class="sxs-lookup"><span data-stu-id="1a953-104">hello [first article](iot-hub-device-sdk-c-intro.md) in this series introduced hello **Azure IoT device SDK for C**. That article explained that there are two architectural layers in SDK.</span></span> <span data-ttu-id="1a953-105">Является базовым hello hello **IoTHubClient** библиотеки, который непосредственно управляет связью с центром IoT.</span><span class="sxs-lookup"><span data-stu-id="1a953-105">At hello base is hello **IoTHubClient** library which directly manages communication with IoT Hub.</span></span> <span data-ttu-id="1a953-106">Имеется также hello **сериализатор** библиотеки, созданный на основе этой tooprovide службы сериализации.</span><span class="sxs-lookup"><span data-stu-id="1a953-106">There's also hello **serializer** library that builds on top of that tooprovide serialization services.</span></span> <span data-ttu-id="1a953-107">В этой статье мы предоставим Дополнительные сведения на hello **IoTHubClient** библиотеки.</span><span class="sxs-lookup"><span data-stu-id="1a953-107">In this article we'll provide additional detail on hello **IoTHubClient** library.</span></span>

<span data-ttu-id="1a953-108">Hello предыдущей статье описано, как toouse hello **IoTHubClient** tooIoT события toosend библиотеки концентратора и получать сообщения.</span><span class="sxs-lookup"><span data-stu-id="1a953-108">hello previous article described how toouse hello **IoTHubClient** library toosend events tooIoT Hub and receive messages.</span></span> <span data-ttu-id="1a953-109">В этой статье расширяет обсуждение этой темы, объясняющий, как точно управлять toomore *при* отправки и получения данных, общие сведения о toohello **более низкого уровня API-интерфейсы**.</span><span class="sxs-lookup"><span data-stu-id="1a953-109">This article extends that discussion by explaining how toomore precisely manage *when* you send and receive data, introducing you toohello **lower-level APIs**.</span></span> <span data-ttu-id="1a953-110">Вы также узнаете как tooevents свойства tooattach (и извлекать их из сообщений) с помощью свойства hello обработки возможности hello **IoTHubClient** библиотеки.</span><span class="sxs-lookup"><span data-stu-id="1a953-110">We'll also explain how tooattach properties tooevents (and retrieve them from messages) using hello property handling features in hello **IoTHubClient** library.</span></span> <span data-ttu-id="1a953-111">Наконец, мы предоставим дополнительное объяснение способов toohandle сообщения, полученные из центра IoT.</span><span class="sxs-lookup"><span data-stu-id="1a953-111">Finally, we'll provide additional explanation of different ways toohandle messages received from IoT Hub.</span></span>

<span data-ttu-id="1a953-112">Hello статьи по завершении охватывают несколько различные разделы, включая дополнительные сведения об устройстве, и как toochange hello поведение hello **IoTHubClient** через параметры конфигурации.</span><span class="sxs-lookup"><span data-stu-id="1a953-112">hello article concludes by covering a couple of miscellaneous topics, including more about device credentials and how toochange hello behavior of hello **IoTHubClient** through configuration options.</span></span>

<span data-ttu-id="1a953-113">Мы будем использовать hello **IoTHubClient** SDK образцы tooexplain эти разделы.</span><span class="sxs-lookup"><span data-stu-id="1a953-113">We'll use hello **IoTHubClient** SDK samples tooexplain these topics.</span></span> <span data-ttu-id="1a953-114">Следует toofollow вдоль разделе hello **центром IOT\_клиента\_пример\_http** и **центром IOT\_клиента\_пример\_amqp** приложений, включенных в пакет SDK устройства Azure IoT hello для C. все описанные в следующих разделах hello показано в этих примерах.</span><span class="sxs-lookup"><span data-stu-id="1a953-114">If you want toofollow along, see hello **iothub\_client\_sample\_http** and **iothub\_client\_sample\_amqp** applications that are included in hello Azure IoT device SDK for C. Everything described in hello following sections is demonstrated in these samples.</span></span>

<span data-ttu-id="1a953-115">Можно найти hello [ **устройств Azure IoT SDK для C** ](https://github.com/Azure/azure-iot-sdk-c) GitHub репозитория и просмотра сведений из hello API в hello [Справочник по C API](https://azure.github.io/azure-iot-sdk-c/index.html).</span><span class="sxs-lookup"><span data-stu-id="1a953-115">You can find hello [**Azure IoT device SDK for C**](https://github.com/Azure/azure-iot-sdk-c) GitHub repository and view details of hello API in hello [C API reference](https://azure.github.io/azure-iot-sdk-c/index.html).</span></span>

## <a name="hello-lower-level-apis"></a><span data-ttu-id="1a953-116">Hello более низкого уровня API-интерфейсы</span><span class="sxs-lookup"><span data-stu-id="1a953-116">hello lower-level APIs</span></span>
<span data-ttu-id="1a953-117">Hello предыдущей статьи описано hello основные операции hello **IotHubClient** в контексте hello hello **центром IOT\_клиента\_пример\_amqp** приложение.</span><span class="sxs-lookup"><span data-stu-id="1a953-117">hello previous article described hello basic operation of hello **IotHubClient** within hello context of hello **iothub\_client\_sample\_amqp** application.</span></span> <span data-ttu-id="1a953-118">Например описано, как tooinitialize hello библиотеки с помощью следующего кода.</span><span class="sxs-lookup"><span data-stu-id="1a953-118">For example, it explained how tooinitialize hello library using this code.</span></span>

```
IOTHUB_CLIENT_HANDLE iotHubClientHandle;
iotHubClientHandle = IoTHubClient_CreateFromConnectionString(connectionString, AMQP_Protocol);
```

<span data-ttu-id="1a953-119">Также описывается, как с помощью этого события toosend вызов функции.</span><span class="sxs-lookup"><span data-stu-id="1a953-119">It also described how toosend events using this function call.</span></span>

```
IoTHubClient_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message);
```

<span data-ttu-id="1a953-120">Hello статье также описывается способ tooreceive сообщений путем регистрации функции обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="1a953-120">hello article also described how tooreceive messages by registering a callback function.</span></span>

```
int receiveContext = 0;
IoTHubClient_SetMessageCallback(iotHubClientHandle, ReceiveMessageCallback, &receiveContext);
```

<span data-ttu-id="1a953-121">статья Hello также показал, как toofree ресурсов с помощью кода hello ниже.</span><span class="sxs-lookup"><span data-stu-id="1a953-121">hello article also showed how toofree resources using code such as hello following.</span></span>

```
IoTHubClient_Destroy(iotHubClientHandle);
```

<span data-ttu-id="1a953-122">Однако существует дополнительное tooeach функции этих API-интерфейсов:</span><span class="sxs-lookup"><span data-stu-id="1a953-122">However there are companion functions tooeach of these APIs:</span></span>

* <span data-ttu-id="1a953-123">IoTHubClient\_LL\_CreateFromConnectionString</span><span class="sxs-lookup"><span data-stu-id="1a953-123">IoTHubClient\_LL\_CreateFromConnectionString</span></span>
* <span data-ttu-id="1a953-124">IoTHubClient\_LL\_SendEventAsync</span><span class="sxs-lookup"><span data-stu-id="1a953-124">IoTHubClient\_LL\_SendEventAsync</span></span>
* <span data-ttu-id="1a953-125">IoTHubClient\_LL\_SetMessageCallback</span><span class="sxs-lookup"><span data-stu-id="1a953-125">IoTHubClient\_LL\_SetMessageCallback</span></span>
* <span data-ttu-id="1a953-126">IoTHubClient\_LL\_Destroy</span><span class="sxs-lookup"><span data-stu-id="1a953-126">IoTHubClient\_LL\_Destroy</span></span>

<span data-ttu-id="1a953-127">Все эти функции включают «LL» в имени API hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-127">These functions all include “LL” in hello API name.</span></span> <span data-ttu-id="1a953-128">За исключением этого каждая из этих функций hello параметры являются аналогами идентичные tootheir не LL.</span><span class="sxs-lookup"><span data-stu-id="1a953-128">Other than that, hello parameters of each of these functions are identical tootheir non-LL counterparts.</span></span> <span data-ttu-id="1a953-129">Тем не менее поведение этих функций hello отличается одно важное отличие.</span><span class="sxs-lookup"><span data-stu-id="1a953-129">However, hello behavior of these functions is different in one important way.</span></span>

<span data-ttu-id="1a953-130">При вызове **IoTHubClient\_CreateFromConnectionString**, библиотеки базовых hello создать новый поток, который выполняется в фоновом режиме hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-130">When you call **IoTHubClient\_CreateFromConnectionString**, hello underlying libraries create a new thread that runs in hello background.</span></span> <span data-ttu-id="1a953-131">Этот поток отправляет события в центр IoT и принимает сообщения из него.</span><span class="sxs-lookup"><span data-stu-id="1a953-131">This thread sends events to, and receives messages from, IoT Hub.</span></span> <span data-ttu-id="1a953-132">Потока не создается при работе с hello «LL» API-интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="1a953-132">No such thread is created when working with hello "LL" APIs.</span></span> <span data-ttu-id="1a953-133">Создание Hello hello фонового потока — разработчик toohello удобства.</span><span class="sxs-lookup"><span data-stu-id="1a953-133">hello creation of hello background thread is a convenience toohello developer.</span></span> <span data-ttu-id="1a953-134">У вас нет tooworry о явно отправки событий и получения сообщений от центра IoT — это происходит автоматически в фоновом режиме hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-134">You don’t have tooworry about explicitly sending events and receiving messages from IoT Hub -- it happens automatically in hello background.</span></span> <span data-ttu-id="1a953-135">Напротив hello «LL» API-интерфейсы позволяют явный контроль над связи с центром IoT, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="1a953-135">In contrast, hello "LL" APIs give you explicit control over communication with IoT Hub, if you need it.</span></span>

<span data-ttu-id="1a953-136">toounderstand этого лучше, давайте рассмотрим пример:</span><span class="sxs-lookup"><span data-stu-id="1a953-136">toounderstand this better, let’s look at an example:</span></span>

<span data-ttu-id="1a953-137">При вызове **IoTHubClient\_SendEventAsync**, фактически это помещает hello событий в буфере.</span><span class="sxs-lookup"><span data-stu-id="1a953-137">When you call **IoTHubClient\_SendEventAsync**, what you're actually doing is putting hello event in a buffer.</span></span> <span data-ttu-id="1a953-138">Здравствуйте, фоновый поток, созданные при вызове **IoTHubClient\_CreateFromConnectionString** постоянно отслеживает этот буфер и отправлять любые данные, он содержит tooIoT концентратора.</span><span class="sxs-lookup"><span data-stu-id="1a953-138">hello background thread created when you call **IoTHubClient\_CreateFromConnectionString** continually monitors this buffer and sends any data that it contains tooIoT Hub.</span></span> <span data-ttu-id="1a953-139">Это происходит в фоновом режиме hello в hello одновременную, hello основной поток выполняет другую работу.</span><span class="sxs-lookup"><span data-stu-id="1a953-139">This happens in hello background at hello same time that hello main thread is performing other work.</span></span>

<span data-ttu-id="1a953-140">Аналогично, при регистрации функции обратного вызова для сообщения с помощью **IoTHubClient\_SetMessageCallback**, указывающей hello SDK toohave hello фона потока вызвать функцию обратного вызова hello после сообщения Получено, независимо от основного потока hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-140">Similarly, when you register a callback function for messages using **IoTHubClient\_SetMessageCallback**, you're instructing hello SDK toohave hello background thread invoke hello callback function when a message is received, independent of hello main thread.</span></span>

<span data-ttu-id="1a953-141">Hello «LL» API-интерфейсов нельзя создавать в фоновом потоке.</span><span class="sxs-lookup"><span data-stu-id="1a953-141">hello "LL" APIs don’t create a background thread.</span></span> <span data-ttu-id="1a953-142">Вместо этого новый API необходимо вызвать tooexplicitly отправки и получения данных из центра IoT.</span><span class="sxs-lookup"><span data-stu-id="1a953-142">Instead, a new API must be called tooexplicitly send and receive data from IoT Hub.</span></span> <span data-ttu-id="1a953-143">Это показано в следующий пример hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-143">This is demonstrated in hello following example.</span></span>

<span data-ttu-id="1a953-144">Hello **центром IOT\_клиента\_пример\_http** приложения, включенного в SDK демонстрирует hello hello API-интерфейсы более низкого уровня.</span><span class="sxs-lookup"><span data-stu-id="1a953-144">hello **iothub\_client\_sample\_http** application that’s included in hello SDK demonstrates hello lower-level APIs.</span></span> <span data-ttu-id="1a953-145">В этом примере мы отправлять tooIoT события концентратора с кодом, например hello следующее:</span><span class="sxs-lookup"><span data-stu-id="1a953-145">In that sample, we send events tooIoT Hub with code such as hello following:</span></span>

```
EVENT_INSTANCE message;
sprintf_s(msgText, sizeof(msgText), "Message_%d_From_IoTHubClient_LL_Over_HTTP", i);
message.messageHandle = IoTHubMessage_CreateFromByteArray((const unsigned char*)msgText, strlen(msgText));

IoTHubClient_LL_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message)
```

<span data-ttu-id="1a953-146">Hello первых трех строк создания приветственных сообщений и последнюю строку hello отправляет событие hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-146">hello first three lines create hello message, and hello last line sends hello event.</span></span> <span data-ttu-id="1a953-147">Тем не менее как упоминалось ранее, «отправка» hello событий означает, что данные hello просто помещаются в буфер.</span><span class="sxs-lookup"><span data-stu-id="1a953-147">However, as mentioned previously, "sending" hello event means that hello data is simply placed in a buffer.</span></span> <span data-ttu-id="1a953-148">Ничего не передается в сети hello при мы называем **IoTHubClient\_LL\_SendEventAsync**.</span><span class="sxs-lookup"><span data-stu-id="1a953-148">Nothing is transmitted on hello network when we call **IoTHubClient\_LL\_SendEventAsync**.</span></span> <span data-ttu-id="1a953-149">Порядок tooactually входящих сообщений hello данных tooIoT концентратора, необходимо вызвать **IoTHubClient\_LL\_DoWork**, как показано в этом примере:</span><span class="sxs-lookup"><span data-stu-id="1a953-149">In order tooactually ingress hello data tooIoT Hub, you must call **IoTHubClient\_LL\_DoWork**, as in this example:</span></span>

```
while (1)
{
    IoTHubClient_LL_DoWork(iotHubClientHandle);
    ThreadAPI_Sleep(1000);
}
```

<span data-ttu-id="1a953-150">Этот код (от hello **центром IOT\_клиента\_пример\_http** приложения) многократно вызывает **IoTHubClient\_LL\_DoWork** .</span><span class="sxs-lookup"><span data-stu-id="1a953-150">This code (from hello **iothub\_client\_sample\_http** application) repeatedly calls **IoTHubClient\_LL\_DoWork**.</span></span> <span data-ttu-id="1a953-151">Каждый раз **IoTHubClient\_LL\_DoWork** — вызывается, он отправляет некоторые события из буфера hello tooIoT концентратора, он получает сообщение из очереди отправки toohello устройства.</span><span class="sxs-lookup"><span data-stu-id="1a953-151">Each time **IoTHubClient\_LL\_DoWork** is called, it sends some events from hello buffer tooIoT Hub and it retrieves a queued message being sent toohello device.</span></span> <span data-ttu-id="1a953-152">Hello последнем случае означает, что если мы регистрации функции обратного вызова для сообщения, а затем hello обратном вызове (при условии, что все сообщения в очередь).</span><span class="sxs-lookup"><span data-stu-id="1a953-152">hello latter case means that if we registered a callback function for messages, then hello callback is invoked (assuming any messages are queued up).</span></span> <span data-ttu-id="1a953-153">Мы бы регистрации функции обратного вызова с кодом, например hello следующее:</span><span class="sxs-lookup"><span data-stu-id="1a953-153">We would have registered such a callback function with code such as hello following:</span></span>

```
IoTHubClient_LL_SetMessageCallback(iotHubClientHandle, ReceiveMessageCallback, &receiveContext)
```

<span data-ttu-id="1a953-154">Hello причина, по которой **IoTHubClient\_LL\_DoWork** обычно вызывается цикле является при каждом вызове, он отправляет *некоторые* буферизованный tooIoT события концентратора и извлекает *hello рядом* сообщения в очередь для устройства hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-154">hello reason that **IoTHubClient\_LL\_DoWork** is often called in a loop is that each time it’s called, it sends *some* buffered events tooIoT Hub and retrieves *hello next* message queued up for hello device.</span></span> <span data-ttu-id="1a953-155">Каждый вызов функции не гарантируется события toosend в буфер или tooretrieve всех обновляемых посредством очередей сообщений.</span><span class="sxs-lookup"><span data-stu-id="1a953-155">Each call isn’t guaranteed toosend all buffered events or tooretrieve all queued messages.</span></span> <span data-ttu-id="1a953-156">Если требуется, чтобы toosend все события в hello буфер и затем продолжите на другие операции по обработке этого цикла можно заменить кода, подобного hello далее:</span><span class="sxs-lookup"><span data-stu-id="1a953-156">If you want toosend all events in hello buffer and then continue on with other processing you can replace this loop with code such as hello following:</span></span>

```
IOTHUB_CLIENT_STATUS status;

while ((IoTHubClient_LL_GetSendStatus(iotHubClientHandle, &status) == IOTHUB_CLIENT_OK) && (status == IOTHUB_CLIENT_SEND_STATUS_BUSY))
{
    IoTHubClient_LL_DoWork(iotHubClientHandle);
    ThreadAPI_Sleep(1000);
}
```

<span data-ttu-id="1a953-157">Этот код вызывает **IoTHubClient\_LL\_DoWork** до всех событий в буфере hello отправки tooIoT концентратора.</span><span class="sxs-lookup"><span data-stu-id="1a953-157">This code calls **IoTHubClient\_LL\_DoWork** until all events in hello buffer have been sent tooIoT Hub.</span></span> <span data-ttu-id="1a953-158">Обратите внимание, что это не означает, что все сообщения из очереди получены.</span><span class="sxs-lookup"><span data-stu-id="1a953-158">Note this does not also imply that all queued messages have been received.</span></span> <span data-ttu-id="1a953-159">Часть hello причина этого состоит в том, что проверка сообщений, «все» не как детерминированные действие.</span><span class="sxs-lookup"><span data-stu-id="1a953-159">Part of hello reason for this is that checking for "all" messages isn’t as deterministic an action.</span></span> <span data-ttu-id="1a953-160">Что происходит при извлечении «all» сообщений hello, но еще один отправляется toohello устройства сразу же после?</span><span class="sxs-lookup"><span data-stu-id="1a953-160">What happens if you retrieve "all" of hello messages, but then another one is sent toohello device immediately after?</span></span> <span data-ttu-id="1a953-161">Лучше toodeal способом, — с программируемых истечения времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="1a953-161">A better way toodeal with that is with a programmed timeout.</span></span> <span data-ttu-id="1a953-162">Например функция обратного вызова сообщение hello могли сбросить таймер при каждом вызове.</span><span class="sxs-lookup"><span data-stu-id="1a953-162">For example, hello message callback function could reset a timer every time it’s invoked.</span></span> <span data-ttu-id="1a953-163">После этого можно написать обработки логики toocontinue Если, например, сообщения не были получены в hello последнего *X* секунд.</span><span class="sxs-lookup"><span data-stu-id="1a953-163">You can then write logic toocontinue processing if, for example, no messages have been received in hello last *X* seconds.</span></span>

<span data-ttu-id="1a953-164">Все события завершения ingressing при получение сообщений, быть tooclean hello соответствующий toocall убедиться, что функция ресурсов.</span><span class="sxs-lookup"><span data-stu-id="1a953-164">When you’re finished ingressing events and receiving messages, be sure toocall hello corresponding function tooclean up resources.</span></span>

```
IoTHubClient_LL_Destroy(iotHubClientHandle);
```

<span data-ttu-id="1a953-165">По сути является только один набор API-интерфейсов toosend и получения данных в фоновом потоке и другой набор API, hello же без hello фонового потока.</span><span class="sxs-lookup"><span data-stu-id="1a953-165">Basically there’s only one set of APIs toosend and receive data with a background thread and another set of APIs that does hello same thing without hello background thread.</span></span> <span data-ttu-id="1a953-166">Много разработчики могут предпочесть hello не - LL API-интерфейсов, но hello более низкого уровня API-интерфейсы полезны, когда hello разработчику явный контроль над обмена данными по сети.</span><span class="sxs-lookup"><span data-stu-id="1a953-166">A lot of developers may prefer hello non-LL APIs, but hello lower-level APIs are useful when hello developer wants explicit control over network transmissions.</span></span> <span data-ttu-id="1a953-167">Например, некоторые устройства собирают данные в течение продолжительного периода и передают события только через заданные интервалы времени (скажем, раз в час или раз в день).</span><span class="sxs-lookup"><span data-stu-id="1a953-167">For example, some devices collect data over time and only ingress events at specified intervals (for example, once an hour or once a day).</span></span> <span data-ttu-id="1a953-168">Здравствуйте, более низкого уровня API-интерфейсы позволяют hello возможность управления tooexplicitly при отправке и получении данных из центра IoT.</span><span class="sxs-lookup"><span data-stu-id="1a953-168">hello lower-level APIs give you hello ability tooexplicitly control when you send and receive data from IoT Hub.</span></span> <span data-ttu-id="1a953-169">Другие будут предпочтительности простоты hello, более низкого уровня API обеспечивают приветствия.</span><span class="sxs-lookup"><span data-stu-id="1a953-169">Others will simply prefer hello simplicity that hello lower-level APIs provide.</span></span> <span data-ttu-id="1a953-170">Все, что происходит на основной поток hello, а не некоторых рабочих происходит в фоновом режиме hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-170">Everything happens on hello main thread rather than some work happening in hello background.</span></span>

<span data-ttu-id="1a953-171">Независимо от модели, можно выбрать, будет убедиться, что toobe согласованное в какие интерфейсы API используются.</span><span class="sxs-lookup"><span data-stu-id="1a953-171">Whichever model you choose, be sure toobe consistent in which APIs you use.</span></span> <span data-ttu-id="1a953-172">Если запускается путем вызова **IoTHubClient\_LL\_CreateFromConnectionString**, убедитесь, что вы используете только hello соответствующий API-интерфейс более низкого уровня для никаких дальнейших действий:</span><span class="sxs-lookup"><span data-stu-id="1a953-172">If you start by calling **IoTHubClient\_LL\_CreateFromConnectionString**, be sure you only use hello corresponding lower-level APIs for any follow-up work:</span></span>

* <span data-ttu-id="1a953-173">IoTHubClient\_LL\_SendEventAsync</span><span class="sxs-lookup"><span data-stu-id="1a953-173">IoTHubClient\_LL\_SendEventAsync</span></span>
* <span data-ttu-id="1a953-174">IoTHubClient\_LL\_SetMessageCallback</span><span class="sxs-lookup"><span data-stu-id="1a953-174">IoTHubClient\_LL\_SetMessageCallback</span></span>
* <span data-ttu-id="1a953-175">IoTHubClient\_LL\_Destroy</span><span class="sxs-lookup"><span data-stu-id="1a953-175">IoTHubClient\_LL\_Destroy</span></span>
* <span data-ttu-id="1a953-176">IoTHubClient\_LL\_DoWork</span><span class="sxs-lookup"><span data-stu-id="1a953-176">IoTHubClient\_LL\_DoWork</span></span>

<span data-ttu-id="1a953-177">Hello противоположной также имеет значение true.</span><span class="sxs-lookup"><span data-stu-id="1a953-177">hello opposite is true as well.</span></span> <span data-ttu-id="1a953-178">Если начать с **IoTHubClient\_CreateFromConnectionString**, а затем используйте hello не - LL API-интерфейсы для дополнительной обработки.</span><span class="sxs-lookup"><span data-stu-id="1a953-178">If you start with **IoTHubClient\_CreateFromConnectionString**, then use hello non-LL APIs for any additional processing.</span></span>

<span data-ttu-id="1a953-179">В hello Azure устройств IoT пакета SDK для языка C, в разделе hello **центром IOT\_клиента\_пример\_http** полный пример hello нижнего уровня приложения API-интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="1a953-179">In hello Azure IoT device SDK for C, see hello **iothub\_client\_sample\_http** application for a complete example of hello lower-level APIs.</span></span> <span data-ttu-id="1a953-180">Hello **центром IOT\_клиента\_пример\_amqp** приложения могут ссылаться полный пример hello не - LL интерфейсов API.</span><span class="sxs-lookup"><span data-stu-id="1a953-180">hello **iothub\_client\_sample\_amqp** application can be referenced for a full example of hello non-LL APIs.</span></span>

## <a name="property-handling"></a><span data-ttu-id="1a953-181">Обработка свойств</span><span class="sxs-lookup"><span data-stu-id="1a953-181">Property handling</span></span>
<span data-ttu-id="1a953-182">До сих при отправке данных уже было сказано ранее, мы ссылка toohello тело сообщения hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-182">So far when we've described sending data, we've been referring toohello body of hello message.</span></span> <span data-ttu-id="1a953-183">Рассмотрим для примера такой код:</span><span class="sxs-lookup"><span data-stu-id="1a953-183">For example, consider this code:</span></span>

```
EVENT_INSTANCE message;
sprintf_s(msgText, sizeof(msgText), "Hello World");
message.messageHandle = IoTHubMessage_CreateFromByteArray((const unsigned char*)msgText, strlen(msgText));
IoTHubClient_LL_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message)
```

<span data-ttu-id="1a953-184">Этот пример отправляет сообщение tooIoT концентратора с текстом hello «Hello World».</span><span class="sxs-lookup"><span data-stu-id="1a953-184">This example sends a message tooIoT Hub with hello text "Hello World."</span></span> <span data-ttu-id="1a953-185">Однако центр IoT также позволяет свойства toobe вложенного tooeach сообщения.</span><span class="sxs-lookup"><span data-stu-id="1a953-185">However, IoT Hub also allows properties toobe attached tooeach message.</span></span> <span data-ttu-id="1a953-186">Свойства являются пары имя/значение, которые могут быть вложенные toohello сообщения.</span><span class="sxs-lookup"><span data-stu-id="1a953-186">Properties are name/value pairs that can be attached toohello message.</span></span> <span data-ttu-id="1a953-187">Например можно изменять tooattach предыдущего кода hello toohello свойства сообщения:</span><span class="sxs-lookup"><span data-stu-id="1a953-187">For example, we can modify hello previous code tooattach a property toohello message:</span></span>

```
MAP_HANDLE propMap = IoTHubMessage_Properties(message.messageHandle);
sprintf_s(propText, sizeof(propText), "%d", i);
Map_AddOrUpdate(propMap, "SequenceNumber", propText);
```

<span data-ttu-id="1a953-188">Мы начнем с вызова **IoTHubMessage\_свойства** и передав его дескриптор сообщений hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-188">We start by calling **IoTHubMessage\_Properties** and passing it hello handle of our message.</span></span> <span data-ttu-id="1a953-189">Мы получаем обратно **КАРТЫ\_ОБРАБОТКИ** ссылку, которая позволяет нам toostart, Добавление свойств.</span><span class="sxs-lookup"><span data-stu-id="1a953-189">What we get back is a **MAP\_HANDLE** reference that enables us toostart adding properties.</span></span> <span data-ttu-id="1a953-190">последний Hello достигается посредством вызова **карты\_AddOrUpdate**, который принимает ссылку tooa КАРТЫ\_ДЕСКРИПТОР hello имя свойства и значение свойства hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-190">hello latter is accomplished by calling **Map\_AddOrUpdate**, which takes a reference tooa MAP\_HANDLE, hello property name, and hello property value.</span></span> <span data-ttu-id="1a953-191">С помощью этого API мы можем добавить сколько угодно свойств.</span><span class="sxs-lookup"><span data-stu-id="1a953-191">With this API we can add as many properties as we like.</span></span>

<span data-ttu-id="1a953-192">Когда событие hello считывается из **концентраторов событий**, hello получатель сообщения может перечислять свойства hello и извлечения их значений.</span><span class="sxs-lookup"><span data-stu-id="1a953-192">When hello event is read from **Event Hubs**, hello receiver can enumerate hello properties and retrieve their corresponding values.</span></span> <span data-ttu-id="1a953-193">Например, в .NET это будет выполняться доступ к hello [коллекцию свойств для объекта EventData hello](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.eventdata.properties.aspx).</span><span class="sxs-lookup"><span data-stu-id="1a953-193">For example, in .NET this would be accomplished by accessing hello [Properties collection on hello EventData object](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.eventdata.properties.aspx).</span></span>

<span data-ttu-id="1a953-194">В предыдущем примере hello мы прикрепим отправку tooIoT концентратора событий tooan свойства.</span><span class="sxs-lookup"><span data-stu-id="1a953-194">In hello previous example, we’re attaching properties tooan event that we send tooIoT Hub.</span></span> <span data-ttu-id="1a953-195">Свойства также могут быть вложенные toomessages, полученный от центра IoT.</span><span class="sxs-lookup"><span data-stu-id="1a953-195">Properties can also be attached toomessages received from IoT Hub.</span></span> <span data-ttu-id="1a953-196">Если мы хотим tooretrieve свойства из сообщения, мы используем кода, подобного hello далее в нашем функции обратного вызова для сообщения:</span><span class="sxs-lookup"><span data-stu-id="1a953-196">If we want tooretrieve properties from a message, we can use code such as hello following in our message callback function:</span></span>

```
static IOTHUBMESSAGE_DISPOSITION_RESULT ReceiveMessageCallback(IOTHUB_MESSAGE_HANDLE message, void* userContextCallback)
{
    . . .

    // Retrieve properties from hello message
    MAP_HANDLE mapProperties = IoTHubMessage_Properties(message);
    if (mapProperties != NULL)
    {
        const char*const* keys;
        const char*const* values;
        size_t propertyCount = 0;
        if (Map_GetInternals(mapProperties, &keys, &values, &propertyCount) == MAP_OK)
        {
            if (propertyCount > 0)
            {
                printf("Message Properties:\r\n");
                for (size_t index = 0; index < propertyCount; index++)
                {
                    printf("\tKey: %s Value: %s\r\n", keys[index], values[index]);
                }
                printf("\r\n");
            }
        }
    }

    . . .
}
```

<span data-ttu-id="1a953-197">Здравствуйте вызов слишком**IoTHubMessage\_свойства** возвращает hello **КАРТЫ\_ОБРАБОТКИ** ссылки.</span><span class="sxs-lookup"><span data-stu-id="1a953-197">hello call too**IoTHubMessage\_Properties** returns hello **MAP\_HANDLE** reference.</span></span> <span data-ttu-id="1a953-198">Затем передается этой ссылки слишком**карты\_GetInternals** tooobtain tooan ссылку, массив hello имя значение пары (а также число свойств hello).</span><span class="sxs-lookup"><span data-stu-id="1a953-198">We then pass that reference too**Map\_GetInternals** tooobtain a reference tooan array of hello name/value pairs (as well as a count of hello properties).</span></span> <span data-ttu-id="1a953-199">На этом этапе это простой вопрос перечисления hello свойства tooget toohello значениям, которые требуется.</span><span class="sxs-lookup"><span data-stu-id="1a953-199">At that point it's a simple matter of enumerating hello properties tooget toohello values we want.</span></span>

<span data-ttu-id="1a953-200">В приложении нет toouse свойства.</span><span class="sxs-lookup"><span data-stu-id="1a953-200">You don't have toouse properties in your application.</span></span> <span data-ttu-id="1a953-201">Тем не менее если вам требуется tooset их на события или получать их из сообщений hello **IoTHubClient** библиотека позволяет легко.</span><span class="sxs-lookup"><span data-stu-id="1a953-201">However, if you need tooset them on events or retrieve them from messages, hello **IoTHubClient** library makes it easy.</span></span>

## <a name="message-handling"></a><span data-ttu-id="1a953-202">Обработка сообщений</span><span class="sxs-lookup"><span data-stu-id="1a953-202">Message handling</span></span>
<span data-ttu-id="1a953-203">Как уже говорилось ранее, при поступлении сообщений от центра IoT hello **IoTHubClient** библиотеки отвечает, генерируя функция регистрируемого обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="1a953-203">As stated previously, when messages arrive from IoT Hub hello **IoTHubClient** library responds by invoking a registered callback function.</span></span> <span data-ttu-id="1a953-204">У этой функции есть параметр возврата, который требует дополнительного пояснения.</span><span class="sxs-lookup"><span data-stu-id="1a953-204">There is a return parameter of this function that deserves some additional explanation.</span></span> <span data-ttu-id="1a953-205">Ниже приведен фрагмент кода hello функции обратного вызова в hello **центром IOT\_клиента\_пример\_http** образец приложения:</span><span class="sxs-lookup"><span data-stu-id="1a953-205">Here’s an excerpt of hello callback function in hello **iothub\_client\_sample\_http** sample application:</span></span>

```
static IOTHUBMESSAGE_DISPOSITION_RESULT ReceiveMessageCallback(IOTHUB_MESSAGE_HANDLE message, void* userContextCallback)
{
    . . .
    return IOTHUBMESSAGE_ACCEPTED;
}
```

<span data-ttu-id="1a953-206">Обратите внимание, что возвращаемый тип hello **IOTHUBMESSAGE\_DISPOSITION\_РЕЗУЛЬТАТ** и в данном случае мы возвращаем **IOTHUBMESSAGE\_ПРИНЯТО**.</span><span class="sxs-lookup"><span data-stu-id="1a953-206">Note that hello return type is **IOTHUBMESSAGE\_DISPOSITION\_RESULT** and in this particular case we return **IOTHUBMESSAGE\_ACCEPTED**.</span></span> <span data-ttu-id="1a953-207">Существуют другие значения, мы можем вернуться из этой функции, как hello изменение **IoTHubClient** библиотеки реагирует обратного вызова toohello сообщения.</span><span class="sxs-lookup"><span data-stu-id="1a953-207">There are other values we can return from this function that change how hello **IoTHubClient** library reacts toohello message callback.</span></span> <span data-ttu-id="1a953-208">Ниже приведены варианты hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-208">Here are hello options.</span></span>

* <span data-ttu-id="1a953-209">**IOTHUBMESSAGE\_ПРИНЯТО** — успешно обработал сообщение hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-209">**IOTHUBMESSAGE\_ACCEPTED** – hello message has been processed successfully.</span></span> <span data-ttu-id="1a953-210">Hello **IoTHubClient** библиотеки не будет вызывать функцию обратного вызова hello снова с hello одного сообщения.</span><span class="sxs-lookup"><span data-stu-id="1a953-210">hello **IoTHubClient** library will not invoke hello callback function again with hello same message.</span></span>
* <span data-ttu-id="1a953-211">**IOTHUBMESSAGE\_Отклонено** — приветственное сообщение не было обработано и отсутствует в toodo нет желания hello будущих.</span><span class="sxs-lookup"><span data-stu-id="1a953-211">**IOTHUBMESSAGE\_REJECTED** – hello message was not processed and there is no desire toodo so in hello future.</span></span> <span data-ttu-id="1a953-212">Hello **IoTHubClient** библиотеки не должен вызывать функцию обратного вызова hello снова с hello одного сообщения.</span><span class="sxs-lookup"><span data-stu-id="1a953-212">hello **IoTHubClient** library should not invoke hello callback function again with hello same message.</span></span>
* <span data-ttu-id="1a953-213">**IOTHUBMESSAGE\_ОТБРОШЕНО** — не был обработан приветственное сообщение, но hello **IoTHubClient** библиотеки следует вызвать функцию обратного вызова hello снова с hello одного сообщения.</span><span class="sxs-lookup"><span data-stu-id="1a953-213">**IOTHUBMESSAGE\_ABANDONED** – hello message was not processed successfully, but hello **IoTHubClient** library should invoke hello callback function again with hello same message.</span></span>

<span data-ttu-id="1a953-214">Hello первых двух кодах возврата, hello **IoTHubClient** библиотеки отправляет сообщение tooIoT концентратора, указывающее, что сообщение hello следует удаляется из очереди устройства hello и снова не доставлено.</span><span class="sxs-lookup"><span data-stu-id="1a953-214">For hello first two return codes, hello **IoTHubClient** library sends a message tooIoT Hub indicating that hello message should be deleted from hello device queue and not delivered again.</span></span> <span data-ttu-id="1a953-215">суммарным эффектом Hello Здравствуйте, же (приветственное сообщение удаляется из очереди hello устройства), но по-прежнему записывается ли приветственное сообщение было принято или отклонено.</span><span class="sxs-lookup"><span data-stu-id="1a953-215">hello net effect is hello same (hello message is deleted from hello device queue), but whether hello message was accepted or rejected is still recorded.</span></span>  <span data-ttu-id="1a953-216">Запись это различие — полезные toosenders приветственное сообщение, кто может прослушивать отзывы и узнать, если устройство принял или отклонил определенного сообщения.</span><span class="sxs-lookup"><span data-stu-id="1a953-216">Recording this distinction is useful toosenders of hello message who can listen for feedback and find out if a device has accepted or rejected a particular message.</span></span>

<span data-ttu-id="1a953-217">В последнем случае hello также отправляется сообщение tooIoT концентратора, но это означает, что это сообщение hello должны доставляться.</span><span class="sxs-lookup"><span data-stu-id="1a953-217">In hello last case a message is also sent tooIoT Hub, but it indicates that hello message should be redelivered.</span></span> <span data-ttu-id="1a953-218">Обычно будет прерывания сообщение, если некоторые ошибки, но хотите tootry tooprocess hello сообщение еще раз.</span><span class="sxs-lookup"><span data-stu-id="1a953-218">Typically you’ll abandon a message if you encounter some error but want tootry tooprocess hello message again.</span></span> <span data-ttu-id="1a953-219">Напротив отклоняет сообщение подходит при возникновении неустранимой ошибки (или вы просто решить, что вы не хотите tooprocess приветственное сообщение).</span><span class="sxs-lookup"><span data-stu-id="1a953-219">In contrast, rejecting a message is appropriate when you encounter an unrecoverable error (or if you simply decide you don’t want tooprocess hello message).</span></span>

<span data-ttu-id="1a953-220">В любом случае помните о hello различных кодов возврата, чтобы вы, которые заставляют назвать hello поведение в hello **IoTHubClient** библиотеки.</span><span class="sxs-lookup"><span data-stu-id="1a953-220">In any case, be aware of hello different return codes so that you can elicit hello behavior you want from hello **IoTHubClient** library.</span></span>

## <a name="alternate-device-credentials"></a><span data-ttu-id="1a953-221">Альтернативные учетные данные устройств</span><span class="sxs-lookup"><span data-stu-id="1a953-221">Alternate device credentials</span></span>
<span data-ttu-id="1a953-222">Как отмечалось ранее, Здравствуйте, первое, что toodo при работе с hello **IoTHubClient** библиотека — tooobtain **центром IOT\_КЛИЕНТА\_ОБРАБОТКИ** с помощью вызова, например hello следующие:</span><span class="sxs-lookup"><span data-stu-id="1a953-222">As explained previously, hello first thing toodo when working with hello **IoTHubClient** library is tooobtain a **IOTHUB\_CLIENT\_HANDLE** with a call such as hello following:</span></span>

```
IOTHUB_CLIENT_HANDLE iotHubClientHandle;
iotHubClientHandle = IoTHubClient_CreateFromConnectionString(connectionString, AMQP_Protocol);
```

<span data-ttu-id="1a953-223">Здравствуйте аргументы слишком**IoTHubClient\_CreateFromConnectionString** : строка подключения устройства hello и параметр, указывающий протокол hello, мы используем toocommunicate с центром IoT.</span><span class="sxs-lookup"><span data-stu-id="1a953-223">hello arguments too**IoTHubClient\_CreateFromConnectionString** are hello device connection string and a parameter that indicates hello protocol we use toocommunicate with IoT Hub.</span></span> <span data-ttu-id="1a953-224">Строка подключения устройства Hello имеет формат, который выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="1a953-224">hello device connection string has a format that appears as follows:</span></span>

```
HostName=IOTHUBNAME.IOTHUBSUFFIX;DeviceId=DEVICEID;SharedAccessKey=SHAREDACCESSKEY
```

<span data-ttu-id="1a953-225">В этой строке указаны четыре значения: имя центра IoT, суффикс центра IoT, идентификатор устройства и ключ общего доступа.</span><span class="sxs-lookup"><span data-stu-id="1a953-225">There are four pieces of information in this string: IoT Hub name, IoT Hub suffix, device ID, and shared access key.</span></span> <span data-ttu-id="1a953-226">При создании экземпляра концентратора IoT в hello портал Azure, получить hello полное доменное имя (FQDN) из центра IoT — это дает вам имя концентратора IoT hello (hello первой части hello полное доменное имя) и суффикс концентратора IoT hello (hello остальные hello полное доменное имя).</span><span class="sxs-lookup"><span data-stu-id="1a953-226">You obtain hello fully qualified domain name (FQDN) of an IoT hub when you create your IoT hub instance in hello Azure portal — this gives you hello IoT hub name (hello first part of hello FQDN) and hello IoT hub suffix (hello rest of hello FQDN).</span></span> <span data-ttu-id="1a953-227">При регистрации устройства с центром IoT получить идентификатор устройства hello и hello общий ключ доступа (как описано в hello [предыдущей статьи](iot-hub-device-sdk-c-intro.md)).</span><span class="sxs-lookup"><span data-stu-id="1a953-227">You get hello device ID and hello shared access key when you register your device with IoT Hub (as described in hello [previous article](iot-hub-device-sdk-c-intro.md)).</span></span>

<span data-ttu-id="1a953-228">**IoTHubClient\_CreateFromConnectionString** предоставляет один из способов tooinitialize hello библиотеки.</span><span class="sxs-lookup"><span data-stu-id="1a953-228">**IoTHubClient\_CreateFromConnectionString** gives you one way tooinitialize hello library.</span></span> <span data-ttu-id="1a953-229">При желании можно создать новую **центром IOT\_КЛИЕНТА\_ОБРАБОТКИ** при помощи этих отдельных параметров, а не строку подключения устройства hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-229">If you prefer, you can create a new **IOTHUB\_CLIENT\_HANDLE** by using these individual parameters rather than hello device connection string.</span></span> <span data-ttu-id="1a953-230">Это достигается с hello, следующий код:</span><span class="sxs-lookup"><span data-stu-id="1a953-230">This is achieved with hello following code:</span></span>

```
IOTHUB_CLIENT_CONFIG iotHubClientConfig;
iotHubClientConfig.iotHubName = "";
iotHubClientConfig.deviceId = "";
iotHubClientConfig.deviceKey = "";
iotHubClientConfig.iotHubSuffix = "";
iotHubClientConfig.protocol = HTTP_Protocol;
IOTHUB_CLIENT_HANDLE iotHubClientHandle = IoTHubClient_LL_Create(&iotHubClientConfig);
```

<span data-ttu-id="1a953-231">Это достигается hello идентичен **IoTHubClient\_CreateFromConnectionString**.</span><span class="sxs-lookup"><span data-stu-id="1a953-231">This accomplishes hello same thing as **IoTHubClient\_CreateFromConnectionString**.</span></span>

<span data-ttu-id="1a953-232">Он может казаться очевидным, что нужно toouse **IoTHubClient\_CreateFromConnectionString** вместо этого более подробным метод инициализации.</span><span class="sxs-lookup"><span data-stu-id="1a953-232">It may seem obvious that you would want toouse **IoTHubClient\_CreateFromConnectionString** rather than this more verbose method of initialization.</span></span> <span data-ttu-id="1a953-233">Но не стоит забывать, что при регистрации устройства в центре IoT вы получаете только идентификатор и ключ устройства (а не строку подключения).</span><span class="sxs-lookup"><span data-stu-id="1a953-233">Keep in mind, however, that when you register a device in IoT Hub what you get is a device ID and device key (not a connection string).</span></span> <span data-ttu-id="1a953-234">Hello *обозреватель устройств* средства SDK, представленные в hello [предыдущей статьи](iot-hub-device-sdk-c-intro.md) использует библиотеки в hello **пакета SDK службы Azure IoT** toocreate hello устройства строка подключения Идентификатор устройства Hello, ключ устройства и центр IoT имени узла.</span><span class="sxs-lookup"><span data-stu-id="1a953-234">hello *device explorer* SDK tool introduced in hello [previous article](iot-hub-device-sdk-c-intro.md) uses libraries in hello **Azure IoT service SDK** toocreate hello device connection string from hello device ID, device key, and IoT Hub host name.</span></span> <span data-ttu-id="1a953-235">Поэтому вызов **IoTHubClient\_LL\_создать** может быть предпочтительнее, так как избавляет вас hello шаг создания строки подключения.</span><span class="sxs-lookup"><span data-stu-id="1a953-235">So calling **IoTHubClient\_LL\_Create** may be preferable because it saves you hello step of generating a connection string.</span></span> <span data-ttu-id="1a953-236">Используйте тот метод, который для вас удобнее.</span><span class="sxs-lookup"><span data-stu-id="1a953-236">Use whichever method is convenient.</span></span>

## <a name="configuration-options"></a><span data-ttu-id="1a953-237">Варианты настройки</span><span class="sxs-lookup"><span data-stu-id="1a953-237">Configuration options</span></span>
<span data-ttu-id="1a953-238">Пока все описанные о hello способом hello **IoTHubClient** работает библиотека отражает поведения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1a953-238">So far everything described about hello way hello **IoTHubClient** library works reflects its default behavior.</span></span> <span data-ttu-id="1a953-239">Однако существует несколько параметров, задаваемых toochange, как работает библиотека hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-239">However, there are a few options that you can set toochange how hello library works.</span></span> <span data-ttu-id="1a953-240">Это достигается за счет использования hello **IoTHubClient\_LL\_SetOption** API.</span><span class="sxs-lookup"><span data-stu-id="1a953-240">This is accomplished by leveraging hello **IoTHubClient\_LL\_SetOption** API.</span></span> <span data-ttu-id="1a953-241">Рассмотрим следующий пример.</span><span class="sxs-lookup"><span data-stu-id="1a953-241">Consider this example:</span></span>

```
unsigned int timeout = 30000;
IoTHubClient_LL_SetOption(iotHubClientHandle, "timeout", &timeout);
```

<span data-ttu-id="1a953-242">Существует несколько часто используемых параметров:</span><span class="sxs-lookup"><span data-stu-id="1a953-242">There are a couple of options that are commonly used:</span></span>

* <span data-ttu-id="1a953-243">**SetBatching** (логическое значение) — Если **true**, данные, отправляемые tooIoT концентратора, отправляется в виде пакетов.</span><span class="sxs-lookup"><span data-stu-id="1a953-243">**SetBatching** (bool) – If **true**, then data sent tooIoT Hub is sent in batches.</span></span> <span data-ttu-id="1a953-244">При значении **false** сообщения отправляются по отдельности.</span><span class="sxs-lookup"><span data-stu-id="1a953-244">If **false**, then messages are sent individually.</span></span> <span data-ttu-id="1a953-245">по умолчанию Hello — **false**.</span><span class="sxs-lookup"><span data-stu-id="1a953-245">hello default is **false**.</span></span> <span data-ttu-id="1a953-246">Обратите внимание, что hello **SetBatching** параметр применяется только протокол toohello HTTP и не toohello MQTT или AMQP протоколов.</span><span class="sxs-lookup"><span data-stu-id="1a953-246">Note that hello **SetBatching** option only applies toohello HTTP protocol and not toohello MQTT or AMQP protocols.</span></span>
* <span data-ttu-id="1a953-247">**Timeout** (целое число без знака). Это значение указывается в миллисекундах.</span><span class="sxs-lookup"><span data-stu-id="1a953-247">**Timeout** (unsigned int) – This value is represented in milliseconds.</span></span> <span data-ttu-id="1a953-248">Если отправка HTTP-запроса или ответа выполняется дольше этого времени, то время ожидания соединения hello.</span><span class="sxs-lookup"><span data-stu-id="1a953-248">If sending an HTTP request or receiving a response takes longer than this time, then hello connection times out.</span></span>

<span data-ttu-id="1a953-249">Пакетная обработка параметр Hello важен.</span><span class="sxs-lookup"><span data-stu-id="1a953-249">hello batching option is important.</span></span> <span data-ttu-id="1a953-250">По умолчанию hello события ingresses библиотеки по отдельности (одно событие — все передаваемые слишком**IoTHubClient\_LL\_SendEventAsync**).</span><span class="sxs-lookup"><span data-stu-id="1a953-250">By default, hello library ingresses events individually (a single event is whatever you pass too**IoTHubClient\_LL\_SendEventAsync**).</span></span> <span data-ttu-id="1a953-251">Если пакетная обработка параметр hello **true**, библиотека hello собирает столько событий из буфера hello (вверх toohello максимальный размер сообщения, принимается центр IoT).</span><span class="sxs-lookup"><span data-stu-id="1a953-251">If hello batching option is **true**, hello library collects as many events as it can from hello buffer (up toohello maximum message size that IoT Hub will accept).</span></span>  <span data-ttu-id="1a953-252">Hello событий выполняется отправка пакета tooIoT концентратора за один вызов HTTP (отдельные события hello объединены в массив JSON).</span><span class="sxs-lookup"><span data-stu-id="1a953-252">hello event batch is sent tooIoT Hub in a single HTTP call (hello individual events are bundled into a JSON array).</span></span> <span data-ttu-id="1a953-253">Включение пакетной обработки обычно позволяет существенно увеличить производительность, так как уменьшается число сетевых круговых путей.</span><span class="sxs-lookup"><span data-stu-id="1a953-253">Enabling batching typically results in big performance gains since you’re reducing network round-trips.</span></span> <span data-ttu-id="1a953-254">При этом также существенно экономится пропускная способность, так как вы отправляете с пакетом событий только один набор заголовков HTTP, а не набор заголовков для каждого отдельного события.</span><span class="sxs-lookup"><span data-stu-id="1a953-254">It also significantly reduces bandwidth since you are sending one set of HTTP headers with an event batch rather than a set of headers for each individual event.</span></span> <span data-ttu-id="1a953-255">При отсутствии toodo определенной причине в противном случае, обычно стоит tooenable пакетной обработки.</span><span class="sxs-lookup"><span data-stu-id="1a953-255">Unless you have a specific reason toodo otherwise, typically you’ll want tooenable batching.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1a953-256">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="1a953-256">Next steps</span></span>
<span data-ttu-id="1a953-257">В этой статье описывается в поведении hello детализации hello **IoTHubClient** найти библиотеку в hello **устройств Azure IoT SDK для C**. С этой информацией, необходимо хорошо понимать возможности hello hello **IoTHubClient** библиотеки.</span><span class="sxs-lookup"><span data-stu-id="1a953-257">This article describes in detail hello behavior of hello **IoTHubClient** library found in hello **Azure IoT device SDK for C**. With this information, you should have a good understanding of hello capabilities of hello **IoTHubClient** library.</span></span> <span data-ttu-id="1a953-258">Hello [следующей статье](iot-hub-device-sdk-c-serializer.md) содержит аналогичные сведения о hello **сериализатор** библиотеки.</span><span class="sxs-lookup"><span data-stu-id="1a953-258">hello [next article](iot-hub-device-sdk-c-serializer.md) provides similar detail on hello **serializer** library.</span></span>

<span data-ttu-id="1a953-259">toolearn Дополнительные сведения о разработке приложений для центра IoT. в разделе hello [пакеты SDK Azure IoT][lnk-sdks].</span><span class="sxs-lookup"><span data-stu-id="1a953-259">toolearn more about developing for IoT Hub, see hello [Azure IoT SDKs][lnk-sdks].</span></span>

<span data-ttu-id="1a953-260">Изучение возможностей hello центра IoT toofurther см. в разделе:</span><span class="sxs-lookup"><span data-stu-id="1a953-260">toofurther explore hello capabilities of IoT Hub, see:</span></span>

* <span data-ttu-id="1a953-261">[Отправка сообщений с устройства в облако с помощью имитации устройства (Linux) с использованием Edge Интернета вещей Azure][lnk-iotedge]</span><span class="sxs-lookup"><span data-stu-id="1a953-261">[Simulating a device with Azure IoT Edge][lnk-iotedge]</span></span>

[lnk-sdks]: iot-hub-devguide-sdks.md

[lnk-iotedge]: iot-hub-linux-iot-edge-simulated-device.md
