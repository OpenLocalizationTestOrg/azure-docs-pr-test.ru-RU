---
title: "Протоколы и порты связи Центра Интернета вещей Azure | Документы Майкрософт"
description: "Руководство разработчика включает описание поддерживаемых протоколов связи для отправки данных с устройства в облако и из облака в устройство, а также номера портов, которые должны быть открыты."
services: iot-hub
documentationcenter: .net
author: dominicbetts
manager: timlt
editor: 
ms.assetid: 3fc5f1a3-3711-4611-9897-d4db079b4250
ms.service: iot-hub
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/25/2017
ms.author: dobett
ms.openlocfilehash: 98004a48734e33f85eebf8f6213d9f0751dea843
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# Справочник — выбор протокола связи

Центр Интернета вещей позволяет устройствам использовать протоколы [MQTT][lnk-mqtt], MQTT через WebSocket, [AMQP][lnk-amqp], AMQP через WebSocket и HTTP для обмена данными на стороне устройства. Сведения о поддержке протоколов, используемых компонентами Центра Интернета вещей, см. в [руководстве по обмену данными между устройством и облаком][lnk-d2c-guidance] и [руководстве по обмену данными между облаком и устройством][lnk-c2d-guidance].

Ниже в таблице приведены общие рекомендации по выбору протокола.

| Протокол | Когда следует выбрать этот протокол |
| --- | --- |
| MQTT <br> MQTT через WebSocket |Используйте для всех устройств, которые не требуют подключения одновременно нескольких устройств (на каждом из которых используются собственные учетные данные) с помощью одного TLS-соединения. |
| AMQP <br> AMQP через WebSocket |Используйте на собственных или облачных шлюзах, чтобы воспользоваться преимуществами мультиплексирования подключений на устройствах. |
| HTTP |Используйте для устройств, которые не поддерживают другие протоколы. |

При выборе протокола для связи на стороне устройства учитывайте следующие факторы:

* **Шаблон сообщения из облака на устройство**. Протокол HTTP не позволяет отправлять данные по инициативе сервера. Таким образом, при использовании протокола HTTP устройства опрашивают Центр Интернета вещей на предмет наличия сообщений из облака на устройство. Этот подход неэффективен для устройства и Центра Интернета вещей. Согласно текущим рекомендациям для протокола HTTP каждое устройство должно выполнять опрос не реже, чем раз в 25 минут. С другой стороны, протоколы MQTT и AMQP поддерживают отправку сообщений по инициативе сервера при получении сообщений из облака на устройство. Они позволяют незамедлительно передавать сообщения из центра IoT на устройство. Если задержка доставки является проблемой, лучше использовать протокол MQTT или AMQP. Для редко подключаемых устройств также подходит протокол HTTP.
* **Шлюзы поля**. Протоколы MQTT и HTTP не позволяют подключать по TLS-соединению одновременно несколько устройств (на каждом из которых используются собственные учетные данные). Таким образом, эти протоколы не вполне подходят для [ситуаций с использованием полевого шлюза][lnk-azure-gateway-guidance], так как требуют отдельного TLS-подключения между полевым шлюзом и Центром Интернета вещей для каждого устройства, подключаемого к полевому шлюзу.
* **Устройства с небольшим количеством ресурсов**. Библиотеки MQTT и HTTP уступают по объему библиотекам AMQP, а значит, только их можно использовать для устройств с ограниченными ресурсами (например, если размер ОЗУ меньше 1 МБ).
* **Обход сети**. Для стандартного протокола AMQP используется порт 5671, в то время как протокол MQTT прослушивает порт 8883, что может вызвать проблемы в сетях, закрытых для протоколов, отличных от HTTP. В подобных случаях можно использовать протоколы HTTP, MQTT через WebSocket и AMQP через WebSocket.
* **Объем полезных данных**. MQTT и AMQP — это двоичные протоколы, позволяющие передавать более компактные полезные данные, чем HTTP.

> [!WARNING]
> При использовании протокола HTTP каждое устройство должно проверять наличие сообщений, передаваемых из облака на устройство, не реже, чем раз в 25 минут. Тем не менее, во время разработки частота такой проверки может быть выше.

## Номера портов

Устройства могут взаимодействовать с центром IoT в Azure с использованием различных протоколов. Как правило, выбор протокола определяется конкретными требованиями решения. В следующей таблице перечислены исходящие порты, которые должны быть открыты, чтобы устройство могло воспользоваться определенным протоколом.

| Протокол | Порт |
| --- | --- |
| MQTT |8883 |
| MQTT через WebSocket |443 |
| AMQP |5671 |
| AMQP через WebSocket |443 |
| HTTP |443 |

После создания Центра Интернета вещей в регионе Azure IP-адрес центра остается неизменным в течение всего времени его существования. Однако для обеспечения качества обслуживания при перемещении корпорацией Майкрософт центра IoT в другую единицу масштабирования центру назначается новый IP-адрес.


## Дальнейшие действия

Дополнительные сведения о реализации Центром Интернета вещей протокола MQTT см. в статье [Взаимодействие с Центром Интернета вещей с помощью протокола MQTT][lnk-mqtt-support].

[lnk-d2c-guidance]: iot-hub-devguide-d2c-guidance.md
[lnk-c2d-guidance]: iot-hub-devguide-c2d-guidance.md
[lnk-mqtt-support]: iot-hub-mqtt-support.md
[lnk-amqp]: http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-complete-v1.0-os.pdf
[lnk-mqtt]: http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.pdf
[lnk-azure-gateway-guidance]: iot-hub-devguide-endpoints.md#field-gateways
