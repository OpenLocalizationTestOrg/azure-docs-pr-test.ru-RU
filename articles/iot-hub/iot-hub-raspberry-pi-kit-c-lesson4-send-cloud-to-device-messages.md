---
title: "Подключение Raspberry Pi (C) к Интернету вещей Azure. Урок 4. Передача из облака на устройство | Документация Майкрософт"
description: "Пример приложения выполняется на устройстве Pi и отслеживает входящие сообщения от Центра Интернета вещей. Новая задача Gulp отправляет из Центра Интернета вещей сообщения на устройство Pi для управления состоянием индикатора."
services: iot-hub
documentationcenter: 
author: shizn
manager: timtl
tags: 
keywords: "Из облака на устройство, сообщение из облака"
ROBOTS: NOINDEX
redirect_url: /azure/iot-hub/iot-hub-raspberry-pi-kit-c-get-started
ms.assetid: fcbc0dd0-cae3-47b0-8e58-240e4f406f75
ms.service: iot-hub
ms.devlang: c
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 3/21/2017
ms.author: xshi
ms.openlocfilehash: 86c7be931319d9995c2a7311267c7e7c03c3c1b8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="run-a-sample-application-to-receive-cloud-to-device-messages"></a>Запуск примера приложения для получения сообщений из облака на устройство
В этой статье вы развернете пример приложения на устройстве Raspberry Pi 3. Пример приложения отслеживает входящие сообщения от Центра Интернета вещей. Вы можете также запустить на компьютере задачу Gulp для отправки сообщений из Центра Интернета вещей на устройство Pi. При получении сообщений пример приложения включает и отключает светодиодный индикатор. Если возникнут какие-либо проблемы, то решения можно найти на [странице со сведениями об устранении неполадок](iot-hub-raspberry-pi-kit-c-troubleshooting.md).

## <a name="what-you-will-do"></a>Выполняемая задача
* Подключите пример приложения к Центру Интернета вещей.
* Развернете и запустите пример приложения.
* Отправите сообщения от Центра Интернета вещей на устройство Pi для включения и отключения светодиодного индикатора.

## <a name="what-you-will-learn"></a>Новые знания
В этой статье вы узнаете следующее:
* Как отслеживать входящие сообщения от Центра Интернета вещей.
* Как отправлять сообщения из облака на устройство, т. е. из Центра Интернета вещей на устройство Pi.

## <a name="what-you-need"></a>Необходимые элементы
* Устройство Raspberry Pi 3, подготовленное к использованию. Узнайте, как настроить устройство Pi, в разделе [Настройка устройства](iot-hub-raspberry-pi-kit-c-lesson1-configure-your-device.md).
* Центр Интернета вещей, созданный в вашей подписке Azure. Узнайте, как создать Центр Интернета вещей, в разделе [Создание Центра Интернета вещей и регистрация Raspberry Pi 3](iot-hub-raspberry-pi-kit-c-lesson2-prepare-azure-iot-hub.md).

## <a name="connect-the-sample-application-to-your-iot-hub"></a>Подключение примера приложения к Центру Интернета вещей
1. Перейдите в папку репозитория `iot-hub-c-raspberrypi-getting-started`. Откройте пример приложения в Visual Studio Code, выполнив следующие команды:

   ```bash
   cd Lesson4
   code .
   ```

   Обратите внимание на файл `app.c`, созданный во вложенной папке `app`. Файл `app.c` содержит основной код для отслеживания входящих сообщений из Центра Интернета вещей. Функция `blinkLED` включает и отключает светодиодный индикатор.

   ![Структура репозитория в примере приложения](media/iot-hub-raspberry-pi-lessons/lesson4/repo_structure_c.png)
2. Запустите файл конфигурации, выполнив приведенную ниже команду.

   ```bash
   npm install
   gulp init
   ```

   Если вы выполнили действия, описанные в статье [Создание приложения-функции Azure и учетной записи хранения Azure](iot-hub-raspberry-pi-kit-c-lesson3-deploy-resource-manager-template.md), на этом компьютере, то все конфигурации наследуются, поэтому вы можете пропустить задачу развертывания и запуска примера приложения. Если вы выполнили действия, описанные в разделе [Create an Azure function app and Azure storage account](iot-hub-raspberry-pi-kit-c-lesson3-deploy-resource-manager-template.md) (Создание приложения-функции Azure и учетной записи хранения Azure), на другом компьютере, то необходимо заменить заполнители в файле `config-raspberrypi.json`. Файл `config-raspberrypi.json` находится во вложенной папке вашей домашней папки.

   ![Содержимое файла config-raspberrypi.json](media/iot-hub-raspberry-pi-lessons/lesson4/config_raspberrypi.png)

* Замените строку **[device hostname or IP address]** IP-адресом или именем узла вашего устройства Pi. Эти сведения можно получить, выполнив команду `devdisco list --eth`.
* Замените **[IoT device connection string]** строкой подключения к устройству, которую можно получить с помощью команды `az iot device show-connection-string --hub-name {my hub name} --device-id {device id} -g iot-sample {resource group name}`.
* Замените **[IoT hub connection string]** строкой подключения к Центру Интернета вещей, которую можно получить с помощью команды `az iot hub show-connection-string --name {my hub name} -g iot-sample {resource group name}`.

> [!NOTE]
> Выполните также **gulp install-tools**, если это не было сделано на уроке 1.

## <a name="deploy-and-run-the-sample-application"></a>Развертывание и запуск примера приложения
Разверните и запустите пример приложения на устройстве Pi, выполнив следующую команду:

```
gulp deploy && gulp run
```

Команда Gulp в первую очередь устанавливает средства. Затем она развертывает пример приложения на устройстве Pi. В конце она запускает приложение на устройстве Pi и отдельную задачу на главном компьютере, которая отправляет из Центра Интернета вещей 20 сообщений для включения и отключения светодиодного индикатора на устройство Pi.

Запущенное приложение начинает ожидать передачи сообщений от Центра Интернета вещей. Одновременно с этим задача Gulp отправляет несколько сообщений для включения и отключения светодиодного индикатора из Центра Интернета вещей на устройство Pi. При получении каждого такого сообщения пример приложения вызывает функцию `blinkLED` для включения и отключения светодиодного индикатора.

В результате этот индикатор должен мигать каждые две секунды, пока задача Gulp отправляет 20 сообщений от Центра Интернета вещей на устройство Pi. Последнее сообщение содержит команду stop, при получении которой приложение завершит работу.

![Пример приложения с командой Gulp и сообщениями для включения и отключения светодиодного индикатора](media/iot-hub-raspberry-pi-lessons/lesson4/gulp_blink_c.png)

## <a name="summary"></a>Сводка
Итак, вы успешно отправили сообщения от Центра Интернета вещей на устройство Pi для включения и отключения светодиодного индикатора. Следующая задача является необязательной: изменение режима включения и отключения светодиодного индикатора.

## <a name="next-steps"></a>Дальнейшие действия
[Изменение режима включения и отключения светодиодного индикатора](iot-hub-raspberry-pi-kit-c-lesson4-change-led-behavior.md)
