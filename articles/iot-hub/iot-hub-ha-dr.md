---
title: "Высокий уровень доступности и аварийное восстановление Центра Интернета вещей Azure | Документация Майкрософт"
description: "В статье описывается ряд возможностей Azure и Центра Интернета вещей для создания высокодоступных решений Интернета вещей Azure с функциями аварийного восстановления."
services: iot-hub
documentationcenter: 
author: fsautomata
manager: timlt
editor: 
ms.assetid: ae320e58-aa20-45b9-abdc-fa4faae8e6dd
ms.service: iot-hub
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/16/2016
ms.author: elioda
ms.openlocfilehash: 76c3187549e1821908263c30e394db26ee6f75e6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="iot-hub-high-availability-and-disaster-recovery"></a><span data-ttu-id="42df2-103">Высокая доступность и аварийное восстановление центра IoT</span><span class="sxs-lookup"><span data-stu-id="42df2-103">IoT Hub high availability and disaster recovery</span></span>
<span data-ttu-id="42df2-104">Будучи службой Azure, центр IoT отличается высоким уровнем доступности, который достигается за счет использования избыточности в одном регионе Azure. При этом к решению не выдвигаются никакие дополнительные требования.</span><span class="sxs-lookup"><span data-stu-id="42df2-104">As an Azure service, IoT Hub provides high availability (HA) using redundancies at the Azure region level, without any additional work required by the solution.</span></span> <span data-ttu-id="42df2-105">Платформа Microsoft Azure также включает в себя ряд возможностей для создания решений с функциями аварийного восстановления или межрегиональной доступностью.</span><span class="sxs-lookup"><span data-stu-id="42df2-105">The Microsoft Azure platform also includes features to help you build solutions with disaster recovery (DR) capabilities or cross-region availability.</span></span> <span data-ttu-id="42df2-106">Чтобы обеспечить глобальную, межрегиональную высокую доступность для устройств или пользователей, используйте эти функции Azure при разработке и подготовке своих решений.</span><span class="sxs-lookup"><span data-stu-id="42df2-106">If you want to provide global, cross-region high availability for devices or users, design and prepare your solutions to take advantage of these Azure DR features.</span></span> <span data-ttu-id="42df2-107">В [техническом руководстве по обеспечению устойчивости в Azure](../resiliency/resiliency-technical-guidance.md) описаны встроенные функции Azure, которые позволяют обеспечить непрерывность бизнес-процессов и возможности аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="42df2-107">The article [Azure Business Continuity Technical Guidance](../resiliency/resiliency-technical-guidance.md) describes the built-in features in Azure for business continuity and DR.</span></span> <span data-ttu-id="42df2-108">В статье [Аварийное восстановление и высокая доступность для приложений на платформе Azure][Disaster recovery and high availability for Azure applications] содержатся требования к архитектуре, которая позволяет обеспечить высокий уровень доступности приложений Azure и реализовать для них возможности аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="42df2-108">The [Disaster recovery and high availability for Azure applications][Disaster recovery and high availability for Azure applications] paper provides architecture guidance on strategies for Azure applications to achieve HA and DR.</span></span>

## <a name="azure-iot-hub-dr"></a><span data-ttu-id="42df2-109">Аварийное восстановление центра IoT Azure</span><span class="sxs-lookup"><span data-stu-id="42df2-109">Azure IoT Hub DR</span></span>
<span data-ttu-id="42df2-110">В дополнение к обеспечению высокой доступности внутри регионов центр IoT реализует механизмы отказоустойчивости для аварийного восстановления, которые не требуют вмешательства пользователя.</span><span class="sxs-lookup"><span data-stu-id="42df2-110">In addition to intra-region HA, IoT Hub implements failover mechanisms for disaster recovery that require no intervention from the user.</span></span> <span data-ttu-id="42df2-111">Аварийное восстановление центра IoT является самоинициируемым, целевое время восстановления (RTO) составляет от 2 до 26 часов, и доступны следующие целевые точки восстановления (RPO).</span><span class="sxs-lookup"><span data-stu-id="42df2-111">IoT Hub DR is self-initiated and has a recovery time objective (RTO) of 2-26 hours, and the following recovery point objectives (RPOs).</span></span>

| <span data-ttu-id="42df2-112">Функции</span><span class="sxs-lookup"><span data-stu-id="42df2-112">Functionality</span></span> | <span data-ttu-id="42df2-113">RPO</span><span class="sxs-lookup"><span data-stu-id="42df2-113">RPO</span></span> |
| --- | --- |
| <span data-ttu-id="42df2-114">Доступность службы для операций с реестром и операций взаимодействия</span><span class="sxs-lookup"><span data-stu-id="42df2-114">Service availability for registry and communication operations</span></span> |<span data-ttu-id="42df2-115">Возможна потеря записи CName</span><span class="sxs-lookup"><span data-stu-id="42df2-115">Possible CName loss</span></span> |
| <span data-ttu-id="42df2-116">Данные удостоверений в реестре удостоверений</span><span class="sxs-lookup"><span data-stu-id="42df2-116">Identity data in identity registry</span></span> |<span data-ttu-id="42df2-117">Потеря 0–5 мин данных</span><span class="sxs-lookup"><span data-stu-id="42df2-117">0-5 mins data loss</span></span> |
| <span data-ttu-id="42df2-118">Отправка сообщений с устройства в облако</span><span class="sxs-lookup"><span data-stu-id="42df2-118">Device-to-cloud messages</span></span> |<span data-ttu-id="42df2-119">Теряются все непрочитанные сообщения</span><span class="sxs-lookup"><span data-stu-id="42df2-119">All unread messages are lost</span></span> |
| <span data-ttu-id="42df2-120">Отправка сообщений о мониторинге операций</span><span class="sxs-lookup"><span data-stu-id="42df2-120">Operations monitoring messages</span></span> |<span data-ttu-id="42df2-121">Теряются все непрочитанные сообщения</span><span class="sxs-lookup"><span data-stu-id="42df2-121">All unread messages are lost</span></span> |
| <span data-ttu-id="42df2-122">Получение сообщений из облака на устройство</span><span class="sxs-lookup"><span data-stu-id="42df2-122">Cloud-to-device messages</span></span> |<span data-ttu-id="42df2-123">Потеря 0–5 мин данных</span><span class="sxs-lookup"><span data-stu-id="42df2-123">0-5 mins data loss</span></span> |
| <span data-ttu-id="42df2-124">Очередь отзывов из облака на устройство</span><span class="sxs-lookup"><span data-stu-id="42df2-124">Cloud-to-device feedback queue</span></span> |<span data-ttu-id="42df2-125">Теряются все непрочитанные сообщения</span><span class="sxs-lookup"><span data-stu-id="42df2-125">All unread messages are lost</span></span> |

## <a name="regional-failover-with-iot-hub"></a><span data-ttu-id="42df2-126">Отработка отказа между регионами с помощью центра IoT</span><span class="sxs-lookup"><span data-stu-id="42df2-126">Regional failover with IoT Hub</span></span>
<span data-ttu-id="42df2-127">Полное освещение топологий развертывания в решениях Интернета вещей выходит за рамки этой статьи.</span><span class="sxs-lookup"><span data-stu-id="42df2-127">A complete treatment of deployment topologies in IoT solutions is outside the scope of this article.</span></span> <span data-ttu-id="42df2-128">Чтобы раскрыть тему высокого уровня доступности и аварийного восстановления, в статье рассматривается модель развертывания с *отработкой отказа между регионами*.</span><span class="sxs-lookup"><span data-stu-id="42df2-128">The article discusses the *regional failover* deployment model for the purpose of high availability and disaster recovery.</span></span>

<span data-ttu-id="42df2-129">В модели с отработкой отказа между регионами серверная часть решения работает преимущественно в одном центре обработки данных, но в другом ЦОД в другом регионе развертываются дополнительный Центр Интернета вещей и дополнительная серверная часть.</span><span class="sxs-lookup"><span data-stu-id="42df2-129">In a regional failover model, the solution back end runs primarily in one datacenter location, and a secondary IoT hub and back end are deployed in another datacenter location.</span></span> <span data-ttu-id="42df2-130">Если в Центре Интернета вещей в основном ЦОД произойдет сбой или подключение устройства к основному ЦОД по какой-то причине будет нарушено.</span><span class="sxs-lookup"><span data-stu-id="42df2-130">If the IoT hub in the primary datacenter suffers an outage or the network connectivity from the device to the primary datacenter is interrupted.</span></span> <span data-ttu-id="42df2-131">Устройства используют дополнительную конечную точку службы всякий раз, когда основной шлюз недоступен.</span><span class="sxs-lookup"><span data-stu-id="42df2-131">Devices use a secondary service endpoint whenever the primary gateway cannot be reached.</span></span> <span data-ttu-id="42df2-132">Использование дополнительного региона при отработках отказов позволяет еще больше повысить уровень доступности решения.</span><span class="sxs-lookup"><span data-stu-id="42df2-132">With a cross-region failover capability, the solution availability can be improved beyond the high availability of a single region.</span></span>

<span data-ttu-id="42df2-133">Если говорить в общем, то чтобы реализовать модель с отработкой отказа между регионами, необходимо следующее:</span><span class="sxs-lookup"><span data-stu-id="42df2-133">At a high level, to implement a regional failover model with IoT Hub, you need the following:</span></span>

* <span data-ttu-id="42df2-134">**Дополнительный центр IoT и логика маршрутизации устройств**. В случае нарушения работы службы в основном регионе устройства должны подключаться к дополнительному региону.</span><span class="sxs-lookup"><span data-stu-id="42df2-134">**A secondary IoT hub and device routing logic**: In the case of a service disruption in your primary region, devices must start connecting to your secondary region.</span></span> <span data-ttu-id="42df2-135">Учитывая, что состояние большинства задействованных служб отслеживается, чаще всего процесс отработки отказа между регионами активируют администраторы решений.</span><span class="sxs-lookup"><span data-stu-id="42df2-135">Given the state-aware nature of most services involved, it is common for solution administrators to trigger the inter-region failover process.</span></span> <span data-ttu-id="42df2-136">Лучший способ сообщить устройствам новую конечную точку и сохранить контроль над процессом — заставить устройства регулярно получать из *дежурной* службы текущую активную конечную точку.</span><span class="sxs-lookup"><span data-stu-id="42df2-136">The best way to communicate the new endpoint to devices, while maintaining control of the process, is to have them regularly check a *concierge* service for the current active endpoint.</span></span> <span data-ttu-id="42df2-137">Дежурной службой может быть простое реплицируемое веб-приложение, доступность которого обеспечивается посредством перенаправления DNS-трафика (например, с помощью [диспетчера трафика Azure][Azure Traffic Manager]).</span><span class="sxs-lookup"><span data-stu-id="42df2-137">The concierge service can be a web application that is replicated and kept reachable using DNS-redirection techniques (for example, using [Azure Traffic Manager][Azure Traffic Manager]).</span></span>
* <span data-ttu-id="42df2-138">**Репликация реестра удостоверений**. Дополнительный Центр Интернета вещей будет работоспособен только в том случае, если в нем будут все удостоверения устройств и эти удостоверения смогут подключаться к решению.</span><span class="sxs-lookup"><span data-stu-id="42df2-138">**Identity registry replication** - To be usable, the secondary IoT hub must contain all device identities that can connect to the solution.</span></span> <span data-ttu-id="42df2-139">Решение должно хранить геореплицированные резервные копии удостоверений устройств и передавать их в дополнительный центр IoT до перевода устройств на другую конечную точку.</span><span class="sxs-lookup"><span data-stu-id="42df2-139">The solution should keep geo-replicated backups of device identities, and upload them to the secondary IoT hub before switching the active endpoint for the devices.</span></span> <span data-ttu-id="42df2-140">В этом случае вам пригодится функция Центра Интернета вещей для экспорта удостоверений устройств.</span><span class="sxs-lookup"><span data-stu-id="42df2-140">The device identity export functionality of IoT Hub is useful in this context.</span></span> <span data-ttu-id="42df2-141">Дополнительные сведения см. в [разделе, посвященном реестру удостоверений, руководства разработчика для Центра Интернета вещей][IoT Hub developer guide - identity registry].</span><span class="sxs-lookup"><span data-stu-id="42df2-141">For more information, see [IoT Hub developer guide - identity registry][IoT Hub developer guide - identity registry].</span></span>
* <span data-ttu-id="42df2-142">**Логика объединения**. Когда основной регион снова станет доступным, все состояния и данные, которые были созданы в дополнительном регионе, необходимо перенести обратно в основной.</span><span class="sxs-lookup"><span data-stu-id="42df2-142">**Merging logic** - When the primary region becomes available again, all the state and data that have been created in the secondary site must be migrated back to the primary region.</span></span> <span data-ttu-id="42df2-143">Эти состояния и данные главным образом относятся к удостоверениям устройств и метаданным приложений, которые необходимо добавить в основной Центр Интернета вещей и другие хранилища приложений в основном регионе.</span><span class="sxs-lookup"><span data-stu-id="42df2-143">This state and data mostly relates to device identities and application metadata, which must be merged with the primary IoT hub and any other application-specific stores in the primary region.</span></span> <span data-ttu-id="42df2-144">Чтобы упростить эту процедуру, следует использовать идемпотентные операции.</span><span class="sxs-lookup"><span data-stu-id="42df2-144">To simplify this step, you should use idempotent operations.</span></span> <span data-ttu-id="42df2-145">Они сводят к минимуму количество побочных эффектов от итогового согласованного распределения событий и от дублирования данных или беспорядочной доставки событий.</span><span class="sxs-lookup"><span data-stu-id="42df2-145">Idempotent operations minimize the side-effects from the eventual consistent distribution of events, and from duplicates or out-of-order delivery of events.</span></span> <span data-ttu-id="42df2-146">Кроме того, логику приложения необходимо спроектировать таким образом, чтобы потенциальные несоответствия или незначительно устаревшие состояния считались допустимыми.</span><span class="sxs-lookup"><span data-stu-id="42df2-146">In addition, the application logic should be designed to tolerate potential inconsistencies or "slightly" out of date-state.</span></span> <span data-ttu-id="42df2-147">Эта ситуация связана как с целевыми точками восстановления (RPO), так и с тем, что восстановление системы требует времени.</span><span class="sxs-lookup"><span data-stu-id="42df2-147">This situation can occur due to the additional time it takes for the system to "heal" based on recovery point objectives (RPO).</span></span>

## <a name="next-steps"></a><span data-ttu-id="42df2-148">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="42df2-148">Next steps</span></span>
<span data-ttu-id="42df2-149">Дополнительные сведения о центре IoT в Azure см. по следующим ссылкам:</span><span class="sxs-lookup"><span data-stu-id="42df2-149">Follow these links to learn more about Azure IoT Hub:</span></span>

* <span data-ttu-id="42df2-150">[Приступая к работе с Центром Интернета вещей Azure][lnk-get-started]</span><span class="sxs-lookup"><span data-stu-id="42df2-150">[Get started with IoT Hubs (Tutorial)][lnk-get-started]</span></span>
* <span data-ttu-id="42df2-151">[Что такое центр IoT в Azure?][What is Azure IoT Hub?]</span><span class="sxs-lookup"><span data-stu-id="42df2-151">[What is Azure IoT Hub?][What is Azure IoT Hub?]</span></span>

[Disaster recovery and high availability for Azure applications]: ../resiliency/resiliency-disaster-recovery-high-availability-azure-applications.md
[Azure Business Continuity Technical Guidance]: https://azure.microsoft.com/documentation/articles/resiliency-technical-guidance/
[Azure Traffic Manager]: https://azure.microsoft.com/documentation/services/traffic-manager/
[IoT Hub developer guide - identity registry]: iot-hub-devguide-identity-registry.md

[lnk-get-started]: iot-hub-csharp-csharp-getstarted.md
[What is Azure IoT Hub?]: iot-hub-what-is-iot-hub.md
