---
title: "Диагностика и устранение неполадок | Документация Майкрософт"
description: "В этом руководстве описывается, как выявлять и устранять неполадки в среде Time Series Insights."
keywords: 
services: time-series-insights
documentationcenter: 
author: venkatgct
manager: almineev
editor: cgronlun
ms.assetid: 
ms.service: time-series-insights
ms.devlang: na
ms.topic: how-to-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 04/24/2017
ms.author: venkatja
ms.openlocfilehash: 4b8d5fdab1744b2db658917f91d6dac05db30d2f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="diagnose-and-solve-problems-in-your-time-series-insights-environment"></a><span data-ttu-id="cc541-103">Диагностика и устранение неполадок в среде Time Series Insights</span><span class="sxs-lookup"><span data-stu-id="cc541-103">Diagnose and solve problems in your Time Series Insights environment</span></span>

## <a name="i-dont-see-my-data"></a><span data-ttu-id="cc541-104">Данные не отображаются</span><span class="sxs-lookup"><span data-stu-id="cc541-104">I don't see my data</span></span>
<span data-ttu-id="cc541-105">Ниже приведены некоторые причины, по которым данные могут не отображаться в среде на [портале Azure Time Series Insights](https://insights.timeseries.azure.com).</span><span class="sxs-lookup"><span data-stu-id="cc541-105">Here are some reasons why you might not see your data in your environment in the [Azure Time Series Insights portal](https://insights.timeseries.azure.com).</span></span>

### <a name="your-event-source-doesnt-have-data-in-json-format"></a><span data-ttu-id="cc541-106">Источник события не содержит данные в формате JSON</span><span class="sxs-lookup"><span data-stu-id="cc541-106">Your event source doesn't have data in JSON format</span></span>
<span data-ttu-id="cc541-107">Сейчас Azure Time Series Insights поддерживает только данные в формате JSON.</span><span class="sxs-lookup"><span data-stu-id="cc541-107">Azure Time Series Insights supports only JSON data today.</span></span> <span data-ttu-id="cc541-108">Примеры JSON см. в разделе [Поддерживаемые формы JSON](time-series-insights-send-events.md#supported-json-shapes).</span><span class="sxs-lookup"><span data-stu-id="cc541-108">For JSON samples, see [Supported JSON shapes](time-series-insights-send-events.md#supported-json-shapes).</span></span>

### <a name="when-you-registered-your-event-source-you-didnt-provide-the-key-that-has-the-required-permission"></a><span data-ttu-id="cc541-109">Во время регистрации источника события вы не предоставили ключ с необходимыми разрешениями</span><span class="sxs-lookup"><span data-stu-id="cc541-109">When you registered your event source, you didn't provide the key that has the required permission</span></span>
* <span data-ttu-id="cc541-110">Для Центра Интернета вещей необходимо указать ключ с разрешением на **подключение службы**.</span><span class="sxs-lookup"><span data-stu-id="cc541-110">For an IoT hub, you need to provide the key that has **service connect** permission.</span></span>

   ![Разрешение на подключение службы Центра Интернета вещей](media/diagnose-and-solve-problems/iothub-serviceconnect-permissions.png)

   <span data-ttu-id="cc541-112">Как показано на предыдущем рисунке, можно использовать политику **iothubowner** или **service**, так как обеим назначено разрешение на **подключение службы**.</span><span class="sxs-lookup"><span data-stu-id="cc541-112">As shown in the preceding image, either of the policies **iothubowner** and **service** would work, because both have **service connect** permission.</span></span>
* <span data-ttu-id="cc541-113">Для концентратора событий необходимо указать ключ с разрешением на **прослушивание**.</span><span class="sxs-lookup"><span data-stu-id="cc541-113">For an event hub, you need to provide the key that has **Listen** permission.</span></span>

   ![Разрешение на прослушивание концентратора событий](media/diagnose-and-solve-problems/eventhub-listen-permissions.png)

   <span data-ttu-id="cc541-115">Как показано на предыдущем рисунке, можно использовать политику **read** или **manage**, так как обеим назначено разрешение на **прослушивание**.</span><span class="sxs-lookup"><span data-stu-id="cc541-115">As shown in the preceding image, either of the policies **read** and **manage** would work, because both have **Listen** permission.</span></span>

### <a name="the-provided-consumer-group-is-not-exclusive-to-time-series-insights"></a><span data-ttu-id="cc541-116">Указанная группа потребителей не является уникальной для Time Series Insights</span><span class="sxs-lookup"><span data-stu-id="cc541-116">The provided consumer group is not exclusive to Time Series Insights</span></span>
<span data-ttu-id="cc541-117">Во время регистрации для Центра Интернета вещей или концентратора событий нужно указать группу потребителей, которая должна использоваться для чтения данных.</span><span class="sxs-lookup"><span data-stu-id="cc541-117">For an IoT hub or an event hub, during registration we require you to specify the consumer group that should be used for reading your data.</span></span> <span data-ttu-id="cc541-118">Эта группа потребителей не должна быть общей.</span><span class="sxs-lookup"><span data-stu-id="cc541-118">This consumer group must not be shared.</span></span> <span data-ttu-id="cc541-119">Иначе базовый концентратор событий случайным образом автоматически отключает один из модулей чтения.</span><span class="sxs-lookup"><span data-stu-id="cc541-119">If it's shared, the underlying event hub automatically disconnects one of the readers randomly.</span></span>

## <a name="i-see-my-data-but-theres-a-lag"></a><span data-ttu-id="cc541-120">Данные отображаются с задержкой</span><span class="sxs-lookup"><span data-stu-id="cc541-120">I see my data, but there's a lag</span></span>
<span data-ttu-id="cc541-121">Ниже приведены причины, по которым могут отображаться некоторые данные в среде на [портале Time Series Insights](https://insights.timeseries.azure.com).</span><span class="sxs-lookup"><span data-stu-id="cc541-121">Here are reasons why you might see partial data in your environment in the [Time Series Insights portal](https://insights.timeseries.azure.com).</span></span>

### <a name="your-environment-is-getting-throttled"></a><span data-ttu-id="cc541-122">Выполняется регулирование среды</span><span class="sxs-lookup"><span data-stu-id="cc541-122">Your environment is getting throttled</span></span>
<span data-ttu-id="cc541-123">Ограничение регулирования применяется на основе типа номера SKU и емкости среды.</span><span class="sxs-lookup"><span data-stu-id="cc541-123">The throttling limit is enforced based on the environment's SKU type and capacity.</span></span> <span data-ttu-id="cc541-124">Все источники событий в среде совместно используют емкость.</span><span class="sxs-lookup"><span data-stu-id="cc541-124">All event sources in the environment share this capacity.</span></span> <span data-ttu-id="cc541-125">Если источник событий Центра Интернета вещей или концентратора событий превышает ограничение по объему передаваемых данных, наблюдается регулирование и задержка.</span><span class="sxs-lookup"><span data-stu-id="cc541-125">If the event source for your IoT hub or event hub is pushing data beyond the enforced limits, you see throttling and a lag.</span></span>

<span data-ttu-id="cc541-126">На снимке экрана ниже показана среда Time Series Insights с номером SKU S1 и емкостью 3.</span><span class="sxs-lookup"><span data-stu-id="cc541-126">The following diagram shows a Time Series Insights environment that has a SKU of S1 and a capacity of 3.</span></span> <span data-ttu-id="cc541-127">Она может принимать 3 миллиона событий в день.</span><span class="sxs-lookup"><span data-stu-id="cc541-127">It can ingress 3 million events per day.</span></span>

![Текущая емкость номера SKU среды](media/diagnose-and-solve-problems/environment-sku-current-capacity.png)

<span data-ttu-id="cc541-129">Предположим, эта среда принимала сообщения из концентратора событий с определенной скоростью входящих данных, как показано на следующей схеме:</span><span class="sxs-lookup"><span data-stu-id="cc541-129">Assume that this environment is ingesting messages from an event hub with the ingress rate shown in the following diagram:</span></span>

![Пример скорости входящих данных для концентратора событий](media/diagnose-and-solve-problems/eventhub-ingress-rate.png)

<span data-ttu-id="cc541-131">Как показано на схеме, ежедневная частота приема составляет около 67 000 сообщений.</span><span class="sxs-lookup"><span data-stu-id="cc541-131">As shown in the diagram, the daily ingress rate is ~67,000 messages.</span></span> <span data-ttu-id="cc541-132">При этом передается примерно 46 сообщений в минуту.</span><span class="sxs-lookup"><span data-stu-id="cc541-132">This rate translates roughly to 46 messages every minute.</span></span> <span data-ttu-id="cc541-133">Если все сообщения концентратора событий свести к одному событию Time Series Insights, станет понятно, что в этой среде ничего не регулируется.</span><span class="sxs-lookup"><span data-stu-id="cc541-133">If each event hub message is flattened to a single Time Series Insights event, this environment sees no throttling.</span></span> <span data-ttu-id="cc541-134">Если все сообщения концентратора событий свести к 100 событиям Time Series Insights, каждую минуту будет передаваться по 4600 событий.</span><span class="sxs-lookup"><span data-stu-id="cc541-134">If each event hub message is flattened to 100 Time Series Insights events, then 4,600 events should be ingested every minute.</span></span> <span data-ttu-id="cc541-135">Среда с номером SKU S1 и емкостью 3 может принимать только 2100 событий в минуту (1 миллион событий в день = 700 событий в минуту на 3 единицы = 2100 событий в минуту).</span><span class="sxs-lookup"><span data-stu-id="cc541-135">An S1 SKU environment that has a capacity of 3 can ingress only 2,100 events every minute (1 million events per day = 700 events per minute at 3 units = 2,100 events per minute).</span></span> <span data-ttu-id="cc541-136">Поэтому из-за регулирования происходит задержка.</span><span class="sxs-lookup"><span data-stu-id="cc541-136">Therefore you see a lag due to throttling.</span></span> 

<span data-ttu-id="cc541-137">Подробные сведения о логике сведения см. в разделе [Поддерживаемые формы JSON](time-series-insights-send-events.md#supported-json-shapes).</span><span class="sxs-lookup"><span data-stu-id="cc541-137">For a high-level understanding of how flattening logic works, see [Supported JSON shapes](time-series-insights-send-events.md#supported-json-shapes).</span></span>

#### <a name="recommended-steps"></a><span data-ttu-id="cc541-138">Рекомендуемые действия</span><span class="sxs-lookup"><span data-stu-id="cc541-138">Recommended steps</span></span>
<span data-ttu-id="cc541-139">Чтобы устранить задержку, увеличьте емкость номера SKU среды.</span><span class="sxs-lookup"><span data-stu-id="cc541-139">To fix the lag, increase the SKU capacity of your environment.</span></span> <span data-ttu-id="cc541-140">Дополнительные сведения см. в статье [Как масштабировать среду Azure Time Series Insights](time-series-insights-how-to-scale-your-environment.md).</span><span class="sxs-lookup"><span data-stu-id="cc541-140">For more information, see [How to scale your Time Series Insights environment](time-series-insights-how-to-scale-your-environment.md).</span></span>

### <a name="youre-pushing-historical-data-and-causing-slow-ingress"></a><span data-ttu-id="cc541-141">Вы отправляете архивные данные, что приводит к медленной передаче входящих данных</span><span class="sxs-lookup"><span data-stu-id="cc541-141">You're pushing historical data and causing slow ingress</span></span>
<span data-ttu-id="cc541-142">Если вы подключаете существующий источник событий, скорее всего, в Центре Интернета вещей или концентраторе событий уже есть данные.</span><span class="sxs-lookup"><span data-stu-id="cc541-142">If you are connecting an existing event source, it's likely that your IoT hub or event hub already has data in it.</span></span> <span data-ttu-id="cc541-143">Поэтому среда начинает извлекать данные, как только сообщения источника событий начинают сохраняться.</span><span class="sxs-lookup"><span data-stu-id="cc541-143">So the environment starts pulling data from the beginning of the event source's message retention period.</span></span> 

<span data-ttu-id="cc541-144">Это поведение по умолчанию, которое невозможно переопределить.</span><span class="sxs-lookup"><span data-stu-id="cc541-144">This behavior is the default behavior and cannot be overridden.</span></span> <span data-ttu-id="cc541-145">Вы можете включить регулирование, поэтому обработка архивных данных может занять некоторое время.</span><span class="sxs-lookup"><span data-stu-id="cc541-145">You can engage throttling, and it may take a while to catch up on ingesting historical data.</span></span>

#### <a name="recommended-steps"></a><span data-ttu-id="cc541-146">Рекомендуемые действия</span><span class="sxs-lookup"><span data-stu-id="cc541-146">Recommended steps</span></span>
<span data-ttu-id="cc541-147">Чтобы устранить задержку, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="cc541-147">To fix the lag, take the following steps:</span></span>
1. <span data-ttu-id="cc541-148">Увеличьте емкость номера SKU до максимально допустимого значения (в этом случае — 10).</span><span class="sxs-lookup"><span data-stu-id="cc541-148">Increase the SKU capacity to the maximum allowed value (10 in this case).</span></span> <span data-ttu-id="cc541-149">После увеличения емкости прием данных ускорится.</span><span class="sxs-lookup"><span data-stu-id="cc541-149">After the capacity is increased, the ingress process starts catching up much faster.</span></span> <span data-ttu-id="cc541-150">Значение ускорения можно увидеть в таблице доступности на [портале Time Series Insights](https://insights.timeseries.azure.com).</span><span class="sxs-lookup"><span data-stu-id="cc541-150">You can visualize how quickly you're catching up through the availability chart in the [Time Series Insights portal](https://insights.timeseries.azure.com).</span></span> <span data-ttu-id="cc541-151">Плата взимается за увеличенную емкость.</span><span class="sxs-lookup"><span data-stu-id="cc541-151">You are charged for the increased capacity.</span></span>
2. <span data-ttu-id="cc541-152">Устранив задержку, уменьшите емкость номера SKU до нормального уровня приема.</span><span class="sxs-lookup"><span data-stu-id="cc541-152">After the lag is caught up, decrease the SKU capacity back to your normal ingress rate.</span></span>

## <a name="my-event-sources-timestamp-property-name-setting-doesnt-work"></a><span data-ttu-id="cc541-153">Параметр *имени свойства метки времени* источника события не работает</span><span class="sxs-lookup"><span data-stu-id="cc541-153">My event source's *timestamp property name* setting doesn't work</span></span>
<span data-ttu-id="cc541-154">Убедитесь, что имя и значение соответствуют следующим правилам:</span><span class="sxs-lookup"><span data-stu-id="cc541-154">Ensure that the name and value conform to the following rules:</span></span>
* <span data-ttu-id="cc541-155">В имени свойства метки времени _учитывается регистр_.</span><span class="sxs-lookup"><span data-stu-id="cc541-155">The timestamp property name is _case-sensitive_.</span></span>
* <span data-ttu-id="cc541-156">Так как значение свойства метки времени из источника событий является строкой JSON, оно должно иметь формат _гггг-мм-ддТчч:мм:сс.FFFFFFFK_.</span><span class="sxs-lookup"><span data-stu-id="cc541-156">The timestamp property value that's coming from your event source, as a JSON string, should have the format _yyyy-MM-ddTHH:mm:ss.FFFFFFFK_.</span></span> <span data-ttu-id="cc541-157">Например 2008-04-12T12:53Z.</span><span class="sxs-lookup"><span data-stu-id="cc541-157">An example of such a string is “2008-04-12T12:53Z”.</span></span>
