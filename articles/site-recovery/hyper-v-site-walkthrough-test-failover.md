---
title: "Запуск тестовой отработки отказа для репликации Hyper-V (без System Center VMM) в Azure | Документация Майкрософт"
description: "В этой статье кратко описаны шаги для запуска тестовой отработки отказа при репликации виртуальных машин из Hyper-V в Azure с помощью службы Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c9a4c3ca-84a0-4668-b700-9b0046202299
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 06/22/2017
ms.author: raynew
ms.openlocfilehash: 0974b9eda2cb7e3ba54a4a0fad0a768db644caf9
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="step-11-run-a-test-failover-for-hyper-v-replication-to-azure"></a><span data-ttu-id="3dcb7-103">Шаг 11. Выполнение тестовой отработки отказа для репликации Hyper-V в Azure</span><span class="sxs-lookup"><span data-stu-id="3dcb7-103">Step 11: Run a test failover for Hyper-V replication to Azure</span></span>

<span data-ttu-id="3dcb7-104">В этой статье описано, как запустить тестовую отработку отказа для локальных виртуальных машин Hyper-V (которыми не управляет System Center VMM) в Azure с помощью службы [Azure Site Recovery](site-recovery-overview.md) на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-104">This article describes how to run a test failover from  on-premises Hyper-V virtual machines (not managed by System Center VMM) to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service in the Azure portal.</span></span>

<span data-ttu-id="3dcb7-105">Комментарии или вопросы можно добавить в конце этой статьи или на [форуме по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-105">Post comments and questions at the bottom of this article, or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="before-you-start"></a><span data-ttu-id="3dcb7-106">Перед началом работы</span><span class="sxs-lookup"><span data-stu-id="3dcb7-106">Before you start</span></span>

<span data-ttu-id="3dcb7-107">Перед запуском тестовой отработки отказа рекомендуется проверить свойства виртуальной машины и внести необходимые изменения.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-107">Before you run a test failover we recommend that you verify the VM properties, and make any changes you need to.</span></span> <span data-ttu-id="3dcb7-108">Свойства виртуальной машины доступны в разделе **Реплицированные элементы**.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-108">you can access the VM properties in **Replicated items**.</span></span> <span data-ttu-id="3dcb7-109">В колонке **Основные компоненты** отображается информация о параметрах и состоянии компьютеров.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-109">The **Essentials** blade shows information about machines settings and status.</span></span>

## <a name="managed-disk-considerations"></a><span data-ttu-id="3dcb7-110">Рекомендации относительно управляемых дисков</span><span class="sxs-lookup"><span data-stu-id="3dcb7-110">Managed disk considerations</span></span>

<span data-ttu-id="3dcb7-111">[Управляемые диски](../virtual-machines/windows/managed-disks-overview.md) упрощают управление дисками виртуальных машин Azure. Они управляют учетными записями хранения, связанными с этими дисками.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-111">[Managed disks](../virtual-machines/windows/managed-disks-overview.md) simplify disk management for Azure VMs, by managing the storage accounts associated with the VM disks.</span></span> 

- <span data-ttu-id="3dcb7-112">Управляемые диски создаются и подключаются к виртуальной машине только при отработке отказа в Azure.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-112">Managed disks are created and attached to the VM only when a failover to Azure occurs.</span></span> <span data-ttu-id="3dcb7-113">При включении защиты данные из локальных виртуальных машин реплицируются в учетные записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-113">When you enable protection, data from on-premises VMs replicates to storage accounts.</span></span>
- <span data-ttu-id="3dcb7-114">Управляемые диски можно создавать только для виртуальных машин, развернутых с помощью модели развертывания Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-114">Managed disks can be created only for VMs that are deployed using the Resource manager deployment model.</span></span>
- <span data-ttu-id="3dcb7-115">Сейчас восстановление размещения из Azure в локальную среду Hyper-V не поддерживается для виртуальных машин с управляемыми дисками.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-115">Failback from Azure to an on-premises Hyper-V environment is not currently supported for machines with managed disks.</span></span> <span data-ttu-id="3dcb7-116">При выполнении только переноса следует задать для параметра **Использование управляемых дисков** значение **Да** (отработка отказа в Azure без восстановления размещения).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-116">You should only set **Use managed disks** to **Yes** if you're doing a migration only (failover to Azure without failback)</span></span>
- <span data-ttu-id="3dcb7-117">Если этот параметр включен, то можно выбрать только группы доступности в группах ресурсов с включенным параметром **Использование управляемых дисков**.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-117">With this setting enabled, only availability sets in Resource Groups that have **Use managed disks** enabled can be selected.</span></span> <span data-ttu-id="3dcb7-118">Виртуальные машины с управляемыми дисками должны находиться в группах доступности, в которых для параметра **Использование управляемых дисков** задано значение **Да**.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-118">VMs with managed disks must be in availability sets with **Use managed disks** set to **Yes**.</span></span> <span data-ttu-id="3dcb7-119">Если этот параметр не включен для виртуальных машин, то можно выбрать только группы доступности в группах ресурсов без включенного параметра использования управляемых дисков.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-119">If the setting isn't enabled for VMs, then only availability sets in Resource Groups without managed disks enabled can be selected.</span></span> <span data-ttu-id="3dcb7-120">[Подробнее](https://docs.microsoft.com/azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-120">[Learn more](https://docs.microsoft.com/azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set).</span></span>
- - <span data-ttu-id="3dcb7-121">Если учетная запись хранения, используемая для репликации, была зашифрована с помощью шифрования службы хранилища, то во время отработки отказа не удастся создать управляемые диски.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-121">If the storage account you use for replication has been encrypted with Storage Service Encryption, managed disks can't be created during failover.</span></span> <span data-ttu-id="3dcb7-122">В этом случае или не включайте использование управляемых дисков, или отключите защиту виртуальной машины, а затем включите ее повторно, используя учетную запись хранения, в которой не включено шифрование.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-122">In this case either don't enable use of managed disks, or disable protection for the VM, and reenable it to use a storage account that doesn't have encryption enabled.</span></span> <span data-ttu-id="3dcb7-123">[Подробнее](https://docs.microsoft.com/azure/storage/storage-managed-disks-overview#managed-disks-and-encryption).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-123">[Learn more](https://docs.microsoft.com/azure/storage/storage-managed-disks-overview#managed-disks-and-encryption).</span></span>

 
## <a name="network-considerations"></a><span data-ttu-id="3dcb7-124">Рекомендации относительно сети</span><span class="sxs-lookup"><span data-stu-id="3dcb7-124">Network considerations</span></span>
    
- <span data-ttu-id="3dcb7-125">Вы можете задать целевой IP-адрес, который будет использоваться для виртуальной машины Azure после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-125">You can set the target IP address to be used for the Azure VM after failover.</span></span> <span data-ttu-id="3dcb7-126">Если не указать его, компьютер, для которого выполнена отработка отказа, будет использовать DHCP.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-126">If you don't provide an address, the failed over machine will use DHCP.</span></span> <span data-ttu-id="3dcb7-127">Если задать адрес, недоступный при отработке отказа, произойдет сбой.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-127">If you set an address that isn't available at failover, the failover will fail.</span></span> <span data-ttu-id="3dcb7-128">Этот же целевой IP-адрес можно использовать для тестовой отработки отказа, если он доступен в сети тестовой отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-128">The same target IP address can be used for test failover if the address is available in the test failover network.</span></span>
- <span data-ttu-id="3dcb7-129">Количество сетевых адаптеров зависит от размера, указанного для целевой виртуальной машины:</span><span class="sxs-lookup"><span data-stu-id="3dcb7-129">The number of network adapters is dictated by the size you specify for the target virtual machine, as follows:</span></span>
    - <span data-ttu-id="3dcb7-130">Если число сетевых адаптеров на исходной машине меньше или равно числу адаптеров, разрешенному для целевой машины, то количество адаптеров на целевой машине будет таким же.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-130">If the number of network adapters on the source machine is less than or equal to the number of adapters allowed for the target machine size, then the target will have the same number of adapters as the source.</span></span>
    - <span data-ttu-id="3dcb7-131">Если число адаптеров на исходной виртуальной машине превышает допустимое для целевого размера, то будет использовать максимальный размер целевой машины.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-131">If the number of adapters for the source virtual machine exceeds the number allowed for the target size then the target size maximum will be used.</span></span>
    - <span data-ttu-id="3dcb7-132">Например, если на исходной машине есть два сетевых адаптера, а размер целевой машины поддерживает четыре, то на целевой машине будет два адаптера.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-132">For example if a source machine has two network adapters and the target machine size supports four, the target machine will have two adapters.</span></span> <span data-ttu-id="3dcb7-133">Если на исходной машине два адаптера, но целевой размер поддерживает только один, то на целевой машине будет только один адаптер.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-133">If the source machine has two adapters but the supported target size only supports one then the target machine will have only one adapter.</span></span>     
- <span data-ttu-id="3dcb7-134">Если для виртуальной машины настроено несколько сетевых адаптеров, они будут подключены к одной сети.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-134">If the VM has multiple network adapters they will all connect to the same network.</span></span>
- <span data-ttu-id="3dcb7-135">Если виртуальная машина имеет несколько сетевых адаптеров, сетевым адаптером *по умолчанию* для этой виртуальной машины Azure станет тот из них, который расположен в списке первым.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-135">If the virtual machine has multiple network adapters then the first one shown in the list becomes the *Default* network adapter in the Azure virtual machine.</span></span>


## <a name="view-and-manage-vm-settings"></a><span data-ttu-id="3dcb7-136">Просмотр параметров виртуальной машины и управление ими</span><span class="sxs-lookup"><span data-stu-id="3dcb7-136">View and manage VM settings</span></span>

<span data-ttu-id="3dcb7-137">Перед выполнением отработки отказа рекомендуется проверить свойства исходного компьютера.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-137">We recommend that you verify the properties of the source machine before you run a failover.</span></span>

1. <span data-ttu-id="3dcb7-138">В разделе **Защищенные элементы** щелкните **Реплицированные элементы** и выберите виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-138">In **Protected Items**, click **Replicated Items**, and click the VM.</span></span>

    ![Включение репликации](./media/hyper-v-site-walkthrough-test-failover/test-failover1.png)
2. <span data-ttu-id="3dcb7-140">В области **Реплицированный элемент** можно просмотреть сводные данные о виртуальной машине, включая состояние работоспособности и последние доступные точки восстановления.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-140">In the **Replicated item** pane, you can see a summary of VM information, health status, and the latest available recovery points.</span></span> <span data-ttu-id="3dcb7-141">Щелкните **Свойства**, чтобы просмотреть дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-141">Click **Properties** to view more details.</span></span>

    ![Включение репликации](./media/hyper-v-site-walkthrough-test-failover/test-failover2.png)
3. <span data-ttu-id="3dcb7-143">В разделе **Вычисления и сеть** можно выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="3dcb7-143">In **Compute and Network**, you can:</span></span>
    - <span data-ttu-id="3dcb7-144">Изменить имя виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-144">Modify the Azure VM name.</span></span> <span data-ttu-id="3dcb7-145">Это имя должно соответствовать [требованиям Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-145">The name must meet [Azure requirements](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).</span></span>
    - <span data-ttu-id="3dcb7-146">Указать [группу ресурсов], которая будет использоваться после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-146">Specify a post-failover [resource group].</span></span>
    - <span data-ttu-id="3dcb7-147">Указать целевой размер для виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-147">Specify a target size for the Azure VM</span></span>
    - <span data-ttu-id="3dcb7-148">Выбрать [группу доступности](../virtual-machines/windows/tutorial-availability-sets.md).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-148">Select an [availability set](../virtual-machines/windows/tutorial-availability-sets.md).</span></span>
    - <span data-ttu-id="3dcb7-149">Указать, следует ли использовать [управляемые диски](#managed-disk-considerations).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-149">Specify whether to use [managed disks](#managed-disk-considerations).</span></span> <span data-ttu-id="3dcb7-150">Выберите значение **Да**, если требуется подключить управляемые диски к виртуальной машине при переносе в Azure.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-150">Select **Yes**, if you want to attach managed disks to your machine on migration to Azure.</span></span>
    - <span data-ttu-id="3dcb7-151">Просмотреть или изменить параметры сети, включая сеть (или подсеть), в которой будет размещаться виртуальная машина Azure после отработки отказа, и IP-адрес, который будет ей назначен.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-151">View or modify network settings, including the network/subnet in which the Azure VM will be located after failover, and the IP address that will be assigned to it.</span></span>

    ![Включение репликации](./media/hyper-v-site-walkthrough-test-failover/test-failover4.png)
4. <span data-ttu-id="3dcb7-153">В разделе **Диски** отображаются сведения о дисках операционной системы и дисках данных на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-153">In **Disks**, you can see information about the operating system and data disks on the VM.</span></span>


## <a name="run-a-test-failover"></a><span data-ttu-id="3dcb7-154">Запуск тестовой отработки отказа</span><span class="sxs-lookup"><span data-stu-id="3dcb7-154">Run a test failover</span></span>

<span data-ttu-id="3dcb7-155">Теперь запустите тестовую отработку отказа, чтобы убедиться в надлежащей работе всех компонентов.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-155">Now, run a test failover to make sure everything's working as expected.</span></span>

- <span data-ttu-id="3dcb7-156">Если вам нужно, чтобы после отработки отказа к виртуальным машинам Azure можно было подключиться по протоколу RDP, то выполните действия по [подготовке к подключению](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-156">If you want to connect to Azure VMs using RDP after failover, [prepare to connect](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover).</span></span>
 - <span data-ttu-id="3dcb7-157">Чтобы полностью проверить систему, скопируйте Active Directory и DNS в тестовую среду.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-157">To fully test you need to copy of Active Directory and DNS in your test environment.</span></span> <span data-ttu-id="3dcb7-158">[Подробнее](site-recovery-active-directory.md#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-158">[Learn more](site-recovery-active-directory.md#test-failover-considerations).</span></span>
 - <span data-ttu-id="3dcb7-159">Полные сведения о тестовой отработке отказа можно найти в [этой статье](site-recovery-test-failover-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-159">For full information about test failover, read [this article](site-recovery-test-failover-to-azure.md) article.</span></span>
 
 <span data-ttu-id="3dcb7-160">Теперь давайте запустим отработку отказа:</span><span class="sxs-lookup"><span data-stu-id="3dcb7-160">Now run a failover:</span></span>

1. <span data-ttu-id="3dcb7-161">Чтобы выполнить отработку отказа для одного компьютера, в разделе **Реплицированные элементы** щелкните виртуальную машину, а затем — значок **Тестовая отработка отказа**.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-161">To fail over a single machine, in **Replicated Items**, click the VM > **+Test Failover** icon.</span></span>
2. <span data-ttu-id="3dcb7-162">Чтобы выполнить отработку отказа по плану восстановления, в разделе **Планы восстановления** щелкните план правой кнопкой мыши и выберите **Тестовая отработка отказа**.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-162">To fail over a recovery plan, in **Recovery Plans**, right-click the plan > **Test Failover**.</span></span> <span data-ttu-id="3dcb7-163">Чтобы создать план восстановления, [выполните эти инструкции](site-recovery-create-recovery-plans.md).</span><span class="sxs-lookup"><span data-stu-id="3dcb7-163">To create a recovery plan, [follow these instructions](site-recovery-create-recovery-plans.md).</span></span>
3. <span data-ttu-id="3dcb7-164">На странице **Тестовая отработка отказа** выберите сеть Azure, к которой будут подключаться виртуальные машины Azure после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-164">In **Test Failover**, select the Azure network to which Azure VMs will be connected after failover occurs.</span></span>
4. <span data-ttu-id="3dcb7-165">Нажмите кнопку **ОК** , чтобы запустить отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-165">Click **OK** to begin the failover.</span></span> <span data-ttu-id="3dcb7-166">За ходом выполнения можно следить в окне свойств, которое можно открыть, щелкнув виртуальную машину, или в задании **тестовой отработки отказа**, выбрав имя хранилища > **Задания** > **Задания Azure Site Recovery**.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-166">You can track progress by clicking on the VM to open its properties, or on the **Test Failover** job in vault name > **Jobs** > **Site Recovery jobs**.</span></span>
5. <span data-ttu-id="3dcb7-167">После завершения отработки отказа реплика виртуальной машины Azure появится на портале Azure в разделе **Виртуальные машины**.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-167">After the failover completes, you should also be able to see the replica Azure machine appear in the Azure portal > **Virtual Machines**.</span></span> <span data-ttu-id="3dcb7-168">Следует убедиться, что виртуальная машина имеет соответствующий размер, подключена к соответствующей сети и работает.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-168">You should make sure that the VM is the appropriate size, that it's connected to the appropriate network, and that it's running.</span></span>
6. <span data-ttu-id="3dcb7-169">Если вы заранее подготовились к подключению после отработки отказа, вы сможете подключиться к виртуальной машине Azure.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-169">If you prepared for connections after failover, you should be able to connect to the Azure VM.</span></span>
7. <span data-ttu-id="3dcb7-170">По завершении нажмите кнопку **Cleanup test failover** (Очистить тестовую отработку отказа) в плане восстановления.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-170">After you finish, click on **Cleanup test failover** on the recovery plan.</span></span> <span data-ttu-id="3dcb7-171">При необходимости в разделе **примечаний** можно записать и сохранить ваши наблюдения касательно тестовой отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-171">In **Notes** record and save any observations associated with the test failover.</span></span> <span data-ttu-id="3dcb7-172">Это приведет к удалению виртуальных машин, созданных при тестовой отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-172">This will delete the virtual machines that were created during test failover.</span></span>



## <a name="next-steps"></a><span data-ttu-id="3dcb7-173">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="3dcb7-173">Next steps</span></span>

- <span data-ttu-id="3dcb7-174">[Узнайте больше](site-recovery-failover.md) о разных типах отработки отказа и способах их выполнения.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-174">[Learn more](site-recovery-failover.md) about different types of failovers, and how to run them.</span></span>
- <span data-ttu-id="3dcb7-175">[См. сведения в этой статье](site-recovery-failback-from-azure-to-hyper-v.md), если вам нужно выполнить восстановление размещения и репликацию виртуальных машин Azure на основном локальном сайте Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="3dcb7-175">[Read about failback](site-recovery-failback-from-azure-to-hyper-v.md), to fail back and replicate Azure VMs back to the primary on-premises Hyper-V site.</span></span>

