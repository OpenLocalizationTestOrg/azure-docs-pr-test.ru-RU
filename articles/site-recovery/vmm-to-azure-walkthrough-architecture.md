---
title: "Архитектура hello aaaReview для tooAzure репликации (с System Center VMM) Hyper-V с помощью Azure Site Recovery | Документы Microsoft"
description: "В этой статье содержится обзор компонентов и архитектура, используемая при репликации локальных виртуальных машин Hyper-V в tooAzure облака VMM, со службой Azure Site Recovery hello."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 07/24/2017
ms.author: raynew
ms.openlocfilehash: ee1f2775b0c929894933b639464176d7a0441519
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="step-1-review-hello-architecture"></a>Шаг 1: Проверка hello архитектуры


В этой статье описываются компоненты hello и процессы, которые используются при репликации локальных виртуальных машин Hyper-V в облаках диспетчера виртуальных машин System Center (VMM), с помощью hello tooAzure [Azure Site Recovery](site-recovery-overview.md) службы.

Отправлять все комментарии hello нижней части этой статьи, или в hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).



## <a name="architectural-components"></a>Компоненты архитектуры

Ряд компонентов участвуют, при репликации виртуальных машин Hyper-V в облаках tooAzure VMM.

**Компонент** | **Требование** | **Дополнительные сведения**
--- | --- | ---
**Таблицы Azure** | В Azure вам требуется учетная запись Microsoft Azure, учетная запись хранения Azure и сеть Azure. | Реплицированные данные хранятся в учетной записи хранения hello и виртуальных машинах Azure создаются с hello реплицированных данных, когда происходит переход на другой ресурс с веб-узла в локальной среде.<br/><br/> Hello виртуальных машинах Azure подключиться toohello виртуальной сети Azure, когда они создаются.
**Сервер VMM** | Сервер VMM Hello имеет одно или несколько облаков, содержащий узлы Hyper-V. | На сервере VMM hello Установка hello поставщика Site Recovery tooorchestrate репликации с компонентом восстановления сайта и зарегистрировать сервер hello в hello в хранилище служб восстановления.
**Узел Hyper-V** | Один или несколько кластеров (узлов) Hyper-V под управлением VMM. |  Установите агент служб восстановления hello на каждый член узла или кластера.
**Виртуальные машины Hyper-V** | Хотя бы одна виртуальная машина, запущенная на сервере узла Hyper-V. | Ничего не должен tooexplicitly, установленных на виртуальных машинах.
**Сеть** |Логическое "и" сети виртуальных Машин настроены на сервере VMM hello. Сеть виртуальной Машины должно быть связанного tooa логической сети, связанной с облаком hello. | Сети виртуальных Машин являются сопоставленных tooAzure виртуальных сетей, виртуальных машинах Azure находятся в сети, когда они создаются после отработки отказа.

Дополнительные сведения о необходимых условий развертывания hello и требования для каждого из этих компонентов в hello [Матрица поддержки](site-recovery-support-matrix-to-azure.md).


**Рисунок 1: Репликация виртуальных машин на узлах Hyper-V в tooAzure облака VMM**

![Компоненты](./media/vmm-to-azure-walkthrough-architecture/arch-onprem-onprem-azure-vmm.png)


## <a name="replication-process"></a>Процесс репликации

**Рисунок 2: Процесс репликации и восстановления для tooAzure репликации Hyper-V**

![рабочий процесс](./media/vmm-to-azure-walkthrough-architecture/arch-hyperv-azure-workflow.png)

### <a name="enable-protection"></a>Включить защиту

1. После включения защиты для виртуальной Машины Hyper-V в hello портала Azure или локально, hello **включить защиту** запускает.
2. Hello задания проверяет, что компьютер, hello соответствует необходимым требованиям, перед вызовом hello [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), tooset репликации заданы параметры hello.
3. Hello задание запускается начальная репликация с помощью вызова hello [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) метод tooinitialize полной репликации виртуальной Машины и tooAzure виртуальные диски send hello Виртуальной машины.
4. Вы можете отслеживать задания hello в hello **заданий** вкладки.      ![Список заданий](media/vmm-to-azure-walkthrough-architecture/image1.png)![Подробные сведения о включении защиты](media/vmm-to-azure-walkthrough-architecture/image2.png)

### <a name="replicate-hello-initial-data"></a>Репликация hello первоначальных данных

1. При запуске начальной репликации создается [моментальный снимок виртуальной машины Hyper-V](https://technet.microsoft.com/library/dd560637.aspx).
2. Виртуальные жесткие диски, реплицируемых по одному до они все скопированные tooAzure. Он может занять некоторое время, в зависимости от hello размер виртуальной Машины и пропускной способности сети. toooptimize использование вашей сети, в разделе [как toomanage локальной пропускной способности сети защиты tooAzure](https://support.microsoft.com/kb/3056159).
3. В случае изменения диска во время начальной репликации hello отслеживания репликации реплика Hyper-V отслеживает эти изменения как журналы репликации Hyper-V (.hrl). Эти файлы расположены в hello же папке, что диски hello. Каждый диск имеет связанный .hrl файл, будут отправляться toosecondary хранилища.
4. файлы моментальных снимков и журналов Hello потребляют ресурсы диска, во время начальной репликации.
5. После завершения начальной репликации hello, удаление снимка виртуальной Машины hello. Диск изменений в журнале hello, синхронизированным и объединенные toohello родительского диска.


### <a name="finalize-protection"></a>Завершение подготовки защиты

1. По завершении начальной репликации hello hello **завершить подготовку защиты на виртуальной машине hello** задания настроить сеть и другие параметры после репликации таким образом, чтобы hello виртуальная машина защищена.
    ![Задание завершения подготовки защиты](media/vmm-to-azure-walkthrough-architecture/image3.png)
2. Если выполняется репликация tooAzure, может потребоваться tootweak hello параметры для hello виртуальной машины, чтобы она готова для отработки отказа. На этом этапе можно запустить toocheck отработки отказа теста, который все работает, как ожидалось.

### <a name="replicate-hello-delta"></a>Репликация изменений hello

1. После начальной репликации hello начинает разностной синхронизации, в соответствии с параметрами репликации.
2. Hello отслеживания репликации реплика Hyper-V отслеживает файлы .hrl hello изменения tooa виртуального жесткого диска. Для каждого диска, предназначенного для репликации, создается связанный HRL-файл. Этот журнал отправляется toohello пользовательской учетной записи хранения, после завершения начальной репликации. Если журнал транспорте tooAzure, в другой файл журнала, в hello отслеживаются изменения hello основной диск hello один каталог.
3. Во время начального и разностных репликации можно отслеживать hello виртуальной Машины в hello представление виртуальной Машины. [Подробнее](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).  

### <a name="synchronize-replication"></a>Синхронизация репликации

1. Если происходит сбой дельта-репликации и для полной репликации необходима высокая пропускная способность или требуется много времени, тогда виртуальная машина помечается для повторной синхронизации. Например если файлы .hrl hello достигают 50% от размера диска hello, затем hello ВМ помечается для повторной синхронизации.
2.  Повторная синхронизация сводит к минимуму hello объем данных, посланных расчет контрольных сумм hello исходных и целевых виртуальных машин и отправка только hello дельта-данные. Повторная синхронизация использует алгоритм фрагментации, то есть разбивает исходный и целевой файлы на блоки фиксированного размера. Контрольные суммы для каждого фрагмента данных создаются и затем сравнивается toodetermine, который блокирует hello источника необходимость toobe примененных toohello цели.
3. После завершения повторной синхронизации возобновляется обычная разностная репликация данных. По умолчанию повторная синхронизация является запланированных toorun автоматически вне времени office, но можно синхронизировать виртуальную машину вручную. Например, в случае сбоя сети или другого сбоя повторную синхронизацию можно возобновить. toodo это, выберите hello ВМ на портале hello > **повторной синхронизации**.

    ![Повторная синхронизация вручную](media/vmm-to-azure-walkthrough-architecture/image4.png)


### <a name="retry-logic"></a>Логика повторных попыток

При ошибке репликации используется встроенный механизм повторных попыток. Этот алгоритм предполагает работу с двумя представленными ниже категориями ошибок.

**Категория** | **Дополнительные сведения**
--- | ---
**Неустранимые ошибки** | Без повторных попыток. Состояние виртуальной машины отображается как **Критическое**, что требует вмешательства администратора. Примеры этих ошибок: разрыв цепочки виртуальных жестких ДИСКОВ; Недопустимое состояние для hello реплики виртуальной Машины; Сетевые ошибки проверки подлинности: ошибки авторизации; Виртуальная машина не обнаружены ошибки (для изолированных серверов Hyper-V)
**Устранимые ошибки** | Повторы выполняются каждый интервал репликации, с помощью экспоненциальной отсрочки, увеличивает интервал повтора hello от начала hello hello первой попытки, 1, 2, 4, 8 и 10 минут. Если проблема не устранена, повторные попытки выполняются каждые 30 минут. Примеры таких ошибок: сетевые ошибки, дефицит места на диске, нехватка памяти. |



## <a name="failover-and-failback-process"></a>Процесс отработки отказа и восстановления размещения

1. Выполнением запланированного или незапланированного [перехода на другой ресурс](site-recovery-failover.md) из tooAzure локальных виртуальных машин Hyper-V. Если запустить плановую отработку отказа, то источник виртуальных машин, завершают работу tooensure без потери данных.
2. При сбое одного компьютера или создайте [планы восстановления](site-recovery-create-recovery-plans.md) tooorchestrate отработки отказа нескольких машин.
4. После запуска отработки отказа hello следует hello toosee может создать виртуальные машины реплики в Azure. При необходимости можно назначить открытый IP адрес toohello виртуальной Машины.
5. Подтвердите toostart hello перехода на другой ресурс, доступ к рабочей нагрузки hello из hello реплики виртуальной Машины Azure.
6. Когда основной локальный сайт снова станет доступным, вы сможете выполнить [восстановление размещения](site-recovery-failback-from-azure-to-hyper-v.md). Начнем плановой отработки отказа Azure toohello основного сайта. Для плановой отработки отказа, можно toohello выберите toofailback одной виртуальной Машины или tooan другое расположение и синхронизировать изменения между Azure и локальной, tooensure без потери данных. При создании локальных виртуальных машин фиксации hello перехода на другой ресурс.




## <a name="next-steps"></a>Дальнейшие действия

Go слишком[шаг 2: проверка необходимых условий развертывания hello](vmm-to-azure-walkthrough-prerequisites.md)
