---
title: "aaaExclude дисков из группы защиты с помощью Azure Site Recovery | Документы Microsoft"
description: "Описывает, почему и как tooexclude ВМ диски из репликации для сценариев VMware tooAzure и tooAzure Hyper-V."
services: site-recovery
documentationcenter: 
author: nsoneji
manager: garavd
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 06/05/2017
ms.author: nisoneji
ms.openlocfilehash: f47146bc57aeab3fce90123d0894fa86dde93417
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="exclude-disks-from-replication"></a>Исключение дисков из репликации
В этой статье описывается, как tooexclude диски из репликации. Это исключение можно оптимизировать пропускную способность репликации потребляет hello или оптимизировать ресурсы целевую сторону hello, использующие такие диски. функция Hello поддерживается для сценариев VMware tooAzure и tooAzure Hyper-V.

## <a name="prerequisites"></a>Предварительные требования

По умолчанию реплицируются все диски на виртуальной машине. tooexclude диск из репликации, необходимо вручную установить hello службы Mobility service на компьютере hello перед включением репликации при репликации из VMware tooAzure.


## <a name="why-exclude-disks-from-replication"></a>Зачем исключать диски из репликации
Исключение дисков из репликации часто бывает необходимо:

- данные Hello, churned на диске исключен hello не важны или не требуется реплицировать toobe.

- Вы собираетесь toosave ресурсы хранилища и сети, не копируя этой обработки.

## <a name="what-are-hello-typical-scenarios"></a>Каковы основные сценарии hello
Вы можете определить конкретные примеры потоков данных, которые подходят для исключения. Примеры могут включать записывает tooa файла подкачки (pagefile.sys) и записывает файл базы данных tempdb toohello сервера Microsoft SQL Server. В зависимости от рабочей нагрузки hello и hello подсистемы хранилища файл подкачки hello можно зарегистрировать значительный объем обработки. Однако репликация эти данные из основного сайта tooAzure hello бы много ресурсов. Таким образом можно использовать следующие шаги toooptimize репликации виртуальной машины с одного виртуального диска с hello операционной системы и файл подкачки hello hello.

1. Один виртуальный диск hello разбить на два виртуальных диска. Один виртуальный диск имеет hello операционной системы и других hello hello файла подкачки.
2. Исключите файл подкачки hello диск из репликации.

Аналогичным образом можно использовать следующие шаги toooptimize диск, который имеет оба hello Microsoft SQL Server tempdb полей hello и hello файл системной базы данных:

1. Следите за hello системной базы данных и базы данных tempdb на двух различных дисках.
2. Диск базы данных tempdb hello исключите из репликации.

## <a name="how-tooexclude-disks-from-replication"></a>Как tooexclude диски из репликации?

### <a name="vmware-tooazure"></a>VMware tooAzure
Выполните hello [включить репликацию](site-recovery-vmware-to-azure.md) tooprotect рабочий процесс виртуальной машины из портала Azure Site Recovery hello. В hello четвертый шаг hello рабочего процесса, используйте hello **tooREPLICATE диска** дисков tooexclude столбца из репликации. По умолчанию для репликации выбраны все диски. Снимите флажок hello дисков, которые должны tooexclude из репликации и последующем выполнении hello действия tooenable репликации.

![Исключить из репликации дисков и включить репликацию для восстановления размещения tooAzure VMware](./media/site-recovery-exclude-disk/v2a-enable-replication-exclude-disk1.png)


>[!NOTE]
>
> * Можно исключить только диски, для которых уже установлена служба Mobility hello. Необходимо toomanually службу Mobility hello установки, поскольку hello службы Mobility service устанавливается с помощью механизма принудительной hello после включения репликации.
> * Из репликации можно исключать только базовые диски. Вы не можете исключать диски операционной системы или динамические диски.
> * После включения репликации добавить или удалить диски для репликации нельзя. Если требуется tooadd или исключить диск, требуется toodisable защиту для машины hello и включите ее снова.
> * Если вы исключите диск, который требуется для toooperate приложения после отработки отказа tooAzure, необходим диск hello toocreate вручную в Azure, для запуска приложения hello репликации. Кроме того службы автоматизации Azure можно интегрировать в диск hello toocreate плана восстановления при сбое машины hello.
> * Виртуальная машина Windows. Диски, создаваемые в Azure вручную, не восстанавливаются. Например, если вы выполните отработку отказа трех дисков и создадите два диска непосредственно на виртуальной машине Azure, то восстановление размещения будет выполнено только для трех дисков, задействованных при отработке отказа. Нельзя включать дисков, созданных вручную в восстановление после сбоя или повторной защиты из локальной tooAzure.
> * Виртуальная машина Linux. Диски, создаваемые в Azure вручную, восстанавливаются. Например, если для трех дисков выполняется отработка отказа, а еще два создаются непосредственно в виртуальных машинах Azure, восстановление будет выполнено для всех пяти дисков. Диски, созданные вручную при восстановлении расположения, исключать нельзя.
>

### <a name="hyper-v-tooazure"></a>TooAzure Hyper-V
Выполните hello [включить репликацию](site-recovery-hyper-v-site-to-azure.md) tooprotect рабочий процесс виртуальной машины из портала Azure Site Recovery hello. В hello четвертый шаг hello рабочего процесса, используйте hello **tooREPLICATE диска** дисков tooexclude столбца из репликации. По умолчанию для репликации выбраны все диски. Снимите флажок hello дисков, которые должны tooexclude из репликации и последующем выполнении hello действия tooenable репликации.

![Исключить из репликации дисков и включить репликацию для восстановления размещения tooAzure Hyper-V](./media/site-recovery-vmm-to-azure/enable-replication6-with-exclude-disk.png)

>[!NOTE]
>
> * Вы можете исключать из репликации только базовые диски. Вы не можете исключать диски операционной системы. Исключать динамические диски не рекомендуется. Azure Site Recovery не удалось определить, какие виртуального жесткого диска (VHD), базовый или динамический hello гостевой виртуальной машине.  Если все зависимые динамические диски не исключены, защищенного динамического диска hello становится отказавшего диска на виртуальной машине отработки отказа и hello данные на этом диске не доступен.
> * После включения репликации добавить или удалить диски для репликации нельзя. Если требуется tooadd или исключить диск, требуется toodisable защиты для виртуальной машины hello и включите ее снова.
> * Если исключить диск, который требуется для toooperate приложения после отработки отказа tooAzure необходим toocreate hello диск вручную в Azure, позволяющие выполнять приложения hello репликации. Кроме того службы автоматизации Azure можно интегрировать в диск hello toocreate плана восстановления при сбое машины hello.
> * Диски, создаваемые в Azure вручную, не будут восстановлены в исходном расположении. Например если сбой более чем трех дисков и создать два диска непосредственно на виртуальных машинах Azure, только три дисков, которые были отработка отказа не будет выполнен обратно из Azure tooHyper-V. Нельзя включать диски, которые были созданы вручную в восстановление после сбоя или обратная репликация из tooAzure Hyper-V.



## <a name="end-to-end-scenarios-of-exclude-disks"></a>Полные сценарии исключения дисков
Давайте рассмотрим функция двух сценариев toounderstand hello исключить диск:

- Диск с файлом tempdb SQL Server.
- Диск с файлом подкачки (pagefile.sys).

### <a name="exclude-hello-sql-server-tempdb-disk"></a>Исключить диск базы данных tempdb SQL Server hello
Рассмотрим виртуальную машину SQL Server с диском tempdb, который может быть исключен из репликации.

Hello hello виртуальный диск называется SalesDB.

Ниже приведены диски hello исходной виртуальной машине.


**Имя диска** | **№ диска операционной системы на виртуальной машине** | **Буква диска** | **Тип данных на диске hello**
--- | --- | --- | ---
DB-Disk0-OS | Диск 0 | C:\ | Диск операционной системы
DB-Disk1| Диск 1 | D:\ | Системная база данных SQL и база данных пользователя Database1
DB-Disk2 (диск hello исключенных из защиты) | Диск 2 | E:\ | Временные файлы
DB-Disk3 (диск hello исключенных из защиты) | Диск 3 | F:\ | База данных tempdb SQL (путь к папке (F:\MSSQL\Data\) < /br/>< /br/> Запишите путь к папке hello перед выполнением отработки отказа.
DB-Disk4 | Диск 4 |G:\ |База данных пользователя Database2

Поскольку обработка данных на два диска hello виртуальной машины является временным, защиту виртуальной машины SalesDB hello, исключите из репликации Disk2 и Disk3. Эти диски не будут реплицироваться в Azure Site Recovery. При отработке отказа этих дисков не присутствовать на hello отработки отказа виртуальной машины в Azure.

Существуют следующие диски виртуальной машины Azure после отработки отказа hello.

**№ диска операционной системы на виртуальной машине** | **Буква диска** | **Тип данных на диске hello**
--- | --- | ---
Диск 0 | C:\ | Диск операционной системы
Диск 1 | E:\ | Временное хранилище < /br / >< /br / > Azure добавляет этот диск и назначает hello первая доступная буква диска.
Диск 2 | D:\ | Системная база данных SQL и база данных пользователя Database1
Диск 3 | G:\ | База данных пользователя Database2

Поскольку Disk2 и Disk3 были исключены из hello SalesDB виртуальной машины, E: является hello первую букву диска из списка доступных hello. Azure назначает E: объемом временного хранилища toohello. Для всех дисков hello репликации остаются буквы диска hello hello таким же.

Disk3, бывшее диска базы данных tempdb SQL hello (путь к папке базы данных tempdb F:\MSSQL\Data\), был исключен из репликации. Hello диске доступно не на hello отработки отказа виртуальной машины. В результате hello службы SQL Server находится в остановленном состоянии, и ему путь F:\MSSQL\Data hello.

Существует два способа toocreate этот путь:

- Добавьте новый диск и назначьте путь к папке tempdb.
- Используйте существующий диск временного хранилища для hello путь к папке базы данных tempdb.

#### <a name="add-a-new-disk"></a>Добавьте новый диск:

1. Запишите пути hello SQL tempdb.mdf и tempdb.ldf перед выполнением отработки отказа.
2. С помощью hello портал Azure добавьте новый диск toohello отработки отказа виртуальной машины с hello того же или больше размера, что и база данных tempdb SQL исходного hello диска (Disk3).
3. Войдите в систему toohello виртуальной машины Azure. Из консоли управления (diskmgmt.msc) дисками hello инициализации и форматирования hello добавленным диска.
4. Назначение hello одинаковую букву, затраченный на диске базы данных tempdb SQL hello (F:) диска.
5. Создайте папку базы данных tempdb на hello тома F: (F:\MSSQL\Data).
6. Запуск службы SQL Server hello из консоли службы hello.

#### <a name="use-an-existing-temporary-storage-disk-for-hello-sql-tempdb-folder-path"></a>Используйте существующий диск временного хранилища для путь к папке базы данных tempdb SQL hello:

1. Откройте окно командной строки.
2. Запустите SQL Server в режиме восстановления из командной строки hello.

        Net start MSSQLSERVER /f / T3608

3. Запустите hello sqlcmd toochange hello tempdb путь toohello нового пути.

        sqlcmd -A -S SalesDB        **Use your SQL DBname**
        USE master;     
        GO      
        ALTER DATABASE tempdb       
        MODIFY FILE (NAME = tempdev, FILENAME = 'E:\MSSQL\tempdata\tempdb.mdf');
        GO      
        ALTER DATABASE tempdb       
        MODIFY FILE (NAME = templog, FILENAME = 'E:\MSSQL\tempdata\templog.ldf');       
        GO


4. Остановка службы Microsoft SQL Server hello.

        Net stop MSSQLSERVER
5. Запуск службы Microsoft SQL Server hello.

        Net start MSSQLSERVER

См. следующие Azure направляющих для временного хранения диска toohello:

* [Использование SSD на виртуальных машинах Azure toostore SQL Server TempDB и расширений буферного пула](https://blogs.technet.microsoft.com/dataplatforminsider/2014/09/25/using-ssds-in-azure-vms-to-store-sql-server-tempdb-and-buffer-pool-extensions/)
* [Рекомендации по оптимизации производительности SQL Server на виртуальных машинах Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-performance)

### <a name="failback-from-azure-tooan-on-premises-host"></a>Восстановление после сбоя (из Azure tooan локального узла)
Теперь рассмотрим реплицируемых после отработки отказа с узла Hyper-V или VMware локальной Azure tooyour дисков hello. Диски, созданные в Azure вручную, не будут реплицированы. Например, если вы выполните отработку отказа трех дисков и создадите два диска непосредственно на виртуальных машинах Azure, то восстановление размещения будет выполнено только для трех дисков, задействованных при отработке отказа. Нельзя включать диски, которые были созданы вручную в восстановление после сбоя или повторной защиты из локальной tooAzure. Он также не реплицирует узлов tooon локальный диск временного хранилища hello.

#### <a name="failback-toooriginal-location-recovery"></a>Восстановление после сбоя toooriginal расположении восстановления

В предыдущем примере hello конфигурация диска виртуальной машины Azure hello выглядит следующим образом:

**№ диска операционной системы на виртуальной машине** | **Буква диска** | **Тип данных на диске hello**
--- | --- | ---
Диск 0 | C:\ | Диск операционной системы
Диск 1 | E:\ | Временное хранилище < /br / >< /br / > Azure добавляет этот диск и назначает hello первая доступная буква диска.
Диск 2 | D:\ | Системная база данных SQL и база данных пользователя Database1
Диск 3 | G:\ | База данных пользователя Database2


#### <a name="vmware-tooazure"></a>VMware tooAzure
После завершения восстановления размещения toohello исходное расположение конфигурации диска hello восстановления размещения виртуальной машины не имеет исключенных дисков. Диски, которые были исключены из VMware tooAzure будет недоступен для hello восстановления размещения виртуальной машины.

После плановой отработки отказа из Azure tooon организациями VMware дискам на виртуальной машине VMWare hello (исходное расположение) будет следующим:

**№ диска операционной системы на виртуальной машине** | **Буква диска** | **Тип данных на диске hello**
--- | --- | ---
Диск 0 | C:\ | Диск операционной системы
Диск 1 | D:\ | Системная база данных SQL и база данных пользователя Database1
Диск 2 | G:\ | База данных пользователя Database2

#### <a name="hyper-v-tooazure"></a>TooAzure Hyper-V
Если восстановление размещения toohello исходное расположение, hello восстановления размещения виртуальной машины диск конфигурации остается hello таким же, что и исходный конфигурация диска виртуальной машины Hyper-v. Диски, которые были исключены из tooAzure узла Hyper-V доступны на hello восстановления размещения виртуальной машины.

После плановой отработки отказа из Azure tooon организациями Hyper-V дисков на виртуальной машине Hyper-V hello (исходное расположение) будет следующим:

**Имя диска** | **№ диска операционной системы на виртуальной машине** | **Буква диска** | **Тип данных на диске hello**
--- | --- | --- | ---
DB-Disk0-OS | Диск 0 |   C:\ | Диск операционной системы
DB-Disk1 | Диск 1 | D:\ | Системная база данных SQL и база данных пользователя Database1
DB-Disk2 (исключенный из репликации) | Диск 2 | E:\ | Временные файлы
DB-Disk3 (исключенный из репликации) | Диск 3 | F:\ | База данных tempdb SQL (путь к папке — F:\MSSQL\Data\)
DB-Disk4 | Диск 4 | G:\ | База данных пользователя Database2


#### <a name="exclude-hello-paging-file-pagefilesys-disk"></a>Исключить дискового файла (pagefile.sys) подкачки hello

Рассмотрим виртуальную машину с диском с файлом подкачки, который можно исключить из репликации.
Есть два способа.

#### <a name="case-1-hello-paging-file-is-configured-on-hello-d-drive"></a>Вариант 1: файл подкачки hello настроен на диске D: hello
Ниже приведен конфигурации диска hello.


**Имя диска** | **№ диска операционной системы на виртуальной машине** | **Буква диска** | **Тип данных на диске hello**
--- | --- | --- | ---
DB-Disk0-OS | Диск 0 | C:\ | Диск операционной системы
DB-диск 1 (диск hello исключенных из защиты hello) | Диск 1 | D:\ | pagefile.sys
DB-Disk2 | Диск 2 | E:\ | Пользовательские данные 1
DB-Disk3 | Диск 3 | F:\ | Пользовательские данные 2

Ниже приведены hello параметров файла подкачки на hello исходной виртуальной машины.

![Параметры файла подкачки на исходной виртуальной машине](./media/site-recovery-exclude-disk/pagefile-on-d-drive-sourceVM.png)


После отработки отказа виртуальной машины hello с VMware tooAzure или tooAzure Hyper-V дисков на виртуальной машине Azure hello выглядят следующим образом:

**Имя диска** | **№ диска операционной системы на виртуальной машине** | **Буква диска** | **Тип данных на диске hello**
--- | --- | --- | ---
DB-Disk0-OS | Диск 0 | C:\ | Диск операционной системы
DB-Disk1 | Диск 1 | D:\ | Временное хранилище</br /> </br />pagefile.sys
DB-Disk2 | Диск 2 | E:\ | Пользовательские данные 1
DB-Disk3 | Диск 3 | F:\ | Пользовательские данные 2

Поскольку диск 1 (D:) была исключена, D: является hello первую букву диска из списка доступных hello. Azure назначает D: объемом временного хранилища toohello. Поскольку виртуальная машина Azure hello D:, hello hello файла подкачки hello виртуальной машины остается таким же.

Ниже приведены hello параметров файла подкачки на виртуальной машине Azure hello.

![Параметры файла подкачки на виртуальной машине Azure](./media/site-recovery-exclude-disk/pagefile-on-Azure-vm-after-failover.png)

#### <a name="case-2-hello-paging-file-is-configured-on-another-drive-other-than-d-drive"></a>Вариант 2: файл подкачки hello настроен на другом диске (кроме диск D:)

Ниже приведен конфигурации диска hello исходной виртуальной машины.

**Имя диска** | **№ диска операционной системы на виртуальной машине** | **Буква диска** | **Тип данных на диске hello**
--- | --- | --- | ---
DB-Disk0-OS | Диск 0 | C:\ | Диск операционной системы
DB-диск 1 (диск hello исключенных из защиты) | Диск 1 | G:\ | pagefile.sys
DB-Disk2 | Диск 2 | E:\ | Пользовательские данные 1
DB-Disk3 | Диск 3 | F:\ | Пользовательские данные 2

Ниже приведены hello параметров файла подкачки на hello локальной виртуальной машине.

![Разбивка на страницы параметров файла на виртуальной машине hello в локальной среде](./media/site-recovery-exclude-disk/pagefile-on-g-drive-sourceVM.png)

После отработки отказа виртуальной машины hello с VMware или Hyper-V tooAzure дисков на виртуальной машине Azure hello выглядят следующим образом:

**Имя диска**| **№ диска операционной системы на виртуальной машине**| **Буква диска** | **Тип данных на диске hello**
--- | --- | --- | ---
DB-Disk0-OS | Диск 0  |C:\ |Диск операционной системы
DB-Disk1 | Диск 1 | D:\ | Временное хранилище</br /> </br />pagefile.sys
DB-Disk2 | Диск 2 | E:\ | Пользовательские данные 1
DB-Disk3 | Диск 3 | F:\ | Пользовательские данные 2

Поскольку D: hello первая буква диска из списка доступных hello, Azure назначает D: объемом временного хранилища toohello. Для всех дисков hello репликации остается букву диска hello hello таким же. Поскольку hello G: диск недоступен, hello система будет использовать диск C: hello для hello, файл подкачки.

Ниже приведены hello параметров файла подкачки на виртуальной машине Azure hello.

![Параметры файла подкачки на виртуальной машине Azure](./media/site-recovery-exclude-disk/pagefile-on-Azure-vm-after-failover-2.png)

## <a name="next-steps"></a>Дальнейшие действия
Настроив и запустив развертывание, вы можете ознакомиться с [дополнительными сведениями](site-recovery-failover.md) о различных типах обработки отказа.
