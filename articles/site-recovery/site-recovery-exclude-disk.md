---
title: "Исключение дисков из защиты с помощью Azure Site Recovery | Документация Майкрософт"
description: "В статье описывается, как и зачем исключать диски виртуальных машин из репликации для сценариев VMware и Hyper-V в Azure."
services: site-recovery
documentationcenter: 
author: nsoneji
manager: garavd
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 06/05/2017
ms.author: nisoneji
ms.openlocfilehash: fccbe88e3c0c2b2f3e9958f5f2f27adc017e4d03
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2017
---
# <a name="exclude-disks-from-replication"></a><span data-ttu-id="432da-103">Исключение дисков из репликации</span><span class="sxs-lookup"><span data-stu-id="432da-103">Exclude disks from replication</span></span>
<span data-ttu-id="432da-104">В этой статье описывается, как исключать диски из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-104">This article describes how to exclude disks from replication.</span></span> <span data-ttu-id="432da-105">Благодаря этому можно оптимизировать использование пропускной способности при репликации или же ресурсы целевой стороны, используемые такими дисками.</span><span class="sxs-lookup"><span data-stu-id="432da-105">This exclusion can optimize the consumed replication bandwidth or optimize the target-side resources that such disks utilize.</span></span> <span data-ttu-id="432da-106">Эта функция поддерживается для сценариев VMware и Hyper-V в Azure.</span><span class="sxs-lookup"><span data-stu-id="432da-106">The feature is supported for scenarios of VMware to Azure and Hyper-V to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="432da-107">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="432da-107">Prerequisites</span></span>

<span data-ttu-id="432da-108">По умолчанию реплицируются все диски на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="432da-108">By default, all disks on a machine are replicated.</span></span> <span data-ttu-id="432da-109">Чтобы исключить диск из репликации, вам необходимо установить вручную на компьютер службу Mobility Service до включения репликации (при репликации из VMware в Azure).</span><span class="sxs-lookup"><span data-stu-id="432da-109">To exclude a disk from replication, you must manually install the Mobility service on the machine before you enable replication if you are replicating from VMware to Azure.</span></span>


## <a name="why-exclude-disks-from-replication"></a><span data-ttu-id="432da-110">Зачем исключать диски из репликации</span><span class="sxs-lookup"><span data-stu-id="432da-110">Why exclude disks from replication?</span></span>
<span data-ttu-id="432da-111">Исключение дисков из репликации часто бывает необходимо:</span><span class="sxs-lookup"><span data-stu-id="432da-111">Excluding disks from replication is often necessary because:</span></span>

- <span data-ttu-id="432da-112">Если данные, находящиеся на исключенных дисках, не важны или их репликация не требуется.</span><span class="sxs-lookup"><span data-stu-id="432da-112">The data that's churned on the excluded disk is not important or doesn’t need to be replicated.</span></span>

- <span data-ttu-id="432da-113">Ресурсы хранилища и сети можно сохранять, не реплицируя данные этого потока.</span><span class="sxs-lookup"><span data-stu-id="432da-113">You want to save storage and network resources by not replicating this churn.</span></span>

## <a name="what-are-the-typical-scenarios"></a><span data-ttu-id="432da-114">Стандартные сценарии</span><span class="sxs-lookup"><span data-stu-id="432da-114">What are the typical scenarios?</span></span>
<span data-ttu-id="432da-115">Вы можете определить конкретные примеры потоков данных, которые подходят для исключения.</span><span class="sxs-lookup"><span data-stu-id="432da-115">You can identify specific examples of data churn that are great candidates for exclusion.</span></span> <span data-ttu-id="432da-116">Это могут быть записи в файл подкачки (pagefile.sys) и записи в файл tempdb Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="432da-116">Examples might include writes to a paging file (pagefile.sys) and writes to the tempdb file of Microsoft SQL Server.</span></span> <span data-ttu-id="432da-117">В зависимости от рабочей нагрузки и подсистемы хранилища файл подкачки может регистрировать значительный поток данных.</span><span class="sxs-lookup"><span data-stu-id="432da-117">Depending on the workload and the storage subsystem, the paging file can register a significant amount of churn.</span></span> <span data-ttu-id="432da-118">Для репликации таких данных из основного сайта в Azure понадобится много ресурсов.</span><span class="sxs-lookup"><span data-stu-id="432da-118">However, replicating this data from the primary site to Azure would be resource intensive.</span></span> <span data-ttu-id="432da-119">Чтобы оптимизировать репликацию виртуальной машины с одним виртуальным диском, включающим операционную систему и файл подкачки, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="432da-119">Thus, you can use the following steps to optimize replication of a virtual machine with a single virtual disk that has both the operating system and the paging file:</span></span>

1. <span data-ttu-id="432da-120">Разделите один виртуальный диск на два диска.</span><span class="sxs-lookup"><span data-stu-id="432da-120">Split the single virtual disk into two virtual disks.</span></span> <span data-ttu-id="432da-121">Один виртуальный диск будет содержать операционную систему, а второй — файл подкачки.</span><span class="sxs-lookup"><span data-stu-id="432da-121">One virtual disk has the operating system, and the other has the paging file.</span></span>
2. <span data-ttu-id="432da-122">Исключите диск с файлом подкачки из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-122">Exclude the paging file disk from replication.</span></span>

<span data-ttu-id="432da-123">Похожим образом осуществляется оптимизация диска с файлом tempdb Microsoft SQL Server и файлом системной базы данных.</span><span class="sxs-lookup"><span data-stu-id="432da-123">Similarly, you can use the following steps to optimize a disk that has both the Microsoft SQL Server tempdb fie and the system database file:</span></span>

1. <span data-ttu-id="432da-124">Файл системной базы данных и файл tempdb Microsoft SQL Server должны находиться на разных дисках.</span><span class="sxs-lookup"><span data-stu-id="432da-124">Keep the system database and tempdb on two different disks.</span></span>
2. <span data-ttu-id="432da-125">Исключите диск с файлом tempdb из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-125">Exclude the tempdb disk from replication.</span></span>

## <a name="how-to-exclude-disks-from-replication"></a><span data-ttu-id="432da-126">Как исключать диски из репликации</span><span class="sxs-lookup"><span data-stu-id="432da-126">How to exclude disks from replication?</span></span>

### <a name="vmware-to-azure"></a><span data-ttu-id="432da-127">VMware — Azure</span><span class="sxs-lookup"><span data-stu-id="432da-127">VMware to Azure</span></span>
<span data-ttu-id="432da-128">На портале Azure Site Recovery для защиты виртуальной машины выполните рабочий процесс [Включение репликации](site-recovery-vmware-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="432da-128">Follow the [Enable replication](site-recovery-vmware-to-azure.md) workflow to protect a virtual machine from the Azure Site Recovery portal.</span></span> <span data-ttu-id="432da-129">На четвертом шаге рабочего процесса используйте столбец **Disk to replicate** (Диск для репликации), чтобы исключить диски из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-129">In the fourth step of the workflow, use the **DISK TO REPLICATE** column to exclude disks from replication.</span></span> <span data-ttu-id="432da-130">По умолчанию для репликации выбраны все диски.</span><span class="sxs-lookup"><span data-stu-id="432da-130">By default, all disks are selected for replication.</span></span> <span data-ttu-id="432da-131">Снимите флажок для дисков, которые вы хотите исключить из репликации, а затем продолжите выполнение рабочего процесса для включения репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-131">Clear the check box of disks that you want to exclude from replication, and then complete the steps to enable replication.</span></span>

![Исключение дисков из репликации и включение репликации для восстановления размещения виртуальных машин VMware в Azure](./media/site-recovery-exclude-disk/v2a-enable-replication-exclude-disk1.png)


>[!NOTE]
>
> * <span data-ttu-id="432da-133">Вы можете исключить только те диски, на которых установлена служба Mobility Service.</span><span class="sxs-lookup"><span data-stu-id="432da-133">You can exclude only disks that already have the Mobility service installed.</span></span> <span data-ttu-id="432da-134">Службу Mobility Service необходимо установить вручную, так как механизм принудительной установки для нее можно использовать только после включения репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-134">You need to manually install the Mobility service, because the Mobility service is only installed by using the push mechanism after replication is enabled.</span></span>
> * <span data-ttu-id="432da-135">Из репликации можно исключать только базовые диски.</span><span class="sxs-lookup"><span data-stu-id="432da-135">Only basic disks can be excluded from replication.</span></span> <span data-ttu-id="432da-136">Вы не можете исключать диски операционной системы или динамические диски.</span><span class="sxs-lookup"><span data-stu-id="432da-136">You can't exclude operating system or dynamic disks.</span></span>
> * <span data-ttu-id="432da-137">После включения репликации добавить или удалить диски для репликации нельзя.</span><span class="sxs-lookup"><span data-stu-id="432da-137">After you enable replication, you can't add or remove disks for replication.</span></span> <span data-ttu-id="432da-138">Если вы хотите добавить или исключить диск, отключите защиту компьютера, а затем включите ее повторно.</span><span class="sxs-lookup"><span data-stu-id="432da-138">If you want to add or exclude a disk, you need to disable protection for the machine and then enable it again.</span></span>
> * <span data-ttu-id="432da-139">Если вы исключили диск, необходимый для работы приложения, для выполнения реплицируемого приложения после отработки отказа в Azure вам необходимо будет создать его в Azure вручную.</span><span class="sxs-lookup"><span data-stu-id="432da-139">If you exclude a disk that's needed for an application to operate, after failover to Azure, you’ll need to create the disk manually in Azure so that the replicated application can run.</span></span> <span data-ttu-id="432da-140">Кроме того, для создания диска во время отработки отказа компьютера вы можете интегрировать службу автоматизации Azure в план восстановления.</span><span class="sxs-lookup"><span data-stu-id="432da-140">Alternatively, you can integrate Azure automation into a recovery plan to create the disk during failover of the machine.</span></span>
> * <span data-ttu-id="432da-141">Виртуальная машина Windows. Диски, создаваемые в Azure вручную, не восстанавливаются.</span><span class="sxs-lookup"><span data-stu-id="432da-141">Window virtual machine: Disks that you create manually in Azure are not failed back.</span></span> <span data-ttu-id="432da-142">Например, если вы выполните отработку отказа трех дисков и создадите два диска непосредственно на виртуальной машине Azure, то восстановление размещения будет выполнено только для трех дисков, задействованных при отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="432da-142">For example, if you fail over three disks and create two disk directly in Azure Virtual Machines, only three disks that were failed over are failed back.</span></span> <span data-ttu-id="432da-143">Восстановление размещения после сбоя или защита из локальной среды в Azure недоступны для дисков, созданных вручную.</span><span class="sxs-lookup"><span data-stu-id="432da-143">You can't include disks that you created manually in failback or in reprotect from on-premises to Azure.</span></span>
> * <span data-ttu-id="432da-144">Виртуальная машина Linux. Диски, создаваемые в Azure вручную, восстанавливаются.</span><span class="sxs-lookup"><span data-stu-id="432da-144">Linux virtual machine: Disks that you create manually in Azure are failed back.</span></span> <span data-ttu-id="432da-145">Например, если для трех дисков выполняется отработка отказа, а еще два создаются непосредственно в виртуальных машинах Azure, восстановление будет выполнено для всех пяти дисков.</span><span class="sxs-lookup"><span data-stu-id="432da-145">For example, if you fail over three disks and create two disks directly in Azure Virtual Machines, all five will be failed back.</span></span> <span data-ttu-id="432da-146">Диски, созданные вручную при восстановлении расположения, исключать нельзя.</span><span class="sxs-lookup"><span data-stu-id="432da-146">You can't exclude disks that were created manually from failback.</span></span>
>

### <a name="hyper-v-to-azure"></a><span data-ttu-id="432da-147">Hyper-V в Azure</span><span class="sxs-lookup"><span data-stu-id="432da-147">Hyper-V to Azure</span></span>
<span data-ttu-id="432da-148">На портале Azure Site Recovery для защиты виртуальной машины выполните рабочий процесс [Включение репликации](site-recovery-hyper-v-site-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="432da-148">Follow the [Enable replication](site-recovery-hyper-v-site-to-azure.md) workflow to protect a virtual machine from the Azure Site Recovery portal.</span></span> <span data-ttu-id="432da-149">На четвертом шаге рабочего процесса используйте столбец **Disk to replicate** (Диск для репликации), чтобы исключить диски из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-149">In the fourth step of the workflow, use the **DISK TO REPLICATE** column to exclude disks from replication.</span></span> <span data-ttu-id="432da-150">По умолчанию для репликации выбраны все диски.</span><span class="sxs-lookup"><span data-stu-id="432da-150">By default, all disks are selected for replication.</span></span> <span data-ttu-id="432da-151">Снимите флажок для дисков, которые вы хотите исключить из репликации, а затем продолжите выполнение рабочего процесса для включения репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-151">Clear the check box of disks that you want to exclude from replication, and then complete the steps to enable replication.</span></span>

![Исключение дисков из репликации и включение репликации для восстановления размещения виртуальных машин Hyper-V в Azure](./media/site-recovery-vmm-to-azure/enable-replication6-with-exclude-disk.png)

>[!NOTE]
>
> * <span data-ttu-id="432da-153">Вы можете исключать из репликации только базовые диски.</span><span class="sxs-lookup"><span data-stu-id="432da-153">You can exclude only basic disks from replication.</span></span> <span data-ttu-id="432da-154">Вы не можете исключать диски операционной системы.</span><span class="sxs-lookup"><span data-stu-id="432da-154">You can't exclude operating system disks.</span></span> <span data-ttu-id="432da-155">Исключать динамические диски не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="432da-155">We recommend that you do not exclude dynamic disks.</span></span> <span data-ttu-id="432da-156">В Azure Site Recovery вы не можете определить, какой виртуальный жесткий диск (VHD) является базовым, а какой динамическим на гостевой виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="432da-156">Azure Site Recovery cannot identify which virtual hard disk (VHD) is basic or dynamic in the guest virtual machine.</span></span>  <span data-ttu-id="432da-157">Если все зависимые динамические диски не исключены, защищенный динамический диск на виртуальной машине, используемой для отработки отказа, будет считаться неисправным и данные на нем будут недоступны.</span><span class="sxs-lookup"><span data-stu-id="432da-157">If all dependent dynamic volume disks are not excluded, the protected dynamic disk becomes a failed disk on a failover virtual machine, and the data on that disk is not accessible.</span></span>
> * <span data-ttu-id="432da-158">После включения репликации добавить или удалить диски для репликации нельзя.</span><span class="sxs-lookup"><span data-stu-id="432da-158">After you enable replication, you can't add or remove disks for replication.</span></span> <span data-ttu-id="432da-159">Если вы хотите добавить или исключить диск, отключите защиту виртуальной машины, а затем включите ее повторно.</span><span class="sxs-lookup"><span data-stu-id="432da-159">If you want to add or exclude a disk, you need to disable protection for the virtual machine and then enable it again.</span></span>
> * <span data-ttu-id="432da-160">Если вы исключили диск, необходимый для работы приложения, для выполнения реплицируемого приложения после отработки отказа в Azure вам необходимо будет создать его в Azure вручную.</span><span class="sxs-lookup"><span data-stu-id="432da-160">If you exclude a disk that's needed for an application to operate, after failover to Azure you’ll need to create the disk manually in Azure so that the replicated application can run.</span></span> <span data-ttu-id="432da-161">Кроме того, для создания диска во время отработки отказа компьютера вы можете интегрировать службу автоматизации Azure в план восстановления.</span><span class="sxs-lookup"><span data-stu-id="432da-161">Alternatively, you can integrate Azure automation into a recovery plan to create the disk during failover of the machine.</span></span>
> * <span data-ttu-id="432da-162">Диски, создаваемые в Azure вручную, не будут восстановлены в исходном расположении.</span><span class="sxs-lookup"><span data-stu-id="432da-162">Disks that you create manually in Azure will not be failed back.</span></span> <span data-ttu-id="432da-163">Например, если вы выполните отработку отказа трех дисков и создадите два диска непосредственно на виртуальной машине Azure, восстановление размещения из Azure в Hyper-V будет выполнено только для трех дисков, задействованных при отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="432da-163">For example, if you fail over three disks and create two disks directly in Azure Virtual Machines, only three disks that were failed over will be failed back from Azure to Hyper-V.</span></span> <span data-ttu-id="432da-164">Восстановление размещения после сбоя и обратная репликация из Hyper-V в Azure недоступны для дисков, созданных вручную.</span><span class="sxs-lookup"><span data-stu-id="432da-164">You can't include disks that were created manually in failback or in reverse replication from Hyper-V to Azure.</span></span>



## <a name="end-to-end-scenarios-of-exclude-disks"></a><span data-ttu-id="432da-165">Полные сценарии исключения дисков</span><span class="sxs-lookup"><span data-stu-id="432da-165">End-to-end scenarios of exclude disks</span></span>
<span data-ttu-id="432da-166">Рассмотрим два сценария, чтобы лучше понять функцию исключения дисков.</span><span class="sxs-lookup"><span data-stu-id="432da-166">Let's consider two scenarios to understand the exclude disk feature:</span></span>

- <span data-ttu-id="432da-167">Диск с файлом tempdb SQL Server.</span><span class="sxs-lookup"><span data-stu-id="432da-167">SQL Server tempdb disk</span></span>
- <span data-ttu-id="432da-168">Диск с файлом подкачки (pagefile.sys).</span><span class="sxs-lookup"><span data-stu-id="432da-168">Paging file (pagefile.sys) disk</span></span>

### <a name="exclude-the-sql-server-tempdb-disk"></a><span data-ttu-id="432da-169">Исключение диска с файлом tempdb SQL Server</span><span class="sxs-lookup"><span data-stu-id="432da-169">Exclude the SQL Server tempdb disk</span></span>
<span data-ttu-id="432da-170">Рассмотрим виртуальную машину SQL Server с диском tempdb, который может быть исключен из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-170">Let's consider a SQL Server virtual machine that has a tempdb that can be excluded.</span></span>

<span data-ttu-id="432da-171">Имя виртуального диска — SalesDB.</span><span class="sxs-lookup"><span data-stu-id="432da-171">The name of the virtual disk is SalesDB.</span></span>

<span data-ttu-id="432da-172">Ниже представлены диски на исходной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="432da-172">Disks on the source virtual machine are as follows:</span></span>


<span data-ttu-id="432da-173">**Имя диска**</span><span class="sxs-lookup"><span data-stu-id="432da-173">**Disk name**</span></span> | <span data-ttu-id="432da-174">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-174">**Guest operating system disk#**</span></span> | <span data-ttu-id="432da-175">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-175">**Drive letter**</span></span> | <span data-ttu-id="432da-176">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-176">**Data type on the disk**</span></span>
--- | --- | --- | ---
<span data-ttu-id="432da-177">DB-Disk0-OS</span><span class="sxs-lookup"><span data-stu-id="432da-177">DB-Disk0-OS</span></span> | <span data-ttu-id="432da-178">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-178">DISK0</span></span> | <span data-ttu-id="432da-179">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-179">C:\\</span></span> | <span data-ttu-id="432da-180">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-180">Operating system disk</span></span>
<span data-ttu-id="432da-181">DB-Disk1</span><span class="sxs-lookup"><span data-stu-id="432da-181">DB-Disk1</span></span>| <span data-ttu-id="432da-182">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-182">Disk1</span></span> | <span data-ttu-id="432da-183">D:\\</span><span class="sxs-lookup"><span data-stu-id="432da-183">D:\\</span></span> | <span data-ttu-id="432da-184">Системная база данных SQL и база данных пользователя Database1</span><span class="sxs-lookup"><span data-stu-id="432da-184">SQL system database and User Database1</span></span>
<span data-ttu-id="432da-185">DB-Disk 2 (исключенный из репликации)</span><span class="sxs-lookup"><span data-stu-id="432da-185">DB-Disk2 (Excluded the disk from protection)</span></span> | <span data-ttu-id="432da-186">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-186">Disk2</span></span> | <span data-ttu-id="432da-187">E:\\</span><span class="sxs-lookup"><span data-stu-id="432da-187">E:\\</span></span> | <span data-ttu-id="432da-188">Временные файлы</span><span class="sxs-lookup"><span data-stu-id="432da-188">Temp files</span></span>
<span data-ttu-id="432da-189">DB-Disk 3 (исключенный из репликации)</span><span class="sxs-lookup"><span data-stu-id="432da-189">DB-Disk3 (Excluded the disk from protection)</span></span> | <span data-ttu-id="432da-190">Диск 3</span><span class="sxs-lookup"><span data-stu-id="432da-190">Disk3</span></span> | <span data-ttu-id="432da-191">F:\\</span><span class="sxs-lookup"><span data-stu-id="432da-191">F:\\</span></span> | <span data-ttu-id="432da-192">База данных tempdb SQL (путь к папке — F:\MSSQL\Data\) </br /> </br />Запишите путь к папке перед началом отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="432da-192">SQL tempdb database (folder path(F:\MSSQL\Data\) </br /> </br />Write down the folder path before failover.</span></span>
<span data-ttu-id="432da-193">DB-Disk4</span><span class="sxs-lookup"><span data-stu-id="432da-193">DB-Disk4</span></span> | <span data-ttu-id="432da-194">Диск 4</span><span class="sxs-lookup"><span data-stu-id="432da-194">Disk4</span></span> |<span data-ttu-id="432da-195">G:\\</span><span class="sxs-lookup"><span data-stu-id="432da-195">G:\\</span></span> |<span data-ttu-id="432da-196">База данных пользователя Database2</span><span class="sxs-lookup"><span data-stu-id="432da-196">User Database2</span></span>

<span data-ttu-id="432da-197">Так как поток данных на двух дисках виртуальной машины является временным, при защите виртуальной машины SalesDB исключите диски 2 и 3 из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-197">Because data churn on two disks of the virtual machine is temporary, while you protect the SalesDB virtual machine, exclude Disk2 and Disk3 from replication.</span></span> <span data-ttu-id="432da-198">Эти диски не будут реплицироваться в Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="432da-198">Azure Site Recovery will not replicate those disks.</span></span> <span data-ttu-id="432da-199">Эти диски не будут присутствовать в виртуальной машине, перенесенной в Azure при отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="432da-199">On failover, those disks will not be present on the failover virtual machine on Azure.</span></span>

<span data-ttu-id="432da-200">Ниже представлены диски виртуальной машины Azure после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="432da-200">Disks on the Azure virtual machine after failover are as follows:</span></span>

<span data-ttu-id="432da-201">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-201">**Guest operating system disk#**</span></span> | <span data-ttu-id="432da-202">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-202">**Drive letter**</span></span> | <span data-ttu-id="432da-203">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-203">**Data type on the disk**</span></span>
--- | --- | ---
<span data-ttu-id="432da-204">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-204">DISK0</span></span> | <span data-ttu-id="432da-205">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-205">C:\\</span></span> | <span data-ttu-id="432da-206">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-206">Operating system disk</span></span>
<span data-ttu-id="432da-207">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-207">Disk1</span></span> | <span data-ttu-id="432da-208">E:\\</span><span class="sxs-lookup"><span data-stu-id="432da-208">E:\\</span></span> | <span data-ttu-id="432da-209">Временное хранилище</br /> </br />Azure добавляет этот диск и назначает ему первую доступную букву диска.</span><span class="sxs-lookup"><span data-stu-id="432da-209">Temporary storage</br /> </br />Azure adds this disk and assigns the first available drive letter.</span></span>
<span data-ttu-id="432da-210">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-210">Disk2</span></span> | <span data-ttu-id="432da-211">D:\\</span><span class="sxs-lookup"><span data-stu-id="432da-211">D:\\</span></span> | <span data-ttu-id="432da-212">Системная база данных SQL и база данных пользователя Database1</span><span class="sxs-lookup"><span data-stu-id="432da-212">SQL system database and User Database1</span></span>
<span data-ttu-id="432da-213">Диск 3</span><span class="sxs-lookup"><span data-stu-id="432da-213">Disk3</span></span> | <span data-ttu-id="432da-214">G:\\</span><span class="sxs-lookup"><span data-stu-id="432da-214">G:\\</span></span> | <span data-ttu-id="432da-215">База данных пользователя Database2</span><span class="sxs-lookup"><span data-stu-id="432da-215">User Database2</span></span>

<span data-ttu-id="432da-216">Так как диски 2 и 3 были исключены из репликации виртуальной машины SalesDB, "E:" является первой доступной буквой из диска.</span><span class="sxs-lookup"><span data-stu-id="432da-216">Because Disk2 and Disk3 were excluded from the SalesDB virtual machine, E: is the first drive letter from the available list.</span></span> <span data-ttu-id="432da-217">Azure назначает "E:" тому временного хранилища.</span><span class="sxs-lookup"><span data-stu-id="432da-217">Azure assigns E: to the temporary storage volume.</span></span> <span data-ttu-id="432da-218">Для всех реплицированных дисков буквы диска не изменятся.</span><span class="sxs-lookup"><span data-stu-id="432da-218">For all the replicated disks, the drive letters remain the same.</span></span>

<span data-ttu-id="432da-219">Диск 3, который являлся диском с tempdb SQL (путь к папке с tempdb — F:\MSSQL\Data\), был исключен из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-219">Disk3, which was the SQL tempdb disk (tempdb folder path F:\MSSQL\Data\), was excluded from replication.</span></span> <span data-ttu-id="432da-220">Этот диск не будет присутствовать в перенесенной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="432da-220">The disk is not available on the failover virtual machine.</span></span> <span data-ttu-id="432da-221">В результате служба SQL будет остановлена и ей понадобится путь F:\MSSQL\Data.</span><span class="sxs-lookup"><span data-stu-id="432da-221">As a result, the SQL service is in a stopped state, and it needs the F:\MSSQL\Data path.</span></span>

<span data-ttu-id="432da-222">Существует два способа создания этого пути.</span><span class="sxs-lookup"><span data-stu-id="432da-222">There are two ways to create this path:</span></span>

- <span data-ttu-id="432da-223">Добавьте новый диск и назначьте путь к папке tempdb.</span><span class="sxs-lookup"><span data-stu-id="432da-223">Add a new disk and assign tempdb folder path.</span></span>
- <span data-ttu-id="432da-224">Используйте существующий диск временного хранилища для пути к папке tempdb.</span><span class="sxs-lookup"><span data-stu-id="432da-224">Use an existing temporary storage disk for the tempdb folder path.</span></span>

#### <a name="add-a-new-disk"></a><span data-ttu-id="432da-225">Добавьте новый диск:</span><span class="sxs-lookup"><span data-stu-id="432da-225">Add a new disk:</span></span>

1. <span data-ttu-id="432da-226">Запишите пути к файлам tempdb.mdf и tempdb.ldf для базы данных SQL перед отработкой отказа.</span><span class="sxs-lookup"><span data-stu-id="432da-226">Write down the paths of SQL tempdb.mdf and tempdb.ldf before failover.</span></span>
2. <span data-ttu-id="432da-227">На портале Azure добавьте новый диск для восстановленной виртуальной машины с размером, не меньшим, чем у исходного диска базы данных tempdb SQL (диск 3).</span><span class="sxs-lookup"><span data-stu-id="432da-227">From the Azure portal, add a new disk to the failover virtual machine with the same or more size as that of the source SQL tempdb disk (Disk3).</span></span>
3. <span data-ttu-id="432da-228">Выполните вход на виртуальную машину Azure.</span><span class="sxs-lookup"><span data-stu-id="432da-228">Sign in to the Azure virtual machine.</span></span> <span data-ttu-id="432da-229">В консоли управления (diskmgmt.msc) диском выполните инициализацию и форматирование добавленного диска.</span><span class="sxs-lookup"><span data-stu-id="432da-229">From the disk management (diskmgmt.msc) console, initialize and format the newly added disk.</span></span>
4. <span data-ttu-id="432da-230">Назначьте букву диска, используемую для диска базы данных tempdb SQL ("F:").</span><span class="sxs-lookup"><span data-stu-id="432da-230">Assign the same drive letter that was used by the SQL tempdb disk (F:).</span></span>
5. <span data-ttu-id="432da-231">Создайте папку tempdb в томе "F:" (F:\MSSQL\Data).</span><span class="sxs-lookup"><span data-stu-id="432da-231">Create a tempdb folder on the F: volume (F:\MSSQL\Data).</span></span>
6. <span data-ttu-id="432da-232">Запустите службу SQL из консоли службы.</span><span class="sxs-lookup"><span data-stu-id="432da-232">Start the SQL service from the service console.</span></span>

#### <a name="use-an-existing-temporary-storage-disk-for-the-sql-tempdb-folder-path"></a><span data-ttu-id="432da-233">Используйте существующий диск временного хранилища для пути к папке tempdb SQL:</span><span class="sxs-lookup"><span data-stu-id="432da-233">Use an existing temporary storage disk for the SQL tempdb folder path:</span></span>

1. <span data-ttu-id="432da-234">Откройте окно командной строки.</span><span class="sxs-lookup"><span data-stu-id="432da-234">Open a command prompt.</span></span>
2. <span data-ttu-id="432da-235">Запустите SQL Server в режиме восстановления из командной строки.</span><span class="sxs-lookup"><span data-stu-id="432da-235">Run SQL Server in recovery mode from the command prompt.</span></span>

        Net start MSSQLSERVER /f / T3608

3. <span data-ttu-id="432da-236">Запустите следующую команду sqlcmd, чтобы изменить путь к tempdb на новый.</span><span class="sxs-lookup"><span data-stu-id="432da-236">Run the following sqlcmd to change the tempdb path to the new path.</span></span>

        sqlcmd -A -S SalesDB        **Use your SQL DBname**
        USE master;     
        GO      
        ALTER DATABASE tempdb       
        MODIFY FILE (NAME = tempdev, FILENAME = 'E:\MSSQL\tempdata\tempdb.mdf');
        GO      
        ALTER DATABASE tempdb       
        MODIFY FILE (NAME = templog, FILENAME = 'E:\MSSQL\tempdata\templog.ldf');       
        GO


4. <span data-ttu-id="432da-237">Остановите службу Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="432da-237">Stop the Microsoft SQL Server service.</span></span>

        Net stop MSSQLSERVER
5. <span data-ttu-id="432da-238">Запустите службу Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="432da-238">Start the Microsoft SQL Server service.</span></span>

        Net start MSSQLSERVER

<span data-ttu-id="432da-239">Обратитесь к следующим рекомендациям Azure для диска временного хранилища:</span><span class="sxs-lookup"><span data-stu-id="432da-239">Refer to the following Azure guideline for temporary storage disk:</span></span>

* [<span data-ttu-id="432da-240">Использование SSD на виртуальных машинах Azure для хранения базы данных TempDB SQL Server и расширений буферного пула</span><span class="sxs-lookup"><span data-stu-id="432da-240">Using SSDs in Azure VMs to store SQL Server TempDB and Buffer Pool Extensions</span></span>](https://blogs.technet.microsoft.com/dataplatforminsider/2014/09/25/using-ssds-in-azure-vms-to-store-sql-server-tempdb-and-buffer-pool-extensions/)
* [<span data-ttu-id="432da-241">Рекомендации по оптимизации производительности SQL Server на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="432da-241">Performance best practices for SQL Server in Azure Virtual Machines</span></span>](https://docs.microsoft.com/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-performance)

### <a name="failback-from-azure-to-an-on-premises-host"></a><span data-ttu-id="432da-242">Восстановление размещения (из Azure на локальный узел)</span><span class="sxs-lookup"><span data-stu-id="432da-242">Failback (from Azure to an on-premises host)</span></span>
<span data-ttu-id="432da-243">Теперь давайте разберемся, какие диски будут реплицированы при выполнении отработки отказа из Azure в локальную виртуальную машину VMware или узел Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="432da-243">Now let's understand the disks that are replicated when you fail over from Azure to your on-premises VMware or Hyper-V host.</span></span> <span data-ttu-id="432da-244">Диски, созданные в Azure вручную, не будут реплицированы.</span><span class="sxs-lookup"><span data-stu-id="432da-244">Disks that you create manually in Azure will not be replicated.</span></span> <span data-ttu-id="432da-245">Например, если вы выполните отработку отказа трех дисков и создадите два диска непосредственно на виртуальных машинах Azure, то восстановление размещения будет выполнено только для трех дисков, задействованных при отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="432da-245">For example, if you fail over three disks and create two directly in Azure Virtual Machines, only three disks that were failed over will be failed back.</span></span> <span data-ttu-id="432da-246">Восстановление размещения после сбоя или повторная защита из локальной среды в Azure недоступны для дисков, созданных вручную.</span><span class="sxs-lookup"><span data-stu-id="432da-246">You can't include disks that were created manually in failback or in reprotect from on-premises to Azure.</span></span> <span data-ttu-id="432da-247">Диски временного хранилища также не реплицируются в локальные узлы.</span><span class="sxs-lookup"><span data-stu-id="432da-247">It also does not replicate the temporary storage disk to on-premises hosts.</span></span>

#### <a name="failback-to-original-location-recovery"></a><span data-ttu-id="432da-248">Восстановление размещения в исходном расположении</span><span class="sxs-lookup"><span data-stu-id="432da-248">Failback to original location recovery</span></span>

<span data-ttu-id="432da-249">В предыдущем примере конфигурация дисков виртуальной машины Azure была представлена следующим образом:</span><span class="sxs-lookup"><span data-stu-id="432da-249">In the previous example, the Azure virtual machine disk configuration is as follows:</span></span>

<span data-ttu-id="432da-250">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-250">**Guest operating system disk#**</span></span> | <span data-ttu-id="432da-251">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-251">**Drive letter**</span></span> | <span data-ttu-id="432da-252">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-252">**Data type on the disk**</span></span>
--- | --- | ---
<span data-ttu-id="432da-253">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-253">DISK0</span></span> | <span data-ttu-id="432da-254">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-254">C:\\</span></span> | <span data-ttu-id="432da-255">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-255">Operating system disk</span></span>
<span data-ttu-id="432da-256">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-256">Disk1</span></span> | <span data-ttu-id="432da-257">E:\\</span><span class="sxs-lookup"><span data-stu-id="432da-257">E:\\</span></span> | <span data-ttu-id="432da-258">Временное хранилище</br /> </br />Azure добавляет этот диск и назначает ему первую доступную букву диска.</span><span class="sxs-lookup"><span data-stu-id="432da-258">Temporary storage</br /> </br />Azure adds this disk and assigns the first available drive letter.</span></span>
<span data-ttu-id="432da-259">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-259">Disk2</span></span> | <span data-ttu-id="432da-260">D:\\</span><span class="sxs-lookup"><span data-stu-id="432da-260">D:\\</span></span> | <span data-ttu-id="432da-261">Системная база данных SQL и база данных пользователя Database1</span><span class="sxs-lookup"><span data-stu-id="432da-261">SQL system database and User Database1</span></span>
<span data-ttu-id="432da-262">Диск 3</span><span class="sxs-lookup"><span data-stu-id="432da-262">Disk3</span></span> | <span data-ttu-id="432da-263">G:\\</span><span class="sxs-lookup"><span data-stu-id="432da-263">G:\\</span></span> | <span data-ttu-id="432da-264">База данных пользователя Database2</span><span class="sxs-lookup"><span data-stu-id="432da-264">User Database2</span></span>


#### <a name="vmware-to-azure"></a><span data-ttu-id="432da-265">VMware — Azure</span><span class="sxs-lookup"><span data-stu-id="432da-265">VMware to Azure</span></span>
<span data-ttu-id="432da-266">После выполнения восстановления в исходное расположение в конфигурации дисков восстановленной виртуальной машины отсутствуют исключенные из репликации диски.</span><span class="sxs-lookup"><span data-stu-id="432da-266">When failback is done to the original location, the failback virtual machine disk configuration does not have excluded disks.</span></span> <span data-ttu-id="432da-267">Диски, которые были исключены из репликации VMware в Azure, не будут доступны на восстановленной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="432da-267">Disks that were excluded from VMware to Azure  will not be available on the failback virtual machine.</span></span>

<span data-ttu-id="432da-268">Ниже представлены диски, доступные после плановой отработки отказа из Azure на локальную виртуальную машину VMware (исходное расположение).</span><span class="sxs-lookup"><span data-stu-id="432da-268">After planned failover from Azure to on-premises VMware, disks on the VMWare virtual machine (original location) are as follows:</span></span>

<span data-ttu-id="432da-269">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-269">**Guest operating system disk#**</span></span> | <span data-ttu-id="432da-270">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-270">**Drive letter**</span></span> | <span data-ttu-id="432da-271">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-271">**Data type on the disk**</span></span>
--- | --- | ---
<span data-ttu-id="432da-272">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-272">DISK0</span></span> | <span data-ttu-id="432da-273">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-273">C:\\</span></span> | <span data-ttu-id="432da-274">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-274">Operating system disk</span></span>
<span data-ttu-id="432da-275">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-275">Disk1</span></span> | <span data-ttu-id="432da-276">D:\\</span><span class="sxs-lookup"><span data-stu-id="432da-276">D:\\</span></span> | <span data-ttu-id="432da-277">Системная база данных SQL и база данных пользователя Database1</span><span class="sxs-lookup"><span data-stu-id="432da-277">SQL system database and User Database1</span></span>
<span data-ttu-id="432da-278">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-278">Disk2</span></span> | <span data-ttu-id="432da-279">G:\\</span><span class="sxs-lookup"><span data-stu-id="432da-279">G:\\</span></span> | <span data-ttu-id="432da-280">База данных пользователя Database2</span><span class="sxs-lookup"><span data-stu-id="432da-280">User Database2</span></span>

#### <a name="hyper-v-to-azure"></a><span data-ttu-id="432da-281">Hyper-V в Azure</span><span class="sxs-lookup"><span data-stu-id="432da-281">Hyper-V to Azure</span></span>
<span data-ttu-id="432da-282">При восстановлении в исходном расположении конфигурация дисков восстановленной виртуальной машины остается такой же, как исходная конфигурация дисков виртуальной машины Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="432da-282">When failback is to the original location, the failback virtual machine disk configuration remains the same as that of original virtual machine disk configuration for Hyper-V.</span></span> <span data-ttu-id="432da-283">Диски, которые были исключены из репликации из сайта Hyper-V в Azure, доступны на восстановленной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="432da-283">Disks that were excluded from Hyper-V site to Azure are available on the failback virtual machine.</span></span>

<span data-ttu-id="432da-284">Ниже представлены диски, доступные после плановой отработки отказа из Azure на локальную виртуальную машину Hyper-V (исходное расположение).</span><span class="sxs-lookup"><span data-stu-id="432da-284">After planned failover from Azure to on-premises Hyper-V, disks on the Hyper-V virtual machine (original location) are as follows:</span></span>

<span data-ttu-id="432da-285">**Имя диска**</span><span class="sxs-lookup"><span data-stu-id="432da-285">**Disk Name**</span></span> | <span data-ttu-id="432da-286">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-286">**Guest operating system disk#**</span></span> | <span data-ttu-id="432da-287">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-287">**Drive letter**</span></span> | <span data-ttu-id="432da-288">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-288">**Data type on the disk**</span></span>
--- | --- | --- | ---
<span data-ttu-id="432da-289">DB-Disk0-OS</span><span class="sxs-lookup"><span data-stu-id="432da-289">DB-Disk0-OS</span></span> | <span data-ttu-id="432da-290">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-290">DISK0</span></span> |   <span data-ttu-id="432da-291">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-291">C:\\</span></span> | <span data-ttu-id="432da-292">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-292">Operating system disk</span></span>
<span data-ttu-id="432da-293">DB-Disk1</span><span class="sxs-lookup"><span data-stu-id="432da-293">DB-Disk1</span></span> | <span data-ttu-id="432da-294">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-294">Disk1</span></span> | <span data-ttu-id="432da-295">D:\\</span><span class="sxs-lookup"><span data-stu-id="432da-295">D:\\</span></span> | <span data-ttu-id="432da-296">Системная база данных SQL и база данных пользователя Database1</span><span class="sxs-lookup"><span data-stu-id="432da-296">SQL system database and User Database1</span></span>
<span data-ttu-id="432da-297">DB-Disk2 (исключенный из репликации)</span><span class="sxs-lookup"><span data-stu-id="432da-297">DB-Disk2 (Excluded disk)</span></span> | <span data-ttu-id="432da-298">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-298">Disk2</span></span> | <span data-ttu-id="432da-299">E:\\</span><span class="sxs-lookup"><span data-stu-id="432da-299">E:\\</span></span> | <span data-ttu-id="432da-300">Временные файлы</span><span class="sxs-lookup"><span data-stu-id="432da-300">Temp files</span></span>
<span data-ttu-id="432da-301">DB-Disk3 (исключенный из репликации)</span><span class="sxs-lookup"><span data-stu-id="432da-301">DB-Disk3 (Excluded disk)</span></span> | <span data-ttu-id="432da-302">Диск 3</span><span class="sxs-lookup"><span data-stu-id="432da-302">Disk3</span></span> | <span data-ttu-id="432da-303">F:\\</span><span class="sxs-lookup"><span data-stu-id="432da-303">F:\\</span></span> | <span data-ttu-id="432da-304">База данных tempdb SQL (путь к папке — F:\MSSQL\Data\)</span><span class="sxs-lookup"><span data-stu-id="432da-304">SQL tempdb database (folder path(F:\MSSQL\Data\)</span></span>
<span data-ttu-id="432da-305">DB-Disk4</span><span class="sxs-lookup"><span data-stu-id="432da-305">DB-Disk4</span></span> | <span data-ttu-id="432da-306">Диск 4</span><span class="sxs-lookup"><span data-stu-id="432da-306">Disk4</span></span> | <span data-ttu-id="432da-307">G:\\</span><span class="sxs-lookup"><span data-stu-id="432da-307">G:\\</span></span> | <span data-ttu-id="432da-308">База данных пользователя Database2</span><span class="sxs-lookup"><span data-stu-id="432da-308">User Database2</span></span>


#### <a name="exclude-the-paging-file-pagefilesys-disk"></a><span data-ttu-id="432da-309">Исключение диска с файлом подкачки (pagefile.sys)</span><span class="sxs-lookup"><span data-stu-id="432da-309">Exclude the paging file (pagefile.sys) disk</span></span>

<span data-ttu-id="432da-310">Рассмотрим виртуальную машину с диском с файлом подкачки, который можно исключить из репликации.</span><span class="sxs-lookup"><span data-stu-id="432da-310">Let's consider a virtual machine that has a paging file disk that can be excluded.</span></span>
<span data-ttu-id="432da-311">Есть два способа.</span><span class="sxs-lookup"><span data-stu-id="432da-311">There are two cases.</span></span>

#### <a name="case-1-the-paging-file-is-configured-on-the-d-drive"></a><span data-ttu-id="432da-312">Вариант 1. Файл подкачки настроен на диске "D:"</span><span class="sxs-lookup"><span data-stu-id="432da-312">Case 1: The paging file is configured on the D: drive</span></span>
<span data-ttu-id="432da-313">Конфигурация дисков.</span><span class="sxs-lookup"><span data-stu-id="432da-313">Here's the disk configuration:</span></span>


<span data-ttu-id="432da-314">**Имя диска**</span><span class="sxs-lookup"><span data-stu-id="432da-314">**Disk name**</span></span> | <span data-ttu-id="432da-315">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-315">**Guest operating system disk#**</span></span> | <span data-ttu-id="432da-316">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-316">**Drive letter**</span></span> | <span data-ttu-id="432da-317">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-317">**Data type on the disk**</span></span>
--- | --- | --- | ---
<span data-ttu-id="432da-318">DB-Disk0-OS</span><span class="sxs-lookup"><span data-stu-id="432da-318">DB-Disk0-OS</span></span> | <span data-ttu-id="432da-319">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-319">DISK0</span></span> | <span data-ttu-id="432da-320">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-320">C:\\</span></span> | <span data-ttu-id="432da-321">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-321">Operating system disk</span></span>
<span data-ttu-id="432da-322">DB-Disk1 (исключенный из репликации)</span><span class="sxs-lookup"><span data-stu-id="432da-322">DB-Disk1 (Excluded the disk from the protection)</span></span> | <span data-ttu-id="432da-323">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-323">Disk1</span></span> | <span data-ttu-id="432da-324">D:\\</span><span class="sxs-lookup"><span data-stu-id="432da-324">D:\\</span></span> | <span data-ttu-id="432da-325">pagefile.sys</span><span class="sxs-lookup"><span data-stu-id="432da-325">pagefile.sys</span></span>
<span data-ttu-id="432da-326">DB-Disk2</span><span class="sxs-lookup"><span data-stu-id="432da-326">DB-Disk2</span></span> | <span data-ttu-id="432da-327">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-327">Disk2</span></span> | <span data-ttu-id="432da-328">E:\\</span><span class="sxs-lookup"><span data-stu-id="432da-328">E:\\</span></span> | <span data-ttu-id="432da-329">Пользовательские данные 1</span><span class="sxs-lookup"><span data-stu-id="432da-329">User data 1</span></span>
<span data-ttu-id="432da-330">DB-Disk3</span><span class="sxs-lookup"><span data-stu-id="432da-330">DB-Disk3</span></span> | <span data-ttu-id="432da-331">Диск 3</span><span class="sxs-lookup"><span data-stu-id="432da-331">Disk3</span></span> | <span data-ttu-id="432da-332">F:\\</span><span class="sxs-lookup"><span data-stu-id="432da-332">F:\\</span></span> | <span data-ttu-id="432da-333">Пользовательские данные 2</span><span class="sxs-lookup"><span data-stu-id="432da-333">User data 2</span></span>

<span data-ttu-id="432da-334">Ниже приведены параметры файла подкачки на исходной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="432da-334">Here are the paging file settings on the source virtual machine:</span></span>

![Параметры файла подкачки на исходной виртуальной машине](./media/site-recovery-exclude-disk/pagefile-on-d-drive-sourceVM.png)


<span data-ttu-id="432da-336">Ниже представлены диски, доступные на виртуальной машине Azure после отработки отказа виртуальной машины из VMware или Hyper-V в Azure.</span><span class="sxs-lookup"><span data-stu-id="432da-336">After failover of the virtual machine from VMware to Azure or Hyper-V to Azure, disks on the Azure virtual machine are as follows:</span></span>

<span data-ttu-id="432da-337">**Имя диска**</span><span class="sxs-lookup"><span data-stu-id="432da-337">**Disk name**</span></span> | <span data-ttu-id="432da-338">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-338">**Guest operating system disk#**</span></span> | <span data-ttu-id="432da-339">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-339">**Drive letter**</span></span> | <span data-ttu-id="432da-340">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-340">**Data type on the disk**</span></span>
--- | --- | --- | ---
<span data-ttu-id="432da-341">DB-Disk0-OS</span><span class="sxs-lookup"><span data-stu-id="432da-341">DB-Disk0-OS</span></span> | <span data-ttu-id="432da-342">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-342">DISK0</span></span> | <span data-ttu-id="432da-343">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-343">C:\\</span></span> | <span data-ttu-id="432da-344">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-344">Operating system disk</span></span>
<span data-ttu-id="432da-345">DB-Disk1</span><span class="sxs-lookup"><span data-stu-id="432da-345">DB-Disk1</span></span> | <span data-ttu-id="432da-346">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-346">Disk1</span></span> | <span data-ttu-id="432da-347">D:\\</span><span class="sxs-lookup"><span data-stu-id="432da-347">D:\\</span></span> | <span data-ttu-id="432da-348">Временное хранилище</br /> </br />pagefile.sys</span><span class="sxs-lookup"><span data-stu-id="432da-348">Temporary storage</br /> </br />pagefile.sys</span></span>
<span data-ttu-id="432da-349">DB-Disk2</span><span class="sxs-lookup"><span data-stu-id="432da-349">DB-Disk2</span></span> | <span data-ttu-id="432da-350">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-350">Disk2</span></span> | <span data-ttu-id="432da-351">E:\\</span><span class="sxs-lookup"><span data-stu-id="432da-351">E:\\</span></span> | <span data-ttu-id="432da-352">Пользовательские данные 1</span><span class="sxs-lookup"><span data-stu-id="432da-352">User data 1</span></span>
<span data-ttu-id="432da-353">DB-Disk3</span><span class="sxs-lookup"><span data-stu-id="432da-353">DB-Disk3</span></span> | <span data-ttu-id="432da-354">Диск 3</span><span class="sxs-lookup"><span data-stu-id="432da-354">Disk3</span></span> | <span data-ttu-id="432da-355">F:\\</span><span class="sxs-lookup"><span data-stu-id="432da-355">F:\\</span></span> | <span data-ttu-id="432da-356">Пользовательские данные 2</span><span class="sxs-lookup"><span data-stu-id="432da-356">User data 2</span></span>

<span data-ttu-id="432da-357">Так как диск 1 (D:) был исключен, "D:" является первой доступной буквой диска из списка.</span><span class="sxs-lookup"><span data-stu-id="432da-357">Because Disk1 (D:) was excluded, D: is the first drive letter from the available list.</span></span> <span data-ttu-id="432da-358">Azure назначает "D:" тому временного хранилища.</span><span class="sxs-lookup"><span data-stu-id="432da-358">Azure assigns D: to the temporary storage volume.</span></span> <span data-ttu-id="432da-359">Так как диск "D:" доступен на виртуальной машине Azure, параметры файла подкачки виртуальной машины не изменятся.</span><span class="sxs-lookup"><span data-stu-id="432da-359">Because D: is available on the Azure virtual machine, the paging file setting of the virtual machine remains the same.</span></span>

<span data-ttu-id="432da-360">Ниже приведены параметры файла подкачки на виртуальной машине Azure.</span><span class="sxs-lookup"><span data-stu-id="432da-360">Here are the paging file settings on the Azure virtual machine:</span></span>

![Параметры файла подкачки на виртуальной машине Azure](./media/site-recovery-exclude-disk/pagefile-on-Azure-vm-after-failover.png)

#### <a name="case-2-the-paging-file-is-configured-on-another-drive-other-than-d-drive"></a><span data-ttu-id="432da-362">Вариант 2. Файл подкачки настроен на другом диске (отличном от диска "D:")</span><span class="sxs-lookup"><span data-stu-id="432da-362">Case 2: The paging file is configured on another drive (other than D: drive)</span></span>

<span data-ttu-id="432da-363">Ниже приведена конфигурация дисков исходной виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="432da-363">Here's the source virtual machine disk configuration:</span></span>

<span data-ttu-id="432da-364">**Имя диска**</span><span class="sxs-lookup"><span data-stu-id="432da-364">**Disk name**</span></span> | <span data-ttu-id="432da-365">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-365">**Guest operating system disk#**</span></span> | <span data-ttu-id="432da-366">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-366">**Drive letter**</span></span> | <span data-ttu-id="432da-367">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-367">**Data type on the disk**</span></span>
--- | --- | --- | ---
<span data-ttu-id="432da-368">DB-Disk0-OS</span><span class="sxs-lookup"><span data-stu-id="432da-368">DB-Disk0-OS</span></span> | <span data-ttu-id="432da-369">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-369">DISK0</span></span> | <span data-ttu-id="432da-370">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-370">C:\\</span></span> | <span data-ttu-id="432da-371">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-371">Operating system disk</span></span>
<span data-ttu-id="432da-372">DB-Disk 1 (исключенный из репликации)</span><span class="sxs-lookup"><span data-stu-id="432da-372">DB-Disk1 (Excluded the disk from protection)</span></span> | <span data-ttu-id="432da-373">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-373">Disk1</span></span> | <span data-ttu-id="432da-374">G:\\</span><span class="sxs-lookup"><span data-stu-id="432da-374">G:\\</span></span> | <span data-ttu-id="432da-375">pagefile.sys</span><span class="sxs-lookup"><span data-stu-id="432da-375">pagefile.sys</span></span>
<span data-ttu-id="432da-376">DB-Disk2</span><span class="sxs-lookup"><span data-stu-id="432da-376">DB-Disk2</span></span> | <span data-ttu-id="432da-377">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-377">Disk2</span></span> | <span data-ttu-id="432da-378">E:\\</span><span class="sxs-lookup"><span data-stu-id="432da-378">E:\\</span></span> | <span data-ttu-id="432da-379">Пользовательские данные 1</span><span class="sxs-lookup"><span data-stu-id="432da-379">User data 1</span></span>
<span data-ttu-id="432da-380">DB-Disk3</span><span class="sxs-lookup"><span data-stu-id="432da-380">DB-Disk3</span></span> | <span data-ttu-id="432da-381">Диск 3</span><span class="sxs-lookup"><span data-stu-id="432da-381">Disk3</span></span> | <span data-ttu-id="432da-382">F:\\</span><span class="sxs-lookup"><span data-stu-id="432da-382">F:\\</span></span> | <span data-ttu-id="432da-383">Пользовательские данные 2</span><span class="sxs-lookup"><span data-stu-id="432da-383">User data 2</span></span>

<span data-ttu-id="432da-384">Ниже приведены параметры файла подкачки на локальной виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="432da-384">Here are the paging file settings on the on-premises virtual machine:</span></span>

![Параметры файла подкачки на локальной виртуальной машине](./media/site-recovery-exclude-disk/pagefile-on-g-drive-sourceVM.png)

<span data-ttu-id="432da-386">Ниже представлены диски, доступные на виртуальной машине Azure после отработки отказа виртуальной машины из VMware или Hyper-V в Azure.</span><span class="sxs-lookup"><span data-stu-id="432da-386">After failover of the virtual machine from VMware/Hyper-V to Azure, disks on the Azure virtual machine are as follows:</span></span>

<span data-ttu-id="432da-387">**Имя диска**</span><span class="sxs-lookup"><span data-stu-id="432da-387">**Disk name**</span></span>| <span data-ttu-id="432da-388">**№ диска операционной системы на виртуальной машине**</span><span class="sxs-lookup"><span data-stu-id="432da-388">**Guest operating system disk#**</span></span>| <span data-ttu-id="432da-389">**Буква диска**</span><span class="sxs-lookup"><span data-stu-id="432da-389">**Drive letter**</span></span> | <span data-ttu-id="432da-390">**Тип данных на диске**</span><span class="sxs-lookup"><span data-stu-id="432da-390">**Data type on the disk**</span></span>
--- | --- | --- | ---
<span data-ttu-id="432da-391">DB-Disk0-OS</span><span class="sxs-lookup"><span data-stu-id="432da-391">DB-Disk0-OS</span></span> | <span data-ttu-id="432da-392">Диск 0</span><span class="sxs-lookup"><span data-stu-id="432da-392">DISK0</span></span>  |<span data-ttu-id="432da-393">C:\\</span><span class="sxs-lookup"><span data-stu-id="432da-393">C:\\</span></span> |<span data-ttu-id="432da-394">Диск операционной системы</span><span class="sxs-lookup"><span data-stu-id="432da-394">Operating system disk</span></span>
<span data-ttu-id="432da-395">DB-Disk1</span><span class="sxs-lookup"><span data-stu-id="432da-395">DB-Disk1</span></span> | <span data-ttu-id="432da-396">Диск 1</span><span class="sxs-lookup"><span data-stu-id="432da-396">Disk1</span></span> | <span data-ttu-id="432da-397">D:\\</span><span class="sxs-lookup"><span data-stu-id="432da-397">D:\\</span></span> | <span data-ttu-id="432da-398">Временное хранилище</br /> </br />pagefile.sys</span><span class="sxs-lookup"><span data-stu-id="432da-398">Temporary storage</br /> </br />pagefile.sys</span></span>
<span data-ttu-id="432da-399">DB-Disk2</span><span class="sxs-lookup"><span data-stu-id="432da-399">DB-Disk2</span></span> | <span data-ttu-id="432da-400">Диск 2</span><span class="sxs-lookup"><span data-stu-id="432da-400">Disk2</span></span> | <span data-ttu-id="432da-401">E:\\</span><span class="sxs-lookup"><span data-stu-id="432da-401">E:\\</span></span> | <span data-ttu-id="432da-402">Пользовательские данные 1</span><span class="sxs-lookup"><span data-stu-id="432da-402">User data 1</span></span>
<span data-ttu-id="432da-403">DB-Disk3</span><span class="sxs-lookup"><span data-stu-id="432da-403">DB-Disk3</span></span> | <span data-ttu-id="432da-404">Диск 3</span><span class="sxs-lookup"><span data-stu-id="432da-404">Disk3</span></span> | <span data-ttu-id="432da-405">F:\\</span><span class="sxs-lookup"><span data-stu-id="432da-405">F:\\</span></span> | <span data-ttu-id="432da-406">Пользовательские данные 2</span><span class="sxs-lookup"><span data-stu-id="432da-406">User data 2</span></span>

<span data-ttu-id="432da-407">Так как "D:" является первой доступной буквой диска в списке, Azure назначит ее тому временного хранилища.</span><span class="sxs-lookup"><span data-stu-id="432da-407">Because D: is the first drive letter from available the list, Azure assigns D: to the temporary storage volume.</span></span> <span data-ttu-id="432da-408">Для всех реплицированных дисков буква диска не изменится.</span><span class="sxs-lookup"><span data-stu-id="432da-408">For all the replicated disks, the drive letter remains the same.</span></span> <span data-ttu-id="432da-409">Так как диск "G:" недоступен, для файла подкачки система будет использовать диск "C:".</span><span class="sxs-lookup"><span data-stu-id="432da-409">Because the G: disk is not available, the system will use the C: drive for the paging file.</span></span>

<span data-ttu-id="432da-410">Ниже приведены параметры файла подкачки на виртуальной машине Azure.</span><span class="sxs-lookup"><span data-stu-id="432da-410">Here are the paging file settings on the Azure virtual machine:</span></span>

![Параметры файла подкачки на виртуальной машине Azure](./media/site-recovery-exclude-disk/pagefile-on-Azure-vm-after-failover-2.png)

## <a name="next-steps"></a><span data-ttu-id="432da-412">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="432da-412">Next steps</span></span>
<span data-ttu-id="432da-413">Настроив и запустив развертывание, вы можете ознакомиться с [дополнительными сведениями](site-recovery-failover.md) о различных типах обработки отказа.</span><span class="sxs-lookup"><span data-stu-id="432da-413">After your deployment is set up and running, [learn more](site-recovery-failover.md) about different types of failover.</span></span>
