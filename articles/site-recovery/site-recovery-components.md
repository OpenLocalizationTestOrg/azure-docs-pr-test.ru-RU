---
title: "aaaHow работают Site Recovery? | Документация Майкрософт"
description: "В этой статье описана общая архитектура службы Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: site-recovery-azure-to-azure-architecture
ms.openlocfilehash: ff1580d0fe294148dc0c621728491e6119c3048a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-does-azure-site-recovery-work-for-on-premises-infrastructure"></a>Как работает Azure Site Recovery в отношении локальной инфраструктуры?

> [!div class="op_single_selector"]
> * [Репликация виртуальных машин Azure](site-recovery-azure-to-azure-architecture.md)
> * [Репликация локальных компьютеров](site-recovery-components.md)

В этой статье описывается базовая архитектура hello [Azure Site Recovery](site-recovery-overview.md) службы и компоненты hello, сделать его работы для репликации из локальной tooAzure рабочих нагрузок.

Отправлять все комментарии hello нижней части этой статьи, или в hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).


## <a name="replicate-tooazure"></a>Реплицировать tooAzure

Можно реплицировать и защиты на локальный инфраструктуры tooAzure hello следующие:

- **VMware.** Локальные виртуальные машины VMware, запущенные на [поддерживаемом узле](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers). Вы можете реплицировать виртуальные машины VMware, выполняемые в [поддерживаемых операционных системах](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).
- **Hyper-V.** Локальные виртуальные машины Hyper-V, запущенные на [поддерживаемых узлах](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).
- **Физические компьютеры.** Локальные физические серверы под управлением Windows или Linux в [поддерживаемых операционных системах](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions). Вы можете реплицировать виртуальные машины Hyper-V, запущенные в любой операционной системе на виртуальной машине, [поддерживаемой Hyper-V и Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).

## <a name="vmware-tooazure"></a>VMware tooAzure

Вот, что необходимо для репликации виртуальных машин VMware tooAzure.

Область | Компонент | Сведения
--- | --- | ---
**Сервер конфигурации** | На одном сервере управления (виртуальная машина VMware) выполняются все локальные компоненты, а именно: сервер конфигурации, сервер обработки, главный целевой сервер. | Сервер конфигурации Hello координирует взаимодействие между локальной средой и Azure, а также управляет репликации данных.
 **Сервер обработки**  | Устанавливается по умолчанию на сервере конфигурации hello. | Выступает в качестве шлюза репликации. Получает данные репликации, выполняет оптимизацию для кэширования, сжатия и шифрования и отправляет его tooAzure хранилища.<br/><br/> сервер обработки Hello также обрабатываются принудительной установки службы tooprotected hello Mobility машин, а также выполняет автоматическое обнаружение виртуальных машин VMware.<br/><br/> По мере роста развертывания можно добавить дополнительные отдельном выделенном процессе серверов toohandle увеличение объемов трафика репликации.
 **Главный целевой сервер** | Устанавливается по умолчанию на сервере конфигурации локальной hello. | Обрабатывает данные репликации при восстановлении размещения с переносом из Azure.<br/><br/> Если объемы трафика восстановления размещения высоки, можно развернуть отдельный главный целевой сервер.
**Серверы VMware** | Виртуальные машины VMware, размещаются на серверах ESXi vSphere, и мы рекомендуем vCenter server toomanage hello узлов. | Добавьте хранилище служб восстановления tooyour серверов VMware.<br/><br/>
**Реплицируемые компьютеры** | Hello службы Mobility service будет установлен на каждой виртуальной Машины требуется tooreplicate VMware. Его можно установить вручную на каждом компьютере или с помощью принудительной установки с сервера обработки hello.| -

**Рис. 1: Компоненты tooAzure VMware**

![Компоненты](./media/site-recovery-components/arch-enhanced.png)

### <a name="replication-process"></a>Процесс репликации

1. Настройка развертывания hello, включая компоненты Azure и хранилище служб восстановления. В хранилище hello укажите hello репликации исходное и целевое, Настройка сервера конфигурации hello, добавление серверов VMware, создайте политику репликации, развертывание службы мобильности hello, включение репликации и запустите тестовую отработку отказа.
2.  Машины запустить репликацию в соответствии с политикой репликации hello и исходную копию данных hello — реплицированные tooAzure хранилище.
4. Репликация tooAzure разностных изменений начинается после завершения первоначальной репликации hello. Отслеживаемые изменения для компьютера хранятся в HRL-файле.
    - Репликацию машин взаимодействуют с сервером конфигурации hello через порт 443 для HTTPS входящего трафика для управления репликацией.
    - Репликацию машины отправляют сервера обработки toohello репликации данных через порт HTTPS 9443 входящих (можно настроить).
    - Сервер конфигурации Hello управляет управление репликацией с помощью Azure через порт 443 для исходящих подключений HTTPS.
    - Hello сервера обработки получает данные из исходных компьютеров, оптимизирует и шифрует его и отправляет его хранения tooAzure через порт номер 443 исходящего.
    - При включении согласованность нескольких виртуальных Машин, затем машины в группу репликации hello взаимодействовать друг с другом через порт 20004. Эту функция используется, если вы объединяете несколько компьютеров в группы репликации, и они совместно используют отказоустойчивые и согласованные точки восстановления после отработки отказа. Это полезно, если компьютеры работают под управлением hello же рабочую нагрузку и требуют toobe согласованной.
5. Трафик реплицированных tooAzure хранения общедоступных конечных точек, более чем hello Интернета. Кроме того, можно использовать [общедоступный пиринг](https://docs.microsoft.com/en-us/azure/expressroute/expressroute-circuit-peerings#public-peering) Azure ExpressRoute. Репликация трафика через виртуальную частную сеть сайт сайт с локального сайта tooAzure не поддерживается.

**Рисунок 2: VMware tooAzure репликации**

![Расширенная архитектура](./media/site-recovery-components/v2a-architecture-henry.png)

### <a name="failover-and-failback"></a>Отработка отказа и восстановление размещения

1. Убедившись, что тестовой отработки отказа работает должным образом, при необходимости можно запустить tooAzure незапланированной отработки отказа. Плановая отработка отказа не поддерживается.
2. При сбое одного компьютера или создайте [планы восстановления](site-recovery-create-recovery-plans.md), toofail по нескольким ВМ.
3. При отработке отказа в Azure создаются виртуальные машины реплик. Фиксация отработки отказа toostart доступ к hello рабочей нагрузки из hello реплики виртуальной Машины Azure.
4. Когда основной локальный сайт снова станет доступным, вы сможете выполнить восстановление размещения. Настройка инфраструктуры восстановление после сбоя, запустить репликацию машины hello из первичного toohello вторичного сайта hello и запустить незапланированную отработку отказа из вторичного сайта hello. После фиксации этой отработки отказа, данные будут назад в локальной и требуется tooAzure tooenable репликации. [Дополнительные сведения](site-recovery-failback-azure-to-vmware.md)

**Рис. 3. Восстановление размещения виртуальных машин или физических компьютеров VMware**

![Восстановление размещения](./media/site-recovery-components/enhanced-failback.png)

## <a name="physical-tooazure"></a>Физический tooAzure

При репликации tooAzure физического локальных серверов, репликация использует также hello же компоненты и процессы, так как [VMware tooAzure](#vmware-replication-to-azure), но следует отметить следующие различия:

- Для сервера конфигурации hello, а не виртуальной Машины VMware можно использовать физического сервера
- для восстановления размещения требуется локальная инфраструктура VMware. Нельзя отметить как не задней tooa физического компьютера.

## <a name="hyper-v-tooazure"></a>TooAzure Hyper-V

### <a name="replication-process"></a>Процесс репликации

1. Можно настроить hello компонентов Azure. Перед развертыванием Site Recovery мы рекомендуем настроить учетные записи хранения и сети.
2. Необходимо создать хранилище служб репликации для Site Recovery и настроить параметры хранилища. В частности, необходимо сделать следующее.
    - Исходные и целевые параметры. Если вы не управляете узлами Hyper-V в облаке VMM, для целевого объекта hello можно создать контейнер узла Hyper-V и добавьте tooit узлов Hyper-V. Если узлы Hyper-V управляются в VMM, hello источником является облако VMM hello. целевой объект Hello является Azure.
    - Установка hello поставщика Azure Site Recovery и агента служб восстановления Microsoft Azure hello. Если у вас есть hello VMM поставщика будут устанавливаться на нем и hello агента на каждом узле Hyper-V. Если у вас нет VMM, hello поставщика и агента будут установлены на каждом узле.
    - Можно создать политику репликации для узла Hyper-V hello или облака VMM. политика Hello — примененных tooall виртуальными машинами, размещенными на узлах, на сайте hello или в облаке.
    - Включите репликацию для виртуальных машин Hyper-V. Начальная репликация выполняется в соответствии с параметрами политики репликации hello.
4. Отслеживаются изменения данных и репликация tooAzure разностных изменений начинается после завершения первоначальной репликации hello. Отслеживаемые изменения для элемента хранятся в HRL-файле.
5. Можно запустить тест отработки отказа toomake убедиться, что все работает.

### <a name="failover-and-failback-process"></a>Процесс отработки отказа и восстановления размещения

1. Выполнением запланированного или незапланированного [перехода на другой ресурс](site-recovery-failover.md) из tooAzure локальных виртуальных машин Hyper-V. Если запустить плановую отработку отказа, то источник виртуальных машин, завершают работу tooensure без потери данных.
2. При сбое одного компьютера или создайте [планы восстановления](site-recovery-create-recovery-plans.md) tooorchestrate отработки отказа нескольких машин.
4. После запуска отработки отказа hello следует hello toosee может создать виртуальные машины реплики в Azure. При необходимости можно назначить открытый IP адрес toohello виртуальной Машины.
5. Подтвердите toostart hello перехода на другой ресурс, доступ к рабочей нагрузки hello из hello реплики виртуальной Машины Azure.
6. Когда основной локальный сайт снова станет доступным, вы сможете выполнить [восстановление размещения](site-recovery-failback-from-azure-to-hyper-v.md). Начнем плановой отработки отказа Azure toohello основного сайта. Для плановой отработки отказа, можно toohello выберите toofailback одной виртуальной Машины или tooan другое расположение и синхронизировать изменения между Azure и локальной, tooensure без потери данных. При создании локальных виртуальных машин фиксации hello перехода на другой ресурс.

**Рис. 4: Репликация tooAzure узла Hyper-V**

![Компоненты](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)

**Рисунок 5: Hyper-V в VMM облаков tooAzure репликации**

![Компоненты](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png)


## <a name="replicate-tooa-secondary-site"></a>Реплицировать tooa вторичного сайта

Можно реплицировать hello, следуя tooyour вторичного сайта:

- **VMware.** Локальные виртуальные машины VMware, запущенные на [поддерживаемом узле](site-recovery-support-matrix-to-sec-site.md#on-premises-servers). Вы можете реплицировать виртуальные машины VMware, выполняемые в [поддерживаемых операционных системах](site-recovery-support-matrix-to-sec-site.md#support-for-replicated-machine-os-versions).
- **Физические компьютеры.** Локальные физические серверы под управлением Windows или Linux в [поддерживаемых операционных системах](site-recovery-support-matrix-to-sec-site.md#support-for-replicated-machine-os-versions).
- **Hyper-V.** Локальные виртуальные машины Hyper-V, запущенные на [поддерживаемых узлах](site-recovery-support-matrix-to-sec-site.md#on-premises-servers), управление которыми происходит в облаках VMM. [Поддерживаемые узлы](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers). Вы можете реплицировать виртуальные машины Hyper-V, запущенные в любой операционной системе на виртуальной машине, [поддерживаемой Hyper-V и Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).


## <a name="vmwarephysical-tooa-secondary-site"></a>Дополнительный сайт VMware или физическими tooa

Репликации виртуальных машин VMware или физическими серверами tooa вторичного сайта с помощью InMage Scout.

### <a name="components"></a>Компоненты

**Область** | **Компонент** | **Дополнительные сведения**
--- | --- | ---
**Сервер обработки** | Расположен на основном сайте | Кэширование toohandle hello процесса сервера, сжатие и оптимизацию данных развертывания.<br/><br/> Он также обрабатывает hello требуется tooprotect toomachines единой агента принудительной установки.
**Сервер конфигурации** | Расположен на дополнительном сайте | управляет сервер конфигурации Hello, настраивать и отслеживать развертывания, либо с помощью веб-сайта управления hello или консоли также vContinuum hello.
**Сервер vContinuum** | необязательный параметр. Установить hello же расположении, что и сервер конфигурации hello. | Он предоставляет консоль для мониторинга защищенной среды и управления ею.
**Главный целевой сервер** | Расположен в hello вторичного сайта | Hello главный целевой сервер содержит реплицированные данные. Получает данные с сервера обработки hello, создает машины реплики в hello вторичного сайта и содержит hello точки хранения данных.<br/><br/> Hello количество серверов главного целевого сервера зависит от hello количество машин, которые вы защищаете.<br/><br/> Следует toofail задней toohello первичного сайта необходимо главного целевого сервера существует слишком. Hello единой агент установлен на этом сервере.
**VMware ESX/ESXi и сервер vCenter** |  Виртуальные машины размещаются на узлах ESX/ESXi. Управление узлами осуществляется с помощью сервера vCenter | Необходимо tooreplicate инфраструктуры VMware виртуальных машин VMware.
**Виртуальные машины или физические серверы** |  Единая агент, установленный на виртуальные машины VMware и физических серверов, которые должны tooreplicate. | агент Hello выступает в роли поставщика связи между всеми компонентами hello.


### <a name="replication-process"></a>Процесс репликации

1. Настройка серверов компонент hello в каждом сайте (конфигурации, process, главного целевого сервера) и установить на компьютерах, которые должны tooreplicate hello единой агента.
2. После начальной репликации hello агент на каждом компьютере отправляет сервер обработки toohello изменения репликации изменений.
3. сервер обработки Hello оптимизирует hello данных и передает toohello главный целевой сервер на вторичном сайте hello. Сервер конфигурации Hello управляет процессом репликации hello.

**Рис. 6: Репликация tooVMware VMware**

![VMware tooVMware](./media/site-recovery-components/vmware-to-vmware.png)



## <a name="hyper-v-tooa-secondary-site"></a>Дополнительный сайт tooa Hyper-V

Вот, что необходимо для репликации виртуальных машин Hyper-V tooa вторичного сайта.


**Область** | **Компонент** | **Дополнительные сведения**
--- | --- | ---
**Сервер VMM** | Мы рекомендуем сервера VMM в первичном сайте hello и по одному в hello вторичного сайта | Каждый сервер VMM должен быть подключенным toohello Интернета.<br/><br/> Каждый сервер должен иметь по крайней мере одного частного облака VMM с набором профиль возможностей hello Hyper-V.<br/><br/> Установите hello поставщика Azure Site Recovery на сервере VMM hello. Hello поставщика координирует и управляет репликации с hello службы Site Recovery через hello Интернета. Обмен данными между hello поставщика и Azure, защищен и зашифрован.
**Сервер Hyper-V** |  Один или несколько Hyper-V серверы на hello Первичное и вторичное облака VMM.<br/><br/> Серверы должны быть подключенным toohello Интернета.<br/><br/> Данные реплицируются между hello первичных и вторичных серверах Hyper-V узла по локальной сети hello или VPN с использованием проверки подлинности Kerberos или сертификат.  
**Виртуальные машины Hyper-V** | Размещается на сервере узла Hyper-V hello источника. | сервер узла Hello источник должен иметь минимум одну виртуальную Машину, что требуется tooreplicate.

### <a name="replication-process"></a>Процесс репликации

1. Настройка учетной записи Azure hello.
2. Необходимо создать хранилище служб репликации для Site Recovery и настроить параметры хранилища. В частности, необходимо сделать следующее.

    - Hello репликации источник и цель (первичных и вторичных сайтах).
    - Установка hello поставщика Azure Site Recovery и агента служб восстановления Microsoft Azure hello. Hello поставщик устанавливается на серверы VMM и hello агента на каждом узле Hyper-V.
    - Создайте политику репликации для исходного облака VMM. политика Hello — примененных tooall виртуальными машинами, размещенными на узлах в облаке hello.
    - Включите репликацию для виртуальных машин Hyper-V. Начальная репликация выполняется в соответствии с параметрами политики репликации hello.
4. Отслеживаются изменения данных и разностных изменений toobegins после завершения начальной репликации hello. Отслеживаемые изменения для элемента хранятся в HRL-файле.
5. Можно запустить тест отработки отказа toomake убедиться, что все работает.

**Рисунок 7: VMM tooVMM репликации**

![Локальный tooon в локальной среде](./media/site-recovery-components/arch-onprem-onprem.png)

### <a name="failover-and-failback"></a>Отработка отказа и восстановление размещения

1. Вы можете запустить плановую или внеплановую [отработку отказа](site-recovery-failover.md) между локальными сайтами. Если запустить плановую отработку отказа, то источник виртуальных машин, завершают работу tooensure без потери данных.
2. При сбое одного компьютера или создайте [планы восстановления](site-recovery-create-recovery-plans.md) tooorchestrate отработки отказа нескольких машин.
4. При выполнении внеплановой отработки отказа tooa вторичного сайта после hello отработка отказа машин в дополнительное расположение hello не включена для защиты или репликации. Если вы запустили плановой отработки отказа, после отработки отказа hello, защищенных машин в дополнительное расположение hello.
5. Затем доступ к нагрузки hello hello отработки отказа toostart фиксации из hello реплики виртуальной Машины.
6. Когда на первичном сайте снова станет доступной, необходимо инициировать tooreplicate обратная репликация из первичного toohello вторичного сайта hello. Обратная репликация приводит hello виртуальных машин в защищенное состояние, но hello вторичный центр обработки данных по-прежнему активное расположение hello.
7. toomake hello первичного сайта в активное расположение hello, инициируется плановую отработку отказа из вторичного tooprimary, следуют другой обратной репликации.


## <a name="next-steps"></a>Дальнейшие действия

- [Дополнительные сведения](site-recovery-hyper-v-azure-architecture.md) о рабочем процессе репликации hello Hyper-V.
- [Проверьте, соблюдены ли предварительные требования](site-recovery-prereq.md)
