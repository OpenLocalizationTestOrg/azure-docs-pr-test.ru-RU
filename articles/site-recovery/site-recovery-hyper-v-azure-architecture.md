---
title: "aaaHow работает Hyper-V репликации tooAzure в Site Recovery? | Документация Майкрософт"
description: "В этой статье описывается выполнение репликации Hyper-V с помощью службы Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: site-recovery-architecture-hyper-v-to-azure
ms.openlocfilehash: e982806b4d6cdec2f71f82d8c73c17cc50ad3c33
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-does-hyper-v-replication-tooazure-work"></a><span data-ttu-id="98249-104">Как работает tooAzure репликации Hyper-V?</span><span class="sxs-lookup"><span data-stu-id="98249-104">How does Hyper-V replication tooAzure work?</span></span>

<span data-ttu-id="98249-105">Чтение этой статьи toounderstand hello архитектуры и рабочие процессы для tooAzure репликации Hyper-V с помощью hello [Azure Site Recovery](site-recovery-overview.md) службы.</span><span class="sxs-lookup"><span data-stu-id="98249-105">Read this article toounderstand hello architecture and workflows for Hyper-V replication tooAzure using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="98249-106">Отправлять все комментарии hello нижней части этой статьи, или в hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="98249-106">Post any comments at hello bottom of this article, or in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="98249-107">Можно реплицировать hello следующие tooAzure:</span><span class="sxs-lookup"><span data-stu-id="98249-107">You can replicate hello following tooAzure:</span></span>
- <span data-ttu-id="98249-108">**Hyper-V с VMM.** Виртуальные машины, расположенные на локальных узлах Hyper-V, управляемых в облаках System Center Virtual Machine Manager (VMM).</span><span class="sxs-lookup"><span data-stu-id="98249-108">**Hyper-V with VMM**: VMs located on on-premises Hyper-V hosts managed in  System Center Virtual MAchine Manager (VMM) clouds.</span></span> <span data-ttu-id="98249-109">Узлы могут работать под управлением любой [поддерживаемой операционной системы](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span><span class="sxs-lookup"><span data-stu-id="98249-109">Hosts can be running any [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="98249-110">Вы можете реплицировать виртуальные машины Hyper-V, запущенные в любой операционной системе на виртуальной машине, [поддерживаемой Hyper-V и Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="98249-110">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>
- <span data-ttu-id="98249-111">**Hyper-V без VMM.** Локальные виртуальные машины, расположенные на узлах Hyper-V, которые не управляются в облаках VMM.</span><span class="sxs-lookup"><span data-stu-id="98249-111">**Hyper-V without VMM**: On-premises VMs located on Hyper-V hosts that aren't managed in VMM clouds.</span></span> <span data-ttu-id="98249-112">Узлы могут использовать любую из hello [поддерживаемые операционные системы](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span><span class="sxs-lookup"><span data-stu-id="98249-112">Hosts can run any of hello [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span></span> <span data-ttu-id="98249-113">Вы можете реплицировать виртуальные машины Hyper-V, запущенные в любой операционной системе на виртуальной машине, [поддерживаемой Hyper-V и Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="98249-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="98249-114">Компоненты архитектуры</span><span class="sxs-lookup"><span data-stu-id="98249-114">Architectural components</span></span>

<span data-ttu-id="98249-115">**Область**</span><span class="sxs-lookup"><span data-stu-id="98249-115">**Area**</span></span> | <span data-ttu-id="98249-116">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="98249-116">**Component**</span></span> | <span data-ttu-id="98249-117">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="98249-117">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="98249-118">**Таблицы Azure**</span><span class="sxs-lookup"><span data-stu-id="98249-118">**Azure**</span></span> | <span data-ttu-id="98249-119">В Azure вам требуется учетная запись Microsoft Azure, учетная запись хранения Azure и сеть Azure.</span><span class="sxs-lookup"><span data-stu-id="98249-119">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="98249-120">Учетные записи хранения и сети могут быть учетными записями Resource Manager или классическими.</span><span class="sxs-lookup"><span data-stu-id="98249-120">Storage and network can be Resource Manager-based, or classic accounts.</span></span><br/><br/> <span data-ttu-id="98249-121">Реплицированные данные хранятся в учетной записи хранения hello и виртуальных машинах Azure создаются с hello реплицированных данных, когда происходит переход на другой ресурс с веб-узла в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="98249-121">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="98249-122">Hello виртуальных машинах Azure подключиться toohello виртуальной сети Azure, когда они создаются.</span><span class="sxs-lookup"><span data-stu-id="98249-122">hello Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="98249-123">**Сервер VMM**</span><span class="sxs-lookup"><span data-stu-id="98249-123">**VMM server**</span></span> | <span data-ttu-id="98249-124">Узлы Hyper-V, расположенные в облаках VMM</span><span class="sxs-lookup"><span data-stu-id="98249-124">Hyper-V hosts located in VMM clouds</span></span> | <span data-ttu-id="98249-125">Если узлы Hyper-V управляются в облаках VMM, регистрации сервера VMM hello в hello в хранилище служб восстановления.</span><span class="sxs-lookup"><span data-stu-id="98249-125">If Hyper-V hosts are managed in VMM clouds, you register hello VMM server in hello Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="98249-126">На сервере VMM hello hello поставщика Site Recovery tooorchestrate репликации устанавливается с помощью Azure.</span><span class="sxs-lookup"><span data-stu-id="98249-126">On hello VMM server you install hello Site Recovery Provider tooorchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="98249-127">Потребуется логических и tooconfigure сетевое сопоставление настроить сети виртуальных Машин.</span><span class="sxs-lookup"><span data-stu-id="98249-127">You need logical and VM networks set up tooconfigure network mapping.</span></span> <span data-ttu-id="98249-128">Сеть виртуальной Машины должно быть связанного tooa логической сети, связанной с облаком hello.</span><span class="sxs-lookup"><span data-stu-id="98249-128">A VM network should be linked tooa logical network that's associated with hello cloud.</span></span>
<span data-ttu-id="98249-129">**Узел Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="98249-129">**Hyper-V host**</span></span> | <span data-ttu-id="98249-130">Серверы Hyper-V можно развернуть с помощью сервера VMM или без него.</span><span class="sxs-lookup"><span data-stu-id="98249-130">Hyper-V servers can be deployed with or without VMM server.</span></span> | <span data-ttu-id="98249-131">Если нет ни одного сервера VMM, hello поставщика Site Recovery на которых установлен hello узла tooorchestrate репликации с Site Recovery через hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="98249-131">If there's no VMM server, hello Site Recovery Provider is installed on hello host tooorchestrate replication with Site Recovery over hello internet.</span></span> <span data-ttu-id="98249-132">Если сервер VMM, hello поставщик установлен, а не на узле hello.</span><span class="sxs-lookup"><span data-stu-id="98249-132">If there's a VMM server, hello Provider is installed on it, and not on hello host.</span></span><br/><br/> <span data-ttu-id="98249-133">агент служб восстановления Hello устанавливается на репликацию данных toohandle hello узла.</span><span class="sxs-lookup"><span data-stu-id="98249-133">hello Recovery Services agent is installed on hello host toohandle data replication.</span></span><br/><br/> <span data-ttu-id="98249-134">Обмен данными между hello поставщика и агента hello защищен и зашифрован.</span><span class="sxs-lookup"><span data-stu-id="98249-134">Communications from both hello Provider and hello agent are secure and encrypted.</span></span> <span data-ttu-id="98249-135">Реплицированные данные в службе хранилища Azure также шифруются.</span><span class="sxs-lookup"><span data-stu-id="98249-135">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="98249-136">**Виртуальные машины Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="98249-136">**Hyper-V VMs**</span></span> | <span data-ttu-id="98249-137">Требуется один или несколько виртуальных машин на сервере узла Hyper-V hello.</span><span class="sxs-lookup"><span data-stu-id="98249-137">You need one or more VMs on hello Hyper-V host server.</span></span> | <span data-ttu-id="98249-138">Ничего не требуется tooexplicitly, установленных на виртуальных машинах</span><span class="sxs-lookup"><span data-stu-id="98249-138">Nothing needs tooexplicitly installed on VMs</span></span>

## <a name="deployment-steps"></a><span data-ttu-id="98249-139">Шаги по развертыванию</span><span class="sxs-lookup"><span data-stu-id="98249-139">Deployment steps</span></span>

1. <span data-ttu-id="98249-140">**Azure**: настройки hello компонентов Azure.</span><span class="sxs-lookup"><span data-stu-id="98249-140">**Azure**: You set up hello Azure components.</span></span> <span data-ttu-id="98249-141">Перед развертыванием Site Recovery мы рекомендуем настроить учетные записи хранения и сети.</span><span class="sxs-lookup"><span data-stu-id="98249-141">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span></span>
2. <span data-ttu-id="98249-142">**Хранилище.** Необходимо создать хранилище служб восстановления для Site Recovery и настроить параметры хранилища, в том числе параметры исходной и целевой среды, а также настроить политику репликации и включить репликацию.</span><span class="sxs-lookup"><span data-stu-id="98249-142">**Vault**: You create a Recovery Services vault for Site Recovery, and configure vault settings, including configuring source and target settings, setting up a replication policy, and enabling replication.</span></span>
3. <span data-ttu-id="98249-143">**Исходная и целевая среда.**</span><span class="sxs-lookup"><span data-stu-id="98249-143">**Source and target**:</span></span>
    - <span data-ttu-id="98249-144">**Узлы Hyper-V в облаках VMM**: В процессе определения параметров источника, загрузить и установить hello поставщика Azure Site Recovery на сервере VMM hello и hello агента служб восстановления Azure на каждом узле Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="98249-144">**Hyper-V hosts in VMM clouds**: As part of specifying source settings, you download and install hello Azure Site Recovery Provider on hello VMM server, and hello Azure Recovery Services agent on each Hyper-V host.</span></span> <span data-ttu-id="98249-145">Источник Hello будет hello сервера VMM.</span><span class="sxs-lookup"><span data-stu-id="98249-145">hello source will be hello VMM server.</span></span> <span data-ttu-id="98249-146">целевой объект Hello является Azure.</span><span class="sxs-lookup"><span data-stu-id="98249-146">hello target is Azure.</span></span>
    - <span data-ttu-id="98249-147">Узлы Hyper-V без VMM: при указании параметров источника загрузки и установки hello поставщика и агента на каждом узле Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="98249-147">Hyper-V hosts without VMM: When you specify source settings, you download and install hello Provider and agent on each Hyper-V host.</span></span> <span data-ttu-id="98249-148">При развертывании сбора hello узлы в узле Hyper-V и указать этот сайт в качестве источника hello.</span><span class="sxs-lookup"><span data-stu-id="98249-148">During deployment you gather hello hosts into a Hyper-V site, and specify this site as hello source.</span></span> <span data-ttu-id="98249-149">целевой объект Hello является Azure.</span><span class="sxs-lookup"><span data-stu-id="98249-149">hello target is Azure.</span></span>

    <span data-ttu-id="98249-150">![Репликация Hyper-V или VMM tooAzure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![tooAzure репликации узла Hyper-V](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span><span class="sxs-lookup"><span data-stu-id="98249-150">![Hyper-V/VMM replication tooAzure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V site replication tooAzure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span></span>


4. <span data-ttu-id="98249-151">**Политика репликации**: создайте политику репликации для сайта hello Hyper-V или облака VMM.</span><span class="sxs-lookup"><span data-stu-id="98249-151">**Replication policy**: You create a replication policy for hello Hyper-V site or VMM cloud.</span></span> <span data-ttu-id="98249-152">политика Hello — примененных tooall виртуальными машинами, размещенными на узлах, на сайте hello или в облаке.</span><span class="sxs-lookup"><span data-stu-id="98249-152">hello policy is applied tooall VMs located on hosts in hello site or cloud.</span></span>
5. <span data-ttu-id="98249-153">**Включение репликации.** Включите репликацию для виртуальных машин Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="98249-153">**Enable replication**: You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="98249-154">Начальная репликация выполняется в соответствии с параметрами политики репликации hello.</span><span class="sxs-lookup"><span data-stu-id="98249-154">Initial replication occurs in accordance with hello replication policy settings.</span></span> <span data-ttu-id="98249-155">Отслеживаются изменения данных и репликация tooAzure разностных изменений начинается после завершения первоначальной репликации hello.</span><span class="sxs-lookup"><span data-stu-id="98249-155">Data changes are tracked, and replication of delta changes tooAzure begins after hello initial replication finishes.</span></span> <span data-ttu-id="98249-156">Отслеживаемые изменения для элемента хранятся в HRL-файле.</span><span class="sxs-lookup"><span data-stu-id="98249-156">Tracked changes for an item are held in a .hrl file.</span></span>
6. <span data-ttu-id="98249-157">**Тестовая отработка отказа**: запустить тест отработки отказа toomake, убедиться, что все работает должным образом.</span><span class="sxs-lookup"><span data-stu-id="98249-157">**Test failover**:  You run a test failover toomake sure everything's working as expected.</span></span>

<span data-ttu-id="98249-158">Дополнительные сведения о развертывании см. в статьях, представленных ниже.</span><span class="sxs-lookup"><span data-stu-id="98249-158">Learn more about deployment:</span></span>
- [<span data-ttu-id="98249-159">Приступая к работе с tooAzure репликации виртуальных Машин Hyper-V - с помощью VMM</span><span class="sxs-lookup"><span data-stu-id="98249-159">Get started with Hyper-V VM replication tooAzure - with VMM</span></span>](site-recovery-vmm-to-azure.md)
- [<span data-ttu-id="98249-160">Приступая к работе с tooAzure репликации виртуальных Машин Hyper-V - без VMM</span><span class="sxs-lookup"><span data-stu-id="98249-160">Get started with Hyper-V VM replication tooAzure - without VMM</span></span>](site-recovery-hyper-v-site-to-azure.md)

## <a name="hyper-v-replication-workflow"></a><span data-ttu-id="98249-161">Рабочий процесс репликации Hyper-V</span><span class="sxs-lookup"><span data-stu-id="98249-161">Hyper-V replication workflow</span></span>

### <a name="enable-protection"></a><span data-ttu-id="98249-162">Включить защиту</span><span class="sxs-lookup"><span data-stu-id="98249-162">Enable protection</span></span>

1. <span data-ttu-id="98249-163">После включения защиты для виртуальной Машины Hyper-V в hello портала Azure или локально, hello **включить защиту** запускает.</span><span class="sxs-lookup"><span data-stu-id="98249-163">After you enable protection for a Hyper-V VM, in hello Azure portal or on-premises, hello **Enable protection** starts.</span></span>
2. <span data-ttu-id="98249-164">Hello задания проверяет, что компьютер, hello соответствует необходимым требованиям, перед вызовом hello [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), tooset репликации заданы параметры hello.</span><span class="sxs-lookup"><span data-stu-id="98249-164">hello job checks that hello machine complies with prerequisites, before invoking hello [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), tooset up replication with hello settings you've configured.</span></span>
3. <span data-ttu-id="98249-165">Hello задание запускается начальная репликация с помощью вызова hello [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) метод tooinitialize полной репликации виртуальной Машины и tooAzure виртуальные диски send hello Виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="98249-165">hello job starts initial replication by invoking hello [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) method, tooinitialize a full VM replication, and send hello VM's virtual disks tooAzure.</span></span>
4. <span data-ttu-id="98249-166">Вы можете отслеживать задания hello в hello **заданий** вкладки.      ![Список заданий](media/site-recovery-hyper-v-azure-architecture/image1.png)![Подробные сведения о включении защиты](media/site-recovery-hyper-v-azure-architecture/image2.png)</span><span class="sxs-lookup"><span data-stu-id="98249-166">You can monitor hello job in hello **Jobs** tab.      ![Jobs list](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Enable protection drill down](media/site-recovery-hyper-v-azure-architecture/image2.png)</span></span>

### <a name="initial-replication"></a><span data-ttu-id="98249-167">Начальная репликация</span><span class="sxs-lookup"><span data-stu-id="98249-167">Initial replication</span></span>

1. <span data-ttu-id="98249-168">При запуске начальной репликации создается [моментальный снимок виртуальной машины Hyper-V](https://technet.microsoft.com/library/dd560637.aspx).</span><span class="sxs-lookup"><span data-stu-id="98249-168">A [Hyper-V VM snapshot](https://technet.microsoft.com/library/dd560637.aspx) snapshot is taken when initial replication is triggered.</span></span>
2. <span data-ttu-id="98249-169">Виртуальные жесткие диски, реплицируемых по одному до они все скопированные tooAzure.</span><span class="sxs-lookup"><span data-stu-id="98249-169">Virtual hard disks are replicated one by one until they're all copied tooAzure.</span></span> <span data-ttu-id="98249-170">Он может занять некоторое время, в зависимости от hello размер виртуальной Машины и пропускной способности сети.</span><span class="sxs-lookup"><span data-stu-id="98249-170">It could take a while, depending on hello VM size, and network bandwidth.</span></span> <span data-ttu-id="98249-171">toooptimize использование вашей сети, в разделе [как toomanage локальной пропускной способности сети защиты tooAzure](https://support.microsoft.com/kb/3056159).</span><span class="sxs-lookup"><span data-stu-id="98249-171">toooptimize your network usage, see [How toomanage on-premises tooAzure protection network bandwidth usage](https://support.microsoft.com/kb/3056159).</span></span>
3. <span data-ttu-id="98249-172">В случае изменения диска во время начальной репликации hello отслеживания репликации реплика Hyper-V отслеживает эти изменения как журналы репликации Hyper-V (.hrl).</span><span class="sxs-lookup"><span data-stu-id="98249-172">If disk changes occur while initial replication is in progress, hello Hyper-V Replica Replication Tracker tracks those changes as Hyper-V Replication Logs (.hrl).</span></span> <span data-ttu-id="98249-173">Эти файлы расположены в hello же папке, что диски hello.</span><span class="sxs-lookup"><span data-stu-id="98249-173">These files are located in hello same folder as hello disks.</span></span> <span data-ttu-id="98249-174">Каждый диск имеет связанный .hrl файл, будут отправляться toosecondary хранилища.</span><span class="sxs-lookup"><span data-stu-id="98249-174">Each disk has an associated .hrl file that will be sent toosecondary storage.</span></span>
4. <span data-ttu-id="98249-175">файлы моментальных снимков и журналов Hello потребляют ресурсы диска, во время начальной репликации.</span><span class="sxs-lookup"><span data-stu-id="98249-175">hello snapshot and log files consume disk resources while initial replication is in progress.</span></span>
5. <span data-ttu-id="98249-176">После завершения начальной репликации hello, удаление снимка виртуальной Машины hello.</span><span class="sxs-lookup"><span data-stu-id="98249-176">When hello initial replication finishes, hello VM snapshot is deleted.</span></span> <span data-ttu-id="98249-177">Диск изменений в журнале hello, синхронизированным и объединенные toohello родительского диска.</span><span class="sxs-lookup"><span data-stu-id="98249-177">Delta disk changes in hello log are synchronized and merged toohello parent disk.</span></span>


### <a name="finalize-protection"></a><span data-ttu-id="98249-178">Завершение подготовки защиты</span><span class="sxs-lookup"><span data-stu-id="98249-178">Finalize protection</span></span>

1. <span data-ttu-id="98249-179">По завершении начальной репликации hello hello **завершить подготовку защиты на виртуальной машине hello** задания настроить сеть и другие параметры после репликации таким образом, чтобы hello виртуальная машина защищена.</span><span class="sxs-lookup"><span data-stu-id="98249-179">After hello initial replication finishes, hello **Finalize protection on hello virtual machine** job configures network and other post-replication settings, so that hello virtual machine is protected.</span></span>
    <span data-ttu-id="98249-180">![Задание завершения подготовки защиты](media/site-recovery-hyper-v-azure-architecture/image3.png)</span><span class="sxs-lookup"><span data-stu-id="98249-180">![Finalize protection job](media/site-recovery-hyper-v-azure-architecture/image3.png)</span></span>
2. <span data-ttu-id="98249-181">Если выполняется репликация tooAzure, может потребоваться tootweak hello параметры для hello виртуальной машины, чтобы она готова для отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="98249-181">If you're replicating tooAzure, you might need tootweak hello settings for hello virtual machine so that it's ready for failover.</span></span> <span data-ttu-id="98249-182">На этом этапе можно запустить toocheck отработки отказа теста, который все работает, как ожидалось.</span><span class="sxs-lookup"><span data-stu-id="98249-182">At this point you can run a test failover toocheck everything is working as expected.</span></span>

### <a name="delta-replication"></a><span data-ttu-id="98249-183">Разностная репликация данных</span><span class="sxs-lookup"><span data-stu-id="98249-183">Delta replication</span></span>

1. <span data-ttu-id="98249-184">После начальной репликации hello начинает разностной синхронизации, в соответствии с параметрами репликации.</span><span class="sxs-lookup"><span data-stu-id="98249-184">After hello initial replication, delta synchronization begins, in accordance with replication settings.</span></span>
2. <span data-ttu-id="98249-185">Hello отслеживания репликации реплика Hyper-V отслеживает файлы .hrl hello изменения tooa виртуального жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="98249-185">hello Hyper-V Replica Replication Tracker tracks hello changes tooa virtual hard disk as .hrl files.</span></span> <span data-ttu-id="98249-186">Для каждого диска, предназначенного для репликации, создается связанный HRL-файл.</span><span class="sxs-lookup"><span data-stu-id="98249-186">Each disk that's configured for replication has an associated .hrl file.</span></span> <span data-ttu-id="98249-187">Этот журнал отправляется toohello пользовательской учетной записи хранения, после завершения начальной репликации.</span><span class="sxs-lookup"><span data-stu-id="98249-187">This log is sent toohello customer's storage account after initial replication is complete.</span></span> <span data-ttu-id="98249-188">Если журнал транспорте tooAzure, в другой файл журнала, в hello отслеживаются изменения hello основной диск hello один каталог.</span><span class="sxs-lookup"><span data-stu-id="98249-188">When a log is in transit tooAzure, hello changes in hello primary disk are tracked in another log file, in hello same directory.</span></span>
3. <span data-ttu-id="98249-189">Во время начального и разностных репликации можно отслеживать hello виртуальной Машины в hello представление виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="98249-189">During initial and delta replication, you can monitor hello VM in hello VM view.</span></span> <span data-ttu-id="98249-190">[Подробнее](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="98249-190">[Learn more](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span></span>  

### <a name="replication-synchronization"></a><span data-ttu-id="98249-191">Синхронизация репликации</span><span class="sxs-lookup"><span data-stu-id="98249-191">Replication synchronization</span></span>

1. <span data-ttu-id="98249-192">Если происходит сбой дельта-репликации и для полной репликации необходима высокая пропускная способность или требуется много времени, тогда виртуальная машина помечается для повторной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="98249-192">If delta replication fails, and a full replication would be costly in terms of bandwidth or time, then a VM is marked for resynchronization.</span></span> <span data-ttu-id="98249-193">Например если файлы .hrl hello достигают 50% от размера диска hello, затем hello ВМ помечается для повторной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="98249-193">For example, if hello .hrl files reach 50% of hello disk size, then hello VM will be marked for resynchronization.</span></span>
2.  <span data-ttu-id="98249-194">Повторная синхронизация сводит к минимуму hello объем данных, посланных расчет контрольных сумм hello исходных и целевых виртуальных машин и отправка только hello дельта-данные.</span><span class="sxs-lookup"><span data-stu-id="98249-194">Resynchronization minimizes hello amount of data sent by computing checksums of hello source and target virtual machines, and sending only hello delta data.</span></span> <span data-ttu-id="98249-195">Повторная синхронизация использует алгоритм фрагментации, то есть разбивает исходный и целевой файлы на блоки фиксированного размера.</span><span class="sxs-lookup"><span data-stu-id="98249-195">Resynchronization uses a fixed-block chunking algorithm where source and target files are divided into fixed chunks.</span></span> <span data-ttu-id="98249-196">Контрольные суммы для каждого фрагмента данных создаются и затем сравнивается toodetermine, который блокирует hello источника необходимость toobe примененных toohello цели.</span><span class="sxs-lookup"><span data-stu-id="98249-196">Checksums for each chunk are generated and then compared toodetermine which blocks from hello source need toobe applied toohello target.</span></span>
3. <span data-ttu-id="98249-197">После завершения повторной синхронизации возобновляется обычная разностная репликация данных.</span><span class="sxs-lookup"><span data-stu-id="98249-197">After resynchronization finishes, normal delta replication should resume.</span></span> <span data-ttu-id="98249-198">По умолчанию повторная синхронизация является запланированных toorun автоматически вне времени office, но можно синхронизировать виртуальную машину вручную.</span><span class="sxs-lookup"><span data-stu-id="98249-198">By default resynchronization is scheduled toorun automatically outside office hours, but you can resynchronize a virtual machine manually.</span></span> <span data-ttu-id="98249-199">Например, в случае сбоя сети или другого сбоя повторную синхронизацию можно возобновить.</span><span class="sxs-lookup"><span data-stu-id="98249-199">For example, you can resume resynchronization if a network outage or another outage occurs.</span></span> <span data-ttu-id="98249-200">toodo это, выберите hello ВМ на портале hello > **повторной синхронизации**.</span><span class="sxs-lookup"><span data-stu-id="98249-200">toodo this, select hello VM in hello portal > **Resynchronize**.</span></span>

    ![Повторная синхронизация вручную](media/site-recovery-hyper-v-azure-architecture/image4.png)


### <a name="retries"></a><span data-ttu-id="98249-202">Повторы</span><span class="sxs-lookup"><span data-stu-id="98249-202">Retries</span></span>

<span data-ttu-id="98249-203">При ошибке репликации используется встроенный механизм повторных попыток.</span><span class="sxs-lookup"><span data-stu-id="98249-203">If a replication error occurs, there's a built-in retry.</span></span> <span data-ttu-id="98249-204">Этот алгоритм предполагает работу с двумя представленными ниже категориями ошибок.</span><span class="sxs-lookup"><span data-stu-id="98249-204">This logic can be classified into two categories:</span></span>

<span data-ttu-id="98249-205">**Категория**</span><span class="sxs-lookup"><span data-stu-id="98249-205">**Category**</span></span> | <span data-ttu-id="98249-206">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="98249-206">**Details**</span></span>
--- | ---
<span data-ttu-id="98249-207">**Неустранимые ошибки**</span><span class="sxs-lookup"><span data-stu-id="98249-207">**Non-recoverable errors**</span></span> | <span data-ttu-id="98249-208">Без повторных попыток.</span><span class="sxs-lookup"><span data-stu-id="98249-208">No retry is attempted.</span></span> <span data-ttu-id="98249-209">Состояние виртуальной машины отображается как **Критическое**, что требует вмешательства администратора.</span><span class="sxs-lookup"><span data-stu-id="98249-209">VM status will be **Critical**, and administrator intervention is required.</span></span> <span data-ttu-id="98249-210">Примеры этих ошибок: разрыв цепочки виртуальных жестких ДИСКОВ; Недопустимое состояние для hello реплики виртуальной Машины; Сетевые ошибки проверки подлинности: ошибки авторизации; Виртуальная машина не обнаружены ошибки (для изолированных серверов Hyper-V)</span><span class="sxs-lookup"><span data-stu-id="98249-210">Examples of these errors include: broken VHD chain; Invalid state for hello replica VM; Network authentication errors: authorization errors; VM not found errors (for standalone Hyper-V servers)</span></span>
<span data-ttu-id="98249-211">**Устранимые ошибки**</span><span class="sxs-lookup"><span data-stu-id="98249-211">**Recoverable errors**</span></span> | <span data-ttu-id="98249-212">Повторы выполняются каждый интервал репликации, с помощью экспоненциальной отсрочки, увеличивает интервал повтора hello от начала hello hello первой попытки, 1, 2, 4, 8 и 10 минут.</span><span class="sxs-lookup"><span data-stu-id="98249-212">Retries occur every replication interval, using an exponential back-off that increases hello retry interval from hello start of hello first attempt by 1, 2, 4, 8, and 10 minutes.</span></span> <span data-ttu-id="98249-213">Если проблема не устранена, повторные попытки выполняются каждые 30 минут.</span><span class="sxs-lookup"><span data-stu-id="98249-213">If an error persists, retry every 30 minutes.</span></span> <span data-ttu-id="98249-214">Примеры таких ошибок: сетевые ошибки, дефицит места на диске, нехватка памяти.</span><span class="sxs-lookup"><span data-stu-id="98249-214">Examples include: network errors; low disk  errors; low memory conditions</span></span> |

## <a name="protection-and-recovery-lifecycle"></a><span data-ttu-id="98249-215">Жизненный цикл защиты и восстановления</span><span class="sxs-lookup"><span data-stu-id="98249-215">Protection and recovery lifecycle</span></span>

![рабочий процесс](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

## <a name="next-steps"></a><span data-ttu-id="98249-217">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="98249-217">Next steps</span></span>

- [<span data-ttu-id="98249-218">Проверка предварительных условий для развертывания</span><span class="sxs-lookup"><span data-stu-id="98249-218">Check deployment prerequisites</span></span>](site-recovery-prereq.md)
- <span data-ttu-id="98249-219">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="98249-219">Troubleshoot with:</span></span>
    - [<span data-ttu-id="98249-220">Разделы о мониторинге и устранении неполадок защиты</span><span class="sxs-lookup"><span data-stu-id="98249-220">Monitor and troubleshoot protection</span></span>](site-recovery-monitoring-and-troubleshooting.md)
    - [<span data-ttu-id="98249-221">Служба технической поддержки Майкрософт</span><span class="sxs-lookup"><span data-stu-id="98249-221">Help from Microsoft support</span></span>](site-recovery-monitoring-and-troubleshooting.md#reach-out-for-microsoft-support)
    - [<span data-ttu-id="98249-222">Распространенные ошибки ASR и способы их устранения</span><span class="sxs-lookup"><span data-stu-id="98249-222">Common errors and resolutions</span></span>](site-recovery-monitoring-and-troubleshooting.md#common-azure-site-recovery-errors-and-their-resolutions)
