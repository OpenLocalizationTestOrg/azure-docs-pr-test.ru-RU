---
title: "отработка отказа aaaTest (VMM tooVMM) в Azure Site Recovery | Документы Microsoft"
description: "Azure Site Recovery координирует hello репликации, отработки отказа и восстановления виртуальных машин и физических серверов. Дополнительные сведения о tooAzure отработки отказа или вторичный центр обработки данных."
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 06/05/2017
ms.author: pratshar
ms.openlocfilehash: 6b4f65ab692cbb0665102c4f51ea0694151cd3ae
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="test-failover-vmm-toovmm-in-site-recovery"></a>Тестовая отработка отказа (VMM tooVMM) в компоненте восстановления сайта


В данной статье содержатся сведения и инструкции по тестовой отработке отказа или тренировке аварийного восстановления виртуальных машин и физических серверов, защищенных с помощью Azure Site Recovery С управлением System Center Virtual Machine Manager VMM на локальном сайте будет использоваться как hello восстановления сайта.

Запустить тест отработки отказа toovalidate стратегии репликации или выполнить детализация аварийного восстановления без потери данных или простоя. Тестовой отработки отказа не негативного влияния на выполняющуюся репликацию hello или на рабочую среду. Ее можно выполнять на виртуальной машине или в [плане восстановления](site-recovery-create-recovery-plans.md). Когда Запуск тестовой отработки отказа, вам нужно toospecify hello сети, к которой будет подключаться hello тестовые виртуальные машины. Можно отслеживать ход выполнения hello hello тестовой отработки отказа на hello **заданий** страницы.  

Если вы используете комментарии или вопросы, задайте их hello нижней части этой статьи, или на hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).


## <a name="prepare-hello-infrastructure-for-test-failover"></a>Подготовка инфраструктуры hello для тестовой отработки отказа
Если требуется toorun тестовую отработку отказа с использованием существующей сети, подготовьте Active Directory, DHCP и DNS в этой сети.

Требуется toorun тестовой отработки отказа с помощью сети виртуальных Машин toocreate параметр hello автоматически добавьте ручной шаг перед Group-1 в план восстановления hello ты toouse для тестовой отработки отказа hello. Затем добавьте hello инфраструктуры ресурсы toohello автоматически создается сети, прежде чем выполнить тестовую отработку отказа hello.

### <a name="things-toonote"></a>Toonote действия
При выполнении репликации tooa вторичного сайта, тип сети, что использует машины hello реплики не требуется тип hello toomatch логической сети, используемой для тестовой отработки отказа, но может не работать некоторые сочетания hello. Если реплика hello использует DHCP и изоляцию на основе виртуальной ЛС, hello сеть виртуальных Машин для реплики hello не требуется пул статических IP-адресов. С помощью виртуализации сети Windows для hello тестовой отработки отказа не будет работать, так как нет пулы адресов недоступны. 

Кроме того hello тестовой отработки отказа не будут работать при hello реплики сети используется без изоляции и hello тестовой сети использует виртуализацию сети Windows. Это объясняется hello без изоляции сети не требуется toocreate hello подсетей сети виртуализация сети Windows.

Как реплики виртуальных машин, подключенных toomapped сетей виртуальных Машин после отработки отказа зависит от того, как сеть виртуальной Машины hello настроена в консоли VMM hello.

#### <a name="vm-network-configured-with-no-isolation-or-vlan-isolation"></a>Сеть виртуальных машин настроенная без изоляции или с изоляцией виртуальной локальной сети
Если DHCP определен для сети виртуальной Машины hello, hello реплики виртуальной машины — подключенных toohello идентификатор виртуальной локальной сети через hello параметры, указанные для сетевого сайта hello в связанной логической сетью hello. Виртуальная машина Hello получает свой IP-адрес с hello доступных DHCP-сервера. 

Toodefine пул статических IP-адресов не требуется для hello целевой сети ВМ. При использовании статических IP-адресов для сети виртуальной Машины hello hello реплики виртуальной машины — подключенных toohello идентификатор виртуальной локальной сети через hello параметры, указанные для сетевого сайта hello в связанной логической сетью hello.

Виртуальная машина Hello получает свой IP-адрес из пула hello, которая определена для сети виртуальной Машины hello. Если в целевой сети ВМ hello не определен статический пул IP-адресов, произойдет сбой выделения IP-адресов. Создайте пул IP-адресов hello на обоих hello исходных и целевых серверах VMM, будет использоваться для защиты и восстановления.

#### <a name="vm-network-with-windows-network-virtualization"></a>Сеть виртуальных машин с виртуализацией сети Windows
Если сеть виртуальной Машины настроен с использованием виртуализации сети Windows, следует определить статический пул для hello целевой сети ВМ, независимо от того, hello исходную сеть виртуальных Машин настроенных toouse DHCP или пул статических IP-адресов. 

Если DHCP определен, целевой сервер VMM hello выступает в роли DHCP-сервера и предоставляет IP-адрес из пула hello, определенного для целевой сети ВМ hello. Если для исходного сервера hello определено использование статических IP-адресов, hello целевой сервер VMM выделяет IP-адрес из пула hello. Если пул статических IP-адресов не определен, то в обоих случаях выделение IP-адреса завершится ошибкой.


### <a name="prepare-dhcp"></a>Подготовка DHCP
Hello виртуальные машины, участвующие в тестовой отработки отказа используется протокол DHCP, создать тест DHCP-сервера в изолированной сети hello тестовой отработки отказа с целью hello.

### <a name="prepare-active-directory"></a>Подготовка Active Directory
toorun тестовую отработку отказа для тестирования приложений в тестовой среде нужна копия производственной среды Active Directory hello. Дополнительные сведения см. в статье hello [тестирование отработки отказа рекомендации для Active Directory](site-recovery-active-directory.md#test-failover-considerations).

### <a name="prepare-dns"></a>Подготовка DNS
Подготовьте DNS-сервер для тестовой отработки отказа hello следующим образом:

* **DHCP**: Если виртуальные машины используют DHCP, IP-адрес hello hello теста DNS должны обновляться на DHCP-сервере hello теста. Если вы используете сеть типа виртуализации сети Windows, сервер VMM hello действует как hello DHCP-сервера. Таким образом hello IP-адрес DNS должны обновляться в hello тестовой отработки отказа сети. В этом случае hello виртуальные машины регистрируются toohello соответствующем DNS-сервере.
* **Статический адрес**: Если виртуальные машины используют статические IP-адреса, hello IP-адрес DNS-сервера должны быть обновлены в тестовой отработки отказа сети теста hello. Может потребоваться tooupdate DNS с IP-адрес hello hello тестовые виртуальные машины. Можно использовать следующий пример скрипта для этой цели hello.

        Param(
        [string]$Zone,
        [string]$name,
        [string]$IP
        )
        $Record = Get-DnsServerResourceRecord -ZoneName $zone -Name $name
        $newrecord = $record.clone()
        $newrecord.RecordData[0].IPv4Address  =  $IP
        Set-DnsServerResourceRecord -zonename $zone -OldInputObject $record -NewInputObject $Newrecord



## <a name="run-a-test-failover"></a>Запуск тестовой отработки отказа
Эта процедура описывает, как toorun тестовую отработку отказа для восстановления плане. Кроме того, можно запустить hello отработку отказа для одной виртуальной машины на hello **виртуальные машины** вкладки.

![Колонка "Тестирование отработки отказа"](./media/site-recovery-test-failover-vmm-to-vmm/TestFailover.png)

1. Выберите **Планы восстановления** > *имя_плана_восстановления*. Последовательно выберите пункты **Тип отработки отказа** > **Test Тип отработки отказа**.
1. На hello **тестовой отработки отказа** колонки, указать, как виртуальные машины должны быть подключенных toonetworks после тестовой отработки отказа hello. Дополнительные сведения см. в разделе hello [параметры сетевой](#network-options-in-site-recovery).
1. Отслеживать ход аварийного переключения на hello **заданий** вкладки.
1. После завершения отработки отказа убедитесь, что hello виртуальные машины запускаются успешно.
1. Когда закончите, нажмите кнопку **очистку тестовой отработки отказа** hello плана восстановления. В **заметки**, записать и сохранить все наблюдения, связанные с тестовой отработки отказа hello. Этот шаг удаляет hello виртуальные машины и сети, которые были созданы во время тестовой отработки отказа.


## <a name="network-options-in-site-recovery"></a>Параметры сети в Site Recovery

При выполнении тестовой отработки отказа, появится сообщение с tooselect сетевые параметры для тестовых машин реплики. У вас есть несколько вариантов.  

| **Вариант тестовой отработки отказа** | **Описание** | **Проверки, выполняемые при отработке отказа** | **Дополнительные сведения** |
| --- | --- | --- | --- |
| **При сбое tooa вторичный сайт VMM — без сети** |Не нужно выбирать сеть виртуальных машин. |При отработке отказа выполняется проверка того, созданы ли тестовые машины.<br/><br/>Hello тестовая виртуальная машина создается на узле hello, где существует виртуальная машина реплики hello. Она не будет добавляться toohello облака, где находится виртуальная машина реплики hello. |<p>машина Hello отработка отказа не tooany подключенной сети.<br/><br/>Hello компьютер может быть tooa подключенной сети виртуальной Машины, после его создания. |
| **При сбое tooa вторичный сайт VMM — с сетью** |Необходимо выбрать существующую сеть виртуальных машин. |При отработке отказа выполняется проверка того, созданы ли виртуальные машины. |Hello тестовая виртуальная машина создается на узле hello, где существует виртуальная машина реплики hello. Она не будет добавляться toohello облака, где находится виртуальная машина реплики hello.<br/><br/>Создайте сеть виртуальных машин, которая будет изолирована от вашей рабочей сети.<br/><br/>Если вы используете сеть на основе виртуальной локальной сети, то рекомендуется создать в VMM отдельную логическую сеть (которая не будет применяться в рабочих целях). Эта логическая сеть является используется toocreate сетей виртуальных Машин для тестовой отработки отказа.<br/><br/>Hello логической сети должен быть связан по крайней мере одно hello сетевых адаптеров всех серверов Hyper-V hello, в которых размещаются виртуальные машины.<br/><br/>Для логических сетей VLAN hello сетевые сайты, добавления toohello логической сети должны быть изолированы.<br/><br/>При использовании логической сети на базе виртуализации сети Windows Azure Site Recovery автоматически создает изолированные сети виртуальных машин. |
| **Сбой по tooa вторичный сайт VMM — создание сети** |Временная тестовая сеть создается автоматически на основании приветствия, указываемое в **логической сети** и ее связанных сетевых сайтов. |При отработке отказа выполняется проверка того, созданы ли виртуальные машины. |Используйте этот параметр, если план восстановления hello использует несколько сетей виртуальной Машины. При использовании сетей Wnv этот параметр, можно автоматически создать сети виртуальных Машин с hello параметрами (подсетей и пулы IP-адресов) в сети hello hello реплики виртуальной машины. Сети виртуальных Машин будут автоматически удалены после завершения тестовой отработки отказа hello.</p><p>Hello тестовая виртуальная машина создается на узле hello, где существует виртуальная машина реплики hello. Она не будет добавляться toohello облака, где находится виртуальная машина реплики hello. |

> [!TIP]
> Hello заданное tooa виртуальной машины во время тестовой отработки отказа IP-адрес — hello же IP-адрес, который hello виртуальной машины получают при выполнении плановой или незапланированной отработки отказа (предполагается, что IP-адрес hello доступна в hello тестовой отработки отказа сети). Если hello одного IP-адреса не поддерживается в hello тестовой отработки отказа сети, виртуальная машина hello получает другой IP-адрес, который доступен в hello тестовой отработки отказа сети.
>
>


## <a name="test-failover-tooa-production-network-on-a-recovery-site"></a>Тестирование отработки отказа tooa рабочей сети на сайте восстановления
При выполнении тестовой отработки отказа советуем выбрать сеть, которая отличается от рабочей сети сайта восстановления, указанной в разделе параметров [Сетевое сопоставление](https://docs.microsoft.com/azure/site-recovery/site-recovery-network-mapping). Но если действительно toovalidate конца в конец сетевого подключения на виртуальной машине отработка отказа, обратите внимание hello после точки:

* Убедитесь, что основная виртуальная машина, hello завершает работу при выполнении тестовой отработки отказа hello. Если этого не сделать, две виртуальные машины с удостоверением будет выполняться в сетевых на hello hello hello же время. Такой ситуации может привести tooundesired последствия.
* Любые внесенные toohello тестовые отработки отказа виртуальные машины будут потеряны при очистке hello тестировании отработки отказа виртуальных машин. Эти изменения не реплицированных задней toohello основной виртуальной машины.
* Такой способ тестировании приводит toodowntime для производственного приложения. Попросите пользователей приложения hello не toouse, что выполняется приложение hello при детализации hello аварийного восстановления.  


## <a name="next-steps"></a>Дальнейшие действия
После успешного выполнения тестовой отработки отказа можно выполнить [фактическую отработку отказа](site-recovery-failover.md).
