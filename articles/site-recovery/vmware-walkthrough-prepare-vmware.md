---
title: "Подготовка локальных ресурсов VMware для репликации в Azure с помощью Azure Site Recovery | Документация Майкрософт"
description: "В этой статье кратко описаны шаги для репликации рабочих нагрузок, запущенных на виртуальных машинах VMware, в хранилище Azure"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 6aba0e89-ad7c-467e-9db2-cfb3bfe4c7d6
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 3e1c589030210c2eae1ad9c02811775d9d6365d4
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2017
---
# <a name="step-6-prepare-on-premises-vmware-replication-to-azure"></a><span data-ttu-id="2ee60-103">Шаг 6. Подготовка локальных ресурсов VMware для репликации в Azure</span><span class="sxs-lookup"><span data-stu-id="2ee60-103">Step 6: Prepare on-premises VMware replication to Azure</span></span>

<span data-ttu-id="2ee60-104">Используйте инструкции этой статьи, чтобы подготовить локальные серверы VMware к взаимодействию со службой Azure Site Recovery, а также подготовить виртуальные машины VMWare к установке службы Mobility Service.</span><span class="sxs-lookup"><span data-stu-id="2ee60-104">Use the instructions in this article to prepare on-premises VMware servers to interact with Azure Site Recovery, and prepare VMWare VMs for installation of the Mobility service.</span></span> <span data-ttu-id="2ee60-105">Служба Mobility Service должна быть установлена на всех локальных виртуальных машинах, которые реплицируются в Azure.</span><span class="sxs-lookup"><span data-stu-id="2ee60-105">The Mobility service agent must be installed on all on-premises VMs that you want to replicate to Azure.</span></span>

## <a name="prepare-for-automatic-discovery"></a><span data-ttu-id="2ee60-106">Подготовка для автоматического обнаружения</span><span class="sxs-lookup"><span data-stu-id="2ee60-106">Prepare for automatic discovery</span></span>

<span data-ttu-id="2ee60-107">Site Recovery автоматически обнаруживает виртуальные машины, выполняющиеся на узлах vSphere ESXi (с сервером vCenter или без него).</span><span class="sxs-lookup"><span data-stu-id="2ee60-107">Site Recovery automatically discovers VMs running on vSphere ESXi hosts (with or without a vCenter server).</span></span> <span data-ttu-id="2ee60-108">Для автоматического обнаружения Site Recovery требуется учетная запись, чтобы получить доступ к узлам и серверам:</span><span class="sxs-lookup"><span data-stu-id="2ee60-108">For automatic discovery, Site Recovery needs an account to access hosts and servers:</span></span>

1. <span data-ttu-id="2ee60-109">Чтобы использовать выделенную учетную запись, создайте роль на уровне vCenter с разрешениями, описанными в приведенной ниже таблице.</span><span class="sxs-lookup"><span data-stu-id="2ee60-109">To use a dedicated account, create a role (at the vCenter level, with the permissions described in the table below.</span></span> <span data-ttu-id="2ee60-110">Присвойте ей имя, например **Azure_Site_Recovery**.</span><span class="sxs-lookup"><span data-stu-id="2ee60-110">Give it a name such as **Azure_Site_Recovery**.</span></span>
2. <span data-ttu-id="2ee60-111">Создайте пользователя на узле vSphere или на сервере vCenter и назначьте ему роль.</span><span class="sxs-lookup"><span data-stu-id="2ee60-111">Then, create a user on the vSphere host/vCenter server, and assign the role to the user.</span></span> <span data-ttu-id="2ee60-112">Укажите эту учетную запись пользователя во время развертывания Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="2ee60-112">You specify this user account during Site Recovery deployment.</span></span>


### <a name="vmware-account-permissions"></a><span data-ttu-id="2ee60-113">Разрешения учетной записи VMware</span><span class="sxs-lookup"><span data-stu-id="2ee60-113">VMware account permissions</span></span>

<span data-ttu-id="2ee60-114">Службе Site Recovery нужен доступ к учетным записям VMware для отработки отказа и восстановления размещения, а также для автоматического обнаружения виртуальных машин на сервере обработки.</span><span class="sxs-lookup"><span data-stu-id="2ee60-114">Site Recovery needs access to VMware for the process server to automatically discover VMs, and for failover and failback of VMs.</span></span>

- <span data-ttu-id="2ee60-115">**Перенос** — если требуется только перенос виртуальных машин VMware в Azure (без восстановление размещения), можно использовать учетную запись VMware с ролью только для чтения.</span><span class="sxs-lookup"><span data-stu-id="2ee60-115">**Migrate**: If you only want to migrate VMware VMs to Azure, without ever failing them back, you can use a VMware account with a read-only role.</span></span> <span data-ttu-id="2ee60-116">Такая роль позволяет выполнять отработку отказа только без выключения исходных защищенных компьютеров.</span><span class="sxs-lookup"><span data-stu-id="2ee60-116">Such a role can run failover, but can't shut down protected source machines.</span></span> <span data-ttu-id="2ee60-117">Это не является обязательным для переноса.</span><span class="sxs-lookup"><span data-stu-id="2ee60-117">This isn't necessary for migration.</span></span>
- <span data-ttu-id="2ee60-118">**Репликация и восстановление** — если вы хотите развернуть полную репликацию (репликация, отработка отказа, восстановление размещения), учетная запись должна иметь возможность выполнять такие операции, как создание и удаление дисков, включение виртуальных машин и т. д.</span><span class="sxs-lookup"><span data-stu-id="2ee60-118">**Replicate/Recover**: If you want to deploy full replication (replicate, failover, failback) the account must be able to run operations such as creating and removing disks, powering on VMs etc.</span></span>
- <span data-ttu-id="2ee60-119">**Автоматическое обнаружение** — требуется по крайней мере учетная запись только для чтения.</span><span class="sxs-lookup"><span data-stu-id="2ee60-119">**Automatic discovery**: At least a read-only account is required.</span></span>


<span data-ttu-id="2ee60-120">**Задача.**</span><span class="sxs-lookup"><span data-stu-id="2ee60-120">**Task**</span></span> | <span data-ttu-id="2ee60-121">**Требуемая учетная запись или роль**</span><span class="sxs-lookup"><span data-stu-id="2ee60-121">**Required account/role**</span></span> | <span data-ttu-id="2ee60-122">**Разрешения**</span><span class="sxs-lookup"><span data-stu-id="2ee60-122">**Permissions**</span></span> | <span data-ttu-id="2ee60-123">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="2ee60-123">**Details**</span></span>
--- | --- | --- | ---
<span data-ttu-id="2ee60-124">**Сервер обработки автоматически обнаруживает виртуальные машины VMware**</span><span class="sxs-lookup"><span data-stu-id="2ee60-124">**Process server automatically discovers VMware VMs**</span></span> | <span data-ttu-id="2ee60-125">Потребуется по крайней мере пользователь только для чтения</span><span class="sxs-lookup"><span data-stu-id="2ee60-125">You need at least a read-only user</span></span> | <span data-ttu-id="2ee60-126">Объект центра обработки данных –> Распространение на дочерний объект, роль Read-only</span><span class="sxs-lookup"><span data-stu-id="2ee60-126">Data Center object –> Propagate to Child Object, role=Read-only</span></span> | <span data-ttu-id="2ee60-127">Пользователь назначается на уровне центра обработки данных и поэтому имеет доступ ко всем объектам в центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2ee60-127">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="2ee60-128">Если нужно ограничить доступ, назначьте дочерним объектам (узлы vSphere, хранилища данных, виртуальные машины и сети) роль **Без доступа** с параметром **Propagate to child** (Распространить на дочерний объект).</span><span class="sxs-lookup"><span data-stu-id="2ee60-128">To restrict access, assign the **No access** role with the **Propagate to child** object, to the child objects (vSphere hosts, datastores, VMs and networks).</span></span>
<span data-ttu-id="2ee60-129">**Тип отработки отказа**</span><span class="sxs-lookup"><span data-stu-id="2ee60-129">**Failover**</span></span> | <span data-ttu-id="2ee60-130">Потребуется по крайней мере пользователь только для чтения</span><span class="sxs-lookup"><span data-stu-id="2ee60-130">You need at least a read-only user</span></span> | <span data-ttu-id="2ee60-131">Объект центра обработки данных –> Распространение на дочерний объект, роль Read-only</span><span class="sxs-lookup"><span data-stu-id="2ee60-131">Data Center object –> Propagate to Child Object, role=Read-only</span></span> | <span data-ttu-id="2ee60-132">Пользователь назначается на уровне центра обработки данных и поэтому имеет доступ ко всем объектам в центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2ee60-132">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="2ee60-133">Если нужно ограничить доступ, назначьте дочерним объектам (узлы vSphere, хранилища данных, виртуальные машины и сети) роль **Без доступа** с параметром **Propagate to child** (Распространить на дочерний объект).</span><span class="sxs-lookup"><span data-stu-id="2ee60-133">To restrict access, assign the **No access** role with the **Propagate to child** object to the child objects (vSphere hosts, datastores, VMs and networks).</span></span><br/><br/> <span data-ttu-id="2ee60-134">Это полезно для сценария переноса, но не подходит для полной репликации, отработки отказа и восстановления размещения.</span><span class="sxs-lookup"><span data-stu-id="2ee60-134">Useful for migration purposes, but not full replication, failover, failback.</span></span>
<span data-ttu-id="2ee60-135">**Отработка отказа и восстановление размещения**</span><span class="sxs-lookup"><span data-stu-id="2ee60-135">**Failover and failback**</span></span> | <span data-ttu-id="2ee60-136">Мы рекомендуем создать роль VMware (Azure_Site_Recovery) с необходимыми разрешениями и назначить эту роль пользователю или группе VMware.</span><span class="sxs-lookup"><span data-stu-id="2ee60-136">We suggest you create a role (Azure_Site_Recovery) with the required permissions, and then assign the role to a VMware user or group</span></span> | <span data-ttu-id="2ee60-137">Объект центра обработки данных –> распространение на дочерний объект, роль Azure_Site_Recovery</span><span class="sxs-lookup"><span data-stu-id="2ee60-137">Data Center object –> Propagate to Child Object, role=Azure_Site_Recovery</span></span><br/><br/> <span data-ttu-id="2ee60-138">Хранилище данных -> выделение места, обзор хранилища данных, низкоуровневые операции с файлами, удаление файлов, обновление файлов виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="2ee60-138">Datastore -> Allocate space, browse datastore, low-level file operations, remove file, update virtual machine files</span></span><br/><br/> <span data-ttu-id="2ee60-139">Сеть -> Назначение сети</span><span class="sxs-lookup"><span data-stu-id="2ee60-139">Network -> Network assign</span></span><br/><br/> <span data-ttu-id="2ee60-140">Ресурс -> назначение виртуальной машины в пул ресурсов, миграция отключенной виртуальной машины, миграция включенной виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="2ee60-140">Resource -> Assign VM to resource pool, migrate powered off VM, migrate powered on VM</span></span><br/><br/> <span data-ttu-id="2ee60-141">Задачи -> Создание задач, Обновление задач</span><span class="sxs-lookup"><span data-stu-id="2ee60-141">Tasks -> Create task, update task</span></span><br/><br/> <span data-ttu-id="2ee60-142">Виртуальная машина -> конфигурация</span><span class="sxs-lookup"><span data-stu-id="2ee60-142">Virtual machine -> Configuration</span></span><br/><br/> <span data-ttu-id="2ee60-143">Виртуальная машина -> взаимодействие -> ответ на вопрос, подключение устройства, настройка компакт-диска носителя, настройка дискеты носителя, отключение, включение, установка средств VMware</span><span class="sxs-lookup"><span data-stu-id="2ee60-143">Virtual machine -> Interact -> answer question, device connection, configure CD media, configure floppy media, power off, power on, VMware tools install</span></span><br/><br/> <span data-ttu-id="2ee60-144">Виртуальная машина -> инвентаризация -> создание, регистрация, отмена регистрации</span><span class="sxs-lookup"><span data-stu-id="2ee60-144">Virtual machine -> Inventory -> Create, register, unregister</span></span><br/><br/> <span data-ttu-id="2ee60-145">Виртуальная машина -> подготовка -> разрешение загрузки виртуальной машины, разрешение отправки файлов виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="2ee60-145">Virtual machine -> Provisioning -> Allow virtual machine download, allow virtual machine files upload</span></span><br/><br/> <span data-ttu-id="2ee60-146">виртуальная машина -> моментальные снимки -> удаление моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="2ee60-146">Virtual machine -> Snapshots -> Remove snapshots</span></span> | <span data-ttu-id="2ee60-147">Пользователь назначается на уровне центра обработки данных и поэтому имеет доступ ко всем объектам в центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2ee60-147">User assigned at datacenter level, and has access to all the objects in the datacenter.</span></span><br/><br/> <span data-ttu-id="2ee60-148">Если нужно ограничить доступ, назначьте дочерним объектам (узлы vSphere, хранилища данных, виртуальные машины и сети) роль **Без доступа** с параметром **Propagate to child** (Распространить на дочерний объект).</span><span class="sxs-lookup"><span data-stu-id="2ee60-148">To restrict access, assign the **No access** role with the **Propagate to child** object, to the child objects (vSphere hosts, datastores, VMs and networks).</span></span>


## <a name="prepare-for-push-installation-of-the-mobility-service"></a><span data-ttu-id="2ee60-149">Подготовка к принудительной установке службы Mobility Service</span><span class="sxs-lookup"><span data-stu-id="2ee60-149">Prepare for push installation of the Mobility service</span></span>

<span data-ttu-id="2ee60-150">Служба Mobility Service должна быть установлена на всех виртуальных машинах, которые нужно реплицировать.</span><span class="sxs-lookup"><span data-stu-id="2ee60-150">The Mobility service must be installed on all VMs you want to replicate.</span></span> <span data-ttu-id="2ee60-151">Существует несколько способов установки службы, включая установку вручную, принудительную установку с сервера обработки Site Recovery и установку с использованием специальных методов, например с помощью System Center Configuration Manager.</span><span class="sxs-lookup"><span data-stu-id="2ee60-151">There are a number of ways to install the service, including manual installation, push installation from the Site Recovery process server, and installation using methods such as System Center Configuration Manager.</span></span>

<span data-ttu-id="2ee60-152">Для применения принудительной установки необходимо подготовить учетную запись, которую Site Recovery сможет использовать для доступа к виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="2ee60-152">If you want to use push installation, you need to prepare an account that Site Recovery can use to access the VM.</span></span>

- <span data-ttu-id="2ee60-153">Можно использовать доменную или локальную учетную запись.</span><span class="sxs-lookup"><span data-stu-id="2ee60-153">You can use a domain or local account</span></span>
- <span data-ttu-id="2ee60-154">Для Windows, если учетная запись домена не используется, на локальном компьютере потребуется отключить контроль удаленного доступа пользователей.</span><span class="sxs-lookup"><span data-stu-id="2ee60-154">For Windows, if you're not using a domain account, you need to disable Remote User Access control on the local machine.</span></span> <span data-ttu-id="2ee60-155">Для этого в разделе реестра **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System** добавьте запись **LocalAccountTokenFilterPolicy** DWORD и задайте для нее значение 1.</span><span class="sxs-lookup"><span data-stu-id="2ee60-155">To do this, in the register under **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System**, add the DWORD entry **LocalAccountTokenFilterPolicy**, with a value of 1.</span></span>
- <span data-ttu-id="2ee60-156">Если требуется добавить запись в реестр Windows из командной строки, введите: ``REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1.``</span><span class="sxs-lookup"><span data-stu-id="2ee60-156">If you want to add the registry entry for Windows from a CLI, type:       ``REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1.``</span></span>
- <span data-ttu-id="2ee60-157">Для Linux учетная запись должна принадлежать привилегированному пользователю на исходном сервере Linux.</span><span class="sxs-lookup"><span data-stu-id="2ee60-157">For Linux, the account should be root on the source Linux server.</span></span>



## <a name="next-steps"></a><span data-ttu-id="2ee60-158">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="2ee60-158">Next steps</span></span>

<span data-ttu-id="2ee60-159">Перейдите к статье [Шаг 7. Настройка хранилища для репликации Hyper-V](vmware-walkthrough-create-vault.md).</span><span class="sxs-lookup"><span data-stu-id="2ee60-159">Go to [Step 7: Create a vault](vmware-walkthrough-create-vault.md)</span></span>
