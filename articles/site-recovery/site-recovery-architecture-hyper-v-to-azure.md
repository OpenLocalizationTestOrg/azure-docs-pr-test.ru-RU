---
title: "Как в Azure Site Recovery работает репликация Hyper-V в Azure? | Документация Майкрософт"
description: "В этой статье представлен обзор компонентов и архитектуры, используемых при репликации виртуальных машин Hyper-V из локальной среды в Azure с помощью службы Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/23/2017
ms.author: raynew
ms.openlocfilehash: 28f775afaf72b11eec0c22f755e4dbd6a485c895
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="how-does-hyper-v-replication-to-azure-work-in-site-recovery"></a><span data-ttu-id="a6c08-104">Как в Site Recovery работает репликация Hyper-V в Azure?</span><span class="sxs-lookup"><span data-stu-id="a6c08-104">How does Hyper-V replication to Azure work in Site Recovery?</span></span>


<span data-ttu-id="a6c08-105">В этой статье описываются компоненты и процессы, задействованные при репликации виртуальных машин Hyper-V из локальной среды в Azure с помощью службы [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a6c08-105">This article describes the components and processes involved when replicating on-premises Hyper-V virtual machines, to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="a6c08-106">Служба Site Recovery может реплицировать виртуальные машины Hyper-V в кластерах Hyper-V и на изолированных узлах, которые управляются с помощью компонента System Center Virtual Machine Manager (VMM) или без него.</span><span class="sxs-lookup"><span data-stu-id="a6c08-106">Site Recovery can replicate Hyper-V VMs on Hyper-V clusters and standalone hosts that are managed with or without System Center Virtual Machine Manager (VMM).</span></span>

<span data-ttu-id="a6c08-107">Комментарии можно добавить в конце этой статьи или на [форуме по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="a6c08-107">Post any comments at the bottom of this article, or in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>



## <a name="architectural-components"></a><span data-ttu-id="a6c08-108">Компоненты архитектуры</span><span class="sxs-lookup"><span data-stu-id="a6c08-108">Architectural components</span></span>

<span data-ttu-id="a6c08-109">В репликации виртуальных машин Hyper-V в Azure задействовано несколько компонентов.</span><span class="sxs-lookup"><span data-stu-id="a6c08-109">There are a number of components involved when replicating Hyper-V VMs to Azure.</span></span>

<span data-ttu-id="a6c08-110">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="a6c08-110">**Component**</span></span> | <span data-ttu-id="a6c08-111">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="a6c08-111">**Location**</span></span> | <span data-ttu-id="a6c08-112">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="a6c08-112">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="a6c08-113">**Таблицы Azure**</span><span class="sxs-lookup"><span data-stu-id="a6c08-113">**Azure**</span></span> | <span data-ttu-id="a6c08-114">В Azure вам требуется учетная запись Microsoft Azure, учетная запись хранения Azure и сеть Azure.</span><span class="sxs-lookup"><span data-stu-id="a6c08-114">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="a6c08-115">Реплицированные данные хранятся в учетной записи хранения, а виртуальные машины Azure создаются с использованием реплицированных данных при отработке отказа с локального сайта.</span><span class="sxs-lookup"><span data-stu-id="a6c08-115">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="a6c08-116">При создании виртуальные машины Azure подключаются к виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="a6c08-116">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="a6c08-117">**Сервер VMM**</span><span class="sxs-lookup"><span data-stu-id="a6c08-117">**VMM server**</span></span> | <span data-ttu-id="a6c08-118">Узлы Hyper-V, расположенные в облаках VMM</span><span class="sxs-lookup"><span data-stu-id="a6c08-118">Hyper-V hosts are located in VMM clouds</span></span> | <span data-ttu-id="a6c08-119">Если управление узлами Hyper-V осуществляется в облаках VMM, сервер VMM необходимо зарегистрировать в хранилище служб восстановления.</span><span class="sxs-lookup"><span data-stu-id="a6c08-119">If Hyper-V hosts are managed in VMM clouds, you register the VMM server in the Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="a6c08-120">Установите поставщик Site Recovery на сервере VMM, чтобы управлять репликацией с помощью Azure.</span><span class="sxs-lookup"><span data-stu-id="a6c08-120">On the VMM server you install the Site Recovery Provider to orchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="a6c08-121">Необходимо настроить логические сети и сети виртуальных машин для настройки сетевого сопоставления.</span><span class="sxs-lookup"><span data-stu-id="a6c08-121">You need logical and VM networks set up to configure network mapping.</span></span> <span data-ttu-id="a6c08-122">Сеть виртуальных машин должна быть связана с логической сетью, которая сопоставлена с облаком.</span><span class="sxs-lookup"><span data-stu-id="a6c08-122">A VM network should be linked to a logical network that's associated with the cloud.</span></span>
<span data-ttu-id="a6c08-123">**Узел Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="a6c08-123">**Hyper-V host**</span></span> | <span data-ttu-id="a6c08-124">Узлы и кластеры Hyper-V можно развернуть с помощью сервера VMM или без него.</span><span class="sxs-lookup"><span data-stu-id="a6c08-124">Hyper-V hosts and clusters can be deployed with or without VMM server.</span></span> | <span data-ttu-id="a6c08-125">Если сервера VMM нет, поставщик Site Recovery устанавливается на узле, чтобы управлять репликацией с помощью Site Recovery через Интернет.</span><span class="sxs-lookup"><span data-stu-id="a6c08-125">If there's no VMM server, the Site Recovery Provider is installed on the host to orchestrate replication with Site Recovery over the internet.</span></span> <span data-ttu-id="a6c08-126">При наличии сервера VMM поставщик устанавливается не на узле, а на нем.</span><span class="sxs-lookup"><span data-stu-id="a6c08-126">If there's a VMM server, the Provider is installed on it, and not on the host.</span></span><br/><br/> <span data-ttu-id="a6c08-127">Агент служб восстановления устанавливается на узле для выполнения репликации данных.</span><span class="sxs-lookup"><span data-stu-id="a6c08-127">The Recovery Services agent is installed on the host to handle data replication.</span></span><br/><br/> <span data-ttu-id="a6c08-128">Обмен данными между поставщиком и агентом осуществляется по защищенным и зашифрованным каналам.</span><span class="sxs-lookup"><span data-stu-id="a6c08-128">Communications from both the Provider and the agent are secure and encrypted.</span></span> <span data-ttu-id="a6c08-129">Реплицированные данные в службе хранилища Azure также шифруются.</span><span class="sxs-lookup"><span data-stu-id="a6c08-129">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="a6c08-130">**Виртуальные машины Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="a6c08-130">**Hyper-V VMs**</span></span> | <span data-ttu-id="a6c08-131">На сервере узла Hyper-V должна быть запущена хотя бы одна виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="a6c08-131">You need one or more VMs running on a Hyper-V host server.</span></span> | <span data-ttu-id="a6c08-132">На виртуальных машинах не нужно ничего устанавливать явным образом.</span><span class="sxs-lookup"><span data-stu-id="a6c08-132">Nothing needs to explicitly installed on VMs.</span></span>

<span data-ttu-id="a6c08-133">Дополнительные сведения о необходимых компонентах развертывания и требованиях к каждому компоненту см. в [таблице поддержки](site-recovery-support-matrix-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="a6c08-133">Learn about the deployment prerequisites and requirements for each of these components in the [support matrix](site-recovery-support-matrix-to-azure.md).</span></span>

<span data-ttu-id="a6c08-134">**Рис. 1. Репликация с сайта Hyper-V в Azure**</span><span class="sxs-lookup"><span data-stu-id="a6c08-134">**Figure 1: Hyper-V site to Azure replication**</span></span>

![Компоненты](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)

<span data-ttu-id="a6c08-136">**Рис. 2. Репликация Hyper-V из облаков VMM в Azure**</span><span class="sxs-lookup"><span data-stu-id="a6c08-136">**Figure 2: Hyper-V in VMM clouds to Azure replication**</span></span>

![Компоненты](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png)


## <a name="replication-process"></a><span data-ttu-id="a6c08-138">Процесс репликации</span><span class="sxs-lookup"><span data-stu-id="a6c08-138">Replication process</span></span>

<span data-ttu-id="a6c08-139">**Рис. 3. Репликация и восстановление в ходе репликации Hyper-V в Azure**</span><span class="sxs-lookup"><span data-stu-id="a6c08-139">**Figure 3: Replication and recovery process for Hyper-V replication to Azure**</span></span>

![рабочий процесс](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

### <a name="enable-protection"></a><span data-ttu-id="a6c08-141">Включить защиту</span><span class="sxs-lookup"><span data-stu-id="a6c08-141">Enable protection</span></span>

1. <span data-ttu-id="a6c08-142">После включения защиты для виртуальных машин Hyper-V на портале Azure или локально запустится рабочий процесс **Включение защиты**.</span><span class="sxs-lookup"><span data-stu-id="a6c08-142">After you enable protection for a Hyper-V VM, in the Azure portal or on-premises, the **Enable protection** starts.</span></span>
2. <span data-ttu-id="a6c08-143">Это задание проверяет, соответствует ли компьютер необходимым требованиям перед вызовом метода [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), который настраивает репликацию, используя определенные вами параметры.</span><span class="sxs-lookup"><span data-stu-id="a6c08-143">The job checks that the machine complies with prerequisites, before invoking the [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), to set up replication with the settings you've configured.</span></span>
3. <span data-ttu-id="a6c08-144">Задание запускает начальную репликацию, вызывая метод [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx), чтобы инициализировать полную репликацию виртуальной машины и отправить ее виртуальные диски в Azure.</span><span class="sxs-lookup"><span data-stu-id="a6c08-144">The job starts initial replication by invoking the [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) method, to initialize a full VM replication, and send the VM's virtual disks to Azure.</span></span>
4. <span data-ttu-id="a6c08-145">На вкладке **Задания** можно отслеживать ход выполнения задания.</span><span class="sxs-lookup"><span data-stu-id="a6c08-145">You can monitor the job in the **Jobs** tab.</span></span>
        <span data-ttu-id="a6c08-146">![Список заданий](media/site-recovery-hyper-v-azure-architecture/image1.png)![Подробные сведения о включении защиты](media/site-recovery-hyper-v-azure-architecture/image2.png)</span><span class="sxs-lookup"><span data-stu-id="a6c08-146">![Jobs list](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Enable protection drill down](media/site-recovery-hyper-v-azure-architecture/image2.png)</span></span>

### <a name="replicate-the-initial-data"></a><span data-ttu-id="a6c08-147">Репликация исходных данных</span><span class="sxs-lookup"><span data-stu-id="a6c08-147">Replicate the initial data</span></span>

1. <span data-ttu-id="a6c08-148">При запуске начальной репликации создается [моментальный снимок виртуальной машины Hyper-V](https://technet.microsoft.com/library/dd560637.aspx).</span><span class="sxs-lookup"><span data-stu-id="a6c08-148">A [Hyper-V VM snapshot](https://technet.microsoft.com/library/dd560637.aspx) snapshot is taken when initial replication is triggered.</span></span>
2. <span data-ttu-id="a6c08-149">Виртуальные жесткие диски реплицируются по одному, пока все они не будут скопированы в Azure.</span><span class="sxs-lookup"><span data-stu-id="a6c08-149">Virtual hard disks are replicated one by one until they're all copied to Azure.</span></span> <span data-ttu-id="a6c08-150">В зависимости от размера виртуальной машины и пропускной способности сети это может занять некоторое время.</span><span class="sxs-lookup"><span data-stu-id="a6c08-150">It could take a while, depending on the VM size, and network bandwidth.</span></span> <span data-ttu-id="a6c08-151">Инструкции по оптимизации использования сети см. в статье [Как уменьшить нагрузку на сеть при защите между локальной средой и Azure](https://support.microsoft.com/kb/3056159).</span><span class="sxs-lookup"><span data-stu-id="a6c08-151">To optimize your network usage, see [How to manage on-premises to Azure protection network bandwidth usage](https://support.microsoft.com/kb/3056159).</span></span>
3. <span data-ttu-id="a6c08-152">В случае возникновения изменений на диске при выполнении начальной репликации модуль отслеживания репликации реплики Hyper-V регистрирует их в журналах репликации Hyper-V (HRL),</span><span class="sxs-lookup"><span data-stu-id="a6c08-152">If disk changes occur while initial replication is in progress, the Hyper-V Replica Replication Tracker tracks those changes as Hyper-V Replication Logs (.hrl).</span></span> <span data-ttu-id="a6c08-153">которые находятся в папке с дисками.</span><span class="sxs-lookup"><span data-stu-id="a6c08-153">These files are located in the same folder as the disks.</span></span> <span data-ttu-id="a6c08-154">С каждым диском связан HRL-файл, который отправляется в дополнительное хранилище.</span><span class="sxs-lookup"><span data-stu-id="a6c08-154">Each disk has an associated .hrl file that will be sent to secondary storage.</span></span>
4. <span data-ttu-id="a6c08-155">При начальной репликации файлы моментальных снимков и журналов потребляют ресурсы диска.</span><span class="sxs-lookup"><span data-stu-id="a6c08-155">The snapshot and log files consume disk resources while initial replication is in progress.</span></span>
5. <span data-ttu-id="a6c08-156">После завершения начальной репликации моментальный снимок виртуальной машины удаляется.</span><span class="sxs-lookup"><span data-stu-id="a6c08-156">When the initial replication finishes, the VM snapshot is deleted.</span></span> <span data-ttu-id="a6c08-157">Разностные изменения на диске в журнале синхронизируются и объединяются в родительском диске.</span><span class="sxs-lookup"><span data-stu-id="a6c08-157">Delta disk changes in the log are synchronized and merged to the parent disk.</span></span>


### <a name="finalize-protection"></a><span data-ttu-id="a6c08-158">Завершение подготовки защиты</span><span class="sxs-lookup"><span data-stu-id="a6c08-158">Finalize protection</span></span>

1. <span data-ttu-id="a6c08-159">После завершения начальной репликации задание **Завершить подготовку защиты на виртуальной машине** настраивает сеть и другие параметры для защиты виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a6c08-159">After the initial replication finishes, the **Finalize protection on the virtual machine** job configures network and other post-replication settings, so that the virtual machine is protected.</span></span>
    <span data-ttu-id="a6c08-160">![Задание завершения подготовки защиты](media/site-recovery-hyper-v-azure-architecture/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a6c08-160">![Finalize protection job](media/site-recovery-hyper-v-azure-architecture/image3.png)</span></span>
2. <span data-ttu-id="a6c08-161">При репликации в Azure может потребоваться настроить параметры виртуальной машины для обеспечения готовности к отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="a6c08-161">If you're replicating to Azure, you might need to tweak the settings for the virtual machine so that it's ready for failover.</span></span> <span data-ttu-id="a6c08-162">На этом этапе можно выполнить тестовую отработку отказа, чтобы убедиться, что все работает правильно.</span><span class="sxs-lookup"><span data-stu-id="a6c08-162">At this point you can run a test failover to check everything is working as expected.</span></span>

### <a name="replicate-the-delta"></a><span data-ttu-id="a6c08-163">Репликация изменений</span><span class="sxs-lookup"><span data-stu-id="a6c08-163">Replicate the delta</span></span>

1. <span data-ttu-id="a6c08-164">После начальной репликации начинается синхронизация изменений в соответствии с параметрами репликации.</span><span class="sxs-lookup"><span data-stu-id="a6c08-164">After the initial replication, delta synchronization begins, in accordance with replication settings.</span></span>
2. <span data-ttu-id="a6c08-165">Модуль отслеживания репликации реплики Hyper-V отслеживает изменения и передает их виртуальному жесткому диску в качестве HRL-файлов.</span><span class="sxs-lookup"><span data-stu-id="a6c08-165">The Hyper-V Replica Replication Tracker tracks the changes to a virtual hard disk as .hrl files.</span></span> <span data-ttu-id="a6c08-166">Для каждого диска, предназначенного для репликации, создается связанный HRL-файл.</span><span class="sxs-lookup"><span data-stu-id="a6c08-166">Each disk that's configured for replication has an associated .hrl file.</span></span> <span data-ttu-id="a6c08-167">Эти журналы передаются в пользовательскую учетную запись хранения после завершения начальной репликации.</span><span class="sxs-lookup"><span data-stu-id="a6c08-167">This log is sent to the customer's storage account after initial replication is complete.</span></span> <span data-ttu-id="a6c08-168">При передаче журнала в Azure изменения на основном диске фиксируются в дополнительном журнале, который размещается в том же каталоге.</span><span class="sxs-lookup"><span data-stu-id="a6c08-168">When a log is in transit to Azure, the changes in the primary disk are tracked in another log file, in the same directory.</span></span>
3. <span data-ttu-id="a6c08-169">Во время начальной и разностной репликаций вы можете отслеживать состояние виртуальной машины в ее представлении.</span><span class="sxs-lookup"><span data-stu-id="a6c08-169">During initial and delta replication, you can monitor the VM in the VM view.</span></span> <span data-ttu-id="a6c08-170">[Подробнее](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="a6c08-170">[Learn more](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span></span>  

### <a name="synchronize-replication"></a><span data-ttu-id="a6c08-171">Синхронизация репликации</span><span class="sxs-lookup"><span data-stu-id="a6c08-171">Synchronize replication</span></span>

1. <span data-ttu-id="a6c08-172">Если происходит сбой дельта-репликации и для полной репликации необходима высокая пропускная способность или требуется много времени, тогда виртуальная машина помечается для повторной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="a6c08-172">If delta replication fails, and a full replication would be costly in terms of bandwidth or time, then a VM is marked for resynchronization.</span></span> <span data-ttu-id="a6c08-173">Например, когда HRL-файлы заполняют до 50 % объема диска, виртуальная машина отмечается для повторной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="a6c08-173">For example, if the .hrl files reach 50% of the disk size, then the VM will be marked for resynchronization.</span></span>
2.  <span data-ttu-id="a6c08-174">Повторная синхронизация минимизирует объем передаваемых данных. Для этого вычисляются контрольные суммы исходной и целевой виртуальной машины, а затем отправляются только отличающиеся данные.</span><span class="sxs-lookup"><span data-stu-id="a6c08-174">Resynchronization minimizes the amount of data sent by computing checksums of the source and target virtual machines, and sending only the delta data.</span></span> <span data-ttu-id="a6c08-175">Повторная синхронизация использует алгоритм фрагментации, то есть разбивает исходный и целевой файлы на блоки фиксированного размера.</span><span class="sxs-lookup"><span data-stu-id="a6c08-175">Resynchronization uses a fixed-block chunking algorithm where source and target files are divided into fixed chunks.</span></span> <span data-ttu-id="a6c08-176">Для каждого фрагмента данных создаются контрольные суммы, сравнение которых позволяет определить, какие из блоков нужно передать от источника к целевому объекту.</span><span class="sxs-lookup"><span data-stu-id="a6c08-176">Checksums for each chunk are generated and then compared to determine which blocks from the source need to be applied to the target.</span></span>
3. <span data-ttu-id="a6c08-177">После завершения повторной синхронизации возобновляется обычная разностная репликация данных.</span><span class="sxs-lookup"><span data-stu-id="a6c08-177">After resynchronization finishes, normal delta replication should resume.</span></span> <span data-ttu-id="a6c08-178">По умолчанию повторная синхронизация автоматически выполняется в нерабочее время. Повторную синхронизацию виртуальной машины можно выполнить вручную.</span><span class="sxs-lookup"><span data-stu-id="a6c08-178">By default resynchronization is scheduled to run automatically outside office hours, but you can resynchronize a virtual machine manually.</span></span> <span data-ttu-id="a6c08-179">Например, в случае сбоя сети или другого сбоя повторную синхронизацию можно возобновить.</span><span class="sxs-lookup"><span data-stu-id="a6c08-179">For example, you can resume resynchronization if a network outage or another outage occurs.</span></span> <span data-ttu-id="a6c08-180">Чтобы сделать это, выберите виртуальную машину на портале и щелкните **Повторная синхронизация**.</span><span class="sxs-lookup"><span data-stu-id="a6c08-180">To do this, select the VM in the portal > **Resynchronize**.</span></span>

    ![Повторная синхронизация вручную](media/site-recovery-hyper-v-azure-architecture/image4.png)


### <a name="retry-logic"></a><span data-ttu-id="a6c08-182">Логика повторных попыток</span><span class="sxs-lookup"><span data-stu-id="a6c08-182">Retry logic</span></span>

<span data-ttu-id="a6c08-183">При ошибке репликации используется встроенный механизм повторных попыток.</span><span class="sxs-lookup"><span data-stu-id="a6c08-183">If a replication error occurs, there's a built-in retry.</span></span> <span data-ttu-id="a6c08-184">Этот алгоритм предполагает работу с двумя представленными ниже категориями ошибок.</span><span class="sxs-lookup"><span data-stu-id="a6c08-184">This logic can be classified into two categories:</span></span>

<span data-ttu-id="a6c08-185">**Категория**</span><span class="sxs-lookup"><span data-stu-id="a6c08-185">**Category**</span></span> | <span data-ttu-id="a6c08-186">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="a6c08-186">**Details**</span></span>
--- | ---
<span data-ttu-id="a6c08-187">**Неустранимые ошибки**</span><span class="sxs-lookup"><span data-stu-id="a6c08-187">**Non-recoverable errors**</span></span> | <span data-ttu-id="a6c08-188">Без повторных попыток.</span><span class="sxs-lookup"><span data-stu-id="a6c08-188">No retry is attempted.</span></span> <span data-ttu-id="a6c08-189">Состояние виртуальной машины отображается как **Критическое**, что требует вмешательства администратора.</span><span class="sxs-lookup"><span data-stu-id="a6c08-189">VM status will be **Critical**, and administrator intervention is required.</span></span> <span data-ttu-id="a6c08-190">Это может быть обусловлено неисправной цепочкой виртуальных жестких дисков, недопустимым состоянием реплики виртуальной машины, ошибками аутентификации сети (ошибками авторизации), ошибками "Не найдено" для виртуальной машины (для отдельных серверов Hyper-V).</span><span class="sxs-lookup"><span data-stu-id="a6c08-190">Examples of these errors include: broken VHD chain; Invalid state for the replica VM; Network authentication errors: authorization errors; VM not found errors (for standalone Hyper-V servers)</span></span>
<span data-ttu-id="a6c08-191">**Устранимые ошибки**</span><span class="sxs-lookup"><span data-stu-id="a6c08-191">**Recoverable errors**</span></span> | <span data-ttu-id="a6c08-192">Повторные попытки выполняются в рамках каждого интервала репликации с использованием экспоненциального алгоритма отсрочки, то есть каждая следующая попытка выполняется с большей задержкой (1, 2, 4, 8 и 10 минут).</span><span class="sxs-lookup"><span data-stu-id="a6c08-192">Retries occur every replication interval, using an exponential back-off that increases the retry interval from the start of the first attempt by 1, 2, 4, 8, and 10 minutes.</span></span> <span data-ttu-id="a6c08-193">Если проблема не устранена, повторные попытки выполняются каждые 30 минут.</span><span class="sxs-lookup"><span data-stu-id="a6c08-193">If an error persists, retry every 30 minutes.</span></span> <span data-ttu-id="a6c08-194">Примеры таких ошибок: сетевые ошибки, дефицит места на диске, нехватка памяти.</span><span class="sxs-lookup"><span data-stu-id="a6c08-194">Examples include: network errors; low disk  errors; low memory conditions</span></span> |



## <a name="failover-and-failback-process"></a><span data-ttu-id="a6c08-195">Процесс отработки отказа и восстановления размещения</span><span class="sxs-lookup"><span data-stu-id="a6c08-195">Failover and failback process</span></span>

1. <span data-ttu-id="a6c08-196">Вы можете запустить плановую или внеплановую [отработку отказа](site-recovery-failover.md) с локальных виртуальных машин Hyper-V в Azure.</span><span class="sxs-lookup"><span data-stu-id="a6c08-196">You can run a planned or unplanned [failover](site-recovery-failover.md) from on-premises Hyper-V VMs to Azure.</span></span> <span data-ttu-id="a6c08-197">Чтобы не допустить потери данных при выполнении плановой отработки отказа, выключите исходные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="a6c08-197">If you run a planned failover, then source VMs are shut down to ensure no data loss.</span></span>
2. <span data-ttu-id="a6c08-198">Вы можете выполнить отработку отказа одного компьютера или создать [планы восстановления](site-recovery-create-recovery-plans.md) для координации отработки отказа нескольких компьютеров.</span><span class="sxs-lookup"><span data-stu-id="a6c08-198">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md) to orchestrate failover of multiple machines.</span></span>
4. <span data-ttu-id="a6c08-199">После запуска отработки отказа в Azure должны отобразиться созданные виртуальные машины реплик.</span><span class="sxs-lookup"><span data-stu-id="a6c08-199">After you run the failover, you should be able to see the created replica VMs in Azure.</span></span> <span data-ttu-id="a6c08-200">При необходимости виртуальной машине можно назначить общедоступный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="a6c08-200">You can assign a public IP address to the VM if required.</span></span>
5. <span data-ttu-id="a6c08-201">Затем необходимо зафиксировать отработку отказа для получения доступа к рабочей нагрузке из виртуальной машины реплики Azure.</span><span class="sxs-lookup"><span data-stu-id="a6c08-201">You then commit the failover to start accessing the workload from the replica Azure VM.</span></span>
6. <span data-ttu-id="a6c08-202">Когда основной локальный сайт снова станет доступным, вы сможете выполнить [восстановление размещения](site-recovery-failback-from-azure-to-hyper-v.md).</span><span class="sxs-lookup"><span data-stu-id="a6c08-202">When your primary on-premises site is available again, you can [fail back](site-recovery-failback-from-azure-to-hyper-v.md).</span></span> <span data-ttu-id="a6c08-203">Запустите плановую отработку отказа из Azure на основной сайт.</span><span class="sxs-lookup"><span data-stu-id="a6c08-203">You kick off a planned failover from Azure to the primary site.</span></span> <span data-ttu-id="a6c08-204">Для плановой отработки отказа можно выбрать восстановление размещения на ту же самую виртуальную машину или в другое расположение и синхронизировать изменения между Azure и локальным расположением, чтобы предотвратить потерю данных.</span><span class="sxs-lookup"><span data-stu-id="a6c08-204">For a planned failover you can select to failback to the same VM or to an alternate location, and synchronize changes between Azure and on-premises, to ensure no data loss.</span></span> <span data-ttu-id="a6c08-205">Если виртуальные машины создаются локально, необходимо зафиксировать отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="a6c08-205">When VMs are created on-premises, you commit the failover.</span></span>




## <a name="next-steps"></a><span data-ttu-id="a6c08-206">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a6c08-206">Next steps</span></span>

<span data-ttu-id="a6c08-207">См. [таблицу поддержки](site-recovery-support-matrix-to-azure.md)</span><span class="sxs-lookup"><span data-stu-id="a6c08-207">Review the [support matrix](site-recovery-support-matrix-to-azure.md)</span></span>
