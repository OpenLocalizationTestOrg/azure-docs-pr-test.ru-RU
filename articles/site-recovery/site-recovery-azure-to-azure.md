---
title: "Репликация виртуальных машин Azure между регионами Azure (из Azure в Azure) в целях аварийного восстановления | Документация Майкрософт"
description: "В этой статье кратко описаны шаги для репликации виртуальных машин Azure между регионами Azure (из Azure в Azure) с помощью службы Azure Site Recovery в целях аварийного восстановления."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmon
editor: 
ms.assetid: dab98aa5-9c41-4475-b7dc-2e07ab1cfd18
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/10/2017
ms.author: raynew
ms.openlocfilehash: 9ca33057f6030fdcc233f6053fdc392d62f8f9f4
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="replicate-azure-vms-between-regions-with-azure-site-recovery"></a>Репликация виртуальных машин Azure между регионами с помощью Azure Site Recovery

>[!NOTE]
>
> Репликация Azure Site Recovery для виртуальных машин Azure сейчас доступна в предварительной версии.

В этой статье описано, как выполнить репликацию виртуальных машин Azure между регионами Azure с помощью службы [Site Recovery](site-recovery-overview.md) на портале Azure.

Комментарии или вопросы можно добавить в конце этой статьи или на [форуме по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).

## <a name="disaster-recovery-in-azure"></a>Аварийное восстановление в Azure

Встроенные возможности и функции инфраструктуры Azure формируют надежные и устойчивые стратегии доступности для рабочих нагрузок, выполняемых на виртуальных машинах Azure. Однако существует множество причин, почему вам может потребоваться спланировать аварийное восстановление между регионами Azure самостоятельно:

- Нужно обеспечить соответствие рекомендациям для конкретных приложений и рабочих нагрузок, требующих реализации стратегии непрерывности бизнес-процессов и аварийного восстановления (BCDR).
- Необходимо иметь возможность защищать и восстанавливать виртуальные машины Azure на основе бизнес-решений, а не только на основе встроенной функциональности Azure.
- Нужно выполнить тестовою отработку отказа и тестовое восстановление в соответствии с бизнес-требованиями и требованиями соответствию стандартам, не влияя на производство.
- Вам нужно выполнить отработку отказа в регионе восстановления в случае аварии и восстановить размещение в исходном регионе источника.

Чтобы выполнить все эти действия, используйте Site Recovery для репликации виртуальных машин из Azure в Azure.


## <a name="why-use-site-recovery"></a>Зачем использовать Site Recovery?      

Site Recovery предоставляет простой способ репликации виртуальных машин Azure между регионами.

- **Автоматическое развертывание**. В отличии от модели репликации в режиме "активный — активный" в дополнительном регионе нет необходимости приобретать дорогостоящую и сложную инфраструктуру. При включении репликации Site Recovery автоматически создает требуемые ресурсы в целевом регионе на основе параметров региона источника.
- **Управление регионами**. С помощью Site Recovery можно выполнить репликацию из любого региона в другой в рамках континента. Сравните это с геоизбыточным хранилищем с доступом для чтения, которое выполняет асинхронную репликацию только между стандартными [парами регионов](https://docs.microsoft.com/azure/best-practices-availability-paired-regions). Геоизбыточное хранилище с доступом для чтения предоставляет доступ только для чтения данных в целевом регионе.
- **Автоматическая репликация**. Site Recovery предоставляет автоматическую непрерывную репликацию. Отработку отказа и восстановление размещения можно активировать одним щелчком мыши.
- **RTO и RPO**. Site Recovery использует преимущества инфраструктуры сети Azure, которая обеспечивает подключение между регионами, чтобы поддерживать очень низкие показатели RTO и RPO.
- **Тестирование**. Вы можете выполнять отработку аварийного восстановления с тестовой отработкой отказа по запросу по мере необходимости, не влияя на производственные рабочие нагрузки или текущую репликацию.
- **Планы восстановления**. Используйте планы восстановления для оркестрации отработки отказа и восстановления размещения всего приложения, работающего на нескольких виртуальных машинах. Функция плана восстановления имеет широкие возможности первоклассной интеграции с модулями Runbook службы автоматизации Azure.


## <a name="deployment-summary"></a>Сводка по развертыванию

Ниже приведен перечень действий, которые необходимо выполнить для настройки репликации виртуальных машин между регионами Azure.

1. Создайте хранилище служб восстановления, которое содержит параметры конфигурации и управляет репликацией.
2. Включите репликацию виртуальных машин Azure.
3. Запустите тестовую отработку отказа, чтобы убедиться в надлежащей работе всех компонентов.

>[!IMPORTANT]
>
> Вы можете просмотреть сведения о [матрице поддержки для репликации виртуальных машин Azure](./site-recovery-support-matrix-azure-to-azure.md).

>[!IMPORTANT]
>
> Сведения о настройке обязательных исходящих сетевых подключений для репликации виртуальных машин Azure с помощью Site Recovery см. в статье [Руководство по организации сети для репликации виртуальных машин Azure](./site-recovery-azure-to-azure-networking-guidance.md).

### <a name="before-you-start"></a>Перед началом работы

* Учетная запись пользователя Azure должна содержать определенные [разрешения](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines) для включения репликации виртуальной машины Azure.
* Чтобы создать виртуальные машины Azure в целевом расположении, которое планируется использовать в качестве региона аварийного восстановления, необходимо настроить подписку. Свяжитесь со службой поддержки, чтобы включить необходимые квоты.

## <a name="create-a-recovery-services-vault"></a>Создание хранилища служб восстановления

[!INCLUDE [site-recovery-create-vault](../../includes/site-recovery-create-vault.md)]

>[!NOTE]
>
> Советуем создавать хранилище служб восстановления в расположении, куда вы хотите реплицировать ваши виртуальные машины. Например, если целевое расположение центральная часть США, создайте хранилище в **центральной части США**.

## <a name="enable-replication"></a>Включение репликации

Щелкните имя хранилища в **хранилище служб восстановления**. В хранилище нажмите кнопку **+Replicate** (+Репликация).

### <a name="step-1-configure-the-source"></a>Шаг 1. Настройка источника
1. В поле **Источник** выберите **Azure Preview**.
2. В поле **Исходное расположение** выберите исходный регион Azure, в котором сейчас запущены виртуальные машины.
3. Выберите модель развертывания виртуальных машин: **Диспетчер ресурсов** или **Классическая**.
4. Выберите **исходную группу ресурсов** для виртуальных машин диспетчера ресурсов или **облачную службу** для классических виртуальных машин.

    ![Настройка источника](./media/site-recovery-azure-to-azure/source.png)

### <a name="step-2-select-virtual-machines"></a>Шаг 2. Выбор виртуальных машин

* Выберите виртуальную машину, которую необходимо реплицировать и нажмите кнопку **ОК**.

    ![Выбор виртуальных машин](./media/site-recovery-azure-to-azure/vms.png)

### <a name="step-3-configure-settings"></a>Шаг 3. Настройка параметров

1. Чтобы переопределить стандартные целевые параметры и указать собственные, щелкните **Настройка**. Дополнительные сведения см. в разделе [Настройка целевых ресурсов](site-recovery-replicate-azure-to-azure.md##customize-target-resources).

    ![Настройка параметров](./media/site-recovery-azure-to-azure/settings.png)


2. По умолчанию Site Recovery создает политику репликации, которая выполняет моментальные снимки с согласованием каждые 4 часа и хранит точки восстановления 24 часа. Чтобы создать политику с различными параметрами, щелкните **Настройка** рядом с **политикой репликации**.

    ![Настройка политики](./media/site-recovery-azure-to-azure/customize-policy.png)

3. Чтобы начать подготовку целевых ресурсов, щелкните **Create target resources** (Создать целевые ресурсы). Подготовка занимает несколько минут. Не закрывайте колонки во время подготовки, в противном случае нужно будет начать все сначала.

4. Чтобы запустить репликацию выбранной виртуальной машины, щелкните **Включить репликацию**.

5. Ход выполнения задания **включения защиты** можно отслеживать, выбрав **Параметры** > **Задания** > **Site Recovery Jobs** (Задания Site Recovery).

6. Выберите **Параметры** > **Реплицированные элементы**, чтобы просмотреть состояние виртуальных машин и ход выполнения начальной репликации. Выберите виртуальную машину, чтобы просмотреть ее параметры.

## <a name="run-a-test-failover"></a>Запуск тестовой отработки отказа

Когда настройка будет завершена, запустите тестовую отработку отказа, чтобы убедиться в надлежащей работе всех компонентов.

1. Чтобы выполнить отработку отказа для одного компьютера, в разделе **Параметры** > **Реплицированные элементы** щелкните виртуальную машину, а затем — значок **+Test Failover** (+Тестовая отработка отказа).

2. Чтобы выполнить отработку отказа по плану восстановления, в разделе **Параметры** > **Планы восстановления** щелкните план правой кнопкой мыши и выберите **Тестовая отработка отказа**. Чтобы создать план восстановления, [выполните эти инструкции](site-recovery-create-recovery-plans.md). 

3. В разделе **Тестовая отработка отказа** выберите целевую виртуальную сеть Azure, к которой будут подключаться виртуальные машины Azure после отработки отказа.

4. Нажмите кнопку **ОК**, чтобы начать отработку отказа. За ходом выполнения можно следить в окне свойств, которое можно открыть, щелкнув виртуальную машину. Или щелкните в имени хранилища задание **Тестовая отработка отказа** > **Параметры** > **Задания** > **Site Recovery Jobs** (Задания Site Recovery).

5. После завершения отработки отказа реплика виртуальной машины Azure отображается на портале Azure на вкладке **Виртуальные машины**. Убедитесь, что виртуальная машина имеет соответствующий размер, подключена к соответствующей сети и работает.

6. Чтобы удалить виртуальные машины, созданные во время тестовой отработки отказа, щелкните **Cleanup test failover** (Очистить тестовою отработку) в реплицируемом элементе или в плане восстановления. В разделе **Примечания** можно записать и сохранить любые замечания, связанные с тестовой отработкой отказа. 

[Узнайте больше](site-recovery-test-failover-to-azure.md) о выполнении тестовой отработки отказа.


## <a name="next-steps"></a>Дальнейшие действия

После тестирования развертывания:

- [Узнайте больше](site-recovery-failover.md) о разных типах отработки отказа и способах их выполнения.
- Узнайте больше об [использовании планов восстановления](site-recovery-create-recovery-plans.md), чтобы снизить значение RTO.
