---
title: "Планировщик развертывания Azure Site Recovery для развертывания виртуальных машин Hyper-V в Azure | Документация Майкрософт"
description: "В этой статье приведены рекомендации по использованию планировщика развертывания Azure Site Recovery при развертывании виртуальных машин Hyper-V в Azure."
services: site-recovery
documentationcenter: 
author: nsoneji
manager: garavd
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 12/02/2017
ms.author: nisoneji
ms.openlocfilehash: 0baf595266e71fad2df16996d63af3ba7d23a6ac
ms.sourcegitcommit: 176c575aea7602682afd6214880aad0be6167c52
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/09/2018
---
# <a name="azure-site-recovery-deployment-planner-for-hyper-v-to-azure"></a>Планировщик развертывания Azure Site Recovery для развертывания виртуальных машин Hyper-V в Azure
В этой статье приведены рекомендации по использованию планировщика развертывания Azure Site Recovery при рабочем развертывании виртуальных машин Hyper-V в Azure.

## <a name="overview"></a>Обзор
Перед установкой защиты виртуальных машин Hyper-V с помощью Site Recovery выделите достаточный объем пропускной способности в зависимости от частоты ежедневного изменения данных в соответствии с требуемой целевой точкой восстановления (RPO) и выделите достаточной пространство для хранения в каждом томе локального хранилища Hyper-V.

Кроме того, необходимо создать требуемое количество целевых учетных записей хранения Azure соответствующего типа (класса Standard или Premium), учитывая рост нагрузки на исходные рабочие серверы из-за более активного их использования в будущем. Тип хранилища определяется для каждой виртуальной машины на основе особенностей рабочей нагрузки (количества операций записи и чтения на диск в секунду, активности обработки данных) и ограничений Azure Site Recovery. 

Планировщик развертывания Azure Site Recovery — это программа командной строки для сценариев аварийного восстановления виртуальных машин Hyper-V в Azure и VMware в Azure. Эта программа позволяет выполнить удаленное профилирование виртуальных машин Hyper-V на нескольких узлах Hyper-V (никоим образом не влияя на рабочий процесс), чтобы оценить требования к пропускной способности и службе хранилища Azure для успешной репликации и тестовой или рабочей отработки отказа. Чтобы запустить эту программу, в локальной среде не требуется устанавливать дополнительные компоненты Azure Site Recovery. Чтобы получить точные показатели достигнутой пропускной способности, рекомендуем запустить планировщик на сервере Windows Server с такой же конфигурацией оборудования, что на одном из серверов Hyper-V, которые будут использоваться для защиты при помощи аварийного восстановления в Azure. 

Эта программа предоставляет указанные ниже сведения.

**Оценка совместимости**

* Оценка совместимости виртуальной машины в зависимости от количества дисков, их размера, числа операций ввода-вывода в секунду, активности обработки данных и некоторых характеристик виртуальной машины.

**Оценка пропускной способности сети и целевой точки восстановления**

* Расчетное значение пропускной способности, необходимой для разностной репликации.
* Пропускная способность, которую может получить Azure Site Recovery при репликации данных из локальной среды в Azure.
* Целевая точка восстановления, которая может быть достигнута при указанной пропускной способности.
* Влияние низкой пропускной способности на требуемую целевую точку восстановления.

    
**Требования к инфраструктуре Azure**

* Требование к типу хранилища (хранилище класса Standard или Premium) каждой виртуальной машины.
* Общее число учетных записей хранения уровня Standard или Premium, которое необходимо настроить для репликации.
* Именование учетных записей хранения в соответствии с рекомендациями к службе хранилища Azure.
* Размещение учетной записи хранения каждой виртуальной машины.
* Число ядер Azure, которое необходимо настроить перед отработкой отказа или тестовой отработкой отказа, на подписку.
* Рекомендуемый размер виртуальной машины Azure для каждой локальной виртуальной машины.

**Требования к локальной инфраструктуре**
* Обеспечьте пространство хранения в каждом томе хранилища Hyper-V для успешной начальной и разностной репликации. Это позволит избежать нежелательных простоев при репликации виртуальных машин.
* Максимальная частота копирования, которая будет установлена для репликации Hyper-V.

**Рекомендации по пакетной обработке для начальной репликации:** 
* количество пакетов виртуальных машин, которые будут использоваться для защиты;
* список виртуальных машин в каждом пакете;
* порядок защиты пакетов;
* предполагаемое время выполнения начальной репликации для каждого пакета.

**Оценочные затраты на аварийное восстановление в Azure:**
* оценочные общие затраты на аварийное восстановление в Azure: затраты на вычисление, хранение, сети и лицензии Azure Site Recovery;
* подробный анализ затрат для каждой виртуальной машины.



>[!IMPORTANT]
>
>При выполнении вычислений в программе использовался 30-процентный коэффициент роста характеристик рабочей нагрузки (из-за возможного роста использования со временем) и 95-й процентиль всех метрик профилирования (число операций записи и чтения в секунду, активность обработки данных и т. д.). Оба эти элемента (коэффициент роста и используемый процентиль) можно изменить. Дополнительные сведения о коэффициенте роста и используемом процентиле см. в разделе "Рекомендации по коэффициенту роста" и "Значение процентиля, используемое для вычисления".
>

## <a name="support-matrix"></a>Матрица поддержки

| | **VMware в VMware** |**Hyper-V в Azure**|**Из Azure в Azure**|**Из Hyper-V на дополнительный сайт**|**Из VMware на дополнительный сайт**
--|--|--|--|--|--
Поддерживаемые сценарии использования. |Yes|Yes|Нет |Да*|Нет 
Поддерживаемая версия | vCenter 6.5, 6.0 или 5.5| Windows Server 2016, Windows Server 2012 R2 | Нет данных |Windows Server 2016, Windows Server 2012 R2|Нет данных
Поддерживаемая конфигурация|vCenter, ESXi| Кластер Hyper-V, узел Hyper-V|Нет данных|Кластер Hyper-V, узел Hyper-V|Нет данных|
Число серверов, которые можно профилировать для каждого запущенного экземпляра планировщика развертывания Azure Site Recovery. |Один (одновременно можно профилировать виртуальные машины на одном сервере vCenter Server или ESXi)|Несколько (одновременно можно профилировать виртуальные машины на нескольких узлах или кластерах узлов)| Нет данных |Несколько (одновременно можно профилировать виртуальные машины на нескольких узлах или кластерах узлов)| Нет данных

*Это средство в первую очередь предназначено для сценария аварийного восстановления виртуальных машин Hyper-V в Azure. При аварийном восстановлении виртуальных машин Hyper-V на вторичный сайт это средство может использоваться только для того, чтобы получить рекомендации на стороне источника, такие как необходимая пропускная способность сети, требуемое свободное место на каждом исходном сервере Hyper-V, а также количество необходимых операций пакетной обработки и определения пакетов для начальной репликации.  Пропустите рекомендации и сведения о затратах на Azure в отчете. Кроме того, операция оценки пропускной способности не применяется в сценариях аварийного восстановления виртуальных машин Hyper-V на вторичный сайт.

## <a name="prerequisites"></a>Необходимые компоненты
Планирование развертывания Hyper-V при помощи программы состоит из трех основных этапов: получение списка виртуальных машин, профилирование и создание отчетов. С помощью этой программы также можно оценить пропускную способность. В следующей таблице представлены требования к серверу, на котором выполняются различные этапы обработки.

| Требование к серверу | ОПИСАНИЕ |
|---|---|
|Получение списка виртуальных машин, профилирование и оценка пропускной способности |<ul><li>Операционная система: Microsoft Windows Server 2016 или Microsoft Windows Server 2012 R2 </li><li>Конфигурация виртуальной машины: 8 виртуальных ЦП, 16 ГБ ОЗУ, жесткий диск емкостью 300 ГБ.</li><li>[Microsoft .NET Framework 4.5](https://aka.ms/dotnet-framework-45)</li><li>[Распространяемый компонент Microsoft Visual C++ для Visual Studio 2012](https://aka.ms/vcplusplus-redistributable).</li><li>Интернет-доступ к Azure с этого сервера.</li><li>Учетная запись хранения Azure.</li><li>Права администратора на доступ к серверу.</li><li>Минимальное свободное место на диске: 100 ГБ (предполагается, что профилирование 1000 виртуальных машин в среднем с 3 дисками на каждую выполняется 30 дней).</li><li>Виртуальную машину, на которой выполняется планировщик развертывания Azure Site Recovery, необходимо добавить в список TrustedHosts для всех серверов Hyper-V.</li><li>Все виртуальные машины Hyper-V для профилирования нужно добавить в список TrustedHosts на клиентской виртуальной машине, где запущена программа. [Дополнительные сведения о добавлении серверов в список TrustedHosts](#steps-to-add-servers-into-trustedhosts-list). </li><li> Программу следует запускать с правами администратора из PowerShell или консоли командной строки в клиенте.</ul></ul>|
| Создание отчетов. | Любой компьютер с Windows или Windows Server с Microsoft Excel 2013 или более поздней версии. |
| Разрешения пользователя | Учетная запись администратора для доступа к кластеру или узлу Hyper-V при получении списка виртуальных машин и профилировании.<br>В учетных записях администратора домена для всех узлов, которые необходимо профилировать, должны использоваться одни и те же учетные данные, т. е. имя пользователя и пароль.
 |

## <a name="steps-to-add-servers-into-trustedhosts-list"></a>Инструкции по добавлению серверов в список TrustedHosts
1.  Все узлы, которые необходимо профилировать, должны быть указаны в списке TrustedHosts для виртуальной машины, на которой будет развертываться программа. Чтобы добавить клиент в список Trustedhosts, выполните указанную ниже команду в сеансе PowerShell с повышенными привилегиями на виртуальной машине. На виртуальной машине можно использовать ОС Windows Server 2012 R2 или Windows Server 2016. 

            set-item wsman:\localhost\Client\TrustedHosts -value <ComputerName>[,<ComputerName>]

2.  Для каждого узла Hyper-V, который необходимо профилировать, необходимо:

    a. Указать виртуальную машину, на которой будет выполняться программа, в списке TrustedHosts. Выполните следующую команду в сеансе PowerShell с повышенными привилегиями в узле Hyper-V:

            set-item wsman:\localhost\Client\TrustedHosts -value <ComputerName>[,<ComputerName>]

    Б. Включить удаленное взаимодействие PowerShell.

            Enable-PSRemoting -Force

## <a name="download-and-extract-the-deployment-planner-tool"></a>Скачивание и извлечение планировщика развертывания

1.  Скачайте последнюю версию [планировщика ресурсов Azure Site Recovery](https://aka.ms/asr-deployment-planner).
Эта программа упакована в формате ZIP. Программа поддерживает сценарии аварийного восстановления VMware и Hyper-V в Azure. Кроме того, вы можете использовать эту программу для сценария аварийного восстановления Hyper-V на вторичный сайт. Но при этом пропустите рекомендации по инфраструктуре Azure из отчета.

2.  Скопируйте ZIP-папку на сервер Windows Server, где необходимо запустить программу. Можно запустить ее на Windows Server 2012 R2 или Windows Server 2016. Сервер должен иметь доступ к сети, чтобы подключиться к кластеру или узлу Hyper-V с виртуальными машинами для профилирования. Рекомендуем использовать для виртуальной машины, где будет запущена программа, оборудование той же конфигурации, что и на сервере Hyper-V, который необходимо защитить. Такая конфигурация гарантирует, что пропускная способность, сведения о которой получены с помощью планировщика, будет соответствовать фактической пропускной способности, которой Azure Site Recovery может добиться во время репликации. Значение пропускной способности зависит от доступной пропускной способности сети и конфигурации оборудования сервера (ЦП, хранилище и т. д.). Пропускная способность вычисляется на основе сведений о передаче данных с сервера, где выполняется программа, в Azure. Если на этом сервере и на сервере Hyper-V различные конфигурации оборудования, значение достигаемой пропускной способности, полученное с помощью этой программы, будет неточным.
Рекомендуемая конфигурация виртуальной машины: 8 виртуальных ЦП, ОЗУ 16 ГБ, 300 ГБ на жестком диске.

3.  Распакуйте ZIP-папку.
Папка содержит несколько файлов и вложенных папок. Исполняемый файл ASRDeploymentPlanner.exe находится в родительской папке.

Пример. Скопируйте ZIP-файл в папку E:\ drive и распакуйте его. E:\ASR Deployment Planner_v2.1.zip

E:\ASR Deployment Planner_v2.1\ASRDeploymentPlanner.exe

### <a name="updating-to-the-latest-version-of-deployment-planner"></a>Обновление планировщика развертывания до последней версии
Если установлена предыдущая версия планировщика развертывания, выполните одно из следующих действий:
 * Если в последней версии нет исправления профилирования и оно уже выполняется, вам не нужно останавливать его.
 * Если в последней версии есть исправления профилирования, мы рекомендуем остановить профилирование, выполняемое в текущей версии, и запустить его с использованием новой версии.


  >[!NOTE]
  >
  >При запуске профилирования с использованием новой версии передайте тот же путь к выходному каталогу, который будет использоваться средством для добавления данных профиля в существующие файлы. При создании отчетов будет использоваться полный набор данных профилирования. Если передать разные выходные каталоги, то создадутся файлы, а старые данные профилирования нельзя будет использовать при создании отчета.
  >
  >Каждое обновление планировщика ресурсов с использованием ZIP-файла является накопительным. Не нужно копировать файлы новой версии в папку со старой версией. Вы можете создать и использовать папку.

## <a name="version-history"></a>Журнал версий
Последняя версия средства Планировщика развертывания ASR — 2.1.
Описание исправлений, добавляемых при каждом обновлении, см. на странице [журнала версий Планировщика развертывания ASR](https://social.technet.microsoft.com/wiki/contents/articles/51049.asr-deployment-planner-version-history.aspx).


## <a name="next-steps"></a>Дополнительная информация
* [Запуск планировщика развертывания](site-recovery-hyper-v-deployment-planner-run.md).