---
title: "aaaReplicate развертывании многоуровневого Citrix XenDesktop и XenApp с помощью Azure Site Recovery | Документы Microsoft"
description: "В этой статье описывается как tooprotect и восстановление развертывания Citrix XenDesktop и XenApp с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: ponatara
manager: abhemraj
editor: 
ms.assetid: 9126f5e8-e9ed-4c31-b6b4-bf969c12c184
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/18/2017
ms.author: ponatara
ms.openlocfilehash: c4ea9f95f91c585cdcf9d776b02c0967f4c16ab0
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="replicate-a-multi-tier-citrix-xenapp-and-xendesktop-deployment-using-azure-site-recovery"></a>Репликация многоуровневого развертывания Citrix XenApp и XenApp с помощью Azure Site Recovery

## <a name="overview"></a>Обзор

Citrix XenDesktop — это решение виртуализации рабочего стола, которое предоставляет рабочие столы и приложения в виде ondemand tooany пользователя службы, в любом месте. С помощью технологии доставки FlexCast XenDesktop можно быстро и безопасно предоставлять приложения и toousers рабочие столы.
Сейчас Citrix XenApp не предоставляет возможности аварийного восстановления.

Это решение хорошо аварийного восстановления, следует разрешить моделирования планов восстановления вокруг hello выше архитектур сложных приложений и также имеют hello возможность tooadd настроенные действия toohandle для сопоставлений между различными уровнями таким образом обеспечивая одним щелчком, что снимок решения в событии hello аварии начальные tooa снижение RTO.

Этот документ содержит пошаговое руководство для создания решения аварийного восстановления для локальных развертываний Citrix XenApp на платформах Hyper-V и VMware vSphere. В этом документе также описывается как tooperform тестовой отработки отказа (аварийного восстановления) и tooAzure внеплановой отработки отказа с использованием планов восстановления, hello поддерживаемые конфигурации и необходимые компоненты.


## <a name="prerequisites"></a>Предварительные требования

Прежде чем начать, убедитесь, что вы понимаете следующие hello:

1. [Репликация tooAzure виртуальной машины](site-recovery-vmware-to-azure.md)
1. Как слишком[проектирования сети восстановления](site-recovery-network-design.md)
1. [Выполнив tooAzure теста отработки отказа](site-recovery-test-failover-to-azure.md)
1. [Выполнив tooAzure отработки отказа](site-recovery-failover.md)
1. Как слишком[репликации контроллера домена](site-recovery-active-directory.md)
1. Как слишком[репликации SQL Server](site-recovery-sql.md)

## <a name="deployment-patterns"></a>Модели развертывания

Citrix XenApp и XenDesktop фермы обычно имеет hello после развертывания шаблона.

**Модель развертывания**

Развертывание Citrix XenApp и XenDesktop с помощью DNS-сервера AD, сервера базы данных SQL, контролера доставки Citrix, сервера StoreFront, XenApp Master (VDA), сервера лицензирования Citrix XenApp

![Модель развертывания 1](./media/site-recovery-citrix-xenapp-and-xendesktop/citrix-deployment.png)


## <a name="site-recovery-support"></a>Поддержка Site Recovery

В целях hello в этой статье управляет Citrix развертывания на виртуальных машинах VMware vSphere 6.0 / System Center VMM 2012 R2 были используется toosetup аварийного восстановления.

### <a name="source-and-target"></a>Исходный и целевой объект

**Сценарий** | **tooa вторичного сайта** | **tooAzure**
--- | --- | ---
**Hyper-V** | За пределами области | Да
**VMware** | За пределами области | Да
**Физический сервер** | За пределами области | Да

### <a name="versions"></a>Версии
Клиенты могут развертывать компоненты XenApp в качестве физических серверов или виртуальных машин под управлением Hyper-V или VMware. Azure Site Recovery можно защитить tooAzure обоих развертываний физическими и виртуальными.
Поскольку XenApp 7,7 или более поздней версии поддерживаются в Azure, только для развертываний с этих версий возможен переход tooAzure для аварийного восстановления или миграции.

### <a name="things-tookeep-in-mind"></a>Действия tookeep помнить

1. Защита и восстановление локальных развертываний с помощью toodeliver машины ОС Server XenApp опубликованных приложений и XenApp опубликованных рабочих столов поддерживается.

2. Защита и восстановление для локальных развертываний с помощью рабочего стола toodeliver машины ОС СТОЛОВ для виртуальных рабочих столов клиента, включая Windows 10 не поддерживается. Это происходит потому ASR не поддерживает восстановление hello машин с рабочего стола OS'es.  Кроме того, лицензирование некоторых особенностей виртуального рабочего стола клиента (например, Windows 7) еще не поддерживается в Azure. Дополнительные сведения о лицензировании рабочих столов клиента и сервера в Azure см. [здесь](https://azure.microsoft.com/pricing/licensing-faq/).

3.  С помощью Azure Site Recovery нельзя выполнить репликацию и защиту имеющихся локальных клонов MCS или PVS.
Необходимо toorecreate клонированного с помощью надежного обмена Сообщениями Azure подготовки из контроллера доставки.

4. NetScaler невозможно защитить с помощью Azure Site Recovery, так как NetScaler, основана на FreeBSD и Azure Site Recovery, не поддерживает защиту ОС FreeBSD. Будет необходимо toodeploy и настроить новое устройство NetScaler из рынок Azure после отработки отказа tooAzure.


## <a name="replicating-virtual-machines"></a>Репликация виртуальных машин

следующие компоненты hello развертывания Citrix XenApp Hello должны toobe защищенных tooenable репликации и восстановления.

* DNS-сервер AD;
* сервер базы данных SQL;
* контроллер доставки Citrix;
* защита сервера StoreFront;
* защита XenApp Master (VDA);
* защита сервера лицензирования Citrix XenApp.


**Репликация DNS-сервера AD**

См. слишком[защиты Active Directory и DNS с помощью Azure Site Recovery](site-recovery-active-directory.md) на руководство по репликации и настройка контроллера домена в Azure.

**Репликация сервера базы данных SQL**

См. слишком[защиты SQL Server с помощью аварийного восстановления SQL Server и Azure Site Recovery](site-recovery-sql.md) подробное техническое руководство по hello рекомендуется использовать параметры для защиты серверов SQL Server.

Выполните [в этом руководстве](site-recovery-vmware-to-azure.md) репликации toostart hello tooAzure виртуальных машин других компонентов.

![Защита компонентов XenApp](./media/site-recovery-citrix-xenapp-and-xendesktop/citrix-enablereplication.png)

**Параметры вычислений и сети**

После защищенных машин hello вычислений hello (отображает состояние как «Protected» в группе репликации элементов), и параметры сети требуется настроить toobe.
В вычисления и сеть > вычислений свойства, можно указать имя и целевой размер виртуальной Машины Azure hello.
Если вам нужно, измените toocomply имя hello требованиям Azure. Кроме того, можно просматривать и добавлять сведения о hello целевой сети, подсети и IP-адрес, который будет назначен toohello виртуальной Машине Azure.

Обратите внимание hello следующие:

* Можно задать hello конечный IP-адрес. Если вы не укажете, при сбое машины hello будет использовать DHCP. Если адрес, который недоступен в отработки отказа, отработка отказа hello не сработает. Здравствуйте, одинаковый целевой IP-адрес можно использовать для тестовой отработки отказа, если доступен адрес hello в hello тестовой отработки отказа сети.

* Для hello AD или DNS-сервера сохраняя hello локального адреса определяет hello же адрес как hello DNS-сервер для hello Azure виртуальной сети.

Hello число сетевых адаптеров определяется размер hello, указываемые для hello целевой виртуальной машине, следующим образом:

*   Если hello количество сетевых адаптеров на исходном компьютере hello меньше или равно toohello число адаптеров разрешено hello целевой машине размером, а затем целевой hello будут иметь одинаковое число адаптеров как источник hello hello.
*   Если hello число адаптеров для hello исходной виртуальной машины превышает допустимое hello для hello целевого размера, а затем максимальный размер целевой hello будет использоваться.
* Например если исходная машина имеет два сетевых адаптера, hello целевой машине размер поддерживает четыре hello целевой компьютер будет иметь два адаптера. Если hello исходный компьютер имеет два адаптера, но hello поддерживаемые целевой размер поддерживает только один hello целевой компьютер будет только один адаптер.
*   Если виртуальная машина hello имеет несколько сетевых адаптеров все они подключатся toohello одной сети.
*   Если hello виртуальной машины с несколькими сетевыми адаптерами, hello первый отображаются в списке hello становится hello по умолчанию сетевой адаптер в виртуальной машине Azure hello.


## <a name="creating-a-recovery-plan"></a>Создание плана восстановления

После включения репликации для виртуальных машин компонент XenApp hello hello следующим шагом является toocreate план восстановления.
Группы плана восстановления объединяют виртуальные машины с аналогичными требованиями для выполнения отработки отказа и восстановления.  

**Действия toocreate плана восстановления**

1. Добавление hello XenApp компонент виртуальных машин в план восстановления hello.
2. Выберите "Планы восстановления" > + Recovery Plan (Добавить план восстановления). Укажите имя для плана восстановления hello интуитивно понятными.
3. Для виртуальных машин VMware в качестве источника выберите сервер обработки VMware, в качестве целевого объекта — Microsoft Azure, а в качестве модели развертывания — диспетчер ресурсов и щелкните "Выбор элементов".
4. Для виртуальных машин Hyper-V: выберите источник, что и сервер VMM, целевых как Microsoft Azure и модель развертывания как диспетчер ресурсов и щелкнуть выбора элементов и выберите hello XenApp развертывания виртуальных машин.

### <a name="adding-virtual-machines-toofailover-groups"></a>Добавление групп toofailover виртуальные машины

Планы восстановления может быть tooadd настраиваемые группы перехода на другой ресурс для запуска конкретного заказа, скриптов или ручных действий. следующие группы Hello должны плана восстановления добавлены toohello toobe.

1. 1 группа отработки отказа: DNS-сервер AD.
2. 2 группа отработки отказа: виртуальные машины SQL Server.
2. 3 группа отработки отказа: виртуальная машина с образом VDA Master.
3. 4 группа отработки отказа: контроллер доставки и виртуальные машины сервера StoreFront.


### <a name="adding-scripts-toohello-recovery-plan"></a>Добавление плана восстановления toohello сценариев

Скрипты могут выполняться до или после определенной группы в плане восстановления. Выполняемые вручную действия могут быть также включены и выполняться во время отработки отказа.

план восстановления, настроенные Hello выглядит следующим образом hello ниже.

1. 1 группа отработки отказа: DNS-сервер AD.
2. 2 группа отработки отказа: виртуальные машины SQL Server.
3. 3 группа отработки отказа: виртуальная машина с образом VDA Master.

   >[!NOTE]     
   >Шаги 4, 6 и 7, содержащий действия вручную или сценария, применимые tooonly XenApp локальной > среде с несколькими Подключениями и просмотры Страниц каталогами.

4. Действие вручную или скрипт группа 3: hello master VDA ВМ завершение работы ВМ VDA Master при переключении tooAzure будет находиться в состоянии выполнения. toocreate с помощью размещения Azure ARM новые каталоги MCS, образец hello VDA ВМ — необходимые toobe остановлена (de выделенной) состояние. Здравствуйте, завершение работы виртуальной Машины с портала Azure.

5. 4 группа отработки отказа: контроллер доставки и виртуальные машины сервера StoreFront.
6. Группа 3. Действие вручную или действие скрипта. Вариант 1:

    ***Добавление подключения к узлу Azure RM***

    Создайте подключение к узлу Azure ARM tooprovision машины контроллера доставки новых MCS каталогов в Azure. Выполните шаги hello, как описано в этом [статьи](https://www.citrix.com/blogs/2016/07/21/connecting-to-azure-resource-manager-in-xenapp-xendesktop/).

7. Группа 3. Действие вручную или действие скрипта. Вариант 2:

    ***Повторное создание каталогов MCS в Azure***

    существующие клоны MCS или просмотры Страниц на первичном сайте hello Hello не будет реплицированных tooAzure. Необходимо toorecreate клонированного с помощью hello реплицированные master VDA и Azure ARM подготовки из контроллера доставки. Выполните шаги hello, как описано в этом [статьи](https://www.citrix.com/blogs/2016/09/12/using-xenapp-xendesktop-in-azure-resource-manager/) toocreate MCS каталоги в Azure.

![План восстановления для компонентов XenApp](./media/site-recovery-citrix-xenapp-and-xendesktop/citrix-recoveryplan.png)


   >[!NOTE]
   >Можно использовать скрипты в [расположение](https://github.com/Azure/azure-quickstart-templates/blob/>master/asr-automation-recovery/scripts) tooupdate hello DNS с помощью нового IP-адресов hello отработку отказа hello > виртуальных машин или tooattach при необходимости подсистему балансировки нагрузки на hello отработку отказа виртуальной машины.


## <a name="doing-a-test-failover"></a>Тестовая отработка отказа

Выполните [в этом руководстве](site-recovery-test-failover-to-azure.md) toodo тестовой отработки отказа.

![План восстановления](./media/site-recovery-citrix-xenapp-and-xendesktop/citrix-tfo.png)


## <a name="doing-a-failover"></a>Отработка отказа

При выполнении отработки отказа используйте [это руководство](site-recovery-failover.md).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о репликации развертываний Citrix XenApp и XenDesktop см. в [этом техническом документе](https://aka.ms/citrix-xenapp-xendesktop-with-asr). Просмотрите рекомендации hello слишком[репликацию других приложений](site-recovery-workload.md) с помощью Site Recovery.
