---
title: "Планировщик ресурсов Azure Site Recovery для сценариев развертывания виртуальных машин VMware в Azure | Документация Майкрософт"
description: "В этой статье описан режим запуска для планировщика развертывания Azure Site Recovery при развертывании виртуальных машин VMware в Azure."
services: site-recovery
documentationcenter: 
author: nsoneji
manager: garavd
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 12/04/2017
ms.author: nisoneji
ms.openlocfilehash: 9aedd5561397c78622a43f39f423c618000a2a33
ms.sourcegitcommit: 384d2ec82214e8af0fc4891f9f840fb7cf89ef59
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/16/2018
---
# <a name="run-azure-site-recovery-deployment-planner-for-vmware-to-azure"></a>Запуск планировщика развертывания Azure Site Recovery для сценариев развертывания виртуальных машин VMware в Azure
В этой статье приведены рекомендации по использованию планировщика развертывания Azure Site Recovery в сценариях рабочих развертываний виртуальных машин VMware в Azure.


## <a name="modes-of-running-deployment-planner"></a>Режимы запуска для планировщика развертывания
Программу командной строки (ASRDeploymentPlanner.exe) можно запустить в любом из следующих четырех режимов: 

1.  [Профилирование](#profile-vmware-vms).
2.  [Создание отчета](#generate-report).
3.  [Получение данных пропускной способности](#get-throughput).

Сначала планировщик необходимо запустить в режиме профилирования, чтобы получить сведения об активности обработки данных и числе операций ввода-вывода в секунду на виртуальной машине. Затем запустите ее в режиме создания отчетов, чтобы узнать пропускную способность сети, требования к хранилищу, а также оценить затраты на аварийное восстановление.

## <a name="profile-vmware-vms"></a>Профилирование виртуальных машин VMware
В режиме профилирования планировщик ресурсов подключается к серверу vCenter Server или узлам vSphere ESXi, чтобы собрать данные о производительности виртуальной машины.

* Профилирование не влияет на производительность рабочих процессов виртуальных машин, так как программа напрямую не подключается к виртуальной машине. Все данные о производительности собираются на сервере vCenter Server или узле vSphere ESXi.
* Программа отправляет запросы к серверу vCenter Server или узлу vSphere ESXi каждые 15 минут. За счет этого влияние на сервер во время профилирования незначительное. Такой интервал запросов не влияет на точность профилирования, так как программа сохраняет данные счетчика производительности, получаемые каждую минуту.

### <a name="create-a-list-of-vms-to-profile"></a>Создание списка виртуальных машин для профилирования
Сначала вы должны создать список виртуальных машин, профилирование которых нужно выполнить. Список всех имен виртуальных машин можно получить на сервере vCenter Server или узле vSphere ESXi, используя приведенные ниже команды VMware vSphere PowerCLI. Кроме того, вы можете выбрать знакомые имена или IP-адреса виртуальных машин, для которых следует выполнить профилирование, вручную в файле.

1. Войдите в виртуальную машину, на которой установлен VMware vSphere PowerCLI.
2. Откройте консоль VMware vSphere PowerCLI.
3. Проверьте, включена ли политика выполнения скрипта. Если отключена, запустите консоль VMware vSphere PowerCLI в режиме администратора и включите ее, выполнив следующую команду:

            Set-ExecutionPolicy –ExecutionPolicy AllSigned

4. Если Connect-VIServer не распознается как имя командлета, вам может потребоваться выполнить следующую команду:
 
            Add-PSSnapin VMware.VimAutomation.Core 

5. Чтобы получить список всех имен виртуальных машин на сервере vCenter Server или узле vSphere ESXi и сохранить их в TXT-файле, выполните приведенные ниже команды.
Замените значения &lsaquo;имени сервера&rsaquo;, &lsaquo;имени пользователя&rsaquo;, &lsaquo;пароля&rsaquo; и &lsaquo;выходного TXT-файла&rsaquo; собственными.

            Connect-VIServer -Server <server name> -User <user name> -Password <password>

            Get-VM |  Select Name | Sort-Object -Property Name >  <outputfile.txt>

6. Откройте выходной файл в Блокноте. Скопируйте имена виртуальных машин, профилирование которых необходимо выполнить, в другой файл (например, в файл ProfileVMList.txt) по одному на строку. Этот файл используется в качестве входного значения параметра *-VMListFile* в программе командной строки.

    ![Список имен виртуальных машин в планировщике ресурсов
](media/site-recovery-vmware-deployment-planner-run/profile-vm-list-v2a.png)

### <a name="start-profiling"></a>Начало профилирования
После создания списка виртуальных машин можно запустить программу в режиме профилирования. Ниже приведен список обязательных и необязательных параметров для запуска планировщика в режиме профилирования.

```
ASRDeploymentPlanner.exe -Operation StartProfiling /?
```

| Имя параметра | ОПИСАНИЕ |
|---|---|
| -Operation | StartProfiling |
| -Server | Полное доменное имя или IP-адрес сервера vCenter Server или узла vSphere ESXi, профилирование виртуальных машин которого необходимо выполнить.|
| -User | Имя пользователя для подключения к серверу vCenter Server или узлу vSphere ESXi. Пользователь должен иметь по крайней мере доступ с правами только для чтения.|
| -VMListFile | Файл со списком виртуальных машин для профилирования. Путь к файлу может быть абсолютным или относительным. Этот файл должен содержать по одному имени или IP-адресу виртуальной машины в каждой строке. Имя виртуальной машины, указанное в файле, должно совпадать с именем виртуальной машины на сервере vCenter Server или узле vSphere ESXi.<br>Например, файл VMList.txt содержит следующие виртуальные машины:<ul><li>virtual_machine_A</li><li>10.150.29.110</li><li>virtual_machine_B</li><ul> |
|-NoOfMinutesToProfile|Число минут, в течение которых будет выполняться профилирование. Минимальное значение — 30 минут.|
|-NoOfHoursToProfile|Число часов, в течение которых будет выполняться профилирование.|
| -NoOfDaysToProfile | Число дней, в течение которых будет выполняться профилирование. Мы рекомендуем выполнять профилирование более 7 дней. Это позволит более детально определить шаблон рабочей нагрузки в среде и предоставить более точные рекомендации. |
|-Virtualization|Укажите тип виртуализации (VMware или Hyper-V).|
| -Directory | (Необязательно.) UNC-путь или путь к локальному каталогу для хранения данных профилирования. Если имя каталога не задано, в качестве каталога по умолчанию используется каталог ProfiledData, расположенный по текущему пути. |
| -Password | (Необязательно.) Пароль, используемый для подключения к серверу vCenter Server или узлу vSphere ESXi. Если не указать его сейчас, запрос на ввод пароля отобразится после выполнения команды.|
|-Port|(Необязательно.) Номер порта для подключения к узлу vCenter или ESXi. По умолчанию используется порт 443.|
|-Protocol| (Необязательно.) Указывает протокол (HTTP или HTTPS) для подключения к vCenter. По умолчанию используется протокол HTTPS.|
| -StorageAccountName | (Необязательно.) Имя учетной записи хранения, используемой для определения объема пропускной способности, доступной для репликации данных из локальной среды в Azure. Программа отправляет тестовые данные в эту учетную запись хранения, чтобы рассчитать пропускную способность. Учетная запись хранения должна быть общего назначения версии 1 или storageV2 (общего назначения версии 2)|
| -StorageAccountKey | (Необязательно.) Ключ, используемый для доступа к учетной записи хранения. Перейдите на портал Azure и выберите "Учетные записи хранения" > <*имя_учетной записи_хранения*> > "Параметры" > "Ключи доступа" > Key1. |
| -Environment | (необязательно) Это целевая среда учетной записи хранения Azure. Этот параметр может иметь одно из трех значений: AzureCloud, AzureUSGovernment, AzureChinaCloud. Значение по умолчанию — AzureCloud. Используйте этот параметр, если ваш целевой регион Azure — Azure для государственных организаций США или Azure для Китая. |


Рекомендуем выполнять профилирование виртуальных машин более 7 дней. Если в течение месяца шаблон обработки изменяется, рекомендуем выполнять профилирование в течение недели, когда будет зафиксирован максимальный показатель. Чтобы получить точные данные, рекомендуем профилировать машины в течение 31 дня. В течение этого периода программа ASRDeploymentPlanner.exe продолжает работать. Время профилирования необходимо указать в днях. Чтобы быстро протестировать программу или подтвердить концепцию, можно выполнять профилирование в течение нескольких часов или минут. Минимальное разрешенное время профилирования составляет 30 минут.

В процессе профилирования при необходимости можно передать имя и ключ учетной записи хранения, чтобы определить пропускную способность, которой может достигнуть Site Recovery во время репликации данных с сервера конфигурации и сервера обработки в Azure. Если их не передать, планировщик не будет рассчитывать достигаемую пропускную способность.

Вы можете запустить несколько экземпляров этой программы для наборов виртуальных машин. Убедитесь, что в этих наборах профилирования имена виртуальных машин не повторяются. Например, вы выполнили профилирование десяти виртуальных машин (VM1–VM10) и спустя несколько дней хотите повторить этот процесс для еще пяти (VM11–VM15). Для профилирования второго набора виртуальных машин (VM11–VM15) эту программу можно запустить в другой консоли командной строки. Проверьте, не входят ли во второй набор виртуальные машины из первого экземпляра профилирования или не используется ли для второго запуска другой выходной каталог. Если два экземпляра планировщика выполняют профилирование тех же самых виртуальных машин и используется тот же выходной каталог, созданный отчет будет неправильным.

По умолчанию средство настроено для профилирования и создания отчетов максимум для 1000 виртуальных машин. Это ограничение можно изменить, переопределив значение ключа MaxVMsSupported в файле *ASRDeploymentPlanner.exe.config*.
```
<!-- Maximum number of vms supported-->
<add key="MaxVmsSupported" value="1000"/>
```
Используя параметры по умолчанию, для профилирования, например, 1500 виртуальных машин создайте два файла VMList.txt. Один файл должен содержать 1000 виртуальных машин, а второй — 500. Запустите два экземпляра планировщика развертывания ASR: один со списком VMList1.txt и второй со списком VMList2.txt. Профилируемые данные обеих виртуальных машин VMList можно хранить в одной папке. 

Мы убедились, что в зависимости от конфигурации оборудования (особенно в зависимости от размера ОЗУ сервера, на котором запускается средство для создания отчетов), операция может завершиться ошибкой из-за нехватки памяти. При наличии хорошего оборудования можно увеличить значение параметра MaxVMsSupported.  

При наличии нескольких серверов vCenter необходимо запускать один экземпляр ASRDeploymentPlanner на каждом сервере vCenter для профилирования.

Конфигурации виртуальных машин записываются один раз при запуске профилирования и сохраняются в файле VMDetailList.xml. Эти сведения используются во время создания отчета. Изменения в конфигурации виртуальной машины (например, увеличение числа ядер, дисков, сетевых карт и т. д.), внесенные после запуска профилирования до завершения этого процесса, не записываются. Если конфигурация виртуальной машины изменилась во время профилирования в общедоступной предварительной версии планировщика, ниже приведены рекомендации по получению последних сведений о виртуальной машине, используемых при создании отчета.

* Создайте резервную копию файла VMdetailList.xml и удалите его из текущего расположения.
* Передайте аргументы -User и -Password во время создания отчета.

Команда профилирования создает в каталоге профилирования несколько файлов. Не удаляйте их, так как это повлияет на создание отчетов.

#### <a name="example-1-profile-vms-for-30-days-and-find-the-throughput-from-on-premises-to-azure"></a>Пример 1. Профилирование виртуальных машин, выполняемое в течение 30 дней, и определение пропускной способности, достигаемой при репликации данных из локальной среды в Azure
```
ASRDeploymentPlanner.exe -Operation StartProfiling -Virtualization VMware -Directory “E:\vCenter1_ProfiledData” -Server vCenter1.contoso.com -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  -NoOfDaysToProfile  30  -User vCenterUser1 -StorageAccountName  asrspfarm1 -StorageAccountKey Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==
```

#### <a name="example-2-profile-vms-for-15-days"></a>Пример 2. Профилирование виртуальных машин, выполняемое в течение 15 дней

```
ASRDeploymentPlanner.exe -Operation StartProfiling -Virtualization VMware -Directory “E:\vCenter1_ProfiledData” -Server vCenter1.contoso.com -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt” -NoOfDaysToProfile  15  -User vCenterUser1
```

#### <a name="example-3-profile-vms-for-60-minutes-for-a-quick-test-of-the-tool"></a>Пример 3. Профилирование виртуальных машин в течение 60 минут для быстрой проверки программы
```
ASRDeploymentPlanner.exe -Operation StartProfiling -Virtualization VMware -Directory “E:\vCenter1_ProfiledData” -Server vCenter1.contoso.com -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  -NoOfMinutesToProfile 60  -User vCenterUser1
```

#### <a name="example-4-profile-vms-for-2-hours-for-a-proof-of-concept"></a>Пример 4. Профилирование виртуальных машин в течение двух часов для подтверждения концепции
```
ASRDeploymentPlanner.exe -Operation StartProfiling -Virtualization VMware -Directory “E:\vCenter1_ProfiledData” -Server vCenter1.contoso.com -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt” -NoOfHoursToProfile 2 -User vCenterUser1
```

>[!NOTE]
>
>* Если сервер, на котором выполняется программа, перезагрузился или на нем произошел сбой, а также если вы вышли из нее, нажав клавиши CTRL+C, данные профилирования сохраняются. Однако вы можете потерять данные за последние 15 минут. В этом случае после перезагрузки сервера повторно запустите планировщик в режиме профилирования.
>* Получив имя и ключ учетной записи хранения, программа измеряет пропускную способность на последнем этапе профилирования. Если она прерывает работу до завершения профилирования, пропускная способность не измеряется. Чтобы определить пропускную способность перед созданием отчета, вы можете выполнить операцию GetThroughput в консоли командной строки. В противном случае сведения о достигаемой пропускной способности не будут включены в отчет.


## <a name="generate-report"></a>Создание отчета
Планировщик создает отчет в формате XLSM (файл Microsoft Excel с поддержкой макросов). В нем содержатся все рекомендации по развертыванию. Этот отчет называется DeploymentPlannerReport_<unique numeric identifier>.xlsm и помещается в указанный каталог.

После завершения профилирования планировщик можно запустить в режиме создания отчетов. В таблице ниже приведен список обязательных и необязательных параметров для запуска программы в режиме создания отчетов.

`ASRDeploymentPlanner.exe -Operation GenerateReport /?`

|Имя параметра | ОПИСАНИЕ |
|-|-|
| -Operation | Создание отчета. |
| -Server |  Полное доменное имя или IP-адрес сервера vCenter Server или сервера vSphere (имя или IP-адрес должны совпадать с используемыми во время профилирования), где расположены виртуальные машины, для которых необходимо создать отчет. Обратите внимание, если профилирование выполняется на сервере vCenter Server, вы не можете использовать для создания отчетов сервер vSphere (и наоборот).|
| -VMListFile | Файл со списком профилированных виртуальных машин, для которых необходимо создать отчет. Путь к файлу может быть абсолютным или относительным. Этот файл должен содержать по одному имени или IP-адресу виртуальной машины в каждой строке. Имена виртуальных машин, указанные в файле, должны совпадать с именами на сервере vCenter Server или узле vSphere ESXi, а также с именами, используемыми в процессе профилирования.|
|-Virtualization|Укажите тип виртуализации (VMware или Hyper-V).|
| -Directory | (Необязательно.) UNC-путь или путь к локальному каталогу, в котором хранятся данные профилирования (файлы, созданные в процессе профилирования). Эти данные используются для создания отчета. Если имя не указано, используется каталог ProfiledData. |
| -GoalToCompleteIR | (Необязательно.) Время (в часах), необходимое для завершения начальной репликации профилированных виртуальных машин. В созданном отчете содержатся сведения о количестве виртуальных машин, репликацию которых можно выполнить в течение указанного времени. По умолчанию — 72 часа. |
| -User | (Необязательно.) Имя пользователя, используемое для подключения к серверу vCenter Server или vSphere. Имя используется для получения последних сведений о конфигурации виртуальных машин, например о количестве дисков, ядер, сетевых карт и т. д., используемых в отчете. Если не указать имя, используются сведения о конфигурации, полученные в начале профилирования. |
| -Password | (Необязательно.) Пароль, используемый для подключения к серверу vCenter Server или узлу vSphere ESXi. Если не указать его в качестве параметра, запрос на ввод пароля отобразится позже после выполнения команды. |
|-Port|(Необязательно.) Номер порта для подключения к узлу vCenter или ESXi. По умолчанию используется порт 443.|
|-Protocol|(Необязательно.) Указывает протокол (HTTP или HTTPS) для подключения к vCenter. По умолчанию используется протокол HTTPS.|
| -DesiredRPO | (Необязательно.) Требуемая целевая точка восстановления в минутах. Значение по умолчанию — 15 минут.|
| -Bandwidth | Пропускная способность в Мбит/с. Этот параметр используется для вычисления значения целевой точки восстановления, которого можно достигнуть для указанной пропускной способности. |
| -StartDate | (Необязательно.) Дата и время начала в формате ММ-ДД-ГГГГ:ЧЧ:ММ (24-часовой цикл). Параметр *StartDate* необходимо указать с параметром *EndDate*. Если указать параметр StartDate, отчет будет создан на основе данных, собранных в период между датой начала и окончания. |
| -EndDate | (Необязательно.) Дата и время окончания в формате ММ-ДД-ГГГГ:ЧЧ:ММ (24-часовой цикл). Параметр *EndDate* необходимо указать с параметром *StartDate*. Если указать параметр EndDate, отчет будет создан на основе данных, собранных в период между датой начала и окончания. |
| -GrowthFactor | (Необязательно.) Коэффициент роста в процентах. Значение по умолчанию — 30 процентов. |
| -UseManagedDisks | (Необязательно) UseManagedDisks — "Да" или "Нет". Значение по умолчанию — "Да". Число виртуальных машин, которые можно разместить в одной учетной записи хранения, вычисляется с учетом того, где выполняется отработка отказа или тестовая отработка отказа виртуальных машин — на управляемом или на неуправляемом диске. |
|-SubscriptionId |(Необязательно.) Идентификатор GUID подписки. Используйте этот параметр, чтобы создать отчет об оценке затрат с последними ценами на основе вашей подписки, предложения, связанного с подпиской, а также для указанного вами целевого региона Azure в указанной валюте.|
|-TargetRegion|(Необязательно.) Целевой регион Azure для репликации. Используйте этот параметр, чтобы создать отчет для целевого региона Azure, так как цены в Azure устанавливаются отдельно для каждого региона.<br>Значение по умолчанию — WestUS2 или последний указанный целевой регион.<br>Ознакомьтесь со списком [поддерживаемых целевых регионов](site-recovery-vmware-deployment-planner-cost-estimation.md#supported-target-regions).|
|-OfferId|(Необязательно.) Предложение, связанное с определенной подпиской. Значение по умолчанию — MS-AZR-0003P (оплата по мере использования).|
|-Currency|(Необязательно.) Валюта, в которой отображается стоимость в созданном отчете. Значение по умолчанию — доллар США ($) или последняя указанная валюта.<br>Ознакомьтесь со списком [поддерживаемых валют](site-recovery-vmware-deployment-planner-cost-estimation.md#supported-currencies).|

По умолчанию средство настроено для профилирования и создания отчетов максимум для 1000 виртуальных машин. Это ограничение можно изменить, переопределив значение ключа MaxVMsSupported в файле *ASRDeploymentPlanner.exe.config*.
```
<!-- Maximum number of vms supported-->
<add key="MaxVmsSupported" value="1000"/>
```

#### <a name="example-1-generate-a-report-with-default-values-when-the-profiled-data-is-on-the-local-drive"></a>Пример 1. Создание отчета со значениями по умолчанию, когда данные профилирования находятся на локальном диске
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualiztion VMware -Server vCenter1.contoso.com -Directory “E:\vCenter1_ProfiledData” -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt”
```

#### <a name="example-2-generate-a-report-when-the-profiled-data-is-on-a-remote-server"></a>Пример 2. Создание отчета, когда данные профилирования находятся на удаленном сервере
У вас должен быть доступ на чтение и запись к удаленному каталогу.
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization VMware -Server vCenter1.contoso.com -Directory “\\PS1-W2K12R2\vCenter1_ProfiledData” -VMListFile “\\PS1-W2K12R2\vCenter1_ProfiledData\ProfileVMList1.txt”
```

#### <a name="example-3-generate-a-report-with-a-specific-bandwidth-and-goal-to-complete-ir-within-specified-time"></a>Пример 3. Создание отчета с определенной пропускной способностью для выполнения начальной репликации в указанный интервал времени
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization VMware -Server vCenter1.contoso.com -Directory “E:\vCenter1_ProfiledData” -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt” -Bandwidth 100 -GoalToCompleteIR 24
```

#### <a name="example-4-generate-a-report-with-a-5-percent-growth-factor-instead-of-the-default-30-percent"></a>Пример 4. Создание отчета с коэффициентом роста 5 %, а не 30 % (значение по умолчанию)
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualzation VMware -Server vCenter1.contoso.com -Directory “E:\vCenter1_ProfiledData” -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt” -GrowthFactor 5
```

#### <a name="example-5-generate-a-report-with-a-subset-of-profiled-data"></a>Пример 5. Создание отчета с подмножеством данных профилирования
Например, у вас есть данные профилирования за 30 дней, но вы хотите создать отчет только за 20 дней.
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization VMware -Server vCenter1.contoso.com -Directory “E:\vCenter1_ProfiledData” -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt” -StartDate  01-10-2017:12:30 -EndDate 01-19-2017:12:30
```

#### <a name="example-6-generate-a-report-for-5-minute-rpo"></a>Пример 6. Создание отчета для 5-минутной целевой точки восстановления
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization VMware -Server vCenter1.contoso.com -Directory “E:\vCenter1_ProfiledData” -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  -DesiredRPO 5
```

#### <a name="example-7-generate-a-report-for-south-india-azure-region-with-indian-rupee-and-specific-offer-id"></a>Пример 7. Создание отчета для региона Azure "Южная Индия" со значением валюты "индийская рупия" и указанием идентификатора предложения
```
ASRDeploymentPlanner.exe -Operation GenerateReport -Virtualization VMware  -Directory “E:\vCenter1_ProfiledData” -VMListFile “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  -SubscriptionID 4d19f16b-3e00-4b89-a2ba-8645edf42fe5 -OfferID MS-AZR-0148P -TargetRegion southindia -Currency INR
```

## <a name="percentile-value-used-for-the-calculation"></a>Значение процентиля, используемое для вычисления
**Значение какого процентиля метрик производительности, собранных во время профилирования, по умолчанию использует планировщик при создании отчета?**

По умолчанию планировщик использует значения 95-го процентиля числа операций записи и чтения на диск в секунду, числа операций вода-вывода в секунду при записи и активности обработки данных, собранных во время профилирования всех виртуальных машин. Это гарантирует, что для определения требований к пропускной способности учетной записи хранения и целевой службы не будут использоваться пиковые значения 100-го процентиля, которые могут возникать на виртуальной машине из-за временных событий, например из-за выполнения задания архивации раз в день, периодического индексирования базы данных, создания аналитического отчета или какого-либо другого кратковременного события, происходящего в определенный момент времени.

При использовании значений 95-го процентиля вы получите точные сведения об особенностях рабочей нагрузки, что, в свою очередь, позволяет обеспечить наилучшую производительность при выполнении этих рабочих нагрузок в Azure. Мы не рекомендуем изменять это значение, но если вы решили сделать это, например изменить на 90-й процентиль, обновите файл конфигурации *ASRDeploymentPlanner.exe.config*, который находится в каталоге по умолчанию, а затем сохраните этот файл, чтобы создать отчет на основе имеющихся данных профилирования.
```
<add key="WriteIOPSPercentile" value="95" />      
<add key="ReadWriteIOPSPercentile" value="95" />      
<add key="DataChurnPercentile" value="95" />
```

## <a name="growth-factor-considerations"></a>Рекомендации по коэффициенту роста
**Почему следует учитывать коэффициент роста при планировании развертывания?**

Крайне важно учитывать расширение характеристик рабочей нагрузки при увеличении шаблона использования с течением времени. После установки защиты виртуальной машины изменяются характеристики рабочей нагрузки. Сейчас невозможно переключиться на другую учетную запись хранения Azure, не отключая защиту.

Например, сейчас виртуальная машина находится в учетной записи репликации хранилища класса Standard. За следующие три месяца произошли некоторые изменения:

* Увеличилось количество пользователей приложения, запущенного на этой виртуальной машине.
* Объем данных на ней вырос, и из-за этого вам потребуется перейти на хранилище класса Premium. Это позволит Site Recovery обрабатывать еще больший объем данных во время репликации.
* Для этого вам потребуется отключить защиту, а затем повторно включить ее в учетной записи хранения уровня Premium.

Поэтому мы настоятельно рекомендуем спланировать рост во время планирования развертывания. По умолчанию коэффициент роста составляет 30 %. Вы знаете шаблон использования ваших приложений и можете оценить рост их использования. Измените этот коэффициент соответствующим образом при создании отчета. Кроме того, вы можете создать несколько отчетов с разными коэффициентами роста на основе тех же данных профилирования и оценить, какие рекомендации по пропускной способности источника данных и целевого хранилища лучше всего соответствуют вашим требованиям.

Созданный отчет Microsoft Excel содержит следующие сведения:

* [сводка по локальной инфраструктуре](site-recovery-vmware-deployment-planner-analyze-report.md#on-premises-summary);
* [рекомендации](site-recovery-vmware-deployment-planner-analyze-report.md#recommendations);
* [Размещение хранилища виртуальной машины](site-recovery-vmware-deployment-planner-analyze-report.md#vm-storage-placement)
* [Совместимые виртуальные машины](site-recovery-vmware-deployment-planner-analyze-report.md#compatible-vms)
* [Несовместимые виртуальные машины](site-recovery-vmware-deployment-planner-analyze-report.md#incompatible-vms)
* [оценка затрат](site-recovery-vmware-deployment-planner-cost-estimation.md).

![Планировщик ресурсов](media/site-recovery-vmware-deployment-planner-analyze-report/Recommendations-v2a.png)

## <a name="get-throughput"></a>Оценка пропускной способности.

Чтобы оценить пропускную способность, которой Site Recovery может достигнуть при репликации данных из локальной среды в Azure, запустите программу в режиме GetThroughput. Планировщик вычисляет пропускную способность на сервере, где он запущен. В идеале используется сервер, конфигурация оборудования которого соответствует рекомендациям по размеру сервера конфигурации. Если вы уже развернули компоненты инфраструктуры Site Recovery в локальной среде, запустите эту программу на сервере конфигурации.

Откройте консоль командной строки и перейдите в папку планировщика ресурсов Site Recovery. Запустите ASRDeploymentPlanner.exe с указанными ниже параметрами.

`ASRDeploymentPlanner.exe -Operation GetThroughput /?`

|Имя параметра | ОПИСАНИЕ |
|-|-|
| -Operation | Оценка пропускной способности. |
|-Virtualization|Укажите тип виртуализации (VMware или Hyper-V).|
| -Directory | (Необязательно.) UNC-путь или путь к локальному каталогу, в котором хранятся данные профилирования (файлы, созданные в процессе профилирования). Эти данные используются для создания отчета. Если имя каталога не указано, используется каталог ProfiledData. |
| -StorageAccountName | Имя учетной записи хранения, используемой для определения пропускной способности, необходимой для репликации данных из локальной среды в Azure. Программа отправляет тестовые данные в эту учетную запись хранения, чтобы рассчитать используемую пропускную способность. Учетная запись хранения должна быть общего назначения версии 1 или storageV2 (общего назначения версии 2)|
| -StorageAccountKey | Ключ, используемый для доступа к учетной записи хранения. Перейдите на портал Azure и выберите "Учетные записи хранения > *имя_учетной записи_хранения* > Параметры > Ключи доступа > Ключ 1" (или первичный ключ доступа для классической учетной записи хранения). |
| -VMListFile | Файл со списком виртуальных машин, профилирование которых необходимо выполнить, для расчета используемой пропускной способности. Путь к файлу может быть абсолютным или относительным. Этот файл должен содержать по одному имени или IP-адресу виртуальной машины в каждой строке. Имена виртуальных машин, указанные в файле, должны совпадать с именами виртуальных машин на сервере vCenter Server или узле vSphere ESXi.<br>Например, файл VMList.txt содержит следующие виртуальные машины:<ul><li>VM_A;</li><li>10.150.29.110</li><li>VM_B.</li></ul>|
| -Environment | (необязательно) Это целевая среда учетной записи хранения Azure. Этот параметр может иметь одно из трех значений: AzureCloud, AzureUSGovernment, AzureChinaCloud. Значение по умолчанию — AzureCloud. Используйте этот параметр, если ваш целевой регион Azure — Azure для государственных организаций США или Azure для Китая. |

Планировщик создает в указанном каталоге несколько файлов asrvhdfile<#>.vhd емкостью 64 МБ (# — число), а затем передает их в учетную запись хранения для определения пропускной способности. После измерения пропускной способности он удаляет эти файлы из учетной записи хранения и с локального сервера. Если программа по каким-либо причинам прерывает работу, не завершив оценку пропускной способности, она не удаляет файлы. Их необходимо удалить вручную.

Пропускная способность измеряется в определенный момент времени. Это максимальная пропускная способность, которой может достигнуть Site Recovery во время репликации (при условии, что все остальные факторы не изменяются). Например, если любое приложение начинает использовать больший объем пропускной способности сети, тогда фактическая пропускная способность меняется во время репликации. При выполнении команды GetThroughput на сервере конфигурации планировщик не учитывает все защищенные виртуальные машины и непрерывную репликацию. Если выполнить команду GetThroughput на защищенных виртуальных машинах с активной обработкой данных, результаты измерения пропускной способности будут отличаться. Мы рекомендуем запустить программу несколько раз во время профилирования, чтобы оценить, какой пропускной способности можно достигнуть в разные моменты времени. В отчете планировщик отображает последнюю измеренную пропускную способность.

### <a name="example"></a>Пример
```
ASRDeploymentPlanner.exe -Operation GetThroughput -Directory  E:\vCenter1_ProfiledData -VMListFile E:\vCenter1_ProfiledData\ProfileVMList1.txt  -StorageAccountName  asrspfarm1 -StorageAccountKey by8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==
```

>[!NOTE]
>
> Запустите программу на сервере с такими же характеристиками хранилища и ЦП, что и на сервере конфигурации.
>
> При выполнении репликации установите рекомендуемый объем пропускной способности, необходимый для соблюдения требований к RPO в 100 % случаев. Если после установки достаточной пропускной способности результаты в отчете не улучшились, сделайте следующее:
>
>  1. Проверьте наличие требований к качеству обслуживания сети, которые ограничивают пропускную способность Site Recovery.
>
>  2. Проверьте, находится ли хранилище Site Recovery в ближайшем поддерживаемом физическом регионе Microsoft Azure, чтобы минимизировать сетевые задержки.
>
>  3. Проверьте характеристики локального хранилища, чтобы определить, можно ли улучшить оборудование (например, замените жесткие диски на твердотельные).
>
>  4. Измените параметры Site Recovery на сервере обработки, чтобы [увеличить объем пропускной способности сети, необходимой для репликации](./site-recovery-plan-capacity-vmware.md#control-network-bandwidth).

## <a name="next-steps"></a>Дополнительная информация
* [Анализ созданного отчета](site-recovery-vmware-deployment-planner-analyze-report.md)

