---
title: "Архитектура Azure Azure для репликации в Azure Site Recovery | Документы Microsoft"
description: "В этой статье представлен обзор архитектуры и компонентов, используемых для репликации виртуальных машин Azure между регионами Azure с использованием службы Azure Site Recovery."
author: rayne-wiselman
ms.service: site-recovery
ms.topic: article
ms.date: 12/19/2017
ms.author: raynew
ms.openlocfilehash: b37af3462a58f4418653d0e1b2300b5805e0a864
ms.sourcegitcommit: a648f9d7a502bfbab4cd89c9e25aa03d1a0c412b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="azure-to-azure-replication-architecture"></a>Архитектура репликации из Azure в Azure


В этой статье описывается архитектура, используемая при репликации, отработки отказа и восстановления виртуальных машин Azure (ВМ) между регионами Azure, с помощью [Azure Site Recovery](site-recovery-overview.md) службы.

>[!NOTE]
>Сейчас репликация виртуальных машин Azure в службе Site Recovery находится на стадии предварительной версии.



## <a name="architectural-components"></a>Компоненты архитектуры

Следующий рисунок дает общее представление о среде виртуальных машин Azure в определенном регионе (в этом примере — в восточной части США). В среде виртуальных машин Azure:
- Приложения могут работать на виртуальных машинах с дисками, распределенными между учетными записями хранения.
- Виртуальные машины могут находится в одной или нескольких подсетях в виртуальной сети.


**Репликация из Azure в Azure**

![customer-environment](./media/concepts-azure-to-azure-architecture/source-environment.png)

## <a name="replication-process"></a>Процесс репликации

### <a name="step-1"></a>Шаг 1

При включении репликации для виртуальной Машины Azure со следующими ресурсами автоматически создаются в целевой области, на основе параметров области источника. При необходимости можно настроить параметры целевых ресурсов.

![Включение процесса репликации, шаг 1](./media/concepts-azure-to-azure-architecture/enable-replication-step-1.png)

**Ресурс** | **Дополнительные сведения**
--- | ---
**Целевая группа ресурсов** | Группа ресурсов, в которой реплицированные виртуальные машины будут находится после отработки отказа.
**Целевая виртуальная сеть** | Виртуальная сеть, в которой реплицированные виртуальные машины будут находиться после отработки отказа. Сетевое сопоставление создается между исходными и целевыми виртуальными сетями и наоборот.
**Учетная запись хранения** | Прежде чем целевой учетной записи хранения реплицируются изменения исходной виртуальной Машины, отслеживаются и отправляется учетной записи хранилища кэша в исходное расположение. В этом случае минимальное влияние на производственных приложений, работающих на виртуальной Машине.
**Целевые учетные записи хранения**  | Учетные записи хранения в целевом расположении, в которые реплицируются данные.
**Целевая группа доступности**  | Группы доступности, в которых реплицированные виртуальные машины будут находиться после отработки отказа.

### <a name="step-2"></a>Шаг 2

После включения репликации служба мобильности расширения Site Recovery автоматически устанавливается на виртуальной машине:

1. Виртуальная машина регистрируется с помощью Site Recovery.

2. Для виртуальной машины настраивается непрерывная репликация. Операции записи данных на дисках виртуальной машины постоянно передаются в учетную запись хранения кэша в исходном расположении.

   ![Включение процесса репликации, шаг 2](./media/concepts-azure-to-azure-architecture/enable-replication-step-2.png)


 Для Site Recovery никогда не требуется входящее подключение к виртуальной машине. Для следующих требуется только исходящие подключения.

 - URL-адреса и IP-адресов службы восстановления сайта
 - Проверка подлинности Office 365 URL-адреса и IP-адресов
 - Кэш хранилища учетной записи IP-адресов

Если включить согласованность между виртуальными машинами, компьютеры в группе репликации будут обмениваться данными друг с другом через порт 20004. Убедитесь, что нет устройства брандмауэр блокирует внутренний обмен данными между виртуальными машинами через порт 20004.

> [!IMPORTANT]
Если вы хотите виртуальных машин Linux, должен входить в группу репликации, убедитесь, что исходящий трафик через порт 20004 вручную открыть согласно указаниям по конкретной версии Linux.

### <a name="step-3"></a>Шаг 3.

После начала непрерывной репликации операции записи на диск сразу же переносятся в учетную запись хранения кэша. Site Recovery обрабатывает данные и отправляет их в целевую учетную запись хранения. После обработки данных каждые несколько минут в целевой учетной записи хранения создаются точки восстановления.

## <a name="failover-process"></a>Процесс отработки отказа

При запуске отработки отказа виртуальные машины создаются в целевой группе ресурсов, целевой виртуальной сети, целевой подсети и целевой группе доступности. Во время отработки отказа можно использовать любую точку восстановления.

![Процесс отработки отказа](./media/concepts-azure-to-azure-architecture/failover.png)

## <a name="next-steps"></a>Дальнейшие действия

[Быстро реплицировать](azure-to-azure-quickstart.md) ВМ Azure в дополнительный регион.
