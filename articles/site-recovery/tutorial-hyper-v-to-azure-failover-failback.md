---
title: "Отработка отказа и восстановление размещения виртуальных машин Hyper-V, реплицированных в Azure, с помощью Site Recovery | Документация Майкрософт"
description: "Сведения об отработке отказа виртуальных машин Hyper-V в Azure и восстановлении размещения на локальном сайте с помощью Azure Site Recovery"
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: article
ms.date: 12/31/2017
ms.author: raynew
ms.openlocfilehash: 390fe98bc718da4fe07f580bbf1dcbffbf8fc1ba
ms.sourcegitcommit: 9ea2edae5dbb4a104322135bef957ba6e9aeecde
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2018
---
# <a name="fail-over-and-fail-back-hyper-v-vms-replicated-to-azure"></a>Отработка отказа и восстановление размещения виртуальных машин Hyper-V, реплицированных в Azure

В этом руководстве содержатся сведения об отработке отказа виртуальных машин Hyper-V в Azure. Восстановление размещения на локальном сайте после отработки отказа происходит в тех ситуациях, когда это возможно. Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Убедитесь, что свойства виртуальной Машины Hyper-V, чтобы проверить соответствовать требованиям Azure
> * Выполнение отработки отказа в Azure
> * Повторное включение защиты виртуальных машин Azure на локальном сайте
> * Восстановление размещения из Azure в локальную среду
> * Повторное включение защиты локальных виртуальных машин для запуска повторной репликации в Azure

Это пятый учебник в серии. В этом учебнике предполагается, что вы уже выполнили задачи в предыдущих учебниках.

1. [Подготовка Azure](tutorial-prepare-azure.md)
2. [Подготовка локальной среды VMware](tutorial-prepare-on-premises-hyper-v.md).
3. Настройка аварийного восстановления для [виртуальных машин Hyper-V](tutorial-hyper-v-to-azure.md), или для [виртуальных машин Hyper-V управляются в облаках System Center VMM](tutorial-hyper-v-vmm-to-azure.md)
4. [Run a disaster recovery drill to Azure](tutorial-dr-drill-azure.md) (Выполнение отработки аварийного восстановления в Azure)

## <a name="prepare-for-failover-and-failback"></a>Подготовка для отработки отказа и восстановления размещения

Убедитесь, что нет моментальных снимков на виртуальной Машине, и что ВМ локальной выключен во время повторное включение защиты. Это позволяет обеспечить согласованность данных во время репликации. Не включайте виртуальную машину после завершения повторного включения защиты. 

Отработка отказа и восстановление размещения происходит в четыре этапа.

1. **Отработка отказа с переходом в Azure.** Отработка отказа с переносом компьютеров с локального сайта в Azure.
2. **Затем включите защиту виртуальных машин Azure**: Защитите виртуальных машинах Azure, чтобы они начать репликацию обратно на локальных виртуальных машин Hyper-V.
3. **При сбое в локальную среду**: запуск отработки отказа из Azure на локальный узел, если оно доступно.
4. **Повторной защиты локальных виртуальных машин**: после данных произошел сбой обратно, повторно включите защиту виртуальных машин в локальной среде для запуска, копируя их в Azure.

## <a name="verify-vm-properties"></a>Проверка свойств виртуальной машины

Проверьте свойства виртуальной машины и убедитесь, что виртуальная машина соответствует [требованиям Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).

1. В **защищенные элементы**, нажмите кнопку **реплицируются элементы** >< VM-name >.

2. В **элемента реплицированные** области, просмотрите сведения о виртуальной Машины, состояние работоспособности и последние доступные точки восстановления. Щелкните **Свойства**, чтобы просмотреть дополнительные сведения.
     - В **вычисления и сеть**, можно изменить параметры виртуальной Машины и сетевые параметры, включая сеть и подсеть, в которой ВМ Azure. Для восстановления размещения из Azure к Hyper-V, управляемых диски не поддерживаются.
   будет располагаться после отработки отказа и IP-адрес, который будет назначен к нему.
    - В разделе **Диски** отображаются сведения о дисках операционной системы и дисках данных на виртуальной машине.

## <a name="fail-over-to-azure"></a>Отработка отказа с переходом в Azure

1. В разделе **Параметры** > **Реплицированные элементы** выберите виртуальную машину и щелкните **Отработка отказа**.
2. В **перехода на другой ресурс** выберите **последнюю** точку восстановления. 
3. Выберите **завершить работу компьютера перед началом отработки отказа**. Site Recovery попытается выполнить завершение работы источника виртуальных машин перед тем как запускать отработку отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
4. После проверки отработки отказа нажмите **зафиксировать**. При этом будут удалены все доступные точки восстановления.

> [!WARNING]
> **Не отменяйте выполняющуюся отработку отказа**. Перед запуском отработки отказа останавливается репликация виртуальной машины. Если Отмена выполняется останавливается отработка отказа виртуальной Машины будут реплицированы еще раз.

## <a name="reprotect-azure-vms"></a>Повторное включение защиты виртуальных машин Azure

1. В **AzureVMVault** > **реплицируются элементы**, щелкните правой кнопкой мыши виртуальную Машину, перешла и выберите **повторно защитить**.
2. Убедитесь, что направление защиты **Azure к локальной**.
3. Выключить локальной виртуальной Машины во время повторно, чтобы обеспечить согласованность данных. Не включать его после завершения повторное включение защиты.
4. После завершения процесса повторное включение защиты Виртуальная машина будет репликация из Azure в локальном сайте.



## <a name="fail-over-from-azure-and-reprotect-the-on-premises-vm"></a>Переход из Azure и затем включите защиту виртуальной Машины в локальной среде

Выполните отработку отказа из Azure на локальный сайт и начните репликацию виртуальных машин с локального сайта в Azure.

1. В **параметры** > **реплицируются элементы**, щелкните виртуальную Машину > **плановой отработки отказа**.
2. В разделе **Подтвердить плановую отработку отказа** проверьте направление отработки отказа (из Azure) и выберите исходное и целевое расположение.
3. Выберите **синхронизация данных до отработки отказа (синхронизация только изменений)**. Этот параметр сокращает время простоя виртуальной Машины, так как она синхронизирует без выключения виртуальной Машины.
4. Запустите отработку отказа. На вкладке **Задания** можно следить за ходом выполнения отработки отказа.
5. После первоначального данных выполняется синхронизация и вы готовы к выключить виртуальные машины Azure щелкните **заданий** > запланированный-отработки отказа job-name > **завершения отработки отказа**. Эта команда завершит работу виртуальной машины Azure, передаст последние изменения в локальную среду и выполнит запуск локальной виртуальной машины.
6. Войдите в локальную виртуальную машину, чтобы проверить, доступна ли она, как и ожидалось.
7. В локальной виртуальной Машины находится в **ожидания фиксации** состояния. Нажмите кнопку **зафиксировать**. Эта команда удаляет виртуальные машины Azure и их диски, а также подготавливает локальную виртуальную машину к обратной репликации.
Чтобы запустить репликацию локальной виртуальной машины в Azure, включите **обратную репликацию**. Это запускает репликацию изменений, произошедших с момента был выключен в виртуальной Машине Azure.  
