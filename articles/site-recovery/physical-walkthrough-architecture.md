---
title: "Архитектура hello aaaReview для tooAzure репликации физического сервера с помощью Azure Site Recovery | Документы Microsoft"
description: "В этой статье содержится обзор компонентов и архитектуры, используемый при репликационном tooAzure локальных физических серверов со службой Azure Site Recovery hello"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 4f334c181fa6f0821adf978ebe9dbd7d36a3c753
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="step-1-review-hello-architecture-for-physical-server-replication-tooazure"></a><span data-ttu-id="145dc-103">Шаг 1: Проверка hello архитектуры для tooAzure репликации физического сервера</span><span class="sxs-lookup"><span data-stu-id="145dc-103">Step 1: Review hello architecture for physical server replication tooAzure</span></span>

<span data-ttu-id="145dc-104">В этой статье описываются компоненты hello и процессы, которые используются при репликации tooAzure физических серверов Windows и Linux в локальной среде, с помощью hello [Azure Site Recovery](site-recovery-overview.md) службы.</span><span class="sxs-lookup"><span data-stu-id="145dc-104">This article describes hello components and processes used when you replicate on-premises Windows/Linux physical servers tooAzure, using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="145dc-105">Отправлять все комментарии hello нижней части этой статьи, или задать вопросы в hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="145dc-105">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="145dc-106">Компоненты архитектуры</span><span class="sxs-lookup"><span data-stu-id="145dc-106">Architectural components</span></span>

<span data-ttu-id="145dc-107">Hello таблице перечислены компоненты hello.</span><span class="sxs-lookup"><span data-stu-id="145dc-107">hello table summarizes hello components you need.</span></span>

<span data-ttu-id="145dc-108">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="145dc-108">**Component**</span></span> | <span data-ttu-id="145dc-109">**Требование**</span><span class="sxs-lookup"><span data-stu-id="145dc-109">**Requirement**</span></span> | <span data-ttu-id="145dc-110">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="145dc-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="145dc-111">**Таблицы Azure**</span><span class="sxs-lookup"><span data-stu-id="145dc-111">**Azure**</span></span> | <span data-ttu-id="145dc-112">Вам потребуется учетная запись Azure, учетная запись хранения Azure и сеть Azure.</span><span class="sxs-lookup"><span data-stu-id="145dc-112">You need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="145dc-113">Реплицированные данные хранятся в учетной записи хранения hello и виртуальные машины Azure создаются с hello реплицированных данных при отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="145dc-113">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover occurs.</span></span> <span data-ttu-id="145dc-114">Виртуальные машины Azure соединить toohello виртуальной сети Azure, если они создаются.</span><span class="sxs-lookup"><span data-stu-id="145dc-114">Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="145dc-115">**Сервер конфигурации**</span><span class="sxs-lookup"><span data-stu-id="145dc-115">**Configuration server**</span></span> | <span data-ttu-id="145dc-116">Один локального сервера управления (физический сервер или виртуальная машина VMware), запускает все hello локальные компоненты Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="145dc-116">A single on-premises management server (physical server or VMware VM) that runs all hello on-premises Site Recovery components.</span></span> <span data-ttu-id="145dc-117">К ним относятся сервер конфигурации, сервер обработки и главный целевой сервер.</span><span class="sxs-lookup"><span data-stu-id="145dc-117">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="145dc-118">Hello конфигурации серверного компонента координирует взаимодействие между локальной средой и Azure и управляет репликацией данных.</span><span class="sxs-lookup"><span data-stu-id="145dc-118">hello configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="145dc-119">**Сервер обработки**</span><span class="sxs-lookup"><span data-stu-id="145dc-119">**Process server**</span></span>  | <span data-ttu-id="145dc-120">Устанавливается по умолчанию на сервере конфигурации hello.</span><span class="sxs-lookup"><span data-stu-id="145dc-120">Installed by default on hello configuration server.</span></span> | <span data-ttu-id="145dc-121">Выступает в качестве шлюза репликации.</span><span class="sxs-lookup"><span data-stu-id="145dc-121">Acts as a replication gateway.</span></span> <span data-ttu-id="145dc-122">Получает данные репликации, выполняет оптимизацию для кэширования, сжатия и шифрования и отправляет его tooAzure хранилища.</span><span class="sxs-lookup"><span data-stu-id="145dc-122">Receives replication data, optimizes it with caching, compression, and encryption, and sends it tooAzure storage.</span></span><br/><br/> <span data-ttu-id="145dc-123">сервер обработки Hello также обрабатывает принудительной установки службы tooprotected hello Mobility машин.</span><span class="sxs-lookup"><span data-stu-id="145dc-123">hello process server also handles push installation of hello Mobility service tooprotected machines.</span></span><br/><br/> <span data-ttu-id="145dc-124">Можно добавить дополнительные отдельном выделенном процессе серверов, toohandle увеличение объемов трафика репликации.</span><span class="sxs-lookup"><span data-stu-id="145dc-124">You can add additional separate dedicated process servers, toohandle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="145dc-125">**Главный целевой сервер**</span><span class="sxs-lookup"><span data-stu-id="145dc-125">**Master target server**</span></span> | <span data-ttu-id="145dc-126">Устанавливается по умолчанию на сервере конфигурации локальной hello.</span><span class="sxs-lookup"><span data-stu-id="145dc-126">Installed by default on hello on-premises configuration server.</span></span> | <span data-ttu-id="145dc-127">Обрабатывает данные репликации при восстановлении размещения с переносом из Azure.</span><span class="sxs-lookup"><span data-stu-id="145dc-127">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="145dc-128">Если объемы трафика восстановления размещения высоки, можно развернуть отдельный главный целевой сервер.</span><span class="sxs-lookup"><span data-stu-id="145dc-128">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="145dc-129">**Реплицированные серверы**</span><span class="sxs-lookup"><span data-stu-id="145dc-129">**Replicated servers**</span></span> | <span data-ttu-id="145dc-130">Hello Mobility установки службы на каждом сервере Windows или Linux требуется tooreplicate.</span><span class="sxs-lookup"><span data-stu-id="145dc-130">hello Mobility service component is installed on each Windows/Linux server you want tooreplicate.</span></span> <span data-ttu-id="145dc-131">Его можно установить вручную на каждом компьютере или с помощью принудительной установки с сервера обработки hello.</span><span class="sxs-lookup"><span data-stu-id="145dc-131">It can be installed manually on each machine, or with a push installation from hello process server.</span></span>
<span data-ttu-id="145dc-132">**Восстановление размещения**</span><span class="sxs-lookup"><span data-stu-id="145dc-132">**Failback**</span></span> | <span data-ttu-id="145dc-133">Чтобы восстановить размещение, требуется инфраструктура VMware.</span><span class="sxs-lookup"><span data-stu-id="145dc-133">For failback a VMware infrastructure is required.</span></span> <span data-ttu-id="145dc-134">Нельзя отметить как не задней tooa физического сервера.</span><span class="sxs-lookup"><span data-stu-id="145dc-134">You can't fail back tooa physical server.</span></span>


<span data-ttu-id="145dc-135">**Рис. 1: Компоненты физического tooAzure**</span><span class="sxs-lookup"><span data-stu-id="145dc-135">**Figure 1: Physical tooAzure components**</span></span>

![Компоненты](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="145dc-137">Процесс репликации</span><span class="sxs-lookup"><span data-stu-id="145dc-137">Replication process</span></span>

1. <span data-ttu-id="145dc-138">Настройка развертывания hello, включая локальные и компонентах Azure.</span><span class="sxs-lookup"><span data-stu-id="145dc-138">You set up hello deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="145dc-139">В хранилище служб восстановления hello укажите hello репликации исходное и целевое, Настройка сервера конфигурации hello, создайте политику репликации, развернуть службу Mobility hello, включение репликации и запустите тестовую отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="145dc-139">In hello Recovery Services vault, you specify hello replication source and target, set up hello configuration server, create a replication policy, deploy hello Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="145dc-140">Реплицировать машины в соответствии с политикой репликации hello и исходную копию данных hello является реплицированной tooAzure хранения.</span><span class="sxs-lookup"><span data-stu-id="145dc-140">Machines replicate in accordance with hello replication policy, and an initial copy of hello data is replicated tooAzure storage.</span></span>
4. <span data-ttu-id="145dc-141">После завершения начальной репликации начинает репликацию tooAzure разностных изменений.</span><span class="sxs-lookup"><span data-stu-id="145dc-141">After initial replication finishes, replication of delta changes tooAzure begins.</span></span> <span data-ttu-id="145dc-142">Отслеживаемые изменения для компьютера хранятся в HRL-файле.</span><span class="sxs-lookup"><span data-stu-id="145dc-142">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="145dc-143">Репликацию машин взаимодействуют с сервером конфигурации hello через порт 443 для HTTPS входящего трафика для управления репликацией.</span><span class="sxs-lookup"><span data-stu-id="145dc-143">Replicating machines communicate with hello configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="145dc-144">Репликацию машины отправляют сервера обработки toohello репликации данных через порт HTTPS 9443 входящих (изменить).</span><span class="sxs-lookup"><span data-stu-id="145dc-144">Replicating machines send replication data toohello process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="145dc-145">Сервер конфигурации Hello управляет управление репликацией с помощью Azure через порт 443 для исходящих подключений HTTPS.</span><span class="sxs-lookup"><span data-stu-id="145dc-145">hello configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="145dc-146">Hello сервера обработки получает данные из исходных компьютеров, оптимизирует и шифрует его и отправляет его хранения tooAzure через порт номер 443 исходящего.</span><span class="sxs-lookup"><span data-stu-id="145dc-146">hello process server receives data from source machines, optimizes and encrypts it, and sends it tooAzure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="145dc-147">При включении согласованность нескольких виртуальных Машин, затем машины в группу репликации hello взаимодействовать друг с другом через порт 20004.</span><span class="sxs-lookup"><span data-stu-id="145dc-147">If you enable multi-VM consistency, then machines in hello replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="145dc-148">Эту функция используется, если вы объединяете несколько компьютеров в группы репликации, и они совместно используют отказоустойчивые и согласованные точки восстановления после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="145dc-148">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="145dc-149">Это полезно, если компьютеры работают под управлением hello же рабочую нагрузку и требуют toobe согласованной.</span><span class="sxs-lookup"><span data-stu-id="145dc-149">This is useful if machines are running hello same workload and need toobe consistent.</span></span>
5. <span data-ttu-id="145dc-150">Трафик реплицированных tooAzure хранения общедоступных конечных точек, более чем hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="145dc-150">Traffic is replicated tooAzure storage public endpoints, over hello internet.</span></span> <span data-ttu-id="145dc-151">Кроме того, можно использовать [общедоступный пиринг](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="145dc-151">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="145dc-152">Репликация трафика через виртуальную частную сеть сайт сайт с локального сайта tooAzure не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="145dc-152">Replicating traffic over a site-to-site VPN from an on-premises site tooAzure isn't supported.</span></span>

<span data-ttu-id="145dc-153">**Рис. 2: Репликация физических tooAzure**</span><span class="sxs-lookup"><span data-stu-id="145dc-153">**Figure 2: Physical tooAzure replication**</span></span>

![Расширенная архитектура](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="145dc-155">Процесс отработки отказа и восстановления размещения</span><span class="sxs-lookup"><span data-stu-id="145dc-155">Failover and failback process</span></span>

<span data-ttu-id="145dc-156">Убедившись, что тестовой отработки отказа работает должным образом, при необходимости можно запустить tooAzure незапланированной отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="145dc-156">After you verify that test failover is working as expected, you can run unplanned failovers tooAzure as required.</span></span> <span data-ttu-id="145dc-157">При выполнении отработки отказа из реплицированных данных создаются виртуальные машины Azure.</span><span class="sxs-lookup"><span data-stu-id="145dc-157">When you run a failover, Azure VMs are created from replicated data.</span></span> <span data-ttu-id="145dc-158">Когда основной локальный сайт снова станет доступным, вы сможете выполнить восстановление размещения.</span><span class="sxs-lookup"><span data-stu-id="145dc-158">Then, when your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="145dc-159">Обратите внимание на следующее.</span><span class="sxs-lookup"><span data-stu-id="145dc-159">Note that:</span></span>

- <span data-ttu-id="145dc-160">Плановая отработка отказа не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="145dc-160">Planned failover isn't supported.</span></span>
- <span data-ttu-id="145dc-161">При сбое одного компьютера или создайте [планы восстановления](site-recovery-create-recovery-plans.md), toofail по нескольким компьютерам вместе.</span><span class="sxs-lookup"><span data-stu-id="145dc-161">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), toofail over multiple machines together.</span></span>
- <span data-ttu-id="145dc-162">Фиксация отработки отказа toostart доступ к hello рабочей нагрузки из hello реплики виртуальной Машины Azure.</span><span class="sxs-lookup"><span data-stu-id="145dc-162">You commit a failover toostart accessing hello workload from hello replica Azure VM.</span></span>
- <span data-ttu-id="145dc-163">Когда hello первичном сайте снова станет доступной, машины hello репликации с первичного сайта вторичного toohello hello.</span><span class="sxs-lookup"><span data-stu-id="145dc-163">When hello primary site is available again, you replicate hello machine from hello secondary toohello primary site.</span></span> <span data-ttu-id="145dc-164">Затем запустите незапланированной отработки отказа с hello вторичного сайта.</span><span class="sxs-lookup"><span data-stu-id="145dc-164">Then, run an unplanned failover from hello secondary site.</span></span> <span data-ttu-id="145dc-165">После фиксации этой отработки отказа, данные будут назад в локальной и требуется tooAzure tooenable репликации.</span><span class="sxs-lookup"><span data-stu-id="145dc-165">After you commit this failover, data will be back on-premises, and you need tooenable replication tooAzure again.</span></span>

<span data-ttu-id="145dc-166">Компоненты восстановления размещения:</span><span class="sxs-lookup"><span data-stu-id="145dc-166">Failback components include:</span></span>

- <span data-ttu-id="145dc-167">**Сервер обработки временных в Azure**: требуется tooset копирование tooact виртуальной Машине Azure, что и сервер обработки, toohandle репликация из Azure.</span><span class="sxs-lookup"><span data-stu-id="145dc-167">**Temporary process server in Azure**: You need tooset up an Azure VM tooact as a process server, toohandle replication from Azure.</span></span> <span data-ttu-id="145dc-168">После восстановления размещения эту виртуальную машину можно удалить.</span><span class="sxs-lookup"><span data-stu-id="145dc-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="145dc-169">**VPN-подключение**: требуется от hello Azure toohello локального сайта сети VPN-подключение (или Azure ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="145dc-169">**VPN connection**: You need a VPN connection (or Azure ExpressRoute) from hello Azure network toohello on-premises site.</span></span>
- <span data-ttu-id="145dc-170">**Отдельный локальный главный целевой сервер**: hello локальный главный целевой сервер (устанавливается по умолчанию на сервере конфигурации hello) обрабатывает восстановления размещения.</span><span class="sxs-lookup"><span data-stu-id="145dc-170">**Separate on-premises master target server**: hello on-premises master target server (installed by default on hello configuration server) handles failback.</span></span> <span data-ttu-id="145dc-171">При восстановлении размещения больших объемов трафика настройте отдельный локальный главный целевой сервер.</span><span class="sxs-lookup"><span data-stu-id="145dc-171">If you fail back large volumes of traffic, you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="145dc-172">**Политика восстановления размещения.** Необходима политика восстановления размещения.</span><span class="sxs-lookup"><span data-stu-id="145dc-172">**Failback policy**: You need a failback policy.</span></span> <span data-ttu-id="145dc-173">Она создается автоматически во время создания политики репликации.</span><span class="sxs-lookup"><span data-stu-id="145dc-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="145dc-174">**Инфраструктура VMware**: необходимо сбоя tooan локальной виртуальной Машины VMware.</span><span class="sxs-lookup"><span data-stu-id="145dc-174">**VMware infrastructure**: You must fail back tooan on-premises VMware VM.</span></span> <span data-ttu-id="145dc-175">Это означает, что требуется локальная инфраструктура VMware, даже если выполняется репликация tooAzure локальных физических серверов.</span><span class="sxs-lookup"><span data-stu-id="145dc-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers tooAzure.</span></span>

<span data-ttu-id="145dc-176">**Рис. 3. Восстановление размещения физического сервера**</span><span class="sxs-lookup"><span data-stu-id="145dc-176">**Figure 3: Physical server failback**</span></span>

![Восстановление размещения](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="145dc-178">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="145dc-178">Next steps</span></span>

<span data-ttu-id="145dc-179">Go слишком[шаг 2: Проверьте предварительные условия и ограничения](physical-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="145dc-179">Go too[Step 2: Verify prerequisites and limitations](physical-walkthrough-prerequisites.md)</span></span>
