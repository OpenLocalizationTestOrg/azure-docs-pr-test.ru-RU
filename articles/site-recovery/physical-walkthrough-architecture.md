---
title: "Общие сведения об архитектуре репликации физического сервера в Azure с помощью Azure Site Recovery | Документация Майкрософт"
description: "В этой статье представлен обзор компонентов и архитектуры, используемых при репликации физических серверов из локальной среды в Azure с помощью службы Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 843c3f1b54f50fe50b162ed242deab717a080830
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-physical-server-replication-to-azure"></a>Шаг 1. Обзор архитектуры репликации физического сервера в Azure

В этой статье описываются компоненты и процессы, задействованные при репликации локальных физических серверов Windows или Linux в Azure с помощью службы [Azure Site Recovery](site-recovery-overview.md).

Все комментарии можно добавить в конце этой статьи. Вопросы можно задать на [форуме по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).


## <a name="architectural-components"></a>Компоненты архитектуры

В этой таблице приведены необходимые компоненты.

**Компонент** | **Требование** | **Дополнительные сведения**
--- | --- | ---
**Таблицы Azure** | Вам потребуется учетная запись Azure, учетная запись хранения Azure и сеть Azure. | Реплицированные данные хранятся в учетной записи хранения, а виртуальные машины Azure создаются с использованием реплицированных данных при отработке отказа. При создании виртуальные машины Azure подключаются к виртуальной сети Azure.
**Сервер конфигурации** | Обособленный локальный сервер управления (физический сервер или виртуальная машина VMware), на котором работают все необходимые локальные компоненты. К ним относятся сервер конфигурации, сервер обработки и главный целевой сервер. | Компонент сервера конфигурации используется для координации обмена данными между локальным источником и Azure, а также для управления репликацией данных.
 **Сервер обработки**  | По умолчанию устанавливается на сервере конфигурации. | Выступает в качестве шлюза репликации. Получает данные репликации, оптимизирует их путем кэширования, сжатия и шифрования и отправляет эти данные в службу хранилища Azure.<br/><br/> Сервер обработки также обеспечивает принудительную установку службы Mobility Service на защищенные компьютеры.<br/><br/> Вы можете добавлять дополнительные выделенные серверы для обработки растущего объема данных репликации.
 **Главный целевой сервер** | По умолчанию устанавливается на локальном сервере конфигурации. | Обрабатывает данные репликации при восстановлении размещения с переносом из Azure.<br/><br/> Если объемы трафика восстановления размещения высоки, можно развернуть отдельный главный целевой сервер.
**Реплицированные серверы** | Компонент службы Mobility Service, который устанавливается на каждом реплицируемом сервере Windows или Linux. Ее можно установить вручную или с помощью принудительной установки с сервера обработки.
**Восстановление размещения** | Чтобы восстановить размещение, требуется инфраструктура VMware. Восстанавливать размещение на физический сервер нельзя.


**Рис. 1. Физические компоненты, реплицируемые в Azure**

![Компоненты](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a>Процесс репликации

1. Необходимо настроить развертывание, в том числе локальные компоненты и компоненты Azure. В хранилище служб восстановления необходимо указать источник и целевой объект репликации, настроить сервер конфигурации, создать политику репликации, развернуть службу Mobility Service, включить репликацию и запустить тестовую отработку отказа.
2.  Компьютеры выполняют репликацию в соответствии с политикой репликации, а репликация начальной копии данных выполняется в службу хранилища Azure.
4. После завершения начальной репликации начинается репликация разностных изменений в Azure. Отслеживаемые изменения для компьютера хранятся в HRL-файле.
    - Реплицируемые компьютеры обмениваются данными с сервером конфигурации через порт HTTPS 443 для входящих подключений для управления репликацией.
    - Реплицируемые компьютеры отправляют данные репликации на сервер обработки через порт HTTPS 9443 для входящих подключений (можно изменить).
    - Сервер конфигурации выполняет оркестрацию управления репликацией с Azure через порт HTTPS 443 для исходящих подключений.
    - Сервер обработки получает данные с исходных компьютеров, оптимизирует и зашифровывает их, а затем отправляет их в службу хранилища Azure через порт 443 для исходящих подключений.
    - Если включить согласованность между виртуальными машинами, компьютеры в группе репликации будут обмениваться данными друг с другом через порт 20004. Эту функция используется, если вы объединяете несколько компьютеров в группы репликации, и они совместно используют отказоустойчивые и согласованные точки восстановления после отработки отказа. Это полезно, если на компьютерах выполняется одна и та же рабочая нагрузка и они должны быть согласованы.
5. Трафик реплицируется в общедоступные конечные точки службы хранилища Azure через Интернет. Кроме того, можно использовать [общедоступный пиринг](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute. Репликация трафика через VPN типа "сеть — сеть" с локального сайта в Azure не поддерживается.

**Рис. 2. Репликация физических компонентов в Azure**

![Расширенная архитектура](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a>Процесс отработки отказа и восстановления размещения

Убедившись, что тестовая отработка отказа работает правильно, при необходимости выполните незапланированную отработку отказа в Azure. При выполнении отработки отказа из реплицированных данных создаются виртуальные машины Azure. Когда основной локальный сайт снова станет доступным, вы сможете выполнить восстановление размещения. Обратите внимание на следующее.

- Плановая отработка отказа не поддерживается.
- Вы можете выполнить отработку отказа одного компьютера или создать [планы восстановления](site-recovery-create-recovery-plans.md), чтобы выполнить отработку отказа нескольких компьютеров.
- Фиксация отработки отказа выполняется для получения доступа к рабочей нагрузке из виртуальной машины реплики Azure.
- Когда основной локальный сайт снова станет доступным, вы сможете выполнить репликацию компьютера из вторичного сайта на основной. Затем выполните незапланированную отработку отказа на дополнительном сайте. После того, как это восстановление размещения будет зафиксировано, данные переместятся обратно в локальное расположение, и вам понадобится включить репликацию в Azure снова.

Компоненты восстановления размещения:

- **Временный сервер обработки в Azure.** Необходимо настроить виртуальную машину Azure как сервер обработки. Это позволит выполнять репликацию из Azure. После восстановления размещения эту виртуальную машину можно удалить.
- **VPN-подключение.** Необходимо настроить подключение VPN (или Azure ExpressRoute) между сетью Azure и локальным размещением.
- **Отдельный локальный главный целевой сервер.** Локальный главный целевой сервер (по умолчанию устанавливается на сервере конфигурации) обрабатывает восстановление размещения. При восстановлении размещения больших объемов трафика настройте отдельный локальный главный целевой сервер.
- **Политика восстановления размещения.** Необходима политика восстановления размещения. Она создается автоматически во время создания политики репликации.
- **Инфраструктура VMware.** Размещение необходимо восстанавливать на локальную виртуальную машину VMware. Это означает, что даже при репликации локальных физических серверов в Azure требуется локальная инфраструктура VMware.

**Рис. 3. Восстановление размещения физического сервера**

![Восстановление размещения](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a>Дальнейшие действия

Перейдите к разделу [Шаг 2. Проверка предварительных требований для репликации из VMware в Azure](physical-walkthrough-prerequisites.md).
