---
title: "Общие сведения об архитектуре репликации физического сервера в Azure с помощью Azure Site Recovery | Документация Майкрософт"
description: "В этой статье представлен обзор компонентов и архитектуры, используемых при репликации физических серверов из локальной среды в Azure с помощью службы Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 843c3f1b54f50fe50b162ed242deab717a080830
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-physical-server-replication-to-azure"></a><span data-ttu-id="5ae05-103">Шаг 1. Обзор архитектуры репликации физического сервера в Azure</span><span class="sxs-lookup"><span data-stu-id="5ae05-103">Step 1: Review the architecture for physical server replication to Azure</span></span>

<span data-ttu-id="5ae05-104">В этой статье описываются компоненты и процессы, задействованные при репликации локальных физических серверов Windows или Linux в Azure с помощью службы [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5ae05-104">This article describes the components and processes used when you replicate on-premises Windows/Linux physical servers to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="5ae05-105">Все комментарии можно добавить в конце этой статьи. Вопросы можно задать на [форуме по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="5ae05-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="5ae05-106">Компоненты архитектуры</span><span class="sxs-lookup"><span data-stu-id="5ae05-106">Architectural components</span></span>

<span data-ttu-id="5ae05-107">В этой таблице приведены необходимые компоненты.</span><span class="sxs-lookup"><span data-stu-id="5ae05-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="5ae05-108">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="5ae05-108">**Component**</span></span> | <span data-ttu-id="5ae05-109">**Требование**</span><span class="sxs-lookup"><span data-stu-id="5ae05-109">**Requirement**</span></span> | <span data-ttu-id="5ae05-110">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="5ae05-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="5ae05-111">**Таблицы Azure**</span><span class="sxs-lookup"><span data-stu-id="5ae05-111">**Azure**</span></span> | <span data-ttu-id="5ae05-112">Вам потребуется учетная запись Azure, учетная запись хранения Azure и сеть Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-112">You need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="5ae05-113">Реплицированные данные хранятся в учетной записи хранения, а виртуальные машины Azure создаются с использованием реплицированных данных при отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="5ae05-113">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover occurs.</span></span> <span data-ttu-id="5ae05-114">При создании виртуальные машины Azure подключаются к виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-114">Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="5ae05-115">**Сервер конфигурации**</span><span class="sxs-lookup"><span data-stu-id="5ae05-115">**Configuration server**</span></span> | <span data-ttu-id="5ae05-116">Обособленный локальный сервер управления (физический сервер или виртуальная машина VMware), на котором работают все необходимые локальные компоненты.</span><span class="sxs-lookup"><span data-stu-id="5ae05-116">A single on-premises management server (physical server or VMware VM) that runs all the on-premises Site Recovery components.</span></span> <span data-ttu-id="5ae05-117">К ним относятся сервер конфигурации, сервер обработки и главный целевой сервер.</span><span class="sxs-lookup"><span data-stu-id="5ae05-117">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="5ae05-118">Компонент сервера конфигурации используется для координации обмена данными между локальным источником и Azure, а также для управления репликацией данных.</span><span class="sxs-lookup"><span data-stu-id="5ae05-118">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="5ae05-119">**Сервер обработки**</span><span class="sxs-lookup"><span data-stu-id="5ae05-119">**Process server**</span></span>  | <span data-ttu-id="5ae05-120">По умолчанию устанавливается на сервере конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5ae05-120">Installed by default on the configuration server.</span></span> | <span data-ttu-id="5ae05-121">Выступает в качестве шлюза репликации.</span><span class="sxs-lookup"><span data-stu-id="5ae05-121">Acts as a replication gateway.</span></span> <span data-ttu-id="5ae05-122">Получает данные репликации, оптимизирует их путем кэширования, сжатия и шифрования и отправляет эти данные в службу хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-122">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="5ae05-123">Сервер обработки также обеспечивает принудительную установку службы Mobility Service на защищенные компьютеры.</span><span class="sxs-lookup"><span data-stu-id="5ae05-123">The process server also handles push installation of the Mobility service to protected machines.</span></span><br/><br/> <span data-ttu-id="5ae05-124">Вы можете добавлять дополнительные выделенные серверы для обработки растущего объема данных репликации.</span><span class="sxs-lookup"><span data-stu-id="5ae05-124">You can add additional separate dedicated process servers, to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="5ae05-125">**Главный целевой сервер**</span><span class="sxs-lookup"><span data-stu-id="5ae05-125">**Master target server**</span></span> | <span data-ttu-id="5ae05-126">По умолчанию устанавливается на локальном сервере конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5ae05-126">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="5ae05-127">Обрабатывает данные репликации при восстановлении размещения с переносом из Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-127">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="5ae05-128">Если объемы трафика восстановления размещения высоки, можно развернуть отдельный главный целевой сервер.</span><span class="sxs-lookup"><span data-stu-id="5ae05-128">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="5ae05-129">**Реплицированные серверы**</span><span class="sxs-lookup"><span data-stu-id="5ae05-129">**Replicated servers**</span></span> | <span data-ttu-id="5ae05-130">Компонент службы Mobility Service, который устанавливается на каждом реплицируемом сервере Windows или Linux.</span><span class="sxs-lookup"><span data-stu-id="5ae05-130">The Mobility service component is installed on each Windows/Linux server you want to replicate.</span></span> <span data-ttu-id="5ae05-131">Ее можно установить вручную или с помощью принудительной установки с сервера обработки.</span><span class="sxs-lookup"><span data-stu-id="5ae05-131">It can be installed manually on each machine, or with a push installation from the process server.</span></span>
<span data-ttu-id="5ae05-132">**Восстановление размещения**</span><span class="sxs-lookup"><span data-stu-id="5ae05-132">**Failback**</span></span> | <span data-ttu-id="5ae05-133">Чтобы восстановить размещение, требуется инфраструктура VMware.</span><span class="sxs-lookup"><span data-stu-id="5ae05-133">For failback a VMware infrastructure is required.</span></span> <span data-ttu-id="5ae05-134">Восстанавливать размещение на физический сервер нельзя.</span><span class="sxs-lookup"><span data-stu-id="5ae05-134">You can't fail back to a physical server.</span></span>


<span data-ttu-id="5ae05-135">**Рис. 1. Физические компоненты, реплицируемые в Azure**</span><span class="sxs-lookup"><span data-stu-id="5ae05-135">**Figure 1: Physical to Azure components**</span></span>

![Компоненты](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="5ae05-137">Процесс репликации</span><span class="sxs-lookup"><span data-stu-id="5ae05-137">Replication process</span></span>

1. <span data-ttu-id="5ae05-138">Необходимо настроить развертывание, в том числе локальные компоненты и компоненты Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-138">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="5ae05-139">В хранилище служб восстановления необходимо указать источник и целевой объект репликации, настроить сервер конфигурации, создать политику репликации, развернуть службу Mobility Service, включить репликацию и запустить тестовую отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="5ae05-139">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="5ae05-140">Компьютеры выполняют репликацию в соответствии с политикой репликации, а репликация начальной копии данных выполняется в службу хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-140">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
4. <span data-ttu-id="5ae05-141">После завершения начальной репликации начинается репликация разностных изменений в Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-141">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="5ae05-142">Отслеживаемые изменения для компьютера хранятся в HRL-файле.</span><span class="sxs-lookup"><span data-stu-id="5ae05-142">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="5ae05-143">Реплицируемые компьютеры обмениваются данными с сервером конфигурации через порт HTTPS 443 для входящих подключений для управления репликацией.</span><span class="sxs-lookup"><span data-stu-id="5ae05-143">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="5ae05-144">Реплицируемые компьютеры отправляют данные репликации на сервер обработки через порт HTTPS 9443 для входящих подключений (можно изменить).</span><span class="sxs-lookup"><span data-stu-id="5ae05-144">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="5ae05-145">Сервер конфигурации выполняет оркестрацию управления репликацией с Azure через порт HTTPS 443 для исходящих подключений.</span><span class="sxs-lookup"><span data-stu-id="5ae05-145">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="5ae05-146">Сервер обработки получает данные с исходных компьютеров, оптимизирует и зашифровывает их, а затем отправляет их в службу хранилища Azure через порт 443 для исходящих подключений.</span><span class="sxs-lookup"><span data-stu-id="5ae05-146">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="5ae05-147">Если включить согласованность между виртуальными машинами, компьютеры в группе репликации будут обмениваться данными друг с другом через порт 20004.</span><span class="sxs-lookup"><span data-stu-id="5ae05-147">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="5ae05-148">Эту функция используется, если вы объединяете несколько компьютеров в группы репликации, и они совместно используют отказоустойчивые и согласованные точки восстановления после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="5ae05-148">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="5ae05-149">Это полезно, если на компьютерах выполняется одна и та же рабочая нагрузка и они должны быть согласованы.</span><span class="sxs-lookup"><span data-stu-id="5ae05-149">This is useful if machines are running the same workload and need to be consistent.</span></span>
5. <span data-ttu-id="5ae05-150">Трафик реплицируется в общедоступные конечные точки службы хранилища Azure через Интернет.</span><span class="sxs-lookup"><span data-stu-id="5ae05-150">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="5ae05-151">Кроме того, можно использовать [общедоступный пиринг](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5ae05-151">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="5ae05-152">Репликация трафика через VPN типа "сеть — сеть" с локального сайта в Azure не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="5ae05-152">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>

<span data-ttu-id="5ae05-153">**Рис. 2. Репликация физических компонентов в Azure**</span><span class="sxs-lookup"><span data-stu-id="5ae05-153">**Figure 2: Physical to Azure replication**</span></span>

![Расширенная архитектура](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="5ae05-155">Процесс отработки отказа и восстановления размещения</span><span class="sxs-lookup"><span data-stu-id="5ae05-155">Failover and failback process</span></span>

<span data-ttu-id="5ae05-156">Убедившись, что тестовая отработка отказа работает правильно, при необходимости выполните незапланированную отработку отказа в Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-156">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="5ae05-157">При выполнении отработки отказа из реплицированных данных создаются виртуальные машины Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-157">When you run a failover, Azure VMs are created from replicated data.</span></span> <span data-ttu-id="5ae05-158">Когда основной локальный сайт снова станет доступным, вы сможете выполнить восстановление размещения.</span><span class="sxs-lookup"><span data-stu-id="5ae05-158">Then, when your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="5ae05-159">Обратите внимание на следующее.</span><span class="sxs-lookup"><span data-stu-id="5ae05-159">Note that:</span></span>

- <span data-ttu-id="5ae05-160">Плановая отработка отказа не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="5ae05-160">Planned failover isn't supported.</span></span>
- <span data-ttu-id="5ae05-161">Вы можете выполнить отработку отказа одного компьютера или создать [планы восстановления](site-recovery-create-recovery-plans.md), чтобы выполнить отработку отказа нескольких компьютеров.</span><span class="sxs-lookup"><span data-stu-id="5ae05-161">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple machines together.</span></span>
- <span data-ttu-id="5ae05-162">Фиксация отработки отказа выполняется для получения доступа к рабочей нагрузке из виртуальной машины реплики Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-162">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
- <span data-ttu-id="5ae05-163">Когда основной локальный сайт снова станет доступным, вы сможете выполнить репликацию компьютера из вторичного сайта на основной.</span><span class="sxs-lookup"><span data-stu-id="5ae05-163">When the primary site is available again, you replicate the machine from the secondary to the primary site.</span></span> <span data-ttu-id="5ae05-164">Затем выполните незапланированную отработку отказа на дополнительном сайте.</span><span class="sxs-lookup"><span data-stu-id="5ae05-164">Then, run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="5ae05-165">После того, как это восстановление размещения будет зафиксировано, данные переместятся обратно в локальное расположение, и вам понадобится включить репликацию в Azure снова.</span><span class="sxs-lookup"><span data-stu-id="5ae05-165">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span>

<span data-ttu-id="5ae05-166">Компоненты восстановления размещения:</span><span class="sxs-lookup"><span data-stu-id="5ae05-166">Failback components include:</span></span>

- <span data-ttu-id="5ae05-167">**Временный сервер обработки в Azure.** Необходимо настроить виртуальную машину Azure как сервер обработки. Это позволит выполнять репликацию из Azure.</span><span class="sxs-lookup"><span data-stu-id="5ae05-167">**Temporary process server in Azure**: You need to set up an Azure VM to act as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="5ae05-168">После восстановления размещения эту виртуальную машину можно удалить.</span><span class="sxs-lookup"><span data-stu-id="5ae05-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="5ae05-169">**VPN-подключение.** Необходимо настроить подключение VPN (или Azure ExpressRoute) между сетью Azure и локальным размещением.</span><span class="sxs-lookup"><span data-stu-id="5ae05-169">**VPN connection**: You need a VPN connection (or Azure ExpressRoute) from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="5ae05-170">**Отдельный локальный главный целевой сервер.** Локальный главный целевой сервер (по умолчанию устанавливается на сервере конфигурации) обрабатывает восстановление размещения.</span><span class="sxs-lookup"><span data-stu-id="5ae05-170">**Separate on-premises master target server**: The on-premises master target server (installed by default on the configuration server) handles failback.</span></span> <span data-ttu-id="5ae05-171">При восстановлении размещения больших объемов трафика настройте отдельный локальный главный целевой сервер.</span><span class="sxs-lookup"><span data-stu-id="5ae05-171">If you fail back large volumes of traffic, you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="5ae05-172">**Политика восстановления размещения.** Необходима политика восстановления размещения.</span><span class="sxs-lookup"><span data-stu-id="5ae05-172">**Failback policy**: You need a failback policy.</span></span> <span data-ttu-id="5ae05-173">Она создается автоматически во время создания политики репликации.</span><span class="sxs-lookup"><span data-stu-id="5ae05-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="5ae05-174">**Инфраструктура VMware.** Размещение необходимо восстанавливать на локальную виртуальную машину VMware.</span><span class="sxs-lookup"><span data-stu-id="5ae05-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="5ae05-175">Это означает, что даже при репликации локальных физических серверов в Azure требуется локальная инфраструктура VMware.</span><span class="sxs-lookup"><span data-stu-id="5ae05-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="5ae05-176">**Рис. 3. Восстановление размещения физического сервера**</span><span class="sxs-lookup"><span data-stu-id="5ae05-176">**Figure 3: Physical server failback**</span></span>

![Восстановление размещения](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="5ae05-178">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="5ae05-178">Next steps</span></span>

<span data-ttu-id="5ae05-179">Перейдите к разделу [Шаг 2. Проверка предварительных требований для репликации из VMware в Azure](physical-walkthrough-prerequisites.md).</span><span class="sxs-lookup"><span data-stu-id="5ae05-179">Go to [Step 2: Verify prerequisites and limitations](physical-walkthrough-prerequisites.md)</span></span>
