---
title: "Работа по сети для Hyper-V репликации tooa вторичный сайт VMM с помощью Azure Site Recovery aaaPlan | Документы Microsoft"
description: "В этой статье рассматриваются сети планирования при репликации виртуальных машин Hyper-V tooa вторичного System Center VMM сайта с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 095f2d73-994e-4fc0-96f2-e03a7d72e492
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/27/2017
ms.author: raynew
ms.openlocfilehash: 5934db4a661a2c697a1a799c3848852250ddb451
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="step-3-plan-networking-for-hyper-v-vm-replication-tooa-secondary-vmm-site"></a><span data-ttu-id="85145-103">Шаг 3: Планирование сети для виртуальных Машин Hyper-V репликации tooa вторичного сайта, VMM</span><span class="sxs-lookup"><span data-stu-id="85145-103">Step 3: Plan networking for Hyper-V VM replication tooa secondary VMM site</span></span>

<span data-ttu-id="85145-104">После просмотра необходимые условия для развертывания, чтение этой статье tooplan, при репликации Hyper-V виртуальных машин (ВМ), управляемых в облаках диспетчера виртуальных машин System Center (VMM) к сети с помощью вторичного сайта tooa [Azure Site Recovery](site-recovery-overview.md) в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="85145-104">After reviewing deployment prerequisites, read this article tooplan networking when replicating Hyper-V virtual machines (VMs) managed in System Center Virtual Machine Manager (VMM) clouds, tooa secondary site using [Azure Site Recovery](site-recovery-overview.md) in hello Azure portal.</span></span> 

<span data-ttu-id="85145-105">После считывания в этой статье, отправлять любые комментарии, внизу hello, или на hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="85145-105">After reading this article, post any comments at hello bottom, or on hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="network-mapping-overview"></a><span data-ttu-id="85145-106">Общие сведения о сетевом сопоставлении</span><span class="sxs-lookup"><span data-stu-id="85145-106">Network mapping overview</span></span>

<span data-ttu-id="85145-107">Сетевое сопоставление используется при репликации виртуальных машин Hyper-V (управляемый код в VMM), дополнительного tooa центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="85145-107">Network mapping is used when replicating Hyper-V VMs (managed in VMM) tooa secondary datacenter.</span></span> <span data-ttu-id="85145-108">При сетевом сопоставлении сопоставляются сети виртуальных машин, на исходном сервере VMM, и сети виртуальных машин целевого сервера VMM.</span><span class="sxs-lookup"><span data-stu-id="85145-108">Network mapping maps between VM networks on a source VMM server, and VM networks on a target VMM server.</span></span> <span data-ttu-id="85145-109">Сопоставление hello следующие:</span><span class="sxs-lookup"><span data-stu-id="85145-109">Mapping does hello following:</span></span>

- <span data-ttu-id="85145-110">**Сетевое подключение**— сетей tooappropriate подключается виртуальных машин после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-110">**Network connection**—Connects VMs tooappropriate networks after failover.</span></span> <span data-ttu-id="85145-111">подключенный toohello целевую сеть, сопоставленные toohello Исходная сеть будет Hello реплика виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="85145-111">hello replica VM will be connected toohello target network that's mapped toohello source network.</span></span>
- <span data-ttu-id="85145-112">**Оптимального размещения**— оптимально местах hello виртуальных машин реплики на несущих серверах Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="85145-112">**Optimal placement**—Optimally places hello replica VMs on Hyper-V host servers.</span></span> <span data-ttu-id="85145-113">Виртуальные машины реплики размещается на узле, что можно hello доступа к сопоставленным сетям виртуальных Машин.</span><span class="sxs-lookup"><span data-stu-id="85145-113">Replica VMs are placed on hosts that can access hello mapped VM networks.</span></span>
- <span data-ttu-id="85145-114">**Отсутствует сопоставление сети**— реплик виртуальных машин, если не настроить сетевое сопоставление, не будет tooany подключенной сети виртуальных Машин после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-114">**No network mapping**—If you don’t configure network mapping, replica VMs won’t be connected tooany VM networks after failover.</span></span>


### <a name="example"></a><span data-ttu-id="85145-115">Пример</span><span class="sxs-lookup"><span data-stu-id="85145-115">Example</span></span>

<span data-ttu-id="85145-116">Ниже приведен пример tooillustrate этот механизм.</span><span class="sxs-lookup"><span data-stu-id="85145-116">Here’s an example tooillustrate this mechanism.</span></span> <span data-ttu-id="85145-117">Рассмотрим организацию с двумя филиалами в Нью-Йорке и Чикаго.</span><span class="sxs-lookup"><span data-stu-id="85145-117">Let’s take an organization with two locations in New York and Chicago.</span></span>

<span data-ttu-id="85145-118">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="85145-118">**Location**</span></span> | <span data-ttu-id="85145-119">**Сервер VMM**</span><span class="sxs-lookup"><span data-stu-id="85145-119">**VMM server**</span></span> | <span data-ttu-id="85145-120">**Сети виртуальных машин**</span><span class="sxs-lookup"><span data-stu-id="85145-120">**VM networks**</span></span> | <span data-ttu-id="85145-121">**Сопоставление**</span><span class="sxs-lookup"><span data-stu-id="85145-121">**Mapped to**</span></span>
---|---|---|---
<span data-ttu-id="85145-122">Нью-Йорк</span><span class="sxs-lookup"><span data-stu-id="85145-122">New York</span></span> | <span data-ttu-id="85145-123">VMM-NewYork</span><span class="sxs-lookup"><span data-stu-id="85145-123">VMM-NewYork</span></span>| <span data-ttu-id="85145-124">VMNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="85145-124">VMNetwork1-NewYork</span></span> | <span data-ttu-id="85145-125">Сопоставленные tooVMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-125">Mapped tooVMNetwork1-Chicago</span></span>
 |  | <span data-ttu-id="85145-126">VMNetwork2-NewYork</span><span class="sxs-lookup"><span data-stu-id="85145-126">VMNetwork2-NewYork</span></span> | <span data-ttu-id="85145-127">Не сопоставлена</span><span class="sxs-lookup"><span data-stu-id="85145-127">Not mapped</span></span>
<span data-ttu-id="85145-128">Чикаго</span><span class="sxs-lookup"><span data-stu-id="85145-128">Chicago</span></span> | <span data-ttu-id="85145-129">VMM-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-129">VMM-Chicago</span></span>| <span data-ttu-id="85145-130">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-130">VMNetwork1-Chicago</span></span> | <span data-ttu-id="85145-131">Сопоставленные tooVMNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="85145-131">Mapped tooVMNetwork1-NewYork</span></span>
 | | <span data-ttu-id="85145-132">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-132">VMNetwork1-Chicago</span></span> | <span data-ttu-id="85145-133">Не сопоставлена</span><span class="sxs-lookup"><span data-stu-id="85145-133">Not mapped</span></span>

<span data-ttu-id="85145-134">В данном примере:</span><span class="sxs-lookup"><span data-stu-id="85145-134">In this example:</span></span>

- <span data-ttu-id="85145-135">Когда виртуальная машина реплики создается для всех виртуальных машин, подключенных tooVMNetwork1-NewYork, будет подключенных tooVMNetwork1-Chicago.</span><span class="sxs-lookup"><span data-stu-id="85145-135">When a replica virtual machine is created for any virtual machine that is connected tooVMNetwork1-NewYork, it will be connected tooVMNetwork1-Chicago.</span></span>
- <span data-ttu-id="85145-136">Когда виртуальная машина реплики создается для VMNetwork2-NewYork или VMNetwork2-Chicago, он не будет tooany подключенной сети.</span><span class="sxs-lookup"><span data-stu-id="85145-136">When a replica virtual machine is created for VMNetwork2-NewYork or VMNetwork2-Chicago, it will not be connected tooany network.</span></span>

<span data-ttu-id="85145-137">Вот, как облака VMM настроить в нашем примере организации и hello логических сетей, связанных с облаками hello.</span><span class="sxs-lookup"><span data-stu-id="85145-137">Here's how VMM clouds are set up in our example organization, and hello logical networks associated with hello clouds.</span></span>

#### <a name="cloud-protection-settings"></a><span data-ttu-id="85145-138">Параметры защиты облаков</span><span class="sxs-lookup"><span data-stu-id="85145-138">Cloud protection settings</span></span>

<span data-ttu-id="85145-139">**Защищенное облако**</span><span class="sxs-lookup"><span data-stu-id="85145-139">**Protected cloud**</span></span> | <span data-ttu-id="85145-140">**Защита облака**</span><span class="sxs-lookup"><span data-stu-id="85145-140">**Protecting cloud**</span></span> | <span data-ttu-id="85145-141">**Логическая сеть (Нью-Йорк)**</span><span class="sxs-lookup"><span data-stu-id="85145-141">**Logical network (New York)**</span></span>  
---|---|---
<span data-ttu-id="85145-142">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="85145-142">GoldCloud1</span></span> | <span data-ttu-id="85145-143">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="85145-143">GoldCloud2</span></span> |
<span data-ttu-id="85145-144">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="85145-144">SilverCloud1</span></span>| <span data-ttu-id="85145-145">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="85145-145">SilverCloud2</span></span> |
<span data-ttu-id="85145-146">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="85145-146">GoldCloud2</span></span> | <p><span data-ttu-id="85145-147">Нет данных</span><span class="sxs-lookup"><span data-stu-id="85145-147">NA</span></span></p><p></p> | <p><span data-ttu-id="85145-148">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="85145-148">LogicalNetwork1-NewYork</span></span></p><p><span data-ttu-id="85145-149">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-149">LogicalNetwork1-Chicago</span></span></p>
<span data-ttu-id="85145-150">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="85145-150">SilverCloud2</span></span> | <p><span data-ttu-id="85145-151">Нет данных</span><span class="sxs-lookup"><span data-stu-id="85145-151">NA</span></span></p><p></p> | <p><span data-ttu-id="85145-152">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="85145-152">LogicalNetwork1-NewYork</span></span></p><p><span data-ttu-id="85145-153">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-153">LogicalNetwork1-Chicago</span></span></p>

#### <a name="logical-and-vm-network-settings"></a><span data-ttu-id="85145-154">Параметры логической сети и сети виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="85145-154">Logical and VM network settings</span></span>

<span data-ttu-id="85145-155">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="85145-155">**Location**</span></span> | <span data-ttu-id="85145-156">**Логические сети**</span><span class="sxs-lookup"><span data-stu-id="85145-156">**Logical network**</span></span> | <span data-ttu-id="85145-157">**Связанная сеть виртуальных машин**</span><span class="sxs-lookup"><span data-stu-id="85145-157">**Associated VM network**</span></span>
---|---|---
<span data-ttu-id="85145-158">Нью-Йорк</span><span class="sxs-lookup"><span data-stu-id="85145-158">New York</span></span> | <span data-ttu-id="85145-159">LogicalNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="85145-159">LogicalNetwork1-NewYork</span></span> | <span data-ttu-id="85145-160">VMNetwork1-NewYork</span><span class="sxs-lookup"><span data-stu-id="85145-160">VMNetwork1-NewYork</span></span>
<span data-ttu-id="85145-161">Чикаго</span><span class="sxs-lookup"><span data-stu-id="85145-161">Chicago</span></span> | <span data-ttu-id="85145-162">LogicalNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-162">LogicalNetwork1-Chicago</span></span> | <span data-ttu-id="85145-163">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-163">VMNetwork1-Chicago</span></span>
 | <span data-ttu-id="85145-164">LogicalNetwork2Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-164">LogicalNetwork2Chicago</span></span> | <span data-ttu-id="85145-165">VMNetwork2-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-165">VMNetwork2-Chicago</span></span>

#### <a name="target-network-settings"></a><span data-ttu-id="85145-166">Параметры целевой сети</span><span class="sxs-lookup"><span data-stu-id="85145-166">Target network settings</span></span>

<span data-ttu-id="85145-167">На основе этих параметров, при выборе целевой сети ВМ hello, hello в следующей таблице показаны hello вариантов, которые будут доступны.</span><span class="sxs-lookup"><span data-stu-id="85145-167">Based on these settings, when you select hello target VM network, hello following table shows hello choices that will be available.</span></span>

<span data-ttu-id="85145-168">**Выбор**</span><span class="sxs-lookup"><span data-stu-id="85145-168">**Select**</span></span> | <span data-ttu-id="85145-169">**Защищенное облако**</span><span class="sxs-lookup"><span data-stu-id="85145-169">**Protected cloud**</span></span> | <span data-ttu-id="85145-170">**Защита облака**</span><span class="sxs-lookup"><span data-stu-id="85145-170">**Protecting cloud**</span></span> | <span data-ttu-id="85145-171">**Доступная целевая сеть**</span><span class="sxs-lookup"><span data-stu-id="85145-171">**Target network available**</span></span>
---|---|---|---
<span data-ttu-id="85145-172">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-172">VMNetwork1-Chicago</span></span> | <span data-ttu-id="85145-173">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="85145-173">SilverCloud1</span></span> | <span data-ttu-id="85145-174">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="85145-174">SilverCloud2</span></span> | <span data-ttu-id="85145-175">Доступна</span><span class="sxs-lookup"><span data-stu-id="85145-175">Available</span></span>
 | <span data-ttu-id="85145-176">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="85145-176">GoldCloud1</span></span> | <span data-ttu-id="85145-177">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="85145-177">GoldCloud2</span></span> | <span data-ttu-id="85145-178">Доступна</span><span class="sxs-lookup"><span data-stu-id="85145-178">Available</span></span>
<span data-ttu-id="85145-179">VMNetwork2-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-179">VMNetwork2-Chicago</span></span> | <span data-ttu-id="85145-180">SilverCloud1</span><span class="sxs-lookup"><span data-stu-id="85145-180">SilverCloud1</span></span> | <span data-ttu-id="85145-181">SilverCloud2</span><span class="sxs-lookup"><span data-stu-id="85145-181">SilverCloud2</span></span> | <span data-ttu-id="85145-182">Недоступно</span><span class="sxs-lookup"><span data-stu-id="85145-182">Not available</span></span>
 | <span data-ttu-id="85145-183">GoldCloud1</span><span class="sxs-lookup"><span data-stu-id="85145-183">GoldCloud1</span></span> | <span data-ttu-id="85145-184">GoldCloud2</span><span class="sxs-lookup"><span data-stu-id="85145-184">GoldCloud2</span></span> | <span data-ttu-id="85145-185">Доступна</span><span class="sxs-lookup"><span data-stu-id="85145-185">Available</span></span>


<span data-ttu-id="85145-186">Если hello целевая сеть содержит несколько подсетей, и один из этих подсетей имеет hello таким же именем как hello подсети, на какие hello находится исходная виртуальная машина, затем hello виртуальной машины реплики будет подключенных toothat целевой подсети после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-186">If hello target network has multiple subnets and one of those subnets has hello same name as hello subnet on which hello source virtual machine is located, then hello replica virtual machine will be connected toothat target subnet after failover.</span></span> <span data-ttu-id="85145-187">Если никакой целевой подсети с совпадающим именем, hello виртуальная машина будет подключенных toohello первой подсети в сети hello.</span><span class="sxs-lookup"><span data-stu-id="85145-187">If there’s no target subnet with a matching name, hello virtual machine will be connected toohello first subnet in hello network.</span></span>


#### <a name="failback-behavior"></a><span data-ttu-id="85145-188">Поведение восстановления размещения</span><span class="sxs-lookup"><span data-stu-id="85145-188">Failback behavior</span></span>

<span data-ttu-id="85145-189">toosee, что происходит в случае, когда hello восстановления размещения (обратной репликации), давайте предположим, что VMNetwork1-NewYork сопоставленных tooVMNetwork1-Chicago, с hello следующие параметры.</span><span class="sxs-lookup"><span data-stu-id="85145-189">toosee what happens in hello case of failback (reverse replication), let’s assume that VMNetwork1-NewYork is mapped tooVMNetwork1-Chicago, with hello following settings.</span></span>


<span data-ttu-id="85145-190">**Виртуальная машина**</span><span class="sxs-lookup"><span data-stu-id="85145-190">**Virtual machine**</span></span> | <span data-ttu-id="85145-191">**TooVM подключенной сети**</span><span class="sxs-lookup"><span data-stu-id="85145-191">**Connected tooVM network**</span></span>
---|---
<span data-ttu-id="85145-192">VM1</span><span class="sxs-lookup"><span data-stu-id="85145-192">VM1</span></span> | <span data-ttu-id="85145-193">VMNetwork1-Network</span><span class="sxs-lookup"><span data-stu-id="85145-193">VMNetwork1-Network</span></span>
<span data-ttu-id="85145-194">VM2 (реплика VM1)</span><span class="sxs-lookup"><span data-stu-id="85145-194">VM2 (replica of VM1)</span></span> | <span data-ttu-id="85145-195">VMNetwork1-Chicago</span><span class="sxs-lookup"><span data-stu-id="85145-195">VMNetwork1-Chicago</span></span>

<span data-ttu-id="85145-196">Приняв эти параметры, рассмотрим, что происходит в нескольких возможных сценариях.</span><span class="sxs-lookup"><span data-stu-id="85145-196">With these settings, let's review what happens in a couple of possible scenarios.</span></span>

<span data-ttu-id="85145-197">**Сценарий**</span><span class="sxs-lookup"><span data-stu-id="85145-197">**Scenario**</span></span> | <span data-ttu-id="85145-198">**Результат**</span><span class="sxs-lookup"><span data-stu-id="85145-198">**Outcome**</span></span>
---|---
<span data-ttu-id="85145-199">Без изменений в свойствах сети hello VM-2 после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-199">No change in hello network properties of VM-2 after failover.</span></span> | <span data-ttu-id="85145-200">VM-1 остается подключенной toohello исходную сеть.</span><span class="sxs-lookup"><span data-stu-id="85145-200">VM-1 remains connected toohello source network.</span></span>
<span data-ttu-id="85145-201">Сетевые свойства VM-2 изменяются после отработки отказа, и она отключается.</span><span class="sxs-lookup"><span data-stu-id="85145-201">Network properties of VM-2 are changed after failover and is disconnected.</span></span> | <span data-ttu-id="85145-202">VM-1 отключается.</span><span class="sxs-lookup"><span data-stu-id="85145-202">VM-1 is disconnected.</span></span>
<span data-ttu-id="85145-203">Свойства сети VM-2 изменяются после отработки отказа и является подключенных tooVMNetwork2-Chicago.</span><span class="sxs-lookup"><span data-stu-id="85145-203">Network properties of VM-2 are changed after failover and is connected tooVMNetwork2-Chicago.</span></span> | <span data-ttu-id="85145-204">Если VMNetwork2-Chicago не сопоставлена, VM-1 будет отключена.</span><span class="sxs-lookup"><span data-stu-id="85145-204">If VMNetwork2-Chicago isn’t mapped, VM-1 will be disconnected.</span></span>
<span data-ttu-id="85145-205">Сетевое сопоставление VMNetwork1-Chicago изменяется.</span><span class="sxs-lookup"><span data-stu-id="85145-205">Network mapping of VMNetwork1-Chicago is changed.</span></span> | <span data-ttu-id="85145-206">VM-1 будет toohello подключенной сети, сопоставленной теперь tooVMNetwork1-Chicago.</span><span class="sxs-lookup"><span data-stu-id="85145-206">VM-1 will be connected toohello network now mapped tooVMNetwork1-Chicago.</span></span>



## <a name="prepare-for-network-mapping"></a><span data-ttu-id="85145-207">Подготовка к сопоставлению сетей</span><span class="sxs-lookup"><span data-stu-id="85145-207">Prepare for network mapping</span></span>

1. <span data-ttu-id="85145-208">На hello исходный и целевой серверы VMM должен иметь логической сетью, связанной с hello исходном и целевом облаках.</span><span class="sxs-lookup"><span data-stu-id="85145-208">On hello source and target VMM servers, you should have a logical network associated with hello source and target clouds.</span></span> 
2. <span data-ttu-id="85145-209">В исходном и целевом серверах hello должен быть логическую сеть связанных toohello сети виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="85145-209">In hello source and target servers, you should have a VM network linked toohello logical network.</span></span>
3. <span data-ttu-id="85145-210">Виртуальные машины на узлах Hyper-V в исходное расположение hello должно быть toohello связанные исходной сетью виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="85145-210">VMs on Hyper-V hosts in hello source location should be linked toohello source VM network.</span></span> <span data-ttu-id="85145-211">Если вы используете только один сервер VMM, можно настроить сопоставление между сетями виртуальных Машин на hello же сервера.</span><span class="sxs-lookup"><span data-stu-id="85145-211">If you're only using a single VMM server, you can configure mapping between VM networks on hello same server.</span></span>

<span data-ttu-id="85145-212">Вот что происходит при настройке сетевого сопоставления во время развертывания Site Recovery:</span><span class="sxs-lookup"><span data-stu-id="85145-212">Here's what happens when you set up network mapping during Site Recovery deployment:</span></span>

- <span data-ttu-id="85145-213">Если настроить сетевое сопоставление и выберите целевую сеть виртуальной Машины, исходных облаках VMM hello, использующие исходную сеть виртуальных Машин hello будет отображаться, вместе с hello доступные целевые сети ВМ hello целевых облаков.</span><span class="sxs-lookup"><span data-stu-id="85145-213">When you set up network mapping and select a target VM network, hello VMM source clouds that use hello source VM network will be displayed, along with hello available target VM networks on hello target clouds.</span></span>
- - <span data-ttu-id="85145-214">Если сопоставление настроено правильно и репликация включена, исходной виртуальной Машины будет подключенных tooits исходную сеть виртуальных Машин и его репликой hello целевого расположения будет подключена tooits сопоставлены сети виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="85145-214">When mapping is configured correctly and replication is enabled, a source VM will be connected tooits source VM network, and its replica at hello target location will be connected tooits mapped VM network.</span></span>
- <span data-ttu-id="85145-215">Если hello целевая сеть содержит несколько подсетей, и один из этих подсетей имеет hello таким же именем как hello подсети, на какие hello находится исходная виртуальная машина, затем hello виртуальной машины реплики будет подключенных toothat целевой подсети после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-215">If hello target network has multiple subnets, and one of those subnets has hello same name as hello subnet on which hello source virtual machine is located, then hello replica virtual machine will be connected toothat target subnet after failover.</span></span> <span data-ttu-id="85145-216">Если никакой целевой подсети с совпадающим именем, hello виртуальной Машины будет подключенных toohello первой подсети в сети hello.</span><span class="sxs-lookup"><span data-stu-id="85145-216">If there’s no target subnet with a matching name, hello VM will be connected toohello first subnet in hello network.</span></span>

## <a name="connect-toovms-after-failover"></a><span data-ttu-id="85145-217">Подключение tooVMs после отработки отказа</span><span class="sxs-lookup"><span data-stu-id="85145-217">Connect tooVMs after failover</span></span>

<span data-ttu-id="85145-218">При планировании репликации и стратегия отработки отказа, является одним из ключевых вопроса hello как tooconnect toohello реплики после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-218">When planning your replication and failover strategy, one of hello key questions is how tooconnect toohello replica after failover.</span></span> <span data-ttu-id="85145-219">Существует несколько вариантов:</span><span class="sxs-lookup"><span data-stu-id="85145-219">There are a couple of choices:</span></span> 

- <span data-ttu-id="85145-220">**Использовать другой IP-адрес**: можно выбрать toouse другой IP-адрес для hello реплицированных виртуальных Машин.</span><span class="sxs-lookup"><span data-stu-id="85145-220">**Use a different IP address**: You can select toouse a different IP address for hello replicated VM.</span></span> <span data-ttu-id="85145-221">В этот сценарий hello виртуальная машина получит новый IP-адрес после отработки отказа и требуется обновление DNS.</span><span class="sxs-lookup"><span data-stu-id="85145-221">In this scenario hello VM gets a new IP address after failover, and a DNS update is required.</span></span>
- <span data-ttu-id="85145-222">**Сохранить hello же IP-адрес**: может потребоваться toouse hello же IP-адрес для hello реплики виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="85145-222">**Retain hello same IP address**: You might want toouse hello same IP address for hello replica VM.</span></span> <span data-ttu-id="85145-223">Сохранение hello одинаковые IP-адреса упрощает hello восстановления за счет уменьшения проблемы, связанные с сети после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-223">Keeping hello same IP addresses simplifies hello recovery by reducing network related issues after failover.</span></span> 

## <a name="retain-ip-addresses"></a><span data-ttu-id="85145-224">Использование тех же IP-адресов</span><span class="sxs-lookup"><span data-stu-id="85145-224">Retain IP addresses</span></span>

<span data-ttu-id="85145-225">Если требуется tooretain hello IP-адресов hello основного сайта после отработки отказа toohello вторичного сайта, можно провести полное подсети отработки отказа, а также обновить маршруты tooindicate hello новое расположение hello IP-адресов, или вариант развертывания растяжением подсети между hello основной и hello восстановления сайтов.</span><span class="sxs-lookup"><span data-stu-id="85145-225">If you want tooretain hello IP addresses from hello primary site after failover toohello secondary site, you can do a full subnet failover, and update routes tooindicate hello new location of hello IP addresses, or alternative deploy a stretched subnet between hello primary and hello recovery sites.</span></span>

### <a name="stretched-subnet"></a><span data-ttu-id="85145-226">Растянутая подсеть</span><span class="sxs-lookup"><span data-stu-id="85145-226">Stretched subnet</span></span>

<span data-ttu-id="85145-227">В расширенной подсети подсети hello доступен одновременно в hello первичного и вторичного сайта.</span><span class="sxs-lookup"><span data-stu-id="85145-227">In a stretched subnet, hello subnet is available simultaneously in both hello primary and secondary site.</span></span> <span data-ttu-id="85145-228">При перемещении сервера и его конфигурации IP (уровень 3) toohello вторичного сайта, сети hello автоматически направит hello трафика toohello новое расположение.</span><span class="sxs-lookup"><span data-stu-id="85145-228">If you move a server and its IP (Layer 3) configuration toohello secondary site, hello network will route hello traffic toohello new location automatically.</span></span> 

<span data-ttu-id="85145-229">С точки зрения уровня 2 (уровень связи данных) требуется сетевое оборудование, с помощью которого можно управлять растянутой виртуальной локальной сетью.</span><span class="sxs-lookup"><span data-stu-id="85145-229">From a Layer 2 (data link layer) perspective, you need networking equipment that can manage a stretched VLAN.</span></span> <span data-ttu-id="85145-230">Кроме того растяжения hello виртуальной локальной сети, потенциальные домен сбоя hello располагается по tooboth узлов, по сути становится единая точка отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-230">In addition, by stretching hello VLAN, hello potential fault domain extends tooboth sites, essentially becoming a single point of failure.</span></span> <span data-ttu-id="85145-231">Хотя это маловероятно, может произойти сетевая буря, которую не получится изолировать.</span><span class="sxs-lookup"><span data-stu-id="85145-231">While this is an unlikely, it could happen that a broadcast storm started and cannot be isolated.</span></span> 


### <a name="subnet-failover"></a><span data-ttu-id="85145-232">Отработка отказа подсети</span><span class="sxs-lookup"><span data-stu-id="85145-232">Subnet failover</span></span>

<span data-ttu-id="85145-233">Преимущества подсети hello растягивается hello tooobtain отработки отказа подсети могут выполняться без фактически растягивая его.</span><span class="sxs-lookup"><span data-stu-id="85145-233">You can run a subnet failover tooobtain hello benefits of hello stretched subnet, without actually stretching it.</span></span> <span data-ttu-id="85145-234">В этом решении подсети будут доступны в hello исходный или конечный сайт, но не на оба одновременно.</span><span class="sxs-lookup"><span data-stu-id="85145-234">In this solution, a subnet will be available in hello source or target site, but not at both simultaneously.</span></span> <span data-ttu-id="85145-235">toomaintain hello пространство IP-адресов в событии hello перехода на другой ресурс, можно программным образом упорядочить для hello маршрутизатора инфраструктуры toomove из одного узла tooanother hello подсетей.</span><span class="sxs-lookup"><span data-stu-id="85145-235">toomaintain hello IP address space in hello event of a failover, you can programmatically arrange for hello router infrastructure toomove hello subnets from one site tooanother.</span></span> <span data-ttu-id="85145-236">После переносились в случае отработки отказа подсетей с hello связанные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="85145-236">After when failover occurs, subnets would move with hello associated VMs.</span></span> <span data-ttu-id="85145-237">Основным недостатком Hello: в случае сбоя hello иметь toomove hello всей подсети.</span><span class="sxs-lookup"><span data-stu-id="85145-237">hello main drawback is that in hello event of a failure, you have toomove hello whole subnet.</span></span>

### <a name="example"></a><span data-ttu-id="85145-238">Пример</span><span class="sxs-lookup"><span data-stu-id="85145-238">Example</span></span>

<span data-ttu-id="85145-239">Ниже приведен пример полной отработки отказа подсети.</span><span class="sxs-lookup"><span data-stu-id="85145-239">Here's an example of complete subnet failover.</span></span> <span data-ttu-id="85145-240">Hello основной сайт имеет приложений, работающих в подсети 192.168.1.0/24.</span><span class="sxs-lookup"><span data-stu-id="85145-240">hello primary site has applications running in subnet 192.168.1.0/24.</span></span> <span data-ttu-id="85145-241">После перехода на другой ресурс hello все виртуальные машины в этой подсети отработку отказа toohello вторичного сайта и сохраняют свои IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="85145-241">At failover, all hello VMs in this subnet are failed over toohello secondary site, and retain their IP addresses.</span></span> <span data-ttu-id="85145-242">Маршруты toobe необходимость изменить фактов hello tooreflect все hello виртуальной Машины виртуальных машин, принадлежащих toosubnet 192.168.1.0/24 теперь перемещен toohello вторичного сайта.</span><span class="sxs-lookup"><span data-stu-id="85145-242">Routes need toobe modified tooreflect hello fact that all hello VM virtual machines belonging toosubnet 192.168.1.0/24 have now moved toohello secondary site.</span></span>

<span data-ttu-id="85145-243">Hello следующем рисунке показан подсетей hello до и после отработки отказа:</span><span class="sxs-lookup"><span data-stu-id="85145-243">hello following graphics show hello subnets before and after failover:</span></span>

- <span data-ttu-id="85145-244">Перед выполнением отработки отказа 192.168.0.1/24 подсети активен на исходном сайте hello, становятся активными на вторичном сайте hello после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-244">Before failover, subnet 192.168.0.1/24 is active on hello source site, become active on hello secondary site after failover.</span></span>
- <span data-ttu-id="85145-245">Hello направляет между первичным сайтом и сайтом восстановления, третий узел и первичного сайта, а третий сайтом и сайтом восстановления будет иметь toobe соответствующим образом изменены.</span><span class="sxs-lookup"><span data-stu-id="85145-245">hello routes between primary site and recovery site, third site and primary site, and third site and recovery site will have toobe appropriately modified.</span></span>

<span data-ttu-id="85145-246">**Перед выполнением отработки отказа**</span><span class="sxs-lookup"><span data-stu-id="85145-246">**Before failover**</span></span>

![Перед выполнением отработки отказа](./media/vmm-to-vmm-walkthrough-network/network-design2.png)

<span data-ttu-id="85145-248">**После выполнения отработки отказа**</span><span class="sxs-lookup"><span data-stu-id="85145-248">**After failover**</span></span>

![После выполнения отработки отказа](./media/vmm-to-vmm-walkthrough-network/network-design3.png)

<span data-ttu-id="85145-250">После отработки отказа происходит следующее:</span><span class="sxs-lookup"><span data-stu-id="85145-250">After failover, here's what happens:</span></span>

- <span data-ttu-id="85145-251">Site Recovery выделяет IP-адреса для каждого сетевого интерфейса на ВМ, hello hello статических IP-адресов в сети hello применимо, для каждого экземпляра VMM.</span><span class="sxs-lookup"><span data-stu-id="85145-251">Site Recovery allocates an IP address for each network interface on hello VM, from hello static IP address pool in hello relevant network, for each VMM instance.</span></span>
- <span data-ttu-id="85145-252">Если пул IP-адресов hello вторичном сайте hello hello же, как на исходном сайте hello, Site Recovery выделяет hello же IP адрес (hello исходной виртуальной Машины) toohello виртуальную Машину реплики.</span><span class="sxs-lookup"><span data-stu-id="85145-252">If hello IP address pool in hello secondary site is hello same as that on hello source site, Site Recovery allocates hello same IP address (of hello source VM) toohello replica VM.</span></span> <span data-ttu-id="85145-253">Hello IP-адрес зарезервирован в VMM, но не устанавливается как hello отработки отказа IP-адрес на узле Hyper-V hello.</span><span class="sxs-lookup"><span data-stu-id="85145-253">hello IP address is reserved in VMM, but it isn't set as hello failover IP address on hello Hyper-V host.</span></span> <span data-ttu-id="85145-254">Hello отработки отказа IP-адрес на узле Hyper-v задается непосредственно перед hello перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="85145-254">hello failover IP address on a Hyper-v host is set just before hello failover.</span></span>
- <span data-ttu-id="85145-255">Если hello же IP-адрес недоступен, Site Recovery выделяет другой доступный IP-адрес из пула hello.</span><span class="sxs-lookup"><span data-stu-id="85145-255">If hello same IP address isn't available, Site Recovery allocates another available IP address from hello pool.</span></span>
- <span data-ttu-id="85145-256">Если виртуальные машины используют DHCP, Site Recovery не управлять hello IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="85145-256">If VMs use DHCP, Site Recovery doesn't manage hello IP addresses.</span></span> <span data-ttu-id="85145-257">Требуется toocheck, hello DHCP server на вторичном сайте hello можно выделить адрес из hello же диапазон как hello исходного сайта.</span><span class="sxs-lookup"><span data-stu-id="85145-257">You need toocheck that hello DHCP server on hello secondary site can allocate address from hello same range as hello source site.</span></span>

### <a name="validate-hello-ip-address"></a><span data-ttu-id="85145-258">Проверка hello IP-адрес</span><span class="sxs-lookup"><span data-stu-id="85145-258">Validate hello IP address</span></span>

<span data-ttu-id="85145-259">После включения защиты для виртуальной Машины, можно использовать следующий образец скрипта tooverify hello toohello адрес, назначенный виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="85145-259">After you enable protection for a VM, you can use following sample script tooverify hello address assigned toohello VM.</span></span> <span data-ttu-id="85145-260">Hello же IP-адрес будет устанавливаться как hello отработки отказа IP-адрес и назначенный toohello виртуальной Машины во время отработки отказа hello:</span><span class="sxs-lookup"><span data-stu-id="85145-260">hello same IP address will be set as hello failover IP address, and assigned toohello VM at hello time of failover:</span></span>

    ```
    $vm = Get-SCVirtualMachine -Name <VM_NAME>
    $na = $vm[0].VirtualNetworkAdapters>
    $ip = Get-SCIPAddress -GrantToObjectID $na[0].id
    $ip.address 
    ```

## <a name="changing-ip-addresses"></a><span data-ttu-id="85145-261">Изменение IP-адресов</span><span class="sxs-lookup"><span data-stu-id="85145-261">Changing IP addresses</span></span>

<span data-ttu-id="85145-262">В этом случае изменения hello IP-адреса виртуальных машин, которые выполняют отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-262">In this scenario, hello IP addresses of VMs that fail over are changed.</span></span> <span data-ttu-id="85145-263">Hello недостатком этого решения является hello затрат на сопровождение.</span><span class="sxs-lookup"><span data-stu-id="85145-263">hello drawback of this solution is hello maintenance required.</span></span> <span data-ttu-id="85145-264">Как правило, DNS обновляется после запуска виртуальных машин реплики.</span><span class="sxs-lookup"><span data-stu-id="85145-264">Typically, DNS will be updated after replica VMs start.</span></span> <span data-ttu-id="85145-265">Записи DNS может потребоваться изменить toobe или fluster в сети и обновления кэшированных записей.</span><span class="sxs-lookup"><span data-stu-id="85145-265">DNS entries might need toobe changed or fluster in thenetwork, and cached entries updated.</span></span> <span data-ttu-id="85145-266">Это может привести к возникновению простоя.</span><span class="sxs-lookup"><span data-stu-id="85145-266">This can result in downtime.</span></span> <span data-ttu-id="85145-267">Простой можно устранить следующим образом:</span><span class="sxs-lookup"><span data-stu-id="85145-267">Downtime can be mitigated as follows:</span></span>

- <span data-ttu-id="85145-268">Используйте низкие значения срока жизни для приложений интрасети.</span><span class="sxs-lookup"><span data-stu-id="85145-268">Use low TTL values for intranet applications.</span></span>
- <span data-ttu-id="85145-269">Используйте следующий скрипт в план восстановления Site Recovery tooupdate hello DNS server tooensure своевременное обновление hello.</span><span class="sxs-lookup"><span data-stu-id="85145-269">Use hello following script in a Site Recovery recovery plan, tooupdate hello DNS server tooensure a timely update.</span></span> <span data-ttu-id="85145-270">Если использовать динамическую регистрацию DNS hello скрипт не требуется.</span><span class="sxs-lookup"><span data-stu-id="85145-270">You don't need hello script if you use dynamic DNS registration.</span></span>

    ```
    param(
    string]$Zone,
    [string]$name,
    [string]$IP
    )
    $Record = Get-DnsServerResourceRecord -ZoneName $zone -Name $name
    $newrecord = $record.clone()
    $newrecord.RecordData[0].IPv4Address  =  $IP
    Set-DnsServerResourceRecord -zonename $zone -OldInputObject $record -NewInputObject $Newrecord
    ```
    
### <a name="example"></a><span data-ttu-id="85145-271">Пример</span><span class="sxs-lookup"><span data-stu-id="85145-271">Example</span></span> 

<span data-ttu-id="85145-272">Рассмотрим сценарий, в котором вы планируете toouse разные IP-адреса через основной hello и hello восстановления сайтов. В этом примере у нас есть разные IP-адреса на первичных и вторичных сайтах и существует; получить доступ к сайту s третий из какие приложения, размещенного на сайте hello основного сервера или восстановления.</span><span class="sxs-lookup"><span data-stu-id="85145-272">Let's look at a scenario in which you're planning toouse different IP addresses across hello primary and hello recovery sites.In this example we have different IP addresses across primary and secondary sites, and there;s a third site from which applications hosted on hello primary or recovery site can be accessed.</span></span>

- <span data-ttu-id="85145-273">Перед выполнением отработки отказа приложения, 192.168.1.0/24 размещенного подсети на первичном сайте hello и являются настроенные toobe в подсети 172.16.1.0/24 на вторичном сайте hello после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-273">Before failover, apps are hosted subnet 192.168.1.0/24 on hello primary site, and are configured toobe in subnet 172.16.1.0/24 on hello secondary site after a failover.</span></span>
- <span data-ttu-id="85145-274">VPN-подключения/сетевые маршруты были настроены так, чтобы все три объекта могли иметь доступ друг к другу.</span><span class="sxs-lookup"><span data-stu-id="85145-274">VPN connections/network routes have been configured appropriately so that all three sites can access each other.</span></span>
- <span data-ttu-id="85145-275">После отработки отказа будет восстановлена в подсети hello восстановления приложений.</span><span class="sxs-lookup"><span data-stu-id="85145-275">After failover, apps will be restored in hello recovery subnet.</span></span> <span data-ttu-id="85145-276">В этом сценарии имеется без необходимости toofail по всей подсети hello и необходимые tooreconfigure VPN или сетевых маршрутов не вносить изменения.</span><span class="sxs-lookup"><span data-stu-id="85145-276">In this scenario there's no need toofail over hello entire subnet, and no changes are needed tooreconfigure VPN or network routes.</span></span> <span data-ttu-id="85145-277">Hello перехода на другой ресурс, а некоторые DNS обеспечить сохранение доступных приложений.</span><span class="sxs-lookup"><span data-stu-id="85145-277">hello failover, and some DNS updates, ensure that applications remain accessible.</span></span>
- <span data-ttu-id="85145-278">Если настроенные tooallow динамические обновления DNS, затем hello виртуальные машины будут регистрироваться с помощью hello новый IP-адрес, когда они запускают после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="85145-278">If DNS is configured tooallow dynamic updates, then hello VMs will register themselves using hello new IP address, when they start after failover.</span></span>

<span data-ttu-id="85145-279">**Перед выполнением отработки отказа**</span><span class="sxs-lookup"><span data-stu-id="85145-279">**Before failover**</span></span>

![Другой IP-адрес — до отработки отказа](./media/vmm-to-vmm-walkthrough-network/network-design10.png)

<span data-ttu-id="85145-281">**После выполнения отработки отказа**</span><span class="sxs-lookup"><span data-stu-id="85145-281">**After failover**</span></span>

![Другой IP-адрес — после отработки отказа](./media/vmm-to-vmm-walkthrough-network/network-design11.png)



## <a name="next-steps"></a><span data-ttu-id="85145-283">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="85145-283">Next steps</span></span>

<span data-ttu-id="85145-284">Go слишком[шаг 4: Подготовка VMM и Hyper-V](vmm-to-vmm-walkthrough-vmm-hyper-v.md).</span><span class="sxs-lookup"><span data-stu-id="85145-284">Go too[Step 4: Prepare VMM and Hyper-V](vmm-to-vmm-walkthrough-vmm-hyper-v.md).</span></span>


