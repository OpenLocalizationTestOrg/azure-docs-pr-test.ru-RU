---
title: "Работа по сети для репликации Hyper-V (без System Center VMM) tooAzure с Azure Site Recovery aaaPlan | Документы Microsoft"
description: "В этой статье описывается сети, планирование, необходимое при репликации виртуальных машин Hyper-V (без VMM) tooAzure"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 5ca12254-975d-48e8-a84d-422825dac9b2
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 06/21/2017
ms.author: raynew
ms.openlocfilehash: a35de72b53ca921a7b9bfca00a0edcb9416d5aa2
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="step-4-plan-networking-for-hyper-v-tooazure-replication"></a><span data-ttu-id="9041a-103">Шаг 4: Планирование сети для репликации tooAzure Hyper-V</span><span class="sxs-lookup"><span data-stu-id="9041a-103">Step 4: Plan networking for Hyper-V tooAzure replication</span></span>

<span data-ttu-id="9041a-104">Это статье кратко рассматриваются вопросы планирования при репликации локальных tooAzure виртуальных машин Hyper-V (без System Center VMM), с помощью hello сети [Azure Site Recovery](site-recovery-overview.md) службы.</span><span class="sxs-lookup"><span data-stu-id="9041a-104">This article summarizes network planning considerations when replicating on-premises Hyper-V VMs (without System Center VMM) tooAzure using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="9041a-105">Отправлять все комментарии hello нижней части этой статьи, или задать вопросы в hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="9041a-105">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="connecting-tooreplica-vms-after-failover"></a><span data-ttu-id="9041a-106">Подключение tooreplica виртуальных машин после отработки отказа</span><span class="sxs-lookup"><span data-stu-id="9041a-106">Connecting tooreplica VMs after failover</span></span>

<span data-ttu-id="9041a-107">При планировании репликации и стратегия отработки отказа, является одним из ключевых вопроса hello как toohello tooconnect виртуальной Машины Azure после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="9041a-107">When planning your replication and failover strategy, one of hello key questions is how tooconnect toohello Azure VM after failover.</span></span> <span data-ttu-id="9041a-108">При разработке сетевой стратегии для виртуальных машин реплик Azure существует несколько вариантов:</span><span class="sxs-lookup"><span data-stu-id="9041a-108">There are a couple of choices when designing your network strategy for replica Azure VMs:</span></span>

- <span data-ttu-id="9041a-109">**Другой IP-адрес**: можно выбрать toouse диапазоном IP-адресов для сети виртуальной Машины Azure реплицированных hello.</span><span class="sxs-lookup"><span data-stu-id="9041a-109">**Different IP address**: You can select toouse a different IP address range for hello replicated Azure VM network.</span></span> <span data-ttu-id="9041a-110">В этот сценарий hello виртуальная машина получит новый IP-адрес после отработки отказа и требуется обновление DNS.</span><span class="sxs-lookup"><span data-stu-id="9041a-110">In this scenario hello VM gets a new IP address after failover, and a DNS update is required.</span></span> [<span data-ttu-id="9041a-111">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="9041a-111">Learn more</span></span>](site-recovery-test-failover-vmm-to-vmm.md#prepare-the-infrastructure-for-test-failover)
- <span data-ttu-id="9041a-112">**Один IP-адрес**: может потребоваться toouse hello же диапазон IP-адресов, что, в основной в локальной сети, для hello сети Azure после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="9041a-112">**Same IP address**: You might want toouse hello same IP address range as that in your primary on-premises network, for hello Azure network after failover.</span></span>  <span data-ttu-id="9041a-113">Сохранение hello одинаковые IP-адреса упрощает hello восстановления за счет уменьшения проблемы, связанные с сети после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="9041a-113">Keeping hello same IP addresses simplifies hello recovery by reducing network related issues after failover.</span></span> <span data-ttu-id="9041a-114">Тем не менее при выполнении репликации tooAzure, необходимо будет tooupdate маршруты с нового расположения hello hello IP-адресов после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="9041a-114">However, when you're replicating tooAzure, you will need tooupdate routes with hello new location of hello IP addresses after failover.</span></span>


## <a name="retain-ip-addresses"></a><span data-ttu-id="9041a-115">Использование тех же IP-адресов</span><span class="sxs-lookup"><span data-stu-id="9041a-115">Retain IP addresses</span></span>

<span data-ttu-id="9041a-116">Site Recovery предоставляет hello возможность tooretain фиксированных IP-адресов при отработке отказа tooAzure с отработки отказа в подсети.</span><span class="sxs-lookup"><span data-stu-id="9041a-116">Site Recovery provides hello capability tooretain fixed IP addresses when failing over tooAzure, with a subnet failover.</span></span>

<span data-ttu-id="9041a-117">При отработке отказа в подсети отдельно взятая подсеть присутствует на сайте 1 или 2, но никогда на обоих сайтах одновременно.</span><span class="sxs-lookup"><span data-stu-id="9041a-117">With subnet failover, a specific subnet is present at Site 1 or Site 2, but never at both sites simultaneously.</span></span> <span data-ttu-id="9041a-118">В порядке toomaintain hello пространство IP-адресов в событии hello перехода на другой ресурс программным образом упорядочить для hello маршрутизатора инфраструктуры toomove из одного узла tooanother hello подсетей.</span><span class="sxs-lookup"><span data-stu-id="9041a-118">In order toomaintain hello IP address space in hello event of a failover, you programmatically arrange for hello router infrastructure toomove hello subnets from one site tooanother.</span></span> <span data-ttu-id="9041a-119">Во время отработки отказа hello подсетей для перемещения hello связанные защищенных виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="9041a-119">During failover, hello subnets move with hello associated protected VMs.</span></span> <span data-ttu-id="9041a-120">Основным недостатком Hello: в случае сбоя hello иметь toomove hello всей подсети.</span><span class="sxs-lookup"><span data-stu-id="9041a-120">hello main drawback is that in hello event of a failure, you have toomove hello whole subnet.</span></span>


### <a name="failover-example"></a><span data-ttu-id="9041a-121">Пример отработки отказа</span><span class="sxs-lookup"><span data-stu-id="9041a-121">Failover example</span></span>

<span data-ttu-id="9041a-122">Давайте рассмотрим пример tooAzure перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="9041a-122">Let's look at an example for failover tooAzure.</span></span>

- <span data-ttu-id="9041a-123">Вымышленная компания, банк Woodgrove, имеет локальную инфраструктуру, в которой размещены ее бизнес-приложения.</span><span class="sxs-lookup"><span data-stu-id="9041a-123">A ficticious company, Woodgrove Bank, has an on-premises infrastructure hosting their business apps.</span></span> <span data-ttu-id="9041a-124">Ее мобильные приложения размещены в Azure.</span><span class="sxs-lookup"><span data-stu-id="9041a-124">Their mobile applications are hosted on Azure.</span></span>
- <span data-ttu-id="9041a-125">Связь между виртуальными машинами банка Woodgrove в Azure и локальных серверов обеспечивается соединение сеть сеть (VPN) между hello локальной сети edge и hello виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="9041a-125">Connectivity between Woodgrove Bank VMs in Azure and on-premises servers is provided by a site-to-site (VPN) connection between hello on-premises edge network and hello Azure virtual network.</span></span>
- <span data-ttu-id="9041a-126">Это VPN означает, что hello компании виртуальной сети в Azure в виде расширения их в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="9041a-126">This VPN means that hello company's virtual network in Azure appears as an extension of their on-premises network.</span></span>
- <span data-ttu-id="9041a-127">Woodgrove хочет toouse Site Recovery tooreplicate локальных рабочих нагрузок tooAzure.</span><span class="sxs-lookup"><span data-stu-id="9041a-127">Woodgrove wants toouse Site Recovery tooreplicate on-premises workloads tooAzure.</span></span>
 - <span data-ttu-id="9041a-128">Woodgrove имеет toodeal с приложениями и конфигурации, которые зависят от жестко IP-адресов и поэтому tooretain IP-адреса для своих приложений после отработки отказа tooAzure.</span><span class="sxs-lookup"><span data-stu-id="9041a-128">Woodgrove has toodeal with applications and configurations which depend on hard-coded IP addresses, and thus need tooretain IP addresses for their applications after failover tooAzure.</span></span>
 - <span data-ttu-id="9041a-129">Woodgrove назначил IP-адреса из диапазона 172.16.1.0/24, 172.16.2.0/24 tooits ресурсов в Azure.</span><span class="sxs-lookup"><span data-stu-id="9041a-129">Woodgrove has assigned IP addresses from range 172.16.1.0/24, 172.16.2.0/24 tooits resources running in Azure.</span></span>


<span data-ttu-id="9041a-130">Для банка Woodgrove toobe может tooreplicate tooAzure его виртуальные машины во время сохранения hello IP-адресов Вот какие hello компании toodo:</span><span class="sxs-lookup"><span data-stu-id="9041a-130">For Woodgrove toobe able tooreplicate its VMs tooAzure while retaining hello IP addresses, here's what hello company needs toodo:</span></span>

1. <span data-ttu-id="9041a-131">Создайте виртуальную сеть Azure.</span><span class="sxs-lookup"><span data-stu-id="9041a-131">Create an Azure virtual network.</span></span> <span data-ttu-id="9041a-132">Расширение hello в локальной сети, необходимо, чтобы приложения могут выполнять отработку отказа без проблем.</span><span class="sxs-lookup"><span data-stu-id="9041a-132">It should be an extension of hello on-premises network, so that applications can fail over seamlessly.</span></span>
2. <span data-ttu-id="9041a-133">Azure позволяет вам tooadd сеть сеть VPN-подключение, кроме toopoint сеть toohello виртуальных сетей, созданные в Azure.</span><span class="sxs-lookup"><span data-stu-id="9041a-133">Azure allows you tooadd site-to-site VPN connectivity, in addition toopoint-to-site connectivity toohello virtual networks created in Azure.</span></span>
3. <span data-ttu-id="9041a-134">При настройке подключения hello сайт сайт, в hello Azure сети, может осуществлять маршрутизацию трафика toohello локально (локальная сеть) только в том случае, если диапазон IP-адресов hello отличается от диапазона IP-адресов hello в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="9041a-134">When setting up hello site-to-site connection, in hello Azure network, you can route traffic toohello on-premises location (local-network) only if hello IP address range is different from hello on-premises IP address range.</span></span>
    - <span data-ttu-id="9041a-135">Это связано с тем, что Azure не поддерживает растянутые подсети.</span><span class="sxs-lookup"><span data-stu-id="9041a-135">This is because Azure doesn’t support stretched subnets.</span></span> <span data-ttu-id="9041a-136">Поэтому при наличии подсети 192.168.1.0/24 локальной 192.168.1.0/24 локальной сети нельзя добавить в hello сети Azure.</span><span class="sxs-lookup"><span data-stu-id="9041a-136">So if you have subnet 192.168.1.0/24 on-premises, you can’t add a local-network 192.168.1.0/24 in hello Azure network.</span></span>
    - <span data-ttu-id="9041a-137">Ожидается, так как Azure не знает, что отсутствуют активные ВМ в подсети hello и подсети hello создается только для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="9041a-137">This is expected because Azure doesn’t know that there are no active VMs in hello subnet, and that hello subnet is being created for disaster recovery only.</span></span>
    - <span data-ttu-id="9041a-138">toobe может toocorrectly маршрутизацию сетевого трафика за пределами Azure hello подсетей в сети hello и hello локальной сети должен конфликтуют.</span><span class="sxs-lookup"><span data-stu-id="9041a-138">toobe able toocorrectly route network traffic out of an Azure network hello subnets in hello network and hello local-network mustn't conflict.</span></span>

![Перед выполнением отработки отказа подсети](./media/hyper-v-site-walkthrough-network/network-design7.png)

### <a name="before-failover"></a><span data-ttu-id="9041a-140">Перед выполнением отработки отказа</span><span class="sxs-lookup"><span data-stu-id="9041a-140">Before failover</span></span>

1. <span data-ttu-id="9041a-141">Создайте дополнительную сеть (например, сеть восстановления).</span><span class="sxs-lookup"><span data-stu-id="9041a-141">Create an additional network (for example Recovery Network).</span></span> <span data-ttu-id="9041a-142">Это сеть hello в которой отработку отказа виртуальных машин были созданы.</span><span class="sxs-lookup"><span data-stu-id="9041a-142">This is hello network in which failed over VMs are created.</span></span>
2. <span data-ttu-id="9041a-143">tooensure, hello IP-адрес для виртуальной Машины сохраняется после отработки отказа, в свойствах виртуальной Машины hello > **Настройка**, укажите hello же IP-адресов, hello виртуальной Машины используется локальная и нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="9041a-143">tooensure that hello IP address for a VM is retained after a failover, in hello VM properties > **Configure**, specify hello same IP address that hello VM has on-premises, and click **Save**.</span></span>
3. <span data-ttu-id="9041a-144">При переключении hello ВМ Azure Site Recovery будет назначать hello, предоставляемые tooit IP адрес.</span><span class="sxs-lookup"><span data-stu-id="9041a-144">When hello VM is failed over, Azure Site Recovery will assign hello provided IP address tooit.</span></span>

    ![Свойства сети](./media/hyper-v-site-walkthrough-network/network-design8.png)

4. <span data-ttu-id="9041a-146">После отработки отказа триггер срабатывает и hello виртуальные машины создаются в Azure с hello требуется IP-адрес, можно подключиться при помощи сети toohello [Vnet tooVnet vonnection](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="9041a-146">After failover is trigger is triggered, and hello VMs are created in Azure with hello required IP address, you can connect toohello network using a [Vnet tooVnet vonnection](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span> <span data-ttu-id="9041a-147">Это действие можно выполнить с помощью сценария.</span><span class="sxs-lookup"><span data-stu-id="9041a-147">This action can be scripted.</span></span>
5. <span data-ttu-id="9041a-148">Маршруты необходимо соответствующим образом изменены, toobe tooreflect tooAzure теперь перемещен, 192.168.1.0/24.</span><span class="sxs-lookup"><span data-stu-id="9041a-148">Routes need toobe appropriately modified, tooreflect that 192.168.1.0/24 has now moved tooAzure.</span></span>

    ![После выполнения отработки отказа подсети](./media/hyper-v-site-walkthrough-network/network-design9.png)

### <a name="after-failover"></a><span data-ttu-id="9041a-150">После выполнения отработки отказа</span><span class="sxs-lookup"><span data-stu-id="9041a-150">After failover</span></span>

<span data-ttu-id="9041a-151">Если у вас нет сети Azure, как показано на рисунке выше, то после отработки отказа можно создать VPN-подключение типа "сеть — сеть" между основным сайтом и Azure.</span><span class="sxs-lookup"><span data-stu-id="9041a-151">If you don't have an Azure network as illustrated above, you can create a site-to-site VPN connection between your primary site and Azure, after failvoer.</span></span>

## <a name="change-ip-addresses"></a><span data-ttu-id="9041a-152">Изменение IP-адресов</span><span class="sxs-lookup"><span data-stu-id="9041a-152">Change IP addresses</span></span>

<span data-ttu-id="9041a-153">Это [блога](http://azure.microsoft.com/blog/2014/09/04/networking-infrastructure-setup-for-microsoft-azure-as-a-disaster-recovery-site/) объясняет, как tooset копирование hello Azure сетевой инфраструктуры, когда нет необходимости использовать tooretain IP адресов после перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="9041a-153">This [blog post](http://azure.microsoft.com/blog/2014/09/04/networking-infrastructure-setup-for-microsoft-azure-as-a-disaster-recovery-site/) explains how tooset up hello Azure networking infrastructure when you don't need tooretain IP addresses after failover.</span></span> <span data-ttu-id="9041a-154">Он начинается с описание приложения, осуществляет как tooset сеть в локальной, так и в Azure и заканчиваются сведения о выполнении переход на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="9041a-154">It starts with an application description, looks at how tooset up networking on-premises and in Azure, and concludes with information about running failovers.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="9041a-155">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="9041a-155">Next steps</span></span>

<span data-ttu-id="9041a-156">Go слишком[шаг 5: Подготовка Azure](hyper-v-site-walkthrough-prepare-azure.md)</span><span class="sxs-lookup"><span data-stu-id="9041a-156">Go too[Step 5: Prepare Azure](hyper-v-site-walkthrough-prepare-azure.md)</span></span>
