---
title: "Репликация приложений (VMware в Azure) | Документация Майкрософт"
description: "В этой статье приведены сведения о настройке репликации виртуальных машин VMware в Azure."
services: site-recovery
documentationcenter: 
author: asgang
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 09/29/2017
ms.author: asgang
ms.openlocfilehash: 028aa0f23c3a7c98c4801d9e306c5dcfa35aab80
ms.sourcegitcommit: 2d1153d625a7318d7b12a6493f5a2122a16052e0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/20/2017
---
# <a name="replicate-applications-running-on-vmware-virtual-machines-to-azure"></a>Репликация приложений, выполняемых на виртуальных машинах VMware, в Azure



В этой статье приведены сведения о настройке репликации виртуальных машин VMware в Azure.
## <a name="prerequisites"></a>Предварительные требования

В этой статье предполагается, что вы:

1.  [Настроили локальную исходную среду](site-recovery-set-up-vmware-to-azure.md).
2.  [Настроили целевую среду в Azure](site-recovery-prepare-target-vmware-to-azure.md).


## <a name="enable-replication"></a>Включение репликации
### <a name="before-you-start"></a>Перед началом работы
При репликации виртуальных машин VMware:

* Учетная запись пользователя Azure должна содержать определенные [разрешения](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines) для включения репликации новой виртуальной машины в Azure.
* Виртуальные машины VMware обнаруживаются каждые 15 минут. Может пройти 15 минут или более, прежде чем они будут обнаружены и отображены на портале Azure. Обнаружение может также занять 15 минут или более при добавлении нового сервера vCenter или узла vSphere.
* Изменения среды на виртуальной машине (например, установка средств VMware) также могут отобразиться на портале через 15 и более минут.
* Время последнего обнаружения виртуальных машин VMware можно узнать на странице **Серверы конфигурации** в поле **Последний контакт в** для сервера vCenter или узла vSphere.
* Чтобы добавить компьютеры для репликации, не дожидаясь запланированного обнаружения, выделите сервер конфигурации (не щелкая его) и нажмите кнопку **Обновить**.
* Если компьютер уже подготовлен, когда вы включаете репликацию, то сервер обработки автоматически устанавливает на него службу Mobility Service.


### <a name="enable-replication-as-follows"></a>Включите репликацию следующим образом:

1. Последовательно выберите **Шаг 2. Репликация приложения** > **Источник**. Включив репликацию впервые, щелкните **+Replicate** (+ Реплицировать) в хранилище, чтобы включить репликацию для дополнительных машин.
2. На странице **Источник** щелкните **Источник** и выберите нужный сервер конфигурации.
3. В поле **Тип компьютера** выберите параметр **Виртуальные машины** или **Физические компьютеры**.
4. В поле **vCenter/vSphere Hypervisor** (Гипервизор vCenter или vSphere) выберите сервер vCenter, который управляет узлом vSphere, или сам узел. Этот параметр не учитывается при репликации физических компьютеров.
5. Выберите сервер обработки, который имеет то же имя, что и сервер конфигурации (если вы не создали других серверов обработки). Нажмите кнопку **ОК**.

    ![Включение источника репликации](./media/site-recovery-vmware-to-azure/enable-replication2.png)

6. Для параметра **Цель** выберите подписку и группу ресурсов, в которых вы хотите создавать виртуальные машины при отработке отказа. Выберите модель развертывания, которая будет использоваться в Azure (классическая или Azure Resource Manager) для виртуальных машин после отработки отказа.

7. Выберите учетную запись службы хранения Azure, которую вы хотите использовать для репликации данных. 

    > [!NOTE]

    >   * Можно выбрать учетную запись хранения класса Standard или Premium. Если вы выберете учетную запись класса Premium, потребуется указать дополнительную учетную запись хранения класса Standard для журналов текущей репликации. Учетные записи должны находиться в том же регионе, что и хранилище служб восстановления.
    >   * Если вам нужна другая учетная запись хранения, [создайте ее](../storage/common/storage-create-storage-account.md). Чтобы создать учетную запись хранения используя диспетчер ресурсов, щелкните **Создать**. Если нужно создать учетную запись хранения, используя классическую модель, это можно сделать на портале Azure.

8. Выберите сеть и подсеть Azure, к которой будут подключаться развернутые виртуальные машины Azure после отработки отказа. Сеть должна располагаться в том же регионе, что и хранилище служб восстановления. Выберите **Настроить сейчас для всех выбранных компьютеров**, чтобы применить параметр сети ко всем защищаемым компьютерам. Выберите **Отложить настройку**, чтобы выбрать сеть Azure для каждого компьютера. Если у вас нет сети, ее необходимо [создать](#set-up-an-azure-network). Чтобы создать сеть, используя диспетчер ресурсов, щелкните **Создать**. Если нужно создать сеть, используя классическую модель, это можно сделать [на портале Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md). Выберите подсеть, если это применимо, затем нажмите кнопку **ОК**.

    ![Включение параметров целевого объекта репликации](./media/site-recovery-vmware-to-azure/enable-rep3.png)
9. В разделе **Виртуальные машины** > **Выбор виртуальных машин**, выберите каждую машину, которую нужно реплицировать. Можно выбрать только те компьютеры, для которых можно включить репликацию. Нажмите кнопку **ОК**.

    ![Включение в репликацию выбранных виртуальных машин](./media/site-recovery-vmware-to-azure/enable-replication5.png)
10. В поле **Свойства** > **Настройка свойств** выберите учетную запись, используемую сервером обработки для автоматической установки службы Mobility Service на компьютере.  
11. По умолчанию будут реплицироваться все диски. Чтобы исключить диски из репликации, щелкните **Все диски**, а затем снимите флажки напротив дисков, которые не нужно реплицировать.  Нажмите кнопку **ОК**. Позже можно задать дополнительные свойства. Дополнительные сведения об исключении дисков см.в [этой статье](site-recovery-exclude-disk.md).

    ![Включение параметров политики репликации](./media/site-recovery-vmware-to-azure/enable-replication6.png)

12. Выберите **Параметры репликации** > **Настройка параметров репликации** и убедитесь, что выбрана правильная политика репликации. Параметры политики репликации можно изменить, последовательно выбрав **Параметры** > **Политики репликации** > имя политики > **Изменить параметры**. Изменения, примененные к политике, будут применены к репликации и новым компьютерам.
13. Включите параметр **Multi-VM consistency** (Согласованность нескольких виртуальных машин), если хотите объединить компьютеры в группу репликации. Укажите имя группы и нажмите кнопку **ОК**. 

    > [!NOTE]

    >    * Компьютеры в группе репликации реплицируются вместе и имеют отказоустойчивые и согласованные точки восстановления после отработки отказа.
    >    * Объедините виртуальные машины и физические сервера, чтобы они могли зеркалировать рабочие нагрузки. Включение согласованности нескольких виртуальных машин может повлиять на производительность рабочей нагрузки. Используйте ее, только если компьютеры выполняют одну и ту же рабочую нагрузку и должны действовать согласованно.

    ![Включение репликации](./media/site-recovery-vmware-to-azure/enable-replication7.png)
14. Щелкните **Включить репликацию**. Ход выполнения задания **включения защиты** можно отслеживать, выбрав **Параметры** > **Задания** > **Задания Site Recovery**. После выполнения задания **Завершить подготовку защиты** виртуальная машина будет готова к отработке отказа.

> [!NOTE]
> Если компьютер готов к принудительной установке, компонент службы Mobility устанавливается при включении защиты. После установки компонента на компьютере задание защиты будет запущено и завершится ошибкой. После сбоя каждый компьютер необходимо будет перезапустить вручную. После перезапуска будет снова запущено задание защиты и начнется начальная репликация.
>
>

## <a name="view-and-manage-vm-properties"></a>Просмотр свойств виртуальной машины и управление ими

Далее нужно проверить свойства исходного компьютера. Помните, что имя виртуальной машины Azure должно соответствовать [требованиям к виртуальным машинам Azure после отработки отказа](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).

1. Щелкните **Параметры** >  > **Реплицированные элементы**, а затем выберите нужный компьютер. На странице **Основные компоненты** отображается информация о параметрах и состоянии компьютера.
2. На разделе **Свойства** можно просмотреть сведения о репликации и отработке отказа для виртуальной машины.
3. В разделе **Вычисления и сеть** > **Свойства вычислений** можно указать имя и целевой размер виртуальной машины Azure. При необходимости измените имя в соответствии с требованиями Azure.

    ![Свойства вычислений и сети](./media/site-recovery-vmware-to-azure/vmproperties.png)

4.  Вы можете выбрать [группу ресурсов](https://docs.microsoft.com/azure/virtual-machines/windows/infrastructure-resource-groups-guidelines), из которой компьютер будет получен для отработки отказа. Этот параметр можно изменить в любое время перед отработкой отказа. Если после отработки отказа переместить компьютер в другую группу ресурсов, параметры защиты для этого компьютера будут нарушены.
5. Кроме того, можно выбрать [группу доступности](https://docs.microsoft.com/azure/virtual-machines/windows/infrastructure-availability-sets-guidelines), если компьютер нужно добавить в нее после отработки отказа. При выборе группы доступности учитывайте следующее:

    * Отображаются только группы доступности, принадлежащие к указанной группе ресурсов.  
    * Компьютеры в разных виртуальных сетях не могут входить в одну группу доступности.
    * В одну группу доступности могут входить только виртуальные машины одинакового размера.
5. Кроме того, можно просмотреть и добавить сведения о целевой сети, подсети и целевом IP-адресе, назначенном виртуальной машине Azure.
6. На странице **Диски** отображаются сведения о дисках операционной системы и дисках данных на виртуальной машине для репликации.

### <a name="network-adapters-and-ip-addressing"></a>Сетевые адаптеры и назначение IP-адресов

- Вы можете задать целевой IP-адрес. Если не указать его, компьютер, для которого выполнена отработка отказа, будет использовать DHCP. Если задать адрес, недоступный при отработке отказа, произойдет сбой. Если целевой IP-адрес доступен в сети тестовой отработки отказа, его можно использовать для тестовой отработки отказа.
- Количество сетевых адаптеров зависит от размера, указанного для целевой виртуальной машины:
    - Если число сетевых адаптеров на исходном компьютере меньше или равно числу адаптеров, разрешенному для целевого компьютера, то на целевом и исходном компьютерах число адаптеров одинаковое.
    - Если число адаптеров на исходной виртуальной машине превышает допустимое для целевого размера, используется максимальный размер целевой машины.
    Например, если на исходной машине есть два сетевых адаптера, а размер целевой машины поддерживает четыре, на целевой машине будет два адаптера. Если на исходном компьютере два адаптера, но целевой размер поддерживает только один, то на целевом компьютере будет работать только один адаптер.
    - Если для виртуальной машины настроено несколько сетевых адаптеров, все они будут подключены к одной сети. В виртуальной машине Azure сетевой адаптер, который отобразится первым в списке, становится сетевым адаптером *по умолчанию*.

### <a name="azure-hybrid-use-benefit"></a>Программа преимуществ гибридного использования Azure

Клиенты Microsoft Software Assurance могут использовать программу преимуществ гибридного использования Azure, чтобы сэкономить на стоимости лицензирования компьютеров Windows Server, которые переносятся в Azure, или использовать Azure для аварийного восстановления. Если вы имеете право применять преимущество гибридного использования Azure, вы можете назначить его виртуальной машине, которую создает служба Azure Site Recovery в Azure в случае отработки отказа. Для этого:
- Перейдите в раздел свойств "Вычисления и сеть" реплицируемой виртуальной машины.
- Ответьте на вопрос, есть ли у вас лицензия Windows Server, дающая право на участие в программе преимуществ гибридного использования Azure.
- Установите флажок, чтобы подтвердить наличие соответствующей лицензии Windows Server с программой Software Assurance, которую можно использовать для применения преимуществ гибридного использования на компьютере, который будет создан при отработке отказа.
- Сохраните настройки для реплицируемого компьютера.

Узнайте больше о [преимуществе гибридного использования Azure](https://aka.ms/azure-hybrid-use-benefit-pricing).

## <a name="common-issues"></a>Распространенные проблемы

* Размер каждого диска не должен превышать 1 ТБ.
* Диск операционной системы представляет собой базовый, а не динамический диск.
* У виртуальных машин с поддержкой 2/UEFI операционная система должна быть из семейства Windows, а размер загрузочного диска не должен превышать 300 ГБ.

## <a name="next-steps"></a>Дальнейшие действия

После того как защита будет установлена и компьютер окажется в защищенном состоянии, можно запустить пробную [отработку отказа](site-recovery-failover.md), чтобы определить, появится ли ваше приложение в Azure.

Если вы захотите отключить защиту, см. сведения в статье [Удаление серверов и отключение защиты](site-recovery-manage-registration-and-protection.md).
