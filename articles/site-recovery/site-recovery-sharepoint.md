---
title: "aaaReplicate многоуровневого приложения SharePoint с помощью Azure Site Recovery | Документы Microsoft"
description: "В этой статье описывается как tooreplicate многоуровневого приложения SharePoint с помощью возможностей Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: sujayt
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: sutalasi
ms.openlocfilehash: d856034ac2a3c95b0c1f0cf85e62c4e7a5a3210f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="replicate-a-multi-tier-sharepoint-application-for-disaster-recovery-using-azure-site-recovery"></a><span data-ttu-id="dad7d-103">Репликация многоуровневого приложения SharePoint для аварийного восстановления с помощью Azure Site Recovery | Документы Майкрософт</span><span class="sxs-lookup"><span data-stu-id="dad7d-103">Replicate a multi-tier SharePoint application for disaster recovery using Azure Site Recovery</span></span>

<span data-ttu-id="dad7d-104">В этой статье подробно описываются как приложения SharePoint с помощью tooprotect [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="dad7d-104">This article describes in detail how tooprotect a SharePoint application using  [Azure Site Recovery](site-recovery-overview.md).</span></span>


## <a name="overview"></a><span data-ttu-id="dad7d-105">Обзор</span><span class="sxs-lookup"><span data-stu-id="dad7d-105">Overview</span></span>

<span data-ttu-id="dad7d-106">Microsoft SharePoint — это эффективное приложение, которое может помочь рабочей группе или отделу организовать информацию, обмениваться ею и осуществлять совместную работу.</span><span class="sxs-lookup"><span data-stu-id="dad7d-106">Microsoft SharePoint is a powerful application that can help a group or department organize, collaborate, and share information.</span></span> <span data-ttu-id="dad7d-107">SharePoint может предоставлять порталы интрасети, функции управления файлами и документами, совместной работы, социальных сетей, экстрасетей, веб-сайтов, поиска в корпоративной среде и бизнес-аналитики.</span><span class="sxs-lookup"><span data-stu-id="dad7d-107">SharePoint can provide intranet portals, document and file management, collaboration, social networks, extranets, websites, enterprise search, and business intelligence.</span></span> <span data-ttu-id="dad7d-108">Эта система также включает возможности интеграции систем и процессов и автоматизации рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="dad7d-108">It also has system integration, process integration, and workflow automation capabilities.</span></span> <span data-ttu-id="dad7d-109">Как правило организации считают, что как уровня 1 приложения конфиденциальных toodowntime и потерю данных.</span><span class="sxs-lookup"><span data-stu-id="dad7d-109">Typically, organizations consider it as a Tier-1 application sensitive toodowntime and data loss.</span></span>

<span data-ttu-id="dad7d-110">На данный момент Microsoft SharePoint не предоставляет какие-либо готовые функции аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="dad7d-110">Today, Microsoft SharePoint  does not provide any out-of-the-box disaster recovery capabilities.</span></span> <span data-ttu-id="dad7d-111">Независимо от типа hello и масштаб аварии восстановления используются hello центра резервные данные, которые можно восстановить hello фермы.</span><span class="sxs-lookup"><span data-stu-id="dad7d-111">Regardless of hello type and scale of a disaster, recovery involves hello use of a standby data center that you can recover hello farm to.</span></span> <span data-ttu-id="dad7d-112">Центры обработки данных на резервном требуются для сценариев, где локальные резервные системы и резервные копии не может восстановиться hello отказов на hello основного центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="dad7d-112">Standby data centers are required for scenarios where local redundant systems and backups cannot recover from hello outage at hello primary data center.</span></span>

<span data-ttu-id="dad7d-113">Хороший аварийного восстановления должен позволять моделирования планов восстановления вокруг архитектур hello сложных приложений, например SharePoint.</span><span class="sxs-lookup"><span data-stu-id="dad7d-113">A good disaster recovery solution should allow modeling of recovery plans around hello  complex application architectures such as SharePoint.</span></span> <span data-ttu-id="dad7d-114">Он также должен иметь hello возможность tooadd настроенные действия toohandle для сопоставлений между различными уровнями и таким образом обеспечивать отработку отказа одним щелчком с нижней RTO hello для события сбоя.</span><span class="sxs-lookup"><span data-stu-id="dad7d-114">It should also have hello ability tooadd customized steps toohandle application mappings between various tiers and hence providing a single-click failover with a lower RTO in hello event of a disaster.</span></span>

<span data-ttu-id="dad7d-115">В этой статье подробно описываются как приложения SharePoint с помощью tooprotect [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="dad7d-115">This article describes in detail how tooprotect a SharePoint application using [Azure Site Recovery](site-recovery-overview.md).</span></span> <span data-ttu-id="dad7d-116">В этой статье рассматриваются рекомендации по репликация tooAzure приложения SharePoint три уровня, как это можно сделать аварийного восстановления и как можно tooAzure приложения hello отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-116">This article will cover best practices for replicating a three tier SharePoint application tooAzure, how you can do a disaster recovery drill, and how you can failover hello application tooAzure.</span></span>

<span data-ttu-id="dad7d-117">Вы можете ознакомиться с hello под видео о восстановлении tooAzure несколькими уровня приложения.</span><span class="sxs-lookup"><span data-stu-id="dad7d-117">You can watch hello below video about recovering a multi tier application tooAzure.</span></span>

> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/Disaster-Recovery-of-load-balanced-multi-tier-applications-using-Azure-Site-Recovery/player]


## <a name="prerequisites"></a><span data-ttu-id="dad7d-118">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="dad7d-118">Prerequisites</span></span>

<span data-ttu-id="dad7d-119">Прежде чем начать, убедитесь, что вы понимаете следующие hello:</span><span class="sxs-lookup"><span data-stu-id="dad7d-119">Before you start, make sure you understand hello following:</span></span>

1. [<span data-ttu-id="dad7d-120">Репликация tooAzure виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="dad7d-120">Replicating a virtual machine tooAzure</span></span>](site-recovery-vmware-to-azure.md)
2. <span data-ttu-id="dad7d-121">Как слишком[проектирования сети восстановления](site-recovery-network-design.md)</span><span class="sxs-lookup"><span data-stu-id="dad7d-121">How too[design a recovery network](site-recovery-network-design.md)</span></span>
3. [<span data-ttu-id="dad7d-122">Выполнив tooAzure теста отработки отказа</span><span class="sxs-lookup"><span data-stu-id="dad7d-122">Doing a test failover tooAzure</span></span>](site-recovery-test-failover-to-azure.md)
4. [<span data-ttu-id="dad7d-123">Выполнив tooAzure отработки отказа</span><span class="sxs-lookup"><span data-stu-id="dad7d-123">Doing a failover tooAzure</span></span>](site-recovery-failover.md)
5. <span data-ttu-id="dad7d-124">Как слишком[репликации контроллера домена](site-recovery-active-directory.md)</span><span class="sxs-lookup"><span data-stu-id="dad7d-124">How too[replicate a domain controller](site-recovery-active-directory.md)</span></span>
6. <span data-ttu-id="dad7d-125">Как слишком[репликации SQL Server](site-recovery-sql.md)</span><span class="sxs-lookup"><span data-stu-id="dad7d-125">How too[replicate SQL Server](site-recovery-sql.md)</span></span>

## <a name="sharepoint-architecture"></a><span data-ttu-id="dad7d-126">Архитектура SharePoint</span><span class="sxs-lookup"><span data-stu-id="dad7d-126">SharePoint architecture</span></span>

<span data-ttu-id="dad7d-127">SharePoint могут развертываться на одном или нескольких серверах, с помощью многоуровневой топологии и ролей сервера tooimplement проект фермы, который соответствует конкретным целям.</span><span class="sxs-lookup"><span data-stu-id="dad7d-127">SharePoint can be deployed on one or more servers using tiered topologies and server roles tooimplement a farm design that meets specific goals and objectives.</span></span> <span data-ttu-id="dad7d-128">Типичная большая ферма серверов SharePoint с высокой загрузкой, которая поддерживает большое число одновременных пользователей и элементов содержимого, использует группирование служб как часть стратегии масштабирования.</span><span class="sxs-lookup"><span data-stu-id="dad7d-128">A typical large, high-demand SharePoint server farm that supports a high number of concurrent users and a large number of content items use service grouping as part of their scalability strategy.</span></span> <span data-ttu-id="dad7d-129">Этот подход включает выполнение служб на выделенных серверах, группирование их и затем масштабирование hello серверы в группу.</span><span class="sxs-lookup"><span data-stu-id="dad7d-129">This approach involves running services on dedicated servers, grouping these services together, and then scaling out hello servers as a group.</span></span> <span data-ttu-id="dad7d-130">Hello следующую топологию иллюстрирует hello службы и группирование для трехуровневая ферма серверов SharePoint server.</span><span class="sxs-lookup"><span data-stu-id="dad7d-130">hello following topology illustrates hello service and server grouping for a three tier SharePoint server farm.</span></span> <span data-ttu-id="dad7d-131">Подробные инструкции о различных топологиях SharePoint обратитесь tooSharePoint документации и архитектур строки продукта.</span><span class="sxs-lookup"><span data-stu-id="dad7d-131">Please refer tooSharePoint documentation and product line architectures for detailed guidance on different SharePoint topologies.</span></span> <span data-ttu-id="dad7d-132">Дополнительные сведения о развертывании SharePoint 2013 см. в [этом документе](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span><span class="sxs-lookup"><span data-stu-id="dad7d-132">You can find more details about SharePoint 2013 deployment in [this document](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span></span>



![Модель развертывания 1](./media/site-recovery-sharepoint/sharepointarch.png)


## <a name="site-recovery-support"></a><span data-ttu-id="dad7d-134">Поддержка Site Recovery</span><span class="sxs-lookup"><span data-stu-id="dad7d-134">Site Recovery support</span></span>

<span data-ttu-id="dad7d-135">Для написания этой статьи использовались виртуальные машины VMware под управлением Windows Server 2012 R2 Enterprise.</span><span class="sxs-lookup"><span data-stu-id="dad7d-135">For creating this article, VMware virtual machines with Windows Server 2012 R2 Enterprise were used.</span></span> <span data-ttu-id="dad7d-136">Кроме того, использовались выпуски SharePoint 2013 Enterprise и SQL Server 2014 Enterprise.</span><span class="sxs-lookup"><span data-stu-id="dad7d-136">SharePoint 2013 Enterprise edition and SQL server 2014 Enterprise edition were used.</span></span> <span data-ttu-id="dad7d-137">Как репликация Site Recovery не зависит от приложения, рекомендации hello приведены здесь ожидаемый toohold на также в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="dad7d-137">As Site Recovery replication is application agnostic, hello recommendations provided here are expected toohold on for following scenarios as well.</span></span>

### <a name="source-and-target"></a><span data-ttu-id="dad7d-138">Исходный и целевой объект</span><span class="sxs-lookup"><span data-stu-id="dad7d-138">Source and target</span></span>

<span data-ttu-id="dad7d-139">**Сценарий**</span><span class="sxs-lookup"><span data-stu-id="dad7d-139">**Scenario**</span></span> | <span data-ttu-id="dad7d-140">**tooa вторичного сайта**</span><span class="sxs-lookup"><span data-stu-id="dad7d-140">**tooa secondary site**</span></span> | <span data-ttu-id="dad7d-141">**tooAzure**</span><span class="sxs-lookup"><span data-stu-id="dad7d-141">**tooAzure**</span></span>
--- | --- | ---
<span data-ttu-id="dad7d-142">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="dad7d-142">**Hyper-V**</span></span> | <span data-ttu-id="dad7d-143">Да</span><span class="sxs-lookup"><span data-stu-id="dad7d-143">Yes</span></span> | <span data-ttu-id="dad7d-144">Да</span><span class="sxs-lookup"><span data-stu-id="dad7d-144">Yes</span></span>
<span data-ttu-id="dad7d-145">**VMware**</span><span class="sxs-lookup"><span data-stu-id="dad7d-145">**VMware**</span></span> | <span data-ttu-id="dad7d-146">Да</span><span class="sxs-lookup"><span data-stu-id="dad7d-146">Yes</span></span> | <span data-ttu-id="dad7d-147">Да</span><span class="sxs-lookup"><span data-stu-id="dad7d-147">Yes</span></span>
<span data-ttu-id="dad7d-148">**Физический сервер**</span><span class="sxs-lookup"><span data-stu-id="dad7d-148">**Physical server**</span></span> | <span data-ttu-id="dad7d-149">Да</span><span class="sxs-lookup"><span data-stu-id="dad7d-149">Yes</span></span> | <span data-ttu-id="dad7d-150">Да</span><span class="sxs-lookup"><span data-stu-id="dad7d-150">Yes</span></span>

### <a name="sharepoint-versions"></a><span data-ttu-id="dad7d-151">Версии SharePoint</span><span class="sxs-lookup"><span data-stu-id="dad7d-151">SharePoint Versions</span></span>
<span data-ttu-id="dad7d-152">поддерживаются следующие версии SharePoint server Hello.</span><span class="sxs-lookup"><span data-stu-id="dad7d-152">hello following SharePoint server versions are supported.</span></span>

* <span data-ttu-id="dad7d-153">SharePoint Server 2013 Standard</span><span class="sxs-lookup"><span data-stu-id="dad7d-153">SharePoint server 2013 Standard</span></span>
* <span data-ttu-id="dad7d-154">SharePoint Server 2013 Enterprise</span><span class="sxs-lookup"><span data-stu-id="dad7d-154">SharePoint server 2013 Enterprise</span></span>
* <span data-ttu-id="dad7d-155">SharePoint Server 2016 Standard</span><span class="sxs-lookup"><span data-stu-id="dad7d-155">SharePoint server 2016 Standard</span></span>
* <span data-ttu-id="dad7d-156">SharePoint Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="dad7d-156">SharePoint server 2016 Enterprise</span></span>

### <a name="things-tookeep-in-mind"></a><span data-ttu-id="dad7d-157">Действия tookeep помнить</span><span class="sxs-lookup"><span data-stu-id="dad7d-157">Things tookeep in mind</span></span>

<span data-ttu-id="dad7d-158">Если вы используете общего кластера на диске как любого уровня приложения, то не может быть tooreplicate репликации может toouse Site Recovery этих виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="dad7d-158">If you are using a shared disk-based cluster as any tier in your application then you will not be able toouse Site Recovery replication tooreplicate those virtual machines.</span></span> <span data-ttu-id="dad7d-159">Можно использовать собственный репликации, предоставляемые приложения hello, а затем использовать [плана восстановления](site-recovery-create-recovery-plans.md) toofailover на всех уровнях.</span><span class="sxs-lookup"><span data-stu-id="dad7d-159">You can use native replication provided by hello application and then use a [recovery plan](site-recovery-create-recovery-plans.md) toofailover all tiers.</span></span>

## <a name="replicating-virtual-machines"></a><span data-ttu-id="dad7d-160">Репликация виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="dad7d-160">Replicating virtual machines</span></span>

<span data-ttu-id="dad7d-161">Выполните [в этом руководстве](site-recovery-vmware-to-azure.md) toostart репликации tooAzure hello виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="dad7d-161">Follow [this guidance](site-recovery-vmware-to-azure.md) toostart replicating hello virtual machine tooAzure.</span></span>

* <span data-ttu-id="dad7d-162">После завершения репликации hello убедитесь, что переход виртуальной машины tooeach каждого уровня и выберите же доступности в "реплицированные элемента > Параметры > Свойства > вычисления и сеть".</span><span class="sxs-lookup"><span data-stu-id="dad7d-162">Once hello replication is complete, make sure you go tooeach virtual machine of each tier and select same availability set in 'Replicated item > Settings > Properties > Compute and Network'.</span></span> <span data-ttu-id="dad7d-163">Например если ваш веб-уровень содержит три виртуальные машины, убедитесь, что все виртуальные машины, 3 — приветствия toobe частью того же доступности в Azure.</span><span class="sxs-lookup"><span data-stu-id="dad7d-163">For example, if your web tier has 3 VMs, ensure all hello 3 VMs are configured toobe part of same availability set in Azure.</span></span>

    ![Set-Availability-Set](./media/site-recovery-sharepoint/select-av-set.png)

* <span data-ttu-id="dad7d-165">Рекомендации по защите DNS и Active Directory, см. в разделе слишком[защиты Active Directory и DNS](site-recovery-active-directory.md) документа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-165">For guidance on protecting Active Directory and DNS, refer too[Protect Active Directory and DNS](site-recovery-active-directory.md) document.</span></span>

* <span data-ttu-id="dad7d-166">Для получения рекомендаций по защите уровня базы данных на сервере SQL ссылаться слишком[защиты SQL Server](site-recovery-active-directory.md) документа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-166">For guidance on protecting database tier running on SQL server, refer too[Protect SQL Server](site-recovery-active-directory.md) document.</span></span>

## <a name="networking-configuration"></a><span data-ttu-id="dad7d-167">Конфигурация сети</span><span class="sxs-lookup"><span data-stu-id="dad7d-167">Networking configuration</span></span>

### <a name="network-properties"></a><span data-ttu-id="dad7d-168">Свойства сети</span><span class="sxs-lookup"><span data-stu-id="dad7d-168">Network properties</span></span>

* <span data-ttu-id="dad7d-169">Hello приложения и веб-уровень виртуальных машин сетевых параметров на портале Azure, чтобы виртуальные машины hello получить вложенные toohello правильной сети аварийного восстановления после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-169">For hello App and Web tier VMs, configure network settings in Azure portal so that hello VMs get attached toohello right DR network after failover.</span></span>

    ![Выбор сети](./media/site-recovery-sharepoint/select-network.png)


* <span data-ttu-id="dad7d-171">При использовании статического IP-адреса, укажите IP-адрес hello требуется hello tootake виртуальной машины в hello **целевой IP-адрес** поля</span><span class="sxs-lookup"><span data-stu-id="dad7d-171">If you are using a static IP, then specify hello IP that you want hello virtual machine tootake in hello **Target IP** field</span></span>

    ![Настройка статического IP-адреса](./media/site-recovery-sharepoint/set-static-ip.png)

### <a name="dns-and-traffic-routing"></a><span data-ttu-id="dad7d-173">DNS и маршрутизация трафика</span><span class="sxs-lookup"><span data-stu-id="dad7d-173">DNS and Traffic Routing</span></span>

<span data-ttu-id="dad7d-174">Для узлов, подключенных к Интернету [создать профиль диспетчера трафика «Приоритет» типа](../traffic-manager/traffic-manager-create-profile.md) в hello подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="dad7d-174">For internet facing sites, [create a Traffic Manager profile of 'Priority' type](../traffic-manager/traffic-manager-create-profile.md) in hello Azure subscription.</span></span> <span data-ttu-id="dad7d-175">И затем настроить профиль DNS и диспетчера трафика в следующих способом hello.</span><span class="sxs-lookup"><span data-stu-id="dad7d-175">And then configure your DNS and Traffic Manager profile in hello following manner.</span></span>


| <span data-ttu-id="dad7d-176">**Where**</span><span class="sxs-lookup"><span data-stu-id="dad7d-176">**Where**</span></span> | <span data-ttu-id="dad7d-177">**Источник**</span><span class="sxs-lookup"><span data-stu-id="dad7d-177">**Source**</span></span> | <span data-ttu-id="dad7d-178">**Цель**</span><span class="sxs-lookup"><span data-stu-id="dad7d-178">**Target**</span></span>|
| --- | --- | --- |
| <span data-ttu-id="dad7d-179">Общедоступное имя DNS</span><span class="sxs-lookup"><span data-stu-id="dad7d-179">Public DNS</span></span> | <span data-ttu-id="dad7d-180">Общедоступное имя DNS для сайтов SharePoint</span><span class="sxs-lookup"><span data-stu-id="dad7d-180">Public DNS for SharePoint sites</span></span> <br/><br/> <span data-ttu-id="dad7d-181">Например: sharepoint.contoso.com</span><span class="sxs-lookup"><span data-stu-id="dad7d-181">Ex: sharepoint.contoso.com</span></span> | <span data-ttu-id="dad7d-182">Диспетчер трафика</span><span class="sxs-lookup"><span data-stu-id="dad7d-182">Traffic Manager</span></span> <br/><br/> <span data-ttu-id="dad7d-183">contososharepoint.trafficmanager.net</span><span class="sxs-lookup"><span data-stu-id="dad7d-183">contososharepoint.trafficmanager.net</span></span> |
| <span data-ttu-id="dad7d-184">Локальное имя DNS</span><span class="sxs-lookup"><span data-stu-id="dad7d-184">On-premises DNS</span></span> | <span data-ttu-id="dad7d-185">sharepointonprem.contoso.com</span><span class="sxs-lookup"><span data-stu-id="dad7d-185">sharepointonprem.contoso.com</span></span> | <span data-ttu-id="dad7d-186">Общедоступный IP-адрес в локальной ферме hello</span><span class="sxs-lookup"><span data-stu-id="dad7d-186">Public IP on hello on-premises farm</span></span> |


<span data-ttu-id="dad7d-187">В профиль диспетчера трафика hello [создать конечные точки источника и восстановления hello](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="dad7d-187">In hello Traffic Manager profile, [create hello primary and recovery endpoints](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span></span> <span data-ttu-id="dad7d-188">Используйте внешнюю конечную точку hello локальную конечную точку и общедоступный IP-адрес для конечной точки Azure.</span><span class="sxs-lookup"><span data-stu-id="dad7d-188">Use hello external endpoint for on-premises endpoint and public IP for Azure endpoint.</span></span> <span data-ttu-id="dad7d-189">Убедитесь, что hello приоритет выше tooon локальной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="dad7d-189">Ensure that hello priority is set higher tooon-premises endpoint.</span></span>

<span data-ttu-id="dad7d-190">Узел тестовой страницы через определенный порт (например, 800) в hello SharePoint веб-уровень, чтобы tooautomatically диспетчера трафика обнаруживает доступности после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-190">Host a test page on a specific port (for example, 800) in hello SharePoint web tier in order for Traffic Manager tooautomatically detect availability post failover.</span></span> <span data-ttu-id="dad7d-191">Это обходное решение на случай, если невозможно включить анонимную проверку подлинности для всех сайтов SharePoint.</span><span class="sxs-lookup"><span data-stu-id="dad7d-191">This is a workaround in case you cannot enable anonymous authentication on any of your SharePoint sites.</span></span>

<span data-ttu-id="dad7d-192">[Настройка профиля диспетчера трафика hello](../traffic-manager/traffic-manager-configure-priority-routing-method.md) с hello ниже параметры.</span><span class="sxs-lookup"><span data-stu-id="dad7d-192">[Configure hello Traffic Manager profile](../traffic-manager/traffic-manager-configure-priority-routing-method.md) with hello below settings.</span></span>

* <span data-ttu-id="dad7d-193">Метод маршрутизации — "Приоритет"</span><span class="sxs-lookup"><span data-stu-id="dad7d-193">Routing method - 'Priority'</span></span>
* <span data-ttu-id="dad7d-194">DNS время toolive (TTL) — 30 секунд</span><span class="sxs-lookup"><span data-stu-id="dad7d-194">DNS time toolive (TTL) - '30 seconds'</span></span>
* <span data-ttu-id="dad7d-195">Параметры монитора конечной точки — если можно включить анонимную проверку подлинности, вы можете указать конечную точку определенного веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="dad7d-195">Endpoint monitor settings - If you can enable anonymous authentication, you can give a specific website endpoint.</span></span> <span data-ttu-id="dad7d-196">В противном случае можно использовать тестовую страницу по конкретному порту (например, 800).</span><span class="sxs-lookup"><span data-stu-id="dad7d-196">Or, you can use a test page on a specific port (for example, 800).</span></span>

## <a name="creating-a-recovery-plan"></a><span data-ttu-id="dad7d-197">Создание плана восстановления</span><span class="sxs-lookup"><span data-stu-id="dad7d-197">Creating a recovery plan</span></span>

<span data-ttu-id="dad7d-198">План восстановления позволяет последовательность отработки отказа hello различных уровней многоуровневого приложения, таким образом, поддерживая согласованность приложения.</span><span class="sxs-lookup"><span data-stu-id="dad7d-198">A recovery plan allows sequencing hello failover of various tiers in a multi-tier application, hence, maintaining application consistency.</span></span> <span data-ttu-id="dad7d-199">При создании плана восстановления многоуровневые веб-приложение, выполните hello шаги, описанные ниже.</span><span class="sxs-lookup"><span data-stu-id="dad7d-199">Follow hello below steps while creating a recovery plan for a multi-tier web application.</span></span> <span data-ttu-id="dad7d-200">Дополнительные сведения см. в статье [Создание планов восстановления](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span><span class="sxs-lookup"><span data-stu-id="dad7d-200">[Learn more about creating a recovery plan](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span></span>

### <a name="adding-virtual-machines-toofailover-groups"></a><span data-ttu-id="dad7d-201">Добавление групп toofailover виртуальные машины</span><span class="sxs-lookup"><span data-stu-id="dad7d-201">Adding virtual machines toofailover groups</span></span>

1. <span data-ttu-id="dad7d-202">Создайте план восстановления, добавление hello приложения и веб-уровень виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="dad7d-202">Create a recovery plan by adding hello App and Web tier VMs.</span></span>
2. <span data-ttu-id="dad7d-203">Щелкните «Настройка» toogroup hello виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="dad7d-203">Click on 'Customize' toogroup hello VMs.</span></span> <span data-ttu-id="dad7d-204">По умолчанию все виртуальные машины входят в группу 1.</span><span class="sxs-lookup"><span data-stu-id="dad7d-204">By default, all VMs are part of 'Group 1'.</span></span>

    ![Настройка плана восстановления](./media/site-recovery-sharepoint/rp-groups.png)

3. <span data-ttu-id="dad7d-206">Создать новую группу (группа 2) и переместить в новую группу hello hello веб-уровень виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="dad7d-206">Create another Group (Group 2) and move hello Web tier VMs into hello new group.</span></span> <span data-ttu-id="dad7d-207">Виртуальные машины уровня приложений должны входить в группу 1, а виртуальные машины веб-уровня — в группу 2.</span><span class="sxs-lookup"><span data-stu-id="dad7d-207">Your App tier VMs should be part of 'Group 1' and Web tier VMs should be part of 'Group 2'.</span></span> <span data-ttu-id="dad7d-208">Это tooensure, hello виртуальных машин уровня загрузки после виртуальных машин уровня Web App.</span><span class="sxs-lookup"><span data-stu-id="dad7d-208">This is tooensure that hello App tier VMs boot up first followed by Web tier VMs.</span></span>


### <a name="adding-scripts-toohello-recovery-plan"></a><span data-ttu-id="dad7d-209">Добавление плана восстановления toohello сценариев</span><span class="sxs-lookup"><span data-stu-id="dad7d-209">Adding scripts toohello recovery plan</span></span>

<span data-ttu-id="dad7d-210">Hello наиболее часто используемые скрипты Azure Site Recovery можно развернуть в вашей учетной записи автоматизации, кнопку hello «TooAzure развертывание» ниже.</span><span class="sxs-lookup"><span data-stu-id="dad7d-210">You can deploy hello most commonly used Azure Site Recovery scripts into your Automation account clicking hello 'Deploy tooAzure' button below.</span></span> <span data-ttu-id="dad7d-211">При использовании любой опубликованной скрипт, убедитесь, что следуйте указаниям hello в скрипт hello.</span><span class="sxs-lookup"><span data-stu-id="dad7d-211">When you are using any published script, ensure you follow hello guidance in hello script.</span></span>

<span data-ttu-id="dad7d-212">[![Развертывание tooAzure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span><span class="sxs-lookup"><span data-stu-id="dad7d-212">[![Deploy tooAzure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span></span>

1. <span data-ttu-id="dad7d-213">Добавление скрипта перед действием too'Group 1' toofailover группы доступности SQL.</span><span class="sxs-lookup"><span data-stu-id="dad7d-213">Add a pre-action script too'Group 1' toofailover SQL Availability group.</span></span> <span data-ttu-id="dad7d-214">Используйте сценарий «FailoverAG ASR SQL» hello, опубликованных в скриптах образец hello.</span><span class="sxs-lookup"><span data-stu-id="dad7d-214">Use hello 'ASR-SQL-FailoverAG' script published in hello sample scripts.</span></span> <span data-ttu-id="dad7d-215">Убедитесь, следуйте указаниям hello в скрипте hello и внести изменения требуется hello в скрипте hello соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="dad7d-215">Ensure you follow hello guidance in hello script and make hello required changes in hello script appropriately.</span></span>

    ![Add-AG-Script-Step-1](./media/site-recovery-sharepoint/add-ag-script-step1.png)

    ![Add-AG-Script-Step-2](./media/site-recovery-sharepoint/add-ag-script-step2.png)

2. <span data-ttu-id="dad7d-218">Добавьте скрипт tooattach действие post, подсистемы балансировки нагрузки на hello отработку отказа виртуальных машин из веб-уровень (группа 2).</span><span class="sxs-lookup"><span data-stu-id="dad7d-218">Add a post action script tooattach a load balancer on hello failed over virtual machines of Web tier (Group 2).</span></span> <span data-ttu-id="dad7d-219">Используйте сценарий «ASR AddSingleLoadBalancer» hello, опубликованных в скриптах образец hello.</span><span class="sxs-lookup"><span data-stu-id="dad7d-219">Use hello 'ASR-AddSingleLoadBalancer' script published in hello sample scripts.</span></span> <span data-ttu-id="dad7d-220">Убедитесь, следуйте указаниям hello в скрипте hello и внести изменения требуется hello в скрипте hello соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="dad7d-220">Ensure you follow hello guidance in hello script and make hello required changes in hello script appropriately.</span></span>

    ![Add-LB-Script-Step-1](./media/site-recovery-sharepoint/add-lb-script-step1.png)

    ![Add-LB-Script-Step-2](./media/site-recovery-sharepoint/add-lb-script-step2.png)

3. <span data-ttu-id="dad7d-223">Добавьте ручной шаг tooupdate hello DNS записей toopoint toohello новой фермы в Azure.</span><span class="sxs-lookup"><span data-stu-id="dad7d-223">Add a manual step tooupdate hello DNS records toopoint toohello new farm in Azure.</span></span>

    * <span data-ttu-id="dad7d-224">Для сайтов, работающих с Интернетом, изменение записей DNS после отработки отказа не требуется.</span><span class="sxs-lookup"><span data-stu-id="dad7d-224">For internet facing sites, no DNS updates are required post failover.</span></span> <span data-ttu-id="dad7d-225">Следуйте инструкциям hello в tooconfigure раздела «Руководство по сетям» hello диспетчера трафика.</span><span class="sxs-lookup"><span data-stu-id="dad7d-225">Follow hello steps described in hello 'Networking guidance' section tooconfigure Traffic Manager.</span></span> <span data-ttu-id="dad7d-226">Если hello профиля диспетчера трафика настроен как описано в предыдущем разделе hello, добавьте фиктивный порт tooopen (800 в примере hello) скрипт на виртуальной Машине Azure hello.</span><span class="sxs-lookup"><span data-stu-id="dad7d-226">If hello Traffic Manager profile has been set up as described in hello previous section, add a script tooopen dummy port (800 in hello example) on hello Azure VM.</span></span>

    * <span data-ttu-id="dad7d-227">Для внутренних узлов добавьте IP подсистемы балансировки нагрузки ручной шаг tooupdate hello DNS записей toopoint toohello новый Web уровня Виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="dad7d-227">For internal facing sites, add a manual step tooupdate hello DNS record toopoint toohello new Web tier VM’s load balancer IP.</span></span>

4. <span data-ttu-id="dad7d-228">Добавить приложение поиска toorestore ручной шаг из резервной копии или запустить новую службу поиска.</span><span class="sxs-lookup"><span data-stu-id="dad7d-228">Add a manual step toorestore search application from a backup or start a new search service.</span></span>

5. <span data-ttu-id="dad7d-229">Для восстановления приложения-службы поиска из резервной копии выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="dad7d-229">For restoring Search service application from a backup, follow below steps.</span></span>

    * <span data-ttu-id="dad7d-230">Этот метод предполагает, что резервная копия hello приложения службы поиска была выполнена до критического события hello и hello резервной копии находится на сайте hello аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="dad7d-230">This method assumes that a backup of hello Search Service Application was performed before hello catastrophic event and that hello backup is available at hello DR site.</span></span>
    * <span data-ttu-id="dad7d-231">Это легко сделать, запланировав резервное копирование hello (например, один раз в день) и с помощью резервной копии процедуры tooplace hello на сайте hello аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="dad7d-231">This can easily be achieved by scheduling hello backup (for example, once daily) and using a copy procedure tooplace hello backup at hello DR site.</span></span> <span data-ttu-id="dad7d-232">Процедуры копирования могут включать программы на основе сценариев, такие как AzCopy (копирование Azure) или настройку DFSR (репликации распределенных файловых служб).</span><span class="sxs-lookup"><span data-stu-id="dad7d-232">Copy procedures could include scripted programs such as AzCopy (Azure Copy) or setting up DFSR (Distributed File Services Replication).</span></span>
    * <span data-ttu-id="dad7d-233">Теперь этот hello запущен фермы SharePoint перейдите hello центра администрирования «Резервное копирование и восстановление» и выберите восстановление.</span><span class="sxs-lookup"><span data-stu-id="dad7d-233">Now that hello SharePoint farm is running, navigate hello Central Administration, 'Backup and Restore' and select Restore.</span></span> <span data-ttu-id="dad7d-234">Hello восстановления их в заданном указано расположение резервной копии hello (возможно, потребуется tooupdate hello значение).</span><span class="sxs-lookup"><span data-stu-id="dad7d-234">hello restore interrogates hello backup location specified (you may need tooupdate hello value).</span></span> <span data-ttu-id="dad7d-235">Выберите hello резервное копирование приложения службы поиска хотелось бы toorestore.</span><span class="sxs-lookup"><span data-stu-id="dad7d-235">Select hello Search Service Application backup you would like toorestore.</span></span>
    * <span data-ttu-id="dad7d-236">Служба поиска будет восстановлена.</span><span class="sxs-lookup"><span data-stu-id="dad7d-236">Search is restored.</span></span> <span data-ttu-id="dad7d-237">Имейте в виду, что hello восстановления ожидает toofind hello же самые топологии (же число серверов) и жесткие диски, серверы toothose буквы.</span><span class="sxs-lookup"><span data-stu-id="dad7d-237">Keep in mind that hello restore expects toofind hello same topology (same number of servers) and same hard drive letters assigned toothose servers.</span></span> <span data-ttu-id="dad7d-238">Дополнительные сведения см. в документе [Восстановление приложений-служб поиска в SharePoint 2013](https://technet.microsoft.com/library/ee748654.aspx).</span><span class="sxs-lookup"><span data-stu-id="dad7d-238">For more information, see ['Restore Search service application in SharePoint 2013'](https://technet.microsoft.com/library/ee748654.aspx) document.</span></span>


6. <span data-ttu-id="dad7d-239">Чтобы начать работу с новым приложением-службой поиска, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="dad7d-239">For starting with a new Search service application, follow below steps.</span></span>

    * <span data-ttu-id="dad7d-240">Этот метод предполагает, что резервная копия базы данных «Администрирование поиска» hello доступна на сайте hello аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="dad7d-240">This method assumes that a backup of hello “Search Administration” database is available at hello DR site.</span></span>
    * <span data-ttu-id="dad7d-241">Поскольку hello других баз данных приложения службы поиска не реплицируются, они должны toobe повторно создан.</span><span class="sxs-lookup"><span data-stu-id="dad7d-241">Since hello other Search Service Application databases are not replicated, they need toobe re-created.</span></span> <span data-ttu-id="dad7d-242">Таким образом, toodo перейдите tooCentral администрирования и удалите hello приложения службы поиска.</span><span class="sxs-lookup"><span data-stu-id="dad7d-242">toodo so, navigate tooCentral Administration and delete hello Search Service Application.</span></span> <span data-ttu-id="dad7d-243">На всех серверах, какой узел hello индекс поиска удаления файлов индекса hello.</span><span class="sxs-lookup"><span data-stu-id="dad7d-243">On any servers which host hello Search Index, delete hello index files.</span></span>
    * <span data-ttu-id="dad7d-244">Повторно создайте приложение службы поиска hello и этот повторно создает hello баз данных.</span><span class="sxs-lookup"><span data-stu-id="dad7d-244">Re-create hello Search Service Application and this re-creates hello databases.</span></span> <span data-ttu-id="dad7d-245">Рекомендуется toohave подготовленного скрипт, который повторно создает это приложение службы так как она не возможные tooperform все действия через hello графического пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="dad7d-245">It is recommended toohave a prepared script that re-creates this service application since it is not possible tooperform all actions via hello GUI.</span></span> <span data-ttu-id="dad7d-246">Например диск hello индексу установки и настройки топологии поиска hello, возможны только с помощью командлетов PowerShell для SharePoint.</span><span class="sxs-lookup"><span data-stu-id="dad7d-246">For example, setting hello index drive location and configuring hello search topology are only possible by using SharePoint PowerShell cmdlets.</span></span> <span data-ttu-id="dad7d-247">С помощью командлета Windows PowerShell hello Restore SPEnterpriseSearchServiceApplication и укажите hello доставки журналов и Реплицированная база данных администрирования поиска, Search_Service__DB.</span><span class="sxs-lookup"><span data-stu-id="dad7d-247">Use hello Windows PowerShell cmdlet Restore-SPEnterpriseSearchServiceApplication and specify hello log-shipped and replicated Search Administration database, Search_Service__DB.</span></span> <span data-ttu-id="dad7d-248">Этот командлет предоставляет конфигурацию поиска hello, схемы, управляемые свойства, правил и источники и создает набор по умолчанию hello других компонентов.</span><span class="sxs-lookup"><span data-stu-id="dad7d-248">This cmdlet gives hello search configuration, schema, managed properties, rules, and sources and creates a default set of hello other components.</span></span>
    * <span data-ttu-id="dad7d-249">После hello, приложение службы поиска должен быть создан повторно, необходимо запустить полное сканирование для каждой hello toorestore источника содержимого службы поиска.</span><span class="sxs-lookup"><span data-stu-id="dad7d-249">Once hello Search Service Application has be re-created, you must start a full crawl for each content source toorestore hello Search Service.</span></span> <span data-ttu-id="dad7d-250">Будут потеряны некоторые данные аналитики из фермы hello в локальной среде, например рекомендации поиска.</span><span class="sxs-lookup"><span data-stu-id="dad7d-250">You lose some analytics information from hello on-premises farm, such as search recommendations.</span></span>

7. <span data-ttu-id="dad7d-251">После выполнения всех шагов hello, сохранить план восстановления hello и план hello конечный объект восстановления будет выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="dad7d-251">Once all hello steps are completed, save hello recovery plan and hello final recovery plan will look like following.</span></span>

    ![Сохраненный план восстановления](./media/site-recovery-sharepoint/saved-rp.png)

## <a name="doing-a-test-failover"></a><span data-ttu-id="dad7d-253">Тестовая отработка отказа</span><span class="sxs-lookup"><span data-stu-id="dad7d-253">Doing a test failover</span></span>
<span data-ttu-id="dad7d-254">Выполните [в этом руководстве](site-recovery-test-failover-to-azure.md) toodo тестовой отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-254">Follow [this guidance](site-recovery-test-failover-to-azure.md) toodo a test failover.</span></span>

1.  <span data-ttu-id="dad7d-255">Портал tooAzure перейти и выбрать хранилище службы восстановления.</span><span class="sxs-lookup"><span data-stu-id="dad7d-255">Go tooAzure portal and select your Recovery Service vault.</span></span>
2.  <span data-ttu-id="dad7d-256">Щелкните hello плана восстановления, созданной для приложения SharePoint.</span><span class="sxs-lookup"><span data-stu-id="dad7d-256">Click on hello recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="dad7d-257">Щелкните "Тестовая отработка отказа".</span><span class="sxs-lookup"><span data-stu-id="dad7d-257">Click on 'Test Failover'.</span></span>
4.  <span data-ttu-id="dad7d-258">Выберите точку восстановления и процесс перехода на другой ресурс тестирования hello toostart виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="dad7d-258">Select recovery point and Azure virtual network toostart hello test failover process.</span></span>
5.  <span data-ttu-id="dad7d-259">После hello получателей среде можно выполнять вашей проверки.</span><span class="sxs-lookup"><span data-stu-id="dad7d-259">Once hello secondary environment is up, you can perform your validations.</span></span>
6.  <span data-ttu-id="dad7d-260">После завершения проверки hello, можно щелкнуть «Очистку тестовой отработки отказа» в плане восстановления hello и удаляются hello тестовой среды отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-260">Once hello validations are complete, you can click 'Cleanup test failover' on hello recovery plan and hello test failover environment is cleaned.</span></span>

<span data-ttu-id="dad7d-261">Рекомендации по выполнению теста отработки отказа для AD и DNS, слишком[тестирование отработки отказа рекомендации для AD и DNS](site-recovery-active-directory.md#test-failover-considerations) документа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-261">For guidance on doing test failover for AD and DNS, refer too[Test failover considerations for AD and DNS](site-recovery-active-directory.md#test-failover-considerations) document.</span></span>

<span data-ttu-id="dad7d-262">Рекомендации по выполнению выполнить тестовую отработку отказа SQL всегда в группах доступности см. в разделе слишком[выполнив тестовую отработку отказа для SQL Server AlwaysOn](site-recovery-sql.md#steps-to-do-a-test-failover) документа.</span><span class="sxs-lookup"><span data-stu-id="dad7d-262">For guidance on doing test failover for SQL Always ON availability groups, refer too[Doing Test failover for SQL Server Always On](site-recovery-sql.md#steps-to-do-a-test-failover) document.</span></span>

## <a name="doing-a-failover"></a><span data-ttu-id="dad7d-263">Отработка отказа</span><span class="sxs-lookup"><span data-stu-id="dad7d-263">Doing a failover</span></span>
<span data-ttu-id="dad7d-264">При выполнении отработки отказа используйте [это руководство](site-recovery-failover.md).</span><span class="sxs-lookup"><span data-stu-id="dad7d-264">Follow [this guidance](site-recovery-failover.md) for doing a failover.</span></span>

1.  <span data-ttu-id="dad7d-265">Портал tooAzure перейти и выбрать хранилище служб восстановления.</span><span class="sxs-lookup"><span data-stu-id="dad7d-265">Go tooAzure portal and select your Recovery Services vault.</span></span>
2.  <span data-ttu-id="dad7d-266">Щелкните hello плана восстановления, созданной для приложения SharePoint.</span><span class="sxs-lookup"><span data-stu-id="dad7d-266">Click on hello recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="dad7d-267">Щелкните "Отработка отказа".</span><span class="sxs-lookup"><span data-stu-id="dad7d-267">Click on 'Failover'.</span></span>
4.  <span data-ttu-id="dad7d-268">Выберите процесс отработки отказа hello toostart точки восстановления.</span><span class="sxs-lookup"><span data-stu-id="dad7d-268">Select recovery point toostart hello failover process.</span></span>

## <a name="next-steps"></a><span data-ttu-id="dad7d-269">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="dad7d-269">Next steps</span></span>
<span data-ttu-id="dad7d-270">Вы можете больше узнать о [репликации других приложений](site-recovery-workload.md) с помощью Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="dad7d-270">You can learn more about [replicating other applications](site-recovery-workload.md) using Site Recovery.</span></span>
