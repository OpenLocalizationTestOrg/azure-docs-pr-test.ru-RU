---
title: "aaaReplicate многоуровневого приложения SharePoint с помощью Azure Site Recovery | Документы Microsoft"
description: "В этой статье описывается как tooreplicate многоуровневого приложения SharePoint с помощью возможностей Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: sujayt
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: sutalasi
ms.openlocfilehash: d856034ac2a3c95b0c1f0cf85e62c4e7a5a3210f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="replicate-a-multi-tier-sharepoint-application-for-disaster-recovery-using-azure-site-recovery"></a>Репликация многоуровневого приложения SharePoint для аварийного восстановления с помощью Azure Site Recovery | Документы Майкрософт

В этой статье подробно описываются как приложения SharePoint с помощью tooprotect [Azure Site Recovery](site-recovery-overview.md).


## <a name="overview"></a>Обзор

Microsoft SharePoint — это эффективное приложение, которое может помочь рабочей группе или отделу организовать информацию, обмениваться ею и осуществлять совместную работу. SharePoint может предоставлять порталы интрасети, функции управления файлами и документами, совместной работы, социальных сетей, экстрасетей, веб-сайтов, поиска в корпоративной среде и бизнес-аналитики. Эта система также включает возможности интеграции систем и процессов и автоматизации рабочих процессов. Как правило организации считают, что как уровня 1 приложения конфиденциальных toodowntime и потерю данных.

На данный момент Microsoft SharePoint не предоставляет какие-либо готовые функции аварийного восстановления. Независимо от типа hello и масштаб аварии восстановления используются hello центра резервные данные, которые можно восстановить hello фермы. Центры обработки данных на резервном требуются для сценариев, где локальные резервные системы и резервные копии не может восстановиться hello отказов на hello основного центра обработки данных.

Хороший аварийного восстановления должен позволять моделирования планов восстановления вокруг архитектур hello сложных приложений, например SharePoint. Он также должен иметь hello возможность tooadd настроенные действия toohandle для сопоставлений между различными уровнями и таким образом обеспечивать отработку отказа одним щелчком с нижней RTO hello для события сбоя.

В этой статье подробно описываются как приложения SharePoint с помощью tooprotect [Azure Site Recovery](site-recovery-overview.md). В этой статье рассматриваются рекомендации по репликация tooAzure приложения SharePoint три уровня, как это можно сделать аварийного восстановления и как можно tooAzure приложения hello отработки отказа.

Вы можете ознакомиться с hello под видео о восстановлении tooAzure несколькими уровня приложения.

> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/Disaster-Recovery-of-load-balanced-multi-tier-applications-using-Azure-Site-Recovery/player]


## <a name="prerequisites"></a>Предварительные требования

Прежде чем начать, убедитесь, что вы понимаете следующие hello:

1. [Репликация tooAzure виртуальной машины](site-recovery-vmware-to-azure.md)
2. Как слишком[проектирования сети восстановления](site-recovery-network-design.md)
3. [Выполнив tooAzure теста отработки отказа](site-recovery-test-failover-to-azure.md)
4. [Выполнив tooAzure отработки отказа](site-recovery-failover.md)
5. Как слишком[репликации контроллера домена](site-recovery-active-directory.md)
6. Как слишком[репликации SQL Server](site-recovery-sql.md)

## <a name="sharepoint-architecture"></a>Архитектура SharePoint

SharePoint могут развертываться на одном или нескольких серверах, с помощью многоуровневой топологии и ролей сервера tooimplement проект фермы, который соответствует конкретным целям. Типичная большая ферма серверов SharePoint с высокой загрузкой, которая поддерживает большое число одновременных пользователей и элементов содержимого, использует группирование служб как часть стратегии масштабирования. Этот подход включает выполнение служб на выделенных серверах, группирование их и затем масштабирование hello серверы в группу. Hello следующую топологию иллюстрирует hello службы и группирование для трехуровневая ферма серверов SharePoint server. Подробные инструкции о различных топологиях SharePoint обратитесь tooSharePoint документации и архитектур строки продукта. Дополнительные сведения о развертывании SharePoint 2013 см. в [этом документе](https://technet.microsoft.com/en-us/library/cc303422.aspx).



![Модель развертывания 1](./media/site-recovery-sharepoint/sharepointarch.png)


## <a name="site-recovery-support"></a>Поддержка Site Recovery

Для написания этой статьи использовались виртуальные машины VMware под управлением Windows Server 2012 R2 Enterprise. Кроме того, использовались выпуски SharePoint 2013 Enterprise и SQL Server 2014 Enterprise. Как репликация Site Recovery не зависит от приложения, рекомендации hello приведены здесь ожидаемый toohold на также в следующих случаях.

### <a name="source-and-target"></a>Исходный и целевой объект

**Сценарий** | **tooa вторичного сайта** | **tooAzure**
--- | --- | ---
**Hyper-V** | Да | Да
**VMware** | Да | Да
**Физический сервер** | Да | Да

### <a name="sharepoint-versions"></a>Версии SharePoint
поддерживаются следующие версии SharePoint server Hello.

* SharePoint Server 2013 Standard
* SharePoint Server 2013 Enterprise
* SharePoint Server 2016 Standard
* SharePoint Server 2016 Enterprise

### <a name="things-tookeep-in-mind"></a>Действия tookeep помнить

Если вы используете общего кластера на диске как любого уровня приложения, то не может быть tooreplicate репликации может toouse Site Recovery этих виртуальных машин. Можно использовать собственный репликации, предоставляемые приложения hello, а затем использовать [плана восстановления](site-recovery-create-recovery-plans.md) toofailover на всех уровнях.

## <a name="replicating-virtual-machines"></a>Репликация виртуальных машин

Выполните [в этом руководстве](site-recovery-vmware-to-azure.md) toostart репликации tooAzure hello виртуальной машины.

* После завершения репликации hello убедитесь, что переход виртуальной машины tooeach каждого уровня и выберите же доступности в "реплицированные элемента > Параметры > Свойства > вычисления и сеть". Например если ваш веб-уровень содержит три виртуальные машины, убедитесь, что все виртуальные машины, 3 — приветствия toobe частью того же доступности в Azure.

    ![Set-Availability-Set](./media/site-recovery-sharepoint/select-av-set.png)

* Рекомендации по защите DNS и Active Directory, см. в разделе слишком[защиты Active Directory и DNS](site-recovery-active-directory.md) документа.

* Для получения рекомендаций по защите уровня базы данных на сервере SQL ссылаться слишком[защиты SQL Server](site-recovery-active-directory.md) документа.

## <a name="networking-configuration"></a>Конфигурация сети

### <a name="network-properties"></a>Свойства сети

* Hello приложения и веб-уровень виртуальных машин сетевых параметров на портале Azure, чтобы виртуальные машины hello получить вложенные toohello правильной сети аварийного восстановления после отработки отказа.

    ![Выбор сети](./media/site-recovery-sharepoint/select-network.png)


* При использовании статического IP-адреса, укажите IP-адрес hello требуется hello tootake виртуальной машины в hello **целевой IP-адрес** поля

    ![Настройка статического IP-адреса](./media/site-recovery-sharepoint/set-static-ip.png)

### <a name="dns-and-traffic-routing"></a>DNS и маршрутизация трафика

Для узлов, подключенных к Интернету [создать профиль диспетчера трафика «Приоритет» типа](../traffic-manager/traffic-manager-create-profile.md) в hello подписки Azure. И затем настроить профиль DNS и диспетчера трафика в следующих способом hello.


| **Where** | **Источник** | **Цель**|
| --- | --- | --- |
| Общедоступное имя DNS | Общедоступное имя DNS для сайтов SharePoint <br/><br/> Например: sharepoint.contoso.com | Диспетчер трафика <br/><br/> contososharepoint.trafficmanager.net |
| Локальное имя DNS | sharepointonprem.contoso.com | Общедоступный IP-адрес в локальной ферме hello |


В профиль диспетчера трафика hello [создать конечные точки источника и восстановления hello](../traffic-manager/traffic-manager-configure-priority-routing-method.md). Используйте внешнюю конечную точку hello локальную конечную точку и общедоступный IP-адрес для конечной точки Azure. Убедитесь, что hello приоритет выше tooon локальной конечной точки.

Узел тестовой страницы через определенный порт (например, 800) в hello SharePoint веб-уровень, чтобы tooautomatically диспетчера трафика обнаруживает доступности после отработки отказа. Это обходное решение на случай, если невозможно включить анонимную проверку подлинности для всех сайтов SharePoint.

[Настройка профиля диспетчера трафика hello](../traffic-manager/traffic-manager-configure-priority-routing-method.md) с hello ниже параметры.

* Метод маршрутизации — "Приоритет"
* DNS время toolive (TTL) — 30 секунд
* Параметры монитора конечной точки — если можно включить анонимную проверку подлинности, вы можете указать конечную точку определенного веб-сайта. В противном случае можно использовать тестовую страницу по конкретному порту (например, 800).

## <a name="creating-a-recovery-plan"></a>Создание плана восстановления

План восстановления позволяет последовательность отработки отказа hello различных уровней многоуровневого приложения, таким образом, поддерживая согласованность приложения. При создании плана восстановления многоуровневые веб-приложение, выполните hello шаги, описанные ниже. Дополнительные сведения см. в статье [Создание планов восстановления](site-recovery-runbook-automation.md#customize-the-recovery-plan).

### <a name="adding-virtual-machines-toofailover-groups"></a>Добавление групп toofailover виртуальные машины

1. Создайте план восстановления, добавление hello приложения и веб-уровень виртуальных машин.
2. Щелкните «Настройка» toogroup hello виртуальных машин. По умолчанию все виртуальные машины входят в группу 1.

    ![Настройка плана восстановления](./media/site-recovery-sharepoint/rp-groups.png)

3. Создать новую группу (группа 2) и переместить в новую группу hello hello веб-уровень виртуальных машин. Виртуальные машины уровня приложений должны входить в группу 1, а виртуальные машины веб-уровня — в группу 2. Это tooensure, hello виртуальных машин уровня загрузки после виртуальных машин уровня Web App.


### <a name="adding-scripts-toohello-recovery-plan"></a>Добавление плана восстановления toohello сценариев

Hello наиболее часто используемые скрипты Azure Site Recovery можно развернуть в вашей учетной записи автоматизации, кнопку hello «TooAzure развертывание» ниже. При использовании любой опубликованной скрипт, убедитесь, что следуйте указаниям hello в скрипт hello.

[![Развертывание tooAzure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)

1. Добавление скрипта перед действием too'Group 1' toofailover группы доступности SQL. Используйте сценарий «FailoverAG ASR SQL» hello, опубликованных в скриптах образец hello. Убедитесь, следуйте указаниям hello в скрипте hello и внести изменения требуется hello в скрипте hello соответствующим образом.

    ![Add-AG-Script-Step-1](./media/site-recovery-sharepoint/add-ag-script-step1.png)

    ![Add-AG-Script-Step-2](./media/site-recovery-sharepoint/add-ag-script-step2.png)

2. Добавьте скрипт tooattach действие post, подсистемы балансировки нагрузки на hello отработку отказа виртуальных машин из веб-уровень (группа 2). Используйте сценарий «ASR AddSingleLoadBalancer» hello, опубликованных в скриптах образец hello. Убедитесь, следуйте указаниям hello в скрипте hello и внести изменения требуется hello в скрипте hello соответствующим образом.

    ![Add-LB-Script-Step-1](./media/site-recovery-sharepoint/add-lb-script-step1.png)

    ![Add-LB-Script-Step-2](./media/site-recovery-sharepoint/add-lb-script-step2.png)

3. Добавьте ручной шаг tooupdate hello DNS записей toopoint toohello новой фермы в Azure.

    * Для сайтов, работающих с Интернетом, изменение записей DNS после отработки отказа не требуется. Следуйте инструкциям hello в tooconfigure раздела «Руководство по сетям» hello диспетчера трафика. Если hello профиля диспетчера трафика настроен как описано в предыдущем разделе hello, добавьте фиктивный порт tooopen (800 в примере hello) скрипт на виртуальной Машине Azure hello.

    * Для внутренних узлов добавьте IP подсистемы балансировки нагрузки ручной шаг tooupdate hello DNS записей toopoint toohello новый Web уровня Виртуальной машины.

4. Добавить приложение поиска toorestore ручной шаг из резервной копии или запустить новую службу поиска.

5. Для восстановления приложения-службы поиска из резервной копии выполните следующие действия.

    * Этот метод предполагает, что резервная копия hello приложения службы поиска была выполнена до критического события hello и hello резервной копии находится на сайте hello аварийного восстановления.
    * Это легко сделать, запланировав резервное копирование hello (например, один раз в день) и с помощью резервной копии процедуры tooplace hello на сайте hello аварийного восстановления. Процедуры копирования могут включать программы на основе сценариев, такие как AzCopy (копирование Azure) или настройку DFSR (репликации распределенных файловых служб).
    * Теперь этот hello запущен фермы SharePoint перейдите hello центра администрирования «Резервное копирование и восстановление» и выберите восстановление. Hello восстановления их в заданном указано расположение резервной копии hello (возможно, потребуется tooupdate hello значение). Выберите hello резервное копирование приложения службы поиска хотелось бы toorestore.
    * Служба поиска будет восстановлена. Имейте в виду, что hello восстановления ожидает toofind hello же самые топологии (же число серверов) и жесткие диски, серверы toothose буквы. Дополнительные сведения см. в документе [Восстановление приложений-служб поиска в SharePoint 2013](https://technet.microsoft.com/library/ee748654.aspx).


6. Чтобы начать работу с новым приложением-службой поиска, выполните следующие действия.

    * Этот метод предполагает, что резервная копия базы данных «Администрирование поиска» hello доступна на сайте hello аварийного восстановления.
    * Поскольку hello других баз данных приложения службы поиска не реплицируются, они должны toobe повторно создан. Таким образом, toodo перейдите tooCentral администрирования и удалите hello приложения службы поиска. На всех серверах, какой узел hello индекс поиска удаления файлов индекса hello.
    * Повторно создайте приложение службы поиска hello и этот повторно создает hello баз данных. Рекомендуется toohave подготовленного скрипт, который повторно создает это приложение службы так как она не возможные tooperform все действия через hello графического пользовательского интерфейса. Например диск hello индексу установки и настройки топологии поиска hello, возможны только с помощью командлетов PowerShell для SharePoint. С помощью командлета Windows PowerShell hello Restore SPEnterpriseSearchServiceApplication и укажите hello доставки журналов и Реплицированная база данных администрирования поиска, Search_Service__DB. Этот командлет предоставляет конфигурацию поиска hello, схемы, управляемые свойства, правил и источники и создает набор по умолчанию hello других компонентов.
    * После hello, приложение службы поиска должен быть создан повторно, необходимо запустить полное сканирование для каждой hello toorestore источника содержимого службы поиска. Будут потеряны некоторые данные аналитики из фермы hello в локальной среде, например рекомендации поиска.

7. После выполнения всех шагов hello, сохранить план восстановления hello и план hello конечный объект восстановления будет выглядеть следующим образом.

    ![Сохраненный план восстановления](./media/site-recovery-sharepoint/saved-rp.png)

## <a name="doing-a-test-failover"></a>Тестовая отработка отказа
Выполните [в этом руководстве](site-recovery-test-failover-to-azure.md) toodo тестовой отработки отказа.

1.  Портал tooAzure перейти и выбрать хранилище службы восстановления.
2.  Щелкните hello плана восстановления, созданной для приложения SharePoint.
3.  Щелкните "Тестовая отработка отказа".
4.  Выберите точку восстановления и процесс перехода на другой ресурс тестирования hello toostart виртуальной сети Azure.
5.  После hello получателей среде можно выполнять вашей проверки.
6.  После завершения проверки hello, можно щелкнуть «Очистку тестовой отработки отказа» в плане восстановления hello и удаляются hello тестовой среды отработки отказа.

Рекомендации по выполнению теста отработки отказа для AD и DNS, слишком[тестирование отработки отказа рекомендации для AD и DNS](site-recovery-active-directory.md#test-failover-considerations) документа.

Рекомендации по выполнению выполнить тестовую отработку отказа SQL всегда в группах доступности см. в разделе слишком[выполнив тестовую отработку отказа для SQL Server AlwaysOn](site-recovery-sql.md#steps-to-do-a-test-failover) документа.

## <a name="doing-a-failover"></a>Отработка отказа
При выполнении отработки отказа используйте [это руководство](site-recovery-failover.md).

1.  Портал tooAzure перейти и выбрать хранилище служб восстановления.
2.  Щелкните hello плана восстановления, созданной для приложения SharePoint.
3.  Щелкните "Отработка отказа".
4.  Выберите процесс отработки отказа hello toostart точки восстановления.

## <a name="next-steps"></a>Дальнейшие действия
Вы можете больше узнать о [репликации других приложений](site-recovery-workload.md) с помощью Site Recovery.
