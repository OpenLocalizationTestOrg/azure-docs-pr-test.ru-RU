---
title: "Репликация многоуровневого приложения SharePoint с помощью Azure Site Recovery | Документы Майкрософт"
description: "В этой статье рассматривается репликация многоуровневого приложения SharePoint с помощью возможностей Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: sujayt
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: sutalasi
ms.openlocfilehash: 9c0570b9da661a8ffb0041e5c24905480f55f6e2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="replicate-a-multi-tier-sharepoint-application-for-disaster-recovery-using-azure-site-recovery"></a><span data-ttu-id="15e0b-103">Репликация многоуровневого приложения SharePoint для аварийного восстановления с помощью Azure Site Recovery | Документы Майкрософт</span><span class="sxs-lookup"><span data-stu-id="15e0b-103">Replicate a multi-tier SharePoint application for disaster recovery using Azure Site Recovery</span></span>

<span data-ttu-id="15e0b-104">В этой статье подробно описывается защита приложения SharePoint с помощью [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="15e0b-104">This article describes in detail how to protect a SharePoint application using  [Azure Site Recovery](site-recovery-overview.md).</span></span>


## <a name="overview"></a><span data-ttu-id="15e0b-105">Обзор</span><span class="sxs-lookup"><span data-stu-id="15e0b-105">Overview</span></span>

<span data-ttu-id="15e0b-106">Microsoft SharePoint — это эффективное приложение, которое может помочь рабочей группе или отделу организовать информацию, обмениваться ею и осуществлять совместную работу.</span><span class="sxs-lookup"><span data-stu-id="15e0b-106">Microsoft SharePoint is a powerful application that can help a group or department organize, collaborate, and share information.</span></span> <span data-ttu-id="15e0b-107">SharePoint может предоставлять порталы интрасети, функции управления файлами и документами, совместной работы, социальных сетей, экстрасетей, веб-сайтов, поиска в корпоративной среде и бизнес-аналитики.</span><span class="sxs-lookup"><span data-stu-id="15e0b-107">SharePoint can provide intranet portals, document and file management, collaboration, social networks, extranets, websites, enterprise search, and business intelligence.</span></span> <span data-ttu-id="15e0b-108">Эта система также включает возможности интеграции систем и процессов и автоматизации рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="15e0b-108">It also has system integration, process integration, and workflow automation capabilities.</span></span> <span data-ttu-id="15e0b-109">Как правило, организации рассматривают его как приложение первого уровня, чувствительное к простоям и потере данных.</span><span class="sxs-lookup"><span data-stu-id="15e0b-109">Typically, organizations consider it as a Tier-1 application sensitive to downtime and data loss.</span></span>

<span data-ttu-id="15e0b-110">На данный момент Microsoft SharePoint не предоставляет какие-либо готовые функции аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="15e0b-110">Today, Microsoft SharePoint  does not provide any out-of-the-box disaster recovery capabilities.</span></span> <span data-ttu-id="15e0b-111">Независимо от типа и масштаба аварии, восстановление включает использование резервного центра обработки данных, в котором можно восстановить ферму.</span><span class="sxs-lookup"><span data-stu-id="15e0b-111">Regardless of the type and scale of a disaster, recovery involves the use of a standby data center that you can recover the farm to.</span></span> <span data-ttu-id="15e0b-112">Резервные центры обработки данных требуются для сценариев, когда локальные избыточные системы и резервные копии не позволяют выполнить восстановление после сбоя в основном центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="15e0b-112">Standby data centers are required for scenarios where local redundant systems and backups cannot recover from the outage at the primary data center.</span></span>

<span data-ttu-id="15e0b-113">Хорошее решение аварийного восстановления должно допускать моделирование планов восстановления для сложных архитектур приложений, таких как SharePoint.</span><span class="sxs-lookup"><span data-stu-id="15e0b-113">A good disaster recovery solution should allow modeling of recovery plans around the  complex application architectures such as SharePoint.</span></span> <span data-ttu-id="15e0b-114">Оно также должно включать возможность добавления настраиваемых действий для обработки сопоставлений приложений между различными уровнями и, таким образом, обеспечивать быструю отработку отказа с низким RTO в случае аварии.</span><span class="sxs-lookup"><span data-stu-id="15e0b-114">It should also have the ability to add customized steps to handle application mappings between various tiers and hence providing a single-click failover with a lower RTO in the event of a disaster.</span></span>

<span data-ttu-id="15e0b-115">В этой статье подробно описывается защита приложения SharePoint с помощью [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="15e0b-115">This article describes in detail how to protect a SharePoint application using [Azure Site Recovery](site-recovery-overview.md).</span></span> <span data-ttu-id="15e0b-116">Здесь мы рассмотрим рекомендации по репликации трехуровневого приложения SharePoint в Azure, выполнение отработки аварийного восстановления и отработки отказа приложения в Azure.</span><span class="sxs-lookup"><span data-stu-id="15e0b-116">This article will cover best practices for replicating a three tier SharePoint application to Azure, how you can do a disaster recovery drill, and how you can failover the application to Azure.</span></span>

<span data-ttu-id="15e0b-117">В видеоролике ниже рассказывается о восстановлении многоуровневого приложения в Azure.</span><span class="sxs-lookup"><span data-stu-id="15e0b-117">You can watch the below video about recovering a multi tier application to Azure.</span></span>

> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/Disaster-Recovery-of-load-balanced-multi-tier-applications-using-Azure-Site-Recovery/player]


## <a name="prerequisites"></a><span data-ttu-id="15e0b-118">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="15e0b-118">Prerequisites</span></span>

<span data-ttu-id="15e0b-119">Прежде чем продолжить, ознакомьтесь со следующими статьями:</span><span class="sxs-lookup"><span data-stu-id="15e0b-119">Before you start, make sure you understand the following:</span></span>

1. [<span data-ttu-id="15e0b-120">Репликация виртуальных машин VMware в Azure с помощью Site Recovery</span><span class="sxs-lookup"><span data-stu-id="15e0b-120">Replicating a virtual machine to Azure</span></span>](site-recovery-vmware-to-azure.md)
2. <span data-ttu-id="15e0b-121">[Проектирование сети для аварийного восстановления](site-recovery-network-design.md)</span><span class="sxs-lookup"><span data-stu-id="15e0b-121">How to [design a recovery network](site-recovery-network-design.md)</span></span>
3. [<span data-ttu-id="15e0b-122">Тестовая отработка отказа в Azure в Site Recovery</span><span class="sxs-lookup"><span data-stu-id="15e0b-122">Doing a test failover to Azure</span></span>](site-recovery-test-failover-to-azure.md)
4. [<span data-ttu-id="15e0b-123">Отработка отказа в Site Recovery</span><span class="sxs-lookup"><span data-stu-id="15e0b-123">Doing a failover to Azure</span></span>](site-recovery-failover.md)
5. <span data-ttu-id="15e0b-124">[Защита Active Directory и DNS с Azure Site Recovery](site-recovery-active-directory.md)</span><span class="sxs-lookup"><span data-stu-id="15e0b-124">How to [replicate a domain controller](site-recovery-active-directory.md)</span></span>
6. <span data-ttu-id="15e0b-125">[Защита SQL Server с помощью аварийного восстановления SQL Server и Azure Site Recovery](site-recovery-sql.md)</span><span class="sxs-lookup"><span data-stu-id="15e0b-125">How to [replicate SQL Server](site-recovery-sql.md)</span></span>

## <a name="sharepoint-architecture"></a><span data-ttu-id="15e0b-126">Архитектура SharePoint</span><span class="sxs-lookup"><span data-stu-id="15e0b-126">SharePoint architecture</span></span>

<span data-ttu-id="15e0b-127">SharePoint можно развертывать на одном или нескольких серверах с помощью многоуровневых топологий и ролей сервера для реализации архитектуры фермы, отвечающей конкретным требованиям и целям.</span><span class="sxs-lookup"><span data-stu-id="15e0b-127">SharePoint can be deployed on one or more servers using tiered topologies and server roles to implement a farm design that meets specific goals and objectives.</span></span> <span data-ttu-id="15e0b-128">Типичная большая ферма серверов SharePoint с высокой загрузкой, которая поддерживает большое число одновременных пользователей и элементов содержимого, использует группирование служб как часть стратегии масштабирования.</span><span class="sxs-lookup"><span data-stu-id="15e0b-128">A typical large, high-demand SharePoint server farm that supports a high number of concurrent users and a large number of content items use service grouping as part of their scalability strategy.</span></span> <span data-ttu-id="15e0b-129">Этот подход включает выполнение служб на выделенных серверах, их группирование, а затем масштабирование серверов как группы.</span><span class="sxs-lookup"><span data-stu-id="15e0b-129">This approach involves running services on dedicated servers, grouping these services together, and then scaling out the servers as a group.</span></span> <span data-ttu-id="15e0b-130">Следующие топологии иллюстрирует группирование служб и серверов для трехуровневой фермы серверов SharePoint.</span><span class="sxs-lookup"><span data-stu-id="15e0b-130">The following topology illustrates the service and server grouping for a three tier SharePoint server farm.</span></span> <span data-ttu-id="15e0b-131">Подробное руководство по различным топологиям SharePoint можно найти в документации по SharePoint и описаниях архитектур семейств продуктов.</span><span class="sxs-lookup"><span data-stu-id="15e0b-131">Please refer to SharePoint documentation and product line architectures for detailed guidance on different SharePoint topologies.</span></span> <span data-ttu-id="15e0b-132">Дополнительные сведения о развертывании SharePoint 2013 см. в [этом документе](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span><span class="sxs-lookup"><span data-stu-id="15e0b-132">You can find more details about SharePoint 2013 deployment in [this document](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span></span>



![Модель развертывания 1](./media/site-recovery-sharepoint/sharepointarch.png)


## <a name="site-recovery-support"></a><span data-ttu-id="15e0b-134">Поддержка Site Recovery</span><span class="sxs-lookup"><span data-stu-id="15e0b-134">Site Recovery support</span></span>

<span data-ttu-id="15e0b-135">Для написания этой статьи использовались виртуальные машины VMware под управлением Windows Server 2012 R2 Enterprise.</span><span class="sxs-lookup"><span data-stu-id="15e0b-135">For creating this article, VMware virtual machines with Windows Server 2012 R2 Enterprise were used.</span></span> <span data-ttu-id="15e0b-136">Кроме того, использовались выпуски SharePoint 2013 Enterprise и SQL Server 2014 Enterprise.</span><span class="sxs-lookup"><span data-stu-id="15e0b-136">SharePoint 2013 Enterprise edition and SQL server 2014 Enterprise edition were used.</span></span> <span data-ttu-id="15e0b-137">Так как репликация Site Recovery не зависит от приложения, описанные здесь рекомендации также подходят для сценариев, представленных ниже.</span><span class="sxs-lookup"><span data-stu-id="15e0b-137">As Site Recovery replication is application agnostic, the recommendations provided here are expected to hold on for following scenarios as well.</span></span>

### <a name="source-and-target"></a><span data-ttu-id="15e0b-138">Исходный и целевой объект</span><span class="sxs-lookup"><span data-stu-id="15e0b-138">Source and target</span></span>

<span data-ttu-id="15e0b-139">**Сценарий**</span><span class="sxs-lookup"><span data-stu-id="15e0b-139">**Scenario**</span></span> | <span data-ttu-id="15e0b-140">**На дополнительный сайт**</span><span class="sxs-lookup"><span data-stu-id="15e0b-140">**To a secondary site**</span></span> | <span data-ttu-id="15e0b-141">**В Azure**</span><span class="sxs-lookup"><span data-stu-id="15e0b-141">**To Azure**</span></span>
--- | --- | ---
<span data-ttu-id="15e0b-142">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="15e0b-142">**Hyper-V**</span></span> | <span data-ttu-id="15e0b-143">Да</span><span class="sxs-lookup"><span data-stu-id="15e0b-143">Yes</span></span> | <span data-ttu-id="15e0b-144">Да</span><span class="sxs-lookup"><span data-stu-id="15e0b-144">Yes</span></span>
<span data-ttu-id="15e0b-145">**VMware**</span><span class="sxs-lookup"><span data-stu-id="15e0b-145">**VMware**</span></span> | <span data-ttu-id="15e0b-146">Да</span><span class="sxs-lookup"><span data-stu-id="15e0b-146">Yes</span></span> | <span data-ttu-id="15e0b-147">Да</span><span class="sxs-lookup"><span data-stu-id="15e0b-147">Yes</span></span>
<span data-ttu-id="15e0b-148">**Физический сервер**</span><span class="sxs-lookup"><span data-stu-id="15e0b-148">**Physical server**</span></span> | <span data-ttu-id="15e0b-149">Да</span><span class="sxs-lookup"><span data-stu-id="15e0b-149">Yes</span></span> | <span data-ttu-id="15e0b-150">Да</span><span class="sxs-lookup"><span data-stu-id="15e0b-150">Yes</span></span>

### <a name="sharepoint-versions"></a><span data-ttu-id="15e0b-151">Версии SharePoint</span><span class="sxs-lookup"><span data-stu-id="15e0b-151">SharePoint Versions</span></span>
<span data-ttu-id="15e0b-152">Поддерживаются следующие версии SharePoint Server.</span><span class="sxs-lookup"><span data-stu-id="15e0b-152">The following SharePoint server versions are supported.</span></span>

* <span data-ttu-id="15e0b-153">SharePoint Server 2013 Standard</span><span class="sxs-lookup"><span data-stu-id="15e0b-153">SharePoint server 2013 Standard</span></span>
* <span data-ttu-id="15e0b-154">SharePoint Server 2013 Enterprise</span><span class="sxs-lookup"><span data-stu-id="15e0b-154">SharePoint server 2013 Enterprise</span></span>
* <span data-ttu-id="15e0b-155">SharePoint Server 2016 Standard</span><span class="sxs-lookup"><span data-stu-id="15e0b-155">SharePoint server 2016 Standard</span></span>
* <span data-ttu-id="15e0b-156">SharePoint Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="15e0b-156">SharePoint server 2016 Enterprise</span></span>

### <a name="things-to-keep-in-mind"></a><span data-ttu-id="15e0b-157">Важные аспекты</span><span class="sxs-lookup"><span data-stu-id="15e0b-157">Things to keep in mind</span></span>

<span data-ttu-id="15e0b-158">При использовании общего кластера на основе диска в качестве любого из уровней приложения вы не сможете использовать репликацию Site Recovery для репликации таких виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="15e0b-158">If you are using a shared disk-based cluster as any tier in your application then you will not be able to use Site Recovery replication to replicate those virtual machines.</span></span> <span data-ttu-id="15e0b-159">Можно использовать собственный механизм репликации, предоставляемый приложением, а затем применить [план восстановления](site-recovery-create-recovery-plans.md) для отработки отказа всех уровней.</span><span class="sxs-lookup"><span data-stu-id="15e0b-159">You can use native replication provided by the application and then use a [recovery plan](site-recovery-create-recovery-plans.md) to failover all tiers.</span></span>

## <a name="replicating-virtual-machines"></a><span data-ttu-id="15e0b-160">Репликация виртуальных машин</span><span class="sxs-lookup"><span data-stu-id="15e0b-160">Replicating virtual machines</span></span>

<span data-ttu-id="15e0b-161">В [этом руководстве](site-recovery-vmware-to-azure.md) приводится процедура первой репликации виртуальных машин в Azure.</span><span class="sxs-lookup"><span data-stu-id="15e0b-161">Follow [this guidance](site-recovery-vmware-to-azure.md) to start replicating the virtual machine to Azure.</span></span>

* <span data-ttu-id="15e0b-162">После завершения репликации необходимо перейти к каждой виртуальной машине каждого уровня и выбрать одну и ту же группу доступности в разделе "Реплицируемый элемент" > "Параметры" > "Свойства" > "Вычисления и сети".</span><span class="sxs-lookup"><span data-stu-id="15e0b-162">Once the replication is complete, make sure you go to each virtual machine of each tier and select same availability set in 'Replicated item > Settings > Properties > Compute and Network'.</span></span> <span data-ttu-id="15e0b-163">Например, если веб-уровень включает три виртуальные машины, убедитесь, что все три виртуальные машины настроены как часть одной группы доступности в Azure.</span><span class="sxs-lookup"><span data-stu-id="15e0b-163">For example, if your web tier has 3 VMs, ensure all the 3 VMs are configured to be part of same availability set in Azure.</span></span>

    ![Set-Availability-Set](./media/site-recovery-sharepoint/select-av-set.png)

* <span data-ttu-id="15e0b-165">Рекомендации по защите Active Directory и DNS см. в [соответствующем документе](site-recovery-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="15e0b-165">For guidance on protecting Active Directory and DNS, refer to [Protect Active Directory and DNS](site-recovery-active-directory.md) document.</span></span>

* <span data-ttu-id="15e0b-166">Рекомендации по защите уровня базы данных на сервере SQL Server см. в документе, посвященном [защите SQL Server](site-recovery-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="15e0b-166">For guidance on protecting database tier running on SQL server, refer to [Protect SQL Server](site-recovery-active-directory.md) document.</span></span>

## <a name="networking-configuration"></a><span data-ttu-id="15e0b-167">Конфигурация сети</span><span class="sxs-lookup"><span data-stu-id="15e0b-167">Networking configuration</span></span>

### <a name="network-properties"></a><span data-ttu-id="15e0b-168">Свойства сети</span><span class="sxs-lookup"><span data-stu-id="15e0b-168">Network properties</span></span>

* <span data-ttu-id="15e0b-169">Для виртуальных машин веб-уровня и уровня приложений настройте параметры сети на портале Azure таким образом, чтобы виртуальные машины подключались к правильной сети аварийного восстановления после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="15e0b-169">For the App and Web tier VMs, configure network settings in Azure portal so that the VMs get attached to the right DR network after failover.</span></span>

    ![Выбор сети](./media/site-recovery-sharepoint/select-network.png)


* <span data-ttu-id="15e0b-171">Если вы используете статический IP-адрес, укажите нужный IP-адрес для виртуальной машины в поле **Целевой IP-адрес**.</span><span class="sxs-lookup"><span data-stu-id="15e0b-171">If you are using a static IP, then specify the IP that you want the virtual machine to take in the **Target IP** field</span></span>

    ![Настройка статического IP-адреса](./media/site-recovery-sharepoint/set-static-ip.png)

### <a name="dns-and-traffic-routing"></a><span data-ttu-id="15e0b-173">DNS и маршрутизация трафика</span><span class="sxs-lookup"><span data-stu-id="15e0b-173">DNS and Traffic Routing</span></span>

<span data-ttu-id="15e0b-174">Для сайтов, работающих с Интернетом, [создайте профиль диспетчера трафика типа "Приоритет"](../traffic-manager/traffic-manager-create-profile.md) в подписке Azure.</span><span class="sxs-lookup"><span data-stu-id="15e0b-174">For internet facing sites, [create a Traffic Manager profile of 'Priority' type](../traffic-manager/traffic-manager-create-profile.md) in the Azure subscription.</span></span> <span data-ttu-id="15e0b-175">Затем настройте профиль DNS и диспетчера трафика следующим образом.</span><span class="sxs-lookup"><span data-stu-id="15e0b-175">And then configure your DNS and Traffic Manager profile in the following manner.</span></span>


| <span data-ttu-id="15e0b-176">**Where**</span><span class="sxs-lookup"><span data-stu-id="15e0b-176">**Where**</span></span> | <span data-ttu-id="15e0b-177">**Источник**</span><span class="sxs-lookup"><span data-stu-id="15e0b-177">**Source**</span></span> | <span data-ttu-id="15e0b-178">**Цель**</span><span class="sxs-lookup"><span data-stu-id="15e0b-178">**Target**</span></span>|
| --- | --- | --- |
| <span data-ttu-id="15e0b-179">Общедоступное имя DNS</span><span class="sxs-lookup"><span data-stu-id="15e0b-179">Public DNS</span></span> | <span data-ttu-id="15e0b-180">Общедоступное имя DNS для сайтов SharePoint</span><span class="sxs-lookup"><span data-stu-id="15e0b-180">Public DNS for SharePoint sites</span></span> <br/><br/> <span data-ttu-id="15e0b-181">Например: sharepoint.contoso.com</span><span class="sxs-lookup"><span data-stu-id="15e0b-181">Ex: sharepoint.contoso.com</span></span> | <span data-ttu-id="15e0b-182">Диспетчер трафика</span><span class="sxs-lookup"><span data-stu-id="15e0b-182">Traffic Manager</span></span> <br/><br/> <span data-ttu-id="15e0b-183">contososharepoint.trafficmanager.net</span><span class="sxs-lookup"><span data-stu-id="15e0b-183">contososharepoint.trafficmanager.net</span></span> |
| <span data-ttu-id="15e0b-184">Локальное имя DNS</span><span class="sxs-lookup"><span data-stu-id="15e0b-184">On-premises DNS</span></span> | <span data-ttu-id="15e0b-185">sharepointonprem.contoso.com</span><span class="sxs-lookup"><span data-stu-id="15e0b-185">sharepointonprem.contoso.com</span></span> | <span data-ttu-id="15e0b-186">Общедоступный IP-адрес в локальной ферме</span><span class="sxs-lookup"><span data-stu-id="15e0b-186">Public IP on the on-premises farm</span></span> |


<span data-ttu-id="15e0b-187">В профиле диспетчера трафика [создайте первичную конечную точку и конечную точку восстановления](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="15e0b-187">In the Traffic Manager profile, [create the primary and recovery endpoints](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span></span> <span data-ttu-id="15e0b-188">Используйте внешнюю конечную точку для локальной конечной точки и общедоступный IP-адрес для конечной точки Azure.</span><span class="sxs-lookup"><span data-stu-id="15e0b-188">Use the external endpoint for on-premises endpoint and public IP for Azure endpoint.</span></span> <span data-ttu-id="15e0b-189">Убедитесь, что для локальной конечной точки задан более высокий приоритет.</span><span class="sxs-lookup"><span data-stu-id="15e0b-189">Ensure that the priority is set higher to on-premises endpoint.</span></span>

<span data-ttu-id="15e0b-190">Разместите тестовую страницу по определенному порту (например, 800) в веб-уровне SharePoint, чтобы диспетчер трафика мог автоматически обнаруживать доступность после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="15e0b-190">Host a test page on a specific port (for example, 800) in the SharePoint web tier in order for Traffic Manager to automatically detect availability post failover.</span></span> <span data-ttu-id="15e0b-191">Это обходное решение на случай, если невозможно включить анонимную проверку подлинности для всех сайтов SharePoint.</span><span class="sxs-lookup"><span data-stu-id="15e0b-191">This is a workaround in case you cannot enable anonymous authentication on any of your SharePoint sites.</span></span>

<span data-ttu-id="15e0b-192">[Настройте профиль диспетчера трафика](../traffic-manager/traffic-manager-configure-priority-routing-method.md), используя приведенные ниже параметры.</span><span class="sxs-lookup"><span data-stu-id="15e0b-192">[Configure the Traffic Manager profile](../traffic-manager/traffic-manager-configure-priority-routing-method.md) with the below settings.</span></span>

* <span data-ttu-id="15e0b-193">Метод маршрутизации — "Приоритет"</span><span class="sxs-lookup"><span data-stu-id="15e0b-193">Routing method - 'Priority'</span></span>
* <span data-ttu-id="15e0b-194">Срок жизни (TTL) DNS — "30 секунд"</span><span class="sxs-lookup"><span data-stu-id="15e0b-194">DNS time to live (TTL) - '30 seconds'</span></span>
* <span data-ttu-id="15e0b-195">Параметры монитора конечной точки — если можно включить анонимную проверку подлинности, вы можете указать конечную точку определенного веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="15e0b-195">Endpoint monitor settings - If you can enable anonymous authentication, you can give a specific website endpoint.</span></span> <span data-ttu-id="15e0b-196">В противном случае можно использовать тестовую страницу по конкретному порту (например, 800).</span><span class="sxs-lookup"><span data-stu-id="15e0b-196">Or, you can use a test page on a specific port (for example, 800).</span></span>

## <a name="creating-a-recovery-plan"></a><span data-ttu-id="15e0b-197">Создание плана восстановления</span><span class="sxs-lookup"><span data-stu-id="15e0b-197">Creating a recovery plan</span></span>

<span data-ttu-id="15e0b-198">План восстановления в многоуровневом приложении позволяет выполнять виртуализацию отработки отказов различных уровней, а значит — поддерживает целостность на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="15e0b-198">A recovery plan allows sequencing the failover of various tiers in a multi-tier application, hence, maintaining application consistency.</span></span> <span data-ttu-id="15e0b-199">При создании плана восстановления для многоуровневого веб-приложения следует выполнить действия, приведенные ниже.</span><span class="sxs-lookup"><span data-stu-id="15e0b-199">Follow the below steps while creating a recovery plan for a multi-tier web application.</span></span> <span data-ttu-id="15e0b-200">Дополнительные сведения см. в статье [Создание планов восстановления](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span><span class="sxs-lookup"><span data-stu-id="15e0b-200">[Learn more about creating a recovery plan](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span></span>

### <a name="adding-virtual-machines-to-failover-groups"></a><span data-ttu-id="15e0b-201">Добавление виртуальных машин в группы отработки отказа</span><span class="sxs-lookup"><span data-stu-id="15e0b-201">Adding virtual machines to failover groups</span></span>

1. <span data-ttu-id="15e0b-202">Создайте план восстановления, добавив виртуальные машины веб-уровня и уровня приложений.</span><span class="sxs-lookup"><span data-stu-id="15e0b-202">Create a recovery plan by adding the App and Web tier VMs.</span></span>
2. <span data-ttu-id="15e0b-203">Щелкните "Настроить", чтобы сгруппировать виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="15e0b-203">Click on 'Customize' to group the VMs.</span></span> <span data-ttu-id="15e0b-204">По умолчанию все виртуальные машины входят в группу 1.</span><span class="sxs-lookup"><span data-stu-id="15e0b-204">By default, all VMs are part of 'Group 1'.</span></span>

    ![Настройка плана восстановления](./media/site-recovery-sharepoint/rp-groups.png)

3. <span data-ttu-id="15e0b-206">Создайте другую группу (группа 2) и переместите виртуальные машины веб-уровня в эту новую группу.</span><span class="sxs-lookup"><span data-stu-id="15e0b-206">Create another Group (Group 2) and move the Web tier VMs into the new group.</span></span> <span data-ttu-id="15e0b-207">Виртуальные машины уровня приложений должны входить в группу 1, а виртуальные машины веб-уровня — в группу 2.</span><span class="sxs-lookup"><span data-stu-id="15e0b-207">Your App tier VMs should be part of 'Group 1' and Web tier VMs should be part of 'Group 2'.</span></span> <span data-ttu-id="15e0b-208">Это позволяет гарантировать, что виртуальные машины уровня приложений будут загружаться до виртуальных машин веб-уровня.</span><span class="sxs-lookup"><span data-stu-id="15e0b-208">This is to ensure that the App tier VMs boot up first followed by Web tier VMs.</span></span>


### <a name="adding-scripts-to-the-recovery-plan"></a><span data-ttu-id="15e0b-209">Добавление скриптов в план восстановления</span><span class="sxs-lookup"><span data-stu-id="15e0b-209">Adding scripts to the recovery plan</span></span>

<span data-ttu-id="15e0b-210">Наиболее часто используемые сценарии Azure Site Recovery можно развернуть в учетной записи автоматизации, нажав кнопку "Развертывание в Azure" ниже.</span><span class="sxs-lookup"><span data-stu-id="15e0b-210">You can deploy the most commonly used Azure Site Recovery scripts into your Automation account clicking the 'Deploy to Azure' button below.</span></span> <span data-ttu-id="15e0b-211">При использовании любого опубликованного сценария необходимо выполнять указанные в нем инструкции.</span><span class="sxs-lookup"><span data-stu-id="15e0b-211">When you are using any published script, ensure you follow the guidance in the script.</span></span>

<span data-ttu-id="15e0b-212">[![Развертывание в Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span><span class="sxs-lookup"><span data-stu-id="15e0b-212">[![Deploy to Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span></span>

1. <span data-ttu-id="15e0b-213">Добавьте сценарий предварительного действия в группу 1 для отработки отказа группы доступности SQL.</span><span class="sxs-lookup"><span data-stu-id="15e0b-213">Add a pre-action script to 'Group 1' to failover SQL Availability group.</span></span> <span data-ttu-id="15e0b-214">Используйте сценарий ASR-SQL-FailoverAG, опубликованный в примерах сценариев.</span><span class="sxs-lookup"><span data-stu-id="15e0b-214">Use the 'ASR-SQL-FailoverAG' script published in the sample scripts.</span></span> <span data-ttu-id="15e0b-215">Обязательно выполните инструкции, предусмотренные сценарием, и внесите необходимые изменения в сценарий соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="15e0b-215">Ensure you follow the guidance in the script and make the required changes in the script appropriately.</span></span>

    ![Add-AG-Script-Step-1](./media/site-recovery-sharepoint/add-ag-script-step1.png)

    ![Add-AG-Script-Step-2](./media/site-recovery-sharepoint/add-ag-script-step2.png)

2. <span data-ttu-id="15e0b-218">Добавьте сценарий завершающего действия для подключения подсистемы балансировки нагрузки на виртуальных машинах веб-уровня (группа 2), для которых выполнена отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="15e0b-218">Add a post action script to attach a load balancer on the failed over virtual machines of Web tier (Group 2).</span></span> <span data-ttu-id="15e0b-219">Используйте сценарий ASR-AddSingleLoadBalancer, опубликованный в примерах сценариев.</span><span class="sxs-lookup"><span data-stu-id="15e0b-219">Use the 'ASR-AddSingleLoadBalancer' script published in the sample scripts.</span></span> <span data-ttu-id="15e0b-220">Обязательно выполните инструкции, предусмотренные сценарием, и внесите необходимые изменения в сценарий соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="15e0b-220">Ensure you follow the guidance in the script and make the required changes in the script appropriately.</span></span>

    ![Add-LB-Script-Step-1](./media/site-recovery-sharepoint/add-lb-script-step1.png)

    ![Add-LB-Script-Step-2](./media/site-recovery-sharepoint/add-lb-script-step2.png)

3. <span data-ttu-id="15e0b-223">Добавьте действие вручную для изменения записей DNS для указания на новую ферму в Azure.</span><span class="sxs-lookup"><span data-stu-id="15e0b-223">Add a manual step to update the DNS records to point to the new farm in Azure.</span></span>

    * <span data-ttu-id="15e0b-224">Для сайтов, работающих с Интернетом, изменение записей DNS после отработки отказа не требуется.</span><span class="sxs-lookup"><span data-stu-id="15e0b-224">For internet facing sites, no DNS updates are required post failover.</span></span> <span data-ttu-id="15e0b-225">Выполните действия, описанные в разделе "Руководство по настройке сети", чтобы настроить диспетчер трафика.</span><span class="sxs-lookup"><span data-stu-id="15e0b-225">Follow the steps described in the 'Networking guidance' section to configure Traffic Manager.</span></span> <span data-ttu-id="15e0b-226">Если профиль диспетчера трафика настроен, как описано в предыдущем разделе, добавьте сценарий для открытия фиктивного порта (например, 800) на виртуальной машине Azure.</span><span class="sxs-lookup"><span data-stu-id="15e0b-226">If the Traffic Manager profile has been set up as described in the previous section, add a script to open dummy port (800 in the example) on the Azure VM.</span></span>

    * <span data-ttu-id="15e0b-227">Для внутренних сайтов добавьте действие вручную для изменения записи DNS для указания на IP-адресе подсистемы балансировки нагрузки новой виртуальной машины веб-уровня.</span><span class="sxs-lookup"><span data-stu-id="15e0b-227">For internal facing sites, add a manual step to update the DNS record to point to the new Web tier VM’s load balancer IP.</span></span>

4. <span data-ttu-id="15e0b-228">Добавьте действие вручную для восстановления приложения поиска из резервной копии или запуска новой службы поиска.</span><span class="sxs-lookup"><span data-stu-id="15e0b-228">Add a manual step to restore search application from a backup or start a new search service.</span></span>

5. <span data-ttu-id="15e0b-229">Для восстановления приложения-службы поиска из резервной копии выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="15e0b-229">For restoring Search service application from a backup, follow below steps.</span></span>

    * <span data-ttu-id="15e0b-230">Этот способ предполагает, что резервная копия приложения-службы поиска была создана до аварийного события и доступна на сайте аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="15e0b-230">This method assumes that a backup of the Search Service Application was performed before the catastrophic event and that the backup is available at the DR site.</span></span>
    * <span data-ttu-id="15e0b-231">Проще всего будет запланировать резервное копирование (например, раз в день) и использовать процедуру копирования для переноса резервной копии на сайт аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="15e0b-231">This can easily be achieved by scheduling the backup (for example, once daily) and using a copy procedure to place the backup at the DR site.</span></span> <span data-ttu-id="15e0b-232">Процедуры копирования могут включать программы на основе сценариев, такие как AzCopy (копирование Azure) или настройку DFSR (репликации распределенных файловых служб).</span><span class="sxs-lookup"><span data-stu-id="15e0b-232">Copy procedures could include scripted programs such as AzCopy (Azure Copy) or setting up DFSR (Distributed File Services Replication).</span></span>
    * <span data-ttu-id="15e0b-233">Когда ферма SharePoint будет запущена, перейдите в раздел "Архивация и восстановление" центра администрирования и выберите "Восстановить".</span><span class="sxs-lookup"><span data-stu-id="15e0b-233">Now that the SharePoint farm is running, navigate the Central Administration, 'Backup and Restore' and select Restore.</span></span> <span data-ttu-id="15e0b-234">Функция восстановления опрашивает указанное расположение архивации (может потребоваться обновить значение).</span><span class="sxs-lookup"><span data-stu-id="15e0b-234">The restore interrogates the backup location specified (you may need to update the value).</span></span> <span data-ttu-id="15e0b-235">Выберите резервную копию приложения-службы поиска, которую требуется восстановить.</span><span class="sxs-lookup"><span data-stu-id="15e0b-235">Select the Search Service Application backup you would like to restore.</span></span>
    * <span data-ttu-id="15e0b-236">Служба поиска будет восстановлена.</span><span class="sxs-lookup"><span data-stu-id="15e0b-236">Search is restored.</span></span> <span data-ttu-id="15e0b-237">Учтите, что служба восстановления ожидает ту же топологию (то же число серверов) и буквы жестких дисков, назначенные этим серверам.</span><span class="sxs-lookup"><span data-stu-id="15e0b-237">Keep in mind that the restore expects to find the same topology (same number of servers) and same hard drive letters assigned to those servers.</span></span> <span data-ttu-id="15e0b-238">Дополнительные сведения см. в документе [Восстановление приложений-служб поиска в SharePoint 2013](https://technet.microsoft.com/library/ee748654.aspx).</span><span class="sxs-lookup"><span data-stu-id="15e0b-238">For more information, see ['Restore Search service application in SharePoint 2013'](https://technet.microsoft.com/library/ee748654.aspx) document.</span></span>


6. <span data-ttu-id="15e0b-239">Чтобы начать работу с новым приложением-службой поиска, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="15e0b-239">For starting with a new Search service application, follow below steps.</span></span>

    * <span data-ttu-id="15e0b-240">Этот способ предполагает, что резервная копия базы данных "Администрирование поиска" доступна на сайте аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="15e0b-240">This method assumes that a backup of the “Search Administration” database is available at the DR site.</span></span>
    * <span data-ttu-id="15e0b-241">Поскольку другие базы данных приложения-службы поиска не реплицируются, их потребуется создать повторно.</span><span class="sxs-lookup"><span data-stu-id="15e0b-241">Since the other Search Service Application databases are not replicated, they need to be re-created.</span></span> <span data-ttu-id="15e0b-242">Для этого перейдите в центр администрирования и удалите приложение-службу поиска.</span><span class="sxs-lookup"><span data-stu-id="15e0b-242">To do so, navigate to Central Administration and delete the Search Service Application.</span></span> <span data-ttu-id="15e0b-243">На любых серверах, на которых размещается индекс поиска, удалите файлы индекса.</span><span class="sxs-lookup"><span data-stu-id="15e0b-243">On any servers which host the Search Index, delete the index files.</span></span>
    * <span data-ttu-id="15e0b-244">Повторно создайте приложение-службу поиска, при этом базы данных будут воссозданы автоматически.</span><span class="sxs-lookup"><span data-stu-id="15e0b-244">Re-create the Search Service Application and this re-creates the databases.</span></span> <span data-ttu-id="15e0b-245">Рекомендуется заранее подготовить сценарий, который повторно создает это приложение-службу, поскольку вы не сможете выполнить все действия через графический интерфейс.</span><span class="sxs-lookup"><span data-stu-id="15e0b-245">It is recommended to have a prepared script that re-creates this service application since it is not possible to perform all actions via the GUI.</span></span> <span data-ttu-id="15e0b-246">Например, задание расположения диска индекса и настройку топологии поиска можно выполнить только с помощью командлетов PowerShell для SharePoint.</span><span class="sxs-lookup"><span data-stu-id="15e0b-246">For example, setting the index drive location and configuring the search topology are only possible by using SharePoint PowerShell cmdlets.</span></span> <span data-ttu-id="15e0b-247">Используйте командлет Windows PowerShell Restore-SPEnterpriseSearchServiceApplication и укажите базу данных администрирования поиска, для которой выполнена доставка журналов и репликация, Search_Service__DB.</span><span class="sxs-lookup"><span data-stu-id="15e0b-247">Use the Windows PowerShell cmdlet Restore-SPEnterpriseSearchServiceApplication and specify the log-shipped and replicated Search Administration database, Search_Service__DB.</span></span> <span data-ttu-id="15e0b-248">Этот командлет предоставляет конфигурацию поиска, схему, управляемые свойства, правила и источники и создает набор других компонентов по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="15e0b-248">This cmdlet gives the search configuration, schema, managed properties, rules, and sources and creates a default set of the other components.</span></span>
    * <span data-ttu-id="15e0b-249">Как только потребуется повторно создать приложение-службу поиска, вы должны будете запустить полный обход всех источников содержимого для восстановления этой службы.</span><span class="sxs-lookup"><span data-stu-id="15e0b-249">Once the Search Service Application has be re-created, you must start a full crawl for each content source to restore the Search Service.</span></span> <span data-ttu-id="15e0b-250">Будут потеряны некоторые данные аналитики из локальной фермы, например рекомендации по поиску.</span><span class="sxs-lookup"><span data-stu-id="15e0b-250">You lose some analytics information from the on-premises farm, such as search recommendations.</span></span>

7. <span data-ttu-id="15e0b-251">После завершения всех этих действий сохраните план восстановления. Окончательный план восстановления будет похож на приведенный ниже.</span><span class="sxs-lookup"><span data-stu-id="15e0b-251">Once all the steps are completed, save the recovery plan and the final recovery plan will look like following.</span></span>

    ![Сохраненный план восстановления](./media/site-recovery-sharepoint/saved-rp.png)

## <a name="doing-a-test-failover"></a><span data-ttu-id="15e0b-253">Тестовая отработка отказа</span><span class="sxs-lookup"><span data-stu-id="15e0b-253">Doing a test failover</span></span>
<span data-ttu-id="15e0b-254">Чтобы выполнить тестовую отработку отказа, используйте [это руководство](site-recovery-test-failover-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="15e0b-254">Follow [this guidance](site-recovery-test-failover-to-azure.md) to do a test failover.</span></span>

1.  <span data-ttu-id="15e0b-255">Перейдите на портал Azure и выберите хранилище служб восстановления.</span><span class="sxs-lookup"><span data-stu-id="15e0b-255">Go to Azure portal and select your Recovery Service vault.</span></span>
2.  <span data-ttu-id="15e0b-256">Щелкните план восстановления, созданный для приложения SharePoint.</span><span class="sxs-lookup"><span data-stu-id="15e0b-256">Click on the recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="15e0b-257">Щелкните "Тестовая отработка отказа".</span><span class="sxs-lookup"><span data-stu-id="15e0b-257">Click on 'Test Failover'.</span></span>
4.  <span data-ttu-id="15e0b-258">Выберите точку восстановления и виртуальную сеть Azure, чтобы запустить тестовую отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="15e0b-258">Select recovery point and Azure virtual network to start the test failover process.</span></span>
5.  <span data-ttu-id="15e0b-259">Как только будет запущена вторичная среда, вы сможете выполнить проверку.</span><span class="sxs-lookup"><span data-stu-id="15e0b-259">Once the secondary environment is up, you can perform your validations.</span></span>
6.  <span data-ttu-id="15e0b-260">После завершения проверки можно нажать кнопку "Очистить тестовую отработку отказа" в плане восстановления. Тестовая среда отработки отказа будет очищена.</span><span class="sxs-lookup"><span data-stu-id="15e0b-260">Once the validations are complete, you can click 'Cleanup test failover' on the recovery plan and the test failover environment is cleaned.</span></span>

<span data-ttu-id="15e0b-261">Инструкции по выполнению тестовой отработки отказа для AD и DNS см. в документе [Рекомендации по тестированию отработки отказа для AD и DNS](site-recovery-active-directory.md#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="15e0b-261">For guidance on doing test failover for AD and DNS, refer to [Test failover considerations for AD and DNS](site-recovery-active-directory.md#test-failover-considerations) document.</span></span>

<span data-ttu-id="15e0b-262">Инструкции по выполнении тестовой отработки отказа для групп доступности SQL AlwaysOn см. в [соответствующем документе](site-recovery-sql.md#steps-to-do-a-test-failover).</span><span class="sxs-lookup"><span data-stu-id="15e0b-262">For guidance on doing test failover for SQL Always ON availability groups, refer to [Doing Test failover for SQL Server Always On](site-recovery-sql.md#steps-to-do-a-test-failover) document.</span></span>

## <a name="doing-a-failover"></a><span data-ttu-id="15e0b-263">Отработка отказа</span><span class="sxs-lookup"><span data-stu-id="15e0b-263">Doing a failover</span></span>
<span data-ttu-id="15e0b-264">При выполнении отработки отказа используйте [это руководство](site-recovery-failover.md).</span><span class="sxs-lookup"><span data-stu-id="15e0b-264">Follow [this guidance](site-recovery-failover.md) for doing a failover.</span></span>

1.  <span data-ttu-id="15e0b-265">Перейдите на портал Azure и выберите хранилище служб восстановления.</span><span class="sxs-lookup"><span data-stu-id="15e0b-265">Go to Azure portal and select your Recovery Services vault.</span></span>
2.  <span data-ttu-id="15e0b-266">Щелкните план восстановления, созданный для приложения SharePoint.</span><span class="sxs-lookup"><span data-stu-id="15e0b-266">Click on the recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="15e0b-267">Щелкните "Отработка отказа".</span><span class="sxs-lookup"><span data-stu-id="15e0b-267">Click on 'Failover'.</span></span>
4.  <span data-ttu-id="15e0b-268">Выберите точку восстановления, чтобы запустить отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="15e0b-268">Select recovery point to start the failover process.</span></span>

## <a name="next-steps"></a><span data-ttu-id="15e0b-269">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="15e0b-269">Next steps</span></span>
<span data-ttu-id="15e0b-270">Вы можете больше узнать о [репликации других приложений](site-recovery-workload.md) с помощью Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="15e0b-270">You can learn more about [replicating other applications](site-recovery-workload.md) using Site Recovery.</span></span>
