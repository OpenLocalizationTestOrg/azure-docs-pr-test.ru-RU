---
title: "планы восстановления aaaCreate для отработки отказа и восстановления в Azure Site Recovery | Документы Microsoft"
description: "Описывает способ toocreate и Настройка планов восстановления в Azure Site Recovery toofail через и восстановление виртуальных машин и физических серверов"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 72408c62-fcb6-4ee2-8ff5-cab1218773f2
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/23/2017
ms.author: raynew
ms.openlocfilehash: 09ca7719e92460b283947fdbe752e8654e5b9cab
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="create-recovery-plans"></a>Создание планов восстановления


В этой статье содержится информация о создании и настройке планов восстановления в [Azure Site Recovery](site-recovery-overview.md).

Отправьте все комментарии или вопросы hello нижней части этой статьи, или на hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).

 Создайте следующие toodo hello с планов восстановления:

* Определяют группы компьютеров, для которых отработка отказа и запуск выполняются одновременно.
* Моделируют зависимости между компьютерами, объединяя их в группы плана восстановления. Например, toofail через и подключить конкретного приложения, можно сгруппировать все hello виртуальных машин для этого приложения в hello же группы плана восстановления.
* Выполняют отработку отказа. Вы можете запустить тестовую, плановую или внеплановую отработку отказа в плане восстановления.


## <a name="create-a-recovery-plan"></a>Создайте план восстановления

1. Щелкните **Планы восстановления** > **Создать план восстановления**.
   Укажите имя для плана восстановления hello и исходные и целевые. расположение источника Hello должно иметь виртуальные машины, которые включены для отработки отказа и восстановления.

    - Репликация tooVMM VMM, установите **тип источника** > **VMM**и hello источника и целевых серверах VMM. Нажмите кнопку **Hyper-V** toosee облаков, которые защищены.
    - VMM tooAzure выберите **тип источника** > **VMM**.  Выберите hello исходном сервере VMM, и **Azure** как целевой hello.
    - TooAzure репликации Hyper-V (без VMM), выберите **тип источника** > **узла Hyper-V**. Выберите hello сайта как источник hello и **Azure** как целевой hello.
    - Для физической или виртуальной Машины VMware локальной tooAzure сервера, выберите сервер конфигурации в качестве источника hello, и **Azure** как целевой hello.
    - Для плана восстановления Azure tooAzure выберите регион Azure, как источник hello и вторичный регион Azure в качестве целевой hello. Hello дополнительного регионов Azure — это защищены только виртуальные машины toowhich.
2. В **выберите виртуальные машины**, выберите виртуальные машины hello (или группы репликации), которые должны tooadd toohello группа по умолчанию (группа 1) в плане восстановления hello.

## <a name="customize-and-extend-recovery-plans"></a>Настройка и расширение планов восстановления

Вы можете настраивать и расширять планы восстановления.

- **Добавление новых групп**— Добавление дополнительная группа планов восстановления групп (копирование tooseven) toohello по умолчанию, а затем добавьте дополнительные машины или репликации группирует toothose группы плана восстановления. Группы нумеруются в порядке hello, в котором их добавить. Каждую виртуальную машину или группу репликации можно включить только в одну группу плана восстановления.
- **Добавление ручного действия**. Вы можете добавить ручные действия, выполняемые до или после группы плана восстановления. При выполнении плана восстановления hello, он останавливается в точке hello, по которому вставлен выполняемое вручную действие hello. Диалоговое окно предлагает toospecify завершение выполняемого вручную действия hello.
- **Добавление скрипта**. Вы можете добавить скрипты, выполняемые до или после группы плана восстановления. При добавлении сценария, он добавляет новый набор действий для группы hello. Например, набор предварительных шагов для группы 1 будет создаваться с именем hello: группа 1: предварительные шаги. Все предварительные действия будут перечислены в этом наборе. Сценарий можно добавить на первичном сайте hello, только если имеется сервер VMM, развернутый.
- **Добавление модулей Runbook Azure**.Чтобы расширить план восстановления, вы можете применить модули Runbook Azure. Например задачи tooautomate или toocreate один шаг восстановления. [Подробнее](site-recovery-runbook-automation.md).

## <a name="add-scripts"></a>Добавление скриптов

В планах восстановления можно использовать скрипты PowerShell.

 - Убедитесь, что скрипты используют блоки try-catch, hello исключения обрабатываются правильно.
    - В случае исключения в скрипте hello прекращения работы и задачу hello показано, как сбой.
    - Если возникает ошибка, оставшаяся часть скрипта hello не запускается.
    - Если произошла ошибка при выполнении внеплановой отработки отказа, план восстановления hello продолжается.
    - Если произошла ошибка при выполнении плановой отработки отказа, hello плана восстановления останавливается. Требуется toofix hello скрипт, убедитесь, что оно работает ожидаемым образом, а затем выполните снова hello плана восстановления.
- Команда Write-Host Hello не работает в скриптах плана восстановления и hello скрипт завершится с ошибкой. toocreate выходные данные, создайте скрипт прокси-сервера, который будет запускать основной скрипт. Убедитесь, что все выходные данные выдавались с помощью hello >> команды.
  * сценарий Hello времени ожидания, если он не возвращает в течение 600 секунд.
  * Если что-либо записывается tooSTDERR, скрипт hello классифицируется как сбойный. Эта информация отображается в сведения о выполнении скрипта hello.

Если в вашем развертывании есть VMM, учтите следующее.

* Скрипты в плане восстановления выполняются в контексте hello hello учетная запись службы VMM. Убедитесь, что эта учетная запись имеет разрешения на чтение для hello удаленного общего ресурса, на какие hello скрипт находится. Протестируйте toorun сценария hello в hello уровень прав доступа учетной записи службы VMM.
* Командлеты VMM предоставляются в модуле Windows PowerShell. модуль Hello устанавливается при установке консоли VMM hello. Он может быть загружена в сценарий, используя следующую команду в скрипт hello hello:
   - Import-Module -Name virtualmachinemanager. [Подробнее](https://technet.microsoft.com/library/hh875013.aspx).
* Убедитесь в наличии хотя бы одного сервера библиотеки в вашем развертывании VMM. По умолчанию hello общую папку библиотеки для сервера VMM расположен локально на сервер VMM, с имени папки hello MSCVMMLibrary hello.
    * Если ваш путь к общей папке библиотеки удаленного (или локальным, а не от mscvmmlibrary), настроить общую папку hello следующим образом (с помощью \\libserver2.contoso.com\share\ в качестве примера):
      * Откройте редактор реестра hello и перейдите слишком**Recovery\Registration сайта HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\Azure**.
      * Изменить значение hello **ScriptLibraryPath** и поместите ее в качестве \\libserver2.contoso.com\share\. Укажите полное доменное имя hello. Предоставить разрешения toohello общую папку.
      * Протестируйте скрипт hello с учетной записью пользователя, которая имеет hello же hello VMM разрешения учетной записи службы. Проверяет, предоставляемыми протестированных сценариев запуска в hello таким же способом, что и в планах восстановления. На сервере VMM hello задайте toobypass политики выполнения hello следующим образом:
        * Откройте консоль Windows PowerShell на 64-разрядных hello, с использованием повышенных привилегий.
        * Введите: **Set-executionpolicy bypass**. [Подробнее](https://technet.microsoft.com/library/ee176961.aspx).

## <a name="add-a-script-or-manual-action-tooa-plan"></a>Добавить скрипт или ручное действие tooa плана

После добавления виртуальных машин или tooit группы репликации и план hello создан, можно добавить группы плана восстановления по умолчанию toohello сценария.

1. Привет открыть план восстановления.
2. Щелкните элемент в hello **шаг** , а затем нажмите **сценарий** или **действие вручную**.
3. Укажите ли скрипт hello tooadd toowant или действия до или после hello выбранный элемент. Используйте hello **вверх** и **вниз** кнопок, положение hello toomove hello скрипта вверх или вниз.
4. При добавлении сценария VMM выберите **tooVMM сценария отработки отказа**. В **путь к скрипту**, относительный путь toohello типа hello папки. В следующем примере VMM hello, указывается путь hello: **\RPScripts\RPScript.PS1**.
5. При добавлении книга выполнения автоматизации Azure, укажите учетную запись службы автоматизации Azure hello, в какие hello runbook — скрипт hello найти и выбрать соответствующие runbook для Azure.
6. Выполните отработку отказа плана восстановления hello, убедиться, что скрипт hello toomake работает надлежащим образом.


### <a name="add-a-vmm-script"></a>Добавление скрипта VMM

При наличии исходного сайта VMM, можно создать сценарий на сервере VMM hello и включить в план восстановления.

1. Создайте новую папку в общей папке библиотеки hello. Например \<VMMServerName>\MSSCVMMLibrary\RPScripts. Поместите ее на hello источника и целевых серверах VMM.
2. Создать скрипт hello (например RPScript) и убедитесь, что он работает нужным образом.
3. Сценарий hello поместить в расположение hello \<VMMServerName > \MSSCVMMLibrary на hello исходный и целевой серверы VMM.


## <a name="next-steps"></a>Дальнейшие действия

[Дополнительные сведения](site-recovery-failover.md) о выполнении отработки отказа.
