---
title: "Результаты теста репликации Hyper-V между сайтами с использованием Azure Site Recovery | Документация Майкрософт"
description: "В этой статье содержатся сведения о тестировании производительности для репликации виртуальных машин Hyper-V между локальными сайтами с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: tysonn
ms.assetid: 96ff404f-0d88-43fa-a00b-2dffde93d192
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 05/24/2017
ms.author: raynew
ms.openlocfilehash: a9bec774b5482de87eefcd0c87844a2adbd98bbe
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="test-results-for-on-premises-to-on-premises-hyper-v-replication-with-site-recovery"></a>Результаты теста репликации Hyper-V между локальными сайтами с помощью Site Recovery

Microsoft Azure Site Recovery можно использовать для координации и контроля репликации виртуальных машин и физических серверов в Azure или дополнительный центр обработки данных. Эта статья содержит результаты тестирования производительности, которое мы выполняли при репликации виртуальных машин Hyper-V между двумя локальными центрами обработки данных.

## <a name="test-goals"></a>Цели тестирования

Цель тестирования — проверить, как ведет себя Azure Site Recovery при репликации устойчивого состояния. Репликация устойчивого состояния происходит, когда виртуальные машины завершили начальную репликацию и выполняют синхронизацию небольших изменений. Производительность важно измерять с помощью устойчивого состояния, поскольку это как раз то состояние, в котором большинство виртуальных машин остается до тех пор, пока не возникает непредвиденный простой.

Тестовое развертывание включает два локальных сайта, на каждом из которых имеется сервер VMM. Такое тестовое развертывание является типичным для развертывания головного офиса и филиала, в котором первый выступает в качестве основного сайта, а филиал — как дополнительный сайт или сайт восстановления.

## <a name="what-we-did"></a>Результат

Вот что мы сделали в ходе теста:

1. Создание виртуальных машин с помощью шаблонов VMM.
2. Запуск виртуальных машин и отслеживание базовых показателей производительности каждые 12 часов.
3. Создание облаков на основном сервере VMM и сервере восстановления VMM.
4. Настройка защиты облака в Azure Site Recovery, включая сопоставление исходного облака и облака восстановления.
5. Включение защиты для виртуальных машин и предоставление им разрешения на выполнение начальной репликации.
6. Ожидание стабилизации системы в течение нескольких часов.
7. Собор метрик производительности каждые 12 часов для проверки того, что в течение этих 12 часов все виртуальные машины остаются в ожидаемом состоянии репликации.
8. Измерение разницы между базовыми метриками производительности и метриками производительности репликации.


## <a name="primary-server-performance"></a>Производительность основного сервера

* Реплика Hyper-V асинхронно отслеживает изменения в файле журнала с минимальным задействованием ресурсов хранилища на основном сервере.
* Реплика Hyper-V использует самоподдерживающий кэш памяти, чтобы свести к минимуму временные затраты на выполнение операций ввода-вывода в секунду для отслеживания. Она сохраняет операции записи в VHDX в памяти и записывает их в файл журнала перед отправкой журнала на сайт восстановления. Окончательная запись данных на диск также происходит в случае, если операции записи сталкиваются с предопределенным ограничением.
* На диаграмме ниже показаны временные затраты на выполнение операций ввода-вывода в секунду для репликации. Мы видим, что временные затраты на выполнение операций ввода-вывода в секунду для репликации составляют приблизительно 5 %, что довольно мало.

![Основные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744913.png)

Реплика Hyper-V использует память на основном сервере для оптимизации производительности диска. Как показано на следующей диаграмме, временные затраты на использование памяти на всех серверах в основном кластере являются граничными. Временные затраты на использование памяти представлены в виде процента памяти, используемого репликацией, по отношению к общему объему памяти, который имеется на сервере Hyper-V.

![Основные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744914.png)

Временные затраты на использование ресурсов ЦП репликой Hyper-V являются минимальными. Как показано на диаграмме ниже, временные затраты на репликацию находятся в диапазоне 2–3 %.

![Основные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744915.png)

## <a name="secondary-recovery-server-performance"></a>Производительность дополнительного сервера (сервера восстановления)

Реплика Hyper-V использует небольшой объем памяти на сервере восстановления, чтобы оптимизировать числа операций сохранения. На диаграмме ниже представлены обобщенные данные об использовании памяти на сервере восстановления. Временные затраты на использование памяти представлены в виде процента памяти, используемого репликацией, по отношению к общему объему памяти, который имеется на сервере Hyper-V.

![Дополнительные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744916.png)

Объем операций ввода-вывода на сайте восстановления зависит от количества операций записи на основном сайте. Рассмотрим общее количество операций ввода-вывода на сайте восстановления по сравнению с общим количеством операций ввода-вывода и операций записи на основном сайте. На диаграмме показано, что итоговое количество операций ввода-вывода в секунду на сайте восстановления:

* приблизительно в 1,5 раза больше количества операций записи на основном сайте;
* составляет приблизительно 37 % от общего количества операций ввода-вывода в секунду на основном сайте.

![Дополнительные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744917.png)

![Дополнительные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744918.png)

## <a name="effect-on-network-utilization"></a>Влияние на использование сети

Пропускная способность сети между основным узлом и узлом восстановления в среднем составила 275 МБ/с (с включенным сжатием данных) по отношению к существующей пропускной способности сети в 5 ГБ/с.

![Результаты по использованию сети](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744919.png)

## <a name="effect-on-vm-performance"></a>Влияние на производительность виртуальной машины

Важным аспектом является влияние репликации на выполнение рабочей нагрузки, назначенной виртуальным машинам. Если основной сайт правильно подготовлен для репликации, то не должно быть никакого влияния на рабочую нагрузку. Упрощенный механизм отслеживания реплики Hyper-V гарантирует, что рабочие нагрузки, выполняющиеся на виртуальных машинах, не будут затронуты репликацией устойчивого состояния. Это как раз иллюстрируется на следующих диаграммах.

На этой диаграмме показаны операции ввода-вывода в секунду, выполняемые виртуальными машинами с разными рабочими нагрузками до и после включения репликации. Можно заметить, что никаких различий между ними не наблюдается.

![Результаты по воздействию реплики](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744920.png)

На следующей диаграмме показана пропускная способность виртуальных машин, на которых выполняются разные рабочие нагрузки до и после включения репликации. Можно видеть, что репликация не оказывает существенного влияния.

![Воздействие реплики, результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744921.png)

## <a name="conclusion"></a>Заключение

Результаты ясно показывают, что масштабирование Azure Site Recovery в сочетании с репликой Hyper-V выполняется с минимальными временными затратами для большого кластера.  Azure Site Recovery обеспечивает простоту развертывания, репликации, управления и мониторинга. Реплика Hyper-V предоставляет необходимую инфраструктуру для успешного масштабирования репликации. Для планирования оптимального развертывания рекомендуется скачать [Планировщик ресурсов реплики Hyper-V](https://www.microsoft.com/download/details.aspx?id=39057).

## <a name="test-environment-details"></a>Сведения о тестовой среде

### <a name="primary-site"></a>Основной сайт

* Основной сайт включает кластер, содержащий пять серверов Hyper-V, на которых выполняются 470 виртуальных машин.
* Виртуальные машины выполняют разную рабочую нагрузку и на них на всех включена защита Azure Site Recovery.
* Хранилище для узла кластера предоставляется сетью хранения данных iSCSI. Модель — Hitachi HUS130.
* Каждый сервер кластера оборудован четырьмя сетевыми картами (NIC) со скоростью передачи данных 1 Гбит/с.
* Две из них подключены к частной сети iSCSI, а другие две — к внешней корпоративной сети. Одна из внешних сетей зарезервирована исключительно для кластерных взаимодействий.

![Основные требования к оборудованию](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744922.png)

| сервер; | ОЗУ | Модель | Процессор | Количество процессоров | Сетевая карта | Программное обеспечение |
| --- | --- | --- | --- | --- | --- | --- |
| Серверы Hyper-V в кластере:  <br />ESTLAB-HOST11<br />ESTLAB-HOST12<br />ESTLAB-HOST13<br />ESTLAB-HOST14<br />ESTLAB-HOST25 |На сервере 128ESTLAB-HOST25 имеется ОЗУ 256 МБ |Dell ™ PowerEdge ™ R820 |Intel(R) Xeon(R) CPU E5-4620 0 @ 2.20GHz |4. |1 Гбит/с х 4 |Windows Server Datacenter 2012 R2 (64-разрядная версия) + роль Hyper-V |
| Сервер VMM |2 | | |2 |1 Гбит/с |Windows Server Database 2012 R2 (64-разрядная версия) + VMM 2012 R2 |

### <a name="secondary-recovery-site"></a>Дополнительный сайт (сайт восстановления)

* Дополнительный сайт включает отказоустойчивый кластер с шестью узлами.
* Хранилище для узла кластера предоставляется сетью хранения данных iSCSI. Модель — Hitachi HUS130.

![Основные характеристики оборудования](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744923.png)

| сервер; | ОЗУ | Модель | Процессор | Количество процессоров | Сетевая карта | Программное обеспечение |
| --- | --- | --- | --- | --- | --- | --- |
| Серверы Hyper-V в кластере:  <br />ESTLAB-HOST07<br />ESTLAB-HOST08<br />ESTLAB-HOST09<br />ESTLAB-HOST10 |96 |Dell ™ PowerEdge ™ R720 |Intel(R) Xeon(R) CPU E5-2630 0 @ 2.30GHz |2 |1 Гбит/с х 4 |Windows Server Datacenter 2012 R2 (64-разрядная версия) + роль Hyper-V |
| ESTLAB HOST17 |128 |Dell ™ PowerEdge ™ R820 |Intel(R) Xeon(R) CPU E5-4620 0 @ 2.20GHz |4. | |Windows Server Datacenter 2012 R2 (64-разрядная версия) + роль Hyper-V |
| ESTLAB HOST24 |256 |Dell ™ PowerEdge ™ R820 |Intel(R) Xeon(R) CPU E5-4620 0 @ 2.20GHz |2 | |Windows Server Datacenter 2012 R2 (64-разрядная версия) + роль Hyper-V |
| Сервер VMM |2 | | |2 |1 Гбит/с |Windows Server Database 2012 R2 (64-разрядная версия) + VMM 2012 R2 |

### <a name="server-workloads"></a>Рабочие нагрузки сервера

* Для целей тестирования мы выбрали рабочие нагрузки, которые обычно используются в сценариях корпоративных клиентов.
* Мы используем [IOMeter](http://www.iometer.org) со сводной таблицей характеристик рабочей нагрузки для моделирования.
* Все профили IOMeter настроены на запись случайных байтов, чтобы смоделировать худшие варианты моделей записи для рабочих нагрузок.

| Рабочая нагрузка | Размер ввода-вывода (КБ) | % доступа | % чтения | Количество необработанных операций ввода-вывода | Модель операций ввода-вывода |
| --- | --- | --- | --- | --- | --- |
| Файловый сервер |48163264 |60 %, 20 %, 5 %, 5 %, 10 % |80 %, 80 %, 80 %, 80 %, 80 % |88888 |Все 100 % случайные |
| SQL Server (том 1), SQL Server (том 2) |864 |100 %, 100 % |70 %, 0 % |88 |100 % случайные, 100 % последовательные |
| Exchange |32 |100 % |67 % |8 |100 % случайные |
| Рабочая станция/VDI |464 |66 %, 34 % |70 %, 95 % |11 |100 % случайные (в обоих случаях) |
| Файловый веб-сервер |4864 |33 %, 34 %, 33 % |95 %, 95 %, 95 % |888 |Все 75 % случайные |

### <a name="vm-configuration"></a>Конфигурация виртуальной машины

* 470 виртуальных машин в основном кластере.
* Все виртуальные машины с диском VHDX.
* В таблице представлены сводные сведения о виртуальных машинах, выполняющих рабочие нагрузки. Все они созданы с помощью шаблонов VMM.

| Рабочая нагрузка | Число виртуальных машин | Минимальный объем ОЗУ (ГБ) | Максимальный объем ОЗУ (ГБ) | Размер логического диска (ГБ) на виртуальную машину | Максимальное значение IOPS |
| --- | --- | --- | --- | --- | --- |
| SQL Server |51 |1 |4. |167 |10 |
| Exchange Server |71 |1 |4. |552 |10 |
| Файловый сервер |50 |1 |2 |552 |22 |
| VDI |149 |0,5 |1 |80 |6 |
| Веб-сервер |149 |0,5 |1 |80 |6 |
| ВСЕГО |470 | | |96,83 ТБ |4108 |

### <a name="site-recovery-settings"></a>Параметры Azure Site Recovery

* Azure Site Recovery был настроен на защиту с помощью переноса из локальной среды в локальную среду.
* На сервере VMM имеется четыре облака, в которых находятся серверы кластера Hyper-V и их виртуальные машины.

| Основное облако VMM | Защищенные виртуальные машины в облаке | Частота репликации | Дополнительные точки восстановления |
| --- | --- | --- | --- |
| PrimaryCloudRpo15m |142 |15 мин |None |
| PrimaryCloudRpo30s |47 |30 с |None |
| PrimaryCloudRpo30sArp1 |47 |30 с |1 |
| PrimaryCloudRpo5m |235 |5 мин |None |

### <a name="performance-metrics"></a>Метрики производительности

В таблице ниже перечислены метрики производительности и счетчики, которые оценивались в развертывании.

| Метрика | Счетчик |
| --- | --- |
| ЦП |\Процессор (_общий объем ресурсов)\% загруженности процессора |
| Объем доступной памяти |\Память\Доступный объем в МБ |
| ОПЕРАЦИЙ ВВОДА-ВЫВОДА |\Диск\Физический диск(_общий объем ресурсов) в секунду |
| Операции чтения (IOPS) виртуальной машины в секунду |\Виртуальное запоминающее устройство Hyper-V (<VHD>)\Операции чтения в секунду |
| Операции записи (IOPS) виртуальной машины в секунду |\Виртуальное запоминающее устройство Hyper-V (<VHD>)\Операции записи в секунду |
| Пропускная способность операций чтения виртуальной машины |\Виртуальное запоминающее устройство Hyper-V (<VHD>)\Чтение байтов в секунду |
| Пропускная способность операций записи виртуальной машины |\Виртуальное запоминающее устройство Hyper-V (<VHD>)Запись байтов в секунду |

## <a name="next-steps"></a>Дальнейшие действия

[Настройка репликации между двумя локальными сайтами VMM](site-recovery-vmm-to-vmm.md)
