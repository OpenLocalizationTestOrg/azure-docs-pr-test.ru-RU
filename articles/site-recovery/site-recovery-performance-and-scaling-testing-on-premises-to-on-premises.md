---
title: "результаты aaaTest Hyper-V репликации между сайтами с помощью Azure Site Recovery | Документы Microsoft"
description: "В этой статье рассматривается тестирование производительности для репликации локальной tooon локальных виртуальных машин Hyper-V с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: tysonn
ms.assetid: 96ff404f-0d88-43fa-a00b-2dffde93d192
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 05/24/2017
ms.author: raynew
ms.openlocfilehash: 3b37542fc88e0af05e05cee78183983667618816
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="test-results-for-on-premises-tooon-premises-hyper-v-replication-with-site-recovery"></a>Результаты теста для репликации Hyper-V локально tooon организациями с Site Recovery

Можно использовать tooorchestrate Microsoft Azure Site Recovery и управление репликацией виртуальных машин и физических серверов tooAzure или tooa дополнительный центр обработки данных. В этой статье приведены hello результаты тестирования производительности, которые мы использовали при репликации виртуальных машин Hyper-V между двумя локальными центрами обработки данных.

## <a name="test-goals"></a>Цели тестирования

Цель Hello тестирования была tooexamine, как выполняется Azure Site Recovery при репликации устойчивого состояния. Репликация устойчивого состояния происходит, когда виртуальные машины завершили начальную репликацию и выполняют синхронизацию небольших изменений. Это важные toomeasure производительности с помощью устойчивого состояния, так как он находится в состоянии hello, остаются большинство виртуальных машин, если только при возникновении непредвиденных сбоев.

тестовое развертывание Hello состоял из двух локальных сайтов с сервером VMM на каждом сайте. Этого тестового развертывания является типичным головной офис/филиал развертывания office, в котором головной офис, выступающем в качестве первичного сайта hello и hello филиале как hello дополнительного сайта или сайта восстановления.

## <a name="what-we-did"></a>Результат

Вот, что в тесте hello передается.

1. Создание виртуальных машин с помощью шаблонов VMM.
2. Запуск виртуальных машин и отслеживание базовых показателей производительности каждые 12 часов.
3. Создание облаков на основном сервере VMM и сервере восстановления VMM.
4. Настройка защиты облака в Azure Site Recovery, включая сопоставление исходного облака и облака восстановления.
5. Включить защиту для виртуальных машин и разрешить им toocomplete начальной репликации.
6. Ожидание стабилизации системы в течение нескольких часов.
7. Собор метрик производительности каждые 12 часов для проверки того, что в течение этих 12 часов все виртуальные машины остаются в ожидаемом состоянии репликации.
8. Мера hello разницу между базовыми метриками производительности hello и hello метрики производительности репликации.


## <a name="primary-server-performance"></a>Производительность основного сервера

* Реплика Hyper-V асинхронно отслеживает изменения tooa журнал с минимальными затратами памяти на сервере-источнике hello.
* Реплика Hyper-V использует издержки памяти кэша toominimize операций ввода-ВЫВОДА для отслеживания. Он сохраняет записи toohello, VHDX в памяти и их в файл журнала hello перед hello времени этот журнал hello сбросов отправляется toohello восстановления сайта. На диск также происходит, если записи hello сталкиваются с предопределенным ограничением.
* Hello графике ниже показаны hello устойчивого состояния операций ввода-ВЫВОДА и служебных данных для репликации. Мы видим, что hello tooreplication издержки из-за операций ввода-ВЫВОДА — около 5%, что довольно мало.

![Основные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744913.png)

Реплика Hyper-V использует память на производительность диска toooptimize hello сервера-источника. Как показано в следующих graph hello граничной издержки памяти на всех серверах в основном кластере hello. показанные издержки памяти Hello — hello процент памяти, используемой памяти репликации по сравнению toohello общее установлен на сервере Hyper-V hello.

![Основные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744914.png)

Временные затраты на использование ресурсов ЦП репликой Hyper-V являются минимальными. Как показано на диаграмме hello, издержки на репликацию находятся в диапазоне hello 2-3%.

![Основные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744915.png)

## <a name="secondary-recovery-server-performance"></a>Производительность дополнительного сервера (сервера восстановления)

Реплика Hyper-V использует небольшой объем памяти на номер hello восстановления сервера toooptimize hello операций хранилища. График Hello перечислены hello использование памяти на сервере восстановления hello. показанные издержки памяти Hello — hello процент памяти, используемой памяти репликации по сравнению toohello общее установлен на сервере Hyper-V hello.

![Дополнительные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744916.png)

Hello объем операций ввода-вывода на сайте восстановления hello зависит от hello количество операций записи на первичном сайте hello. Рассмотрим hello общего количества операций ввода-вывода на сайте восстановления hello по сравнению с hello общего количества операций ввода-вывода и операций записи на первичном сайте hello. графы Hello показывают итогового hello — операций ввода-ВЫВОДА на сайте восстановления hello

* Hello приблизительно в 1,5 раза больше операций ввода-ВЫВОДА записи на основной hello.
* Примерно 37% от hello общее число операций ввода-ВЫВОДА на первичном сайте hello.

![Дополнительные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744917.png)

![Дополнительные результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744918.png)

## <a name="effect-on-network-utilization"></a>Влияние на использование сети

В среднем 275 МБ в секунду, пропускной способности сети использовался hello источника и восстановления узлов (с включенным сжатием) к имеющейся пропускной способности в 5 ГБ в секунду.

![Результаты по использованию сети](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744919.png)

## <a name="effect-on-vm-performance"></a>Влияние на производительность виртуальной машины

Важным аспектом является влияние репликации на рабочих нагрузок, работающих на виртуальных машинах hello hello. Если hello основной сайт правильно подготовлен к репликации, для рабочих нагрузок hello не должна быть негативного влияния. Реплика Hyper-V упрощенный механизм отслеживания гарантирует рабочих нагрузок, работающих на виртуальных машинах hello не затрагиваются при репликации устойчивого состояния. Это продемонстрировано в следующих диаграмм hello.

На этой диаграмме показаны операции ввода-вывода в секунду, выполняемые виртуальными машинами с разными рабочими нагрузками до и после включения репликации. Можно заметить, что нет никаких различий между двумя hello.

![Результаты по воздействию реплики](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744920.png)

Hello следующей диаграмме показано hello пропускная способность виртуальных машин под управлением разных рабочих нагрузок до и после включения репликации. Можно видеть, что репликация не оказывает существенного влияния.

![Воздействие реплики, результаты](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744921.png)

## <a name="conclusion"></a>Заключение

Hello результаты ясно показывают, что Azure Site Recovery в сочетании с репликой Hyper-V, масштабируется с минимальными издержками для большого кластера.  Azure Site Recovery обеспечивает простоту развертывания, репликации, управления и мониторинга. Реплика Hyper-V обеспечивает необходимую инфраструктуру hello для успешного масштабирования репликации. Для планирования оптимального развертывания рекомендуется загрузить hello [планировщик ресурсов реплики Hyper-V](https://www.microsoft.com/download/details.aspx?id=39057).

## <a name="test-environment-details"></a>Сведения о тестовой среде

### <a name="primary-site"></a>Основной сайт

* Hello основной сайт имеет кластер, содержащий пять серверов Hyper-V под управлением 470 виртуальных машин.
* Hello виртуальные машины обрабатывают разную рабочую нагрузку и имеют включенной защитой Azure Site Recovery.
* Хранилище для узла кластера hello предоставляется сетью iSCSI SAN. Модель — Hitachi HUS130.
* Каждый сервер кластера оборудован четырьмя сетевыми картами (NIC) со скоростью передачи данных 1 Гбит/с.
* Две сетевые карты hello частной сети iSCSI подключенного tooan и два подключенных tooan внешней корпоративной сети. Один hello внешних сетей зарезервирована только для кластерных взаимодействий.

![Основные требования к оборудованию](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744922.png)

| сервер; | ОЗУ | Модель | Процессор | Количество процессоров | Сетевая карта | Программное обеспечение |
| --- | --- | --- | --- | --- | --- | --- |
| Серверы Hyper-V в кластере:  <br />ESTLAB-HOST11<br />ESTLAB-HOST12<br />ESTLAB-HOST13<br />ESTLAB-HOST14<br />ESTLAB-HOST25 |На сервере 128ESTLAB-HOST25 имеется ОЗУ 256 МБ |Dell ™ PowerEdge ™ R820 |Intel(R) Xeon(R) CPU E5-4620 0 @ 2.20GHz |4. |1 Гбит/с х 4 |Windows Server Datacenter 2012 R2 (64-разрядная версия) + роль Hyper-V |
| Сервер VMM |2 | | |2 |1 Гбит/с |Windows Server Database 2012 R2 (64-разрядная версия) + VMM 2012 R2 |

### <a name="secondary-recovery-site"></a>Дополнительный сайт (сайт восстановления)

* Дополнительный сайт Hello имеет шестью узлами отказоустойчивого кластера.
* Хранилище для узла кластера hello предоставляется сетью iSCSI SAN. Модель — Hitachi HUS130.

![Основные характеристики оборудования](./media/site-recovery-performance-and-scaling-testing-on-premises-to-on-premises/IC744923.png)

| сервер; | ОЗУ | Модель | Процессор | Количество процессоров | Сетевая карта | Программное обеспечение |
| --- | --- | --- | --- | --- | --- | --- |
| Серверы Hyper-V в кластере:  <br />ESTLAB-HOST07<br />ESTLAB-HOST08<br />ESTLAB-HOST09<br />ESTLAB-HOST10 |96 |Dell ™ PowerEdge ™ R720 |Intel(R) Xeon(R) CPU E5-2630 0 @ 2.30GHz |2 |1 Гбит/с х 4 |Windows Server Datacenter 2012 R2 (64-разрядная версия) + роль Hyper-V |
| ESTLAB HOST17 |128 |Dell ™ PowerEdge ™ R820 |Intel(R) Xeon(R) CPU E5-4620 0 @ 2.20GHz |4. | |Windows Server Datacenter 2012 R2 (64-разрядная версия) + роль Hyper-V |
| ESTLAB HOST24 |256 |Dell ™ PowerEdge ™ R820 |Intel(R) Xeon(R) CPU E5-4620 0 @ 2.20GHz |2 | |Windows Server Datacenter 2012 R2 (64-разрядная версия) + роль Hyper-V |
| Сервер VMM |2 | | |2 |1 Гбит/с |Windows Server Database 2012 R2 (64-разрядная версия) + VMM 2012 R2 |

### <a name="server-workloads"></a>Рабочие нагрузки сервера

* Для целей тестирования мы выбрали рабочие нагрузки, которые обычно используются в сценариях корпоративных клиентов.
* Мы используем [IOMeter](http://www.iometer.org) с характеристиками рабочей нагрузки hello, представленные в таблице hello для моделирования.
* Все профили IOMeter настроены шаблоны toowrite случайных байтов toosimulate худший записи для рабочих нагрузок.

| Рабочая нагрузка | Размер ввода-вывода (КБ) | % доступа | % чтения | Количество необработанных операций ввода-вывода | Модель операций ввода-вывода |
| --- | --- | --- | --- | --- | --- |
| Файловый сервер |48163264 |60 %, 20 %, 5 %, 5 %, 10 % |80 %, 80 %, 80 %, 80 %, 80 % |88888 |Все 100 % случайные |
| SQL Server (том 1), SQL Server (том 2) |864 |100 %, 100 % |70 %, 0 % |88 |100 % случайные, 100 % последовательные |
| Exchange |32 |100 % |67 % |8 |100 % случайные |
| Рабочая станция/VDI |464 |66 %, 34 % |70 %, 95 % |11 |100 % случайные (в обоих случаях) |
| Файловый веб-сервер |4864 |33 %, 34 %, 33 % |95 %, 95 %, 95 % |888 |Все 75 % случайные |

### <a name="vm-configuration"></a>Конфигурация виртуальной машины

* 470 виртуальных машин в основном кластере hello.
* Все виртуальные машины с диском VHDX.
* Виртуальные машины обрабатывают рабочую нагрузку, представленные в таблице hello. Все они созданы с помощью шаблонов VMM.

| Рабочая нагрузка | Число виртуальных машин | Минимальный объем ОЗУ (ГБ) | Максимальный объем ОЗУ (ГБ) | Размер логического диска (ГБ) на виртуальную машину | Максимальное значение IOPS |
| --- | --- | --- | --- | --- | --- |
| SQL Server |51 |1 |4. |167 |10 |
| Exchange Server |71 |1 |4. |552 |10 |
| Файловый сервер |50 |1 |2 |552 |22 |
| VDI |149 |0,5 |1 |80 |6 |
| Веб-сервер |149 |0,5 |1 |80 |6 |
| ВСЕГО |470 | | |96,83 ТБ |4108 |

### <a name="site-recovery-settings"></a>Параметры Azure Site Recovery

* Azure Site Recovery был настроен для локальной tooon локальной защиты
* Сервер VMM Hello имеет настроено четыре облака, содержащие hello серверы кластера Hyper-V и виртуальных машин.

| Основное облако VMM | Защищенные виртуальные машины в облаке hello | Частота репликации | Дополнительные точки восстановления |
| --- | --- | --- | --- |
| PrimaryCloudRpo15m |142 |15 мин |None |
| PrimaryCloudRpo30s |47 |30 с |None |
| PrimaryCloudRpo30sArp1 |47 |30 с |1 |
| PrimaryCloudRpo5m |235 |5 мин |None |

### <a name="performance-metrics"></a>Метрики производительности

Hello таблице перечислены метрики производительности hello и счетчики, которые оценивались в развертывании hello.

| Метрика | Счетчик |
| --- | --- |
| ЦП |\Процессор (_общий объем ресурсов)\% загруженности процессора |
| Объем доступной памяти |\Память\Доступный объем в МБ |
| ОПЕРАЦИЙ ВВОДА-ВЫВОДА |\Диск\Физический диск(_общий объем ресурсов) в секунду |
| Операции чтения (IOPS) виртуальной машины в секунду |\Виртуальное запоминающее устройство Hyper-V (<VHD>)\Операции чтения в секунду |
| Операции записи (IOPS) виртуальной машины в секунду |\Виртуальное запоминающее устройство Hyper-V (<VHD>)\Операции записи в секунду |
| Пропускная способность операций чтения виртуальной машины |\Виртуальное запоминающее устройство Hyper-V (<VHD>)\Чтение байтов в секунду |
| Пропускная способность операций записи виртуальной машины |\Виртуальное запоминающее устройство Hyper-V (<VHD>)Запись байтов в секунду |

## <a name="next-steps"></a>Дальнейшие действия

[Настройка репликации между двумя локальными сайтами VMM](site-recovery-vmm-to-vmm.md)
