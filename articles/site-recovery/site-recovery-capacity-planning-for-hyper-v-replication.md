---
title: "Планировщик ресурсов Hyper-V для Azure Site Recovery | Документация Майкрософт"
description: "В этой статье объясняется, как запустить планировщик ресурсов Hyper-V для Azure Site Recovery."
services: site-recovery
documentationcenter: na
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: 2bc3832f-4d6e-458d-bf0c-f00567200ca0
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 11/28/2017
ms.author: nisoneji
ms.openlocfilehash: e2a69f240068d3155c2fdd52c118dc037ccbcdcb
ms.sourcegitcommit: a48e503fce6d51c7915dd23b4de14a91dd0337d8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2017
---
Теперь доступна новая улучшенная версия [планировщика развертывания Azure Site Recovery (развертывание виртуальных машин Hyper-V в Azure)](site-recovery-hyper-v-deployment-planner.md). Она используется вместо старого средства. Используйте для планирования развертывания новое средство. Это средство обеспечивает следующие возможности: 
* Оценка совместимости виртуальной машины в зависимости от количества дисков, их размера, числа операций ввода-вывода в секунду, активности обработки данных и некоторых характеристик виртуальной машины.
* оценка пропускной способности сети и RPO;
* соответствие требованиям к инфраструктуре Azure;
* соответствие требованиям к локальной инфраструктуре;
* рекомендации по пакетной обработке для начальной репликации;
* оценочные затраты на аварийное восстановление в Azure.


# <a name="hyper-v-capacity-planner-tool-for-site-recovery"></a>Планировщик ресурсов Hyper-V для Site Recovery

Во время развертывания Azure Site Recovery вам нужно будет определить свои требования к репликации и пропускной способности. Планировщик ресурсов Hyper-V для Site Recovery поможет вам сделать это для репликации виртуальных машин Hyper-V.

В этой статье объясняется, как запустить планировщик ресурсов Hyper-V. Этот инструмент следует использовать вместе с другими инструментами планирования ресурсов. Дополнительные сведения см. в статье [Планирование производительности для защиты виртуальных машин и физических серверов в Azure Site Recovery](site-recovery-capacity-planner.md).

## <a name="before-you-start"></a>Перед началом работы
Запустите средство на сервере или узле кластера Hyper-V на основном сайте. Для работы средства сервер Hyper-V должен иметь следующие ресурсы.

* Операционная система: Windows Server 2012 или 2012 R2.
* Память: 20 МБ (минимум)
* ЦП: дополнительно 5 процентов (минимум)
* Место на диске: 5 МБ (минимум)

Перед запуском средства нужно подготовить основной сайт. Если репликация выполняется между двумя локальными сайтами и вы хотите проверить пропускную способность, вам также потребуется подготовить сервер-реплику.

## <a name="step-1-prepare-the-primary-site"></a>Шаг 1. Подготовка основного сайта

1. На основном сайте создайте список всех виртуальных машин Hyper-V для репликации, а также список кластеров или узлов Hyper-V, на которых они расположены. Средство можно запускать либо для нескольких изолированных узлов, либо для отдельного кластера (сочетать эти варианты нельзя). Также средство необходимо запускать отдельно для каждой операционной системы, поэтому серверы Hyper-V следует сгруппировать следующим образом:

   * изолированные серверы Windows Server 2012;
   * кластеры Windows Server 2012;
   * изолированные серверы Windows Server 2012 R2;
   * кластеры Windows Server 2012 R2.
2. Включите удаленный доступ к WMI на всех узлах и кластерах Hyper-V. Выполните следующую команду для каждого сервера или кластера, чтобы настроить правила брандмауэра и разрешения пользователей.

        netsh firewall set service RemoteAdmin enable
3. Включите мониторинг производительности для серверов и кластеров следующим образом.

   * Откройте брандмауэр Windows в режиме **повышенной безопасности**, а затем включите следующие входящие правила: **сетевой доступ COM+ (DCOM-IN)** и все правила в **группе удаленного управления журналом событий**.

## <a name="step-2-prepare-a-replica-server-on-premises-to-on-premises-replication"></a>Шаг 2. Подготовка сервера-реплики (для репликации между локальными средами)
Этот шаг можно пропустить, если репликация выполняется в Azure.

Мы рекомендуем настроить один узел Hyper-V в качестве сервера восстановления, на который будет выполнена репликация фиктивной виртуальной машины для проверки пропускной способности.  Это действие можно пропустить, но тогда вы не сможете измерить пропускную способность.

1. Если вы хотите использовать в качестве реплики узел кластера, настройте брокер реплики Hyper-V следующим образом.

   * В **диспетчере серверов** откройте **диспетчер отказоустойчивости кластеров**.
   * Подключитесь к кластеру, выделите имя кластера и щелкните **Действия** > **Настроить роль**. Откроется мастер обеспечения высокой доступности.
   * В разделе **Выбрать роль** щелкните **Брокер реплики Hyper-V**. В окне мастера введите **NetBIOS-имя** и **IP-адрес**, которые будут использоваться в качестве точки подключения к кластеру (точки доступа клиента). Мастер настроит **брокер реплики Hyper-V** и сообщит имя точки доступа клиента. Запишите это имя.
   * Убедитесь, что роль брокера реплики Hyper-V успешно подключается к сети и может переключаться при сбое между всеми узлами кластера. Для этого щелкните правой кнопкой мыши роль, выберите пункт **Переместить**, а затем нажмите кнопку **Выбрать узел**. Выберите узел, нажав кнопку **ОК**.
   * Если вы используете проверку подлинности на основе сертификатов, убедитесь, что для всех узлов кластера и всех точек доступа клиента установлены сертификаты.
2. Включите сервер-реплику следующим образом.

   * Если вы используете кластер, откройте диспетчер сбоя кластера, подключитесь к кластеру и щелкните **Роли** > выберите роль > **Настройки репликации** > **Enable this cluster as a Replica server** (Использовать этот кластер как сервер-реплику). При использовании кластера в качестве реплики вам также потребуется настроить роль брокера реплики Hyper-V для кластера на основном сайте.
   * Если вы используете автономный сервер, откройте диспетчер Hyper-V. На панели **Действия** щелкните **Параметры Hyper-V** для нужного сервера и в разделе **Конфигурация репликации** щелкните **Enable this computer as a Replica server** (Использовать этот компьютер как сервер-реплику).
3. Настройте проверку подлинности следующим образом.

   * В разделе **Проверка подлинности и порты** выберите способ проверки подлинности сервера-источника и порты проверки подлинности. Если вы используете сертификат, нажмите кнопку **Выбрать сертификат** и укажите нужный сертификат. Если основные узлы и узлы восстановления Hyper-V находятся в одном домене или доверенных доменах, используйте Kerberos. Для разных доменов или для развертывания рабочей группы используйте сертификаты.
   * В разделе **Авторизация и хранилище** разрешите отправку данных репликации на этот сервер-реплику для **любого** прошедшего проверку сервера (источника).

     ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image1.png)
   * Запустите команду **netsh http show servicestate**, чтобы проверить выполнение прослушивателя для указанных протокола и порта.  
4. Настройте правила брандмауэров. Во время установки Hyper-V создаются правила брандмауэра, разрешающие трафик на порты по умолчанию (HTTPS на порт 443, Kerberos на порт 80). Включите эти правила:
  - Проверка подлинности сертификата в кластере (443): ``Get-ClusterNode | ForEach-Object {Invoke-command -computername \$\_.name -scriptblock {Enable-Netfirewallrule -displayname "Hyper-V Replica HTTPS Listener (TCP-In)"}}``
  - Проверка подлинности Kerberos в кластере (80): ``Get-ClusterNode | ForEach-Object {Invoke-command -computername \$\_.name -scriptblock {Enable-Netfirewallrule -displayname "Hyper-V Replica HTTP Listener (TCP-In)"}}``
  - Проверка подлинности сертификата на изолированном сервере: ``Enable-Netfirewallrule -displayname "Hyper-V Replica HTTPS Listener (TCP-In)"``
  - Проверка подлинности Kerberos на изолированном сервере: ``Enable-Netfirewallrule -displayname "Hyper-V Replica HTTP Listener (TCP-In)"``

## <a name="step-3-run-the-capacity-planner-tool"></a>Шаг 3. Запуск планировщика ресурсов
Когда вы завершите подготовку основного сайта и настройку сервера восстановления, можно запустить средство.

1. [скачать](https://www.microsoft.com/download/details.aspx?id=39057) the tool from the Microsoft скачать Center.
2. Запустите средство на одном из основных серверов (или одном из узлов в составе основного кластера). Щелкните правой кнопкой мыши файл .exe, а затем выберите **Запуск от имени администратора**.
3. В пункте **Перед началом работы** укажите период сбора данных. Для обеспечения репрезентативности данных мы рекомендуем запускать средство в рабочее время. Если вы проверяете только сетевое подключение, будет достаточно собирать данные в течение одной минуты.

    ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image2.png)
4. В разделе **Primary site details** (Сведения об основном сайте) укажите имя сервера или полное доменное имя для изолированного узла. Для кластера укажите полное доменное имя точки доступа клиента, имя кластера или любой узел кластера. Затем нажмите кнопку **Далее**. Средство автоматически определяет имя сервера, на котором оно запущено. Средство создает список виртуальных машин, которые можно отслеживать на указанных серверах.

    ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image3.png)
5. Если вы выполняете репликацию в Azure или дополнительный центр обработки данных, а сервер-реплика еще не настроен, в разделе **Replica Site Details** (Сведения о сайте-реплике) установите флажок **Skip tests involving replica site** (Пропускать тесты, включающие сайт-реплику). Если вы выполняете репликацию в дополнительный центр обработки данных и реплика уже настроена, введите в поле **Server name (or) Hyper-V Replica Broker CAP** (Имя сервера (или) точка доступа клиента брокера реплики Hyper-V) полное доменное имя автономного сервера или точку доступа клиента кластера.

    ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image4.png)
6. В разделе **Extended Replica Details** (Сведения о расширенной репликации) установите флажок **Skip the tests involving Extended Replica site** (Пропускать тесты, включающие сайт-реплику расширенной репликации). Служба Site Recovery не поддерживает эти тесты.
7. В разделе **Choose VMs to Replicate** (Выбор виртуальных машин для репликации) средство подключается к серверу или кластеру и отображает все виртуальные машины и диски, запущенные на сервере-источнике, используя параметры со страницы **Primary Site Details** (Сведения об основном сайте). Виртуальные машины, которые уже включены в репликацию или которые не работают, отображены не будут. Выберите виртуальные машины, для которых вы хотите собрать метрики. Если выбрать виртуальные жесткие диски, данные будут автоматически собраны и для виртуальных машин.
8. Если вы уже настроили сервер-реплику или кластер, в разделе **Сведения о сети** укажите примерную расчетную пропускную способность глобальной сети между основным сайтом и сайтом-репликой, а также выберите сертификаты, если вы настроили проверку подлинности с их использованием.

    ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image5.png)
9. В разделе **Сводка** проверьте все параметры и нажмите кнопку **Далее**, чтобы начать сбор метрик. Ход выполнения и текущее состояние будут отображаться на странице **Оценка ресурсов** . Когда средство завершит работу, щелкните **Просмотреть отчет** и изучите результаты. По умолчанию отчеты и журналы хранятся в папке **%systemdrive%\Users\Public\Documents\Capacity Planner**.

   ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image6.png)

## <a name="step-4-interpret-the-results"></a>Шаг 4. Интерпретация результатов

Ниже перечислены важные метрики. На остальные метрики можно не обращать внимания. Они не имеют отношения к Site Recovery.

### <a name="on-premises-to-on-premises-replication"></a>Репликация между локальными средами

* Влияние репликации на вычисления и память основного узла
* Влияние репликации на дисковое пространство и операции ввода-вывода на основном узле восстановления
* Общая пропускная способность, необходимая для разностной репликации (Мбит/с)
* Наблюдаемая пропускная способность между основным узлом и узлом восстановления (Мбит/с)
* Предложение оптимального количества активных параллельных передач между двумя узлами или кластерами

### <a name="on-premises-to-azure-replication"></a>Репликация из локальной среды в Azure

* Влияние репликации на вычисления и память основного узла
* Влияние репликации на дисковое пространство и операции ввода-вывода на основном узле
* Общая пропускная способность, необходимая для разностной репликации (Мбит/с)

## <a name="more-resources"></a>Дополнительные ресурсы
* Дополнительные сведения о планировщике см. в документации из пакета загрузки.
* Пошаговое руководство по использованию планировщика доступно в [блоге TechNet](http://blogs.technet.com/b/keithmayer/archive/2014/02/27/guided-hands-on-lab-capacity-planner-for-windows-server-2012-hyper-v-replica.aspx)Кита Майера (Keith Mayer).
* [Ознакомьтесь с результатами](site-recovery-performance-and-scaling-testing-on-premises-to-on-premises.md) нашей проверки производительности при репликации Hyper-V между локальными средами.

## <a name="next-steps"></a>Дальнейшие действия

После завершения планирования ресурсов можно начать развертывание Site Recovery.

* [Репликация виртуальных машин Hyper-V из облачных сред VMM в Azure](site-recovery-vmm-to-azure.md)
* [Репликация виртуальных машин Hyper-V (без VMM) в Azure](site-recovery-hyper-v-site-to-azure.md)
* [Репликация виртуальных машин Hyper-V между сайтами VMM](site-recovery-vmm-to-vmm.md)
