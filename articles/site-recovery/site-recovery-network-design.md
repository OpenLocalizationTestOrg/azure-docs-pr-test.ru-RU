---
title: "aaaDesigning сетевой инфраструктуры для аварийного восстановления | Документы Microsoft"
description: "В этой статье обсуждаются особенности проектирования сети для Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: prateek9us
manager: jwhit
editor: 
ms.assetid: ce787731-d930-4f00-a309-e2fbc2e1f53b
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/20/2017
ms.author: pratshar
ms.openlocfilehash: 18bafa1b8b334192bfaf2f4aeba9f090011041ce
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="designing-your-network-for-disaster-recovery"></a>Проектирование сети для аварийного восстановления

Эта статья является направленным tooIT специалистов, ответственных за разработку, реализации и поддержки непрерывности бизнес-процессов и аварийного восстановления (BCDR) инфраструктуры и желающим toosupport tooleverage восстановления сайта Microsoft Azure (ASR) и повысить свои службы BCDR. В этой статье рассматриваются практические рекомендации по организации сети для сайта аварийного восстановления, размещенного в Azure или локально. 

## <a name="overview"></a>Обзор
[Восстановление сайта Azure (ASR)](https://azure.microsoft.com/services/site-recovery/) — это служба Microsoft Azure, которая организует hello защиты и восстановления виртуализованных приложений для аварийного восстановления (BCDR) непрерывности бизнеса. Данный документ является предполагаемым tooguide hello модуль чтения процессе hello проектирование сетей hello, посвященных архитектуры диапазоны IP-адресов и подсетей в hello аварийного восстановления, при репликации виртуальных машин (ВМ) с помощью Site Recovery.

Кроме того в этой статье показано, как Site Recovery включает проектирование и реализация службы BCDR toosupport многосайтового виртуального центра обработки данных во время тестирования или аварии.

В мире, где все ожидает подключения к 24/7, является более важным, чем когда-либо tookeep инфраструктуры и приложений запуска. Hello непрерывности и аварийного восстановления (BCDR) предназначен toorestore сбой компонентов, hello организации можно быстро возобновить нормальную работу. Разработка toodeal стратегии аварийного восстановления с событиями, скорее всего, разумеется очень сложной. Это происходит из-за сложности специфические toohello предсказания будущих hello, особенно в отношении события tooimprobable и hello высокой стоимости tooprovide достаточно меры защиты от вирусные эпидемии далеко идущими.

Для планирования BCDR очень важно, чтобы целевое время восстановления (RTO) и целевая точка восстановления (RPO) были определены в рамках плана аварийного восстановления. Если случится hello клиента центра обработки данных, с помощью Azure Site Recovery, клиенты могут быстро (низкий RTO) подключить их реплицированных виртуальных машин, размещенных в hello вторичный центр обработки данных или Microsoft Azure с минимальной потерей данных (низкий RPO).

Переход на другой ресурс стало возможным благодаря ASR изначально копирует указанный виртуальных машин из hello первичных данных центра toohello вторичный центр обработки данных или tooAzure (в зависимости от сценария hello), которое периодически обновляет hello реплик. При планировании инфраструктуры следует рассматривать проект сети как потенциально уязвимое место, которое может помешать достичь целевых значений RTO и RPO, установленных в компании.  

При планировании Администраторы toodeploy решение аварийного восстановления, одним из ключевых вопроса hello в их умы является, как hello виртуальная машина может быть недоступна после завершения отработки отказа hello. ASR позволяет toowhich hello администратора toochoose hello сети виртуальной машины будет подключенных tooafter перехода на другой ресурс. Если основной сайт hello Azure или на локальном сайте, управляемых на сервере VMM, то это достигается с помощью сопоставления сети. Дополнительные сведения о [сетевое сопоставление в Azure tooAzure аварийного восстановления](site-recovery-network-mapping-azure-to-azure.md) и [сетевое сопоставление из VMM](site-recovery-network-mapping.md)


При проектировании сети hello для восстановления сайта hello, Здравствуйте, администратор имеет два варианта:

* Используйте другой диапазон IP-адресов для сети hello на сайте восстановления. В этом случае hello виртуальной машины после отработки отказа будет получить новый IP-адрес и Здравствуйте, администратор будет иметь toodo обновления DNS. 
* Используйте же диапазон IP-адресов для сети hello на сайте восстановления hello. В некоторых случаях администраторы предпочитают tooretain hello IP-адресов, которые у них на первичном сайте hello даже после отработки отказа hello. В обычном случае администратор будет иметь tooupdate hello маршруты tooindicate hello новое расположение hello IP-адресов. Однако в hello сценарии развертывания растяжением подсети между основной hello и сайте восстановления hello, сохраняя hello IP-адресов для виртуальных машин hello становится привлекательным вариантом. Растяжение подсеть из локальной сети tooan сеть Azure или между двумя сетями Azure невозможна.  

При планировании Администраторы toodeploy решение аварийного восстановления, одним из ключевых вопроса hello в уме является, как приложения hello будут доступны после завершения отработки отказа hello. Современные приложения зависят от почти всегда сети степень toosome физически перемещение службы с одного узла tooanother представляет сетевой запрос. Решения аварийного восстановления могут устранить эту проблему двумя основными способами. Первый подход Hello — toomaintain фиксированные IP-адреса. Несмотря на перемещение служб hello и серверы, находящиеся в разных местах размещения hello приложения используют hello конфигурацию IP-адресов с ними toohello новое расположение. Hello втором подходе полностью изменение hello IP-адреса во время перехода hello в hello восстановленного сайта. Каждый подход имеет несколько вариантов реализации, которые приведены ниже.

При проектировании сети hello для восстановления сайта hello, Здравствуйте, администратор имеет два варианта:

## <a name="option-1-retain-ip-addresses"></a>Вариант 1. Сохранение IP-адресов
С точки зрения процесса аварийного восстановления с помощью фиксированные IP-адреса появляется tooimplement простой метод toobe hello, но имеет ряд потенциальных проблем, что на практике hello наименее часто встречающиеся подход. Azure Site Recovery предоставляет возможность hello tooretain hello IP-адреса во всех сценариях. Перед принимается решение tooretain IP, соответствующие следует уделять особое внимание toohello ограничения, который устанавливает на hello возможности перехода на другой ресурс. Рассмотрим hello факторы, которые могут помочь toomake, решение tooretain IP-адреса или нет. Это можно сделать двумя способами: с помощью растянутой подсети или полной отработкой отказа в подсеть.

### <a name="stretched-subnet"></a>Растянутая подсеть
Здесь hello подсети становятся доступными одновременно в основном сервере и расположения аварийного восстановления. Проще говоря это означает, можно переместить сервер и его IP (уровень 3) конфигурации toohello второй узел и hello сети будет перенаправлять hello трафика toohello новое расположение автоматически. Это тривиальные toodeal с со стороны сервера, но имеет ряд проблем:

* С точки зрения уровня 2 (уровень канала передачи данных) требуется сетевое оборудование, которое может управлять растянутой виртуальной локальной сетью, но это больше не проблема, так как это оборудование общедоступно. Hello второй и более сложно проблема заключается в, распределяя hello потенциальных домен сбоя виртуальной ЛС hello расширится tooboth узлов, по сути становится единая точка отказа. Хотя это маловероятно, может произойти сетевая буря, которую не удастся изолировать. Мы встречали различные мнения о такой проблеме и видели множество успешных решений, в том числе "мы никогда не будем использовать эту топологию здесь".
* При использовании Microsoft Azure как hello сайт аварийного восстановления, растянутой подсети невозможна.

### <a name="subnet-failover"></a>Отработка отказа подсети
Это возможно tooimplement подсети отработки отказа tooobtain hello преимущества решения подсети hello растягивается описанный выше, без растягивая hello подсети на нескольких сайтах. В этом сценарии любая отдельно взятая подсеть будет присутствовать на сайте 1 или 2, но никогда на обоих сайтах одновременно. В порядке toomaintain hello пространство IP-адресов в событии hello перехода на другой ресурс, можно упорядочить tooprogrammatically для подсетей hello маршрутизатора инфраструктуры toomove hello из tooanother один сайт. В hello сценария отработки отказа, что и подсети для перемещения hello связанные защищенных виртуальных машин. Hello основным недостатком toothis подход заключается в hello в случае сбоя, у вас есть toomove hello всей подсети, что может быть в порядке, но это может повлиять на вопросы гранулярности hello отработки отказа.

Давайте рассмотрим, как вымышленной предприятия с именем Contoso — может tooreplicate расположения восстановления tooa виртуальных машин во время отработки отказа hello всей подсети. Сначала рассмотрим как Contoso — может toomanage свои подсети репликацию виртуальных машин между двумя локальными расположения, а затем мы обсудим, как работает отработка отказа, когда [Azure используется в качестве аварийного восстановления hello](#failover-to-azure).

#### <a name="failover-from-on-premises-tooazure"></a>Отработка отказа из локальной tooAzure 
Восстановление сайта Azure (ASR) позволяет Azure toobe используется в качестве аварийного восстановления для виртуальных машин.  

Рассмотрим следующий сценарий. Вымышленная компания Woodgrove Bank размещает свои бизнес-приложения в локальной инфраструктуре, а мобильные приложения — в Azure. Подключение между виртуальными машинами Woodgrove Bank в Azure и локальными серверами обеспечивается через подключение VPN или ExpressRoute типа "сеть — сеть". S2S VPN позволяет банка Woodgrove Bank виртуальной сети в Azure toobe рассматривать как расширение банка Woodgrove Bank в локальной сети. Это взаимодействие обеспечивается VPN-подключением типа "сеть — сеть" между границей Woodgrove Bank и виртуальной сетью Azure. Woodgrove предполагает toouse ASR tooreplicate его нагрузок tooanother основной регион Azure регион Azure. Этот параметр соответствует потребностям hello Woodgrove, который хочет экономичный вариант аварийного восстановления и может toostore данные в общедоступном облаке сред. Woodgrove имеет toodeal с приложениями и конфигурации, которые зависят от жестко IP-адресов, таким образом они имели на требование tooretain IP-адреса для своих приложений после сбоя tooanother область в Azure.

Woodgrove решил tooassign IP-адресов в Azure tooits ресурсы IP-адресов диапазона (172.16.1.0/24, 172.16.2.0/24).

Для возможности tooreplicate toobe Woodgrove его tooAzure виртуальных машин, сохраняя IP-адреса hello, виртуальной сети Azure должен toobe создан. Его необходимо расширение hello в локальной сети, чтобы приложения могли переключаться между hello локального сайта tooAzure без проблем. Azure позволяет tooadd сайт сайт, а также точка сеть VPN подключения toohello виртуальных сетей, созданные в Azure. При настройке подключения сеть сеть, сеть Azure позволяет вам tooroute трафика toohello локально (Azure вызывает его локальной сети) только в том случае, если диапазон IP-адресов hello отличается от диапазона IP-адресов локальной для hello, поскольку Azure не поддержки растяжения подсетей.  Это означает, что при наличии 192.168.1.0/24 подсети в локальной среде, вы не можете добавить 192.168.1.0/24 локальную сеть в hello сети Azure. Ожидается, так как Azure не знает, что отсутствуют активные ВМ в подсети hello и подсети hello создается только в целях аварийного восстановления. не должно конфликтовать toobe может toocorrectly маршрутизацию сетевого трафика за пределами Azure hello подсетей в сети hello и hello локальной сети.

![Перед выполнением отработки отказа подсети](./media/site-recovery-network-design/network-design7.png)

Перед выполнением отработки отказа

toohelp Woodgrove выполнить их бизнес-требованиям, то необходимо hello tooimplement следующие процессы:

* Создание дополнительной сети, назовем его восстановления сети, где будут создаваться hello отработка отказа виртуальных машин.
* tooensure сохранения hello IP-адрес для виртуальной Машины после отработки отказа, go toohello вкладке "Настройка" в свойствах виртуальной Машины, указать hello же IP-адреса, hello виртуальной Машины используется локальная и нажмите Сохранить. При переключении hello ВМ Azure Site Recovery будет назначать hello, предоставляемые IP toohello виртуальной машины.

![Свойства сети](./media/site-recovery-network-design/network-design8.png)

После запуска отработки отказа hello hello виртуальные машины создаются в сети восстановления с IP-адресом hello требуемого hello, toothis сетевого подключения может быть установлено с помощью [tooVnet виртуальной сети подключения](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md). При необходимости это действие можно включить в скрипт.  Как уже говорилось в предыдущем разделе hello об отработке отказа в подсети, даже в случае, когда hello tooAzure отработки отказа маршруты бы toobe соответствующим образом изменены tooreflect, 192.168.1.0/24 теперь перемещен tooAzure.

![После выполнения отработки отказа подсети](./media/site-recovery-network-design/network-design9.png)

После выполнения отработки отказа

При отсутствии «Сети Azure», как показано на приведенном выше рисунке hello. Можно создать узел toosite VPN-подключение между «Первичный сайт» и «Сети восстановления» после отработки отказа hello.  


#### <a name="failover-tooa-secondary-on-premises-site"></a>Tooa отработки отказа вторичная локального сайта
Рассмотрим сценарий, где следует сохранить hello IP-адрес каждой из виртуальных машин hello и hello отработку отказа совместно выполнены подсети. Hello основной сайт имеет приложений, работающих в подсети 192.168.1.0/24. В случае перехода на другой ресурс hello всех hello виртуальных машин, которые являются частью этой подсети отказа toohello восстановления сайта и сохранить их IP-адреса. Маршруты будут иметь toobe соответствующим образом изменить tooreflect hello фактов, все виртуальные машины hello, принадлежащий toosubnet 192.168.1.0/24 теперь перемещен toohello восстановления сайта.

В hello следующей иллюстрации hello направляет между первичным сайтом и сайтом восстановления, третий узел и первичного сайта и третий сайтом и сайтом восстановления будет иметь toobe соответствующим образом изменены.

Следующие изображения Hello показывает подсетей hello перед выполнением отработки отказа hello. Подсети 192.168.0.1/24 активен на hello первичном сайте до отработки отказа hello и становится активной для hello сайт восстановления после отработки отказа hello

![Перед выполнением отработки отказа](./media/site-recovery-network-design/network-design2.png)

Перед выполнением отработки отказа

Hello рисунке ниже показаны сети и подсети после отработки отказа.

![После выполнения отработки отказа](./media/site-recovery-network-design/network-design3.png)

После выполнения отработки отказа

На вторичном сайте является локальным, и вы используете toomanage сервера VMM и когда Включение защиты для конкретной виртуальной машины, ASR выделит сетевых ресурсов, toohello после рабочего процесса в соответствии с:

* ASR выделяет IP-адреса для каждого сетевого интерфейса на виртуальной машине hello hello статических IP-адресов определенные на соответствующее сетевое hello для каждого экземпляра System Center VMM.
* Если Здравствуйте, администратор определяет пул для сети hello на сайте восстановления hello как же IP-адресов, hello пула IP-адресов из hello будет выделить сети на первичном сайте hello при выделении виртуальной машины реплики ASR для hello IP адрес toohello hello hello же IP-адрес, что и основная виртуальная машина hello.  Hello IP-адрес будет зарезервирован в VMM, но не задано как IP-адрес отработки отказа на узле Hyper-v hello. IP отработки отказа на узле Hyper-v задается непосредственно перед hello перехода на другой ресурс.


Если hello IP-адрес недоступен, ASR будет выделить некоторые другие доступные IP-адрес из пула IP-адресов hello определенные.

После приветствия включена защита виртуальных Машин можно использовать следующий образец скрипта tooverify hello IP-адреса, занятый toohello виртуальной машины. Привет, IP-адрес будет задать как отработки отказа IP-адрес и назначенный toohello виртуальной Машины во время отработки отказа hello:

        $vm = Get-SCVirtualMachine -Name <VM_NAME>
        $na = $vm[0].VirtualNetworkAdapters>
        $ip = Get-SCIPAddress -GrantToObjectID $na[0].id
        $ip.address  

> [!NOTE]
> В сценарии hello, где виртуальные машины используют DHCP Управление IP-адресами hello полностью находится за пределами hello управление ASR. Администратор имеет tooensure, который можно использовать hello DHCP обслуживанием hello IP-адреса сервера на сайте восстановления hello из hello того же диапазона, что и первичный сайт hello.
>
>



## <a name="option-2-changing-ip-addresses"></a>Вариант 2. Изменение IP-адресов
Такой подход кажется toobe hello наиболее распространенных основании мы видели. Он принимает форму hello изменение hello IP-адреса каждой виртуальной машины, в которой участвует в hello перехода на другой ресурс. Недостаток данного подхода требует входящих сетевых too'learn hello ", на IPx приложения hello сейчас находится на IPy. Даже если IPx и IPy логические имена, DNS-записей, обычно имеют toobe были изменены или сброшены во всей сети hello и кэшированных записей в таблицах сети имеют toobe обновляется или записаны на диск, поэтому простоя может возникнуть в зависимости от того, как инфраструктура DNS hello имеет были созданы. Эти проблемы можно устранить, используя низкие значения TTL в случае hello приложений интрасети и [диспетчера трафика Azure с помощью ASR](http://azure.microsoft.com/blog/2015/03/03/reduce-rto-by-using-azure-traffic-manager-with-azure-site-recovery/) для Интернета приложений на основе.

### <a name="changing-hello-ip-addresses---illustration"></a>Изменение IP-адресов hello - иллюстрации
Рассмотрим сценарий hello которых вы планируете toouse другой IP-адресов между основной hello и hello восстановления сайтов. В следующий пример hello у нас также есть третий узел, из которой возможен hello приложения, размещенные на сайте основного сервера или восстановления.

![Другой IP-адрес — до отработки отказа](./media/site-recovery-network-design/network-design10.png)


На приведенном выше рисунке hello существуют некоторые приложения, размещенные в подсети 192.168.1.0/24 подсети на первичном сайте hello и их настроенных toocome вверх на сайте восстановления hello в подсети 172.16.1.0/24 после отработки отказа. VPN-подключения/сетевые маршруты были настроены так, чтобы все три объекта могли иметь доступ друг к другу.

Как рисунок hello ниже показан после отработки отказа одного или нескольких приложений они будут восстановлены в подсети восстановления hello. В этом случае мы не ограниченного toofailover hello всей подсети в hello то же время. Изменение не требуется tooreconfigure маршруты VPN-подключения или сети. Отработка отказа и некоторые обновления DNS обеспечат доступность приложений. Если hello DNS является настроенным tooallow динамические обновления hello виртуальных машин будет регистрировать себя, используя новый IP-адрес hello после их запуска после отработки отказа.

![Другой IP-адрес — после отработки отказа](./media/site-recovery-network-design/network-design11.png)


После того как виртуальная машина реплики hello сбое может IP-адреса, которые не hello же, как IP-адрес hello hello основной виртуальной машины. Виртуальные машины обновит hello DNS-сервер, в которой они работают после их запуска. DNS-записи обычно имеют toobe были изменены или сброшены во всей сети hello и кэшированных записей в таблицах сети имеют toobe обновляется или сохранения данных, поэтому это не так часто toobe столкнулись с временем простоя, пока эти изменения выполняются. Эту проблему можно решить следующим образом.

* Использование низких значений TTL для приложений интрасети.
* Использование диспетчера трафика Azure с ASR для интернет-приложений.
* С помощью следующих hello скрипта в рамках восстановления планирование tooensure DNS-сервер hello tooupdate своевременное обновление (hello сценария не требуется Если настроен hello динамической регистрации DNS)

        param(
        string]$Zone,
        [string]$name,
        [string]$IP
        )
        $Record = Get-DnsServerResourceRecord -ZoneName $zone -Name $name
        $newrecord = $record.clone()
        $newrecord.RecordData[0].IPv4Address  =  $IP
        Set-DnsServerResourceRecord -zonename $zone -OldInputObject $record -NewInputObject $Newrecord

### <a name="changing-hello-ip-addresses--dr-tooazure"></a>Изменение hello IP-адресов — tooAzure аварийного восстановления
Hello [установки инфраструктуры сети Microsoft Azure в качестве аварийного восстановления](http://azure.microsoft.com/blog/2014/09/04/networking-infrastructure-setup-for-microsoft-azure-as-a-disaster-recovery-site/) в блоге описывает, каким образом toosetup hello требуется сетевой инфраструктуры Azure при сохранении IP-адресов не является обязательной. Он начинается с описания приложения hello и затем найдите в как toosetup сети в локальной среде и на Azure и завершении при помощи как toodo тестовую отработку отказа и запланированной отработки отказа.

## <a name="next-steps"></a>Дальнейшие действия
[Дополнительные сведения](site-recovery-vmm-to-vmm.md#prepare-for-network-mapping) Site Recovery сопоставление исходной и целевой сетей при первичном сайте используется toomanage hello сервера VMM.
