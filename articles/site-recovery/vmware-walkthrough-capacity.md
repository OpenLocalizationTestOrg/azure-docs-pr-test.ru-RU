---
title: "Планирование ресурсов и масштабирования для репликации из VMware в Azure с помощью Azure Site Recovery | Документы Майкрософт"
description: "Используйте эту статью, чтобы запланировать ресурсы и масштабирование при репликации виртуальных машин VMware в Azure с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 0a1cd8eb-a8f7-4228-ab84-9449e0b2887b
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 06/27/2017
ms.author: rayne
ms.openlocfilehash: f5b334e594e3d002e1862b25c4faba7163efa7d4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="step-3-plan-capacity-and-scaling-for-vmware-to-azure-replication"></a><span data-ttu-id="5b79b-103">Шаг 3. Планирование ресурсов и масштабирования для репликации из VMware в Azure</span><span class="sxs-lookup"><span data-stu-id="5b79b-103">Step 3: Plan capacity and scaling for VMware to Azure replication</span></span>

<span data-ttu-id="5b79b-104">Используйте данную статью, чтобы выяснить, как планировать ресурсы и масштабирование при репликации локальных физических серверов и виртуальных машин VMware в Azure с помощью [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5b79b-104">Use this article to figure out planning for capacity and scaling, when replicating on-premises VMware VMs and physical servers to Azure with [Azure Site Recovery](site-recovery-overview.md).</span></span>

<span data-ttu-id="5b79b-105">Комментарии или вопросы можно добавить в конце этой статьи или на [форуме по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="5b79b-105">Post comments and questions at the bottom of this article, or on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

## <a name="how-do-i-start-capacity-planning"></a><span data-ttu-id="5b79b-106">С чего начать планирование загрузки?</span><span class="sxs-lookup"><span data-stu-id="5b79b-106">How do I start capacity planning?</span></span>

<span data-ttu-id="5b79b-107">Необходимо собрать сведения о среде репликации, а затем запланировать ресурсы, используя эти сведения и учитывая рекомендации, приведенные в этой статье.</span><span class="sxs-lookup"><span data-stu-id="5b79b-107">You gather information about your replication environment, and then plan capacity using this information, together with the considerations highlighted in this article.</span></span>


## <a name="gather-information"></a><span data-ttu-id="5b79b-108">Сбор сведений</span><span class="sxs-lookup"><span data-stu-id="5b79b-108">Gather information</span></span>

1. <span data-ttu-id="5b79b-109">Скачайте [инструмент Deployment Planner](https://aka.ms/asr-deployment-planner) для репликации из VMware.</span><span class="sxs-lookup"><span data-stu-id="5b79b-109">Download the [Deployment Planner tool](https://aka.ms/asr-deployment-planner) for VMware replication.</span></span>
2. <span data-ttu-id="5b79b-110">[Прочитайте эту статью](site-recovery-deployment-planner.md), чтобы понять, как работает данный инструмент.</span><span class="sxs-lookup"><span data-stu-id="5b79b-110">[Read this article](site-recovery-deployment-planner.md) to understand how to run the tool.</span></span>
3. <span data-ttu-id="5b79b-111">С помощью этого инструмента собираются данные о виртуальных машинах (совместимых и несовместимых), дисках на каждой виртуальной машине и обновлениях данных на каждом диске.</span><span class="sxs-lookup"><span data-stu-id="5b79b-111">Using the tool you gather information about compatible and incompatible VMs, disks per VM, and data churn per disk.</span></span> <span data-ttu-id="5b79b-112">Инструмент также проверяет соответствие требованиях к пропускной способности сети и инфраструктуре Azure для успешной репликации и тестовой отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="5b79b-112">The tool also covers network bandwidth requirements, and the Azure infrastructure needed for successful replication and test failover.</span></span>

## <a name="replication-considerations"></a><span data-ttu-id="5b79b-113">Рекомендации относительно репликации</span><span class="sxs-lookup"><span data-stu-id="5b79b-113">Replication considerations</span></span>

<span data-ttu-id="5b79b-114">Перед началом развертывания ознакомьтесь с этими рекомендациями:</span><span class="sxs-lookup"><span data-stu-id="5b79b-114">Note these considerations before you start deployment:</span></span>

<span data-ttu-id="5b79b-115">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="5b79b-115">**Component**</span></span> | <span data-ttu-id="5b79b-116">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="5b79b-116">**Details**</span></span> |
--- | --- | ---
<span data-ttu-id="5b79b-117">**Репликация**</span><span class="sxs-lookup"><span data-stu-id="5b79b-117">**Replication**</span></span> | <span data-ttu-id="5b79b-118">**Максимальный объем ежедневно изменяемых данных.** Защищенный компьютер может использовать только один сервер обработки, а объем ежедневно изменяемых данных на одном сервере обработки может составлять не более 2 ТБ.</span><span class="sxs-lookup"><span data-stu-id="5b79b-118">**Maximum daily change rate:** A protected machine can only use one process server, and a single process server can handle a daily change rate up to 2 TB.</span></span> <span data-ttu-id="5b79b-119">В связи с этим 2 ТБ — максимальный объем ежедневно изменяемых данных, поддерживаемый защищенным компьютером.</span><span class="sxs-lookup"><span data-stu-id="5b79b-119">Thus 2 TB is the maximum daily data change rate that’s supported for a protected machine.</span></span><br/><br/> <span data-ttu-id="5b79b-120">**Максимальная пропускная способность.** Реплицированный компьютер может принадлежать одной учетной записи хранения в Azure.</span><span class="sxs-lookup"><span data-stu-id="5b79b-120">**Maximum throughput:** A replicated machine can belong to one storage account in Azure.</span></span> <span data-ttu-id="5b79b-121">Стандартная учетная запись хранения может обрабатывать не более 20 000 запросов в секунду. Мы рекомендуем не превышать количество в 20 000 операций ввода-вывода в секунду на исходном компьютере.</span><span class="sxs-lookup"><span data-stu-id="5b79b-121">A standard storage account can handle a maximum of 20,000 requests per second, and we recommend that you keep the number of input/output operations per second (IOPS) across a source machine to 20,000.</span></span> <span data-ttu-id="5b79b-122">Например, если есть исходный компьютер с 5 дисками, на каждом из которых выполняется по 120 операций ввода-вывода в секунду (размером в 8 КБ), то этот показатель не будет превышать ограничение в 500 операций ввода-вывода в секунду на диск в Azure.</span><span class="sxs-lookup"><span data-stu-id="5b79b-122">For example, if you have a source machine with 5 disks, and each disk generates 120 IOPS (8K size) on the source machine, then it will be within the Azure per disk IOPS limit of 500.</span></span> <span data-ttu-id="5b79b-123">Число необходимых учетных записей хранения определяется путем деления общего числа операций ввода-вывода для исходного компьютера на 20 000.</span><span class="sxs-lookup"><span data-stu-id="5b79b-123">(The number of storage accounts required is equal to the total source machine IOPS, divided by 20,000.)</span></span>

## <a name="configuration-server-capacity"></a><span data-ttu-id="5b79b-124">Емкость сервера конфигурации</span><span class="sxs-lookup"><span data-stu-id="5b79b-124">Configuration server capacity</span></span>

<span data-ttu-id="5b79b-125">Сервер конфигурации должен поддерживать суммарный объем ежедневно изменяемых данных для всех рабочих нагрузок, которые выполняются на защищенных компьютерах. Кроме того, он должен обладать достаточной пропускной способностью для непрерывной репликации данных в службу хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="5b79b-125">The configuration server should be able to handle the daily change rate capacity across all workloads running on protected machines, and needs sufficient bandwidth to continuously replicate data to Azure Storage.</span></span>

<span data-ttu-id="5b79b-126">Мы рекомендуем разместить сервер конфигурации в той же сети и в том же сегменте локальной сети, что и компьютеры, которые необходимо защитить.</span><span class="sxs-lookup"><span data-stu-id="5b79b-126">As a best practice, locate the configuration server on the same network and LAN segment as the machines you want to protect.</span></span> <span data-ttu-id="5b79b-127">Его можно разместить и в другой сети при наличии у компьютеров, которые нужно защитить, доступа к этой сети третьего уровня.</span><span class="sxs-lookup"><span data-stu-id="5b79b-127">It can be located on a different network, but machines you want to protect should have layer 3 network visibility to it.</span></span>

## <a name="sizing-recommendations"></a><span data-ttu-id="5b79b-128">Рекомендации относительно размеров</span><span class="sxs-lookup"><span data-stu-id="5b79b-128">Sizing recommendations</span></span>

<span data-ttu-id="5b79b-129">В следующей таблице приводятся рекомендации относительно размеров, исходя из мощности ЦП.</span><span class="sxs-lookup"><span data-stu-id="5b79b-129">The table summarizes sizing recommendations based on CPU.</span></span>

<span data-ttu-id="5b79b-130">**ЦП**</span><span class="sxs-lookup"><span data-stu-id="5b79b-130">**CPU**</span></span> | <span data-ttu-id="5b79b-131">**Память**</span><span class="sxs-lookup"><span data-stu-id="5b79b-131">**Memory**</span></span> | <span data-ttu-id="5b79b-132">**Размер диска кэша**</span><span class="sxs-lookup"><span data-stu-id="5b79b-132">**Cache disk size**</span></span> | <span data-ttu-id="5b79b-133">**Частота изменения данных**</span><span class="sxs-lookup"><span data-stu-id="5b79b-133">**Data change rate**</span></span> | <span data-ttu-id="5b79b-134">**Защищенные компьютеры**</span><span class="sxs-lookup"><span data-stu-id="5b79b-134">**Protected machines**</span></span>
--- | --- | --- | --- | ---
<span data-ttu-id="5b79b-135">8 виртуальных ЦП (2 сокета * 4 ядра с частотой 2,5 ГГц)</span><span class="sxs-lookup"><span data-stu-id="5b79b-135">8 vCPUs (2 sockets * 4 cores @ 2.5 gigahertz [GHz])</span></span> | <span data-ttu-id="5b79b-136">16 ГБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-136">16 GB</span></span> | <span data-ttu-id="5b79b-137">300 ГБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-137">300 GB</span></span> | <span data-ttu-id="5b79b-138">500 ГБ или менее</span><span class="sxs-lookup"><span data-stu-id="5b79b-138">500 GB or less</span></span> | <span data-ttu-id="5b79b-139">Репликация не более 100 компьютеров</span><span class="sxs-lookup"><span data-stu-id="5b79b-139">Replicate less than 100 machines.</span></span>
<span data-ttu-id="5b79b-140">12 виртуальных ЦП (2 сокета * 6 ядер с частотой 2,5 ГГц)</span><span class="sxs-lookup"><span data-stu-id="5b79b-140">12 vCPUs (2 sockets * 6 cores @ 2.5 GHz)</span></span> | <span data-ttu-id="5b79b-141">18 ГБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-141">18 GB</span></span> | <span data-ttu-id="5b79b-142">600 ГБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-142">600 GB</span></span> | <span data-ttu-id="5b79b-143">От 500 ГБ до 1 ТБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-143">500 GB to 1 TB</span></span> | <span data-ttu-id="5b79b-144">Репликация от 100 до 150 компьютеров</span><span class="sxs-lookup"><span data-stu-id="5b79b-144">Replicate between 100-150 machines.</span></span>
<span data-ttu-id="5b79b-145">16 виртуальных ЦП (2 сокета * 8 ядер с частотой 2,5 ГГц)</span><span class="sxs-lookup"><span data-stu-id="5b79b-145">16 vCPUs (2 sockets * 8 cores @ 2.5 GHz)</span></span> | <span data-ttu-id="5b79b-146">32 ГБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-146">32 GB</span></span> | <span data-ttu-id="5b79b-147">1 TБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-147">1 TB</span></span> | <span data-ttu-id="5b79b-148">От 1 ТБ до 2 ТБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-148">1 TB to 2 TB</span></span> | <span data-ttu-id="5b79b-149">Репликация от 150 до 200 компьютеров</span><span class="sxs-lookup"><span data-stu-id="5b79b-149">Replicate between 150-200 machines.</span></span>
<span data-ttu-id="5b79b-150">Разверните другой сервер обработки</span><span class="sxs-lookup"><span data-stu-id="5b79b-150">Deploy another process server</span></span> | | | <span data-ttu-id="5b79b-151">Более 2 ТБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-151">> 2 TB</span></span> | <span data-ttu-id="5b79b-152">Разверните дополнительные серверы обработки при репликации более 200 компьютеров или объеме ежедневно изменяемых данных более 2 ТБ.</span><span class="sxs-lookup"><span data-stu-id="5b79b-152">Deploy additional process servers if you're replicating more than 200 machines, or if the daily data change rate exceeds 2 TB.</span></span>

<span data-ttu-id="5b79b-153">Описание</span><span class="sxs-lookup"><span data-stu-id="5b79b-153">Where:</span></span>

* <span data-ttu-id="5b79b-154">Для каждого исходного компьютера настраивается 3 диска объемом по 100 ГБ каждый.</span><span class="sxs-lookup"><span data-stu-id="5b79b-154">Each source machine is configured with 3 disks of 100 GB each.</span></span>
* <span data-ttu-id="5b79b-155">Чтобы измерить показатели диска кэша, мы использовали хранилище для тестирования производительности с 8 дисками SAS с частотой вращения шпинделя 10 000 об/мин в конфигурации RAID 10.</span><span class="sxs-lookup"><span data-stu-id="5b79b-155">We used benchmarking storage of 8 SAS drives of 10 K RPM, with RAID 10, for cache disk measurements.</span></span>

## <a name="process-server-capacity"></a><span data-ttu-id="5b79b-156">Емкость сервера обработки</span><span class="sxs-lookup"><span data-stu-id="5b79b-156">Process server capacity</span></span>


<span data-ttu-id="5b79b-157">Сервер обработки получает данные репликации с защищенных компьютеров и оптимизирует их путем кэширования, сжатия и шифрования,</span><span class="sxs-lookup"><span data-stu-id="5b79b-157">The process server receives replication data from protected machines, and optimizes it with caching, compression, and encryption.</span></span> <span data-ttu-id="5b79b-158">а затем отправляет их в Azure.</span><span class="sxs-lookup"><span data-stu-id="5b79b-158">Then it sends the data to Azure.</span></span>

- <span data-ttu-id="5b79b-159">Сервер обработки должен располагать достаточными ресурсами для выполнения этих задач.</span><span class="sxs-lookup"><span data-stu-id="5b79b-159">The process server machine should have sufficient resources to perform these tasks.</span></span>
- <span data-ttu-id="5b79b-160">Первый сервер обработки по умолчанию устанавливается на сервере конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5b79b-160">The first process server is installed by default on the configuration server.</span></span> <span data-ttu-id="5b79b-161">Для масштабирования среды можно развернуть дополнительные серверы обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-161">You can deploy additional process servers to scale your environment.</span></span>
- <span data-ttu-id="5b79b-162">Сервер обработки использует дисковый кэш.</span><span class="sxs-lookup"><span data-stu-id="5b79b-162">The process server uses a disk-based cache.</span></span> <span data-ttu-id="5b79b-163">Чтобы обеспечить обработку хранящихся изменений данных в случае возникновения узкого места в сети или сбоя, установите отдельный диск кэша объемом 600 ГБ и более.</span><span class="sxs-lookup"><span data-stu-id="5b79b-163">Use a separate cache disk of 600 GB or more to handle data changes stored in the event of a network bottleneck or outage.</span></span>
- <span data-ttu-id="5b79b-164">Если необходимо защитить более 200 компьютеров или объем ежедневно изменяемых данных составляет более 2 ТБ, для обработки такой нагрузки репликации можно добавить серверы обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-164">If you need to protect more than 200 machines, or the daily change rate is greater than 2 TB, you can add process servers to handle the replication load.</span></span> <span data-ttu-id="5b79b-165">Для развертывания можно выполнить следующее.</span><span class="sxs-lookup"><span data-stu-id="5b79b-165">To scale out, you can:</span></span>
    - <span data-ttu-id="5b79b-166">Увеличить количество серверов конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5b79b-166">Increase the number of configuration servers.</span></span> <span data-ttu-id="5b79b-167">Например, с помощью двух серверов конфигурации можно защитить до 400 компьютеров.</span><span class="sxs-lookup"><span data-stu-id="5b79b-167">For example, you can protect up to 400 machines with two configuration servers.</span></span>
    - <span data-ttu-id="5b79b-168">Добавить дополнительные серверы обработки и использовать их для обработки трафика вместо сервера конфигурации (или вместе с ним).</span><span class="sxs-lookup"><span data-stu-id="5b79b-168">Add more process servers, and use these to handle traffic instead of (or in addition to) the configuration server.</span></span>


### <a name="example-process-server-scaling"></a><span data-ttu-id="5b79b-169">Пример масштабирования серверов обработки</span><span class="sxs-lookup"><span data-stu-id="5b79b-169">Example process server scaling</span></span>

<span data-ttu-id="5b79b-170">В таблице ниже описан следующий сценарий.</span><span class="sxs-lookup"><span data-stu-id="5b79b-170">The following table describes a scenario in which:</span></span>

* <span data-ttu-id="5b79b-171">Вы не планируете использовать сервер конфигурации в качестве сервера обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-171">You're not planning to use the configuration server as a process server.</span></span>
* <span data-ttu-id="5b79b-172">Вы настроили дополнительный сервер обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-172">You've set up an additional process server.</span></span>
* <span data-ttu-id="5b79b-173">Вы настроили для защищенных виртуальных машин дополнительный сервер обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-173">You've configured protected virtual machines to use the additional process server.</span></span>
* <span data-ttu-id="5b79b-174">Для каждого защищенного исходного компьютера настраивается три диска объемом 100 ГБ каждый.</span><span class="sxs-lookup"><span data-stu-id="5b79b-174">Each protected source machine is configured with three disks of 100 GB each.</span></span>

<span data-ttu-id="5b79b-175">**Сервер конфигурации**</span><span class="sxs-lookup"><span data-stu-id="5b79b-175">**Configuration server**</span></span> | <span data-ttu-id="5b79b-176">**Дополнительный сервер обработки**</span><span class="sxs-lookup"><span data-stu-id="5b79b-176">**Additional process server**</span></span> | <span data-ttu-id="5b79b-177">**Размер диска кэша**</span><span class="sxs-lookup"><span data-stu-id="5b79b-177">**Cache disk size**</span></span> | <span data-ttu-id="5b79b-178">**Частота изменения данных**</span><span class="sxs-lookup"><span data-stu-id="5b79b-178">**Data change rate**</span></span> | <span data-ttu-id="5b79b-179">**Защищенные компьютеры**</span><span class="sxs-lookup"><span data-stu-id="5b79b-179">**Protected machines**</span></span>
--- | --- | --- | --- | ---
<span data-ttu-id="5b79b-180">8 виртуальных ЦП (2 сокета * 4 ядра с частотой 2,5 ГГц), 16 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="5b79b-180">8 vCPUs (2 sockets * 4 cores @ 2.5 GHz), 16 GB memory</span></span> | <span data-ttu-id="5b79b-181">4 виртуальных ЦП (2 сокета * 2 ядра с частотой 2,5 ГГц), 8 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="5b79b-181">4 vCPUs (2 sockets * 2 cores @ 2.5 GHz), 8 GB memory</span></span> | <span data-ttu-id="5b79b-182">300 ГБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-182">300 GB</span></span> | <span data-ttu-id="5b79b-183">250 ГБ или менее</span><span class="sxs-lookup"><span data-stu-id="5b79b-183">250 GB or less</span></span> | <span data-ttu-id="5b79b-184">Вы можете реплицировать до 85 компьютеров.</span><span class="sxs-lookup"><span data-stu-id="5b79b-184">Replicate 85 or fewer machines.</span></span>
<span data-ttu-id="5b79b-185">8 виртуальных ЦП (2 сокета * 4 ядра с частотой 2,5 ГГц), 16 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="5b79b-185">8 vCPUs (2 sockets * 4 cores @ 2.5 GHz), 16 GB memory</span></span> | <span data-ttu-id="5b79b-186">8 виртуальных ЦП (2 сокета * 4 ядра с частотой 2,5 ГГц), 12 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="5b79b-186">8 vCPUs (2 sockets * 4 cores @ 2.5 GHz), 12 GB memory</span></span> | <span data-ttu-id="5b79b-187">600 ГБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-187">600 GB</span></span> | <span data-ttu-id="5b79b-188">От 250 ГБ до 1 ТБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-188">250 GB to 1 TB</span></span> | <span data-ttu-id="5b79b-189">Репликация от 85 до 150 компьютеров</span><span class="sxs-lookup"><span data-stu-id="5b79b-189">Replicate between 85-150 machines.</span></span>
<span data-ttu-id="5b79b-190">12 виртуальных ЦП (2 сокета * 6 ядер с частотой 2,5 ГГц), 18 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="5b79b-190">12 vCPUs (2 sockets * 6 cores @ 2.5 GHz), 18 GB memory</span></span> | <span data-ttu-id="5b79b-191">12 виртуальных ЦП (2 сокета * 6 ядер с частотой 2,5 ГГц), 24 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="5b79b-191">12 vCPUs (2 sockets * 6 cores @ 2.5 GHz) 24 GB memory</span></span> | <span data-ttu-id="5b79b-192">1 TБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-192">1 TB</span></span> | <span data-ttu-id="5b79b-193">От 1 ТБ до 2 ТБ</span><span class="sxs-lookup"><span data-stu-id="5b79b-193">1 TB to 2 TB</span></span> | <span data-ttu-id="5b79b-194">Репликация от 150 до 225 компьютеров</span><span class="sxs-lookup"><span data-stu-id="5b79b-194">Replicate between 150-225 machines.</span></span>

<span data-ttu-id="5b79b-195">Способ масштабирования серверов будет зависеть от выбора модели увеличения масштаба и развертывания.</span><span class="sxs-lookup"><span data-stu-id="5b79b-195">The way in which you scale your servers depends on your preference for a scale-up or scale-out model.</span></span>  <span data-ttu-id="5b79b-196">Вы можете увеличить масштаб, развернув несколько современных серверов конфигурации и обработки, или выполнить развертывание, развернув несколько серверов с меньшим объемом ресурсов.</span><span class="sxs-lookup"><span data-stu-id="5b79b-196">You scale up by deploying a few high-end configuration and process servers, or scale out by deploying more servers with fewer resources.</span></span> <span data-ttu-id="5b79b-197">Например, чтобы защитить 220 компьютеров, можно применить одну из следующих рекомендаций.</span><span class="sxs-lookup"><span data-stu-id="5b79b-197">For example, if you need to protect 220 machines, you could do either of the following:</span></span>

* <span data-ttu-id="5b79b-198">Настроить сервер конфигурации с 12 виртуальными ЦП и памятью объемом 18 ГБ, дополнительный сервер обработки с 12 виртуальными ЦП и памятью объемом 24 ГБ,</span><span class="sxs-lookup"><span data-stu-id="5b79b-198">Set up the configuration server with 12 vCPU, 18 GB of memory, and an additional process server with 12 vCPU, 24 GB of memory.</span></span> <span data-ttu-id="5b79b-199">а также защищенные компьютеры для использования только дополнительного сервера обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-199">Configure protected machines to use the additional process server only.</span></span>
* <span data-ttu-id="5b79b-200">Настроить два сервера конфигурации (8 виртуальных ЦП и 16 ГБ ОЗУ в каждом), два дополнительных сервера обработки (8 виртуальных ЦП в одном и 4 виртуальных ЦП, что позволит обрабатывать 220 (135 + 85) компьютеров)</span><span class="sxs-lookup"><span data-stu-id="5b79b-200">Set up two configuration servers (2 x 8 vCPU, 16 GB RAM) and two additional process servers (1 x 8 vCPU and 4 vCPU x 1 to handle 135 + 85 [220] machines).</span></span> <span data-ttu-id="5b79b-201">и указать, что защищенные компьютеры должны использовать только дополнительные серверы обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-201">Configure protected machines to use the additional process servers only.</span></span>

## <a name="deploy-additional-process-servers"></a><span data-ttu-id="5b79b-202">Развертывание дополнительных серверов обработки</span><span class="sxs-lookup"><span data-stu-id="5b79b-202">Deploy additional process servers</span></span>

<span data-ttu-id="5b79b-203">Выполните эти инструкции, чтобы настроить дополнительный сервер обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-203">Follow these instructions to set up an additional process server.</span></span> <span data-ttu-id="5b79b-204">После настройки сервера необходимо перевести исходные компьютеры на его использование.</span><span class="sxs-lookup"><span data-stu-id="5b79b-204">After setting up the server, you migrate source machines to use it.</span></span>

1. <span data-ttu-id="5b79b-205">Выберите **Site Recovery servers** (Серверы Site Recovery), выберите сервер конфигурации и щелкните **+Process Server** (Добавить сервер обработки).</span><span class="sxs-lookup"><span data-stu-id="5b79b-205">In **Site Recovery servers**, click the configuration server > **+Process Server**.</span></span>
2. <span data-ttu-id="5b79b-206">В поле **Тип сервера** щелкните **Process server (on-premises)** (Сервер обработки (локальный)).</span><span class="sxs-lookup"><span data-stu-id="5b79b-206">In **Server type**, click **Process server (on-premises)**.</span></span>

    ![Сервер обработки](./media/vmware-walkthrough-capacity/migrate-ps2.png)
3. <span data-ttu-id="5b79b-208">Скачайте файл единой установки Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="5b79b-208">Download the Site Recovery Unified Setup file.</span></span>
4. <span data-ttu-id="5b79b-209">Запустите его, чтобы установить сервер обработки и зарегистрировать его в хранилище.</span><span class="sxs-lookup"><span data-stu-id="5b79b-209">Run setup to install the process server, and register it in the vault.</span></span>
5. <span data-ttu-id="5b79b-210">На странице **Перед началом работы** выберите **Add additional process servers to scale out deployment** (Добавить дополнительные серверы обработки для масштабирования развертывания).</span><span class="sxs-lookup"><span data-stu-id="5b79b-210">In **Before you begin**, select **Add additional process servers to scale out deployment**.</span></span>
6. <span data-ttu-id="5b79b-211">На странице **Сведения о сервере конфигурации** укажите IP-адрес сервера конфигурации и парольную фразу.</span><span class="sxs-lookup"><span data-stu-id="5b79b-211">In **Configuration Server Details**, specify the IP address of the configuration server, and the passphrase.</span></span> <span data-ttu-id="5b79b-212">Если у вас нет парольной фразы, то для ее получения выполните на сервере конфигурации команду **[папка_установки_Site_Recovery]\home\sysystems\bin\genpassphrase.exe –n**.</span><span class="sxs-lookup"><span data-stu-id="5b79b-212">If you don't have the passphrase, get it by running **[SiteRecoveryInstallationFolder]\home\sysystems\bin\genpassphrase.exe –n** on the configuration server.</span></span>

    ![Сервер конфигурации](./media/vmware-walkthrough-capacity/add-ps2.png)
7. <span data-ttu-id="5b79b-214">Выполните остальные шаги так же, как и при настройке сервера конфигурации.</span><span class="sxs-lookup"><span data-stu-id="5b79b-214">Complete the rest of setup in the same way you did when you set up the configuration server.</span></span>

### <a name="migrate-machines-to-use-the-process-server"></a><span data-ttu-id="5b79b-215">Перенос компьютеров для использования сервера обработки</span><span class="sxs-lookup"><span data-stu-id="5b79b-215">Migrate machines to use the process server</span></span>

1. <span data-ttu-id="5b79b-216">Выберите **Параметры** > **Site Recovery servers** (Серверы Site Recovery), выберите сервер конфигурации и щелкните **Серверы обработки**.</span><span class="sxs-lookup"><span data-stu-id="5b79b-216">In **Settings** > **Site Recovery servers**, click the configuration server > **Process servers**.</span></span>
2. <span data-ttu-id="5b79b-217">Щелкните используемый сервер обработки правой кнопкой мыши и выберите **Переключить**.</span><span class="sxs-lookup"><span data-stu-id="5b79b-217">Right-click the process server currently in use > **Switch**.</span></span>

    ![Переключение сервера обработки](./media/vmware-walkthrough-capacity/migrate-ps3.png)
3. <span data-ttu-id="5b79b-219">В поле **Выбор целевого сервера обработки** выберите сервер обработки, который нужно использовать, и укажите виртуальные машины, с которыми он будет работать.</span><span class="sxs-lookup"><span data-stu-id="5b79b-219">In **Select target process server**, select the process server you want to use, and select the VMs that the server will handle.</span></span>
4. <span data-ttu-id="5b79b-220">Щелкните значок сведений.</span><span class="sxs-lookup"><span data-stu-id="5b79b-220">Click the information icon.</span></span> <span data-ttu-id="5b79b-221">Чтобы помочь принять решение о скачивании, отображается средний объем свободного места, требуемый для репликации каждой выбранной виртуальной машины на новом сервере обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-221">To help you make load decisions, the average space that's needed to replicate each selected VM to the new process server is displayed.</span></span>
5. <span data-ttu-id="5b79b-222">Щелкните флажок, чтобы начать репликацию на новом сервере обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-222">Click the check mark to start replication to the new process server.</span></span>

## <a name="control-network-bandwidth"></a><span data-ttu-id="5b79b-223">Управление пропускной способностью сети</span><span class="sxs-lookup"><span data-stu-id="5b79b-223">Control network bandwidth</span></span>

<span data-ttu-id="5b79b-224">После того, как [инструмент Deployment Planner](site-recovery-deployment-planner.md) рассчитает пропускную способность, необходимую для репликации (начальной и разностной), вы можете управлять объемом пропускной способности, используемой для репликации. Для этого существует несколько способов:</span><span class="sxs-lookup"><span data-stu-id="5b79b-224">After you run [the Deployment Planner tool](site-recovery-deployment-planner.md) to calculate the bandwidth you need for replication (the initial replication and then delta), you can control the amount of bandwidth used for replication using a couple of options:</span></span>

* <span data-ttu-id="5b79b-225">**Регулирование пропускной способности**. Трафик VMware, который реплицируется в Azure, проходит через определенный сервер обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-225">**Throttle bandwidth**: VMware traffic that replicates to Azure goes through a specific process server.</span></span> <span data-ttu-id="5b79b-226">Пропускную способность можно регулировать на компьютерах, которые служат серверами обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-226">You can throttle bandwidth on the machines running as process servers.</span></span>
* <span data-ttu-id="5b79b-227">**Изменение пропускной способности.** Пропускную способность, используемую для репликации, можно изменить с помощью нескольких разделов реестра:</span><span class="sxs-lookup"><span data-stu-id="5b79b-227">**Influence bandwidth**: You can influence the bandwidth used for replication by using a couple of registry keys:</span></span>
  * <span data-ttu-id="5b79b-228">Значение реестра **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\UploadThreadsPerVM** задает количество потоков, используемых для передачи данных диска (для начальной или разностной репликации данных).</span><span class="sxs-lookup"><span data-stu-id="5b79b-228">The **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\UploadThreadsPerVM** registry value specifies the number of threads that are used for data transfer (initial or delta replication) of a disk.</span></span> <span data-ttu-id="5b79b-229">Если задать высокое значение, пропускная способность сети, используемая для репликации, увеличивается.</span><span class="sxs-lookup"><span data-stu-id="5b79b-229">A higher value increases the network bandwidth used for replication.</span></span>
  * <span data-ttu-id="5b79b-230">Значение **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\DownloadThreadsPerVM** задает количество потоков, используемых для передачи данных при восстановлении размещения.</span><span class="sxs-lookup"><span data-stu-id="5b79b-230">The **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\DownloadThreadsPerVM** specifies the number of threads used for data transfer during failback.</span></span>

### <a name="throttle-bandwidth"></a><span data-ttu-id="5b79b-231">Регулирование пропускной способности</span><span class="sxs-lookup"><span data-stu-id="5b79b-231">Throttle bandwidth</span></span>

1. <span data-ttu-id="5b79b-232">Откройте оснастку MMC в службе архивации Azure на компьютере, который выступает в качестве сервера обработки.</span><span class="sxs-lookup"><span data-stu-id="5b79b-232">Open the Azure Backup MMC snap-in on the machine acting as the process server.</span></span> <span data-ttu-id="5b79b-233">По умолчанию ярлык для службы архивации расположен на рабочем столе или в папке C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.</span><span class="sxs-lookup"><span data-stu-id="5b79b-233">By default, a shortcut for Backup is available on the desktop, or in the following folder: C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.</span></span>
2. <span data-ttu-id="5b79b-234">В оснастке щелкните **Изменить свойства**.</span><span class="sxs-lookup"><span data-stu-id="5b79b-234">In the snap-in, click **Change Properties**.</span></span>
3. <span data-ttu-id="5b79b-235">На вкладке **Регулирование** установите флажок **Разрешить регулирование уровня использования пропускной способности канала для операций резервного копирования**.</span><span class="sxs-lookup"><span data-stu-id="5b79b-235">On the **Throttling** tab, select **Enable internet bandwidth usage throttling for backup operations**.</span></span>
4. <span data-ttu-id="5b79b-236">Задайте ограничения для рабочего и нерабочего времени.</span><span class="sxs-lookup"><span data-stu-id="5b79b-236">Set the limits for work and non-work hours.</span></span> <span data-ttu-id="5b79b-237">Допустимы значения в диапазоне от 512 Кбит/с до 102 Мбит/с.</span><span class="sxs-lookup"><span data-stu-id="5b79b-237">Valid ranges are from 512 Kbps to 102 Mbps per second.</span></span>

    ![Регулирование](./media/vmware-walkthrough-capacity/throttle2.png)

<span data-ttu-id="5b79b-239">Чтобы настроить регулирование, можно также использовать командлет [Set-OBMachineSetting](https://technet.microsoft.com/library/hh770409.aspx) .</span><span class="sxs-lookup"><span data-stu-id="5b79b-239">You can also use the [Set-OBMachineSetting](https://technet.microsoft.com/library/hh770409.aspx) cmdlet to set throttling.</span></span> <span data-ttu-id="5b79b-240">Рассмотрим пример:</span><span class="sxs-lookup"><span data-stu-id="5b79b-240">Here's a sample:</span></span>

    $mon = [System.DayOfWeek]::Monday
    $tue = [System.DayOfWeek]::Tuesday
    Set-OBMachineSetting -WorkDay $mon, $tue -StartWorkHour "9:00:00" -EndWorkHour "18:00:00" -WorkHourBandwidth  (512*1024) -NonWorkHourBandwidth (2048*1024)

<span data-ttu-id="5b79b-241">**Set-OBMachineSetting -NoThrottle** указывает, что регулирование не требуется.</span><span class="sxs-lookup"><span data-stu-id="5b79b-241">**Set-OBMachineSetting -NoThrottle** indicates that no throttling is required.</span></span>

### <a name="influence-network-bandwidth-for-a-vm"></a><span data-ttu-id="5b79b-242">Изменение пропускной способности сети для виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="5b79b-242">Influence network bandwidth for a VM</span></span>

1. <span data-ttu-id="5b79b-243">В реестре виртуальной машины перейдите в раздел **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication**.</span><span class="sxs-lookup"><span data-stu-id="5b79b-243">In registry of the VM, go to **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication**.</span></span>
   * <span data-ttu-id="5b79b-244">Чтобы изменить скорость передачи данных при репликации диска, задайте новое значение для раздела **UploadThreadsPerVM** или создайте его, если он еще не существует.</span><span class="sxs-lookup"><span data-stu-id="5b79b-244">To influence the bandwidth traffic on a replicating disk, modify the value of **UploadThreadsPerVM**, or create the key if it doesn't exist.</span></span>
   * <span data-ttu-id="5b79b-245">Чтобы изменить скорость передачи данных при восстановлении размещения из Azure, задайте новое значение для раздела **DownloadThreadsPerVM**.</span><span class="sxs-lookup"><span data-stu-id="5b79b-245">To influence the bandwidth for failback traffic from Azure, modify the value of **DownloadThreadsPerVM**.</span></span>
2. <span data-ttu-id="5b79b-246">Значение по умолчанию — 4.</span><span class="sxs-lookup"><span data-stu-id="5b79b-246">The default value is 4.</span></span> <span data-ttu-id="5b79b-247">В сети со значительным избыточным резервом эти разделы реестра необходимо изменить.</span><span class="sxs-lookup"><span data-stu-id="5b79b-247">In an overprovisioned network, these registry keys should be modified.</span></span> <span data-ttu-id="5b79b-248">Максимальное значение — 32.</span><span class="sxs-lookup"><span data-stu-id="5b79b-248">The maximum is 32.</span></span> <span data-ttu-id="5b79b-249">Следите за трафиком для оптимизации значения.</span><span class="sxs-lookup"><span data-stu-id="5b79b-249">Monitor traffic to optimize the value.</span></span>




## <a name="next-steps"></a><span data-ttu-id="5b79b-250">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="5b79b-250">Next steps</span></span>

<span data-ttu-id="5b79b-251">Перейдите к статье [Шаг 4. Планирование сетей для репликации физического сервера в Azure](vmware-walkthrough-network.md).</span><span class="sxs-lookup"><span data-stu-id="5b79b-251">Go to [Step 4: Plan networking](vmware-walkthrough-network.md).</span></span>
