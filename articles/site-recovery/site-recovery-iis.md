---
title: "aaaReplicate IIS многоуровневых приложений на основе веб-приложения с помощью Azure Site Recovery | Документы Microsoft"
description: "В этой статье описывается, как tooreplicate IIS веб-фермы виртуальных машин с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: nsoneji
manager: gauravd
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: nisoneji
ms.openlocfilehash: 1974265b3cb05f6dc57049876306d2e08424bb97
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="replicate-a-multi-tier-iis-based-web-application-using-azure-site-recovery"></a>Репликация многоуровневого веб-приложения на основе IIS с помощью Azure Site Recovery

## <a name="overview"></a>Обзор


Программное обеспечение — hello подсистемы производительность бизнеса в организации. Разные веб-приложения используются для различных целей. Важнейшими для деятельности организации являются приложения обработки платежных ведомостей, финансовые приложения и сайты для обслуживания клиентов. Будет ли это важно для hello организации toohave их вверх и работают в постоянно tooprevent снижение производительности и более важно предотвратить повреждение toohello изображения фирменной символики организации hello.

Критическое веб-приложений, обычно настраиваются как многоуровневых приложений с hello web, базы данных и приложения на разных уровнях. Помимо распределены на различных уровнях, hello приложения также могут использовать несколько серверов в каждый уровень tooload баланс hello трафик. Кроме того hello сопоставления между различными уровнями и на веб-сервере hello может основываться на статические IP-адреса. При отработке отказа некоторые из этих сопоставлений потребуется toobe обновлен, особенно, если имеется несколько веб-сайтов настроены на веб-сервере hello. В случае веб-приложений с помощью протокола SSL привязки сертификата потребуется обновить toobe.

Включает в себя методы традиционных по репликации на основе восстановления резервное копирование из различных файлов конфигурации, параметры реестра, привязки, пользовательских компонентов (COM или .NET), содержимое и также сертификаты и восстановления файлов hello через набор действий. Эти методы весьма трудоемки, к тому же они могут приводить к ошибкам и не являются масштабируемыми. Он является, например, возможность легко tooforget создает резервную копию сертификата и оставить с выбором, но не toobuy новые сертификаты для hello сервера после отработки отказа.

Это решение хорошо аварийного восстановления, следует разрешить моделирования планов восстановления вокруг hello выше архитектур сложных приложений и также имеют hello возможность tooadd настроенные действия toohandle для сопоставлений между различными уровнями таким образом обеспечивая одним щелчком, что снимок решения в событии hello аварии начальные tooa снижение RTO.


В этой статье описывается, как на основе tooprotect IIS веб-приложения с помощью [Azure Site Recovery](site-recovery-overview.md). В этой статье рассматриваются рекомендации по репликации три уровня IIS на основе tooAzure приложения web, инструкции аварийного восстановления, и способы tooAzure приложения hello отработки отказа.


## <a name="prerequisites"></a>Предварительные требования

Прежде чем начать, убедитесь, что вы понимаете следующие hello:

1. [Репликация tooAzure виртуальной машины](site-recovery-vmware-to-azure.md)
1. Как слишком[проектирования сети восстановления](site-recovery-network-design.md)
1. [Выполнив tooAzure теста отработки отказа](./site-recovery-test-failover-to-azure.md)
1. [Выполнив tooAzure отработки отказа](site-recovery-failover.md)
1. Как слишком[репликации контроллера домена](site-recovery-active-directory.md)
1. Как слишком[репликации SQL Server](site-recovery-sql.md)

## <a name="deployment-patterns"></a>Модели развертывания
Веб-приложение IIS на основе обычно соответствует одному из следующих схем развертывания hello:

**Модель развертывания 1.** Веб-ферма на основе IIS с маршрутизацией запросов приложений (ARR), сервером IIS и Microsoft SQL Server.

![Модель развертывания](./media/site-recovery-iis/deployment-pattern1.png)

**Модель развертывания 2.** Веб-ферма на основе IIS с маршрутизацией запросов приложений (ARR), сервером IIS, сервером приложений и Microsoft SQL Server.


![Модель развертывания](./media/site-recovery-iis/deployment-pattern2.png)

## <a name="site-recovery-support"></a>Поддержка Site Recovery

Создание виртуальных машин VMware этой статьи с сервера IIS версии 7.5 в Windows Server 2012 R2 Enterprise с целью hello использовались. Как репликация восстановления сайтов не зависит от приложения, рекомендации hello приведены здесь ожидаемый toohold в следующих сценариях также и для другой версии IIS.

### <a name="source-and-target"></a>Исходный и целевой объект

**Сценарий** | **tooa вторичного сайта** | **tooAzure**
--- | --- | ---
**Hyper-V** | Да | Да
**VMware** | Да | Да
**Физический сервер** | Нет | Да

## <a name="replicate-virtual-machines"></a>Репликация виртуальных машин

Выполните [в этом руководстве](site-recovery-vmware-to-azure.md) toostart репликации tooAzure все hello IIS web фермы виртуальных машин.

Если используется статический IP-адрес, а затем укажите IP-адрес hello требуется hello tootake виртуальной машины в hello [ **целевой IP-адрес** ](./site-recovery-replicate-vmware-to-azure.md#view-and-manage-vm-properties) в вычислительных и сетевых параметров.

![Целевой IP-адрес](./media/site-recovery-active-directory/dns-target-ip.png)


## <a name="creating-a-recovery-plan"></a>Создание плана восстановления

План восстановления позволяет последовательность отработки отказа hello различных уровней многоуровневого приложения, таким образом, поддерживая согласованность приложения. При создании плана восстановления многоуровневые веб-приложение, выполните hello шаги, описанные ниже.  Дополнительные сведения см. в статье [Создание планов восстановления](./site-recovery-create-recovery-plans.md).

### <a name="adding-virtual-machines-toofailover-groups"></a>Добавление групп toofailover виртуальные машины
Типичные многоуровневого веб-приложения IIS будет состоять из уровня базы данных с виртуальных машин, веб-уровень hello круглую сервером IIS и уровень приложений SQL. Добавьте все эти виртуальные машины toodifferent группы на основании уровень ниже. Дополнительные сведения см. в разделе [Настройка плана восстановления](site-recovery-runbook-automation.md#customize-the-recovery-plan).

1. Создайте план восстановления. Добавление виртуальных машин уровня hello базы данных в группу 1 tooensure их завершения работы последнего и первого активным.

1. Добавьте hello приложения уровня виртуальных машин в группе 2, таким образом, что они запускаются после была помещена hello уровня базы данных.

1. Добавление hello web уровня виртуальных машин в группа 3 таким образом, что они запускаются после была помещена уровня приложения hello.

1. Добавьте в группу 4 виртуальных машин для балансировки нагрузки, таким образом, что они запускаются после была помещена hello веб-уровня.


### <a name="adding-scripts-toohello-recovery-plan"></a>Добавление плана восстановления toohello сценариев
Может потребоваться toodo некоторых операций на виртуальных машинах Azure post отработки отказа или тестовой отработки отказа toomake IIS веб-фермы функции hello правильно. Можно автоматизировать операцию отработки отказа hello как обновление DNS-запись, изменение привязки сайта, в строке подключения, добавив соответствующие сценарии в плане восстановления hello, как показано ниже. Дополнительные сведения см. в разделе [Добавление скриптов](./site-recovery-create-recovery-plans.md#add-scripts).

#### <a name="dns-update"></a>Обновление DNS
Если hello DNS настроен для динамического обновления DNS, обновите виртуальные машины обычно hello DNS с hello новый IP-адрес после их запуска. Tooadd явные шаг tooupdate DNS, с hello новый IP-адреса виртуальных машин hello затем добавить это [скрипт tooupdate IP-адрес в DNS](https://aka.ms/asr-dns-update) как действие post в группы плана восстановления.  

#### <a name="connection-string-in-an-applications-webconfig"></a>Строка подключения в файле web.config приложения
Строка подключения Hello указывает hello базы данных, веб-сайт hello обменивается данными с.

Если строка подключения hello содержит имя hello hello базы данных виртуальной машины, никакие дополнительные действия будут необходимые после отработки отказа и hello приложение сможет получить доступ tooautomatically взаимодействовать toohello DB. Кроме того, если сохраняется hello IP-адрес для виртуальной машины hello базы данных, он не будет необходимости строка подключения tooupdate hello. Если строка подключения hello ссылается toohello базы данных виртуальной машины с помощью IP-адрес, его потребуется toobe обновлен после отработки отказа. Например:  Hello ниже строка подключения указывает toohello DB с IP-адресом 127.0.1.2

        <?xml version="1.0" encoding="utf-8"?>
        <configuration>
        <connectionStrings>
        <add name="ConnStringDb1" connectionString="Data Source= 127.0.1.2\SqlExpress; Initial Catalog=TestDB1;Integrated Security=False;" />
        </connectionStrings>
        </configuration>

Можно обновить hello строку подключения в веб-уровень, добавив [скрипт обновления подключения IIS](https://aka.ms/asr-update-webtier-script-classic) после 3 группы в плане восстановления hello.

#### <a name="site-bindings-for-hello-application"></a>Привязки узла для приложения hello
Каждый сайт состоит из привязки сведения, включающие hello тип привязки, hello IP-адрес, по которой hello сервера IIS ожидает передачи данных toohello запросов для сайта hello, номер порта hello и приветствия имен узлов для сайта hello. Во время перехода на другой ресурс hello эти привязки может потребоваться toobe обновляются при изменении в hello IP-адреса, связанного с ними.

> [!NOTE]
>
> Если помеченные «все неназначенные» для привязки сайта hello, как показано в приведенном ниже примере hello, не потребуется tooupdate этой привязки после отработки отказа. Кроме того, если hello IP-адреса, связанного с узлом не меняется после отработки отказа, hello привязки сайта требуется не будут обновлены (хранения hello IP-адреса зависит от архитектуры сети hello и подсети назначены toohello основной и восстановления сайтов и таким образом может или не может быть возможно в вашей организации.)

![Привязка SSL](./media/site-recovery-iis/sslbinding.png)

Если IP-адрес hello связаны с сайтом, необходимо будет tooupdate все привязки сайта hello новый IP-адрес. Можно добавить [скрипт обновления уровня IIS Web](https://aka.ms/asr-web-tier-update-runbook-classic) после группа 3 в привязки сайта hello toochange плана восстановления.


#### <a name="update-load-balancer-ip-address"></a>Обновление IP-адреса балансировщика нагрузки
При наличии маршрутизации запросов приложений виртуальной машины, добавьте [сценария отработки отказа IIS ARR](https://aka.ms/asr-iis-arrtier-failover-script-classic) после группу 4 tooupdate hello IP-адрес.

#### <a name="hello-ssl-cert-binding-for-an-https-connection"></a>Hello привязки сертификата SSL для https-соединения
Веб-сайтов может иметь связанный SSL-сертификат, помогающая для обеспечения безопасного взаимодействия между веб-сервере hello и браузер пользователя hello. Если веб-сайта hello https-соединения и связанные https сайта привязки toohello IP-адрес hello сервера IIS с помощью привязки сертификата SSL, новую привязку сайта потребуется toobe добавлена cert hello hello, IP-адреса виртуальной машины hello IIS учет перехода на другой ресурс.

Hello SSL-сертификат может быть выдан для-

) полное доменное имя hello hello веб-сайта<br>
b) имя сервера, hello hello<br>
c) сертификатом с подстановочными символами для hello доменного имени<br>
d) IP-адрес — Если выполняется hello IP-адрес сервера IIS hello hello SSL-сертификат, другой toobe требованиям сертификата SSL выдан для hello hello IP-адрес сервера IIS на hello Azure site и дополнительные привязки SSL для этого сертификата потребуется создать toobe. Таким образом он является использование рекомендуется toonot выдан сертификат SSL для IP. Этот вариант используется не часто, а вскоре он будет объявлен устаревшим в соответствии с изменениями CA/Browser Forum.

#### <a name="update-hello-dependency-between-hello-web-and-hello-application-tier"></a>Обновление hello зависимость между веб-hello и уровня приложения hello
При наличии определенных зависимость приложения по IP-адресу hello hello виртуальных машин, tooupdate необходимо это зависимостей после отработки отказа.

## <a name="doing-a-test-failover"></a>Тестовая отработка отказа
Выполните [в этом руководстве](site-recovery-test-failover-to-azure.md) toodo тестовой отработки отказа.

1.  Портал tooAzure перейти и выбрать хранилище службы восстановления.
1.  Щелкните hello плана восстановления, созданные для веб-ферму IIS.
1.  Щелкните "Тестовая отработка отказа".
1.  Выберите точку восстановления и процесс перехода на другой ресурс тестирования hello toostart виртуальной сети Azure.
1.  После hello получателей среде можно выполнять вашей проверки.
1.  После завершения проверки hello, «Выполнить проверку» можно выбрать и hello тестовой среды отработки отказа будет очищен.

## <a name="doing-a-failover"></a>Отработка отказа
При выполнении отработки отказа используйте [это руководство](site-recovery-failover.md).

1.  Портал tooAzure перейти и выбрать хранилище службы восстановления.
1.  Щелкните hello плана восстановления, созданные для веб-ферму IIS.
1.  Щелкните "Отработка отказа".
1.  Выберите процесс отработки отказа hello toostart точки восстановления.

## <a name="next-steps"></a>Дальнейшие действия
Вы можете узнать дополнительные сведения о [репликации других приложений](site-recovery-workload.md) с помощью Site Recovery.
