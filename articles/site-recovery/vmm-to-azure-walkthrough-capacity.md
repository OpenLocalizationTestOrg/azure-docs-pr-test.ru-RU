---
title: "Планирование ресурсов и масштабирование для репликации виртуальной машины Hyper-V (с VMM) в Azure с помощью Azure Site Recovery | Документация Майкрософт"
description: "Используйте эту статью, чтобы запланировать ресурсы и масштабирование при репликации виртуальных машин Hyper-V в облаках VMM в Azure с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 41c3c83e-6b1a-496a-8179-498c552ef0c7
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 07/23/2017
ms.author: raynew
ms.openlocfilehash: ab1dc21a829140f8cd2e57837d83a05b0d71bcdf
ms.sourcegitcommit: 422efcbac5b6b68295064bd545132fcc98349d01
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/29/2017
---
# <a name="step-3-plan-capacity-and-scaling-for-hyper-v-with-vmm-to-azure-replication"></a>Шаг 3. Планирование ресурсов и масштабирования для репликации из Hyper-V (с VMM) в Azure

Ознакомившись с [необходимыми условиями для развертывания](vmm-to-azure-walkthrough-prerequisites.md), прочтите эту статью, чтобы запланировать ресурсы и масштабирование при репликации локальных виртуальных машин Hyper-V в облаках VMM в Azure с помощью [Azure Site Recovery](site-recovery-overview.md).

Комментарии или вопросы технического характера можно добавить в конце этой статьи или на [форуме по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).


## <a name="how-do-i-start-capacity-planning"></a>С чего начать планирование загрузки?


Необходимо собрать сведения о среде репликации, а затем запланировать ресурсы, используя эти данные и учитывая рекомендации, приведенные в этой статье.


## <a name="gather-information"></a>Сбор сведений

1. Соберите сведения о среде репликации, включая информацию о виртуальных машинах, количестве дисков на виртуальную машину и объеме хранилища на диск.
2. Определите частоту ежедневных изменений (обновлений) реплицированных данных. Скачайте [инструмент планирования ресурсов Hyper-V](https://www.microsoft.com/download/details.aspx?id=39057), чтобы получить сведения о частоте изменений. Мы советует использовать это средство в течение недели, чтобы получить средние значения.
 

## <a name="figure-out-capacity"></a>Планирование ресурсов

На основе полученной информации используйте [планировщик ресурсов Site Recovery](http://aka.ms/asr-capacity-planner-excel), чтобы проанализировать исходную среду и рабочие нагрузки и оценить требования к пропускной способности, а также определить объем ресурсов сервера для исходного расположения и ресурсы (виртуальные машины, хранилища и т. д.), требуемые для целевого расположения. Его можно использовать в нескольких режимах:

- Быстрое планирование. Запустите инструмент в этом режиме, чтобы получить проекции сети и сервера на основе среднего числа виртуальных машин, дисков, объема хранилища и частоты изменений.
- Детальное планирование. Запустите инструмент в этом режиме, чтобы задать сведения о каждой рабочей нагрузке на уровне виртуальной машины. Проанализируйте совместимость виртуальной машины и получите проекции сети и сервера.

Теперь запустите инструмент.

1. Скачайте [инструмент](http://aka.ms/asr-capacity-planner-excel).
2. Чтобы запустить инструмент быстрого планирования, выполните [эти инструкции](site-recovery-capacity-planner.md#run-the-quick-planner) и выберите сценарий **Hyper-V в Azure**.
3. Чтобы запустить инструмент детального планирования, выполните [эти инструкции](site-recovery-capacity-planner.md#run-the-detailed-planner) и выберите сценарий **Hyper-V в Azure**.

## <a name="control-network-bandwidth"></a>Управление пропускной способностью сети

После вычисления необходимой пропускной способности у вас есть несколько вариантов управления объемом пропускной способности, используемой для репликации:

* **Регулирование пропускной способности.** Трафик Hyper-V, который реплицируется в Azure, проходит через определенный узел Hyper-V. Пропускную способность можно регулировать на сервере этого узла.
* **Изменение пропускной способности.** Пропускную способность, используемую для репликации, можно изменить с помощью нескольких ключей реестра.

### <a name="throttle-bandwidth"></a>Регулирование пропускной способности
1. Откройте на сервере узла Hyper-V оснастку MMC в службе архивации Microsoft Azure. По умолчанию ярлык для службы архивации Microsoft Azure доступен на рабочем столе или в папке C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.
2. В оснастке щелкните **Изменить свойства**.
3. На вкладке **Регулирование** установите флажок **Разрешить регулирование пропускной способности интернет-канала для операций архивации** и задайте ограничения для рабочего и нерабочего времени. Допустимы значения в диапазоне от 512 Кбит/с до 102 Мбит/с.

    ![Регулирование пропускной способности](./media/vmm-to-azure-walkthrough-capacity/throttle2.png)

Чтобы настроить регулирование, можно также использовать командлет [Set-OBMachineSetting](https://technet.microsoft.com/library/hh770409.aspx) . Рассмотрим пример:

    $mon = [System.DayOfWeek]::Monday
    $tue = [System.DayOfWeek]::Tuesday
    Set-OBMachineSetting -WorkDay $mon, $tue -StartWorkHour "9:00:00" -EndWorkHour "18:00:00" -WorkHourBandwidth  (512*1024) -NonWorkHourBandwidth (2048*1024)

**Set-OBMachineSetting -NoThrottle** указывает, что регулирование не требуется.

### <a name="influence-network-bandwidth"></a>Изменение пропускной способности сети
1. В реестре перейдите в раздел **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication**.
   * Чтобы изменить скорость передачи данных при репликации диска, задайте новое значение для раздела **UploadThreadsPerVM**или создайте его, если он еще не существует.
   * Чтобы изменить скорость передачи данных при восстановлении размещения из Azure, задайте новое значение для раздела **DownloadThreadsPerVM**.
2. Значение по умолчанию — 4. В сети со значительным избыточным резервом для этих разделов реестра необходимо изменить значения по умолчанию. Максимальное значение — 32. Следите за трафиком для оптимизации значения.

## <a name="next-steps"></a>Дальнейшие действия

Перейдите к статье [Шаг 4. Планирование сетей для репликации физического сервера в Azure](vmm-to-azure-walkthrough-network.md).
