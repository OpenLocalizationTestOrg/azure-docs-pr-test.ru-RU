---
title: "aaaHow работают VMware репликации tooAzure в Azure Site Recovery? | Документация Майкрософт"
description: "В этой статье содержится обзор компонентов и архитектура, используемая при репликации локальных виртуальных машин VMware и физических серверов tooAzure с hello службы Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/29/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: vmware-walkthrough-architecture
ms.openlocfilehash: f0fb834f8b251640f97e4d0163b2b9e54de691e1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="how-does-vmware-replication-tooazure-work-in-site-recovery"></a><span data-ttu-id="e7745-104">Как работает репликация tooAzure VMware в Site Recovery</span><span class="sxs-lookup"><span data-stu-id="e7745-104">How does VMware replication tooAzure work in Site Recovery?</span></span>

<span data-ttu-id="e7745-105">В этой статье описывается hello компонентов и процессов, задействованных при репликации локальной VMware виртуальных машин и физических серверов Windows и Linux, tooAzure, с помощью hello [Azure Site Recovery](site-recovery-overview.md) службы.</span><span class="sxs-lookup"><span data-stu-id="e7745-105">This article describes hello components and processes involved when replicating on-premises VMware virtual machines, and Windows/Linux physical servers, tooAzure using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="e7745-106">При репликации tooAzure физического локальных серверов, репликация использует также hello же компоненты и процессы, как репликация виртуальной Машины VMware, имеют следующие отличия:</span><span class="sxs-lookup"><span data-stu-id="e7745-106">When you replicate physical on-premises servers tooAzure, replication uses also hello same components and processes as VMware VM replication, with these differences:</span></span>

- <span data-ttu-id="e7745-107">Физический сервер можно использовать для настройки сервера hello, вместо виртуальной Машины VMware.</span><span class="sxs-lookup"><span data-stu-id="e7745-107">You can use a physical server for hello configuration server, instead of a VMware VM.</span></span>
- <span data-ttu-id="e7745-108">для восстановления размещения требуется локальная инфраструктура VMware.</span><span class="sxs-lookup"><span data-stu-id="e7745-108">You will need an on-premises VMware infrastructure for failback.</span></span> <span data-ttu-id="e7745-109">Нельзя отметить как не задней tooa физического компьютера.</span><span class="sxs-lookup"><span data-stu-id="e7745-109">You can't fail back tooa physical machine.</span></span>

<span data-ttu-id="e7745-110">Отправлять все комментарии hello нижней части этой статьи, или задать вопросы в hello [форум по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="e7745-110">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="e7745-111">Компоненты архитектуры</span><span class="sxs-lookup"><span data-stu-id="e7745-111">Architectural components</span></span>

<span data-ttu-id="e7745-112">Ряд компонентов участвуют, при репликации виртуальных машин VMware и физических серверов tooAzure.</span><span class="sxs-lookup"><span data-stu-id="e7745-112">There are a number of components involved when replicating VMware VMs and physical servers tooAzure.</span></span>

<span data-ttu-id="e7745-113">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="e7745-113">**Component**</span></span> | <span data-ttu-id="e7745-114">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="e7745-114">**Location**</span></span> | <span data-ttu-id="e7745-115">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="e7745-115">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="e7745-116">**Таблицы Azure**</span><span class="sxs-lookup"><span data-stu-id="e7745-116">**Azure**</span></span> | <span data-ttu-id="e7745-117">В Azure требуется учетная запись Azure, учетная запись хранения Azure и сеть Azure.</span><span class="sxs-lookup"><span data-stu-id="e7745-117">In Azure you need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="e7745-118">Реплицированные данные хранятся в учетной записи хранения hello и виртуальных машинах Azure создаются с hello реплицированных данных, когда происходит переход на другой ресурс с веб-узла в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="e7745-118">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="e7745-119">Hello виртуальных машинах Azure подключиться toohello виртуальной сети Azure, когда они создаются.</span><span class="sxs-lookup"><span data-stu-id="e7745-119">hello Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="e7745-120">**Сервер конфигурации**</span><span class="sxs-lookup"><span data-stu-id="e7745-120">**Configuration server**</span></span> | <span data-ttu-id="e7745-121">Один локальный сервер управления (виртуальной Машины VMWare), запускает все компоненты локально hello, которые требуются для развертывания hello, включая hello конфигурации сервера, сервера обработки, главный целевой сервер</span><span class="sxs-lookup"><span data-stu-id="e7745-121">A single on-premises management server (VMWare VM) that runs all hello on-premises components that are needed for hello deployment, including hello configuration server, process server, master target server</span></span> | <span data-ttu-id="e7745-122">Hello конфигурации серверного компонента координирует взаимодействие между локальной средой и Azure и управляет репликацией данных.</span><span class="sxs-lookup"><span data-stu-id="e7745-122">hello configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="e7745-123">**Сервер обработки**</span><span class="sxs-lookup"><span data-stu-id="e7745-123">**Process server**:</span></span>  | <span data-ttu-id="e7745-124">Устанавливается по умолчанию на сервере конфигурации hello.</span><span class="sxs-lookup"><span data-stu-id="e7745-124">Installed by default on hello configuration server.</span></span> | <span data-ttu-id="e7745-125">Выступает в качестве шлюза репликации.</span><span class="sxs-lookup"><span data-stu-id="e7745-125">Acts as a replication gateway.</span></span> <span data-ttu-id="e7745-126">Получает данные репликации, выполняет оптимизацию для кэширования, сжатия и шифрования и отправляет его tooAzure хранилища.</span><span class="sxs-lookup"><span data-stu-id="e7745-126">Receives replication data, optimizes it with caching, compression, and encryption, and sends it tooAzure storage.</span></span><br/><br/> <span data-ttu-id="e7745-127">сервер обработки Hello также обрабатываются принудительной установки службы tooprotected hello Mobility машин, а также выполняет автоматическое обнаружение виртуальных машин VMware.</span><span class="sxs-lookup"><span data-stu-id="e7745-127">hello process server also handles push installation of hello Mobility service tooprotected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="e7745-128">По мере роста развертывания можно добавить дополнительные отдельном выделенном процессе серверов toohandle увеличение объемов трафика репликации.</span><span class="sxs-lookup"><span data-stu-id="e7745-128">As your deployment grows you can add additional separate dedicated process servers toohandle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="e7745-129">**Главный целевой сервер**</span><span class="sxs-lookup"><span data-stu-id="e7745-129">**Master target server**</span></span> | <span data-ttu-id="e7745-130">Устанавливается по умолчанию на сервере конфигурации локальной hello.</span><span class="sxs-lookup"><span data-stu-id="e7745-130">Installed by default on hello on-premises configuration server.</span></span> | <span data-ttu-id="e7745-131">Обрабатывает данные репликации при восстановлении размещения с переносом из Azure.</span><span class="sxs-lookup"><span data-stu-id="e7745-131">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="e7745-132">Если объемы трафика восстановления размещения высоки, можно развернуть отдельный главный целевой сервер.</span><span class="sxs-lookup"><span data-stu-id="e7745-132">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="e7745-133">**Серверы VMware**</span><span class="sxs-lookup"><span data-stu-id="e7745-133">**VMware servers**</span></span> | <span data-ttu-id="e7745-134">Виртуальные машины VMware, размещаются на серверах ESXi vSphere, и мы рекомендуем vCenter server toomanage hello узлов.</span><span class="sxs-lookup"><span data-stu-id="e7745-134">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server toomanage hello hosts.</span></span> | <span data-ttu-id="e7745-135">Добавьте хранилище служб восстановления tooyour серверов VMware.</span><span class="sxs-lookup"><span data-stu-id="e7745-135">You add VMware servers tooyour Recovery Services vault.</span></span>
<span data-ttu-id="e7745-136">**Реплицируемые компьютеры**</span><span class="sxs-lookup"><span data-stu-id="e7745-136">**Replicated machines**</span></span> | <span data-ttu-id="e7745-137">Hello службы Mobility service будет установлен на каждой виртуальной Машины требуется tooreplicate VMware.</span><span class="sxs-lookup"><span data-stu-id="e7745-137">hello Mobility service will be installed on each VMware VM you want tooreplicate.</span></span> <span data-ttu-id="e7745-138">Его можно установить вручную на каждом компьютере или с помощью принудительной установки с сервера обработки hello.</span><span class="sxs-lookup"><span data-stu-id="e7745-138">It can be installed manually on each machine, or with a push installation from hello process server.</span></span>

<span data-ttu-id="e7745-139">Дополнительные сведения о необходимых условий развертывания hello и требования для каждого из этих компонентов в hello [Матрица поддержки](site-recovery-support-matrix-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="e7745-139">Learn about hello deployment prerequisites and requirements for each of these components in hello [support matrix](site-recovery-support-matrix-to-azure.md).</span></span>

<span data-ttu-id="e7745-140">**Рис. 1: Компоненты tooAzure VMware**</span><span class="sxs-lookup"><span data-stu-id="e7745-140">**Figure 1: VMware tooAzure components**</span></span>

![Компоненты](./media/site-recovery-components/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="e7745-142">Процесс репликации</span><span class="sxs-lookup"><span data-stu-id="e7745-142">Replication process</span></span>

1. <span data-ttu-id="e7745-143">Настройка развертывания hello, включая компоненты Azure и хранилище служб восстановления.</span><span class="sxs-lookup"><span data-stu-id="e7745-143">You set up hello deployment, including Azure components, and a Recovery Services vault.</span></span> <span data-ttu-id="e7745-144">В хранилище hello укажите hello репликации исходное и целевое, Настройка сервера конфигурации hello, добавление серверов VMware, создайте политику репликации, развертывание службы мобильности hello, включение репликации и запустите тестовую отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="e7745-144">In hello vault you specify hello replication source and target, set up hello configuration server, add VMware servers, create a replication policy, deploy hello Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="e7745-145">Машины запустить репликацию в соответствии с политикой репликации hello и исходную копию данных hello — реплицированные tooAzure хранилище.</span><span class="sxs-lookup"><span data-stu-id="e7745-145">Machines start replicating in accordance with hello replication policy, and an initial copy of hello data is replicated tooAzure storage.</span></span>
4. <span data-ttu-id="e7745-146">Репликация tooAzure разностных изменений начинается после завершения первоначальной репликации hello.</span><span class="sxs-lookup"><span data-stu-id="e7745-146">Replication of delta changes tooAzure begins after hello initial replication finishes.</span></span> <span data-ttu-id="e7745-147">Отслеживаемые изменения для компьютера хранятся в HRL-файле.</span><span class="sxs-lookup"><span data-stu-id="e7745-147">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="e7745-148">Репликацию машин взаимодействуют с сервером конфигурации hello через порт 443 для HTTPS входящего трафика для управления репликацией.</span><span class="sxs-lookup"><span data-stu-id="e7745-148">Replicating machines communicate with hello configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="e7745-149">Репликацию машины отправляют сервера обработки toohello репликации данных через порт HTTPS 9443 входящих (можно настроить).</span><span class="sxs-lookup"><span data-stu-id="e7745-149">Replicating machines send replication data toohello process server on port HTTPS 9443 inbound (can be configured).</span></span>
    - <span data-ttu-id="e7745-150">Сервер конфигурации Hello управляет управление репликацией с помощью Azure через порт 443 для исходящих подключений HTTPS.</span><span class="sxs-lookup"><span data-stu-id="e7745-150">hello configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="e7745-151">Hello сервера обработки получает данные из исходных компьютеров, оптимизирует и шифрует его и отправляет его хранения tooAzure через порт номер 443 исходящего.</span><span class="sxs-lookup"><span data-stu-id="e7745-151">hello process server receives data from source machines, optimizes and encrypts it, and sends it tooAzure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="e7745-152">При включении согласованность нескольких виртуальных Машин, затем машины в группу репликации hello взаимодействовать друг с другом через порт 20004.</span><span class="sxs-lookup"><span data-stu-id="e7745-152">If you enable multi-VM consistency, then machines in hello replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="e7745-153">Эту функция используется, если вы объединяете несколько компьютеров в группы репликации, и они совместно используют отказоустойчивые и согласованные точки восстановления после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="e7745-153">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="e7745-154">Это полезно, если компьютеры работают под управлением hello же рабочую нагрузку и требуют toobe согласованной.</span><span class="sxs-lookup"><span data-stu-id="e7745-154">This is useful if machines are running hello same workload and need toobe consistent.</span></span>
5. <span data-ttu-id="e7745-155">Трафик реплицированных tooAzure хранения общедоступных конечных точек, более чем hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="e7745-155">Traffic is replicated tooAzure storage public endpoints, over hello internet.</span></span> <span data-ttu-id="e7745-156">Кроме того, можно использовать [общедоступный пиринг](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="e7745-156">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="e7745-157">Репликация трафика через виртуальную частную сеть сайт сайт с локального сайта tooAzure не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="e7745-157">Replicating traffic over a site-to-site VPN from an on-premises site tooAzure isn't supported.</span></span>

<span data-ttu-id="e7745-158">**Рисунок 2: VMware tooAzure репликации**</span><span class="sxs-lookup"><span data-stu-id="e7745-158">**Figure 2: VMware tooAzure replication**</span></span>

![Расширенная архитектура](./media/site-recovery-components/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="e7745-160">Процесс отработки отказа и восстановления размещения</span><span class="sxs-lookup"><span data-stu-id="e7745-160">Failover and failback process</span></span>

1. <span data-ttu-id="e7745-161">Убедившись, что тестовой отработки отказа работает должным образом, при необходимости можно запустить tooAzure незапланированной отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="e7745-161">After you verify that test failover is working as expected, you can run unplanned failovers tooAzure as required.</span></span> <span data-ttu-id="e7745-162">Плановая отработка отказа не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="e7745-162">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="e7745-163">При сбое одного компьютера или создайте [планы восстановления](site-recovery-create-recovery-plans.md), toofail по нескольким ВМ.</span><span class="sxs-lookup"><span data-stu-id="e7745-163">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), toofail over multiple VMs.</span></span>
3. <span data-ttu-id="e7745-164">При отработке отказа в Azure создаются виртуальные машины реплик.</span><span class="sxs-lookup"><span data-stu-id="e7745-164">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="e7745-165">Фиксация отработки отказа toostart доступ к hello рабочей нагрузки из hello реплики виртуальной Машины Azure.</span><span class="sxs-lookup"><span data-stu-id="e7745-165">You commit a failover toostart accessing hello workload from hello replica Azure VM.</span></span>
4. <span data-ttu-id="e7745-166">Когда основной локальный сайт снова станет доступным, вы сможете выполнить восстановление размещения.</span><span class="sxs-lookup"><span data-stu-id="e7745-166">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="e7745-167">Настройка инфраструктуры восстановление после сбоя, запустить репликацию машины hello из первичного toohello вторичного сайта hello и запустить незапланированную отработку отказа из вторичного сайта hello.</span><span class="sxs-lookup"><span data-stu-id="e7745-167">You set up a failback infrastructure, start replicating hello machine from hello secondary site toohello primary, and run an unplanned failover from hello secondary site.</span></span> <span data-ttu-id="e7745-168">После фиксации этой отработки отказа, данные будут назад в локальной и требуется tooAzure tooenable репликации.</span><span class="sxs-lookup"><span data-stu-id="e7745-168">After you commit this failover, data will be back on-premises, and you need tooenable replication tooAzure again.</span></span> [<span data-ttu-id="e7745-169">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="e7745-169">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="e7745-170">Есть ряд требований к восстановлению размещения.</span><span class="sxs-lookup"><span data-stu-id="e7745-170">There are a few failback requirements:</span></span>


- <span data-ttu-id="e7745-171">**Сервер обработки временных в Azure**: Если требуется toofail от Azure после отработки отказа необходимо tooset копирование виртуальной Машины Azure в качестве процесса сервера, toohandle репликация из Azure.</span><span class="sxs-lookup"><span data-stu-id="e7745-171">**Temporary process server in Azure**: If you want toofail back from Azure after failover you'll need tooset up an Azure VM configured as a process server, toohandle replication from Azure.</span></span> <span data-ttu-id="e7745-172">После восстановления размещения эту виртуальную машину можно удалить.</span><span class="sxs-lookup"><span data-stu-id="e7745-172">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="e7745-173">**VPN-подключение**: для восстановления размещения, вам потребуется подключения VPN (или Azure ExpressRoute) настроить от hello Azure toohello локального сайта сети.</span><span class="sxs-lookup"><span data-stu-id="e7745-173">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from hello Azure network toohello on-premises site.</span></span>
- <span data-ttu-id="e7745-174">**Отдельный локальный главный целевой сервер**: hello локальный главный целевой сервер обрабатывает восстановления размещения.</span><span class="sxs-lookup"><span data-stu-id="e7745-174">**Separate on-premises master target server**: hello on-premises master target server handles failback.</span></span> <span data-ttu-id="e7745-175">Hello главный целевой сервер устанавливается по умолчанию на сервере управления hello, но если удается обратно больших объемов трафика отдельные на локальный главный целевой сервер для этой цели следует настроить.</span><span class="sxs-lookup"><span data-stu-id="e7745-175">hello master target server is installed by default on hello management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="e7745-176">**Политика восстановления размещения**: назад tooyour tooreplicate локального сайта, необходимо, чтобы политика восстановления размещения.</span><span class="sxs-lookup"><span data-stu-id="e7745-176">**Failback policy**: tooreplicate back tooyour on-premises site, you need a failback policy.</span></span> <span data-ttu-id="e7745-177">Она создается автоматически во время создания политики репликации.</span><span class="sxs-lookup"><span data-stu-id="e7745-177">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="e7745-178">**Инфраструктура VMware**: необходимо сбоя tooan локальной виртуальной Машины VMware.</span><span class="sxs-lookup"><span data-stu-id="e7745-178">**VMware infrastructure**: You must fail back tooan on-premises VMware VM.</span></span> <span data-ttu-id="e7745-179">Это означает, что требуется локальная инфраструктура VMware, даже если выполняется репликация tooAzure локальных физических серверов.</span><span class="sxs-lookup"><span data-stu-id="e7745-179">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers tooAzure.</span></span>

<span data-ttu-id="e7745-180">**Рис. 3. Восстановление размещения виртуальных машин или физических компьютеров VMware**</span><span class="sxs-lookup"><span data-stu-id="e7745-180">**Figure 3: VMware/physical failback**</span></span>

![Восстановление размещения](./media/site-recovery-components/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="e7745-182">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="e7745-182">Next steps</span></span>

<span data-ttu-id="e7745-183">Просмотрите hello [Матрица поддержки](site-recovery-support-matrix-to-azure.md)</span><span class="sxs-lookup"><span data-stu-id="e7745-183">Review hello [support matrix](site-recovery-support-matrix-to-azure.md)</span></span>
