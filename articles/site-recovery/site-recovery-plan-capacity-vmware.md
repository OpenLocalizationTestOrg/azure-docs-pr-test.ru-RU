---
title: "Планирование ресурсов и масштабирования для репликации из VMware в Azure с помощью Azure Site Recovery | Документы Майкрософт"
description: "Используйте эту статью, чтобы запланировать ресурсы и масштабирование при репликации виртуальных машин VMware в Azure с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: 0a1cd8eb-a8f7-4228-ab84-9449e0b2887b
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 05/24/2017
ms.author: rayne
ms.openlocfilehash: 8b580ac239bfb6d7b633fb03d4cfb91b168b0610
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="plan-capacity-and-scaling-for-vmware-replication-with-azure-site-recovery"></a><span data-ttu-id="9cd0e-103">Планирование загрузки и масштабирования для репликации из VMware с помощью Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="9cd0e-103">Plan capacity and scaling for VMware replication with Azure Site Recovery</span></span>

<span data-ttu-id="9cd0e-104">Используйте эту статью, чтобы выяснить, как планировать ресурсы и масштабирование при репликации локальных физических серверов и виртуальных машин VMware в Azure с помощью [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="9cd0e-104">Use this article to figure out planning for capacity and scaling, when replicating on-premises VMware VMs and physical servers to Azure with [Azure Site Recovery](site-recovery-overview.md).</span></span>

## <a name="how-do-i-start-capacity-planning"></a><span data-ttu-id="9cd0e-105">С чего начать планирование загрузки?</span><span class="sxs-lookup"><span data-stu-id="9cd0e-105">How do I start capacity planning?</span></span>

<span data-ttu-id="9cd0e-106">Соберите сведения о среде репликации, запустив [планировщик ресурсов Azure Site Recovery](https://aka.ms/asr-deployment-planner-doc) для репликации VMware.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-106">Gather information about your replication environment by running the [Azure Site Recovery Deployment Planner](https://aka.ms/asr-deployment-planner-doc) for VMware replication.</span></span> <span data-ttu-id="9cd0e-107">См. [дополнительные сведения](site-recovery-deployment-planner.md) об этом средстве.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-107">[Learn more](site-recovery-deployment-planner.md) about this tool.</span></span> <span data-ttu-id="9cd0e-108">Планировщик поможет вам собрать данные о виртуальных машинах (совместимых и несовместимых), дисках на каждой виртуальной машине и обновлениях данных на каждом диске.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-108">You'll gather information about compatible and incompatible VMs, disks per VM, and data churn per disk.</span></span> <span data-ttu-id="9cd0e-109">Инструмент также проверяет соответствие требованиям к пропускной способности сети и инфраструктуре Azure для успешной репликации и тестовой отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-109">The tool also covers network bandwidth requirements, and the Azure infrastructure needed for successful replication and test failover.</span></span>

## <a name="capacity-considerations"></a><span data-ttu-id="9cd0e-110">Рекомендации по емкости</span><span class="sxs-lookup"><span data-stu-id="9cd0e-110">Capacity considerations</span></span>

<span data-ttu-id="9cd0e-111">**Компонент**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-111">**Component**</span></span> | <span data-ttu-id="9cd0e-112">**Дополнительные сведения**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-112">**Details**</span></span> |
--- | --- | ---
<span data-ttu-id="9cd0e-113">**Репликация**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-113">**Replication**</span></span> | <span data-ttu-id="9cd0e-114">**Максимальный объем ежедневно изменяемых данных.** Защищенный компьютер может использовать только один сервер обработки, а объем ежедневно изменяемых данных на одном сервере обработки может составлять не более 2 ТБ.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-114">**Maximum daily change rate:** A protected machine can only use one process server, and a single process server can handle a daily change rate up to 2 TB.</span></span> <span data-ttu-id="9cd0e-115">В связи с этим 2 ТБ — максимальный объем ежедневно изменяемых данных, поддерживаемый защищенным компьютером.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-115">Thus 2 TB is the maximum daily data change rate that’s supported for a protected machine.</span></span><br/><br/> <span data-ttu-id="9cd0e-116">**Максимальная пропускная способность.** Реплицированный компьютер может принадлежать одной учетной записи хранения в Azure.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-116">**Maximum throughput:** A replicated machine can belong to one storage account in Azure.</span></span> <span data-ttu-id="9cd0e-117">Стандартная учетная запись хранения может обрабатывать не более 20 000 запросов в секунду. Мы рекомендуем не превышать количество в 20 000 операций ввода-вывода в секунду на исходном компьютере.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-117">A standard storage account can handle a maximum of 20,000 requests per second, and we recommend that you keep the number of input/output operations per second (IOPS) across a source machine to 20,000.</span></span> <span data-ttu-id="9cd0e-118">Например, если есть исходный компьютер с 5 дисками, на каждом из которых выполняется по 120 операций ввода-вывода в секунду (размером в 8 КБ), то этот показатель не будет превышать ограничение в 500 операций ввода-вывода в секунду на диск в Azure.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-118">For example, if you have a source machine with 5 disks, and each disk generates 120 IOPS (8K size) on the source machine, then it will be within the Azure per disk IOPS limit of 500.</span></span> <span data-ttu-id="9cd0e-119">Число необходимых учетных записей хранения определяется путем деления общего числа операций ввода-вывода для исходного компьютера на 20 000.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-119">(The number of storage accounts required is equal to the total source machine IOPS, divided by 20,000.)</span></span>
<span data-ttu-id="9cd0e-120">**Сервер конфигурации**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-120">**Configuration server**</span></span> | <span data-ttu-id="9cd0e-121">Сервер конфигурации должен поддерживать суммарный объем ежедневно изменяемых данных для всех рабочих нагрузок, которые выполняются на защищенных компьютерах. Кроме того, он должен обладать достаточной пропускной способностью для непрерывной репликации данных в службу хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-121">The configuration server should be able to handle the daily change rate capacity across all workloads running on protected machines, and needs sufficient bandwidth to continuously replicate data to Azure Storage.</span></span><br/><br/> <span data-ttu-id="9cd0e-122">Мы рекомендуем разместить сервер конфигурации в той же сети и в том же сегменте локальной сети, что и компьютеры, которые необходимо защитить.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-122">As a best practice, locate the configuration server on the same network and LAN segment as the machines you want to protect.</span></span> <span data-ttu-id="9cd0e-123">Его можно разместить и в другой сети при наличии у компьютеров, которые нужно защитить, доступа к этой сети третьего уровня.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-123">It can be located on a different network, but machines you want to protect should have layer 3 network visibility to it.</span></span><br/><br/> <span data-ttu-id="9cd0e-124">В следующем разделе в таблице приведены рекомендации по размерам для сервера конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-124">Size recommendations for the configuration server are summarized in the table in the following section.</span></span>
<span data-ttu-id="9cd0e-125">**Сервер обработки**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-125">**Process server**</span></span> | <span data-ttu-id="9cd0e-126">Первый сервер обработки по умолчанию устанавливается на сервере конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-126">The first process server is installed by default on the configuration server.</span></span> <span data-ttu-id="9cd0e-127">Для масштабирования среды можно развернуть дополнительные серверы обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-127">You can deploy additional process servers to scale your environment.</span></span> <br/><br/> <span data-ttu-id="9cd0e-128">Сервер обработки получает данные репликации с защищенных компьютеров и оптимизирует их путем кэширования, сжатия и шифрования,</span><span class="sxs-lookup"><span data-stu-id="9cd0e-128">The process server receives replication data from protected machines, and optimizes it with caching, compression, and encryption.</span></span> <span data-ttu-id="9cd0e-129">а затем отправляет их в Azure.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-129">Then it sends the data to Azure.</span></span> <span data-ttu-id="9cd0e-130">Сервер обработки должен располагать достаточными ресурсами для выполнения этих задач.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-130">The process server machine should have sufficient resources to perform these tasks.</span></span><br/><br/> <span data-ttu-id="9cd0e-131">Сервер обработки использует дисковый кэш.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-131">The process server uses a disk-based cache.</span></span> <span data-ttu-id="9cd0e-132">Чтобы обеспечить обработку хранящихся изменений данных в случае возникновения узкого места в сети или сбоя, установите отдельный диск кэша объемом 600 ГБ и более.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-132">Use a separate cache disk of 600 GB or more to handle data changes stored in the event of a network bottleneck or outage.</span></span>

## <a name="size-recommendations-for-the-configuration-server"></a><span data-ttu-id="9cd0e-133">Рекомендации по размеру сервера конфигурации</span><span class="sxs-lookup"><span data-stu-id="9cd0e-133">Size recommendations for the configuration server</span></span>

<span data-ttu-id="9cd0e-134">**ЦП**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-134">**CPU**</span></span> | <span data-ttu-id="9cd0e-135">**Память**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-135">**Memory**</span></span> | <span data-ttu-id="9cd0e-136">**Размер диска кэша**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-136">**Cache disk size**</span></span> | <span data-ttu-id="9cd0e-137">**Частота изменения данных**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-137">**Data change rate**</span></span> | <span data-ttu-id="9cd0e-138">**Защищенные компьютеры**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-138">**Protected machines**</span></span>
--- | --- | --- | --- | ---
<span data-ttu-id="9cd0e-139">8 виртуальных ЦП (2 сокета * 4 ядра с частотой 2,5 ГГц)</span><span class="sxs-lookup"><span data-stu-id="9cd0e-139">8 vCPUs (2 sockets * 4 cores @ 2.5 gigahertz [GHz])</span></span> | <span data-ttu-id="9cd0e-140">16 ГБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-140">16 GB</span></span> | <span data-ttu-id="9cd0e-141">300 ГБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-141">300 GB</span></span> | <span data-ttu-id="9cd0e-142">500 ГБ или менее</span><span class="sxs-lookup"><span data-stu-id="9cd0e-142">500 GB or less</span></span> | <span data-ttu-id="9cd0e-143">Репликация не более 100 компьютеров</span><span class="sxs-lookup"><span data-stu-id="9cd0e-143">Replicate less than 100 machines.</span></span>
<span data-ttu-id="9cd0e-144">12 виртуальных ЦП (2 сокета * 6 ядер с частотой 2,5 ГГц)</span><span class="sxs-lookup"><span data-stu-id="9cd0e-144">12 vCPUs (2 sockets * 6 cores @ 2.5 GHz)</span></span> | <span data-ttu-id="9cd0e-145">18 ГБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-145">18 GB</span></span> | <span data-ttu-id="9cd0e-146">600 ГБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-146">600 GB</span></span> | <span data-ttu-id="9cd0e-147">От 500 ГБ до 1 ТБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-147">500 GB to 1 TB</span></span> | <span data-ttu-id="9cd0e-148">Репликация от 100 до 150 компьютеров</span><span class="sxs-lookup"><span data-stu-id="9cd0e-148">Replicate between 100-150 machines.</span></span>
<span data-ttu-id="9cd0e-149">16 виртуальных ЦП (2 сокета * 8 ядер с частотой 2,5 ГГц)</span><span class="sxs-lookup"><span data-stu-id="9cd0e-149">16 vCPUs (2 sockets * 8 cores @ 2.5 GHz)</span></span> | <span data-ttu-id="9cd0e-150">32 ГБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-150">32 GB</span></span> | <span data-ttu-id="9cd0e-151">1 TБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-151">1 TB</span></span> | <span data-ttu-id="9cd0e-152">От 1 ТБ до 2 ТБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-152">1 TB to 2 TB</span></span> | <span data-ttu-id="9cd0e-153">Репликация от 150 до 200 компьютеров</span><span class="sxs-lookup"><span data-stu-id="9cd0e-153">Replicate between 150-200 machines.</span></span>
<span data-ttu-id="9cd0e-154">Разверните другой сервер обработки</span><span class="sxs-lookup"><span data-stu-id="9cd0e-154">Deploy another process server</span></span> | | | <span data-ttu-id="9cd0e-155">Более 2 ТБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-155">> 2 TB</span></span> | <span data-ttu-id="9cd0e-156">Разверните дополнительные серверы обработки при репликации более 200 компьютеров или объеме ежедневно изменяемых данных более 2 ТБ.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-156">Deploy additional process servers if you're replicating more than 200 machines, or if the daily data change rate exceeds 2 TB.</span></span>

<span data-ttu-id="9cd0e-157">Описание</span><span class="sxs-lookup"><span data-stu-id="9cd0e-157">Where:</span></span>

* <span data-ttu-id="9cd0e-158">Для каждого исходного компьютера настраивается 3 диска объемом по 100 ГБ каждый.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-158">Each source machine is configured with 3 disks of 100 GB each.</span></span>
* <span data-ttu-id="9cd0e-159">Чтобы измерить показатели диска кэша, мы использовали хранилище для тестирования производительности с 8 дисками SAS с частотой вращения шпинделя 10 000 об/мин в конфигурации RAID 10.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-159">We used benchmarking storage of 8 SAS drives of 10 K RPM, with RAID 10, for cache disk measurements.</span></span>

## <a name="size-recommendations-for-the-process-server"></a><span data-ttu-id="9cd0e-160">Рекомендации по размеру сервера обработки</span><span class="sxs-lookup"><span data-stu-id="9cd0e-160">Size recommendations for the process server</span></span>

<span data-ttu-id="9cd0e-161">Если необходимо защитить более 200 компьютеров или объем ежедневно изменяемых данных составляет более 2 ТБ, для обработки такой нагрузки репликации можно добавить серверы обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-161">If you need to protect more than 200 machines, or the daily change rate is greater than 2 TB, you can add process servers to handle the replication load.</span></span> <span data-ttu-id="9cd0e-162">Для развертывания можно выполнить следующее.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-162">To scale out, you can:</span></span>

* <span data-ttu-id="9cd0e-163">Увеличить количество серверов конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-163">Increase the number of configuration servers.</span></span> <span data-ttu-id="9cd0e-164">Например, с помощью двух серверов конфигурации можно защитить до 400 компьютеров.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-164">For example, you can protect up to 400 machines with two configuration servers.</span></span>
* <span data-ttu-id="9cd0e-165">Добавить дополнительные серверы обработки и использовать их для обработки трафика вместо сервера конфигурации (или вместе с ним).</span><span class="sxs-lookup"><span data-stu-id="9cd0e-165">Add more process servers, and use these to handle traffic instead of (or in addition to) the configuration server.</span></span>

<span data-ttu-id="9cd0e-166">В таблице ниже описан следующий сценарий.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-166">The following table describes a scenario in which:</span></span>

* <span data-ttu-id="9cd0e-167">Вы не планируете использовать сервер конфигурации в качестве сервера обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-167">You're not planning to use the configuration server as a process server.</span></span>
* <span data-ttu-id="9cd0e-168">Вы настроили дополнительный сервер обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-168">You've set up an additional process server.</span></span>
* <span data-ttu-id="9cd0e-169">Вы настроили для защищенных виртуальных машин дополнительный сервер обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-169">You've configured protected virtual machines to use the additional process server.</span></span>
* <span data-ttu-id="9cd0e-170">Для каждого защищенного исходного компьютера настраивается три диска объемом 100 ГБ каждый.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-170">Each protected source machine is configured with three disks of 100 GB each.</span></span>

<span data-ttu-id="9cd0e-171">**Сервер конфигурации**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-171">**Configuration server**</span></span> | <span data-ttu-id="9cd0e-172">**Дополнительный сервер обработки**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-172">**Additional process server**</span></span> | <span data-ttu-id="9cd0e-173">**Размер диска кэша**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-173">**Cache disk size**</span></span> | <span data-ttu-id="9cd0e-174">**Частота изменения данных**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-174">**Data change rate**</span></span> | <span data-ttu-id="9cd0e-175">**Защищенные компьютеры**</span><span class="sxs-lookup"><span data-stu-id="9cd0e-175">**Protected machines**</span></span>
--- | --- | --- | --- | ---
<span data-ttu-id="9cd0e-176">8 виртуальных ЦП (2 сокета * 4 ядра с частотой 2,5 ГГц), 16 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="9cd0e-176">8 vCPUs (2 sockets * 4 cores @ 2.5 GHz), 16 GB memory</span></span> | <span data-ttu-id="9cd0e-177">4 виртуальных ЦП (2 сокета * 2 ядра с частотой 2,5 ГГц), 8 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="9cd0e-177">4 vCPUs (2 sockets * 2 cores @ 2.5 GHz), 8 GB memory</span></span> | <span data-ttu-id="9cd0e-178">300 ГБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-178">300 GB</span></span> | <span data-ttu-id="9cd0e-179">250 ГБ или менее</span><span class="sxs-lookup"><span data-stu-id="9cd0e-179">250 GB or less</span></span> | <span data-ttu-id="9cd0e-180">Вы можете реплицировать до 85 компьютеров.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-180">Replicate 85 or fewer machines.</span></span>
<span data-ttu-id="9cd0e-181">8 виртуальных ЦП (2 сокета * 4 ядра с частотой 2,5 ГГц), 16 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="9cd0e-181">8 vCPUs (2 sockets * 4 cores @ 2.5 GHz), 16 GB memory</span></span> | <span data-ttu-id="9cd0e-182">8 виртуальных ЦП (2 сокета * 4 ядра с частотой 2,5 ГГц), 12 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="9cd0e-182">8 vCPUs (2 sockets * 4 cores @ 2.5 GHz), 12 GB memory</span></span> | <span data-ttu-id="9cd0e-183">600 ГБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-183">600 GB</span></span> | <span data-ttu-id="9cd0e-184">От 250 ГБ до 1 ТБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-184">250 GB to 1 TB</span></span> | <span data-ttu-id="9cd0e-185">Репликация от 85 до 150 компьютеров</span><span class="sxs-lookup"><span data-stu-id="9cd0e-185">Replicate between 85-150 machines.</span></span>
<span data-ttu-id="9cd0e-186">12 виртуальных ЦП (2 сокета * 6 ядер с частотой 2,5 ГГц), 18 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="9cd0e-186">12 vCPUs (2 sockets * 6 cores @ 2.5 GHz), 18 GB memory</span></span> | <span data-ttu-id="9cd0e-187">12 виртуальных ЦП (2 сокета * 6 ядер с частотой 2,5 ГГц), 24 ГБ памяти</span><span class="sxs-lookup"><span data-stu-id="9cd0e-187">12 vCPUs (2 sockets * 6 cores @ 2.5 GHz) 24 GB memory</span></span> | <span data-ttu-id="9cd0e-188">1 TБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-188">1 TB</span></span> | <span data-ttu-id="9cd0e-189">От 1 ТБ до 2 ТБ</span><span class="sxs-lookup"><span data-stu-id="9cd0e-189">1 TB to 2 TB</span></span> | <span data-ttu-id="9cd0e-190">Репликация от 150 до 225 компьютеров</span><span class="sxs-lookup"><span data-stu-id="9cd0e-190">Replicate between 150-225 machines.</span></span>

<span data-ttu-id="9cd0e-191">Способ масштабирования серверов будет зависеть от выбора модели увеличения масштаба и развертывания.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-191">The way in which you scale your servers depends on your preference for a scale-up or scale-out model.</span></span>  <span data-ttu-id="9cd0e-192">Вы можете увеличить масштаб, развернув несколько современных серверов конфигурации и обработки, или выполнить развертывание, развернув несколько серверов с меньшим объемом ресурсов.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-192">You scale up by deploying a few high-end configuration and process servers, or scale out by deploying more servers with fewer resources.</span></span> <span data-ttu-id="9cd0e-193">Например, чтобы защитить 220 компьютеров, можно применить одну из следующих рекомендаций.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-193">For example, if you need to protect 220 machines, you could do either of the following:</span></span>

* <span data-ttu-id="9cd0e-194">Настроить сервер конфигурации с 12 виртуальными ЦП и памятью объемом 18 ГБ, дополнительный сервер обработки с 12 виртуальными ЦП и памятью объемом 24 ГБ,</span><span class="sxs-lookup"><span data-stu-id="9cd0e-194">Set up the configuration server with 12 vCPU, 18 GB of memory, and an additional process server with 12 vCPU, 24 GB of memory.</span></span> <span data-ttu-id="9cd0e-195">а также защищенные компьютеры для использования только дополнительного сервера обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-195">Configure protected machines to use the additional process server only.</span></span>
* <span data-ttu-id="9cd0e-196">Настроить два сервера конфигурации (8 виртуальных ЦП и 16 ГБ ОЗУ в каждом), два дополнительных сервера обработки (8 виртуальных ЦП в одном и 4 виртуальных ЦП, что позволит обрабатывать 220 (135 + 85) компьютеров)</span><span class="sxs-lookup"><span data-stu-id="9cd0e-196">Set up two configuration servers (2 x 8 vCPU, 16 GB RAM) and two additional process servers (1 x 8 vCPU and 4 vCPU x 1 to handle 135 + 85 [220] machines).</span></span> <span data-ttu-id="9cd0e-197">и указать, что защищенные компьютеры должны использовать только дополнительные серверы обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-197">Configure protected machines to use the additional process servers only.</span></span>


## <a name="control-network-bandwidth"></a><span data-ttu-id="9cd0e-198">Управление пропускной способностью сети</span><span class="sxs-lookup"><span data-stu-id="9cd0e-198">Control network bandwidth</span></span>

<span data-ttu-id="9cd0e-199">После того как [планировщик ресурсов](site-recovery-deployment-planner.md) рассчитает пропускную способность, необходимую для репликации (начальной и разностной), вы можете управлять объемом пропускной способности, используемой для репликации. Для этого существует несколько способов:</span><span class="sxs-lookup"><span data-stu-id="9cd0e-199">After you've used the [the Deployment Planner tool](site-recovery-deployment-planner.md) to calculate the bandwidth you need for replication (the initial replication and then delta), you can control the amount of bandwidth used for replication using a couple of options:</span></span>

* <span data-ttu-id="9cd0e-200">**Регулирование пропускной способности**. Трафик VMware, который реплицируется в Azure, проходит через определенный сервер обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-200">**Throttle bandwidth**: VMware traffic that replicates to Azure goes through a specific process server.</span></span> <span data-ttu-id="9cd0e-201">Пропускную способность можно регулировать на компьютерах, которые служат серверами обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-201">You can throttle bandwidth on the machines running as process servers.</span></span>
* <span data-ttu-id="9cd0e-202">**Изменение пропускной способности.** Пропускную способность, используемую для репликации, можно изменить с помощью нескольких разделов реестра:</span><span class="sxs-lookup"><span data-stu-id="9cd0e-202">**Influence bandwidth**: You can influence the bandwidth used for replication by using a couple of registry keys:</span></span>
  * <span data-ttu-id="9cd0e-203">Значение реестра **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\UploadThreadsPerVM** задает количество потоков, используемых для передачи данных диска (для начальной или разностной репликации данных).</span><span class="sxs-lookup"><span data-stu-id="9cd0e-203">The **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\UploadThreadsPerVM** registry value specifies the number of threads that are used for data transfer (initial or delta replication) of a disk.</span></span> <span data-ttu-id="9cd0e-204">Если задать высокое значение, пропускная способность сети, используемая для репликации, увеличивается.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-204">A higher value increases the network bandwidth used for replication.</span></span>
  * <span data-ttu-id="9cd0e-205">Значение **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\DownloadThreadsPerVM** задает количество потоков, используемых для передачи данных при восстановлении размещения.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-205">The **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\DownloadThreadsPerVM** specifies the number of threads used for data transfer during failback.</span></span>

### <a name="throttle-bandwidth"></a><span data-ttu-id="9cd0e-206">Регулирование пропускной способности</span><span class="sxs-lookup"><span data-stu-id="9cd0e-206">Throttle bandwidth</span></span>

1. <span data-ttu-id="9cd0e-207">Откройте оснастку MMC в службе архивации Azure на компьютере, который выступает в качестве сервера обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-207">Open the Azure Backup MMC snap-in on the machine acting as the process server.</span></span> <span data-ttu-id="9cd0e-208">По умолчанию ярлык для службы архивации расположен на рабочем столе или в папке C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-208">By default, a shortcut for Backup is available on the desktop, or in the following folder: C:\Program Files\Microsoft Azure Recovery Services Agent\bin\wabadmin.</span></span>
2. <span data-ttu-id="9cd0e-209">В оснастке щелкните **Изменить свойства**.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-209">In the snap-in, click **Change Properties**.</span></span>

    ![Снимок экрана с параметром оснастки MMC в службе архивации Azure для изменения свойств](./media/site-recovery-vmware-to-azure/throttle1.png)
3. <span data-ttu-id="9cd0e-211">На вкладке **Регулирование** установите флажок **Разрешить регулирование уровня использования пропускной способности канала для операций резервного копирования**.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-211">On the **Throttling** tab, select **Enable internet bandwidth usage throttling for backup operations**.</span></span> <span data-ttu-id="9cd0e-212">Задайте ограничения для рабочего и нерабочего времени.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-212">Set the limits for work and non-work hours.</span></span> <span data-ttu-id="9cd0e-213">Допустимы значения в диапазоне от 512 Кбит/с до 102 Мбит/с.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-213">Valid ranges are from 512 Kbps to 102 Mbps per second.</span></span>

    ![Снимок экрана с диалоговым окном свойства службы архивации Azure](./media/site-recovery-vmware-to-azure/throttle2.png)

<span data-ttu-id="9cd0e-215">Чтобы настроить регулирование, можно также использовать командлет [Set-OBMachineSetting](https://technet.microsoft.com/library/hh770409.aspx) .</span><span class="sxs-lookup"><span data-stu-id="9cd0e-215">You can also use the [Set-OBMachineSetting](https://technet.microsoft.com/library/hh770409.aspx) cmdlet to set throttling.</span></span> <span data-ttu-id="9cd0e-216">Рассмотрим пример:</span><span class="sxs-lookup"><span data-stu-id="9cd0e-216">Here's a sample:</span></span>

    $mon = [System.DayOfWeek]::Monday
    $tue = [System.DayOfWeek]::Tuesday
    Set-OBMachineSetting -WorkDay $mon, $tue -StartWorkHour "9:00:00" -EndWorkHour "18:00:00" -WorkHourBandwidth  (512*1024) -NonWorkHourBandwidth (2048*1024)

<span data-ttu-id="9cd0e-217">**Set-OBMachineSetting -NoThrottle** указывает, что регулирование не требуется.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-217">**Set-OBMachineSetting -NoThrottle** indicates that no throttling is required.</span></span>

### <a name="influence-network-bandwidth-for-a-vm"></a><span data-ttu-id="9cd0e-218">Изменение пропускной способности сети для виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="9cd0e-218">Influence network bandwidth for a VM</span></span>

1. <span data-ttu-id="9cd0e-219">В реестре виртуальной машины перейдите в раздел **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication**.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-219">In the VM's registry, navigate to **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Azure Backup\Replication**.</span></span>
   * <span data-ttu-id="9cd0e-220">Чтобы изменить скорость передачи данных при репликации диска, задайте новое значение для раздела **UploadThreadsPerVM** или создайте его, если он еще не существует.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-220">To influence the bandwidth traffic on a replicating disk, modify the value of **UploadThreadsPerVM**, or create the key if it doesn't exist.</span></span>
   * <span data-ttu-id="9cd0e-221">Чтобы изменить скорость передачи данных при восстановлении размещения из Azure, задайте новое значение для раздела **DownloadThreadsPerVM**.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-221">To influence the bandwidth for failback traffic from Azure, modify the value of **DownloadThreadsPerVM**.</span></span>
2. <span data-ttu-id="9cd0e-222">Значение по умолчанию — 4.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-222">The default value is 4.</span></span> <span data-ttu-id="9cd0e-223">В сети со значительным избыточным резервом для этих разделов реестра необходимо изменить значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-223">In an “overprovisioned” network, these registry keys should be changed from the default values.</span></span> <span data-ttu-id="9cd0e-224">Максимальное значение — 32.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-224">The maximum is 32.</span></span> <span data-ttu-id="9cd0e-225">Следите за трафиком для оптимизации значения.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-225">Monitor traffic to optimize the value.</span></span>


## <a name="deploy-additional-process-servers"></a><span data-ttu-id="9cd0e-226">Развертывание дополнительных серверов обработки</span><span class="sxs-lookup"><span data-stu-id="9cd0e-226">Deploy additional process servers</span></span>

<span data-ttu-id="9cd0e-227">Если вы увеличите развертывание так, что количество компьютеров-источников превысит 200 или объем ежедневно изменяемых данных превысит 2 ТБ, для обработки такой нагрузки потребуются дополнительные серверы обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-227">If you have to scale out your deployment beyond 200 source machines, or you have a total daily churn rate of more than 2 TB, you need additional process servers to handle the traffic volume.</span></span> <span data-ttu-id="9cd0e-228">Выполните эти инструкции, чтобы настроить сервер обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-228">Follow these instructions to set up the process server.</span></span> <span data-ttu-id="9cd0e-229">После настройки сервера необходимо перевести исходные компьютеры на его использование.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-229">After setting up the server, you migrate source machines to use it.</span></span>

1. <span data-ttu-id="9cd0e-230">Выберите **Site Recovery servers** (Серверы Site Recovery), щелкните сервер конфигурации и пункт **Сервер обработки**.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-230">In **Site Recovery servers**, click the configuration server, and then click **Process Server**.</span></span>

    ![Снимок экрана с параметром Site Recovery servers (Серверы Site Recovery) для добавления сервера обработки](./media/site-recovery-vmware-to-azure/migrate-ps1.png)
2. <span data-ttu-id="9cd0e-232">В поле **Тип сервера** щелкните **Process server (on-premises)** (Сервер обработки (локальный)).</span><span class="sxs-lookup"><span data-stu-id="9cd0e-232">In **Server type**, click **Process server (on-premises)**.</span></span>

    ![Снимок экрана с диалоговым окном "Сервер обработки"](./media/site-recovery-vmware-to-azure/migrate-ps2.png)
3. <span data-ttu-id="9cd0e-234">Скачайте файл единой установки Site Recovery и запустите его, чтобы установить сервер обработки</span><span class="sxs-lookup"><span data-stu-id="9cd0e-234">Download the Site Recovery Unified Setup file, and run it to install the process server.</span></span> <span data-ttu-id="9cd0e-235">и зарегистрировать его в хранилище.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-235">This also registers it in the vault.</span></span>
4. <span data-ttu-id="9cd0e-236">На странице **Перед началом работы** выберите **Add additional process servers to scale out deployment** (Добавить дополнительные серверы обработки для масштабирования развертывания).</span><span class="sxs-lookup"><span data-stu-id="9cd0e-236">In **Before you begin**, select **Add additional process servers to scale out deployment**.</span></span>
5. <span data-ttu-id="9cd0e-237">Завершите работу мастера так же, как и при [настройке](#step-2-set-up-the-source-environment) сервера конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-237">Complete the wizard in the same way you did when you [set up](#step-2-set-up-the-source-environment) the configuration server.</span></span>

    ![Снимок экрана с мастером единой установки Azure Site Recovery](./media/site-recovery-vmware-to-azure/add-ps1.png)
6. <span data-ttu-id="9cd0e-239">На странице **Сведения о сервере конфигурации** укажите IP-адрес сервера конфигурации и парольную фразу.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-239">In **Configuration Server Details**, specify the IP address of the configuration server, and the passphrase.</span></span> <span data-ttu-id="9cd0e-240">Чтобы получить парольную фразу, выполните на сервере конфигурации команду **<папка_установки_Site_Recovery>\home\sysystems\bin\genpassphrase.exe –n**.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-240">To obtain the passphrase, run **[SiteRecoveryInstallationFolder]\home\sysystems\bin\genpassphrase.exe –n** on the configuration server.</span></span>

    ![Снимок экрана со страницей сведений о сервере конфигурации](./media/site-recovery-vmware-to-azure/add-ps2.png)

### <a name="migrate-machines-to-use-the-new-process-server"></a><span data-ttu-id="9cd0e-242">Перенос компьютеров для использования нового сервера обработки</span><span class="sxs-lookup"><span data-stu-id="9cd0e-242">Migrate machines to use the new process server</span></span>
1. <span data-ttu-id="9cd0e-243">В разделе **Параметры** > **Серверы Site Recovery** щелкните сервер конфигурации и разверните список **Серверы обработки**.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-243">In **Settings** > **Site Recovery servers**, click the configuration server, and then expand **Process servers**.</span></span>

    ![Снимок экрана с диалоговым окном "Сервер обработки"](./media/site-recovery-vmware-to-azure/migrate-ps2.png)
2. <span data-ttu-id="9cd0e-245">Щелкните используемый сервер обработки правой кнопкой мыши и выберите **Переключить**.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-245">Right-click the process server currently in use, and click **Switch**.</span></span>

    ![Снимок экрана с диалоговым окном "Сервер конфигурации"](./media/site-recovery-vmware-to-azure/migrate-ps3.png)
3. <span data-ttu-id="9cd0e-247">В поле **Выбор целевого сервера обработки** выберите новый сервер обработки, который нужно использовать, а затем — виртуальные машины, с которыми он будет работать.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-247">In **Select target process server**, select the new process server you want to use, and then select the virtual machines that the server will handle.</span></span> <span data-ttu-id="9cd0e-248">Щелкните значок сведений, чтобы получить сведения о сервере.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-248">Click the information icon to get information about the server.</span></span> <span data-ttu-id="9cd0e-249">Чтобы помочь принять решение о скачивании, отображается средний объем свободного места, требуемый для репликации каждой выбранной виртуальной машины на новом сервере обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-249">To help you make load decisions, the average space that's needed to replicate each selected virtual machine to the new process server is displayed.</span></span> <span data-ttu-id="9cd0e-250">Щелкните значок галочки, чтобы начать репликацию на новом сервере обработки.</span><span class="sxs-lookup"><span data-stu-id="9cd0e-250">Click the check mark to start replicating to the new process server.</span></span>


## <a name="next-steps"></a><span data-ttu-id="9cd0e-251">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="9cd0e-251">Next steps</span></span>

<span data-ttu-id="9cd0e-252">Скачайте и запустите [планировщик ресурсов Azure Site Recovery](https://aka.ms/asr-deployment-planner)</span><span class="sxs-lookup"><span data-stu-id="9cd0e-252">Download and run the [Azure Site Recovery Deployment Planner](https://aka.ms/asr-deployment-planner)</span></span>
