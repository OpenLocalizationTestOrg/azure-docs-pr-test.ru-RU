---
title: "активы aaaSecuring Azure CDN с помощью маркера проверки подлинности | Документы Microsoft"
description: "С помощью проверки подлинности маркера toosecure доступа tooyour Azure CDN активы."
services: cdn
documentationcenter: .net
author: zhangmanling
manager: zhangmanling
editor: 
ms.assetid: 837018e3-03e6-4f9c-a23e-4b63d5707a64
ms.service: cdn
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.date: 11/11/2016
ms.author: mezha
ms.openlocfilehash: 5865bcb8eed7ced834970d52d30136252039265f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="securing-azure-cdn-assets-with-token-authentication"></a>Защита ресурсов Azure CDN с помощью аутентификации на основе маркеров

[!INCLUDE [cdn-premium-feature](../../includes/cdn-premium-feature.md)]

##<a name="overview"></a>Обзор

Маркер проверки подлинности — это механизм, позволяет tooprevent Azure CDN из обслуживание активы toounauthorized клиентов.  Обычно это делается tooprevent «hotlinking» содержимого, где другой сайт часто доске объявлений, использует активов без разрешения.  Это может повлиять на стоимость предоставления содержимого. Включить этот компонент в CDN, запросы будут проходить проверку подлинности CDN край извлекает перед доставкой содержимого hello. 

## <a name="how-it-works"></a>Принцип работы

Маркер проверки подлинности проверяет запросы созданных надежных сайтов, требуя toocontain запросов значение токена, содержащий закодированную информацию о запрашивающей стороне hello. Содержимое будет только поступать toorequester hello формате сведения hello соответствует требованиям, в противном случае запросы будут отклоняться. Можно настроить hello требования, используя один или несколько параметров ниже.

- Страна. Разрешение или отклонение запросов, отправленных из конкретных стран.  [Список допустимых кодов стран.](https://msdn.microsoft.com/library/mt761717.aspx) 
- URL-адрес: разрешить только указанный toorequest активов или путь.  
- Узел: разрешить или запретить запросы с использованием указанных узлах в заголовке запроса hello.
- Источник ссылки: разрешить или запретить toorequest указанного источника ссылки.
- IP-адрес. Разрешение запросов, отправленных только с конкретного IP-адреса или IP-подсети.
- Протокол: разрешить или блокировать запросы на основе протокола hello использования toorequest hello содержимого.
- Время истечения срока действия: задать дату и время периода tooensure, что ссылка только действует в течение ограниченного периода времени.

Ознакомьтесь с примером подробной конфигурации каждого параметра.

## <a name="reference-architecture"></a>Эталонная архитектура

См. ниже Эталонная архитектура настройки проверки подлинности маркера на toowork CDN с веб-приложения.

![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-workflow2.png)

## <a name="token-validation-logic-on-cdn-endpoint"></a>Логика проверки маркеров в конечной точке CDN
    
На этой схеме представлены сведения о том, как Azure CDN проверяет запросы клиентов при настройке аутентификации на основе маркеров в конечной точке CDN.

![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-validation-logic.png)

## <a name="setting-up-token-authentication"></a>Настройка аутентификации на основе маркеров

1. Из hello [портал Azure](https://portal.azure.com), Обзор профиля CDN tooyour и нажмите кнопку hello **управление** кнопку toolaunch hello дополнительном портале.

    ![Кнопка управления в колонке профиля CDN](./media/cdn-rules-engine/cdn-manage-btn.png)

2. Наведите указатель мыши на **HTTP больших**и нажмите кнопку **токена проверки подлинности** в раскрывающейся hello. На этой вкладке вы настроите ключ и параметры шифрования.

    1. В поле **Первичный ключ** введите уникальный ключ шифрования.  В поле **Backup Key** (Резервный ключ) введите другой ключ.

        ![Настройка ключей для аутентификации на основе маркеров CDN](./media/cdn-token-auth/cdn-token-auth-setupkey.png)
    
    2. Настройте параметры шифрования с помощью инструмента шифрования (Разрешение или отклонение запросов с учетом времени истечения срока действия, страны, источника ссылки, протокола, IP-адреса клиента. Вы можете использовать любую комбинацию.).

        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-encrypttool.png)

        - ec-expire назначает срок действия маркера после указанного периода времени. Запросов, переданных после истечения срока действия hello будет запрещен. Этот параметр использует метку времени Unix (С учетом секунд, прошедших с начала стандартной эры — 1 января 1970 г., 00:00:00 по Гринвичу. Ее можно использовать онлайн-инструментами tooprovide преобразование между стандартным и временем Unix).  Например, если необходимо tooset toobe маркера hello просрочен на 12/31/2016 12:00:00 по Гринвичу, использовать время Unix hello: 1483185600, как показано ниже:
    
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-expire2.png)
    
        - Разрешить EC URL-адрес: позволяет tootailor маркеры tooa конкретного средства или путь. Оно ограничивает количество toorequests доступ, URL-адрес будет начинаться с определенной относительный путь. Вы можете указать несколько путей через запятую. В URL-адресах учитывается регистр. В зависимости от требований hello можно настроить другое значение tooprovide другой уровень доступа. Ниже приведены несколько сценариев.
        
            Для URL-адреса http://www.mydomain.com/pictures/city/strasbourg.png будут использоваться следующие входные значения и уровни доступа:

            1. Входное значение "/"— все запросы разрешаются.
            2. Входное значение «/ изображений»: разрешает все hello, следующие запросы
            
                - http://www.mydomain.com/pictures.png;
                - http://www.mydomain.com/pictures/city/strasbourg.png;
                - http://www.mydomain.com/picturesnew/city/strasbourgh.png.
            3. Входное значение /pictures/ — разрешаются запросы только для /pictures/.
            4. Входное значение /pictures/city/strasbourg.png — разрешаются запросы только для этого ресурса.
    
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-url-allow4.png)
    
        - ec-country-allow разрешает запросы, отправленные из одной или нескольких указанных стран. Запросы, отправленные из других стран, будут отклоняться. Используйте tooset код страны параметры hello и разделив каждого кода страны запятой. Например следует tooallow доступ из США и Франции ввода (США), FR в столбце hello в качестве ниже.  
        
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-country-allow.png)

        - ec-country-deny отклоняет запросы, отправленные из одной или нескольких указанных стран. Запросы, отправленные из других стран, будут разрешаться. Используйте tooset код страны параметры hello и разделив каждого кода страны запятой. Например если вы хотите получить доступ toodeny из США и Франции, ввода US, FR в столбце hello.
    
        - ec-ref-allow разрешает запросы только из указанного источника ссылки. Источник ссылки идентифицирует hello URL-адрес веб-страницы приветствия, связанного запрашиваемого ресурса toohello. значение параметра referrer Hello не должен включать протокол hello. Вы можете ввести имя узла и/или конкретный путь для этого имени узла. Кроме того, можно добавить несколько источников ссылки в одном параметре через запятую. Если указано значение источника ссылки, но hello referrer сведения не отправляются в запросе hello из-за конфигурации обозревателя toosome, эти запросы будут отклоняться по умолчанию. Эти запросы с отсутствующим referrer сведения можно назначить «Missing» или пустые значения в параметр tooallow hello. Можно также использовать «*. consoto.com» tooallow consoto.com все поддомены.  Например если требуется tooallow доступ для запросов из www.consoto.com, всем поддоменам в consoto2.com и erquests с reffers пустые или отсутствующие ввода значение ниже:
        
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-referrer-allow2.png)
    
        - ec-ref-deny отклоняет запросы из указанного источника ссылки. См. пример в параметре «ec-ref разрешить» и toodetails.
         
        - ec-proto-allow разрешает запросы, полученные только по указанному протоколу. Например, http или https.
        
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-url-allow4.png)
            
        - ec-proto-deny разрешает запросы, полученные по указанному протоколу. Например, http или https.
    
        - адреса clientip EC: ограничивает доступ toospecified инициатора IP-адрес. Поддерживаются протоколы IPV4 и IPV6. Вы можете указать один IP-адрес запроса или IP-подсеть.
            
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-clientip.png)
        
    3. Можно проверить срок действия токена с помощью средства расшифровку hello.

    4. Можно также настроить hello тип ответа, будут возвращены toouser, когда не удается выполнить запрос. По умолчанию используется ответ 403.

3. Теперь щелкните вкладку **Подсистема правил** в разделе **HTTP Large** (Большой HTTP-объект). Будет используйте вкладку toodefine пути tooapply hello, включить функцию проверки подлинности маркера hello и включить возможности, связанные с дополнительной проверки подлинности маркера.

    - Используйте средства toodefine столбец «IF» или путь будет tooapply токена проверки подлинности. 
    - Щелкните tooadd «Токена проверки подлинности» hello функция раскрывающийся список tooenable токена проверки подлинности.
        
    ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-rules-engine-enable2.png)

4. В hello **обработчик правил** имеются несколько дополнительных возможностей, которые можно включить.
    
    - Токен отказ код проверки подлинности: Определяет тип hello ответа, который будет возвращен toouser, когда не удается выполнить запрос. Правила, установленные здесь переопределит hello отказ кода hello вкладке токена проверки подлинности.
    - Игнорировать токена проверки подлинности: Определяет, будет ли токен toovalidate URL-адрес с учетом регистра.
    - Параметр токена проверки подлинности: переименование строковый параметр, показывающую hello запрошенный URL-адрес запроса проверки подлинности маркеров hello. 
        
    ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-rules-engine2.png)

5. Вы можете настроить маркер, который является приложением, создающим маркер для возможностей аутентификации на основе маркеров. Исходный код доступен на [портале GitHub](https://github.com/VerizonDigital/ectoken).
Доступны такие языки:
    
    - C
    - C#
    - PHP
    - Perl;
    - Java
    - Python    


## <a name="azure-cdn-features-and-provider-pricing"></a>Цены поставщиков на возможности Azure CDN

В разделе hello [Обзор CDN](cdn-overview.md) раздела.
