---
title: "Защита ресурсов Azure CDN с помощью аутентификации на основе маркеров | Документация Майкрософт"
description: "Обеспечение безопасного доступа к ресурсам Azure CDN с помощью аутентификации на основе маркеров."
services: cdn
documentationcenter: .net
author: zhangmanling
manager: zhangmanling
editor: 
ms.assetid: 837018e3-03e6-4f9c-a23e-4b63d5707a64
ms.service: cdn
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.date: 11/11/2016
ms.author: mezha
ms.openlocfilehash: 42b182c314795b1ebf69639ec7ac5583208dc7c1
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="securing-azure-cdn-assets-with-token-authentication"></a>Защита ресурсов Azure CDN с помощью аутентификации на основе маркеров

[!INCLUDE [cdn-premium-feature](../../includes/cdn-premium-feature.md)]

##<a name="overview"></a>Обзор

Аутентификации на основе маркеров — это механизм, позволяющий предотвратить доступ неавторизованных клиентов к ресурсам Azure CDN.  Обычно это делается во избежание создания активных ссылок на содержимое. В этом случае другой сайт (зачастую это доска сообщений) использует ваши ресурсы без разрешения.  Это может повлиять на стоимость предоставления содержимого. При включении этой функции в CDN перед предоставлением содержимого запросы будут проходить аутентификацию в граничных точках входа в сеть CDN. 

## <a name="how-it-works"></a>Принцип работы

При аутентификации на основе маркеров проверяется, отправлены ли запросы с доверенного сайта. Для этого запросы должны содержать значение маркера, содержащего закодированные сведения об инициаторе запроса. Содержимое передается инициатору запроса, только если сведения соответствуют требованиям. В противном случае запросы будут отклоняться. Требования можно настроить, используя один или несколько параметров ниже.

- Страна. Разрешение или отклонение запросов, отправленных из конкретных стран.  [Список допустимых кодов стран.](https://msdn.microsoft.com/library/mt761717.aspx) 
- URL-адрес. Разрешение только указанных ресурсов или пути для запроса.  
- Узел. Разрешение или отклонение запросов, в заголовке которых используются указанные узлы.
- Источник ссылки. Разрешение или отклонение указанного источника ссылки для запроса.
- IP-адрес. Разрешение запросов, отправленных только с конкретного IP-адреса или IP-подсети.
- Протокол. Разрешение или блокирование запросов на основе протокола, использованного для запроса содержимого.
- Время истечения срока действия. Задайте дату и время, чтобы убедиться, что ссылка будет действовать только в течение ограниченного периода времени.

Ознакомьтесь с примером подробной конфигурации каждого параметра.

## <a name="reference-architecture"></a>Эталонная архитектура

Ниже представлена эталонная архитектура настройки аутентификации на основе маркеров в сети CDN для работы с веб-приложением.

![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-workflow2.png)

## <a name="token-validation-logic-on-cdn-endpoint"></a>Логика проверки маркеров в конечной точке CDN
    
На этой схеме представлены сведения о том, как Azure CDN проверяет запросы клиентов при настройке аутентификации на основе маркеров в конечной точке CDN.

![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-validation-logic.png)

## <a name="setting-up-token-authentication"></a>Настройка аутентификации на основе маркеров

1. На [портале Azure](https://portal.azure.com) перейдите к профилю CDN и нажмите кнопку **Управление** для запуска дополнительного портала.

    ![Кнопка управления в колонке профиля CDN](./media/cdn-rules-engine/cdn-manage-btn.png)

2. Наведите указатель мыши на элемент **HTTP Large** (Большой HTTP-объект) и щелкните **Token Auth** (Аутентификация на основе маркеров) во всплывающем элементе. На этой вкладке вы настроите ключ и параметры шифрования.

    1. В поле **Первичный ключ** введите уникальный ключ шифрования.  В поле **Backup Key** (Резервный ключ) введите другой ключ.

        ![Настройка ключей для аутентификации на основе маркеров CDN](./media/cdn-token-auth/cdn-token-auth-setupkey.png)
    
    2. Настройте параметры шифрования с помощью инструмента шифрования (Разрешение или отклонение запросов с учетом времени истечения срока действия, страны, источника ссылки, протокола, IP-адреса клиента. Вы можете использовать любую комбинацию.).

        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-encrypttool.png)

        - ec-expire назначает срок действия маркера после указанного периода времени. Запросы, отправленные после истечения срока действия, будут отклоняться. Этот параметр использует метку времени Unix (С учетом секунд, прошедших с начала стандартной эры — 1 января 1970 г., 00:00:00 по Гринвичу. Преобразование стандартного времени и Unix-времени можно осуществлять с помощью онлайн-инструментов.).  Например, если вы хотите, чтобы срок действия маркера истек 31 декабря 2016 г. в 12:00:00 по Гринвичу, используйте значение Unix-времени 1483185600, как показано ниже:
    
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-expire2.png)
    
        - ec-url-allow позволяет настраивать маркеры для определенного ресурса или пути. Этот параметр ограничивает доступ к запросам, URL-адрес которых начинается с определенного относительного пути. Вы можете указать несколько путей через запятую. В URL-адресах учитывается регистр. В зависимости от требований можно настроить разные значения для обеспечения различных уровней доступа. Ниже приведены несколько сценариев.
        
            Для URL-адреса http://www.mydomain.com/pictures/city/strasbourg.png будут использоваться следующие входные значения и уровни доступа:

            1. Входное значение "/"— все запросы разрешаются.
            2. Входное значение /pictures — разрешаются следующие запросы:
            
                - http://www.mydomain.com/pictures.png;
                - http://www.mydomain.com/pictures/city/strasbourg.png;
                - http://www.mydomain.com/picturesnew/city/strasbourgh.png.
            3. Входное значение /pictures/ — разрешаются запросы только для /pictures/.
            4. Входное значение /pictures/city/strasbourg.png — разрешаются запросы только для этого ресурса.
    
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-url-allow4.png)
    
        - ec-country-allow разрешает запросы, отправленные из одной или нескольких указанных стран. Запросы, отправленные из других стран, будут отклоняться. Используйте код страны для настройки параметров и разделите каждый код страны запятыми. Например, если вы хотите разрешить доступ из США и Франции, введите US, FR в столбце, как показано ниже.  
        
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-country-allow.png)

        - ec-country-deny отклоняет запросы, отправленные из одной или нескольких указанных стран. Запросы, отправленные из других стран, будут разрешаться. Используйте код страны для настройки параметров и разделите каждый код страны запятыми. Например, если вы хотите запретить доступ из США и Франции, введите US, FR в столбце.
    
        - ec-ref-allow разрешает запросы только из указанного источника ссылки. Источник ссылки определяет URL-адрес веб-страницы, связанной с запрашиваемым ресурсом. Значение параметра источника ссылки не должно содержать протокол. Вы можете ввести имя узла и/или конкретный путь для этого имени узла. Кроме того, можно добавить несколько источников ссылки в одном параметре через запятую. Если значение источника ссылки указано, но сведения о нем не отправляются в запрос из-за конфигурации браузера, эти запросы будут отклоняться по умолчанию. Вы можете назначить значение, помеченное как отсутствующее, или пустое значение в параметре, чтобы разрешить эти запросы без сведений об источнике ссылки. Кроме того, можно указать *.consoto.com, чтобы разрешить все поддомены consoto.com.  Например, если вы хотите разрешить доступ для запросов от www.consoto.com, всех поддоменов consoto2.com, а также запросов, в которых не указаны источники ссылки или они пустые, введите значение ниже:
        
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-referrer-allow2.png)
    
        - ec-ref-deny отклоняет запросы из указанного источника ссылки. Ознакомьтесь со сведениями и примером параметра ec-ref-allow.
         
        - ec-proto-allow разрешает запросы, полученные только по указанному протоколу. Например, http или https.
        
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-url-allow4.png)
            
        - ec-proto-deny разрешает запросы, полученные по указанному протоколу. Например, http или https.
    
        - ec-clientip ограничивает доступ к IP-адресу указанного инициатора запроса. Поддерживаются протоколы IPV4 и IPV6. Вы можете указать один IP-адрес запроса или IP-подсеть.
            
        ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-token-auth-clientip.png)
        
    3. Маркер можно проверить с помощью инструмента расшифровки.

    4. Кроме того, можно настроить тип ответа, возвращаемого пользователю при отклонении запроса. По умолчанию используется ответ 403.

3. Теперь щелкните вкладку **Подсистема правил** в разделе **HTTP Large** (Большой HTTP-объект). На этой вкладке можно определить путь для применения функции, включить функцию аутентификации на основе маркеров, а также включить дополнительные возможности, связанные с этой функцией.

    - В столбце IF можно определить ресурс или путь, к которым нужно применить аутентификацию на основе маркеров. 
    - Щелкните, чтобы выбрать аутентификацию на основе маркеров в раскрывающемся списке компонентов и включить соответствующую функцию.
        
    ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-rules-engine-enable2.png)

4. На вкладке **Подсистема правил** есть несколько дополнительных возможностей, которые можно включить.
    
    - Параметр Token auth denial code (Код отказа при аутентификации на основе маркеров) определяет тип ответа, возвращаемого пользователю при отклонении запроса. Правила, заданные здесь, переопределяют параметр кода отказа на вкладке аутентификации на основе маркеров.
    - Параметр Token auth ignore (Не учитывать регистр при аутентификации на основе маркеров) определяет, будет ли учитываться регистр в URL-адресе, используемом для проверки маркера.
    - Параметр Token auth parameter (Параметр аутентификации на основе маркеров) переименовывает параметр строки запроса аутентификации на основе маркеров, отображающийся в запрошенном URL-адресе. 
        
    ![Кнопка управления в колонке профиля CDN](./media/cdn-token-auth/cdn-rules-engine2.png)

5. Вы можете настроить маркер, который является приложением, создающим маркер для возможностей аутентификации на основе маркеров. Исходный код доступен на [портале GitHub](https://github.com/VerizonDigital/ectoken).
Доступны такие языки:
    
    - C
    - C#
    - PHP
    - Perl;
    - Java
    - Python    


## <a name="azure-cdn-features-and-provider-pricing"></a>Цены поставщиков на возможности Azure CDN

Ознакомьтесь со статьей [Общие сведения о сети доставки содержимого(CDN) Azure](cdn-overview.md).
