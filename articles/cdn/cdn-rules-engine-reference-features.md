---
title: "Функции обработчика правил Azure CDN | Документация Майкрософт"
description: "Справочная документация по условиям соответствия и функциям обработчика правил Azure CDN."
services: cdn
documentationcenter: 
author: Lichard
manager: akucer
editor: 
ms.assetid: 669ef140-a6dd-4b62-9b9d-3f375a14215e
ms.service: cdn
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: rli
ms.openlocfilehash: 858bc1dd2880583a3283522a01c9a48679b76296
ms.sourcegitcommit: fa28ca091317eba4e55cef17766e72475bdd4c96
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2017
---
# <a name="azure-cdn-rules-engine-features"></a>Функции обработчика правил Azure CDN
В этой статье перечислены подробные описания доступных функций для Azure доставки содержимого сети (CDN) [обработчик правил](cdn-rules-engine.md).

Третья часть правила представляет собой функцию. Функция определяет тип действия, которое применяется к типу запроса определяется набор условий соответствия.

## <a name="access-features"></a>Функции доступа

Эти функции предназначены для управления доступом к содержимому.


ИМЯ | Назначение
-----|--------
[Запретить доступ (403)](#deny-access-403) | Определяет, отклоняются ли все запросы с ответом 403 (запрещено).
[Маркер проверки подлинности](#token-auth) | Определяет, применяется ли запрос на проверку подлинности на основе маркера.
[Код типа "отказ" токена проверки подлинности](#token-auth-denial-code) | Определяет тип ответ, который возвращается пользователю, когда запрос запрещен из-за проверки подлинности на основе маркеров.
[Маркер проверки подлинности не учитывать регистр URL-адрес](#token-auth-ignore-url-case) | Определяет, учитывается ли URL-адрес сравнения, выполненные с помощью проверки подлинности на основе маркеров.
[Параметр проверки подлинности маркера](#token-auth-parameter) | Определяет, должен ли быть переименован параметр строки запроса проверки подлинности на основе маркеров.


## <a name="caching-features"></a>Код функций кэширования

Эти функции предназначены для настройки времени и способа кэширования содержимого.

ИМЯ | Назначение
-----|--------
[Параметры пропускной способности](#bandwidth-parameters) | Определяет, активны ли параметры регулирования пропускной способности (например, ec_rate и ec_prebuf).
[Регулирование полосы пропускания](#bandwidth-throttling) | Регулирует пропускную способность для ответа, предоставляемые пограничные серверы.
[Кэш не используется](#bypass-cache) | Определяет, должен ли запрос обойти кэширование.
[Обработка заголовок Cache-Control](#cache-control-header-treatment) | Контролирует создание `Cache-Control` заголовков, с помощью пограничного сервера при активном компонентов внешних Max-Age.
[Строка запроса ключ кэша](#cache-key-query-string) | Определяет, будет ли ключ кэша включать или исключать параметры строки запроса, связанные с запросом.
[Перепишите ключ кэша](#cache-key-rewrite) | Перезаписывает ключ кэша, связанный с запросом.
[Завершения заполнения кэша](#complete-cache-fill) | Определяет, что происходит, когда результаты запроса в частичном кэше отсутствуют на пограничном сервере.
[Сжатие типов файлов](#compress-file-types) | Определяет форматы файлов, которые будут сжаты на сервере.
[По умолчанию внутренняя Max-Age](#default-internal-max-age) | Определяет интервал максимального срока по умолчанию для повторной сверки пограничного сервера с сервером-источником.
[Срок действия истекает обработки заголовка](#expires-header-treatment) | Контролирует создание `Expires` заголовков, с помощью пограничного сервера при активном компонент внешнего Max-Age.
[Внешние Max-Age](#external-max-age) | Определяет интервал максимального срока для повторной сверки браузера с пограничным сервером.
[Принудительно внутренней Max-Age](#force-internal-max-age) | Определяет интервал максимального срока для повторной сверки пограничного сервера с сервером-источником.
[Поддержка H.264 (HTTP последовательная загрузка)](#h264-support-http-progressive-download) | Определяет типы форматов файлов H.264, которые могут использоваться для потоковой передачи содержимого.
[Запрос No-Cache honor](#honor-no-cache-request) | Определяет, будут ли запросы без кэша HTTP-клиента перенаправляться на сервер-источник.
[Игнорировать источника No-Cache](#ignore-origin-no-cache) | Определяет, пропускаются ли CDN некоторые директивы, полученном из исходного сервера.
[Игнорировать невозможно удовлетворить диапазонов](#ignore-unsatisfiable-ranges) | Определяет, возвращаются клиенту в том случае, когда запрос приводит к возникновению ошибки 416 запрошенный диапазон невыполним код состояния ответа.
[Внутренняя Max устарело](#internal-max-stale) | Контролирует, как долго после обычного истечения срока действия кэшированный ресурс может обслуживаться с пограничного сервера, если пограничному серверу не удалось выполнить повторную сверку кэшированного ресурса с сервером-источником.
[Частичное кэширование для управления доступом](#partial-cache-sharing) | Определяет, может ли запрос создавать частично кэшированное содержимое.
[PreValidate кэшированное содержимое](#prevalidate-cached-content) | Определяет, подойдет ли кэшированное содержимое для ранней повторной сверки до истечения его срока действия.
[Обновить пустой кэш-файлы](#refresh-zero-byte-cache-files) | Определяет способ обработки запроса HTTP-клиента для актива кэша нулевым байтом, пограничные серверы.
[Коды состояния может быть кэширован](#set-cacheable-status-codes) | Определяет набор кодов состояния, которые могут привести к кэшированному содержимому.
[Устаревшие доставки содержимого в случае ошибки](#stale-content-delivery-on-error) | Определяет, будет ли доставлено содержимое с истекшим сроком при возникновении ошибки во время повторной сверки кэша или при получении запрошенного содержимого с сервера-источника клиента.
[Устаревшие при Revalidate](#stale-while-revalidate) | Повышает производительность, позволяя пограничных серверов для обслуживания запрашивающей стороне устаревших клиентов, пока выполняется повторная проверка.

## <a name="comment-feature"></a>Функции комментариев

Эта функция предназначена для предоставления дополнительных сведений в правиле.

ИМЯ | Назначение
-----|--------
[Comment](#comment) | Позволяет Примечание для добавления в правиле.
 
## <a name="header-features"></a>Функции заголовков

Эти функции предназначены для добавления, изменения или удаления заголовков из запроса или ответа.

ИМЯ | Назначение
-----|--------
[Заголовок ответа Age](#age-response-header) | Определяет, будет ли заголовок ответа Age включен в ответ, отправляемый запрашивающей стороне.
[Отладка заголовки ответа кэша](#debug-cache-response-headers) | Определяет, может ли ответ включать заголовок ответа X-EC-Debug, предоставляющий сведения о политику кэширования для запрошенного ресурса.
[Изменение заголовка запроса клиента](#modify-client-request-header) | Перезаписывает, добавляет или удаляет заголовок из запроса.
[Измените заголовок ответа клиента](#modify-client-response-header) | Перезаписывает, добавляет или удаляет заголовок из ответа.
[Задать пользовательский заголовок IP клиента](#set-client-ip-custom-header) | Позволяет добавлять IP-адрес запрашивающего клиента в запрос в качестве настраиваемого заголовка запроса.


## <a name="logging-features"></a>Ведение журналов

Эти функции предназначены для настройки данных, хранящихся в необработанных файлах журнала.

ИМЯ | Назначение
-----|--------
[Пользовательский журнал поле 1](#custom-log-field-1) | Определяет формат и содержимое, которое будет присвоено полю пользовательского журнала в необработанном файле журнала.
[Строка запроса журнала](#log-query-string) | Определяет, будет ли строка запроса сохранена вместе с URL-адресом в журналах доступа.


<!---
## Optimize

These features determine whether a request will undergo the optimizations provided by Edge Optimizer.

Name | Purpose
-----|--------
Edge Optimizer | Determines whether Edge Optimizer can be applied to a request.
Edge Optimizer – Instantiate Configuration | Instantiates or activates the Edge Optimizer configuration associated with a site.

###Edge Optimizer
**Purpose:** Determines whether Edge Optimizer can be applied to a request.

If this feature has been enabled, then the following criteria must also be met before the request will be processed by Edge Optimizer:

- The requested content must use an edge CNAME URL.
- The edge CNAME referenced in the URL must correspond to a site whose configuration has been activated in a rule.

This feature requires the ADN platform and the Edge Optimizer feature.

Value|Result
-|-
Enabled|Indicates that the request is eligible for Edge Optimizer processing.
Disabled|Restores the default behavior. The default behavior is to deliver content over the ADN platform without any additional processing.

**Default Behavior:** Disabled
 

###Edge Optimizer - Instantiate Configuration
**Purpose:** Instantiates or activates the Edge Optimizer configuration associated with a site.

This feature requires the ADN platform and the Edge Optimizer feature.

Key information:

- Instantiation of a site configuration is required before requests to the corresponding edge CNAME can be processed by Edge Optimizer.
- This instantiation only needs to be performed a single time per site configuration. A site configuration that has been instantiated will remain in that state until the Edge Optimizer – Instantiate Configuration feature that references it is removed from the rule.
- The instantiation of a site configuration does not mean that all requests to the corresponding edge CNAME will automatically be processed by Edge Optimizer. The Edge Optimizer feature determines whether an individual request will be processed.

If the desired site does not appear in the list, then you should edit its configuration and verify that the Active option has been marked.

**Default Behavior:** Site configurations are inactive by default.
--->

## <a name="origin-features"></a>Компоненты источника

Эти функции предназначены для управления способом взаимодействия CDN с сервером-источником.

ИМЯ | Назначение
-----|--------
[Максимальное число запросов активности](#maximum-keep-alive-requests) | Определяет максимальное количество запросов для проверки активности подключения до его закрытия.
[Специальные заголовки прокси-сервера](#proxy-special-headers) | Определяет набор заголовков запросов, относящихся к CDN, которые будут перенаправляться с пограничного сервера на сервер-источник.


## <a name="specialty-features"></a>Специальные возможности

Эти функции предоставляют дополнительные функции для опытных пользователей.

ИМЯ | Назначение
-----|--------
[Кэшируемый HTTP-методы](#cacheable-http-methods) | Определяет набор дополнительных методов HTTP, которые могут быть кэшированы в сети.
[Размер текста запроса, кэшируемого](#cacheable-request-body-size) | Определяет пороговое значение для определения возможности кэширования ответа POST.
[Пользовательская переменная](#user-variable) | Только для внутреннего использования.

 
## <a name="url-features"></a>URL-адрес функции

Эти функции позволяют перенаправлять или перезаписывать запрос на другой URL-адрес.

ИМЯ | Назначение
-----|--------
[Следовать перенаправлениям](#follow-redirects) | Определяет, можно ли перенаправлять запросы к имени узла, определенном в заголовке Location, возвращенным сервером-источником клиента.
[URL-адрес перенаправления](#url-redirect) | Перенаправляет запросы через заголовок Location.
[Перезапись URL-адреса](#url-rewrite)  | Перезаписывает URL-адрес запроса.



## <a name="azure-cdn-rules-engine-features-reference"></a>Справочник по возможности система Azure CDN правил

---
### <a name="age-response-header"></a>Заголовок ответа Age
**Назначение**: Определяет, включен ли заголовок ответа возраст в ответ инициатору.
Значение|Результат
--|--
Включено | Заголовок ответа возраст включается в ответ инициатору.
Отключено | Заголовок ответа возраст исключается ответ инициатору.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="bandwidth-parameters"></a>Параметры пропускной способности
**Назначение.** Определяет, будут ли активны параметры регулирования пропускной способности (например, ec_rate и ec_prebuf).

Параметры регулирования пропускной способности определяют, будет ли скорость передачи данных для запроса клиента ограничена до уровня пользовательской скорости.

Значение|Результат
--|--
Включено|Позволяет пограничных серверов на обработку запросы регулирования полосы пропускания.
Отключено|В результате пограничные серверы игнорировать параметры регулирования пропускной способности. Запрашиваемое содержимое будет предоставляться обычным способом (т. е. без регулирования пропускной способности).

**Поведение по умолчанию.** Включено.
 
[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="bandwidth-throttling"></a>Регулирование пропускной способности
**Назначение:** регулирует пропускную способность для ответа, предоставляемые пограничные серверы.

Чтобы надлежащим образом настроить регулирование пропускной способности, необходимо определить следующие параметры.

Параметр|ОПИСАНИЕ
--|--
Кбайт запросов в секунду|Присвойте этому параметру значение максимальной пропускной способности (в килобайтах в секунду), которое можно использовать для предоставления ответа.
Секунды Prebuf|Этот параметр можно задайте количество секунд для пограничных серверов подождать, пока регулирование пропускной способности. Этот период времени неограниченной пропускной способности предназначен для предотвращения возникновения перебоев в работе или проблем буферизации из-за регулирования пропускной способности в проигрывателе мультимедиа.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="bypass-cache"></a>Отключение кэша
**Назначение:** определяет, должен ли запрос обойти кэширование.

Значение|Результат
--|--
Включено|Приводит к тому, что все запросы переходят на сервер-источник, даже если содержимое ранее было кэшировано на пограничных серверах.
Отключено|Приводит к тому, что пограничные серверы кэшируют ресурсы в соответствии с политикой кэширования, определенной в заголовках ответов.

**Поведение по умолчанию:**

- **Большой HTTP-объект.** Отключено.

<!---
- **ADN:** Enabled

--->

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="cacheable-http-methods"></a>Кэшируемые методы HTTP
**Назначение:** определяет набор дополнительных методов HTTP, которые могут быть кэшированы в сети.

Основные сведения

- Эта функция предполагает, что все ответы GET всегда кэшируются. В результате метод GET HTTP не следует включать при задании этой функции.
- Эта функция поддерживает только метод POST HTTP. Включить кэширование ответов POST, задав эту функцию `POST`.
- По умолчанию кэшируются только запросы, тело которого меньше, чем 14 КБ. Используйте функцию размера текста кэшируемого запроса, чтобы задать максимальный размер текста запроса.

**Поведение по умолчанию:** кэшируются только ответов GET.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="cacheable-request-body-size"></a>Размер текста кэшируемого запроса
**Назначение.** Определяет пороговое значение для определения возможности кэширования ответа POST.

Чтобы определить это пороговое значение, укажите максимальный размер текста запроса. Запросы, содержащие текст запроса большего размера, не будут кэшироваться.

Основные сведения

- Эта функция применяется, только если ответы POST будут пригодны для кэширования. Используйте функцию кэшируемых методов HTTP, чтобы включить кэширование запроса POST.
- Текст запроса принимается во внимание для следующих значений:
    - значения x-www-form-urlencode;
    - обеспечение уникального ключа кэша.
- Задание большого максимального размера текста запроса может повлиять на производительность доставки данных.
    - **Рекомендуемое значение:** 14 КБ.
    - **Минимальное значение:** 1 КБ.

**По умолчанию:** 14 КБ.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="cache-control-header-treatment"></a>Обработка заголовка Cache-Control
**Назначение:** контролирует создание `Cache-Control` заголовков, с помощью пограничного сервера при активном внешней функции Max-Age.

Самый простой способ настроить этот тип конфигурации — поместить функции External Max-Age и обработки заголовка Cache-Control в одну инструкцию.

Значение|Результат
--|--
Перезаписать|Гарантирует, что выполняются следующие действия:<br/> -Перезаписывает `Cache-Control` заголовок, созданные на исходном сервере. <br/>— Добавляет `Cache-Control` заголовок полученных компонентом внешнего Max-Age в ответ.
Пропустить|Гарантирует, что `Cache-Control` заголовок, полученных с помощью функции внешних Max-Age никогда не добавляется в ответ. <br/> Если сервер-источник создает `Cache-Control` заголовка, он проходит через конечному пользователю. <br/> Если сервер-источник создает `Cache-Control` заголовок, а затем этот параметр может привести к заголовок ответа не содержит `Cache-Control` заголовок.
Добавить при отсутствии|Если `Cache-Control` заголовок не был получен из исходного сервера, то этот параметр добавляет `Cache-Control` заголовок полученных компонентом внешнего Max-Age. Этот параметр полезен для обеспечения того, что все ресурсы, назначенные `Cache-Control` заголовок.
Удалить| Этот параметр гарантирует, что `Cache-Control` заголовок не включается в ответ заголовок. Если `Cache-Control` уже назначен заголовок, то он удаляется из заголовка ответа.

**Поведение по умолчанию.** Перезаписать.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="cache-key-query-string"></a>Строка запроса ключа кэша
**Назначение.** Определяет, будет ли ключ кэша включать или исключать параметры строки запроса, связанные с запросом.

Основные сведения

- Укажите одно или несколько имен параметров строки запроса. Все имена параметров должны быть разделены одним пробелом.
- Эта функция определяет, будут ли параметры строки запроса включены в ключ кэша или исключены из него. Ниже приведены дополнительные сведения о каждом параметре.

type|ОПИСАНИЕ
--|--
 Включить|  Указывает, что каждый указанный параметр должен быть включен в ключ кэша. Для каждого запроса, содержащего уникальное значение для параметра строки запроса, определенного в этой функции, будет создан уникальный ключ кэша. 
 Включить все  |Указывает, что для каждого запроса на ресурс, который включает уникальную строку запроса, будет создан уникальный ключ кэша. Этот тип конфигурации обычно не рекомендуется, так как он может привести к возникновению небольшого процента попаданий в кэш. Это влечет увеличение нагрузки на сервер-источник, так как он будет обслуживать большее количество запросов. Эта конфигурация дублирует поведение кэширования, известное как уникальный кэш, на странице Query-String Caching (Кэширование строк запроса). 
 Исключить | Указывает, что из ключа кэша будут исключены только указанные параметры. Остальные параметры строки запроса будут включены в ключ кэша. 
 Исключить все  |Указывает, что из ключа кэша будут исключены все параметры строки запроса. Эта конфигурация дублирует поведение кэширования по умолчанию, известное как стандартный кэш, на странице Query-String Caching (Кэширование строк запроса). 

Возможности обработчика правил HTTP позволяют настраивать способ реализации кэширования строк запроса. Например, можно указать, что кэширование строк запроса будет выполняться только в определенных расположениях или типах файлов.

Если вы хотите дублировать поведение кэширования строк запроса, известное как "без кэша" на странице Query-String Caching (Кэширование строк запроса), необходимо создать правило, содержащее условие соответствия шаблона запроса URL-адреса и функцию отключения кэша. Для условия соответствия шаблона запроса URL-адреса следует указать звездочку (*).

#### <a name="sample-scenarios"></a>Примеры сценариев

В следующем примере использования этой функции предоставляется пример запроса и ключ кэша по умолчанию:

- **Пример запроса:** http://wpc.0001.&lt;Домен&gt;/800001/Origin/folder/asset.htm?sessionid=1234&language=EN&userid=01
- **Ключ кэша по умолчанию:** /800001/Origin/folder/asset.htm

##### <a name="include"></a>Включить

Образец конфигурации:

- **Тип:** включить.
- **Параметры:** язык.

Этот тип конфигурации создаст следующий ключ кэша параметра строки запроса:

    /800001/Origin/folder/asset.htm?language=EN

##### <a name="include-all"></a>Включить все

Образец конфигурации:

- **Тип:** включить все.

Этот тип конфигурации создаст следующий ключ кэша параметра строки запроса:

    /800001/Origin/folder/asset.htm?sessionid=1234&language=EN&userid=01

##### <a name="exclude"></a>Исключить

Образец конфигурации:

- **Тип:** исключить.
- **Параметры:** sessionid userid.

Этот тип конфигурации создаст следующий ключ кэша параметра строки запроса:

    /800001/Origin/folder/asset.htm?language=EN

##### <a name="exclude-all"></a>Исключить все

Образец конфигурации:

- **Тип:** исключить все.

Этот тип конфигурации создаст следующий ключ кэша параметра строки запроса:

    /800001/Origin/folder/asset.htm

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="cache-key-rewrite"></a>Перезапись ключа кэша
**Назначение.** Перезаписывает ключ кэша, связанный с запросом.

Ключ кэша — это относительный путь, определяющий ресурс для целей кэширования. Другими словами серверы будет проверять наличие кэшированная версия актива, согласно пути, в соответствии с определением его ключ кэша.

Настройте эту функцию, определив оба следующих параметра.

Параметр|ОПИСАНИЕ
--|--
Исходный путь| Определяет относительный путь к типам запросов, ключ кэша которых будет перезаписан. Относительный путь можно задать, выбрав базовый исходный путь, а затем определив шаблон регулярного выражения.
Новый путь|Определяет относительный путь для нового ключа кэша. Относительный путь можно задать, выбрав базовый исходный путь, а затем определив шаблон регулярного выражения. Этот относительный путь можно создать динамически с использованием переменных HTTP.
**Поведение по умолчанию.** Ключ кэша запроса определяется универсальным кодом ресурса (URI) запроса.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="comment"></a>Комментарий
**Назначение.** Позволяет добавлять примечания в правила.

Эта функция используется для предоставления дополнительных сведений об общем назначении правила или причине добавления определенного условия соответствия или функции в правило.

Основные сведения

- Можно указать до 150 символов.
- Используйте только буквенно-цифровые символы.
- Эта функция не влияет на поведение правила. Она только предоставляет область, в которой можно указать сведения для дальнейшего использования, или может помочь при устранении неполадок правила.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="complete-cache-fill"></a>Завершение заполнения кэша
**Назначение.** Определяет, что происходит, когда запрос завершается частичным промахом кэша на пограничном сервере.

Частичный промах кэша описывает состояние кэша для ресурса, который был не полностью скачан на пограничный сервер. Если ресурс лишь частично кэширован на пограничном сервере, следующий запрос для этого ресурса будет снова перенаправлен на сервер-источник.
<!---
This feature is not available for the ADN platform. The typical traffic on this platform consists of relatively small assets. The size of the assets served through these platforms helps mitigate the effects of partial cache misses, since the next request will typically result in the asset being cached on that POP.

--->
Частичный промах кэша обычно возникает после того, как пользователь прерывает процесс скачивания, или в ресурсах, которые запрашиваются только с помощью запросов в диапазоне HTTP. Эта функция наиболее полезна для больших ресурсов, когда пользователи, как правило, не скачивают их от начала до конца (например, видео). В результате на большой HTTP-платформе эта функция включена по умолчанию. На всех остальных платформах она отключена.

Сохраните конфигурацию по умолчанию для платформы больших HTTP, так как уменьшает нагрузку на исходный сервер клиента и повышает скорость, по которому ваши клиенты загрузки содержимого.

Из-за способа отслеживания параметров кэша эту функцию невозможно связать со следующими условиями соответствия: граничная запись Cname, литерал заголовка запроса, шаблон заголовка запроса, литерал запроса URL-адреса и шаблон запроса URL-адреса.

Значение|Результат
--|--
Включено|Восстанавливает поведение по умолчанию. Поведение по умолчанию — принудительно инициировать получение фоновых данных ресурса с сервера-источника на пограничном сервере. После этого ресурс будет находиться в локальном кэше пограничного сервера.
Отключено|Предотвращает получение фоновых данных для ресурса на пограничном сервере. Это означает, что при выполнении следующего запроса на этот ресурс из этого региона пограничный сервер будет запрашивать его с сервера-источника клиента.

**Поведение по умолчанию.** Включено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="compress-file-types"></a>Сжатие типов файлов
**Назначение.** Определяет форматы файлов, которые будут сжаты на сервере.

Формат файла можно указать с помощью его типа мультимедиа для Интернета (т. е. Content-Type). Тип носителя Internet это независимая от платформы метаданные, которые позволяет серверам определить формат конкретного средства. Ниже приведен список распространенных типов мультимедиа для Интернета.

Тип мультимедиа для Интернета|ОПИСАНИЕ
--|--
text/plain|Обычные текстовые файлы
text/html| HTML-файлы
text/css|Каскадные таблицы стилей (CSS)
application/x-javascript|JavaScript
application/javascript|JavaScript
Основные сведения

- Указывайте несколько типов мультимедиа для Интернета, разделяя их одним пробелом. 
- Эта функция будет сжимать только те ресурсы, размер которых меньше 1 МБ. Активы больше не будет сжиматься серверами.
- Некоторые типы содержимого, такие как мультимедийные файлы изображений, видео и аудио (например, JPG, MP3, MP4 и т. д.), уже сжаты. Дополнительное сжатие этих типов ресурсов не приведет к значительному уменьшению размера файла. Поэтому мы рекомендуем не включать сжатие для этих типов ресурсов.
- Подстановочные знаки, например звездочки, не поддерживаются.
- Прежде чем добавить эту функцию в правило, убедитесь, что задан параметр Compression Disabled (Сжатие отключено) на странице "Сжатие" для платформы, к которой это правило будет применяться.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="custom-log-field-1"></a>Поле 1 пользовательского журнала
**Назначение.** Определяет формат и содержимое, которое будет присвоено полю пользовательского журнала в необработанном файле журнала.

Это поле позволяет определить, какие значения заголовка запроса и ответа сохраняются в файлы журнала.

По умолчанию поле пользовательского журнала называется x-ec_custom-1. Тем не менее имя этого поля можно настроить на странице Общие параметры журнала.

Ниже указано форматирование, которое следует использовать для указания заголовков запроса и ответа.

Тип заголовка|Формат|Примеры
-|-|-
Заголовок запроса|%{[RequestHeader]()}[i]() | %{Accept-Encoding}i <br/> {Referer}i <br/> %{Authorization}i
Заголовок ответа|%{[ResponseHeader]()}[o]()| %{Age}o <br/> %{Content-Type}o <br/> %{Cookie}o

Основные сведения

- Поле пользовательского журнала может содержать любое сочетание полей заголовка и обычного текста.
- К допустимым символам для этого поля относятся буквенно-цифровые (0–9, a–z и A–Z), дефисы, двоеточия, точки с запятой, апострофы, запятые, точки, символы подчеркивания, знаки равенства, круглые скобки, квадратные скобки и пробелы. Символ процента и фигурные скобки можно использовать только для указания поля заголовка.
- Написание каждого указанного заголовка поля должно совпадать с именем необходимого заголовка запроса или ответа.
- Если вы хотите указать несколько заголовков, мы рекомендуем использовать между ними разделитель. Например, можно использовать сокращение для каждого заголовка. Пример синтаксиса приведен ниже.
    - AE: %{Accept-Encoding}i A: %{Authorization}i CT: %{Content-Type}o 

**Значение по умолчанию:** -

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="debug-cache-response-headers"></a>Заголовки ответа Debug Cache
**Назначение.** Определяет, может ли ответ включать заголовок ответа X-EC-Debug, предоставляющий сведения о политике кэширования для запрошенного ресурса.

Заголовки ответа Debug Cache будут включены в ответ, если выполнены следующие условия:

- в необходимом запросе включена функция заголовков ответа Debug Cache;
- в приведенном выше запросе определен набор заголовков ответа Debug Cache, которые будут включены в ответ.

Заголовки ответа Debug Cache можно запрашивать, добавив в запрос следующий заголовок и необходимые директивы:

X-EC-Debug: _Directive1_,_Directive2_,_DirectiveN_

**Пример.**

X-EC-Debug: x-ec-cache,x-ec-check-cacheable,x-ec-cache-key,x-ec-cache-state

Значение|Результат
-|-
Включено|Запросы для заголовков ответа Debug Cache возвратят ответ, который включает заголовок X-EC-Debug.
Отключено|Заголовок ответа X-EC-Debug будет исключен из ответа.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="default-internal-max-age"></a>Внутренний максимальный срок по умолчанию
**Назначение.** Определяет интервал максимального срока по умолчанию для повторной сверки пограничного сервера с сервером-источником. Другими словами, это количество времени, которое пройдет, прежде чем пограничный сервер проверит, соответствует ли кэшированный ресурс ресурсу, хранящемуся на сервере-источнике.

Основные сведения

- Это действие будет выполняться только для ответов от исходного сервера, не назначенных индикатором max-age в `Cache-Control` или `Expires` заголовок.
- Это действие не будет выполняться для ресурсов, которые невозможно кэшировать.
- Это действие не влияет на повторные сверки браузера с пограничным сервером. Эти типы достоверности просмотра определяются `Cache-Control` или `Expires` заголовки, отправляемого в браузер, которое может быть настроено с помощью функции внешних Max-Age.
- Результаты этого действия не оказывают значительное влияние на заголовки ответа и содержимое, возвращаемое с пограничных серверов для вашего содержимого, но они могут повлиять на объем трафика повторных сверок, отправляемых с пограничных серверов на сервер-источник.
- Настройте эту функцию, сделав следующее:
    - Выберите код состояния, к которому можно применить внутренний максимальный срок по умолчанию.
    - Укажите целое значение, а затем выберите нужную единицу времени (секунды, минуты, часы и т. д.). Это значение определяет интервал внутреннего максимального срока по умолчанию.

- Задание единицы времени для «Выкл» будет назначать интервал по умолчанию внутренние max-age 7 дней для запросов, которые не были назначены также указывает максимальное время, в их `Cache-Control` или `Expires` заголовок.
- Из-за способа отслеживания параметров кэша эту функцию невозможно связать со следующими условиями соответствия: 
    - граничная запись; 
    - Cname;
    - Литерал заголовка запроса
    - Шаблон заголовка запроса
    - Метод запроса
    - Литерал запроса URL-адреса
    - Шаблон запроса URL-адреса

**Значение по умолчанию:** 7 дней

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="deny-access-403"></a>Запретить доступ (403)
**Назначение.** Определяет, отклоняются ли все запросы с ответом 403 (запрещено).

Значение | Результат
------|-------
Включено| Приводит к отклонению всех запросов, соответствующих критериям сопоставления, с ответом 403 (запрещено).
Отключено| Восстанавливает поведение по умолчанию. Поведение по умолчанию предполагает разрешение серверу-источнику определять тип возвращаемого ответа.

**Поведение по умолчанию.** Отключено.

> [!TIP]
   > Один из возможных способов использования этой функции — связать ее с условием соответствия заголовка запроса, чтобы заблокировать доступ к источникам ссылок HTTP, использующих встроенные ссылки на содержимое.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="expires-header-treatment"></a>Обработка заголовка Expires
**Назначение:** контролирует создание `Expires` заголовков, с помощью пограничного сервера при активном компонент внешнего Max-Age.

Самый простой способ настроить этот тип конфигурации — поместить функции External Max-Age и Expires Header Treatment в одну инструкцию.

Значение|Результат
--|--
Перезаписать|Обеспечивает выполнение следующих действий:<br/>-Перезаписывает `Expires` заголовок, созданные на исходном сервере.<br/>— Добавляет `Expires` заголовок полученных компонентом внешнего Max-Age в ответ.
Пропустить|Гарантирует, что `Expires` заголовок, полученных с помощью функции внешних Max-Age никогда не добавляется в ответ. <br/> Если сервер-источник создает `Expires` заголовка, он будет проходить конечному пользователю. <br/>Если сервер-источник создает `Expires` заголовок, а затем этот параметр может привести к заголовок ответа не содержит `Expires` заголовок.
Добавить при отсутствии| Если `Expires` заголовок не был получен из исходного сервера, то этот параметр добавляет `Expires` заголовок полученных компонентом внешнего Max-Age. Этот параметр полезен для обеспечения, все активы будет назначен `Expires` заголовок.
Удалить| Гарантирует, что `Expires` заголовок не включается в ответ заголовок. Если `Expires` уже назначен заголовок, то он удаляется из заголовка ответа.

**Поведение по умолчанию.** Перезаписать.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="external-max-age"></a>Внешний максимальный срок
**Назначение.** Определяет интервал максимального срока для повторной сверки браузера с пограничным сервером. Другими словами, это количество времени, которое пройдет, прежде чем браузер сможет проверить наличие новой версии ресурса с пограничного сервера.

Включение этой функции будет создавать `Cache-Control: max-age` и `Expires` заголовки из пограничных серверов и их отправки HTTP-клиента. По умолчанию эти заголовки перезапишут заголовки, созданные на сервере-источнике. Тем не менее это поведение можно изменить с помощью функции обработки заголовка Cache-Control и Expires.

Основные сведения

- Это действие не влияет на повторные сверки пограничного сервера с сервером-источником. Эти типы достоверности просмотра определяются `Cache-Control` и `Expires` заголовков, полученные от исходного сервера и могут настраиваться с помощью по умолчанию внутренние Max-Age и компонентах Force внутренней Max-Age.
- Настройте эту функцию, указав целое значение и выбрав нужную единицу времени (секунды, минуты, часы и т. д.).
- Эта функция отрицательное значение при указании пограничные серверы для отправки `Cache-Control: no-cache` и `Expires` время, заданные в прошлом с каждого ответа в браузер. Несмотря на то, что HTTP-клиент не будет кэшировать ответ, этот параметр не повлияет на пограничных серверов возможность кэшировать ответ от исходного сервера.
- Если задать для единицы времени значение "Выкл.", эта функция будет отключена. `Cache-Control` И `Expires` заголовки ответа на исходном сервере в кэше передаст через браузер.

**Поведение по умолчанию.** Выключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="follow-redirects"></a>Поддержка перенаправлений
**Назначение.** Определяет, можно ли перенаправлять запросы к имени узла, определенном в заголовке Location, возвращенным сервером-источником клиента.

Основные сведения

- Запросы можно перенаправлять только к граничным записям CNAME, которые соответствуют одной и той же платформе.

Значение|Результат
-|-
Включено|Запросы можно перенаправлять.
Отключено|Запросы не будут перенаправляться.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="force-internal-max-age"></a>Принудительное использование внутреннего максимального срока
**Назначение.** Определяет интервал максимального срока для повторной сверки пограничного сервера с сервером-источником. Другими словами, это количество времени, которое пройдет, прежде чем пограничный сервер сможет проверить, соответствует ли кэшированный ресурс ресурсу, хранящемуся на сервере-источнике.

Основные сведения

- Этот компонент будет переопределить max-age интервал, заданный в `Cache-Control` или `Expires` заголовки, созданные из исходного сервера.
- Эта функция не влияет на повторные сверки браузера с пограничным сервером. Эти типы достоверности просмотра определяются `Cache-Control` или `Expires` заголовки, отправляемого в браузер.
- Эта функция не оказывает значительное влияние на ответ, который пограничный сервер предоставляет инициатору запроса. Тем не менее он может оказывать влияние на объем трафика повторной проверки подлинности, отправленных из пограничных серверов на исходном сервере.
- Настройте эту функцию, сделав следующее:
    - Выберите код состояния, к которому будет применен внутренний максимальный срок.
    - Укажите целое значение, а затем выберите нужную единицу времени (секунды, минуты, часы и т. д.). Это значение определяет интервал максимального срока запроса.

- Если задать для единицы времени значение "Выкл.", эта функция будет отключена. Интервал внутреннего максимального срока не будет назначен запрошенным ресурсам. Если исходный заголовок не содержит инструкции для кэширования, ресурс будет кэшироваться в соответствии с активным параметром в функции Default Internal Max-Age.
- Из-за способа отслеживания параметров кэша эту функцию невозможно связать со следующими условиями соответствия: 
    - граничная запись; 
    - Cname;
    - Литерал заголовка запроса
    - Шаблон заголовка запроса
    - Метод запроса
    - Литерал запроса URL-адреса
    - Шаблон запроса URL-адреса

**Поведение по умолчанию.** Выключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="h264-support-http-progressive-download"></a>Поддержка H.264 (Прогрессивное скачивание через HTTP)
**Назначение.** Определяет типы форматов файлов H.264, которые можно использовать для потоковой передачи содержимого.

Основные сведения

- Определите ряд разделенных пробелом допустимых расширений имен файлов H.264 в параметре "Расширения файлов". Параметр "Расширения файлов" переопределяет поведение по умолчанию. Настраивая этот параметр, включите эти расширения имен файлов, чтобы обеспечить поддержку MP4 и F4V. 
- Не забудьте добавлять точку при указании каждого расширения имени файла (например, .mp4, .f4v).

**Поведение по умолчанию.** Поэтапная загрузка HTTP поддерживает мультимедиа в формате MP4 и F4V по умолчанию.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="honor-no-cache-request"></a>Учитывать запрос без кэша
**Назначение.** Определяет, будут ли запросы без кэша HTTP-клиента перенаправляться на сервер-источник.

Запрос кэша не происходит, когда клиент HTTP отправляет `Cache-Control: no-cache` и/или `Pragma: no-cache` заголовок НТТР-запроса.

Значение|Результат
--|--
Включено|Позволяет перенаправлять запросы без кэша HTTP-клиента на сервер-источник, который будет возвращать заголовки ответов и текст через пограничный сервер обратно в HTTP-клиент.
Отключено|Восстанавливает поведение по умолчанию. Поведение по умолчанию — предотвратить перенаправление запросов без кэша на сервер-источник.

Для всего рабочего трафика мы настоятельно рекомендуем оставить эту функцию в отключенном состоянии по умолчанию. В противном случае серверы-источники не будут изолированы от конечных пользователей, которые могут случайно инициировать множество запросов без кэша при обновлении веб-страниц, или от многих популярных медиапроигрывателей, запрограммированных на отправку заголовка без кэша при каждом запросе видео. Тем не менее эту функцию полезно применять в определенных непроизводственных промежуточных или тестовых каталогах, чтобы извлекать новое содержимое по запросу с сервера-источника.

Состояние кэша, передаваемое для запроса, который можно переслать на сервер-источник в результате применения этой функции, — TCP_Client_Refresh_Miss. Отчет о попаданиях в кэш, который доступен в основном модуле создания отчетов, предоставляет статистические данные по состоянию кэша. Это позволяет отслеживать количество и процент запросов, перенаправляемых на сервер-источник при применении этой функции.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="ignore-origin-no-cache"></a>Не учитывать источник без кэша
**Назначение:** определяет ли CDN будет игнорировать предоставлен из исходного сервера следующие директивы:

- `Cache-Control: private`
- `Cache-Control: no-store`
- `Cache-Control: no-cache`
- `Pragma: no-cache`

Основные сведения

- Настройте эту функцию, определив список разделенных пробелом кодов состояния, для которых приведенные выше директивы будут игнорироваться.
- Набор допустимых кодов состояния для этой функции: 200, 203, 300, 301, 302, 305, 307, 400, 401, 402, 403, 404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 500, 501, 502, 503, 504 и 505.
- Отключите эту функцию, присвоив ей пустое значение.
- Из-за способа отслеживания параметров кэша эту функцию невозможно связать со следующими условиями соответствия: 
    - граничная запись; 
    - Cname;
    - Литерал заголовка запроса
    - Шаблон заголовка запроса
    - Метод запроса
    - Литерал запроса URL-адреса
    - Шаблон запроса URL-адреса

**Поведение по умолчанию.** Учитывать приведенные выше директивы.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="ignore-unsatisfiable-ranges"></a>Игнорировать неподходящие диапазоны 
**Назначение.** Определяет ответ, возвращаемый клиенту, если запрос формирует код состояния 416 (Запрошенный диапазон невыполним).

По умолчанию этот код состояния возвращается, когда пограничный сервер не может удовлетворить указанный запрос диапазонов байтов и если поле заголовка запроса If-Range не указано.

Значение|Результат
-|-
Включено|Запрещает отвечает на запрос недопустимый диапазон байтов с кодом состояния 416 запрошенный диапазон невыполним пограничные серверы. Вместо этого серверы доставки запрошенного ресурса и вернуть ответ 200 OK клиенту.
Отключено|Восстанавливает поведение по умолчанию. Поведение по умолчанию — учитывать код состояния 416 (Запрошенный диапазон невыполним).

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="internal-max-stale"></a>Внутреннее максимальное значение устаревания
**Назначение.** Контролирует, как долго после обычного истечения срока действия кэшированный ресурс может обслуживаться с пограничного сервера, если пограничному серверу не удалось выполнить повторную сверку кэшированного ресурса с сервером-источником.

Как правило, по истечении времени максимального срока ресурса пограничный сервер отправит на сервер-источник запрос на повторную сверку. Сервер-источник затем отправит ответ 304 (не изменено), чтобы предоставить пограничному серверу новую аренду для кэшированного ресурса, либо ответ 200 ОК, чтобы предоставить пограничному серверу обновленную версию кэшированного ресурса.

Если при попытке выполнения этой повторной сверки пограничный сервер не может установить соединение с сервером-источником, эта функция Internal Max-Stale определяет способность и длительность обслуживания пограничным сервером уже устаревших ресурсов.

Обратите внимание, что этот интервал времени начинается по истечении максимального срока ресурса, а не при неудачной повторной проверке. Таким образом, максимальный период, в течение которого ресурс может обрабатываться без успешной повторной проверки, — промежуток времени, представляющий сочетание значения максимального срока и максимального значения устаревания. Например если ресурс был кэширован в 9:00 с max-age 30 минут и устаревшей max-15 минут, затем сбой повторной попытки 9:44 приведет к появлению устаревших кэшированных, получающей актив во время попытки сбой повторной проверки подлинности в 15:04 приведет к появлению en конечного пользователя d пользователь получает 504 истекло время ожидания шлюза.

Любое значение, настроенное для этого компонент заменен `Cache-Control: must-revalidate` или `Cache-Control: proxy-revalidate` заголовки, полученные от исходного сервера. Если один из этих заголовков получен с сервера-источника при изначальном кэшировании ресурса, пограничный сервер не будет обрабатывать устаревший кэшированный ресурс. В этом случае если пограничный сервер не может выполнить повторную проверку с начала координат, по истечении интервала max-age актива пограничный сервер возвращает ошибку 504 истекло время ожидания шлюза.

Основные сведения

- Настройте эту функцию, сделав следующее:
    - Выберите код состояния, к которому будет применено максимальное значение устаревания.
    - Укажите целое значение, а затем выберите нужную единицу времени (секунды, минуты, часы и т. д.). Это значение определяет внутреннее максимальное значение устаревания, которое будет применено.

- Если задать для единицы времени значение "Выкл.", эта функция будет отключена. Кэшированный ресурс не будет обслуживаться по истечении обычного срока действия.
- Из-за способа отслеживания параметров кэша эту функцию невозможно связать со следующими условиями соответствия: 
    - граничная запись; 
    - Cname;
    - Литерал заголовка запроса
    - Шаблон заголовка запроса
    - Метод запроса
    - Литерал запроса URL-адреса
    - Шаблон запроса URL-адреса

**Поведение по умолчанию.** Две минуты.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="log-query-string"></a>Регистрация строки запроса
**Назначение.** Определяет, будет ли строка запроса сохранена вместе с URL-адресом в журналах доступа.

Значение|Результат
-|-
Включено|Позволяет хранить строки запроса во время записи URL-адресов в журнале доступа. Если URL-адрес не содержит строку запроса, этот параметр не будет иметь влияния.
Отключено|Восстанавливает поведение по умолчанию. Поведение по умолчанию — игнорировать строки запроса во время записи URL-адресов в журнал доступа.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="maximum-keep-alive-requests"></a>Максимальное количество запросов для проверки активности
**Назначение.** Определяет максимальное количество запросов для проверки активности подключения до его закрытия.

Мы настоятельно рекомендуем не задавать низкое значение для максимального числа запросов, так как это может привести к снижению производительности.

Основные сведения

- Укажите в качестве значения целое число.
- Не добавляйте запятые или точки в указанное значение.

**Значение по умолчанию:** 10 000 запросов.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="modify-client-request-header"></a>Заголовок запроса Modify Client
**Назначение:** каждый запрос содержит набор заголовков запроса, описывающие его. Эта функция может выполнять одно из следующих действий:

- Добавить или заменить значение, назначенное в заголовке запроса. Если указанный заголовок запроса не существует, эта функция добавит его в запрос.
- Удалить заголовок из запроса.

В запросах, перенаправляемых на сервер-источник, будут отражены изменения, внесенные этой функцией.

В заголовке запроса можно выполнить одно из приведенных ниже действий.

Параметр|ОПИСАНИЕ|Пример
-|-|-
Добавить|Указанное значение будет добавлено в конец имеющегося значения заголовка запроса.|**Значение заголовка запроса (клиент):** значение1. <br/> **Значение заголовка запроса (обработчик правил HTTP):** значение2. <br/>**Новое значение заголовка запроса:** значение1значение2.
Перезаписать|Для значения заголовка запроса будет присвоено указанное значение.|**Значение заголовка запроса (клиент):** значение1. <br/>**Значение заголовка запроса (обработчик правил HTTP):** значение2. <br/>**Новое значение заголовка запроса:** значение2. <br/>
Delete|Удаляет указанный заголовок запроса.|**Значение заголовка запроса (клиент):** значение1. <br/> **Конфигурация заголовка запроса Modify Client.** Удаление заголовка запроса в вопросе. <br/>**Результат.** Указанный заголовок запроса не будет перенаправляться на сервер-источник.

Основные сведения

- Убедитесь, что значение, указанное в параметре Name, точно совпадает с нужным заголовком запроса.
- В целях определения заголовка регистр не учитывается. Например, любой из следующих варианты `Cache-Control` имя заголовка можно использовать для его идентификации:
    - cache-control;
    - CACHE-CONTROL;
    - cachE-Control.
- При указании имени заголовка используйте только буквенно-цифровые символы, дефисы и символы подчеркивания.
- Удаление заголовка будут препятствовать пересылаются на исходном сервере, пограничные серверы.
- Следующие заголовки защищены и не могут быть изменены этой функцией:
    - forwarded;
    - host
    - via;
    - Предупреждение
    - x-forwarded-for.
    - Все имена заголовков, начинающиеся с "x-ec", защищены.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="modify-client-response-header"></a>Заголовок ответа Modify Client
Каждый ответ содержит набор заголовков ответа, описывающие его. Эта функция может выполнять одно из следующих действий:

- Добавить или заменить значение, назначенное в заголовке ответа. Если указанный заголовок ответа не существует, эта функция добавит его в ответ.
- Удалить заголовок из ответа.

По умолчанию значения заголовка ответа определяются с исходного сервера, пограничные серверы.

В заголовке ответа можно выполнить одно из приведенных ниже действий.

Параметр|ОПИСАНИЕ|Пример
-|-|-
Добавить|Указанное значение будет добавлено в конец имеющегося значения заголовка ответа.|**Значение заголовка ответа (клиент):** значение1. <br/> **Значение заголовка ответа (обработчик правил HTTP):** значение2. <br/>**Новое значение заголовка ответа:** значение1значение2.
Перезаписать|Заголовку ответа будет присвоено указанное значение.|**Значение заголовка ответа (клиент):** значение1. <br/>**Значение заголовка ответа (обработчик правил HTTP):** значение2. <br/>**Новое значение заголовка ответа:** значение2. <br/>
Delete|Удаляет указанный заголовок ответа.|**Значение заголовка ответа (клиент):** значение1. <br/> **Конфигурация заголовка ответа Modify Client:** удаление заголовка ответа в вопросе. <br/>**Результат.** Указанный заголовок ответа не будет перенаправляться инициатору запроса.

Основные сведения

- Значение, указанное в параметре Name, должно точно совпадать с нужным заголовком ответа. 
- В целях определения заголовка регистр не учитывается. Например, любой из следующих варианты `Cache-Control` имя заголовка можно использовать для его идентификации:
    - cache-control;
    - CACHE-CONTROL;
    - cachE-Control.
- Удаление заголовка предотвращает его пересылку запрашивающей стороне.
- Следующие заголовки защищены и не могут быть изменены этой функцией:
    - accept-encoding;
    - age;
    - connection;
    - content-encoding
    - content-length;
    - content-range;
    - дата
    - имя сервера
    - trailer;
    - transfer-encoding;
    - upgrade
    - vary;
    - via;
    - Предупреждение
    - Все имена заголовков, начинающиеся с "x-ec", защищены.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="partial-cache-sharing"></a>Совместное использование частичного кэширования
**Назначение.** Определяет, может ли запрос создавать частично кэшированное содержимое.

Этот частичный кэш затем будет использоваться для удовлетворения новых запросов на это содержимое, пока запрошенное содержимое не будет полностью кэшировано.

Значение|Результат
-|-
Включено|Запросы могут создавать частично кэшированное содержимое.
Отключено|Запросы могут создавать только полностью кэшированную версию запрошенного содержимого.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="prevalidate-cached-content"></a>Предварительная проверка кэшированного содержимого
**Назначение.** Определяет, подойдет ли кэшированное содержимое для ранней повторной сверки до истечения его срока действия.

Определите период времени до истечения срока жизни запрошенного содержимого, в течение которого для него можно будет выполнить раннюю повторную сверку.

Основные сведения

- Если задать значение "Выкл." в качестве единицы измерения времени, после истечения срока жизни кэшированного содержимого потребуется повторная проверка. Не указывайте время, и это будет проигнорировано.

**Поведение по умолчанию.** Выключено. Повторную проверку можно провести только после истечения срока жизни кэшированного содержимого.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="proxy-special-headers"></a>Специальные заголовки прокси-сервера
**Назначение:** определяет набор заголовков запроса конкретного CDN, которые пересылаются из пограничного сервера на исходном сервере.

Основные сведения

- Каждый заголовок запроса, относящийся к CDN и определенный в этой функции, перенаправляется на сервер-источник.
- Удалите из этого списка заголовок запроса, относящийся к CDN, чтобы он не перенаправлялся на сервер-источник.

**Поведение по умолчанию:** все заголовки запроса, характерные CDN пересылаются на сервер-источник.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="refresh-zero-byte-cache-files"></a>Обновление файлов кэша нулевой длины
**Назначение:** определяет способ обработки запроса HTTP-клиента для актива кэша нулевым байтом, пограничные серверы.

Допустимые значения:

Значение|Результат
--|--
Включено|Вызывает пограничного сервера, чтобы повторно извлечь ресурс из исходного сервера.
Отключено|Восстанавливает поведение по умолчанию. Поведение по умолчанию — обслуживать допустимые ресурсы кэша по запросу.
Эта функция не является обязательной для надлежащего кэширования и доставки содержимого, но может использоваться в качестве обходного решения. Например, генераторы динамического содержимого на серверах-источниках могут случайным образом привести к получению ответов нулевой длины, отправляемых на пограничные серверы. Эти типы ответов обычно кэшируются на пограничных серверов. Если вам известно, что ответ нулевой длины является недопустимым ответом 

для такого содержимого, эта функция может препятствовать обслуживанию этих типов ресурсов в ваших клиентах.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="set-cacheable-status-codes"></a>Набор кодов состояния кэшированного содержимого
**Назначение.** Определяет набор кодов состояния, которые могут привести к кэшированному содержимому.

По умолчанию кэширование включено только для ответов 200 ОК.

Укажите ряд необходимых кодов состояния, разделенных пробелами.

Основные сведения

- Включите функцию Ignore Origin No-Cache. Если эта функция не включена, ответы, отличающиеся от 200 ОК, могут не кэшироваться.
- Набор допустимых кодов состояния для этой функции: 203, 300, 301, 302, 305, 307, 400, 401, 402, 403, 404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 500, 501, 502, 503, 504 и 505.
- Эту функцию невозможно использовать, чтобы отключить кэширование для ответов, создающих код состояния 200 ОК.

**Поведение по умолчанию.** Кэширование включено только для ответов, создающих код состояния 200 ОК.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="set-client-ip-custom-header"></a>Настраиваемый заголовок Set Client IP
**Назначение.** Добавляет пользовательский заголовок, который определяет запрашивающего клиента по IP-адресу, в запрос.

Параметр заголовка имя определяет имя заголовка пользовательского запроса, где хранится IP-адрес клиента.

Эта функция позволяет серверу-источнику клиента узнать IP-адреса клиента с помощью пользовательского заголовка запроса. Если запрос обрабатывается из кэша, сервер-источник не получит IP-адрес клиента. Таким образом, мы рекомендуем использовать эту функцию с ADN или ресурсами, которые не будут кэшироваться.

Убедитесь, что указанное имя заголовка не совпадает с перечисленными ниже именами.

- Стандартные имена заголовков запросов. Список стандартных имен заголовков можно найти в статье о [RFC 2616](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html).
- Имена защищенных заголовков:
    - forwarded-for;
    - host
    - vary;
    - via;
    - Предупреждение
    - x-forwarded-for.
    - Все имена заголовков, начинающиеся с "x-ec", защищены.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="stale-content-delivery-on-error"></a>Доставка устаревшего содержимого при ошибке
**Назначение:** определяет, доставляются ли кэшированное содержимое с истекшим сроком действия при возникновении ошибки во время повторной проверки кэша, или при получении запрошенного содержимого из исходного сервера клиента.

Значение|Результат
-|-
Включено|Устаревшее содержание обслуживается запрашивающей стороне при возникновении ошибки во время подключения для исходного сервера.
Отключено|Ошибка на исходном сервере будут отправлены запрашивающей стороне.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="stale-while-revalidate"></a>Устаревший клиент при повторной сверке
**Назначение:** повышает производительность, позволяя пограничных серверов для предоставления содержимого устаревших запрашивающей стороне, пока выполняется повторная проверка.

Основные сведения

- Поведение этой функции зависит от выбранной единицы времени.
    - **Единица времени.** Укажите интервал времени и выберите единицу времени (например, секунды, минуты, часы и т. д.), чтобы разрешить доставку устаревшего содержимого. Этот тип установки позволяет CDN увеличивать интервал времени, в течение которого он может предоставлять содержимое перед проверкой по следующей формуле: **TTL** + **Stale While Revalidate Time**. 
    - **Выкл.** Выберите значение "Выкл.", чтобы перед обработкой запроса на устаревшее содержимое проводить повторную сверку.
        - Не указывайте промежуток времени, так как он неприменим и будет игнорироваться.

**Поведение по умолчанию.** Выключено. Повторная сверка должна проводиться перед обслуживанием запрошенного содержимого.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="token-auth"></a>Проверка подлинности на основе маркеров
**Назначение.** Определяет, будет ли применена к запросу проверка подлинности на основе маркеров.

Если проверка подлинности на основе маркеров включена, будут учитываться только те запросы, которые предоставляют зашифрованный маркер и соответствуют указанным в нем требованиям.

Ключ шифрования, который используется для шифрования и расшифровки значений маркера определяется первичный ключ и параметры резервного копирования ключа на странице проверки подлинности маркера. Имейте в виду, что ключи шифрования специфичны для конкретной платформы.

Значение | Результат
------|---------
Включено | Защищает запрошенное содержимое с помощью проверки подлинности на основе маркеров. Принимаются запросы только от тех клиентов, которые предоставляют допустимый маркер и соответствуют требованиям. На транзакции FTP проверка подлинности на основе маркеров не распространяется.
Отключено| Восстанавливает поведение по умолчанию. Поведение по умолчанию заключается в том, что конфигурация проверки подлинности на основе маркеров может определять, будет ли запрос защищен.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="token-auth-denial-code"></a>Код отказа при проверки подлинности на основе маркеров
**Назначение.** Определяет тип ответа, возвращаемого пользователю при отклонении запроса в результате проверки подлинности на основе маркеров.

Ниже перечислены доступные коды ответов.

Код ответа|Имя ответа|ОПИСАНИЕ
----------------|-----------|--------
301|Перемещено навсегда|Этот код состояния перенаправляет неавторизованных пользователей на URL-адрес, указанный в заголовке Location.
302|Найдено|Этот код состояния перенаправляет неавторизованных пользователей на URL-адрес, указанный в заголовке Location. Этот код состояния является стандартным отраслевым методом выполнения перенаправления.
307|Временное перенаправление|Этот код состояния перенаправляет неавторизованных пользователей на URL-адрес, указанный в заголовке Location.
401|Не авторизовано|Объединение этого кода состояния с заголовком ответа WWW-Authenticate дает возможность выполнять запрос на проверку подлинности пользователя.
403|Запрещено|Это стандартное сообщение о состоянии 403 (запрещено), которое неавторизованный пользователь увидит при попытке доступа к защищенному содержимому.
404|Файл не найден|Этот код состояния указывает, что обмен данными между HTTP-клиентом и сервером состоялся, но запрошенное содержимое не найдено.

#### <a name="url-redirection"></a>Перенаправление URL-адреса

Эта функция поддерживает перенаправление URL-адреса на определяемый пользователем URL-адрес, если он настроен на возврат кода состояния 3xx. Этот определяемый пользователем URL-адрес можно указать, сделав следующее:

1. Выберите код ответа 3xx для компонента кода отказа при проверке подлинности на основе маркеров.
2. Выберите Location из параметра необязательного имени заголовка.
3. Задайте для параметра необязательного значения заголовка нужный URL-адрес.

Если URL-адрес не определен для кода состояния 3xx, пользователю будет возвращена стандартная страница ответа для кода состояния 3xx.

Перенаправление URL-адреса применимо только для кодов ответов 3xx.

Параметр Optional Header Value (Необязательное значение заголовка) поддерживает буквенно-цифровые символы, кавычки и пробелы.

#### <a name="authentication"></a>Authentication

Эта функция поддерживает возможность включения заголовка WWW-Authenticate при ответе на неавторизованный запрос на содержимое, защищенное с помощью проверки подлинности на основе маркеров. Если в вашей конфигурации заголовку WWW-Authenticate присвоено значение basic, неавторизованный пользователь получит запрос на ввод учетных данных учетной записи.

Чтобы задать приведенную выше конфигурацию, сделайте следующее:

1. Выберите 401 в качестве кода ответа для функции кода отказа при проверке подлинности на основе маркеров.
2. Выберите WWW-Authenticate из параметра Optional Header Name.
3. Задайте для параметра необязательного значения заголовка значение basic.

Заголовок WWW-Authenticate применим только для кодов ответов 401.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="token-auth-ignore-url-case"></a>Не учитывать регистр URL-адреса при проверке подлинности на основе маркеров
**Назначение:** определяет, являются ли URL-адрес сравнения, выполненные с помощью проверки подлинности на основе маркеров с учетом регистра.

Ниже приведены параметры, на которые влияет эта функция.

- ec_url_allow
- ec_ref_allow
- ec_ref_deny

Допустимые значения:

Значение|Результат
---|----
Включено|В результате пограничного сервера, чтобы не учитывать регистр при сравнении URL-адреса для проверки подлинности на основе маркеров параметров.
Отключено|Восстанавливает поведение по умолчанию. Поведение по умолчанию предполагает учет регистра при сравнении URL-адресов для проверки подлинности на основе маркеров.

**Поведение по умолчанию.** Отключено.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="token-auth-parameter"></a>Параметр маркера проверки подлинности
**Назначение.** Определяет, должен ли быть переименован параметр строки запроса проверки подлинности на основе маркеров.

Основные сведения

- Параметр Value определяет имя параметра строки запроса, через который можно указать маркер.
- Для параметра Value невозможно присвоить значение ec_token.
- Убедитесь, что имя, указанное в параметре Value, содержит только допустимые символы для URL-адреса.

Значение|Результат
----|----
Включено|Параметр Value определяет имя параметра строки запроса, через который следует определять маркеры.
Отключено|Маркер можно указать как неопределенный параметр строки запроса в URL-адресе запроса.

**Поведение по умолчанию.** Отключено. Маркер можно указать как неопределенный параметр строки запроса в URL-адресе запроса.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="url-redirect"></a>URL Redirect
**Назначение.** Перенаправляет запросы через заголовок Location.

Для конфигурации этой функции требуется задать следующие параметры.

Параметр|ОПИСАНИЕ
-|-
Код|Выбор кода ответа, который возвращается инициатору запроса.
Источник и шаблон| Эти параметры определяют шаблон универсального кода ресурса (URI) запроса, обозначающий тип запросов, которые можно перенаправлять. Будут перенаправляться только те запросы, URL-адреса которых соответствуют следующим условиям. <br/> <br/> **Источник (или точка доступа к содержимому):** выберите относительный путь, который определяет сервер-источник. Это раздел "/XXXX/" и имя конечной точки. <br/> **Источник (шаблон):** необходимо указать шаблон, который определяет запросы по относительному пути. Этот шаблон регулярного выражения должен определять путь, который начинается непосредственно после выбранной ранее точки доступа к содержимому (см. выше). <br/> – Убедитесь, что критерии URI запроса (т. е. источник и шаблон), определенные ранее, не конфликтуют с условиями соответствия, заданными для этой функции. <br/> – Укажите шаблон. Если использовать в качестве шаблона пустое значение, сопоставляются все строки.
Место назначения| Определите URL-адрес, на который будут перенаправляться указанные выше запросы. <br/> Создайте этот URL-адрес динамически с помощью следующих компонентов: <br/> — шаблон регулярного выражения; <br/>— переменные HTTP. <br/> Замените значения, записанные из исходного шаблона, в целевом шаблоне в виде $_n_, где _n_ определяет значение в порядке, в котором оно было записано. Например, $1 представляет собой первое значение, записанное из исходного шаблона, а $2 — второе значение. <br/> 
Мы настоятельно рекомендуем использовать абсолютный URL-адрес. Использование относительного URL-адреса может привести к перенаправлению URL-адресов CDN по недопустимому пути.

**Пример сценария**

В этом примере показано, как перенаправить ребром CNAME URL-адрес, который разрешается в этот базовый URL-адрес CDN: http://marketing.azureedge.net/brochures

Отвечающие требованиям запросы будут перенаправляться на этот базовый URL-адрес граничной записи CNAME: http://cdn.mydomain.com/resources.

URL-адрес перенаправления можно получить с помощью следующей конфигурации: ![](./media/cdn-rules-engine-reference/cdn-rules-engine-redirect.png).

**Основные моменты:**

- Функция перенаправления URL-адреса определяет URL-адреса запроса, которые будут перенаправляться. В результате дополнительные условия соответствия не являются обязательными. Несмотря на то что условие соответствия было определено как Always, будут перенаправляться только те запросы, которые указывают на папку brochures в источнике клиента marketing. 
- Все соответствующие запросы будут перенаправляться на URL-адрес граничной записи CNAME, определенный в параметре Destination. 
    - Пример сценария №1: 
        - Пример запроса (URL-адрес CDN): http://marketing.azureedge.net/brochures/widgets.pdf. 
        - URL-адрес запроса (после перенаправления): http://cdn.mydomain.com/resources/widgets.pdf.  
    - Пример сценария №2: 
        - Пример запроса (URL-адрес граничной записи): http://marketing.mydomain.com/brochures/widgets.pdf. 
        - URL-адрес запроса (после перенаправления): http://cdn.mydomain.com/resources/widgets.pdf. Пример сценария
    - Пример сценария №3: 
        - Пример запроса (URL-адрес граничной записи CNAME): http://brochures.mydomain.com/campaignA/final/productC.ppt. 
        - URL-адрес запроса (после перенаправления): http://cdn.mydomain.com/resources/campaignA/final/productC.ppt.  
- В параметре Destination была использована переменная схемы запроса (%{scheme}). Это гарантирует, что схема запроса останется неизменной после перенаправления.
- Сегменты URL-адреса, полученные из запроса, добавляются к новому URL-адресу с помощью $1.

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="url-rewrite"></a>Переопределение URL-адреса
**Назначение.** Перезаписывает URL-адрес запроса.

Основные сведения

- Для конфигурации этой функции требуется задать следующие параметры.

Параметр|ОПИСАНИЕ
-|-
 Источник и шаблон | Эти параметры определяют шаблон универсального кода ресурса (URI) запроса, определяющий тип запросов, которые можно перезаписать. Будут перезаписываться только те запросы, URL-адреса которых соответствуют следующим условиям: <br/>     - **Источник (или точка доступа к содержимому):** выберите относительный путь, который определяет сервер-источник. Это раздел "/XXXX/" и имя конечной точки. <br/> - **Источник (шаблон):** необходимо указать шаблон, который определяет запросы по относительному пути. Этот шаблон регулярного выражения должен определять путь, который начинается непосредственно после выбранной ранее точки доступа к содержимому (см. выше). <br/> Убедитесь, что критерии URI запроса (т. е. источник и шаблон), определенные ранее, не конфликтуют с условиями соответствия, заданными для этой функции. Укажите шаблон. Если использовать в качестве шаблона пустое значение, сопоставляются все строки. 
 Место назначения  |Определите относительный URL-адрес, на который будут перезаписываться указанные выше запросы. <br/>    1. Выбор точки доступа к содержимому, определяющей сервер-источник. <br/>    2. Определение относительного пути с помощью следующих компонентов: <br/>        — шаблон регулярного выражения; <br/>        — переменные HTTP. <br/> <br/> Замените значения, записанные из исходного шаблона, в целевом шаблоне в виде $_n_, где _n_ определяет значение в порядке, в котором оно было записано. Например, $1 представляет собой первое значение, записанное из исходного шаблона, а $2 — второе значение. 
 Эта функция позволяет пограничные серверы переписать без выполнения традиционных перенаправления URL-адрес. Это означает, что инициатор запроса получит один и тот же код ответа так, как если бы был запрошен перезаписанный URL-адрес.

**Пример сценария 1**

В этом примере показано, как перенаправить ребром CNAME URL-адрес, который разрешается в этот базовый URL-адрес CDN: http://marketing.azureedge.net/brochures/

Отвечающие требованиям запросы будут перенаправляться на этот базовый URL-адрес граничной записи CNAME: http://MyOrigin.azureedge.net/resources.

URL-адрес перенаправления можно получить с помощью следующей конфигурации: ![](./media/cdn-rules-engine-reference/cdn-rules-engine-rewrite.png).

**Пример сценария 2**

В этом примере показано, как перенаправить ребром CNAME URL-адрес из прописных букв в нижний регистр с помощью регулярных выражений.

URL-адрес перенаправления можно получить с помощью следующей конфигурации: ![](./media/cdn-rules-engine-reference/cdn-rules-engine-to-lowercase.png).


**Основные моменты:**

- Функция перезаписи URL-адреса определяет URL-адреса запроса, которые будут перезаписаны. В результате дополнительные условия соответствия не являются обязательными. Несмотря на то что условие соответствия было определено как Always, будут перезаписаны только те запросы, которые указывают на папку brochures в источнике клиента marketing.

- Сегменты URL-адреса, полученные из запроса, добавляются к новому URL-адресу с помощью $1.

#### <a name="compatibility"></a>Совместимость

Эта функция включает критерии соответствия, которые необходимо выполнить, прежде чем ее можно будет применить к запросу. В целях предотвращения установки конфликтующих критериев соответствия эта функция несовместима со следующими условиями соответствия:

- Номер AS
- Источник CDN
- IP-адрес клиента
- Источник клиента
- Схема запроса
- Каталог URL-пути
- Расширение URL-пути
- Имя файла URL-пути
- Литерал URL-пути
- Регулярное выражение URL-пути
- Шаблон URL-пути
- Литерал запроса URL-адреса
- Параметр запроса URL-адреса
- Регулярное выражение запроса URL-адреса
- Шаблон запроса URL-адреса

[К началу](#azure-cdn-rules-engine-features)

</br>

---
### <a name="user-variable"></a>Пользовательская переменная
**Назначение:** только для внутреннего использования.

[К началу](#azure-cdn-rules-engine-features)

</br>

## <a name="next-steps"></a>Следующие шаги
* [Azure Content Delivery Network Rules Engine](cdn-rules-engine-reference.md) (Обработчик правил сети доставки содержимого Azure)
* [Conditional Expressions for Azure Content Delivery Network (CDN) Rules Engine](cdn-rules-engine-reference-conditional-expressions.md) (Условные выражения для обработчика правил сети доставки содержимого (CDN) Azure)
* [Условия соответствия обработчика правил](cdn-rules-engine-reference-match-conditions.md)
* [Переопределение стандартного поведения через HTTP с помощью обработчика правил](cdn-rules-engine.md)
* [Обзор Azure CDN](cdn-overview.md)
