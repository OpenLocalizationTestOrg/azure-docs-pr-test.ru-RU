---
title: "Оптимизация потоковой передачи мультимедиа через сеть доставки содержимого Azure"
description: "Оптимизация потоковой передачи файлов мультимедиа для непрерывной доставки"
services: cdn
documentationcenter: 
author: smcevoy
manager: erikre
editor: 
ms.assetid: 
ms.service: cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: v-semcev
ms.openlocfilehash: 02cd0fe30a2a14f42a16ed12f714d496bbb23b36
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="media-streaming-optimization-via-the-azure-content-delivery-network"></a>Оптимизация потоковой передачи мультимедиа через сеть доставки содержимого Azure 
 
Пользователи Интернета все чаще отдают предпочтение видео высокого разрешения, что создает трудности для эффективной доставки больших файлов. Пользователи ожидают плавного воспроизведения видео по запросу или потокового видео в разных сетях и клиентах по всему миру. Чтобы обеспечить комфорт пользователей, крайне важно обеспечить быстрый и эффективный механизм потоковой передачи файлов мультимедиа.  

Потоковую передачу мультимедиа обеспечить особенно трудно из-за большого размера файлов и количества параллельных зрителей. Пользователи не захотят мириться с длинными задержками. Так как потоковые трансляции в прямом эфире не могут кэшироваться заранее, а большие задержки не устраивают зрителей, то фрагменты видео должны передаваться своевременно. 

Шаблоны запросов потоковой передачи также создают некоторые сложности. Во время популярных потоковых трансляций или выхода новых сериалов для видео по запросу количество зрителей, которые одновременно запрашивают поток, составляет от нескольких тысяч до нескольких миллионов. В таких случаях правильная консолидация запросов является ключевой для исключения перегрузки серверов-источников, если ресурсы еще не кэшированы.
 
Сеть доставки содержимого Azure от Akamai теперь предоставляет возможность эффективной потоковой передачи ресурсов мультимедиа для пользователей по всему миру. Эта функция сокращает задержки, так как снижает нагрузку на серверы-источники. Эта функция доступна в ценовой категории Akamai уровня "Стандартный". 

В сети доставки содержимого Azure от Verizon для потоковой передачи мультимедиа используется оптимизация общей веб-доставки.
 
## <a name="configure-an-endpoint-to-optimize-media-streaming-in-the-azure-content-delivery-network-from-akamai"></a>Настройка конечной точки для оптимизации потоковой передачи мультимедиа в сети доставки содержимого Azure от Akamai
 
Вы можете настроить конечную точку сети доставки содержимого для оптимизации доставки больших файлов с помощью портала Azure. Для этого можно также использовать наши интерфейсы REST API или любые клиентские пакеты SDK. Для настройки конечной точки на портале Azure выполните следующие действия:

1. Чтобы добавить новую конечную точку, на странице **Профиль сети доставки содержимого** выберите **Конечная точка**.
  
    ![Новая конечная точка](./media/cdn-media-streaming-optimization/01_Adding.png)

2. В раскрывающемся списке **Оптимизировано для** выберите **Потоковая передача видео по запросу** для ресурсов видео по запросу. Если используется сочетание потоковой передачи видео в реальном времени и потоковой передачи видео по запросу, выберите **Общая потоковая передача мультимедиа**.

    ![Выбранная потоковая передача](./media/cdn-media-streaming-optimization/02_Creating.png) 
 
После создания конечной точки будет применена оптимизация для всех файлов, соответствующих определенным условиям. Этот процесс описан в следующем разделе. 
 
## <a name="media-streaming-optimizations-for-the-azure-content-delivery-network-from-akamai"></a>Оптимизация потоковой передачи мультимедиа для сети доставки содержимого Azure от Akamai
 
Оптимизация потоковой передачи из Akamai эффективна для потоковой передачи видео по запросу, при которой передаются отдельные фрагменты мультимедиа. Этот процесс отличается от передачи одного большого ресурса с помощью последовательной загрузки или с помощью запросов на диапазоны байт. Дополнительные сведения о таком типе доставки мультимедиа см. в статье [Оптимизация больших файлов](cdn-large-file-optimization.md).


При оптимизации общей передачи мультимедиа и оптимизации передачи видео по запросу используется сеть доставки содержимого с серверной оптимизацией для ускорения доставки ресурсов мультимедиа. В них также используются конфигурации для ресурсов мультимедиа на основе общих рекомендаций, выработанных с течением времени.

### <a name="caching"></a>Caching

Если сеть доставки содержимого Azure от Akamai определяет ресурс как манифест потоковой передачи или фрагмент, то для этого ресурса будет использовано другое время истечения срока кэширования по сравнению с общей веб-доставкой. (Полный список см. в таблице ниже.) Как всегда, учитываются заголовки Cache-Control или Expires, отправленные из источника. Если ресурс не является ресурсом мультимедиа, он кэшируется с использованием времени истечения срока действия для обычной веб-доставки.

Короткое время отрицательного кэширования удобно для разгрузки источника, когда множество пользователей запрашивают фрагмент, которого еще не существует. Такое происходит, например, в потоках реального времени, в которых пакеты не доступны от источника в ту же секунду. Более долгий интервал кэширования также помогает разгрузить запросы от источника, так как содержимое видео обычно не изменяется.
 

|   | Общая веб-доставка | Общая потоковая передача мультимедиа | Потоковая передача видео по запросу  
--- | --- | --- | ---
Кэширование: положительное <br> HTTP 200, 203, 300, <br> 301, 302 и 410 | 7 дней |365 дней | 365 дней   
Кэширование: отрицательное <br> HTTP 204, 305, 404 <br> и 405 | None | 1 с | 1 с
 
### <a name="deal-with-origin-failure"></a>Устранение сбоев источника  

При общей передаче мультимедиа и передаче видео по запросу также используются время ожидания источника и журнал повторных попыток в соответствии с рекомендациями для шаблонов типичных запросов. Например, так как общая передача мультимедиа предназначена для передачи в реальном времени и передачи видео по запросу, в ней используется меньшее время ожидания подключения из-за того, что при потоковой передаче в реальном времени необходимо строго соблюдать временные интервалы.

После истечения времени ожидания подключения сеть доставки содержимого повторит попытку подключения несколько раз, после чего клиенту будет отправлена ошибка 504 ("Время ожидания шлюза истекло"). 

Если файл соответствует типу файла и списку условий для размера файла, сеть доставки содержимого использует параметры для потоковой передачи мультимедиа. В противном случае используется общая веб-доставка.
   
### <a name="conditions-for-media-streaming-optimization"></a>Условия для оптимизации потоковой передачи мультимедиа 

В следующей таблице перечислен набор критериев, которые должны быть выполнены для оптимизации потоковой передачи: 
 
Поддерживаемые типы потоковой передачи | Расширения файлов  
--- | ---  
Apple HLS | m3u8, m3u, m3ub, key, ts, aac
Adobe HDS | f4m, f4x, drmmeta, bootstrap, f4f,<br>Структура URL Seg-Frag <br> (сопоставления регулярного выражения: ^(/.*)Seq(\d+)-Frag(\d+)
DASH | mpd, тире, divx, ismv, m4s, m4v, mp4, mp4v, <br> sidx, webm, mp4a, m4a, isma
Потоковая передача Smooth Streaming | /manifest/,/QualityLevels/Fragments/
  

 
## <a name="media-streaming-optimizations-for-the-azure-content-delivery-network-from-verizon"></a>Оптимизация потоковой передачи мультимедиа для сети доставки содержимого Azure от Verizon

В сети доставки содержимого Azure от Verizon для потоковой передачи ресурсов мультимедиа используется оптимизация общей веб-доставки. Некоторые функции сети доставки содержимого по умолчанию напрямую влияют на доставку ресурсов мультимедиа.

### <a name="partial-cache-sharing"></a>Совместное использование частичного кэширования

Совместное использование частичного кэширования позволяет сети доставки содержимого отправлять частично кэшированное содержимое в ответ на новые запросы. Например, если первый запрос к результатам сети доставки содержимого завершился промахом кэша, то запрос отправляется к источнику. Хотя это неполное содержимое загружается в кэш сети доставки содержимого, другие запросы к сети доставки содержимого начнут получать эти данные. 

### <a name="cache-fill-wait-time"></a>Время ожидания заполнения кэша

 Функция времени ожидания заполнения кэша вынуждает пограничный сервер удерживать последующие запросы к тому же ресурсу, пока с сервера-источника не будут возвращены заголовки HTTP-ответа. Если заголовки HTTP-ответа с сервера-источника поступают до истечения времени ожидания, то все удерживаемые запросы возвращаются из растущего кэша. В это же время кэш заполняется данными из источника. Время ожидания заполнения кэша по умолчанию равно 3,000 мс. 

