---
title: "Использование Azure CDN с SAS | Документы Microsoft"
description: 
services: cdn
documentationcenter: 
author: dksimpson
manager: 
editor: 
ms.assetid: 
ms.service: cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/14/2017
ms.author: rli v-deasim
ms.openlocfilehash: de30f4319be75362131f8c8ad71aad57b0528f05
ms.sourcegitcommit: 3f33787645e890ff3b73c4b3a28d90d5f814e46c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2018
---
# <a name="using-azure-cdn-with-sas"></a>Использование Azure CDN с SAS

Вы предоставления содержимого из контейнера хранилища учетной записи, можно защитить как пользователям доступ к файлам, предоставляя доступ к закрытому в контейнер хранилища. В противном случае возможен контейнер хранилища, для которой был предоставлен общий доступ, любой пользователь, знающий его URL-адрес. Чтобы защитить разрешен сети доставки содержимого (CDN) для доступа к учетной записи хранения, можно использовать функцию подписи общего доступа (SAS), из хранилища Azure для предоставления ограниченного доступа к контейнерам закрытого хранения.

Это URI, который предоставляет ограниченные права доступа к ресурсам хранилища Azure без предоставления ключа учетной записи. Вы можете предоставить подписанный URL-адрес для клиентов, не имеющих доверительных отношений с помощью ключа учетной записи хранилища, но которым требуется делегировать доступ к определенным ресурсам учетной записи хранилища. Распространение URI подписи коллективного доступа этим клиентам, им предоставлен доступ к ресурсу за указанный период времени.
 
SAS можно задать различные параметры доступа к большому двоичному объекту, например, время начала и окончания срока действия, разрешения (чтение запись) и диапазоны IP-адресов. В этой статье описывается использование SAS вместе с Azure CDN. Дополнительные сведения о SAS, включая создание его и его настройки параметров в разделе [с помощью подписи коллективного доступа (SAS)](https://docs.microsoft.com/azure/storage/common/storage-dotnet-shared-access-signature-part-1).

## <a name="setting-up-azure-cdn-to-work-with-storage-sas"></a>Настройка сети доставки Содержимого Azure для работы с хранилищем SAS
Следующие параметры рекомендуется использовать с помощью SAS с Azure CDN. Все параметры предполагается уже создали рабочий SAS (см. предварительные условия). 
 
### <a name="prerequisites"></a>Технические условия
Чтобы начать, создайте учетную запись хранилища, а затем создать SAS для актива. Можно создать два вида хранимых URL-адреса: служба SAS или учетную запись SAS. Дополнительные сведения см. в разделе [типов подписей общего доступа](https://docs.microsoft.com/azure/storage/common/storage-dotnet-shared-access-signature-part-1#types-of-shared-access-signatures).

После создания SAS можно получить доступ к файла хранилища больших двоичных объектов с помощью URL-адрес, который имеет следующий формат:`https://<account>.blob.core.windows.net/<folder>/<file>?sv=<SAS_TOKEN>`
 
Например: 
 ```
https://democdnstorage1.blob.core.windows.net/container1/sasblob.txt?sv=2017-04-17&ss=b&srt=co&sp=r&se=2038-01-02T21:30:49Z&st=2018-01-02T13:30:49Z&spr=https&sig=QehoetQFWUEd1lhU5iOMGrHBmE727xYAbKJl5ohSiWI%3D
```

Дополнительные сведения о параметрах настройки см. в разделе [сведения о параметрах SAS](#sas-parameter-considerations) и [параметры подписи общего доступа](https://docs.microsoft.com/azure/storage/common/storage-dotnet-shared-access-signature-part-1#shared-access-signature-parameters).

![Параметры CDN SAS](./media/cdn-sas-storage-support/cdn-sas-settings.png)

### <a name="option-1-using-sas-with-pass-through-to-blob-storage-from-the-cdn"></a>Вариант 1: С SAS к серверу хранилища из сети CDN больших двоичных объектов

Этот вариант является наиболее простым и использует только один SAS токен, который передается из CDN на исходном сервере. Этот режим поддерживается **CDN Azure из Verizon**, профилей Standard и Premium и **Azure CDN с Akamai**. 
 
1. Выберите конечную точку, щелкните **правила кэширования**, а затем выберите **кэшировать каждый уникальный URL-адрес** из **кэширование строки запроса** списка.

    ![Правил кэширования CDN](./media/cdn-sas-storage-support/cdn-caching-rules.png)

2. После настройки SAS в вашей учетной записи хранилища, используйте маркер SAS с URL-адрес CDN, доступ к файлу. 
   
   Полученный URL-адрес имеет следующий формат:`https://<endpoint>.azureedge.net/<folder>/<file>?sv=<SAS_TOKEN>`

   Например:    
   ```
   https://demoendpoint.azureedge.net/test/demo.jpg/?sv=2017-04-17&ss=b&srt=c&sp=r&se=2027-12-19T17:35:58Z&st=2017-12-19T09:35:58Z&spr=https&sig=kquaXsAuCLXomN7R00b8CYM13UpDbAHcsRfGOW3Du1M%3D
   ```
   
3. Оптимизировать длительность кэширования с помощью правил кэширования или добавив `Cache-Control` заголовки в источнике. CDN маркер SAS рассматривается как строка простых запросов, рекомендуется вам следует настроить длительность кэширования, истечения срока действия во время или до истечения срока действия SAS. В противном случае если файл с кэшированием длительный срок, чем SAS активен, возможно, файл доступен с исходного сервера CDN после истечения срока действия SAS. Если это происходит, и вы хотите сделать недоступной кэшированный файл, необходимо выполнить операцию очистки в файл, чтобы удалить его из кэша. Сведения о настройке длительность кэширования на CDN см. в разделе [управления сети доставки содержимого Azure поведение кэширования с кэшированием правила](cdn-caching-rules.md).

### <a name="option-2-hidden-cdn-security-token-using-rewrite-rule"></a>Вариант 2: Скрыт правило подстановки с помощью маркера безопасности CDN
 
Этот параметр можно защитить хранилище больших двоичных объектов источника без необходимости маркер SAS для пользователя CDN. Можно использовать этот параметр, если вам не требуется специальный доступ ограничения для файла, но требуется запретить пользователям доступ к исходной хранения непосредственно для ускорения разгрузки CDN. Этот параметр доступен только для **Azure CDN Premium из Verizon** профилей. 
 
1. Используйте [обработчик правил](cdn-rules-engine.md) для создания правила переопределения URL-адресов. Новые правила требует около 90 минут для распространения.

   ![Управление CDN кнопки](./media/cdn-sas-storage-support/cdn-manage-btn.png)

   ![Система правил CDN кнопки](./media/cdn-sas-storage-support/cdn-rules-engine-btn.png)

   Этот пример правила переопределения URL-адресов имеет следующие шаблоны:
   
   Источник:   
   `/test/demo.jpg`
   
   Назначение:   
   `/test/demo.jpg?sv=2017-04-17&ss=b&srt=c&sp=r&se=2027-12-19T17:35:58Z&st=2017-12-19T09:35:58Z&spr=https&sig=kquaXsAuCLXomN7R00b8CYM13UpDbAHcsRfGOW3Du1M%3D`

   ![Правило CDN переопределения URL-адресов](./media/cdn-sas-storage-support/cdn-url-rewrite-rule.png)
 
2. Доступ к файлу на CDN без токена SAS, в следующем формате:`https://<endpoint>.azureedge.net/<folder>/<file>`
 
   Например:    
   `https://demoendpoint.azureedge.net/test/demo.jpg`
       
   Обратите внимание, что угодно, независимо от того, является ли они используют маркер SAS получить доступ к конечной точке CDN. 

3. Оптимизировать длительность кэширования с помощью правил кэширования или добавив `Cache-Control` заголовки в источнике. CDN маркер SAS рассматривается как строка простых запросов, рекомендуется вам следует настроить длительность кэширования, истечения срока действия во время или до истечения срока действия SAS. В противном случае если файл с кэшированием длительный срок, чем SAS активен, возможно, файл доступен с исходного сервера CDN после истечения срока действия SAS. Если это происходит, и вы хотите сделать недоступной кэшированный файл, необходимо выполнить операцию очистки в файл, чтобы удалить его из кэша. Сведения о настройке длительность кэширования на CDN см. в разделе [управления сети доставки содержимого Azure поведение кэширования с кэшированием правила](cdn-caching-rules.md).

### <a name="option-3-using-cdn-security-token-authentication-with-a-rewrite-rule"></a>Вариант 3: Использование проверки подлинности маркера безопасности CDN с правило подстановки

Этот параметр является наиболее безопасной и настраиваемым. Чтобы использовать проверку подлинности маркеров безопасности CDN, необходимо иметь **Azure CDN Premium из Verizon** профиля. Клиентский доступ основан на параметры безопасности, заданные на маркер безопасности CDN. Однако если SAS становится недействительным, CDN нельзя будет выполнить повторную проверку содержимого с основного сервера.

1. [Создает маркер безопасности CDN](https://docs.microsoft.com/azure/cdn/cdn-token-auth#setting-up-token-authentication) и активируйте его с помощью модуля правил для конечной точки CDN и путь к местоположению файла.

   Ниже приведен формат URL-адреса SAS:   
   `https://<endpoint>.azureedge.net/<folder>/<file>?sv=<SAS_TOKEN>`
 
   Например:    
   ```
   https://demoendpoint.azureedge.net/test/demo.jpg?sv=2017-04-17&ss=b&srt=c&sp=r&se=2027-12-19T17:35:58Z&st=2017-12-19T09:35:58Z&spr=https&sig=kquaXsAuCLXomN7R00b8CYM13UpDbAHcsRfGOW3Du1M%3D
   ```
       
   Параметры для аутентификации токенов безопасности CDN, отличаются от параметров для маркера SAS. Если вы решили использовать срок действия при создании маркера безопасности CDN, ему необходимо присвоить значение как срок действия маркера SAS. Это обеспечивает возможность истечения срока действия прогнозируемого. 
 
2. Используйте [обработчик правил](cdn-rules-engine.md) для создания правила переопределения URL-адресов для токена доступа для всех больших двоичных объектов в контейнере. Новые правила требует около 90 минут для распространения.

   Этот пример правила переопределения URL-адресов имеет следующие шаблоны:
   
   Источник:   
   `/test/demo.jpg`
   
   Назначение:   
   `/test/demo.jpg?sv=2017-04-17&ss=b&srt=c&sp=r&se=2027-12-19T17:35:58Z&st=2017-12-19T09:35:58Z&spr=https&sig=kquaXsAuCLXomN7R00b8CYM13UpDbAHcsRfGOW3Du1M%3D`

   ![Правило CDN переопределения URL-адресов](./media/cdn-sas-storage-support/cdn-url-rewrite-rule.png)

3. При обновлении SAS обновите правило переопределения URL-адресов, чтобы использовать новый маркер SAS. 

## <a name="sas-parameter-considerations"></a>Сведения о параметрах SAS

Поскольку параметров SAS не видны в CDN, CDN не могут изменить его поведение доставки на их основе. Определенный параметр ограничения применяются только на запросы, которые делает CDN для исходного сервера, не для запросов от клиента к CDN. Это различие важно учитывать при установке параметров SAS. Если эти дополнительные возможности необходимы, и вы используете [вариант 3](#option-3-using-cdn-security-token-authentication-with-a-rewrite-rule), задать соответствующие ограничения для маркера безопасности CDN.

| Имя параметра SAS | ОПИСАНИЕ |
| --- | --- |
| Начало | Время, можно начать CDN для доступа к файлу большого двоичного объекта. Из-за расфазировки наклон (прибытии часов сигнала в разное время для различных компонентов), выберите время 15 минутами ранее, если требуется, чтобы ресурс, будут доступны незамедлительно. |
| End | Время, после которого CDN теряет доступ к файла большого двоичного объекта. Ранее кэшированных файлов на CDN по-прежнему доступны. Чтобы контролировать время истечения срока действия файла, задать соответствующий срок действия для маркера безопасности CDN или очистить актива. |
| Разрешенные IP-адреса | Необязательный элемент. Если вы используете **CDN Azure из Verizon**, этот параметр можно задавать на диапазоны, определенные в [CDN Azure из диапазонов IP-адресов Verizon пограничного сервера](https://msdn.microsoft.com/library/mt757330.aspx). Если вы используете **Azure CDN с Akamai**, нельзя задать параметр диапазоны IP, поскольку IP-адреса, не являются статичными.|
| Разрешенных протоколов | Протоколы, допустимое для запросов с учетной записью SAS. Рекомендуется использовать параметр HTTPS.|

## <a name="see-also"></a>См. также
- [Использование подписанных URL-адресов (SAS)](https://docs.microsoft.com/azure/storage/common/storage-dotnet-shared-access-signature-part-1)
- [Подписанные URL-адреса. Часть 2: создание и использование подписанного URL-адреса в службе BLOB-объектов](https://docs.microsoft.com/azure/storage/blobs/storage-dotnet-shared-access-signature-part-2)
- [Защита ресурсов сети доставки содержимого Azure с помощью маркера проверки подлинности](https://docs.microsoft.com/azure/cdn/cdn-token-auth)
