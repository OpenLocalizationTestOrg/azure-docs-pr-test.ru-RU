---
title: "Управление политикой кэширования Azure CDN в службах мультимедиа Azure | Документация Майкрософт"
description: "Узнайте, как управлять политикой кэширования Azure CDN в службах мультимедиа Azure."
services: media-services,cdn
documentationcenter: .NET
author: juliako
manager: erikre
editor: 
ms.assetid: be33aecc-6dbe-43d7-a056-10ba911e0e94
ms.service: media-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/04/2017
ms.author: juliako
ms.openlocfilehash: 0c479a58f4158bb1a72dc43432507160f65d2791
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="manage-azure-cdn-caching-policy-in-azure-media-services"></a><span data-ttu-id="5defe-103">Управление политикой кэширования Azure CDN в службах мультимедиа Azure</span><span class="sxs-lookup"><span data-stu-id="5defe-103">Manage Azure CDN caching policy in Azure Media Services</span></span>
<span data-ttu-id="5defe-104">Службы мультимедиа Azure предоставляют адаптивную потоковую передачу и прогрессивное скачивание на основе протокола HTTP.</span><span class="sxs-lookup"><span data-stu-id="5defe-104">Azure Media Services provides HTTP based Adaptive Streaming and progressive download.</span></span> <span data-ttu-id="5defe-105">Потоковая передача на основе протокола HTTP — это высокомасштабируемая технология, обладающая преимуществами кэширования на стороне прокси-сервера и на стороне клиента, а также преимуществами слоев CDN.</span><span class="sxs-lookup"><span data-stu-id="5defe-105">HTTP based streaming is highly scalable with benefits of caching in proxy and CDN layers as well as client side caching.</span></span> <span data-ttu-id="5defe-106">Функция конечных точек потоковой передачи предоставляет общие возможности потоковой передачи, а также конфигурацию для заголовков кэша HTTP.</span><span class="sxs-lookup"><span data-stu-id="5defe-106">Streaming endpoints provides general streaming capabilities and also configuration for HTTP cache headers.</span></span> <span data-ttu-id="5defe-107">Она также задает заголовки HTTP Cache-Control: max-age и Expires.</span><span class="sxs-lookup"><span data-stu-id="5defe-107">Streaming endpoints sets HTTP Cache-Control: max-age and Expires headers.</span></span> <span data-ttu-id="5defe-108">Узнать больше о заголовках кэша HTTP можно на веб-сайте [W3.org](http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html).</span><span class="sxs-lookup"><span data-stu-id="5defe-108">You can get more information for HTTP cache headers from [W3.org](http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html).</span></span>

## <a name="default-caching-headers"></a><span data-ttu-id="5defe-109">Заголовки кэша по умолчанию</span><span class="sxs-lookup"><span data-stu-id="5defe-109">Default Caching headers</span></span>
<span data-ttu-id="5defe-110">Конечные точки потоковой передачи по умолчанию используют 3-дневные заголовки кэша для потоковой передачи данных по требованию (собственно мультимедийных фрагментов/блоков) и манифеста (списка воспроизведения).</span><span class="sxs-lookup"><span data-stu-id="5defe-110">By default streaming-endpoints apply 3 day cache headers for on-demand streaming data (actual media fragments/chunks) and manifest(playlist).</span></span> <span data-ttu-id="5defe-111">Для динамической потоковой передачи конечные точки потоковой передачи используют 3-дневные заголовки кэша для данных (собственно мультимедийных фрагментов/блоков) и 2-секундный заголовок для запросов манифеста (списка воспроизведения).</span><span class="sxs-lookup"><span data-stu-id="5defe-111">For live streaming, streaming endpoints apply 3 day cache headers for data (actual media fragments/chunks) and 2 seconds cache header for manifest(playlist) requests.</span></span> <span data-ttu-id="5defe-112">При переключении динамической программы в программу по запросу (динамический архив) используются заголовки кэша потоковой передачи по запросу.</span><span class="sxs-lookup"><span data-stu-id="5defe-112">When live program turns to on-demand (live archive) then on-demand streaming cache headers apply.</span></span>

## <a name="azure-cdn-integration"></a><span data-ttu-id="5defe-113">Интеграция Azure CDN</span><span class="sxs-lookup"><span data-stu-id="5defe-113">Azure CDN integration</span></span>
<span data-ttu-id="5defe-114">Службы мультимедиа Azure обеспечивают [интегрированную сеть CDN](https://azure.microsoft.com/updates/azure-media-services-now-fully-integrated-with-azure-cdn/) для конечных точек потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="5defe-114">Azure Media Services provides [integrated CDN](https://azure.microsoft.com/updates/azure-media-services-now-fully-integrated-with-azure-cdn/) for streaming-endpoints.</span></span> <span data-ttu-id="5defe-115">Заголовки Cache-control применяются таким же образом, как и конечные точки потоковой передачи для таких же точек с поддержкой CDN.</span><span class="sxs-lookup"><span data-stu-id="5defe-115">Cache-control headers applies in the same way as streaming endpoints to CDN enabled streaming endpoints.</span></span> <span data-ttu-id="5defe-116">В сетях CDN Azure значения кэша, настроенные для конечных точек потоковой передачи, используются, чтобы определить жизненный цикл внутренне кэшированных объектов и задать заголовки кэша доставки.</span><span class="sxs-lookup"><span data-stu-id="5defe-116">Azure CDN uses streaming endpoint configured cache values to define the life time of the internally cached objects and also uses this value to set the delivery cache headers.</span></span> <span data-ttu-id="5defe-117">При использовании конечных точек потоковой передачи с поддержкой CDN не рекомендуется устанавливать небольшие значения кэша.</span><span class="sxs-lookup"><span data-stu-id="5defe-117">When using CDN enabled streaming endpoints it is not recommended to set small cache values.</span></span> <span data-ttu-id="5defe-118">Малые значения кэша снижают производительность и нивелируют преимущество CDN.</span><span class="sxs-lookup"><span data-stu-id="5defe-118">Setting small values will decrease the performance and reduce the benefit of CDN.</span></span> <span data-ttu-id="5defe-119">Задать заголовки кэша менее 600 секунд для конечных точек потоковой передачи с поддержкой CDN невозможно.</span><span class="sxs-lookup"><span data-stu-id="5defe-119">It is not allowed to set cache headers smaller than 600 seconds for CDN enabled streaming endpoints.</span></span>

> [!IMPORTANT]
><span data-ttu-id="5defe-120">Службы мультимедиа Azure полностью интегрированы с Azure CDN.</span><span class="sxs-lookup"><span data-stu-id="5defe-120">Azure Media Services has complete integration with Azure CDN.</span></span> <span data-ttu-id="5defe-121">Одним щелчком можно интегрировать все доступные поставщики Azure CDN (Akamai и Verizon) в конечную точку потоковой передачи, включая продукты CDN Standard и Premium.</span><span class="sxs-lookup"><span data-stu-id="5defe-121">With a single click you can integrate all the available Azure CDN providers (Akamai and Verizon) to your streaming endpoint including CDN Standard and Premium products.</span></span> <span data-ttu-id="5defe-122">Дополнительные сведения см. в [этом объявлении](https://azure.microsoft.com/blog/standardstreamingendpoint/).</span><span class="sxs-lookup"><span data-stu-id="5defe-122">For more information, see this [announcement](https://azure.microsoft.com/blog/standardstreamingendpoint/).</span></span>
> 
> <span data-ttu-id="5defe-123">Плата за передачу данных из конечной точки в CDN отключается только тогда, когда CDN включена в API-интерфейсах конечной точки потоковой передачи или в разделе конечной точки потоковой передачи на портале управления Azure.</span><span class="sxs-lookup"><span data-stu-id="5defe-123">Data charges from streaming endpoint to CDN only gets disabled if the CDN is enabled over streaming endpoint APIs or using Azure management portal's streaming endpoint section.</span></span> <span data-ttu-id="5defe-124">При интеграции вручную или при непосредственном создании конечной точки CDN с помощью API-интерфейса CDN или на портале плата за передачу данных отключена не будет.</span><span class="sxs-lookup"><span data-stu-id="5defe-124">Manual integration or directly creating a CDN endpoint using CDN APIs or portal section will not disable the data charges.</span></span>

## <a name="configuring-cache-headers-with-azure-media-services"></a><span data-ttu-id="5defe-125">Настройка заголовков кэша с помощью служб мультимедиа Azure</span><span class="sxs-lookup"><span data-stu-id="5defe-125">Configuring cache headers with Azure Media Services</span></span>
<span data-ttu-id="5defe-126">Для настройки значений заголовков кэша можно использовать портал управления Azure или API-интерфейсы служб мультимедиа Azure.</span><span class="sxs-lookup"><span data-stu-id="5defe-126">You can use Azure Management portal or Azure Media Services APIs to configure cache header values.</span></span>

1. <span data-ttu-id="5defe-127">Настройка заголовков кэша с помощью портала управления описывается в разделе «Настройка конечной точки потоковой передачи» статьи [Как управлять конечными точками потоковой передачи](../media-services/media-services-portal-manage-streaming-endpoints.md) .</span><span class="sxs-lookup"><span data-stu-id="5defe-127">To configure cache headers using management portal please refer to [How to Manage Streaming Endpoints](../media-services/media-services-portal-manage-streaming-endpoints.md) section Configuring the Streaming Endpoint.</span></span>
2. <span data-ttu-id="5defe-128">Интерфейс REST API служб мультимедиа Azure, [StreamingEndpoint](https://msdn.microsoft.com/library/azure/dn783468.aspx#StreamingEndpointCacheControl).</span><span class="sxs-lookup"><span data-stu-id="5defe-128">Azure Media Services REST API, [StreamingEndpoint](https://msdn.microsoft.com/library/azure/dn783468.aspx#StreamingEndpointCacheControl).</span></span>
3. <span data-ttu-id="5defe-129">Пакет SDK для служб мультимедиа Azure для .NET, [свойства StreamingEndpointCacheControl](http://go.microsoft.com/fwlink/?LinkId=615302).</span><span class="sxs-lookup"><span data-stu-id="5defe-129">Azure Media Services .NET SDK, [StreamingEndpointCacheControl Properties](http://go.microsoft.com/fwlink/?LinkId=615302).</span></span>

## <a name="cache-configuration-precedence-order"></a><span data-ttu-id="5defe-130">Порядок приоритета конфигурации кэша</span><span class="sxs-lookup"><span data-stu-id="5defe-130">Cache configuration precedence order</span></span>
1. <span data-ttu-id="5defe-131">Настроенные значения кэша служб мультимедиа Azure переопределяют значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="5defe-131">Azure Media Services configured cache value overrides default value.</span></span>
2. <span data-ttu-id="5defe-132">При отсутствии ручных настроек применяются значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="5defe-132">If there is no manual configuration, default values applies.</span></span>
3. <span data-ttu-id="5defe-133">По умолчанию для манифеста динамической потоковой передачи (списка воспроизведения) используются 2-секундные заголовки кэша независимо от конфигурации мультимедиа Azure или службы хранилища Azure, и переопределить это значение невозможно.</span><span class="sxs-lookup"><span data-stu-id="5defe-133">By default 2 seconds cache headers applies to live streaming manifest(playlist) regardless of Azure Media or Azure Storage configuration and overriding of this value is not available.</span></span>

