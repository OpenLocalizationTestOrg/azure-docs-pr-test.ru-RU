---
title: "aaaWork с прокси-серверов в функции Azure | Документы Microsoft"
description: "Общие сведения о том, как toouse функции Azure учетные записи-посредники"
services: functions
documentationcenter: 
author: mattchenderson
manager: erikre
editor: 
ms.assetid: 
ms.service: functions
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 04/11/2017
ms.author: mahender
ms.openlocfilehash: 4d94c89e8f8f2d2c771b01bae142bf9a4f3b7f2a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="work-with-azure-functions-proxies-preview"></a>Работа с прокси в Функциях Azure (предварительная версия)

> [!NOTE] 
> Сейчас доступна предварительная версия прокси Функций Azure. Он распространяется бесплатно, пока в предварительной версии, но стандартные функции выставления счетов применяется tooproxy выполнений. Дополнительные сведения см. на странице [цен на Функции Azure](https://azure.microsoft.com/pricing/details/functions/).

В этой статье объясняется, как tooconfigure и работать с Azure функции прокси-серверов. Эта функция позволяет указать конечные точки в приложении-функции, реализуемые другим ресурсом. Можно использовать эти учетные записи-посредники toobreak больших API, в нескольких приложениях функции (как архитектура микрослужбу) и сохранить одну область API для клиентов.

[!INCLUDE [intro](../../includes/functions-bindings-intro.md)]


## <a name="enable"></a>Включение прокси-серверов Функций Azure

По умолчанию прокси не включены. Можно создать учетные записи-посредники hello компонент отключен, но они не будут выполняться. учетные записи-посредники tooenable hello следующие:

1. Откройте hello [портал Azure], и затем перейти tooyour функции приложения.
2. Выберите **Параметры приложения-функции**.
3. Коммутатор **включить Azure функции прокси-серверов (Предварительная версия)** слишком**на**.

Можно также вернуть здесь tooupdate hello прокси-сервера, среда выполнения как становятся доступными новые возможности.


## <a name="create"></a>Создание прокси-сервера

В этом разделе показано, как toocreate a прокси-сервера в hello функции портала.

1. Откройте hello [портал Azure], и затем перейти tooyour функции приложения.
2. Выберите в левой области hello **новый прокси-сервер**.
3. Задайте имя прокси.
4. Настройте hello конечную точку, которая предоставляется для этой функции приложения, указав hello **шаблон маршрута** и **методы HTTP**. Эти параметры ведут себя соответствующим правила toohello [триггеры HTTP].
5. Набор hello **URL-адрес внутреннего** tooanother конечной точки. Ею может быть функция в другом приложении-функции или другой API. Hello значение не обязательно toobe статический, и он может ссылаться на [параметры приложения] и [параметров из исходного запроса клиента hello].
6. Щелкните **Создать**.

Прокси теперь существует в виде новой конечной точки в приложении-функции. С точки зрения клиента это эквивалент tooan HttpTrigger в функциях Azure. Можно опробовать новый прокси-сервера путем копирования hello URL-адрес прокси-сервера и его тестирование с помощью HTTP клиента по вашему выбору.

## <a name="modify-requests-responses"></a>Изменение запросов и ответов

С помощью функции Azure учетных записей-посредников можно изменить ответы tooand запросов из серверной части hello. При таком преобразовании используются переменные, указанные в разделе [Использование переменных].

### <a name="modify-backend-request"></a>Измените запрос hello серверной части

По умолчанию hello серверной части запроса инициализируется как копию исходного запроса hello. В дополнение к этому toosetting hello серверной части URL-адрес, можно сделать метод HTTP toohello изменения, заголовки и параметры строки запроса. Hello измененные значения могут ссылаться на [параметры приложения] и [параметров из исходного запроса клиента hello].

Сейчас на портале не предусмотрена возможность изменения запросов внутреннего сервера. toolearn tooapply эту возможность от proxies.json, в статье [Определите объект requestOverrides].

### <a name="modify-response"></a>Изменение ответа hello

По умолчанию hello ответа клиента инициализируется как копия ответа hello серверной части. Можно сделать код состояния ответа toohello изменения, фразу причины, заголовки и текст. Hello измененные значения могут ссылаться на [параметры приложения], [параметров из исходного запроса клиента hello], и [параметров из ответа внутренней hello].

Сейчас на портале не предусмотрена возможность изменения ответов. toolearn tooapply эту возможность от proxies.json, в статье [Определите объект responseOverrides].

## <a name="using-variables"></a>Использование переменных

Hello конфигурации для прокси-сервер не обязательно toobe статический. Можно условия его toouse переменные из hello первоначальный запрос, ответ серверной части hello или параметров приложений.

### <a name="request-parameters"></a>Ссылки на параметры запроса

Параметры запроса можно использовать как входные данные свойства URL-адрес внутренней toohello или как часть изменение запросов и ответов. Некоторые параметры могут быть привязаны из hello шаблон маршрута, который задан в конфигурации hello базовый прокси-сервера, а другие могут поступать из свойства hello входящего запроса.

#### <a name="route-template-parameters"></a>Параметры шаблона маршрута
Параметры, используемые в шаблоне маршрута hello являются доступными toobe ссылаться по имени. имена параметров Hello заключенных в фигурные скобки ({}).

Например, если прокси-сервер имеет шаблон маршрута, например `/pets/{petId}`, hello серверной части URL-адрес может включать значение hello `{petId}`, как в `https://<AnotherApp>.azurewebsites.net/api/pets/{petId}`. Если шаблон маршрута hello завершается в подстановочный знак, таких как `/api/{*restOfPath}`, hello значение `{restOfPath}` представляет собой строку hello оставшиеся сегменты пути hello входящий запрос.

#### <a name="additional-request-parameters"></a>Дополнительные параметры запроса
Кроме toohello направления параметров шаблона, можно использовать hello последующих значений в значения конфигурации:

* **{request.method}** : hello метод HTTP, используемый в исходном запросе hello.
* **{request.headers. \<HeaderName\>}**: заголовок, который может быть считано из исходного запроса hello. Замените  *\<HeaderName\>*  с именем hello hello заголовка, которые должны tooread. Если заголовок hello не включена в запрос hello, hello значение будет пустая строка hello.
* **{request.querystring. \<Имя_параметра\>}**: параметр строки запроса, могут быть прочитаны из исходного запроса hello. Замените  *\<Имя_параметра\>*  с именем hello hello параметра, которое следует tooread. Если параметр hello не включается в запрос hello, hello значение будет пустая строка hello.

### <a name="response-parameters"></a>Ссылки на параметры ответа внутреннего сервера

Параметры ответа можно использовать как часть изменения hello ответа toohello клиента. Hello последующих значений можно использовать в значения конфигурации:

* **{backend.response.statusCode}** : hello код состояния HTTP, который возвращается в ответе hello серверной части.
* **{backend.response.statusReason}** : фразу причины hello HTTP, возвращаемый в ответе hello серверной части.
* **{backend.response.headers. \<HeaderName\>}**: заголовок, который может быть считано из ответа hello серверной части. Замените  *\<HeaderName\>*  с именем hello заголовка hello требуется tooread. Если заголовок hello не включена в запрос hello, hello значение будет пустая строка hello.

### <a name="use-appsettings"></a>Ссылки на параметры приложения

Можно также сослаться на [параметры приложения, определенные для функции приложение hello](https://docs.microsoft.com/azure/azure-functions/functions-how-to-use-azure-function-app-settings#develop) заключив имя параметра hello в символы процентов (%).

Например, серверной части URL- *https://%ORDER_PROCESSING_HOST%/api/orders* бы «% ORDER_PROCESSING_HOST %» заменено значением hello параметра ORDER_PROCESSING_HOST hello.

> [!TIP] 
> Используйте параметры приложения для внутренних узлов при наличии нескольких развертываний или тестовых сред. Таким образом, можно гарантировать, что вы всегда говорите самому началу toohello завершения для этой среды.

## <a name="advanced-configuration"></a>Расширенная конфигурация

Hello прокси-серверы, настроенные хранятся в файле proxies.json, который находится в корневом каталоге hello функции каталога приложения. Можно вручную изменить этот файл и развернуть его как часть приложения, при использовании любого hello [методы развертывания](https://docs.microsoft.com/azure/azure-functions/functions-continuous-deployment) , поддерживаемые функции. функция Hello должен быть [включен](#enable) для обработки toobe файл hello. 

> [!TIP] 
> Если вы не настроили одним из способов развертывания hello, можно также работать с файлом proxies.json hello hello портала. Последовательно выберите tooyour функции приложения, выберите **возможности платформы**и выберите **редактор службы приложения**. Таким образом, можно просматривать структуру приложения функции hello весь файл и внесите изменения.

Файл proxies.json определяется объектом прокси, который состоит из именованных прокси и их определений. При необходимости для автозавершения кода можно ссылаться на [схему JSON](http://json.schemastore.org/proxies), если ваш редактор поддерживает такую возможность. Пример файла может выглядеть hello следующим образом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "proxy1": {
            "matchCondition": {
                "methods": [ "GET" ],
                "route": "/api/{test}"
            },
            "backendUri": "https://<AnotherApp>.azurewebsites.net/api/<FunctionName>"
        }
    }
}
```

Каждый прокси-сервер имеет понятное имя, например *proxy1* в предшествующих пример hello. Hello соответствующий объект определения прокси-сервера определяется hello следующие свойства:

* **matchCondition**: требуется — объект, определяющий hello запросы, вызывающие выполнение hello этого прокси-сервера. Он содержит два свойства, используемые совместно с [триггеры HTTP]:
    * _методы_: массив hello HTTP-методов, которые hello прокси-сервер отвечает на. Если не указан, hello прокси-сервер отвечает tooall HTTP-методов в маршруте hello.
    * _маршрут_: требуются определяет шаблон маршрута hello, управление которой запрос URL-адреса прокси-сервер отвечает. В отличие от триггеров HTTP значение по умолчанию отсутствует.
* **backendUri**: hello URL-адрес hello внутренний ресурс toowhich hello запроса должен быть прокси. Это значение можно ссылаться из исходного запроса клиента hello параметры приложения и параметры. Если это свойство не включено, Функции Azure вернут ответ HTTP 200 OK.
* **requestOverrides**: объект, определяющий преобразования toohello серверной части запроса. Ознакомьтесь с разделом [Определите объект requestOverrides].
* **responseOverrides**: объект, определяющий ответа клиента toohello преобразования. Ознакомьтесь с разделом [Определите объект responseOverrides].

> [!NOTE] 
> свойства маршрута Hello Azure функции прокси-серверы не учитывают свойство routePrefix hello конфигурации узла функции hello. Если вы хотите tooinclude является префиксом, например /api, он должен включаться в свойстве маршрута hello.

### <a name="requestOverrides"></a>Определение объекта requestOverrides

Объект requestOverrides Hello определяет изменения, внесенные toohello запроса при вызове hello внутренний ресурс. Hello объекта определяется hello следующие свойства:

* **backend.Request.Method**: hello метод HTTP, который использовал toocall hello серверной части.
* **backend.Request.Querystring. \<Имя_параметра\>**: параметр строки запроса, можно задать для hello вызовов toohello серверной части. Замените  *\<Имя_параметра\>*  с именем hello hello параметра, которое следует tooset. Если пустая строка hello, параметр hello не включена на hello серверной части запроса.
* **backend.Request.Headers. \<HeaderName\>**: заголовок, который может быть задано для hello вызовов toohello серверной части. Замените  *\<HeaderName\>*  с именем hello hello заголовка, которые должны tooset. Если указать пустую строку hello hello не колонтитул hello серверной части запроса.

Значения можно ссылаться из исходного запроса клиента hello параметры приложения и параметры.

Пример конфигурации может выглядеть hello следующим образом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "proxy1": {
            "matchCondition": {
                "methods": [ "GET" ],
                "route": "/api/{test}"
            },
            "backendUri": "https://<AnotherApp>.azurewebsites.net/api/<FunctionName>",
            "requestOverrides": {
                "backend.request.headers.Accept": "application/xml",
                "backend.request.headers.x-functions-key": "%ANOTHERAPP_API_KEY%"
            }
        }
    }
}
```

### <a name="responseOverrides"></a>Определение объекта responseOverrides

Объект requestOverrides Hello определяет изменения, внесенные toohello ответ, который прошел задней toohello клиента. Hello объекта определяется hello следующие свойства:

* **response.statusCode**: toobe код состояния hello HTTP вернул toohello клиента.
* **response.statusReason**: toobe фразу причины hello HTTP вернул toohello клиента.
* **Response.Body**: hello строковое представление toobe текст hello вернул toohello клиента.
* **Response.Headers. \<HeaderName\>**: заголовок, который можно задать для клиента toohello hello ответа. Замените  *\<HeaderName\>*  с именем hello hello заголовка, которые должны tooset. Если указать пустую строку hello hello не колонтитул hello ответа.

Значения можно ссылаться из ответа внутренней hello параметры приложения, параметры из hello первоначальный запрос клиента и параметры.

Пример конфигурации может выглядеть hello следующим образом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "proxy1": {
            "matchCondition": {
                "methods": [ "GET" ],
                "route": "/api/{test}"
            },
            "responseOverrides": {
                "response.body": "Hello, {test}",
                "response.headers.Content-Type": "text/plain"
            }
        }
    }
}
```
> [!NOTE] 
> В этом примере текст hello задается значение напрямую, поэтому нет `backendUri` необходимые свойства. Hello примере показано, как можно использовать функции Azure учетных записей-посредников для имитации API-интерфейсы.

[портал Azure]: https://portal.azure.com
[триггеры HTTP]: https://docs.microsoft.com/azure/azure-functions/functions-bindings-http-webhook#http-trigger
[Modify hello back-end request]: #modify-backend-request
[Modify hello response]: #modify-response
[Определите объект requestOverrides]: #requestOverrides
[Определите объект responseOverrides]: #responseOverrides
[параметры приложения]: #use-appsettings
[Использование переменных]: #using-variables
[параметров из исходного запроса клиента hello]: #request-parameters
[параметров из ответа внутренней hello]: #response-parameters
