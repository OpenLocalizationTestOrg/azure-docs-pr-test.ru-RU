---
title: "Создание бессерверного API с помощью Функций Azure | Документация Майкрософт"
description: "Руководство по созданию бессерверного API с помощью Функций Azure."
services: functions
author: mattchenderson
manager: erikre
ms.service: functions
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: tutorial
ms.date: 05/04/2017
ms.author: mahender
ms.custom: mvc
ms.openlocfilehash: 28056a385b058f7daeca2253ccb304116b49eba0
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="create-a-serverless-api-using-azure-functions"></a>Создание бессерверного API с помощью Функций Azure

В этом руководстве вы узнаете, как с помощью Функций Azure создавать высокомасштабируемые API. Функции Azure поставляются с набором встроенных триггеров и привязок HTTP, которые упрощают создание конечных точек на различных языках, включая Node.JS, C# и другие. В этом руководстве вы настроите триггер HTTP, который будет обрабатывать определенные действия в вашем API. Вы также подготовите ваш API к увеличению размеров, интегрировав его с прокси-серверами Функций Azure и установив макет API. Все это будет выполнено в бессерверной вычислительной среде Функций, так что вам не придется беспокоиться о масштабировании ресурсов, вы просто сможете сосредоточиться на логике вашего API.

## <a name="prerequisites"></a>Предварительные требования 

[!INCLUDE [Previous quickstart note](../../includes/functions-quickstart-previous-topics.md)]

Полученная функция будет использоваться до конца этого руководства.

### <a name="sign-in-to-azure"></a>Вход в Azure

Перейдите на портал Azure. Для этого войдите на портал [https://portal.azure.com](https://portal.azure.com) с помощью вашей учетной записи Azure.

## <a name="customize-your-http-function"></a>Настройка функции HTTP

По умолчанию функция, инициируемая HTTP-запросом, настроена для приема любого метода HTTP. Существует также URL-адрес по умолчанию следующего вида: `http://<yourapp>.azurewebsites.net/api/<funcname>?code=<functionkey>`. Если вы следовали краткому руководству, тогда `<funcname>`, вероятно, выглядит примерно так: HttpTriggerJS1. В этом разделе вы измените функцию, чтобы отвечать только на запросы GET вместо маршрута `/api/hello`. 

Перейдите к своей функции на портале Azure. В левой области навигации выберите **Интегрировать**.

![Настройка функции HTTP](./media/functions-create-serverless-api/customizing-http.png)

Используйте настройки триггера HTTP, как указано в таблице.

| Поле | Образец значения | Описание |
|---|---|---|
| Разрешенные методы HTTP | Выбранные методы | Определяет, какие методы HTTP могут использоваться для вызова этой функции |
| Выбранные методы HTTP | ПОЛУЧЕНИЕ | Разрешает использовать только выбранные методы HTTP для вызова этой функции |
| Шаблон маршрута | /hello | Определяет пути, используемые для вызова этой функции |

Обратите внимание, что вы не включали префикс базового пути `/api` в шаблон маршрута, так как он обрабатывается глобальным параметром.

Щелкните **Сохранить**.

Дополнительные сведения см. в статье [Привязки HTTP и webhook в функциях Azure](https://docs.microsoft.com/azure/azure-functions/functions-bindings-http-webhook#customizing-the-http-endpoint).

### <a name="test-your-api"></a>Тестирование API

Протестируйте свою функцию, чтобы увидеть, как она работает с новой поверхностью API.

Вернитесь на страницу разработки, щелкнув имя функции в левой области навигации.

Щелкните **Get function URL** (Получить URL-адрес функции) и скопируйте URL-адрес. Вы должны увидеть, что теперь используется маршрут `/api/hello`.

Скопируйте URL-адрес в новую вкладку браузера или в предпочтительный клиент REST. По умолчанию браузер использует функцию GET.

Выполните функцию и убедитесь, что она работает. Возможно, потребуется указать параметр имени в качестве строки запроса, чтобы использовать код быстрого запуска.

Вы также можете попытаться вызвать конечную точку с помощью другого метода HTTP, чтобы убедиться, что эта функция не выполняется. Для этого необходимо использовать клиент REST, например cURL, Postman или Fiddler.

## <a name="proxies-overview"></a>Общие сведения о прокси-серверах

В следующем разделе вы получите доступ к вашему API через прокси-сервер. Прокси-серверы Функций Azure — это предварительная версия функции, позволяющая вам перенаправлять запросы к другим ресурсам. Вы определяете конечную точку HTTP точно так же, как триггер HTTP, но вместо написания кода для выполнения при вызове этой конечной точки вы указываете URL-адрес для удаленной реализации. Это позволяет вам собрать несколько источников API в единую поверхность API, которую можно легко использовать. Это особенно полезно, если вы хотите создать свой API как микрослужбы.

Прокси-сервер может указывать на любой ресурс HTTP, например:
- Функции Azure 
- Приложения API в [службе приложений Azure](https://docs.microsoft.com/azure/app-service/app-service-value-prop-what-is).
- Контейнеры Docker в [службе приложений под управлением Linux](https://docs.microsoft.com/azure/app-service/app-service-linux-readme).
- Любой другой размещенный API.

Дополнительные сведения о прокси-сервере см. в статье [Работа с прокси Функций Azure (предварительная версия)].

## <a name="create-your-first-proxy"></a>Создание первого прокси-сервера

В этом разделе вы создадите прокси-сервер, который будет выступать в качестве интерфейса для вашего API. 

### <a name="setting-up-the-frontend-environment"></a>Настройка среды интерфейса

Повторите шаги для [создания приложения-функции](https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function#create-a-function-app), чтобы создать приложение-функцию, в котором вы создадите свой прокси-сервер. Это новое приложение будет использоваться в качестве интерфейса для нашего API, а измененное приложение-функция — в качестве внутреннего сервера.

Перейдите к своему новому приложению-функции интерфейса на портале.

Выберите элемент **Параметры**. Включите параметр **Использовать прокси-серверы для API-интерфейсов**.

Выберите **Platform Settings** (Параметры платформы), а затем — **Параметры приложения**.

Прокрутите вниз до **Параметры приложения** и создайте параметр с ключом HELLO_HOST. Задайте узел приложения-функции внутреннего сервера, например `<YourApp>.azurewebsites.net`, в качестве его значения. Это часть URL-адреса, скопированного ранее при тестировании функции HTTP. Вы укажете этот параметр при конфигурации позднее.

> [!NOTE] 
> Мы рекомендуем использовать параметры приложения для настройки узла, чтобы прокси-сервер не зависел от жестко заданной среды. Использование настроек приложения означает, что вы можете перемещать конфигурацию прокси-сервера между средами. Параметры приложения для конкретной среды будут применяться.

Щелкните **Сохранить**.

### <a name="creating-a-proxy-on-the-frontend"></a>Создание прокси-сервера в интерфейсе

Вернитесь к своему приложению-функции интерфейса на портале.

В области навигации слева щелкните значок "+" рядом с "Прокси (предварительная версия)".

![Создание прокси](./media/functions-create-serverless-api/creating-proxy.png)

Используйте настройки прокси-сервера, как указано в таблице.

| Поле | Образец значения | Описание |
|---|---|---|
| Имя | HelloProxy | Понятное имя, используемое только для управления |
| Шаблон маршрута | /api/hello | Определяет пути, используемые для вызова этого прокси-сервера |
| Внутренний URL-адрес | https://%HELLO_HOST%/api/hello | Определяет конечную точку, к которой должен быть отправлен запрос |

Обратите внимание, что прокси-сервер не предоставляет префикс базового пути `/api`, который нужно включить в шаблон маршрута.

Синтаксис `%HELLO_HOST%` будет ссылаться на созданный ранее параметр приложения. Разрешенный URL-адрес будет указывать на исходную функцию.

Щелкните **Создать**.

Вы можете испытать новый прокси-сервер, скопировав URL-адрес прокси-сервера и протестировав его в браузере или с помощью избранного клиента HTTP.

## <a name="create-a-mock-api"></a>Создание макета API

Вы создадите макет API для своего решения с помощью прокси-сервера. Это позволяет разрабатывать клиент без необходимости полного внедрения внутреннего сервера. Позже при разработке вы можете создать приложение-функцию, которое поддерживает эту логику, и перенаправить на него свой прокси-сервер.

Чтобы создать макет API, мы создадим прокси-сервер, в этот раз с помощью [редактора службы приложений](https://github.com/projectkudu/kudu/wiki/App-Service-Editor). Чтобы начать работу, перейдите к своему приложению-функции на портале. Выберите **Функции платформы** и найдите **редактор службы приложений**. Если вы щелкнете его, в новой вкладке откроется редактор службы приложений.

В левой области навигации выберите `proxies.json`. Это файл, в котором хранятся конфигурации для всех ваших прокси-серверов. Если вы используете один из [методов развертывания Функций](https://docs.microsoft.com/azure/azure-functions/functions-continuous-deployment), это файл, который вы будете поддерживать в системе управления версиями. Дополнительные сведения об этом файле см. в разделе [Расширенная конфигурация](https://docs.microsoft.com/azure/azure-functions/functions-proxies#advanced-configuration).

Если вы выполнили все указания пошагового руководства, ваш файл proxies.json должен выглядеть следующим образом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "HelloProxy": {
            "matchCondition": {
                "route": "/api/hello"
            },
            "backendUri": "https://%HELLO_HOST%/api/hello"
        }
    }
}
```

Затем добавьте макет API. Замените свой файл proxies.json следующим кодом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "HelloProxy": {
            "matchCondition": {
                "route": "/api/hello"
            },
            "backendUri": "https://%HELLO_HOST%/api/hello"
        },
        "GetUserByName" : {
            "matchCondition": {
                "methods": [ "GET" ],
                "route": "/api/users/{username}"
            },
            "responseOverrides": {
                "response.statusCode": "200",
                "response.headers.Content-Type" : "application/json",
                "response.body": {
                    "name": "{username}",
                    "description": "Awesome developer and master of serverless APIs",
                    "skills": [
                        "Serverless",
                        "APIs",
                        "Azure",
                        "Cloud"
                    ]
                }
            }
        }
    }
}
```

При этом добавляется новый прокси, GetUserByName, без свойства backendUri. Вместо вызова другого ресурса он изменяет ответ по умолчанию от прокси-серверов, используя переопределение ответа. Переопределение запроса и ответа может также использоваться в сочетании с URL-адресом внутреннего сервера. Это особенно полезно при перенаправлении к устаревшим системам, где вам может потребоваться изменить заголовки, параметры запроса и т. д. Дополнительные сведения о переопределении запроса и ответа см. в [этой статье](https://docs.microsoft.com/azure/azure-functions/functions-proxies#a-namemodify-requests-responsesamodifying-requests-and-responses).

Протестируйте макет API, вызвав конечную точку `/api/users/{username}` с помощью браузера или избранного клиента REST. Замените _{username}_ строковым значением, представляющим имя пользователя.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы научились создавать и настраивать API с помощью решения "Функции Azure", а также объединять несколько API, включая макеты, в единую поверхность API. Вы можете использовать эти методы для создания API любой сложности, работая в бессерверной вычислительной модели, предоставляемой Функциями Azure.

Следующие ссылки могут оказаться полезными при дальнейшей разработке API:

- [Привязки HTTP и webhook в функциях Azure](https://docs.microsoft.com/azure/azure-functions/functions-bindings-http-webhook)
- [Работа с прокси Функций Azure (предварительная версия)]
- [Создание метаданных OpenAPI 2.0 (Swagger) для приложения-функции (предварительная версия)](https://docs.microsoft.com/azure/azure-functions/functions-api-definition-getting-started)


[Create your first function]: https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function
[Работа с прокси Функций Azure (предварительная версия)]: https://docs.microsoft.com/azure/azure-functions/functions-proxies
