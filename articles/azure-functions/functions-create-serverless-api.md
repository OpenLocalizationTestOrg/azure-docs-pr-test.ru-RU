---
title: "Создание бессерверного API с помощью Функций Azure | Документация Майкрософт"
description: "Руководство по созданию бессерверного API с помощью Функций Azure."
services: functions
author: mattchenderson
manager: cfowler
ms.service: functions
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: tutorial
ms.date: 05/04/2017
ms.author: mahender
ms.custom: mvc
ms.openlocfilehash: 7c3933210c01c81077b594abb8c3183d6e3c58a0
ms.sourcegitcommit: 9a61faf3463003375a53279e3adce241b5700879
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2017
---
# <a name="create-a-serverless-api-using-azure-functions"></a>Создание бессерверного API с помощью Функций Azure

Из этого руководства вы узнаете, как с помощью решения "Функции Azure" создавать высокомасштабируемые API-интерфейсы. Решение "Функции Azure" включает набор встроенных триггеров и привязок HTTP, которые упрощают создание конечных точек на разных языках, включая Node.JS, C# и другие. В этом руководстве вы настроите триггер HTTP, который будет обрабатывать определенные действия в вашем API. Вы также подготовите ваш API к увеличению размеров, интегрировав его с прокси-серверами Функций Azure и установив макет API. Все это будет выполнено в бессерверной вычислительной среде Функций, так что вам не придется беспокоиться о масштабировании ресурсов, вы просто сможете сосредоточиться на логике вашего API.

## <a name="prerequisites"></a>Предварительные требования 

[!INCLUDE [Previous quickstart note](../../includes/functions-quickstart-previous-topics.md)]

Полученная функция будет использоваться до конца этого руководства.

### <a name="sign-in-to-azure"></a>Вход в Azure

Перейдите на портал Azure. Для этого войдите на портал [https://portal.azure.com](https://portal.azure.com) с помощью вашей учетной записи Azure.

## <a name="customize-your-http-function"></a>Настройка функции HTTP

По умолчанию функция, инициируемая HTTP-запросом, настроена для приема любого метода HTTP. Существует также URL-адрес по умолчанию следующего вида: `http://<yourapp>.azurewebsites.net/api/<funcname>?code=<functionkey>`. Если вы следовали краткому руководству, тогда `<funcname>`, вероятно, выглядит примерно так: HttpTriggerJS1. В этом разделе вы измените функцию, чтобы отвечать только на запросы GET вместо маршрута `/api/hello`. 

1. Перейдите к своей функции на портале Azure. В левой области навигации выберите **Интегрировать**.

    ![Настройка функции HTTP](./media/functions-create-serverless-api/customizing-http.png)

1. Используйте настройки триггера HTTP, как указано в таблице.

    | Поле | Образец значения | Описание |
    |---|---|---|
    | Разрешенные методы HTTP | Выбранные методы | Определяет, какие методы HTTP могут использоваться для вызова этой функции |
    | Выбранные методы HTTP | ПОЛУЧЕНИЕ | Разрешает использовать только выбранные методы HTTP для вызова этой функции |
    | Шаблон маршрута | /hello | Определяет пути, используемые для вызова этой функции |
    | Уровень авторизации | Анонимные | (Необязательно.) Предоставляет доступ к функции без ключа API |

    > [!NOTE] 
    > Обратите внимание, что вы не включали префикс базового пути `/api` в шаблон маршрута, так как он обрабатывается глобальным параметром.

1. Щелкните **Сохранить**.

Дополнительные сведения см. в статье [Привязки HTTP и webhook в функциях Azure](https://docs.microsoft.com/azure/azure-functions/functions-bindings-http-webhook#customizing-the-http-endpoint).

### <a name="test-your-api"></a>Тестирование API

Протестируйте свою функцию, чтобы увидеть, как она работает с новой поверхностью API.
1. Вернитесь на страницу разработки, щелкнув имя функции в левой области навигации.
1. Щелкните **Get function URL** (Получить URL-адрес функции) и скопируйте URL-адрес. Вы должны увидеть, что теперь используется маршрут `/api/hello`.
1. Скопируйте URL-адрес в новую вкладку браузера или в предпочтительный клиент REST. По умолчанию браузер использует функцию GET.
1. Добавьте параметры строки запроса в URL-адрес, например `/api/hello/?name=John`.
1. Нажмите клавишу ВВОД, чтобы убедиться, что он работает. Вы увидите ответ "*Hello John*".
1. Вы также можете попытаться вызвать конечную точку с помощью другого метода HTTP, чтобы убедиться, что эта функция не выполняется. Для этого необходимо использовать клиент REST, например cURL, Postman или Fiddler.

## <a name="proxies-overview"></a>Общие сведения о прокси-серверах

В следующем разделе вы получите доступ к вашему API через прокси-сервер. Функция "Прокси-серверы Функций Azure" позволяет вам перенаправлять запросы к другим ресурсам. Вы определяете конечную точку HTTP точно так же, как триггер HTTP, но вместо написания кода для выполнения при вызове этой конечной точки вы указываете URL-адрес для удаленной реализации. Это позволяет вам собрать несколько источников API в единую поверхность API, которую можно легко использовать. Это особенно полезно, если вы хотите создать свой API как микрослужбы.

Прокси-сервер может указывать на любой ресурс HTTP, например:
- Функции Azure 
- Приложения API в [службе приложений Azure](https://docs.microsoft.com/azure/app-service/app-service-web-overview).
- Контейнеры Docker в [службе приложений под управлением Linux](https://docs.microsoft.com/azure/app-service/containers/app-service-linux-intro).
- Любой другой размещенный API.

Дополнительные сведения о прокси-серверах см. в статье [Работа с функцией "Прокси-серверы Функций Azure"].

## <a name="create-your-first-proxy"></a>Создание первого прокси-сервера

В этом разделе вы создадите прокси-сервер, который будет выступать в качестве интерфейса для вашего API. 

### <a name="setting-up-the-frontend-environment"></a>Настройка среды интерфейса

Повторите шаги для [создания приложения-функции](https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function#create-a-function-app), чтобы создать приложение-функцию, в котором вы создадите свой прокси-сервер. URL-адрес этого нового приложения будет использоваться в качестве интерфейса для нашего API, а измененное приложение-функция — в качестве серверной части.

1. Перейдите к своему новому приложению-функции интерфейса на портале.
1. Выберите **Функции платформы**, а затем — **Параметры приложения**.
1. Прокрутите вниз до раздела **Параметры приложения**, в котором хранятся пары "ключ-значение", а затем создайте параметр с ключом HELLO_HOST. Задайте узел приложения-функции внутреннего сервера, например `<YourBackendApp>.azurewebsites.net`, в качестве его значения. Это часть URL-адреса, скопированного ранее при тестировании функции HTTP. Вы укажете этот параметр при конфигурации позднее.

    > [!NOTE] 
    > Мы рекомендуем использовать параметры приложения для настройки узла, чтобы прокси-сервер не зависел от жестко заданной среды. Использование настроек приложения означает, что вы можете перемещать конфигурацию прокси-сервера между средами. Параметры приложения для конкретной среды будут применяться.

1. Щелкните **Сохранить**.

### <a name="creating-a-proxy-on-the-frontend"></a>Создание прокси-сервера в интерфейсе

1. Вернитесь к своему приложению-функции интерфейса на портале.
1. В области навигации слева щелкните значок "+" рядом с Proxies (Прокси-серверы).
    ![Создание прокси](./media/functions-create-serverless-api/creating-proxy.png)
1. Используйте настройки прокси-сервера, как указано в таблице. 

    | Поле | Образец значения | Описание |
    |---|---|---|
    | Имя | HelloProxy | Понятное имя, используемое только для управления |
    | Шаблон маршрута | /api/hello | Определяет пути, используемые для вызова этого прокси-сервера |
    | Внутренний URL-адрес | https://%HELLO_HOST%/api/hello | Определяет конечную точку, к которой должен быть отправлен запрос |
    
1. Обратите внимание, что прокси-сервер не предоставляет префикс базового пути `/api`, который нужно включить в шаблон маршрута.
1. Синтаксис `%HELLO_HOST%` будет ссылаться на созданный ранее параметр приложения. Разрешенный URL-адрес будет указывать на исходную функцию.
1. Щелкните **Создать**.
1. Вы можете испытать новый прокси-сервер, скопировав URL-адрес прокси-сервера и протестировав его в браузере или с помощью избранного клиента HTTP.
    1. Для использования анонимной функции:
        1. `https://YOURPROXYAPP.azurewebsites.net/api/hello?name="Proxies"`
    1. Для использования функции с авторизацией:
        1. `https://YOURPROXYAPP.azurewebsites.net/api/hello?code=YOURCODE&name="Proxies"`

## <a name="create-a-mock-api"></a>Создание макета API

Вы создадите макет API для своего решения с помощью прокси-сервера. Это позволяет разрабатывать клиент без необходимости полного внедрения внутреннего сервера. Позже при разработке вы можете создать приложение-функцию, которое поддерживает эту логику, и перенаправить на него свой прокси-сервер.

Чтобы создать макет API, мы создадим прокси-сервер, в этот раз с помощью [редактора службы приложений](https://github.com/projectkudu/kudu/wiki/App-Service-Editor). Чтобы начать работу, перейдите к своему приложению-функции на портале. Выберите **Функции платформы** и в разделе **Средства разработки** найдите **редактор службы приложений**. Если вы щелкнете его, в новой вкладке откроется редактор службы приложений.

В левой области навигации выберите `proxies.json`. Это файл, в котором хранятся конфигурации для всех ваших прокси-серверов. Если вы используете один из [методов развертывания Функций](https://docs.microsoft.com/azure/azure-functions/functions-continuous-deployment), это файл, который вы будете поддерживать в системе управления версиями. Дополнительные сведения об этом файле см. в разделе [Расширенная конфигурация](https://docs.microsoft.com/azure/azure-functions/functions-proxies#advanced-configuration).

Если вы выполнили все указания пошагового руководства, ваш файл proxies.json должен выглядеть следующим образом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "HelloProxy": {
            "matchCondition": {
                "route": "/api/hello"
            },
            "backendUri": "https://%HELLO_HOST%/api/hello"
        }
    }
}
```

Затем добавьте макет API. Замените свой файл proxies.json следующим кодом:

```json
{
    "$schema": "http://json.schemastore.org/proxies",
    "proxies": {
        "HelloProxy": {
            "matchCondition": {
                "route": "/api/hello"
            },
            "backendUri": "https://%HELLO_HOST%/api/hello"
        },
        "GetUserByName" : {
            "matchCondition": {
                "methods": [ "GET" ],
                "route": "/api/users/{username}"
            },
            "responseOverrides": {
                "response.statusCode": "200",
                "response.headers.Content-Type" : "application/json",
                "response.body": {
                    "name": "{username}",
                    "description": "Awesome developer and master of serverless APIs",
                    "skills": [
                        "Serverless",
                        "APIs",
                        "Azure",
                        "Cloud"
                    ]
                }
            }
        }
    }
}
```

При этом добавляется новый прокси, GetUserByName, без свойства backendUri. Вместо вызова другого ресурса он изменяет ответ по умолчанию от прокси-серверов, используя переопределение ответа. Переопределение запроса и ответа может также использоваться в сочетании с URL-адресом внутреннего сервера. Это особенно полезно при перенаправлении к устаревшим системам, где вам может потребоваться изменить заголовки, параметры запроса и т. д. Дополнительные сведения о переопределении запроса и ответа см. в [этой статье](https://docs.microsoft.com/azure/azure-functions/functions-proxies#a-namemodify-requests-responsesamodifying-requests-and-responses).

Протестируйте макет API, вызвав конечную точку `<YourProxyApp>.azurewebsites.net/api/users/{username}` с помощью браузера или избранного клиента REST. Замените _{username}_ строковым значением, представляющим имя пользователя.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы научились создавать и настраивать API с помощью решения "Функции Azure", а также объединять несколько API, включая макеты, в единую поверхность API. Вы можете использовать эти методы для создания API любой сложности, работая в бессерверной вычислительной модели, предоставляемой Функциями Azure.

Следующие ссылки могут оказаться полезными при дальнейшей разработке API:

- [Привязки HTTP и webhook в функциях Azure](https://docs.microsoft.com/azure/azure-functions/functions-bindings-http-webhook)
- [Работа с функцией "Прокси-серверы Функций Azure"]
- [Создание метаданных OpenAPI 2.0 (Swagger) для приложения-функции (предварительная версия)](https://docs.microsoft.com/azure/azure-functions/functions-api-definition-getting-started)


[Create your first function]: https://docs.microsoft.com/azure/azure-functions/functions-create-first-azure-function
[Работа с функцией "Прокси-серверы Функций Azure"]: https://docs.microsoft.com/azure/azure-functions/functions-proxies
