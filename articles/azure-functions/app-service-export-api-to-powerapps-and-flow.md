---
title: "Экспорт размещенного в Azure API в PowerApps и Microsoft Flow | Документация Майкрософт"
description: "Общие сведения о предоставлении API, размещенного в службе приложений, для PowerApps и Microsoft Flow"
services: app-service
documentationcenter: 
author: mattchenderson
manager: erikre
editor: 
ms.assetid: 
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 12/15/2017
ms.author: mahender; mblythe
ms.openlocfilehash: 7482ca27c2edcb281180fb8fbbfb1884a515d379
ms.sourcegitcommit: 68aec76e471d677fd9a6333dc60ed098d1072cfc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/18/2017
---
# <a name="exporting-an-azure-hosted-api-to-powerapps-and-microsoft-flow"></a>Экспорт размещенного в Azure API в PowerApps и Microsoft Flow

[PowerApps](https://powerapps.microsoft.com/guided-learning/learning-introducing-powerapps/) — это служба для создания и использования пользовательских бизнес-приложений, которые подключаются к данным и работают на различных платформах. [Microsoft Flow](https://flow.microsoft.com/guided-learning/learning-introducing-flow/) позволяет легко автоматизировать рабочие и бизнес-процессы между избранными приложениями и службами. PowerApps и Microsoft Flow содержат ряд встроенных соединителей для источников данных, таких как Office 365, Dynamics 365, Salesforce и т д. В некоторых случаях разработчикам приложений и потоков также нужно подключиться к источникам данных и API, созданным в их организации.

Аналогичным образом разработчикам, которым необходимо расширить возможности совместного использования API внутри организации, может потребоваться предоставить доступ к своим API создателям приложений и потоков. В этой статье показано, как экспортировать API, созданный с помощью [Функций Azure](../azure-functions/functions-overview.md) или [службы приложений Azure](../app-service/app-service-web-overview.md). Экспортированный API становится *настраиваемым соединителем*, который используется в PowerApps и Microsoft Flow так же, как встроенный соединитель.

## <a name="create-and-export-an-api-definition"></a>Создание и экспорт определения API
Перед экспортом API нужно описать его с помощью определения OpenAPI (ранее называвшегося файлом [Swagger](http://swagger.io/)). Это определение содержит сведения о доступных операция в API и о том, как необходимо структурировать данные запросов и ответов для API. С помощью PowerApps и Microsoft Flow можно создать настраиваемые соединители для любого определения OpenAPI 2.0. Функции Azure и служба приложений Azure имеют встроенную поддержку создания и размещения определений OpenAPI, а также управления ими. Дополнительные сведения см. в статье [Создание API RESTful Node.js и его развертывание в приложении API в Azure](../app-service/app-service-web-tutorial-rest-api.md).

> [!NOTE]
> Также можно создать настраиваемые соединители в пользовательских интерфейсах PowerApps и Microsoft Flow без использования определения OpenAPI. Дополнительные сведения см. в статьях [Регистрация и использование настраиваемых соединителей в PowerApps](https://powerapps.microsoft.com/tutorials/register-custom-api/) и [Регистрация и использование настраиваемых соединителей в Microsoft Flow](https://flow.microsoft.com/documentation/register-custom-api/).

Чтобы экспортировать определение API, выполните такие действия:

1. В [портал Azure](https://portal.azure.com), перейдите в папку функций Azure или другое приложение службы приложений.

    При использовании Функции Azure щелкните приложение-функцию и выберите **Platform features** (Функции платформы), а затем — **Определение API**.

    ![Определение API Функций Azure](media/app-service-export-api-to-powerapps-and-flow/api-definition-function.png)

    При использовании службы приложений Azure в списке параметров выберите **Определение API**.

    ![Определение API службы приложений](media/app-service-export-api-to-powerapps-and-flow/api-definition-app.png)

2. Кнопка **Export to PowerApps + Microsoft Flow** (Экспорт в PowerApps + Microsoft Flow) должна быть доступна (если нет, сначала нужно создать определение OpenAPI). Нажмите эту кнопку, чтобы начать процесс экспорта.

    ![Кнопка Export to PowerApps + Microsoft Flow (Экспорт в PowerApps + Microsoft Flow)](media/app-service-export-api-to-powerapps-and-flow/export-apps-flow.png)

3. Выберите **режим экспорта**:

    **Экспресс**: позволяет создавать пользовательский соединитель в портале Azure. Для этого требуется, чтобы вы вошли в PowerApps или Microsoft Flow и получили разрешение на создание соединителей в целевой среде. Это рекомендуемый подход, если эти два требования могут быть выполнены. При использовании этого режима следуйте инструкциям, приведенным в разделе [Экспресс экспорт](#express) ниже.

    **Вручную**. Позволяет экспортировать определение API, которое затем импортируется с помощью порталов PowerApps или Microsoft Flow. Это рекомендуемый подход, если пользователь Azure и пользователь с разрешением на создание соединителей — разные люди или соединитель должна быть создана в другой клиент Azure. При использовании этого режима следуйте инструкциям, приведенным в разделе [Экспорт вручную](#manual) ниже.

    ![Режим экспорта](media/app-service-export-api-to-powerapps-and-flow/export-mode.png)

> [!NOTE]
> Настраиваемый соединитель использует *копию* определения API, поэтому PowerApps и Microsoft Flow не сразу узнают о внесении изменений в приложение и определение API. При внесении изменений повторите действия по экспорту для новой версии.

<a name="express"></a>
## <a name="use-express-export"></a>Экспресс-экспорт

Чтобы выполнить экспорт в режиме **Экспресс**, выполните следующие действия:

1. Убедитесь, что вы вошли в клиент PowerApps или Microsoft Flow, в который необходимо выполнить экспорт. 

2. Используйте настройки, указанные в таблице.

    |Параметр|ОПИСАНИЕ|
    |--------|------------|
    |**Среда**|Выберите среду, в которую нужно сохранить настраиваемый соединитель. Дополнительные сведения см. в статье [Обзор сред](https://powerapps.microsoft.com/tutorials/environments-overview/).|
    |**Имя пользовательского API**|Введите имя, которое разработчики PowerApps and Microsoft Flow увидят в своих списках соединителей.|
    |**Подготовка конфигурации безопасности**|При необходимости предоставьте сведения о конфигурации системы безопасности, необходимые для предоставления пользователям доступа к вашему API. В этом примере показан ключ API. Дополнительные сведения см. в разделе [Указание типа проверки подлинности](#auth) ниже.|
 
    ![Экспресс-экспорт в PowerApps и Microsoft Flow](media/app-service-export-api-to-powerapps-and-flow/export-express.png)

3. Последовательно выберите **ОК**. После этого будет создан настраиваемый соединитель, который затем будет добавлен в указанную среду.

Пример использования **экспресс**-режима со службой "Функции Azure" см. в статье [Вызов функции из PowerApps](functions-powerapps-scenario.md) и [Вызов функции из Microsoft Flow](functions-flow-scenario.md).

<a name="manual"></a>
## <a name="use-manual-export"></a>Экспорт вручную

Чтобы выполнить экспорт в **ручном** режиме, выполните такие действия:

1. Щелкните **Скачать** и сохраните файл или щелкните кнопку "Копировать" и сохраните URL-адрес. При импорте будет использоваться URL-адрес или скачанный файл.
 
    ![Экспорт вручную в PowerApps и Microsoft Flow](media/app-service-export-api-to-powerapps-and-flow/export-manual.png)
 
2. Если определение API содержит какие-либо параметры безопасности, они будут вызваны на шаге 2. При импорте PowerApps и Microsoft Flow обнаруживают их и запрашивают сведения о безопасности. Получите учетные данные, связанные с определениями. Они понадобятся в следующем разделе. Дополнительные сведения см. в разделе [Указание типа проверки подлинности](#auth) ниже.

    ![Безопасность при экспорте вручную](media/app-service-export-api-to-powerapps-and-flow/export-manual-security.png)

    В этом примере показано определение ключа безопасности API, который содержится в определении OpenAPI.

Теперь, когда определение API экспортировано, импортируйте его, чтобы создать настраиваемый соединитель в PowerApps и Microsoft Flow. Настраиваемые соединители совместно используются двумя службами, поэтому импортировать определение необходимо один раз.

Чтобы импортировать определение API в PowerApps и Microsoft Flow, выполните такие действия:

1. Последовательно выберите пункты [powerapps.com](https://web.powerapps.com) или [flow.microsoft.com](https://flow.microsoft.com).

2. В правом верхнем углу щелкните значок шестеренки, а затем нажмите кнопку **соединители настраиваемый**.

   ![Щелкните значок шестеренки в службе](media/app-service-export-api-to-powerapps-and-flow/icon-gear.png)

3. Нажмите кнопку **создать настраиваемый соединитель**, нажмите кнопку **Импорт определения OpenAPI**.

   ![Создание пользовательского соединителя](media/app-service-export-api-to-powerapps-and-flow/flow-apps-create-connector.png)

4. Введите имя для пользовательского соединителя, затем перейти к определению OpenAPI, который был экспортирован и нажмите кнопку **Продолжить**.

   ![Передать определение OpenAPI](media/app-service-export-api-to-powerapps-and-flow/flow-apps-upload-definition.png)

4. На **Общие** просмотрите данные, поступающие из определения OpenAPI.

5. Если появится запрос на ввод сведений о проверке подлинности, введите значения для соответствующего типа проверки подлинности на вкладке **Безопасность**. Нажмите кнопку **Продолжить**.

    ![Вкладка "Безопасность"](media/app-service-export-api-to-powerapps-and-flow/tab-security.png)

    В этом примере показаны обязательные поля для проверки подлинности с использованием ключа API. Поля отличаются в зависимости от типа проверки подлинности.

6. На вкладке **Определения** все операции, определенные в файле OpenAPI, заполняются автоматически. Если определены все необходимые операции, можно перейти к следующему шагу. Если нет, вы можете добавить и изменить операции здесь.

    ![Вкладка "Определения"](media/app-service-export-api-to-powerapps-and-flow/tab-definitions.png)

    В этом примере имеется одна операция, которая называется `CalculateCosts`. Метаданные, такие как **Описание**, берутся из файла OpenAPI.

7. Щелкните **Create connector** (Создать соединитель) в верхней части страницы.

Теперь можно подключиться к настраиваемому соединителю в PowerApps и Microsoft Flow. Дополнительные сведения о создании соединителей на порталах PowerApps и Microsoft Flow см. в статье [Регистрация настраиваемого соединителя (PowerApps)](https://powerapps.microsoft.com/tutorials/register-custom-api/#register-your-custom-connector) и [Регистрация настраиваемого соединителя (Microsoft Flow)](https://flow.microsoft.com/documentation/register-custom-api/#register-your-custom-connector).

<a name="auth"></a>
## <a name="specify-authentication-type"></a>Укажите тип аутентификации

PowerApps и Microsoft Flow поддерживают коллекцию поставщиков удостоверений, которые обеспечивают проверку подлинности настраиваемых соединителей. Если для API требуется проверка подлинности, это определение должно быть записано в виде _определения безопасности_ в документе OpenAPI, как показано в примере ниже:

```json
"securityDefinitions": {
    "AAD": {
    "type": "oauth2",
    "flow": "accessCode",
    "authorizationUrl": "https://login.windows.net/common/oauth2/authorize",
    "scopes": {}
    }
}
``` 
Во время экспорта укажите значения конфигурации, позволяющие PowerApps и Microsoft Flow проверить подлинность пользователей.

В этом разделе описаны типы проверки подлинности, поддерживаемые в режиме **Экспресс**: ключ API, Azure Active Directory и универсальная OAuth 2.0. PowerApps и Microsoft Flow также поддерживают обычную проверку подлинности и OAuth 2.0 для определенных служб, таких как Dropbox, Facebook или SalesForce.

### <a name="api-key"></a>Ключ API
При использовании ключа API пользователям соединителя будет предложено предоставить ключ во время создания подключения. Укажите имя ключа API, чтобы помочь пользователям понять, какой ключ необходим. В предыдущем примере используется имя `API Key (contact meganb@contoso.com)`, чтобы пользователи знали, где можно получить сведения о ключе API. Для Функций Azure это, как правило, один из ключей узла, охватывающий несколько функций внутри приложения-функции.

### <a name="azure-active-directory-azure-ad"></a>Azure Active Directory (Azure AD)
При использовании Azure AD необходимо две регистрации приложения Azure AD: одна для API, а другая — для настраиваемого соединителя:

- Чтобы настроить регистрацию для API, используйте возможность [проверки подлинности и авторизации в службе приложений](../app-service/app-service-mobile-how-to-configure-active-directory-authentication.md).

- Чтобы настроить регистрацию для соединителя, выполните действия, описанные в разделе [Добавление приложения](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications#adding-an-application). Регистрации требуется делегированный доступ к вашему API и URL-адресу ответа из `https://msmanaged-na.consent.azure-apim.net/redirect`. 

Дополнительные сведения см. в примерах регистрации Azure AD для [PowerApps](https://powerapps.microsoft.com/tutorials/customapi-azure-resource-manager-tutorial/) и [Microsoft Flow](https://flow.microsoft.com/documentation/customapi-azure-resource-manager-tutorial/). В этих примерах в качестве API используется Azure Resource Manager. Замените свой API при выполнении этих шагов.

Требуются следующие значения конфигурации:
- **Идентификатор клиента.** Идентификатор клиента регистрации соединителя Azure AD.
- **Секрет клиента.** Секрет клиента регистрации соединителя Azure AD.
- **URL-адрес для входа.** Базовый URL-адрес для Azure AD. В Azure это обычно `https://login.windows.net`.
- **Идентификатор клиента**: идентификатор клиента, используемый для входа. Он должен быть "общим" или идентификатором клиента, в котором создается соединитель.
- **URL-адрес ресурса.** URL-адрес ресурса регистрации Azure AD для API.

> [!IMPORTANT]
> Если импортировать определение API в PowerApps и Microsoft Flow в качестве ручного потока будет другой пользователь, помимо файла определения API ему нужно предоставить идентификатор и секрет клиента *регистрации соединителя*. Обеспечьте безопасное управление этими секретами. **Не предоставляйте учетные данные безопасности самого API.**

### <a name="generic-oauth-20"></a>Универсальная OAuth 2.0
При использовании универсальной OAuth 2.0 можно интегрироваться с любым поставщиком OAuth 2.0. Это позволяет работать с пользовательскими поставщиками, которые изначально не поддерживаются.

Требуются следующие значения конфигурации:
- **Идентификатор клиента**: идентификатор клиента OAuth 2.0
- **Секрет клиента**: секрет клиента OAuth 2.0.
- **Authorization URL** (URL-адрес для авторизации) URL-адрес для авторизации OAuth 2.0.
- **Token URL** (URL-адрес токена): URL-адрес токена OAuth 2.0.
- **Refresh URL** (URL-адрес обновления): URL-адрес обновления OAuth 2.0.


