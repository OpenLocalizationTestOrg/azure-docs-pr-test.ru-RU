---
title: "Вызов функции из PowerApps | Документация Майкрософт"
description: "Создание пользовательского соединителя и вызов функции с его помощью."
services: functions
keywords: "облачные приложения, облачные службы, PowerApps, бизнес-процессы, бизнес-приложение"
documentationcenter: 
author: mgblythe
manager: cfowler
editor: 
ms.assetid: 
ms.service: functions
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/14/2017
ms.author: mblythe
ms.custom: 
ms.openlocfilehash: 28c2fc8246851807e1f65911d6a5d56322c5ea16
ms.sourcegitcommit: 68aec76e471d677fd9a6333dc60ed098d1072cfc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/18/2017
---
# <a name="call-a-function-from-powerapps"></a>Вызов функции из PowerApps
Платформа [PowerApps](https://powerapps.microsoft.com) позволяет бизнес-экспертами создавать приложения без традиционного кода. Профессиональные разработчики могут расширить возможности PowerApps с помощью функций Azure, избавляя при этом разработчиков приложений PowerApps от технических деталей.

В рамках этой статьи вы создадите приложение для обслуживания ветроэлектрических установок. Здесь показано, как вызвать функцию, определенную в статье [Создание определения OpenAPI функции](functions-openapi-definition.md). Функция определяет экономичность аварийного ремонта ветроэлектрической установки.

![Готовое приложение в PowerApps](media/functions-powerapps-scenario/finished-app.png)

Сведения о вызове этой же функции из Microsoft Flow вы найдете в статье [Call a function from Microsoft Flow](functions-flow-scenario.md) (Вызов функции из Microsoft Flow).

В этой статье:

> [!div class="checklist"]
> * Подготовка демонстрационных данных в Excel.
> * импортировали определения API;
> * добавили подключения к API;
> * создали приложения и добавили источники данных;
> * Добавление элементов управления для просмотра данных в приложении.
> * Добавление элементов управления для вызова функции и отображения данных.
> * запустили приложения для определения экономичности аварийного ремонта ветроэлектрической установки.

## <a name="prerequisites"></a>Технические условия

+ Активная [учетная запись PowerApps](https://powerapps.microsoft.com/tutorials/signup-for-powerapps.md) с такими же учетными данными, что и в учетной записи Azure. 
+ Excel и [образец файла Excel](https://procsi.blob.core.windows.net/docs/turbine-data.xlsx) , будет использовать как источник данных для вашего приложения.
+ Выполните шаги, описанные в руководстве [Создание определения OpenAPI функции](functions-openapi-definition.md).

[!INCLUDE [Export an API definition](../../includes/functions-export-api-definition.md)]

## <a name="add-a-connection-to-the-api"></a>Добавление подключения к API
Пользовательский API (пользовательский соединитель) доступен в PowerApps, но чтобы использовать его в приложении, к нему нужно подключиться.

1. На сайте [web.powerapps.com](https://web.powerapps.com) щелкните **Подключения**.

    ![Подключения PowerApps](media/functions-powerapps-scenario/powerapps-connections.png)

1. Нажмите кнопку **Создать подключение**, прокрутите вниз до соединителя **Ремонт турбин** и выберите его.

    ![Новое подключение](media/functions-powerapps-scenario/new-connection.png)

1. Введите ключ API и нажмите кнопку **Создать**.

    ![Создание подключения](media/functions-powerapps-scenario/create-connection.png)

> [!NOTE]
> Если приложение используется совместно с другими пользователями, каждый, кто работает в нем, должен также ввести ключ API, чтобы подключиться к API. Это поведение может измениться в будущем. В связи с этим мы обновим этот раздел.

## <a name="create-an-app-and-add-data-sources"></a>Создание приложения и добавление источников данных
Теперь вы можете создать приложение в PowerApps, а затем добавить данные Excel и пользовательский API в качестве источников данных приложения.

1. В [web.powerapps.com](https://web.powerapps.com), выберите **начать с пустой** > ![значок приложения телефона](media/functions-powerapps-scenario/icon-phone-app.png) (phone) > **сделать это приложение**.

    ![Начать с пустой - телефона](media/functions-powerapps-scenario/create-phone-app.png)

    Приложение откроется в интернет-версии PowerApps Studio. На снимке экрана ниже приведены различные части PowerApps Studio.

    ![PowerApps Studio](media/functions-powerapps-scenario/powerapps-studio.png)

    **(A) левой панели навигации**, в котором можно увидеть, иерархическое представление всех элементов управления на каждом экране

    **(Б) средней панели**, который демонстрирует экрана, над которыми вы работаете

    **(C) правой части окна**где задайте параметры, такие как макет и источников данных

    **(D) свойство** раскрывающегося списка, в котором выбрать свойства, применимые к формулы

    **(E) формул**, где добавлять формулы (как в Excel), которые определяют поведение приложения
    
    **(F) лента**, чтобы добавить элементы управления и настроить элементы макета

1. Добавьте файл Excel в качестве источника данных.

    Данные, которые будут импортированы выглядит следующим образом:

    ![Данные Excel для импорта](media/functions-powerapps-scenario/excel-table.png)

    1. На холсте приложения выберите **подключение к данным**.

    1. На **данные** нажмите кнопку **добавить статические данные в приложение**.

        ![Добавление источника данных](media/functions-powerapps-scenario/add-static-data.png)

        Обычно читаются и записываются данные из внешнего источника, но в этом примере вы добавляете данные Excel как статические данные.

    1. Перейдите в сохраненный файл Excel, выберите таблицу **Турбины** и щелкните **Подключить**.

        ![Добавление источника данных](media/functions-powerapps-scenario/choose-table.png)


1. Добавьте пользовательский API в качестве источника данных.

    1. На **данные** нажмите кнопку **добавить источник данных**.

    1. Щелкните **Ремонт турбин**.

        ![Соединитель ремонта турбин](media/functions-powerapps-scenario/turbine-connector.png)

## <a name="add-controls-to-view-data-in-the-app"></a>Добавление элементов управления для просмотра данных в приложении
Теперь, когда источники данных доступны в приложении, добавьте в приложение окно, чтобы просмотреть данные о турбине.

1. На вкладке**Главная** щелкните **Новый экран** > **Окно списка**.

    ![Окно списка](media/functions-powerapps-scenario/list-screen.png)

    PowerApps добавит окно, в котором содержится *коллекция* элементов и другие элементы управления, позволяющие выполнять поиск, сортировку и фильтрацию.

1. Измените строку заголовка на `Turbine Repair` и измените размер коллекции, чтобы в ней было достаточно места для нескольких элементов управления.

    ![Изменение заголовка и размера коллекции](media/functions-powerapps-scenario/gallery-title.png)

1. Коллекция установлен, в области справа в разделе **свойства**, нажмите кнопку **CustomGallerySample**.

    ![Изменение источника данных](media/functions-powerapps-scenario/change-data-source.png)

1. В **данные** панель, выберите **турбины** из списка.

    ![Выберите источник данных](media/functions-powerapps-scenario/select-data-source.png)

    Набор данных не содержит изображения, поэтому измените макет, чтобы лучше разместить данные. 

1. В по-прежнему **данные** панели, измените **макета** для **заголовок, подзаголовок и тело**.

    ![Изменение макета коллекции](media/functions-powerapps-scenario/change-layout.png)

1. В качестве последнего шага в **данные** панели, измените поля, отображаемые в коллекции.

    ![Изменение полей коллекции](media/functions-powerapps-scenario/change-fields.png)
    
    + **Текст1** — "Дата последнего обслуживания".
    + **Подзаголовок2** — "Требуется_обслуживание".
    + **Заголовок2** — "Заголовок". 

1. Выберите коллекцию. В качестве значения свойства **TemplateFill** задайте следующую формулу: `If(ThisItem.IsSelected, Orange, White)`.

    ![Формула заливки шаблона](media/functions-powerapps-scenario/formula-fill.png)

    Теперь проще просматривать выбранный элемент коллекции.

    ![Выбранный элемент](media/functions-powerapps-scenario/selected-item.png)

1. В приложении не требуется исходное окно. В области слева наведите указатель мыши на раздел **Экран1**, щелкните **...**, а затем **Удалить**.

    ![Удаление окна](media/functions-powerapps-scenario/delete-screen.png)

1. Нажмите кнопку **файл**и имя приложения. Нажмите кнопку **Сохранить** в левом меню, нажмите кнопку **Сохранить** в правом нижнем углу.

Существует много других видов форматирования, которое вы обычно выполняете в рабочем приложении, но мы перейдем к важной части этого сценария — вызове функции.

## <a name="add-controls-to-call-the-function-and-display-data"></a>Добавление элементов управления для вызова функции и отображения данных
У вас есть приложение, которое отображает сводные данные для каждой турбины, поэтому теперь пришло время добавить элементы управления, с помощью которых можно вызвать созданную вами функцию и отобразить возвращаемые данные. Вы можете получить доступ к функции в зависимости от способа ее имени в определении OpenAPI. В этом случае она называется `TurbineRepair.CalculateCosts()`.

1. На ленте на вкладке **Вставка** щелкните **Кнопка**. На этой же вкладке щелкните **Метка**.

    ![Кнопка "Вставка" и метка](media/functions-powerapps-scenario/insert-controls.png)

1. Перетащите кнопку и метку под коллекцию и измените размер метки. 

1. Выделите текст кнопки и измените его на `Calculate costs`. Приложение должно выглядеть как на следующем изображении.

    ![Приложения с кнопкой](media/functions-powerapps-scenario/move-button-label.png)

1. Выберите кнопку и введите следующую формулу для свойства **OnSelect** кнопки.

    ```
    If (BrowseGallery1.Selected.ServiceRequired="Yes", ClearCollect(DetermineRepair, TurbineRepair.CalculateCosts({hours: BrowseGallery1.Selected.EstimatedEffort, capacity: BrowseGallery1.Selected.MaxOutput})))
    ```
    Эта формула выполняется при нажатии кнопки, а если элемент выбранной коллекции имеет значение  **параметра** Требуется_обслуживание`Yes`, она выполняет следующее:

    + Удаляет значение `DetermineRepair` *коллекции*, чтобы удалить данные предыдущих вызовов. (Коллекция — это табличная переменная).

    + Назначает коллекции данные, возвращенные путем вызова функции `TurbineRepair.CalculateCosts()`. 
    
        Значения, передаваемые в функцию, берутся из полей **EstimatedEffort** и **MaxOutput** элемента, выбранного в коллекции. Эти поля не отображаются в коллекции, но их по-прежнему можно использовать в формулах.

1. Выберите метку и введите формулу ниже для свойства **Текст** метки.

    ```
    "Repair decision: " & First(DetermineRepair).message & " | Cost: " & First(DetermineRepair).costToFix & " | Revenue: " & First(DetermineRepair).revenueOpportunity
    ```
    В этой формуле используется функция `First()`. Она обеспечивает доступ к первой (и единственной) строке коллекции `DetermineRepair`. Эта функция возвращает три значения: `message`, `costToFix` и `revenueOpportunity`. Перед первым запуском приложения эти значения пусты.

    Готовое приложение должно выглядеть, как на следующем изображении.

    ![Готовое приложение перед запуском](media/functions-powerapps-scenario/finished-app-before-run.png)


## <a name="run-the-app"></a>Запуск приложения
Вы создали приложение. Пришло время запустить его и увидеть вызовы функции в действии.

1. В правом верхнем углу PowerApps Studio нажмите кнопку выполнения: ![Кнопка запуска приложения](media/functions-powerapps-scenario/f5-arrow-sm.png).

1. Выберите турбину со значением `Yes` параметра **Требуется_обслуживание**, а затем нажмите кнопку **Расчет затрат**. Вы должны увидеть следующий результат:

    ![Готовое приложение в PowerApps](media/functions-powerapps-scenario/finished-app.png)

1. Попробуйте выбрать другие турбины, чтобы увидеть остальные данные, возвращаемые функцией.

## <a name="next-steps"></a>Дальнейшие действия
В этой статье вы выполнили следующие действия:

> [!div class="checklist"]
> * подготовили демонстрационные данные в Excel;
> * импортировали определения API;
> * добавили подключения к API;
> * создали приложения и добавили источники данных;
> * добавили элементы управления для просмотра данных в приложении;
> * добавили элементы управления для вызова функции и отображения данных;
> * запустили приложения для определения экономичности аварийного ремонта ветроэлектрической установки.

Дополнительные сведения о PowerApps см. в статье [Введение в PowerApps](https://powerapps.microsoft.com/tutorials/getting-started/).

Дополнительные сведения о других сценариях использования службы "Функции Azure" см. в статьях [Call a function from Microsoft Flow](functions-flow-scenario.md) (Вызов функции из Microsoft Flow) и [Создание функции, интегрируемой с Azure Logic Apps](functions-twitter-email.md).