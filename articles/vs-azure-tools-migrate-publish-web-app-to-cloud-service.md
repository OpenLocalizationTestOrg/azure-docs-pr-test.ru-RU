---
title: "Как перенести веб-приложение из Visual Studio и опубликовать его в облачной службе Azure | Документация Майкрософт"
description: "Узнайте, как перенести и опубликовать веб-приложение в облачную службу Azure путем использования Visual Studio."
services: visual-studio-online
documentationcenter: na
author: kraigb
manager: ghogen
editor: 
ms.assetid: 9394adfd-a645-4664-9354-dd5df08e8c91
ms.service: multiple
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: multiple
ms.date: 11/10/2017
ms.author: kraigb
ms.openlocfilehash: 1ced364bed821a9391f8ffd049f61ac236d98309
ms.sourcegitcommit: 85012dbead7879f1f6c2965daa61302eb78bd366
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/02/2018
---
# <a name="how-to-migrate-and-publish-a-web-application-to-an-azure-cloud-service-from-visual-studio"></a>Инструкции. Миграция и публикация веб-приложения в облачную службу Azure из среды Visual Studio

Чтобы использовать все возможности служб размещения и масштабирования, предлагаемые Azure, необходимо выполнить миграцию и развертывание веб-приложения в облачную службу Azure. Требуются минимальные изменения кода. В этой статье описывается только развертывание в облачные службы. Сведения о развертывании в службе приложений см. в статье [Развертывание локального репозитория Git в службе приложений Azure](app-service/app-service-deploy-local-git.md).

> [!Important]
> Этот вид миграции поддерживается только для определенных проектов ASP.NET, Silverlight, WCF и рабочего процесса WCF и не поддерживается для проектов ASP.NET Core. Подробные сведения см. в разделе [Поддерживаемые шаблоны проектов](#supported-project-templates)

## <a name="migrate-a-project-to-cloud-services"></a>Миграция проекта в облачные службы

1. Щелкните проект веб-приложения правой кнопкой мыши и выберите **Convert (Преобразовать) > Преобразовать в проект облачной службы Microsoft Azure**. (Обратите внимание, что эта команда не отображается, если уже имеется проект веб-роли в решении).
1. Visual Studio создает проект облачной службы в решении, в котором имеется требуемая веб-роль. У этого проекта такое же название, как и у проекта приложения, но с суффиксом `.Azure`.
1. В Visual Studio для свойства **Копировать локально** присваивается значение true для всех сборок, необходимых для MVC 2, MVC 3, MVC 4 и бизнес-приложений Silverlight. В результате эти сборки свойств будут добавлены в пакет служб, используемый для развертывания.

   > [!Important]
   > Если для веб-приложения требуются другие сборки или файлы, свойства этих файлов необходимо настроить вручную. Инструкции по настройке этих свойств см. в статье [Инструкции. Миграция и публикация веб-приложения в облачную службу Azure из среды Visual Studio](#include-files-in-the-service-package).

### <a name="errors-and-warnings"></a>Ошибки и предупреждения

Все возникающие предупреждения или ошибки сообщают о проблемах, которые нужно исправить перед развертыванием в Azure (например, отсутствие сборки).

При локальном запуске созданного приложения с помощью эмулятора вычислений или публикации этого приложения в Azure может отобразиться следующее сообщение об ошибке: "Слишком длинный путь или имя файла". Эта ошибка означает, что длина полного имени проекта Azure превышает 146 знаков. Чтобы устранить эту проблему, переместите решение в другую папку с более коротким путем.

Дополнительные сведения об обработке предупреждений в виде ошибок см. в статье [Настройка проекта облачной службы Azure в Visual Studio](vs-azure-tools-configuring-an-azure-project.md).

### <a name="test-the-migration-locally"></a>Локальное тестирование миграции

1. В **обозревателе решений** Visual Studio щелкните добавленный проект облачной службы правой кнопкой мыши и выберите **Назначить запускаемым проектом**.
1. Выберите **Отладка > Начать отладку** (F5), чтобы запустить среду отладки Azure. В частности, эта среда предоставляет возможность эмуляции различных служб Azure.

### <a name="use-an-azure-sql-database-for-your-application"></a>Использование базы данных SQL Azure для приложения

Если имеется строка подключения для веб-приложения, которое использует локальную базу данных SQL Server, нужно перенести базу данных в базу данных SQL Azure и обновить строку подключения. Руководство по этому процессу см. в следующих статьях:

- [Миграция базы данных SQL Server в базу данных SQL в облаке](sql-database/sql-database-cloud-migrate.md)
- [Использование .NET (C#) с Visual Studio для подключения и создания запросов к базе данных SQL Azure](sql-database/sql-database-connect-query-dotnet-visual-studio.md).

## <a name="publish-the-application-to-azure-cloud-service"></a>Публикация приложения в облачной службе Azure

1. Создайте необходимые учетные записи хранения и облачной службы в подписке Azure, как описано в статье [Подготовка к публикации или развертыванию приложения Azure из Visual Studio](vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio.md).
1. В Visual Studio щелкните проект приложения правой кнопкой мыши и выберите **Опубликовать в Microsoft Azure...** (эта команда отличается от команды "Опубликовать…".).
1. В открывшемся окне **Публикация приложения Azure** выполните вход, используя учетную запись с подпиской Azure, и выберите **Далее >**.
1. На вкладке **Параметры > Common Settings (Общие параметры)** выберите целевую облачную службу из раскрывающегося списка **Облачная служба**, а также среду и конфигурации. 
1. На вкладке **Параметры > Advanced Settings (Дополнительные параметры)** выберите учетную запись хранения, а затем нажмите **Далее >**.
1. На вкладке **Диагностика** выберите, следует ли отправлять сведения в Application Insights.
1. Выберите **Далее >**, чтобы просмотреть сводки, а затем **Publish** (Опубликовать), чтобы запустить развертывание.
1. В Visual Studio откроется окно журнала действий, в котором вы можете отслеживать ход выполнения.

    ![VST_AzureActivityLog](./media/vs-azure-tools-migrate-publish-web-app-to-cloud-service/IC744149.png)

1. (Необязательно). Чтобы отменить процесс развертывания, щелкните элемент строки правой кнопкой мыши в журнале действий и выберите пункт **Отменить и удалить**. Эта команда позволит остановить процесс развертывания и удалить среду развертывания из Azure. Примечание. Чтобы удалить среду развертывания после завершения развертывания, воспользуйтесь [порталом Azure](https://portal.azure.com).
1. (Необязательно.) После запуска экземпляров ролей Visual Studio автоматически отображает среду развертывания в узле **Обозреватель серверов > Облачные службы**. Здесь можно просматривать состояние отдельных экземпляров ролей.
1. Для доступа к приложению после развертывания выберите стрелку рядом с развертыванием, когда в **журнале действий Azure** появится состояние **Завершено** и URL-адрес. Сведения о запуске веб-приложения определенного типа из Azure см. в следующей таблице.

## <a name="using-the-compute-emulator-and-starting-application-in-azure"></a>Использование эмулятора вычислений и запуск приложения в Azure

Все типы приложений можно запустить в браузере, подключенном к отладчику Visual Studio, выбрав **Отладка > Начать отладку** (F5). В проекте "Пустое веб-приложение ASP.NET" необходимо сначала добавить страницу `.aspx` в приложение и установить ее в качестве начальной страницы веб-проекта.

В следующей таблице приведены сведения о запуске приложения в Azure.

   | Тип веб-приложения | Выполнение в Azure |
   | --- | --- | --- |
   | Веб-приложение ASP.NET<br/>(включая MVC 2, MVC 3, MVC 4) | Выберите URL-адрес **журнала действий Azure** на вкладке **Развертывание**. |
   | Пустое веб-приложение ASP.NET | Если в приложении уже имеется страница по умолчанию `.aspx`, выберите URL-адрес на вкладке **Развертывание** для **журнала действий Azure**. Чтобы перейти на другую страницу, введите в браузере следующий URL-адрес: `<deployment_url>/<page_name>.aspx` |
   | Приложение Silverlight<br/>Бизнес-приложение Silverlight<br/>Приложение навигации Silverlight | Перейдите к заданной странице вашего приложения, используя URL-адрес в следующем формате: `<deployment_url>/<page_name>.aspx` |
    Приложение службы WCF<br/>Приложение службы рабочего процесса WCF | Задайте `.svc` файл в качестве начальной страницы для проекта службы WCF. Затем перейдите на страницу `<deployment_url>/<service_file>.svc` |
   | Динамические сущности ASP.NET<br/>Платформа динамических данных ASP.NET типа Linq to SQL | Обновите строку подключения (как описано в следующем разделе). Затем перейдите на страницу `<deployment_url>/<page_name>.aspx`. Для Linq to SQL необходимо использовать базу данных SQL Azure. |

## <a name="update-a-connection-string-for-aspnet-dynamic-entities"></a>Обновление строки подключения для динамических сущностей ASP.NET

1. Создайте базу данных SQL Azure для веб-приложения динамических сущностей ASP.NET, как описано ранее (#use-an-azuresql-database-for-your-application).
1. Добавьте таблицы и поля, необходимые для этой базы данных, из портала Azure.
1. Укажите строку подключения в файле `web.config` в следующем формате и сохраните этот файл:

    ```xml
    <addname="tempdbEntities"connectionString="metadata=res://*/Model1.csdl|res://*/Model1.ssdl|res://*/Model1.msl;provider=System.Data.SqlClient;provider connection string=&quot;data source=<server name>\SQLEXPRESS;initial catalog=<database name>;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&quot;"providerName="System.Data.EntityClient"/>
    ```

    Обновите значение *connectionString* , используя строку подключения ADO.NET для базы данных SQL Azure, следующим образом:

    ```xml
    XMLCopy<addname="tempdbEntities"connectionString="metadata=res://*/Model1.csdl|res://*/Model1.ssdl|res://*/Model1.msl;provider=System.Data.SqlClient;provider connection string=&quot;Server=tcp:<SQL Azure server name>.database.windows.net,1433;Database=<database name>;User ID=<user name>;Password=<password>;Trusted_Connection=False;Encrypt=True;multipleactiveresultsets=True;App=EntityFramework&quot;"providerName="System.Data.EntityClient"/>
    ```

## <a name="supported-project-templates"></a>Поддерживаемые шаблоны проектов

Приложения, которые можно перенести и опубликовать в облачных службах, должны использовать один из шаблонов, перечисленных в следующей таблице. ASP.NET Core не поддерживается.

| Группа шаблонов | Шаблон проекта |
| --- | --- |
| Web | Веб-приложение ASP.NET (.NET Framework) |
| Web | Веб-приложение ASP.NET MVC 2 |
| Web | Веб-приложение ASP.NET MVC 3 |
| Web | Веб-приложение ASP.NET MVC 4 |
| Web | Пустое веб-приложение ASP.NET (или сайт) |
| Web | Пустое веб-приложение ASP.NET MVC 2 |
| Web | Веб-приложение динамических сущностей данных ASP.NET |
| Web | Веб-приложение динамических сущностей данных Linq to SQL ASP.NET |
| Silverlight | Приложение Silverlight |
| Silverlight | Бизнес-приложение Silverlight |
| Silverlight | Приложение навигации Silverlight |
| WCF | Приложение службы WCF |
| WCF | Приложение службы рабочего процесса WCF |
| Рабочий процесс | Приложение службы рабочего процесса WCF |

## <a name="next-steps"></a>Дальнейшие действия

- [Подготовка к публикации или развертыванию приложения Azure из Visual Studio](vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio.md)
- [Настройка именованных учетных данных для проверки подлинности](vs-azure-tools-setting-up-named-authentication-credentials.md)
