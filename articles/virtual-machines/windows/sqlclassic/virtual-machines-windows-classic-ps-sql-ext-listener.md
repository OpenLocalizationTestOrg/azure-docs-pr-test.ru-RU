---
title: "Настройка внешнего прослушивателя для групп доступности AlwaysOn | Документация Майкрософт"
description: "В этом руководстве описывается процесс создания прослушивателя группы доступности AlwaysOn в Azure, доступного через публичный виртуальный IP-адрес связанной облачной службы."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: a2453032-94ab-4775-b976-c74d24716728
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/31/2017
ms.author: mikeray
ms.openlocfilehash: 8e506be42aea4fb3c48c29b771a78dcf694f4518
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="configure-an-external-listener-for-always-on-availability-groups-in-azure"></a><span data-ttu-id="39a25-103">Настройка внешнего прослушивателя для групп доступности AlwaysOn в Azure</span><span class="sxs-lookup"><span data-stu-id="39a25-103">Configure an external listener for Always On Availability Groups in Azure</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="39a25-104">Внутренний прослушиватель</span><span class="sxs-lookup"><span data-stu-id="39a25-104">Internal Listener</span></span>](../classic/ps-sql-int-listener.md)
> * [<span data-ttu-id="39a25-105">Внешний прослушиватель</span><span class="sxs-lookup"><span data-stu-id="39a25-105">External Listener</span></span>](../classic/ps-sql-ext-listener.md)
> 
> 

<span data-ttu-id="39a25-106">В этом разделе показано, как настроить прослушиватель для группы доступности AlwaysOn, доступный через Интернет.</span><span class="sxs-lookup"><span data-stu-id="39a25-106">This topic shows you how to configure a listener for an Always On Availability Group that is externally accessible on the internet.</span></span> <span data-ttu-id="39a25-107">Такую настройку можно выполнить, связав **общедоступный виртуальный IP-адрес (VIP)** облачной службы с прослушивателем.</span><span class="sxs-lookup"><span data-stu-id="39a25-107">This is made possible by associating the cloud service's **public Virtual IP (VIP)** address with the listener.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="39a25-108">В Azure предлагаются две модели развертывания для создания ресурсов и работы с ними: [модель диспетчера ресурсов и классическая модель](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="39a25-108">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="39a25-109">В этой статье рассматривается использование классической модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="39a25-109">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="39a25-110">Для большинства новых развертываний Майкрософт рекомендует использовать модель диспетчера ресурсов.</span><span class="sxs-lookup"><span data-stu-id="39a25-110">Microsoft recommends that most new deployments use the Resource Manager model.</span></span>

<span data-ttu-id="39a25-111">В группе доступности могут быть реплики, доступные только локально или только в Azure. В гибридных конфигурациях возможны оба способа доступа одновременно.</span><span class="sxs-lookup"><span data-stu-id="39a25-111">Your Availability Group can contain replicas that are on-premises only, Azure only, or span both on-premises and Azure for hybrid configurations.</span></span> <span data-ttu-id="39a25-112">Реплики в Azure могут находиться в одном или нескольких регионах (при использовании нескольких виртуальных сетей).</span><span class="sxs-lookup"><span data-stu-id="39a25-112">Azure replicas can reside within the same region or across multiple regions using multiple virtual networks (VNets).</span></span> <span data-ttu-id="39a25-113">В приведенных ниже указаниях предполагается, что вы уже [настроили группу доступности](../classic/portal-sql-alwayson-availability-groups.md), но еще не настроили прослушиватель.</span><span class="sxs-lookup"><span data-stu-id="39a25-113">The steps below assume you have already [configured an availability group](../classic/portal-sql-alwayson-availability-groups.md) but have not configured a listener.</span></span>

## <a name="guidelines-and-limitations-for-external-listeners"></a><span data-ttu-id="39a25-114">Рекомендации и ограничения для внешних прослушивателей</span><span class="sxs-lookup"><span data-stu-id="39a25-114">Guidelines and limitations for external listeners</span></span>
<span data-ttu-id="39a25-115">Обратите внимание на следующие рекомендации для прослушивателя группы доступности в Azure при развертывании с использованием общедоступного виртуального IP-адреса облачной службы.</span><span class="sxs-lookup"><span data-stu-id="39a25-115">Note the following guidelines about the availability group listener in Azure when you are deploying using the cloud service pubic VIP address:</span></span>

* <span data-ttu-id="39a25-116">Прослушиватель группы доступности поддерживается в Windows Server 2008 R2, Windows Server 2012 и Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="39a25-116">The availability group listener is supported on Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2.</span></span>
* <span data-ttu-id="39a25-117">Клиентское приложение должно находиться в облачной службе, отличной от той, которая содержит виртуальные машины группы доступности.</span><span class="sxs-lookup"><span data-stu-id="39a25-117">The client application must reside on a different cloud service than the one that contains your availability group VMs.</span></span> <span data-ttu-id="39a25-118">Azure не поддерживает службу Direct Server Return для клиента и сервера в одной облачной службе.</span><span class="sxs-lookup"><span data-stu-id="39a25-118">Azure does not support direct server return with client and server in the same cloud service.</span></span>
* <span data-ttu-id="39a25-119">По умолчанию действия в этой статье показывают, как настроить один прослушиватель для использования виртуального IP-адреса облачной службы.</span><span class="sxs-lookup"><span data-stu-id="39a25-119">By default, the steps in this article show how to configure one listener to use the cloud service Virtual IP (VIP) address.</span></span> <span data-ttu-id="39a25-120">Тем не менее, для облачной службы можно зарезервировать и создать несколько виртуальных IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="39a25-120">However, it is possible to reserve and create multiple VIP addresses for your cloud service.</span></span> <span data-ttu-id="39a25-121">Это позволяет использовать описанные в этой статье шаги, чтобы создать несколько прослушивателей, привязанных к собственному виртуальному IP-адресу.</span><span class="sxs-lookup"><span data-stu-id="39a25-121">This enables you to use the steps in this article to create multiple listeners that are each associated with a different VIP.</span></span> <span data-ttu-id="39a25-122">Дополнительные сведения о том, как создать несколько виртуальных IP-адресов, см. в статье [Несколько виртуальных IP-адресов для облачной службы](../../../load-balancer/load-balancer-multivip.md).</span><span class="sxs-lookup"><span data-stu-id="39a25-122">For information on how to create multiple VIP addresses, see [Multiple VIPs per cloud service](../../../load-balancer/load-balancer-multivip.md).</span></span>
* <span data-ttu-id="39a25-123">Если вы создаете прослушиватель в гибридной среде, в локальной сети должно быть настроено подключение к сети Интернет помимо VPN-подключения типа "сеть-сеть" к виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="39a25-123">If you are creating a listener for a hybrid environment, the on-premises network must have connectivity to the public Internet in addition to the site-to-site VPN with the Azure virtual network.</span></span> <span data-ttu-id="39a25-124">В подсети Azure прослушиватель группы доступности будет доступен только через общедоступный IP-адрес соответствующей облачной службы.</span><span class="sxs-lookup"><span data-stu-id="39a25-124">When in the Azure subnet, the availability group listener is reachable only by the public IP address of the respective cloud service.</span></span>
* <span data-ttu-id="39a25-125">Создание внешнего прослушивателя в той же облачной службе, что и внутренний прослушиватель, использующий внутренний балансировщик нагрузки (ILB), не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="39a25-125">It is not supported to create an external listener in the same cloud service where you also have an internal listener using the Internal Load Balancer (ILB).</span></span>

## <a name="determine-the-accessibility-of-the-listener"></a><span data-ttu-id="39a25-126">Определение доступности прослушивателя</span><span class="sxs-lookup"><span data-stu-id="39a25-126">Determine the accessibility of the listener</span></span>
[!INCLUDE [ag-listener-accessibility](../../../../includes/virtual-machines-ag-listener-determine-accessibility.md)]

<span data-ttu-id="39a25-127">В этой статье рассматривается создание прослушивателя, использующего **внешнюю балансировку нагрузки**.</span><span class="sxs-lookup"><span data-stu-id="39a25-127">This article focuses on creating a listener that uses **external load balancing**.</span></span> <span data-ttu-id="39a25-128">Если вы хотите использовать закрытый прослушиватель из своей виртуальной сети, см. другую версию этой статьи, где приведены пошаговые инструкции по настройке [прослушивателя с помощью внутреннего балансировщика нагрузки](../classic/ps-sql-int-listener.md).</span><span class="sxs-lookup"><span data-stu-id="39a25-128">If you want a listener that is private to your virtual network, see the version of this article that provides steps for setting up an [listener with ILB](../classic/ps-sql-int-listener.md)</span></span>

## <a name="create-load-balanced-vm-endpoints-with-direct-server-return"></a><span data-ttu-id="39a25-129">Создание конечных точек балансировки нагрузки в ВМ со службой Direct Server Return</span><span class="sxs-lookup"><span data-stu-id="39a25-129">Create load-balanced VM endpoints with direct server return</span></span>
<span data-ttu-id="39a25-130">Внешняя балансировка нагрузки использует общедоступный виртуальный IP-адрес облачной службы, на которой размещены виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="39a25-130">External load balancing uses the virtual the public Virtual IP address of the cloud service that hosts your VMs.</span></span> <span data-ttu-id="39a25-131">В таком случае вам не обязательно создавать или настраивать балансировщик нагрузки.</span><span class="sxs-lookup"><span data-stu-id="39a25-131">So you do not need to create or configure the load balancer in this case.</span></span>

<span data-ttu-id="39a25-132">Для каждой виртуальной машины с репликой Azure необходимо создать конечную точку с балансировкой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="39a25-132">You must create a load-balanced endpoint for each VM hosting an Azure replica.</span></span> <span data-ttu-id="39a25-133">Все реплики одного региона должны быть в одной облачной службе и одной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="39a25-133">If you have replicas in multiple regions, each replica for that region must be in the same cloud service in the same VNet.</span></span> <span data-ttu-id="39a25-134">Чтобы создать реплики группы доступности, охватывающие несколько регионов Azure, необходимо настроить несколько виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="39a25-134">Creating Availability Group replicas that span multiple Azure regions requires configuring multiple VNets.</span></span> <span data-ttu-id="39a25-135">Дополнительные сведения о настройке подключения между виртуальными сетями см. в статье [Настройка подключения между виртуальными сетями для классической модели развертывания](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="39a25-135">For more information on configuring cross VNet connectivity, see  [Configure VNet to VNet Connectivity](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

1. <span data-ttu-id="39a25-136">На портале Azure перейдите к каждой виртуальной машине с репликой и просмотрите сведения.</span><span class="sxs-lookup"><span data-stu-id="39a25-136">In the Azure portal, navigate to each VM hosting a replica and view the details.</span></span>
2. <span data-ttu-id="39a25-137">Перейдите на вкладку **Конечные точки** для каждой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="39a25-137">Click the **Endpoints** tab for each of the VMs.</span></span>
3. <span data-ttu-id="39a25-138">Убедитесь, что **имя** и **общий порт** необходимой конечной точки прослушивателя еще не используются.</span><span class="sxs-lookup"><span data-stu-id="39a25-138">Verify that the **Name** and **Public Port** of the listener endpoint you want to use is not already in use.</span></span> <span data-ttu-id="39a25-139">В следующем примере используется имя MyEndpoint и порт 1433.</span><span class="sxs-lookup"><span data-stu-id="39a25-139">In the example below, the name is “MyEndpoint” and the port is “1433”.</span></span>
4. <span data-ttu-id="39a25-140">На локальном клиенте скачайте и установите [последнюю версию модуля PowerShell](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="39a25-140">On your local client, download and install [the latest PowerShell module](https://azure.microsoft.com/downloads/).</span></span>
5. <span data-ttu-id="39a25-141">Запустите **Azure PowerShell**.</span><span class="sxs-lookup"><span data-stu-id="39a25-141">Launch **Azure PowerShell**.</span></span> <span data-ttu-id="39a25-142">Откроется новый сеанс PowerShell с загруженными административными модулями Azure.</span><span class="sxs-lookup"><span data-stu-id="39a25-142">A new PowerShell session is opened with the Azure administrative modules loaded.</span></span>
6. <span data-ttu-id="39a25-143">Выполните командлет **Get-AzurePublishSettingsFile**.</span><span class="sxs-lookup"><span data-stu-id="39a25-143">Run **Get-AzurePublishSettingsFile**.</span></span> <span data-ttu-id="39a25-144">Он перенаправит вас в браузер для скачивания файла параметров публикации в локальный каталог.</span><span class="sxs-lookup"><span data-stu-id="39a25-144">This cmdlet directs you to a browser to download a publish settings file to a local directory.</span></span> <span data-ttu-id="39a25-145">Может потребоваться ввод учетных данных подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="39a25-145">You may be prompted for your log-in credentials for your Azure subscription.</span></span>
7. <span data-ttu-id="39a25-146">Выполните команду **Import-AzurePublishSettingsFile** , указав путь к скачанному файлу параметров публикации:</span><span class="sxs-lookup"><span data-stu-id="39a25-146">Run the **Import-AzurePublishSettingsFile** command with the path of the publish settings file that you downloaded:</span></span>
   
        Import-AzurePublishSettingsFile -PublishSettingsFile <PublishSettingsFilePath>
   
    <span data-ttu-id="39a25-147">После импорта файла параметров публикации вы сможете управлять подпиской Azure в сеансе PowerShell.</span><span class="sxs-lookup"><span data-stu-id="39a25-147">Once the publish settings file is imported, you can manage your Azure subscription in the PowerShell session.</span></span>
    
1. <span data-ttu-id="39a25-148">Скопируйте приведенный ниже сценарий PowerShell в текстовый редактор и задайте значения переменных в соответствии с вашими условиями (для некоторых параметров указаны значения по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="39a25-148">Copy the PowerShell script below into a text editor and set the variable values to suit your environment (defaults have been provided for some parameters).</span></span> <span data-ttu-id="39a25-149">Обратите внимание: если ваша группа доступности охватывает несколько регионов Azure, приведенный сценарий нужно будет запустить в каждом центре данных для всех облачных служб и узлов, которые находятся в этом центре.</span><span class="sxs-lookup"><span data-stu-id="39a25-149">Note that if your availability group spans Azure regions, you must run the script once in each datacenter for the cloud service and nodes that reside in that datacenter.</span></span>
   
        # Define variables
        $ServiceName = "<MyCloudService>" # the name of the cloud service that contains the availability group nodes
        $AGNodes = "<VM1>","<VM2>","<VM3>" # all availability group nodes containing replicas in the same cloud service, separated by commas
   
        # Configure a load balanced endpoint for each node in $AGNodes, with direct server return enabled
        ForEach ($node in $AGNodes)
        {
            Get-AzureVM -ServiceName $ServiceName -Name $node | Add-AzureEndpoint -Name "ListenerEndpoint" -Protocol "TCP" -PublicPort 1433 -LocalPort 1433 -LBSetName "ListenerEndpointLB" -ProbePort 59999 -ProbeProtocol "TCP" -DirectServerReturn $true | Update-AzureVM
        }

2. <span data-ttu-id="39a25-150">Присвоив значения переменным, скопируйте сценарий из текстового редактора в текущий сеанс Azure PowerShell и выполните его.</span><span class="sxs-lookup"><span data-stu-id="39a25-150">Once you have set the variables, copy the script from the text editor into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="39a25-151">Если в командной строке отображается >>, нажмите клавишу ВВОД еще раз, чтобы начать выполнение сценария.</span><span class="sxs-lookup"><span data-stu-id="39a25-151">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>

## <a name="verify-that-kb2854082-is-installed-if-necessary"></a><span data-ttu-id="39a25-152">Проверка наличия пакета KB2854082</span><span class="sxs-lookup"><span data-stu-id="39a25-152">Verify that KB2854082 is installed if necessary</span></span>
[!INCLUDE [kb2854082](../../../../includes/virtual-machines-ag-listener-kb2854082.md)]

## <a name="open-the-firewall-ports-in-availability-group-nodes"></a><span data-ttu-id="39a25-153">Открытие портов брандмауэра в узлах групп доступности.</span><span class="sxs-lookup"><span data-stu-id="39a25-153">Open the firewall ports in availability group nodes</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-open-firewall.md)]

## <a name="create-the-availability-group-listener"></a><span data-ttu-id="39a25-154">Создание прослушивателя группы доступности</span><span class="sxs-lookup"><span data-stu-id="39a25-154">Create the availability group listener</span></span>

<span data-ttu-id="39a25-155">Создайте прослушиватель группы доступности в два этапа.</span><span class="sxs-lookup"><span data-stu-id="39a25-155">Create the availability group listener in two steps.</span></span> <span data-ttu-id="39a25-156">Сначала создайте кластерный ресурс точки доступа клиента и настройте зависимости.</span><span class="sxs-lookup"><span data-stu-id="39a25-156">First, create the client access point cluster resource and configure  dependencies.</span></span> <span data-ttu-id="39a25-157">Затем настройте кластерные ресурсы с помощью PowerShell.</span><span class="sxs-lookup"><span data-stu-id="39a25-157">Second, configure the cluster resources with PowerShell.</span></span>

### <a name="create-the-client-access-point-and-configure-the-cluster-dependencies"></a><span data-ttu-id="39a25-158">Создание точки доступа клиента и настройка кластерных зависимостей</span><span class="sxs-lookup"><span data-stu-id="39a25-158">Create the client access point and configure the cluster dependencies</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-create-listener.md)]

### <a name="configure-the-cluster-resources-in-powershell"></a><span data-ttu-id="39a25-159">Настройка кластерных ресурсов в PowerShell</span><span class="sxs-lookup"><span data-stu-id="39a25-159">Configure the cluster resources in PowerShell</span></span>
1. <span data-ttu-id="39a25-160">Для использования внешней балансировки нагрузки вам потребуется получить общедоступный виртуальный IP-адрес облачной службы, на которой размещены ваши реплики.</span><span class="sxs-lookup"><span data-stu-id="39a25-160">For external load balancing, you must obtain the public virtual IP address of the cloud service that contains your replicas.</span></span> <span data-ttu-id="39a25-161">Войдите на портал Azure.</span><span class="sxs-lookup"><span data-stu-id="39a25-161">Log into the Azure portal.</span></span> <span data-ttu-id="39a25-162">Перейдите к облачной службе, в которой находится виртуальная машина вашей группы доступности.</span><span class="sxs-lookup"><span data-stu-id="39a25-162">Navigate to the cloud service that contains your availability group VM.</span></span> <span data-ttu-id="39a25-163">Откройте представление **Панель мониторинга** .</span><span class="sxs-lookup"><span data-stu-id="39a25-163">Open the **Dashboard** view.</span></span>
2. <span data-ttu-id="39a25-164">Запишите адрес, показанный в разделе **Общедоступный виртуальный IP-адрес (VIP-адрес)**.</span><span class="sxs-lookup"><span data-stu-id="39a25-164">Note the address shown under **Public Virtual IP (VIP) Address**.</span></span> <span data-ttu-id="39a25-165">Если ваше решение располагается в нескольких виртуальных сетях, повторите этот шаг для каждой облачной службы с виртуальной машиной, на которой размещается реплика.</span><span class="sxs-lookup"><span data-stu-id="39a25-165">If your solution spans VNets, repeat this step for each cloud service that contains a VM that hosts a replica.</span></span>
3. <span data-ttu-id="39a25-166">Войдите на одну из виртуальных машин и скопируйте приведенный ниже сценарий PowerShell в текстовый редактор. Затем присвойте переменным записанные ранее значения.</span><span class="sxs-lookup"><span data-stu-id="39a25-166">On one of the VMs, copy the PowerShell script below into a text editor and set the variables to the values you noted earlier.</span></span>
   
        # Define variables
        $ClusterNetworkName = "<ClusterNetworkName>" # the cluster network name (Use Get-ClusterNetwork on Windows Server 2012 of higher to find the name)
        $IPResourceName = "<IPResourceName>" # the IP Address resource name
        $CloudServiceIP = "<X.X.X.X>" # Public Virtual IP (VIP) address of your cloud service
   
        Import-Module FailoverClusters
   
        # If you are using Windows Server 2012 or higher, use the Get-Cluster Resource command. If you are using Windows Server 2008 R2, use the cluster res command. Both commands are commented out. Choose the one applicable to your environment and remove the # at the beginning of the line to convert the comment to an executable line of code.
   
        # Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$CloudServiceIP";"ProbePort"="59999";"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"OverrideAddressMatch"=1;"EnableDhcp"=0}
        # cluster res $IPResourceName /priv enabledhcp=0 overrideaddressmatch=1 address=$CloudServiceIP probeport=59999  subnetmask=255.255.255.255
4. <span data-ttu-id="39a25-167">Присвоив значения переменным, откройте окно Windows PowerShell с повышенными правами. Затем скопируйте сценарий из текстового редактора, вставьте его в текущий сеанс Azure PowerShell и выполните сценарий.</span><span class="sxs-lookup"><span data-stu-id="39a25-167">Once you have set the variables, open an elevated Windows PowerShell window, then copy the script from the text editor and paste into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="39a25-168">Если в командной строке отображается >>, нажмите клавишу ВВОД еще раз, чтобы начать выполнение сценария.</span><span class="sxs-lookup"><span data-stu-id="39a25-168">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>
5. <span data-ttu-id="39a25-169">Повторите эти действия на каждой виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="39a25-169">Repeat this on each VM.</span></span> <span data-ttu-id="39a25-170">Этот сценарий настраивает ресурс IP-адреса путем установки IP-адреса облачной службы и прочих параметров, таких как порт зонда.</span><span class="sxs-lookup"><span data-stu-id="39a25-170">This script configures the IP Address resource with the IP address of the cloud service and sets other parameters like the probe port.</span></span> <span data-ttu-id="39a25-171">После подключения ресурс IP-адреса сможет отвечать на запросы, отправляемые на порт зонда из созданной ранее конечной точки балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="39a25-171">When the IP Address resource is brought online, it can then respond to the polling on the probe port from the load-balanced endpoint created earlier in this tutorial.</span></span>

## <a name="bring-the-listener-online"></a><span data-ttu-id="39a25-172">Подключение прослушивателя</span><span class="sxs-lookup"><span data-stu-id="39a25-172">Bring the listener online</span></span>
[!INCLUDE [Bring-Listener-Online](../../../../includes/virtual-machines-ag-listener-bring-online.md)]

## <a name="follow-up-items"></a><span data-ttu-id="39a25-173">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="39a25-173">Follow-up items</span></span>
[!INCLUDE [Follow-up](../../../../includes/virtual-machines-ag-listener-follow-up.md)]

## <a name="test-the-availability-group-listener-within-the-same-vnet"></a><span data-ttu-id="39a25-174">Проверьте прослушиватель группы доступности (в пределах одной виртуальной сети)</span><span class="sxs-lookup"><span data-stu-id="39a25-174">Test the availability group listener (within the same VNet)</span></span>
[!INCLUDE [Test-Listener-Within-VNET](../../../../includes/virtual-machines-ag-listener-test.md)]

## <a name="test-the-availability-group-listener-over-the-internet"></a><span data-ttu-id="39a25-175">Проверьте прослушиватель группы доступности (из сети Интернет)</span><span class="sxs-lookup"><span data-stu-id="39a25-175">Test the availability group listener (over the internet)</span></span>
<span data-ttu-id="39a25-176">Чтобы получить доступ к прослушивателю вне виртуальной сети, необходимо использовать внешнюю или общедоступную балансировку нагрузки (описанные в этой статье), а не внутренний балансировщик нагрузки, доступный только в пределах одной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="39a25-176">In order to access the listener from outside the virtual network, you must be using external/public load balancing (described in this topic) rather than ILB, which is only accesible within the same VNet.</span></span> <span data-ttu-id="39a25-177">В строке подключения укажите имя облачной службы.</span><span class="sxs-lookup"><span data-stu-id="39a25-177">In the connection string, you specify the cloud service name.</span></span> <span data-ttu-id="39a25-178">Например, если ваша облачная служба называется *mycloudservice*, оператор sqlcmd будет выглядеть так:</span><span class="sxs-lookup"><span data-stu-id="39a25-178">For example, if you had a cloud service with the name *mycloudservice*, the sqlcmd statement would be as follows:</span></span>

    sqlcmd -S "mycloudservice.cloudapp.net,<EndpointPort>" -d "<DatabaseName>" -U "<LoginId>" -P "<Password>"  -Q "select @@servername, db_name()" -l 15

<span data-ttu-id="39a25-179">В отличие от предыдущего примера здесь потребуется проверка подлинности SQL. Это связано с тем, что вызывающий объект не может использовать проверку подлинности Windows через Интернет.</span><span class="sxs-lookup"><span data-stu-id="39a25-179">Unlike the previous example, SQL authentication must be used, because the caller cannot use windows authentication over the internet.</span></span> <span data-ttu-id="39a25-180">Дополнительные сведения см. в публикации блога [AlwaysOn Availability Group in Windows Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx) (Группы доступности AlwaysOn на виртуальной машине Azure: сценарии клиентских подключений).</span><span class="sxs-lookup"><span data-stu-id="39a25-180">For more information, see [Always On Availability Group in Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span></span> <span data-ttu-id="39a25-181">При использовании проверки подлинности SQL учетные данные для входа на обоих репликах должны совпадать.</span><span class="sxs-lookup"><span data-stu-id="39a25-181">When using SQL authentication, make sure that you create the same login on both replicas.</span></span> <span data-ttu-id="39a25-182">Дополнительные сведения об устранении неполадок с учетными данными, возникающих при использовании групп доступности, см. в статье [Сопоставление учетных записей или использование пользователей автономных баз данных SQL для подключения к другим репликам и сопоставления баз данных доступности](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span><span class="sxs-lookup"><span data-stu-id="39a25-182">For more information about troubleshooting logins with Availability Groups, see [How to map logins or use contained SQL database user to connect to other replicas and map to availability databases](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span></span>

<span data-ttu-id="39a25-183">Если реплики AlwaysOn размещены в разных подсетях, клиенты должны указывать **MultisubnetFailover=True** в строке подключения.</span><span class="sxs-lookup"><span data-stu-id="39a25-183">If the Always On replicas are in different subnets, clients must specify **MultisubnetFailover=True** in the connection string.</span></span> <span data-ttu-id="39a25-184">В результате будут выполняться попытки параллельного подключения к репликам в разных подсетях.</span><span class="sxs-lookup"><span data-stu-id="39a25-184">This results in parallel connection attempts to replicas in the different subnets.</span></span> <span data-ttu-id="39a25-185">Обратите внимание, что этот сценарий включает развертывание межрегиональной группы доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="39a25-185">Note that this scenario includes a cross-region Always On Availability Group deployment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="39a25-186">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="39a25-186">Next steps</span></span>
[!INCLUDE [Listener-Next-Steps](../../../../includes/virtual-machines-ag-listener-next-steps.md)]

