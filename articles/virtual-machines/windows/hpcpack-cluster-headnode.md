---
title: "Создание головного узла пакета HPC на виртуальной машине Azure | Документация Майкрософт"
description: "Сведения о том, как использовать портал Azure и модель развертывания Resource Manager для создания головного узла пакета Microsoft HPC 2012 R2 на виртуальной машине Azure."
services: virtual-machines-windows
documentationcenter: 
author: dlepow
manager: timlt
editor: 
tags: azure-resource-manager,hpc-pack
ms.assetid: e6a13eaf-9124-47b4-8d75-2bc4672b8f21
ms.service: virtual-machines-windows
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 12/29/2016
ms.author: danlep
ms.openlocfilehash: b2bb9caf82a580dc5f67ea0b0b1c2e9a46363e9c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="create-the-head-node-of-an-hpc-pack-cluster-in-an-azure-vm-with-a-marketplace-image"></a><span data-ttu-id="27b12-103">Создание головного узла кластера пакета HPC на виртуальной машине Azure с помощью образа Marketplace</span><span class="sxs-lookup"><span data-stu-id="27b12-103">Create the head node of an HPC Pack cluster in an Azure VM with a Marketplace image</span></span>
<span data-ttu-id="27b12-104">Для создания головного узла кластера HPC с помощью портала Azure используйте [образ виртуальной машины пакета Microsoft HPC 2012 R2](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/) из Azure Marketplace.</span><span class="sxs-lookup"><span data-stu-id="27b12-104">Use a [Microsoft HPC Pack 2012 R2 virtual machine image](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/) from the Azure Marketplace and the Azure portal to create the head node of an HPC cluster.</span></span> <span data-ttu-id="27b12-105">Этот образ виртуальной машины пакета HPC основан на ОС Windows Server 2012 R2 Datacenter с предустановленным пакетом HPC 2012 R2 с обновлением 3.</span><span class="sxs-lookup"><span data-stu-id="27b12-105">This HPC Pack VM image is based on Windows Server 2012 R2 Datacenter with HPC Pack 2012 R2 Update 3 pre-installed.</span></span> <span data-ttu-id="27b12-106">Используйте этот головной узел для экспериментального развертывания пакета HPC в Azure.</span><span class="sxs-lookup"><span data-stu-id="27b12-106">Use this head node for a proof of concept deployment of HPC Pack in Azure.</span></span> <span data-ttu-id="27b12-107">Затем можно добавить к кластеру вычислительные узлы для запуска рабочих нагрузок HPC.</span><span class="sxs-lookup"><span data-stu-id="27b12-107">You can then add compute nodes to the cluster to run HPC workloads.</span></span>

> [!TIP]
> <span data-ttu-id="27b12-108">Чтобы развернуть в Azure полный кластер пакета HPC 2012 R2, который включает в себя головной узел и вычислительные узлы, рекомендуется использовать автоматизированный метод.</span><span class="sxs-lookup"><span data-stu-id="27b12-108">To deploy a complete HPC Pack 2012 R2 cluster in Azure that includes the head node and compute nodes, we recommend that you use an automated method.</span></span> <span data-ttu-id="27b12-109">Для этого можно использовать [сценарий развертывания IaaS пакета HPC](classic/hpcpack-cluster-powershell-script.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json) и шаблоны Resource Manager, например [кластера пакета HPC для рабочих нагрузок Windows](https://azure.microsoft.com/marketplace/partners/microsofthpc/newclusterwindowscn/).</span><span class="sxs-lookup"><span data-stu-id="27b12-109">Options include the [HPC Pack IaaS deployment script](classic/hpcpack-cluster-powershell-script.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json) and Resource Manager templates such as the [HPC Pack cluster for Windows workloads](https://azure.microsoft.com/marketplace/partners/microsofthpc/newclusterwindowscn/).</span></span> <span data-ttu-id="27b12-110">Шаблоны Resource Manager также доступны для [кластеров пакета Microsoft HPC 2016](https://github.com/MsHpcPack/HPCPack2016/tree/master/newcluster-templates).</span><span class="sxs-lookup"><span data-stu-id="27b12-110">Resource Manager templates are also available for [Microsoft HPC Pack 2016 clusters](https://github.com/MsHpcPack/HPCPack2016/tree/master/newcluster-templates).</span></span> 
> 
> 

## <a name="planning-considerations"></a><span data-ttu-id="27b12-111">Рекомендации относительно планирования</span><span class="sxs-lookup"><span data-stu-id="27b12-111">Planning considerations</span></span>
<span data-ttu-id="27b12-112">Как показано на следующей схеме, головной узел должен кластера пакета HPC быть развернут в домене Active Directory в виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="27b12-112">As shown in the following figure, you deploy the HPC Pack head node in an Active Directory domain in an Azure virtual network.</span></span>

![Головной узел пакета HPC][headnode]

* <span data-ttu-id="27b12-114">**Домен Active Directory** — перед запуском служб HPC головной узел пакета HPC 2012 R2 должен быть присоединен к домену Active Directory в Azure на виртуальной машине.</span><span class="sxs-lookup"><span data-stu-id="27b12-114">**Active Directory domain**: The HPC Pack 2012 R2 head node must be joined to an Active Directory domain in Azure before you start the HPC services on the VM.</span></span> <span data-ttu-id="27b12-115">Как показано в этой статье, для экспериментального развертывания перед запуском служб HPC можно повысить уровень виртуальной машины, создаваемой для головного узла, до контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="27b12-115">As shown in this article, for a proof of concept deployment, you can promote the VM you create for the head node as a domain controller before starting the HPC services.</span></span> <span data-ttu-id="27b12-116">Другой вариант — развертывание отдельного контроллера домена и леса в Azure, к которому можно присоединить виртуальную машину головного узла.</span><span class="sxs-lookup"><span data-stu-id="27b12-116">Another option is to deploy a separate domain controller and forest in Azure to which you join the head node VM.</span></span>

* <span data-ttu-id="27b12-117">**Модель развертывания** — для большинства новых развертываний корпорация Майкрософт рекомендует использовать модель развертывания с помощью Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="27b12-117">**Deployment model**: For most new deployments, Microsoft recommends that you use the Resource Manager deployment model.</span></span> <span data-ttu-id="27b12-118">В этой статье предполагается, что вы используете эту модель развертывания.</span><span class="sxs-lookup"><span data-stu-id="27b12-118">This article assumes that you use this deployment model.</span></span>

* <span data-ttu-id="27b12-119">**Виртуальная сеть Azure** — при использовании модели развертывания с помощью Resource Manager для развертывания головного узла следует указать или создать виртуальную сеть Azure.</span><span class="sxs-lookup"><span data-stu-id="27b12-119">**Azure virtual network**: When you use the Resource Manager deployment model to deploy the head node, you specify or create an Azure virtual network.</span></span> <span data-ttu-id="27b12-120">Виртуальная сеть используется в том случае, если необходимо присоединить головной узел к существующему домену Active Directory.</span><span class="sxs-lookup"><span data-stu-id="27b12-120">You use the virtual network if you need to join the head node to an existing Active Directory domain.</span></span> <span data-ttu-id="27b12-121">Кроме того, она потребуются позднее для добавления виртуальных машин вычислительных узлов в кластер.</span><span class="sxs-lookup"><span data-stu-id="27b12-121">You also need it later to add compute node VMs to the cluster.</span></span>

## <a name="steps-to-create-the-head-node"></a><span data-ttu-id="27b12-122">Шаги по созданию головного узла</span><span class="sxs-lookup"><span data-stu-id="27b12-122">Steps to create the head node</span></span>
<span data-ttu-id="27b12-123">Ниже в общих чертах описывается, как с помощью портала Azure создать виртуальную машину Azure для головного узла пакета HPC, используя модель развертывания с помощью Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="27b12-123">Following are high-level steps to use the Azure portal to create an Azure VM for the HPC Pack head node by using the Resource Manager deployment model.</span></span> 

1. <span data-ttu-id="27b12-124">Если вы хотите создать новый лес Active Directory в Azure с отдельными виртуальными машинами контроллера домена, одним из вариантов является использование [шаблона Resource Manager](https://github.com/Azure/azure-quickstart-templates/tree/master/active-directory-new-domain-ha-2-dc).</span><span class="sxs-lookup"><span data-stu-id="27b12-124">If you want to create a new Active Directory forest in Azure with separate domain controller VMs, one option is to use a [Resource Manager template](https://github.com/Azure/azure-quickstart-templates/tree/master/active-directory-new-domain-ha-2-dc).</span></span> <span data-ttu-id="27b12-125">Для простого подтверждающего концепцию развертывания этот шаг можно пропустить и настроить саму виртуальную машину головного узла в качестве контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="27b12-125">For a simple proof of concept deployment, it's fine to omit this step and configure the head node VM itself as a domain controller.</span></span> <span data-ttu-id="27b12-126">Этот вариант описан далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="27b12-126">This option is described later in this article.</span></span>
2. <span data-ttu-id="27b12-127">На странице [HPC Pack 2012 R2 on Windows Server 2012 R2](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/) (Пакет HPC 2012 R2 на основе Windows Server 2012 R2) в Azure Marketplace щелкните **Создать виртуальную машину**.</span><span class="sxs-lookup"><span data-stu-id="27b12-127">On the [HPC Pack 2012 R2 on Windows Server 2012 R2 page](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/) in the Azure Marketplace, click **Create Virtual Machine**.</span></span> 
3. <span data-ttu-id="27b12-128">На портале на странице **HPC Pack 2012 R2 on Windows Server 2012 R2** (Пакет HPC 2012 R2 на основе Windows Server 2012 R2) выберите модель развертывания **Resource Manager**, а затем нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="27b12-128">In the portal, on the **HPC Pack 2012 R2 on Windows Server 2012 R2** page, select the **Resource Manager** deployment model and then click **Create**.</span></span>
   
    ![Образ пакета HPC][marketplace]
4. <span data-ttu-id="27b12-130">Используйте портал для указания настроек и создания виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="27b12-130">Use the portal to configure the settings and create the VM.</span></span> <span data-ttu-id="27b12-131">Если вы новичок в Azure, то ознакомьтесь с подробными инструкциями в руководстве [Создание виртуальной машины Windows на портале Azure](../virtual-machines-windows-hero-tutorial.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="27b12-131">If you're new to Azure, follow the tutorial [Create a Windows virtual machine in the Azure portal](../virtual-machines-windows-hero-tutorial.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span> <span data-ttu-id="27b12-132">Для подтверждающего концепцию развертывания большинство параметров можно оставить без изменения, приняв значения по умолчанию или рекомендуемые значения.</span><span class="sxs-lookup"><span data-stu-id="27b12-132">For a proof of concept deployment, you can usually accept the default or recommended settings.</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="27b12-133">Если вы хотите присоединить головной узел к существующему домену Active Directory в Azure, то при создании виртуальной машины укажите виртуальную сеть для этого домена.</span><span class="sxs-lookup"><span data-stu-id="27b12-133">If you want to join the head node to an existing Active Directory domain in Azure, make sure you specify the virtual network for that domain when creating the VM.</span></span>
   > 
   > 
5. <span data-ttu-id="27b12-134">После создания и запуска виртуальной машины [подключитесь к ней](connect-logon.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) через протокол удаленного рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="27b12-134">After you create the VM and the VM is running, [connect to the VM](connect-logon.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) by Remote Desktop.</span></span> 
6. <span data-ttu-id="27b12-135">Присоедините виртуальную машину к лесу домена Active Directory, выбрав один из следующих вариантов.</span><span class="sxs-lookup"><span data-stu-id="27b12-135">Join the VM to an Active Directory domain forest by choosing one of the following options:</span></span>
   
   * <span data-ttu-id="27b12-136">В случае, если виртуальная машина создана в виртуальной сети Azure с существующим доменным лесом, используйте стандартный диспетчер сервера или инструменты Windows PowerShell для присоединения виртуальной машины к лесу.</span><span class="sxs-lookup"><span data-stu-id="27b12-136">If you created the VM in an Azure virtual network with an existing domain forest, join the VM to the forest by using standard Server Manager or Windows PowerShell tools.</span></span> <span data-ttu-id="27b12-137">Выполните перезапуск.</span><span class="sxs-lookup"><span data-stu-id="27b12-137">Then restart.</span></span>
   * <span data-ttu-id="27b12-138">Если вы создали виртуальную машину в новой виртуальной сети без доменного леса, повысьте эту виртуальную машину до контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="27b12-138">If you created the VM in a new virtual network (without an existing domain forest), then promote the VM as a domain controller.</span></span> <span data-ttu-id="27b12-139">Следуйте стандартной процедуре установки и настройки роли доменных служб Active Directory на головном узле.</span><span class="sxs-lookup"><span data-stu-id="27b12-139">Use standard steps to install and configure the Active Directory Domain Services role on the head node.</span></span> <span data-ttu-id="27b12-140">Подробные инструкции см. в разделе [Установка нового леса Active Directory в Windows Server 2012](https://technet.microsoft.com/library/jj574166.aspx).</span><span class="sxs-lookup"><span data-stu-id="27b12-140">For detailed steps, see [Install a New Windows Server 2012 Active Directory Forest](https://technet.microsoft.com/library/jj574166.aspx).</span></span>
7. <span data-ttu-id="27b12-141">Когда виртуальная машина будет запущена и присоединена к лесу Active Directory, запустите службы пакета HPC, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="27b12-141">After the VM is running and is joined to an Active Directory forest, start the HPC Pack services as follows:</span></span>
   
    <span data-ttu-id="27b12-142">а.</span><span class="sxs-lookup"><span data-stu-id="27b12-142">a.</span></span> <span data-ttu-id="27b12-143">Подключитесь к виртуальной машине головного узла, используя учетную запись домена, которая является участником локальной группы администраторов.</span><span class="sxs-lookup"><span data-stu-id="27b12-143">Connect to the head node VM using a domain account that is a member of the local Administrators group.</span></span> <span data-ttu-id="27b12-144">Например, можно использовать учетную запись администратора, настроенную при создании виртуальной машины головного узла.</span><span class="sxs-lookup"><span data-stu-id="27b12-144">For example, use the administrator account you set up when you created the head node VM.</span></span>
   
    <span data-ttu-id="27b12-145">b.</span><span class="sxs-lookup"><span data-stu-id="27b12-145">b.</span></span> <span data-ttu-id="27b12-146">Для использования конфигурации головного узла по умолчанию запустите Windows PowerShell от имени администратора и введите следующую команду:</span><span class="sxs-lookup"><span data-stu-id="27b12-146">For a default head node configuration, start Windows PowerShell as an administrator and type the following:</span></span>
   
    ```PowerShell
    & $env:CCP_HOME\bin\HPCHNPrepare.ps1 –DBServerInstance ".\ComputeCluster"
    ```
   
    <span data-ttu-id="27b12-147">Запуск служб пакета HPC может занять несколько минут.</span><span class="sxs-lookup"><span data-stu-id="27b12-147">It can take several minutes for the HPC Pack services to start.</span></span>
   
    <span data-ttu-id="27b12-148">Для вывода сведений о дополнительных параметрах конфигурации головного узла введите `get-help HPCHNPrepare.ps1`.</span><span class="sxs-lookup"><span data-stu-id="27b12-148">For additional head node configuration options, type `get-help HPCHNPrepare.ps1`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="27b12-149">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="27b12-149">Next steps</span></span>
* <span data-ttu-id="27b12-150">Теперь вы можете работать с головным узлом кластера пакета HPC.</span><span class="sxs-lookup"><span data-stu-id="27b12-150">You can now work with the head node of your HPC Pack cluster.</span></span> <span data-ttu-id="27b12-151">Например, запустите диспетчер кластеров HPC и завершите [список дел развертывания](https://technet.microsoft.com/library/jj884141.aspx).</span><span class="sxs-lookup"><span data-stu-id="27b12-151">For example, start HPC Cluster Manager, and complete the [Deployment To-do List](https://technet.microsoft.com/library/jj884141.aspx).</span></span>
* <span data-ttu-id="27b12-152">Если требуется увеличивать вычислительную мощность кластера по запросу, добавьте [расширительные узлы Azure](classic/hpcpack-cluster-node-burst.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json) в облачную службу.</span><span class="sxs-lookup"><span data-stu-id="27b12-152">If you want to increase the cluster compute capacity on-demand, add [Azure burst nodes](classic/hpcpack-cluster-node-burst.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json) in a cloud service.</span></span> 
* <span data-ttu-id="27b12-153">Попробуйте запустить рабочую нагрузку в кластере.</span><span class="sxs-lookup"><span data-stu-id="27b12-153">Try running a test workload on the cluster.</span></span> <span data-ttu-id="27b12-154">См. пример в [руководстве по началу работы](https://technet.microsoft.com/library/jj884144) с пакетом HPC.</span><span class="sxs-lookup"><span data-stu-id="27b12-154">For an example, see the HPC Pack [getting started guide](https://technet.microsoft.com/library/jj884144).</span></span>

<!--Image references-->
[headnode]: ./media/hpcpack-cluster-headnode/headnode.png
[marketplace]: ./media/hpcpack-cluster-headnode/marketplace.png
