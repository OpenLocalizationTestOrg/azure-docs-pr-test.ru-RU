---
title: "aaaCreate конвейера CI или компакт-диска в Azure с помощью Team Services | Документы Microsoft"
description: "Узнайте, как Visual Studio Team Services toocreate конвейера для непрерывной интеграции и доставки, который развертывает tooIIS приложения web на виртуальной Машине Windows"
services: virtual-machines-windows
documentationcenter: virtual-machines
author: iainfoulds
manager: timlt
editor: tysonn
tags: azure-resource-manager
ms.assetid: 
ms.service: virtual-machines-windows
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure
ms.date: 05/12/2017
ms.author: iainfou
ms.custom: mvc
ms.openlocfilehash: b758a124c4742854dd3b543f747fd8700f954414
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="create-a-continuous-integration-pipeline-with-visual-studio-team-services-and-iis"></a>Создание конвейера для непрерывной интеграции с помощью Visual Studio Team Services и IIS
tooautomate hello сборки, тестирования и развертывания этапах разработки приложения, можно использовать непрерывной интеграции и развертывания (CI/CD) конвейера. В рамках этого руководства вы создадите конвейер CI/CD с помощью Visual Studio Team Services и виртуальной машины Windows в Azure, где выполняются службы IIS. Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Публикация проекта Team Services веб-приложения ASP.NET tooa
> * создавать определение сборки, которое активируется фиксациями кода;
> * устанавливать и настраивать IIS на виртуальной машине в Azure;
> * Добавить группу развертывания tooa экземпляр IIS hello в Team Services
> * Создание выпуска определения toopublish новый веб-развертывание пакетов tooIIS
> * Тестирование hello CI/CD конвейера

Этот учебник требует hello Azure PowerShell модуль версии 3.6 или более поздней версии. Запустите `Get-Module -ListAvailable AzureRM` версии toofind hello. Получить tooupgrade [установите Azure PowerShell модуль](/powershell/azure/install-azurerm-ps).


## <a name="create-project-in-team-services"></a>Создание проекта в Team Services
Visual Studio Team Services обеспечивает совместную работу и разработку без необходимости обслуживания решения для управления локальным кодом. Team Services также позволяет выполнять тестирование кода в облака, а также создавать и анализировать приложение. Вы можете выбрать интегрированную среду разработки и репозиторий системы управления версиями, которые лучше всего подходят для вашего сценария разработки кода. В этом учебнике можно использовать бесплатную учетную запись toocreate основные веб-приложения ASP.NET и конвейер CI или компакт-диска. Если у вас еще нет учетной записи Team Services, [создайте ее](http://go.microsoft.com/fwlink/?LinkId=307137).

процесс фиксации кода hello toomanage, определений сборок и определения выпуска, Создание проекта в Team Services следующим образом:

1. В браузере откройте панель мониторинга Team Services и выберите **Новый проект**.
2. Введите *myWebApp* для hello **имя проекта**. Оставьте все другие toouse значения по умолчанию *Git* системы управления версиями и *Agile* процесс рабочего элемента.
3. Выберите параметр hello слишком**предоставить** *члены команды*, а затем выберите **создать**.
5. После создания проекта, выберите параметр hello слишком**инициализации при помощи README или gitignore**, затем **инициализировать**.
6. Внутри нового проекта выберите **панелей мониторинга** сверху hello, затем выберите **в среде Visual Studio**.


## <a name="create-aspnet-web-application"></a>Создание веб-приложения ASP.NET
В предыдущем шаге hello создать проект в Team Services. Последний шаг Hello открывает новый проект в Visual Studio. Управление фиксаций кода в hello **Team Explorer** окна. Создайте локальную копию нового проекта, а затем создайте веб-приложение ASP.NET из шаблона, как показано ниже.

1. Выберите **клон** toocreate репозитории git локального проекта Team Services.
    
    ![Клонирование репозитория из проекта Team Services](media/tutorial-vsts-iis-cicd/clone_repo.png)

2. В разделе **Решения** выберите **Создать**.

    ![Создание решения веб-приложения](media/tutorial-vsts-iis-cicd/new_solution.png)

3. Выберите **веб** шаблоны, а затем выберите hello **веб-приложение ASP.NET** шаблона.
    1. Введите имя для вашего приложения, такие как *myWebApp*и снимите флажок hello для **создать каталог для решения**.
    2. Если параметр hello, снимите флажок hello слишком**tooproject добавить Application Insights**. Application Insights требуется вы tooauthorize веб-приложения с помощью Azure Application Insights. tookeep простым в этом учебнике, пропустите этот процесс.
    3. Нажмите кнопку **ОК**.
4. Выберите **MVC** из списка шаблонов hello.
    1. Выберите **Изменить способ проверки подлинности**, затем — **Нет проверки подлинности** и нажмите кнопку **ОК**.
    2. Выберите **ОК** toocreate решения.
5. В hello **Team Explorer** окно, выберите **изменения**.

    ![Зафиксировать репозитория git служб tooTeam локальных изменений](media/tutorial-vsts-iis-cicd/commit_changes.png)

6. В текстовом поле hello фиксации, введите сообщение, таких как *фиксации начального*. Выберите **зафиксировать все и синхронизировать** hello раскрывающегося меню.


## <a name="create-build-definition"></a>Создание определения сборки
В Team Services используется toooutline определение сборки, построение приложения. В этом учебнике мы создадим базового определения, принимает наш исходный код сборки hello решения, а затем создается веб развертывание пакета, можно использовать toorun hello веб-приложения на сервере IIS.

1. В проекте Team Services выберите **построения и выпуска** сверху hello, затем выберите **строит**.
3. Выберите **+ Новое определение**.
4. Выберите hello **ASP.NET (Предварительная версия)** шаблона и выберите **применить**.
5. Оставьте все по умолчанию hello значения задачи. В разделе **получить исходный**, убедитесь, что hello *myWebApp* репозитория и *master* выбраны ветви.

    ![Создание определения сборки в проекте Team Services](media/tutorial-vsts-iis-cicd/create_build_definition.png)

6. На hello **триггеры** вкладки, переместите ползунок hello **включения триггера** слишком*включено*.
7. Сохранить определение сборки hello и очередь новую сборку, выбрав **сохранить & очередь** , затем **сохранить & очередь** еще раз. Оставьте значения по умолчанию hello и выделите **очереди**.

Контрольное значение hello сборки запланирован на размещенный агент, затем начинают toobuild. Hello вывода будет примерно toohello следующий пример:

![Успешная сборка проекта Team Services](media/tutorial-vsts-iis-cicd/successful_build.png)


## <a name="create-virtual-machine"></a>Создание виртуальной машины
tooprovide toorun платформы веб-приложения ASP.NET требуется виртуальной машине под управлением служб IIS. Team Services использует toointeract агента с экземпляра IIS hello как фиксация кода и активации сборок.

Создайте виртуальную машину Windows Server 2016 с помощью [этого примера скрипта](../scripts/virtual-machines-windows-powershell-sample-create-vm.md?toc=%2fpowershell%2fmodule%2ftoc.json). Он занимает несколько минут для сценария toorun hello и создать hello виртуальной Машины. После создания hello виртуальной Машины откройте порт 80 для веб-трафика с [AzureRmNetworkSecurityRuleConfig добавить](/powershell/module/azurerm.resources/new-azurermresourcegroup) следующим образом:

```powershell
Get-AzureRmNetworkSecurityGroup `
  -ResourceGroupName $resourceGroup `
  -Name "myNetworkSecurityGroup" | `
Add-AzureRmNetworkSecurityRuleConfig `
  -Name "myNetworkSecurityGroupRuleWeb" `
  -Protocol "Tcp" `
  -Direction "Inbound" `
  -Priority "1001" `
  -SourceAddressPrefix "*" `
  -SourcePortRange "*" `
  -DestinationAddressPrefix "*" `
  -DestinationPortRange "80" `
  -Access "Allow" | `
Set-AzureRmNetworkSecurityGroup
```

tooconnect tooyour виртуальной Машины, получить hello общедоступный IP-адрес с [Get AzureRmPublicIpAddress](/powershell/module/azurerm.network/get-azurermpublicipaddress) следующим образом:

```powershell
Get-AzureRmPublicIpAddress -ResourceGroupName $resourceGroup | Select IpAddress
```

Создайте сеанс удаленного рабочего стола tooyour виртуальной Машины:

```cmd
mstsc /v:<publicIpAddress>
```

Откройте на hello виртуальной Машины, **PowerShell администратора** командной строки. Установите IIS и необходимые компоненты .NET, как показано ниже.

```powershell
Install-WindowsFeature Web-Server,Web-Asp-Net45,NET-Framework-Features
```


## <a name="create-deployment-group"></a>Создание группы развертывания
toopush out hello web развертывание сервера IIS toohello пакета, определите группу развертывания в Team Services. Эта группа позволяет toospecify, какие серверы являются целью hello новых сборок, зафиксировал tooTeam кода выполняются службы и сборки.

1. В Team Services выберите **Сборка и выпуск**, а затем — **Группы развертываний**.
2. Выберите **Добавить группу развертывания**.
3. Например, введите имя для группы hello *myIIS*, а затем выберите **создать**.
4. В hello **зарегистрируйте машины** Убедитесь *Windows* выбран, а затем установите флажок "hello" слишком**использовать в скрипте hello личный маркер доступа для проверки подлинности**.
5. Выберите **скопируйте сценарий tooclipboard**.


### <a name="add-iis-vm-toohello-deployment-group"></a>Добавить группу развертывания toohello IIS виртуальной Машины
Создание группы развертывания hello добавьте каждой группы toohello экземпляр IIS. Team Services создает скрипт, который загружает и настраивает агент на hello виртуальной Машины, которая получает новый веб-узел развертывания пакетов, а затем применяет их tooIIS.

1. Вернитесь в hello **PowerShell администратора** сеанс на ВМ, вставьте и запустите сценарий hello, скопированные из Team Services.
2. Когда запрос tooconfigure теги для агента hello, выберите *Y* и введите *web*.
3. Когда появится сообщение hello учетной записи пользователя, нажмите клавишу *возвращают* tooaccept hello значения по умолчанию.
4. Дождитесь hello toofinish сценария с сообщением *vstsagent.account.computername служба успешно запущена*.
5. В hello **группы развертывания** страница hello **построения и выпуска** меню, откройте hello *myIIS* Группа развертывания. На hello **машины** убедитесь, что указана ВМ.

    ![Виртуальная машина успешно добавлено tooTeam группы развертывания служб](media/tutorial-vsts-iis-cicd/deployment_group.png)


## <a name="create-release-definition"></a>Создание определения выпуска
toopublish сборки, необходимо создать определение выпуска в Team Services. Это определение запускается автоматически при успешной сборке приложения. Необходимо выбрать hello развертывания группы toopush веб-развертывания пакета и определить соответствующие параметры IIS hello.

1. Выберите **Сборка и выпуск**, а затем — **Сборки**. Выберите определение сборки hello на предыдущем шаге.
2. В разделе **Недавно завершенные**, выберите последнюю сборку hello, а затем выберите **выпуска**.
3. Выберите **Да** toocreate определения выпуска.
4. Выберите hello **пустой** шаблон, затем выберите **Далее**.
5. Убедитесь, определение сборки проекта и исходные hello заполнены проекта.
6. Выберите hello **непрерывного развертывания** флажок, а затем выберите **создать**.
7. Выберите поле со списком hello Далее слишком**+ добавить задачи** и выберите *добавить этап развертывания группы*.
    
    ![Добавьте определение toorelease задач в Team Services](media/tutorial-vsts-iis-cicd/add_release_task.png)

8. Выберите **добавить** Далее слишком**IIS Web App Deploy(Preview)**, а затем выберите **закрыть**.
9. Выберите hello **выполнить для развертывания группы** родительской задачи.
    1. Для **Группа развертывания**, выберите группу hello развертывания, то созданный ранее, такие как *myIIS*.
    2. В hello **теги машины** выберите **добавить** и выберите hello *web* тег.
    
    ![Задача группы развертывания определения выпуска для IIS](media/tutorial-vsts-iis-cicd/release_definition_iis.png)
 
11. Выберите hello **развертывание: IIS веб-приложения, развертывание** tooconfigure задачи служб IIS экземпляра параметры следующим образом:
    1. Для **имени веб-сайта** введите *Веб-сайт по умолчанию*.
    2. Оставьте все hello другие параметры по умолчанию.
12. Щелкните **Сохранить**, а затем дважды нажмите кнопку **ОК**.


## <a name="create-a-release-and-publish"></a>Создание выпуска и публикация
Теперь вы можете отправить пакет веб-развертывания как новый выпуск. Этот шаг связывается с агентом hello в каждый экземпляр, который является частью группы развертывания hello, помещает hello web развертывание пакета, а затем настраивает IIS toorun hello обновить веб-приложения.

1. В определении выпуска выберите **+ Выпуск**, затем выберите **Создать выпуск**.
2. Убедитесь, что последняя сборка hello в раскрывающемся списке hello, вместе с **автоматическое развертывание: после создания выпуска**. Нажмите кнопку **Создать**.
3. Небольшой баннер hello верхней части появляется определение выпуска, такие как *выпуска «версия 1"был создан*. Выберите hello ссылка выпуска.
4. Откройте hello **журналы** вкладке toowatch hello выпуска выполняется.
    
    ![Успешное создание выпуска Team Services и отправка пакета веб-развертывания](media/tutorial-vsts-iis-cicd/successful_release.png)

5. После выпуска hello откройте веб-браузер и введите hello общедоступный адрес производства вашей виртуальной машины. Вы увидите, что веб-приложение ASP.NET выполняется.

    ![Выполнение веб-приложения ASP.NET на виртуальной машине IIS](media/tutorial-vsts-iis-cicd/running_web_app.png)


## <a name="test-hello-whole-cicd-pipeline"></a>Весь конвейер CI/CD теста hello
С веб-приложения на сервере IIS попробуйте hello весь конвейер CI или компакт-диска. После внесения изменений в Visual Studio, чтобы зафиксировать, активируется код сборки, что вызывает выпустить обновленную веб-развертывание пакета tooIIS:

1. В Visual Studio откройте hello **обозревателе решений** окна.
2. Переход открытия tooand *myWebApp | Представления | Главная | Index.cshtml*
3. Изменение tooread строка 6:

    `<h1>ASP.NET with VSTS and CI/CD!</h1>`

4. Сохраните файл hello.
5. Откройте hello **Team Explorer** окно, выберите hello *myWebApp* проекта, а затем выберите **изменения**.
6. Введите сообщение фиксации, например *конвейера тестирование CI/CD*, выберите **все фиксации и синхронизации** hello раскрывающегося меню.
7. В рабочей области Team Services новая сборка запускается из фиксации кода hello. 
    - Выберите **Сборка и выпуск**, а затем — **Сборки**. 
    - Выберите определение сборки, а затем выберите hello **в очереди и выполнения** toowatch сборки как hello построения продвижения.
9. После успешного построения hello, инициируется новый выпуск.
    - Выберите **построения и выпуска**, затем **выпуски** пакет, помещается tooyour ВМ IIS веб-hello toosee развертывания. 
    - Выберите hello **обновление** значок tooupdate hello состояния. Здравствуйте, когда *среды* столбце отображается зеленая галочка, hello выпуска успешно развернута tooIIS.
11. применить изменения, toosee, обновить веб-сайта IIS, в браузере.

    ![Выполнение веб-приложения ASP.NET на виртуальной машине IIS из конвейера CI/CD](media/tutorial-vsts-iis-cicd/running_web_app_cicd.png)


## <a name="next-steps"></a>Дальнейшие действия

В этом учебнике вы создали веб-приложения ASP.NET в Team Services и настроенного построения и выпуска определения toodeploy нового веб-узла развертывания tooIIS пакетов на каждой фиксации кода. Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Публикация проекта Team Services веб-приложения ASP.NET tooa
> * создавать определение сборки, которое активируется фиксациями кода;
> * устанавливать и настраивать IIS на виртуальной машине в Azure;
> * Добавить группу развертывания tooa экземпляр IIS hello в Team Services
> * Создание выпуска определения toopublish новый веб-развертывание пакетов tooIIS
> * Тестирование hello CI/CD конвейера

Как переместить следующий учебник toolearn toohello toosecure веб-сервере с использованием сертификата SSL.

> [!div class="nextstepaction"]
> [Secure a web server with SSL certificates on a Linux virtual machine in Azure](tutorial-secure-web-server.md) (Защита веб-сервера на виртуальной машине Linux в облаке Azure с помощью SSL-сертификата)