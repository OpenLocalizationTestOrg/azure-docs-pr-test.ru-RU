---
title: "aaaAdd мониторинг и диагностика tooan виртуальной машины Azure | Документы Microsoft"
description: "Используйте toocreate шаблона диспетчера ресурсов Azure новой виртуальной машины Windows с расширением диагностики Azure."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="a1367-103">Использование мониторинга и системы диагностики с виртуальной машиной Windows и шаблонами Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="a1367-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="a1367-104">Hello расширения системы диагностики Azure обеспечивает мониторинг hello и возможности диагностики в Windows на основе виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="a1367-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="a1367-105">Вы можете включить эти возможности на виртуальной машине hello, включая расширение hello как часть шаблона диспетчера ресурсов azure hello.</span><span class="sxs-lookup"><span data-stu-id="a1367-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="a1367-106">Дополнительные сведения о включении любого расширения в шаблон виртуальной машины см. в статье [Создание шаблонов диспетчера ресурсов Azure с расширениями виртуальных машин](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions).</span><span class="sxs-lookup"><span data-stu-id="a1367-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="a1367-107">В этой статье рассматривается, как можно добавить windows hello Azure Diagnostics расширения tooa шаблона виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a1367-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="a1367-108">Добавьте определения ресурсов виртуальной Машины toohello расширения hello диагностики Azure</span><span class="sxs-lookup"><span data-stu-id="a1367-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="a1367-109">расширение системы диагностики hello tooenable на виртуальной машине Windows вы должны иметь расширение hello tooadd виртуальной Машины в качестве ресурса hello шаблона диспетчера ресурсов.</span><span class="sxs-lookup"><span data-stu-id="a1367-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="a1367-110">Для простых диспетчер ресурсов на основе виртуальной машины добавить hello расширения конфигурации toohello *ресурсов* массива для hello виртуальной машины:</span><span class="sxs-lookup"><span data-stu-id="a1367-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="a1367-111">Другое соглашение о распространенных добавить конфигурацию расширения hello hello корневого узла ресурсов шаблона hello, вместо того чтобы определять его в узле ресурсы виртуальной машины hello.</span><span class="sxs-lookup"><span data-stu-id="a1367-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="a1367-112">В этом случае у вас есть tooexplicitly укажите иерархические отношения между расширение hello и hello виртуальной машины с hello *имя* и *тип* значения.</span><span class="sxs-lookup"><span data-stu-id="a1367-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="a1367-113">Например:</span><span class="sxs-lookup"><span data-stu-id="a1367-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="a1367-114">расширение Hello всегда связано с hello виртуальной машины, можно либо непосредственно определить ресурс в узле hello виртуальной машины напрямую или его определения на уровне базы hello и использовать hello иерархических именования tooassociate соглашение о его с виртуального hello компьютер.</span><span class="sxs-lookup"><span data-stu-id="a1367-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="a1367-115">Для расширения набора масштабирования виртуальной машины hello конфигурации указывается в hello *extensionProfile* свойство hello *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="a1367-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="a1367-116">Hello *издатель* свойство со значением hello **Microsoft.Azure.Diagnostics** и hello *тип* свойство со значением hello **IaaSDiagnostics** уникальной идентификации hello расширения диагностики Azure.</span><span class="sxs-lookup"><span data-stu-id="a1367-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="a1367-117">Здравствуйте, значение hello *имя* свойство может иметь расширение toohello toorefer используется в группе ресурсов hello.</span><span class="sxs-lookup"><span data-stu-id="a1367-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="a1367-118">Значения этого свойства специально слишком**Microsoft.Insights.VMDiagnosticsSettings** включит ее toobe легко идентифицировать по hello Azure гарантирует портала, hello мониторинга диаграммы отображаются правильно в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="a1367-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="a1367-119">Hello *typeHandlerVersion* указывает версию hello расширения hello хотелось бы toouse.</span><span class="sxs-lookup"><span data-stu-id="a1367-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="a1367-120">Установка *autoUpgradeMinorVersion* вспомогательная версии слишком**true** гарантирует, что будет получат hello последняя вспомогательная версия расширения hello, которая доступна.</span><span class="sxs-lookup"><span data-stu-id="a1367-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="a1367-121">Настоятельно рекомендуется всегда устанавливать *autoUpgradeMinorVersion* быть tooalways **true** , чтобы всегда получать расширения hello последнюю toouse диагностики доступны все новые функции hello и ошибки исправления.</span><span class="sxs-lookup"><span data-stu-id="a1367-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="a1367-122">Hello *параметры* элемент содержит свойства конфигурации для расширения hello, которое можно задать и считывается расширения hello (который иногда ссылается tooas открытой конфигурации).</span><span class="sxs-lookup"><span data-stu-id="a1367-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="a1367-123">Hello *xmlcfg* свойство содержит конфигурацию на основе xml для журналов диагностики hello, счетчиков производительности собираются агентом диагностики hello и т. д.</span><span class="sxs-lookup"><span data-stu-id="a1367-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="a1367-124">В разделе [схема конфигурации службы диагностики](https://msdn.microsoft.com/library/azure/dn782207.aspx) Дополнительные сведения о hello саму схему xml.</span><span class="sxs-lookup"><span data-stu-id="a1367-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="a1367-125">Распространенной практикой является toostore hello фактические XML-файл конфигурации, как переменную в шаблоне hello диспетчера ресурсов Azure и затем concatenate и base64 кодировать значение hello tooset *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="a1367-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="a1367-126">См. в разделе hello [переменных конфигурации диагностики](#diagnostics-configuration-variables) toounderstand Дополнительные сведения о как toostore hello xml в переменных.</span><span class="sxs-lookup"><span data-stu-id="a1367-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="a1367-127">Hello *storageAccount* свойство указывает, будут передаваться данные диагностики toowhich учетной записи хранилища hello имя hello.</span><span class="sxs-lookup"><span data-stu-id="a1367-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="a1367-128">Здравствуйте, свойства в *protectedSettings* (который иногда ссылается tooas закрытая конфигурация) можно установить, но не удается прочитать обратно после установки.</span><span class="sxs-lookup"><span data-stu-id="a1367-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="a1367-129">Здравствуйте, только для записи характер *protectedSettings* позволяет использовать его для хранения секретов как ключ учетной записи хранения hello где hello диагностические данные будут записаны.</span><span class="sxs-lookup"><span data-stu-id="a1367-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="a1367-130">Указание учетной записи хранения диагностических данных в качестве параметра</span><span class="sxs-lookup"><span data-stu-id="a1367-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="a1367-131">Hello диагностики расширения json выше фрагменте предполагается два параметра *existingdiagnosticsStorageAccountName* и *existingdiagnosticsStorageResourceGroup* toospecify hello диагностики Учетная запись хранения, где будут храниться данные диагностики.</span><span class="sxs-lookup"><span data-stu-id="a1367-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="a1367-132">Указание учетной записи хранения диагностики hello в параметр делает учетная запись хранения диагностики hello легко toochange различных средах например вы можете toouse учетной записи хранения различных диагностики для тестирования, а другой для вашей развертывание в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="a1367-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="a1367-133">Это лучший подход toospecify учетная запись хранения диагностики в группе ресурсов, отличной от hello группы ресурсов для виртуальной машины hello.</span><span class="sxs-lookup"><span data-stu-id="a1367-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="a1367-134">Группа ресурсов может рассматриваться как toobe домен имеет собственный жизненный цикл развертывания, можно развернуть и повторного развертывания при внесении новых обновлений конфигурации виртуальной машины tooit, но вы можете toocontinue хранение данных диагностики hello в hello учетную запись хранения для развертывания этих виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="a1367-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="a1367-135">Наличие учетной записи хранилища hello в другой ресурс включает hello данные учетной записи хранилища tooaccept из различных развертывания виртуальных машин, что позволяет легко tootroubleshoot проблемы через hello различных версий.</span><span class="sxs-lookup"><span data-stu-id="a1367-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="a1367-136">При создании шаблона виртуальной машины windows из Visual Studio, может быть настроена учетная запись хранения по умолчанию hello toouse hello одной учетной записи хранения, где данные будут загружены hello виртуальный жесткий ДИСК виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="a1367-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="a1367-137">Это toosimplify начальной настройки hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="a1367-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="a1367-138">Следует повторно оценить toouse шаблона hello другую учетную запись хранения, можно передать в качестве параметра.</span><span class="sxs-lookup"><span data-stu-id="a1367-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="a1367-139">Переменные конфигурации диагностики</span><span class="sxs-lookup"><span data-stu-id="a1367-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="a1367-140">Определяет Hello диагностики расширения json выше фрагменте *accountid* переменных toosimplify начало hello ключ учетной записи хранилища для хранения диагностики hello:</span><span class="sxs-lookup"><span data-stu-id="a1367-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="a1367-141">Hello *xmlcfg* для расширения диагностики hello определено несколько переменных, которые соединяются с помощью.</span><span class="sxs-lookup"><span data-stu-id="a1367-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="a1367-142">значения этих переменных Hello возвращаются в формате xml, поэтому они должны toobe escape-знака корректно при задании переменных hello json.</span><span class="sxs-lookup"><span data-stu-id="a1367-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="a1367-143">Hello ниже описаны hello диагностики XML-файл конфигурации, сбор данных счетчиков производительности уровня стандартной системы вместе с некоторыми журналы событий windows и журналы инфраструктуры диагностики.</span><span class="sxs-lookup"><span data-stu-id="a1367-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="a1367-144">Он escape-последовательность и правильный формат, чтобы hello конфигурации, можно напрямую вставить в разделе hello переменных шаблона.</span><span class="sxs-lookup"><span data-stu-id="a1367-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="a1367-145">В разделе hello [схема конфигурации службы диагностики](https://msdn.microsoft.com/library/azure/dn782207.aspx) человеческих пример XML-файл конфигурации hello, доступной для чтения.</span><span class="sxs-lookup"><span data-stu-id="a1367-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="a1367-146">Hello метрики определения XML-узел в hello выше конфигурации — это элемент важные настройки, как он определяет, как счетчики производительности hello, определенные ранее в xml hello в *PerformanceCounter* узла будут собраны и сохраняются.</span><span class="sxs-lookup"><span data-stu-id="a1367-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="a1367-147">Эти метрики диска hello мониторинга диаграммы и оповещений в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="a1367-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="a1367-148">Hello **метрики** узел с hello *resourceID* и **MetricAggregation** должны быть включены в hello конфигурация диагностики для виртуальной Машины, если требуется, чтобы toosee hello виртуальной Машины Наблюдение за данными в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="a1367-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="a1367-149">Hello ниже приведен пример hello xml для определений метрик:</span><span class="sxs-lookup"><span data-stu-id="a1367-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="a1367-150">Hello *resourceID* атрибут однозначно определяет hello виртуальной машины в вашей подписке.</span><span class="sxs-lookup"><span data-stu-id="a1367-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="a1367-151">Убедитесь, что subscription() toouse hello и resourceGroup() функции, чтобы hello шаблон автоматически обновляет эти значения на основе группы ресурса и подписки hello, которые развертываются на.</span><span class="sxs-lookup"><span data-stu-id="a1367-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="a1367-152">Если создается несколько виртуальных машин в цикле, то необходимо будет toopopulate hello *resourceID* значение с toocorrectly функция copyIndex() отличать каждого отдельных виртуальных Машин.</span><span class="sxs-lookup"><span data-stu-id="a1367-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="a1367-153">Hello *xmlCfg* значение может быть обновленные toosupport это следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a1367-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="a1367-154">Здравствуйте, значение MetricAggregation *PT1H* и *PT1M* обозначения агрегирование за минуту и агрегата более часа.</span><span class="sxs-lookup"><span data-stu-id="a1367-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="a1367-155">Таблицы WADMetrics в хранилище</span><span class="sxs-lookup"><span data-stu-id="a1367-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="a1367-156">Hello показатели выше конфигурации будет создать таблицы в учетной записи хранения диагностики с hello соглашениям об именовании:</span><span class="sxs-lookup"><span data-stu-id="a1367-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="a1367-157">**WADMetrics** — стандартный префикс для всех таблиц WADMetrics.</span><span class="sxs-lookup"><span data-stu-id="a1367-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="a1367-158">**PT1H** или **PT1M** : обозначает этой таблицы hello содержит сводные данные более 1 часа или 1 минута</span><span class="sxs-lookup"><span data-stu-id="a1367-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="a1367-159">**P10D** : обозначает hello таблицы будет содержать данные для 10 дней после начала сбора данных таблицы hello</span><span class="sxs-lookup"><span data-stu-id="a1367-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="a1367-160">**V2S** — строковая константа.</span><span class="sxs-lookup"><span data-stu-id="a1367-160">**V2S** : String constant</span></span>
* <span data-ttu-id="a1367-161">**ГГГГММДД** : hello даты, на какие hello таблицы начала сбор данных</span><span class="sxs-lookup"><span data-stu-id="a1367-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="a1367-162">Например, таблица *WADMetricsPT1HP10DV2S20151108* будет содержать данные метрик, агрегированные за час в течение 10 дней, начиная с 11 ноября 2015 года.</span><span class="sxs-lookup"><span data-stu-id="a1367-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="a1367-163">Каждая таблица WADMetrics будет содержать hello следующие столбцы:</span><span class="sxs-lookup"><span data-stu-id="a1367-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="a1367-164">**PartitionKey**: hello partitionkey создается на основании hello *resourceID* toouniquely значение идентификации hello ресурса виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="a1367-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="a1367-165">например: 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="a1367-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="a1367-166">**RowKey** : формат hello следующим <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="a1367-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="a1367-167">Hello по убыванию вычисление такт времени — max для времени тактах минус hello время начала hello периода hello статистической обработки.</span><span class="sxs-lookup"><span data-stu-id="a1367-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="a1367-168">Например: </span><span class="sxs-lookup"><span data-stu-id="a1367-168">E.g.</span></span> <span data-ttu-id="a1367-169">Если период выборки hello запущен на 10 ноября 2015 г. и расчет времени UTC, а затем hello 00:00Hrs будет выглядеть: DateTime.MaxValue.Ticks - (новый DateTime(2015,11,10,0,0,0,DateTimeKind.Utc). Такты).</span><span class="sxs-lookup"><span data-stu-id="a1367-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="a1367-170">Для hello доступно байт памяти производительности, счетчик hello ключ строки будет выглядеть, таких как: 2519551871999999999__:005CMemory:005CAvailable:0020 байт</span><span class="sxs-lookup"><span data-stu-id="a1367-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="a1367-171">**CounterName** : hello имя счетчика производительности "hello".</span><span class="sxs-lookup"><span data-stu-id="a1367-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="a1367-172">Это соответствует hello *counterSpecifier* в файле конфигурации xml hello.</span><span class="sxs-lookup"><span data-stu-id="a1367-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="a1367-173">**Максимальная** : hello максимальное значение счетчика производительности "hello" в течение периода hello статистической обработки.</span><span class="sxs-lookup"><span data-stu-id="a1367-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="a1367-174">**Минимальное** : hello минимальное значение счетчика производительности "hello" в течение периода hello статистической обработки.</span><span class="sxs-lookup"><span data-stu-id="a1367-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="a1367-175">**Общее** : hello сумму всех значений счетчика производительности "hello" сообщил о за период hello статистической обработки.</span><span class="sxs-lookup"><span data-stu-id="a1367-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="a1367-176">**Число** : hello общее количество значений в отчеты для счетчика производительности hello.</span><span class="sxs-lookup"><span data-stu-id="a1367-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="a1367-177">**Среднее** : hello среднее (общий или count) значение счетчика производительности "hello" в течение периода hello статистической обработки.</span><span class="sxs-lookup"><span data-stu-id="a1367-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a1367-178">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="a1367-178">Next Steps</span></span>
* <span data-ttu-id="a1367-179">Полный пример шаблона виртуальной машины Windows с расширением системы диагностики см. в разделе [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension).</span><span class="sxs-lookup"><span data-stu-id="a1367-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="a1367-180">Развертывание с помощью hello resource manager шаблона [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) или [командной строки Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="a1367-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="a1367-181">Узнайте больше о [создании шаблонов диспетчера ресурсов Azure](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="a1367-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

