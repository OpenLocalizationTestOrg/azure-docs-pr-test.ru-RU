---
title: "удаленный рабочий стол aaaDetailed Устранение неполадок в Azure | Документы Microsoft"
description: "Просмотрите сведения об устранении неполадок для удаленного рабочего стола ошибок, где вы не можете tooa виртуальных машинах в Azure"
services: virtual-machines-windows
documentationcenter: 
author: genlin
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
keywords: "не удается подключиться tooremote рабочего стола, устранение неполадок удаленного рабочего стола удаленного рабочего стола не удается подключиться, удаленного рабочего стола устранения неполадок, удаленного рабочего стола ошибок, проблем удаленного рабочего стола"
ms.assetid: 9da36f3d-30dd-44af-824b-8ce5ef07e5e0
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: support-article
ms.date: 07/25/2017
ms.author: genli
ms.openlocfilehash: fcb0d06aa66b748f3ebbbbe3431471d3cbe7c60d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="detailed-troubleshooting-steps-for-remote-desktop-connection-issues-toowindows-vms-in-azure"></a><span data-ttu-id="54155-104">Сведения об устранении неполадок подключения к удаленному рабочему столу выдает tooWindows ВМ в Azure</span><span class="sxs-lookup"><span data-stu-id="54155-104">Detailed troubleshooting steps for remote desktop connection issues tooWindows VMs in Azure</span></span>
<span data-ttu-id="54155-105">Этой статье содержатся сведения об устранении неполадок toodiagnose и исправление ошибок сложных удаленного рабочего стола для Windows Azure виртуальных машин под управлением.</span><span class="sxs-lookup"><span data-stu-id="54155-105">This article provides detailed troubleshooting steps toodiagnose and fix complex Remote Desktop errors for Windows-based Azure virtual machines.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="54155-106">Здравствуйте, наиболее часто встречающихся ошибок удаленного рабочего стола, убедитесь, что tooread tooeliminate [Основные статьи по устранению неполадок hello для удаленного рабочего стола](troubleshoot-rdp-connection.md) перед продолжением.</span><span class="sxs-lookup"><span data-stu-id="54155-106">tooeliminate hello more common Remote Desktop errors, make sure tooread [hello basic troubleshooting article for Remote Desktop](troubleshoot-rdp-connection.md) before proceeding.</span></span>

<span data-ttu-id="54155-107">Удаленный рабочий стол, охваченных сообщение об ошибке, не похож hello специальные сообщения об ошибках могут возникнуть [hello базового удаленного рабочего стола, руководство по устранению неполадок](troubleshoot-rdp-connection.md).</span><span class="sxs-lookup"><span data-stu-id="54155-107">You may encounter a Remote Desktop error message that does not resemble any of hello specific error messages covered in [hello basic Remote Desktop troubleshooting guide](troubleshoot-rdp-connection.md).</span></span> <span data-ttu-id="54155-108">Выполните эти шаги toodetermine, почему hello клиента удаленного рабочего стола (RDP) — служба протокола удаленного рабочего СТОЛА не удается tooconnect toohello на виртуальной Машине Azure hello.</span><span class="sxs-lookup"><span data-stu-id="54155-108">Follow these steps toodetermine why hello Remote Desktop (RDP) client is unable tooconnect toohello RDP service on hello Azure VM.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="54155-109">Если вам нужна дополнительная помощь в любой момент в этой статье, можно обратиться в hello экспертов Azure на [hello MSDN Azure и hello переполнения стека форумы](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="54155-109">If you need more help at any point in this article, you can contact hello Azure experts on [hello MSDN Azure and hello Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="54155-110">Кроме того, можно зарегистрировать обращение в службу поддержки Azure.</span><span class="sxs-lookup"><span data-stu-id="54155-110">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="54155-111">Go toohello [сайте поддержки Azure](https://azure.microsoft.com/support/options/) и нажмите кнопку **Get Support**.</span><span class="sxs-lookup"><span data-stu-id="54155-111">Go toohello [Azure Support site](https://azure.microsoft.com/support/options/) and click **Get Support**.</span></span> <span data-ttu-id="54155-112">Сведения об использовании поддержки Azure см. в статье hello [ответы поддержки Microsoft Azure](https://azure.microsoft.com/support/faq/).</span><span class="sxs-lookup"><span data-stu-id="54155-112">For information about using Azure Support, read hello [Microsoft Azure Support FAQ](https://azure.microsoft.com/support/faq/).</span></span>

## <a name="components-of-a-remote-desktop-connection"></a><span data-ttu-id="54155-113">Компоненты подключения к удаленному рабочему столу</span><span class="sxs-lookup"><span data-stu-id="54155-113">Components of a Remote Desktop connection</span></span>
<span data-ttu-id="54155-114">следующие компоненты Hello участвуют в RDP-подключение.</span><span class="sxs-lookup"><span data-stu-id="54155-114">hello following components are involved in an RDP connection:</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_0.png)

<span data-ttu-id="54155-115">Прежде чем продолжить, будет полезно toomentally проверьте, что были изменены с момента hello последнего успешного удаленного рабочего стола подключения toohello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="54155-115">Before proceeding, it might help toomentally review what has changed since hello last successful Remote Desktop connection toohello VM.</span></span> <span data-ttu-id="54155-116">Например:</span><span class="sxs-lookup"><span data-stu-id="54155-116">For example:</span></span>

* <span data-ttu-id="54155-117">Здравствуйте, общедоступный IP-адрес hello виртуальной Машины или hello облачной службе, содержащей hello виртуальной Машины (также называется hello виртуальный IP-адрес [виртуальных IP-адресов](https://en.wikipedia.org/wiki/Virtual_IP_address)) был изменен.</span><span class="sxs-lookup"><span data-stu-id="54155-117">hello public IP address of hello VM or hello cloud service containing hello VM (also called hello virtual IP address [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) has changed.</span></span> <span data-ttu-id="54155-118">Hello RDP сбоя может быть вызвано DNS кэша клиента по-прежнему содержит hello *старый IP-адрес* зарегистрирован для hello DNS-имени.</span><span class="sxs-lookup"><span data-stu-id="54155-118">hello RDP failure could be because your DNS client cache still has hello *old IP address* registered for hello DNS name.</span></span> <span data-ttu-id="54155-119">Очистить кэш клиента DNS и повторите попытку подключения hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="54155-119">Flush your DNS client cache and try connecting hello VM again.</span></span> <span data-ttu-id="54155-120">Или попробуйте подключиться напрямую с hello новый виртуальный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="54155-120">Or try connecting directly with hello new VIP.</span></span>
* <span data-ttu-id="54155-121">Вместо использования hello соединение, созданное hello портал Azure используют toomanage приложений сторонних разработчиков подключений к удаленному рабочему столу.</span><span class="sxs-lookup"><span data-stu-id="54155-121">You are using a third-party application toomanage your Remote Desktop connections instead of using hello connection generated by hello Azure portal.</span></span> <span data-ttu-id="54155-122">Убедитесь, что в этой конфигурации приложения hello включает hello правильный TCP-порт для трафика удаленного рабочего стола hello.</span><span class="sxs-lookup"><span data-stu-id="54155-122">Verify that hello application configuration includes hello correct TCP port for hello Remote Desktop traffic.</span></span> <span data-ttu-id="54155-123">Вы можете проверить этот порт для классической виртуальной машины в hello [портал Azure](https://portal.azure.com), щелкнув параметры виртуальной Машины hello > конечные точки.</span><span class="sxs-lookup"><span data-stu-id="54155-123">You can check this port for a classic virtual machine in hello [Azure portal](https://portal.azure.com), by clicking hello VM's Settings > Endpoints.</span></span>

## <a name="preliminary-steps"></a><span data-ttu-id="54155-124">Предварительные действия</span><span class="sxs-lookup"><span data-stu-id="54155-124">Preliminary steps</span></span>
<span data-ttu-id="54155-125">Прежде чем продолжить toohello подробные сведения об устранении,</span><span class="sxs-lookup"><span data-stu-id="54155-125">Before proceeding toohello detailed troubleshooting,</span></span>

* <span data-ttu-id="54155-126">Проверьте состояние виртуальной машины hello в hello портала Azure по вопросам очевидным hello.</span><span class="sxs-lookup"><span data-stu-id="54155-126">Check hello status of hello virtual machine in hello Azure portal for any obvious issues.</span></span>
* <span data-ttu-id="54155-127">Выполните hello [быстрого исправления для типичных ошибок протокола удаленного рабочего СТОЛА в hello устранение основных неполадок представлены инструкции](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span><span class="sxs-lookup"><span data-stu-id="54155-127">Follow hello [quick fix steps for common RDP errors in hello basic troubleshooting guide](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span></span>

<span data-ttu-id="54155-128">Выполните повторное подключение toohello виртуальной Машине через удаленный рабочий стол после выполнения этих шагов.</span><span class="sxs-lookup"><span data-stu-id="54155-128">Try reconnecting toohello VM via Remote Desktop after these steps.</span></span>

## <a name="detailed-troubleshooting-steps"></a><span data-ttu-id="54155-129">Подробное описание устранения неполадок</span><span class="sxs-lookup"><span data-stu-id="54155-129">Detailed troubleshooting steps</span></span>
<span data-ttu-id="54155-130">Клиент удаленного рабочего стола Hello не может быть службы удаленного рабочего стола hello может tooreach на виртуальной Машине Azure hello из-за tooissues на hello следующие источники:</span><span class="sxs-lookup"><span data-stu-id="54155-130">hello Remote Desktop client may not be able tooreach hello Remote Desktop service on hello Azure VM due tooissues at hello following sources:</span></span>

* [<span data-ttu-id="54155-131">Компьютер с клиентом удаленного рабочего стола</span><span class="sxs-lookup"><span data-stu-id="54155-131">Remote Desktop client computer</span></span>](#source-1-remote-desktop-client-computer)
* [<span data-ttu-id="54155-132">Пограничное устройство интрасети организации</span><span class="sxs-lookup"><span data-stu-id="54155-132">Organization intranet edge device</span></span>](#source-2-organization-intranet-edge-device)
* [<span data-ttu-id="54155-133">Конечная точка облачной службы и список управления доступом (ACL)</span><span class="sxs-lookup"><span data-stu-id="54155-133">Cloud service endpoint and access control list (ACL)</span></span>](#source-3-cloud-service-endpoint-and-acl)
* [<span data-ttu-id="54155-134">Группы безопасности сети</span><span class="sxs-lookup"><span data-stu-id="54155-134">Network security groups</span></span>](#source-4-network-security-groups)
* [<span data-ttu-id="54155-135">Виртуальная машина Azure под управлением Windows</span><span class="sxs-lookup"><span data-stu-id="54155-135">Windows-based Azure VM</span></span>](#source-5-windows-based-azure-vm)

## <a name="source-1-remote-desktop-client-computer"></a><span data-ttu-id="54155-136">Источник 1: компьютер с клиентом удаленного рабочего стола</span><span class="sxs-lookup"><span data-stu-id="54155-136">Source 1: Remote Desktop client computer</span></span>
<span data-ttu-id="54155-137">Убедитесь, что ваш компьютер может предоставить удаленного рабочего стола подключений tooanother локально, компьютер под управлением Windows.</span><span class="sxs-lookup"><span data-stu-id="54155-137">Verify that your computer can make Remote Desktop connections tooanother on-premises, Windows-based computer.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_1.png)

<span data-ttu-id="54155-138">Если это невозможно, проверьте следующие параметры на компьютере hello.</span><span class="sxs-lookup"><span data-stu-id="54155-138">If you cannot, check for hello following settings on your computer:</span></span>

* <span data-ttu-id="54155-139">Настройки локального брандмауэра, которые могут блокировать обмен данными с удаленным рабочим столом.</span><span class="sxs-lookup"><span data-stu-id="54155-139">A local firewall setting that is blocking Remote Desktop traffic.</span></span>
* <span data-ttu-id="54155-140">Наличие локального программного обеспечения с функциями прокси-сервера, которое не позволяет установить подключение к удаленному рабочему столу.</span><span class="sxs-lookup"><span data-stu-id="54155-140">Locally installed client proxy software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="54155-141">Наличие локального программного обеспечения для мониторинга сети, которое не позволяет установить подключение к удаленному рабочему столу.</span><span class="sxs-lookup"><span data-stu-id="54155-141">Locally installed network monitoring software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="54155-142">Наличие других программ для обеспечения безопасности, которые ведут мониторинг трафика либо разрешают и запрещают трафик определенных типов, поэтому могут блокировать подключение к удаленному рабочему столу.</span><span class="sxs-lookup"><span data-stu-id="54155-142">Other types of security software that either monitor traffic or allow/disallow specific types of traffic that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="54155-143">Во всех этих случаях временно отключить hello программное обеспечение и попробуйте tooconnect tooan на локальном компьютере через удаленный рабочий стол.</span><span class="sxs-lookup"><span data-stu-id="54155-143">In all these cases, temporarily disable hello software and try tooconnect tooan on-premises computer via Remote Desktop.</span></span> <span data-ttu-id="54155-144">Если вы можете найти действительную причину hello таким образом, работаете с вашей сетевой администратор toocorrect hello программного обеспечения параметры tooallow подключений удаленного рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="54155-144">If you can find out hello actual cause this way, work with your network administrator toocorrect hello software settings tooallow Remote Desktop connections.</span></span>

## <a name="source-2-organization-intranet-edge-device"></a><span data-ttu-id="54155-145">Источник 2: пограничное устройство интрасети организации</span><span class="sxs-lookup"><span data-stu-id="54155-145">Source 2: Organization intranet edge device</span></span>
<span data-ttu-id="54155-146">Убедитесь, что компьютер подключен напрямую toohello Интернет освободить tooyour подключения удаленного рабочего стола виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="54155-146">Verify that a computer directly connected toohello Internet can make Remote Desktop connections tooyour Azure virtual machine.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_2.png)

<span data-ttu-id="54155-147">Если у вас компьютер, который подключен напрямую toohello Интернет, создайте и протестируйте с новой виртуальной машины Azure в ресурс группы или облачной службы.</span><span class="sxs-lookup"><span data-stu-id="54155-147">If you do not have a computer that is directly connected toohello Internet, create and test with a new Azure virtual machine in a resource group or cloud service.</span></span> <span data-ttu-id="54155-148">Дополнительные сведения см. в статье [Создание виртуальной машины Windows в среде Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="54155-148">For more information, see [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="54155-149">Hello виртуальной машины и группы ресурсов hello или hello облачной службы, можно удалить после тестирования hello.</span><span class="sxs-lookup"><span data-stu-id="54155-149">You can delete hello virtual machine and hello resource group or hello cloud service, after hello test.</span></span>

<span data-ttu-id="54155-150">Если можно создать подключения удаленного рабочего стола с компьютером, присоединенные непосредственно toohello Интернет, проверьте устройство пограничного интрасети организации для:</span><span class="sxs-lookup"><span data-stu-id="54155-150">If you can create a Remote Desktop connection with a computer directly attached toohello Internet, check your organization intranet edge device for:</span></span>

* <span data-ttu-id="54155-151">Внутренняя брандмауэр, блокирует toohello HTTPS подключения к Интернету.</span><span class="sxs-lookup"><span data-stu-id="54155-151">An internal firewall blocking HTTPS connections toohello Internet.</span></span>
* <span data-ttu-id="54155-152">прокси-сервера, который не позволяет установить подключение к удаленному рабочему столу;</span><span class="sxs-lookup"><span data-stu-id="54155-152">A proxy server preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="54155-153">программного обеспечения для обнаружения атак и мониторинга сети, которое работает на устройствах в вашей сети периметра и блокирует подключения к удаленным рабочим столам.</span><span class="sxs-lookup"><span data-stu-id="54155-153">Intrusion detection or network monitoring software running on devices in your edge network that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="54155-154">Работать с параметры сети toocorrect администратора hello вашей организации интрасети пограничного устройства tooallow удаленного рабочего стола на основе HTTPS соединений toohello Интернета.</span><span class="sxs-lookup"><span data-stu-id="54155-154">Work with your network administrator toocorrect hello settings of your organization intranet edge device tooallow HTTPS-based Remote Desktop connections toohello Internet.</span></span>

## <a name="source-3-cloud-service-endpoint-and-acl"></a><span data-ttu-id="54155-155">Источник 3: конечная точка облачной службы и список управления доступом (ACL)</span><span class="sxs-lookup"><span data-stu-id="54155-155">Source 3: Cloud service endpoint and ACL</span></span>
<span data-ttu-id="54155-156">Виртуальные машины, созданные с помощью hello классической модели развертывания, убедитесь, что другой виртуальной Машиной Azure, в hello же облачной службе или виртуальной сети можно сделать tooyour подключения удаленного рабочего стола виртуальной Машины Azure.</span><span class="sxs-lookup"><span data-stu-id="54155-156">For VMs created using hello Classic deployment model, verify that another Azure VM that is in hello same cloud service or virtual network can make Remote Desktop connections tooyour Azure VM.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_3.png)

> [!NOTE]
> <span data-ttu-id="54155-157">Для виртуальных машин, созданных в диспетчере ресурсов, пропустить слишком[источника 4: группы безопасности сети](#source-4-network-security-groups).</span><span class="sxs-lookup"><span data-stu-id="54155-157">For virtual machines created in Resource Manager, skip too[Source 4: Network Security Groups](#source-4-network-security-groups).</span></span>

<span data-ttu-id="54155-158">Если у вас другой виртуальной машины в Здравствуйте одной облачной службе или виртуальной сети, создайте его.</span><span class="sxs-lookup"><span data-stu-id="54155-158">If you do not have another virtual machine in hello same cloud service or virtual network, create one.</span></span> <span data-ttu-id="54155-159">Следуйте указаниям hello [создать виртуальную машину под управлением Windows в Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="54155-159">Follow hello steps in [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="54155-160">Удалите hello тестовой виртуальной машины после завершения теста hello.</span><span class="sxs-lookup"><span data-stu-id="54155-160">Delete hello test virtual machine after hello test is completed.</span></span>

<span data-ttu-id="54155-161">При подключении через удаленный рабочий стол tooa виртуальной машины в hello же облачной службе или виртуальной сети, проверьте следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="54155-161">If you can connect via Remote Desktop tooa virtual machine in hello same cloud service or virtual network, check for these settings:</span></span>

* <span data-ttu-id="54155-162">Hello конфигурации конечной точки для трафика удаленного рабочего стола на целевом сервере hello виртуальной Машины: hello частный порт TCP hello конечной точки должно соответствовать какие hello службы удаленного рабочего стола Виртуальной машины прослушивает порт TCP hello (по умолчанию — 3389).</span><span class="sxs-lookup"><span data-stu-id="54155-162">hello endpoint configuration for Remote Desktop traffic on hello target VM: hello private TCP port of hello endpoint must match hello TCP port on which hello VM's Remote Desktop service is listening (default is 3389).</span></span>
* <span data-ttu-id="54155-163">Hello ACL для конечной точки трафика hello удаленного рабочего стола на целевом сервере hello виртуальной Машины: списки управления доступом позволяют toospecify разрешает или запрещает входящий трафик от hello Интернет IP-адреса источника.</span><span class="sxs-lookup"><span data-stu-id="54155-163">hello ACL for hello Remote Desktop traffic endpoint on hello target VM: ACLs allow you toospecify allowed or denied incoming traffic from hello Internet based on its source IP address.</span></span> <span data-ttu-id="54155-164">Неправильно настроенные ACL можно предотвратить входящих конечной точки toohello трафика удаленного рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="54155-164">Misconfigured ACLs can prevent incoming Remote Desktop traffic toohello endpoint.</span></span> <span data-ttu-id="54155-165">Проверьте вашей tooensure списки управления доступом разрешен входящий трафик от общих IP-адреса прокси-сервера или других пограничный сервер.</span><span class="sxs-lookup"><span data-stu-id="54155-165">Check your ACLs tooensure that incoming traffic from your public IP addresses of your proxy or other edge server is allowed.</span></span> <span data-ttu-id="54155-166">Дополнительные сведения см. в статье [Список управления доступом (ACL) конечной точки](../../virtual-network/virtual-networks-acl.md).</span><span class="sxs-lookup"><span data-stu-id="54155-166">For more information, see [What is a Network Access Control List (ACL)?](../../virtual-network/virtual-networks-acl.md)</span></span>

<span data-ttu-id="54155-167">Если конечная точка hello hello источник проблемы hello, toocheck удалить hello текущей конечной точки и создайте новую, выбрав случайный порт в диапазон hello 49152 – 65535 для внешнего порта hello.</span><span class="sxs-lookup"><span data-stu-id="54155-167">toocheck if hello endpoint is hello source of hello problem, remove hello current endpoint and create a new one, choosing a random port in hello range 49152–65535 for hello external port number.</span></span> <span data-ttu-id="54155-168">Дополнительные сведения см. в разделе [как tooset конечные точки tooa виртуальной машины](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="54155-168">For more information, see [How tooset up endpoints tooa virtual machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

## <a name="source-4-network-security-groups"></a><span data-ttu-id="54155-169">Источник 4: группы безопасности сети</span><span class="sxs-lookup"><span data-stu-id="54155-169">Source 4: Network Security Groups</span></span>
<span data-ttu-id="54155-170">Группы безопасности сети позволяют точнее настраивать параметры разрешенного входящего и исходящего трафика.</span><span class="sxs-lookup"><span data-stu-id="54155-170">Network Security Groups allow more granular control of allowed inbound and outbound traffic.</span></span> <span data-ttu-id="54155-171">Можно создавать правила, которые распространяются на подсети и облачные службы в виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="54155-171">You can create rules spanning subnets and cloud services in an Azure virtual network.</span></span>

<span data-ttu-id="54155-172">Используйте [проверить поток IP](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm, если правила в группе безопасности сети блокирует tooor трафик от виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="54155-172">Use [IP flow verify](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm if a rule in a Network Security Group is blocking traffic tooor from a virtual machine.</span></span> <span data-ttu-id="54155-173">Можно также просмотреть действующие безопасности группы, которую правила входящих подключений tooensure NSG «разрешить» правило существует и приоритет для порта протокола удаленного рабочего СТОЛА (по умолчанию 3389).</span><span class="sxs-lookup"><span data-stu-id="54155-173">You can also review effective security group rules tooensure inbound "Allow" NSG rule exists and is prioritized for RDP port(default 3389).</span></span> <span data-ttu-id="54155-174">Дополнительные сведения см. в разделе [поток трафика с помощью действующие правила безопасности tootroubleshoot виртуальной Машины](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span><span class="sxs-lookup"><span data-stu-id="54155-174">For more information, see [Using Effective Security Rules tootroubleshoot VM traffic flow](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span></span>

## <a name="source-5-windows-based-azure-vm"></a><span data-ttu-id="54155-175">Источник 5: виртуальная машина Azure под управлением Windows</span><span class="sxs-lookup"><span data-stu-id="54155-175">Source 5: Windows-based Azure VM</span></span>
![](./media/detailed-troubleshoot-rdp/tshootrdp_5.png)

<span data-ttu-id="54155-176">Следуйте инструкциям в разделе hello [в этой статье](reset-rdp.md).</span><span class="sxs-lookup"><span data-stu-id="54155-176">Follow hello instructions in [this article](reset-rdp.md).</span></span> <span data-ttu-id="54155-177">В этой статье сбрасывает hello службы удаленного рабочего стола на виртуальной машине hello:</span><span class="sxs-lookup"><span data-stu-id="54155-177">This article resets hello Remote Desktop service on hello virtual machine:</span></span>

* <span data-ttu-id="54155-178">Включите hello «Удаленный рабочий стол» правило брандмауэра Windows по умолчанию (порт TCP 3389).</span><span class="sxs-lookup"><span data-stu-id="54155-178">Enable hello "Remote Desktop" Windows Firewall default rule (TCP port 3389).</span></span>
* <span data-ttu-id="54155-179">Включите подключения удаленного рабочего стола, задав too0 значение реестра HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections hello.</span><span class="sxs-lookup"><span data-stu-id="54155-179">Enable Remote Desktop connections by setting hello HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registry value too0.</span></span>

<span data-ttu-id="54155-180">Попробуйте hello с компьютера попытку подключения.</span><span class="sxs-lookup"><span data-stu-id="54155-180">Try hello connection from your computer again.</span></span> <span data-ttu-id="54155-181">Если вы по-прежнему не удается tooconnect через удаленный рабочий стол, проверьте следующие возможные проблемы hello:</span><span class="sxs-lookup"><span data-stu-id="54155-181">If you are still not able tooconnect via Remote Desktop, check for hello following possible problems:</span></span>

* <span data-ttu-id="54155-182">Hello службы удаленного рабочего стола не запущена на целевом сервере hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="54155-182">hello Remote Desktop service is not running on hello target VM.</span></span>
* <span data-ttu-id="54155-183">Hello службы удаленного рабочего стола не прослушивает TCP-порт 3389.</span><span class="sxs-lookup"><span data-stu-id="54155-183">hello Remote Desktop service is not listening on TCP port 3389.</span></span>
* <span data-ttu-id="54155-184">В брандмауэре Windows или другом локальном брандмауэре есть правило для исходящего трафика, блокирующее трафик удаленных рабочих столов.</span><span class="sxs-lookup"><span data-stu-id="54155-184">Windows Firewall or another local firewall has an outbound rule that is preventing Remote Desktop traffic.</span></span>
* <span data-ttu-id="54155-185">Обнаружение вторжений или сетевого мониторинга программного обеспечения на виртуальной машине Azure hello препятствует подключений удаленного рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="54155-185">Intrusion detection or network monitoring software running on hello Azure virtual machine is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="54155-186">Для виртуальных машин, созданных с помощью hello классической модели развертывания можно использовать удаленный toohello сеанс Azure PowerShell виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="54155-186">For VMs created using hello classic deployment model, you can use a remote Azure PowerShell session toohello Azure virtual machine.</span></span> <span data-ttu-id="54155-187">Во-первых необходимо tooinstall сертификат для размещения облачной службы hello виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="54155-187">First, you need tooinstall a certificate for hello virtual machine's hosting cloud service.</span></span> <span data-ttu-id="54155-188">Go слишком[tooAzure Настройка безопасного удаленного PowerShell доступа виртуальных машин](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) и загрузите hello **InstallWinRMCertAzureVM.ps1** сценария файла tooyour локального компьютера.</span><span class="sxs-lookup"><span data-stu-id="54155-188">Go too[Configure Secure Remote PowerShell Access tooAzure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) and download hello **InstallWinRMCertAzureVM.ps1** script file tooyour local computer.</span></span>

<span data-ttu-id="54155-189">Затем установите Azure PowerShell, если еще не сделали этого.</span><span class="sxs-lookup"><span data-stu-id="54155-189">Next, install Azure PowerShell if you haven't already.</span></span> <span data-ttu-id="54155-190">В разделе [как tooinstall и настройка Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="54155-190">See [How tooinstall and configure Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="54155-191">Далее откройте командную строку Azure PowerShell и измените текущее расположение toohello папки hello объекта hello **InstallWinRMCertAzureVM.ps1** файла скрипта.</span><span class="sxs-lookup"><span data-stu-id="54155-191">Next, open an Azure PowerShell command prompt and change hello current folder toohello location of hello **InstallWinRMCertAzureVM.ps1** script file.</span></span> <span data-ttu-id="54155-192">toorun сценария Azure PowerShell, необходимо задать правильное выполнение политики hello.</span><span class="sxs-lookup"><span data-stu-id="54155-192">toorun an Azure PowerShell script, you must set hello correct execution policy.</span></span> <span data-ttu-id="54155-193">Запустите hello **Get-ExecutionPolicy** команды toodetermine текущий уровень политики.</span><span class="sxs-lookup"><span data-stu-id="54155-193">Run hello **Get-ExecutionPolicy** command toodetermine your current policy level.</span></span> <span data-ttu-id="54155-194">Сведения о настройке соответствующий уровень hello. в разделе [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span><span class="sxs-lookup"><span data-stu-id="54155-194">For information about setting hello appropriate level, see [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span></span>

<span data-ttu-id="54155-195">Затем заполните имя подписки Azure, hello имя облачной службы и имя виртуальной машины (удаляя hello < и > символов) и затем выполните следующие команды.</span><span class="sxs-lookup"><span data-stu-id="54155-195">Next, fill in your Azure subscription name, hello cloud service name, and your virtual machine name (removing hello < and > characters), and then run these commands.</span></span>

```powershell
$subscr="<Name of your Azure subscription>"
$serviceName="<Name of hello cloud service that contains hello target virtual machine>"
$vmName="<Name of hello target virtual machine>"
.\InstallWinRMCertAzureVM.ps1 -SubscriptionName $subscr -ServiceName $serviceName -Name $vmName
```

<span data-ttu-id="54155-196">Hello правильное имя подписки можно получить из hello *Имя_подписки* свойство отображения hello hello **Get-AzureSubscription** команды.</span><span class="sxs-lookup"><span data-stu-id="54155-196">You can get hello correct subscription name from hello *SubscriptionName* property of hello display of hello **Get-AzureSubscription** command.</span></span> <span data-ttu-id="54155-197">Можно получить имя hello облачной службы для виртуальной машины hello hello *ServiceName* столбец в вывод hello hello **Get-AzureVM** команды.</span><span class="sxs-lookup"><span data-stu-id="54155-197">You can get hello cloud service name for hello virtual machine from hello *ServiceName* column in hello display of hello **Get-AzureVM** command.</span></span>

<span data-ttu-id="54155-198">Проверьте наличие нового сертификата hello.</span><span class="sxs-lookup"><span data-stu-id="54155-198">Check if you have hello new certificate.</span></span> <span data-ttu-id="54155-199">Откройте оснастку сертификатов для текущего пользователя hello и найдите в hello **доверенного корневого Certification Authorities\Certificates** папки.</span><span class="sxs-lookup"><span data-stu-id="54155-199">Open a Certificates snap-in for hello current user and look in hello **Trusted Root Certification Authorities\Certificates** folder.</span></span> <span data-ttu-id="54155-200">Вы увидите сертификат с DNS-имя облачной службы в hello toocolumn Кому выдан hello (пример: cloudservice4testing.cloudapp.net).</span><span class="sxs-lookup"><span data-stu-id="54155-200">You should see a certificate with hello DNS name of your cloud service in hello Issued toocolumn (example: cloudservice4testing.cloudapp.net).</span></span>

<span data-ttu-id="54155-201">Затем инициируйте удаленный сеанс Azure PowerShell с помощью следующих команд.</span><span class="sxs-lookup"><span data-stu-id="54155-201">Next, initiate a remote Azure PowerShell session by using these commands.</span></span>

```powershell
$uri = Get-AzureWinRMUri -ServiceName $serviceName -Name $vmName
$creds = Get-Credential
Enter-PSSession -ConnectionUri $uri -Credential $creds
```

<span data-ttu-id="54155-202">После ввода действительные учетные данные администратора, вы увидите, что-нибудь подобное toohello следующие командной строке Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="54155-202">After entering valid administrator credentials, you should see something similar toohello following Azure PowerShell prompt:</span></span>

```powershell
[cloudservice4testing.cloudapp.net]: PS C:\Users\User1\Documents>
```

<span data-ttu-id="54155-203">Первая часть Hello этот запрос является имя облачной службы, содержащий hello целевой виртуальной Машины, которая может отличаться от «cloudservice4testing.cloudapp.net».</span><span class="sxs-lookup"><span data-stu-id="54155-203">hello first part of this prompt is your cloud service name that contains hello target VM, which could be different from "cloudservice4testing.cloudapp.net".</span></span> <span data-ttu-id="54155-204">Теперь можно команд Azure PowerShell для этого облака вышеперечисленных неполадок hello tooinvestigate службы и исправьте конфигурацию hello.</span><span class="sxs-lookup"><span data-stu-id="54155-204">You can now issue Azure PowerShell commands for this cloud service tooinvestigate hello problems mentioned and correct hello configuration.</span></span>

### <a name="toomanually-correct-hello-remote-desktop-services-listening-tcp-port"></a><span data-ttu-id="54155-205">правильный hello toomanually прослушивания TCP-порт служб удаленных рабочих столов</span><span class="sxs-lookup"><span data-stu-id="54155-205">toomanually correct hello Remote Desktop Services listening TCP port</span></span>
<span data-ttu-id="54155-206">Hello удаленного сеанса строке Azure PowerShell выполните следующую команду.</span><span class="sxs-lookup"><span data-stu-id="54155-206">At hello remote Azure PowerShell session prompt, run this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="54155-207">Свойство PortNumber Hello показывает hello текущий номер порта.</span><span class="sxs-lookup"><span data-stu-id="54155-207">hello PortNumber property shows hello current port number.</span></span> <span data-ttu-id="54155-208">При необходимости измените hello удаленного рабочего стола номеров tooits назад по умолчанию значение порта (3389) с помощью этой команды.</span><span class="sxs-lookup"><span data-stu-id="54155-208">If needed, change hello Remote Desktop port number back tooits default value (3389) by using this command.</span></span>

```powershell
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber" -Value 3389
```

<span data-ttu-id="54155-209">Убедиться в устранении hello порт too3389 измененные с помощью этой команды.</span><span class="sxs-lookup"><span data-stu-id="54155-209">Verify that hello port has been changed too3389 by using this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="54155-210">Выйдите из hello удаленный сеанс Azure PowerShell с помощью этой команды.</span><span class="sxs-lookup"><span data-stu-id="54155-210">Exit hello remote Azure PowerShell session by using this command.</span></span>

```powershell
Exit-PSSession
```

<span data-ttu-id="54155-211">Убедитесь, что этой конечной точки удаленного рабочего стола для виртуальной Машины Azure hello hello также использует TCP-порт 3398 как свой внутренний порт.</span><span class="sxs-lookup"><span data-stu-id="54155-211">Verify that hello Remote Desktop endpoint for hello Azure VM is also using TCP port 3398 as its internal port.</span></span> <span data-ttu-id="54155-212">Перезапустите hello Azure VM и повторите попытку подключения удаленного рабочего стола hello.</span><span class="sxs-lookup"><span data-stu-id="54155-212">Restart hello Azure VM and try hello Remote Desktop connection again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="54155-213">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="54155-213">Additional resources</span></span>
[<span data-ttu-id="54155-214">Как службы tooreset пароль или hello удаленного рабочего стола для виртуальных машин Windows</span><span class="sxs-lookup"><span data-stu-id="54155-214">How tooreset a password or hello Remote Desktop service for Windows virtual machines</span></span>](reset-rdp.md)

[<span data-ttu-id="54155-215">Как tooinstall и настройка Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="54155-215">How tooinstall and configure Azure PowerShell</span></span>](/powershell/azure/overview)

[<span data-ttu-id="54155-216">Устранение неполадок Secure Shell (SSH) подключения tooa под управлением Linux Azure виртуальные машины</span><span class="sxs-lookup"><span data-stu-id="54155-216">Troubleshoot Secure Shell (SSH) connections tooa Linux-based Azure virtual machine</span></span>](../linux/troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[<span data-ttu-id="54155-217">Устранение неполадок доступа tooan приложение, работающее на виртуальной машине Azure</span><span class="sxs-lookup"><span data-stu-id="54155-217">Troubleshoot access tooan application running on an Azure virtual machine</span></span>](../linux/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

