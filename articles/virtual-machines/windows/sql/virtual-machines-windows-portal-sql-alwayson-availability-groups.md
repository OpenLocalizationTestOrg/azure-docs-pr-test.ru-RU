---
title: "aaaSet высокого уровня доступности для виртуальных машин диспетчера ресурсов Azure | Документы Microsoft"
description: "Этот учебник показывает, как группы доступности Always On toocreate с виртуальными машинами Azure в режим диспетчера ресурсов Azure."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-resource-manager
ms.assetid: 64e85527-d5c8-40d9-bbe2-13045d25fc68
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/17/2017
ms.author: mikeray
ms.openlocfilehash: 6f0a253d3502259a487e66fd62d92e41c379a6b5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="configure-always-on-availability-groups-in-azure-virtual-machines-automatically-resource-manager"></a>Автоматическая настройка групп доступности AlwaysOn на виртуальных машинах Azure с использованием Resource Manager

Этот учебник показывает, как toocreate доступности SQL Server группы, использующий виртуальные машины Azure Resource Manager. Hello учебнике используется Azure колонках tooconfigure шаблона. Просмотрите параметры по умолчанию hello, введите необходимые параметры и обновление hello колонок в портале hello по мере изучения этого руководства.

весь учебник Hello создает группу доступности SQL Server на виртуальных машинах Azure, включающие hello следующие элементы:

* виртуальная сеть с несколькими подсетями, в том числе для интерфейса и внутренних серверов;
* два контроллера домена, поддерживающих домен Active Directory (AD);
* Две виртуальные машины, на которых выполняется SQL Server и toohello развернутой серверной подсети и присоединены к домену toohello домена Active Directory
* Трех узлов отказоустойчивого кластера с моделью кворума большинства узлов hello
* группа доступности с двумя репликами базы данных доступности с синхронной фиксацией.

Привет, Следующая иллюстрация представляет комплексное решение hello.

![Тестовая архитектура для групп доступности в Azure](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/0-EndstateSample.png)

Все ресурсы в этом решении входить tooa единой группы ресурсов.

Перед началом этого учебника подтверждение hello следующее:

* У вас уже есть учетная запись Azure. Если у вас ее нет, [зарегистрируйтесь, чтобы воспользоваться пробной учетной записью](http://azure.microsoft.com/pricing/free-trial/).
* Вы уже знаете, как toouse hello tooprovision графического пользовательского интерфейса SQL Server виртуальной машины из коллекции виртуальных машин hello. Дополнительные сведения см. в разделе [Подготовка виртуальной машины SQL Server на портале Azure](virtual-machines-windows-portal-sql-server-provision.md).
* Теперь вы хорошо понимаете принцип работы групп доступности. Дополнительные сведения см. в разделе [Группы доступности AlwaysOn (SQL Server)](http://msdn.microsoft.com/library/hh510230.aspx).

> [!NOTE]
> Если вы планируете использовать группы доступности с SharePoint, ознакомьтесь со статьей [Configure SQL Server 2012 Always On availability groups for SharePoint 2013](http://technet.microsoft.com/library/jj715261.aspx)(Настройка групп доступности AlwaysOn SQL Server 2012 для SharePoint 2013).
>
>

В этом учебнике используется hello Azure портала для:

* Шаблон hello Always On с портала hello.
* Просмотрите параметры шаблона hello и обновить несколько параметров конфигурации для вашей среды.
* Он создает всей среды hello наблюдать за Azure.
* Подключите tooa контроллера домена, а затем tooa сервер, на котором выполняется SQL Server.

[!INCLUDE [availability-group-template](../../../../includes/virtual-machines-windows-portal-sql-alwayson-ag-template.md)]

## <a name="provision-hello-cluster-from-hello-gallery"></a>Подготовка кластера hello из галереи hello
Azure предоставляет коллекции образов для всего решения hello. шаблон hello toolocate:

1. Войдите в toohello портал Azure с помощью учетной записи.
2. В hello портал Azure, щелкните **+ создать** tooopen hello **New** колонку.
3. На hello **New** колонки, поиск **AlwaysOn**.
   ![Поиск шаблона AlwaysOn](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/16-findalwayson.png)
4. В результатах поиска hello, найдите **кластера SQL Server AlwaysOn**.
   ![Шаблон AlwaysOn](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/17-alwaysontemplate.png)
5. В разделе **Выберите модель развертывания** щелкните **Resource Manager**.

### <a name="basics"></a>Основы
Нажмите кнопку **основы** и настройте следующие параметры hello:

* **Имя пользователя администратора** учетной записи пользователя, которая имеет права администратора домена и является членом фиксированной серверной роли sysadmin hello SQL Server на обоих экземплярах SQL Server. В этом руководстве мы будем использовать имя **DomainAdmin**.
* **Пароль** hello пароль для учетной записи администратора домена hello. Следует использовать сложный пароль. Подтверждение пароля hello.
* **Подписки** подписка hello, Azure выставляет счет за ресурсы toorun развертывания для группы доступности hello. Если в вашей учетной записи есть несколько подписок, можно указать любую из них.
* **Группа ресурсов** является именем hello для toowhich группы hello принадлежат все ресурсы Azure, созданные с помощью этого шаблона. В этом руководстве мы будем использовать имя **SQL-HA-RG**. Дополнительные сведения см. в [обзоре Azure Resource Manager](../../../azure-resource-manager/resource-group-overview.md#resource-groups).
* **Расположение** регион Azure, где hello учебник создает ресурсы hello "hello". Выберите регион Azure.

Hello следующий снимок экрана является завершенной **основы** колонки:

![Основы](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/1-basics.png)

Нажмите кнопку **ОК**.

### <a name="domain-and-network-settings"></a>Параметры домена и сети
Этот шаблон из коллекции Azure создает домен и контроллеры домена. Он также создает сеть c двумя подсетями. шаблон Hello не удается создать серверы в существующем домене или виртуальной сети. Следующий шаг Hello настраивает hello параметры домена и сети.

На hello **параметры домена и сети** колонки, просмотрите hello предварительно заданных значений для параметров hello домена и сети:

* **Имя корневого домена леса** — hello доменное имя для домена Active Directory hello hello узлов кластера. В учебнике hello использовать **contoso.com**.
* **Имя виртуальной сети** hello сетевое имя для hello виртуальной сети Azure. В учебнике hello использовать **autohaVNET**.
* **Имя подсети контроллера домена** является именем hello части hello виртуальной сети контроллера домена hello узлов. Используйте **subnet-1**. Эта подсеть использует префикс адреса **10.0.0.0/24**.
* **Имя подсети SQL Server** является именем hello части hello виртуальной сети, что серверы hello узлов под управлением SQL Server и файла hello ресурс-свидетель. Используйте **subnet-2**. Эта подсеть использует префикс адреса **10.0.1.0/26**.

toolearn Дополнительные сведения о виртуальных сетей в Azure, в разделе [Обзор виртуальной сети](../../../virtual-network/virtual-networks-overview.md).  

Hello **параметры домена и сети** должен выглядят hello следующий снимок экрана:

![Параметры домена и сети](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/2-domain.png)

При необходимости эти значения можно изменить. В этом учебнике использовать hello предварительно заданных значений.

Просмотрите параметры hello и нажмите кнопку **ОК**.

### <a name="availability-group-settings"></a>Параметры группы доступности
На **настройки группы доступности**, просмотрите hello предварительно заданных значений для группы доступности hello и hello прослушивателя.

* **Имя группы доступности** является имя hello кластерный ресурс группы доступности hello. Мы будем использовать имя **Contoso-ag**.
* **Имя прослушивателя группы доступности** используется кластер hello и hello внутренней подсистемы балансировки нагрузки. Клиенты, подключающиеся tooSQL сервера можно использовать это имя tooconnect toohello соответствующую реплику hello базы данных. Мы будем использовать имя **Contoso-listener**.
* **Порт прослушивателя группы доступности** указывает TCP-порт hello hello прослушивателя SQL Server. В этом учебнике используется порт по умолчанию hello, **1433**.

При необходимости эти значения можно изменить. В этом учебнике использовать hello предварительно заданных значений.  

![Параметры группы доступности](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/3-availabilitygroup.png)

Нажмите кнопку **ОК**.

### <a name="virtual-machine-size-storage-settings"></a>Размер виртуальной машины и параметры хранилища
На **размер виртуальной Машины, параметры хранения**, выберите размер виртуальной машины SQL Server и просмотрите hello другие параметры.

* **Размер виртуальной машины SQL Server** hello размер для виртуальных машин под управлением SQL Server. Выберите такой размер, который соответствует вашей рабочей нагрузке. При создании этой среды в учебнике hello использовать **DS2**. Для рабочих нагрузок выберите размер виртуальной машины, который может поддерживать hello рабочей нагрузки. Для многих производственных рабочих нагрузок нужна виртуальная машина **DS4** или большего размера. шаблон Hello создает две виртуальные машины такого размера и устанавливает SQL Server на каждый из них. Дополнительные сведения см. в разделе [Размеры виртуальных машин](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

> [!NOTE]
> Hello Azure устанавливает выпуск SQL Server Enterprise. Hello стоимость зависит от выпуска hello и размер виртуальной машины hello. Подробные сведения о текущих ценах см. на странице [цен на виртуальные машины](http://azure.microsoft.com/pricing/details/virtual-machines/#Sql).
>
>

* **Размер виртуальной машины контроллера домена** — hello размер виртуальной машины для hello контроллеров домена. Мы будем использовать размер **D2**.
* **Размер виртуальной машины ресурса-свидетеля файла** hello размер виртуальной машины для hello файловый ресурс-свидетель. Мы будем использовать размер **A1**.
* **Учетная запись хранения SQL** hello имя учетной записи хранения hello, хранящий данные SQL Server hello и дисков операционной системы. Мы будем использовать имя **alwaysonsql01**.
* **Учетная запись хранения контроллера домена** — hello имя учетной записи хранилища hello hello контроллеров домена. Мы будем использовать имя **alwaysondc01**.
* **Размер диска данных SQL Server** в ТБ — hello размер диска данных SQL Server hello в ТБ. Введите число от 1 до 4. Мы будем использовать размер **1**.
* **Оптимизация хранения** задает параметры конфигурации системы хранения для виртуальных машин hello SQL Server на основе типа hello рабочей нагрузки. Все виртуальные машины SQL Server в этом случае используйте хранилище premium с диска Azure узла кэша только для tooread. Кроме того можно оптимизировать параметры SQL Server для hello рабочей нагрузки, выбрав один из этих трех параметров:

  * **General workload** (Общая рабочая нагрузка) — без особых параметров конфигурации.
  * **Обработка транзакций** — устанавливаются флаги трассировки 1117 и 1118.
  * **Хранилище данных** — устанавливаются флаги трассировки 1117 и 610.

Мы будем использовать параметр **General workload**(Общая рабочая нагрузка).

![Размер виртуальной машины и параметры хранилища](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/4-vm.png)

Просмотрите параметры hello и нажмите кнопку **ОК**.

#### <a name="a-note-about-storage"></a>Примечание о хранилище
Дополнительная оптимизация зависят от размера hello hello дисков данных SQL Server. Azure добавляет дополнительное хранилище класса Premium размером 1 ТБ для каждого терабайта данных на диске. Если сервер требует 2 ТБ не менее, hello шаблона создается пул носителей на каждой виртуальной машине SQL Server. Пул носителей — виде виртуализации хранения, где несколько дисков, настроенных tooprovide пропускную способность, устойчивость и производительность.  шаблон Hello создает дискового пространства в пуле носителей hello и представляется данных single toohello диска операционной системы. шаблон Hello определяет этот диск как диск данных hello для SQL Server. шаблон Hello настраивает hello пула носителей для SQL Server с помощью hello следующие параметры:

* Размер чередования — hello чередовать параметр для hello виртуального диска. Для транзакционных рабочих нагрузок используйте размер в 64 КБ. Для рабочих нагрузок хранилища данных используйте размер в 256 КБ.
* Для типа устойчивости выбирается параметр "Простой (без устойчивости)".

> [!NOTE]
> Хранилище Azure класса premium является локально избыточной и сохраняет три копии данных hello в одном регионе, поэтому улучшения устойчивости в пуле носителей hello не является обязательным.
>
>

* Число столбцов равно hello число дисков в пуле носителей hello.

Дополнительные сведения о дисковом пространстве и пулах носителей:

* [Обзор дисковых пространств](http://technet.microsoft.com/library/hh831739.aspx);
* [Windows Server Backup and Storage Pools (Резервное копирование данных Windows Server и пулы носителей)](http://technet.microsoft.com/library/dn390929.aspx)

Дополнительные рекомендации по настройке SQL Server см. в статье [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md).

### <a name="sql-server-settings"></a>Параметры SQL Server
На **параметры SQL Server**, просмотрите и измените префикс имени виртуальной машины SQL Server hello, версия SQL Server, учетная запись службы SQL Server и пароль и hello расписание обслуживания автоматическое исправление SQL.

* **SQL Server имя префикса** — это имя для каждой виртуальной машины SQL Server используется toocreate. Мы будем использовать префикс **sqlserver**. Hello шаблон имен hello виртуальных машин SQL Server *sqlserver 0* и *sqlserver 1*.
* **Версия SQL Server** hello версия SQL Server. Мы будем использовать версию **SQL Server 2014**. Можно также выбрать **SQL Server 2012** или **SQL Server 2016**.
* **Имя пользователя учетной записи службы SQL Server** — имя учетной записи домена hello hello службы SQL Server. Мы будем использовать **sqlservice**.
* **Пароль** hello пароль для учетной записи службы SQL Server hello.  Следует использовать сложный пароль. Подтверждение пароля hello.
* **Автоматическое исправление SQL расписание обслуживания** идентифицирует hello день недели hello, что Azure автоматически обновляет hello серверов SQL. Мы будем использовать значение **воскресенье**.
* **Час запуска обслуживания SQL автоматическое исправление** — hello время дня для hello регион Azure, в начале автоматического исправления.

> [!NOTE]
> Hello исправления окна для каждой виртуальной машины происходит постепенно на один час. Только одна виртуальная машина будет заполнена во время tooprevent перерыв в работе службы.
>
>

![Параметры SQL Server](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/5-sql.png)

Просмотрите параметры hello и нажмите кнопку **ОК**.

### <a name="summary"></a>Сводка
На странице сводки hello Azure проверяет параметры hello. Можно также загрузить шаблон hello. Просмотрите hello сводки. Нажмите кнопку **ОК**.

### <a name="buy"></a>Купить
Эта последняя колонка содержит **условия использования** и **политику конфиденциальности**. Просмотрите эту информацию. Если вы готовы для виртуальных машин, Azure toostart toocreate hello Здравствуйте, все другие необходимые ресурсы для группы доступности hello, нажмите кнопку **создать**.

Hello портал Azure создает группы ресурсов hello и все ресурсы hello.

## <a name="monitor-deployment"></a>Мониторинг развертывания
Отслеживать ход выполнения развертывания hello из hello портал Azure. Значок, представляющий hello развертывания — автоматически закрепленных toohello Azure панели мониторинга портала.

![Панель мониторинга Azure](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/11-deploydashboard.png)

## <a name="connect-toosql-server"></a>Подключение tooSQL сервера
Hello новые экземпляры SQL Server запущены на виртуальных машинах, подключенных к Интернету IP-адреса. Вы можете удаленного рабочего стола (RDP) непосредственно tooeach виртуальной машины SQL Server.

tooRDP tooa SQL Server, выполните следующие действия.

1. Из hello Azure панели мониторинга портала убедитесь, что hello развертывания выполнено успешно.
2. Щелкните **Ресурсы**.
3. В hello **ресурсов** колонке нажмите кнопку **sqlserver 0**, которое является именем компьютера hello одного hello виртуальных машин, на которых выполняется SQL Server.
4. В колонке hello для **sqlserver 0**, нажмите кнопку **Connect**. Браузер запрашивает, если хотите tooopen или сохранения hello объекта удаленного подключения. Щелкните **Открыть**.
5. **Подключение к удаленному рабочему столу** может предупреждение о том, что hello не удается определить издателя этого удаленного подключения. Щелкните **Подключить**.
6. Безопасность Windows предлагает вам tooenter toohello tooconnect учетные данные IP-адреса hello основного контроллера домена. Щелкните **Использовать другую учетную запись**. В поле **Имя пользователя** введите **contoso\DomainAdmin**. Эта учетная запись настроена, при установке имя пользователя администратора hello в шаблоне hello. Используйте hello сложный пароль, который был выбран при настройке шаблона hello.
7. **Удаленный рабочий стол** может предупреждение о том, что на удаленном компьютере hello не прошла проверку из-за tooproblems с сертификатом безопасности. Там показано, как имя сертификата безопасности hello. Если вы следовали hello учебник, hello называется **sqlserver 0.contoso.com**. Щелкните **Да**.

Теперь вы подключены с виртуальной машины SQL Server toohello протокола удаленного рабочего СТОЛА. Откройте SQL Server Management Studio, подключитесь toohello экземпляр по умолчанию SQL Server и убедитесь, что настройки группы доступности, hello.
