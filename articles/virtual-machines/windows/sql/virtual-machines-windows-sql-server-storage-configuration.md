---
title: "aaaStorage конфигурацию для виртуальных машин SQL Server | Документы Microsoft"
description: "В этой статье описывается процесс настройки хранилища для виртуальных машин SQL Server на портале Azure во время подготовки (модель развертывания с помощью Resource Manager). Здесь также описывается настройка хранилища для имеющихся виртуальных машин SQL Server."
services: virtual-machines-windows
documentationcenter: na
author: ninarn
manager: jhubbard
tags: azure-resource-manager
ms.assetid: 169fc765-3269-48fa-83f1-9fe3e4e40947
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 01/31/2017
ms.author: ninarn
ms.openlocfilehash: b50dbd698828780cfc044fa0966e8f4e2f3bb6c6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="storage-configuration-for-sql-server-vms"></a>Настройка хранилища для виртуальных машин SQL Server
При настройке образ виртуальной машины SQL Server в Azure, портал hello помогает tooautomate конфигурацию хранилища. Сюда входят присоединение toohello хранилища виртуальной Машины, выполняете, tooSQL доступного хранилища сервера и его настройки toooptimize для требований к производительности.

В этой статье описывается процесс настройки хранилища для подготавливаемых и уже имеющихся виртуальных машин SQL Server на портале Azure. Эта конфигурация зависит от hello [рекомендации по производительности](virtual-machines-windows-sql-performance.md) для виртуальных машин Azure с SQL Server.

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-rm-include.md)]

## <a name="prerequisites"></a>Предварительные требования
toouse hello автоматической настройки конфигурации хранилища, к виртуальной машине требуется hello следующие характеристики:

* быть подготовлена с помощью [коллекции образов SQL Server](virtual-machines-windows-sql-server-iaas-overview.md#option-1-create-a-sql-vm-with-per-minute-licensing);
* Использует hello [модели развертывания диспетчера ресурсов](../../../azure-resource-manager/resource-manager-deployment-model.md).
* использовать [хранилище класса Premium](../../../storage/common/storage-premium-storage.md).

## <a name="new-vms"></a>Новые виртуальные машины
Hello ниже описано, как tooconfigure хранилища для новых виртуальных машин SQL Server.

### <a name="azure-portal"></a>Портал Azure
При подготовке виртуальной Машины Azure с помощью образа коллекции SQL Server, вы можете tooautomatically Настройка hello хранилища для новой виртуальной Машины. Укажите размер хранилища hello, ограничения производительности и тип рабочей нагрузки. Hello следующем снимке экрана показано hello хранилища конфигурации колонки, использованной для виртуальной Машины SQL подготовки.

![Настройка хранилища для виртуальной машины SQL Server во время подготовки](./media/virtual-machines-windows-sql-storage-configuration/sql-vm-storage-configuration-provisioning.png)

На основе ваших ответов, Azure выполняет следующие задачи настройки хранилища после создания виртуальной Машины hello hello.

* Создает и присоединяет виртуальная машина toohello диски premium хранилища данных.
* Настраивает hello данных дисков toobe доступен tooSQL сервера.
* Настраивает hello диски с данными в хранилище пула на основании hello указанный размер и производительность требования (операции ввода-ВЫВОДА и пропускной способности).
* Пул носителей hello связывает с нового диска на виртуальной машине hello.
* оптимизирует этот диск в зависимости от указанного типа рабочей нагрузки ("Хранилище данных", "Обработка транзакций" или "Общая").

Для получения сведений о том, как Azure настраивает параметры хранения в разделе hello [раздел конфигурации хранилища](#storage-configuration). Полное Пошаговое руководство по toocreate ВМ SQL Server в hello портала Azure. в статье [hello подготовки учебника](virtual-machines-windows-portal-sql-server-provision.md).

### <a name="resource-manage-templates"></a>Шаблоны Resource Manager
При использовании hello следующие шаблоны диспетчера ресурсов, по умолчанию без настройки пула носителей подключены два диски данных premium. Тем не менее можно настроить эти шаблоны toochange hello число дисков данных premium, вложенные toohello виртуальной машины.

* [Создание виртуальной машины с поддержкой автоматической архивации](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-sql-full-autobackup)
* [Создание виртуальной машины с автоматической установкой исправлений](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-sql-full-autopatching)
* [Создание виртуальной машины с интеграцией AKV](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-sql-full-keyvault)

## <a name="existing-vms"></a>Существующие виртуальные машины
Для существующих виртуальных машин SQL Server можно изменить некоторые параметры хранения hello портал Azure. Выберите виртуальную Машину, перейти toohello области параметров, а затем выберите конфигурация SQL Server. Hello колонке конфигурации SQL Server показывает hello текущее использование памяти виртуальной Машины. На этой диаграмме отображаются все диски, подключенные к виртуальной машине. Для каждого диска место хранения hello отображается в четырех разделах:

* данные SQL;
* журнал SQL;
* прочее (не хранилище SQL);
* Доступна

![Настройка хранилища для имеющейся виртуальной машины SQL Server](./media/virtual-machines-windows-sql-storage-configuration/sql-vm-storage-configuration-existing.png)

tooconfigure hello хранилища tooadd новый диск или расширить существующий диск, щелкните ссылку "Изменить" hello над диаграммой hello.

параметры конфигурации Hello, которые вы видите зависит от использовали эту функцию перед. При использовании для hello первый раз, можно указать требования к хранилищу для нового диска. Если ранее использовался этот компонент toocreate диска, вы можете tooextend хранилища этот диск.

### <a name="use-for-hello-first-time"></a>Используйте для hello первый раз
Если это первый раз с помощью этой функции, можно указать hello ограничения размера и производительность хранилища для нового диска. Такая ситуация аналогичные toowhat отображаемые во время подготовки. Основное отличие Hello — не допускаются тип рабочей нагрузки toospecify hello. Это ограничение предотвращает нарушения все существующие конфигурации SQL Server на виртуальной машине hello.

![Ползунки настройки хранилища для SQL Server](./media/virtual-machines-windows-sql-storage-configuration/sql-vm-storage-usage-sliders.png)

Azure создает диск на основе ваших параметров. В этом случае Azure выполняет следующие задачи настройки хранилища hello.

* Создает и присоединяет виртуальная машина toohello диски premium хранилища данных.
* Настраивает hello данных дисков toobe доступен tooSQL сервера.
* Настраивает hello диски с данными в хранилище пула на основании hello указанный размер и производительность требования (операции ввода-ВЫВОДА и пропускной способности).
* Пул носителей hello связывает с нового диска на виртуальной машине hello.

Для получения сведений о том, как Azure настраивает параметры хранения в разделе hello [раздел конфигурации хранилища](#storage-configuration).

### <a name="add-a-new-drive"></a>Добавление нового диска
Если хранилище на виртуальной машине SQL Server уже настроено, появится два параметра, позволяющие его расширить. Первый параметр Hello – tooadd новый диск, что может повысить уровень производительности hello вашей виртуальной машины.

![Добавить новый tooa диска виртуальной Машины SQL](./media/virtual-machines-windows-sql-storage-configuration/sql-vm-storage-configuration-add-new-drive.png)

Однако после добавления hello диска, необходимо выполнить некоторое повышение производительности hello tooachieve лишние Ручная настройка.

### <a name="extend-hello-drive"></a>Расширьте диск hello
Hello другие возможность расширить хранилище-tooextend hello существующего диска. Данный параметр увеличивает hello доступное хранилище для диска, но не повышает производительность. Пулы носителей невозможно изменить hello число столбцов, после создания пула носителей hello. Hello число столбцов определяет число параллельных записей, которые можно Расслоение дисков данных hello в hello. Поэтому добавление дисков данных не поможет вам повысить производительность. Они могут только выделить дополнительное хранилище для записываемых данных hello. Это ограничение также означает, что, при расширении диска hello, количество столбцов в hello определяет hello минимальное число дисков данных, которые можно добавить. Поэтому при создании пула носителей с дисками данных четыре hello количество столбцов не также 4. Каждый раз, когда расширить хранилище hello, необходимо добавить диски данных по крайней мере четыре.

![Расширения диска для виртуальной машины SQL](./media/virtual-machines-windows-sql-storage-configuration/sql-vm-storage-extend-a-drive.png)

## <a name="storage-configuration"></a>Конфигурация хранилища
Этот раздел предоставляет справку для изменения конфигурации хранилища hello, Azure автоматически выполняет их во время подготовки виртуальной Машины SQL или конфигурации hello портала Azure.

* Если для виртуальной машины выбрано хранилище объемом менее 2 ТБ, Azure не создает пул носителей,
* а если 2 ТБ или больше — пул носителей создается. Hello следующий раздел в этом разделе подробно описаны hello hello конфигурацию пула носителей.
* При автоматической настройке хранилища всегда используются диски данных P30 [хранилища класса Premium](../../../storage/common/storage-premium-storage.md) . Следовательно имеется однозначное соответствие между вашей выбранное число терабайт и hello число дисков данных вложенных tooyour виртуальной Машины.

Сведения о ценах см. в разделе hello [цены на хранилище](https://azure.microsoft.com/pricing/details/storage) страницы приветствия **дисковый накопитель** вкладки.

### <a name="creation-of-hello-storage-pool"></a>Создание пула носителей hello
Azure использует hello после пула носителей hello toocreate параметры на виртуальные машины SQL Server.

| Настройка | Значение |
| --- | --- |
| Размер полосы |256 КБ (хранение данных), 64 КБ (обработка транзакций) |
| Размеры диска |1 ТБ каждый |
| Кэш |чтение |
| Размер выделения |Размер единицы выделения NTFS — 64 КБ |
| Мгновенная инициализация файлов |Включено |
| Блокировка страниц в памяти |Включено |
| Восстановление |Простая модель восстановления (без устойчивости) |
| Количество столбцов |Количество дисков данных<sup>1</sup> |
| Расположение временной базы данных |Хранится на дисках данных<sup>2</sup> |

<sup>1</sup> невозможно изменить после создания пула носителей hello hello число столбцов в пуле носителей hello.

<sup>2</sup> этот параметр применяется только первый диск toohello создается с помощью функции конфигурации хранилища hello.

## <a name="workload-optimization-settings"></a>Параметры оптимизации рабочей нагрузки
Hello следующей таблице описываются hello рабочей нагрузки тип доступны три варианта и их соответствующие оптимизации.

| Тип рабочей нагрузки | Описание | Оптимизация |
| --- | --- | --- |
| **Общие сведения** |Значение по умолчанию, поддерживающее большинство рабочих нагрузок |None |
| **Обработка транзакций** |Оптимизирует хранение hello для рабочих нагрузок OLTP традиционных баз данных |Флаг трассировки 1117<br/>Флаг трассировки 1118 |
| **Хранение данных** |Оптимизирует хранение hello для рабочих нагрузок аналитики и отчетности |Флаг трассировки 610<br/>Флаг трассировки 1117 |

> [!NOTE]
> Тип hello рабочей нагрузки можно указать только при подготовке виртуальной машины SQL, выбрав ее в шаг настройки хранилища hello.
>
>

## <a name="next-steps"></a>Дальнейшие действия
Другие разделы, посвященные toorunning SQL Server в виртуальных машинах Azure, см. в разделе [SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md).
