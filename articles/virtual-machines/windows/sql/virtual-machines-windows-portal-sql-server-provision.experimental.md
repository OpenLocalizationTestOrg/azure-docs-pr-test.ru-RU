---
title: "Подготовка виртуальной машины SQL Server | Документация Майкрософт"
description: "Создание и подключение к виртуальной машине SQL Server с помощью портала Azure. В этом руководстве используется модель Resource Manager."
services: virtual-machines-windows
documentationcenter: na
author: rothja
editor: 
manager: jhubbard
tags: azure-resource-manager
ms.assetid: 1aff691f-a40a-4de2-b6a0-def1384e086e
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: infrastructure-services
ms.date: 04/03/2017
ms.author: jroth
experimental_id: a641df96-f27d-40
ms.openlocfilehash: c51908058bb785cb33da21de76ba3c956b6b9f1f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="provision-a-sql-server-virtual-machine-in-the-azure-portal"></a>Подготовка виртуальной машины SQL Server на портале Azure
> [!div class="op_single_selector"]
> * [Портал](virtual-machines-windows-portal-sql-server-provision.md)
> * [PowerShell](virtual-machines-windows-ps-sql-create.md)
> 
> 

В этом комплексном руководстве показано, как подготовить виртуальную машину SQL Server на портале Azure.

Коллекция виртуальных машин (VM) в Azure включает в себя несколько образов, содержащих Microsoft SQL Server. Всего за несколько действий вы можете выбрать один из образов виртуальной машины SQL из коллекции и подготовить ее в среде Azure.

Изучив данный учебник, вы научитесь:

* [выбирать образ виртуальной машины из коллекции;](#select-a-sql-vm-image-from-the-gallery)
* [настраивать и создавать виртуальные машины;](#configure-the-vm)
* [открывать виртуальные машины с помощью удаленного рабочего стола;](#open-the-vm-with-remote-desktop)
* [удаленно подключаться к SQL Server;](#connect-to-sql-server-remotely)

## <a name="select-a-sql-vm-image-from-the-gallery"></a>выбирать образ виртуальной машины из коллекции;
1. Войдите на [портал Azure](https://portal.azure.com) , используя свою учетную запись.

   > [!NOTE]
   > Если у вас нет учетной записи Azure, используйте [бесплатную пробную версию Azure](https://azure.microsoft.com/pricing/free-trial/).

2. На портале Azure нажмите кнопку **Создать**. На портале откроется колонка **Создать** . Ресурсы виртуальных машин SQL Server находятся на Marketplace в группе **Вычисления**.
3. В колонке **Создать** щелкните **Вычисления** и выберите **See all** (Показать все).
4. В текстовом поле **Фильтр** введите SQL Server и нажмите клавишу ВВОД.

   ![Колонка "Виртуальные машины Azure"](./media/virtual-machines-windows-portal-sql-server-provision/azure-compute-blade2.png)

5. Просмотрите доступные образы SQL Server. Каждый образ определяет версию SQL Server и операционную систему. 
6. Выберите образ SQL Server 2016 SP1 Developer на платформе Windows Server 2016.

   > [!TIP]
   > В этом руководстве используется выпуск Developer, так как это полнофункциональный выпуск SQL Server, предоставляемый бесплатно для тестирования в процессе разработки. Вы оплачиваете только стоимость выполнения виртуальной машины.

   > [!NOTE]
   > В поминутную тарификацию использования виртуальных машин SQL, создаваемых из образов, включена стоимость лицензий на SQL Server (за исключением выпусков Developer и Express). Выпуск SQL Server Developer предоставляется бесплатно для разработки и тестирования (не для рабочей среды), а выпуск SQL Express предоставляется бесплатно для упрощенных рабочих нагрузок (требующих менее 1 ГБ памяти и 10 ГБ хранилища).
   > Есть еще один вариант — использовать собственную лицензию (BYOL) и платить только за виртуальную машину. Имена таких образов содержат префикс {BYOL}. Дополнительные сведения об этих параметрах см. в [руководстве по выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md).

7. В разделе **Выбор модели развертывания** выберите **Resource Manager**. Для новых виртуальных машин рекомендуется использовать модель развертывания Resource Manager. Щелкните **Создать**.

    ![Создание виртуальной машины SQL с помощью Resource Manager](./media/virtual-machines-windows-portal-sql-server-provision/azure-compute-sql-deployment-model.png)

## <a name="configure-the-vm"></a>Настройка виртуальной машины
Есть пять колонок для настройки виртуальной машины SQL Server.

| Шаг | Описание |
| --- | --- |
| **Основы** |[Настройка основных параметров](#1-configure-basic-settings) |
| **Размер** |[Выбор размера виртуальной машины](#2-choose-virtual-machine-size) |
| **Параметры** |[Настройка дополнительных возможностей](#3-configure-optional-features) |
| **Параметры SQL Server** |[Настройка параметров SQL Server](#4-configure-sql-server-settings) |
| **Сводка** |[Просмотр сводки.](#5-review-the-summary) |

## <a name="1-configure-basic-settings"></a>1. Настройка основных параметров.
В колонке **Основные сведения** укажите следующую информацию.

* Введите уникальное **имя**виртуальной машины.
* Укажите **имя пользователя** для учетной записи локального администратора виртуальной машины. Эта учетная запись также добавляется к фиксированной серверной роли **sysadmin** SQL Server.
* Введите надежный **пароль**.
* Если у вас несколько подписок, проверьте, правильно ли выбрана подписка для новой виртуальной машины.
* В поле **Группа ресурсов** введите имя новой группы ресурсов. Кроме того, можно использовать существующую группу ресурсов, щелкнув параметр **Использовать существующую**. Группа ресурсов — это коллекция связанных ресурсов в Azure (виртуальные машины, учетные записи хранения, виртуальные сети и т. д.).
  
  > [!NOTE]
  > Рекомендуется использовать новую группу ресурсов для тестирования или изучения процесса развертывания SQL Server в Azure. После завершения теста удалите группу ресурсов, чтобы автоматически удалить виртуальную машину и все ресурсы, связанные с этой группой ресурсов. Дополнительные сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../../../azure-resource-manager/resource-group-overview.md).
  > 
  > 
* Выберите **расположение** для развертывания.
* Нажмите кнопку **ОК** , чтобы сохранить настройки.
  
    ![Колонка "Основные" в SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-basic.png)

## <a name="2-choose-virtual-machine-size"></a>2) Выбор размера виртуальной машины.
Чтобы изменить **размер** виртуальной машины, выберите нужное значение в колонке **Выбор размера**. В колонке изначально отображаются рекомендуемые размеры виртуальных машин в зависимости от выбранного образа.

> [!IMPORTANT]
> В расчетную ежемесячную стоимость, указанную в колонке **Выбор размера**, не включена стоимость лицензирования SQL Server. Это расчетная ежемесячная стоимость виртуальной машины. Для выпусков SQL Server Express и Developer указана итоговая расчетная стоимость. Получить сведения о других выпусках можно на странице [цен на виртуальные машины Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/), где вы можете выбрать целевой выпуск SQL Server. См. также [руководство по выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md).

![Варианты размеров виртуальной машины SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-vm-choose-a-size.png)

Для рабочих нагрузок рекомендуется выбрать размер виртуальной машины, который поддерживает [хранилище класса Premium](../../../storage/storage-premium-storage.md). Если этот уровень производительности не требуется, нажмите кнопку **Просмотреть все** , чтобы просмотреть все доступные размеры машин. Например, для среды разработки и тестирования можно использовать виртуальную машину меньшего размера.

> [!NOTE]
> Дополнительные сведения о размерах виртуальных машин см. в [этой статье](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json). Описание размеров виртуальных машин SQL Server см. в статье [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md).

Укажите размер машины и нажмите кнопку **Выбрать**.

## <a name="3-configure-optional-features"></a>3. Настройка дополнительных возможностей
В колонке **Параметры** настройте для виртуальной машины параметры службы хранилища Azure, сети и мониторинга.

* В разделе **Хранилище** укажите значение в поле **Тип диска**: Standard или Premium (SSD). Для производственных рабочих нагрузок рекомендуется хранилище класса Premium.

> [!NOTE]
> Если выбрать тип диска Премиум (SSD) для размера виртуальной машины, в котором не поддерживается хранилище класса Premium, размер ВМ будет изменен автоматически.  
> 
> 

* В разделе **Учетная запись хранения** вы можете принять автоматически подготовленное имя учетной записи хранения. Также можно щелкнуть пункт **Учетная запись хранения**, чтобы выбрать существующую учетную запись и настроить ее тип. По умолчанию Azure создает новую учетную запись хранения с локально избыточным хранилищем. Дополнительные сведения о вариантах хранилища см. в статье [Репликация службы хранилища Azure](../../../storage/storage-redundancy.md).
* В разделе **Сеть**вы можете принять автоматически заполненные значения. Можно также щелкнуть каждый компонент, чтобы вручную настроить **виртуальную сеть**, **подсеть**, **общедоступный IP-адрес** и **группу безопасности сети**. В рамках этого руководства можно использовать значения по умолчанию.
* Azure по умолчанию включает **мониторинг** в учетной записи хранения, которая будет использоваться для виртуальной машины. Эти параметры можно изменить.
* В поле **Группа доступности** укажите группу доступности. В рамках этого руководства можно выбрать значение **Нет**. Если вы планируете настроить группы доступности AlwaysOn SQL, настройте доступность, чтобы не создавать виртуальную машину повторно.  Дополнительные сведения см. в статье [Управление доступностью виртуальных машин](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

Завершив настройку параметров, нажмите кнопку **OК**.

## <a name="4-configure-sql-server-settings"></a>4. Настройка параметров SQL Server
В колонке **Настройки SQL Server** укажите нужные параметры и настройте оптимизацию для SQL Server. Для SQL Server можно настроить следующие параметры.

| Настройка |
| --- |
| [Соединение](#connectivity) |
| [Аутентификация](#authentication) |
| [Конфигурация хранилища](#storage-configuration) |
| [Автоматическое исправление](#automated-patching) |
| [Автоматическая архивация](#automated-backup) |
| [Интеграция с хранилищем ключей Azure](#azure-key-vault-integration) |
| [Службы R](#r-services) |

### <a name="connectivity"></a>Соединение
В разделе **Подключение SQL**укажите необходимый тип доступа к экземпляру SQL Server на этой виртуальной машине. В рамках этого руководства выберите пункт **Общедоступное (в Интернете)** для подключения к SQL Server с компьютеров или из служб в Интернете. Если этот параметр выбран, Azure автоматически настраивает брандмауэр и группу безопасности сети, чтобы разрешить трафик через порт 1433.  

![Варианты подключений SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-connectivity-alt.png)

Чтобы подключиться к SQL Server через Интернет, также необходимо включить проверку подлинности SQL Server, как описано в следующем разделе.

> [!NOTE]
> Можно добавить дополнительные ограничения для сетевых подключений к виртуальной машине SQL Server. Для этого после создания виртуальной машины необходимо изменить группу безопасности сети. Дополнительные сведения см. в статье [Группа безопасности сети](../../../virtual-network/virtual-networks-nsg.md).
> 
> 

Если вы не хотите включать подключения к ядру СУБД через Интернет, выберите один из следующих вариантов:

* **Локальное (только в виртуальной машине)** — для подключения к SQL Server только в пределах самой виртуальной машины.
* **Частное (в виртуальной сети)** — для подключения к SQL Server с машин или из служб в той же виртуальной сети.

> [!NOTE]
> Образ виртуальной машины выпуска SQL Server Express не включает протокол TCP/IP автоматически, даже если выбрано общедоступное и частное подключение. Для выпуска Express необходимо [включить протокол TCP/IP вручную](#configure-sql-server-to-listen-on-the-tcp-protocol) в диспетчере конфигурации SQL Server после создания виртуальной машины.
> 
> 

Как правило, чтобы повысить уровень безопасности, необходимо выбрать наиболее подходящий тип подключения для выполнения вашего сценария. Но все параметры можно защитить с помощью правил группы безопасности сети и проверки подлинности Windows или SQL.

Значение **порта** по умолчанию — 1433. Вы можете указать другой номер порта.
Дополнительные сведения см. в статье [Подключение к виртуальной машине SQL Server в Azure (Resource Manager) | Microsoft Azure](virtual-machines-windows-sql-connect.md).

### <a name="authentication"></a>Аутентификация
Если требуется проверка подлинности SQL Server, выберите для параметра **Включить** under **Включить**.

![проверка подлинности SQL Server](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-authentication.png)

> [!NOTE]
> Если вы планируете предоставить доступ к SQL Server через Интернет (то есть включаете параметр общедоступного подключения), включите проверку подлинности SQL здесь. Для общего доступа к SQL Server необходимо использовать проверку подлинности SQL.
> 
> 

Если вы включаете проверку подлинности SQL Server, укажите **имя для входа** и **пароль**. Это имя пользователя настраивается в качестве имени для входа во время проверки подлинности SQL Server и имени участника фиксированной серверной роли **sysadmin**. Дополнительные сведения о режимах проверки подлинности см. в [этой статье](http://msdn.microsoft.com/library/ms144284.aspx).

Если проверка подлинности SQL Server не включена, подключиться к экземпляру SQL Server можно с помощью локальной учетной записи администратора на виртуальной машине.

### <a name="storage-configuration"></a>Конфигурация хранилища
Щелкните **Конфигурация хранилища** , чтобы указать требования к хранилищу.

![Конфигурация хранилища SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-storage.png)

> [!NOTE]
> Этот параметр недоступен при выборе стандартного хранилища. Автоматическая оптимизация доступна только для хранилища класса Premium.
> 
> 

Вы можете указать такие требования, как количество операций ввода-вывода в секунду (IOPs), пропускная способность в МБ/с и общий размер хранилища. Настройте эти значения на скользящих шкалах. Портал автоматически вычисляет количество дисков на основании этих требований.

По умолчанию Azure оптимизирует хранилище для 5000 операций ввода-вывода, 200 МБ/с и 1 ТБ дискового пространства. Вы можете изменить эти параметры хранилища в зависимости от рабочей нагрузки. В разделе **Storage optimized for**(Оптимизация хранилища) выберите один из следующих вариантов.

* **Общая** — это значение по умолчанию, которое поддерживает большинство рабочих нагрузок.
* **Транзакционная** обработка оптимизирует хранилище для рабочих нагрузок OLTP в традиционных базах данных.
* **Хранилище данных** оптимизирует хранилище для рабочих нагрузок аналитики и отчетов.

> [!NOTE]
> Ограничения, указанные с помощью ползунков, зависят от размера виртуальной машины.
> 
> 

### <a name="automated-patching"></a>Автоматическое исправление
**Automated patching** включен по умолчанию. Автоматическая установка исправлений позволяет Azure автоматически исправлять SQL Server и операционную систему. Укажите день недели, время и длительность периода обслуживания. Azure устанавливает исправления в период обслуживания. Расписание периода обслуживания использует для определения времени региональные параметры VM. Если вы не хотите, чтобы платформа Azure автоматически устанавливала исправления для SQL Server и операционной системы, выберите вариант **Отключить**.  

![Автоматическая установка исправлений SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-patching.png)

Дополнительные сведения см. в статье [Автоматическая установка исправлений SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-sql-automated-patching.md).

### <a name="automated-backup"></a>Автоматическая архивация
Включите автоматическую архивацию для всех баз данных в разделе **Автоматическая архивация**. По умолчанию автоматическая архивация отключена.

Во время включения автоматического резервного копирования SQL можно настроить следующие параметры:

* срок хранения (в днях) для резервных копий;
* учетная запись хранения, используемая для резервных копий;
* параметр шифрования и пароль для резервных копий.
* архивация системных баз данных;
* настройка расписания архивации баз данных.

Для шифрования резервной копии щелкните **Включить**. Затем введите **пароль**. Azure создает сертификат для шифрования резервных копий и использует указанный пароль для защиты этого сертификата.

![Автоматическая архивация SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-autobackup2.png)

 Дополнительную информацию см. в статье [Автоматическая архивация SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-sql-automated-backup.md).

### <a name="azure-key-vault-integration"></a>Интеграция с хранилищем ключей Azure
Чтобы хранить в Azure секреты безопасности для шифрования, щелкните **Интеграция хранилища ключей Azure** и выберите значение **Включить**.

![Интеграция SQL с хранилищем ключей Azure](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-akv.png)

В следующей таблице перечислены параметры, необходимые для настройки интеграции с хранилищем ключей Azure.

| ПАРАМЕТР | Описание | ПРИМЕР |
| --- | --- | --- |
| **URL-адрес хранилища ключей** |Расположение хранилища ключей. |https://contosokeyvault.vault.azure.net/ |
| **Имя субъекта** |Имя субъекта-службы Azure Active Directory. Этот имя также называется идентификатором клиента. |fde2b411-33d5-4e11-af04eb07b669ccf2 |
| **Секрет субъекта** |Секрет субъекта-службы Azure Active Directory. Этот секрет также называется секретом клиента. |9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM= |
| **Имя учетных данных** |**Учетное имя**: интеграция AKV создает учетные данные в рамках SQL Server, позволяя виртуальной машине иметь доступ к хранилищу ключей. Выберите имя для этих учетных данных. |mycred1 |

Дополнительные сведения см. в статье [Настройка интеграции хранилища ключей Azure для SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-ps-sql-keyvault.md).

Настроив параметры SQL Server, нажмите кнопку **ОК**.

### <a name="r-services"></a>Службы R
Вы можете включить [службы R SQL Server](https://msdn.microsoft.com/library/mt604845.aspx). Службы R SQL Server позволяют вам использовать расширенные средства аналитики в SQL Server 2016. Щелкните **Включить** on the **SQL Server Settings** .

![Включение служб R SQL Server](./media/virtual-machines-windows-portal-sql-server-provision/azure-vm-sql-server-r-services.png)


## <a name="5-review-the-summary"></a>5. Просмотр сводки.
В колонке **Сводка** просмотрите сводные данные и нажмите кнопку **ОК**, чтобы создать SQL Server, группу ресурсов и ресурсы, указанные для этой виртуальной машины.

Развертывание можно отслеживать на портале Azure. Если нажать кнопку **Уведомления** в верхней части окна, будут показаны основные сведения о состоянии развертывания.

> [!NOTE]
> Чтобы предоставить вам сведения о времени, необходимом для выполнения развертывания, в нашем сценарии виртуальная машина SQL была развернута в восточной части США с параметрами по умолчанию. На выполнение тестового развертывания понадобилось 26 минут. Время развертывания зависит от региона и выбранных параметров.
> 
> 

## <a name="open-the-vm-with-remote-desktop"></a>открывать виртуальные машины с помощью удаленного рабочего стола;
Выполните следующие действия, чтобы подключиться к виртуальной машине через удаленный рабочий стол.

1. После создания виртуальной машины Azure на панели мониторинга Azure отобразится значок виртуальной машины. Его также можно найти, открыв список существующих виртуальных машин. Щелкните имя новой виртуальной машины SQL. В колонке **Виртуальная машина** отобразятся сведения о виртуальной машине.
2. В верхней части колонки **Виртуальная машина** нажмите кнопку **Подключиться**.
3. Браузер загрузит RDP-файл для ВМ. Откройте RDP-файл.
    ![Подключение удаленного рабочего стола к виртуальной машине SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-vm-remote-desktop.png)
4. В ходе подключения к удаленному рабочему столу может появиться предупреждение о том, что издателя этого удаленного подключения невозможно определить. Чтобы продолжить, щелкните **Подключить** .
5. В диалоговом окне **Безопасность Windows** выберите **Использовать другую учетную запись**.
6. В поле **Имя пользователя** введите **\<имя_пользователя>**<user name>, указанное вами во время настройки виртуальной машины. Перед именем необходимо добавить обратную косую черту.
7. Введите **пароль**, ранее настроенный для этой виртуальной машины, и нажмите кнопку **ОК**, чтобы подключиться.
8. Если появится еще одно диалоговое окно **Подключение к удаленному рабочему столу** с запросом на подключение, нажмите кнопку **Да**.

После подключения к виртуальной машине SQL Server вы можете запустить SQL Server Management Studio и подключиться с проверкой подлинности Windows, используя свои учетные данные локального администратора. Если включена проверка подлинности SQL Server, можно также подключиться с проверкой подлинности SQL, используя имя пользователя и пароль SQL, настроенные во время подготовки.

Доступ к машине позволяет напрямую изменять настройки компьютера и SQL Server в зависимости от ваших требований. Например, можно настроить параметры брандмауэра или изменить параметры конфигурации SQL Server.

## <a name="connect-to-sql-server-remotely"></a>удаленно подключаться к SQL Server;
В рамках этого руководства для виртуальной машины используется **открытый** доступ и **проверка подлинности SQL Server**. Эти параметры позволяют автоматически настроить виртуальную машину для получения доступа к экземпляру SQL Server из любого клиента через Интернет (при условии, что будет использоваться правильное имя пользователя SQL).

> [!NOTE]
> Если вы не выбрали параметр "Общедоступное" во время подготовки, для доступа к экземпляру SQL Server через Интернет потребуется выполнить дополнительные действия. Дополнительные сведения см. в статье [Подключение к виртуальной машине SQL Server в Azure (Resource Manager)](virtual-machines-windows-sql-connect.md).
> 
> 

В следующих разделах описано, как подключиться к экземпляру SQL Server на виртуальной машине с другого компьютера через Интернет.

> [!INCLUDE [Connect to SQL Server in a VM Resource Manager](../../../../includes/virtual-machines-sql-server-connection-steps-resource-manager.md)]
> 
> 

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения об использовании SQL Server в Azure см. в статье [Приступая к работе с SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md) и [Часто задаваемые вопросы об SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-faq.md).

Чтобы получить общие сведения об SQL Server на виртуальных машинах Azure, просмотрите видео [Azure VM is the best platform for SQL Server 2016](https://channel9.msdn.com/Events/DataDriven/SQLServer2016/Azure-VM-is-the-best-platform-for-SQL-Server-2016)(Виртуальные машины Azure — лучшая платформа для SQL Server 2016).

[Ознакомьтесь со схемой обучения](https://azure.microsoft.com/documentation/learning-paths/sql-azure-vm/) по использованию SQL Server в виртуальных машинах Azure.

