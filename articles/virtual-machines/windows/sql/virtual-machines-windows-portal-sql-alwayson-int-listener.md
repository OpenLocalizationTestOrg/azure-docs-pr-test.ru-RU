---
title: "aaaCreate прослушивателя группы доступности SQL Server в виртуальных машинах Azure | Документы Microsoft"
description: "Пошаговые инструкции по созданию прослушивателя для группы доступности AlwaysOn для SQL Server в службе виртуальных машин Azure."
services: virtual-machines
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: monicar
ms.assetid: d1f291e9-9af2-41ba-9d29-9541e3adcfcf
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/01/2017
ms.author: mikeray
ms.openlocfilehash: c6a44dc5c7c18b572c2bf5772b4651b7210aacbd
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="configure-a-load-balancer-for-an-always-on-availability-group-in-azure"></a><span data-ttu-id="7e99f-103">Настройка подсистемы балансировки нагрузки для группы доступности AlwaysOn в Azure</span><span class="sxs-lookup"><span data-stu-id="7e99f-103">Configure a load balancer for an Always On availability group in Azure</span></span>
<span data-ttu-id="7e99f-104">В этой статье объясняется, как toocreate балансировки нагрузки для SQL Server Always On группы доступности в Azure виртуальных машинах, которые выполняются с помощью диспетчера ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="7e99f-104">This article explains how toocreate a load balancer for a SQL Server Always On availability group in Azure virtual machines that are running with Azure Resource Manager.</span></span> <span data-ttu-id="7e99f-105">Группы доступности требуется подсистемы балансировки нагрузки для hello экземпляров SQL Server в виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="7e99f-105">An availability group requires a load balancer when hello SQL Server instances are on Azure virtual machines.</span></span> <span data-ttu-id="7e99f-106">Подсистема балансировки нагрузки Hello хранит hello IP-адрес для прослушивателя группы доступности hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-106">hello load balancer stores hello IP address for hello availability group listener.</span></span> <span data-ttu-id="7e99f-107">Если группа доступности распространяется на несколько регионов, для каждого из них нужен отдельный балансировщик.</span><span class="sxs-lookup"><span data-stu-id="7e99f-107">If an availability group spans multiple regions, each region needs a load balancer.</span></span>

<span data-ttu-id="7e99f-108">toocomplete этой задачи необходимо toohave группы доступности SQL Server развернуты на виртуальных машинах Azure, выполняются с помощью диспетчера ресурсов.</span><span class="sxs-lookup"><span data-stu-id="7e99f-108">toocomplete this task, you need toohave a SQL Server availability group deployed on Azure virtual machines that are running with Resource Manager.</span></span> <span data-ttu-id="7e99f-109">Обе виртуальные машины SQL Server должны принадлежать toohello одной группе доступности.</span><span class="sxs-lookup"><span data-stu-id="7e99f-109">Both SQL Server virtual machines must belong toohello same availability set.</span></span> <span data-ttu-id="7e99f-110">Можно использовать hello [шаблона Microsoft](virtual-machines-windows-portal-sql-alwayson-availability-groups.md) tooautomatically Создание группы доступности hello в диспетчере ресурсов.</span><span class="sxs-lookup"><span data-stu-id="7e99f-110">You can use hello [Microsoft template](virtual-machines-windows-portal-sql-alwayson-availability-groups.md) tooautomatically create hello availability group in Resource Manager.</span></span> <span data-ttu-id="7e99f-111">Этот шаблон также автоматически создает внутреннюю подсистему балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-111">This template automatically creates an internal load balancer for you.</span></span> 

<span data-ttu-id="7e99f-112">При необходимости [группу доступности можно настроить вручную](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md).</span><span class="sxs-lookup"><span data-stu-id="7e99f-112">If you prefer, you can [manually configure an availability group](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md).</span></span>

<span data-ttu-id="7e99f-113">Здесь предполагается, что группы доступности уже настроены.</span><span class="sxs-lookup"><span data-stu-id="7e99f-113">This article requires that your availability groups are already configured.</span></span>  

<span data-ttu-id="7e99f-114">Связанные разделы включают:</span><span class="sxs-lookup"><span data-stu-id="7e99f-114">Related topics include:</span></span>

* [<span data-ttu-id="7e99f-115">Введение в группы доступности AlwaysOn SQL Server на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="7e99f-115">Configure Always On availability groups in Azure VM (GUI)</span></span>](virtual-machines-windows-portal-sql-alwayson-availability-groups-manual.md)   
* [<span data-ttu-id="7e99f-116">Настройка подключения между виртуальными сетями с помощью Azure Resource Manager и PowerShell</span><span class="sxs-lookup"><span data-stu-id="7e99f-116">Configure a VNet-to-VNet connection by using Azure Resource Manager and PowerShell</span></span>](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md)

<span data-ttu-id="7e99f-117">При рассмотрении в этой статье, создания и настройки балансировки нагрузки в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="7e99f-117">By walking through this article, you create and configure a load balancer in hello Azure portal.</span></span> <span data-ttu-id="7e99f-118">После завершения процесса hello, настройке hello toouse hello IP-адрес кластера из hello балансировки нагрузки для прослушивателя группы доступности hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-118">After hello process is complete, you configure hello cluster toouse hello IP address from hello load balancer for hello availability group listener.</span></span>

## <a name="create-and-configure-hello-load-balancer-in-hello-azure-portal"></a><span data-ttu-id="7e99f-119">Создание и Настройка балансировки нагрузки hello в hello портал Azure</span><span class="sxs-lookup"><span data-stu-id="7e99f-119">Create and configure hello load balancer in hello Azure portal</span></span>
<span data-ttu-id="7e99f-120">В этой части задачу hello hello следующие:</span><span class="sxs-lookup"><span data-stu-id="7e99f-120">In this portion of hello task, do hello following:</span></span>

1. <span data-ttu-id="7e99f-121">В hello портал Azure создайте hello балансировки нагрузки и настроить hello IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="7e99f-121">In hello Azure portal, create hello load balancer and configure hello IP address.</span></span>
2. <span data-ttu-id="7e99f-122">Настройте пул hello серверной части.</span><span class="sxs-lookup"><span data-stu-id="7e99f-122">Configure hello back-end pool.</span></span>
3. <span data-ttu-id="7e99f-123">Создайте пробу hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-123">Create hello probe.</span></span> 
4. <span data-ttu-id="7e99f-124">Задайте правила подсистемы балансировки нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-124">Set hello load balancing rules.</span></span>

> [!NOTE]
> <span data-ttu-id="7e99f-125">Если экземпляры SQL Server hello в несколько групп ресурсов и регионах, все действия дважды, один раз в каждой группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="7e99f-125">If hello SQL Server instances are in multiple resource groups and regions, perform each step twice, once in each resource group.</span></span>
> 
> 

### <a name="step-1-create-hello-load-balancer-and-configure-hello-ip-address"></a><span data-ttu-id="7e99f-126">Шаг 1: Создание hello балансировки нагрузки и hello IP-адрес</span><span class="sxs-lookup"><span data-stu-id="7e99f-126">Step 1: Create hello load balancer and configure hello IP address</span></span>
<span data-ttu-id="7e99f-127">Во-первых создайте hello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-127">First, create hello load balancer.</span></span> 

1. <span data-ttu-id="7e99f-128">Hello портал Azure откройте hello группы ресурсов, содержащем виртуальные машины SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-128">In hello Azure portal, open hello resource group that contains hello SQL Server virtual machines.</span></span> 

2. <span data-ttu-id="7e99f-129">В группе ресурсов hello, нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-129">In hello resource group, click **Add**.</span></span>

3. <span data-ttu-id="7e99f-130">Поиск **подсистемы балансировки нагрузки** и выберите в результатах поиска hello, **подсистемы балансировки нагрузки**, который публикуется с **Microsoft**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-130">Search for **load balancer** and then, in hello search results, select **Load Balancer**, which is published by **Microsoft**.</span></span>

4. <span data-ttu-id="7e99f-131">На hello **балансировки нагрузки** колонка, щелкните **создать**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-131">On hello **Load Balancer** blade, click **Create**.</span></span>

5. <span data-ttu-id="7e99f-132">В hello **создать балансировки нагрузки** диалогового окна поле, настройте подсистемы балансировки нагрузки hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="7e99f-132">In hello **Create load balancer** dialog box, configure hello load balancer as follows:</span></span>

   | <span data-ttu-id="7e99f-133">Настройка</span><span class="sxs-lookup"><span data-stu-id="7e99f-133">Setting</span></span> | <span data-ttu-id="7e99f-134">Значение</span><span class="sxs-lookup"><span data-stu-id="7e99f-134">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="7e99f-135">**Имя**</span><span class="sxs-lookup"><span data-stu-id="7e99f-135">**Name**</span></span> |<span data-ttu-id="7e99f-136">Текстовое имя, представляющее hello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-136">A text name representing hello load balancer.</span></span> <span data-ttu-id="7e99f-137">Например, **sqlLB**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-137">For example, **sqlLB**.</span></span> |
   | <span data-ttu-id="7e99f-138">**Тип**</span><span class="sxs-lookup"><span data-stu-id="7e99f-138">**Type**</span></span> |<span data-ttu-id="7e99f-139">**Внутренняя**: большинство реализаций использовать внутреннюю подсистему балансировки нагрузки, позволяющая приложениям внутри hello одной группы доступности toohello tooconnect виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="7e99f-139">**Internal**: Most implementations use an internal load balancer, which allows applications within hello same virtual network tooconnect toohello availability group.</span></span>  </br> <span data-ttu-id="7e99f-140">**Внешние**: позволяет группе доступности приложений tooconnect toohello через открытые подключение к Интернету.</span><span class="sxs-lookup"><span data-stu-id="7e99f-140">**External**: Allows applications tooconnect toohello availability group through a public Internet connection.</span></span> |
   | <span data-ttu-id="7e99f-141">**Виртуальная сеть**</span><span class="sxs-lookup"><span data-stu-id="7e99f-141">**Virtual network**</span></span> |<span data-ttu-id="7e99f-142">Выберите виртуальную сеть hello, принимаемые экземпляры SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-142">Select hello virtual network that hello SQL Server intances are in.</span></span> |
   | <span data-ttu-id="7e99f-143">**Подсеть**</span><span class="sxs-lookup"><span data-stu-id="7e99f-143">**Subnet**</span></span> |<span data-ttu-id="7e99f-144">Выберите подсеть hello, принадлежат hello экземпляры SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7e99f-144">Select hello subnet that hello SQL Server instances are in.</span></span> |
   | <span data-ttu-id="7e99f-145">**Назначение IP-адресов**</span><span class="sxs-lookup"><span data-stu-id="7e99f-145">**IP address assignment**</span></span> |<span data-ttu-id="7e99f-146">**Статическое**</span><span class="sxs-lookup"><span data-stu-id="7e99f-146">**Static**</span></span> |
   | <span data-ttu-id="7e99f-147">**Частный IP-адрес**</span><span class="sxs-lookup"><span data-stu-id="7e99f-147">**Private IP address**</span></span> |<span data-ttu-id="7e99f-148">Укажите IP-адрес доступен из подсети hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-148">Specify an available IP address from hello subnet.</span></span> <span data-ttu-id="7e99f-149">Используйте этот IP-адрес при создании прослушивателя в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-149">Use this IP address when you create a listener on hello cluster.</span></span> <span data-ttu-id="7e99f-150">В скрипте PowerShell далее в этой статье, можно использовать этот адрес для hello `$ILBIP` переменной.</span><span class="sxs-lookup"><span data-stu-id="7e99f-150">In a PowerShell script, later in this article, use this address for hello `$ILBIP` variable.</span></span> |
   | <span data-ttu-id="7e99f-151">**Подписка**</span><span class="sxs-lookup"><span data-stu-id="7e99f-151">**Subscription**</span></span> |<span data-ttu-id="7e99f-152">Это поле может появиться, если у вас несколько подписок.</span><span class="sxs-lookup"><span data-stu-id="7e99f-152">If you have multiple subscriptions, this field might appear.</span></span> <span data-ttu-id="7e99f-153">Выберите подписку hello, что требуется tooassociate с этим ресурсом.</span><span class="sxs-lookup"><span data-stu-id="7e99f-153">Select hello subscription that you want tooassociate with this resource.</span></span> <span data-ttu-id="7e99f-154">Он является обычно Здравствуйте, той же подписке, как все ресурсы hello для группы доступности hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-154">It is normally hello same subscription as all hello resources for hello availability group.</span></span> |
   | <span data-ttu-id="7e99f-155">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="7e99f-155">**Resource group**</span></span> |<span data-ttu-id="7e99f-156">Выберите группу ресурсов hello, экземпляры SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-156">Select hello resource group that hello SQL Server instances are in.</span></span> |
   | <span data-ttu-id="7e99f-157">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="7e99f-157">**Location**</span></span> |<span data-ttu-id="7e99f-158">Выберите hello Azure hello экземпляры SQL Server находятся в расположении.</span><span class="sxs-lookup"><span data-stu-id="7e99f-158">Select hello Azure location that hello SQL Server instances are in.</span></span> |

6. <span data-ttu-id="7e99f-159">Щелкните **Создать**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-159">Click **Create**.</span></span> 

<span data-ttu-id="7e99f-160">Azure создает hello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-160">Azure creates hello load balancer.</span></span> <span data-ttu-id="7e99f-161">Подсистема балансировки нагрузки Hello принадлежит tooa конкретной сети, подсети, группы ресурсов и расположение.</span><span class="sxs-lookup"><span data-stu-id="7e99f-161">hello load balancer belongs tooa specific network, subnet, resource group, and location.</span></span> <span data-ttu-id="7e99f-162">После завершения задачи hello Azure проверьте hello параметры подсистемы балансировки нагрузки в Azure.</span><span class="sxs-lookup"><span data-stu-id="7e99f-162">After Azure completes hello task, verify hello load balancer settings in Azure.</span></span> 

### <a name="step-2-configure-hello-back-end-pool"></a><span data-ttu-id="7e99f-163">Шаг 2: Настройка пула hello серверной части</span><span class="sxs-lookup"><span data-stu-id="7e99f-163">Step 2: Configure hello back-end pool</span></span>
<span data-ttu-id="7e99f-164">Пул адресов серверной части hello Azure вызовы *внутренний пул*.</span><span class="sxs-lookup"><span data-stu-id="7e99f-164">Azure calls hello back-end address pool *backend pool*.</span></span> <span data-ttu-id="7e99f-165">В этом случае пул hello серверной части — адреса hello hello двух экземпляров SQL Server в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="7e99f-165">In this case, hello back-end pool is hello addresses of hello two SQL Server instances in your availability group.</span></span> 

1. <span data-ttu-id="7e99f-166">В группе ресурсов щелкните hello подсистемы балансировки нагрузки, вы создали.</span><span class="sxs-lookup"><span data-stu-id="7e99f-166">In your resource group, click hello load balancer that you created.</span></span> 

2. <span data-ttu-id="7e99f-167">В колонке **Параметры** щелкните **Серверные пулы**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-167">On **Settings**, click **Backend pools**.</span></span>

3. <span data-ttu-id="7e99f-168">На **внутренние пулы**, нажмите кнопку **добавить** toocreate пул адресов серверной части.</span><span class="sxs-lookup"><span data-stu-id="7e99f-168">On **Backend pools**, click **Add** toocreate a back-end address pool.</span></span> 

4. <span data-ttu-id="7e99f-169">На **Добавление внутреннего пула**в разделе **имя**, введите имя для пула hello серверной части.</span><span class="sxs-lookup"><span data-stu-id="7e99f-169">On **Add backend pool**, under **Name**, type a name for hello back-end pool.</span></span>

5. <span data-ttu-id="7e99f-170">В разделе **Виртуальные машины** щелкните **Добавить виртуальную машину**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-170">Under **Virtual machines**, click **Add a virtual machine**.</span></span> 

6. <span data-ttu-id="7e99f-171">В разделе **выберите виртуальные машины**, нажмите кнопку **выберите группу доступности**, а затем укажите группу доступности hello, виртуальных машин SQL Server hello относятся к.</span><span class="sxs-lookup"><span data-stu-id="7e99f-171">Under **Choose virtual machines**, click **Choose an availability set**, and then specify hello availability set that hello SQL Server virtual machines belong to.</span></span>

7. <span data-ttu-id="7e99f-172">После выбора набора доступности hello щелкните **выберите виртуальные машины hello**, выберите hello две виртуальные машины, на которых размещены экземпляры SQL Server hello в группе доступности hello и нажмите кнопку **выберите**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-172">After you have chosen hello availability set, click **Choose hello virtual machines**, select hello two virtual machines that host hello SQL Server instances in hello availability group, and then click **Select**.</span></span> 

8. <span data-ttu-id="7e99f-173">Нажмите кнопку **ОК** tooclose hello колонок для **выберите виртуальные машины**, и **Добавление внутреннего пула**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-173">Click **OK** tooclose hello blades for **Choose virtual machines**, and **Add backend pool**.</span></span> 

<span data-ttu-id="7e99f-174">Azure обновляет параметры hello hello пула адресов серверной части.</span><span class="sxs-lookup"><span data-stu-id="7e99f-174">Azure updates hello settings for hello back-end address pool.</span></span> <span data-ttu-id="7e99f-175">Теперь в вашей группе доступности есть пул из двух экземпляров SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7e99f-175">Now your availability set has a pool of two SQL Server instances.</span></span>

### <a name="step-3-create-a-probe"></a><span data-ttu-id="7e99f-176">Шаг 3. Создание пробы</span><span class="sxs-lookup"><span data-stu-id="7e99f-176">Step 3: Create a probe</span></span>
<span data-ttu-id="7e99f-177">зонд Hello определяет, как Azure проверяет, что hello экземпляров SQL Server в данный момент принадлежит hello прослушивателя группы доступности.</span><span class="sxs-lookup"><span data-stu-id="7e99f-177">hello probe defines how Azure verifies which of hello SQL Server instances currently owns hello availability group listener.</span></span> <span data-ttu-id="7e99f-178">Azure зондами hello службы на основании hello IP-адрес, порт, определяются при создании пробы hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-178">Azure probes hello service based on hello IP address on a port that you define when you create hello probe.</span></span>

1. <span data-ttu-id="7e99f-179">Подсистема балансировки нагрузки на hello **параметры** колонка, щелкните **зонды работоспособности**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-179">On hello load balancer **Settings** blade, click **Health probes**.</span></span> 

2. <span data-ttu-id="7e99f-180">На hello **зонды работоспособности** колонка, щелкните **добавить**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-180">On hello **Health probes** blade, click **Add**.</span></span>

3. <span data-ttu-id="7e99f-181">Настройка проверки hello на hello **пробы добавить** колонку.</span><span class="sxs-lookup"><span data-stu-id="7e99f-181">Configure hello probe on hello **Add probe** blade.</span></span> <span data-ttu-id="7e99f-182">Используйте hello после проверки hello tooconfigure значения:</span><span class="sxs-lookup"><span data-stu-id="7e99f-182">Use hello following values tooconfigure hello probe:</span></span>

   | <span data-ttu-id="7e99f-183">Настройка</span><span class="sxs-lookup"><span data-stu-id="7e99f-183">Setting</span></span> | <span data-ttu-id="7e99f-184">Значение</span><span class="sxs-lookup"><span data-stu-id="7e99f-184">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="7e99f-185">**Имя**</span><span class="sxs-lookup"><span data-stu-id="7e99f-185">**Name**</span></span> |<span data-ttu-id="7e99f-186">Текстовое имя, представляющее пробы hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-186">A text name representing hello probe.</span></span> <span data-ttu-id="7e99f-187">Например, **SQLAlwaysOnEndPointProbe**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-187">For example, **SQLAlwaysOnEndPointProbe**.</span></span> |
   | <span data-ttu-id="7e99f-188">**Протокол**</span><span class="sxs-lookup"><span data-stu-id="7e99f-188">**Protocol**</span></span> |<span data-ttu-id="7e99f-189">**TCP**</span><span class="sxs-lookup"><span data-stu-id="7e99f-189">**TCP**</span></span> |
   | <span data-ttu-id="7e99f-190">**Порт**</span><span class="sxs-lookup"><span data-stu-id="7e99f-190">**Port**</span></span> |<span data-ttu-id="7e99f-191">Вы можете использовать любой доступный порт.</span><span class="sxs-lookup"><span data-stu-id="7e99f-191">You can use any available port.</span></span> <span data-ttu-id="7e99f-192">Например, *59999*.</span><span class="sxs-lookup"><span data-stu-id="7e99f-192">For example, *59999*.</span></span> |
   | <span data-ttu-id="7e99f-193">**Интервал**</span><span class="sxs-lookup"><span data-stu-id="7e99f-193">**Interval**</span></span> |<span data-ttu-id="7e99f-194">*5*</span><span class="sxs-lookup"><span data-stu-id="7e99f-194">*5*</span></span> |
   | <span data-ttu-id="7e99f-195">**Пороговое значение сбоя**</span><span class="sxs-lookup"><span data-stu-id="7e99f-195">**Unhealthy threshold**</span></span> |<span data-ttu-id="7e99f-196">*2*</span><span class="sxs-lookup"><span data-stu-id="7e99f-196">*2*</span></span> |

4.  <span data-ttu-id="7e99f-197">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-197">Click **OK**.</span></span> 

> [!NOTE]
> <span data-ttu-id="7e99f-198">Убедитесь, что открыт порт hello, указываемые на брандмауэре hello обоих экземпляров SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7e99f-198">Make sure that hello port you specify is open on hello firewall of both SQL Server instances.</span></span> <span data-ttu-id="7e99f-199">Оба экземпляра требуют входящее правило для hello TCP-порт, который можно использовать.</span><span class="sxs-lookup"><span data-stu-id="7e99f-199">Both instances require an inbound rule for hello TCP port that you use.</span></span> <span data-ttu-id="7e99f-200">Дополнительные сведения см. в статье [Добавление и изменение правила брандмауэра](http://technet.microsoft.com/library/cc753558.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e99f-200">For more information, see [Add or Edit Firewall Rule](http://technet.microsoft.com/library/cc753558.aspx).</span></span> 
> 
> 

<span data-ttu-id="7e99f-201">Azure создает Проба hello и использует его tootest, какой экземпляр SQL Server имеет hello прослушиватель для группы доступности hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-201">Azure creates hello probe and then uses it tootest which SQL Server instance has hello listener for hello availability group.</span></span>

### <a name="step-4-set-hello-load-balancing-rules"></a><span data-ttu-id="7e99f-202">Шаг 4: Настройка правил балансировки нагрузки, hello</span><span class="sxs-lookup"><span data-stu-id="7e99f-202">Step 4: Set hello load balancing rules</span></span>
<span data-ttu-id="7e99f-203">правила балансировки нагрузки Hello настроить как hello балансировки нагрузки направляет трафик экземпляров SQL Server toohello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-203">hello load balancing rules configure how hello load balancer routes traffic toohello SQL Server instances.</span></span> <span data-ttu-id="7e99f-204">Для этой подсистемы балансировки нагрузки включен прямой возврат сервера так, как только один из двух экземпляров SQL Server hello принадлежит ресурс прослушивателя группы доступности hello одновременно.</span><span class="sxs-lookup"><span data-stu-id="7e99f-204">For this load balancer, you enable direct server return because only one of hello two SQL Server instances owns hello availability group listener resource at a time.</span></span>

1. <span data-ttu-id="7e99f-205">Подсистема балансировки нагрузки на hello **параметры** колонке нажмите кнопку **правила подсистемы балансировки нагрузки**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-205">On hello load balancer **Settings** blade, click **Load balancing rules**.</span></span> 

2. <span data-ttu-id="7e99f-206">На hello **правила подсистемы балансировки нагрузки** колонка, щелкните **добавить**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-206">On hello **Load balancing rules** blade, click **Add**.</span></span>

3. <span data-ttu-id="7e99f-207">На hello **правила подсистемы балансировки нагрузки добавить** колонки, настройте правило балансировки нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-207">On hello **Add load balancing rules** blade, configure hello load balancing rule.</span></span> <span data-ttu-id="7e99f-208">Используйте hello следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="7e99f-208">Use hello following settings:</span></span> 

   | <span data-ttu-id="7e99f-209">Настройка</span><span class="sxs-lookup"><span data-stu-id="7e99f-209">Setting</span></span> | <span data-ttu-id="7e99f-210">Значение</span><span class="sxs-lookup"><span data-stu-id="7e99f-210">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="7e99f-211">**Имя**</span><span class="sxs-lookup"><span data-stu-id="7e99f-211">**Name**</span></span> |<span data-ttu-id="7e99f-212">Текстовое имя, представляющее правила подсистемы балансировки нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-212">A text name representing hello load balancing rules.</span></span> <span data-ttu-id="7e99f-213">Например, **SQLAlwaysOnEndPointListener**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-213">For example, **SQLAlwaysOnEndPointListener**.</span></span> |
   | <span data-ttu-id="7e99f-214">**Протокол**</span><span class="sxs-lookup"><span data-stu-id="7e99f-214">**Protocol**</span></span> |<span data-ttu-id="7e99f-215">**TCP**</span><span class="sxs-lookup"><span data-stu-id="7e99f-215">**TCP**</span></span> |
   | <span data-ttu-id="7e99f-216">**Порт**</span><span class="sxs-lookup"><span data-stu-id="7e99f-216">**Port**</span></span> |<span data-ttu-id="7e99f-217">*1433*</span><span class="sxs-lookup"><span data-stu-id="7e99f-217">*1433*</span></span> |
   | <span data-ttu-id="7e99f-218">**Серверный порт**</span><span class="sxs-lookup"><span data-stu-id="7e99f-218">**Backend Port**</span></span> |<span data-ttu-id="7e99f-219">*1433*. Это значение игнорируется, поскольку правило использует **плавающий IP-адрес (прямой ответ от сервера)**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-219">*1433*. This value is ignored because this rule uses **Floating IP (direct server return)**.</span></span> |
   | <span data-ttu-id="7e99f-220">**Проба**</span><span class="sxs-lookup"><span data-stu-id="7e99f-220">**Probe**</span></span> |<span data-ttu-id="7e99f-221">Используйте имя hello hello пробы, созданный для этой подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-221">Use hello name of hello probe that you created for this load balancer.</span></span> |
   | <span data-ttu-id="7e99f-222">**Сохранение сеанса**</span><span class="sxs-lookup"><span data-stu-id="7e99f-222">**Session persistence**</span></span> |<span data-ttu-id="7e99f-223">**None**</span><span class="sxs-lookup"><span data-stu-id="7e99f-223">**None**</span></span> |
   | <span data-ttu-id="7e99f-224">**Время ожидания простоя (в минутах)**</span><span class="sxs-lookup"><span data-stu-id="7e99f-224">**Idle timeout (minutes)**</span></span> |<span data-ttu-id="7e99f-225">*4*</span><span class="sxs-lookup"><span data-stu-id="7e99f-225">*4*</span></span> |
   | <span data-ttu-id="7e99f-226">**Плавающий IP-адрес (прямой ответ от сервера)**</span><span class="sxs-lookup"><span data-stu-id="7e99f-226">**Floating IP (direct server return)**</span></span> |<span data-ttu-id="7e99f-227">**Включено**</span><span class="sxs-lookup"><span data-stu-id="7e99f-227">**Enabled**</span></span> |

   > [!NOTE]
   > <span data-ttu-id="7e99f-228">Может потребоваться tooscroll вниз колонку tooview hello все параметры hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-228">You might have tooscroll down hello blade tooview all hello settings.</span></span>
   > 

4. <span data-ttu-id="7e99f-229">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-229">Click **OK**.</span></span> 
5. <span data-ttu-id="7e99f-230">Azure настраивает правила балансировки нагрузки hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-230">Azure configures hello load balancing rule.</span></span> <span data-ttu-id="7e99f-231">Теперь подсистемы балансировки нагрузки hello — экземпляр SQL Server toohello трафика настроенных tooroute, на котором размещена hello прослушиватель для группы доступности hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-231">Now hello load balancer is configured tooroute traffic toohello SQL Server instance that hosts hello listener for hello availability group.</span></span> 

<span data-ttu-id="7e99f-232">В этот момент hello группа ресурсов содержит подсистемы балансировки нагрузки, соединяющей tooboth машины SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7e99f-232">At this point, hello resource group has a load balancer that connects tooboth SQL Server machines.</span></span> <span data-ttu-id="7e99f-233">Hello балансировки нагрузки также содержит IP-адрес для hello SQL Server Always On прослушивателя группы доступности, поэтому любой компьютер может отвечать toorequests для групп доступности hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-233">hello load balancer also contains an IP address for hello SQL Server Always On availability group listener, so that either machine can respond toorequests for hello availability groups.</span></span>

> [!NOTE]
> <span data-ttu-id="7e99f-234">Если экземпляры SQL Server находятся в двух разных регионах, повторите шаги hello hello другой области.</span><span class="sxs-lookup"><span data-stu-id="7e99f-234">If your SQL Server instances are in two separate regions, repeat hello steps in hello other region.</span></span> <span data-ttu-id="7e99f-235">Балансировщик нагрузки необходим для каждого региона.</span><span class="sxs-lookup"><span data-stu-id="7e99f-235">Each region requires a load balancer.</span></span> 
> 
> 

## <a name="configure-hello-cluster-toouse-hello-load-balancer-ip-address"></a><span data-ttu-id="7e99f-236">Настройка hello кластера toouse hello подсистемы балансировки нагрузки IP-адреса</span><span class="sxs-lookup"><span data-stu-id="7e99f-236">Configure hello cluster toouse hello load balancer IP address</span></span>
<span data-ttu-id="7e99f-237">Hello следующим шагом является прослушивателем hello tooconfigure на кластере hello и перевод hello прослушивателя в оперативный режим.</span><span class="sxs-lookup"><span data-stu-id="7e99f-237">hello next step is tooconfigure hello listener on hello cluster, and bring hello listener online.</span></span> <span data-ttu-id="7e99f-238">Здравствуйте, следующие:</span><span class="sxs-lookup"><span data-stu-id="7e99f-238">Do hello following:</span></span> 

1. <span data-ttu-id="7e99f-239">Создайте hello прослушивателя группы доступности в отказоустойчивом кластере hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-239">Create hello availability group listener on hello failover cluster.</span></span> 

2. <span data-ttu-id="7e99f-240">Перевод прослушивателя hello в оперативный режим.</span><span class="sxs-lookup"><span data-stu-id="7e99f-240">Bring hello listener online.</span></span>

### <a name="step-5-create-hello-availability-group-listener-on-hello-failover-cluster"></a><span data-ttu-id="7e99f-241">Шаг 5: Создание hello прослушивателя группы доступности в отказоустойчивом кластере hello</span><span class="sxs-lookup"><span data-stu-id="7e99f-241">Step 5: Create hello availability group listener on hello failover cluster</span></span>
<span data-ttu-id="7e99f-242">На этом шаге вы вручную создать прослушиватель группы доступности hello в Диспетчер отказоустойчивости кластеров и SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="7e99f-242">In this step, you manually create hello availability group listener in Failover Cluster Manager and SQL Server Management Studio.</span></span>

[!INCLUDE [ag-listener-configure](../../../../includes/virtual-machines-ag-listener-configure.md)]

### <a name="verify-hello-configuration-of-hello-listener"></a><span data-ttu-id="7e99f-243">Проверка конфигурации hello hello прослушивателя</span><span class="sxs-lookup"><span data-stu-id="7e99f-243">Verify hello configuration of hello listener</span></span>

<span data-ttu-id="7e99f-244">Ресурсы кластера hello и зависимости настроены правильно, следует прослушиватель может tooview hello в SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="7e99f-244">If hello cluster resources and dependencies are correctly configured, you should be able tooview hello listener in SQL Server Management Studio.</span></span> <span data-ttu-id="7e99f-245">tooset Здравствуйте порта прослушивателя, hello следующие:</span><span class="sxs-lookup"><span data-stu-id="7e99f-245">tooset hello listener port, do hello following:</span></span>

1. <span data-ttu-id="7e99f-246">Запустите SQL Server Management Studio и подключитесь toohello первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="7e99f-246">Start SQL Server Management Studio, and then connect toohello primary replica.</span></span>

2. <span data-ttu-id="7e99f-247">Go слишком**высокий уровень доступности AlwaysOn** > **группы доступности** > **прослушиватели группы доступности**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-247">Go too**AlwaysOn High Availability** > **Availability Groups** > **Availability Group Listeners**.</span></span>  
    <span data-ttu-id="7e99f-248">Теперь вы увидите имя прослушивателя hello, созданный в диспетчере отказоустойчивости кластеров.</span><span class="sxs-lookup"><span data-stu-id="7e99f-248">You should now see hello listener name that you created in Failover Cluster Manager.</span></span> 

3. <span data-ttu-id="7e99f-249">Щелкните правой кнопкой мыши имя прослушивателя hello и нажмите кнопку **свойства**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-249">Right-click hello listener name, and then click **Properties**.</span></span>

4. <span data-ttu-id="7e99f-250">В hello **порт** укажите hello номер порта для прослушивателя группы доступности hello $EndpointPort ранее с помощью hello (по умолчанию hello — 1433), а затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-250">In hello **Port** box, specify hello port number for hello availability group listener by using hello $EndpointPort you used earlier (1433 was hello default), and then click **OK**.</span></span>

<span data-ttu-id="7e99f-251">Теперь у вас есть группа доступности на виртуальных машинах Azure, работающих в режиме Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="7e99f-251">You now have an availability group in Azure virtual machines running in Resource Manager mode.</span></span> 

## <a name="test-hello-connection-toohello-listener"></a><span data-ttu-id="7e99f-252">Подключение toohello теста hello прослушивателя</span><span class="sxs-lookup"><span data-stu-id="7e99f-252">Test hello connection toohello listener</span></span>
<span data-ttu-id="7e99f-253">Проверка соединения hello, выполнив hello ниже:</span><span class="sxs-lookup"><span data-stu-id="7e99f-253">Test hello connection by doing hello following:</span></span>

1. <span data-ttu-id="7e99f-254">Экземпляр SQL Server tooa протокола удаленного рабочего СТОЛА, hello виртуальных сетевых, но не собственные hello реплики.</span><span class="sxs-lookup"><span data-stu-id="7e99f-254">RDP tooa SQL Server instance that is in hello same virtual network, but does not own hello replica.</span></span> <span data-ttu-id="7e99f-255">Этот сервер можно hello другой экземпляр SQL Server в кластере hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-255">This server can be hello other SQL Server instance in hello cluster.</span></span>

2. <span data-ttu-id="7e99f-256">Используйте **sqlcmd** программа tootest hello соединения.</span><span class="sxs-lookup"><span data-stu-id="7e99f-256">Use **sqlcmd** utility tootest hello connection.</span></span> <span data-ttu-id="7e99f-257">Например, следующий скрипт hello устанавливает **sqlcmd** toohello первичной подключения через прослушиватель hello с проверкой подлинности Windows:</span><span class="sxs-lookup"><span data-stu-id="7e99f-257">For example, hello following script establishes a **sqlcmd** connection toohello primary replica through hello listener with Windows authentication:</span></span>
   
        sqlcmd -S <listenerName> -E

<span data-ttu-id="7e99f-258">Hello SQLCMD подключения автоматически подключается toohello экземпляр SQL Server, на котором размещена первичная реплика hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-258">hello SQLCMD connection automatically connects toohello SQL Server instance that hosts hello primary replica.</span></span> 

## <a name="create-an-ip-address-for-an-additional-availability-group"></a><span data-ttu-id="7e99f-259">Создание IP-адреса для дополнительной группы доступности</span><span class="sxs-lookup"><span data-stu-id="7e99f-259">Create an IP address for an additional availability group</span></span>

<span data-ttu-id="7e99f-260">Каждая группа доступности использует отдельный прослушиватель.</span><span class="sxs-lookup"><span data-stu-id="7e99f-260">Each availability group uses a separate listener.</span></span> <span data-ttu-id="7e99f-261">У каждого прослушивателя имеется собственный IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="7e99f-261">Each listener has its own IP address.</span></span> <span data-ttu-id="7e99f-262">Используйте hello же загрузить балансировки toohold hello IP-адрес для дополнительных прослушивателей.</span><span class="sxs-lookup"><span data-stu-id="7e99f-262">Use hello same load balancer toohold hello IP address for additional listeners.</span></span> <span data-ttu-id="7e99f-263">После создания группы доступности, добавления подсистемы балансировки нагрузки toohello hello IP адрес, а затем настройте прослушиватель hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-263">After you create an availability group, add hello IP address toohello load balancer, and then configure hello listener.</span></span>

<span data-ttu-id="7e99f-264">tooadd IP адрес tooa подсистемы балансировки нагрузки с портала Azure hello hello следующие:</span><span class="sxs-lookup"><span data-stu-id="7e99f-264">tooadd an IP address tooa load balancer with hello Azure portal, do hello following:</span></span>

1. <span data-ttu-id="7e99f-265">В hello портал Azure откройте группу ресурсов hello, содержит подсистему балансировки нагрузки hello и нажмите кнопку hello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-265">In hello Azure portal, open hello resource group that contains hello load balancer, and then click hello load balancer.</span></span> 

2. <span data-ttu-id="7e99f-266">В разделе **Параметры** щелкните **Пул внешних IP-адресов**, а затем щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-266">Under **SETTINGS**, click **Frontend IP pool**, and then click **Add**.</span></span> 

3. <span data-ttu-id="7e99f-267">В разделе **добавить IP-адрес внешнего интерфейса**, укажите имя для hello переднего плана.</span><span class="sxs-lookup"><span data-stu-id="7e99f-267">Under **Add frontend IP address**, assign a name for hello front end.</span></span> 

4. <span data-ttu-id="7e99f-268">Убедитесь, что hello **виртуальная сеть** и hello **подсети** являются hello так же, как hello экземпляров SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7e99f-268">Verify that hello **Virtual network** and hello **Subnet** are hello same as hello SQL Server instances.</span></span>

5. <span data-ttu-id="7e99f-269">Задать hello IP-адрес для прослушивателя hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-269">Set hello IP address for hello listener.</span></span> 
   
   >[!TIP]
   ><span data-ttu-id="7e99f-270">Можно задать hello IP адрес toostatic и введите адрес, который в настоящее время не используется в подсети hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-270">You can set hello IP address toostatic and type an address that is not currently used in hello subnet.</span></span> <span data-ttu-id="7e99f-271">Кроме того можно задать hello IP адрес toodynamic и сохранить hello нового интерфейса пула IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="7e99f-271">Alternatively, you can set hello IP address toodynamic and save hello new front-end IP pool.</span></span> <span data-ttu-id="7e99f-272">При этом hello портал Azure автоматически назначает доступные toohello пул IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="7e99f-272">When you do so, hello Azure portal automatically assigns an available IP address toohello pool.</span></span> <span data-ttu-id="7e99f-273">Затем можно повторно открыть пул hello интерфейсный IP-адресов и изменить назначения toostatic hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-273">You can then reopen hello front-end IP pool and change hello assignment toostatic.</span></span> 

6. <span data-ttu-id="7e99f-274">Сохраните hello IP-адрес для прослушивателя hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-274">Save hello IP address for hello listener.</span></span> 

7. <span data-ttu-id="7e99f-275">Добавьте проверку работоспособности с помощью hello следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="7e99f-275">Add a health probe by using hello following settings:</span></span>

   |<span data-ttu-id="7e99f-276">Настройка</span><span class="sxs-lookup"><span data-stu-id="7e99f-276">Setting</span></span> |<span data-ttu-id="7e99f-277">Значение</span><span class="sxs-lookup"><span data-stu-id="7e99f-277">Value</span></span>
   |:-----|:----
   |<span data-ttu-id="7e99f-278">**Имя**</span><span class="sxs-lookup"><span data-stu-id="7e99f-278">**Name**</span></span> |<span data-ttu-id="7e99f-279">Имя зонда hello tooidentify.</span><span class="sxs-lookup"><span data-stu-id="7e99f-279">A name tooidentify hello probe.</span></span>
   |<span data-ttu-id="7e99f-280">**Протокол**</span><span class="sxs-lookup"><span data-stu-id="7e99f-280">**Protocol**</span></span> |<span data-ttu-id="7e99f-281">TCP</span><span class="sxs-lookup"><span data-stu-id="7e99f-281">TCP</span></span>
   |<span data-ttu-id="7e99f-282">**Порт**</span><span class="sxs-lookup"><span data-stu-id="7e99f-282">**Port**</span></span> |<span data-ttu-id="7e99f-283">Неиспользуемый TCP-порт, который должен быть доступен для всех виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="7e99f-283">An unused TCP port, which must be available on all virtual machines.</span></span> <span data-ttu-id="7e99f-284">Он не должен использоваться для других целей.</span><span class="sxs-lookup"><span data-stu-id="7e99f-284">It cannot be used for any other purpose.</span></span> <span data-ttu-id="7e99f-285">Нет двух прослушивателей можно использовать hello же порта пробы.</span><span class="sxs-lookup"><span data-stu-id="7e99f-285">No two listeners can use hello same probe port.</span></span> 
   |<span data-ttu-id="7e99f-286">**Интервал**</span><span class="sxs-lookup"><span data-stu-id="7e99f-286">**Interval**</span></span> |<span data-ttu-id="7e99f-287">промежуток времени между пробы Hello попыток.</span><span class="sxs-lookup"><span data-stu-id="7e99f-287">hello amount of time between probe attempts.</span></span> <span data-ttu-id="7e99f-288">Используйте по умолчанию hello (5).</span><span class="sxs-lookup"><span data-stu-id="7e99f-288">Use hello default (5).</span></span>
   |<span data-ttu-id="7e99f-289">**Пороговое значение сбоя**</span><span class="sxs-lookup"><span data-stu-id="7e99f-289">**Unhealthy threshold**</span></span> |<span data-ttu-id="7e99f-290">Количество последовательных пороговых значений, которые должно не выполняться виртуальной машины будет считаться неработоспособной Hello.</span><span class="sxs-lookup"><span data-stu-id="7e99f-290">hello number of consecutive thresholds that should fail before a virtual machine is considered unhealthy.</span></span>

8. <span data-ttu-id="7e99f-291">Нажмите кнопку **ОК** toosave hello пробы.</span><span class="sxs-lookup"><span data-stu-id="7e99f-291">Click **OK** toosave hello probe.</span></span> 

9. <span data-ttu-id="7e99f-292">Создайте правило балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-292">Create a load balancing rule.</span></span> <span data-ttu-id="7e99f-293">Выберите **Правила балансировки нагрузки**, затем щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-293">Click **Load balancing rules**, and then click **Add**.</span></span>

10. <span data-ttu-id="7e99f-294">Настройка hello новый балансировки нагрузки правила с помощью hello следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="7e99f-294">Configure hello new load balancing rule by using hello following settings:</span></span>

   |<span data-ttu-id="7e99f-295">Настройка</span><span class="sxs-lookup"><span data-stu-id="7e99f-295">Setting</span></span> |<span data-ttu-id="7e99f-296">Значение</span><span class="sxs-lookup"><span data-stu-id="7e99f-296">Value</span></span>
   |:-----|:----
   |<span data-ttu-id="7e99f-297">**Имя**</span><span class="sxs-lookup"><span data-stu-id="7e99f-297">**Name**</span></span> |<span data-ttu-id="7e99f-298">Имя tooidentify hello нагрузки правила балансировки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-298">A name tooidentify hello load balancing rule.</span></span> 
   |<span data-ttu-id="7e99f-299">**Frontend IP address** (Интерфейсный IP-адрес)</span><span class="sxs-lookup"><span data-stu-id="7e99f-299">**Frontend IP address**</span></span> |<span data-ttu-id="7e99f-300">Выберите hello IP-адрес, созданный.</span><span class="sxs-lookup"><span data-stu-id="7e99f-300">Select hello IP address you created.</span></span> 
   |<span data-ttu-id="7e99f-301">**Протокол**</span><span class="sxs-lookup"><span data-stu-id="7e99f-301">**Protocol**</span></span> |<span data-ttu-id="7e99f-302">TCP</span><span class="sxs-lookup"><span data-stu-id="7e99f-302">TCP</span></span>
   |<span data-ttu-id="7e99f-303">**Порт**</span><span class="sxs-lookup"><span data-stu-id="7e99f-303">**Port**</span></span> |<span data-ttu-id="7e99f-304">Используйте порт hello, в которых используется hello экземпляров SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7e99f-304">Use hello port that hello SQL Server instances are using.</span></span> <span data-ttu-id="7e99f-305">Экземпляр по умолчанию использует порт 1433, если только вы не изменили его.</span><span class="sxs-lookup"><span data-stu-id="7e99f-305">A default instance uses port 1433, unless you changed it.</span></span> 
   |<span data-ttu-id="7e99f-306">**Внутренний порт**</span><span class="sxs-lookup"><span data-stu-id="7e99f-306">**Backend port**</span></span> |<span data-ttu-id="7e99f-307">Используйте hello совпадает со значением в **порт**.</span><span class="sxs-lookup"><span data-stu-id="7e99f-307">Use hello same value as **Port**.</span></span>
   |<span data-ttu-id="7e99f-308">**Внутренний пул**</span><span class="sxs-lookup"><span data-stu-id="7e99f-308">**Backend pool**</span></span> |<span data-ttu-id="7e99f-309">Hello пула, содержащего виртуальные машины hello hello экземплярами SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7e99f-309">hello pool that contains hello virtual machines with hello SQL Server instances.</span></span> 
   |<span data-ttu-id="7e99f-310">**Зонд работоспособности**</span><span class="sxs-lookup"><span data-stu-id="7e99f-310">**Health probe**</span></span> |<span data-ttu-id="7e99f-311">Выберите hello пробы, созданный.</span><span class="sxs-lookup"><span data-stu-id="7e99f-311">Choose hello probe you created.</span></span>
   |<span data-ttu-id="7e99f-312">**Сохранение сеанса**</span><span class="sxs-lookup"><span data-stu-id="7e99f-312">**Session persistence**</span></span> |<span data-ttu-id="7e99f-313">None</span><span class="sxs-lookup"><span data-stu-id="7e99f-313">None</span></span>
   |<span data-ttu-id="7e99f-314">**Время ожидания простоя (в минутах)**</span><span class="sxs-lookup"><span data-stu-id="7e99f-314">**Idle timeout (minutes)**</span></span> |<span data-ttu-id="7e99f-315">Оставьте значение по умолчанию (4).</span><span class="sxs-lookup"><span data-stu-id="7e99f-315">Default (4)</span></span>
   |<span data-ttu-id="7e99f-316">**Плавающий IP-адрес (прямой ответ от сервера)**</span><span class="sxs-lookup"><span data-stu-id="7e99f-316">**Floating IP (direct server return)**</span></span> | <span data-ttu-id="7e99f-317">Включено</span><span class="sxs-lookup"><span data-stu-id="7e99f-317">Enabled</span></span>

### <a name="configure-hello-availability-group-toouse-hello-new-ip-address"></a><span data-ttu-id="7e99f-318">Настройка hello доступности группы toouse hello новый IP-адрес</span><span class="sxs-lookup"><span data-stu-id="7e99f-318">Configure hello availability group toouse hello new IP address</span></span>

<span data-ttu-id="7e99f-319">toofinish настройка кластера hello hello повторите шаги при внесении hello первой группы доступности.</span><span class="sxs-lookup"><span data-stu-id="7e99f-319">toofinish configuring hello cluster, repeat hello steps that you followed when you made hello first availability group.</span></span> <span data-ttu-id="7e99f-320">То есть, настройте hello [toouse hello новый IP-адрес кластера](#configure-the-cluster-to-use-the-load-balancer-ip-address).</span><span class="sxs-lookup"><span data-stu-id="7e99f-320">That is, configure hello [cluster toouse hello new IP address](#configure-the-cluster-to-use-the-load-balancer-ip-address).</span></span> 

<span data-ttu-id="7e99f-321">После добавления IP-адрес для прослушивателя hello, настройте hello повышенную доступность группы, выполнив следующие hello:</span><span class="sxs-lookup"><span data-stu-id="7e99f-321">After you have added an IP address for hello listener, configure hello additional availability group by doing hello following:</span></span> 

1. <span data-ttu-id="7e99f-322">Убедитесь, что порт пробы hello для нового IP-адреса hello открыт на обеих виртуальных машин SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7e99f-322">Verify that hello probe port for hello new IP address is open on both SQL Server virtual machines.</span></span> 

2. <span data-ttu-id="7e99f-323">[В диспетчере кластера добавьте точку доступа клиента hello](#addcap).</span><span class="sxs-lookup"><span data-stu-id="7e99f-323">[In Cluster Manager, add hello client access point](#addcap).</span></span>

3. <span data-ttu-id="7e99f-324">[Настройка hello IP-ресурс для группы доступности hello](#congroup).</span><span class="sxs-lookup"><span data-stu-id="7e99f-324">[Configure hello IP resource for hello availability group](#congroup).</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="7e99f-325">При создании hello IP-адрес, используйте hello IP-адрес, что вы добавили toohello подсистемы балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="7e99f-325">When you create hello IP address, use hello IP address that you added toohello load balancer.</span></span>  

4. <span data-ttu-id="7e99f-326">[Сделать зависимым от точки доступа клиента hello ресурс группы доступности SQL Server hello](#dependencyGroup).</span><span class="sxs-lookup"><span data-stu-id="7e99f-326">[Make hello SQL Server availability group resource dependent on hello client access point](#dependencyGroup).</span></span>

5. <span data-ttu-id="7e99f-327">[Сделать hello клиентского доступа точки ресурса, зависящее от hello IP-адрес](#listname).</span><span class="sxs-lookup"><span data-stu-id="7e99f-327">[Make hello client access point resource dependent on hello IP address](#listname).</span></span>
 
6. <span data-ttu-id="7e99f-328">[Задайте параметры кластера hello в PowerShell](#setparam).</span><span class="sxs-lookup"><span data-stu-id="7e99f-328">[Set hello cluster parameters in PowerShell](#setparam).</span></span>

<span data-ttu-id="7e99f-329">После настройки hello доступности группы toouse hello новый IP-адрес, настройте прослушиватель toohello hello соединения.</span><span class="sxs-lookup"><span data-stu-id="7e99f-329">After you configure hello availability group toouse hello new IP address, configure hello connection toohello listener.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="7e99f-330">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="7e99f-330">Next steps</span></span>

- [<span data-ttu-id="7e99f-331">Настройка группы доступности AlwaysOn на виртуальных машинах Azure в разных регионах</span><span class="sxs-lookup"><span data-stu-id="7e99f-331">Configure a SQL Server Always On availability group on Azure virtual machines in different regions</span></span>](virtual-machines-windows-portal-sql-availability-group-dr.md)
