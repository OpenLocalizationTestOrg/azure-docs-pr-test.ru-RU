---
title: "aaaHigh доступности и аварийное восстановление для SQL Server | Документы Microsoft"
description: "Обсуждение hello различных стратегий HADR для SQL Server в виртуальных машинах Azure."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: 53981f7e-8370-4979-b26a-93a5988d905f
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 06/27/2017
ms.author: mikeray
ms.openlocfilehash: 2b62d8b30520952ba6b7da7177a2c2de95bea8ce
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="high-availability-and-disaster-recovery-for-sql-server-in-azure-virtual-machines"></a><span data-ttu-id="ce092-103">Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="ce092-103">High availability and disaster recovery for SQL Server in Azure Virtual Machines</span></span>

<span data-ttu-id="ce092-104">Виртуальные машины Microsoft Azure (ВМ) с SQL Server может помочь сократить стоимость hello решения высокого уровня доступности и аварийного восстановления (HADR) базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce092-104">Microsoft Azure virtual machines (VMs) with SQL Server can help lower hello cost of a high availability and disaster recovery (HADR) database solution.</span></span> <span data-ttu-id="ce092-105">Виртуальные машины Azure поддерживают большинство решений HADR для SQL Server как для использования только в службе Azure, так и в качестве гибридных решений.</span><span class="sxs-lookup"><span data-stu-id="ce092-105">Most SQL Server HADR solutions are supported in Azure virtual machines, both as Azure-only and as hybrid solutions.</span></span> <span data-ttu-id="ce092-106">В решении только в Azure hello вся система HADR работает в Azure.</span><span class="sxs-lookup"><span data-stu-id="ce092-106">In an Azure-only solution, hello entire HADR system runs in Azure.</span></span> <span data-ttu-id="ce092-107">В гибридной конфигурации часть решения hello выполняется в Azure и hello другие части — локально в вашей организации.</span><span class="sxs-lookup"><span data-stu-id="ce092-107">In a hybrid configuration, part of hello solution runs in Azure and hello other part runs on-premises in your organization.</span></span> <span data-ttu-id="ce092-108">Hello гибкость hello среды Azure позволяет toomove частично или полностью tooAzure toosatisfy hello бюджету и требований HADR вашего сервера SQL Server систем баз данных.</span><span class="sxs-lookup"><span data-stu-id="ce092-108">hello flexibility of hello Azure environment enables you toomove partially or completely tooAzure toosatisfy hello budget and HADR requirements of your SQL Server database systems.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-both-include.md)]

## <a name="understanding-hello-need-for-an-hadr-solution"></a><span data-ttu-id="ce092-109">Основные сведения о необходимости hello HADR-решении</span><span class="sxs-lookup"><span data-stu-id="ce092-109">Understanding hello need for an HADR solution</span></span>
<span data-ttu-id="ce092-110">Он работает tooyou tooensure, ваша система поддерживает возможности HADR hello, требует hello соглашения об уровне обслуживания (SLA).</span><span class="sxs-lookup"><span data-stu-id="ce092-110">It is up tooyou tooensure that your database system possesses hello HADR capabilities that hello service-level agreement (SLA) requires.</span></span> <span data-ttu-id="ce092-111">Hello факт, что Azure предоставляет механизмы высокого уровня доступности, такие как восстановление облачных служб и обнаружение восстановления после сбоя для виртуальных машин не сам гарантирует, что можно достичь требуемой hello соглашения об уровне ОБСЛУЖИВАНИЯ.</span><span class="sxs-lookup"><span data-stu-id="ce092-111">hello fact that Azure provides high availability mechanisms, such as service healing for cloud services and failure recovery detection for Virtual Machines, does not itself guarantee you can meet hello desired SLA.</span></span> <span data-ttu-id="ce092-112">Эти механизмы защищают высокий уровень доступности hello hello виртуальные машины, но не hello высокой доступности SQL Server, работающей ВМ hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-112">These mechanisms protect hello high availability of hello VMs but not hello high availability of SQL Server running inside hello VMs.</span></span> <span data-ttu-id="ce092-113">Существует возможность toofail экземпляр SQL Server hello, пока hello виртуальной Машины и исправен.</span><span class="sxs-lookup"><span data-stu-id="ce092-113">It is possible for hello SQL Server instance toofail while hello VM is online and healthy.</span></span> <span data-ttu-id="ce092-114">Кроме того, разрешить hello даже механизмы высокого уровня доступности, предоставляемые Azure времени простоя для hello виртуальных машин из-за tooevents, такие как восстановление после сбоев оборудования или программного обеспечения и обновлений операционной системы.</span><span class="sxs-lookup"><span data-stu-id="ce092-114">Moreover, even hello high availability mechanisms provided by Azure allow for downtime of hello VMs due tooevents such as recovery from software or hardware failures and operating system upgrades.</span></span>

<span data-ttu-id="ce092-115">Кроме того, геоизбыточного хранилища (GRS) в Azure, которое реализуется с помощью такой функции, как георепликация, может оказаться недостаточно для аварийного восстановления баз данных.</span><span class="sxs-lookup"><span data-stu-id="ce092-115">In addition, Geo Redundant Storage (GRS) in Azure, which is implemented with a feature called geo-replication, may not be an adequate disaster recovery solution for your databases.</span></span> <span data-ttu-id="ce092-116">Поскольку георепликация отправляет данные асинхронно, последние обновления может быть потеряна в событии hello аварии.</span><span class="sxs-lookup"><span data-stu-id="ce092-116">Because geo-replication sends data asynchronously, recent updates can be lost in hello event of disaster.</span></span> <span data-ttu-id="ce092-117">Дополнительные сведения об ограничениях георепликации охваченных hello [георепликация не поддерживается для файлов данных и журналов на разных дисках](#geo-replication-support) раздела.</span><span class="sxs-lookup"><span data-stu-id="ce092-117">More information regarding geo-replication limitations are covered in hello [Geo-replication not supported for data and log files on separate disks](#geo-replication-support) section.</span></span>

## <a name="hadr-deployment-architectures"></a><span data-ttu-id="ce092-118">Архитектуры развертывания HADR</span><span class="sxs-lookup"><span data-stu-id="ce092-118">HADR deployment architectures</span></span>
<span data-ttu-id="ce092-119">В Azure поддерживаются следующие технологии HADR для SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ce092-119">SQL Server HADR technologies that are supported in Azure include:</span></span>

* [<span data-ttu-id="ce092-120">Группы доступности Always On</span><span class="sxs-lookup"><span data-stu-id="ce092-120">Always On Availability Groups</span></span>](https://technet.microsoft.com/library/hh510230.aspx)
* [<span data-ttu-id="ce092-121">Экземпляры отказоустойчивого кластера Always On</span><span class="sxs-lookup"><span data-stu-id="ce092-121">Always On Failover Cluster Instances</span></span>](https://technet.microsoft.com/library/ms189134.aspx)
* [<span data-ttu-id="ce092-122">Доставка журналов</span><span class="sxs-lookup"><span data-stu-id="ce092-122">Log Shipping</span></span>](https://technet.microsoft.com/library/ms187103.aspx)
* [<span data-ttu-id="ce092-123">Резервное копирование и восстановление SQL Server с помощью службы хранилища BLOB-объектов Azure</span><span class="sxs-lookup"><span data-stu-id="ce092-123">SQL Server Backup and Restore with Azure Blob Storage Service</span></span>](https://msdn.microsoft.com/library/jj919148.aspx)
* <span data-ttu-id="ce092-124">[Зеркальное отображение базы данных (SQL Server)](https://technet.microsoft.com/library/ms189852.aspx) — устаревшее в SQL Server 2016</span><span class="sxs-lookup"><span data-stu-id="ce092-124">[Database Mirroring](https://technet.microsoft.com/library/ms189852.aspx) - Deprecated in SQL Server 2016</span></span>

<span data-ttu-id="ce092-125">Это возможно toocombine hello технологий вместе tooimplement решение SQL Server, который имеет высокий уровень доступности и возможности аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="ce092-125">It is possible toocombine hello technologies together tooimplement a SQL Server solution that has both high availability and disaster recovery capabilities.</span></span> <span data-ttu-id="ce092-126">В зависимости от используемой технологии hello гибридного развертывания может потребоваться VPN-туннель с hello виртуальной сети Azure.</span><span class="sxs-lookup"><span data-stu-id="ce092-126">Depending on hello technology you use, a hybrid deployment may require a VPN tunnel with hello Azure virtual network.</span></span> <span data-ttu-id="ce092-127">в следующих разделах Hello показаны некоторые примеры архитектур развертывания hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-127">hello sections below show you some of hello example deployment architectures.</span></span>

## <a name="azure-only-high-availability-solutions"></a><span data-ttu-id="ce092-128">Только в Azure: решения высокого уровня доступности</span><span class="sxs-lookup"><span data-stu-id="ce092-128">Azure-only: High availability solutions</span></span>

<span data-ttu-id="ce092-129">Решение для обеспечения высокого уровня доступности SQL Server можно реализовать на уровне базы данных с помощью групп доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="ce092-129">You can have a high availability solution for SQL Server at a database level with Always On Availability Groups - called availability groups.</span></span> <span data-ttu-id="ce092-130">Его можно также создать на уровне экземпляра с помощью экземпляров отказоустойчивого кластера AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="ce092-130">You can also create a high availability solution at an instance level with Always On Failover Cluster Instances - failover cluster instances.</span></span> <span data-ttu-id="ce092-131">Чтобы повысить избыточность на обоих уровнях, можно также создать группы доступности для экземпляров отказоустойчивого кластера.</span><span class="sxs-lookup"><span data-stu-id="ce092-131">For additional redundancy, you can create redundancy at both levels by creating availability groups on failover cluster instances.</span></span> 

| <span data-ttu-id="ce092-132">Технология</span><span class="sxs-lookup"><span data-stu-id="ce092-132">Technology</span></span> | <span data-ttu-id="ce092-133">Примеры архитектур</span><span class="sxs-lookup"><span data-stu-id="ce092-133">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="ce092-134">**Группы доступности**</span><span class="sxs-lookup"><span data-stu-id="ce092-134">**Availability groups**</span></span> |<span data-ttu-id="ce092-135">Таким же Здравствуйте, реплики доступности выполняются на виртуальных машинах Azure в области обеспечения высокого уровня доступности.</span><span class="sxs-lookup"><span data-stu-id="ce092-135">Availability replicas running in Azure VMs in hello same region provide high availability.</span></span> <span data-ttu-id="ce092-136">Необходимо tooconfigure контроллер домена виртуальной Машины, так как отказоустойчивая кластеризация Windows требуется домен Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ce092-136">You need tooconfigure a domain controller VM, because Windows failover clustering requires an Active Directory domain.</span></span><br/> <span data-ttu-id="ce092-137">![Группы доступности](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span><span class="sxs-lookup"><span data-stu-id="ce092-137">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span></span><br/><span data-ttu-id="ce092-138">Дополнительные сведения см. в статье [Автоматическая настройка групп доступности AlwaysOn на виртуальных машинах Azure с использованием Resource Manager](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-138">For more information, see [Configure Availability Groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span> |
| <span data-ttu-id="ce092-139">**Экземпляры отказоустойчивого кластера**</span><span class="sxs-lookup"><span data-stu-id="ce092-139">**Failover cluster instances**</span></span> |<span data-ttu-id="ce092-140">Экземпляры отказоустойчивого кластера (FCI), которые требуют наличия общего хранилища, можно создавать тремя способами.</span><span class="sxs-lookup"><span data-stu-id="ce092-140">Failover Cluster Instances (FCI), which require shared storage, can be created in 3 different ways.</span></span><br/><br/><span data-ttu-id="ce092-141">1. В двухузловом отказоустойчивом кластере в виртуальных машинах Azure с хранилищем с помощью [Windows Server 2016 Storage Spaces Direct \(S2D\) ](virtual-machines-windows-portal-sql-create-failover-cluster.md) tooprovide виртуальную сеть SAN на основе программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="ce092-141">1. A two-node failover cluster running in Azure VMs with attached storage using [Windows Server 2016 Storage Spaces Direct \(S2D\)](virtual-machines-windows-portal-sql-create-failover-cluster.md) tooprovide a software-based virtual SAN.</span></span><br/><br/><span data-ttu-id="ce092-142">2. Отказоустойчивый кластер с двумя узлами, выполняющийся на виртуальных машинах Azure, с хранилищем, поддерживаемым сторонним решением кластеризации.</span><span class="sxs-lookup"><span data-stu-id="ce092-142">2. A two-node failover cluster running in Azure VMs with storage supported by a third-party clustering solution.</span></span> <span data-ttu-id="ce092-143">Конкретный пример, в котором используется SIOS DataKeeper, приведен в публикации блога [High Availability for a file share using WSFC, ILB and 3rd-party Software SIOS Datakeeper](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/) (Обеспечение высокого уровня доступности файлового ресурса с помощью WSFC, внутренней подсистемы балансировки нагрузки и стороннего ПО SIOS Datakeeper).</span><span class="sxs-lookup"><span data-stu-id="ce092-143">For a specific example that uses SIOS DataKeeper, see [High availability for a file share using failover clustering and 3rd party software SIOS DataKeeper](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/).</span></span><br/><br/><span data-ttu-id="ce092-144">3. Отказоустойчивый кластер с двумя узлами, выполняющийся на виртуальных машинах Azure, с удаленным целевым общим блочным хранилищем iSCSI, подключенным через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="ce092-144">3. A two-node failover cluster running in Azure VMs with remote iSCSI Target shared block storage via ExpressRoute.</span></span> <span data-ttu-id="ce092-145">Например NetApp частного хранилища (NPS) обеспечивает доступ к цели iSCSI через ExpressRoute с Equinix tooAzure виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="ce092-145">For example, NetApp Private Storage (NPS) exposes an iSCSI target via ExpressRoute with Equinix tooAzure VMs.</span></span><br/><br/><span data-ttu-id="ce092-146">Для общего хранилища сторонних решений и данных репликации следует обратиться к поставщику hello tooaccessing связанных данных проблем при отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="ce092-146">For third-party shared storage and data replication solutions, you should contact hello vendor for any issues related tooaccessing data on failover.</span></span><br/><br/><span data-ttu-id="ce092-147">Обратите внимание, что использование экземпляра FCI поверх [хранилища файлов Azure](https://azure.microsoft.com/services/storage/files/) пока не поддерживается, так как это решение не использует хранилище уровня "Премиум".</span><span class="sxs-lookup"><span data-stu-id="ce092-147">Note that using FCI on top of [Azure File storage](https://azure.microsoft.com/services/storage/files/) is not supported yet, because this solution does not utilize Premium Storage.</span></span> <span data-ttu-id="ce092-148">Мы активно работаем над toosupport этом скоро.</span><span class="sxs-lookup"><span data-stu-id="ce092-148">We are working toosupport this soon.</span></span> |

## <a name="azure-only-disaster-recovery-solutions"></a><span data-ttu-id="ce092-149">Только в Azure: решения аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="ce092-149">Azure-only: Disaster recovery solutions</span></span>
<span data-ttu-id="ce092-150">У вас может быть решение аварийного восстановления для баз данных SQL Server в Azure, использующее группы доступности, зеркальное отображение базы данных или архивацию и восстановление с большими двоичными объектами хранилища.</span><span class="sxs-lookup"><span data-stu-id="ce092-150">You can have a disaster recovery solution for your SQL Server databases in Azure using availability groups, database mirroring, or backup and restore with storage blobs.</span></span>

| <span data-ttu-id="ce092-151">Технология</span><span class="sxs-lookup"><span data-stu-id="ce092-151">Technology</span></span> | <span data-ttu-id="ce092-152">Примеры архитектур</span><span class="sxs-lookup"><span data-stu-id="ce092-152">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="ce092-153">**Группы доступности**</span><span class="sxs-lookup"><span data-stu-id="ce092-153">**Availability Groups**</span></span> |<span data-ttu-id="ce092-154">Реплики доступности, выполняемые в нескольких центрах обработки данных на виртуальных машинах Azure для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="ce092-154">Availability replicas running across multiple datacenters in Azure VMs for disaster recovery.</span></span> <span data-ttu-id="ce092-155">Это межрегиональное решение обеспечивает защиту от простоя всего сайта.</span><span class="sxs-lookup"><span data-stu-id="ce092-155">This cross-region solution protects against complete site outage.</span></span> <br/> <span data-ttu-id="ce092-156">![Группы доступности](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span><span class="sxs-lookup"><span data-stu-id="ce092-156">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span></span><br/><span data-ttu-id="ce092-157">В области все реплики должны быть в пределах hello же облачную службу и hello одной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="ce092-157">Within a region, all replicas should be within hello same cloud service and hello same VNet.</span></span> <span data-ttu-id="ce092-158">Так как в каждом регионе может быть отдельная VNet, эти решения требуют подключения к виртуальной сети tooVNet.</span><span class="sxs-lookup"><span data-stu-id="ce092-158">Because each region will have a separate VNet, these solutions require VNet tooVNet connectivity.</span></span> <span data-ttu-id="ce092-159">Дополнительные сведения см. в разделе [VNet к VNet Настройка соединения с помощью портала Azure "hello"](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-159">For more information, see [Configure a VNet-to-VNet connection using hello Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span></span> <span data-ttu-id="ce092-160">Подробные инструкции см. в статье [Настройка группы доступности AlwaysOn на виртуальных машинах Azure в разных регионах](virtual-machines-windows-portal-sql-availability-group-dr.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-160">For detailed instructions, see [Configure a SQL Server Availability Group on Azure Virtual Machines in Different Regions](virtual-machines-windows-portal-sql-availability-group-dr.md).</span></span>|
| <span data-ttu-id="ce092-161">**Зеркальное отображение базы данных**</span><span class="sxs-lookup"><span data-stu-id="ce092-161">**Database Mirroring**</span></span> |<span data-ttu-id="ce092-162">Основной, зеркальный и другие серверы, выполняемые в разных центрах обработки данных для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="ce092-162">Principal and mirror and servers running in different datacenters for disaster recovery.</span></span> <span data-ttu-id="ce092-163">Для развертывания необходимо использовать сертификаты сервера, так как домен Active Directory не может охватывать несколько центров обработки данных.</span><span class="sxs-lookup"><span data-stu-id="ce092-163">You must deploy using server certificates because an active directory domain cannot span multiple datacenters.</span></span><br/>![Зеркальное отображение базы данных](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_dbmirroring.gif) |
| <span data-ttu-id="ce092-165">**Резервное копирование и восстановление с помощью службы хранилища больших двоичных объектов Azure**</span><span class="sxs-lookup"><span data-stu-id="ce092-165">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="ce092-166">Производственные базы данных, резервные копии непосредственно tooblob хранилища в другом центре обработки данных для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="ce092-166">Production databases backed up directly tooblob storage in a different datacenter for disaster recovery.</span></span><br/><span data-ttu-id="ce092-167">![Резервное копирование и восстановление](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="ce092-167">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="ce092-168">Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-168">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="hybrid-it-disaster-recovery-solutions"></a><span data-ttu-id="ce092-169">Гибридная ИТ-среда: решения аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="ce092-169">Hybrid IT: Disaster recovery solutions</span></span>
<span data-ttu-id="ce092-170">У вас может быть решение аварийного восстановления для баз данных SQL Server в гибридной ИТ-среде, использующее группы доступности, зеркальное отображение базы данных и доставку журналов, а также архивацию и восстановление с помощью хранилища больших двоичных объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="ce092-170">You can have a disaster recovery solution for your SQL Server databases in a hybrid-IT environment using availability groups, database mirroring, log shipping, and backup and restore with Azure blog storage.</span></span>

| <span data-ttu-id="ce092-171">Технология</span><span class="sxs-lookup"><span data-stu-id="ce092-171">Technology</span></span> | <span data-ttu-id="ce092-172">Примеры архитектур</span><span class="sxs-lookup"><span data-stu-id="ce092-172">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="ce092-173">**Группы доступности**</span><span class="sxs-lookup"><span data-stu-id="ce092-173">**Availability Groups**</span></span> |<span data-ttu-id="ce092-174">Некоторые реплики доступности, выполняемые на виртуальных машинах Azure, и другие реплики, которые выполняются локально для аварийного восстановления на нескольких сайтах.</span><span class="sxs-lookup"><span data-stu-id="ce092-174">Some availability replicas running in Azure VMs and other replicas running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="ce092-175">Hello рабочий сайт может размещаться локально или в центре обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="ce092-175">hello production site can be either on-premises or in an Azure datacenter.</span></span><br/>![Группы доступности](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_alwayson.gif)<br/><span data-ttu-id="ce092-177">Поскольку все реплики доступности должны находиться в hello один отказоустойчивый кластер hello кластер должен охватывать обе сети (несколькими подсетями отказоустойчивого кластера).</span><span class="sxs-lookup"><span data-stu-id="ce092-177">Because all availability replicas must be in hello same failover cluster, hello cluster must span both networks (a multi-subnet failover cluster).</span></span> <span data-ttu-id="ce092-178">Этой конфигурации требуется VPN-подключение между Azure и hello в локальной сети.</span><span class="sxs-lookup"><span data-stu-id="ce092-178">This configuration requires a VPN connection between Azure and hello on-premises network.</span></span><br/><br/><span data-ttu-id="ce092-179">Для успешного аварийного восстановления баз данных следует также установить реплики контроллера домена на сайте аварийного восстановления hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-179">For successful disaster recovery of your databases, you should also install a replica domain controller at hello disaster recovery site.</span></span><br/><br/><span data-ttu-id="ce092-180">Это возможно toouse приветствия мастера добавления реплики в SSMS tooadd tooan реплики Azure существующей группы доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="ce092-180">It is possible toouse hello Add Replica Wizard in SSMS tooadd an Azure replica tooan existing Always On Availability Group.</span></span> <span data-ttu-id="ce092-181">Дополнительные сведения см. в разделе учебника: расширить tooAzure вашей группы доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="ce092-181">For more information, see Tutorial: Extend your Always On Availability Group tooAzure.</span></span> |
| <span data-ttu-id="ce092-182">**Зеркальное отображение базы данных**</span><span class="sxs-lookup"><span data-stu-id="ce092-182">**Database Mirroring**</span></span> |<span data-ttu-id="ce092-183">Один участник выполняется на ВМ Azure, а другие hello выполняется локально для межсайтовой аварийного восстановления, с использованием сертификатов сервера.</span><span class="sxs-lookup"><span data-stu-id="ce092-183">One partner running in an Azure VM and hello other running on-premises for cross-site disaster recovery using server certificates.</span></span> <span data-ttu-id="ce092-184">Партнеры не обязательно toobe в Привет одному домену Active Directory и VPN-подключение не требуется.</span><span class="sxs-lookup"><span data-stu-id="ce092-184">Partners do not need toobe in hello same Active Directory domain, and no VPN connection is required.</span></span><br/><span data-ttu-id="ce092-185">![Зеркальное отображение базы данных](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span><span class="sxs-lookup"><span data-stu-id="ce092-185">![Database Mirroring](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span></span><br/><span data-ttu-id="ce092-186">Сценарии зеркального отражения другой базы данных включает в себя один участник выполняется на виртуальной Машине Azure и hello другой выполняется локально в hello же домене Active Directory для аварийного восстановления между сайтами.</span><span class="sxs-lookup"><span data-stu-id="ce092-186">Another database mirroring scenario involves one partner running in an Azure VM and hello other running on-premises in hello same Active Directory domain for cross-site disaster recovery.</span></span> <span data-ttu-id="ce092-187">Объект [VPN-подключение между hello Azure виртуальной сети и hello в локальной сети](../../../vpn-gateway/vpn-gateway-site-to-site-create.md) является обязательным.</span><span class="sxs-lookup"><span data-stu-id="ce092-187">A [VPN connection between hello Azure virtual network and hello on-premises network](../../../vpn-gateway/vpn-gateway-site-to-site-create.md) is required.</span></span><br/><br/><span data-ttu-id="ce092-188">Для успешного аварийного восстановления баз данных следует также установить реплики контроллера домена на сайте аварийного восстановления hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-188">For successful disaster recovery of your databases, you should also install a replica domain controller at hello disaster recovery site.</span></span> |
| <span data-ttu-id="ce092-189">**Доставка журналов**</span><span class="sxs-lookup"><span data-stu-id="ce092-189">**Log Shipping**</span></span> |<span data-ttu-id="ce092-190">Один сервер работает на виртуальной Машине Azure и других hello выполняется локально для аварийного восстановления между сайтами.</span><span class="sxs-lookup"><span data-stu-id="ce092-190">One server running in an Azure VM and hello other running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="ce092-191">Доставка журналов зависит от совместное использование файлов Windows, поэтому VPN-подключение между hello виртуальной сети Azure и hello в локальной сети не требуется.</span><span class="sxs-lookup"><span data-stu-id="ce092-191">Log shipping depends on Windows file sharing, so a VPN connection between hello Azure virtual network and hello on-premises network is required.</span></span><br/>![Доставка журналов](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_log_shipping.gif)<br/><span data-ttu-id="ce092-193">Для успешного аварийного восстановления баз данных следует также установить реплики контроллера домена на сайте аварийного восстановления hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-193">For successful disaster recovery of your databases, you should also install a replica domain controller at hello disaster recovery site.</span></span> |
| <span data-ttu-id="ce092-194">**Резервное копирование и восстановление с помощью службы хранилища больших двоичных объектов Azure**</span><span class="sxs-lookup"><span data-stu-id="ce092-194">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="ce092-195">Локальных рабочих баз данных, резервные копии непосредственно tooAzure хранилища BLOB-данных для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="ce092-195">On-premises production databases backed up directly tooAzure blob storage for disaster recovery.</span></span><br/><span data-ttu-id="ce092-196">![Резервное копирование и восстановление](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="ce092-196">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="ce092-197">Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-197">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="important-considerations-for-sql-server-hadr-in-azure"></a><span data-ttu-id="ce092-198">Важные соображения в отношении HADR для SQL Server в Azure</span><span class="sxs-lookup"><span data-stu-id="ce092-198">Important considerations for SQL Server HADR in Azure</span></span>
<span data-ttu-id="ce092-199">Виртуальные машины, хранилища и сети Azure имеют рабочие характеристики, отличные от характеристик локальной, невиртуализированной ИТ-инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="ce092-199">Azure VMs, storage, and networking have different operational characteristics than an on-premises, non-virtualized IT infrastructure.</span></span> <span data-ttu-id="ce092-200">Для успешной реализации решение HADR SQL Server в Azure необходимо понимать эти различия и разработать вашего решения tooaccommodate их.</span><span class="sxs-lookup"><span data-stu-id="ce092-200">A successful implementation of a HADR SQL Server solution in Azure requires that you understand these differences and design your solution tooaccommodate them.</span></span>

### <a name="high-availability-nodes-in-an-availability-set"></a><span data-ttu-id="ce092-201">Узлы с высоким уровнем доступности в группе доступности</span><span class="sxs-lookup"><span data-stu-id="ce092-201">High availability nodes in an availability set</span></span>
<span data-ttu-id="ce092-202">Группы доступности в Azure включить узлы высокой доступности tooplace hello в отдельном ошибки доменах отказоустойчивости и обновления доменах.</span><span class="sxs-lookup"><span data-stu-id="ce092-202">Availability sets in Azure enable you tooplace hello high availability nodes into separate Fault Domains (FDs) and Update Domains (UDs).</span></span> <span data-ttu-id="ce092-203">Виртуальные машины Azure toobe помещается в hello же группу доступности необходимо развернуть их в hello же облачной службе.</span><span class="sxs-lookup"><span data-stu-id="ce092-203">For Azure VMs toobe placed in hello same availability set, you must deploy them in hello same cloud service.</span></span> <span data-ttu-id="ce092-204">Только узлы в одной облачной службе могут участвовать в приветствия hello одной группе доступности.</span><span class="sxs-lookup"><span data-stu-id="ce092-204">Only nodes in hello same cloud service can participate in hello same availability set.</span></span> <span data-ttu-id="ce092-205">Дополнительные сведения см. в разделе [hello Управление доступностью виртуальных машин](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="ce092-205">For more information, see [Manage hello Availability of Virtual Machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

### <a name="failover-cluster-behavior-in-azure-networking"></a><span data-ttu-id="ce092-206">Поведение отказоустойчивого кластера в сети Azure</span><span class="sxs-lookup"><span data-stu-id="ce092-206">Failover cluster behavior in Azure networking</span></span>
<span data-ttu-id="ce092-207">Hello не соответствует RFC служба DHCP в Azure может привести к hello создания определенных toofail кластера конфигурации отработки отказа, из-за сетевого имени кластера toohello, присваиваемого дублирующийся IP-адрес, например hello же IP-адрес как один из узлов кластера hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-207">hello non-RFC-compliant DHCP service in Azure can cause hello creation of certain failover cluster configurations toofail, due toohello cluster network name being assigned a duplicate IP address, such as hello same IP address as one of hello cluster nodes.</span></span> <span data-ttu-id="ce092-208">Это важно при реализации групп доступности, который зависит от компонента отказоустойчивого кластера для Windows hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-208">This is an issue when you implement Availability Groups, which depends on hello Windows failover cluster feature.</span></span>

<span data-ttu-id="ce092-209">Рассмотрим сценарий hello, при создании двухузлового кластера и перевести в оперативный режим.</span><span class="sxs-lookup"><span data-stu-id="ce092-209">Consider hello scenario when a two-node cluster is created and brought online:</span></span>

1. <span data-ttu-id="ce092-210">Hello кластер переходит в оперативный режим, а затем NODE1 запрашивает динамически назначаемый IP-адрес для сетевого имени кластера hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-210">hello cluster comes online, then NODE1 requests a dynamically assigned IP address for hello cluster network name.</span></span>
2. <span data-ttu-id="ce092-211">Отсутствует IP-адрес, отличный от NODE1 собственный IP-адрес задается hello службой DHCP, так как hello служба DHCP распознает, что hello запрос поступает от NODE1 сам.</span><span class="sxs-lookup"><span data-stu-id="ce092-211">No IP address other than NODE1’s own IP address is given by hello DHCP service, since hello DHCP service recognizes that hello request comes from NODE1 itself.</span></span>
3. <span data-ttu-id="ce092-212">Windows обнаруживает, что повторяющийся адрес назначен tooNODE1 и toohello сетевое имя отказоустойчивого кластера и группы кластера по умолчанию hello не toocome через Интернет.</span><span class="sxs-lookup"><span data-stu-id="ce092-212">Windows detects that a duplicate address is assigned both tooNODE1 and toohello failover cluster network name, and hello default cluster group fails toocome online.</span></span>
4. <span data-ttu-id="ce092-213">Кластерная группа по умолчанию Hello перемещает tooNODE2, который обрабатывает IP-адрес NODE1 как IP-адрес кластера hello и переводит группу кластера по умолчанию hello через Интернет.</span><span class="sxs-lookup"><span data-stu-id="ce092-213">hello default cluster group moves tooNODE2, which treats NODE1’s IP address as hello cluster IP address and brings hello default cluster group online.</span></span>
5. <span data-ttu-id="ce092-214">Когда NODE2 пытается tooestablish соединение с NODE1, пакеты, направляемые на NODE1 никогда не покидают NODE2, так как он разрешается NODE1 IP адрес tooitself.</span><span class="sxs-lookup"><span data-stu-id="ce092-214">When NODE2 attempts tooestablish connectivity with NODE1, packets directed at NODE1 never leave NODE2 because it resolves NODE1’s IP address tooitself.</span></span> <span data-ttu-id="ce092-215">NODE2 не может установить соединение с NODE1, теряет кворум и завершает работу кластера hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-215">NODE2 cannot establish connectivity with NODE1, then loses quorum and shuts down hello cluster.</span></span>
6. <span data-ttu-id="ce092-216">В это время hello NODE1 может отправлять пакеты tooNODE2, но NODE2 не может ответить.</span><span class="sxs-lookup"><span data-stu-id="ce092-216">In hello meantime, NODE1 can send packets tooNODE2, but NODE2 cannot reply.</span></span> <span data-ttu-id="ce092-217">NODE1 теряет кворум и завершает работу кластера hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-217">NODE1 loses quorum and shuts down hello cluster.</span></span>

<span data-ttu-id="ce092-218">Этот сценарий можно избежать, если назначить неиспользуемый статический IP-адрес, такие как IP-адрес локальной связи, такой как 169.254.1.1, toohello сетевое имя кластера в порядке toobring hello сетевое имя кластера в оперативный режим.</span><span class="sxs-lookup"><span data-stu-id="ce092-218">This scenario can be avoided by assigning an unused static IP address, such as a link-local IP address like 169.254.1.1, toohello cluster network name in order toobring hello cluster network name online.</span></span> <span data-ttu-id="ce092-219">toosimplify Эта процедура, в разделе [отказоустойчивого кластера Windows, Настройка в Azure для групп доступности](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx).</span><span class="sxs-lookup"><span data-stu-id="ce092-219">toosimplify this process, see [Configuring Windows failover cluster in Azure for availability groups](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx).</span></span>

<span data-ttu-id="ce092-220">Дополнительные сведения см. в статье [Автоматическая настройка групп доступности AlwaysOn на виртуальных машинах Azure с использованием Resource Manager](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-220">For more information, see [Configure availability groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span>

### <a name="availability-group-listener-support"></a><span data-ttu-id="ce092-221">Поддержка прослушивателя группы доступности</span><span class="sxs-lookup"><span data-stu-id="ce092-221">Availability group listener support</span></span>
<span data-ttu-id="ce092-222">Прослушиватели группы доступности поддерживаются на виртуальных машинах Azure, работающих под управлением Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2 и Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="ce092-222">Availability group listeners are supported on Azure VMs running Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2, and Windows Server 2016.</span></span> <span data-ttu-id="ce092-223">Эта поддержка возможна при hello использование конечных точек с балансировкой нагрузки включена на виртуальных машинах Azure hello, являющихся узлами группы доступности.</span><span class="sxs-lookup"><span data-stu-id="ce092-223">This support is made possible by hello use of load-balanced endpoints enabled on hello Azure VMs that are availability group nodes.</span></span> <span data-ttu-id="ce092-224">Выполните специальные шаги настройки для hello toowork прослушиватели для обоих клиентских приложений, выполняющихся в Azure, а также те выполняется локально.</span><span class="sxs-lookup"><span data-stu-id="ce092-224">You must follow special configuration steps for hello listeners toowork for both client applications that are running in Azure as well as those running on-premises.</span></span>

<span data-ttu-id="ce092-225">Существует два основных способа настройки: внешний (общедоступный) или внутренний прослушиватель.</span><span class="sxs-lookup"><span data-stu-id="ce092-225">There are two main options for setting up your listener: external (public) or internal.</span></span> <span data-ttu-id="ce092-226">использует внешних (открытых) прослушиватель Hello из Интернета, подсистема балансировки нагрузки и связан с открытый виртуальных IP-адресов (VIP), доступном через hello Интернета.</span><span class="sxs-lookup"><span data-stu-id="ce092-226">hello external (public) listener uses an internet facing load balancer and is associated with a public Virtual IP (VIP) that is accessible over hello internet.</span></span> <span data-ttu-id="ce092-227">Внутренний прослушиватель использует внутренний балансировщик нагрузки и только для поддержки клиентов в пределах hello одной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="ce092-227">An internal listener uses an internal load balancer and only supports clients within hello same Virtual Network.</span></span> <span data-ttu-id="ce092-228">Для обоих типов балансировщика нагрузки необходимо включить прямой ответ от сервера.</span><span class="sxs-lookup"><span data-stu-id="ce092-228">For either load balancer type, you must enable Direct Server Return.</span></span> 

<span data-ttu-id="ce092-229">Если hello группа доступности распространяется на несколько подсетей, Azure (например, развертывания, пересекающего регионы Azure), необходимо включить строку подключения клиента hello»**MultisubnetFailover = True**».</span><span class="sxs-lookup"><span data-stu-id="ce092-229">If hello Availability Group spans multiple Azure subnets (such as a deployment that crosses Azure regions), hello client connection string must include "**MultisubnetFailover=True**".</span></span> <span data-ttu-id="ce092-230">Это приводит к реплик toohello попытки параллельных подключений в разных подсетях hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-230">This results in parallel connection attempts toohello replicas in hello different subnets.</span></span> <span data-ttu-id="ce092-231">Инструкции по настройке прослушивателя см. в разделах:</span><span class="sxs-lookup"><span data-stu-id="ce092-231">For instructions on setting up a listener, see</span></span>

* <span data-ttu-id="ce092-232">[Настройка прослушивателя внутренней подсистемы балансировки нагрузки для групп доступности в Azure](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-232">[Configure an ILB listener for availability groups in Azure](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md).</span></span>
* <span data-ttu-id="ce092-233">[Настройка внешнего прослушивателя для групп доступности в Azure](../classic/ps-sql-ext-listener.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-233">[Configure an external listener for availability groups in Azure](../classic/ps-sql-ext-listener.md).</span></span>

<span data-ttu-id="ce092-234">Вы можете подключаться tooeach реплике доступности отдельно, напрямую подключившись toohello экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="ce092-234">You can still connect tooeach availability replica separately by connecting directly toohello service instance.</span></span> <span data-ttu-id="ce092-235">Кроме того, поскольку группы доступности обратно совместимы с клиентами зеркального отображения базы данных, можно подключиться toohello репликам доступности как к участникам зеркального отображения при условии, что hello реплики настроены как toodatabase зеркального отображения:</span><span class="sxs-lookup"><span data-stu-id="ce092-235">Also, since availability groups are backward compatible with database mirroring clients, you can connect toohello availability replicas like database mirroring partners as long as hello replicas are configured similar toodatabase mirroring:</span></span>

* <span data-ttu-id="ce092-236">имеется по одной первичной и вторичной реплике;</span><span class="sxs-lookup"><span data-stu-id="ce092-236">One primary replica and one secondary replica</span></span>
* <span data-ttu-id="ce092-237">Hello вторичная реплика настроена как недоступный для чтения (**вторичной** параметр установлен слишком**нет**)</span><span class="sxs-lookup"><span data-stu-id="ce092-237">hello secondary replica is configured as non-readable (**Readable Secondary** option set too**No**)</span></span>

<span data-ttu-id="ce092-238">Пример строки подключения клиента, соответствующий конфигурации подобной зеркальному отображению базы данных toothis, с использованием ADO.NET или собственный клиент SQL Server используется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ce092-238">An example client connection string that corresponds toothis database mirroring-like configuration using ADO.NET or SQL Server Native Client is below:</span></span>

    Data Source=ReplicaServer1;Failover Partner=ReplicaServer2;Initial Catalog=AvailabilityDatabase;

<span data-ttu-id="ce092-239">Дополнительные сведения о подключении клиента см. в следующих статьях.</span><span class="sxs-lookup"><span data-stu-id="ce092-239">For more information on client connectivity, see:</span></span>

* [<span data-ttu-id="ce092-240">Использование ключевых слов строки подключения с собственным клиентом SQL Server</span><span class="sxs-lookup"><span data-stu-id="ce092-240">Using Connection String Keywords with SQL Server Native Client</span></span>](https://msdn.microsoft.com/library/ms130822.aspx)
* [<span data-ttu-id="ce092-241">Подключение клиентов tooa сеанса зеркального отображения базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ce092-241">Connect Clients tooa Database Mirroring Session (SQL Server)</span></span>](https://technet.microsoft.com/library/ms175484.aspx)
* [<span data-ttu-id="ce092-242">Подключение tooAvailability прослушиватель группы в гибридной ИТ</span><span class="sxs-lookup"><span data-stu-id="ce092-242">Connecting tooAvailability Group Listener in Hybrid IT</span></span>](http://blogs.msdn.com/b/sqlalwayson/archive/2013/02/14/connecting-to-availability-group-listener-in-hybrid-it.aspx)
* [<span data-ttu-id="ce092-243">Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ce092-243">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>](https://technet.microsoft.com/library/hh213417.aspx)
* [<span data-ttu-id="ce092-244">Использование строк подключения к зеркально отображаемой базе данных с группами доступности</span><span class="sxs-lookup"><span data-stu-id="ce092-244">Using Database-Mirroring Connection Strings with Availability Groups</span></span>](https://technet.microsoft.com/library/hh213417.aspx)

### <a name="network-latency-in-hybrid-it"></a><span data-ttu-id="ce092-245">Задержки сети в гибридной ИТ-среде</span><span class="sxs-lookup"><span data-stu-id="ce092-245">Network latency in hybrid IT</span></span>
<span data-ttu-id="ce092-246">Следует развернуть решение HADR hello предположение, что может быть периоды времени задержки между локальной сетью и Azure.</span><span class="sxs-lookup"><span data-stu-id="ce092-246">You should deploy your HADR solution with hello assumption that there may be periods of time with high network latency between your on-premises network and Azure.</span></span> <span data-ttu-id="ce092-247">При развертывании tooAzure реплики, следует использовать асинхронную фиксацию вместо одновременной фиксации для режима синхронизации hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-247">When deploying replicas tooAzure, you should use asynchronous commit instead of synchronous commit for hello synchronization mode.</span></span> <span data-ttu-id="ce092-248">При развертывании серверов зеркального отображения базы данных как в локальной среде и в Azure, используйте режим высокой производительности hello вместо режима высокой безопасности hello.</span><span class="sxs-lookup"><span data-stu-id="ce092-248">When deploying database mirroring servers both on-premises and in Azure, use hello high-performance mode instead of hello high-safety mode.</span></span>

### <a name="geo-replication-support"></a><span data-ttu-id="ce092-249">Поддержка георепликации</span><span class="sxs-lookup"><span data-stu-id="ce092-249">Geo-replication support</span></span>
<span data-ttu-id="ce092-250">Георепликация на дисках Azure не поддерживает hello файла данных и файлов журналов hello же toobe базы данных, хранящихся на разных дисках.</span><span class="sxs-lookup"><span data-stu-id="ce092-250">Geo-replication in Azure disks does not support hello data file and log file of hello same database toobe stored on separate disks.</span></span> <span data-ttu-id="ce092-251">GRS реплицирует изменения на каждом диске независимо и асинхронно.</span><span class="sxs-lookup"><span data-stu-id="ce092-251">GRS replicates changes on each disk independently and asynchronously.</span></span> <span data-ttu-id="ce092-252">Этот механизм обеспечивает hello порядок записи на одном диске в геореплицированной копии hello, но не для геореплицированных копий нескольких дисков.</span><span class="sxs-lookup"><span data-stu-id="ce092-252">This mechanism guarantees hello write order within a single disk on hello geo-replicated copy, but not across geo-replicated copies of multiple disks.</span></span> <span data-ttu-id="ce092-253">При настройке toostore базы данных, файла данных и файла журнала на разных дисках, hello восстановления дисков после сбоя может содержать более позднюю копию файла данных hello, чем файла журнала hello, останавливающий выполнение hello упреждающего ведения журнала в SQL Server и hello ACID Свойства транзакции.</span><span class="sxs-lookup"><span data-stu-id="ce092-253">If you configure a database toostore its data file and its log file on separate disks, hello recovered disks after a disaster may contain a more up-to-date copy of hello data file than hello log file, which breaks hello write-ahead log in SQL Server and hello ACID properties of transactions.</span></span> <span data-ttu-id="ce092-254">Если у вас hello параметр toodisable георепликация для учетной записи хранилища hello, необходимо хранить все данные и файлы журналов для базы данных на hello же диска.</span><span class="sxs-lookup"><span data-stu-id="ce092-254">If you do not have hello option toodisable geo-replication on hello storage account, you should keep all data and log files for a given database on hello same disk.</span></span> <span data-ttu-id="ce092-255">Если необходимо использовать более одного диска из-за размера toohello hello базы данных, необходимо одно hello решения аварийного восстановления, перечисленных выше избыточность данных tooensure toodeploy.</span><span class="sxs-lookup"><span data-stu-id="ce092-255">If you must use more than one disk due toohello size of hello database, you need toodeploy one of hello disaster recovery solutions listed above tooensure data redundancy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ce092-256">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="ce092-256">Next steps</span></span>
<span data-ttu-id="ce092-257">Если вам требуется toocreate виртуальной машине Azure с SQL Server, см. раздел [подготовки виртуальной машины SQL Server в Azure](virtual-machines-windows-portal-sql-server-provision.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-257">If you need toocreate an Azure virtual machine with SQL Server, see [Provisioning a SQL Server Virtual Machine on Azure](virtual-machines-windows-portal-sql-server-provision.md).</span></span>

<span data-ttu-id="ce092-258">tooget hello наилучшей производительности SQL Server на Виртуальной машине Azure см. руководство hello в [рекомендации по производительности для SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-258">tooget hello best performance from SQL Server running on an Azure VM, see hello guidance in [Performance Best Practices for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-performance.md).</span></span>

<span data-ttu-id="ce092-259">Другие разделы, посвященные toorunning SQL Server в виртуальных машинах Azure, см. в разделе [SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ce092-259">For other topics related toorunning SQL Server in Azure VMs, see [SQL Server on Azure Virtual Machines](virtual-machines-windows-sql-server-iaas-overview.md).</span></span>

### <a name="other-resources"></a><span data-ttu-id="ce092-260">Другие ресурсы:</span><span class="sxs-lookup"><span data-stu-id="ce092-260">Other resources</span></span>
* [<span data-ttu-id="ce092-261">Установка нового леса Active Directory в виртуальной сети Azure</span><span class="sxs-lookup"><span data-stu-id="ce092-261">Install a new Active Directory forest in Azure</span></span>](../../../active-directory/active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="ce092-262">Создание отказоустойчивого кластера для групп доступности на виртуальной машине Azure</span><span class="sxs-lookup"><span data-stu-id="ce092-262">Create Failover Cluster for availability groups in Azure VM</span></span>](http://gallery.technet.microsoft.com/scriptcenter/Create-WSFC-Cluster-for-7c207d3a)

