---
title: "Высокий уровень доступности и аварийное восстановление для SQL Server | Документация Майкрософт"
description: "Обсуждение различных типов стратегий HADR для SQL Server на виртуальных машинах Azure."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: 53981f7e-8370-4979-b26a-93a5988d905f
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 06/27/2017
ms.author: mikeray
ms.openlocfilehash: 27d05c1681f7d7b3090fc7abd4a6b15d1c030e2c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="high-availability-and-disaster-recovery-for-sql-server-in-azure-virtual-machines"></a><span data-ttu-id="d823d-103">Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="d823d-103">High availability and disaster recovery for SQL Server in Azure Virtual Machines</span></span>

<span data-ttu-id="d823d-104">Виртуальные машины Microsoft Azure с SQL Server могут помочь удешевить базу данных, обеспечивающую высокий уровень доступности и аварийное восстановление (HADR).</span><span class="sxs-lookup"><span data-stu-id="d823d-104">Microsoft Azure virtual machines (VMs) with SQL Server can help lower the cost of a high availability and disaster recovery (HADR) database solution.</span></span> <span data-ttu-id="d823d-105">Виртуальные машины Azure поддерживают большинство решений HADR для SQL Server как для использования только в службе Azure, так и в качестве гибридных решений.</span><span class="sxs-lookup"><span data-stu-id="d823d-105">Most SQL Server HADR solutions are supported in Azure virtual machines, both as Azure-only and as hybrid solutions.</span></span> <span data-ttu-id="d823d-106">Если решение предназначено только для использования в службе Azure, в ней выполняется вся система HADR.</span><span class="sxs-lookup"><span data-stu-id="d823d-106">In an Azure-only solution, the entire HADR system runs in Azure.</span></span> <span data-ttu-id="d823d-107">В гибридной конфигурации часть решения выполняется в Azure, а другая часть — в локальной сети организации.</span><span class="sxs-lookup"><span data-stu-id="d823d-107">In a hybrid configuration, part of the solution runs in Azure and the other part runs on-premises in your organization.</span></span> <span data-ttu-id="d823d-108">Гибкость среды Azure позволяет полностью или частично перемещать ресурсы в Azure в соответствии с бюджетом и требованиями систем баз данных SQL Server к HADR.</span><span class="sxs-lookup"><span data-stu-id="d823d-108">The flexibility of the Azure environment enables you to move partially or completely to Azure to satisfy the budget and HADR requirements of your SQL Server database systems.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-both-include.md)]

## <a name="understanding-the-need-for-an-hadr-solution"></a><span data-ttu-id="d823d-109">Целесообразность использования решения HADR</span><span class="sxs-lookup"><span data-stu-id="d823d-109">Understanding the need for an HADR solution</span></span>
<span data-ttu-id="d823d-110">Вам следует убедиться, что ваша система баз данных поддерживает возможности HADR, оговоренные в соглашении об уровне обслуживания (SLA).</span><span class="sxs-lookup"><span data-stu-id="d823d-110">It is up to you to ensure that your database system possesses the HADR capabilities that the service-level agreement (SLA) requires.</span></span> <span data-ttu-id="d823d-111">Тот факт, что Azure обеспечивает механизмы высокого уровня доступности, такие как восстановление облачных служб и обнаружение восстановления после сбоя для виртуальных машин, сам по себе не гарантирует, что вы выполните условия этого соглашения.</span><span class="sxs-lookup"><span data-stu-id="d823d-111">The fact that Azure provides high availability mechanisms, such as service healing for cloud services and failure recovery detection for Virtual Machines, does not itself guarantee you can meet the desired SLA.</span></span> <span data-ttu-id="d823d-112">Эти механизмы поддерживают высокий уровень доступности исключительно виртуальных машин, а не экземпляра SQL Server, который выполняется на этих виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="d823d-112">These mechanisms protect the high availability of the VMs but not the high availability of SQL Server running inside the VMs.</span></span> <span data-ttu-id="d823d-113">В работе экземпляра SQL Server может возникнуть ошибка, даже если виртуальная машина подключена и исправна.</span><span class="sxs-lookup"><span data-stu-id="d823d-113">It is possible for the SQL Server instance to fail while the VM is online and healthy.</span></span> <span data-ttu-id="d823d-114">Кроме того, даже доступные в Azure механизмы обеспечения высокого уровня доступности допускают простои виртуальных машин, связанные с такими событиями, как восстановление после сбоев программного или аппаратного обеспечения либо обновление операционной системы.</span><span class="sxs-lookup"><span data-stu-id="d823d-114">Moreover, even the high availability mechanisms provided by Azure allow for downtime of the VMs due to events such as recovery from software or hardware failures and operating system upgrades.</span></span>

<span data-ttu-id="d823d-115">Кроме того, геоизбыточного хранилища (GRS) в Azure, которое реализуется с помощью такой функции, как георепликация, может оказаться недостаточно для аварийного восстановления баз данных.</span><span class="sxs-lookup"><span data-stu-id="d823d-115">In addition, Geo Redundant Storage (GRS) in Azure, which is implemented with a feature called geo-replication, may not be an adequate disaster recovery solution for your databases.</span></span> <span data-ttu-id="d823d-116">Так как при георепликации данные отправляются асинхронно, последние обновления могут быть потеряны в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="d823d-116">Because geo-replication sends data asynchronously, recent updates can be lost in the event of disaster.</span></span> <span data-ttu-id="d823d-117">Дополнительные сведения об ограничениях относительно георепликации приведены [в разделе со сведениями о том, что георепликация не поддерживается для файлов данных и журналов на отдельных дисках](#geo-replication-support) .</span><span class="sxs-lookup"><span data-stu-id="d823d-117">More information regarding geo-replication limitations are covered in the [Geo-replication not supported for data and log files on separate disks](#geo-replication-support) section.</span></span>

## <a name="hadr-deployment-architectures"></a><span data-ttu-id="d823d-118">Архитектуры развертывания HADR</span><span class="sxs-lookup"><span data-stu-id="d823d-118">HADR deployment architectures</span></span>
<span data-ttu-id="d823d-119">В Azure поддерживаются следующие технологии HADR для SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d823d-119">SQL Server HADR technologies that are supported in Azure include:</span></span>

* [<span data-ttu-id="d823d-120">Группы доступности Always On</span><span class="sxs-lookup"><span data-stu-id="d823d-120">Always On Availability Groups</span></span>](https://technet.microsoft.com/library/hh510230.aspx)
* [<span data-ttu-id="d823d-121">Экземпляры отказоустойчивого кластера Always On</span><span class="sxs-lookup"><span data-stu-id="d823d-121">Always On Failover Cluster Instances</span></span>](https://technet.microsoft.com/library/ms189134.aspx)
* [<span data-ttu-id="d823d-122">Доставка журналов</span><span class="sxs-lookup"><span data-stu-id="d823d-122">Log Shipping</span></span>](https://technet.microsoft.com/library/ms187103.aspx)
* [<span data-ttu-id="d823d-123">Резервное копирование и восстановление SQL Server с помощью службы хранилища BLOB-объектов Azure</span><span class="sxs-lookup"><span data-stu-id="d823d-123">SQL Server Backup and Restore with Azure Blob Storage Service</span></span>](https://msdn.microsoft.com/library/jj919148.aspx)
* <span data-ttu-id="d823d-124">[Зеркальное отображение базы данных (SQL Server)](https://technet.microsoft.com/library/ms189852.aspx) — устаревшее в SQL Server 2016</span><span class="sxs-lookup"><span data-stu-id="d823d-124">[Database Mirroring](https://technet.microsoft.com/library/ms189852.aspx) - Deprecated in SQL Server 2016</span></span>

<span data-ttu-id="d823d-125">Эти технологии можно объединить, чтобы реализовать решение SQL Server, поддерживающее возможности высокого уровня доступности и аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-125">It is possible to combine the technologies together to implement a SQL Server solution that has both high availability and disaster recovery capabilities.</span></span> <span data-ttu-id="d823d-126">В зависимости от используемой технологии для гибридного развертывания может потребоваться VPN-туннель с виртуальной сетью Azure.</span><span class="sxs-lookup"><span data-stu-id="d823d-126">Depending on the technology you use, a hybrid deployment may require a VPN tunnel with the Azure virtual network.</span></span> <span data-ttu-id="d823d-127">В разделах ниже приведено несколько примеров архитектур развертывания.</span><span class="sxs-lookup"><span data-stu-id="d823d-127">The sections below show you some of the example deployment architectures.</span></span>

## <a name="azure-only-high-availability-solutions"></a><span data-ttu-id="d823d-128">Только в Azure: решения высокого уровня доступности</span><span class="sxs-lookup"><span data-stu-id="d823d-128">Azure-only: High availability solutions</span></span>

<span data-ttu-id="d823d-129">Решение для обеспечения высокого уровня доступности SQL Server можно реализовать на уровне базы данных с помощью групп доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="d823d-129">You can have a high availability solution for SQL Server at a database level with Always On Availability Groups - called availability groups.</span></span> <span data-ttu-id="d823d-130">Его можно также создать на уровне экземпляра с помощью экземпляров отказоустойчивого кластера AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="d823d-130">You can also create a high availability solution at an instance level with Always On Failover Cluster Instances - failover cluster instances.</span></span> <span data-ttu-id="d823d-131">Чтобы повысить избыточность на обоих уровнях, можно также создать группы доступности для экземпляров отказоустойчивого кластера.</span><span class="sxs-lookup"><span data-stu-id="d823d-131">For additional redundancy, you can create redundancy at both levels by creating availability groups on failover cluster instances.</span></span> 

| <span data-ttu-id="d823d-132">Технология</span><span class="sxs-lookup"><span data-stu-id="d823d-132">Technology</span></span> | <span data-ttu-id="d823d-133">Примеры архитектур</span><span class="sxs-lookup"><span data-stu-id="d823d-133">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="d823d-134">**Группы доступности**</span><span class="sxs-lookup"><span data-stu-id="d823d-134">**Availability groups**</span></span> |<span data-ttu-id="d823d-135">Реплики доступности, выполняемые на виртуальных машинах Azure в одном регионе, обеспечивают высокий уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="d823d-135">Availability replicas running in Azure VMs in the same region provide high availability.</span></span> <span data-ttu-id="d823d-136">Необходимо настроить виртуальную машину контроллера домена, так как для отказоустойчивой кластеризации Windows требуется домен Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d823d-136">You need to configure a domain controller VM, because Windows failover clustering requires an Active Directory domain.</span></span><br/> <span data-ttu-id="d823d-137">![Группы доступности](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span><span class="sxs-lookup"><span data-stu-id="d823d-137">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_ha_always_on.gif)</span></span><br/><span data-ttu-id="d823d-138">Дополнительные сведения см. в статье [Автоматическая настройка групп доступности AlwaysOn на виртуальных машинах Azure с использованием Resource Manager](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-138">For more information, see [Configure Availability Groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span> |
| <span data-ttu-id="d823d-139">**Экземпляры отказоустойчивого кластера**</span><span class="sxs-lookup"><span data-stu-id="d823d-139">**Failover cluster instances**</span></span> |<span data-ttu-id="d823d-140">Экземпляры отказоустойчивого кластера (FCI), которые требуют наличия общего хранилища, можно создавать тремя способами.</span><span class="sxs-lookup"><span data-stu-id="d823d-140">Failover Cluster Instances (FCI), which require shared storage, can be created in 3 different ways.</span></span><br/><br/><span data-ttu-id="d823d-141">1. Отказоустойчивый кластер с двумя узлами, выполняющийся на виртуальных машинах Azure, с хранилищем, подключенным с использованием [локальных дисковых пространств Windows Server 2016 \(S2D\)](virtual-machines-windows-portal-sql-create-failover-cluster.md), для предоставления программной виртуальной сети SAN.</span><span class="sxs-lookup"><span data-stu-id="d823d-141">1. A two-node failover cluster running in Azure VMs with attached storage using [Windows Server 2016 Storage Spaces Direct \(S2D\)](virtual-machines-windows-portal-sql-create-failover-cluster.md) to provide a software-based virtual SAN.</span></span><br/><br/><span data-ttu-id="d823d-142">2. Отказоустойчивый кластер с двумя узлами, выполняющийся на виртуальных машинах Azure, с хранилищем, поддерживаемым сторонним решением кластеризации.</span><span class="sxs-lookup"><span data-stu-id="d823d-142">2. A two-node failover cluster running in Azure VMs with storage supported by a third-party clustering solution.</span></span> <span data-ttu-id="d823d-143">Конкретный пример, в котором используется SIOS DataKeeper, приведен в публикации блога [High Availability for a file share using WSFC, ILB and 3rd-party Software SIOS Datakeeper](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/) (Обеспечение высокого уровня доступности файлового ресурса с помощью WSFC, внутренней подсистемы балансировки нагрузки и стороннего ПО SIOS Datakeeper).</span><span class="sxs-lookup"><span data-stu-id="d823d-143">For a specific example that uses SIOS DataKeeper, see [High availability for a file share using failover clustering and 3rd party software SIOS DataKeeper](https://azure.microsoft.com/blog/high-availability-for-a-file-share-using-wsfc-ilb-and-3rd-party-software-sios-datakeeper/).</span></span><br/><br/><span data-ttu-id="d823d-144">3. Отказоустойчивый кластер с двумя узлами, выполняющийся на виртуальных машинах Azure, с удаленным целевым общим блочным хранилищем iSCSI, подключенным через ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="d823d-144">3. A two-node failover cluster running in Azure VMs with remote iSCSI Target shared block storage via ExpressRoute.</span></span> <span data-ttu-id="d823d-145">Например, решение NetApp Private Storage (NPS) предоставляет цели iSCSI через ExpressRoute с Equinix для виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="d823d-145">For example, NetApp Private Storage (NPS) exposes an iSCSI target via ExpressRoute with Equinix to Azure VMs.</span></span><br/><br/><span data-ttu-id="d823d-146">По любым вопросам, связанным с доступом к данным при отработке отказа, касающимся сторонних решений репликации данных и общих хранилищ, следует обратиться к их поставщикам.</span><span class="sxs-lookup"><span data-stu-id="d823d-146">For third-party shared storage and data replication solutions, you should contact the vendor for any issues related to accessing data on failover.</span></span><br/><br/><span data-ttu-id="d823d-147">Обратите внимание, что использование экземпляра FCI поверх [хранилища файлов Azure](https://azure.microsoft.com/services/storage/files/) пока не поддерживается, так как это решение не использует хранилище уровня "Премиум".</span><span class="sxs-lookup"><span data-stu-id="d823d-147">Note that using FCI on top of [Azure File storage](https://azure.microsoft.com/services/storage/files/) is not supported yet, because this solution does not utilize Premium Storage.</span></span> <span data-ttu-id="d823d-148">Мы работаем над тем, чтобы обеспечить поддержку этого сценария в ближайшее время.</span><span class="sxs-lookup"><span data-stu-id="d823d-148">We are working to support this soon.</span></span> |

## <a name="azure-only-disaster-recovery-solutions"></a><span data-ttu-id="d823d-149">Только в Azure: решения аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="d823d-149">Azure-only: Disaster recovery solutions</span></span>
<span data-ttu-id="d823d-150">У вас может быть решение аварийного восстановления для баз данных SQL Server в Azure, использующее группы доступности, зеркальное отображение базы данных или архивацию и восстановление с большими двоичными объектами хранилища.</span><span class="sxs-lookup"><span data-stu-id="d823d-150">You can have a disaster recovery solution for your SQL Server databases in Azure using availability groups, database mirroring, or backup and restore with storage blobs.</span></span>

| <span data-ttu-id="d823d-151">Технология</span><span class="sxs-lookup"><span data-stu-id="d823d-151">Technology</span></span> | <span data-ttu-id="d823d-152">Примеры архитектур</span><span class="sxs-lookup"><span data-stu-id="d823d-152">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="d823d-153">**Группы доступности**</span><span class="sxs-lookup"><span data-stu-id="d823d-153">**Availability Groups**</span></span> |<span data-ttu-id="d823d-154">Реплики доступности, выполняемые в нескольких центрах обработки данных на виртуальных машинах Azure для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-154">Availability replicas running across multiple datacenters in Azure VMs for disaster recovery.</span></span> <span data-ttu-id="d823d-155">Это межрегиональное решение обеспечивает защиту от простоя всего сайта.</span><span class="sxs-lookup"><span data-stu-id="d823d-155">This cross-region solution protects against complete site outage.</span></span> <br/> <span data-ttu-id="d823d-156">![Группы доступности](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span><span class="sxs-lookup"><span data-stu-id="d823d-156">![Availability Groups](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_alwayson.png)</span></span><br/><span data-ttu-id="d823d-157">В пределах региона все реплики должны находиться в одной облачной службе и одной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="d823d-157">Within a region, all replicas should be within the same cloud service and the same VNet.</span></span> <span data-ttu-id="d823d-158">Так как каждый регион будет включать отдельную виртуальную сеть, для этих решений требуется подключение между виртуальными сетями.</span><span class="sxs-lookup"><span data-stu-id="d823d-158">Because each region will have a separate VNet, these solutions require VNet to VNet connectivity.</span></span> <span data-ttu-id="d823d-159">Чтобы узнать больше, ознакомьтесь с разделом [Настройка подключения между виртуальными сетями на портале Azure](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-159">For more information, see [Configure a VNet-to-VNet connection using the Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span></span> <span data-ttu-id="d823d-160">Подробные инструкции см. в статье [Настройка группы доступности AlwaysOn на виртуальных машинах Azure в разных регионах](virtual-machines-windows-portal-sql-availability-group-dr.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-160">For detailed instructions, see [Configure a SQL Server Availability Group on Azure Virtual Machines in Different Regions](virtual-machines-windows-portal-sql-availability-group-dr.md).</span></span>|
| <span data-ttu-id="d823d-161">**Зеркальное отображение базы данных**</span><span class="sxs-lookup"><span data-stu-id="d823d-161">**Database Mirroring**</span></span> |<span data-ttu-id="d823d-162">Основной, зеркальный и другие серверы, выполняемые в разных центрах обработки данных для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-162">Principal and mirror and servers running in different datacenters for disaster recovery.</span></span> <span data-ttu-id="d823d-163">Для развертывания необходимо использовать сертификаты сервера, так как домен Active Directory не может охватывать несколько центров обработки данных.</span><span class="sxs-lookup"><span data-stu-id="d823d-163">You must deploy using server certificates because an active directory domain cannot span multiple datacenters.</span></span><br/>![Зеркальное отображение базы данных](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_dbmirroring.gif) |
| <span data-ttu-id="d823d-165">**Резервное копирование и восстановление с помощью службы хранилища больших двоичных объектов Azure**</span><span class="sxs-lookup"><span data-stu-id="d823d-165">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="d823d-166">Рабочие базы данных архивируются напрямую в хранилище BLOB-объектов в другом центре обработки данных для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-166">Production databases backed up directly to blob storage in a different datacenter for disaster recovery.</span></span><br/><span data-ttu-id="d823d-167">![Резервное копирование и восстановление](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="d823d-167">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/azure_only_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="d823d-168">Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-168">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="hybrid-it-disaster-recovery-solutions"></a><span data-ttu-id="d823d-169">Гибридная ИТ-среда: решения аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="d823d-169">Hybrid IT: Disaster recovery solutions</span></span>
<span data-ttu-id="d823d-170">У вас может быть решение аварийного восстановления для баз данных SQL Server в гибридной ИТ-среде, использующее группы доступности, зеркальное отображение базы данных и доставку журналов, а также архивацию и восстановление с помощью хранилища больших двоичных объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="d823d-170">You can have a disaster recovery solution for your SQL Server databases in a hybrid-IT environment using availability groups, database mirroring, log shipping, and backup and restore with Azure blog storage.</span></span>

| <span data-ttu-id="d823d-171">Технология</span><span class="sxs-lookup"><span data-stu-id="d823d-171">Technology</span></span> | <span data-ttu-id="d823d-172">Примеры архитектур</span><span class="sxs-lookup"><span data-stu-id="d823d-172">Example Architectures</span></span> |
| --- | --- |
| <span data-ttu-id="d823d-173">**Группы доступности**</span><span class="sxs-lookup"><span data-stu-id="d823d-173">**Availability Groups**</span></span> |<span data-ttu-id="d823d-174">Некоторые реплики доступности, выполняемые на виртуальных машинах Azure, и другие реплики, которые выполняются локально для аварийного восстановления на нескольких сайтах.</span><span class="sxs-lookup"><span data-stu-id="d823d-174">Some availability replicas running in Azure VMs and other replicas running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="d823d-175">Рабочий сайт может размещаться локально или в центре обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="d823d-175">The production site can be either on-premises or in an Azure datacenter.</span></span><br/>![Группы доступности](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_alwayson.gif)<br/><span data-ttu-id="d823d-177">Так как все реплики доступности должны находиться в одном отказоустойчивом кластере, он должен охватывать обе сети (отказоустойчивый кластер с несколькими подсетями).</span><span class="sxs-lookup"><span data-stu-id="d823d-177">Because all availability replicas must be in the same failover cluster, the cluster must span both networks (a multi-subnet failover cluster).</span></span> <span data-ttu-id="d823d-178">Для этой конфигурации требуется установить VPN-подключение между сетью Azure и локальной сетью.</span><span class="sxs-lookup"><span data-stu-id="d823d-178">This configuration requires a VPN connection between Azure and the on-premises network.</span></span><br/><br/><span data-ttu-id="d823d-179">Для успешного аварийного восстановления баз данных также следует установить реплику контроллера домена на сайте аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-179">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span><br/><br/><span data-ttu-id="d823d-180">Для добавления реплики Azure в существующую группу доступности AlwaysOn можно воспользоваться мастером добавления реплики в SSMS.</span><span class="sxs-lookup"><span data-stu-id="d823d-180">It is possible to use the Add Replica Wizard in SSMS to add an Azure replica to an existing Always On Availability Group.</span></span> <span data-ttu-id="d823d-181">Дополнительные сведения см. в учебнике, в котором рассматривается расширение группы доступности Always On в Azure.</span><span class="sxs-lookup"><span data-stu-id="d823d-181">For more information, see Tutorial: Extend your Always On Availability Group to Azure.</span></span> |
| <span data-ttu-id="d823d-182">**Зеркальное отображение базы данных**</span><span class="sxs-lookup"><span data-stu-id="d823d-182">**Database Mirroring**</span></span> |<span data-ttu-id="d823d-183">Один участник выполняется на виртуальной машине Azure, а другой — локально для межсайтового аварийного восстановления с использованием сертификатов сервера.</span><span class="sxs-lookup"><span data-stu-id="d823d-183">One partner running in an Azure VM and the other running on-premises for cross-site disaster recovery using server certificates.</span></span> <span data-ttu-id="d823d-184">Участники не обязательно должны находиться в одном домене Active Directory. Кроме того, не требуется VPN-подключение.</span><span class="sxs-lookup"><span data-stu-id="d823d-184">Partners do not need to be in the same Active Directory domain, and no VPN connection is required.</span></span><br/><span data-ttu-id="d823d-185">![Зеркальное отображение базы данных](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span><span class="sxs-lookup"><span data-stu-id="d823d-185">![Database Mirroring](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_dbmirroring.gif)</span></span><br/><span data-ttu-id="d823d-186">В другом сценарии зеркального отображения базы данных один участник выполняется на виртуальной машине Azure, а другой — локально в том же домене Active Directory для межсайтового аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-186">Another database mirroring scenario involves one partner running in an Azure VM and the other running on-premises in the same Active Directory domain for cross-site disaster recovery.</span></span> <span data-ttu-id="d823d-187">Требуется [VPN-подключение между виртуальной сетью Azure и локальной сетью](../../../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-187">A [VPN connection between the Azure virtual network and the on-premises network](../../../vpn-gateway/vpn-gateway-site-to-site-create.md) is required.</span></span><br/><br/><span data-ttu-id="d823d-188">Для успешного аварийного восстановления баз данных также следует установить реплику контроллера домена на сайте аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-188">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span> |
| <span data-ttu-id="d823d-189">**Доставка журналов**</span><span class="sxs-lookup"><span data-stu-id="d823d-189">**Log Shipping**</span></span> |<span data-ttu-id="d823d-190">Один сервер запущен на виртуальной машине Azure, а другой — в локальной сети для межсайтового аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-190">One server running in an Azure VM and the other running on-premises for cross-site disaster recovery.</span></span> <span data-ttu-id="d823d-191">Доставка журналов зависит от общего доступа к файлам Windows, поэтому требуется VPN-подключение между виртуальной сетью Azure и локальной сетью.</span><span class="sxs-lookup"><span data-stu-id="d823d-191">Log shipping depends on Windows file sharing, so a VPN connection between the Azure virtual network and the on-premises network is required.</span></span><br/>![Доставка журналов](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_log_shipping.gif)<br/><span data-ttu-id="d823d-193">Для успешного аварийного восстановления баз данных также следует установить реплику контроллера домена на сайте аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-193">For successful disaster recovery of your databases, you should also install a replica domain controller at the disaster recovery site.</span></span> |
| <span data-ttu-id="d823d-194">**Резервное копирование и восстановление с помощью службы хранилища больших двоичных объектов Azure**</span><span class="sxs-lookup"><span data-stu-id="d823d-194">**Backup and Restore with Azure Blob Storage Service**</span></span> |<span data-ttu-id="d823d-195">Локальные рабочие базы данных архивируются напрямую в хранилище BLOB-объектов для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-195">On-premises production databases backed up directly to Azure blob storage for disaster recovery.</span></span><br/><span data-ttu-id="d823d-196">![Резервное копирование и восстановление](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span><span class="sxs-lookup"><span data-stu-id="d823d-196">![Backup and Restore](./media/virtual-machines-windows-sql-high-availability-dr/hybrid_dr_backup_restore.gif)</span></span><br/><span data-ttu-id="d823d-197">Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-197">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-backup-recovery.md).</span></span> |

## <a name="important-considerations-for-sql-server-hadr-in-azure"></a><span data-ttu-id="d823d-198">Важные соображения в отношении HADR для SQL Server в Azure</span><span class="sxs-lookup"><span data-stu-id="d823d-198">Important considerations for SQL Server HADR in Azure</span></span>
<span data-ttu-id="d823d-199">Виртуальные машины, хранилища и сети Azure имеют рабочие характеристики, отличные от характеристик локальной, невиртуализированной ИТ-инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="d823d-199">Azure VMs, storage, and networking have different operational characteristics than an on-premises, non-virtualized IT infrastructure.</span></span> <span data-ttu-id="d823d-200">Чтобы успешно реализовать решение HADR для SQL Server в Azure, вы должны понимать эти различия и учитывать их при разработке решения.</span><span class="sxs-lookup"><span data-stu-id="d823d-200">A successful implementation of a HADR SQL Server solution in Azure requires that you understand these differences and design your solution to accommodate them.</span></span>

### <a name="high-availability-nodes-in-an-availability-set"></a><span data-ttu-id="d823d-201">Узлы с высоким уровнем доступности в группе доступности</span><span class="sxs-lookup"><span data-stu-id="d823d-201">High availability nodes in an availability set</span></span>
<span data-ttu-id="d823d-202">Группы доступности в Azure позволяют размещать узлы с высоким уровнем доступности в отдельные домены сбоя и домены обновления.</span><span class="sxs-lookup"><span data-stu-id="d823d-202">Availability sets in Azure enable you to place the high availability nodes into separate Fault Domains (FDs) and Update Domains (UDs).</span></span> <span data-ttu-id="d823d-203">Для размещения виртуальных машин Azure в одной группе доступности их необходимо развернуть в одной облачной службе.</span><span class="sxs-lookup"><span data-stu-id="d823d-203">For Azure VMs to be placed in the same availability set, you must deploy them in the same cloud service.</span></span> <span data-ttu-id="d823d-204">В одной группе доступности можно разместить только узлы из одной облачной службы.</span><span class="sxs-lookup"><span data-stu-id="d823d-204">Only nodes in the same cloud service can participate in the same availability set.</span></span> <span data-ttu-id="d823d-205">Дополнительные сведения см. в статье [Управление доступностью виртуальных машин](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="d823d-205">For more information, see [Manage the Availability of Virtual Machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

### <a name="failover-cluster-behavior-in-azure-networking"></a><span data-ttu-id="d823d-206">Поведение отказоустойчивого кластера в сети Azure</span><span class="sxs-lookup"><span data-stu-id="d823d-206">Failover cluster behavior in Azure networking</span></span>
<span data-ttu-id="d823d-207">Несоответствие службы DHCP в Azure стандарту RFC может привести к сбою некоторых создаваемых конфигураций отказоустойчивого кластера, так как сетевому имени кластера может быть назначен повторяющийся IP-адрес, например IP-адрес одного из узлов кластера.</span><span class="sxs-lookup"><span data-stu-id="d823d-207">The non-RFC-compliant DHCP service in Azure can cause the creation of certain failover cluster configurations to fail, due to the cluster network name being assigned a duplicate IP address, such as the same IP address as one of the cluster nodes.</span></span> <span data-ttu-id="d823d-208">Это актуально, если вам нужно реализовать группы доступности, зависящие от функции отказоустойчивого кластера Windows.</span><span class="sxs-lookup"><span data-stu-id="d823d-208">This is an issue when you implement Availability Groups, which depends on the Windows failover cluster feature.</span></span>

<span data-ttu-id="d823d-209">Рассмотрим сценарий, в котором вы создаете и подключаете к сети кластер с двумя узлами.</span><span class="sxs-lookup"><span data-stu-id="d823d-209">Consider the scenario when a two-node cluster is created and brought online:</span></span>

1. <span data-ttu-id="d823d-210">Кластер подключается к сети, после чего узел NODE1 запрашивает динамически назначаемый IP-адрес для сетевого имени кластера.</span><span class="sxs-lookup"><span data-stu-id="d823d-210">The cluster comes online, then NODE1 requests a dynamically assigned IP address for the cluster network name.</span></span>
2. <span data-ttu-id="d823d-211">Служба DHCP не назначает других IP-адресов, кроме собственного IP-адреса узла NODE1, так как она распознает, что запрос поступает от самого узла NODE1.</span><span class="sxs-lookup"><span data-stu-id="d823d-211">No IP address other than NODE1’s own IP address is given by the DHCP service, since the DHCP service recognizes that the request comes from NODE1 itself.</span></span>
3. <span data-ttu-id="d823d-212">Windows обнаруживает, что повторяющийся адрес назначен как узлу NODE1, так и сетевому имени отказоустойчивого кластера, поэтому группе кластера по умолчанию не удается подключиться к сети.</span><span class="sxs-lookup"><span data-stu-id="d823d-212">Windows detects that a duplicate address is assigned both to NODE1 and to the failover cluster network name, and the default cluster group fails to come online.</span></span>
4. <span data-ttu-id="d823d-213">Группа кластера по умолчанию перемещается на узел NODE2, который рассматривает IP-адрес узла NODE1 как IP-адрес кластера и подключает группу кластера по умолчанию к сети.</span><span class="sxs-lookup"><span data-stu-id="d823d-213">The default cluster group moves to NODE2, which treats NODE1’s IP address as the cluster IP address and brings the default cluster group online.</span></span>
5. <span data-ttu-id="d823d-214">Когда узел NODE2 пытается установить соединение с узлом NODE1, пакеты, направляемые на NODE1, не покидают узел NODE2, так как он разрешает IP-адрес узла NODE1 для самого себя.</span><span class="sxs-lookup"><span data-stu-id="d823d-214">When NODE2 attempts to establish connectivity with NODE1, packets directed at NODE1 never leave NODE2 because it resolves NODE1’s IP address to itself.</span></span> <span data-ttu-id="d823d-215">Узлу NODE2 не удается установить соединение с узлом NODE1, что приводит к потере кворума и завершению работы кластера.</span><span class="sxs-lookup"><span data-stu-id="d823d-215">NODE2 cannot establish connectivity with NODE1, then loses quorum and shuts down the cluster.</span></span>
6. <span data-ttu-id="d823d-216">Тем временем узел NODE1 может отправлять пакеты на узел NODE2, который не может отвечать на них.</span><span class="sxs-lookup"><span data-stu-id="d823d-216">In the meantime, NODE1 can send packets to NODE2, but NODE2 cannot reply.</span></span> <span data-ttu-id="d823d-217">Узел NODE1 теряет кворум и завершает работу кластера.</span><span class="sxs-lookup"><span data-stu-id="d823d-217">NODE1 loses quorum and shuts down the cluster.</span></span>

<span data-ttu-id="d823d-218">Этого можно избежать путем назначения сетевому имени кластера неиспользуемого статического IP-адреса, например IP-адреса локальной связи (такого как 169.254.1.1), чтобы позволит подключить сетевое имя кластера к сети.</span><span class="sxs-lookup"><span data-stu-id="d823d-218">This scenario can be avoided by assigning an unused static IP address, such as a link-local IP address like 169.254.1.1, to the cluster network name in order to bring the cluster network name online.</span></span> <span data-ttu-id="d823d-219">Указания по упрощению этого процесса см. в статье [How to Configure Windows Failover Cluster in Azure for AlwaysOn Availability Groups](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx) (Как настроить отказоустойчивый кластер Windows в Azure для групп доступности Always On).</span><span class="sxs-lookup"><span data-stu-id="d823d-219">To simplify this process, see [Configuring Windows failover cluster in Azure for availability groups](http://social.technet.microsoft.com/wiki/contents/articles/14776.configuring-windows-failover-cluster-in-windows-azure-for-alwayson-availability-groups.aspx).</span></span>

<span data-ttu-id="d823d-220">Дополнительные сведения см. в статье [Автоматическая настройка групп доступности AlwaysOn на виртуальных машинах Azure с использованием Resource Manager](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-220">For more information, see [Configure availability groups in Azure (GUI)](virtual-machines-windows-portal-sql-alwayson-availability-groups.md).</span></span>

### <a name="availability-group-listener-support"></a><span data-ttu-id="d823d-221">Поддержка прослушивателя группы доступности</span><span class="sxs-lookup"><span data-stu-id="d823d-221">Availability group listener support</span></span>
<span data-ttu-id="d823d-222">Прослушиватели группы доступности поддерживаются на виртуальных машинах Azure, работающих под управлением Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2 и Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="d823d-222">Availability group listeners are supported on Azure VMs running Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2, and Windows Server 2016.</span></span> <span data-ttu-id="d823d-223">Это поддержка возможна благодаря использованию конечных точек балансировки нагрузки на виртуальных машинах Azure, представляющих собой узлы группы доступности.</span><span class="sxs-lookup"><span data-stu-id="d823d-223">This support is made possible by the use of load-balanced endpoints enabled on the Azure VMs that are availability group nodes.</span></span> <span data-ttu-id="d823d-224">Необходимо выполнить специальные шаги по настройке, чтобы прослушиватели работали с клиентскими приложениями, запущенными в Azure и выполняемыми локально.</span><span class="sxs-lookup"><span data-stu-id="d823d-224">You must follow special configuration steps for the listeners to work for both client applications that are running in Azure as well as those running on-premises.</span></span>

<span data-ttu-id="d823d-225">Существует два основных способа настройки: внешний (общедоступный) или внутренний прослушиватель.</span><span class="sxs-lookup"><span data-stu-id="d823d-225">There are two main options for setting up your listener: external (public) or internal.</span></span> <span data-ttu-id="d823d-226">Внешний (общедоступный) прослушиватель использует балансировщик нагрузки для Интернета и связан с общедоступным виртуальным IP-адресом, доступным через Интернет.</span><span class="sxs-lookup"><span data-stu-id="d823d-226">The external (public) listener uses an internet facing load balancer and is associated with a public Virtual IP (VIP) that is accessible over the internet.</span></span> <span data-ttu-id="d823d-227">Внутренний прослушиватель использует внутренний балансировщик нагрузки и поддерживает только клиенты, находящиеся в той же виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="d823d-227">An internal listener uses an internal load balancer and only supports clients within the same Virtual Network.</span></span> <span data-ttu-id="d823d-228">Для обоих типов балансировщика нагрузки необходимо включить прямой ответ от сервера.</span><span class="sxs-lookup"><span data-stu-id="d823d-228">For either load balancer type, you must enable Direct Server Return.</span></span> 

<span data-ttu-id="d823d-229">Если группа доступности охватывает несколько подсетей Azure (например, развернутую систему, включающую несколько регионов Azure), то строка подключения клиента должна включать текст **MultisubnetFailover=True**.</span><span class="sxs-lookup"><span data-stu-id="d823d-229">If the Availability Group spans multiple Azure subnets (such as a deployment that crosses Azure regions), the client connection string must include "**MultisubnetFailover=True**".</span></span> <span data-ttu-id="d823d-230">В результате будут выполняться попытки параллельного подключения к репликам в разных подсетях.</span><span class="sxs-lookup"><span data-stu-id="d823d-230">This results in parallel connection attempts to the replicas in the different subnets.</span></span> <span data-ttu-id="d823d-231">Инструкции по настройке прослушивателя см. в разделах:</span><span class="sxs-lookup"><span data-stu-id="d823d-231">For instructions on setting up a listener, see</span></span>

* <span data-ttu-id="d823d-232">[Настройка прослушивателя внутренней подсистемы балансировки нагрузки для групп доступности в Azure](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-232">[Configure an ILB listener for availability groups in Azure](virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md).</span></span>
* <span data-ttu-id="d823d-233">[Настройка внешнего прослушивателя для групп доступности в Azure](../classic/ps-sql-ext-listener.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-233">[Configure an external listener for availability groups in Azure](../classic/ps-sql-ext-listener.md).</span></span>

<span data-ttu-id="d823d-234">Вы по-прежнему можете подключаются к отдельным репликам доступности, напрямую подключаясь к экземпляру службы.</span><span class="sxs-lookup"><span data-stu-id="d823d-234">You can still connect to each availability replica separately by connecting directly to the service instance.</span></span> <span data-ttu-id="d823d-235">Кроме того, так как группы доступности обратно совместимы с клиентами зеркального отображения базы данных, вы можете подключаться к репликам доступности как к участникам зеркального отображения, пока реплики настроены аналогично зеркальному отображению базы данных:</span><span class="sxs-lookup"><span data-stu-id="d823d-235">Also, since availability groups are backward compatible with database mirroring clients, you can connect to the availability replicas like database mirroring partners as long as the replicas are configured similar to database mirroring:</span></span>

* <span data-ttu-id="d823d-236">имеется по одной первичной и вторичной реплике;</span><span class="sxs-lookup"><span data-stu-id="d823d-236">One primary replica and one secondary replica</span></span>
* <span data-ttu-id="d823d-237">вторичная реплика настроена как недоступная для чтения (для параметра **Вторичная реплика для чтения** установлено значение **Нет**).</span><span class="sxs-lookup"><span data-stu-id="d823d-237">The secondary replica is configured as non-readable (**Readable Secondary** option set to **No**)</span></span>

<span data-ttu-id="d823d-238">Ниже приведен пример строки подключения клиента, соответствующий этой конфигурации зеркального отображения базы данных с использованием ADO.NET или SQL Server Native Client.</span><span class="sxs-lookup"><span data-stu-id="d823d-238">An example client connection string that corresponds to this database mirroring-like configuration using ADO.NET or SQL Server Native Client is below:</span></span>

    Data Source=ReplicaServer1;Failover Partner=ReplicaServer2;Initial Catalog=AvailabilityDatabase;

<span data-ttu-id="d823d-239">Дополнительные сведения о подключении клиента см. в следующих статьях.</span><span class="sxs-lookup"><span data-stu-id="d823d-239">For more information on client connectivity, see:</span></span>

* [<span data-ttu-id="d823d-240">Использование ключевых слов строки подключения с собственным клиентом SQL Server</span><span class="sxs-lookup"><span data-stu-id="d823d-240">Using Connection String Keywords with SQL Server Native Client</span></span>](https://msdn.microsoft.com/library/ms130822.aspx)
* [<span data-ttu-id="d823d-241">Подключение клиентов к сеансу зеркального отображения базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d823d-241">Connect Clients to a Database Mirroring Session (SQL Server)</span></span>](https://technet.microsoft.com/library/ms175484.aspx)
* [<span data-ttu-id="d823d-242">Подключение к прослушивателю группы доступности в гибридной ИТ-среде</span><span class="sxs-lookup"><span data-stu-id="d823d-242">Connecting to Availability Group Listener in Hybrid IT</span></span>](http://blogs.msdn.com/b/sqlalwayson/archive/2013/02/14/connecting-to-availability-group-listener-in-hybrid-it.aspx)
* [<span data-ttu-id="d823d-243">Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d823d-243">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>](https://technet.microsoft.com/library/hh213417.aspx)
* [<span data-ttu-id="d823d-244">Использование строк подключения к зеркально отображаемой базе данных с группами доступности</span><span class="sxs-lookup"><span data-stu-id="d823d-244">Using Database-Mirroring Connection Strings with Availability Groups</span></span>](https://technet.microsoft.com/library/hh213417.aspx)

### <a name="network-latency-in-hybrid-it"></a><span data-ttu-id="d823d-245">Задержки сети в гибридной ИТ-среде</span><span class="sxs-lookup"><span data-stu-id="d823d-245">Network latency in hybrid IT</span></span>
<span data-ttu-id="d823d-246">Решение HADR следует развернуть, исходя из предположения, что между локальной сетью и Azure могут возникать значительные задержки сети.</span><span class="sxs-lookup"><span data-stu-id="d823d-246">You should deploy your HADR solution with the assumption that there may be periods of time with high network latency between your on-premises network and Azure.</span></span> <span data-ttu-id="d823d-247">При развертывании реплик в Azure вместо синхронной следует использовать асинхронную фиксацию для режима синхронизации.</span><span class="sxs-lookup"><span data-stu-id="d823d-247">When deploying replicas to Azure, you should use asynchronous commit instead of synchronous commit for the synchronization mode.</span></span> <span data-ttu-id="d823d-248">Развертывая серверы зеркального отображения базы данных как локально, так и в Azure, используйте режим высокой производительности вместо режима высокой безопасности.</span><span class="sxs-lookup"><span data-stu-id="d823d-248">When deploying database mirroring servers both on-premises and in Azure, use the high-performance mode instead of the high-safety mode.</span></span>

### <a name="geo-replication-support"></a><span data-ttu-id="d823d-249">Поддержка георепликации</span><span class="sxs-lookup"><span data-stu-id="d823d-249">Geo-replication support</span></span>
<span data-ttu-id="d823d-250">Георепликация на дисках Azure не поддерживает хранение файлов данных и журнала из одной базы данных на отдельных дисках.</span><span class="sxs-lookup"><span data-stu-id="d823d-250">Geo-replication in Azure disks does not support the data file and log file of the same database to be stored on separate disks.</span></span> <span data-ttu-id="d823d-251">GRS реплицирует изменения на каждом диске независимо и асинхронно.</span><span class="sxs-lookup"><span data-stu-id="d823d-251">GRS replicates changes on each disk independently and asynchronously.</span></span> <span data-ttu-id="d823d-252">Этот механизм обеспечивает единый порядок записи на одном диске в геореплицированной копии, но не в геореплицированных копиях нескольких дисков.</span><span class="sxs-lookup"><span data-stu-id="d823d-252">This mechanism guarantees the write order within a single disk on the geo-replicated copy, but not across geo-replicated copies of multiple disks.</span></span> <span data-ttu-id="d823d-253">Если настроить базу данных на хранение файлов данных и журнала на отдельных дисках, восстановленные после сбоя диски могут содержать копию файла данных, созданную позже файла журнала, что нарушит упреждающее протоколирование в SQL Server и свойствах ACID транзакций.</span><span class="sxs-lookup"><span data-stu-id="d823d-253">If you configure a database to store its data file and its log file on separate disks, the recovered disks after a disaster may contain a more up-to-date copy of the data file than the log file, which breaks the write-ahead log in SQL Server and the ACID properties of transactions.</span></span> <span data-ttu-id="d823d-254">Если вы не можете отключить георепликацию в учетной записи хранения, все файлы данных и журнала базы данных следует хранить на одном диске.</span><span class="sxs-lookup"><span data-stu-id="d823d-254">If you do not have the option to disable geo-replication on the storage account, you should keep all data and log files for a given database on the same disk.</span></span> <span data-ttu-id="d823d-255">Если необходимо использовать несколько дисков из-за размера базы данных, для обеспечения избыточности данных необходимо развернуто одно из перечисленных выше решений для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="d823d-255">If you must use more than one disk due to the size of the database, you need to deploy one of the disaster recovery solutions listed above to ensure data redundancy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d823d-256">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="d823d-256">Next steps</span></span>
<span data-ttu-id="d823d-257">Если требуется создать виртуальную машину Azure с SQL Server, то см. статью [Подготовка виртуальной машины SQL Server на портале Azure](virtual-machines-windows-portal-sql-server-provision.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-257">If you need to create an Azure virtual machine with SQL Server, see [Provisioning a SQL Server Virtual Machine on Azure](virtual-machines-windows-portal-sql-server-provision.md).</span></span>

<span data-ttu-id="d823d-258">Чтобы обеспечить максимальную производительность SQL Server на виртуальной машине Azure, см. указания в статье [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-258">To get the best performance from SQL Server running on an Azure VM, see the guidance in [Performance Best Practices for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-performance.md).</span></span>

<span data-ttu-id="d823d-259">Другие темы, связанные с запуском SQL Server на виртуальных машинах Azure, рассматриваются в статье [SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md).</span><span class="sxs-lookup"><span data-stu-id="d823d-259">For other topics related to running SQL Server in Azure VMs, see [SQL Server on Azure Virtual Machines](virtual-machines-windows-sql-server-iaas-overview.md).</span></span>

### <a name="other-resources"></a><span data-ttu-id="d823d-260">Другие ресурсы:</span><span class="sxs-lookup"><span data-stu-id="d823d-260">Other resources</span></span>
* [<span data-ttu-id="d823d-261">Установка нового леса Active Directory в виртуальной сети Azure</span><span class="sxs-lookup"><span data-stu-id="d823d-261">Install a new Active Directory forest in Azure</span></span>](../../../active-directory/active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="d823d-262">Создание отказоустойчивого кластера для групп доступности на виртуальной машине Azure</span><span class="sxs-lookup"><span data-stu-id="d823d-262">Create Failover Cluster for availability groups in Azure VM</span></span>](http://gallery.technet.microsoft.com/scriptcenter/Create-WSFC-Cluster-for-7c207d3a)

