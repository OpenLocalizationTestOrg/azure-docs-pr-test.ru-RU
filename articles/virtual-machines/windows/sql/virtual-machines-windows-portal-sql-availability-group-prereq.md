---
title: "Необходимые компоненты для использования групп доступности SQL Server в Виртуальных машинах Azure | Документация Майкрософт"
description: "В этом руководстве показано, как настроить необходимые компоненты для создания группы доступности AlwaysOn для SQL Server на виртуальных машинах Azure."
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: c492db4c-3faa-4645-849f-5a1a663be55a
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/09/2017
ms.author: mikeray
ms.openlocfilehash: 3d508877928e033f24dae62c1042745ea7250033
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="complete-the-prerequisites-for-creating-always-on-availability-groups-on-azure-virtual-machines"></a><span data-ttu-id="79a30-103">Настройка необходимых компонентов для создания групп доступности AlwaysOn на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="79a30-103">Complete the prerequisites for creating Always On availability groups on Azure virtual machines</span></span>

<span data-ttu-id="79a30-104">В этом руководстве показано, как настроить необходимые компоненты для создания [группы доступности AlwaysOn для SQL Server на виртуальных машинах Azure](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="79a30-104">This tutorial shows how to complete the prerequisites for creating a [SQL Server Always On availability group on Azure virtual machines (VMs)](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span></span> <span data-ttu-id="79a30-105">Когда необходимые компоненты будут настроены, у вас будут подготовлены контроллер домена, две виртуальные машины SQL Server и следящий сервер в одной группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="79a30-105">When you've finished the prerequisites, you have a domain controller, two SQL Server VMs, and a witness server in a single resource group.</span></span>

<span data-ttu-id="79a30-106">**Оценка времени.** Чтобы завершить настройку необходимых компонентов, может потребоваться несколько часов.</span><span class="sxs-lookup"><span data-stu-id="79a30-106">**Time estimate**: It might take a couple of hours to complete the prerequisites.</span></span> <span data-ttu-id="79a30-107">Большая часть времени уходит на создание виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="79a30-107">Much of this time is spent creating virtual machines.</span></span>

<span data-ttu-id="79a30-108">На схеме ниже показаны шаги, которые описываются в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="79a30-108">The following diagram illustrates what you build in the tutorial.</span></span>

![Группа доступности](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/00-EndstateSampleNoELB.png)

## <a name="review-availability-group-documentation"></a><span data-ttu-id="79a30-110">Обзор документации по группам доступности</span><span class="sxs-lookup"><span data-stu-id="79a30-110">Review availability group documentation</span></span>

<span data-ttu-id="79a30-111">В этом руководстве предполагается, что у вас имеется базовое представление о группах доступности AlwaysOn SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-111">This tutorial assumes that you have a basic understanding of SQL Server Always On availability groups.</span></span> <span data-ttu-id="79a30-112">Если же данная технология вам незнакома, изучите статью [Обзор групп доступности AlwaysOn (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span><span class="sxs-lookup"><span data-stu-id="79a30-112">If you're not familiar with this technology, see [Overview of Always On Availability Groups (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span></span>


## <a name="create-an-azure-account"></a><span data-ttu-id="79a30-113">Создание учетной записи Azure</span><span class="sxs-lookup"><span data-stu-id="79a30-113">Create an Azure account</span></span>
<span data-ttu-id="79a30-114">Вам понадобится учетная запись Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-114">You need an Azure account.</span></span> <span data-ttu-id="79a30-115">Вы можете [создать бесплатную учетную запись Azure](/pricing/free-trial/?WT.mc_id=A261C142F) или [активировать преимущества для подписчиков Visual Studio](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span><span class="sxs-lookup"><span data-stu-id="79a30-115">You can [open a free Azure account](/pricing/free-trial/?WT.mc_id=A261C142F) or [activate Visual Studio subscriber benefits](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span></span>

## <a name="create-a-resource-group"></a><span data-ttu-id="79a30-116">Создание группы ресурсов</span><span class="sxs-lookup"><span data-stu-id="79a30-116">Create a resource group</span></span>
1. <span data-ttu-id="79a30-117">Войдите на [портал Azure](http://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="79a30-117">Sign in to the [Azure portal](http://portal.azure.com).</span></span>
2. <span data-ttu-id="79a30-118">Щелкните **+**, чтобы создать объект на портале.</span><span class="sxs-lookup"><span data-stu-id="79a30-118">Click **+** to create a new object in the portal.</span></span>

   ![Новый объект](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-portalplus.png)

3. <span data-ttu-id="79a30-120">В окне поиска **Marketplace** введите **группа ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="79a30-120">Type **resource group** in the **Marketplace** search window.</span></span>

   ![Группа ресурсов](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroupsymbol.png)
4. <span data-ttu-id="79a30-122">Щелкните **Группа ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="79a30-122">Click **Resource group**.</span></span>
5. <span data-ttu-id="79a30-123">Щелкните **Создать**.</span><span class="sxs-lookup"><span data-stu-id="79a30-123">Click **Create**.</span></span>
6. <span data-ttu-id="79a30-124">В колонке **Группа ресурсов** в поле **Имя группы ресурсов** введите имя для группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="79a30-124">On the **Resource group** blade, under **Resource group name**, type a name for the resource group.</span></span> <span data-ttu-id="79a30-125">Например, введите **sql-ha-rg**.</span><span class="sxs-lookup"><span data-stu-id="79a30-125">For example, type **sql-ha-rg**.</span></span>
7. <span data-ttu-id="79a30-126">При наличии нескольких подписок Azure выберите ту, в которой необходимо создать группу доступности.</span><span class="sxs-lookup"><span data-stu-id="79a30-126">If you have multiple Azure subscriptions, verify that the subscription is the Azure subscription that you want to create the availability group in.</span></span>
8. <span data-ttu-id="79a30-127">Выберите расположение.</span><span class="sxs-lookup"><span data-stu-id="79a30-127">Select a location.</span></span> <span data-ttu-id="79a30-128">Расположение — это регион Azure, где необходимо создать группу доступности.</span><span class="sxs-lookup"><span data-stu-id="79a30-128">The location is the Azure region where you want to create the availability group.</span></span> <span data-ttu-id="79a30-129">В этом руководстве все ресурсы будут созданы в одном расположении в среде Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-129">For this tutorial, we're going to build all resources in one Azure location.</span></span>
9. <span data-ttu-id="79a30-130">Убедитесь, что флажок **Закрепить на панели мониторинга** установлен.</span><span class="sxs-lookup"><span data-stu-id="79a30-130">Verify that **Pin to dashboard** is checked.</span></span> <span data-ttu-id="79a30-131">Этот необязательный параметр позволяет разместить ярлык для группы ресурсов на панели мониторинга портала Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-131">This optional setting places a shortcut for the resource group on the Azure portal dashboard.</span></span>

   ![Группа ресурсов](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroup.png)

10. <span data-ttu-id="79a30-133">Щелкните **Создать** , чтобы создать группу ресурсов.</span><span class="sxs-lookup"><span data-stu-id="79a30-133">Click **Create** to create the resource group.</span></span>

<span data-ttu-id="79a30-134">В среде Azure будет создана группа ресурсов, а ее ярлык закреплен на портале.</span><span class="sxs-lookup"><span data-stu-id="79a30-134">Azure creates the resource group and pins a shortcut to the resource group in the portal.</span></span>

## <a name="create-the-network-and-subnets"></a><span data-ttu-id="79a30-135">Создание сети и подсетей</span><span class="sxs-lookup"><span data-stu-id="79a30-135">Create the network and subnets</span></span>
<span data-ttu-id="79a30-136">Следующий шаг — создание сетей и подсетей в группе ресурсов Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-136">The next step is to create the networks and subnets in the Azure resource group.</span></span>

<span data-ttu-id="79a30-137">В решении используется виртуальная сеть с двумя подсетями.</span><span class="sxs-lookup"><span data-stu-id="79a30-137">The solution uses one virtual network with two subnets.</span></span> <span data-ttu-id="79a30-138">Дополнительные сведения о сетях в Azure см. в разделе [Обзор виртуальной сети](../../../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="79a30-138">The [Virtual network overview](../../../virtual-network/virtual-networks-overview.md) provides more information about networks in Azure.</span></span>

<span data-ttu-id="79a30-139">Создание виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="79a30-139">To create the virtual network:</span></span>

1. <span data-ttu-id="79a30-140">На портале Azure в своей группе ресурсов щелкните **+ Добавить**.</span><span class="sxs-lookup"><span data-stu-id="79a30-140">In the Azure portal, in your resource group, click **+ Add**.</span></span> <span data-ttu-id="79a30-141">В Azure откроется колонка **Все** .</span><span class="sxs-lookup"><span data-stu-id="79a30-141">Azure opens the **Everything** blade.</span></span>

   ![Новый элемент](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/02-newiteminrg.png)
2. <span data-ttu-id="79a30-143">Введите в поле поиска **виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="79a30-143">Search for **virtual network**.</span></span>

     ![Поиск виртуальной сети](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/04-findvirtualnetwork.png)
3. <span data-ttu-id="79a30-145">Щелкните **Виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="79a30-145">Click **Virtual network**.</span></span>
4. <span data-ttu-id="79a30-146">В колонке **Виртуальная сеть** выберите модель развертывания **Resource Manager** и нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="79a30-146">On the **Virtual network** blade, click the **Resource Manager** deployment model, and then click **Create**.</span></span>

    <span data-ttu-id="79a30-147">В таблице ниже приведены параметры для виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="79a30-147">The following table shows the settings for the virtual network:</span></span>

   | <span data-ttu-id="79a30-148">**Поле**</span><span class="sxs-lookup"><span data-stu-id="79a30-148">**Field**</span></span> | <span data-ttu-id="79a30-149">Значение</span><span class="sxs-lookup"><span data-stu-id="79a30-149">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="79a30-150">**Имя**</span><span class="sxs-lookup"><span data-stu-id="79a30-150">**Name**</span></span> |<span data-ttu-id="79a30-151">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="79a30-151">autoHAVNET</span></span> |
   | <span data-ttu-id="79a30-152">**Пространство адресов**</span><span class="sxs-lookup"><span data-stu-id="79a30-152">**Address space**</span></span> |<span data-ttu-id="79a30-153">10.33.0.0/24</span><span class="sxs-lookup"><span data-stu-id="79a30-153">10.33.0.0/24</span></span> |
   | <span data-ttu-id="79a30-154">**Имя подсети**</span><span class="sxs-lookup"><span data-stu-id="79a30-154">**Subnet name**</span></span> |<span data-ttu-id="79a30-155">Администратор</span><span class="sxs-lookup"><span data-stu-id="79a30-155">Admin</span></span> |
   | <span data-ttu-id="79a30-156">**Диапазон адресов подсети**</span><span class="sxs-lookup"><span data-stu-id="79a30-156">**Subnet address range**</span></span> |<span data-ttu-id="79a30-157">10.33.0.0/29</span><span class="sxs-lookup"><span data-stu-id="79a30-157">10.33.0.0/29</span></span> |
   | <span data-ttu-id="79a30-158">**Подписка**</span><span class="sxs-lookup"><span data-stu-id="79a30-158">**Subscription**</span></span> |<span data-ttu-id="79a30-159">Укажите подписку, которую нужно использовать.</span><span class="sxs-lookup"><span data-stu-id="79a30-159">Specify the subscription that you intend to use.</span></span> <span data-ttu-id="79a30-160">**Подписка.** Если есть только одна подписка, то этот параметр может быть пустым.</span><span class="sxs-lookup"><span data-stu-id="79a30-160">**Subscription** is blank if you only have one subscription.</span></span> |
   | <span data-ttu-id="79a30-161">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="79a30-161">**Resource group**</span></span> |<span data-ttu-id="79a30-162">Выберите **Использовать существующую** и выберите имя группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="79a30-162">Choose **Use existing** and pick the name of the resource group.</span></span> |
   | <span data-ttu-id="79a30-163">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="79a30-163">**Location**</span></span> |<span data-ttu-id="79a30-164">Укажите расположение Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-164">Specify the Azure location.</span></span> |

   <span data-ttu-id="79a30-165">Адресное пространство и диапазон адресов подсети могут отличаться от указанных в таблице.</span><span class="sxs-lookup"><span data-stu-id="79a30-165">Your address space and subnet address range might be different from the table.</span></span> <span data-ttu-id="79a30-166">В зависимости от подписки портал подскажет доступное адресное пространство и соответствующий диапазон адресов подсети.</span><span class="sxs-lookup"><span data-stu-id="79a30-166">Depending on your subscription, the portal suggests an available address space and corresponding subnet address range.</span></span> <span data-ttu-id="79a30-167">Если достаточное пространство адресов недоступно, используйте другую подписку.</span><span class="sxs-lookup"><span data-stu-id="79a30-167">If no sufficient address space is available, use a different subscription.</span></span>

   <span data-ttu-id="79a30-168">В примере используется имя подсети **admin**. Эта подсеть для контроллеров домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-168">The example uses the subnet name **Admin**. This subnet is for the domain controllers.</span></span>

5. <span data-ttu-id="79a30-169">Щелкните **Создать**.</span><span class="sxs-lookup"><span data-stu-id="79a30-169">Click **Create**.</span></span>

   ![Настройка виртуальной сети](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/06-configurevirtualnetwork.png)

<span data-ttu-id="79a30-171">Вы вернетесь к панели мониторинга портала Azure и получите уведомление о создании сети.</span><span class="sxs-lookup"><span data-stu-id="79a30-171">Azure returns you to the portal dashboard and notifies you when the new network is created.</span></span>

### <a name="create-a-second-subnet"></a><span data-ttu-id="79a30-172">Создание второй подсети</span><span class="sxs-lookup"><span data-stu-id="79a30-172">Create a second subnet</span></span>
<span data-ttu-id="79a30-173">Новая виртуальная сеть имеет одну подсеть с именем **admin**. Ее используют контроллеры домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-173">The new virtual network has one subnet, named **Admin**. The domain controllers use this subnet.</span></span> <span data-ttu-id="79a30-174">Виртуальные машины SQL Server используют вторую подсеть, **SQL**.</span><span class="sxs-lookup"><span data-stu-id="79a30-174">The SQL Server VMs use a second subnet named **SQL**.</span></span> <span data-ttu-id="79a30-175">Чтобы настроить эту подсеть, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="79a30-175">To configure this subnet:</span></span>

1. <span data-ttu-id="79a30-176">На панели мониторинга щелкните созданную группу ресурсов **SQL-HA-RG**.</span><span class="sxs-lookup"><span data-stu-id="79a30-176">On your dashboard, click the resource group that you created, **SQL-HA-RG**.</span></span> <span data-ttu-id="79a30-177">Найдите сеть в группе ресурсов в разделе **Ресурсы**.</span><span class="sxs-lookup"><span data-stu-id="79a30-177">Locate the network in the resource group under **Resources**.</span></span>

    <span data-ttu-id="79a30-178">Если группа ресурсов **SQL-HA-RG** не отображается, ее можно найти, выбрав **Группы ресурсов** и установив фильтрацию по имени группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="79a30-178">If **SQL-HA-RG** isn't visible, find it by clicking **Resource Groups** and filtering by the resource group name.</span></span>
2. <span data-ttu-id="79a30-179">Щелкните **autoHAVNET** в списке ресурсов.</span><span class="sxs-lookup"><span data-stu-id="79a30-179">Click **autoHAVNET** on the list of resources.</span></span> <span data-ttu-id="79a30-180">В Azure откроется колонка конфигурации сети.</span><span class="sxs-lookup"><span data-stu-id="79a30-180">Azure opens the network configuration blade.</span></span>
3. <span data-ttu-id="79a30-181">В колонке виртуальной сети **autoHAVNET** выберите **Параметры**, затем выберите **Подсети**.</span><span class="sxs-lookup"><span data-stu-id="79a30-181">On the **autoHAVNET** virtual network blade, under **Settings** , click **Subnets**.</span></span>

    <span data-ttu-id="79a30-182">Обратите внимание на созданную подсеть.</span><span class="sxs-lookup"><span data-stu-id="79a30-182">Note the subnet that you already created.</span></span>

   ![Настройка виртуальной сети](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/07-addsubnet.png)
5. <span data-ttu-id="79a30-184">Создайте вторую подсеть.</span><span class="sxs-lookup"><span data-stu-id="79a30-184">Create a second subnet.</span></span> <span data-ttu-id="79a30-185">Щелкните **+ Subnet**(+Подсеть).</span><span class="sxs-lookup"><span data-stu-id="79a30-185">Click **+ Subnet**.</span></span>
6. <span data-ttu-id="79a30-186">В колонке **Добавление подсети** настройте подсеть, указав в поле **Имя** значение **sqlsubnet**.</span><span class="sxs-lookup"><span data-stu-id="79a30-186">On the **Add subnet** blade, configure the subnet by typing **sqlsubnet** under **Name**.</span></span> <span data-ttu-id="79a30-187">Azure автоматически укажет допустимое значение в поле **Диапазон адресов**.</span><span class="sxs-lookup"><span data-stu-id="79a30-187">Azure automatically specifies a valid **Address range**.</span></span> <span data-ttu-id="79a30-188">Убедитесь, что этот диапазон адресов содержит по крайней мере 10 адресов.</span><span class="sxs-lookup"><span data-stu-id="79a30-188">Verify that this address range has at least 10 addresses in it.</span></span> <span data-ttu-id="79a30-189">Для рабочей среды может потребоваться больше адресов.</span><span class="sxs-lookup"><span data-stu-id="79a30-189">In a production environment, you might require more addresses.</span></span>
7. <span data-ttu-id="79a30-190">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="79a30-190">Click **OK**.</span></span>

    ![Настройка виртуальной сети](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/08-configuresubnet.png)

<span data-ttu-id="79a30-192">В следующей таблице описаны параметры конфигурации сети.</span><span class="sxs-lookup"><span data-stu-id="79a30-192">The following table summarizes the network configuration settings:</span></span>

| <span data-ttu-id="79a30-193">**Поле**</span><span class="sxs-lookup"><span data-stu-id="79a30-193">**Field**</span></span> | <span data-ttu-id="79a30-194">Значение</span><span class="sxs-lookup"><span data-stu-id="79a30-194">Value</span></span> |
| --- | --- |
| <span data-ttu-id="79a30-195">**Имя**</span><span class="sxs-lookup"><span data-stu-id="79a30-195">**Name**</span></span> |<span data-ttu-id="79a30-196">**autoHAVNET**</span><span class="sxs-lookup"><span data-stu-id="79a30-196">**autoHAVNET**</span></span> |
| <span data-ttu-id="79a30-197">**Пространство адресов**</span><span class="sxs-lookup"><span data-stu-id="79a30-197">**Address space**</span></span> |<span data-ttu-id="79a30-198">Это значение зависит от доступных адресных пространств в подписке.</span><span class="sxs-lookup"><span data-stu-id="79a30-198">This value depends on the available address spaces in your subscription.</span></span> <span data-ttu-id="79a30-199">Стандартное значение — 10.0.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="79a30-199">A typical value is 10.0.0.0/16.</span></span> |
| <span data-ttu-id="79a30-200">**Имя подсети**</span><span class="sxs-lookup"><span data-stu-id="79a30-200">**Subnet name**</span></span> |<span data-ttu-id="79a30-201">**admin**</span><span class="sxs-lookup"><span data-stu-id="79a30-201">**admin**</span></span> |
| <span data-ttu-id="79a30-202">**Диапазон адресов подсети**</span><span class="sxs-lookup"><span data-stu-id="79a30-202">**Subnet address range**</span></span> |<span data-ttu-id="79a30-203">Это значение зависит от доступных диапазонов адресов в подписке.</span><span class="sxs-lookup"><span data-stu-id="79a30-203">This value depends on the available address ranges in your subscription.</span></span> <span data-ttu-id="79a30-204">Стандартное значение — 10.0.0.0/24.</span><span class="sxs-lookup"><span data-stu-id="79a30-204">A typical value is 10.0.0.0/24.</span></span> |
| <span data-ttu-id="79a30-205">**Имя подсети**</span><span class="sxs-lookup"><span data-stu-id="79a30-205">**Subnet name**</span></span> |<span data-ttu-id="79a30-206">**sqlsubnet**</span><span class="sxs-lookup"><span data-stu-id="79a30-206">**sqlsubnet**</span></span> |
| <span data-ttu-id="79a30-207">**Диапазон адресов подсети**</span><span class="sxs-lookup"><span data-stu-id="79a30-207">**Subnet address range**</span></span> |<span data-ttu-id="79a30-208">Это значение зависит от доступных диапазонов адресов в подписке.</span><span class="sxs-lookup"><span data-stu-id="79a30-208">This value depends on the available address ranges in your subscription.</span></span> <span data-ttu-id="79a30-209">Стандартное значение — 10.0.1.0/24.</span><span class="sxs-lookup"><span data-stu-id="79a30-209">A typical value is 10.0.1.0/24.</span></span> |
| <span data-ttu-id="79a30-210">**Подписка**</span><span class="sxs-lookup"><span data-stu-id="79a30-210">**Subscription**</span></span> |<span data-ttu-id="79a30-211">Укажите подписку, которую нужно использовать.</span><span class="sxs-lookup"><span data-stu-id="79a30-211">Specify the subscription that you intend to use.</span></span> |
| <span data-ttu-id="79a30-212">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="79a30-212">**Resource Group**</span></span> |<span data-ttu-id="79a30-213">**SQL-HA-RG**</span><span class="sxs-lookup"><span data-stu-id="79a30-213">**SQL-HA-RG**</span></span> |
| <span data-ttu-id="79a30-214">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="79a30-214">**Location**</span></span> |<span data-ttu-id="79a30-215">Укажите расположение, выбранное для группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="79a30-215">Specify the same location that you chose for the resource group.</span></span> |

## <a name="create-availability-sets"></a><span data-ttu-id="79a30-216">Создание групп доступности</span><span class="sxs-lookup"><span data-stu-id="79a30-216">Create availability sets</span></span>

<span data-ttu-id="79a30-217">Прежде чем создавать виртуальные машины, необходимо создать группы доступности.</span><span class="sxs-lookup"><span data-stu-id="79a30-217">Before you create virtual machines, you need to create availability sets.</span></span> <span data-ttu-id="79a30-218">Такие группы позволяют сократить простой при плановых и внеплановых событиях обслуживания.</span><span class="sxs-lookup"><span data-stu-id="79a30-218">Availability sets reduce the downtime for planned or unplanned maintenance events.</span></span> <span data-ttu-id="79a30-219">Группа доступности Azure представляет собой логическую группу ресурсов, которую Azure помещает в физические домены сбоя и домены обновления.</span><span class="sxs-lookup"><span data-stu-id="79a30-219">An Azure availability set is a logical group of resources that Azure places on physical fault domains and update domains.</span></span> <span data-ttu-id="79a30-220">Домен сбоя обеспечивает разделение ресурсов питания и сетевых ресурсов для элементов группы доступности.</span><span class="sxs-lookup"><span data-stu-id="79a30-220">A fault domain ensures that the members of the availability set have separate power and network resources.</span></span> <span data-ttu-id="79a30-221">Домен обновления гарантирует, что элементы группы доступности не отключаются для обслуживания одновременно.</span><span class="sxs-lookup"><span data-stu-id="79a30-221">An update domain ensures that members of the availability set aren't brought down for maintenance at the same time.</span></span> <span data-ttu-id="79a30-222">Дополнительные сведения см. в статье [Управление доступностью виртуальных машин](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="79a30-222">For more information, see [Manage the availability of virtual machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="79a30-223">Вам потребуется две группы доступности:</span><span class="sxs-lookup"><span data-stu-id="79a30-223">You need two availability sets.</span></span> <span data-ttu-id="79a30-224">одна для контроллеров домена,</span><span class="sxs-lookup"><span data-stu-id="79a30-224">One is for the domain controllers.</span></span> <span data-ttu-id="79a30-225">а вторая для виртуальных машин SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-225">The second is for the SQL Server VMs.</span></span>

<span data-ttu-id="79a30-226">Чтобы создать группу доступности, перейдите в колонку группы ресурсов и щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="79a30-226">To create an availability set, go to the resource group and click **Add**.</span></span> <span data-ttu-id="79a30-227">Отфильтруйте результаты по запросу **Группа доступности**.</span><span class="sxs-lookup"><span data-stu-id="79a30-227">Filter the results by typing **availability set**.</span></span> <span data-ttu-id="79a30-228">В результатах выберите **Группа доступности**, затем щелкните **Создать**.</span><span class="sxs-lookup"><span data-stu-id="79a30-228">Click **Availability Set** in the results, and then click **Create**.</span></span>

<span data-ttu-id="79a30-229">Настройте две группы доступности в соответствии с параметрами в таблице ниже.</span><span class="sxs-lookup"><span data-stu-id="79a30-229">Configure two availability sets according to the parameters in the following table:</span></span>

| <span data-ttu-id="79a30-230">**Поле**</span><span class="sxs-lookup"><span data-stu-id="79a30-230">**Field**</span></span> | <span data-ttu-id="79a30-231">Группа доступности контроллера домена</span><span class="sxs-lookup"><span data-stu-id="79a30-231">Domain controller availability set</span></span> | <span data-ttu-id="79a30-232">Группа доступности SQL Server</span><span class="sxs-lookup"><span data-stu-id="79a30-232">SQL Server availability set</span></span> |
| --- | --- | --- |
| <span data-ttu-id="79a30-233">**Имя**</span><span class="sxs-lookup"><span data-stu-id="79a30-233">**Name**</span></span> |<span data-ttu-id="79a30-234">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="79a30-234">adavailabilityset</span></span> |<span data-ttu-id="79a30-235">sqlavailabilityset</span><span class="sxs-lookup"><span data-stu-id="79a30-235">sqlavailabilityset</span></span> |
| <span data-ttu-id="79a30-236">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="79a30-236">**Resource group**</span></span> |<span data-ttu-id="79a30-237">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="79a30-237">SQL-HA-RG</span></span> |<span data-ttu-id="79a30-238">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="79a30-238">SQL-HA-RG</span></span> |
| <span data-ttu-id="79a30-239">**Домены сбоя**</span><span class="sxs-lookup"><span data-stu-id="79a30-239">**Fault domains**</span></span> |<span data-ttu-id="79a30-240">3</span><span class="sxs-lookup"><span data-stu-id="79a30-240">3</span></span> |<span data-ttu-id="79a30-241">3</span><span class="sxs-lookup"><span data-stu-id="79a30-241">3</span></span> |
| <span data-ttu-id="79a30-242">**Домены обновления**</span><span class="sxs-lookup"><span data-stu-id="79a30-242">**Update domains**</span></span> |<span data-ttu-id="79a30-243">5</span><span class="sxs-lookup"><span data-stu-id="79a30-243">5</span></span> |<span data-ttu-id="79a30-244">3</span><span class="sxs-lookup"><span data-stu-id="79a30-244">3</span></span> |

<span data-ttu-id="79a30-245">Создав группы доступности, вернитесь в колонку группы ресурсов на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-245">After you create the availability sets, return to the resource group in the Azure portal.</span></span>

## <a name="create-domain-controllers"></a><span data-ttu-id="79a30-246">Создание контроллеров домена</span><span class="sxs-lookup"><span data-stu-id="79a30-246">Create domain controllers</span></span>
<span data-ttu-id="79a30-247">После создания сети, подсетей, групп доступности и подсистемы балансировки нагрузки с доступом к Интернету все готово к созданию виртуальных машин для контроллеров домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-247">After you've created the network, subnets, availability sets, and an Internet-facing load balancer, you're ready to create the virtual machines for the domain controllers.</span></span>

### <a name="create-virtual-machines-for-the-domain-controllers"></a><span data-ttu-id="79a30-248">Создание виртуальных машин для контроллеров домена</span><span class="sxs-lookup"><span data-stu-id="79a30-248">Create virtual machines for the domain controllers</span></span>
<span data-ttu-id="79a30-249">Чтобы создать и настроить контроллеры домена, вернитесь к группе ресурсов **SQL-HA-RG** .</span><span class="sxs-lookup"><span data-stu-id="79a30-249">To create and configure the domain controllers, return to the **SQL-HA-RG** resource group.</span></span>

1. <span data-ttu-id="79a30-250">Щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="79a30-250">Click **Add**.</span></span> <span data-ttu-id="79a30-251">Откроется колонка **Все** .</span><span class="sxs-lookup"><span data-stu-id="79a30-251">The **Everything** blade opens.</span></span>
2. <span data-ttu-id="79a30-252">Введите **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="79a30-252">Type **Windows Server 2016 Datacenter**.</span></span>
3. <span data-ttu-id="79a30-253">Щелкните **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="79a30-253">Click **Windows Server 2016 Datacenter**.</span></span> <span data-ttu-id="79a30-254">Убедитесь, что в колонке **Windows Server 2016 Datacenter** в качестве модели развертывания выбран параметр **Resource Manager**, а затем щелкните **Создать**.</span><span class="sxs-lookup"><span data-stu-id="79a30-254">In the **Windows Server 2016 Datacenter** blade, verify that the deployment model is **Resource Manager**, and then click **Create**.</span></span> <span data-ttu-id="79a30-255">В Azure откроется колонка **Создание виртуальной машины** .</span><span class="sxs-lookup"><span data-stu-id="79a30-255">Azure opens the **Create virtual machine** blade.</span></span>

<span data-ttu-id="79a30-256">Повторите действия выше, чтобы создать две виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="79a30-256">Repeat the preceding steps to create two virtual machines.</span></span> <span data-ttu-id="79a30-257">Присвойте этим виртуальным машинам следующие имена:</span><span class="sxs-lookup"><span data-stu-id="79a30-257">Name the two virtual machines:</span></span>

* <span data-ttu-id="79a30-258">ad-primary-dc</span><span class="sxs-lookup"><span data-stu-id="79a30-258">ad-primary-dc</span></span>
* <span data-ttu-id="79a30-259">ad-secondary-dc.</span><span class="sxs-lookup"><span data-stu-id="79a30-259">ad-secondary-dc</span></span>

  > [!NOTE]
  > <span data-ttu-id="79a30-260">**ad-secondary-dc** — дополнительная виртуальная машина, служащая для обеспечения высокого уровня доступности доменных служб Active Directory.</span><span class="sxs-lookup"><span data-stu-id="79a30-260">The **ad-secondary-dc** virtual machine is optional, to provide high availability for Active Directory Domain Services.</span></span>
  >
  >

<span data-ttu-id="79a30-261">В таблице ниже приведены параметры для этих двух машин.</span><span class="sxs-lookup"><span data-stu-id="79a30-261">The following table shows the settings for these two machines:</span></span>

| <span data-ttu-id="79a30-262">**Поле**</span><span class="sxs-lookup"><span data-stu-id="79a30-262">**Field**</span></span> | <span data-ttu-id="79a30-263">Значение</span><span class="sxs-lookup"><span data-stu-id="79a30-263">Value</span></span> |
| --- | --- |
| <span data-ttu-id="79a30-264">**Имя**</span><span class="sxs-lookup"><span data-stu-id="79a30-264">**Name**</span></span> |<span data-ttu-id="79a30-265">Первый контроллер домена: *ad-primary-dc*.</span><span class="sxs-lookup"><span data-stu-id="79a30-265">First domain controller: *ad-primary-dc*.</span></span></br><span data-ttu-id="79a30-266">Второй контроллер домена *ad-secondary-dc*.</span><span class="sxs-lookup"><span data-stu-id="79a30-266">Second domain controller *ad-secondary-dc*.</span></span> |
| <span data-ttu-id="79a30-267">**Тип диска виртуальной машины**</span><span class="sxs-lookup"><span data-stu-id="79a30-267">**VM disk type**</span></span> |<span data-ttu-id="79a30-268">SSD</span><span class="sxs-lookup"><span data-stu-id="79a30-268">SSD</span></span> |
| <span data-ttu-id="79a30-269">**Имя пользователя**</span><span class="sxs-lookup"><span data-stu-id="79a30-269">**User name**</span></span> |<span data-ttu-id="79a30-270">DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="79a30-270">DomainAdmin</span></span> |
| <span data-ttu-id="79a30-271">**Пароль**</span><span class="sxs-lookup"><span data-stu-id="79a30-271">**Password**</span></span> |<span data-ttu-id="79a30-272">Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="79a30-272">Contoso!0000</span></span> |
| <span data-ttu-id="79a30-273">**Подписка**</span><span class="sxs-lookup"><span data-stu-id="79a30-273">**Subscription**</span></span> |<span data-ttu-id="79a30-274">*Ваша подписка*</span><span class="sxs-lookup"><span data-stu-id="79a30-274">*Your subscription*</span></span> |
| <span data-ttu-id="79a30-275">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="79a30-275">**Resource group**</span></span> |<span data-ttu-id="79a30-276">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="79a30-276">SQL-HA-RG</span></span> |
| <span data-ttu-id="79a30-277">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="79a30-277">**Location**</span></span> |<span data-ttu-id="79a30-278">*Ваше расположение*</span><span class="sxs-lookup"><span data-stu-id="79a30-278">*Your location*</span></span> |
| <span data-ttu-id="79a30-279">**Размер**</span><span class="sxs-lookup"><span data-stu-id="79a30-279">**Size**</span></span> |<span data-ttu-id="79a30-280">DS1_V2</span><span class="sxs-lookup"><span data-stu-id="79a30-280">DS1_V2</span></span> |
| <span data-ttu-id="79a30-281">**Хранилище**</span><span class="sxs-lookup"><span data-stu-id="79a30-281">**Storage**</span></span> | <span data-ttu-id="79a30-282">**Использование управляемых дисков** - **Да**</span><span class="sxs-lookup"><span data-stu-id="79a30-282">**Use managed disks** - **Yes**</span></span> |
| <span data-ttu-id="79a30-283">**Виртуальная сеть**</span><span class="sxs-lookup"><span data-stu-id="79a30-283">**Virtual network**</span></span> |<span data-ttu-id="79a30-284">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="79a30-284">autoHAVNET</span></span> |
| <span data-ttu-id="79a30-285">**Подсеть**</span><span class="sxs-lookup"><span data-stu-id="79a30-285">**Subnet**</span></span> |<span data-ttu-id="79a30-286">admin</span><span class="sxs-lookup"><span data-stu-id="79a30-286">admin</span></span> |
| <span data-ttu-id="79a30-287">**Общедоступный IP-адрес**</span><span class="sxs-lookup"><span data-stu-id="79a30-287">**Public IP address**</span></span> |<span data-ttu-id="79a30-288">*Совпадает с именем виртуальной машины*</span><span class="sxs-lookup"><span data-stu-id="79a30-288">*Same name as the VM*</span></span> |
| <span data-ttu-id="79a30-289">**группа безопасности сети**.</span><span class="sxs-lookup"><span data-stu-id="79a30-289">**Network security group**</span></span> |<span data-ttu-id="79a30-290">*Совпадает с именем виртуальной машины*</span><span class="sxs-lookup"><span data-stu-id="79a30-290">*Same name as the VM*</span></span> |
| <span data-ttu-id="79a30-291">**группа доступности;**</span><span class="sxs-lookup"><span data-stu-id="79a30-291">**Availability set**</span></span> |<span data-ttu-id="79a30-292">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="79a30-292">adavailabilityset</span></span> </br><span data-ttu-id="79a30-293">**Домены сбоя**: 2</span><span class="sxs-lookup"><span data-stu-id="79a30-293">**Fault domains**:2</span></span></br><span data-ttu-id="79a30-294">**Домены обновления**: 2</span><span class="sxs-lookup"><span data-stu-id="79a30-294">**Update domains**:2</span></span>|
| <span data-ttu-id="79a30-295">**Диагностика**</span><span class="sxs-lookup"><span data-stu-id="79a30-295">**Diagnostics**</span></span> |<span data-ttu-id="79a30-296">Включено</span><span class="sxs-lookup"><span data-stu-id="79a30-296">Enabled</span></span> |
| <span data-ttu-id="79a30-297">**Учетная запись хранения для диагностики**</span><span class="sxs-lookup"><span data-stu-id="79a30-297">**Diagnostics storage account**</span></span> |<span data-ttu-id="79a30-298">*Создается автоматически*</span><span class="sxs-lookup"><span data-stu-id="79a30-298">*Automatically created*</span></span> |

   >[!IMPORTANT]
   ><span data-ttu-id="79a30-299">Виртуальную машину можно разместить в группе доступности только при ее создании.</span><span class="sxs-lookup"><span data-stu-id="79a30-299">You can only place a VM in an availability set when you create it.</span></span> <span data-ttu-id="79a30-300">После создания виртуальной машины группу доступности изменить невозможно.</span><span class="sxs-lookup"><span data-stu-id="79a30-300">You can't change the availability set after a VM is created.</span></span> <span data-ttu-id="79a30-301">Дополнительные сведения см. в статье [Управление доступностью виртуальных машин](../manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="79a30-301">See [Manage the availability of virtual machines](../manage-availability.md).</span></span>

<span data-ttu-id="79a30-302">Azure создаст виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="79a30-302">Azure creates the virtual machines.</span></span>

<span data-ttu-id="79a30-303">После создания виртуальных машин следует настроить контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-303">After the virtual machines are created, configure the domain controller.</span></span>

### <a name="configure-the-domain-controller"></a><span data-ttu-id="79a30-304">Настройка контроллера домена</span><span class="sxs-lookup"><span data-stu-id="79a30-304">Configure the domain controller</span></span>
<span data-ttu-id="79a30-305">На следующих этапах необходимо настроить машину **ad-primary-dc** в качестве контроллера домена для corp.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="79a30-305">In the following steps, configure the **ad-primary-dc** machine as a domain controller for corp.contoso.com.</span></span>

1. <span data-ttu-id="79a30-306">На портале откройте группу ресурсов **SQL-HA-RG** и выберите машину **ad-primary-dc**.</span><span class="sxs-lookup"><span data-stu-id="79a30-306">In the portal, open the **SQL-HA-RG** resource group and select the **ad-primary-dc** machine.</span></span> <span data-ttu-id="79a30-307">В колонке **ad-primary-dc** нажмите **Подключиться**, чтобы открыть RDP-файл для подключения к удаленному рабочему столу.</span><span class="sxs-lookup"><span data-stu-id="79a30-307">On the **ad-primary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>

    ![Подключение к виртуальной машине](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/20-connectrdp.png)
2. <span data-ttu-id="79a30-309">Войдите в систему, используя настроенную учетную запись администратора (**\DomainAdmin**) и ее пароль (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="79a30-309">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="79a30-310">По умолчанию отображается панель мониторинга **Диспетчер серверов** .</span><span class="sxs-lookup"><span data-stu-id="79a30-310">By default, the **Server Manager** dashboard should be displayed.</span></span>
4. <span data-ttu-id="79a30-311">Щелкните ссылку **Добавление ролей и компонентов** на панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="79a30-311">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Диспетчер сервера. Добавление ролей](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
5. <span data-ttu-id="79a30-313">Нажимайте **Далее**, пока не откроется раздел **Роли сервера**.</span><span class="sxs-lookup"><span data-stu-id="79a30-313">Select **Next** until you get to the **Server Roles** section.</span></span>
6. <span data-ttu-id="79a30-314">Выберите роли **Доменные службы Active Directory** и **DNS-сервер**.</span><span class="sxs-lookup"><span data-stu-id="79a30-314">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="79a30-315">При появлении запроса добавьте требуемые для этих ролей дополнительные компоненты.</span><span class="sxs-lookup"><span data-stu-id="79a30-315">When you're prompted, add any additional features that are required by these roles.</span></span>

   > [!NOTE]
   > <span data-ttu-id="79a30-316">Windows предупреждает о том, что статического IP-адреса не существует.</span><span class="sxs-lookup"><span data-stu-id="79a30-316">Windows warns you that there is no static IP address.</span></span> <span data-ttu-id="79a30-317">Если вы тестируете конфигурацию, нажмите кнопку **Продолжить**.</span><span class="sxs-lookup"><span data-stu-id="79a30-317">If you're testing the configuration, click **Continue**.</span></span> <span data-ttu-id="79a30-318">Для рабочих сценариев на портале Azure установите статический IP-адрес или [используйте PowerShell для установки статического IP-адреса компьютера контроллера домена](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span><span class="sxs-lookup"><span data-stu-id="79a30-318">For production scenarios, set the IP address to static in the Azure portal, or [use PowerShell to set the static IP address of the domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>
   >
   >

    ![Диалоговое окно добавления ролей](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/23-addroles.png)
7. <span data-ttu-id="79a30-320">Нажимайте **Далее**, пока не откроется раздел **Подтверждение**.</span><span class="sxs-lookup"><span data-stu-id="79a30-320">Click **Next** until you reach the **Confirmation** section.</span></span> <span data-ttu-id="79a30-321">Установите флажок **Автоматически перезапускать конечный сервер, если это потребуется**.</span><span class="sxs-lookup"><span data-stu-id="79a30-321">Select the **Restart the destination server automatically if required** check box.</span></span>
8. <span data-ttu-id="79a30-322">Щелкните **Install**(Установить).</span><span class="sxs-lookup"><span data-stu-id="79a30-322">Click **Install**.</span></span>
9. <span data-ttu-id="79a30-323">После установки компонентов вернитесь к панели мониторинга **Диспетчер серверов** .</span><span class="sxs-lookup"><span data-stu-id="79a30-323">After the features finish installing, return to the **Server Manager** dashboard.</span></span>
10. <span data-ttu-id="79a30-324">Выберите новый вариант **AD DS** на левой панели.</span><span class="sxs-lookup"><span data-stu-id="79a30-324">Select the new **AD DS** option on the left-hand pane.</span></span>
11. <span data-ttu-id="79a30-325">Щелкните ссылку **Дополнительно** на желтой панели предупреждения.</span><span class="sxs-lookup"><span data-stu-id="79a30-325">Click the **More** link on the yellow warning bar.</span></span>

    ![Диалоговое окно службы каталогов Active Directory на виртуальной машине DNS-сервера](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/24-addsmore.png)
12. <span data-ttu-id="79a30-327">В столбце **Действие** диалогового окна **Сведения обо всех задачах сервера** нажмите **Повысить роль этого сервера до уровня контроллера домена**.</span><span class="sxs-lookup"><span data-stu-id="79a30-327">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span></span>
13. <span data-ttu-id="79a30-328">В **мастере настройки доменных служб Active Directory**используйте следующие значения:</span><span class="sxs-lookup"><span data-stu-id="79a30-328">In the **Active Directory Domain Services Configuration Wizard**, use the following values:</span></span>

    | <span data-ttu-id="79a30-329">**Страница**</span><span class="sxs-lookup"><span data-stu-id="79a30-329">**Page**</span></span> | <span data-ttu-id="79a30-330">Настройка</span><span class="sxs-lookup"><span data-stu-id="79a30-330">Setting</span></span> |
    | --- | --- |
    | <span data-ttu-id="79a30-331">**Конфигурация развертывания**</span><span class="sxs-lookup"><span data-stu-id="79a30-331">**Deployment Configuration**</span></span> |<span data-ttu-id="79a30-332">**Добавить новый лес**</span><span class="sxs-lookup"><span data-stu-id="79a30-332">**Add a new forest**</span></span><br/> <span data-ttu-id="79a30-333">**Имя корневого домена** = corp.contoso.com</span><span class="sxs-lookup"><span data-stu-id="79a30-333">**Root domain name** = corp.contoso.com</span></span> |
    | <span data-ttu-id="79a30-334">**Параметры контроллера домена**</span><span class="sxs-lookup"><span data-stu-id="79a30-334">**Domain Controller Options**</span></span> |<span data-ttu-id="79a30-335">**Пароль DSRM** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="79a30-335">**DSRM Password** = Contoso!0000</span></span><br/><span data-ttu-id="79a30-336">**Подтверждение пароля** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="79a30-336">**Confirm Password** = Contoso!0000</span></span> |
14. <span data-ttu-id="79a30-337">Нажимайте кнопку **Далее** , чтобы пройти остальные страницы мастера.</span><span class="sxs-lookup"><span data-stu-id="79a30-337">Click **Next** to go through the other pages in the wizard.</span></span> <span data-ttu-id="79a30-338">Убедитесь, что на странице **Проверка готовности** отображается следующее сообщение: **Все проверки готовности успешно завершены**.</span><span class="sxs-lookup"><span data-stu-id="79a30-338">On the **Prerequisites Check** page, verify that you see the following message: **All prerequisite checks passed successfully**.</span></span> <span data-ttu-id="79a30-339">Можно просмотреть все применимые предупреждающие сообщения, хотя для продолжения установки это и не обязательно.</span><span class="sxs-lookup"><span data-stu-id="79a30-339">You can review any applicable warning messages, but it's possible to continue with the installation.</span></span>
15. <span data-ttu-id="79a30-340">Щелкните **Install**(Установить).</span><span class="sxs-lookup"><span data-stu-id="79a30-340">Click **Install**.</span></span> <span data-ttu-id="79a30-341">Виртуальная машина **ad-primary-dc** перезагружается автоматически.</span><span class="sxs-lookup"><span data-stu-id="79a30-341">The **ad-primary-dc** virtual machine automatically reboots.</span></span>

### <a name="note-the-ip-address-of-the-primary-domain-controller"></a><span data-ttu-id="79a30-342">Запишите IP-адрес основного контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-342">Note the IP address of the primary domain controller</span></span>

<span data-ttu-id="79a30-343">Используйте основной контроллер домена для DNS.</span><span class="sxs-lookup"><span data-stu-id="79a30-343">Use the primary domain controller for DNS.</span></span> <span data-ttu-id="79a30-344">Запишите IP-адрес основного контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-344">Note the primary domain controller IP address.</span></span>

<span data-ttu-id="79a30-345">Получить IP-адрес основного контроллера домена можно только через портал Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-345">One way to get the primary domain controller IP address is through the Azure portal.</span></span>

1. <span data-ttu-id="79a30-346">На портале Azure откройте группу ресурсов.</span><span class="sxs-lookup"><span data-stu-id="79a30-346">On the Azure portal, open the resource group.</span></span>

2. <span data-ttu-id="79a30-347">Щелкните основной контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-347">Click the primary domain controller.</span></span>

3. <span data-ttu-id="79a30-348">В колонке основного контроллера домена щелкните **Сетевые интерфейсы**.</span><span class="sxs-lookup"><span data-stu-id="79a30-348">On the primary domain controller blade, click **Network interfaces**.</span></span>

![Сетевые интерфейсы](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/25-primarydcip.png)

<span data-ttu-id="79a30-350">Сохраните частный IP-адрес для этого сервера.</span><span class="sxs-lookup"><span data-stu-id="79a30-350">Note the private IP address for this server.</span></span>

### <a name="configure-the-virtual-network-dns"></a><span data-ttu-id="79a30-351">Настройка DNS виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="79a30-351">Configure the virtual network DNS</span></span>
<span data-ttu-id="79a30-352">После создания первого контроллера домена и включения DNS на первом сервере, настройте виртуальную сеть для использования этого сервера для DNS.</span><span class="sxs-lookup"><span data-stu-id="79a30-352">After you create the first domain controller and enable DNS on the first server, configure the virtual network to use this server for DNS.</span></span>

1. <span data-ttu-id="79a30-353">На портале Azure выберите виртуальную сеть.</span><span class="sxs-lookup"><span data-stu-id="79a30-353">In the Azure portal, click on the virtual network.</span></span>

2. <span data-ttu-id="79a30-354">В разделе **Параметры** выберите **DNS-сервер**.</span><span class="sxs-lookup"><span data-stu-id="79a30-354">Under **Settings**, click **DNS Server**.</span></span>

3. <span data-ttu-id="79a30-355">Щелкните **Настраиваемый** и введите частный IP-адрес основного контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-355">Click **Custom**, and type the private IP address of the primary domain controller.</span></span>

4. <span data-ttu-id="79a30-356">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="79a30-356">Click **Save**.</span></span>

### <a name="configure-the-second-domain-controller"></a><span data-ttu-id="79a30-357">Настройка второго контроллера домена</span><span class="sxs-lookup"><span data-stu-id="79a30-357">Configure the second domain controller</span></span>
<span data-ttu-id="79a30-358">После перезагрузки основного контроллера домена можно настроить второй контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-358">After the primary domain controller reboots, you can configure the second domain controller.</span></span> <span data-ttu-id="79a30-359">Этот необязательный шаг выполняется для обеспечения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="79a30-359">This optional step is for high availability.</span></span> <span data-ttu-id="79a30-360">Чтобы настроить второй контроллер домена, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="79a30-360">Follow these steps to configure the second domain controller:</span></span>

1. <span data-ttu-id="79a30-361">На портале откройте группу ресурсов **SQL-HA-RG** и выберите машину **ad-secondary-dc**.</span><span class="sxs-lookup"><span data-stu-id="79a30-361">In the portal, open the **SQL-HA-RG** resource group and select the **ad-secondary-dc** machine.</span></span> <span data-ttu-id="79a30-362">В колонке **ad-secondary-dc** щелкните **Подключиться**, чтобы открыть RDP-файл для подключения к удаленному рабочему столу.</span><span class="sxs-lookup"><span data-stu-id="79a30-362">On the **ad-secondary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>
2. <span data-ttu-id="79a30-363">Войдите в виртуальную машину, используя настроенную учетную запись администратора (**BUILTIN\DomainAdmin**) и ее пароль (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="79a30-363">Sign in to the VM by using your configured administrator account (**BUILTIN\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="79a30-364">Измените предпочтительный адрес DNS-сервера на адрес контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-364">Change the preferred DNS server address to the address of the domain controller.</span></span>
4. <span data-ttu-id="79a30-365">В **Центре управления сетями и общим доступом** щелкните сетевой интерфейс.</span><span class="sxs-lookup"><span data-stu-id="79a30-365">In **Network and Sharing Center**, click the network interface.</span></span>
   <span data-ttu-id="79a30-366">![Сетевой интерфейс](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span><span class="sxs-lookup"><span data-stu-id="79a30-366">![Network interface](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span></span>

5. <span data-ttu-id="79a30-367">Щелкните **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="79a30-367">Click **Properties**.</span></span>
6. <span data-ttu-id="79a30-368">Выберите **Протокол IP версии 4 (TCP/IPv4)** и нажмите кнопку **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="79a30-368">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span></span>
7. <span data-ttu-id="79a30-369">Установите переключатель **Использовать следующие адреса DNS-серверов** и укажите адрес основного контроллера домена в поле **Предпочитаемый DNS-сервер**.</span><span class="sxs-lookup"><span data-stu-id="79a30-369">Select **Use the following DNS server addresses** and specify the address of the primary domain controller in **Preferred DNS server**.</span></span>
8. <span data-ttu-id="79a30-370">Нажмите кнопку **ОК**, а затем — **Закрыть**, чтобы сохранить изменения.</span><span class="sxs-lookup"><span data-stu-id="79a30-370">Click **OK**, and then **Close** to commit the changes.</span></span> <span data-ttu-id="79a30-371">Теперь вы можете присоединить виртуальную машину к домену **corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="79a30-371">You are now able to join the VM to **corp.contoso.com**.</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="79a30-372">Если вы потеряете подключение к удаленному рабочему столу после изменения параметров DNS-сервера, перейдите на портал Azure и перезапустите виртуальную машину.</span><span class="sxs-lookup"><span data-stu-id="79a30-372">If you lose the connection to your remote desktop after changing the DNS setting, go to the Azure portal and restart the virtual machine.</span></span>

9. <span data-ttu-id="79a30-373">С удаленного рабочего стола на втором контроллере домена откройте **панель мониторинга диспетчера сервера**.</span><span class="sxs-lookup"><span data-stu-id="79a30-373">From the remote desktop to the secondary domain controller, open **Server Manager Dashboard**.</span></span>
10. <span data-ttu-id="79a30-374">Щелкните ссылку **Добавление ролей и компонентов** на панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="79a30-374">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Диспетчер сервера. Добавление ролей](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
11. <span data-ttu-id="79a30-376">Нажимайте **Далее**, пока не откроется раздел **Роли сервера**.</span><span class="sxs-lookup"><span data-stu-id="79a30-376">Select **Next** until you get to the **Server Roles** section.</span></span>
12. <span data-ttu-id="79a30-377">Выберите роли **Доменные службы Active Directory** и **DNS-сервер**.</span><span class="sxs-lookup"><span data-stu-id="79a30-377">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="79a30-378">При появлении запроса добавьте требуемые для этих ролей дополнительные компоненты.</span><span class="sxs-lookup"><span data-stu-id="79a30-378">When you're prompted, add any additional features that are required by these roles.</span></span>
13. <span data-ttu-id="79a30-379">После установки компонентов вернитесь к панели мониторинга **Диспетчер серверов** .</span><span class="sxs-lookup"><span data-stu-id="79a30-379">After the features finish installing, return to the **Server Manager** dashboard.</span></span>
14. <span data-ttu-id="79a30-380">Выберите новый вариант **AD DS** на левой панели.</span><span class="sxs-lookup"><span data-stu-id="79a30-380">Select the new **AD DS** option on the left-hand pane.</span></span>
15. <span data-ttu-id="79a30-381">Щелкните ссылку **Дополнительно** на желтой панели предупреждения.</span><span class="sxs-lookup"><span data-stu-id="79a30-381">Click the **More** link on the yellow warning bar.</span></span>
16. <span data-ttu-id="79a30-382">В столбце **Действие** диалогового окна **Сведения обо всех задачах сервера** нажмите **Повысить роль этого сервера до уровня контроллера домена**.</span><span class="sxs-lookup"><span data-stu-id="79a30-382">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span></span>
17. <span data-ttu-id="79a30-383">На вкладке **Конфигурация развертывания** установите переключатель **Добавить контроллер домена в существующий домен**.</span><span class="sxs-lookup"><span data-stu-id="79a30-383">Under **Deployment Configuration**, select **Add a domain controller to an existing domain**.</span></span>
   <span data-ttu-id="79a30-384">![Конфигурация развертывания](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span><span class="sxs-lookup"><span data-stu-id="79a30-384">![Deployment configuration](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span></span>
18. <span data-ttu-id="79a30-385">Нажмите кнопку **Выбрать**.</span><span class="sxs-lookup"><span data-stu-id="79a30-385">Click **Select**.</span></span>
19. <span data-ttu-id="79a30-386">Подключитесь, используя учетную запись администратора (**CORP.CONTOSO.COM\domainadmin**) и ее пароль (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="79a30-386">Connect by using the administrator account (**CORP.CONTOSO.COM\domainadmin**) and password (**Contoso!0000**).</span></span>
20. <span data-ttu-id="79a30-387">В разделе **Выберите домен в лесу** щелкните свой домен, а затем щелкните **ОК**.</span><span class="sxs-lookup"><span data-stu-id="79a30-387">In **Select a domain from the forest**, click your domain, and then click **OK**.</span></span>
21. <span data-ttu-id="79a30-388">В разделе **Параметры контроллера домена** используйте значения по умолчанию и задайте пароль DSRM.</span><span class="sxs-lookup"><span data-stu-id="79a30-388">In **Domain Controller Options**, use the default values and set a DSRM password.</span></span>

   >[!NOTE]
   ><span data-ttu-id="79a30-389">На странице **Параметры DNS** может отобразиться предупреждение о том, что делегирование для этого DNS-сервера создать невозможно.</span><span class="sxs-lookup"><span data-stu-id="79a30-389">The **DNS Options** page might warn you that a delegation for this DNS server can't be created.</span></span> <span data-ttu-id="79a30-390">В нерабочей среде это предупреждение можно игнорировать.</span><span class="sxs-lookup"><span data-stu-id="79a30-390">You can ignore this warning in non-production environments.</span></span>
22. <span data-ttu-id="79a30-391">Нажимайте кнопку **Далее** до тех пор, пока не откроется вкладка **Предварительные требования**.</span><span class="sxs-lookup"><span data-stu-id="79a30-391">Click **Next** until the dialog reaches the **Prerequisites** check.</span></span> <span data-ttu-id="79a30-392">Нажмите **Install**(Установить).</span><span class="sxs-lookup"><span data-stu-id="79a30-392">Then click **Install**.</span></span>

<span data-ttu-id="79a30-393">После завершения изменений конфигурации перезапустите сервер.</span><span class="sxs-lookup"><span data-stu-id="79a30-393">After the server finishes the configuration changes, restart the server.</span></span>

### <a name="add-the-private-ip-address-to-the-second-domain-controller-to-the-vpn-dns-server"></a><span data-ttu-id="79a30-394">Добавление частного IP-адреса для второго контроллера домена на DNS-сервер VPN</span><span class="sxs-lookup"><span data-stu-id="79a30-394">Add the Private IP Address to the second domain controller to the VPN DNS Server</span></span>

<span data-ttu-id="79a30-395">На портале Azure в колонке виртуальной сети измените параметры DNS-сервера, добавив IP-адрес дополнительного контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-395">In the Azure portal, under virtual network, change the DNS Server to include the IP address of the secondary domain controller.</span></span> <span data-ttu-id="79a30-396">Это обеспечивает избыточность службы DNS.</span><span class="sxs-lookup"><span data-stu-id="79a30-396">This allows the DNS service redundancy.</span></span>

### <span data-ttu-id="79a30-397"><a name=DomainAccounts></a>Настройка доменных учетных записей</span><span class="sxs-lookup"><span data-stu-id="79a30-397"><a name=DomainAccounts></a> Configure the domain accounts</span></span>

<span data-ttu-id="79a30-398">На следующих шагах настраиваются учетные записи Active Directory.</span><span class="sxs-lookup"><span data-stu-id="79a30-398">In the next steps, you configure the Active Directory accounts.</span></span> <span data-ttu-id="79a30-399">Учетные записи показаны в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="79a30-399">The following table shows the accounts:</span></span>

| |<span data-ttu-id="79a30-400">Учетная запись установки</span><span class="sxs-lookup"><span data-stu-id="79a30-400">Installation account</span></span><br/> |<span data-ttu-id="79a30-401">sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="79a30-401">sqlserver-0</span></span> <br/><span data-ttu-id="79a30-402">Учетная запись SQL Server и службы агента SQL</span><span class="sxs-lookup"><span data-stu-id="79a30-402">SQL Server and SQL Agent Service account</span></span> |<span data-ttu-id="79a30-403">sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="79a30-403">sqlserver-1</span></span><br/><span data-ttu-id="79a30-404">Учетная запись SQL Server и службы агента SQL</span><span class="sxs-lookup"><span data-stu-id="79a30-404">SQL Server and SQL Agent Service account</span></span>
| --- | --- | --- | ---
|<span data-ttu-id="79a30-405">**Имя**</span><span class="sxs-lookup"><span data-stu-id="79a30-405">**First Name**</span></span> |<span data-ttu-id="79a30-406">Install</span><span class="sxs-lookup"><span data-stu-id="79a30-406">Install</span></span> |<span data-ttu-id="79a30-407">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="79a30-407">SQLSvc1</span></span> | <span data-ttu-id="79a30-408">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="79a30-408">SQLSvc2</span></span>
|<span data-ttu-id="79a30-409">**User SamAccountName**</span><span class="sxs-lookup"><span data-stu-id="79a30-409">**User SamAccountName**</span></span> |<span data-ttu-id="79a30-410">Install</span><span class="sxs-lookup"><span data-stu-id="79a30-410">Install</span></span> |<span data-ttu-id="79a30-411">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="79a30-411">SQLSvc1</span></span> | <span data-ttu-id="79a30-412">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="79a30-412">SQLSvc2</span></span>

<span data-ttu-id="79a30-413">Чтобы создать каждую учетную запись, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="79a30-413">Use the following steps to create each account.</span></span>

1. <span data-ttu-id="79a30-414">Войдите в виртуальную машину **ad-primary-dc**.</span><span class="sxs-lookup"><span data-stu-id="79a30-414">Sign in to the **ad-primary-dc** machine.</span></span>
2. <span data-ttu-id="79a30-415">На панели **Диспетчер серверов** выберите **Средства**, а затем щелкните **Центр администрирования Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="79a30-415">In **Server Manager**, select **Tools**, and then click **Active Directory Administrative Center**.</span></span>   
3. <span data-ttu-id="79a30-416">Выберите **corp (local)** в левой области.</span><span class="sxs-lookup"><span data-stu-id="79a30-416">Select **corp (local)** from the left pane.</span></span>
4. <span data-ttu-id="79a30-417">В правой области **Задачи** выберите **Создать** и щелкните **Пользователь**.</span><span class="sxs-lookup"><span data-stu-id="79a30-417">On the right **Tasks** pane, select **New**, and then click **User**.</span></span>
   <span data-ttu-id="79a30-418">![Центр администрирования Active Directory](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span><span class="sxs-lookup"><span data-stu-id="79a30-418">![Active Directory Administrative Center](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span></span>

   >[!TIP]
   ><span data-ttu-id="79a30-419">Задайте сложный пароль для каждой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="79a30-419">Set a complex password for each account.</span></span><br/> <span data-ttu-id="79a30-420">Для нерабочей среды задайте неограниченный срок действия учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="79a30-420">For non-production environments, set the user account to never expire.</span></span>

5. <span data-ttu-id="79a30-421">Нажмите кнопку **ОК**, чтобы создать пользователя.</span><span class="sxs-lookup"><span data-stu-id="79a30-421">Click **OK** to create the user.</span></span>
6. <span data-ttu-id="79a30-422">Повторите предыдущие действия для каждой из трех учетных записей.</span><span class="sxs-lookup"><span data-stu-id="79a30-422">Repeat the preceding steps for each of the three accounts.</span></span>

### <a name="grant-the-required-permissions-to-the-installation-account"></a><span data-ttu-id="79a30-423">Предоставление требуемых разрешений учетной записи установки</span><span class="sxs-lookup"><span data-stu-id="79a30-423">Grant the required permissions to the installation account</span></span>
1. <span data-ttu-id="79a30-424">В **центре администрирования Active Directory** выберите **corp (локальный)** на левой панели.</span><span class="sxs-lookup"><span data-stu-id="79a30-424">In the **Active Directory Administrative Center**, select **corp (local)** in the left pane.</span></span> <span data-ttu-id="79a30-425">Затем на правой панели **Задачи** нажмите кнопку **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="79a30-425">Then in the right-hand **Tasks** pane, click **Properties**.</span></span>

    ![Свойства пользователя CORP](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/31-addcproperties.png)
2. <span data-ttu-id="79a30-427">Выберите **Расширения**, затем нажмите кнопку **Дополнительно** на вкладке **Безопасность**.</span><span class="sxs-lookup"><span data-stu-id="79a30-427">Select **Extensions**, and then click the **Advanced** button on the **Security** tab.</span></span>
3. <span data-ttu-id="79a30-428">В диалоговом окне **Дополнительные параметры безопасности для corp** нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="79a30-428">In the **Advanced Security Settings for corp** dialog, click **Add**.</span></span>
4. <span data-ttu-id="79a30-429">Щелкните **Выберите субъект**, найдите **CORP\Install** и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="79a30-429">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span></span>
5. <span data-ttu-id="79a30-430">Установите флажок **Чтение всех свойств**.</span><span class="sxs-lookup"><span data-stu-id="79a30-430">Select the **Read all properties** check box.</span></span>

6. <span data-ttu-id="79a30-431">Установите флажок **Create Computer objects** (Создание объектов-компьютеров).</span><span class="sxs-lookup"><span data-stu-id="79a30-431">Select the **Create Computer objects** check box.</span></span>

     ![Разрешения пользователя CORP](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/33-addpermissions.png)
7. <span data-ttu-id="79a30-433">Нажмите кнопку **ОК**, а затем снова кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="79a30-433">Click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="79a30-434">Закройте окно свойств **corp**.</span><span class="sxs-lookup"><span data-stu-id="79a30-434">Close the **corp** properties window.</span></span>

<span data-ttu-id="79a30-435">После завершения настройки Active Directory и объектов-пользователей нужно создать две виртуальные машины SQL Server и виртуальную машину следящего сервера.</span><span class="sxs-lookup"><span data-stu-id="79a30-435">Now that you've finished configuring Active Directory and the user objects, create two SQL Server VMs and a witness server VM.</span></span> <span data-ttu-id="79a30-436">Затем присоедините их к этому домену.</span><span class="sxs-lookup"><span data-stu-id="79a30-436">Then join all three to the domain.</span></span>

## <a name="create-sql-server-vms"></a><span data-ttu-id="79a30-437">Создание виртуальных машин SQL Server</span><span class="sxs-lookup"><span data-stu-id="79a30-437">Create SQL Server VMs</span></span>

<span data-ttu-id="79a30-438">Создайте три дополнительные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="79a30-438">Create three additional virtual machines.</span></span> <span data-ttu-id="79a30-439">Для решения требуются две виртуальные машины с экземплярами SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-439">The solution requires two virtual machines with SQL Server instances.</span></span> <span data-ttu-id="79a30-440">Третья виртуальная машина будет выполнять роль свидетеля.</span><span class="sxs-lookup"><span data-stu-id="79a30-440">A third virtual machine will function as a witness.</span></span> <span data-ttu-id="79a30-441">Windows Server 2016 может использовать [облако-свидетель](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness), но для обеспечения согласованности с предыдущими операционными системами в этом документе в качестве свидетеля используется виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="79a30-441">Windows Server 2016 can use a [cloud witness](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness), however for consistency with previous operating systems this document uses a virtual machine for a witness.</span></span>  

<span data-ttu-id="79a30-442">Перед продолжением рассмотрите следующие решения разработки.</span><span class="sxs-lookup"><span data-stu-id="79a30-442">Before you proceed consider the following deisign decisions.</span></span>

* <span data-ttu-id="79a30-443">**Хранилище — управляемые диски Azure**</span><span class="sxs-lookup"><span data-stu-id="79a30-443">**Storage - Azure Managed Disks**</span></span>

   <span data-ttu-id="79a30-444">Для хранилища виртуальных машин используйте управляемые диски Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-444">For the virtual machine storage, use Azure Managed Disks.</span></span> <span data-ttu-id="79a30-445">Корпорация Майкрософт рекомендует управляемые диски для виртуальных машин SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-445">Microsoft recommends Managed Disks for SQL Server virtual machines.</span></span> <span data-ttu-id="79a30-446">Управляемые диски управляют хранилищем в фоновом режиме.</span><span class="sxs-lookup"><span data-stu-id="79a30-446">Managed Disks handles storage behind the scenes.</span></span> <span data-ttu-id="79a30-447">Кроме того, когда виртуальные машины с управляемыми дисками находятся в одной группе доступности, Azure распределяет ресурсы хранения, чтобы обеспечить соответствующую избыточность.</span><span class="sxs-lookup"><span data-stu-id="79a30-447">In addition, when virtual machines with Managed Disks are in the same availability set, Azure distributes the storage resources to provide appropriate redundancy.</span></span> <span data-ttu-id="79a30-448">Дополнительные сведения см. в [обзоре управляемых дисков Azure](../managed-disks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="79a30-448">For additional information, see [Azure Managed Disks Overview](../managed-disks-overview.md).</span></span> <span data-ttu-id="79a30-449">Подробные сведения об управляемых дисках в группе доступности см. в разделе [Использование управляемых дисков для виртуальных машин в группе доступности](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span><span class="sxs-lookup"><span data-stu-id="79a30-449">For specifics about managed disks in an availability set, see [Use Managed Disks for VMs in an availability set](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span></span>

* <span data-ttu-id="79a30-450">**Сеть — частные IP-адреса в рабочей среде**</span><span class="sxs-lookup"><span data-stu-id="79a30-450">**Network - Private IP addresses in production**</span></span>

   <span data-ttu-id="79a30-451">В этом руководстве для виртуальных машин используются общедоступные IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="79a30-451">For the virtual machines, this tutorial uses public IP addresses.</span></span> <span data-ttu-id="79a30-452">Это позволяет удаленно подключаться через Интернет непосредственно к виртуальной машине, что облегчает настройку.</span><span class="sxs-lookup"><span data-stu-id="79a30-452">This enables remote connection directly to the virtual machine over the internet - it makes configuration steps easier.</span></span> <span data-ttu-id="79a30-453">Корпорация Майкрософт рекомендует использовать в рабочих средах только частные IP-адреса для снижения уязвимости ресурса виртуальной машины с экземпляром SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-453">In production environments, Microsoft recommends only private IP addresses in order to reduce the vulnerability footprint of the SQL Server instance VM resource.</span></span>

### <a name="create-and-configure-the-sql-server-vms"></a><span data-ttu-id="79a30-454">Создание и настройка виртуальных машин SQL Server</span><span class="sxs-lookup"><span data-stu-id="79a30-454">Create and configure the SQL Server VMs</span></span>
<span data-ttu-id="79a30-455">Далее создайте три виртуальные машины: две виртуальные машины SQL Server и виртуальную машину для дополнительного узла кластера.</span><span class="sxs-lookup"><span data-stu-id="79a30-455">Next, create three VMs--two SQL Server VMs and a VM for an additional cluster node.</span></span> <span data-ttu-id="79a30-456">Чтобы создать виртуальные машины, вернитесь к группе ресурсов **SQL-HA-RG**, нажмите кнопку **Добавить**, найдите соответствующий элемент коллекции, щелкните **Виртуальная машина**, а затем — **Из коллекции**.</span><span class="sxs-lookup"><span data-stu-id="79a30-456">To create each of the VMs, go back to the **SQL-HA-RG** resource group, click **Add**, search for the appropriate gallery item, click **Virtual Machine**, and then click **From Gallery**.</span></span> <span data-ttu-id="79a30-457">Используйте информацию из следующей таблицы, чтобы упростить создание виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="79a30-457">Use the information in the following table to help you create the VMs:</span></span>


| <span data-ttu-id="79a30-458">Страница</span><span class="sxs-lookup"><span data-stu-id="79a30-458">Page</span></span> | <span data-ttu-id="79a30-459">VM1</span><span class="sxs-lookup"><span data-stu-id="79a30-459">VM1</span></span> | <span data-ttu-id="79a30-460">VM2</span><span class="sxs-lookup"><span data-stu-id="79a30-460">VM2</span></span> | <span data-ttu-id="79a30-461">VM3</span><span class="sxs-lookup"><span data-stu-id="79a30-461">VM3</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="79a30-462">Выбор соответствующего элемента коллекции</span><span class="sxs-lookup"><span data-stu-id="79a30-462">Select the appropriate gallery item</span></span> |<span data-ttu-id="79a30-463">**Windows Server 2016 Datacenter**</span><span class="sxs-lookup"><span data-stu-id="79a30-463">**Windows Server 2016 Datacenter**</span></span> |<span data-ttu-id="79a30-464">**SQL Server 2016 SP1 Enterprise на базе Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="79a30-464">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |<span data-ttu-id="79a30-465">**SQL Server 2016 SP1 Enterprise на базе Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="79a30-465">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |
| <span data-ttu-id="79a30-466">Конфигурация виртуальной машины **Базовый**</span><span class="sxs-lookup"><span data-stu-id="79a30-466">Virtual machine configuration **Basics**</span></span> |<span data-ttu-id="79a30-467">**Имя** = cluster-fsw</span><span class="sxs-lookup"><span data-stu-id="79a30-467">**Name** = cluster-fsw</span></span><br/><span data-ttu-id="79a30-468">**Имя пользователя** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="79a30-468">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="79a30-469">**Пароль** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="79a30-469">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="79a30-470">**Подписка** = ваша подписка</span><span class="sxs-lookup"><span data-stu-id="79a30-470">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="79a30-471">**Группа ресурсов** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="79a30-471">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="79a30-472">**Расположение** = ваше расположение Azure</span><span class="sxs-lookup"><span data-stu-id="79a30-472">**Location** = Your azure location</span></span> |<span data-ttu-id="79a30-473">**Имя** = sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="79a30-473">**Name** = sqlserver-0</span></span><br/><span data-ttu-id="79a30-474">**Имя пользователя** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="79a30-474">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="79a30-475">**Пароль** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="79a30-475">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="79a30-476">**Подписка** = ваша подписка</span><span class="sxs-lookup"><span data-stu-id="79a30-476">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="79a30-477">**Группа ресурсов** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="79a30-477">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="79a30-478">**Расположение** = ваше расположение Azure</span><span class="sxs-lookup"><span data-stu-id="79a30-478">**Location** = Your azure location</span></span> |<span data-ttu-id="79a30-479">**Имя** = sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="79a30-479">**Name** = sqlserver-1</span></span><br/><span data-ttu-id="79a30-480">**Имя пользователя** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="79a30-480">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="79a30-481">**Пароль** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="79a30-481">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="79a30-482">**Подписка** = ваша подписка</span><span class="sxs-lookup"><span data-stu-id="79a30-482">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="79a30-483">**Группа ресурсов** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="79a30-483">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="79a30-484">**Расположение** = ваше расположение Azure</span><span class="sxs-lookup"><span data-stu-id="79a30-484">**Location** = Your azure location</span></span> |
| <span data-ttu-id="79a30-485">Конфигурация виртуальной машины **Размер**</span><span class="sxs-lookup"><span data-stu-id="79a30-485">Virtual machine configuration **Size**</span></span> |<span data-ttu-id="79a30-486">**Размер** = DS1\_V2 (1 ядро, 3,5 ГБ)</span><span class="sxs-lookup"><span data-stu-id="79a30-486">**SIZE** = DS1\_V2 (1 core, 3.5 GB)</span></span> |<span data-ttu-id="79a30-487">**Размер** = DS2\_V2 (2 ядра, 7 ГБ)</span><span class="sxs-lookup"><span data-stu-id="79a30-487">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span></br><span data-ttu-id="79a30-488">Размер должен поддерживать SSD-хранилище (поддержка дисков "Премиум"</span><span class="sxs-lookup"><span data-stu-id="79a30-488">The size must support SSD storage (Premium disk support.</span></span> <span data-ttu-id="79a30-489">)</span><span class="sxs-lookup"><span data-stu-id="79a30-489">))</span></span> |<span data-ttu-id="79a30-490">**Размер** = DS2\_V2 (2 ядра, 7 ГБ)</span><span class="sxs-lookup"><span data-stu-id="79a30-490">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span> |
| <span data-ttu-id="79a30-491">Конфигурация виртуальной машины **Параметры**</span><span class="sxs-lookup"><span data-stu-id="79a30-491">Virtual machine configuration **Settings**</span></span> |<span data-ttu-id="79a30-492">**Хранилище**: используйте управляемые диски.</span><span class="sxs-lookup"><span data-stu-id="79a30-492">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="79a30-493">**Виртуальная сеть** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="79a30-493">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="79a30-494">**Подсеть** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="79a30-494">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="79a30-495">**Общедоступный IP-адрес** создается автоматически.</span><span class="sxs-lookup"><span data-stu-id="79a30-495">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="79a30-496">**Группа безопасности сети** = нет</span><span class="sxs-lookup"><span data-stu-id="79a30-496">**Network security group** = None</span></span><br/><span data-ttu-id="79a30-497">**Диагностика мониторинга** = включено</span><span class="sxs-lookup"><span data-stu-id="79a30-497">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="79a30-498">**Учетная запись хранения для диагностики** = используйте автоматически созданную учетную запись хранения</span><span class="sxs-lookup"><span data-stu-id="79a30-498">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="79a30-499">**Группа доступности** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="79a30-499">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="79a30-500">**Хранилище**: используйте управляемые диски.</span><span class="sxs-lookup"><span data-stu-id="79a30-500">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="79a30-501">**Виртуальная сеть** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="79a30-501">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="79a30-502">**Подсеть** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="79a30-502">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="79a30-503">**Общедоступный IP-адрес** создается автоматически.</span><span class="sxs-lookup"><span data-stu-id="79a30-503">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="79a30-504">**Группа безопасности сети** = нет</span><span class="sxs-lookup"><span data-stu-id="79a30-504">**Network security group** = None</span></span><br/><span data-ttu-id="79a30-505">**Диагностика мониторинга** = включено</span><span class="sxs-lookup"><span data-stu-id="79a30-505">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="79a30-506">**Учетная запись хранения для диагностики** = используйте автоматически созданную учетную запись хранения</span><span class="sxs-lookup"><span data-stu-id="79a30-506">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="79a30-507">**Группа доступности** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="79a30-507">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="79a30-508">**Хранилище**: используйте управляемые диски.</span><span class="sxs-lookup"><span data-stu-id="79a30-508">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="79a30-509">**Виртуальная сеть** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="79a30-509">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="79a30-510">**Подсеть** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="79a30-510">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="79a30-511">**Общедоступный IP-адрес** создается автоматически.</span><span class="sxs-lookup"><span data-stu-id="79a30-511">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="79a30-512">**Группа безопасности сети** = нет</span><span class="sxs-lookup"><span data-stu-id="79a30-512">**Network security group** = None</span></span><br/><span data-ttu-id="79a30-513">**Диагностика мониторинга** = включено</span><span class="sxs-lookup"><span data-stu-id="79a30-513">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="79a30-514">**Учетная запись хранения для диагностики** = используйте автоматически созданную учетную запись хранения</span><span class="sxs-lookup"><span data-stu-id="79a30-514">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="79a30-515">**Группа доступности** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="79a30-515">**Availability set** = sqlAvailabilitySet</span></span><br/> |
| <span data-ttu-id="79a30-516">Конфигурация виртуальной машины **Параметры SQL Server**</span><span class="sxs-lookup"><span data-stu-id="79a30-516">Virtual machine configuration **SQL Server settings**</span></span> |<span data-ttu-id="79a30-517">Не применяется</span><span class="sxs-lookup"><span data-stu-id="79a30-517">Not applicable</span></span> |<span data-ttu-id="79a30-518">**Подключение к SQL** = закрытое (в виртуальной сети)</span><span class="sxs-lookup"><span data-stu-id="79a30-518">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="79a30-519">**Порт** = 1433</span><span class="sxs-lookup"><span data-stu-id="79a30-519">**Port** = 1433</span></span><br/><span data-ttu-id="79a30-520">**Проверка подлинности SQL** = отключено</span><span class="sxs-lookup"><span data-stu-id="79a30-520">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="79a30-521">**Конфигурация хранилища** = общая</span><span class="sxs-lookup"><span data-stu-id="79a30-521">**Storage configuration** = General</span></span><br/><span data-ttu-id="79a30-522">**Автоматическое исправление** = воскресенье в 2:00</span><span class="sxs-lookup"><span data-stu-id="79a30-522">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="79a30-523">**Автоматическая архивация** = отключено</span><span class="sxs-lookup"><span data-stu-id="79a30-523">**Automated backup** = Disabled</span></span></br><span data-ttu-id="79a30-524">**Интеграция хранилища ключей Azure** = отключено</span><span class="sxs-lookup"><span data-stu-id="79a30-524">**Azure Key Vault integration** = Disabled</span></span> |<span data-ttu-id="79a30-525">**Подключение к SQL** = закрытое (в виртуальной сети)</span><span class="sxs-lookup"><span data-stu-id="79a30-525">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="79a30-526">**Порт** = 1433</span><span class="sxs-lookup"><span data-stu-id="79a30-526">**Port** = 1433</span></span><br/><span data-ttu-id="79a30-527">**Проверка подлинности SQL** = отключено</span><span class="sxs-lookup"><span data-stu-id="79a30-527">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="79a30-528">**Конфигурация хранилища** = общая</span><span class="sxs-lookup"><span data-stu-id="79a30-528">**Storage configuration** = General</span></span><br/><span data-ttu-id="79a30-529">**Автоматическое исправление** = воскресенье в 2:00</span><span class="sxs-lookup"><span data-stu-id="79a30-529">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="79a30-530">**Автоматическая архивация** = отключено</span><span class="sxs-lookup"><span data-stu-id="79a30-530">**Automated backup** = Disabled</span></span></br><span data-ttu-id="79a30-531">**Интеграция хранилища ключей Azure** = отключено</span><span class="sxs-lookup"><span data-stu-id="79a30-531">**Azure Key Vault integration** = Disabled</span></span> |

<br/>

> [!NOTE]
> <span data-ttu-id="79a30-532">Предлагаемые здесь размеры компьютеров предназначены для тестирования групп доступности в виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="79a30-532">The machine sizes suggested here are meant for testing availability groups in Azure VMs.</span></span> <span data-ttu-id="79a30-533">Для обеспечения оптимальной производительности рабочих нагрузок изучите рекомендации по размерам машин SQL Server и их настройке в статье [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="79a30-533">For the best performance on production workloads, see the recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>
>
>

<span data-ttu-id="79a30-534">После завершения подготовки трех виртуальных машин вам потребуется присоединить их к домену **corp.contoso.com** и предоставить пользователю CORP\Install права администратора виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="79a30-534">After the three VMs are fully provisioned, you need to join them to the **corp.contoso.com** domain and grant CORP\Install administrative rights to the machines.</span></span>

### <span data-ttu-id="79a30-535"><a name="joinDomain"></a>Присоединение серверов к домену</span><span class="sxs-lookup"><span data-stu-id="79a30-535"><a name="joinDomain"></a>Join the servers to the domain</span></span>

<span data-ttu-id="79a30-536">Теперь вы можете присоединить виртуальные машины к домену **corp.contoso.com**. Выполните следующие действия для виртуальных машин SQL Server и сервера файловых ресурсов-свидетелей.</span><span class="sxs-lookup"><span data-stu-id="79a30-536">You're now able to join the VMs to **corp.contoso.com**. Do the following for both the SQL Server VMs and the file share witness server:</span></span>

1. <span data-ttu-id="79a30-537">Удаленно подключитесь к виртуальной машине в качестве пользователя **BUILTIN\DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="79a30-537">Remotely connect to the virtual machine with **BUILTIN\DomainAdmin**.</span></span>
2. <span data-ttu-id="79a30-538">В **диспетчере сервера** щелкните **Локальный сервер**.</span><span class="sxs-lookup"><span data-stu-id="79a30-538">In **Server Manager**, click **Local Server**.</span></span>
3. <span data-ttu-id="79a30-539">Щелкните ссылку **Рабочая группа**.</span><span class="sxs-lookup"><span data-stu-id="79a30-539">Click the **WORKGROUP** link.</span></span>
4. <span data-ttu-id="79a30-540">В разделе **Имя компьютера** нажмите кнопку **Изменить**.</span><span class="sxs-lookup"><span data-stu-id="79a30-540">In the **Computer Name** section, click **Change**.</span></span>
5. <span data-ttu-id="79a30-541">Установить флажок **Домен** и введите в текстовом поле **corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="79a30-541">Select the **Domain** check box and type **corp.contoso.com** in the text box.</span></span> <span data-ttu-id="79a30-542">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="79a30-542">Click **OK**.</span></span>
6. <span data-ttu-id="79a30-543">Во всплывающем диалоговом окне **Безопасность Windows** укажите имя (**CORP\DomainAdmin**) и пароль (**Contoso!0000**) учетной записи администратора домена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="79a30-543">In the **Windows Security** popup dialog, specify the credentials for the default domain administrator account (**CORP\DomainAdmin**) and the password (**Contoso!0000**).</span></span>
7. <span data-ttu-id="79a30-544">При появлении сообщения "Добро пожаловать на домен corp.contoso.com" нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="79a30-544">When you see the "Welcome to the corp.contoso.com domain" message, click **OK**.</span></span>
8. <span data-ttu-id="79a30-545">Нажмите кнопку **Закрыть**, а затем **Перезагрузить сейчас** во всплывающем диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="79a30-545">Click **Close**, and then click **Restart Now** in the popup dialog.</span></span>

### <a name="add-the-corpinstall-user-as-an-administrator-on-each-cluster-vm"></a><span data-ttu-id="79a30-546">Добавление пользователя Corp\Install в качестве администратора на каждой виртуальной машине кластера</span><span class="sxs-lookup"><span data-stu-id="79a30-546">Add the Corp\Install user as an administrator on each cluster VM</span></span>

<span data-ttu-id="79a30-547">После того как каждая виртуальная машина будет перезапущена и войдет в состав домена, добавьте **CORP\Install** как участника группы локальных администраторов.</span><span class="sxs-lookup"><span data-stu-id="79a30-547">After each virtual machine restarts as a member of the domain, add **CORP\Install** as a member of the local administrators group.</span></span>

1. <span data-ttu-id="79a30-548">Дождитесь перезапуска виртуальной машины, а затем запустите RDP-файл еще раз на основном контроллере домена, чтобы войти на **sqlserver-0**, используя учетную запись **CORP\DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="79a30-548">Wait until the VM is restarted, then launch the RDP file again from the primary domain controller to sign in to **sqlserver-0** by using the **CORP\DomainAdmin** account.</span></span>
   >[!TIP]
   ><span data-ttu-id="79a30-549">Обязательно выполните вход с использованием учетной записи администратора домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-549">Make sure that you sign in with the domain administrator account.</span></span> <span data-ttu-id="79a30-550">Ранее вы использовали учетную запись администратора BUILTIN.</span><span class="sxs-lookup"><span data-stu-id="79a30-550">In the previous steps, you were using the BUILT IN administrator account.</span></span> <span data-ttu-id="79a30-551">Теперь, когда сервер находится в домене, используйте учетную запись домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-551">Now that the server is in the domain, use the domain account.</span></span> <span data-ttu-id="79a30-552">В сеансе RDP укажите *Домен*\\*имя пользователя*.</span><span class="sxs-lookup"><span data-stu-id="79a30-552">In your RDP session, specify *DOMAIN*\\*username*.</span></span>

2. <span data-ttu-id="79a30-553">На панели **Диспетчер серверов** выберите **Инструменты**, а затем щелкните **Управление компьютером**.</span><span class="sxs-lookup"><span data-stu-id="79a30-553">In **Server Manager**, select **Tools**, and then click **Computer Management**.</span></span>
3. <span data-ttu-id="79a30-554">В окне **Управление компьютерами** разверните пункт **Локальные пользователи и группы**, а затем выберите **Группы**.</span><span class="sxs-lookup"><span data-stu-id="79a30-554">In the **Computer Management** window, expand **Local Users and Groups**, and then select **Groups**.</span></span>
4. <span data-ttu-id="79a30-555">Дважды щелкните группу **Администраторы** .</span><span class="sxs-lookup"><span data-stu-id="79a30-555">Double-click the **Administrators** group.</span></span>
5. <span data-ttu-id="79a30-556">В диалоговом окне **Свойства администратора** нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="79a30-556">In the **Administrators Properties** dialog, click the **Add** button.</span></span>
6. <span data-ttu-id="79a30-557">Введите имя пользователя **CORP\Install**, а затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="79a30-557">Enter the user **CORP\Install**, and then click **OK**.</span></span>
7. <span data-ttu-id="79a30-558">Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Свойства администратора**.</span><span class="sxs-lookup"><span data-stu-id="79a30-558">Click **OK** to close the **Administrator Properties** dialog.</span></span>
8. <span data-ttu-id="79a30-559">Повторите описанные выше шаги для **sqlserver-1** и **cluster-fsw**.</span><span class="sxs-lookup"><span data-stu-id="79a30-559">Repeat the previous steps on **sqlserver-1** and **cluster-fsw**.</span></span>

### <span data-ttu-id="79a30-560"><a name="setServiceAccount"></a>Настройка учетных записей службы SQL Server</span><span class="sxs-lookup"><span data-stu-id="79a30-560"><a name="setServiceAccount"></a>Set the SQL Server service accounts</span></span>

<span data-ttu-id="79a30-561">На каждой виртуальной машине SQL Server настройте учетную запись службы SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-561">On each SQL Server VM, set the SQL Server service account.</span></span> <span data-ttu-id="79a30-562">Используйте учетные записи, созданные при [настройке учетных записей домена](#DomainAccounts).</span><span class="sxs-lookup"><span data-stu-id="79a30-562">Use the accounts that you created when you [configured the domain accounts](#DomainAccounts).</span></span>

1. <span data-ttu-id="79a30-563">Откройте **диспетчер конфигурации SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="79a30-563">Open **SQL Server Configuration Manager**.</span></span>
2. <span data-ttu-id="79a30-564">Щелкните правой кнопкой мыши службу SQL Server, а затем выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="79a30-564">Right-click the SQL Server service, and then click **Properties**.</span></span>
3. <span data-ttu-id="79a30-565">Настройте учетную запись и задайте пароль.</span><span class="sxs-lookup"><span data-stu-id="79a30-565">Set the account and password.</span></span>
4. <span data-ttu-id="79a30-566">Повторите эти действия на другой виртуальной машине SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-566">Repeat these steps on the other SQL Server VM.</span></span>  

<span data-ttu-id="79a30-567">Для групп доступности SQL Server каждая виртуальная машине SQL Server должна запускаться как учетная запись домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-567">For SQL Server availability groups, each SQL Server VM needs to run as a domain account.</span></span>

### <a name="create-a-sign-in-on-each-sql-server-vm-for-the-installation-account"></a><span data-ttu-id="79a30-568">Создание на каждой виртуальной машине SQL Server имени для входа для учетной записи установки</span><span class="sxs-lookup"><span data-stu-id="79a30-568">Create a sign-in on each SQL Server VM for the installation account</span></span>

<span data-ttu-id="79a30-569">Используйте учетную запись установки (CORP\install), чтобы настроить группу доступности.</span><span class="sxs-lookup"><span data-stu-id="79a30-569">Use the installation account (CORP\install) to configure the availability group.</span></span> <span data-ttu-id="79a30-570">Эта учетная запись должна быть участником фиксированной роли сервера **sysadmin** на каждой виртуальной машине SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-570">This account needs to be a member of the **sysadmin** fixed server role on each SQL Server VM.</span></span> <span data-ttu-id="79a30-571">Чтобы создать имя для входа для учетной записи установки, сделайте следующее.</span><span class="sxs-lookup"><span data-stu-id="79a30-571">The following steps create a sign-in for the installation account:</span></span>

1. <span data-ttu-id="79a30-572">Подключитесь к серверу по протоколу удаленного рабочего стола (RDP) с помощью учетной записи *\<MachineName\>\DomainAdmin*.</span><span class="sxs-lookup"><span data-stu-id="79a30-572">Connect to the server through the Remote Desktop Protocol (RDP) by using the *\<MachineName\>\DomainAdmin* account.</span></span>

1. <span data-ttu-id="79a30-573">Откройте SQL Server Management Studio и подключитесь к локальному экземпляру сервера SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-573">Open SQL Server Management Studio and connect to the local instance of SQL Server.</span></span>

1. <span data-ttu-id="79a30-574">В **обозревателе объектов** щелкните **Безопасность**.</span><span class="sxs-lookup"><span data-stu-id="79a30-574">In **Object Explorer**, click **Security**.</span></span>

1. <span data-ttu-id="79a30-575">Щелкните правой кнопкой мыши **Имена входа**.</span><span class="sxs-lookup"><span data-stu-id="79a30-575">Right-click **Logins**.</span></span> <span data-ttu-id="79a30-576">Выберите **Создать имя входа**.</span><span class="sxs-lookup"><span data-stu-id="79a30-576">Click **New Login**.</span></span>

1. <span data-ttu-id="79a30-577">В разделе **Создание имени входа** щелкните **Поиск**.</span><span class="sxs-lookup"><span data-stu-id="79a30-577">In **Login - New**, click **Search**.</span></span>

1. <span data-ttu-id="79a30-578">Щелкните **Расположения**.</span><span class="sxs-lookup"><span data-stu-id="79a30-578">Click **Locations**.</span></span>

1. <span data-ttu-id="79a30-579">Введите сетевые учетные данные администратора домена.</span><span class="sxs-lookup"><span data-stu-id="79a30-579">Enter the domain administrator network credentials.</span></span>

1. <span data-ttu-id="79a30-580">Используйте учетную запись установки.</span><span class="sxs-lookup"><span data-stu-id="79a30-580">Use the installation account.</span></span>

1. <span data-ttu-id="79a30-581">Сделайте имя для входа участником фиксированной роли сервера **sysadmin**.</span><span class="sxs-lookup"><span data-stu-id="79a30-581">Set the sign-in to be a member of the **sysadmin** fixed server role.</span></span>

1. <span data-ttu-id="79a30-582">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="79a30-582">Click **OK**.</span></span>

<span data-ttu-id="79a30-583">Повторите эти действия на другой виртуальной машине SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-583">Repeat the preceding steps on the other SQL Server VM.</span></span>

## <a name="add-failover-clustering-features-to-both-sql-server-vms"></a><span data-ttu-id="79a30-584">Добавление функций отказоустойчивого кластера на обеих виртуальных машинах SQL Server</span><span class="sxs-lookup"><span data-stu-id="79a30-584">Add Failover Clustering features to both SQL Server VMs</span></span>

<span data-ttu-id="79a30-585">Чтобы добавить функции отказоустойчивого кластера, на обеих виртуальных машинах SQL Server сделайте следующее.</span><span class="sxs-lookup"><span data-stu-id="79a30-585">To add Failover Clustering features, do the following on both SQL Server VMs:</span></span>

1. <span data-ttu-id="79a30-586">Подключитесь к виртуальной машине SQL Server по протоколу удаленного рабочего стола (RDP) с помощью учетной записи *CORP\install*.</span><span class="sxs-lookup"><span data-stu-id="79a30-586">Connect to the SQL Server virtual machine through the Remote Desktop Protocol (RDP) by using the *CORP\install* account.</span></span> <span data-ttu-id="79a30-587">Откройте **панель мониторинга диспетчера сервера**.</span><span class="sxs-lookup"><span data-stu-id="79a30-587">Open **Server Manager Dashboard**.</span></span>
2. <span data-ttu-id="79a30-588">Щелкните ссылку **Добавление ролей и компонентов** на панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="79a30-588">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Диспетчер сервера. Добавление ролей](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
3. <span data-ttu-id="79a30-590">Нажимайте кнопку **Далее**, пока не откроется раздел **Server Features** (Функции сервера).</span><span class="sxs-lookup"><span data-stu-id="79a30-590">Select **Next** until you get to the **Server Features** section.</span></span>
4. <span data-ttu-id="79a30-591">В разделе **функций** выберите **Отказоустойчивость кластеров**.</span><span class="sxs-lookup"><span data-stu-id="79a30-591">In **Features**, select **Failover Clustering**.</span></span>
5. <span data-ttu-id="79a30-592">Добавьте другие необходимые функции.</span><span class="sxs-lookup"><span data-stu-id="79a30-592">Add any additional required features.</span></span>
6. <span data-ttu-id="79a30-593">Щелкните **Установить**, чтобы добавить функции.</span><span class="sxs-lookup"><span data-stu-id="79a30-593">Click **Install** to add the features.</span></span>

<span data-ttu-id="79a30-594">Повторите эти действия на другой виртуальной машине SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-594">Repeat the steps on the other SQL Server VM.</span></span>

## <a name="a-nameendpoint-firewall-configure-the-firewall-on-each-sql-server-vm"></a><span data-ttu-id="79a30-595"><a name="endpoint-firewall"> Настройка брандмауэра на каждой виртуальной машине SQL Server</span><span class="sxs-lookup"><span data-stu-id="79a30-595"><a name="endpoint-firewall"> Configure the firewall on each SQL Server VM</span></span>

<span data-ttu-id="79a30-596">Это решение требует, чтобы в брандмауэре были открыты следующие TCP-порты:</span><span class="sxs-lookup"><span data-stu-id="79a30-596">The solution requires the following TCP ports to be open in the firewall:</span></span>

- <span data-ttu-id="79a30-597">**Виртуальная машина SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="79a30-597">**SQL Server VM**:</span></span><br/>
   <span data-ttu-id="79a30-598">Порт 1433 для экземпляра сервера SQL Server по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="79a30-598">Port 1433 for a default instance of SQL Server.</span></span>
- <span data-ttu-id="79a30-599">**Проба Azure Load Balancer**.</span><span class="sxs-lookup"><span data-stu-id="79a30-599">**Azure load balancer probe:**</span></span><br/>
   <span data-ttu-id="79a30-600">Любой доступный порт.</span><span class="sxs-lookup"><span data-stu-id="79a30-600">Any available port.</span></span> <span data-ttu-id="79a30-601">В примерах часто используется 59999.</span><span class="sxs-lookup"><span data-stu-id="79a30-601">Examples frequently use 59999.</span></span>
- <span data-ttu-id="79a30-602">**Конечная точка зеркального отображения базы данных**.</span><span class="sxs-lookup"><span data-stu-id="79a30-602">**Database mirroring endpoint:**</span></span> <br/>
   <span data-ttu-id="79a30-603">Любой доступный порт.</span><span class="sxs-lookup"><span data-stu-id="79a30-603">Any available port.</span></span> <span data-ttu-id="79a30-604">В примерах часто используется 5022.</span><span class="sxs-lookup"><span data-stu-id="79a30-604">Examples frequently use 5022.</span></span>

<span data-ttu-id="79a30-605">Порты брандмауэра должны быть открыты на обеих виртуальных машинах SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-605">The firewall ports need to be open on both SQL Server VMs.</span></span>

<span data-ttu-id="79a30-606">Метод открытия портов зависит от используемого решения брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="79a30-606">The method of opening the ports depends on the firewall solution that you use.</span></span> <span data-ttu-id="79a30-607">В следующем разделе показано, как открыть порты в брандмауэре Windows.</span><span class="sxs-lookup"><span data-stu-id="79a30-607">The next section explains how to open the ports in Windows Firewall.</span></span> <span data-ttu-id="79a30-608">Откройте необходимые порты на каждой из виртуальных машин SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-608">Open the required ports on each of your SQL Server VMs.</span></span>

### <a name="open-a-tcp-port-in-the-firewall"></a><span data-ttu-id="79a30-609">Открытие TCP-порта в брандмауэре</span><span class="sxs-lookup"><span data-stu-id="79a30-609">Open a TCP port in the firewall</span></span>

1. <span data-ttu-id="79a30-610">На первом сервере SQL Server на **начальном экране** запустите **Брандмауэр Windows в режиме повышенной безопасности**.</span><span class="sxs-lookup"><span data-stu-id="79a30-610">On the first SQL Server **Start** screen, launch **Windows Firewall with Advanced Security**.</span></span>
2. <span data-ttu-id="79a30-611">В левой области выберите **Правила для входящих подключений**.</span><span class="sxs-lookup"><span data-stu-id="79a30-611">On the left pane, select **Inbound Rules**.</span></span> <span data-ttu-id="79a30-612">На правой панели нажмите кнопку **Новое правило**.</span><span class="sxs-lookup"><span data-stu-id="79a30-612">On the right pane, click **New Rule**.</span></span>
3. <span data-ttu-id="79a30-613">Для параметра **Тип правила** выберите **Порт**.</span><span class="sxs-lookup"><span data-stu-id="79a30-613">For **Rule Type**, choose **Port**.</span></span>
4. <span data-ttu-id="79a30-614">Для порта выберите тип **TCP** и введите соответствующие номера портов.</span><span class="sxs-lookup"><span data-stu-id="79a30-614">For the port, specify **TCP** and type the appropriate port numbers.</span></span> <span data-ttu-id="79a30-615">Как в этом примере:</span><span class="sxs-lookup"><span data-stu-id="79a30-615">See the following example:</span></span>

   ![Брандмауэр SQL](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/35-tcpports.png)

5. <span data-ttu-id="79a30-617">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="79a30-617">Click **Next**.</span></span>
6. <span data-ttu-id="79a30-618">На странице **Действие** оставьте установленным флажок **Разрешить подключение** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="79a30-618">On the **Action** page, keep **Allow the connection** selected, and then click **Next**.</span></span>
7. <span data-ttu-id="79a30-619">На странице **Профиль** примите параметры по умолчанию и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="79a30-619">On the **Profile** page, accept the default settings, and then click **Next**.</span></span>
8. <span data-ttu-id="79a30-620">На странице **Имя** в текстовом поле **Имя** укажите имя правила, например **Проба Azure LB**, и нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="79a30-620">On the **Name** page, specify a rule name (such as **Azure LB Probe**) in the **Name** text box, and then click **Finish**.</span></span>

<span data-ttu-id="79a30-621">Повторите эти действия на второй виртуальной машине SQL Server.</span><span class="sxs-lookup"><span data-stu-id="79a30-621">Repeat these steps on the second SQL Server VM.</span></span>

## <a name="next-steps"></a><span data-ttu-id="79a30-622">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="79a30-622">Next steps</span></span>

* [<span data-ttu-id="79a30-623">Настройка группы доступности AlwaysOn на виртуальной машине Azure вручную</span><span class="sxs-lookup"><span data-stu-id="79a30-623">Create a SQL Server Always On availability group on Azure virtual machines</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md)
