---
title: "Группирует aaaSQL доступность сервера - виртуальных машинах Azure — обязательные требования | Документы Microsoft"
description: "В этом учебнике показано, как группировать условия hello tooconfigure создания доступности AlwaysOn в SQL Server на виртуальных машинах Azure."
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: c492db4c-3faa-4645-849f-5a1a663be55a
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/09/2017
ms.author: mikeray
ms.openlocfilehash: eed0729ead25c7793bb17a04cd7fd996c7dc8c9d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="complete-hello-prerequisites-for-creating-always-on-availability-groups-on-azure-virtual-machines"></a><span data-ttu-id="1135f-103">Выполните hello предварительные требования для создания групп доступности AlwaysOn на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="1135f-103">Complete hello prerequisites for creating Always On availability groups on Azure virtual machines</span></span>

<span data-ttu-id="1135f-104">В этом учебнике показано, как toocomplete hello предварительные условия для создания [SQL Server группы доступности AlwaysOn на виртуальных машинах (ВМ) Azure](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="1135f-104">This tutorial shows how toocomplete hello prerequisites for creating a [SQL Server Always On availability group on Azure virtual machines (VMs)](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span></span> <span data-ttu-id="1135f-105">После завершения необходимых компонентов hello имеется контроллер домена, две виртуальные машины SQL Server и следящего сервера в единой группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="1135f-105">When you've finished hello prerequisites, you have a domain controller, two SQL Server VMs, and a witness server in a single resource group.</span></span>

<span data-ttu-id="1135f-106">**Примерное время**: может занять несколько часов предварительные требования toocomplete hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-106">**Time estimate**: It might take a couple of hours toocomplete hello prerequisites.</span></span> <span data-ttu-id="1135f-107">Большая часть времени уходит на создание виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="1135f-107">Much of this time is spent creating virtual machines.</span></span>

<span data-ttu-id="1135f-108">Hello следующей схеме показано построение hello учебника.</span><span class="sxs-lookup"><span data-stu-id="1135f-108">hello following diagram illustrates what you build in hello tutorial.</span></span>

![Группа доступности](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/00-EndstateSampleNoELB.png)

## <a name="review-availability-group-documentation"></a><span data-ttu-id="1135f-110">Обзор документации по группам доступности</span><span class="sxs-lookup"><span data-stu-id="1135f-110">Review availability group documentation</span></span>

<span data-ttu-id="1135f-111">В этом руководстве предполагается, что у вас имеется базовое представление о группах доступности AlwaysOn SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-111">This tutorial assumes that you have a basic understanding of SQL Server Always On availability groups.</span></span> <span data-ttu-id="1135f-112">Если же данная технология вам незнакома, изучите статью [Обзор групп доступности AlwaysOn (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span><span class="sxs-lookup"><span data-stu-id="1135f-112">If you're not familiar with this technology, see [Overview of Always On Availability Groups (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span></span>


## <a name="create-an-azure-account"></a><span data-ttu-id="1135f-113">Создание учетной записи Azure</span><span class="sxs-lookup"><span data-stu-id="1135f-113">Create an Azure account</span></span>
<span data-ttu-id="1135f-114">Вам понадобится учетная запись Azure.</span><span class="sxs-lookup"><span data-stu-id="1135f-114">You need an Azure account.</span></span> <span data-ttu-id="1135f-115">Вы можете [создать бесплатную учетную запись Azure](/pricing/free-trial/?WT.mc_id=A261C142F) или [активировать преимущества для подписчиков Visual Studio](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span><span class="sxs-lookup"><span data-stu-id="1135f-115">You can [open a free Azure account](/pricing/free-trial/?WT.mc_id=A261C142F) or [activate Visual Studio subscriber benefits](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span></span>

## <a name="create-a-resource-group"></a><span data-ttu-id="1135f-116">Создание группы ресурсов</span><span class="sxs-lookup"><span data-stu-id="1135f-116">Create a resource group</span></span>
1. <span data-ttu-id="1135f-117">Войдите в toohello [портал Azure](http://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="1135f-117">Sign in toohello [Azure portal](http://portal.azure.com).</span></span>
2. <span data-ttu-id="1135f-118">Нажмите кнопку  **+**  toocreate объекта hello портала.</span><span class="sxs-lookup"><span data-stu-id="1135f-118">Click **+** toocreate a new object in hello portal.</span></span>

   ![Новый объект](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-portalplus.png)

3. <span data-ttu-id="1135f-120">Тип **группы ресурсов** в hello **Marketplace** окно поиска.</span><span class="sxs-lookup"><span data-stu-id="1135f-120">Type **resource group** in hello **Marketplace** search window.</span></span>

   ![Группа ресурсов](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroupsymbol.png)
4. <span data-ttu-id="1135f-122">Щелкните **Группа ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="1135f-122">Click **Resource group**.</span></span>
5. <span data-ttu-id="1135f-123">Щелкните **Создать**.</span><span class="sxs-lookup"><span data-stu-id="1135f-123">Click **Create**.</span></span>
6. <span data-ttu-id="1135f-124">На hello **группы ресурсов** колонки в разделе **имя группы ресурсов**, введите имя группы ресурсов hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-124">On hello **Resource group** blade, under **Resource group name**, type a name for hello resource group.</span></span> <span data-ttu-id="1135f-125">Например, введите **sql-ha-rg**.</span><span class="sxs-lookup"><span data-stu-id="1135f-125">For example, type **sql-ha-rg**.</span></span>
7. <span data-ttu-id="1135f-126">Если у вас несколько подписок Azure, проверьте подписки hello hello подписки Azure, который необходимо включить группы доступности toocreate hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-126">If you have multiple Azure subscriptions, verify that hello subscription is hello Azure subscription that you want toocreate hello availability group in.</span></span>
8. <span data-ttu-id="1135f-127">Выберите расположение.</span><span class="sxs-lookup"><span data-stu-id="1135f-127">Select a location.</span></span> <span data-ttu-id="1135f-128">расположение Hello — hello место группы доступности hello toocreate регион Azure.</span><span class="sxs-lookup"><span data-stu-id="1135f-128">hello location is hello Azure region where you want toocreate hello availability group.</span></span> <span data-ttu-id="1135f-129">В этом учебнике мы будем toobuild все ресурсы в одном расположении Azure.</span><span class="sxs-lookup"><span data-stu-id="1135f-129">For this tutorial, we're going toobuild all resources in one Azure location.</span></span>
9. <span data-ttu-id="1135f-130">Убедитесь, что **toodashboard ПИН-код** проверяется.</span><span class="sxs-lookup"><span data-stu-id="1135f-130">Verify that **Pin toodashboard** is checked.</span></span> <span data-ttu-id="1135f-131">Этот необязательный параметр помещает ярлык для группы ресурсов hello hello Azure панели мониторинга портала.</span><span class="sxs-lookup"><span data-stu-id="1135f-131">This optional setting places a shortcut for hello resource group on hello Azure portal dashboard.</span></span>

   ![Группа ресурсов](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroup.png)

10. <span data-ttu-id="1135f-133">Нажмите кнопку **создать** группы ресурсов toocreate hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-133">Click **Create** toocreate hello resource group.</span></span>

<span data-ttu-id="1135f-134">Azure создает группы ресурсов hello и ПИН-кодов группы ресурсов toohello ярлыков на портале hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-134">Azure creates hello resource group and pins a shortcut toohello resource group in hello portal.</span></span>

## <a name="create-hello-network-and-subnets"></a><span data-ttu-id="1135f-135">Создать hello сети и подсети</span><span class="sxs-lookup"><span data-stu-id="1135f-135">Create hello network and subnets</span></span>
<span data-ttu-id="1135f-136">Hello следующим шагом является toocreate hello сети и подсети в группе ресурсов Azure hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-136">hello next step is toocreate hello networks and subnets in hello Azure resource group.</span></span>

<span data-ttu-id="1135f-137">Hello решении используется одна виртуальная сеть с двумя подсетями.</span><span class="sxs-lookup"><span data-stu-id="1135f-137">hello solution uses one virtual network with two subnets.</span></span> <span data-ttu-id="1135f-138">Hello [Обзор виртуальной сети](../../../virtual-network/virtual-networks-overview.md) предоставляет дополнительные сведения о сетях в Azure.</span><span class="sxs-lookup"><span data-stu-id="1135f-138">hello [Virtual network overview](../../../virtual-network/virtual-networks-overview.md) provides more information about networks in Azure.</span></span>

<span data-ttu-id="1135f-139">Виртуальная сеть hello toocreate:</span><span class="sxs-lookup"><span data-stu-id="1135f-139">toocreate hello virtual network:</span></span>

1. <span data-ttu-id="1135f-140">В hello портал Azure, в группе ресурсов, нажмите кнопку **+ добавить**.</span><span class="sxs-lookup"><span data-stu-id="1135f-140">In hello Azure portal, in your resource group, click **+ Add**.</span></span> <span data-ttu-id="1135f-141">Hello Azure открывает **все** колонку.</span><span class="sxs-lookup"><span data-stu-id="1135f-141">Azure opens hello **Everything** blade.</span></span>

   ![Новый элемент](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/02-newiteminrg.png)
2. <span data-ttu-id="1135f-143">Введите в поле поиска **виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="1135f-143">Search for **virtual network**.</span></span>

     ![Поиск виртуальной сети](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/04-findvirtualnetwork.png)
3. <span data-ttu-id="1135f-145">Щелкните **Виртуальная сеть**.</span><span class="sxs-lookup"><span data-stu-id="1135f-145">Click **Virtual network**.</span></span>
4. <span data-ttu-id="1135f-146">На hello **виртуальная сеть** колонка, щелкните hello **диспетчера ресурсов** модель развертывания, а затем щелкните **создать**.</span><span class="sxs-lookup"><span data-stu-id="1135f-146">On hello **Virtual network** blade, click hello **Resource Manager** deployment model, and then click **Create**.</span></span>

    <span data-ttu-id="1135f-147">Hello следующей таблице показаны параметры hello hello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="1135f-147">hello following table shows hello settings for hello virtual network:</span></span>

   | <span data-ttu-id="1135f-148">**Поле**</span><span class="sxs-lookup"><span data-stu-id="1135f-148">**Field**</span></span> | <span data-ttu-id="1135f-149">Значение</span><span class="sxs-lookup"><span data-stu-id="1135f-149">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="1135f-150">**Имя**</span><span class="sxs-lookup"><span data-stu-id="1135f-150">**Name**</span></span> |<span data-ttu-id="1135f-151">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="1135f-151">autoHAVNET</span></span> |
   | <span data-ttu-id="1135f-152">**Пространство адресов**</span><span class="sxs-lookup"><span data-stu-id="1135f-152">**Address space**</span></span> |<span data-ttu-id="1135f-153">10.33.0.0/24</span><span class="sxs-lookup"><span data-stu-id="1135f-153">10.33.0.0/24</span></span> |
   | <span data-ttu-id="1135f-154">**Имя подсети**</span><span class="sxs-lookup"><span data-stu-id="1135f-154">**Subnet name**</span></span> |<span data-ttu-id="1135f-155">Администратор</span><span class="sxs-lookup"><span data-stu-id="1135f-155">Admin</span></span> |
   | <span data-ttu-id="1135f-156">**Диапазон адресов подсети**</span><span class="sxs-lookup"><span data-stu-id="1135f-156">**Subnet address range**</span></span> |<span data-ttu-id="1135f-157">10.33.0.0/29</span><span class="sxs-lookup"><span data-stu-id="1135f-157">10.33.0.0/29</span></span> |
   | <span data-ttu-id="1135f-158">**Подписка**</span><span class="sxs-lookup"><span data-stu-id="1135f-158">**Subscription**</span></span> |<span data-ttu-id="1135f-159">Укажите, следует присвоить toouse подписки hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-159">Specify hello subscription that you intend toouse.</span></span> <span data-ttu-id="1135f-160">**Подписка.** Если есть только одна подписка, то этот параметр может быть пустым.</span><span class="sxs-lookup"><span data-stu-id="1135f-160">**Subscription** is blank if you only have one subscription.</span></span> |
   | <span data-ttu-id="1135f-161">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="1135f-161">**Resource group**</span></span> |<span data-ttu-id="1135f-162">Выберите **использовать существующие** и выберите имя группы ресурсов hello hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-162">Choose **Use existing** and pick hello name of hello resource group.</span></span> |
   | <span data-ttu-id="1135f-163">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="1135f-163">**Location**</span></span> |<span data-ttu-id="1135f-164">Укажите расположение Azure hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-164">Specify hello Azure location.</span></span> |

   <span data-ttu-id="1135f-165">Диапазон адресов пространства и подсети адрес может отличаться от таблицы hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-165">Your address space and subnet address range might be different from hello table.</span></span> <span data-ttu-id="1135f-166">В зависимости от подписки портал hello предлагает доступное адресное пространство и соответствующий диапазон адресов подсети.</span><span class="sxs-lookup"><span data-stu-id="1135f-166">Depending on your subscription, hello portal suggests an available address space and corresponding subnet address range.</span></span> <span data-ttu-id="1135f-167">Если достаточное пространство адресов недоступно, используйте другую подписку.</span><span class="sxs-lookup"><span data-stu-id="1135f-167">If no sufficient address space is available, use a different subscription.</span></span>

   <span data-ttu-id="1135f-168">пример Hello использует hello имя подсети **администратора**. Эта подсеть — для контроллеров домена hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-168">hello example uses hello subnet name **Admin**. This subnet is for hello domain controllers.</span></span>

5. <span data-ttu-id="1135f-169">Щелкните **Создать**.</span><span class="sxs-lookup"><span data-stu-id="1135f-169">Click **Create**.</span></span>

   ![Настройка виртуальной сети hello](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/06-configurevirtualnetwork.png)

<span data-ttu-id="1135f-171">Возврат toohello панели мониторинга портала Azure и уведомляет о том, при создании новой сети hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-171">Azure returns you toohello portal dashboard and notifies you when hello new network is created.</span></span>

### <a name="create-a-second-subnet"></a><span data-ttu-id="1135f-172">Создание второй подсети</span><span class="sxs-lookup"><span data-stu-id="1135f-172">Create a second subnet</span></span>
<span data-ttu-id="1135f-173">Hello новой виртуальной сети имеет одну подсеть, с именем **администратора**. использовать эту подсеть, контроллеры домена hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-173">hello new virtual network has one subnet, named **Admin**. hello domain controllers use this subnet.</span></span> <span data-ttu-id="1135f-174">Hello виртуальные машины SQL Server использовать вторую подсеть с именем **SQL**.</span><span class="sxs-lookup"><span data-stu-id="1135f-174">hello SQL Server VMs use a second subnet named **SQL**.</span></span> <span data-ttu-id="1135f-175">tooconfigure этой подсети:</span><span class="sxs-lookup"><span data-stu-id="1135f-175">tooconfigure this subnet:</span></span>

1. <span data-ttu-id="1135f-176">На панели мониторинга щелкните группу ресурсов hello, вы создали, **SQL-HA-RG**.</span><span class="sxs-lookup"><span data-stu-id="1135f-176">On your dashboard, click hello resource group that you created, **SQL-HA-RG**.</span></span> <span data-ttu-id="1135f-177">Найдите hello сети в группе ресурсов hello под **ресурсов**.</span><span class="sxs-lookup"><span data-stu-id="1135f-177">Locate hello network in hello resource group under **Resources**.</span></span>

    <span data-ttu-id="1135f-178">Если **SQL-HA-RG** не отображается, найдите его, нажав кнопку **групп ресурсов** и фильтрации по имени группы ресурсов hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-178">If **SQL-HA-RG** isn't visible, find it by clicking **Resource Groups** and filtering by hello resource group name.</span></span>
2. <span data-ttu-id="1135f-179">Нажмите кнопку **autoHAVNET** на hello список ресурсов.</span><span class="sxs-lookup"><span data-stu-id="1135f-179">Click **autoHAVNET** on hello list of resources.</span></span> <span data-ttu-id="1135f-180">Azure открывает колонку конфигурации сети hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-180">Azure opens hello network configuration blade.</span></span>
3. <span data-ttu-id="1135f-181">На hello **autoHAVNET** колонки виртуальной сети в разделе **параметры** , нажмите кнопку **подсети**.</span><span class="sxs-lookup"><span data-stu-id="1135f-181">On hello **autoHAVNET** virtual network blade, under **Settings** , click **Subnets**.</span></span>

    <span data-ttu-id="1135f-182">Обратите внимание, hello подсети, уже созданы.</span><span class="sxs-lookup"><span data-stu-id="1135f-182">Note hello subnet that you already created.</span></span>

   ![Настройка виртуальной сети hello](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/07-addsubnet.png)
5. <span data-ttu-id="1135f-184">Создайте вторую подсеть.</span><span class="sxs-lookup"><span data-stu-id="1135f-184">Create a second subnet.</span></span> <span data-ttu-id="1135f-185">Щелкните **+ Subnet**(+Подсеть).</span><span class="sxs-lookup"><span data-stu-id="1135f-185">Click **+ Subnet**.</span></span>
6. <span data-ttu-id="1135f-186">На hello **добавить подсеть** колонке настроить подсеть hello, введя **sqlsubnet** под **имя**.</span><span class="sxs-lookup"><span data-stu-id="1135f-186">On hello **Add subnet** blade, configure hello subnet by typing **sqlsubnet** under **Name**.</span></span> <span data-ttu-id="1135f-187">Azure автоматически укажет допустимое значение в поле **Диапазон адресов**.</span><span class="sxs-lookup"><span data-stu-id="1135f-187">Azure automatically specifies a valid **Address range**.</span></span> <span data-ttu-id="1135f-188">Убедитесь, что этот диапазон адресов содержит по крайней мере 10 адресов.</span><span class="sxs-lookup"><span data-stu-id="1135f-188">Verify that this address range has at least 10 addresses in it.</span></span> <span data-ttu-id="1135f-189">Для рабочей среды может потребоваться больше адресов.</span><span class="sxs-lookup"><span data-stu-id="1135f-189">In a production environment, you might require more addresses.</span></span>
7. <span data-ttu-id="1135f-190">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1135f-190">Click **OK**.</span></span>

    ![Настройка виртуальной сети hello](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/08-configuresubnet.png)

<span data-ttu-id="1135f-192">Привет, в следующей таблице описаны параметры конфигурации сети hello:</span><span class="sxs-lookup"><span data-stu-id="1135f-192">hello following table summarizes hello network configuration settings:</span></span>

| <span data-ttu-id="1135f-193">**Поле**</span><span class="sxs-lookup"><span data-stu-id="1135f-193">**Field**</span></span> | <span data-ttu-id="1135f-194">Значение</span><span class="sxs-lookup"><span data-stu-id="1135f-194">Value</span></span> |
| --- | --- |
| <span data-ttu-id="1135f-195">**Имя**</span><span class="sxs-lookup"><span data-stu-id="1135f-195">**Name**</span></span> |<span data-ttu-id="1135f-196">**autoHAVNET**</span><span class="sxs-lookup"><span data-stu-id="1135f-196">**autoHAVNET**</span></span> |
| <span data-ttu-id="1135f-197">**Пространство адресов**</span><span class="sxs-lookup"><span data-stu-id="1135f-197">**Address space**</span></span> |<span data-ttu-id="1135f-198">Это значение зависит от доступных адресные пространства hello в вашей подписке.</span><span class="sxs-lookup"><span data-stu-id="1135f-198">This value depends on hello available address spaces in your subscription.</span></span> <span data-ttu-id="1135f-199">Стандартное значение — 10.0.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="1135f-199">A typical value is 10.0.0.0/16.</span></span> |
| <span data-ttu-id="1135f-200">**Имя подсети**</span><span class="sxs-lookup"><span data-stu-id="1135f-200">**Subnet name**</span></span> |<span data-ttu-id="1135f-201">**admin**</span><span class="sxs-lookup"><span data-stu-id="1135f-201">**admin**</span></span> |
| <span data-ttu-id="1135f-202">**Диапазон адресов подсети**</span><span class="sxs-lookup"><span data-stu-id="1135f-202">**Subnet address range**</span></span> |<span data-ttu-id="1135f-203">Это значение зависит от hello доступных диапазонов адресов в вашей подписке.</span><span class="sxs-lookup"><span data-stu-id="1135f-203">This value depends on hello available address ranges in your subscription.</span></span> <span data-ttu-id="1135f-204">Стандартное значение — 10.0.0.0/24.</span><span class="sxs-lookup"><span data-stu-id="1135f-204">A typical value is 10.0.0.0/24.</span></span> |
| <span data-ttu-id="1135f-205">**Имя подсети**</span><span class="sxs-lookup"><span data-stu-id="1135f-205">**Subnet name**</span></span> |<span data-ttu-id="1135f-206">**sqlsubnet**</span><span class="sxs-lookup"><span data-stu-id="1135f-206">**sqlsubnet**</span></span> |
| <span data-ttu-id="1135f-207">**Диапазон адресов подсети**</span><span class="sxs-lookup"><span data-stu-id="1135f-207">**Subnet address range**</span></span> |<span data-ttu-id="1135f-208">Это значение зависит от hello доступных диапазонов адресов в вашей подписке.</span><span class="sxs-lookup"><span data-stu-id="1135f-208">This value depends on hello available address ranges in your subscription.</span></span> <span data-ttu-id="1135f-209">Стандартное значение — 10.0.1.0/24.</span><span class="sxs-lookup"><span data-stu-id="1135f-209">A typical value is 10.0.1.0/24.</span></span> |
| <span data-ttu-id="1135f-210">**Подписка**</span><span class="sxs-lookup"><span data-stu-id="1135f-210">**Subscription**</span></span> |<span data-ttu-id="1135f-211">Укажите, следует присвоить toouse подписки hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-211">Specify hello subscription that you intend toouse.</span></span> |
| <span data-ttu-id="1135f-212">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="1135f-212">**Resource Group**</span></span> |<span data-ttu-id="1135f-213">**SQL-HA-RG**</span><span class="sxs-lookup"><span data-stu-id="1135f-213">**SQL-HA-RG**</span></span> |
| <span data-ttu-id="1135f-214">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="1135f-214">**Location**</span></span> |<span data-ttu-id="1135f-215">Укажите Здравствуйте, то расположение, которое было выбрано для группы ресурсов hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-215">Specify hello same location that you chose for hello resource group.</span></span> |

## <a name="create-availability-sets"></a><span data-ttu-id="1135f-216">Создание групп доступности</span><span class="sxs-lookup"><span data-stu-id="1135f-216">Create availability sets</span></span>

<span data-ttu-id="1135f-217">Перед созданием виртуальных машин необходимо toocreate группы доступности.</span><span class="sxs-lookup"><span data-stu-id="1135f-217">Before you create virtual machines, you need toocreate availability sets.</span></span> <span data-ttu-id="1135f-218">Наборы доступности позволит сократить время простоя hello события запланированного или незапланированного обслуживания.</span><span class="sxs-lookup"><span data-stu-id="1135f-218">Availability sets reduce hello downtime for planned or unplanned maintenance events.</span></span> <span data-ttu-id="1135f-219">Группа доступности Azure представляет собой логическую группу ресурсов, которую Azure помещает в физические домены сбоя и домены обновления.</span><span class="sxs-lookup"><span data-stu-id="1135f-219">An Azure availability set is a logical group of resources that Azure places on physical fault domains and update domains.</span></span> <span data-ttu-id="1135f-220">Домен сбоя гарантирует hello элементы набора доступности hello отдельные питания и сетевые ресурсы.</span><span class="sxs-lookup"><span data-stu-id="1135f-220">A fault domain ensures that hello members of hello availability set have separate power and network resources.</span></span> <span data-ttu-id="1135f-221">Домен обновления гарантирует, что элементы набора доступности hello не отключена для обслуживания на hello же время.</span><span class="sxs-lookup"><span data-stu-id="1135f-221">An update domain ensures that members of hello availability set aren't brought down for maintenance at hello same time.</span></span> <span data-ttu-id="1135f-222">Дополнительные сведения см. в разделе [Управление доступностью виртуальных машин hello](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="1135f-222">For more information, see [Manage hello availability of virtual machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="1135f-223">Вам потребуется две группы доступности:</span><span class="sxs-lookup"><span data-stu-id="1135f-223">You need two availability sets.</span></span> <span data-ttu-id="1135f-224">Один — для контроллеров домена hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-224">One is for hello domain controllers.</span></span> <span data-ttu-id="1135f-225">Во-вторых, Hello предназначен для hello виртуальные машины SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-225">hello second is for hello SQL Server VMs.</span></span>

<span data-ttu-id="1135f-226">toocreate доступности задать откройте toohello группы ресурсов и щелкните **добавить**.</span><span class="sxs-lookup"><span data-stu-id="1135f-226">toocreate an availability set, go toohello resource group and click **Add**.</span></span> <span data-ttu-id="1135f-227">Фильтрация результатов hello, введя **набор доступности**.</span><span class="sxs-lookup"><span data-stu-id="1135f-227">Filter hello results by typing **availability set**.</span></span> <span data-ttu-id="1135f-228">Нажмите кнопку **набор доступности** в hello результатов и нажмите кнопку **создать**.</span><span class="sxs-lookup"><span data-stu-id="1135f-228">Click **Availability Set** in hello results, and then click **Create**.</span></span>

<span data-ttu-id="1135f-229">Настройте две группы доступности, в соответствии с параметрами toohello в hello в следующей таблице:</span><span class="sxs-lookup"><span data-stu-id="1135f-229">Configure two availability sets according toohello parameters in hello following table:</span></span>

| <span data-ttu-id="1135f-230">**Поле**</span><span class="sxs-lookup"><span data-stu-id="1135f-230">**Field**</span></span> | <span data-ttu-id="1135f-231">Группа доступности контроллера домена</span><span class="sxs-lookup"><span data-stu-id="1135f-231">Domain controller availability set</span></span> | <span data-ttu-id="1135f-232">Группа доступности SQL Server</span><span class="sxs-lookup"><span data-stu-id="1135f-232">SQL Server availability set</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1135f-233">**Имя**</span><span class="sxs-lookup"><span data-stu-id="1135f-233">**Name**</span></span> |<span data-ttu-id="1135f-234">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="1135f-234">adavailabilityset</span></span> |<span data-ttu-id="1135f-235">sqlavailabilityset</span><span class="sxs-lookup"><span data-stu-id="1135f-235">sqlavailabilityset</span></span> |
| <span data-ttu-id="1135f-236">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="1135f-236">**Resource group**</span></span> |<span data-ttu-id="1135f-237">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="1135f-237">SQL-HA-RG</span></span> |<span data-ttu-id="1135f-238">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="1135f-238">SQL-HA-RG</span></span> |
| <span data-ttu-id="1135f-239">**Домены сбоя**</span><span class="sxs-lookup"><span data-stu-id="1135f-239">**Fault domains**</span></span> |<span data-ttu-id="1135f-240">3</span><span class="sxs-lookup"><span data-stu-id="1135f-240">3</span></span> |<span data-ttu-id="1135f-241">3</span><span class="sxs-lookup"><span data-stu-id="1135f-241">3</span></span> |
| <span data-ttu-id="1135f-242">**Домены обновления**</span><span class="sxs-lookup"><span data-stu-id="1135f-242">**Update domains**</span></span> |<span data-ttu-id="1135f-243">5</span><span class="sxs-lookup"><span data-stu-id="1135f-243">5</span></span> |<span data-ttu-id="1135f-244">3</span><span class="sxs-lookup"><span data-stu-id="1135f-244">3</span></span> |

<span data-ttu-id="1135f-245">После создания группы доступности hello возвращают toohello группы ресурсов в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="1135f-245">After you create hello availability sets, return toohello resource group in hello Azure portal.</span></span>

## <a name="create-domain-controllers"></a><span data-ttu-id="1135f-246">Создание контроллеров домена</span><span class="sxs-lookup"><span data-stu-id="1135f-246">Create domain controllers</span></span>
<span data-ttu-id="1135f-247">После создания hello сети, подсети, группы доступности и балансировки нагрузки с выходом в Интернет, вы готовы toocreate hello виртуальных машин контроллеров домена hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-247">After you've created hello network, subnets, availability sets, and an Internet-facing load balancer, you're ready toocreate hello virtual machines for hello domain controllers.</span></span>

### <a name="create-virtual-machines-for-hello-domain-controllers"></a><span data-ttu-id="1135f-248">Создание виртуальных машин для hello контроллеров домена</span><span class="sxs-lookup"><span data-stu-id="1135f-248">Create virtual machines for hello domain controllers</span></span>
<span data-ttu-id="1135f-249">toocreate и настройка контроллеров домена hello, возвращают toohello **SQL-HA-RG** группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="1135f-249">toocreate and configure hello domain controllers, return toohello **SQL-HA-RG** resource group.</span></span>

1. <span data-ttu-id="1135f-250">Щелкните **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="1135f-250">Click **Add**.</span></span> <span data-ttu-id="1135f-251">Hello **все** открывает колонку.</span><span class="sxs-lookup"><span data-stu-id="1135f-251">hello **Everything** blade opens.</span></span>
2. <span data-ttu-id="1135f-252">Введите **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="1135f-252">Type **Windows Server 2016 Datacenter**.</span></span>
3. <span data-ttu-id="1135f-253">Щелкните **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="1135f-253">Click **Windows Server 2016 Datacenter**.</span></span> <span data-ttu-id="1135f-254">В hello **Windows Server 2016 Datacenter** колонке проверки этой модели развертывания hello **диспетчера ресурсов**и нажмите кнопку **создать**.</span><span class="sxs-lookup"><span data-stu-id="1135f-254">In hello **Windows Server 2016 Datacenter** blade, verify that hello deployment model is **Resource Manager**, and then click **Create**.</span></span> <span data-ttu-id="1135f-255">Hello Azure открывает **создать виртуальную машину** колонку.</span><span class="sxs-lookup"><span data-stu-id="1135f-255">Azure opens hello **Create virtual machine** blade.</span></span>

<span data-ttu-id="1135f-256">Повторите hello, предшествующих шагов toocreate две виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="1135f-256">Repeat hello preceding steps toocreate two virtual machines.</span></span> <span data-ttu-id="1135f-257">Имя hello две виртуальные машины:</span><span class="sxs-lookup"><span data-stu-id="1135f-257">Name hello two virtual machines:</span></span>

* <span data-ttu-id="1135f-258">ad-primary-dc</span><span class="sxs-lookup"><span data-stu-id="1135f-258">ad-primary-dc</span></span>
* <span data-ttu-id="1135f-259">ad-secondary-dc.</span><span class="sxs-lookup"><span data-stu-id="1135f-259">ad-secondary-dc</span></span>

  > [!NOTE]
  > <span data-ttu-id="1135f-260">Hello **дополнительного контроллера домена Active Directory** виртуальной машины необязательно, tooprovide высокий уровень доступности для доменных служб Active Directory.</span><span class="sxs-lookup"><span data-stu-id="1135f-260">hello **ad-secondary-dc** virtual machine is optional, tooprovide high availability for Active Directory Domain Services.</span></span>
  >
  >

<span data-ttu-id="1135f-261">Hello следующей таблице показаны параметры hello для этих двух компьютеров.</span><span class="sxs-lookup"><span data-stu-id="1135f-261">hello following table shows hello settings for these two machines:</span></span>

| <span data-ttu-id="1135f-262">**Поле**</span><span class="sxs-lookup"><span data-stu-id="1135f-262">**Field**</span></span> | <span data-ttu-id="1135f-263">Значение</span><span class="sxs-lookup"><span data-stu-id="1135f-263">Value</span></span> |
| --- | --- |
| <span data-ttu-id="1135f-264">**Имя**</span><span class="sxs-lookup"><span data-stu-id="1135f-264">**Name**</span></span> |<span data-ttu-id="1135f-265">Первый контроллер домена: *ad-primary-dc*.</span><span class="sxs-lookup"><span data-stu-id="1135f-265">First domain controller: *ad-primary-dc*.</span></span></br><span data-ttu-id="1135f-266">Второй контроллер домена *ad-secondary-dc*.</span><span class="sxs-lookup"><span data-stu-id="1135f-266">Second domain controller *ad-secondary-dc*.</span></span> |
| <span data-ttu-id="1135f-267">**Тип диска виртуальной машины**</span><span class="sxs-lookup"><span data-stu-id="1135f-267">**VM disk type**</span></span> |<span data-ttu-id="1135f-268">SSD</span><span class="sxs-lookup"><span data-stu-id="1135f-268">SSD</span></span> |
| <span data-ttu-id="1135f-269">**Имя пользователя**</span><span class="sxs-lookup"><span data-stu-id="1135f-269">**User name**</span></span> |<span data-ttu-id="1135f-270">DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="1135f-270">DomainAdmin</span></span> |
| <span data-ttu-id="1135f-271">**Пароль**</span><span class="sxs-lookup"><span data-stu-id="1135f-271">**Password**</span></span> |<span data-ttu-id="1135f-272">Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="1135f-272">Contoso!0000</span></span> |
| <span data-ttu-id="1135f-273">**Подписка**</span><span class="sxs-lookup"><span data-stu-id="1135f-273">**Subscription**</span></span> |<span data-ttu-id="1135f-274">*Ваша подписка*</span><span class="sxs-lookup"><span data-stu-id="1135f-274">*Your subscription*</span></span> |
| <span data-ttu-id="1135f-275">**Группа ресурсов**</span><span class="sxs-lookup"><span data-stu-id="1135f-275">**Resource group**</span></span> |<span data-ttu-id="1135f-276">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="1135f-276">SQL-HA-RG</span></span> |
| <span data-ttu-id="1135f-277">**Расположение**</span><span class="sxs-lookup"><span data-stu-id="1135f-277">**Location**</span></span> |<span data-ttu-id="1135f-278">*Ваше расположение*</span><span class="sxs-lookup"><span data-stu-id="1135f-278">*Your location*</span></span> |
| <span data-ttu-id="1135f-279">**Размер**</span><span class="sxs-lookup"><span data-stu-id="1135f-279">**Size**</span></span> |<span data-ttu-id="1135f-280">DS1_V2</span><span class="sxs-lookup"><span data-stu-id="1135f-280">DS1_V2</span></span> |
| <span data-ttu-id="1135f-281">**Хранилище**</span><span class="sxs-lookup"><span data-stu-id="1135f-281">**Storage**</span></span> | <span data-ttu-id="1135f-282">**Использование управляемых дисков** - **Да**</span><span class="sxs-lookup"><span data-stu-id="1135f-282">**Use managed disks** - **Yes**</span></span> |
| <span data-ttu-id="1135f-283">**Виртуальная сеть**</span><span class="sxs-lookup"><span data-stu-id="1135f-283">**Virtual network**</span></span> |<span data-ttu-id="1135f-284">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="1135f-284">autoHAVNET</span></span> |
| <span data-ttu-id="1135f-285">**Подсеть**</span><span class="sxs-lookup"><span data-stu-id="1135f-285">**Subnet**</span></span> |<span data-ttu-id="1135f-286">admin</span><span class="sxs-lookup"><span data-stu-id="1135f-286">admin</span></span> |
| <span data-ttu-id="1135f-287">**Общедоступный IP-адрес**</span><span class="sxs-lookup"><span data-stu-id="1135f-287">**Public IP address**</span></span> |<span data-ttu-id="1135f-288">*Совпадает с именем hello виртуальной Машины*</span><span class="sxs-lookup"><span data-stu-id="1135f-288">*Same name as hello VM*</span></span> |
| <span data-ttu-id="1135f-289">**группа безопасности сети**.</span><span class="sxs-lookup"><span data-stu-id="1135f-289">**Network security group**</span></span> |<span data-ttu-id="1135f-290">*Совпадает с именем hello виртуальной Машины*</span><span class="sxs-lookup"><span data-stu-id="1135f-290">*Same name as hello VM*</span></span> |
| <span data-ttu-id="1135f-291">**группа доступности;**</span><span class="sxs-lookup"><span data-stu-id="1135f-291">**Availability set**</span></span> |<span data-ttu-id="1135f-292">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="1135f-292">adavailabilityset</span></span> </br><span data-ttu-id="1135f-293">**Домены сбоя**: 2</span><span class="sxs-lookup"><span data-stu-id="1135f-293">**Fault domains**:2</span></span></br><span data-ttu-id="1135f-294">**Домены обновления**: 2</span><span class="sxs-lookup"><span data-stu-id="1135f-294">**Update domains**:2</span></span>|
| <span data-ttu-id="1135f-295">**Диагностика**</span><span class="sxs-lookup"><span data-stu-id="1135f-295">**Diagnostics**</span></span> |<span data-ttu-id="1135f-296">Включено</span><span class="sxs-lookup"><span data-stu-id="1135f-296">Enabled</span></span> |
| <span data-ttu-id="1135f-297">**Учетная запись хранения для диагностики**</span><span class="sxs-lookup"><span data-stu-id="1135f-297">**Diagnostics storage account**</span></span> |<span data-ttu-id="1135f-298">*Создается автоматически*</span><span class="sxs-lookup"><span data-stu-id="1135f-298">*Automatically created*</span></span> |

   >[!IMPORTANT]
   ><span data-ttu-id="1135f-299">Виртуальную машину можно разместить в группе доступности только при ее создании.</span><span class="sxs-lookup"><span data-stu-id="1135f-299">You can only place a VM in an availability set when you create it.</span></span> <span data-ttu-id="1135f-300">Невозможно изменить доступность hello задать после создания виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="1135f-300">You can't change hello availability set after a VM is created.</span></span> <span data-ttu-id="1135f-301">В разделе [Управление доступностью виртуальных машин hello](../manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="1135f-301">See [Manage hello availability of virtual machines](../manage-availability.md).</span></span>

<span data-ttu-id="1135f-302">Azure создает hello виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="1135f-302">Azure creates hello virtual machines.</span></span>

<span data-ttu-id="1135f-303">После создания виртуальных машин hello настройки контроллера домена hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-303">After hello virtual machines are created, configure hello domain controller.</span></span>

### <a name="configure-hello-domain-controller"></a><span data-ttu-id="1135f-304">Настройка контроллера домена hello</span><span class="sxs-lookup"><span data-stu-id="1135f-304">Configure hello domain controller</span></span>
<span data-ttu-id="1135f-305">В hello следующие шаги настройки hello **основного контроллера домена Active Directory** компьютера в качестве контроллера домена для corp.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="1135f-305">In hello following steps, configure hello **ad-primary-dc** machine as a domain controller for corp.contoso.com.</span></span>

1. <span data-ttu-id="1135f-306">Откройте портал hello hello **SQL-HA-RG** группы ресурсов и выберите hello **основного контроллера домена Active Directory** машины.</span><span class="sxs-lookup"><span data-stu-id="1135f-306">In hello portal, open hello **SQL-HA-RG** resource group and select hello **ad-primary-dc** machine.</span></span> <span data-ttu-id="1135f-307">На hello **основного контроллера домена Active Directory** колонка, щелкните **Connect** tooopen RDP-файла для удаленного доступа к рабочему столу.</span><span class="sxs-lookup"><span data-stu-id="1135f-307">On hello **ad-primary-dc** blade, click **Connect** tooopen an RDP file for remote desktop access.</span></span>

    ![Подключение tooa виртуальной машины](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/20-connectrdp.png)
2. <span data-ttu-id="1135f-309">Войдите в систему, используя настроенную учетную запись администратора (**\DomainAdmin**) и ее пароль (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="1135f-309">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="1135f-310">По умолчанию hello **диспетчера сервера** должна отображаться панель мониторинга.</span><span class="sxs-lookup"><span data-stu-id="1135f-310">By default, hello **Server Manager** dashboard should be displayed.</span></span>
4. <span data-ttu-id="1135f-311">Нажмите кнопку hello **Добавить роли и компоненты** ссылку на панель мониторинга hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-311">Click hello **Add roles and features** link on hello dashboard.</span></span>

    ![Диспетчер сервера. Добавление ролей](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
5. <span data-ttu-id="1135f-313">Выберите **Далее** до получения toohello **ролей сервера** раздела.</span><span class="sxs-lookup"><span data-stu-id="1135f-313">Select **Next** until you get toohello **Server Roles** section.</span></span>
6. <span data-ttu-id="1135f-314">Выберите hello **доменных служб Active Directory** и **DNS-сервер** ролей.</span><span class="sxs-lookup"><span data-stu-id="1135f-314">Select hello **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="1135f-315">При появлении запроса добавьте требуемые для этих ролей дополнительные компоненты.</span><span class="sxs-lookup"><span data-stu-id="1135f-315">When you're prompted, add any additional features that are required by these roles.</span></span>

   > [!NOTE]
   > <span data-ttu-id="1135f-316">Windows предупреждает о том, что статического IP-адреса не существует.</span><span class="sxs-lookup"><span data-stu-id="1135f-316">Windows warns you that there is no static IP address.</span></span> <span data-ttu-id="1135f-317">Если вы тестируете hello конфигурации, нажмите кнопку **Продолжить**.</span><span class="sxs-lookup"><span data-stu-id="1135f-317">If you're testing hello configuration, click **Continue**.</span></span> <span data-ttu-id="1135f-318">Для рабочих сценариев, задайте hello IP адрес toostatic в hello портал Azure или [PowerShell tooset hello статический IP-адрес компьютера контроллера домена hello](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span><span class="sxs-lookup"><span data-stu-id="1135f-318">For production scenarios, set hello IP address toostatic in hello Azure portal, or [use PowerShell tooset hello static IP address of hello domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>
   >
   >

    ![Диалоговое окно добавления ролей](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/23-addroles.png)
7. <span data-ttu-id="1135f-320">Нажмите кнопку **Далее** пока не достигнете hello **Подтверждение** раздела.</span><span class="sxs-lookup"><span data-stu-id="1135f-320">Click **Next** until you reach hello **Confirmation** section.</span></span> <span data-ttu-id="1135f-321">Выберите hello **перезапустите hello целевой сервер автоматически, если необходимо** флажок.</span><span class="sxs-lookup"><span data-stu-id="1135f-321">Select hello **Restart hello destination server automatically if required** check box.</span></span>
8. <span data-ttu-id="1135f-322">Щелкните **Install**(Установить).</span><span class="sxs-lookup"><span data-stu-id="1135f-322">Click **Install**.</span></span>
9. <span data-ttu-id="1135f-323">После установки, возвращают toohello функции hello **диспетчера сервера** панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="1135f-323">After hello features finish installing, return toohello **Server Manager** dashboard.</span></span>
10. <span data-ttu-id="1135f-324">Выберите hello новый **AD DS** параметр на левой панели hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-324">Select hello new **AD DS** option on hello left-hand pane.</span></span>
11. <span data-ttu-id="1135f-325">Нажмите кнопку hello **дополнительные** ссылку на hello желтой строке предупреждения.</span><span class="sxs-lookup"><span data-stu-id="1135f-325">Click hello **More** link on hello yellow warning bar.</span></span>

    ![Диалоговое окно AD DS на ВМ DNS-сервера hello](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/24-addsmore.png)
12. <span data-ttu-id="1135f-327">В hello **действия** столбец hello **все сведения о задаче сервера** диалоговое окно, нажмите кнопку **повысить роль этого контроллера домена server tooa**.</span><span class="sxs-lookup"><span data-stu-id="1135f-327">In hello **Action** column of hello **All Server Task Details** dialog, click **Promote this server tooa domain controller**.</span></span>
13. <span data-ttu-id="1135f-328">В hello **мастер настройки доменных служб Active Directory**, использовать hello следующие значения:</span><span class="sxs-lookup"><span data-stu-id="1135f-328">In hello **Active Directory Domain Services Configuration Wizard**, use hello following values:</span></span>

    | <span data-ttu-id="1135f-329">**Страница**</span><span class="sxs-lookup"><span data-stu-id="1135f-329">**Page**</span></span> | <span data-ttu-id="1135f-330">Настройка</span><span class="sxs-lookup"><span data-stu-id="1135f-330">Setting</span></span> |
    | --- | --- |
    | <span data-ttu-id="1135f-331">**Конфигурация развертывания**</span><span class="sxs-lookup"><span data-stu-id="1135f-331">**Deployment Configuration**</span></span> |<span data-ttu-id="1135f-332">**Добавить новый лес**</span><span class="sxs-lookup"><span data-stu-id="1135f-332">**Add a new forest**</span></span><br/> <span data-ttu-id="1135f-333">**Имя корневого домена** = corp.contoso.com</span><span class="sxs-lookup"><span data-stu-id="1135f-333">**Root domain name** = corp.contoso.com</span></span> |
    | <span data-ttu-id="1135f-334">**Параметры контроллера домена**</span><span class="sxs-lookup"><span data-stu-id="1135f-334">**Domain Controller Options**</span></span> |<span data-ttu-id="1135f-335">**Пароль DSRM** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="1135f-335">**DSRM Password** = Contoso!0000</span></span><br/><span data-ttu-id="1135f-336">**Подтверждение пароля** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="1135f-336">**Confirm Password** = Contoso!0000</span></span> |
14. <span data-ttu-id="1135f-337">Нажмите кнопку **Далее** toogo через hello других страницах мастера hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-337">Click **Next** toogo through hello other pages in hello wizard.</span></span> <span data-ttu-id="1135f-338">На hello **проверка предварительных требований** страницы, убедитесь, что отображаются следующие сообщения hello: **наличие всех необходимых компонентов прошла успешно**.</span><span class="sxs-lookup"><span data-stu-id="1135f-338">On hello **Prerequisites Check** page, verify that you see hello following message: **All prerequisite checks passed successfully**.</span></span> <span data-ttu-id="1135f-339">Можно просмотреть любые применимые предупреждающие сообщения, но это возможно toocontinue с установкой hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-339">You can review any applicable warning messages, but it's possible toocontinue with hello installation.</span></span>
15. <span data-ttu-id="1135f-340">Щелкните **Install**(Установить).</span><span class="sxs-lookup"><span data-stu-id="1135f-340">Click **Install**.</span></span> <span data-ttu-id="1135f-341">Hello **основного контроллера домена Active Directory** виртуальная машина автоматически перезагружается.</span><span class="sxs-lookup"><span data-stu-id="1135f-341">hello **ad-primary-dc** virtual machine automatically reboots.</span></span>

### <a name="note-hello-ip-address-of-hello-primary-domain-controller"></a><span data-ttu-id="1135f-342">Обратите внимание, IP-адрес hello hello основного контроллера домена</span><span class="sxs-lookup"><span data-stu-id="1135f-342">Note hello IP address of hello primary domain controller</span></span>

<span data-ttu-id="1135f-343">Используйте hello основного контроллера домена для службы DNS.</span><span class="sxs-lookup"><span data-stu-id="1135f-343">Use hello primary domain controller for DNS.</span></span> <span data-ttu-id="1135f-344">Обратите внимание, IP-адрес контроллера hello основного домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-344">Note hello primary domain controller IP address.</span></span>

<span data-ttu-id="1135f-345">Одним из способов tooget hello первичного контроллера IP-адрес домена выполняется с помощью портала Azure hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-345">One way tooget hello primary domain controller IP address is through hello Azure portal.</span></span>

1. <span data-ttu-id="1135f-346">На hello портал Azure откройте группу ресурсов hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-346">On hello Azure portal, open hello resource group.</span></span>

2. <span data-ttu-id="1135f-347">Щелкните hello основного контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-347">Click hello primary domain controller.</span></span>

3. <span data-ttu-id="1135f-348">В колонке контроллера hello основной домен, щелкните **сетевых интерфейсов**.</span><span class="sxs-lookup"><span data-stu-id="1135f-348">On hello primary domain controller blade, click **Network interfaces**.</span></span>

![Сетевые интерфейсы](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/25-primarydcip.png)

<span data-ttu-id="1135f-350">Обратите внимание, hello частный IP-адрес для этого сервера.</span><span class="sxs-lookup"><span data-stu-id="1135f-350">Note hello private IP address for this server.</span></span>

### <a name="configure-hello-virtual-network-dns"></a><span data-ttu-id="1135f-351">Настройка виртуальной сети hello DNS</span><span class="sxs-lookup"><span data-stu-id="1135f-351">Configure hello virtual network DNS</span></span>
<span data-ttu-id="1135f-352">После создания первого контроллера домена hello и включить DNS на первом сервере hello, toouse hello виртуальной сети этот сервер настроен для DNS.</span><span class="sxs-lookup"><span data-stu-id="1135f-352">After you create hello first domain controller and enable DNS on hello first server, configure hello virtual network toouse this server for DNS.</span></span>

1. <span data-ttu-id="1135f-353">В hello портал Azure щелкните hello виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="1135f-353">In hello Azure portal, click on hello virtual network.</span></span>

2. <span data-ttu-id="1135f-354">В разделе **Параметры** выберите **DNS-сервер**.</span><span class="sxs-lookup"><span data-stu-id="1135f-354">Under **Settings**, click **DNS Server**.</span></span>

3. <span data-ttu-id="1135f-355">Нажмите кнопку **настраиваемый**и введите hello частный IP-адрес hello основного контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-355">Click **Custom**, and type hello private IP address of hello primary domain controller.</span></span>

4. <span data-ttu-id="1135f-356">Щелкните **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="1135f-356">Click **Save**.</span></span>

### <a name="configure-hello-second-domain-controller"></a><span data-ttu-id="1135f-357">Настройка hello второго контроллера домена</span><span class="sxs-lookup"><span data-stu-id="1135f-357">Configure hello second domain controller</span></span>
<span data-ttu-id="1135f-358">После перезагрузки hello основного контроллера домена, можно настроить hello второго контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-358">After hello primary domain controller reboots, you can configure hello second domain controller.</span></span> <span data-ttu-id="1135f-359">Этот необязательный шаг выполняется для обеспечения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="1135f-359">This optional step is for high availability.</span></span> <span data-ttu-id="1135f-360">Выполните эти шаги tooconfigure hello второго контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-360">Follow these steps tooconfigure hello second domain controller:</span></span>

1. <span data-ttu-id="1135f-361">Откройте портал hello hello **SQL-HA-RG** группы ресурсов и выберите hello **дополнительного контроллера домена Active Directory** машины.</span><span class="sxs-lookup"><span data-stu-id="1135f-361">In hello portal, open hello **SQL-HA-RG** resource group and select hello **ad-secondary-dc** machine.</span></span> <span data-ttu-id="1135f-362">На hello **дополнительного контроллера домена Active Directory** колонка, щелкните **Connect** tooopen RDP-файла для удаленного доступа к рабочему столу.</span><span class="sxs-lookup"><span data-stu-id="1135f-362">On hello **ad-secondary-dc** blade, click **Connect** tooopen an RDP file for remote desktop access.</span></span>
2. <span data-ttu-id="1135f-363">Войдите в toohello виртуальной Машины с помощью учетной записи администратора (**BUILTIN\DomainAdmin**) и пароль (**Contoso! 0000**).</span><span class="sxs-lookup"><span data-stu-id="1135f-363">Sign in toohello VM by using your configured administrator account (**BUILTIN\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="1135f-364">Изменение hello предпочтительный адрес DNS-сервера адрес toohello hello контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-364">Change hello preferred DNS server address toohello address of hello domain controller.</span></span>
4. <span data-ttu-id="1135f-365">В **сетями и общим доступом**, нажмите кнопку hello сетевого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="1135f-365">In **Network and Sharing Center**, click hello network interface.</span></span>
   <span data-ttu-id="1135f-366">![Сетевой интерфейс](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span><span class="sxs-lookup"><span data-stu-id="1135f-366">![Network interface](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span></span>

5. <span data-ttu-id="1135f-367">Щелкните **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="1135f-367">Click **Properties**.</span></span>
6. <span data-ttu-id="1135f-368">Выберите **Протокол IP версии 4 (TCP/IPv4)** и нажмите кнопку **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="1135f-368">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span></span>
7. <span data-ttu-id="1135f-369">Выберите **hello использовать следующие адреса DNS-серверов** и укажите адрес hello hello основной контроллер домена в **предпочитаемый DNS-сервер**.</span><span class="sxs-lookup"><span data-stu-id="1135f-369">Select **Use hello following DNS server addresses** and specify hello address of hello primary domain controller in **Preferred DNS server**.</span></span>
8. <span data-ttu-id="1135f-370">Нажмите кнопку **ОК**, а затем **закрыть** toocommit hello изменения.</span><span class="sxs-lookup"><span data-stu-id="1135f-370">Click **OK**, and then **Close** toocommit hello changes.</span></span> <span data-ttu-id="1135f-371">Теперь вы находитесь может toojoin hello виртуальной Машины слишком**corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="1135f-371">You are now able toojoin hello VM too**corp.contoso.com**.</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="1135f-372">При утере соединения hello tooyour удаленного рабочего стола после изменения параметра hello DNS перейдите toohello портала и перезапустите hello виртуальной машины Azure.</span><span class="sxs-lookup"><span data-stu-id="1135f-372">If you lose hello connection tooyour remote desktop after changing hello DNS setting, go toohello Azure portal and restart hello virtual machine.</span></span>

9. <span data-ttu-id="1135f-373">Hello удаленного рабочего стола toohello дополнительный контроллер домена, откройте **панели мониторинга диспетчера сервера**.</span><span class="sxs-lookup"><span data-stu-id="1135f-373">From hello remote desktop toohello secondary domain controller, open **Server Manager Dashboard**.</span></span>
10. <span data-ttu-id="1135f-374">Нажмите кнопку hello **Добавить роли и компоненты** ссылку на панель мониторинга hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-374">Click hello **Add roles and features** link on hello dashboard.</span></span>

    ![Диспетчер сервера. Добавление ролей](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
11. <span data-ttu-id="1135f-376">Выберите **Далее** до получения toohello **ролей сервера** раздела.</span><span class="sxs-lookup"><span data-stu-id="1135f-376">Select **Next** until you get toohello **Server Roles** section.</span></span>
12. <span data-ttu-id="1135f-377">Выберите hello **доменных служб Active Directory** и **DNS-сервер** ролей.</span><span class="sxs-lookup"><span data-stu-id="1135f-377">Select hello **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="1135f-378">При появлении запроса добавьте требуемые для этих ролей дополнительные компоненты.</span><span class="sxs-lookup"><span data-stu-id="1135f-378">When you're prompted, add any additional features that are required by these roles.</span></span>
13. <span data-ttu-id="1135f-379">После установки, возвращают toohello функции hello **диспетчера сервера** панели мониторинга.</span><span class="sxs-lookup"><span data-stu-id="1135f-379">After hello features finish installing, return toohello **Server Manager** dashboard.</span></span>
14. <span data-ttu-id="1135f-380">Выберите hello новый **AD DS** параметр на левой панели hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-380">Select hello new **AD DS** option on hello left-hand pane.</span></span>
15. <span data-ttu-id="1135f-381">Нажмите кнопку hello **дополнительные** ссылку на hello желтой строке предупреждения.</span><span class="sxs-lookup"><span data-stu-id="1135f-381">Click hello **More** link on hello yellow warning bar.</span></span>
16. <span data-ttu-id="1135f-382">В hello **действия** столбец hello **все сведения о задаче сервера** диалоговое окно, нажмите кнопку **повысить роль этого контроллера домена server tooa**.</span><span class="sxs-lookup"><span data-stu-id="1135f-382">In hello **Action** column of hello **All Server Task Details** dialog, click **Promote this server tooa domain controller**.</span></span>
17. <span data-ttu-id="1135f-383">В разделе **конфигурации развертывания**выберите **добавить контроллер домена tooan существующего домена**.</span><span class="sxs-lookup"><span data-stu-id="1135f-383">Under **Deployment Configuration**, select **Add a domain controller tooan existing domain**.</span></span>
   <span data-ttu-id="1135f-384">![Конфигурация развертывания](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span><span class="sxs-lookup"><span data-stu-id="1135f-384">![Deployment configuration](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span></span>
18. <span data-ttu-id="1135f-385">Нажмите кнопку **Выбрать**.</span><span class="sxs-lookup"><span data-stu-id="1135f-385">Click **Select**.</span></span>
19. <span data-ttu-id="1135f-386">Подключаться с учетной записью администратора hello (**CORP. Contoso.COM\domainadmin**) и пароль (**Contoso! 0000**).</span><span class="sxs-lookup"><span data-stu-id="1135f-386">Connect by using hello administrator account (**CORP.CONTOSO.COM\domainadmin**) and password (**Contoso!0000**).</span></span>
20. <span data-ttu-id="1135f-387">В **выберите домен из леса hello**, щелкните свой домен и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1135f-387">In **Select a domain from hello forest**, click your domain, and then click **OK**.</span></span>
21. <span data-ttu-id="1135f-388">В **параметры контроллера домена**, используйте значения по умолчанию hello и задать пароль DSRM.</span><span class="sxs-lookup"><span data-stu-id="1135f-388">In **Domain Controller Options**, use hello default values and set a DSRM password.</span></span>

   >[!NOTE]
   ><span data-ttu-id="1135f-389">Hello **параметры DNS** страницы может предупреждение о том, что делегирование для этого DNS-сервера создавать нельзя.</span><span class="sxs-lookup"><span data-stu-id="1135f-389">hello **DNS Options** page might warn you that a delegation for this DNS server can't be created.</span></span> <span data-ttu-id="1135f-390">В нерабочей среде это предупреждение можно игнорировать.</span><span class="sxs-lookup"><span data-stu-id="1135f-390">You can ignore this warning in non-production environments.</span></span>
22. <span data-ttu-id="1135f-391">Нажмите кнопку **Далее** пока не достигнет диалоговое окно приветствия hello **необходимые компоненты** проверки.</span><span class="sxs-lookup"><span data-stu-id="1135f-391">Click **Next** until hello dialog reaches hello **Prerequisites** check.</span></span> <span data-ttu-id="1135f-392">Нажмите **Install**(Установить).</span><span class="sxs-lookup"><span data-stu-id="1135f-392">Then click **Install**.</span></span>

<span data-ttu-id="1135f-393">По завершении изменения конфигурации hello hello server перезапустите сервер hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-393">After hello server finishes hello configuration changes, restart hello server.</span></span>

### <a name="add-hello-private-ip-address-toohello-second-domain-controller-toohello-vpn-dns-server"></a><span data-ttu-id="1135f-394">Добавить hello частный IP-адрес toohello второй контроллер toohello домена DNS-сервера VPN</span><span class="sxs-lookup"><span data-stu-id="1135f-394">Add hello Private IP Address toohello second domain controller toohello VPN DNS Server</span></span>

<span data-ttu-id="1135f-395">В hello портале Azure в виртуальной сети измените hello DNS tooinclude hello IP-адрес сервера hello дополнительный контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-395">In hello Azure portal, under virtual network, change hello DNS Server tooinclude hello IP address of hello secondary domain controller.</span></span> <span data-ttu-id="1135f-396">Это обеспечивает избыточность службы DNS hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-396">This allows hello DNS service redundancy.</span></span>

### <span data-ttu-id="1135f-397"><a name=DomainAccounts></a>Настройка учетных записей домена hello</span><span class="sxs-lookup"><span data-stu-id="1135f-397"><a name=DomainAccounts></a> Configure hello domain accounts</span></span>

<span data-ttu-id="1135f-398">В следующих шагах hello настройте учетные записи Active Directory hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-398">In hello next steps, you configure hello Active Directory accounts.</span></span> <span data-ttu-id="1135f-399">Hello Следующая таблица показывает учетные записи hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-399">hello following table shows hello accounts:</span></span>

| |<span data-ttu-id="1135f-400">Учетная запись установки</span><span class="sxs-lookup"><span data-stu-id="1135f-400">Installation account</span></span><br/> |<span data-ttu-id="1135f-401">sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="1135f-401">sqlserver-0</span></span> <br/><span data-ttu-id="1135f-402">Учетная запись SQL Server и службы агента SQL</span><span class="sxs-lookup"><span data-stu-id="1135f-402">SQL Server and SQL Agent Service account</span></span> |<span data-ttu-id="1135f-403">sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="1135f-403">sqlserver-1</span></span><br/><span data-ttu-id="1135f-404">Учетная запись SQL Server и службы агента SQL</span><span class="sxs-lookup"><span data-stu-id="1135f-404">SQL Server and SQL Agent Service account</span></span>
| --- | --- | --- | ---
|<span data-ttu-id="1135f-405">**Имя**</span><span class="sxs-lookup"><span data-stu-id="1135f-405">**First Name**</span></span> |<span data-ttu-id="1135f-406">Install</span><span class="sxs-lookup"><span data-stu-id="1135f-406">Install</span></span> |<span data-ttu-id="1135f-407">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="1135f-407">SQLSvc1</span></span> | <span data-ttu-id="1135f-408">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="1135f-408">SQLSvc2</span></span>
|<span data-ttu-id="1135f-409">**User SamAccountName**</span><span class="sxs-lookup"><span data-stu-id="1135f-409">**User SamAccountName**</span></span> |<span data-ttu-id="1135f-410">Install</span><span class="sxs-lookup"><span data-stu-id="1135f-410">Install</span></span> |<span data-ttu-id="1135f-411">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="1135f-411">SQLSvc1</span></span> | <span data-ttu-id="1135f-412">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="1135f-412">SQLSvc2</span></span>

<span data-ttu-id="1135f-413">Используйте следующие шаги toocreate hello каждой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="1135f-413">Use hello following steps toocreate each account.</span></span>

1. <span data-ttu-id="1135f-414">Войдите в toohello **основного контроллера домена Active Directory** машины.</span><span class="sxs-lookup"><span data-stu-id="1135f-414">Sign in toohello **ad-primary-dc** machine.</span></span>
2. <span data-ttu-id="1135f-415">На панели **Диспетчер серверов** выберите **Средства**, а затем щелкните **Центр администрирования Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="1135f-415">In **Server Manager**, select **Tools**, and then click **Active Directory Administrative Center**.</span></span>   
3. <span data-ttu-id="1135f-416">Выберите **corp (local)** hello левой панели.</span><span class="sxs-lookup"><span data-stu-id="1135f-416">Select **corp (local)** from hello left pane.</span></span>
4. <span data-ttu-id="1135f-417">На правом hello **задачи** выберите **New**и нажмите кнопку **пользователя**.</span><span class="sxs-lookup"><span data-stu-id="1135f-417">On hello right **Tasks** pane, select **New**, and then click **User**.</span></span>
   <span data-ttu-id="1135f-418">![Центр администрирования Active Directory](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span><span class="sxs-lookup"><span data-stu-id="1135f-418">![Active Directory Administrative Center](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span></span>

   >[!TIP]
   ><span data-ttu-id="1135f-419">Задайте сложный пароль для каждой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="1135f-419">Set a complex password for each account.</span></span><br/> <span data-ttu-id="1135f-420">Для непроизводственных средах toonever учетной записи пользователя hello набор срока действия.</span><span class="sxs-lookup"><span data-stu-id="1135f-420">For non-production environments, set hello user account toonever expire.</span></span>

5. <span data-ttu-id="1135f-421">Нажмите кнопку **ОК** toocreate hello пользователя.</span><span class="sxs-lookup"><span data-stu-id="1135f-421">Click **OK** toocreate hello user.</span></span>
6. <span data-ttu-id="1135f-422">Повторите hello в предыдущих шагах, для каждого из трех hello учетных записей.</span><span class="sxs-lookup"><span data-stu-id="1135f-422">Repeat hello preceding steps for each of hello three accounts.</span></span>

### <a name="grant-hello-required-permissions-toohello-installation-account"></a><span data-ttu-id="1135f-423">Учетная запись установки toohello hello необходимые разрешения</span><span class="sxs-lookup"><span data-stu-id="1135f-423">Grant hello required permissions toohello installation account</span></span>
1. <span data-ttu-id="1135f-424">В hello **Центр администрирования Active Directory**выберите **corp (local)** hello левой панели.</span><span class="sxs-lookup"><span data-stu-id="1135f-424">In hello **Active Directory Administrative Center**, select **corp (local)** in hello left pane.</span></span> <span data-ttu-id="1135f-425">Затем в правом hello **задачи** области, нажмите кнопку **свойства**.</span><span class="sxs-lookup"><span data-stu-id="1135f-425">Then in hello right-hand **Tasks** pane, click **Properties**.</span></span>

    ![Свойства пользователя CORP](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/31-addcproperties.png)
2. <span data-ttu-id="1135f-427">Выберите **расширения**, а затем нажмите кнопку hello **Дополнительно** кнопку на hello **безопасности** вкладку.</span><span class="sxs-lookup"><span data-stu-id="1135f-427">Select **Extensions**, and then click hello **Advanced** button on hello **Security** tab.</span></span>
3. <span data-ttu-id="1135f-428">В hello **Дополнительные параметры безопасности для corp** диалоговое окно, нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="1135f-428">In hello **Advanced Security Settings for corp** dialog, click **Add**.</span></span>
4. <span data-ttu-id="1135f-429">Щелкните **Выберите субъект**, найдите **CORP\Install** и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1135f-429">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span></span>
5. <span data-ttu-id="1135f-430">Выберите hello **чтение всех свойств** флажок.</span><span class="sxs-lookup"><span data-stu-id="1135f-430">Select hello **Read all properties** check box.</span></span>

6. <span data-ttu-id="1135f-431">Выберите hello **создание объектов-компьютеров** флажок.</span><span class="sxs-lookup"><span data-stu-id="1135f-431">Select hello **Create Computer objects** check box.</span></span>

     ![Разрешения пользователя CORP](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/33-addpermissions.png)
7. <span data-ttu-id="1135f-433">Нажмите кнопку **ОК**, а затем снова кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1135f-433">Click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="1135f-434">Закрыть hello **corp** окно "Свойства".</span><span class="sxs-lookup"><span data-stu-id="1135f-434">Close hello **corp** properties window.</span></span>

<span data-ttu-id="1135f-435">Теперь, после завершения настройки Active Directory и объектов пользователей hello, создайте две виртуальные машины SQL Server и следящего сервера виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="1135f-435">Now that you've finished configuring Active Directory and hello user objects, create two SQL Server VMs and a witness server VM.</span></span> <span data-ttu-id="1135f-436">Присоедините все три домена toohello.</span><span class="sxs-lookup"><span data-stu-id="1135f-436">Then join all three toohello domain.</span></span>

## <a name="create-sql-server-vms"></a><span data-ttu-id="1135f-437">Создание виртуальных машин SQL Server</span><span class="sxs-lookup"><span data-stu-id="1135f-437">Create SQL Server VMs</span></span>

<span data-ttu-id="1135f-438">Создайте три дополнительные виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="1135f-438">Create three additional virtual machines.</span></span> <span data-ttu-id="1135f-439">Hello решение требует двух виртуальных машин с экземплярами SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-439">hello solution requires two virtual machines with SQL Server instances.</span></span> <span data-ttu-id="1135f-440">Третья виртуальная машина будет выполнять роль свидетеля.</span><span class="sxs-lookup"><span data-stu-id="1135f-440">A third virtual machine will function as a witness.</span></span> <span data-ttu-id="1135f-441">Windows Server 2016 может использовать [облако-свидетель](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness), но для обеспечения согласованности с предыдущими операционными системами в этом документе в качестве свидетеля используется виртуальная машина.</span><span class="sxs-lookup"><span data-stu-id="1135f-441">Windows Server 2016 can use a [cloud witness](http://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness), however for consistency with previous operating systems this document uses a virtual machine for a witness.</span></span>  

<span data-ttu-id="1135f-442">Перед продолжением рассмотрите следующие решения deisign hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-442">Before you proceed consider hello following deisign decisions.</span></span>

* <span data-ttu-id="1135f-443">**Хранилище — управляемые диски Azure**</span><span class="sxs-lookup"><span data-stu-id="1135f-443">**Storage - Azure Managed Disks**</span></span>

   <span data-ttu-id="1135f-444">Для хранилища виртуальных машин hello Используйте управляемые диски Azure.</span><span class="sxs-lookup"><span data-stu-id="1135f-444">For hello virtual machine storage, use Azure Managed Disks.</span></span> <span data-ttu-id="1135f-445">Корпорация Майкрософт рекомендует управляемые диски для виртуальных машин SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-445">Microsoft recommends Managed Disks for SQL Server virtual machines.</span></span> <span data-ttu-id="1135f-446">Управлять дисками управляет хранилищем фоновом hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-446">Managed Disks handles storage behind hello scenes.</span></span> <span data-ttu-id="1135f-447">Кроме того, когда виртуальные машины с дисками управляемых находятся в hello одной группе доступности Azure распределяет соответствующие избыточности ресурсы хранилища tooprovide hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-447">In addition, when virtual machines with Managed Disks are in hello same availability set, Azure distributes hello storage resources tooprovide appropriate redundancy.</span></span> <span data-ttu-id="1135f-448">Дополнительные сведения см. в [обзоре управляемых дисков Azure](../managed-disks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1135f-448">For additional information, see [Azure Managed Disks Overview](../managed-disks-overview.md).</span></span> <span data-ttu-id="1135f-449">Подробные сведения об управляемых дисках в группе доступности см. в разделе [Использование управляемых дисков для виртуальных машин в группе доступности](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span><span class="sxs-lookup"><span data-stu-id="1135f-449">For specifics about managed disks in an availability set, see [Use Managed Disks for VMs in an availability set](../manage-availability.md#use-managed-disks-for-vms-in-an-availability-set).</span></span>

* <span data-ttu-id="1135f-450">**Сеть — частные IP-адреса в рабочей среде**</span><span class="sxs-lookup"><span data-stu-id="1135f-450">**Network - Private IP addresses in production**</span></span>

   <span data-ttu-id="1135f-451">Для виртуальных машин hello в этом учебнике используется общих IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="1135f-451">For hello virtual machines, this tutorial uses public IP addresses.</span></span> <span data-ttu-id="1135f-452">Это позволяет удаленного подключения напрямую toohello виртуальную машину по hello Интернет - он упрощает настройку.</span><span class="sxs-lookup"><span data-stu-id="1135f-452">This enables remote connection directly toohello virtual machine over hello internet - it makes configuration steps easier.</span></span> <span data-ttu-id="1135f-453">В производственной среде Корпорация Майкрософт рекомендует только частных IP-адресов в порядке tooreduce зона уязвимости hello экземпляра SQL Server hello ресурса виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="1135f-453">In production environments, Microsoft recommends only private IP addresses in order tooreduce hello vulnerability footprint of hello SQL Server instance VM resource.</span></span>

### <a name="create-and-configure-hello-sql-server-vms"></a><span data-ttu-id="1135f-454">Создание и настройка виртуальных машин SQL Server hello</span><span class="sxs-lookup"><span data-stu-id="1135f-454">Create and configure hello SQL Server VMs</span></span>
<span data-ttu-id="1135f-455">Далее создайте три виртуальные машины: две виртуальные машины SQL Server и виртуальную машину для дополнительного узла кластера.</span><span class="sxs-lookup"><span data-stu-id="1135f-455">Next, create three VMs--two SQL Server VMs and a VM for an additional cluster node.</span></span> <span data-ttu-id="1135f-456">toocreate каждой ВМ hello, вернитесь к предыдущему окну toohello **SQL-HA-RG** группы ресурсов, нажмите кнопку **добавить**поиск элемента коллекции, соответствующий hello, нажмите кнопку **виртуальной машины**, а затем Нажмите кнопку **из коллекции**.</span><span class="sxs-lookup"><span data-stu-id="1135f-456">toocreate each of hello VMs, go back toohello **SQL-HA-RG** resource group, click **Add**, search for hello appropriate gallery item, click **Virtual Machine**, and then click **From Gallery**.</span></span> <span data-ttu-id="1135f-457">Используйте сведения hello в hello после создания виртуальных машин hello toohelp таблицы.</span><span class="sxs-lookup"><span data-stu-id="1135f-457">Use hello information in hello following table toohelp you create hello VMs:</span></span>


| <span data-ttu-id="1135f-458">Страница</span><span class="sxs-lookup"><span data-stu-id="1135f-458">Page</span></span> | <span data-ttu-id="1135f-459">VM1</span><span class="sxs-lookup"><span data-stu-id="1135f-459">VM1</span></span> | <span data-ttu-id="1135f-460">VM2</span><span class="sxs-lookup"><span data-stu-id="1135f-460">VM2</span></span> | <span data-ttu-id="1135f-461">VM3</span><span class="sxs-lookup"><span data-stu-id="1135f-461">VM3</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="1135f-462">Выберите элемент, соответствующий коллекции hello</span><span class="sxs-lookup"><span data-stu-id="1135f-462">Select hello appropriate gallery item</span></span> |<span data-ttu-id="1135f-463">**Windows Server 2016 Datacenter**</span><span class="sxs-lookup"><span data-stu-id="1135f-463">**Windows Server 2016 Datacenter**</span></span> |<span data-ttu-id="1135f-464">**SQL Server 2016 SP1 Enterprise на базе Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="1135f-464">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |<span data-ttu-id="1135f-465">**SQL Server 2016 SP1 Enterprise на базе Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="1135f-465">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |
| <span data-ttu-id="1135f-466">Конфигурация виртуальной машины **Базовый**</span><span class="sxs-lookup"><span data-stu-id="1135f-466">Virtual machine configuration **Basics**</span></span> |<span data-ttu-id="1135f-467">**Имя** = cluster-fsw</span><span class="sxs-lookup"><span data-stu-id="1135f-467">**Name** = cluster-fsw</span></span><br/><span data-ttu-id="1135f-468">**Имя пользователя** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="1135f-468">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="1135f-469">**Пароль** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="1135f-469">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="1135f-470">**Подписка** = ваша подписка</span><span class="sxs-lookup"><span data-stu-id="1135f-470">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="1135f-471">**Группа ресурсов** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="1135f-471">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="1135f-472">**Расположение** = ваше расположение Azure</span><span class="sxs-lookup"><span data-stu-id="1135f-472">**Location** = Your azure location</span></span> |<span data-ttu-id="1135f-473">**Имя** = sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="1135f-473">**Name** = sqlserver-0</span></span><br/><span data-ttu-id="1135f-474">**Имя пользователя** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="1135f-474">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="1135f-475">**Пароль** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="1135f-475">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="1135f-476">**Подписка** = ваша подписка</span><span class="sxs-lookup"><span data-stu-id="1135f-476">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="1135f-477">**Группа ресурсов** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="1135f-477">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="1135f-478">**Расположение** = ваше расположение Azure</span><span class="sxs-lookup"><span data-stu-id="1135f-478">**Location** = Your azure location</span></span> |<span data-ttu-id="1135f-479">**Имя** = sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="1135f-479">**Name** = sqlserver-1</span></span><br/><span data-ttu-id="1135f-480">**Имя пользователя** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="1135f-480">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="1135f-481">**Пароль** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="1135f-481">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="1135f-482">**Подписка** = ваша подписка</span><span class="sxs-lookup"><span data-stu-id="1135f-482">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="1135f-483">**Группа ресурсов** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="1135f-483">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="1135f-484">**Расположение** = ваше расположение Azure</span><span class="sxs-lookup"><span data-stu-id="1135f-484">**Location** = Your azure location</span></span> |
| <span data-ttu-id="1135f-485">Конфигурация виртуальной машины **Размер**</span><span class="sxs-lookup"><span data-stu-id="1135f-485">Virtual machine configuration **Size**</span></span> |<span data-ttu-id="1135f-486">**Размер** = DS1\_V2 (1 ядро, 3,5 ГБ)</span><span class="sxs-lookup"><span data-stu-id="1135f-486">**SIZE** = DS1\_V2 (1 core, 3.5 GB)</span></span> |<span data-ttu-id="1135f-487">**Размер** = DS2\_V2 (2 ядра, 7 ГБ)</span><span class="sxs-lookup"><span data-stu-id="1135f-487">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span></br><span data-ttu-id="1135f-488">размер Hello должен поддерживать SSD-хранилище (расширенная поддержка диска.</span><span class="sxs-lookup"><span data-stu-id="1135f-488">hello size must support SSD storage (Premium disk support.</span></span> <span data-ttu-id="1135f-489">)</span><span class="sxs-lookup"><span data-stu-id="1135f-489">))</span></span> |<span data-ttu-id="1135f-490">**Размер** = DS2\_V2 (2 ядра, 7 ГБ)</span><span class="sxs-lookup"><span data-stu-id="1135f-490">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span> |
| <span data-ttu-id="1135f-491">Конфигурация виртуальной машины **Параметры**</span><span class="sxs-lookup"><span data-stu-id="1135f-491">Virtual machine configuration **Settings**</span></span> |<span data-ttu-id="1135f-492">**Хранилище**: используйте управляемые диски.</span><span class="sxs-lookup"><span data-stu-id="1135f-492">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="1135f-493">**Виртуальная сеть** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="1135f-493">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="1135f-494">**Подсеть** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="1135f-494">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="1135f-495">**Общедоступный IP-адрес** создается автоматически.</span><span class="sxs-lookup"><span data-stu-id="1135f-495">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="1135f-496">**Группа безопасности сети** = нет</span><span class="sxs-lookup"><span data-stu-id="1135f-496">**Network security group** = None</span></span><br/><span data-ttu-id="1135f-497">**Диагностика мониторинга** = включено</span><span class="sxs-lookup"><span data-stu-id="1135f-497">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="1135f-498">**Учетная запись хранения для диагностики** = используйте автоматически созданную учетную запись хранения</span><span class="sxs-lookup"><span data-stu-id="1135f-498">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="1135f-499">**Группа доступности** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="1135f-499">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="1135f-500">**Хранилище**: используйте управляемые диски.</span><span class="sxs-lookup"><span data-stu-id="1135f-500">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="1135f-501">**Виртуальная сеть** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="1135f-501">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="1135f-502">**Подсеть** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="1135f-502">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="1135f-503">**Общедоступный IP-адрес** создается автоматически.</span><span class="sxs-lookup"><span data-stu-id="1135f-503">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="1135f-504">**Группа безопасности сети** = нет</span><span class="sxs-lookup"><span data-stu-id="1135f-504">**Network security group** = None</span></span><br/><span data-ttu-id="1135f-505">**Диагностика мониторинга** = включено</span><span class="sxs-lookup"><span data-stu-id="1135f-505">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="1135f-506">**Учетная запись хранения для диагностики** = используйте автоматически созданную учетную запись хранения</span><span class="sxs-lookup"><span data-stu-id="1135f-506">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="1135f-507">**Группа доступности** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="1135f-507">**Availability set** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="1135f-508">**Хранилище**: используйте управляемые диски.</span><span class="sxs-lookup"><span data-stu-id="1135f-508">**Storage**: Use managed disks.</span></span><br/><span data-ttu-id="1135f-509">**Виртуальная сеть** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="1135f-509">**Virtual network** = autoHAVNET</span></span><br/><span data-ttu-id="1135f-510">**Подсеть** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="1135f-510">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="1135f-511">**Общедоступный IP-адрес** создается автоматически.</span><span class="sxs-lookup"><span data-stu-id="1135f-511">**Public IP address** automatically generated.</span></span><br/><span data-ttu-id="1135f-512">**Группа безопасности сети** = нет</span><span class="sxs-lookup"><span data-stu-id="1135f-512">**Network security group** = None</span></span><br/><span data-ttu-id="1135f-513">**Диагностика мониторинга** = включено</span><span class="sxs-lookup"><span data-stu-id="1135f-513">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="1135f-514">**Учетная запись хранения для диагностики** = используйте автоматически созданную учетную запись хранения</span><span class="sxs-lookup"><span data-stu-id="1135f-514">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="1135f-515">**Группа доступности** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="1135f-515">**Availability set** = sqlAvailabilitySet</span></span><br/> |
| <span data-ttu-id="1135f-516">Конфигурация виртуальной машины **Параметры SQL Server**</span><span class="sxs-lookup"><span data-stu-id="1135f-516">Virtual machine configuration **SQL Server settings**</span></span> |<span data-ttu-id="1135f-517">Не применяется</span><span class="sxs-lookup"><span data-stu-id="1135f-517">Not applicable</span></span> |<span data-ttu-id="1135f-518">**Подключение к SQL** = закрытое (в виртуальной сети)</span><span class="sxs-lookup"><span data-stu-id="1135f-518">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="1135f-519">**Порт** = 1433</span><span class="sxs-lookup"><span data-stu-id="1135f-519">**Port** = 1433</span></span><br/><span data-ttu-id="1135f-520">**Проверка подлинности SQL** = отключено</span><span class="sxs-lookup"><span data-stu-id="1135f-520">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="1135f-521">**Конфигурация хранилища** = общая</span><span class="sxs-lookup"><span data-stu-id="1135f-521">**Storage configuration** = General</span></span><br/><span data-ttu-id="1135f-522">**Автоматическое исправление** = воскресенье в 2:00</span><span class="sxs-lookup"><span data-stu-id="1135f-522">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="1135f-523">**Автоматическая архивация** = отключено</span><span class="sxs-lookup"><span data-stu-id="1135f-523">**Automated backup** = Disabled</span></span></br><span data-ttu-id="1135f-524">**Интеграция хранилища ключей Azure** = отключено</span><span class="sxs-lookup"><span data-stu-id="1135f-524">**Azure Key Vault integration** = Disabled</span></span> |<span data-ttu-id="1135f-525">**Подключение к SQL** = закрытое (в виртуальной сети)</span><span class="sxs-lookup"><span data-stu-id="1135f-525">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="1135f-526">**Порт** = 1433</span><span class="sxs-lookup"><span data-stu-id="1135f-526">**Port** = 1433</span></span><br/><span data-ttu-id="1135f-527">**Проверка подлинности SQL** = отключено</span><span class="sxs-lookup"><span data-stu-id="1135f-527">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="1135f-528">**Конфигурация хранилища** = общая</span><span class="sxs-lookup"><span data-stu-id="1135f-528">**Storage configuration** = General</span></span><br/><span data-ttu-id="1135f-529">**Автоматическое исправление** = воскресенье в 2:00</span><span class="sxs-lookup"><span data-stu-id="1135f-529">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="1135f-530">**Автоматическая архивация** = отключено</span><span class="sxs-lookup"><span data-stu-id="1135f-530">**Automated backup** = Disabled</span></span></br><span data-ttu-id="1135f-531">**Интеграция хранилища ключей Azure** = отключено</span><span class="sxs-lookup"><span data-stu-id="1135f-531">**Azure Key Vault integration** = Disabled</span></span> |

<br/>

> [!NOTE]
> <span data-ttu-id="1135f-532">размеры машины Hello, предложенные ниже предназначены для тестирования группы доступности в виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="1135f-532">hello machine sizes suggested here are meant for testing availability groups in Azure VMs.</span></span> <span data-ttu-id="1135f-533">Для наилучшей производительности hello на рабочие нагрузки, увидеть рекомендации hello размеров машины SQL Server и конфигурации в [рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="1135f-533">For hello best performance on production workloads, see hello recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>
>
>

<span data-ttu-id="1135f-534">После полного выделения hello трех виртуальных машин необходимо toojoin их toohello **corp.contoso.com** домена и предоставьте машины toohello CORP\Install права администратора.</span><span class="sxs-lookup"><span data-stu-id="1135f-534">After hello three VMs are fully provisioned, you need toojoin them toohello **corp.contoso.com** domain and grant CORP\Install administrative rights toohello machines.</span></span>

### <span data-ttu-id="1135f-535"><a name="joinDomain"></a>Домену toohello hello серверов</span><span class="sxs-lookup"><span data-stu-id="1135f-535"><a name="joinDomain"></a>Join hello servers toohello domain</span></span>

<span data-ttu-id="1135f-536">Вы теперь может toojoin hello виртуальных машин слишком**corp.contoso.com**. Используйте для виртуальных машин SQL Server hello и файл hello следующие hello следящего сервера:</span><span class="sxs-lookup"><span data-stu-id="1135f-536">You're now able toojoin hello VMs too**corp.contoso.com**. Do hello following for both hello SQL Server VMs and hello file share witness server:</span></span>

1. <span data-ttu-id="1135f-537">Удаленное подключение toohello виртуальную машину с **BUILTIN\DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="1135f-537">Remotely connect toohello virtual machine with **BUILTIN\DomainAdmin**.</span></span>
2. <span data-ttu-id="1135f-538">В **диспетчере сервера** щелкните **Локальный сервер**.</span><span class="sxs-lookup"><span data-stu-id="1135f-538">In **Server Manager**, click **Local Server**.</span></span>
3. <span data-ttu-id="1135f-539">Нажмите кнопку hello **рабочей группы** ссылку.</span><span class="sxs-lookup"><span data-stu-id="1135f-539">Click hello **WORKGROUP** link.</span></span>
4. <span data-ttu-id="1135f-540">В hello **имя компьютера** щелкните **изменений**.</span><span class="sxs-lookup"><span data-stu-id="1135f-540">In hello **Computer Name** section, click **Change**.</span></span>
5. <span data-ttu-id="1135f-541">Выберите hello **домена** флажок и введите **corp.contoso.com** в текстовом поле hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-541">Select hello **Domain** check box and type **corp.contoso.com** in hello text box.</span></span> <span data-ttu-id="1135f-542">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1135f-542">Click **OK**.</span></span>
6. <span data-ttu-id="1135f-543">В hello **безопасности Windows** всплывающем диалоговом окне укажите hello учетные данные для учетной записи администратора домена по умолчанию hello (**CORP\DomainAdmin**) и пароль hello (**Contoso! 0000**).</span><span class="sxs-lookup"><span data-stu-id="1135f-543">In hello **Windows Security** popup dialog, specify hello credentials for hello default domain administrator account (**CORP\DomainAdmin**) and hello password (**Contoso!0000**).</span></span>
7. <span data-ttu-id="1135f-544">После появления сообщения «toohello приветствия домена corp.contoso.com» hello, нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1135f-544">When you see hello "Welcome toohello corp.contoso.com domain" message, click **OK**.</span></span>
8. <span data-ttu-id="1135f-545">Нажмите кнопку **закрыть**, а затем нажмите кнопку **Перезагрузить сейчас** в появившемся диалоговом окне приветствия.</span><span class="sxs-lookup"><span data-stu-id="1135f-545">Click **Close**, and then click **Restart Now** in hello popup dialog.</span></span>

### <a name="add-hello-corpinstall-user-as-an-administrator-on-each-cluster-vm"></a><span data-ttu-id="1135f-546">Добавить hello Corp\Install пользователя с правами администратора на каждом кластере виртуальных Машин</span><span class="sxs-lookup"><span data-stu-id="1135f-546">Add hello Corp\Install user as an administrator on each cluster VM</span></span>

<span data-ttu-id="1135f-547">После перезапуска каждой виртуальной машины является членом домена hello, добавить **CORP\Install** является членом группы локальных администраторов hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-547">After each virtual machine restarts as a member of hello domain, add **CORP\Install** as a member of hello local administrators group.</span></span>

1. <span data-ttu-id="1135f-548">Подождите, пока hello виртуальная машина перезапускается и запустите файл протокола удаленного рабочего СТОЛА hello еще раз из toosign hello основной домен контроллера, в слишком**sqlserver 0** с помощью hello **CORP\DomainAdmin** учетной записи.</span><span class="sxs-lookup"><span data-stu-id="1135f-548">Wait until hello VM is restarted, then launch hello RDP file again from hello primary domain controller toosign in too**sqlserver-0** by using hello **CORP\DomainAdmin** account.</span></span>
   >[!TIP]
   ><span data-ttu-id="1135f-549">Убедитесь, что вход hello учетной записи администратора домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-549">Make sure that you sign in with hello domain administrator account.</span></span> <span data-ttu-id="1135f-550">В предыдущих шагах hello с учетной записью администратора в BUILT hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-550">In hello previous steps, you were using hello BUILT IN administrator account.</span></span> <span data-ttu-id="1135f-551">Теперь, когда hello сервера в домене hello, используйте учетную запись домена hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-551">Now that hello server is in hello domain, use hello domain account.</span></span> <span data-ttu-id="1135f-552">В сеансе RDP укажите *Домен*\\*имя пользователя*.</span><span class="sxs-lookup"><span data-stu-id="1135f-552">In your RDP session, specify *DOMAIN*\\*username*.</span></span>

2. <span data-ttu-id="1135f-553">На панели **Диспетчер серверов** выберите **Инструменты**, а затем щелкните **Управление компьютером**.</span><span class="sxs-lookup"><span data-stu-id="1135f-553">In **Server Manager**, select **Tools**, and then click **Computer Management**.</span></span>
3. <span data-ttu-id="1135f-554">В hello **Управление компьютером** окна, разверните **локальные пользователи и группы**, а затем выберите **группы**.</span><span class="sxs-lookup"><span data-stu-id="1135f-554">In hello **Computer Management** window, expand **Local Users and Groups**, and then select **Groups**.</span></span>
4. <span data-ttu-id="1135f-555">Дважды щелкните hello **Администраторы** группы.</span><span class="sxs-lookup"><span data-stu-id="1135f-555">Double-click hello **Administrators** group.</span></span>
5. <span data-ttu-id="1135f-556">В hello **свойства администратора** диалоговое окно, нажмите кнопку hello **добавить** кнопки.</span><span class="sxs-lookup"><span data-stu-id="1135f-556">In hello **Administrators Properties** dialog, click hello **Add** button.</span></span>
6. <span data-ttu-id="1135f-557">Введите пользователя hello **CORP\Install**, а затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1135f-557">Enter hello user **CORP\Install**, and then click **OK**.</span></span>
7. <span data-ttu-id="1135f-558">Нажмите кнопку **ОК** tooclose hello **свойства администратора** диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="1135f-558">Click **OK** tooclose hello **Administrator Properties** dialog.</span></span>
8. <span data-ttu-id="1135f-559">Повторите предыдущие шаги hello в **sqlserver 1** и **fsw кластера**.</span><span class="sxs-lookup"><span data-stu-id="1135f-559">Repeat hello previous steps on **sqlserver-1** and **cluster-fsw**.</span></span>

### <span data-ttu-id="1135f-560"><a name="setServiceAccount"></a>Задайте учетные записи служб SQL Server hello</span><span class="sxs-lookup"><span data-stu-id="1135f-560"><a name="setServiceAccount"></a>Set hello SQL Server service accounts</span></span>

<span data-ttu-id="1135f-561">На каждой виртуальной Машине SQL Server задайте учетную запись службы SQL Server hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-561">On each SQL Server VM, set hello SQL Server service account.</span></span> <span data-ttu-id="1135f-562">Использовать учетные записи hello созданы во время вы [настроены учетные записи домена hello](#DomainAccounts).</span><span class="sxs-lookup"><span data-stu-id="1135f-562">Use hello accounts that you created when you [configured hello domain accounts](#DomainAccounts).</span></span>

1. <span data-ttu-id="1135f-563">Откройте **диспетчер конфигурации SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="1135f-563">Open **SQL Server Configuration Manager**.</span></span>
2. <span data-ttu-id="1135f-564">Щелкните правой кнопкой мыши hello службы SQL Server и нажмите кнопку **свойства**.</span><span class="sxs-lookup"><span data-stu-id="1135f-564">Right-click hello SQL Server service, and then click **Properties**.</span></span>
3. <span data-ttu-id="1135f-565">Набор hello учетную запись и пароль.</span><span class="sxs-lookup"><span data-stu-id="1135f-565">Set hello account and password.</span></span>
4. <span data-ttu-id="1135f-566">Повторите эти действия на hello других ВМ SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-566">Repeat these steps on hello other SQL Server VM.</span></span>  

<span data-ttu-id="1135f-567">Для групп доступности SQL Server каждой виртуальной Машине SQL Server должен toorun под учетной записью домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-567">For SQL Server availability groups, each SQL Server VM needs toorun as a domain account.</span></span>

### <a name="create-a-sign-in-on-each-sql-server-vm-for-hello-installation-account"></a><span data-ttu-id="1135f-568">Создать вход на каждой виртуальной Машине SQL Server hello учетной записи для установки</span><span class="sxs-lookup"><span data-stu-id="1135f-568">Create a sign-in on each SQL Server VM for hello installation account</span></span>

<span data-ttu-id="1135f-569">Используйте hello установки учетной записи (CORP\install) tooconfigure hello группы доступности.</span><span class="sxs-lookup"><span data-stu-id="1135f-569">Use hello installation account (CORP\install) tooconfigure hello availability group.</span></span> <span data-ttu-id="1135f-570">Эта учетная запись должна toobe членом hello **sysadmin** предопределенной роли сервера на каждой виртуальной Машине SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-570">This account needs toobe a member of hello **sysadmin** fixed server role on each SQL Server VM.</span></span> <span data-ttu-id="1135f-571">Hello следующие действия создадут вход hello учетной записи для установки:</span><span class="sxs-lookup"><span data-stu-id="1135f-571">hello following steps create a sign-in for hello installation account:</span></span>

1. <span data-ttu-id="1135f-572">Подключение сервера toohello через hello удаленного рабочего стола (RDP) с помощью hello  *\<MachineName\>\DomainAdmin* учетной записи.</span><span class="sxs-lookup"><span data-stu-id="1135f-572">Connect toohello server through hello Remote Desktop Protocol (RDP) by using hello *\<MachineName\>\DomainAdmin* account.</span></span>

1. <span data-ttu-id="1135f-573">Откройте среду SQL Server Management Studio и подключитесь toohello локальный экземпляр SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-573">Open SQL Server Management Studio and connect toohello local instance of SQL Server.</span></span>

1. <span data-ttu-id="1135f-574">В **обозревателе объектов** щелкните **Безопасность**.</span><span class="sxs-lookup"><span data-stu-id="1135f-574">In **Object Explorer**, click **Security**.</span></span>

1. <span data-ttu-id="1135f-575">Щелкните правой кнопкой мыши **Имена входа**.</span><span class="sxs-lookup"><span data-stu-id="1135f-575">Right-click **Logins**.</span></span> <span data-ttu-id="1135f-576">Выберите **Создать имя входа**.</span><span class="sxs-lookup"><span data-stu-id="1135f-576">Click **New Login**.</span></span>

1. <span data-ttu-id="1135f-577">В разделе **Создание имени входа** щелкните **Поиск**.</span><span class="sxs-lookup"><span data-stu-id="1135f-577">In **Login - New**, click **Search**.</span></span>

1. <span data-ttu-id="1135f-578">Щелкните **Расположения**.</span><span class="sxs-lookup"><span data-stu-id="1135f-578">Click **Locations**.</span></span>

1. <span data-ttu-id="1135f-579">Введите учетные данные администратора сети hello домена.</span><span class="sxs-lookup"><span data-stu-id="1135f-579">Enter hello domain administrator network credentials.</span></span>

1. <span data-ttu-id="1135f-580">Используйте учетную запись для установки hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-580">Use hello installation account.</span></span>

1. <span data-ttu-id="1135f-581">Задать hello вход toobe членом hello **sysadmin** предопределенной роли сервера.</span><span class="sxs-lookup"><span data-stu-id="1135f-581">Set hello sign-in toobe a member of hello **sysadmin** fixed server role.</span></span>

1. <span data-ttu-id="1135f-582">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1135f-582">Click **OK**.</span></span>

<span data-ttu-id="1135f-583">Повторите hello предыдущих шагах на hello других ВМ SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-583">Repeat hello preceding steps on hello other SQL Server VM.</span></span>

## <a name="add-failover-clustering-features-tooboth-sql-server-vms"></a><span data-ttu-id="1135f-584">Добавить tooboth функции отказоустойчивой кластеризации виртуальных машин SQL Server</span><span class="sxs-lookup"><span data-stu-id="1135f-584">Add Failover Clustering features tooboth SQL Server VMs</span></span>

<span data-ttu-id="1135f-585">функции отказоустойчивой кластеризации tooadd hello на обеих виртуальных машин SQL Server:</span><span class="sxs-lookup"><span data-stu-id="1135f-585">tooadd Failover Clustering features, do hello following on both SQL Server VMs:</span></span>

1. <span data-ttu-id="1135f-586">Подключения виртуальной машины SQL Server toohello через hello удаленного рабочего стола (RDP) с помощью hello *CORP\install* учетной записи.</span><span class="sxs-lookup"><span data-stu-id="1135f-586">Connect toohello SQL Server virtual machine through hello Remote Desktop Protocol (RDP) by using hello *CORP\install* account.</span></span> <span data-ttu-id="1135f-587">Откройте **панель мониторинга диспетчера сервера**.</span><span class="sxs-lookup"><span data-stu-id="1135f-587">Open **Server Manager Dashboard**.</span></span>
2. <span data-ttu-id="1135f-588">Нажмите кнопку hello **Добавить роли и компоненты** ссылку на панель мониторинга hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-588">Click hello **Add roles and features** link on hello dashboard.</span></span>

    ![Диспетчер сервера. Добавление ролей](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
3. <span data-ttu-id="1135f-590">Выберите **Далее** до получения toohello **компонентов сервера** раздела.</span><span class="sxs-lookup"><span data-stu-id="1135f-590">Select **Next** until you get toohello **Server Features** section.</span></span>
4. <span data-ttu-id="1135f-591">В разделе **функций** выберите **Отказоустойчивость кластеров**.</span><span class="sxs-lookup"><span data-stu-id="1135f-591">In **Features**, select **Failover Clustering**.</span></span>
5. <span data-ttu-id="1135f-592">Добавьте другие необходимые функции.</span><span class="sxs-lookup"><span data-stu-id="1135f-592">Add any additional required features.</span></span>
6. <span data-ttu-id="1135f-593">Нажмите кнопку **установить** tooadd функции hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-593">Click **Install** tooadd hello features.</span></span>

<span data-ttu-id="1135f-594">Повторите шаги hello на hello других ВМ SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-594">Repeat hello steps on hello other SQL Server VM.</span></span>

## <a name="a-nameendpoint-firewall-configure-hello-firewall-on-each-sql-server-vm"></a><span data-ttu-id="1135f-595"><a name="endpoint-firewall">Настройка брандмауэра hello на каждой виртуальной Машине SQL Server</span><span class="sxs-lookup"><span data-stu-id="1135f-595"><a name="endpoint-firewall"> Configure hello firewall on each SQL Server VM</span></span>

<span data-ttu-id="1135f-596">Hello решения требуются следующие порты TCP toobe открыть в брандмауэре hello hello:</span><span class="sxs-lookup"><span data-stu-id="1135f-596">hello solution requires hello following TCP ports toobe open in hello firewall:</span></span>

- <span data-ttu-id="1135f-597">**Виртуальная машина SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="1135f-597">**SQL Server VM**:</span></span><br/>
   <span data-ttu-id="1135f-598">Порт 1433 для экземпляра сервера SQL Server по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1135f-598">Port 1433 for a default instance of SQL Server.</span></span>
- <span data-ttu-id="1135f-599">**Проба Azure Load Balancer**.</span><span class="sxs-lookup"><span data-stu-id="1135f-599">**Azure load balancer probe:**</span></span><br/>
   <span data-ttu-id="1135f-600">Любой доступный порт.</span><span class="sxs-lookup"><span data-stu-id="1135f-600">Any available port.</span></span> <span data-ttu-id="1135f-601">В примерах часто используется 59999.</span><span class="sxs-lookup"><span data-stu-id="1135f-601">Examples frequently use 59999.</span></span>
- <span data-ttu-id="1135f-602">**Конечная точка зеркального отображения базы данных**.</span><span class="sxs-lookup"><span data-stu-id="1135f-602">**Database mirroring endpoint:**</span></span> <br/>
   <span data-ttu-id="1135f-603">Любой доступный порт.</span><span class="sxs-lookup"><span data-stu-id="1135f-603">Any available port.</span></span> <span data-ttu-id="1135f-604">В примерах часто используется 5022.</span><span class="sxs-lookup"><span data-stu-id="1135f-604">Examples frequently use 5022.</span></span>

<span data-ttu-id="1135f-605">Hello брандмауэра порты toobe необходимость, открыт на обоих виртуальных машин SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-605">hello firewall ports need toobe open on both SQL Server VMs.</span></span>

<span data-ttu-id="1135f-606">Открытие портов hello Hello метод зависит от hello брандмауэра решение, которое вы используете.</span><span class="sxs-lookup"><span data-stu-id="1135f-606">hello method of opening hello ports depends on hello firewall solution that you use.</span></span> <span data-ttu-id="1135f-607">Hello следующем разделе показано, как tooopen hello порты в брандмауэре Windows.</span><span class="sxs-lookup"><span data-stu-id="1135f-607">hello next section explains how tooopen hello ports in Windows Firewall.</span></span> <span data-ttu-id="1135f-608">Привет открыть необходимые порты на всех виртуальных машин SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-608">Open hello required ports on each of your SQL Server VMs.</span></span>

### <a name="open-a-tcp-port-in-hello-firewall"></a><span data-ttu-id="1135f-609">Откройте TCP-порт в брандмауэре hello</span><span class="sxs-lookup"><span data-stu-id="1135f-609">Open a TCP port in hello firewall</span></span>

1. <span data-ttu-id="1135f-610">На hello первого SQL Server **запустить** экрана, запустить **брандмауэр Windows в режиме повышенной безопасности**.</span><span class="sxs-lookup"><span data-stu-id="1135f-610">On hello first SQL Server **Start** screen, launch **Windows Firewall with Advanced Security**.</span></span>
2. <span data-ttu-id="1135f-611">Выберите на левой панели hello **правила для входящих подключений**.</span><span class="sxs-lookup"><span data-stu-id="1135f-611">On hello left pane, select **Inbound Rules**.</span></span> <span data-ttu-id="1135f-612">На правой панели hello щелкните **новое правило**.</span><span class="sxs-lookup"><span data-stu-id="1135f-612">On hello right pane, click **New Rule**.</span></span>
3. <span data-ttu-id="1135f-613">Для параметра **Тип правила** выберите **Порт**.</span><span class="sxs-lookup"><span data-stu-id="1135f-613">For **Rule Type**, choose **Port**.</span></span>
4. <span data-ttu-id="1135f-614">Порт hello укажите **TCP** и соответствующие номера портов hello типа.</span><span class="sxs-lookup"><span data-stu-id="1135f-614">For hello port, specify **TCP** and type hello appropriate port numbers.</span></span> <span data-ttu-id="1135f-615">См. следующий пример hello.</span><span class="sxs-lookup"><span data-stu-id="1135f-615">See hello following example:</span></span>

   ![Брандмауэр SQL](./media/virtual-machines-windows-portal-sql-availability-group-tutorial/35-tcpports.png)

5. <span data-ttu-id="1135f-617">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="1135f-617">Click **Next**.</span></span>
6. <span data-ttu-id="1135f-618">На hello **действия** оставьте **разрешить подключение hello** , а затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="1135f-618">On hello **Action** page, keep **Allow hello connection** selected, and then click **Next**.</span></span>
7. <span data-ttu-id="1135f-619">На hello **профиль** примите параметры по умолчанию hello и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="1135f-619">On hello **Profile** page, accept hello default settings, and then click **Next**.</span></span>
8. <span data-ttu-id="1135f-620">На hello **имя** укажите имя правила (например, **проверки балансировки Нагрузки Azure**) в hello **имя** текстовое поле и нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="1135f-620">On hello **Name** page, specify a rule name (such as **Azure LB Probe**) in hello **Name** text box, and then click **Finish**.</span></span>

<span data-ttu-id="1135f-621">Повторите эти шаги на hello второй виртуальной Машине SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1135f-621">Repeat these steps on hello second SQL Server VM.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1135f-622">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="1135f-622">Next steps</span></span>

* [<span data-ttu-id="1135f-623">Настройка группы доступности AlwaysOn на виртуальной машине Azure вручную</span><span class="sxs-lookup"><span data-stu-id="1135f-623">Create a SQL Server Always On availability group on Azure virtual machines</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md)
