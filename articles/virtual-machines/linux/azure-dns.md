---
title: "aaaDNS параметры разрешения имен для виртуальных машин Linux в Azure"
description: "Сценарии разрешения имен для виртуальных машин Linux в Azure IaaS, включая предоставленные службы DNS, гибридные внешние DNS и использование собственного DNS-сервера."
services: virtual-machines
documentationcenter: na
author: RicksterCDN
manager: timlt
editor: tysonn
ms.assetid: 787a1e04-cebf-4122-a1b4-1fcf0a2bbf5f
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/19/2016
ms.author: rclaus
ms.openlocfilehash: 7df2320b6f6b42b479bf4070ea60fe5770a78a41
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="dns-name-resolution-options-for-linux-virtual-machines-in-azure"></a>Параметры разрешения DNS-имен для виртуальных машин Linux в Azure
Azure по умолчанию предоставляет разрешение DNS-имен для всех виртуальных машин, находящихся в одной виртуальной сети. Вы можете реализовать собственный механизм разрешения DNS-имен, настроив собственные службы DNS в виртуальных машинах, размещенных в Azure. Hello следующие сценарии поможет вам выбрать тот, который работает в вашей ситуации hello.

* [Разрешение имен, предоставляемое Azure](#azure-provided-name-resolution)
* [разрешение имен с помощью собственного DNS-сервера.](#name-resolution-using-your-own-dns-server)

Тип разрешения имен, используемого Hello зависит от того, как виртуальные машины и экземпляры ролей требуется toocommunicate друг с другом.

Hello следующей таблице представлены сценарии и соответствующие решения для разрешения имен.

| **Сценарий** | **Решение** | **Суффикс** |
| --- | --- | --- |
| Разрешение между экземплярами ролей или виртуальных машин в приветствия имен одной виртуальной сети |[Разрешение имен, предоставляемое Azure](#azure-provided-name-resolution) |Имя узла или полное доменное имя |
| Разрешение имен между экземплярами ролей или виртуальными машинами, находящимися в разных виртуальных сетях |Управляемые клиентами DNS-серверы, перенаправляющие запросы между виртуальными сетями для разрешения в Azure (DNS-прокси). См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server). |только полное доменное имя |
| Разрешение имен локальных компьютеров и служб из экземпляров роли или виртуальных машин в Azure |Управляемые клиентами DNS-серверы (например, локальный контроллер домена, локальный контроллер домена только для чтения или DNS-сервер, вторично синхронизированный с помощью передач зоны). См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server). |только полное доменное имя |
| Разрешение имен узлов Azure с локальных компьютеров |Пересылать запросы tooa под управлением прокси-сервер DNS в hello соответствующей виртуальной сети. Hello прокси-сервер перенаправляет запросы tooAzure для разрешения. См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server). |только полное доменное имя |
| Обратный поиск DNS для внутренних IP-адресов |[разрешение имен с помощью собственного DNS-сервера.](#name-resolution-using-your-own-dns-server) |Недоступно |

## <a name="name-resolution-that-azure-provides"></a>Разрешение имен, предоставляемое Azure
А также разрешение общедоступные DNS-имена Azure предоставляет внутреннее разрешение имен для виртуальных машин и Здравствуйте, экземпляры роли, которые находятся в одной виртуальной сети. В виртуальных сетях, основанных на Azure Resource Manager hello DNS-суффикс является согласованным для всех hello виртуальной сети. Hello полное доменное имя не требуется. DNS-имена могут назначаться tooboth сетевых интерфейсных плат (NIC) и виртуальных машин. Несмотря на то, что hello разрешении имен Azure не требует какой-либо настройки, это не hello правильный выбор для всех сценариев развертывания, как видно в предшествующей таблице hello.

### <a name="features-and-considerations"></a>Функции и рекомендации
**Функции**

* Ничего настраивать не требуется toouse разрешении имен Azure.
* Служба разрешения имен Hello, Azure предоставляет высокой доступности. Не нужны toocreate и управление кластерами серверов DNS.
* Служба разрешения имен Hello, Azure предоставляет может использоваться вместе с собственного tooresolve серверами DNS как локальной, так и имена узлов Azure.
* Разрешение имен обеспечивается между виртуальными машинами в виртуальной сети без необходимости hello полное доменное имя.
* Вместо использования автоматически создаваемых имен узлов вы можете создавать имена, которые наиболее точно описывают ваши развертывания.

**Рекомендации**

* Невозможно изменить Hello DNS-суффикс, который создается в Azure.
* Собственные записи нельзя регистрировать вручную.
* WINS и NetBIOS не поддерживаются.
* Имена узлов должны быть DNS-совместимыми.
    Они могут содержать только символы 0–9, a–z и "-" и не могут начинаться или заканчиваться на "-". См. раздел 2 RFC 3696.
* Трафик запросов DNS регулируется для каждой виртуальной машины. Регулирование не должно влиять на большинство приложений.  Если наблюдается регулирование запросов, проверьте, включено ли кэширование на стороне клиента.  Дополнительные сведения см. в разделе [начало hello большинство с разрешением имен, Azure предоставляет](#getting-the-most-from-name-resolution-that-azure-provides).

### <a name="getting-hello-most-from-name-resolution-that-azure-provides"></a>Начало с разрешением имен, Azure предоставляет большинство hello
**Кэширование на стороне клиента**

Некоторые запросы не передаются по сети hello. Кэширование на стороне клиента помогает уменьшить задержку и повышения устойчивости toonetwork несоответствий, разрешая периодические запросы DNS из локального кэша. DNS-записи содержат срока жизни (TTL), позволяющий запись hello toostore hello кэша в течение без ущерба для записей актуальность. Следовательно, кэширование на стороне клиента подходит для большинства ситуаций.

В некоторых дистрибутивах Linux возможность кэширования не включена по умолчанию. Рекомендуется добавлять виртуальные машины Linux tooeach кэша после проверки того, что не существует локального кэша уже.

Существует несколько разных пакетов кэширования DNS, например dnsmasq. Ниже приведены dnsmasq tooinstall действия hello в наиболее распространенных распределениях hello.

**Ubuntu (используется пакет resolvconf)**
  * Установите пакет dnsmasq hello («sudo установки apt get dnsmasq»).

**SUSE (используется пакет netconf)**:
1. Установите пакет dnsmasq hello («sudo zypper установки dnsmasq»).
2. Включите службу hello dnsmasq («systemctl enable dnsmasq.service»).
3. Запустите службу hello dnsmasq («systemctl начала dnsmasq.service»).
4. Изменить «/ и т. д/sysconfig / / конфигурация сети» и измените NETCONFIG_DNS_FORWARDER = "» слишком «dnsmasq».
5. Обновите кэш hello («обновление netconfig») tooset хоста как hello локального разрешения имен DNS.

**CentOS от Rogue Wave Software (прежнее название — OpenLogic; использует NetworkManager)**
1. Установите пакет dnsmasq hello («sudo yum установки dnsmasq»).
2. Включите службу hello dnsmasq («systemctl enable dnsmasq.service»).
3. Запустите службу hello dnsmasq («systemctl начала dnsmasq.service»).
4. Добавьте «добавить серверы доменных имен 127.0.0.1;» too"/etc/dhclient-eth0.conf».
5. Перезагрузить кэш hello сетевой службы («сеть перезапуска службы») tooset hello hello локального разрешения имен DNS

> [!NOTE]
> : hello «dnsmasq» пакета используется только одно из hello кэширует много DNS, которые доступны для Linux. Перед его использованием проверьте, соответствует ли он вашим потребностям, а также не установлен ли у вас другой кэш.
>
>

**Повторные попытки на стороне клиента**

DNS использует преимущественно протокол UDP. Так как hello протокол UDP не гарантирует доставку сообщений, hello сам протокол DNS обрабатывает логику повторных попыток. Каждый DNS-клиента (операционная система) можно достичь логика повторов разные в зависимости от предпочтений hello создатель:

* ОС Windows выполняет повторную попытку через одну секунду, затем через две и четыре, а затем снова через четыре секунды.
* повторные попытки установки Linux по умолчанию Hello через пять секунд.  Необходимо изменить этот tooretry пять раз интервалы одну секунду.  

toocheck hello текущие параметры на виртуальной машине Linux «кошка /etc/resolv.conf» и посмотрите на строку «параметры» hello, например:

    options timeout:1 attempts:5

Hello хоста файл создан автоматически и не следует изменять. Здравствуйте, конкретные действия, которые добавить hello «параметры» строки различаются в зависимости от распределения:

**Ubuntu** (используется пакет resolvconf)
1. Добавить too'/etc/resolveconf/resolv.conf.d/head строку hello параметры ".
2. Запустите tooupdate «resolvconf -u».

**SUSE** (используется пакет netconf)
1. Добавить toohello 'timeout:1 попыток: 5' NETCONFIG_DNS_RESOLVER_OPTIONS = "» параметра в «/ и т. д/sysconfig / / конфигурация сети».
2. Запустите tooupdate «netconfig обновления».

**CentOS от Rogue Wave Software (прежнее название — OpenLogic**; использует NetworkManager)
1. Добавить too'/etc/NetworkManager/dispatcher.d/11-dhclient «echo «параметры timeout:1 попыток: 5»» ".
2. Запустите tooupdate «перезапуск службы сети».

## <a name="name-resolution-using-your-own-dns-server"></a>разрешение имен с помощью собственного DNS-сервера.
Ваших потребностей разрешения имен может выйти за рамки hello функций, предоставляемых Azure. Например, может требоваться разрешение DNS-имен между виртуальными сетями. toocover этот сценарий можно использовать DNS-серверы.  

DNS-серверы в пределах прямой DNS запрашивает toorecursive специалисты по разрешению имен узлов Azure tooresolve может виртуальной сети, которые в hello одной виртуальной сети. Например DNS-сервер, который работает в Azure может отвечать запросы tooDNS свой собственный DNS для зон файлы и пересылать все другие tooAzure запросов. Эти возможности позволяют toosee виртуальные машины в обеих записей в зоне файлов и имена узлов, которые предоставляет Azure (через сервер пересылки hello). Распознаватели рекурсивные toohello доступ из Azure обеспечивается за счет hello виртуального IP-адреса 168.63.129.16.

Перенаправление запросов DNS также позволяет разрешение DNS между виртуальными сетями, а вашей локальной машины tooresolve имена узлов, которые предоставляет Azure. tooresolve имя узла виртуальной машины, виртуальную машину hello DNS server должен находиться в hello одной виртуальной сети и быть tooAzure запросы настроенных tooforward имя узла. Из-за hello DNS-суффикс в каждой виртуальной сети, можно использовать условное перенаправление правила toosend DNS запрашивает toohello исправить виртуальной сети для разрешения. Hello следующем рисунке показаны две виртуальные сети и локальной сетью, выполнив разрешение DNS между виртуальными сетями с помощью этого метода:

![Разрешение DNS между виртуальными сетями](./media/azure-dns/inter-vnet-dns.png)

При использовании разрешения имен, Azure предоставляет внутренние DNS-суффикс hello предоставляется tooeach виртуальной машины с помощью DHCP. При использовании собственного решения разрешение имени этот суффикс не предоставленного toovirtual машины так как суффикс hello мешает других архитектур DNS. toomachines toorefer полное доменное имя или tooconfigure суффикс hello на виртуальных машинах, можно использовать PowerShell или hello суффикс hello toodetermine API:

* Для виртуальных сетей, которые управляются диспетчером ресурсов Azure, суффикс hello доступна через hello [сетевой адаптер](https://msdn.microsoft.com/library/azure/mt163668.aspx) ресурсов. Можно также запустить hello `azure network public-ip show <resource group> <pip name>` команда toodisplay hello сведения о вашей общедоступный IP-адрес, который включает hello полное доменное имя hello сетевого адаптера.

Если пересылка запросов tooAzure не подходят, tooprovide необходимо собственное решение DNS.  Ваше решение DNS должно:

* Предоставлять корректное разрешение имен, например, с помощью [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md). При использовании DDNS, может потребоваться очистки записей toodisable DNS. Время аренды DHCP в Azure очень долгое, и очистка может удалить записи DNS преждевременно.
* Укажите соответствующие рекурсивного разрешения tooallow разрешения внешних доменных имен.
* Быть доступны (TCP и UDP-порт 53) от клиентов hello, он выполняет и быть hello может tooaccess Интернета.
* Быть защищены от доступа из hello Internet toomitigate угрозы внешних агентов.

> [!NOTE]
> Для повышения производительности при использовании виртуальных машин в Azure DNS-серверы, отключить протокол IPv6 и назначить [общедоступный IP-адрес уровня экземпляра](../../virtual-network/virtual-networks-instance-level-public-ip.md) tooeach DNS server виртуальной машины.  
>
>
