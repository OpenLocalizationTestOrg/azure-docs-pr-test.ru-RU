---
title: "Параметры разрешения DNS-имен для виртуальных машин Linux в Azure"
description: "Сценарии разрешения имен для виртуальных машин Linux в Azure IaaS, включая предоставленные службы DNS, гибридные внешние DNS и использование собственного DNS-сервера."
services: virtual-machines
documentationcenter: na
author: RicksterCDN
manager: timlt
editor: tysonn
ms.assetid: 787a1e04-cebf-4122-a1b4-1fcf0a2bbf5f
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/19/2016
ms.author: rclaus
ms.openlocfilehash: cc06ee9305b4d3034154a0825c1aea53fe446f80
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2017
---
# <a name="dns-name-resolution-options-for-linux-virtual-machines-in-azure"></a><span data-ttu-id="cd461-103">Параметры разрешения DNS-имен для виртуальных машин Linux в Azure</span><span class="sxs-lookup"><span data-stu-id="cd461-103">DNS Name Resolution options for Linux virtual machines in Azure</span></span>
<span data-ttu-id="cd461-104">Azure по умолчанию предоставляет разрешение DNS-имен для всех виртуальных машин, находящихся в одной виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="cd461-104">Azure provides DNS name resolution by default for all virtual machines that are in a single virtual network.</span></span> <span data-ttu-id="cd461-105">Вы можете реализовать собственный механизм разрешения DNS-имен, настроив собственные службы DNS в виртуальных машинах, размещенных в Azure.</span><span class="sxs-lookup"><span data-stu-id="cd461-105">You can implement your own DNS name resolution solution by configuring your own DNS services on your virtual machines that Azure hosts.</span></span> <span data-ttu-id="cd461-106">Ниже приведены сценарии, которые помогут вам выбрать наиболее подходящий вариант для конкретной ситуации.</span><span class="sxs-lookup"><span data-stu-id="cd461-106">The following scenarios should help you choose the one that works for your situation.</span></span>

* [<span data-ttu-id="cd461-107">Разрешение имен, предоставляемое Azure</span><span class="sxs-lookup"><span data-stu-id="cd461-107">Name resolution that Azure provides</span></span>](#azure-provided-name-resolution)
* [<span data-ttu-id="cd461-108">разрешение имен с помощью собственного DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="cd461-108">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server)

<span data-ttu-id="cd461-109">Тип разрешения имен зависит от способа взаимодействия виртуальных машин и экземпляров ролей друг с другом.</span><span class="sxs-lookup"><span data-stu-id="cd461-109">The type of name resolution that you use depends on how your virtual machines and role instances need to communicate with each other.</span></span>

<span data-ttu-id="cd461-110">В приведенной ниже таблице представлены сценарии и соответствующие решения для разрешения имен.</span><span class="sxs-lookup"><span data-stu-id="cd461-110">The following table illustrates scenarios and corresponding name resolution solutions:</span></span>

| <span data-ttu-id="cd461-111">**Сценарий**</span><span class="sxs-lookup"><span data-stu-id="cd461-111">**Scenario**</span></span> | <span data-ttu-id="cd461-112">**Решение**</span><span class="sxs-lookup"><span data-stu-id="cd461-112">**Solution**</span></span> | <span data-ttu-id="cd461-113">**Суффикс**</span><span class="sxs-lookup"><span data-stu-id="cd461-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="cd461-114">Разрешение имен между экземплярами ролей или виртуальными машинами, находящимися в одной виртуальной сети</span><span class="sxs-lookup"><span data-stu-id="cd461-114">Name resolution between role instances or virtual machines in the same virtual network</span></span> |[<span data-ttu-id="cd461-115">Разрешение имен, предоставляемое Azure</span><span class="sxs-lookup"><span data-stu-id="cd461-115">Name resolution that Azure provides</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="cd461-116">Имя узла или полное доменное имя</span><span class="sxs-lookup"><span data-stu-id="cd461-116">hostname or fully-qualified domain name (FQDN)</span></span> |
| <span data-ttu-id="cd461-117">Разрешение имен между экземплярами ролей или виртуальными машинами, находящимися в разных виртуальных сетях</span><span class="sxs-lookup"><span data-stu-id="cd461-117">Name resolution between role instances or virtual machines in different virtual networks</span></span> |<span data-ttu-id="cd461-118">Управляемые клиентами DNS-серверы, перенаправляющие запросы между виртуальными сетями для разрешения в Azure (DNS-прокси).</span><span class="sxs-lookup"><span data-stu-id="cd461-118">Customer-managed DNS servers that forward queries between virtual networks for resolution by Azure (DNS proxy).</span></span> <span data-ttu-id="cd461-119">См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="cd461-119">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="cd461-120">только полное доменное имя</span><span class="sxs-lookup"><span data-stu-id="cd461-120">FQDN only</span></span> |
| <span data-ttu-id="cd461-121">Разрешение имен локальных компьютеров и служб из экземпляров роли или виртуальных машин в Azure</span><span class="sxs-lookup"><span data-stu-id="cd461-121">Resolution of on-premises computers and service names from role instances or virtual machines in Azure</span></span> |<span data-ttu-id="cd461-122">Управляемые клиентами DNS-серверы (например, локальный контроллер домена, локальный контроллер домена только для чтения или DNS-сервер, вторично синхронизированный с помощью передач зоны).</span><span class="sxs-lookup"><span data-stu-id="cd461-122">Customer-managed DNS servers (for example, on-premises domain controller, local read-only domain controller, or a DNS secondary synced by using zone transfers).</span></span> <span data-ttu-id="cd461-123">См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="cd461-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="cd461-124">только полное доменное имя</span><span class="sxs-lookup"><span data-stu-id="cd461-124">FQDN only</span></span> |
| <span data-ttu-id="cd461-125">Разрешение имен узлов Azure с локальных компьютеров</span><span class="sxs-lookup"><span data-stu-id="cd461-125">Resolution of Azure hostnames from on-premises computers</span></span> |<span data-ttu-id="cd461-126">Перенаправление запросов на управляемый клиентом прокси-сервер DNS в соответствующей виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="cd461-126">Forward queries to a customer-managed DNS proxy server in the corresponding virtual network.</span></span> <span data-ttu-id="cd461-127">Прокси-сервер перенаправляет запросы в Azure для разрешения.</span><span class="sxs-lookup"><span data-stu-id="cd461-127">The proxy server forwards queries to Azure for resolution.</span></span> <span data-ttu-id="cd461-128">См. раздел [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server).</span><span class="sxs-lookup"><span data-stu-id="cd461-128">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server).</span></span> |<span data-ttu-id="cd461-129">только полное доменное имя</span><span class="sxs-lookup"><span data-stu-id="cd461-129">FQDN only</span></span> |
| <span data-ttu-id="cd461-130">Обратный поиск DNS для внутренних IP-адресов</span><span class="sxs-lookup"><span data-stu-id="cd461-130">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="cd461-131">разрешение имен с помощью собственного DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="cd461-131">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="cd461-132">Недоступно</span><span class="sxs-lookup"><span data-stu-id="cd461-132">n/a</span></span> |

## <a name="name-resolution-that-azure-provides"></a><span data-ttu-id="cd461-133">Разрешение имен, предоставляемое Azure</span><span class="sxs-lookup"><span data-stu-id="cd461-133">Name resolution that Azure provides</span></span>
<span data-ttu-id="cd461-134">Вместе с разрешением общедоступных DNS-имен Azure предоставляет разрешение внутренних имен для виртуальных машин и экземпляров ролей, которые находятся в той же виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="cd461-134">Along with resolution of public DNS names, Azure provides internal name resolution for virtual machines and role instances that are in the same virtual network.</span></span> <span data-ttu-id="cd461-135">В виртуальных сетях на основе Azure Resource Manager DNS-суффикс является одинаковым для всей виртуальной сети; полное доменное имя не требуется.</span><span class="sxs-lookup"><span data-stu-id="cd461-135">In virtual networks that are based on Azure Resource Manager, the DNS suffix is consistent across the virtual network; the FQDN is not needed.</span></span> <span data-ttu-id="cd461-136">DNS-имена можно назначать как сетевым картам, так и виртуальным машинам.</span><span class="sxs-lookup"><span data-stu-id="cd461-136">DNS names can be assigned to both network interface cards (NICs) and virtual machines.</span></span> <span data-ttu-id="cd461-137">Несмотря на то, что разрешение имен Azure не требует настройки, это не лучший выбор для всех сценариев развертывания, как показано в таблице выше.</span><span class="sxs-lookup"><span data-stu-id="cd461-137">Although the name resolution that Azure provides does not require any configuration, it is not the appropriate choice for all deployment scenarios, as seen on the preceding table.</span></span>

### <a name="features-and-considerations"></a><span data-ttu-id="cd461-138">Функции и рекомендации</span><span class="sxs-lookup"><span data-stu-id="cd461-138">Features and considerations</span></span>
<span data-ttu-id="cd461-139">**Функции**</span><span class="sxs-lookup"><span data-stu-id="cd461-139">**Features:**</span></span>

* <span data-ttu-id="cd461-140">Для использования разрешения имен, предоставляемого Azure, дополнительные настройки не нужны.</span><span class="sxs-lookup"><span data-stu-id="cd461-140">No configuration is required to use name resolution that Azure provides.</span></span>
* <span data-ttu-id="cd461-141">Служба разрешения имен, предоставляемая Azure, отличается высокой доступностью.</span><span class="sxs-lookup"><span data-stu-id="cd461-141">The name resolution service that Azure provides is highly available.</span></span> <span data-ttu-id="cd461-142">Вам не нужно создавать кластеры DNS-серверов и управлять ими.</span><span class="sxs-lookup"><span data-stu-id="cd461-142">You don't need to create and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="cd461-143">Служба разрешения имен, предоставляемая Azure, может использоваться параллельно с DNS-серверами для разрешения имен узлов в локальной среде и Azure.</span><span class="sxs-lookup"><span data-stu-id="cd461-143">The name resolution service that Azure provides can be used along with your own DNS servers to resolve both on-premises and Azure hostnames.</span></span>
* <span data-ttu-id="cd461-144">Разрешение имен предоставляется между виртуальными машинами в виртуальных сетях без необходимости указывать полное доменное имя.</span><span class="sxs-lookup"><span data-stu-id="cd461-144">Name resolution is provided between virtual machines in virtual networks without need for the FQDN.</span></span>
* <span data-ttu-id="cd461-145">Вместо использования автоматически создаваемых имен узлов вы можете создавать имена, которые наиболее точно описывают ваши развертывания.</span><span class="sxs-lookup"><span data-stu-id="cd461-145">You can use hostnames that best describe your deployments rather than working with auto-generated names.</span></span>

<span data-ttu-id="cd461-146">**Рекомендации**</span><span class="sxs-lookup"><span data-stu-id="cd461-146">**Considerations:**</span></span>

* <span data-ttu-id="cd461-147">Созданный Azure DNS-суффикс нельзя изменить.</span><span class="sxs-lookup"><span data-stu-id="cd461-147">The DNS suffix that Azure creates cannot be modified.</span></span>
* <span data-ttu-id="cd461-148">Собственные записи нельзя регистрировать вручную.</span><span class="sxs-lookup"><span data-stu-id="cd461-148">You cannot manually register your own records.</span></span>
* <span data-ttu-id="cd461-149">WINS и NetBIOS не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="cd461-149">WINS and NetBIOS are not supported.</span></span>
* <span data-ttu-id="cd461-150">Имена узлов должны быть DNS-совместимыми.</span><span class="sxs-lookup"><span data-stu-id="cd461-150">Hostnames must be DNS-compatible.</span></span>
    <span data-ttu-id="cd461-151">Они могут содержать только символы 0–9, a–z и "-" и не могут начинаться или заканчиваться на "-".</span><span class="sxs-lookup"><span data-stu-id="cd461-151">Names must use only 0-9, a-z, and '-', and they cannot start or end with a '-'.</span></span> <span data-ttu-id="cd461-152">См. раздел 2 RFC 3696.</span><span class="sxs-lookup"><span data-stu-id="cd461-152">See RFC 3696 Section 2.</span></span>
* <span data-ttu-id="cd461-153">Трафик запросов DNS регулируется для каждой виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="cd461-153">DNS query traffic is throttled for each virtual machine.</span></span> <span data-ttu-id="cd461-154">Регулирование не должно влиять на большинство приложений.</span><span class="sxs-lookup"><span data-stu-id="cd461-154">Throttling shouldn't impact most applications.</span></span>  <span data-ttu-id="cd461-155">Если наблюдается регулирование запросов, проверьте, включено ли кэширование на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="cd461-155">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="cd461-156">Дополнительные сведения см. в разделе [Наиболее эффективное использование разрешения имен Azure](#getting-the-most-from-name-resolution-that-azure-provides).</span><span class="sxs-lookup"><span data-stu-id="cd461-156">For more information, see [Getting the most from name resolution that Azure provides](#getting-the-most-from-name-resolution-that-azure-provides).</span></span>

### <a name="getting-the-most-from-name-resolution-that-azure-provides"></a><span data-ttu-id="cd461-157">Наиболее эффективное использование разрешения имен Azure</span><span class="sxs-lookup"><span data-stu-id="cd461-157">Getting the most from name resolution that Azure provides</span></span>
<span data-ttu-id="cd461-158">**Кэширование на стороне клиента**</span><span class="sxs-lookup"><span data-stu-id="cd461-158">**Client-side caching:**</span></span>

<span data-ttu-id="cd461-159">Не каждый запрос DNS отправляется по сети.</span><span class="sxs-lookup"><span data-stu-id="cd461-159">Some DNS queries are not sent across the network.</span></span> <span data-ttu-id="cd461-160">Кэширование на стороне клиента помогает уменьшить задержку и повысить устойчивость к нестабильной работе сети, разрешая повторяющиеся запросы DNS из локального кэша.</span><span class="sxs-lookup"><span data-stu-id="cd461-160">Client-side caching helps reduce latency and improve resilience to network inconsistencies by resolving recurring DNS queries from a local cache.</span></span> <span data-ttu-id="cd461-161">Записи DNS содержат сведения о сроке жизни (TTL). Это позволяет кэшу хранить записи максимально долго, не влияя на их актуальность.</span><span class="sxs-lookup"><span data-stu-id="cd461-161">DNS records contain a Time-To-Live (TTL), which enables the cache to store the record for as long as possible without impacting record freshness.</span></span> <span data-ttu-id="cd461-162">Следовательно, кэширование на стороне клиента подходит для большинства ситуаций.</span><span class="sxs-lookup"><span data-stu-id="cd461-162">As a result, client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="cd461-163">В некоторых дистрибутивах Linux возможность кэширования не включена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="cd461-163">Some Linux distributions do not include caching by default.</span></span> <span data-ttu-id="cd461-164">Мы рекомендуем добавить кэш в каждую виртуальную машину Linux, но сперва нужно убедиться в отсутствии локального кэша.</span><span class="sxs-lookup"><span data-stu-id="cd461-164">We recommend that you add a cache to each Linux virtual machine after you check that there isn't a local cache already.</span></span>

<span data-ttu-id="cd461-165">Существует несколько разных пакетов кэширования DNS, например dnsmasq.</span><span class="sxs-lookup"><span data-stu-id="cd461-165">Several different DNS caching packages, such as dnsmasq, are available.</span></span> <span data-ttu-id="cd461-166">Ниже описаны шаги по установке пакета dnsmasq на наиболее распространенные версии ОС.</span><span class="sxs-lookup"><span data-stu-id="cd461-166">Here are the steps to install dnsmasq on the most common distributions:</span></span>

<span data-ttu-id="cd461-167">**Ubuntu (используется пакет resolvconf)**</span><span class="sxs-lookup"><span data-stu-id="cd461-167">**Ubuntu (uses resolvconf)**</span></span>
  * <span data-ttu-id="cd461-168">Установите пакет dnsmasq ("sudo apt-get install dnsmasq").</span><span class="sxs-lookup"><span data-stu-id="cd461-168">Install the dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>

<span data-ttu-id="cd461-169">**SUSE (используется пакет netconf)**:</span><span class="sxs-lookup"><span data-stu-id="cd461-169">**SUSE (uses netconf)**:</span></span>
1. <span data-ttu-id="cd461-170">Установите пакет dnsmasq ("sudo zypper install dnsmasq").</span><span class="sxs-lookup"><span data-stu-id="cd461-170">Install the dnsmasq package (“sudo zypper install dnsmasq”).</span></span>
2. <span data-ttu-id="cd461-171">Активируйте службу dnsmasq ("systemctl enable dnsmasq.service").</span><span class="sxs-lookup"><span data-stu-id="cd461-171">Enable the dnsmasq service (“systemctl enable dnsmasq.service”).</span></span>
3. <span data-ttu-id="cd461-172">Запустите службу dnsmasq ("systemctl start dnsmasq.service").</span><span class="sxs-lookup"><span data-stu-id="cd461-172">Start the dnsmasq service (“systemctl start dnsmasq.service”).</span></span>
4. <span data-ttu-id="cd461-173">Измените путь /etc/sysconfig/network/config и замените блок NETCONFIG_DNS_FORWARDER="" текстом dnsmasq.</span><span class="sxs-lookup"><span data-stu-id="cd461-173">Edit “/etc/sysconfig/network/config”, and change NETCONFIG_DNS_FORWARDER="" to ”dnsmasq”.</span></span>
5. <span data-ttu-id="cd461-174">Укажите в файле resolv.conf ("netconfig update") кэш в качестве локального сопоставителя DNS.</span><span class="sxs-lookup"><span data-stu-id="cd461-174">Update resolv.conf ("netconfig update") to set the cache as the local DNS resolver.</span></span>

<span data-ttu-id="cd461-175">**CentOS от Rogue Wave Software (прежнее название — OpenLogic; использует NetworkManager)**</span><span class="sxs-lookup"><span data-stu-id="cd461-175">**CentOS by Rogue Wave Software (formerly OpenLogic; uses NetworkManager)**</span></span>
1. <span data-ttu-id="cd461-176">Установите пакет dnsmasq ("sudo yum install dnsmasq").</span><span class="sxs-lookup"><span data-stu-id="cd461-176">Install the dnsmasq package (“sudo yum install dnsmasq”).</span></span>
2. <span data-ttu-id="cd461-177">Активируйте службу dnsmasq ("systemctl enable dnsmasq.service").</span><span class="sxs-lookup"><span data-stu-id="cd461-177">Enable the dnsmasq service (“systemctl enable dnsmasq.service”).</span></span>
3. <span data-ttu-id="cd461-178">Запустите службу dnsmasq ("systemctl start dnsmasq.service").</span><span class="sxs-lookup"><span data-stu-id="cd461-178">Start the dnsmasq service (“systemctl start dnsmasq.service”).</span></span>
4. <span data-ttu-id="cd461-179">Добавьте строку "prepend domain-name-servers 127.0.0.1;" в файл /etc/dhclient-eth0.conf.</span><span class="sxs-lookup"><span data-stu-id="cd461-179">Add “prepend domain-name-servers 127.0.0.1;” to “/etc/dhclient-eth0.conf”.</span></span>
5. <span data-ttu-id="cd461-180">Перезапустите сетевую службу ("service network restart"), чтобы указать кэш в качестве локального сопоставителя DNS.</span><span class="sxs-lookup"><span data-stu-id="cd461-180">Restart the network service (“service network restart”) to set the cache as the local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="cd461-181">Пакет dnsmasq — один из многих доступных пакетов кэша DNS для ОС Linux.</span><span class="sxs-lookup"><span data-stu-id="cd461-181">: The 'dnsmasq' package is only one of the many DNS caches that are available for Linux.</span></span> <span data-ttu-id="cd461-182">Перед его использованием проверьте, соответствует ли он вашим потребностям, а также не установлен ли у вас другой кэш.</span><span class="sxs-lookup"><span data-stu-id="cd461-182">Before you use it, check its suitability for your needs and that no other cache is installed.</span></span>
>
>

<span data-ttu-id="cd461-183">**Повторные попытки на стороне клиента**</span><span class="sxs-lookup"><span data-stu-id="cd461-183">**Client-side retries**</span></span>

<span data-ttu-id="cd461-184">DNS использует преимущественно протокол UDP.</span><span class="sxs-lookup"><span data-stu-id="cd461-184">DNS is primarily a UDP protocol.</span></span> <span data-ttu-id="cd461-185">Так как протокол UDP не гарантирует доставку сообщений, логика повторных попыток обрабатывается в самом протоколе DNS.</span><span class="sxs-lookup"><span data-stu-id="cd461-185">Because the UDP protocol doesn't guarantee message delivery, the DNS protocol itself handles retry logic.</span></span> <span data-ttu-id="cd461-186">Каждый DNS-клиент (ОС) может реализовывать разную логику повторных попыток в зависимости от предпочтений создателя.</span><span class="sxs-lookup"><span data-stu-id="cd461-186">Each DNS client (operating system) can exhibit different retry logic depending on the creator's preference:</span></span>

* <span data-ttu-id="cd461-187">ОС Windows выполняет повторную попытку через одну секунду, затем через две и четыре, а затем снова через четыре секунды.</span><span class="sxs-lookup"><span data-stu-id="cd461-187">Windows operating systems retry after one second and then again after another two, four, and another four seconds.</span></span>
* <span data-ttu-id="cd461-188">Повторные попытки в ОС Linux по умолчанию выполняются через пять секунд.</span><span class="sxs-lookup"><span data-stu-id="cd461-188">The default Linux setup retries after five seconds.</span></span>  <span data-ttu-id="cd461-189">Рекомендуется изменить этот параметр, чтобы повторные попытки выполнялись пять раз с интервалом в одну секунду.</span><span class="sxs-lookup"><span data-stu-id="cd461-189">You should change this to retry five times at one-second intervals.</span></span>  

<span data-ttu-id="cd461-190">Чтобы проверить текущие параметры в виртуальной машине Linux, введите команду "cat /etc/resolv.conf" и просмотрите строку options. Пример:</span><span class="sxs-lookup"><span data-stu-id="cd461-190">To check the current settings on a Linux virtual machine, 'cat /etc/resolv.conf', and look at the 'options' line, for example:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="cd461-191">Файл resolv.conf создается автоматически; его не следует изменять.</span><span class="sxs-lookup"><span data-stu-id="cd461-191">The resolv.conf file is auto-generated and should not be edited.</span></span> <span data-ttu-id="cd461-192">Шаги по добавлению строки options отличаются в разных дистрибутивах.</span><span class="sxs-lookup"><span data-stu-id="cd461-192">The specific steps that add the 'options' line vary by distribution:</span></span>

<span data-ttu-id="cd461-193">**Ubuntu** (используется пакет resolvconf)</span><span class="sxs-lookup"><span data-stu-id="cd461-193">**Ubuntu** (uses resolvconf)</span></span>
1. <span data-ttu-id="cd461-194">Добавьте строку options в "/etc/resolveconf/resolv.conf.d/head".</span><span class="sxs-lookup"><span data-stu-id="cd461-194">Add the options line to '/etc/resolveconf/resolv.conf.d/head'.</span></span>
2. <span data-ttu-id="cd461-195">Выполните команду "resolvconf -u" для обновления.</span><span class="sxs-lookup"><span data-stu-id="cd461-195">Run 'resolvconf -u' to update.</span></span>

<span data-ttu-id="cd461-196">**SUSE** (используется пакет netconf)</span><span class="sxs-lookup"><span data-stu-id="cd461-196">**SUSE** (uses netconf)</span></span>
1. <span data-ttu-id="cd461-197">Добавьте параметр "timeout:1 attempts:5" в блок NETCONFIG_DNS_RESOLVER_OPTIONS="" в /etc/sysconfig/network/config.</span><span class="sxs-lookup"><span data-stu-id="cd461-197">Add 'timeout:1 attempts:5' to the NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'.</span></span>
2. <span data-ttu-id="cd461-198">Выполните команду "netconfig update" для обновления.</span><span class="sxs-lookup"><span data-stu-id="cd461-198">Run 'netconfig update' to update.</span></span>

<span data-ttu-id="cd461-199">**CentOS от Rogue Wave Software (прежнее название — OpenLogic**; использует NetworkManager)</span><span class="sxs-lookup"><span data-stu-id="cd461-199">**CentOS by Rogue Wave Software (formerly OpenLogic)** (uses NetworkManager)</span></span>
1. <span data-ttu-id="cd461-200">Добавьте echo "options timeout:1 attempts:5" в /etc/NetworkManager/dispatcher.d/11-dhclient.</span><span class="sxs-lookup"><span data-stu-id="cd461-200">Add 'echo "options timeout:1 attempts:5"' to '/etc/NetworkManager/dispatcher.d/11-dhclient'.</span></span>
2. <span data-ttu-id="cd461-201">Выполните команду "service network restart" для обновления.</span><span class="sxs-lookup"><span data-stu-id="cd461-201">Run 'service network restart' to update.</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="cd461-202">разрешение имен с помощью собственного DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="cd461-202">Name resolution using your own DNS server</span></span>
<span data-ttu-id="cd461-203">Ваши требования к разрешению имен могут выйти за рамки возможностей Azure.</span><span class="sxs-lookup"><span data-stu-id="cd461-203">Your name resolution needs may go beyond the features that Azure provides.</span></span> <span data-ttu-id="cd461-204">Например, может требоваться разрешение DNS-имен между виртуальными сетями.</span><span class="sxs-lookup"><span data-stu-id="cd461-204">For example, you might require DNS resolution between virtual networks.</span></span> <span data-ttu-id="cd461-205">В таких случаях можно использовать собственные DNS-серверы.</span><span class="sxs-lookup"><span data-stu-id="cd461-205">To cover this scenario, you can use your own DNS servers.</span></span>  

<span data-ttu-id="cd461-206">DNS-серверы в виртуальной сети могут перенаправлять запросы DNS рекурсивным сопоставителям Azure для разрешения имен узлов в этой виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="cd461-206">DNS servers within a virtual network can forward DNS queries to recursive resolvers of Azure to resolve hostnames that are in the same virtual network.</span></span> <span data-ttu-id="cd461-207">Например, DNS-сервер, запущенный в Azure, может отвечать на запросы своих файлов зоны DNS и перенаправлять все остальные запросы в Azure.</span><span class="sxs-lookup"><span data-stu-id="cd461-207">For example, a DNS server that runs in Azure can respond to DNS queries for its own DNS zone files and forward all other queries to Azure.</span></span> <span data-ttu-id="cd461-208">Это позволяет виртуальным машинам видеть как ваши записи в файлах зоны, так и имена узлов, предоставленные Azure (с помощью сервера пересылки).</span><span class="sxs-lookup"><span data-stu-id="cd461-208">This functionality enables virtual machines to see both your entries in your zone files and hostnames that Azure provides (via the forwarder).</span></span> <span data-ttu-id="cd461-209">Доступ к рекурсивным сопоставителям Azure предоставляется через виртуальный IP-адрес 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="cd461-209">Access to the recursive resolvers of Azure is provided via the virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="cd461-210">Перенаправление запросов DNS также позволяет выполнять разрешение DNS между виртуальными сетями и дает вашим локальным компьютерам разрешать имена узлов, предоставляемые Azure.</span><span class="sxs-lookup"><span data-stu-id="cd461-210">DNS forwarding also enables DNS resolution between virtual networks and enables your on-premises machines to resolve hostnames that Azure provides.</span></span> <span data-ttu-id="cd461-211">Чтобы разрешить имя узла виртуальной машины, виртуальная машина DNS-сервера должна находиться в той же виртуальной сети и быть настроена для перенаправления запросов имен узлов в Azure.</span><span class="sxs-lookup"><span data-stu-id="cd461-211">To resolve a virtual machine's hostname, the DNS server virtual machine must reside in the same virtual network and be configured to forward hostname queries to Azure.</span></span> <span data-ttu-id="cd461-212">Так как DNS-суффиксы в разных виртуальных сетях различаются, можно использовать правила условного перенаправления для отправки запросов DNS в правильную виртуальную сеть для разрешения.</span><span class="sxs-lookup"><span data-stu-id="cd461-212">Because the DNS suffix is different in each virtual network, you can use conditional forwarding rules to send DNS queries to the correct virtual network for resolution.</span></span> <span data-ttu-id="cd461-213">На приведенном ниже рисунке показаны две виртуальные сети и локальная сеть, выполняющая разрешение DNS между виртуальными сетями с помощью этого метода.</span><span class="sxs-lookup"><span data-stu-id="cd461-213">The following image shows two virtual networks and an on-premises network doing DNS resolution between virtual networks by using this method:</span></span>

![Разрешение DNS между виртуальными сетями](./media/azure-dns/inter-vnet-dns.png)

<span data-ttu-id="cd461-215">При использовании разрешения имен Azure внутренний DNS-суффикс передается в каждую виртуальную машину с помощью DHCP.</span><span class="sxs-lookup"><span data-stu-id="cd461-215">When you use name resolution that Azure provides, the internal DNS suffix is provided to each virtual machine by using DHCP.</span></span> <span data-ttu-id="cd461-216">При использовании собственного решения для разрешения имен этот суффикс не передается в виртуальные машины, так как влияет на другие архитектуры DNS.</span><span class="sxs-lookup"><span data-stu-id="cd461-216">When you use your own name resolution solution, this suffix is not supplied to virtual machines because the suffix interferes with other DNS architectures.</span></span> <span data-ttu-id="cd461-217">Для ссылки на компьютеры по полному доменному имени или для настройки суффикса в виртуальных машинах можно определить суффикс с помощью PowerShell или API.</span><span class="sxs-lookup"><span data-stu-id="cd461-217">To refer to machines by FQDN or to configure the suffix on your virtual machines, you can use PowerShell or the API to determine the suffix:</span></span>

* <span data-ttu-id="cd461-218">Для управляемых виртуальных сетей в модели Azure Resource Manager суффикс можно узнать с помощью ресурса [сетевой карты](https://msdn.microsoft.com/library/azure/mt163668.aspx).</span><span class="sxs-lookup"><span data-stu-id="cd461-218">For virtual networks that are managed by Azure Resource Manager, the suffix is available via the [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource.</span></span> <span data-ttu-id="cd461-219">Можно также выполнить команду `azure network public-ip show <resource group> <pip name>`, которая покажет ваш общедоступный IP-адрес, включая полное доменное имя сетевой карты.</span><span class="sxs-lookup"><span data-stu-id="cd461-219">You can also run the `azure network public-ip show <resource group> <pip name>` command to display the details of your public IP, which includes the FQDN of the NIC.</span></span>

<span data-ttu-id="cd461-220">Если перенаправление запросов в Azure не соответствует вашим требованиям, необходимо предоставить собственное решение DNS.</span><span class="sxs-lookup"><span data-stu-id="cd461-220">If forwarding queries to Azure doesn't suit your needs, you need to provide your own DNS solution.</span></span>  <span data-ttu-id="cd461-221">Ваше решение DNS должно:</span><span class="sxs-lookup"><span data-stu-id="cd461-221">Your DNS solution needs to:</span></span>

* <span data-ttu-id="cd461-222">Предоставлять корректное разрешение имен, например, с помощью [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md).</span><span class="sxs-lookup"><span data-stu-id="cd461-222">Provide appropriate hostname resolution, for example via [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md).</span></span> <span data-ttu-id="cd461-223">При использовании DDNS может потребоваться отключить очистку записей DNS.</span><span class="sxs-lookup"><span data-stu-id="cd461-223">If you use DDNS, you might need to disable DNS record scavenging.</span></span> <span data-ttu-id="cd461-224">Время аренды DHCP в Azure очень долгое, и очистка может удалить записи DNS преждевременно.</span><span class="sxs-lookup"><span data-stu-id="cd461-224">DHCP leases of Azure are very long and scavenging may remove DNS records prematurely.</span></span>
* <span data-ttu-id="cd461-225">Предоставлять корректное рекурсивное разрешение для разрешения внешних доменных имен.</span><span class="sxs-lookup"><span data-stu-id="cd461-225">Provide appropriate recursive resolution to allow resolution of external domain names.</span></span>
* <span data-ttu-id="cd461-226">Быть доступным (по протоколам TCP и UDP через порт 53) для клиентов, которых оно обслуживает, и иметь доступ к Интернету.</span><span class="sxs-lookup"><span data-stu-id="cd461-226">Be accessible (TCP and UDP on port 53) from the clients it serves and be able to access the Internet.</span></span>
* <span data-ttu-id="cd461-227">Быть защищенным от доступа из Интернета для снижения угроз, исходящих от внешних агентов.</span><span class="sxs-lookup"><span data-stu-id="cd461-227">Be secured against access from the Internet to mitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="cd461-228">Если в качестве DNS-серверов используются виртуальные машины Azure, для оптимальной производительности следует отключить IPv6 и назначить [общедоступный IP-адрес уровня экземпляра](../../virtual-network/virtual-networks-instance-level-public-ip.md) каждой виртуальной машине, выполняющей роль DNS-сервера.</span><span class="sxs-lookup"><span data-stu-id="cd461-228">For best performance, when you use virtual machines in Azure DNS servers, disable IPv6 and assign an [Instance-Level Public IP](../../virtual-network/virtual-networks-instance-level-public-ip.md) to each DNS server virtual machine.</span></span>  
>
>
