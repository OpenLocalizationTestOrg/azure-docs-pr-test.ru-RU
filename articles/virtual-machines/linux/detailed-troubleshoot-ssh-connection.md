---
title: "aaaDetailed SSH для устранения неполадок в Виртуальной машине Azure | Документы Microsoft"
description: "Более подробные SSH устранения неполадок для проблемы с подключением tooan виртуальной машины Azure"
keywords: "в SSH-подключении отказано, ошибка SSH, Azure SSH, ошибка SSH-подключения"
services: virtual-machines-linux
documentationcenter: 
author: iainfoulds
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
ms.assetid: b8e8be5f-e8a6-489d-9922-9df8de32e839
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: support-article
ms.date: 07/06/2017
ms.author: iainfou
ms.openlocfilehash: 3f711e53a8251f8c06dbb589a258222566a4ae1e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="detailed-ssh-troubleshooting-steps-for-issues-connecting-tooa-linux-vm-in-azure"></a>Подробные SSH устранения неполадок для проблемы с подключением tooa виртуальных Машин Linux в Azure
Существует множество возможных причин этого клиента SSH hello может быть служба SSH может tooreach hello hello виртуальной Машины. Если вы следовали через hello более [общие SSH, действия по устранению неполадок](troubleshoot-ssh-connection.md), требуется toofurther устранить проблему подключения hello. В этой статье поможет подробные toodetermine действия для устранения неполадок там, где произошел сбой hello SSH-подключения и как tooresolve его.

## <a name="take-preliminary-steps"></a>Выполнение предварительных действий
Hello следующей диаграмме показаны компоненты hello, задействованные.

![Схема компонентов службы SSH](./media/detailed-troubleshoot-ssh-connection/ssh-tshoot1.png)

Hello следующие действия помогут выявить источник hello сбоя hello и выясните, способы их устранения.

1. Проверьте состояние hello hello ВМ на портале hello.
   В hello [портал Azure](https://portal.azure.com)выберите **виртуальные машины** > *имя виртуальной Машины*.

   Hello hello виртуальной Машины в области состояние должно отображаться **под управлением**. Прокрутите вниз tooshow Недавние действия для вычислений, хранения и сетевых ресурсов.

2. Выберите **параметры** tooexamine конечных точек, IP адреса, сетевые группы безопасности и другие параметры.

   Hello виртуальной Машины должен иметь конечную точку, определенную для SSH-трафика, который можно просмотреть в **конечные точки** или  **[сетевой группы безопасности](../../virtual-network/virtual-networks-nsg.md)**. Конечные точки в виртуальных машинах, созданных с помощью Resource Manager, сохраняются в группе безопасности сети. Кроме того убедитесь, что правила hello был применен toohello сетевой группы безопасности и что все ссылки на них в подсети hello.

tooverify сетевое подключение, проверьте hello настроить конечные точки и разделе, если можно получить доступ к hello виртуальной Машины через другой протокол, например HTTP или другой службы.

После выполнения этих шагов повторите попытку подключения SSH hello.

## <a name="find-hello-source-of-hello-issue"></a>Найти источник проблемы hello hello
Hello клиент SSH на компьютере может завершиться неудачно служба SSH hello tooreach hello виртуальной Машины Azure из-за tooissues или неверные настройки hello в следующих областях:

* [Клиентский компьютер SSH.](#source-1-ssh-client-computer)
* [Пограничное устройство организации.](#source-2-organization-edge-device)
* [Конечная точка облачной службы и список управления доступом (ACL)](#source-3-cloud-service-endpoint-and-acl)
* [Группы безопасности сети](#source-4-network-security-groups)
* [Виртуальная машина Azure под управлением Linux](#source-5-linux-based-azure-virtual-machine)

## <a name="source-1-ssh-client-computer"></a>Источник 1: клиентский компьютер SSH
tooeliminate компьютер в качестве источника hello hello сбоя, убедитесь, что его можно приготовить SSH подключений tooanother локально, компьютер под управлением Linux.

![Схема, на которой выделены компоненты клиентского компьютера SSH](./media/detailed-troubleshoot-ssh-connection/ssh-tshoot2.png)

Если hello подключения возвращает ошибку, проверьте hello следующих ситуаций на вашем компьютере:

* настройки локального брандмауэра, блокирующей входящий и исходящий SSH-трафик (TCP 22);
* локального программного обеспечения с функциями прокси клиента, которое не позволяет установить SSH-подключение;
* локального программного обеспечения для мониторинга сети, которое не позволяет установить SSH-подключение;
* других программ для обеспечения безопасности, которые ведут мониторинг трафика либо разрешают и запрещают трафик определенных типов.

При одном из этих условий, временно отключите hello программного обеспечения и повторите toofind SSH подключения tooan локального компьютера out hello причина, по которой hello подключение блокируется на вашем компьютере. Работайте с вашей сетевой администратор toocorrect hello программного обеспечения параметры tooallow соединений по протоколу SSH.

Если вы используете проверку подлинности сертификата, проверьте наличие папки .ssh toohello эти разрешения в домашнем каталоге:

* Chmod 700 ~/.ssh;
* Chmod 644 ~/.ssh/\*.pub
* Chmod 600 ~/.ssh/id_rsa (или другие файлы, в которых хранятся ваши закрытые ключи);
* Chmod 644 ~/.ssh/known_hosts (содержит узлы, что вы подключились toovia SSH)

## <a name="source-2-organization-edge-device"></a>Источник 2: пограничное устройство организации
tooeliminate устройства edge организации, как источник hello сбоя hello, убедитесь, что компьютер, напрямую подключенный toohello Интернета можно приготовить tooyour SSH подключения к виртуальной Машине Azure. Если вы обращаетесь hello виртуальной Машины через сеть сеть VPN-Подключение или подключение Azure ExpressRoute, пропустите слишком[источника 4: сетевых групп безопасности](#nsg).

![Схема, на которой выделено пограничное устройство организации](./media/detailed-troubleshoot-ssh-connection/ssh-tshoot3.png)

Если у вас нет компьютера, находящегося непосредственно подключенных toohello Интернета, создание новой виртуальной Машины Azure в свой собственный ресурс группы или облачной службы и использовать его. Дополнительные сведения см. в статье [Создание виртуальной машины Linux с помощью интерфейса командной строки Azure 2.0](quick-create-cli.md). Удалите hello ресурсов группы или виртуальной Машины и облачные службы после завершения тестирования.

При создании SSH-подключения с компьютером, который подключен напрямую toohello Интернет Проверьте устройство пограничного организации для:

* Внутренним брандмауэром, который блокирует трафик SSH с hello Интернет
* прокси-сервер, который не позволяет устанавливать SSH-подключения;
* программное обеспечение для обнаружения атак и мониторинга сети, которое работает на устройствах в вашей сети периметра и блокирует SSH-подключения.

Работать с параметры сети toocorrect администратора hello трафика организации пограничного устройства tooallow SSH с hello Интернета.

## <a name="source-3-cloud-service-endpoint-and-acl"></a>Источник 3: конечная точка облачной службы и список управления доступом (ACL)
> [!NOTE]
> Этот источник применяется только tooVMs, созданные с помощью hello классической модели развертывания. Для виртуальных машин, которые были созданы с помощью диспетчера ресурсов, пропустить слишком[источника 4: сетевых групп безопасности](#nsg).

tooeliminate hello конечная точка облачной службы и ACL как источник hello сбоя hello, проверьте, что другой виртуальной Машины Azure в hello таким же виртуальной сети можно сделать tooyour подключений SSH виртуальной Машины.

![Диаграмма, на которой выделены конечная точка облачной службы и ACL](./media/detailed-troubleshoot-ssh-connection/ssh-tshoot4.png)

Если у вас нет другой виртуальной Машиной в hello одной виртуальной сети, ее можно легко создать. Дополнительные сведения см. в разделе [Создание виртуальной Машины Linux в Azure, с помощью hello CLI](quick-create-cli.md). Удалить hello очень ВМ после завершения тестирования.

При создании виртуальной машины в SSH-подключения hello же виртуальной сети, проверьте hello в следующих областях:

* **Конфигурация конечной точки Hello трафик SSH на целевой hello виртуальной Машины.** частный порт TCP Hello hello конечной точки должно совпадать какие hello SSH службы на ВМ hello прослушивает порт TCP hello. (порт по умолчанию hello — 22). Проверьте номер порта SSH TCP hello в hello портал Azure, выбрав **виртуальные машины** > *имя виртуальной Машины* > **параметры**  >  **Конечные точки**.
* **Hello ACL для конечной точки трафика SSH hello hello целевой виртуальной машине.** Список ACL позволяет toospecify разрешает или запрещает входящий трафик из hello Интернета, на основе исходного IP-адреса. Неправильно настроенные ACL может помешать конечной toohello трафик входящих SSH. Проверьте вашей tooensure списки управления доступом разрешен входящий трафик от hello открытый IP-адреса прокси-сервера или других пограничный сервер. Дополнительные сведения см. в статье [Список управления доступом (ACL) конечной точки](../../virtual-network/virtual-networks-acl.md).

Конечная точка hello tooeliminate как источник проблемы hello, удалите hello текущей конечной точки, создать другой конечной точкой и укажите имя SSH hello (TCP-порт 22 для номера портов, открытых и закрытых hello). Дополнительные сведения см. в статье [Настройка конечных точек в классической виртуальной машине Windows в Azure](../windows/classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).

<a id="nsg"></a>

## <a name="source-4-network-security-groups"></a>Источник 4: группы безопасности сети
Сетевые группы безопасности позволяют toohave более детальный контроль над разрешенного входящего и исходящего трафика. Можно создавать правила, которые распространяются на подсети и облачные службы в виртуальной сети Azure. Проверьте вашей tooensure правил сетевой группы безопасности, tooand трафик SSH из hello, разрешенное в Интернете.
Дополнительные сведения см. в статье [Группа безопасности сети](../../virtual-network/virtual-networks-nsg.md).

Также можно проверить IP конфигурации NSG toovalidate hello. Дополнительные сведения см. в статье [Обзор мониторинга сети Azure](https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview). 

## <a name="source-5-linux-based-azure-virtual-machine"></a>Источник 5: виртуальная машина Azure в службе Azure
Источник последнего Hello возможные проблемы — hello Azure самой виртуальной машины.

![Диаграмма, на которой выделена виртуальная машина Azure под управлением Linux](./media/detailed-troubleshoot-ssh-connection/ssh-tshoot5.png)

Если вы еще не сделали этого, выполните инструкции hello [tooreset пароль или SSH для виртуальных машин под управлением Linux](classic/reset-access.md?toc=%2fazure%2fvirtual-machines%2flinux%2fclassic%2ftoc.json).

Попытайтесь снова установить подключение со своего компьютера. Если проблема не исчезла, hello ниже приведены некоторые возможные причины неполадок hello:

* Hello SSH-служба не запущена на hello целевой виртуальной машине.
* Hello SSH-служба не прослушивает TCP-порт 22. tootest, установите клиент telnet на локальном компьютере и запустите «telnet *cloudServiceName*. cloudapp.net 22». Этот шаг определяет, если hello виртуальной машины позволяет входящий и исходящий toohello SSH для взаимодействия.
* Hello локальном брандмауэре hello целевой виртуальной машине имеет правила, которые препятствуют входящего и исходящего трафика SSH.
* Обнаружение вторжений или сетевого мониторинга программного обеспечения, запущенного на виртуальной машине Azure hello препятствует соединений по протоколу SSH.

## <a name="additional-resources"></a>Дополнительные ресурсы
Дополнительные сведения об устранении неполадок доступа к приложениям см. в разделе [устранить неполадки доступа tooan приложение, работающее на виртуальной машине Azure](troubleshoot-app-connection.md)
