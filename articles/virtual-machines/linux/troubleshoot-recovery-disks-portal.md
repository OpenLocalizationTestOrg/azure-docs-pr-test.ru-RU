---
title: "aaaUse a Linux, устранение неполадок виртуальной Машины в hello портал Azure | Документы Microsoft"
description: "Узнайте, как tootroubleshoot проблемы виртуальных машин Linux по связи hello ОС диска tooa восстановления виртуальной Машины с помощью hello портал Azure"
services: virtual-machines-linux
documentationCenter: 
authors: iainfoulds
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 11/14/2016
ms.author: iainfou
ms.openlocfilehash: 794daa06d7436215af84a61ab9088524254c47df
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshoot-a-linux-vm-by-attaching-hello-os-disk-tooa-recovery-vm-using-hello-azure-portal"></a>Устранение неполадок виртуальной Машины Linux путем присоединения восстановление tooa диска hello ОС виртуальной Машины с помощью hello портал Azure
Если Linux виртуальной машины (VM), возникает ошибка загрузки или диск, может потребоваться tooperform действия на виртуальном жестком диске hello сам по устранению неполадок. Распространенным примером будет недопустимую запись в `/etc/fstab` , предотвращает hello виртуальной Машины может tooboot успешно. Этой статьи описаны как toouse hello Azure портала tooconnect вашего виртуального жесткого диска tooanother toofix ВМ Linux все ошибки, а затем повторного создания исходной виртуальной Машины.

## <a name="recovery-process-overview"></a>Обзор процесса восстановления
Поиск и устранение неполадок Hello выглядит следующим образом:

1. Удалите hello ВМ возникновения проблемы, поддержание hello виртуальных жестких дисков.
2. Присоедините и подключите tooanother hello виртуальный жесткий диск виртуальной Машины с Linux для устранения неполадок.
3. Подключите toohello Устранение неполадок виртуальной Машины. Изменение файлов или выполните любые средства toofix проблемы на hello исходный виртуальный жесткий диск.
4. Отключите образ и отсоединить виртуальный жесткий диск hello из hello, устранение неполадок виртуальной Машины.
5. Создайте виртуальную Машину с помощью hello исходный виртуальный жесткий диск.


## <a name="determine-boot-issues"></a>Выявление проблем при загрузке
Изучите Диагностика загрузки hello и почему ВМ не могут tooboot правильно toodetermine экрана виртуальной Машины. Например, причиной может быть неправильная запись в `/etc/fstab`, удаление или перемещение базового виртуального жесткого диска.

Выбрать ВМ на портале hello и прокрутите вниз toohello **поддержки + Устранение неполадок** раздела. Нажмите кнопку **загрузки диагностики** сообщения консоли hello tooview потоковой передачи из виртуальной Машины. Журналы событий консоли hello проверки toosee Если можно определить, почему hello ВМ возникают проблемы. Hello следующем примере показано, что виртуальная машина находится в режиме обслуживания, которое должно выполняться вручную.

![Просмотр журналов консоли для диагностики загрузки виртуальной машины](./media/troubleshoot-recovery-disks-portal/boot-diagnostics-error.png)

Можно также щелкнуть **экрана** сверху hello hello загрузки диагностики журнала toodownload захвата снимка экрана приветствия виртуальной Машины.


## <a name="view-existing-virtual-hard-disk-details"></a>Просмотр сведений для существующего виртуального жесткого диска
Перед тем как присоединить tooanother вашего виртуального жесткого диска виртуальной Машины, необходимо имя hello tooidentify hello виртуального жесткого диска (VHD). 

Выберите группу ресурсов с портала hello, а затем выберите учетную запись хранилища. Нажмите кнопку **большие двоичные объекты**, как показано в следующий пример hello:

![Выбор больших двоичных объектов для хранения](./media/troubleshoot-recovery-disks-portal/storage-account-overview.png)

Обычно виртуальные жесткие диски хранятся в отдельном контейнере с именем **vhds**. Выберите контейнер hello tooview список виртуальных жестких дисков. Примечание hello имя вашего виртуального жесткого диска (префикс hello обычно — имя hello ВМ):

![Поиск виртуального жесткого диска в контейнере хранилища](./media/troubleshoot-recovery-disks-portal/storage-container.png)

Выберите существующий виртуальный жесткий диск из списка hello и скопируйте hello URL-адрес для использования в hello следующие шаги:

![Копирование URL-адреса существующего виртуального жесткого диска](./media/troubleshoot-recovery-disks-portal/copy-vhd-url.png)


## <a name="delete-existing-vm"></a>Удаление существующей виртуальной машины
Виртуальные жесткие диски и виртуальные машины — это разные ресурсы в Azure. Виртуальный жесткий диск является местом hello операционной системы, приложения и конфигурации. Hello самой ВМ — точно так же метаданные, которые определяет hello размер или расположение и ссылки на ресурсы, такие как виртуальный жесткий диск или виртуальный сетевой адаптер (NIC). Каждый виртуальный жесткий диск содержит аренды, назначенный при присоединении tooa виртуальной Машины. Несмотря на то, что диски с данными может быть присоединенные и отсоединенные даже в том случае, когда выполняется hello виртуальной Машины, диска ОС hello отключить невозможно, пока удаляется hello ресурса виртуальной Машины. Аренда Hello продолжается tooassociate hello ОС диска с виртуальной Машиной даже в том случае, если этой виртуальной Машины находится в состоянии остановки и освобождается.

Здравствуйте, первый шаг toorecover ВМ — toodelete hello ВМ сам ресурс. Удаление hello ВМ оставляет hello виртуальных жестких дисков в вашей учетной записи хранилища. После hello удаления виртуальной Машины присоединения hello виртуальный жесткий диск tooanother ВМ tootroubleshoot и устранение ошибок hello.

Выберите виртуальную Машину на портале hello, щелкните **удалить**:

![Снимок экрана диагностики загрузки виртуальной машины с сообщением об ошибке загрузки](./media/troubleshoot-recovery-disks-portal/stop-delete-vm.png)

Подождите, пока hello ВМ закончит удаление перед присоединением tooanother hello виртуальный жесткий диск виртуальной Машины. Аренда Hello hello виртуальный жесткий диск, который связывает его с hello виртуальной Машины должен toobe выпуска перед тем как присоединить tooanother hello виртуальный жесткий диск виртуальной Машины.


## <a name="attach-existing-virtual-hard-disk-tooanother-vm"></a>Подключить существующий виртуальный жесткий диск tooanother виртуальной Машины
Для Здравствуйте рядом шагах, для устранения неполадок используется другой виртуальной Машиной. Подключить существующий виртуальный жесткий диск toothis hello Устранение неполадок может toobrowse toobe ВМ и изменить содержимое диска hello. Этот процесс позволяет toocorrect все ошибки конфигурации или Просмотр дополнительных приложений или файлы журналов, например системы. Выберите или создайте другой toouse виртуальной Машины для устранения неполадок.

1. Выберите группу ресурсов с портала hello, а затем выберите виртуальную Машину по устранению неполадок. Выберите **Диски** и нажмите кнопку **Подключить существующий**.

    ![Подключить существующий диск в портале hello](./media/troubleshoot-recovery-disks-portal/attach-existing-disk.png)

2. tooselect существующего виртуального жесткого диска, нажмите кнопку **VHD-файл**:

    ![Поиск существующего виртуального жесткого диска](./media/troubleshoot-recovery-disks-portal/select-vhd-location.png)

3. Выберите учетную запись хранения и контейнер, затем щелкните существующий виртуальный жесткий диск. Нажмите кнопку hello **выберите** кнопку tooconfirm Выбор:

    ![Выбор существующего виртуального жесткого диска](./media/troubleshoot-recovery-disks-portal/select-vhd.png)

4. С вашей VHD выбранное сейчас, нажмите кнопку **ОК** tooattach hello существующего виртуального жесткого диска:

    ![Подтверждение присоединения существующего виртуального жесткого диска](./media/troubleshoot-recovery-disks-portal/attach-disk-confirm.png)

5. Через несколько секунд hello **дисков** ваш существующий виртуальный жесткий диск, подключенный как диск данных перечислены области для вашей виртуальной Машины:

    ![Существующий виртуальный жесткий диск присоединен как диск данных](./media/troubleshoot-recovery-disks-portal/attached-disk.png)


## <a name="mount-hello-attached-data-disk"></a>Подключить hello подключенный диск данных

> [!NOTE]
> Hello следующих примерах приведены шаги на Виртуальной машине Ubuntu hello. Если вы используете другой дистрибутив Linux, например Red Hat Enterprise Linux или SUSE, hello расположения файлов журнала и `mount` команд может немного отличаться. См. в документации toohello для вашего конкретного дистрибутив для hello соответствующие изменения в командах.

1. Устранение неполадок виртуальной Машины, используя соответствующие учетные данные hello tooyour SSH. Если этот диск является tooyour данных диске, подключенном hello для первого Устранение неполадок виртуальной Машины, оно скорее всего подключено слишком`/dev/sdc`. Используйте `dmseg` toolist присоединенных дисков:

    ```bash
    dmesg | grep SCSI
    ```
    Hello вывода будет примерно toohello следующий пример:

    ```bash
    [    0.294784] SCSI subsystem initialized
    [    0.573458] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252)
    [    7.110271] sd 2:0:0:0: [sda] Attached SCSI disk
    [    8.079653] sd 3:0:1:0: [sdb] Attached SCSI disk
    [ 1828.162306] sd 5:0:0:0: [sdc] Attached SCSI disk
    ```

    В предыдущих пример hello, диск hello ОС находится на `/dev/sda` и hello временного диска, указанное для каждой виртуальной Машины в `/dev/sdb`. Если у вас несколько дисков данных, они будут присоединены как `/dev/sdd`, `/dev/sde` и т. д.

2. Создайте directory toomount существующий виртуальный жесткий диск. Hello следующий пример создает каталог с именем `troubleshootingdisk`:

    ```bash
    sudo mkdir /mnt/troubleshootingdisk
    ```

3. При наличии нескольких секций на существующий виртуальный жесткий диск, подключите hello необходимые секции. Hello следующий пример подключает первому основному разделу hello в `/dev/sdc1`:

    ```bash
    sudo mount /dev/sdc1 /mnt/troubleshootingdisk
    ```

    > [!NOTE]
    > Лучший способ — что toomount диски с данными на виртуальных машинах в Azure с помощью hello универсальный уникальный идентификатор UUID hello виртуального жесткого диска. В этом сценарии короткий по устранению неполадок монтажного hello виртуального жесткого диска с помощью hello UUID не требуется. Тем не менее, при обычных условиях использования редактирования `/etc/fstab` toomount виртуальных жестких дисков с помощью имени, а не может вызвать UUID hello tooboot toofail виртуальной Машины.


## <a name="fix-issues-on-original-virtual-hard-disk"></a>Устранение неполадок на исходном виртуальном жестком диске
С hello существующий виртуальный жесткий диск подключен теперь можно выполнять обслуживание и действия по устранению неполадок при необходимости. После разрешения проблемы hello продолжите hello следующие шаги.

## <a name="unmount-and-detach-original-virtual-hard-disk"></a>Отключение и отсоединение исходного виртуального жесткого диска
После разрешения ошибки, отсоедините hello существующий виртуальный жесткий диск из виртуальной Машины по устранению неполадок. Расположение виртуального жесткого диска нельзя использовать с любой другой ВМ до освобождения аренды hello присоединение toohello hello виртуального жесткого диска, устранение неполадок виртуальной Машины.

1. Из сеанса SSH hello tooyour Устранение неполадок виртуальной Машины отключите hello существующий виртуальный жесткий диск. Сначала измените вне hello родительский каталог для точки подключения:

    ```bash
    cd /
    ```

    Теперь отключите hello существующий виртуальный жесткий диск. Hello следующий пример отсоединяет диск hello устройство с `/dev/sdc1`:

    ```bash
    sudo umount /dev/sdc1
    ```

2. Теперь отсоедините hello виртуальный жесткий диск из виртуальной Машины hello. Выберите виртуальную Машину на портале hello и нажмите кнопку **дисков**. Выберите существующий виртуальный жесткий диск и щелкните **Отсоединить**.

    ![Отсоединение существующего виртуального жесткого диска](./media/troubleshoot-recovery-disks-portal/detach-disk.png)

    Подождите, пока hello виртуальной Машины успешно отсоединена hello диск данных перед продолжением.

## <a name="create-vm-from-original-hard-disk"></a>Создание виртуальной машины из исходного жесткого диска
использовать ВМ с исходного виртуального жесткого диска, toocreate [этого шаблона Azure Resource Manager](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-specialized-vhd-existing-vnet). шаблон Hello развертывания ВМ в существующей виртуальной сети, с помощью hello URL-адрес VHD из hello ранее команд. Нажмите кнопку hello **развертывание tooAzure** кнопку следующим образом:

![Развертывание виртуальной машины из шаблона GitHub](./media/troubleshoot-recovery-disks-portal/deploy-template-from-github.png)

шаблон Hello загружается hello портала Azure для развертывания. Введите имена hello для новой виртуальной Машины и существующие ресурсы Azure и вставьте hello URL-адрес tooyour существующий виртуальный жесткий диск. Развертывание toobegin hello, нажмите кнопку **покупки**:

![Развертывание виртуальной машины на основе шаблона](./media/troubleshoot-recovery-disks-portal/deploy-from-image.png)


## <a name="re-enable-boot-diagnostics"></a>Восстановление диагностики загрузки
При создании ВМ из hello существующий виртуальный жесткий диск, диагностика загрузки может не быть доступной. toocheck hello состояние Диагностика загрузки и включите при необходимости выбрать ВМ на портале hello. В разделе **Мониторинг** щелкните **Параметры диагностики**. Убедитесь, находится в состоянии hello **на**, и hello флажок рядом слишком**загрузки диагностики** выбран. Если вы внесете здесь изменения, нажмите кнопку **Сохранить**.

![Обновление параметров диагностики загрузки](./media/troubleshoot-recovery-disks-portal/reenable-boot-diagnostics.png)

## <a name="next-steps"></a>Дальнейшие действия
Если возникают проблемы с подключением tooyour виртуальной Машины, см. раздел [Устранение SSH подключений tooan виртуальной Машины Azure](troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Для решения проблем с доступом к приложениям, выполняющимся на виртуальной машине, см. статью [Устранение проблем с подключением к приложениям на виртуальных машинах Linux в Azure](../windows/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

Дополнительные сведения об использовании Resource Manager вы найдете в статье [Общие сведения об Azure Resource Manager](../../azure-resource-manager/resource-group-overview.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).
