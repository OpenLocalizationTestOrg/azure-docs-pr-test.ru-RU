---
title: "Архивация виртуальных машин Linux в Azure | Документы Майкрософт"
description: "Защита виртуальных машин Linux путем их архивации с помощью службы архивации Azure."
services: virtual-machines-linux
documentationcenter: virtual-machines
author: cynthn
manager: timlt
editor: tysonn
tags: azure-resource-manager
ms.assetid: 
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 07/27/2017
ms.author: cynthn
ms.custom: mvc
ms.openlocfilehash: 7c00392d5185a2f067f2ee2717529dcbde1e71f5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="back-up-linux--virtual-machines-in-azure"></a>Архивация виртуальных машин Linux в Azure

Защиту данных можно обеспечить, выполняя архивацию через регулярные интервалы. Служба архивации Azure создает точки восстановления, которые хранятся в геоизбыточных хранилищах восстановления. При восстановлении из точки восстановления можно восстановить hello всей виртуальной Машины или лишь некоторые файлы. В этой статье объясняется, как toorestore один файл tooa nginx работающей виртуальной Машины с Linux. Если у вас еще нет toouse виртуальной Машины, можно создать один с помощью hello [краткое руководство Linux](quick-create-cli.md). Из этого руководства вы узнаете, как выполнить следующие задачи:

> [!div class="checklist"]
> * Создание архива виртуальной машины
> * Планирование ежедневной архивации
> * Восстановление файла из архива



## <a name="backup-overview"></a>Обзор службы архивации

Когда служба резервного копирования Azure hello инициирует резервной копии, оно активирует tootake hello расширение резервного копирования моментального снимка в определенный момент. Hello службы архивации Azure использует hello _VMSnapshotLinux_ расширения в Linux. расширение Hello устанавливается во время hello первая резервная копия виртуальной Машины, если hello виртуальная машина работает под управлением. Если hello Виртуальная машина не запущена, hello службы резервного копирования снимок hello базовое хранилище (так как не записывайте возникать при hello остановки виртуальной Машины).

По умолчанию резервного копирования Azure принимает согласованное резервная копия файловой системы для виртуальной Машины Linux, но может быть настроенный tootake [согласованное резервное копирование приложений с помощью платформы сценариев до и после](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent). Hello службы архивации Azure делает снимок hello, hello данных после переносятся toohello хранилища. эффективность toomaximize hello служба определяет и передает только hello блоков данных, которые были изменены с момента предыдущего резервного копирования hello.

После завершения передачи данных hello hello снимок удаляется и создается точка восстановления.


## <a name="create-a-backup"></a>Создание резервной копии
Создание простого запланированного ежедневного резервного копирования tooa хранилище служб восстановления. 

1. Войдите в toohello [портал Azure](https://portal.azure.com/).
2. Выберите в меню hello слева hello, **виртуальные машины**. 
3. Выберите из списка hello tooback ВМ вверх.
4. В колонке виртуальной Машины hello в hello **параметры** щелкните **резервного копирования**. Hello **Enable backup** открывает колонку.
5. В **хранилище служб восстановления**, нажмите кнопку **создать новый** и укажите имя hello для нового хранилища hello. Новое хранилище создается в hello же группу ресурсов и расположение, как виртуальная машина hello.
6. Щелкните **Политика архивации**. В этом примере оставьте значения по умолчанию hello и нажмите кнопку **ОК**.
7. На hello **Enable backup** колонка, щелкните **включить архивацию**. Это создает ежедневного резервного копирования на основе расписания по умолчанию hello.
10. toocreate начальной точки восстановления, на hello **резервного копирования** колонки щелкните **Архивировать сейчас**.
11. На hello **создать резервную копию** колонка, щелкните значок календаря hello, используйте hello календаря управления tooselect hello этой точки восстановления сохраняется и щелкните последний день **резервного копирования**.
12. В hello **резервного копирования** колонке ВМ, вы увидите hello количество точек восстановления, которые являются полными.

    ![Точки восстановления](./media/tutorial-backup-vms/backup-complete.png)

Первая резервная копия Hello занимает примерно 20 минут. Продолжить toohello следующей части этого руководства, после завершения резервного копирования.

## <a name="restore-a-file"></a>Восстановление файла

Случайно удалить или сделать файл tooa изменения, можно использовать файл hello toorecover восстановление файлов из резервного хранилища. Восстановление файлов использует сценарий, который выполняется на ВМ, hello точки восстановления hello toomount как локальный диск. Эти диски останется подключенного 12 часов, можно скопировать файлы из точки восстановления hello и восстановить их toohello виртуальной Машины.  

В этом примере показано, как toorecover hello /var/www/html/index.nginx-debian.html веб-страницы по умолчанию nginx. общедоступный IP-адрес Hello нашей виртуальной машины в этом примере — *13.69.75.209*. Можно найти hello IP-адрес виртуальной машины с помощью:

 ```bash 
 az vm show --resource-group myResourceGroup --name myVM -d --query [publicIps] --o tsv
 ```

 
1. На локальном компьютере откройте браузер и введите в hello общедоступный IP-адрес веб-страницы nginx ВМ toosee hello по умолчанию.

    ![Веб-страница nginx по умолчанию](./media/tutorial-backup-vms/nginx-working.png)

1. Подключитесь к виртуальной машине по протоколу SSH.

    ```bash
    ssh 13.69.75.209
    ```
2. Удалите /var/www/html/index.nginx-debian.html.

    ```bash
    sudo rm /var/www/html/index.nginx-debian.html
    ```
    
4. На локальном компьютере, обновите браузер hello, нажав сочетание клавиш CTRL + F5 toosee, nginx страница по умолчанию отсутствует.

    ![Веб-страница nginx по умолчанию](./media/tutorial-backup-vms/nginx-broken.png)
    
1. На локальном компьютере, войдите в toohello [портал Azure](https://portal.azure.com/).
6. Выберите в меню hello слева hello, **виртуальные машины**. 
7. Выберите из списка hello hello виртуальной Машины.
8. В колонке виртуальной Машины hello в hello **параметры** щелкните **резервного копирования**. Hello **резервного копирования** открывает колонку. 
9. Выберите в меню hello hello верхней части колонки hello, **восстановления файла**. Hello **восстановления файла** открывает колонку.
10. В **шаг 1: выберите точку восстановления**, выберите точку восстановления из раскрывающегося списка hello.
11. В **шаг 2: загрузить скрипт toobrowse и восстанавливать файлы**, щелкните hello **загрузки исполняемого файла** кнопки. Сохраните hello загруженный файл tooyour локального компьютера.
7. Нажмите кнопку **загрузки скрипта** файл скрипта hello toodownload локально.
8. Откройте Bash строку и введите hello следующие, заменив *Linux_myVM_05-05-2017.sh* с hello Исправьте путь и имя файла для hello скрипт, который вы загрузили *azureuser* с именем пользователя hello для hello виртуальной Машины и *13.69.75.209* с hello общедоступный IP-адрес для виртуальной Машины.
    
    ```bash
    scp Linux_myVM_05-05-2017.sh azureuser@13.69.75.209:
    ```
    
9. На локальном компьютере откройте toohello подключения SSH виртуальной Машины.

    ```bash
    ssh 13.69.75.209
    ```
    
10. На ВМ, добавьте выполнить файл сценария toohello разрешения.

    ```bash
    chmod +x Linux_myVM_05-05-2017.sh
    ```
    
11. На ВМ запустите точки восстановления hello toomount сценария hello как файловая система.

    ```bash
    ./Linux_myVM_05-05-2017.sh
    ```
    
12. Hello выходных данных из hello скрипт предоставляет hello путь для точки подключения hello. Hello выходные данные выглядят аналогично toothis:

    ```bash
    Microsoft Azure VM Backup - File Recovery
    ______________________________________________
                          
    Connecting toorecovery point using ISCSI service...
    
    Connection succeeded!
    
    Please wait while we attach volumes of hello recovery point toothis machine...
                         
    ************ Volumes of hello recovery point and their mount paths on this machine ************

    Sr.No.  |  Disk  |  Volume  |  MountPath 

    1)  | /dev/sdc  |  /dev/sdc1  |  /home/azureuser/myVM-20170505191055/Volume1

    ************ Open File Explorer toobrowse for files. ************

    After recovery, tooremove hello disks and close hello connection toohello recovery point, please click 'Unmount Disks' in step 3 of hello portal.

    Please enter 'q/Q' tooexit...
    ```

12. На ВМ, скопируйте hello nginx по умолчанию веб-страницы из toowhere назад точки подключения hello удален файл hello.

    ```bash
    sudo cp ~/myVM-20170505191055/Volume1/var/www/html/index.nginx-debian.html /var/www/html/
    ```
    
17. На локальном компьютере, откройте вкладку браузера hello, где вы подключены toohello IP-адрес по умолчанию hello ВМ показывающий hello nginx страницу. Нажмите клавиши CTRL + F5 страницы браузера toorefresh hello. Теперь вы увидите, hello снова работает страница по умолчанию.

    ![Веб-страница nginx по умолчанию](./media/tutorial-backup-vms/nginx-working.png)

18. На локальном компьютере, вернитесь к предыдущему окну toohello вкладка «браузер» для hello портал Azure и в **Step 3: отключить диски hello после восстановления** щелкните hello **отключить диски** кнопки. Если этот этап будет пропущен toodo, автоматически закрыть монтирования toohello hello подключения через 12 часов. После этих 12 часов необходимо toodownload новый toocreate сценария новая точка монтирования.


## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Создание архива виртуальной машины
> * Планирование ежедневной архивации
> * Восстановление файла из архива

Переместить следующий учебник toolearn toohello о мониторинге виртуальных машин.

> [!div class="nextstepaction"]
> [Мониторинг виртуальных машин](tutorial-monitoring.md)

