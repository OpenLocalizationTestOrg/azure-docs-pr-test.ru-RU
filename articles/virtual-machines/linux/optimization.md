---
title: "aaaOptimize ВМ Linux в Azure | Документы Microsoft"
description: "Узнать некоторые toomake советы по оптимизации, убедиться, что вы настроили ВМ Linux для обеспечения оптимальной производительности в Azure"
keywords: "виртуальная машина linux,linux виртуальная машина,виртуальная машина ubuntu"
services: virtual-machines-linux
documentationcenter: 
author: rickstercdn
manager: timlt
editor: tysonn
tags: azure-resource-manager
ms.assetid: 8baa30c8-d40e-41ac-93d0-74e96fe18d4c
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 09/06/2016
ms.author: rclaus
ms.openlocfilehash: 89a9ac022928a2801a9a15e1c172340352745354
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-your-linux-vm-on-azure"></a>Оптимизация виртуальной машины Linux в Azure
Создание виртуальной машины (VM) Linux — легко toodo с hello командной строки или из портала hello. Этот учебник показывает, как tooensure настройки он toooptimize его производительность на платформе Microsoft Azure hello. В этой статье описывается виртуальная машина Ubuntu Server, но вы можете также создавать виртуальные машины Linux, используя [собственные образы в качестве шаблонов](create-upload-generic.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).  

## <a name="prerequisites"></a>Предварительные требования
В этой статье предполагается, что у вас уже есть действующая подписка Azure ([бесплатная пробная подписка](https://azure.microsoft.com/pricing/free-trial/)), в которой подготовлена виртуальная машина. Убедитесь, что hello последней [Azure CLI 2.0](/cli/azure/install-az-cli2) установлен и вход tooyour подписки Azure с [входа az](/cli/azure/#login) перед [создания виртуальной Машины](quick-create-cli.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

## <a name="azure-os-disk"></a>Диск ОС в Azure
У созданной в Azure виртуальной машины Linux будет два диска: **/dev/sda** (диск операционной системы) и **/dev/sdb** (временный диск).  Не используйте основной диск ОС hello (**/dev/sda**) для любого элемента, за исключением hello операционной системы, как она оптимизирована для быстрое время запуска виртуальной Машины и не предоставляет высокую производительность для рабочих нагрузок. Нужно tooattach один или несколько дисков tooyour ВМ tooget постоянный и оптимизированного хранилища данных. 

## <a name="adding-disks-for-size-and-performance-targets"></a>Добавление дисков для увеличения размера и производительности
На основании hello размер виртуальной Машины, можно присоединить дополнительные диски too16 на серии A, 32 дисков на серии D и 64 дисков на компьютере серии G - каждой копии too1 ТБ. Дополнительные диски добавляются по мере необходимости в зависимости от требований к пространству и количеству операций ввода-вывода. Каждый диск имеет целевой показатель производительности 500 операций ввода-вывода для стандартного хранилища или более поздней too5000 IOP для дисков для хранения Premium.  Дополнительные сведения о дисках хранилища класса Premium см. в статье [Высокопроизводительное хранилище класса Premium, а также неуправляемые и управляемые диски виртуальной машины Azure](../../storage/common/storage-premium-storage.md).

tooachieve hello наибольший операций ввода-вывода на дисках хранилища Premium, где их кэша параметры были заданы tooeither **ReadOnly** или **нет**, необходимо отключить **барьеры** во время подключение hello файловой системы в Linux. Барьеры не обязательно, поскольку hello записывает tooPremium хранилища резервных дисков являются устойчивыми для этих параметров кэша.

* Если вы используете **reiserFS**, с помощью параметра подключения hello барьеры disable `barrier=none` (для включения защиты, используйте `barrier=flush`)
* Если вы используете **ext3/ext4**, с помощью параметра подключения hello барьеры disable `barrier=0` (для включения защиты, используйте `barrier=1`)
* Если вы используете **XFS**, с помощью параметра подключения hello барьеры disable `nobarrier` (для включения защиты, используйте параметр hello `barrier`)

## <a name="unmanaged-storage-account-considerations"></a>Рекомендации по неуправляемой учетной записи хранения
Действие по умолчанию Hello при создании виртуальной Машины с hello Azure CLI 2.0 — дисков управляемых toouse Azure.  Эти диски обрабатываются hello платформы Azure и не требуют toostore любые предварительные и место их.  Для неуправляемых дисков, требующих учетную запись хранения, имеются некоторые дополнительные рекомендации по производительности.  Дополнительные сведения об управляемых дисках Azure см. в [этой статье](../windows/managed-disks-overview.md).  Hello следующем разделе описывается вопросы производительности только при использовании неуправляемого дисков.  Здравствуйте, еще раз, по умолчанию и рекомендуемый хранилища решение toouse управляемых дисков.

При создании виртуальной Машины с неуправляемой дисков убедитесь, что присоединение дисков из учетных записей хранения, находящиеся в hello же регионе, что вашей виртуальной Машины tooensure близко и минимальная задержка в сети.  Для каждой учетной записи хранилища класса "Стандартный" предусмотрено максимум 20 тысяч операций ввода-вывода и размер до 500 ТБ.  Это ограничение происходит tooapproximately 40 интенсивно используется дисками, включая диск hello ОС и диски с данными, которые вы создаете. Для учетных записей хранилища класса Premium нет ограничения на количество операций ввода-вывода, но существует ограничение на размер — 32 ТБ. 

При работе с высокой рабочей нагрузки операций ввода-вывода и выбрали стандартное хранилище для дисков, через несколько toomake учетных записей хранилища, убедиться, что вы не ограничены hello ограничить 20 000 операций ввода-вывода для учетных записей стандартного хранилища может потребоваться toosplit hello дисков. ВМ может содержать сочетание дисков из разных учетных записей хранения и tooachieve типы учетной записи хранилища оптимальной конфигурации.
 

## <a name="your-vm-temporary-drive"></a>Временный диск на виртуальной машине
По умолчанию при создании виртуальной машины в Azure предоставляется диск операционной системы (**/dev/sda**) и временный диск (**/dev/sdb**).  При добавлении дополнительных дисков они отображаются как **/dev/sdc**, **/dev/sdd**, **/dev/sde** и т. д. Все данные на временном диске (**/dev/sdb**) недолговечны и могут быть утеряны, если виртуальная машина будет перезапущена из-за определенных событий, таких как изменение размера, повторное развертывание или обслуживание виртуальной машины.  Hello размер и тип временного диска — связанные toohello размер виртуальной Машины, выбранный во время развертывания. Все hello premium размер виртуальных машин (серии DS, G и DS_V2) hello временного диска, поддерживаемых локальный SSD для дополнительной работы вверх too48k операций ввода-вывода. 

## <a name="linux-swap-file"></a>Файл подкачки Linux
Если из Ubuntu или CoreOS образа ВМ Azure, можно использовать toosend CustomData облачной конфигурации toocloud-init. Если вы [передали пользовательский образ Linux](upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json), использующий cloud-init, разделы подкачки также нужно настраивать с помощью cloud-init.

На изображениях Ubuntu облака необходимо использовать init облака tooconfigure hello переключения секций. Дополнительные сведения см. в статье [AzureSwapPartitions](https://wiki.ubuntu.com/AzureSwapPartitions).

Для образов без поддержки облачных init образов виртуальных Машин, развернутых из hello Azure Marketplace иметь интегрирован с hello ОС Linux агента виртуальной Машины. Этот агент позволяет toointeract hello виртуальной Машины с различными службами Azure. При условии, что вы развернули стандартный образ из hello Azure Marketplace, потребуется toodo hello toocorrectly после настройки параметров файла подкачки Linux:

Найти и изменить две записи в hello **/etc/waagent.conf** файла. Они управляют hello существования файл выделенной виртуальной памяти и размер файла подкачки hello. Параметры Hello нужного toomodify `ResourceDisk.EnableSwap=N` и`ResourceDisk.SwapSizeMB=0` 

Изменить параметры toohello hello, следующие параметры:

* ResourceDisk.EnableSwap=Y
* ResourceDisk.SwapSizeMB={size в toomeet МБ потребностями} 

После внесения изменения hello необходима toorestart hello waagent или перезапустите вашей виртуальной Машине Linux tooreflect эти изменения.  Вы знаете реализованы hello изменения и создания файла подкачки при использовании hello `free` команды tooview свободного места. Hello следующий пример содержит файл подкачки 512 МБ, созданных в результате изменения hello **waagent.conf** файла:

```bash
azuseruser@myVM:~$ free
            total       used       free     shared    buffers     cached
Mem:       3525156     804168    2720988        408       8428     633192
-/+ buffers/cache:     162548    3362608
Swap:       524284          0     524284
```

## <a name="io-scheduling-algorithm-for-premium-storage"></a>Алгоритм планирования операций ввода-вывода для хранилища класса Premium
С hello 2.6.18 ядра Linux Алгоритм планирования операций ввода-вывода по умолчанию hello был изменен с tooCFQ крайнего срока (полностью удовлетворительные алгоритм очередей). Если речь идет о моделях операций ввода-вывода с произвольным доступом, между алгоритмами CFQ и Deadline существуют минимальные различия в производительности.  Для дисков на основе SSD, где преимущественно hello дискового ввода-вывода шаблон последовательного переключение обратно toohello NOOP или крайний срок алгоритм можно добиться повышения производительности операций ввода-вывода.

### <a name="view-hello-current-io-scheduler"></a>Представление hello текущего планировщика ввода-вывода
Hello используйте следующую команду:  

```bash
cat /sys/block/sda/queue/scheduler
```

Вы увидите следующие выходных данных, который указывает hello текущего планировщика.  

```bash
noop [deadline] cfq
```

### <a name="change-hello-current-device-devsda-of-io-scheduling-algorithm"></a>Изменение текущего устройства hello (/ dev/sda) Алгоритм планирования операций ввода-вывода
Используйте hello, следующие команды:  

```bash
azureuser@myVM:~$ sudo su -
root@myVM:~# echo "noop" >/sys/block/sda/queue/scheduler
root@myVM:~# sed -i 's/GRUB_CMDLINE_LINUX=""/GRUB_CMDLINE_LINUX_DEFAULT="quiet splash elevator=noop"/g' /etc/default/grub
root@myVM:~# update-grub
```

> [!NOTE]
> Применять алгоритм только для устройства **/dev/sda** бесполезно. Установить на все диски с данными, где последовательных операций ввода-вывода превосходит hello шаблон ввода-вывода.  

Вы увидите hello следующие выходные данные, означает, что **grub.cfg** успешно перестроен и этот планировщик по умолчанию hello был обновленные tooNOOP.  

```bash
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.13.0-34-generic
Found initrd image: /boot/initrd.img-3.13.0-34-generic
Found linux image: /boot/vmlinuz-3.13.0-32-generic
Found initrd image: /boot/initrd.img-3.13.0-32-generic
Found memtest86+ image: /memtest86+.elf
Found memtest86+ image: /memtest86+.bin
done
```

Для hello семейства Redhat распространения требуется только hello следующую команду:   

```bash
echo 'echo noop >/sys/block/sda/queue/scheduler' >> /etc/rc.local
```

## <a name="using-software-raid-tooachieve-higher-iops"></a>С помощью программного обеспечения RAID tooachieve выше я / Ops
Если рабочих нагрузок требуются дополнительные операции ввода-вывода, чем может предоставить один диск, сначала необходимо toouse конфигурации программного обеспечения RAID несколько дисков. Так как Azure уже выполняет диска устойчивости на уровне структуры локального hello, вы достичь hello высокий уровень производительности из конфигурации чередование RAID-0.  Подготовить создавать диски в среде Azure hello и присоединение tooyour виртуальных Машин Linux, перед секционирование, форматирование и затем подключить hello дисков.  Дополнительные сведения о настройке Настройка программного RAID на ВМ Linux в azure можно найти в hello  **[Настройка программного RAID на платформе Linux](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**  документа.

## <a name="next-steps"></a>Дальнейшие действия
Помните, что все обсуждения оптимизации необходимо tooperform тесты до и после каждого изменения toomeasure hello влияние hello изменение содержит.  Оптимизация — это пошаговый процесс, и результаты его будут разными на различных компьютерах в одной и той же среде.  То, что эффективно для одной конфигурации, может не работать в другой.

Некоторые полезные ссылки tooadditional ресурсы: 

* [Хранилище Premium: высокопроизводительное хранилище для рабочих нагрузок виртуальной машины Azure](../../storage/common/storage-premium-storage.md)
* [Руководство пользователя агента Linux для Azure](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [Оптимизация производительности MySQL в виртуальных машинах Azure Linux](classic/optimize-mysql.md?toc=%2fazure%2fvirtual-machines%2flinux%2fclassic%2ftoc.json)
* [Настройка программного RAID-массива в Linux](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

