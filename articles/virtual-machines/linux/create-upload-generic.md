---
title: "aaaCreate и передача виртуального жесткого диска Linux в Azure"
description: "Узнайте toocreate и отправить в Azure виртуального жесткого диска (VHD), содержащий операционную систему Linux."
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: 208e15c035edb5520fc29ba8e4e71c42b041864d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="b1c56-103">Информация о нерекомендованных дистрибутивах</span><span class="sxs-lookup"><span data-stu-id="b1c56-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="b1c56-104">Hello платформы Azure соглашения об уровне ОБСЛУЖИВАНИЯ применяется toovirtual компьютеров под управлением ОС Linux только в том случае, когда один hello объекта hello [одобренных распределения](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) используется.</span><span class="sxs-lookup"><span data-stu-id="b1c56-104">hello Azure platform SLA applies toovirtual machines running hello Linux OS only when one of hello [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="b1c56-105">Все дистрибутивы Linux, которые предоставляются в hello Azure являются коллекции образов, одобренных распределения с требуемой конфигурацией hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-105">All Linux distributions that are provided in hello Azure image gallery are endorsed distributions with hello required configuration.</span></span>

* [<span data-ttu-id="b1c56-106">Linux в Azure — рекомендованные дистрибутивы</span><span class="sxs-lookup"><span data-stu-id="b1c56-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="b1c56-107">Поддержка образов Linux в Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="b1c56-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="b1c56-108">Все распределения, работающих в Azure, потребуется toomeet количество необходимых компонентов toohave tooproperly вероятность того, работает на платформе hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-108">All distributions running on Azure will need toomeet a number of prerequisites toohave a chance tooproperly run on hello platform.</span></span>  <span data-ttu-id="b1c56-109">В этой статье далеко не является исчерпывающим, как у каждого распределения отличаются; и вполне возможно, что даже если выполнены все hello критериям по-прежнему нужно toosignificantly настроить вашей tooensure системы Linux, где он выполняется должным образом на платформе hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all hello criteria below you will still need toosignificantly tweak your Linux system tooensure that it properly runs on hello platform.</span></span>

<span data-ttu-id="b1c56-110">Именно по этой причине мы рекомендуем по возможности начать работу с одним из [рекомендованных дистрибутивов Linux в Azure](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) .</span><span class="sxs-lookup"><span data-stu-id="b1c56-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="b1c56-111">Hello ниже статьях поможет как tooprepare hello различных одобренных дистрибутивы Linux, которые поддерживаются в Azure:</span><span class="sxs-lookup"><span data-stu-id="b1c56-111">hello following articles will guide you through how tooprepare hello various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="b1c56-112">**[Дистрибутивы на основе CentOS](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b1c56-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b1c56-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b1c56-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b1c56-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b1c56-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b1c56-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b1c56-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b1c56-116">**[SLES и OpenSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b1c56-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="b1c56-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="b1c56-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="b1c56-118">Hello оставшейся части этой статьи будет использован Общие рекомендации по запуску дистрибутива Linux в Azure.</span><span class="sxs-lookup"><span data-stu-id="b1c56-118">hello rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="b1c56-119">Общие замечания по установке Linux</span><span class="sxs-lookup"><span data-stu-id="b1c56-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="b1c56-120">Hello формат VHDX не поддерживается только в Azure, **фиксированный VHD**.</span><span class="sxs-lookup"><span data-stu-id="b1c56-120">hello VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="b1c56-121">Можно преобразовать формат tooVHD hello диска, с помощью диспетчера Hyper-V или hello командлет convert-vhd.</span><span class="sxs-lookup"><span data-stu-id="b1c56-121">You can convert hello disk tooVHD format using Hyper-V Manager or hello convert-vhd cmdlet.</span></span> <span data-ttu-id="b1c56-122">Если вы используете VirtualBox этого нужно выбрать **фиксированный размер** в отличие от toohello по умолчанию динамически назначаемых при создании диска hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-122">If you are using VirtualBox this means selecting **Fixed size** as opposed toohello default dynamically allocated when creating hello disk.</span></span>
* <span data-ttu-id="b1c56-123">Azure поддерживает только виртуальные машины поколения 1.</span><span class="sxs-lookup"><span data-stu-id="b1c56-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="b1c56-124">Вы можете преобразовать поколение 1 виртуальная машина из формат файла виртуального жесткого диска toohello VHDX и динамически расширяемые tooa фиксированного размера диска.</span><span class="sxs-lookup"><span data-stu-id="b1c56-124">You can convert a generation 1 virtual machine from VHDX toohello VHD file format and from dynamically expanding tooa fixed sized disk.</span></span> <span data-ttu-id="b1c56-125">Но вы не можете изменить поколение виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="b1c56-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="b1c56-126">Дополнительные сведения см. в статье о том, [как выбрать поколение для виртуальной машины в Hyper-V](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v).</span><span class="sxs-lookup"><span data-stu-id="b1c56-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="b1c56-127">Максимальный размер Hello разрешена для hello виртуального жесткого диска — 1023 ГБ.</span><span class="sxs-lookup"><span data-stu-id="b1c56-127">hello maximum size allowed for hello VHD is 1,023 GB.</span></span>
* <span data-ttu-id="b1c56-128">При установке системы Linux hello *рекомендуется* использовать стандартные секции, а не LVM (часто hello по умолчанию для многих установок).</span><span class="sxs-lookup"><span data-stu-id="b1c56-128">When installing hello Linux system it is *recommended* that you use standard partitions rather than LVM (often hello default for many installations).</span></span> <span data-ttu-id="b1c56-129">Это позволит избежать конфликтов имен LVM с клонированные виртуальные машины, особенно в том случае, если диска ОС, когда-либо должен tooanother toobe присоединенного идентичные виртуальной Машины для устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="b1c56-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs toobe attached tooanother identical VM for troubleshooting.</span></span> <span data-ttu-id="b1c56-130">Для дисков данных можно использовать [LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) или [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="b1c56-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="b1c56-131">Требуется поддержка ядра для монтирования файловых систем UDF.</span><span class="sxs-lookup"><span data-stu-id="b1c56-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="b1c56-132">При первой загрузке в Azure hello настройке подготовки передается через формате UDF носителей, присоединенных toohello гостевой toohello виртуальной Машины с Linux.</span><span class="sxs-lookup"><span data-stu-id="b1c56-132">At first boot on Azure hello provisioning configuration is passed toohello Linux VM via UDF-formatted media that is attached toohello guest.</span></span> <span data-ttu-id="b1c56-133">агент Azure Linux Hello должно быть может toomount hello UDF файл системы tooread свою конфигурацию и подготовить hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="b1c56-133">hello Azure Linux agent must be able toomount hello UDF file system tooread its configuration and provision hello VM.</span></span>
* <span data-ttu-id="b1c56-134">Версии ядра Linux ниже 2.6.37 не поддерживают NUMA в Hyper-V с виртуальными машинами большего размера.</span><span class="sxs-lookup"><span data-stu-id="b1c56-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="b1c56-135">Эту проблему в основном влияет на старых распределения, с использованием hello вышестоящих ядра Red Hat 2.6.32 и была исправлена в RHEL 6.6 (ядра 2.6.32 504).</span><span class="sxs-lookup"><span data-stu-id="b1c56-135">This issue primarily impacts older distributions using hello upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="b1c56-136">Здравствуйте, систем под управлением старше 2.6.37 пользовательские ядер или на основе RHEL версии ядра более старые, чем 2.6.32-504 необходимо задать параметр загрузки `numa=off` командной строки в grub.conf ядра hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set hello boot parameter `numa=off` on hello kernel command-line in grub.conf.</span></span> <span data-ttu-id="b1c56-137">Дополнительные сведения см. в статье базы знаний Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span><span class="sxs-lookup"><span data-stu-id="b1c56-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="b1c56-138">Не настраивайте переключения секции на диске ОС hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-138">Do not configure a swap partition on hello OS disk.</span></span> <span data-ttu-id="b1c56-139">агент Linux Hello может быть настроенный toocreate файл подкачки на диске временного ресурса hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-139">hello Linux agent can be configured toocreate a swap file on hello temporary resource disk.</span></span>  <span data-ttu-id="b1c56-140">Дополнительные сведения об этом можно найти в hello описанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="b1c56-140">More information about this can be found in hello steps below.</span></span>
* <span data-ttu-id="b1c56-141">Все виртуальные жесткие диски hello должны иметь размеры, кратные 1 МБ.</span><span class="sxs-lookup"><span data-stu-id="b1c56-141">All of hello VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="b1c56-142">Установка модулей ядра без Hyper-V</span><span class="sxs-lookup"><span data-stu-id="b1c56-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="b1c56-143">Azure работает на hello низкоуровневая оболочка Hyper-V, поэтому Linux требует установку определенных модулей ядра в порядке toorun в Azure.</span><span class="sxs-lookup"><span data-stu-id="b1c56-143">Azure runs on hello Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order toorun in Azure.</span></span> <span data-ttu-id="b1c56-144">При наличии виртуальной Машины, в которой был создан за пределами Hyper-V hello Linux установщики могут не содержат hello драйверы для Hyper-V в начальной ramdisk hello (initrd или initramfs) если обнаружит, что он работает в среде Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="b1c56-144">If you have a VM that was created outside of Hyper-V, hello Linux installers may not include hello drivers for Hyper-V in hello initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="b1c56-145">При использовании образа Linux tooprepare различных виртуализации системы (т. е. Virtualbox, KVM, т. д.), может потребоваться toorebuild hello initrd tooensure, по крайней мере hello `hv_vmbus` и `hv_storvsc` на начальной ramdisk hello доступны модули ядра.</span><span class="sxs-lookup"><span data-stu-id="b1c56-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) tooprepare your Linux image, you may need toorebuild hello initrd tooensure that at least hello `hv_vmbus` and `hv_storvsc` kernel modules are available on hello initial ramdisk.</span></span>  <span data-ttu-id="b1c56-146">Это известная проблема по крайней мере в системах на базе hello вышестоящего Red Hat распространения.</span><span class="sxs-lookup"><span data-stu-id="b1c56-146">This is a known issue at least on systems based on hello upstream Red Hat distribution.</span></span>

<span data-ttu-id="b1c56-147">механизм Hello hello initrd или initramfs образа может зависеть от распространения hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-147">hello mechanism for rebuilding hello initrd or initramfs image may vary depending on hello distribution.</span></span> <span data-ttu-id="b1c56-148">Обратитесь к документации на распределение или поддержка hello соответствующие процедуры.</span><span class="sxs-lookup"><span data-stu-id="b1c56-148">Please consult your distribution's documentation or support for hello proper procedure.</span></span>  <span data-ttu-id="b1c56-149">Ниже приведен пример, как toorebuild hello initrd с помощью hello `mkinitrd` программы:</span><span class="sxs-lookup"><span data-stu-id="b1c56-149">Here is one example for how toorebuild hello initrd using hello `mkinitrd` utility:</span></span>

<span data-ttu-id="b1c56-150">Во-первых резервное копирование существующего образа initrd hello:</span><span class="sxs-lookup"><span data-stu-id="b1c56-150">First, back up hello existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="b1c56-151">Затем перестроить initrd hello с hello `hv_vmbus` и `hv_storvsc` модули ядра:</span><span class="sxs-lookup"><span data-stu-id="b1c56-151">Next, rebuild hello initrd with hello `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="b1c56-152">Изменение размера VHD</span><span class="sxs-lookup"><span data-stu-id="b1c56-152">Resizing VHDs</span></span>
<span data-ttu-id="b1c56-153">Образы виртуальных жестких ДИСКОВ в Azure должен иметь too1MB размер виртуальной памяти по краю.</span><span class="sxs-lookup"><span data-stu-id="b1c56-153">VHD images on Azure must have a virtual size aligned too1MB.</span></span>  <span data-ttu-id="b1c56-154">Как правило, размер VHD, созданных с помощью Hyper-V, настроен правильно.</span><span class="sxs-lookup"><span data-stu-id="b1c56-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="b1c56-155">Если виртуальный жесткий ДИСК hello выровнено неправильно, может возникнуть ошибка сообщение аналогичные toohello следующие при попытке toocreate *изображения* из вашего виртуального жесткого диска:</span><span class="sxs-lookup"><span data-stu-id="b1c56-155">If hello VHD is not aligned correctly then you may receive an error message similar toohello following when you attempt toocreate an *image* from your VHD:</span></span>

    "hello VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. hello size must be a whole number (in MBs).”

<span data-ttu-id="b1c56-156">tooremedy Здравствуйте, это можно изменить размер виртуальной Машины с помощью консоли диспетчера Hyper-V hello или hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) командлета Powershell.</span><span class="sxs-lookup"><span data-stu-id="b1c56-156">tooremedy this you can resize hello VM using either hello Hyper-V Manager console or hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="b1c56-157">Если вы не работает в среде Windows, то рекомендуемые toouse qemu img tooconvert (при необходимости) и hello изменения размера виртуального жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="b1c56-157">If you are not running in a Windows environment then it is recommended toouse qemu-img tooconvert (if needed) and resize hello VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="b1c56-158">В команде qemu-img версии 2.2.1 и более поздних версиях есть ошибка, которая приводит к созданию неверного формата VHD.</span><span class="sxs-lookup"><span data-stu-id="b1c56-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="b1c56-159">Hello проблема была устранена в QEMU 2.6.</span><span class="sxs-lookup"><span data-stu-id="b1c56-159">hello issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="b1c56-160">Рекомендуется toouse qemu-img 2.2.0 или нижней или too2.6 обновления или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="b1c56-160">It is recommended toouse either qemu-img 2.2.0 or lower, or update too2.6 or higher.</span></span> <span data-ttu-id="b1c56-161">Ссылки: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="b1c56-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="b1c56-162">Изменение размера виртуального жесткого диска, непосредственно с помощью средств, например "hello" `qemu-img` или `vbox-manage` может привести к невозможности загрузки виртуального жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="b1c56-162">Resizing hello VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="b1c56-163">Поэтому рекомендуется hello convert toofirst образ дисковыми tooa виртуального жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="b1c56-163">So it is recommended toofirst convert hello VHD tooa RAW disk image.</span></span>  <span data-ttu-id="b1c56-164">Если образ виртуальной Машины hello уже был создан как изображение НЕПОДГОТОВЛЕННЫЙ диск (hello по умолчанию некоторые низкоуровневые оболочки, такие как KVM) может пропустить этот шаг:</span><span class="sxs-lookup"><span data-stu-id="b1c56-164">If hello VM image was already created as RAW disk image (hello default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="b1c56-165">Вычислите размер tooensure образ диска hello, hello размер виртуальной памяти не выровненные too1MB обязательных hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-165">Calculate hello required size of hello disk image tooensure that hello virtual size is aligned too1MB.</span></span>  <span data-ttu-id="b1c56-166">Следующий сценарий оболочки bash Hello может помочь с данным.</span><span class="sxs-lookup"><span data-stu-id="b1c56-166">hello following bash shell script can assist with this.</span></span>  <span data-ttu-id="b1c56-167">Hello скрипт использует "`qemu-img info`" toodetermine hello виртуальный размер образа диска hello и вычисляет размер toohello hello далее 1 МБ:</span><span class="sxs-lookup"><span data-stu-id="b1c56-167">hello script uses "`qemu-img info`" toodetermine hello virtual size of hello disk image and then calculates hello size toohello next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="b1c56-168">Изменение размера hello неподготовленный диск с помощью $rounded_size, указанное на hello выше сценария:</span><span class="sxs-lookup"><span data-stu-id="b1c56-168">Resize hello raw disk using $rounded_size as set in hello above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="b1c56-169">Преобразован задней tooa hello НЕПОДГОТОВЛЕННЫЙ диск фиксированного размера виртуального жесткого диска:</span><span class="sxs-lookup"><span data-stu-id="b1c56-169">Now, convert hello RAW disk back tooa fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="b1c56-170">Или с версией qemu **2.6 +** включают hello `force_size` параметр:</span><span class="sxs-lookup"><span data-stu-id="b1c56-170">Or, with qemu version **2.6+** include hello `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="b1c56-171">Рекомендации по ядру Linux</span><span class="sxs-lookup"><span data-stu-id="b1c56-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="b1c56-172">Hello службы интеграции Linux (LIS) драйверы для Hyper-V и Azure предоставляются непосредственно toohello вышестоящего ядра Linux.</span><span class="sxs-lookup"><span data-stu-id="b1c56-172">hello Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly toohello upstream Linux kernel.</span></span> <span data-ttu-id="b1c56-173">Во многих дистрибутивах, которые включают последнюю версию ядра Linux (то есть 3.x), эти драйверы уже будут доступны, или же в ядре предоставляются их более ранние версии.</span><span class="sxs-lookup"><span data-stu-id="b1c56-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="b1c56-174">Эти драйверы постоянно обновляются hello вышестоящего ядра новых исправлений и возможностей, поэтому по возможности рекомендуется toorun [одобренных распространения](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) , будет включать эти исправления и обновления.</span><span class="sxs-lookup"><span data-stu-id="b1c56-174">These drivers are constantly being updated in hello upstream kernel with new fixes and features, so when possible it is recommended toorun an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="b1c56-175">Если вы используете вариант Red Hat Enterprise Linux версии **6.0 6.3**, вам потребуется tooinstall hello последние версии драйверов LIS для Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="b1c56-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need tooinstall hello latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="b1c56-176">Hello драйверов можно найти [в этом месте](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="b1c56-176">hello drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="b1c56-177">Начиная с RHEL **6.4 +** (и производные) hello LIS драйверы входят уже ядра hello и без дополнительной установки пакетов являются необходимые toorun этих систем в Azure.</span><span class="sxs-lookup"><span data-stu-id="b1c56-177">As of RHEL **6.4+** (and derivatives) hello LIS drivers are already included with hello kernel and so no additional installation packages are needed toorun those systems on Azure.</span></span>

<span data-ttu-id="b1c56-178">При необходимости пользовательский ядра, это рекомендуемое toouse более новая версия ядра (т. е. **3.8 +**).</span><span class="sxs-lookup"><span data-stu-id="b1c56-178">If a custom kernel is required, it is recommended toouse a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="b1c56-179">Для этих распределений или поставщиков, обслуживать собственные ядра некоторые усилия будут необходимые tooregularly backport hello LIS драйверы hello вышестоящего ядра tooyour пользовательские ядра.</span><span class="sxs-lookup"><span data-stu-id="b1c56-179">For those distributions or vendors who maintain their own kernel, some effort will be required tooregularly backport hello LIS drivers from hello upstream kernel tooyour custom kernel.</span></span>  <span data-ttu-id="b1c56-180">Даже если вы уже используете относительно новые версии ядра, настоятельно рекомендуется отслеживать tookeep любого вышестоящих исправления в драйверы LIS hello и backport их при необходимости.</span><span class="sxs-lookup"><span data-stu-id="b1c56-180">Even if you are already running a relatively recent kernel version, it is highly recommended tookeep track of any upstream fixes in hello LIS drivers and backport those as needed.</span></span> <span data-ttu-id="b1c56-181">расположение Hello исходные файлы драйверов LIS hello доступен в hello [программы ОБСЛУЖИВАНИЯ](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) файл в дерево исходного кода hello Linux ядра:</span><span class="sxs-lookup"><span data-stu-id="b1c56-181">hello location of hello LIS driver source files is available in hello [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in hello Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="b1c56-182">По крайней мере отсутствие hello hello после исправления известные проблемы toocause в Azure и поэтому они должны быть включены в hello ядра.</span><span class="sxs-lookup"><span data-stu-id="b1c56-182">At a very minimum, hello absence of hello following patches have been known toocause problems on Azure and so these must be included in hello kernel.</span></span> <span data-ttu-id="b1c56-183">Этот список ни в коем случае не является исчерпывающим и полным для всех дистрибутивов:</span><span class="sxs-lookup"><span data-stu-id="b1c56-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="b1c56-184">ata_piix: отложить драйверы toohello Hyper-V дисков по умолчанию</span><span class="sxs-lookup"><span data-stu-id="b1c56-184">ata_piix: defer disks toohello Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="b1c56-185">storvsc: учетная запись для пакетов во время передачи в пути СБРОСА hello</span><span class="sxs-lookup"><span data-stu-id="b1c56-185">storvsc: Account for in-transit packets in hello RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="b1c56-186">storvsc: предотвращение использования WRITE_SAME;</span><span class="sxs-lookup"><span data-stu-id="b1c56-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="b1c56-187">storvsc: отключение WRITE SAME для драйверов RAID и адаптеров виртуальных узлов;</span><span class="sxs-lookup"><span data-stu-id="b1c56-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="b1c56-188">storvsc: исправление разыменования пустого указателя;</span><span class="sxs-lookup"><span data-stu-id="b1c56-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="b1c56-189">storvsc: ошибки кольцевого буфера могут привести к заморозке операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="b1c56-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="b1c56-190">scsi_sysfs: защита от двойного выполнения __scsi_remove_device.</span><span class="sxs-lookup"><span data-stu-id="b1c56-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="hello-azure-linux-agent"></a><span data-ttu-id="b1c56-191">Hello Azure Linux Agent</span><span class="sxs-lookup"><span data-stu-id="b1c56-191">hello Azure Linux Agent</span></span>
<span data-ttu-id="b1c56-192">Hello [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) требуется tooproperly подготовки виртуальной машины Linux в Azure.</span><span class="sxs-lookup"><span data-stu-id="b1c56-192">hello [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required tooproperly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="b1c56-193">Получить последнюю версию hello, файл проблемы или отправлять запросы на включение внесенных изменений в hello [в репозитории GitHub агент Linux](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="b1c56-193">You can get hello latest version, file issues or submit pull requests at hello [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="b1c56-194">агент Linux Hello освобождается по лицензии Apache 2.0 hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-194">hello Linux agent is released under hello Apache 2.0 license.</span></span> <span data-ttu-id="b1c56-195">Большинство установок уже обеспечивают RPM или deb пакеты агента hello и поэтому в некоторых случаях это могут быть установлены и обновлены с минимальными усилиями.</span><span class="sxs-lookup"><span data-stu-id="b1c56-195">Many distributions already provide RPM or deb packages for hello agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="b1c56-196">Hello Azure Linux Agent требует Python v2.6 +.</span><span class="sxs-lookup"><span data-stu-id="b1c56-196">hello Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="b1c56-197">Hello агент также требует наличия модуля python pyasn1 hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-197">hello agent also requires hello python-pyasn1 module.</span></span> <span data-ttu-id="b1c56-198">В большинстве дистрибутивов он предоставляется в виде отдельно устанавливаемого пакета.</span><span class="sxs-lookup"><span data-stu-id="b1c56-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="b1c56-199">В некоторых случаях hello Azure Linux Agent могут оказаться несовместимыми с NetworkManager.</span><span class="sxs-lookup"><span data-stu-id="b1c56-199">In some cases hello Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="b1c56-200">Многие пакеты RPM или Deb hello, предоставляемые распределения настройте NetworkManager как пакет waagent toohello конфликтов и таким образом удалит NetworkManager при установке пакета агента Linux hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-200">Many of hello RPM/Deb packages provided by distributions configure NetworkManager as a conflict toohello waagent package, and thus will uninstall NetworkManager when you install hello Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="b1c56-201">Общие системные требования для Linux</span><span class="sxs-lookup"><span data-stu-id="b1c56-201">General Linux System Requirements</span></span>

* <span data-ttu-id="b1c56-202">Измените строку загрузки ядра hello в GRUB или GRUB2 hello tooinclude следующие параметры.</span><span class="sxs-lookup"><span data-stu-id="b1c56-202">Modify hello kernel boot line in GRUB or GRUB2 tooinclude hello following parameters.</span></span> <span data-ttu-id="b1c56-203">Это также гарантирует все консоли сообщения отправляются toohello первый последовательный порт, который может помочь Azure поддержка с помощью отладки проблем:</span><span class="sxs-lookup"><span data-stu-id="b1c56-203">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="b1c56-204">Это также гарантирует все консоли сообщения отправляются toohello первый последовательный порт, который может помочь Azure поддержка с помощью отладки проблем.</span><span class="sxs-lookup"><span data-stu-id="b1c56-204">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="b1c56-205">В дополнение к этому toohello выше, рекомендуется слишком*удалить* hello следующие параметры, если они существуют:</span><span class="sxs-lookup"><span data-stu-id="b1c56-205">In addition toohello above, it is recommended too*remove* hello following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="b1c56-206">Графический quiet начальной загрузки, не используются в облачной среде, где мы хотим, чтобы все журналы toobe hello, отправляемых toohello последовательного порта.</span><span class="sxs-lookup"><span data-stu-id="b1c56-206">Graphical and quiet boot are not useful in a cloud environment where we want all hello logs toobe sent toohello serial port.</span></span> <span data-ttu-id="b1c56-207">Hello `crashkernel` возможность влево, при желании настроить, но следует заметить, что этот параметр приведет к уменьшению hello объем доступной памяти в hello виртуальная машина по 128 МБ или больше, которое может быть проблематично на hello меньшего размера виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="b1c56-207">hello `crashkernel` option may be left configured if desired, but note that this parameter will reduce hello amount of available memory in hello VM by 128MB or more, which may be problematic on hello smaller VM sizes.</span></span>

* <span data-ttu-id="b1c56-208">Установка агента Azure Linux hello</span><span class="sxs-lookup"><span data-stu-id="b1c56-208">Installing hello Azure Linux Agent</span></span>
  
    <span data-ttu-id="b1c56-209">для подготовки образа Linux на платформе Azure требуется Hello агент Azure Linux.</span><span class="sxs-lookup"><span data-stu-id="b1c56-209">hello Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="b1c56-210">Большинство установок предоставляют агента hello как пакет RPM или Deb (hello пакет обычно называется «WALinuxAgent» или «walinuxagent»).</span><span class="sxs-lookup"><span data-stu-id="b1c56-210">Many distributions provide hello agent as an RPM or Deb package (hello package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="b1c56-211">Hello агент также можно установить вручную, следуя указаниям hello hello [руководство агент Linux](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="b1c56-211">hello agent can also be installed manually by following hello steps in hello [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="b1c56-212">Убедитесь, что hello SSH сервер установлен и настроен toostart во время загрузки.</span><span class="sxs-lookup"><span data-stu-id="b1c56-212">Ensure that hello SSH server is installed and configured toostart at boot time.</span></span>  <span data-ttu-id="b1c56-213">Обычно это происходит по умолчанию hello.</span><span class="sxs-lookup"><span data-stu-id="b1c56-213">This is usually hello default.</span></span>

* <span data-ttu-id="b1c56-214">Не создавайте подкачки на диске ОС hello</span><span class="sxs-lookup"><span data-stu-id="b1c56-214">Do not create swap space on hello OS disk</span></span>
  
    <span data-ttu-id="b1c56-215">Hello Azure Linux Agent может автоматически настроить подкачки с помощью hello локальный диск ресурсов, toohello подключенных виртуальных Машин после подготовки в Azure.</span><span class="sxs-lookup"><span data-stu-id="b1c56-215">hello Azure Linux Agent can automatically configure swap space using hello local resource disk that is attached toohello VM after provisioning on Azure.</span></span> <span data-ttu-id="b1c56-216">Обратите внимание, что hello локальный диск ресурсов *временные* диск, а также может очищаться при отмененной подготовкой hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="b1c56-216">Note that hello local resource disk is a *temporary* disk, and might be emptied when hello VM is deprovisioned.</span></span> <span data-ttu-id="b1c56-217">После установки hello Azure Linux Agent (см. выше), измените соответствующим образом следующие параметры в /etc/waagent.conf hello:</span><span class="sxs-lookup"><span data-stu-id="b1c56-217">After installing hello Azure Linux Agent (see previous step), modify hello following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this toowhatever you need it toobe.

* <span data-ttu-id="b1c56-218">В качестве последнего шага выполните следующие команды toodeprovision hello виртуальной машины hello:</span><span class="sxs-lookup"><span data-stu-id="b1c56-218">As a final step, run hello following commands toodeprovision hello virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="b1c56-219">На Virtualbox может появиться следующая ошибка после выполнения hello "waagent-force - deprovision": `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="b1c56-219">On Virtualbox you may see hello following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="b1c56-220">Это сообщение об ошибке не является важным и может быть пропущено.</span><span class="sxs-lookup"><span data-stu-id="b1c56-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="b1c56-221">Затем может потребоваться tooshut работу hello виртуальной машины и передать tooAzure hello виртуального жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="b1c56-221">You will then need tooshut down hello virtual machine and upload hello VHD tooAzure.</span></span>

