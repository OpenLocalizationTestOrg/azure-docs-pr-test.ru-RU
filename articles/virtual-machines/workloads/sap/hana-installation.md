---
title: "Установка SAP HANA на сервере SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт"
description: "Инструкции по установке SAP HANA на сервере SAP HANA в Azure (крупные экземпляры)."
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/01/2016
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 8ef85c098058c97e5ec6d758fcf1dab5b1a87786
ms.sourcegitcommit: a036a565bca3e47187eefcaf3cc54e3b5af5b369
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2017
---
# <a name="how-to-install-and-configure-sap-hana-large-instances-on-azure"></a>Как установить и настроить SAP HANA (крупные экземпляры) в Azure

Ниже приведено несколько важных определений, которые нужно знать перед прочтением этого руководства. В статье [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture) мы представили два разных класса единиц крупных экземпляров HANA с:

- S72, S72m, S144, S144m, S192 и S192m, которые обычно называются номерами SKU 1 класса;
- S384, S384m, S384xm, S576, S768 и S960, которые обычно называются номерами SKU 2 класса.

В документации по крупным экземплярам HANA описатель класса будет использоваться для ссылки на различные возможности и требования, основанные на номерах SKU крупных экземпляров HANA.

Кроме того, часто используются следующие определения.
- **Стек крупных экземпляров:** сертифицированный для программы SAP HANA TDI аппаратный стек, предназначенный для запуска экземпляров SAP HANA в Azure.
- **SAP HANA в Azure (крупные экземпляры):** официальное название предложения в Azure, предусматривающее запуск экземпляров SAP HANA на оборудовании, сертифицированном для программы SAP HANA TDI, которые развертываются в стеках крупных экземпляров в разных регионах Azure. Связанный термин **крупные экземпляры HANA** — сокращенное название SAP HANA в Azure (крупные экземпляры), которое широко используется в этом техническом руководстве по развертыванию.


Установку SAP HANA вы выполняете самостоятельно. Это можно сделать сразу после получения нового сервера SAP HANA в Azure (крупные экземпляры). И после установки подключения между вашими виртуальными сетями Azure и единицами крупных экземпляров HANA. 

> [!Note]
> Согласно политике SAP, установку SAP HANA выполняет специалист, имеющий соответствующий сертификат. Это пользователь, сдавший экзамен на установку SAP HANA в рамках сертификации технологического партнера SAP, экзамен по установке SAP HANA, или системный интегратор с сертификатом SAP.

Еще раз прочтите (особенно если вы планируете установить HANA 2.0) документ [SAP Support Note #2235581 - SAP HANA: Supported Operating Systems](https://launchpad.support.sap.com/#/notes/2235581/E) (Примечание по поддержке SAP №2235581. SAP HANA: поддерживаемые операционные системы) и убедитесь, что используемая ОС поддерживается выпуском SAP HANA, который вы собираетесь установить. Вы увидите, что в поддерживаемой ОС для HANA 2.0 больше ограничений, чем в ОС для HANA 1.0. 

## <a name="first-steps-after-receiving-the-hana-large-instance-units"></a>Первые шаги после получения единиц крупных экземпляров HANA

**Первый шаг** после получения крупного экземпляра HANA и установки подключения к экземплярам заключается в регистрации операционной системы экземпляра через поставщика ОС. Этот шаг также включает регистрацию операционной системы SUSE Linux в экземпляре SUSE SMT, который необходимо развернуть на виртуальной машине в Azure. К этому экземпляру SMT может подключаться единица крупного экземпляра HANA (см. далее в этой документации). Операционную систему RedHat также можно зарегистрировать в диспетчере подписок RedHat, к которому нужно подключиться. Примечания см. в этом [документе](https://docs.microsoft.com/azure/virtual-machines/linux/sap-hana-overview-architecture?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Кроме того, этот шаг обеспечивает возможность обновления операционной системы. Это задание выполняется клиентом. Документацию по установке и настройке SMT для SUSE можно найти [здесь](https://www.suse.com/documentation/sles-12/book_smt/data/smt_installation.html).

**Второй шаг** заключается в проверке наличия новых обновлений и исправлений для определенного выпуска или версии операционной системы. Вы должны использовать последнюю версию крупного экземпляра HANA. В зависимости от времени выпуска обновлений и исправлений операционной системы, а также изменений в образе, которые может развернуть Майкрософт, последние исправления могут быть не включены. Поэтому после получения единицы крупного экземпляра HANA обязательно проверьте, не выпустил ли определенный поставщик Linux новые исправления системы безопасности, функций, компонентов обеспечения доступности и производительности, которые нужно применить.

**Третий шаг** заключается в ознакомлении с соответствующими примечаниями к SAP по установке и настройке SAP HANA в определенной версии или выпуске операционной системы. Из-за изменения рекомендаций или примечаний к SAP, а также конфигураций, которые зависят от отдельных сценариев установки, Майкрософт не всегда может обеспечить правильную настройку единицы крупного экземпляра HANA. Вы как клиент должны обязательно ознакомиться с примечаниями к SAP, относящимися к SAP HANA в вашем выпуске Linux. Кроме того, проверьте настройки выпуска или версии операционной системы и примените параметры конфигурации, если это еще не сделано.

Проверьте приведенные ниже параметры и измените их значения на следующие:

- net.core.rmem_max = 16777216;
- net.core.wmem_max = 16777216;
- net.core.rmem_default = 16777216;
- net.core.wmem_default = 16777216;
- net.core.optmem_max = 16777216;
- net.ipv4.tcp_rmem = 65536 16777216 16777216;
- net.ipv4.tcp_wmem = 65536 16777216 16777216.

Начиная с SLES 12 с пакетом обновления 1 (SP1) и RHEL 7.2, эти параметры необходимо определить в файле конфигурации в каталоге /etc/sysctl.d. Например, в этом каталоге должен находиться файл конфигурации с именем 91-NetApp-HANA.conf. В предыдущих выпусках SLES и RHEL эти параметры необходимо задать в файле /etc/sysctl.conf.

Во всех выпусках RHEL и SLES (начиная с версии 12) параметр 
- sunrpc.tcp_slot_table_entries = 128

необходимо задать в файле /etc/modprobe.d/sunrpc-local.conf. Если этот файл отсутствует, его сначала необходимо создать, добавив следующую запись: 
- options sunrpc tcp_max_slot_table_entries=128.

**Четвертый шаг** заключается в проверке системного времени единицы крупного экземпляра HANA. При развертывании экземпляров в их системе используется часовой пояс региона Azure, в котором расположен стек крупных экземпляров HANA. Вы можете изменить системное время и часовой пояс экземпляров. В этом случае при добавлении новых экземпляров в клиент также необходимо соответствующим образом изменить их часовой пояс. Ресурсы Майкрософт не имеют доступа к сведениям о настройке часового пояса системы в экземплярах после передачи их в эксплуатацию. Поэтому часовой пояс новых экземпляров может отличаться от установленного вами. В результате вы как клиент должны проверить и при необходимости изменить часовой пояс полученных экземпляров. 

**Пятый шаг** заключается в проверке etc/hosts. После передачи в колонках для разных целей назначены отдельные IP-адреса (см. следующий раздел). Проверьте файл/etc/hosts. При добавлении единиц в имеющийся клиент в файле etc/hosts новых систем могут быть неправильно настроены IP-адреса предыдущих систем. Вы как пользователь обязаны проверить правильность конфигурации. Это позволит новым экземплярам взаимодействовать с ранее развернутыми единицами в клиенте и разрешать их имена. 

## <a name="networking"></a>Сеть
В этом разделе предполагается, что вы следовали рекомендациям по проектированию виртуальных сетей Azure и их подключению к крупным экземплярам HANA, приведенным в следующих статьях:

- [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture)
- [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

При проектировании сети отдельной единицы следует учитывать некоторые моменты. Каждой единице крупного экземпляра HANA выделяется два или три IP-адреса, которые назначаются соответствующему числу портов сетевого адаптера. Три IP-адреса используются в масштабируемых конфигурациях HANA или в сценарии репликации системы HANA. Один из IP-адресов, назначенных сетевому адаптеру единицы, выделяется из диапазона IP-адресов серверного пула. Дополнительные сведения см. в статье [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture).

Распределение для единиц с двумя IP-адресами выполняется следующим образом:

- eth0.xx должен иметь IP-адрес из диапазона IP-адресов серверного пула, отправленного в Майкрософт. Этот IP-адрес нужно указать в файле /etc/hosts операционной системы.
- eth1.xx должен иметь IP-адрес, используемый для взаимодействия с NFS. Таким образом, эти адреса **не** нужно сохранять в файле etc/hosts, чтобы разрешить трафик между экземплярами в одном клиенте.

При развертывании репликации системы HANA или масштабировании HANA конфигурация колонки с двумя назначенными IP-адресами не подходит. При развертывании таких конфигураций обратитесь в службу поддержки SAP HANA для Azure Service Management, чтобы получить третий IP-адрес в третьей виртуальной локальной сети. В единицах крупных экземпляров HANA при наличии трех назначенных IP-адресов в трех портах сетевого адаптера применяются следующие правила использования:

- eth0.xx должен иметь IP-адрес из диапазона IP-адресов серверного пула, отправленного в Майкрософт. Поэтому этот IP-адрес не нужно указывать в файле /etc/hosts операционной системы.
- eth1.xx должен иметь IP-адрес, используемый для взаимодействия с хранилищем NFS. Этот тип адресов не нужно указывать в файле etc/hosts.
- eth2.xx должен использоваться исключительно в файле etc/hosts, чтобы обеспечить взаимодействие между разными экземплярами. Эти адреса также применяются в конфигурациях масштабирования HANA как IP-адреса, используемые системой HANA для конфигурации между узлами.



## <a name="storage"></a>Хранилище

Структура хранения для SAP HANA в Azure (крупные экземпляры) настраивается через управление службами SAP HANA в Azure с применением рекомендованных методик, как описано в техническом документе с описанием [требований к хранилищу для SAP HANA](http://go.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). Приблизительные размеры разных томов с различными SKU крупных экземпляров HANA задокументированы в статье [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](hana-overview-architecture.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

Соглашения об именовании томов хранилища перечислены в следующей таблице.

| Использование хранилища | Имя подключения | Имя тома | 
| --- | --- | ---|
| Данные HANA | /hana/data/SID/mnt0000<m> | IP хранилища: /hana_data_SID_mnt00001_tenant_vol |
| Журнал HANA | /hana/log/SID/mnt0000<m> | IP хранилища: /hana_log_SID_mnt00001_tenant_vol |
| Резервная копия журнала HANA | /hana/log/backups | IP хранилища: /hana_log_backups_SID_mnt00001_tenant_vol |
| Общий HANA | /hana/shared/SID | IP хранилища: /hana_shared_SID_mnt00001_tenant_vol/shared |
| usr/sap | /usr/sap/SID | IP хранилища: /hana_shared_SID_mnt00001_tenant_vol/usr_sap |

Где SID — это системный идентификатор экземпляра HANA 

А клиент — это внутреннее перечисление операций при развертывании клиента.

Как видите, общий HANA и usr/sap используют один и тот же том. В спецификацию точек подключения входит системный идентификатор экземпляров HANA, а также номер подключения. В масштабируемых развертываниях существует только одно подключение, например mnt00001. В масштабируемом развертывании будет отображаться столько подключений, сколько рабочих и главных узлов находится в вашем распоряжении. В масштабируемой среде данные, журнал, тома журнала резервного копирования являются общими и присоединяются к каждому узлу в масштабируемой конфигурации. Для конфигураций с несколькими экземплярами SAP создается другой набор томов, который присоединяется к единице крупного экземпляра HAN.

Ознакомившись с этим документом и оценив единицу крупного экземпляра HANA, вы заметите, что эти единицы имеют крупный том диска HANA/data, а также наличие тома HANA/log/backup. Причина, почему мы выделили больше места для HANA/data, заключается в том, что на этот том диска также сохраняются моментальные снимки, созданные с помощью предоставленной нами функции. Это означает, что чем больше моментальных снимков вы сделали, тем больше требуется пространства. Том HANA/log/backup не используется для хранения резервных копий базы данных. Его размер походит для использования в качестве архивного тома для резервных копий журнала транзакций HANA. В будущих версиях функции самостоятельного создания моментальных снимков хранилища мы планируем настроить сохранение дополнительного количества моментальных снимков на этот том. Это позволит создавать моментальные снимки чаще и при этом чаще выполнять репликацию на сайт аварийного восстановления при использовании функции аварийного восстановления, предоставленной инфраструктурой крупных экземпляров HANA. Дополнительные сведения см. в статье [Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)](hana-overview-high-availability-disaster-recovery.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

Кроме предоставленного хранилища, вы можете приобрести дополнительную емкость хранилища с шагом в 1 ТБ. Это дополнительное хранилище добавляется к HANA (крупные экземпляры) как новые тома.

Во время адаптации с SAP HANA в Azure Service Management пользователи указывают идентификатор пользователя sidadm и идентификатор группы sapsys (например, 1000,500). Важно, чтобы при установке системы SAP HANA использовались те же значения. Так как вы хотите развернуть несколько экземпляров HANA, вы получите несколько наборов томов (один набор для каждого экземпляра). В результате во время развертывания необходимо определить следующие моменты:

- Идентификатор SID разных экземпляров HANA (sidadm получается на его основе).
- Объемы памяти разных экземпляров HANA. Так как объем памяти каждого экземпляра определяет размер тома в каждом отдельном наборе томов.

Согласно рекомендациям поставщика хранилища, для всех подключенных томов настраиваются следующие параметры подключения (кроме LUN загрузки):

- nfs    rw, vers=4, hard, timeo=600, rsize=1048576, wsize=1048576, intr, noatime, lock 0 0

Эти точки подключения настраиваются в /etc/fstab, как показано на следующих снимках экрана:

![fstab подключенных томов в единице крупного экземпляра HANA](./media/hana-installation/image1_fstab.PNG)

Выходные данные команды df -h в единице крупного экземпляра S72m HANA выглядят следующим образом:

![fstab подключенных томов в единице крупного экземпляра HANA](./media/hana-installation/image2_df_output.PNG)


Контроллер хранилища и узлы в стеках больших экземпляров синхронизируются с NTP-серверами. Если выполняется синхронизация с NTP-сервером для единиц SAP HANA в Azure (крупные экземпляры) и виртуальных машин Azure, не должно быть заметного смещения времени между инфраструктурой и вычислительными единицами в Azure или стеками крупных экземпляров.

Чтобы оптимизировать хранилище, используемое SAP HANA, необходимо также задать следующие параметры конфигурации:

- max_parallel_io_requests 128;
- async_read_submit on;
- async_write_submit_active on;
- async_write_submit_blocks all.
 
Начиная с версии SAP HANA 1.0 и до SPS 12, эти параметры можно указать во время установки базы данных SAP HANA, как описано в [примечании к SAP 2267798](https://launchpad.support.sap.com/#/notes/2267798).

Эти параметры также можно настроить после установки базы данных SAP HANA с помощью средства hdbparam. 

Это средство не поддерживается в системе SAP HANA 2.0. В таком случае эти параметры необходимо задать с помощью команд SQL. Дополнительные сведения см. в [примечании к SAP 2399079 об устранении hdbparam в HANA 2.0](https://launchpad.support.sap.com/#/notes/2399079).


## <a name="operating-system"></a>операционная система

Для области буфера доставленного образа ОС выделено 2 ГБ в соответствии с документом [SAP Support Note #1999997 - FAQ: SAP HANA Memory](https://launchpad.support.sap.com/#/notes/1999997/E) (Примечание по поддержке SAP №1999997. Часто задаваемые вопросы: память SAP HANA). Другие необходимые параметры должен устанавливать клиент.

Для SAP HANA в Azure (большие экземпляры) используется дистрибутив [SUSE Linux Enterprise Server 12 SP1 для приложений SAP](https://www.suse.com/products/sles-for-sap/hana). Этот дистрибутив предоставляет все необходимые для SAP функции &quot;без дополнительной настройки&quot; (в том числе предварительно настроенные параметры для эффективного запуска SAP на сервере SLES).

В разделе [библиотеки ресурсов и технической документации](https://www.suse.com/products/sles-for-sap/resource-library#white-papers) на веб-сайте SUSE и на [странице SAP для SUSE](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+SUSE) в сетевом сообществе SAP (SCN) доступно несколько полезных ресурсов, в которых описывается развертывание SAP HANA на SLES (в том числе настройки высокой доступности, методы обеспечения безопасности для работы SAP и многое другое).

Дополнительные сведения и полезные ссылки по SAP в SUSE:

- [SAP HANA на сайте SUSE Linux](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+SUSE);
- [Best Practice for SAP: Enqueue Replication – SAP NetWeaver on SUSE Linux Enterprise 12](https://www.suse.com/docrepcontent/container.jsp?containerId=9113) (Рекомендации по SAP. Постановка репликации в очередь — SAP NetWeaver в SUSE Linux Enterprise 12).
- [ClamSAP – SLES Virus Protection for SAP](http://scn.sap.com/community/linux/blog/2014/04/14/clamsap--suse-linux-enterprise-server-integrates-virus-protection-for-sap) (ClamSAP – защита от вирусов на сервере SLES для SAP) (включая SLES 12 для приложений SAP).

Примечания по поддержке SAP, применимые к реализации SAP HANA на SLES 12:

- [SAP Support Note #1944799 – SAP HANA Guidelines for SLES Operating System Installation](http://go.sap.com/documents/2016/05/e8705aae-717c-0010-82c7-eda71af511fa.html) (Примечание по поддержке SAP №1944799. Рекомендации по установке SAP HANA в ОС SLES).
- [SAP Support Note #2205917 – SAP HANA DB Recommended OS Settings for SLES 12 for SAP Applications](https://launchpad.support.sap.com/#/notes/2205917/E) (Примечание по поддержке SAP №2205917. База данных SAP HANA: рекомендуемые параметры ОС для SLES 12 для приложений SAP).
- [SAP Support Note #1984787 – SUSE Linux Enterprise Server 12: Installation Notes](https://launchpad.support.sap.com/#/notes/1984787) (Примечание по поддержке SAP №1984787. Заметки об установке SUSE Linux Enterprise Server 12).
- [SAP Support Note #171356 – SAP Software on Linux: General Information](https://launchpad.support.sap.com/#/notes/1984787) (Примечание по поддержке SAP №171356. Общие сведения о ПО SAP на платформе Linux).
- [SAP Support Note #1391070 – Linux UUID Solutions](https://launchpad.support.sap.com/#/notes/1391070) (Примечание по поддержке SAP №1391070. Решения UUID для Linux).

[Red Hat Enterprise Linux для SAP HANA](https://www.redhat.com/en/resources/red-hat-enterprise-linux-sap-hana) — еще одно решение для запуска SAP HANA на крупных экземплярах HANA. Доступны выпуски RHEL 6.7 и 7.2. Обратите внимание, что виртуальные машины, размещенные в Azure, поддерживают RHEL начиная с версии 7.2, тогда как крупные экземпляры HANA также поддерживают RHEL версии 6.7. Мы рекомендуем использовать выпуск RHEL 7.x.

Дополнительные сведения и полезные ссылки по SAP в Red Hat:
- [Сайт SAP HANA в Red Hat Linux](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+Red+Hat).

Примечания по поддержке SAP, применимые к реализации SAP HANA в Red Hat:

- [SAP Support Note #2009879 - SAP HANA Guidelines for Red Hat Enterprise Linux (RHEL) Operating System](https://launchpad.support.sap.com/#/notes/2009879/E) (Примечание по поддержке SAP №2009879. Рекомендации по установке SAP HANA в ОС Red Hat Enterprise Linux (RHEL)).
- [SAP Support Note #2292690 - SAP HANA DB: Recommended OS settings for RHEL 7](https://launchpad.support.sap.com/#/notes/2292690) (Примечание по поддержке SAP №2292690. База данных SAP HANA: рекомендуемые параметры операционной системы для RHEL 7).
- [SAP Support Note #2247020 - SAP HANA DB: Recommended OS settings for RHEL 6.7](https://launchpad.support.sap.com/#/notes/2247020) (Примечание по поддержке SAP №2247020. База данных SAP HANA: рекомендуемые параметры операционной системы для RHEL 6.7).
- [SAP Support Note #1391070 – Linux UUID Solutions](https://launchpad.support.sap.com/#/notes/1391070) (Примечание по поддержке SAP №1391070. Решения UUID для Linux).
- [SAP Support Note #2228351 - Linux: SAP HANA Database SPS 11 revision 110 (or higher) on RHEL 6 or SLES 11](https://launchpad.support.sap.com/#/notes/2228351) (Примечание по поддержке SAP №2228351. Linux: база данных SAP HANA SPS 11, редакция 110 (или более поздняя), в RHEL 6 или SLES 11).
- [SAP Support Note #2397039 - FAQ: SAP on RHEL](https://launchpad.support.sap.com/#/notes/2397039) (Примечание по поддержке SAP №2397039. Часто задаваемые вопросы: SAP в RHEL).
- [SAP Support Note #1496410 - Red Hat Enterprise Linux 6.x: Installation and Upgrade](https://launchpad.support.sap.com/#/notes/1496410) (Примечание по поддержке SAP №1496410. Установка и обновление Red Hat Enterprise Linux 6.x).
- [SAP Support Note #2002167 - Red Hat Enterprise Linux 7.x: Installation and Upgrade](https://launchpad.support.sap.com/#/notes/2002167) (Примечание по поддержке SAP №2002167. Установка и обновление Red Hat Enterprise Linux 7.x).

## <a name="time-synchronization"></a>Синхронизация времени

Приложения SAP, построенные на основе архитектуры SAP NetWeaver, очень чувствительны к разнице системного времени на разных компонентах, образующих систему SAP. Вам должны быть знакомы короткие дампы ABAP SAP с ошибкой, озаглавленной ZDATE\_LARGE\_TIME\_DIFF. Они появляются именно в том случае, когда системное время на разных серверах или виртуальных машинах существенно различается.

Для SAP HANA в Azure (крупные экземпляры) синхронизация времени в Azure не применяется к вычислительным единицам в стеках больших экземпляров. Эта синхронизация не относится к приложениям SAP, выполняемым на виртуальных машинах Azure, так как Azure гарантирует правильную синхронизацию системного времени. Соответственно, потребуется отдельный сервер времени, который будут использовать серверы приложений SAP, работающие на виртуальных машинах Azure, и экземпляры баз данных SAP HANA, работающие на HANA (крупные экземпляры). Для инфраструктуры хранения в стеках крупных экземпляров время синхронизируется с серверами NTP.

## <a name="setting-up-smt-server-for-suse-linux"></a>Настройка сервера SMT для SUSE Linux
Крупные экземпляры SAP HANA не подключены к Интернету напрямую. Поэтому процессы регистрации такой единицы у поставщика ОС, а также скачивания и применения исправлений вызывают определенные сложности. При использовании SUSE Linux одним из решений может быть настройка сервера SMT на виртуальной машине Azure. Виртуальная машина Azure должна быть размещена в виртуальной сети Azure, подключенной к крупному экземпляру HANA. При наличии такого сервера SMT единица крупного экземпляра HANA может регистрировать и скачивать исправления. 

SUSE предлагает более объемное руководство по [средству управления подписками для SLES 12 SP2](https://www.suse.com/documentation/sles-12/pdfdoc/book_smt/book_smt.pdf). 

В качестве предварительного условия для установки сервера SMT, выполняющего задачу для крупного экземпляра HANA, вам потребуется:

- виртуальная сеть Azure, подключенная к каналу ER крупного экземпляра HANA;
- учетная запись SUSE, связанная с организацией. А организации требуется действительная подписка SUSE.

### <a name="installation-of-smt-server-on-azure-vm"></a>Установка сервера SMT на виртуальной машине Azure

На этом этапе вы установите сервер SMT на виртуальной машине Azure. Сначала необходимо войти в [Центр клиентов SUSE](https://scc.suse.com/).

После входа перейдите в раздел "Организация"--> "Учетные данные организации". В этом разделе вы должны найти учетные данные, необходимые для настройки сервера SMT.

Третий шаг — это установка виртуальной машины SUSE Linux в виртуальной сети Azure. Чтобы развернуть виртуальную машину, требуется образ SLES 12 SP2 из коллекции Azure. В процессе развертывания не определяйте DNS-имя и не используйте статические IP-адреса, как показано на этом снимке экрана.

![развертывание виртуальной машины для сервера SMT](./media/hana-installation/image3_vm_deployment.png)

Развернутая виртуальная машина имела меньший размер и получила внутренний IP-адрес 10.34.1.4 в виртуальной сети Azure. Виртуальной машине было задано имя smtserver. После установки было проверено подключение к единицам крупных экземпляров HANA. В зависимости от того, как вы организовали разрешение имен, может потребоваться настроить разрешение единиц крупных экземпляров HANA в etc/hosts виртуальной машины Azure. Добавьте в виртуальную машину дополнительный диск, на котором будут храниться исправления. Самого загрузочного диска может оказаться недостаточно. В демонстрируемом случае диск подключен к /srv/www/htdocs, как показано на следующем снимке экрана. 100 ГБ дискового пространства должно быть достаточно.

![развертывание виртуальной машины для сервера SMT](./media/hana-installation/image4_additional_disk_on_smtserver.PNG)

Войдите на единицу крупного экземпляра HANA, выделите/etc/hosts и проверьте, доступна ли виртуальная машина Azure, на которой должен быть запущен сервер SMT по сети.

После успешной проверки необходимо войти в виртуальную машину Azure, где должен быть запущен сервер SMT. Если для входа в виртуальную машину вы используете PuTTY, необходимо выполнить следующую последовательность команд в окне bash:

```
cd ~
echo "export NCURSES_NO_UTF8_ACS=1" >> .bashrc
```

После выполнения этих команд перезапустите bash, чтобы активировать параметры. Затем запустите YAST.

В YAST перейдите в раздел обслуживания программного обеспечения и выполните поиск smt. Выберите пункт smt, который автоматически изменится на yast2-smt, как показано ниже.

![SMT в yast](./media/hana-installation/image5_smt_in_yast.PNG)


Примите выбор для установки на smtserver. После установки перейдите к конфигурации сервера SMT и введите учетные данные организации, полученные ранее в Центре клиентов SUSE. В качестве URL-адреса сервера SMT введите имя узла виртуальной машины Azure. В этой демонстрации это был https://smtserver, как показано на следующих снимках.

![Конфигурация сервера SMT](./media/hana-installation/image6_configuration_of_smtserver1.png)

На следующем шаге необходимо проверить, работает ли подключение к Центру клиентов SUSE. Как показано на следующих снимках, в демонстрации оно работало.

![Тестирование подключения к Центру клиентов SUSE](./media/hana-installation/image7_test_connect.png)

После запуска программы установки SMT необходимо указать пароль базы данных. Так как это новая установка, необходимо определить этот пароль, как показано на следующих снимках.

![Определение пароля для базы данных](./media/hana-installation/image8_define_db_passwd.PNG)

Далее следует создание сертификата. Заполните поля в диалоговом окне, как показано далее, и действие шага будет продолжено.

![Создание сертификата для сервера SMT](./media/hana-installation/image9_certificate_creation.PNG)

Выполнение шага "Запуск проверки синхронизации" в конце конфигурации может занять несколько минут. После установки и настройки сервера SMT вы должны увидеть каталог repo в разделе точки подключения /srv/www/htdocs/, а также несколько вложенных каталогов. 

Перезапустите сервер SMT и его связанные службы, выполнив эти команды.

```
rcsmt restart
systemctl restart smt.service
systemctl restart apache2
```

### <a name="download-of-packages-onto-smt-server"></a>Загрузка пакетов на сервер SMT

После перезапуска всех служб выберите нужные пакеты в окне управления SMT с помощью Yast. Выбор пакета зависит от образа ОС сервера крупного экземпляра HANA, а не от выпуска SLES или версии виртуальной машины, где запущен сервер SMT. Ниже показан пример экрана выбора.

![Выбор пакетов](./media/hana-installation/image10_select_packages.PNG)

После выбора пакетов необходимо запустить исходную копию выбранных пакетов на настроенном сервере SMT. Эта копия запускается в оболочке с помощью команды smt-mirror, как показано ниже.


![Загрузка пакетов на сервер SMT](./media/hana-installation/image11_download_packages.PNG)

Как показано выше, пакеты следует скопировать в каталоги, созданные в разделе точки подключения /srv/www/htdocs. Этот процесс может занять несколько минут. В зависимости от количества выбранных пакетов он может длиться один час или более.
При завершении этого процесса необходимо перейти к установке клиента SMT. 

### <a name="set-up-the-smt-client-on-hana-large-instance-units"></a>Установка клиента SMT на единицах крупных экземпляров HANA

В нашем случае клиенты представляют собой единицы крупных экземпляров HANA. Программа установки сервера SMT скопировала скрипт clientSetup4SMT.sh в виртуальную машину Azure. Скопируйте этот скрипт в единицу крупного экземпляра HANA, которую нужно подключить к серверу SMT. Запустите скрипт с параметром -h и присвойте ему в качестве параметра имя сервера SMT. В этом примере используется smtserver.

![Настройка клиента SMT](./media/hana-installation/image12_configure_client.PNG)

Возможны ситуации, когда загрузка сертификата с сервера с помощью клиента выполняется успешно, но регистрация завершается ошибкой, как показано ниже.

![Ошибка регистрации клиента](./media/hana-installation/image13_registration_failed.PNG)

В случае сбоя регистрации см. [документ по поддержке SUSE](https://www.suse.com/de-de/support/kb/doc/?id=7006024) и выполните описанные в нем действия.

> [!IMPORTANT] 
> В качестве имени сервера необходимо указать имя виртуальной машины (в нашем случае — smtserver) без указания полного доменного имени. Работает просто имя виртуальной машины. 

После выполнения этих шагов необходимо выполнить следующую команду на единице крупного экземпляра HANA:

```
SUSEConnect –cleanup
```

> [!Note] 
> В наших тестах нам всегда приходилось ждать несколько минут после выполнения этого шага. Немедленное выполнение clientSetup4SMT.sh после корректирующих мер, описанных в статье SUSE, завершалось выводом сообщения о том, что сертификат еще не действителен. После 5–10-минутного ожидания выполнение clientSetup4SMT.sh завершалось успешной конфигурацией клиента.

Если возникли проблемы, которые следует исправить с учетом шагов в статье SUSE, необходимо еще раз перезапустить clientSetup4SMT.sh на единице крупного экземпляра HANA. Теперь процесс должен завершиться успешно, как показано ниже.

![Регистрация клиента успешно выполнена](./media/hana-installation/image14_finish_client_config.PNG)

На этом шаге вы настроили клиент SMT единицы крупного экземпляра HANA для подключения к серверу SMT, установленному на виртуальной машине Azure. Теперь можно выполнять zypper up или zypper in для установки исправлений ОС на крупные экземпляры HANA или установки дополнительных пакетов. Предполагается, что можно получить только те исправления, которые были загружены на сервер SMT ранее.


## <a name="example-of-an-sap-hana-installation-on-hana-large-instances"></a>Пример установки SAP HANA на крупных экземплярах HANA
В этом разделе показано, как установить SAP HANA на единице крупного экземпляра HANA. На начальном этапе выполнены следующие условия:

- Вы предоставили Майкрософт все данные для развертывания крупного экземпляра SAP HANA.
- Вы получили от Майкрософт крупный экземпляр SAP HANA.
- Вы создали виртуальную сеть Azure, которая подключена к локальной сети.
- Вы подключили канал ExpressRotue для крупных экземпляров HANA к той же виртуальной сети Azure.
- Вы установили виртуальную машину Azure, которая будет использоваться в качестве места перехода для крупных экземпляров HANA.
- Вы проверили, что можете подключаться из места перехода к единице крупного экземпляра HANA, и наоборот.
- Вы проверили, что установлены все необходимые пакеты и исправления.
- Вы прочли заметки о SAP и документацию по установке HANA в имеющейся операционной системе и проверили, что выпуск HANA поддерживается в выпуске ОС.

Далее показаны загрузка установочных пакетов HANA на переходную виртуальную машину, в данном случае под управлением ОС Windows, копирование пакетов на единицу крупного экземпляра HANA и процедура установки.

### <a name="download-of-the-sap-hana-installation-bits"></a>Загрузка установочных пакетов SAP HANA
Так как у единиц крупных экземпляров HANA нет прямого подключения к Интернету, вы не можете загружать установочные пакеты напрямую из SAP на виртуальную машину крупного экземпляра HANA. Чтобы преодолеть это ограничение, необходима переходная среда. Пакеты следует загрузить на переходную виртуальную машину.

Чтобы загрузить установочные пакеты HANA, необходим S-пользователь SAP или другой пользователь, который позволяет вам получить доступ к SAP Marketplace. После входа выполните следующую последовательность действий:

Перейдите на сайт [SAP Service Marketplace](https://support.sap.com/en/index.html) > щелкните "Загрузить программное обеспечение" > "Установки и обновления" > "По алфавитному указателю" > В разделе H выберите "SAP HANA Platform Edition" > "SAP HANA Platform Edition 2.0" > "Установка" > Загрузите следующие файлы

![Загрузка установочных пакетов HANA](./media/hana-installation/image16_download_hana.PNG)

В демонстрационном случае мы загрузили установочные пакеты SAP HANA 2.0. На переходной виртуальной машине Azure разверните самораспаковывающиеся архивы в каталог, как показано ниже.

![Извлечение установочных пакетов HANA](./media/hana-installation/image17_extract_hana.PNG)

После извлечения архивов скопируйте каталог, созданный при извлечении (в примере выше это 51052030), в единицу крупного экземпляра HANA в том /hana/shared созданного каталога.

> [!Important]
> Не копируйте установочные пакеты в корневой или загрузочный LUN, так как пространство ограничено и предназначено для использования и другими процессами.


### <a name="install-sap-hana-on-the-hana-large-instance-unit"></a>Установка SAP HANA на единице крупного экземпляра HANA
Для установки SAP HANA необходимо выполнить вход с правами привилегированного пользователя. Только такой пользователь имеет достаточно разрешений для установки SAP HANA.
Первое, что нужно сделать, — задать разрешения для каталога, скопированного в /hana/shared. Разрешения должны иметь следующий вид:

```
chmod –R 744 <Installation bits folder>
```

Если вы хотите установить SAP HANA с помощью графической установки, необходимо установить пакет gtk2 на крупных экземплярах HANA. Проверьте, установлен ли пакет, выполнив следующую команду:

```
rpm –qa | grep gtk2
```

Далее демонстрируется установка SAP HANA с помощью графического пользовательского интерфейса. На следующем шаге перейдите в каталог установки и откройте вложенный каталог HDB_LCM_LINUX_X86_64. Начало

```
./hdblcmgui 
```
из этого каталога. На следующих экранах необходимо указать данные для установки. В демонстрируемом случае мы устанавливаем сервер базы данных SAP HANA и компоненты клиента SAP HANA. Поэтому мы выбираем пункт "База данных SAP HANA", как показано ниже.

![Выбор HANA в ходе установки](./media/hana-installation/image18_hana_selection.PNG)

На следующем экране следует выбрать параметр "Установить новую систему".

![Выбор новой установки HANA](./media/hana-installation/image19_select_new.PNG)

После выполнения этого шага необходимо выбрать несколько дополнительных компонентов, которые можно дополнительно установить на сервере базы данных SAP HANA.

![Выбор дополнительных компонентов HANA](./media/hana-installation/image20_select_components.PNG)

В этой документации мы выбрали клиент SAP HANA и SAP HANA Studio. Мы также установили вертикально масштабируемый экземпляр. Поэтому на следующем экране вам нужно выбрать "Система с одним узлом". 

![Выбор вертикально масштабируемой установки](./media/hana-installation/image21_single_host.PNG)

На следующем экране необходимо указать некоторые данные.

![Указание идентификатора SID SAP HANA](./media/hana-installation/image22_provide_sid.PNG)

> [!Important]
> В качестве системного идентификатора (SID) HANA необходимо указать тот же SID, который вы предоставили Майкрософт при заказе развертывания крупных экземпляров HANA. Выбор другого SID приведет к сбою установки из-за проблемы с разрешениями доступа на разных томах.

В качестве каталога установки используется каталог /hana/shared. На следующем шаге необходимо указать расположение для файлов данных HANA и файлов журнал HANA.


![Указание расположения журнала HANA](./media/hana-installation/image23_provide_log.PNG)

> [!Note]
> Следует определить расположение томов данных и томов файлов журнала, полученные уже с точками подключения, которые содержат SID, выбранный на экране ранее. Если SID не совпадает с введенным на экране ранее, измените SID на значение, которое имеется на точках подключения.

На следующем шаге проверьте имя узла и при необходимости измените его. 

![Проверка имени узла](./media/hana-installation/image24_review_host_name.PNG)

На следующем шаге необходимо получить данные, переданные в Майкрософт при заказе развертывания крупных экземпляров HANA. 

![Указание ИД пользователя и ИД группы](./media/hana-installation/image25_provide_guid.PNG)

> [!Important]
> Необходимо указать те же ИД пользователя и ИД группы, которые были переданы в Майкрософт при заказе развертывания. Если вы не предоставите именно те идентификаторы, установка SAP HANA на единице крупного экземпляра HANA завершится сбоем.

На следующих двух экранах, которые не показаны в этой документации, нужно ввести пароль для пользователя SYSTEM базы данных SAP HANA и пароль для пользователя sapadm, который используется для агента узла SAP, устанавливаемого в составе экземпляра базы данных SAP HANA.

После определения пароля отображается экран подтверждения. Проверьте все указанные данные и продолжите установку. Появится экран с отображением хода выполнения, как показано ниже.

![Проверка хода выполнения установки](./media/hana-installation/image27_show_progress.PNG)

После завершения установки вы увидите экран, аналогичный приведенному ниже.

![Установка завершена](./media/hana-installation/image28_install_finished.PNG)

На этом этапе экземпляр SAP HANA должен быть готов к использованию. Вы сможете подключиться к нему из SAP HANA Studio. Также убедитесь в наличии последних исправлений SAP HANA, и примените их.
























































 







 




