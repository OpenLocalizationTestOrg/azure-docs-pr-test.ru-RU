---
title: "резервное копирование HANA Azure aaaSAP, основанные на моментальных снимках хранилища | Документы Microsoft"
description: "Существуют две основные возможности резервного копирования SAP HANA на виртуальных машинах Azure. В этой статье рассматривается резервное копирование на основе моментальных снимков хранилища."
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 32bb80f5a928a2cf63699bfe4f4cf5bbad81e6fe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="fe643-103">Резервное копирование SAP HANA на основе моментальных снимков хранилища</span><span class="sxs-lookup"><span data-stu-id="fe643-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="fe643-104">Введение</span><span class="sxs-lookup"><span data-stu-id="fe643-104">Introduction</span></span>

<span data-ttu-id="fe643-105">Эта статья входит в цикл из трех связанных статей, посвященных резервному копированию SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="fe643-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="fe643-106">[Руководстве по резервному копированию для SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md) содержит обзор и сведения о начале работы и [SAP HANA Azure резервное копирование на уровне файлов](sap-hana-backup-file-level.md) деле hello параметра резервного копирования на основе файлов.</span><span class="sxs-lookup"><span data-stu-id="fe643-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>

<span data-ttu-id="fe643-107">При использовании средств резервного копирования виртуальной Машины для одного экземпляра в одном демонстрационной системы, один попробовать сделать резервной копии виртуальной Машины вместо управления HANA резервные копии на уровне ОС hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at hello OS level.</span></span> <span data-ttu-id="fe643-108">Альтернативой является tootake моментальные снимки больших двоичных объектов Azure toocreate копии отдельных виртуальных дисков, которые являются tooa подключенных виртуальных машин и сохранять файлы данных HANA hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-108">An alternative is tootake Azure blob snapshots toocreate copies of individual virtual disks, which are attached tooa virtual machine, and keep hello HANA data files.</span></span> <span data-ttu-id="fe643-109">Но ключевой момент согласованности приложения при создании моментального снимка резервной копии или диск виртуальной Машины, пока открыт системы hello и запуске.</span><span class="sxs-lookup"><span data-stu-id="fe643-109">But a critical point is app consistency when creating a VM backup or disk snapshot while hello system is up and running.</span></span> <span data-ttu-id="fe643-110">В разделе _целостности данных SAP HANA, когда создание хранилища моментальных снимков_ в соответствующей статье hello [резервной копии руководства по SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="fe643-110">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="fe643-111">SAP HANA имеет функцию, которая поддерживает такие типы моментальных снимков хранилища.</span><span class="sxs-lookup"><span data-stu-id="fe643-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="fe643-112">Моментальные снимки SAP HANA</span><span class="sxs-lookup"><span data-stu-id="fe643-112">SAP HANA snapshots</span></span>

<span data-ttu-id="fe643-113">Система SAP HANA предоставляет функцию создания моментальных снимков хранилища.</span><span class="sxs-lookup"><span data-stu-id="fe643-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="fe643-114">Тем не менее начиная с 2016 декабря, отсутствует ограничение систем toosingle контейнера.</span><span class="sxs-lookup"><span data-stu-id="fe643-114">However, as of December 2016, there is a restriction toosingle-container systems.</span></span> <span data-ttu-id="fe643-115">Мультитенантные конфигурации контейнеров не поддерживают этот тип моментального снимка базы данных. Дополнительные сведения см. в статье [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) (Создание моментального снимка хранилища (SAP HANA Studio)).</span><span class="sxs-lookup"><span data-stu-id="fe643-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="fe643-116">Процесс создания моментальных снимков хранилища состоит из следующих этапов:</span><span class="sxs-lookup"><span data-stu-id="fe643-116">It works as follows:</span></span>

- <span data-ttu-id="fe643-117">Подготовка моментального снимка хранилища, запуская моментального снимка hello SAP HANA</span><span class="sxs-lookup"><span data-stu-id="fe643-117">Prepare for a storage snapshot by initiating hello SAP HANA snapshot</span></span>
- <span data-ttu-id="fe643-118">Запустите моментального снимка хранилища hello (например моментальных снимков Azure blob)</span><span class="sxs-lookup"><span data-stu-id="fe643-118">Run hello storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="fe643-119">Подтвердите моментального снимка hello SAP HANA</span><span class="sxs-lookup"><span data-stu-id="fe643-119">Confirm hello SAP HANA snapshot</span></span>

![Создание моментального снимка данных SAP HANA с помощью инструкции SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="fe643-121">На рисунке выше показан процесс создания моментального снимка данных SAP HANA с помощью инструкции SQL.</span><span class="sxs-lookup"><span data-stu-id="fe643-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![моментальный снимок затем Hello также отображается в каталог резервных копий hello в SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="fe643-123">Hello, затем моментальных снимков также отображается в каталог резервных копий hello в SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="fe643-123">hello snapshot then also appears in hello backup catalog in SAP HANA Studio.</span></span>

![На диске hello моментальных снимков отображается в каталоге данных SAP HANA hello](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="fe643-125">На диске моментальный снимок hello отображается в каталоге данных SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-125">On disk, hello snapshot shows up in hello SAP HANA data directory.</span></span>

<span data-ttu-id="fe643-126">Один имеет tooensure, перед запуском моментального снимка хранилища hello при SAP HANA в режиме подготовки hello моментальных снимков также гарантируется hello целостность файловой системы.</span><span class="sxs-lookup"><span data-stu-id="fe643-126">One has tooensure that hello file system consistency is also guaranteed before running hello storage snapshot while SAP HANA is in hello snapshot preparation mode.</span></span> <span data-ttu-id="fe643-127">В разделе _целостности данных SAP HANA, когда создание хранилища моментальных снимков_ в соответствующей статье hello [резервной копии руководства по SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="fe643-127">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="fe643-128">После этого моментального снимка хранилища hello является моментальным снимком SAP HANA hello критических tooconfirm.</span><span class="sxs-lookup"><span data-stu-id="fe643-128">Once hello storage snapshot is done, it is critical tooconfirm hello SAP HANA snapshot.</span></span> <span data-ttu-id="fe643-129">Отсутствует соответствующий toorun инструкции SQL: ЗАКРЫТЬ моментального СНИМКА данных резервной копии (см. [инструкции BACKUP данных ЗАКРЫТЬ моментальных СНИМКОВ (резервное копирование и восстановление)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="fe643-129">There is a corresponding SQL statement toorun: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fe643-130">Подтвердите моментального снимка HANA hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-130">Confirm hello HANA snapshot.</span></span> <span data-ttu-id="fe643-131">Из-за слишком&quot;копирования при записи,&quot; SAP HANA может потребоваться дополнительное место на диске в моментальный снимок подготовить режиме и не будет возможности toostart новых резервных копий до моментального снимка SAP HANA hello подтверждается.</span><span class="sxs-lookup"><span data-stu-id="fe643-131">Due too&quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible toostart new backups until hello SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="fe643-132">Резервное копирование виртуальной машины HANA с помощью службы архивации Azure</span><span class="sxs-lookup"><span data-stu-id="fe643-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="fe643-133">Начиная с 2016 декабря hello резервного копирования из hello службы резервного копирования Azure недоступна для виртуальных машин Linux.</span><span class="sxs-lookup"><span data-stu-id="fe643-133">As of December 2016, hello backup agent of hello Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="fe643-134">Использование toomake Azure резервного копирования на уровне файла или каталога hello, один скопируйте файлы резервной копии SAP HANA tooa виртуальной Машины Windows и затем с помощью агента резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-134">toomake use of Azure backup on hello file/directory level, one would copy SAP HANA backup files tooa Windows VM and then use hello backup agent.</span></span> <span data-ttu-id="fe643-135">В противном случае через службу архивации Azure hello возможна только полной резервной копии виртуальной Машины с Linux.</span><span class="sxs-lookup"><span data-stu-id="fe643-135">Otherwise, only a full Linux VM backup is possible via hello Azure Backup service.</span></span> <span data-ttu-id="fe643-136">В разделе [hello Обзор функций в Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="fe643-136">See [Overview of hello features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind out more.</span></span>

<span data-ttu-id="fe643-137">Hello службы архивации Azure предлагает параметр tooback и восстановление виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="fe643-137">hello Azure Backup service offers an option tooback up and restore a VM.</span></span> <span data-ttu-id="fe643-138">Дополнительные сведения об этой службе и принцип работы можно найти в статье hello [Спланируйте инфраструктуру резервного копирования виртуальной Машины в Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="fe643-138">More information about this service and how it works can be found in hello article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="fe643-139">Существуют два важных аспекта, toothat статьи в соответствии с:</span><span class="sxs-lookup"><span data-stu-id="fe643-139">There are two important considerations according toothat article:</span></span>

<span data-ttu-id="fe643-140">_&quot;Для виртуальных машин Linux только совместимые в файлами резервных копий возможны, поскольку отсутствует tooVSS эквивалент платформы Linux.&quot;_</span><span class="sxs-lookup"><span data-stu-id="fe643-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform tooVSS.&quot;_</span></span>

<span data-ttu-id="fe643-141">_&quot;Приложения должны tooimplement собственные &quot;исправления&quot; hello с помощью механизма восстановления данных.&quot;_</span><span class="sxs-lookup"><span data-stu-id="fe643-141">_&quot;Applications need tooimplement their own &quot;fix-up&quot; mechanism on hello restored data.&quot;_</span></span>

<span data-ttu-id="fe643-142">Таким образом один имеет toomake том, что SAP HANA в согласованное состояние на диске при запуске резервного копирования hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-142">Therefore, one has toomake sure SAP HANA is in a consistent state on disk when hello backup starts.</span></span> <span data-ttu-id="fe643-143">В разделе _моментальные снимки SAP HANA_ описанных ранее в документе hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-143">See _SAP HANA snapshots_ described earlier in hello document.</span></span> <span data-ttu-id="fe643-144">Но когда SAP HANA находится в режиме подготовки моментального снимка, существует одна потенциальная проблема.</span><span class="sxs-lookup"><span data-stu-id="fe643-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="fe643-145">Дополнительные сведения см. в статье [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) (Создание моментального снимка хранилища (SAP HANA Studio)).</span><span class="sxs-lookup"><span data-stu-id="fe643-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="fe643-146">В этой статье указано:</span><span class="sxs-lookup"><span data-stu-id="fe643-146">That article states:</span></span>

<span data-ttu-id="fe643-147">_&quot;Он настоятельно рекомендуется tooconfirm или отказаться от хранения моментального снимка как можно быстрее после его создания. Хотя моментального снимка хранилища hello подготавливается или создания hello моментальный снимок релевантных данных заморожен. Пока hello, важные для моментального снимка данных остается фиксированным, изменения можно по-прежнему выполняться в базе данных hello. Такие изменения не вызовет hello заморожен toobe моментальный снимок релевантных данных изменен. Вместо этого hello записываются изменения toopositions в области данных hello, отделенные от моментального снимка хранилища hello. Toohello журнал также записываются изменения. Однако hello больше hello моментального снимка, важные данные хранятся замороженный, hello дополнительные hello, который может увеличиваться объем данных.&quot;_</span><span class="sxs-lookup"><span data-stu-id="fe643-147">_&quot;It is strongly recommended tooconfirm or abandon a storage snapshot as soon as possible after it has been created. While hello storage snapshot is being prepared or created, hello snapshot-relevant data is frozen. While hello snapshot-relevant data remains frozen, changes can still be made in hello database. Such changes will not cause hello frozen snapshot-relevant data toobe changed. Instead, hello changes are written toopositions in hello data area that are separate from hello storage snapshot. Changes are also written toohello log. However, hello longer hello snapshot-relevant data is kept frozen, hello more hello data volume can grow.&quot;_</span></span>

<span data-ttu-id="fe643-148">Резервное копирование Azure обеспечивает целостность файловой системы hello через расширения виртуальной Машины Azure.</span><span class="sxs-lookup"><span data-stu-id="fe643-148">Azure Backup takes care of hello file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="fe643-149">Отдельно эти расширения недоступны. Они работают только в сочетании со службой архивации Azure.</span><span class="sxs-lookup"><span data-stu-id="fe643-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="fe643-150">Тем не менее она по-прежнему требование toomanage согласованности приложения SAP HANA tooguarantee моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="fe643-150">Nevertheless, it is still a requirement toomanage an SAP HANA snapshot tooguarantee app consistency.</span></span>

<span data-ttu-id="fe643-151">Служба архивации Azure выполняет два основных этапа:</span><span class="sxs-lookup"><span data-stu-id="fe643-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="fe643-152">создание снимка;</span><span class="sxs-lookup"><span data-stu-id="fe643-152">Take Snapshot</span></span>
- <span data-ttu-id="fe643-153">Передача данных toovault</span><span class="sxs-lookup"><span data-stu-id="fe643-153">Transfer data toovault</span></span>

<span data-ttu-id="fe643-154">Поэтому одним удалось подтвердить моментального снимка hello SAP HANA, после завершения фазы службы архивации Azure hello создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="fe643-154">So one could confirm hello SAP HANA snapshot once hello Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="fe643-155">Может занять несколько минут toosee в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="fe643-155">It might take several minutes toosee in hello Azure portal.</span></span>

![На рисунке показана часть списка задание резервного копирования hello службы архивации Azure](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="fe643-157">На рисунке показана часть списка задание резервного копирования hello резервного копирования Azure службы, которая была используется tooback теста HANA hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="fe643-157">This figure shows part of hello backup job list of an Azure Backup service, which was used tooback up hello HANA test VM.</span></span>

![сведения о задании hello tooshow, выберите задание резервного копирования hello в hello портал Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="fe643-159">сведения о задании hello tooshow, выберите задание резервного копирования hello в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="fe643-159">tooshow hello job details, click hello backup job in hello Azure portal.</span></span> <span data-ttu-id="fe643-160">Здесь увидит, hello два этапа.</span><span class="sxs-lookup"><span data-stu-id="fe643-160">Here, one can see hello two phases.</span></span> <span data-ttu-id="fe643-161">Он может занять несколько минут, пока не будет показан этап hello моментальных снимков, как завершенное.</span><span class="sxs-lookup"><span data-stu-id="fe643-161">It might take a few minutes until it shows hello snapshot phase as completed.</span></span> <span data-ttu-id="fe643-162">Большую часть времени hello затрачивается на этапе передачи данных hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-162">Most of hello time is spent in hello data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="fe643-163">Автоматизация резервного копирования виртуальной машины HANA с помощью службы архивации Azure</span><span class="sxs-lookup"><span data-stu-id="fe643-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="fe643-164">Один удалось подтвердить моментального снимка hello SAP HANA, вручную после завершения резервного копирования Azure моментального снимка фазы hello, как описано выше, но это полезно tooconsider автоматизации, так как администратор не может отслеживать список hello задание резервного копирования в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="fe643-164">One could manually confirm hello SAP HANA snapshot once hello Azure Backup snapshot phase is completed, as described earlier, but it is helpful tooconsider automation because an admin might not monitor hello backup job list in hello Azure portal.</span></span>

<span data-ttu-id="fe643-165">Ниже описано, как это можно сделать с помощью командлетов Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fe643-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Служба резервного копирования Azure был создан с hello имя hana хранилища резервных копий-](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="fe643-167">Служба резервного копирования Azure был создан с именем hello &quot;hana-резервного копирования-хранилище.&quot; hello команды PS **Get AzureRmRecoveryServicesVault-имя хранилища для резервных копий hana** извлекает hello соответствующего объекта.</span><span class="sxs-lookup"><span data-stu-id="fe643-167">An Azure Backup service was created with hello name &quot;hana-backup-vault.&quot; hello PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves hello corresponding object.</span></span> <span data-ttu-id="fe643-168">Этот объект доступен, а затем используется tooset hello контекста резервного копирования, как показано на следующем рисунке hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-168">This object is then used tooset hello backup context as seen on hello next figure.</span></span>

![Можно проверить для задания резервного копирования hello в настоящий момент](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="fe643-170">После правильного контекста hello параметр один проверки для задания резервного копирования hello в настоящее время и найдите его сведений о задании.</span><span class="sxs-lookup"><span data-stu-id="fe643-170">After setting hello correct context, one can check for hello backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="fe643-171">Hello подзадаче перечислены Если этап hello Azure задание резервного копирования моментальных снимков hello уже завершена.</span><span class="sxs-lookup"><span data-stu-id="fe643-171">hello subtask list shows if hello snapshot phase of hello Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Значение hello опроса в цикле, пока она отключает tooCompleted](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="fe643-173">Как только сведения о задании hello хранятся в переменной, он просто PS синтаксис tooget toohello первый элемент массива и получить значение состояния hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-173">Once hello job details are stored in a variable, it is simply PS syntax tooget toohello first array entry and retrieve hello status value.</span></span> <span data-ttu-id="fe643-174">сценарий автоматизации toocomplete hello, значение hello опроса в цикле, пока он становится слишком&quot;завершено.&quot;</span><span class="sxs-lookup"><span data-stu-id="fe643-174">toocomplete hello automation script, poll hello value in a loop until it turns too&quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="fe643-175">Восстановление виртуальной машины и лицензионного ключа HANA в службе архивации Azure</span><span class="sxs-lookup"><span data-stu-id="fe643-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="fe643-176">Hello службы архивации Azure — спроектированный toocreate новой виртуальной Машины во время восстановления.</span><span class="sxs-lookup"><span data-stu-id="fe643-176">hello Azure Backup service is designed toocreate a new VM during restore.</span></span> <span data-ttu-id="fe643-177">Не существует плана прямо сейчас toodo &quot;на месте&quot; восстановление существующей виртуальной Машине Azure.</span><span class="sxs-lookup"><span data-stu-id="fe643-177">There is no plan right now toodo an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![На этом рисунке показано возможность восстановления hello hello службы Azure в hello портал Azure](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="fe643-179">На этом рисунке показано возможность восстановления hello hello службы Azure в hello портал Azure.</span><span class="sxs-lookup"><span data-stu-id="fe643-179">This figure shows hello restore option of hello Azure service in hello Azure portal.</span></span> <span data-ttu-id="fe643-180">Один можно выбрать Создание виртуальной Машины во время восстановления или восстановление дисков hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-180">One can choose between creating a VM during restore or restoring hello disks.</span></span> <span data-ttu-id="fe643-181">После восстановления дисков hello, это по-прежнему необходимо toocreate на основе новой виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="fe643-181">After restoring hello disks, it is still necessary toocreate a new VM on top of it.</span></span> <span data-ttu-id="fe643-182">Каждый раз, когда создаваемой новой виртуальной Машины в Azure hello уникальный ИД виртуальной Машины изменения (см. [получение и использование уникальный идентификатор виртуальной Машины Azure](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="fe643-182">Whenever a new VM gets created on Azure hello unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![На этом рисунке показано уникальный идентификатор виртуальной Машины Azure hello до и после восстановления hello через службы архивации Azure](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="fe643-184">На рисунке показаны уникальный идентификатор виртуальной Машины Azure hello до и после восстановления hello через службы архивации Azure.</span><span class="sxs-lookup"><span data-stu-id="fe643-184">This figure shows hello Azure VM unique ID before and after hello restore via Azure Backup service.</span></span> <span data-ttu-id="fe643-185">Hello SAP аппаратный ключ, который используется для лицензирования SAP, использует этот уникальный идентификатор виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="fe643-185">hello SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="fe643-186">Как следствие новая лицензия SAP имеет toobe установки после восстановления виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="fe643-186">As a consequence, a new SAP license has toobe installed after a VM restore.</span></span>

<span data-ttu-id="fe643-187">Новая функция резервного копирования Azure был предоставлен в режиме предварительного просмотра во время создания hello данного руководства резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="fe643-187">A new Azure Backup feature was presented in preview mode during hello creation of this backup guide.</span></span> <span data-ttu-id="fe643-188">Она позволяет уровня восстановления файлов на основе моментального снимка виртуальной Машины hello, был сделан для hello ВМ резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="fe643-188">It allows a file level restore based on hello VM snapshot that was taken for hello VM backup.</span></span> <span data-ttu-id="fe643-189">Это позволяет избежать необходимости hello toodeploy новых виртуальных Машин и таким образом hello hello уникальный ИД виртуальной Машины остается таким же и лицензионный ключ SAP HANA не является обязательным.</span><span class="sxs-lookup"><span data-stu-id="fe643-189">This avoids hello need toodeploy a new VM, and therefore hello unique VM ID stays hello same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="fe643-190">Дополнительная документация будет предоставлена, когда эта функция будет полностью протестирована.</span><span class="sxs-lookup"><span data-stu-id="fe643-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="fe643-191">Резервное копирование Azure в конечном итоге позволит резервных копий отдельных Azure виртуальных дисков, а также файлы и каталоги из внутри hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="fe643-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside hello VM.</span></span> <span data-ttu-id="fe643-192">Важное преимущество службы архивации Azure — его управление все резервные копии hello, сохранение hello клиентов от необходимости toodo его.</span><span class="sxs-lookup"><span data-stu-id="fe643-192">A major advantage of Azure Backup is its management of all hello backups, saving hello customer from having toodo it.</span></span> <span data-ttu-id="fe643-193">В случае необходимости восстановления резервного копирования Azure будет выбирать правильный резервного копирования toouse hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-193">If a restore becomes necessary, Azure Backup will select hello correct backup toouse.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="fe643-194">Создание резервной копии виртуальной машины SAP HANA вручную с помощью моментального снимка диска</span><span class="sxs-lookup"><span data-stu-id="fe643-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="fe643-195">Вместо использования службы архивации Azure hello, один настроить отдельное решение резервного копирования путем создания моментальных снимков больших двоичных объектов Azure виртуальные жесткие диски вручную через PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fe643-195">Instead of using hello Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="fe643-196">В разделе [моментальные снимки больших двоичных объектов с помощью PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) описание действия hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of hello steps.</span></span>

<span data-ttu-id="fe643-197">Он обеспечивает большую гибкость, но не приводит к устранению проблем hello описано ранее в этом документе:</span><span class="sxs-lookup"><span data-stu-id="fe643-197">It provides more flexibility but does not resolve hello issues explained earlier in this document:</span></span>

- <span data-ttu-id="fe643-198">Пользователи по-прежнему должны обеспечивать согласованность системы SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="fe643-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="fe643-199">Hello диск ОС не может быть перезаписан, даже если существует Виртуальная машина освобождена из-за ошибки, о том, что аренда приветствия.</span><span class="sxs-lookup"><span data-stu-id="fe643-199">hello OS disk cannot be overwritten even if hello VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="fe643-200">Работает только после удаления виртуальной Машины, что может привести к tooa новый уникальный ИД виртуальной Машины и hello необходимость tooinstall новая лицензия SAP "hello".</span><span class="sxs-lookup"><span data-stu-id="fe643-200">It only works after deleting hello VM, which would lead tooa new unique VM ID and hello need tooinstall a new SAP license.</span></span>

![Это возможно toorestore только hello дисков данных ВМ Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="fe643-202">Она возможных toorestore hello дисков данных виртуальной машины Azure, как избежать проблемы hello получения новый уникальный идентификатор виртуальной Машины и таким образом, недействительным hello SAP лицензии:</span><span class="sxs-lookup"><span data-stu-id="fe643-202">It is possible toorestore only hello data disks of an Azure VM, avoiding hello problem of getting a new unique VM ID and, therefore, invalidated hello SAP license:</span></span>

- <span data-ttu-id="fe643-203">Для теста hello двух дисков данных Azure были tooa подключенных виртуальных Машин и программное обеспечение RAID был определен на их основе</span><span class="sxs-lookup"><span data-stu-id="fe643-203">For hello test, two Azure data disks were attached tooa VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="fe643-204">С помощью функции создания моментальных снимков SAP HANA подтвердили, что система SAP HANA находится в согласованном состоянии.</span><span class="sxs-lookup"><span data-stu-id="fe643-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="fe643-205">Закрепить файловой системы (в разделе _целостности данных SAP HANA, когда создание хранилища моментальных снимков_ в соответствующей статье hello [резервной копии руководства по SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="fe643-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="fe643-206">Сделали моментальные снимки больших двоичных объектов обоих дисков данных.</span><span class="sxs-lookup"><span data-stu-id="fe643-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="fe643-207">Освободили файловую систему.</span><span class="sxs-lookup"><span data-stu-id="fe643-207">File system unfreeze</span></span>
- <span data-ttu-id="fe643-208">Подтвердили моментальный снимок SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="fe643-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="fe643-209">дисков с данными hello toorestore hello виртуальной Машины была завершена, и отсоединенные оба диска</span><span class="sxs-lookup"><span data-stu-id="fe643-209">toorestore hello data disks, hello VM was shut down and both disks detached</span></span>
- <span data-ttu-id="fe643-210">После отсоединения hello дисков, они были заменены моментальные снимки бывшей большого двоичного объекта hello</span><span class="sxs-lookup"><span data-stu-id="fe643-210">After detaching hello disks, they were overwritten with hello former blob snapshots</span></span>
- <span data-ttu-id="fe643-211">Затем восстановлена hello виртуальные диски были вложены снова toohello виртуальной Машины</span><span class="sxs-lookup"><span data-stu-id="fe643-211">Then hello restored virtual disks were attached again toohello VM</span></span>
- <span data-ttu-id="fe643-212">После начала hello виртуальной Машины, все данные на программное обеспечение hello RAID работал правильно и было задано toohello больших двоичных объектов обратно время моментального снимка</span><span class="sxs-lookup"><span data-stu-id="fe643-212">After starting hello VM, everything on hello software RAID worked fine and was set back toohello blob snapshot time</span></span>
- <span data-ttu-id="fe643-213">HANA было снова установить моментального снимка toohello HANA</span><span class="sxs-lookup"><span data-stu-id="fe643-213">HANA was set back toohello HANA snapshot</span></span>

<span data-ttu-id="fe643-214">Если это было возможно tooshut вниз SAP HANA перед моментальные снимки большого двоичного объекта hello, процедура hello будет менее сложные.</span><span class="sxs-lookup"><span data-stu-id="fe643-214">If it was possible tooshut down SAP HANA before hello blob snapshots, hello procedure would be less complex.</span></span> <span data-ttu-id="fe643-215">В этом случае один может пропустить моментального снимка HANA hello и, никаких других происходит в системе hello также избежать зависания системы файл hello.</span><span class="sxs-lookup"><span data-stu-id="fe643-215">In that case, one could skip hello HANA snapshot and, if nothing else is going on in hello system, also skip hello file system freeze.</span></span> <span data-ttu-id="fe643-216">Добавленная сложность появляется изображение hello при необходимости toodo моментальные снимки, пока все, что находится в оперативном режиме.</span><span class="sxs-lookup"><span data-stu-id="fe643-216">Added complexity comes into hello picture when it is necessary toodo snapshots while everything is online.</span></span> <span data-ttu-id="fe643-217">В разделе _целостности данных SAP HANA, когда создание хранилища моментальных снимков_ в соответствующей статье hello [резервной копии руководства по SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="fe643-217">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="fe643-218">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="fe643-218">Next steps</span></span>
* <span data-ttu-id="fe643-219">Общие сведения и информацию о начале работы см. в [руководстве по резервному копированию SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="fe643-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="fe643-220">[SAP HANA резервного копирования в зависимости от уровня файла](sap-hana-backup-file-level.md) деле hello параметра резервного копирования на основе файлов.</span><span class="sxs-lookup"><span data-stu-id="fe643-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>
* <span data-ttu-id="fe643-221">tooestablish высокого уровня доступности и план аварийного восстановления из SAP HANA в Azure (большие экземпляры). в статье toolearn [SAP HANA (крупных экземпляров) высокой доступности и аварийного восстановления в Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="fe643-221">toolearn how tooestablish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
