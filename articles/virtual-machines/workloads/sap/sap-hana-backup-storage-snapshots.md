---
title: "резервное копирование HANA Azure aaaSAP, основанные на моментальных снимках хранилища | Документы Microsoft"
description: "Существуют две основные возможности резервного копирования SAP HANA на виртуальных машинах Azure. В этой статье рассматривается резервное копирование на основе моментальных снимков хранилища."
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 32bb80f5a928a2cf63699bfe4f4cf5bbad81e6fe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a>Резервное копирование SAP HANA на основе моментальных снимков хранилища

## <a name="introduction"></a>Введение

Эта статья входит в цикл из трех связанных статей, посвященных резервному копированию SAP HANA. [Руководстве по резервному копированию для SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md) содержит обзор и сведения о начале работы и [SAP HANA Azure резервное копирование на уровне файлов](sap-hana-backup-file-level.md) деле hello параметра резервного копирования на основе файлов.

При использовании средств резервного копирования виртуальной Машины для одного экземпляра в одном демонстрационной системы, один попробовать сделать резервной копии виртуальной Машины вместо управления HANA резервные копии на уровне ОС hello. Альтернативой является tootake моментальные снимки больших двоичных объектов Azure toocreate копии отдельных виртуальных дисков, которые являются tooa подключенных виртуальных машин и сохранять файлы данных HANA hello. Но ключевой момент согласованности приложения при создании моментального снимка резервной копии или диск виртуальной Машины, пока открыт системы hello и запуске. В разделе _целостности данных SAP HANA, когда создание хранилища моментальных снимков_ в соответствующей статье hello [резервной копии руководства по SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md). SAP HANA имеет функцию, которая поддерживает такие типы моментальных снимков хранилища.

## <a name="sap-hana-snapshots"></a>Моментальные снимки SAP HANA

Система SAP HANA предоставляет функцию создания моментальных снимков хранилища. Тем не менее начиная с 2016 декабря, отсутствует ограничение систем toosingle контейнера. Мультитенантные конфигурации контейнеров не поддерживают этот тип моментального снимка базы данных. Дополнительные сведения см. в статье [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) (Создание моментального снимка хранилища (SAP HANA Studio)).

Процесс создания моментальных снимков хранилища состоит из следующих этапов:

- Подготовка моментального снимка хранилища, запуская моментального снимка hello SAP HANA
- Запустите моментального снимка хранилища hello (например моментальных снимков Azure blob)
- Подтвердите моментального снимка hello SAP HANA

![Создание моментального снимка данных SAP HANA с помощью инструкции SQL](media/sap-hana-backup-storage-snapshots/image011.png)

На рисунке выше показан процесс создания моментального снимка данных SAP HANA с помощью инструкции SQL.

![моментальный снимок затем Hello также отображается в каталог резервных копий hello в SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

Hello, затем моментальных снимков также отображается в каталог резервных копий hello в SAP HANA Studio.

![На диске hello моментальных снимков отображается в каталоге данных SAP HANA hello](media/sap-hana-backup-storage-snapshots/image013.png)

На диске моментальный снимок hello отображается в каталоге данных SAP HANA hello.

Один имеет tooensure, перед запуском моментального снимка хранилища hello при SAP HANA в режиме подготовки hello моментальных снимков также гарантируется hello целостность файловой системы. В разделе _целостности данных SAP HANA, когда создание хранилища моментальных снимков_ в соответствующей статье hello [резервной копии руководства по SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).

После этого моментального снимка хранилища hello является моментальным снимком SAP HANA hello критических tooconfirm. Отсутствует соответствующий toorun инструкции SQL: ЗАКРЫТЬ моментального СНИМКА данных резервной копии (см. [инструкции BACKUP данных ЗАКРЫТЬ моментальных СНИМКОВ (резервное копирование и восстановление)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).

> [!IMPORTANT]
> Подтвердите моментального снимка HANA hello. Из-за слишком&quot;копирования при записи,&quot; SAP HANA может потребоваться дополнительное место на диске в моментальный снимок подготовить режиме и не будет возможности toostart новых резервных копий до моментального снимка SAP HANA hello подтверждается.

## <a name="hana-vm-backup-via-azure-backup-service"></a>Резервное копирование виртуальной машины HANA с помощью службы архивации Azure

Начиная с 2016 декабря hello резервного копирования из hello службы резервного копирования Azure недоступна для виртуальных машин Linux. Использование toomake Azure резервного копирования на уровне файла или каталога hello, один скопируйте файлы резервной копии SAP HANA tooa виртуальной Машины Windows и затем с помощью агента резервного копирования hello. В противном случае через службу архивации Azure hello возможна только полной резервной копии виртуальной Машины с Linux. В разделе [hello Обзор функций в Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind дополнительных сведений.

Hello службы архивации Azure предлагает параметр tooback и восстановление виртуальной Машины. Дополнительные сведения об этой службе и принцип работы можно найти в статье hello [Спланируйте инфраструктуру резервного копирования виртуальной Машины в Azure](../../../backup/backup-azure-vms-introduction.md).

Существуют два важных аспекта, toothat статьи в соответствии с:

_&quot;Для виртуальных машин Linux только совместимые в файлами резервных копий возможны, поскольку отсутствует tooVSS эквивалент платформы Linux.&quot;_

_&quot;Приложения должны tooimplement собственные &quot;исправления&quot; hello с помощью механизма восстановления данных.&quot;_

Таким образом один имеет toomake том, что SAP HANA в согласованное состояние на диске при запуске резервного копирования hello. В разделе _моментальные снимки SAP HANA_ описанных ранее в документе hello. Но когда SAP HANA находится в режиме подготовки моментального снимка, существует одна потенциальная проблема. Дополнительные сведения см. в статье [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) (Создание моментального снимка хранилища (SAP HANA Studio)).

В этой статье указано:

_&quot;Он настоятельно рекомендуется tooconfirm или отказаться от хранения моментального снимка как можно быстрее после его создания. Хотя моментального снимка хранилища hello подготавливается или создания hello моментальный снимок релевантных данных заморожен. Пока hello, важные для моментального снимка данных остается фиксированным, изменения можно по-прежнему выполняться в базе данных hello. Такие изменения не вызовет hello заморожен toobe моментальный снимок релевантных данных изменен. Вместо этого hello записываются изменения toopositions в области данных hello, отделенные от моментального снимка хранилища hello. Toohello журнал также записываются изменения. Однако hello больше hello моментального снимка, важные данные хранятся замороженный, hello дополнительные hello, который может увеличиваться объем данных.&quot;_

Резервное копирование Azure обеспечивает целостность файловой системы hello через расширения виртуальной Машины Azure. Отдельно эти расширения недоступны. Они работают только в сочетании со службой архивации Azure. Тем не менее она по-прежнему требование toomanage согласованности приложения SAP HANA tooguarantee моментального снимка.

Служба архивации Azure выполняет два основных этапа:

- создание снимка;
- Передача данных toovault

Поэтому одним удалось подтвердить моментального снимка hello SAP HANA, после завершения фазы службы архивации Azure hello создания моментального снимка. Может занять несколько минут toosee в hello портал Azure.

![На рисунке показана часть списка задание резервного копирования hello службы архивации Azure](media/sap-hana-backup-storage-snapshots/image014.png)

На рисунке показана часть списка задание резервного копирования hello резервного копирования Azure службы, которая была используется tooback теста HANA hello виртуальной Машины.

![сведения о задании hello tooshow, выберите задание резервного копирования hello в hello портал Azure](media/sap-hana-backup-storage-snapshots/image015.png)

сведения о задании hello tooshow, выберите задание резервного копирования hello в hello портал Azure. Здесь увидит, hello два этапа. Он может занять несколько минут, пока не будет показан этап hello моментальных снимков, как завершенное. Большую часть времени hello затрачивается на этапе передачи данных hello.

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a>Автоматизация резервного копирования виртуальной машины HANA с помощью службы архивации Azure

Один удалось подтвердить моментального снимка hello SAP HANA, вручную после завершения резервного копирования Azure моментального снимка фазы hello, как описано выше, но это полезно tooconsider автоматизации, так как администратор не может отслеживать список hello задание резервного копирования в hello портал Azure.

Ниже описано, как это можно сделать с помощью командлетов Azure PowerShell.

![Служба резервного копирования Azure был создан с hello имя hana хранилища резервных копий-](media/sap-hana-backup-storage-snapshots/image016.png)

Служба резервного копирования Azure был создан с именем hello &quot;hana-резервного копирования-хранилище.&quot; hello команды PS **Get AzureRmRecoveryServicesVault-имя хранилища для резервных копий hana** извлекает hello соответствующего объекта. Этот объект доступен, а затем используется tooset hello контекста резервного копирования, как показано на следующем рисунке hello.

![Можно проверить для задания резервного копирования hello в настоящий момент](media/sap-hana-backup-storage-snapshots/image017.png)

После правильного контекста hello параметр один проверки для задания резервного копирования hello в настоящее время и найдите его сведений о задании. Hello подзадаче перечислены Если этап hello Azure задание резервного копирования моментальных снимков hello уже завершена.

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Значение hello опроса в цикле, пока она отключает tooCompleted](media/sap-hana-backup-storage-snapshots/image018.png)

Как только сведения о задании hello хранятся в переменной, он просто PS синтаксис tooget toohello первый элемент массива и получить значение состояния hello. сценарий автоматизации toocomplete hello, значение hello опроса в цикле, пока он становится слишком&quot;завершено.&quot;

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a>Восстановление виртуальной машины и лицензионного ключа HANA в службе архивации Azure

Hello службы архивации Azure — спроектированный toocreate новой виртуальной Машины во время восстановления. Не существует плана прямо сейчас toodo &quot;на месте&quot; восстановление существующей виртуальной Машине Azure.

![На этом рисунке показано возможность восстановления hello hello службы Azure в hello портал Azure](media/sap-hana-backup-storage-snapshots/image019.png)

На этом рисунке показано возможность восстановления hello hello службы Azure в hello портал Azure. Один можно выбрать Создание виртуальной Машины во время восстановления или восстановление дисков hello. После восстановления дисков hello, это по-прежнему необходимо toocreate на основе новой виртуальной Машины. Каждый раз, когда создаваемой новой виртуальной Машины в Azure hello уникальный ИД виртуальной Машины изменения (см. [получение и использование уникальный идентификатор виртуальной Машины Azure](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).

![На этом рисунке показано уникальный идентификатор виртуальной Машины Azure hello до и после восстановления hello через службы архивации Azure](media/sap-hana-backup-storage-snapshots/image020.png)

На рисунке показаны уникальный идентификатор виртуальной Машины Azure hello до и после восстановления hello через службы архивации Azure. Hello SAP аппаратный ключ, который используется для лицензирования SAP, использует этот уникальный идентификатор виртуальной Машины. Как следствие новая лицензия SAP имеет toobe установки после восстановления виртуальной Машины.

Новая функция резервного копирования Azure был предоставлен в режиме предварительного просмотра во время создания hello данного руководства резервного копирования. Она позволяет уровня восстановления файлов на основе моментального снимка виртуальной Машины hello, был сделан для hello ВМ резервного копирования. Это позволяет избежать необходимости hello toodeploy новых виртуальных Машин и таким образом hello hello уникальный ИД виртуальной Машины остается таким же и лицензионный ключ SAP HANA не является обязательным. Дополнительная документация будет предоставлена, когда эта функция будет полностью протестирована.

Резервное копирование Azure в конечном итоге позволит резервных копий отдельных Azure виртуальных дисков, а также файлы и каталоги из внутри hello виртуальной Машины. Важное преимущество службы архивации Azure — его управление все резервные копии hello, сохранение hello клиентов от необходимости toodo его. В случае необходимости восстановления резервного копирования Azure будет выбирать правильный резервного копирования toouse hello.

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a>Создание резервной копии виртуальной машины SAP HANA вручную с помощью моментального снимка диска

Вместо использования службы архивации Azure hello, один настроить отдельное решение резервного копирования путем создания моментальных снимков больших двоичных объектов Azure виртуальные жесткие диски вручную через PowerShell. В разделе [моментальные снимки больших двоичных объектов с помощью PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) описание действия hello.

Он обеспечивает большую гибкость, но не приводит к устранению проблем hello описано ранее в этом документе:

- Пользователи по-прежнему должны обеспечивать согласованность системы SAP HANA.
- Hello диск ОС не может быть перезаписан, даже если существует Виртуальная машина освобождена из-за ошибки, о том, что аренда приветствия. Работает только после удаления виртуальной Машины, что может привести к tooa новый уникальный ИД виртуальной Машины и hello необходимость tooinstall новая лицензия SAP "hello".

![Это возможно toorestore только hello дисков данных ВМ Azure](media/sap-hana-backup-storage-snapshots/image021.png)

Она возможных toorestore hello дисков данных виртуальной машины Azure, как избежать проблемы hello получения новый уникальный идентификатор виртуальной Машины и таким образом, недействительным hello SAP лицензии:

- Для теста hello двух дисков данных Azure были tooa подключенных виртуальных Машин и программное обеспечение RAID был определен на их основе 
- С помощью функции создания моментальных снимков SAP HANA подтвердили, что система SAP HANA находится в согласованном состоянии.
- Закрепить файловой системы (в разделе _целостности данных SAP HANA, когда создание хранилища моментальных снимков_ в соответствующей статье hello [резервной копии руководства по SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md))
- Сделали моментальные снимки больших двоичных объектов обоих дисков данных.
- Освободили файловую систему.
- Подтвердили моментальный снимок SAP HANA.
- дисков с данными hello toorestore hello виртуальной Машины была завершена, и отсоединенные оба диска
- После отсоединения hello дисков, они были заменены моментальные снимки бывшей большого двоичного объекта hello
- Затем восстановлена hello виртуальные диски были вложены снова toohello виртуальной Машины
- После начала hello виртуальной Машины, все данные на программное обеспечение hello RAID работал правильно и было задано toohello больших двоичных объектов обратно время моментального снимка
- HANA было снова установить моментального снимка toohello HANA

Если это было возможно tooshut вниз SAP HANA перед моментальные снимки большого двоичного объекта hello, процедура hello будет менее сложные. В этом случае один может пропустить моментального снимка HANA hello и, никаких других происходит в системе hello также избежать зависания системы файл hello. Добавленная сложность появляется изображение hello при необходимости toodo моментальные снимки, пока все, что находится в оперативном режиме. В разделе _целостности данных SAP HANA, когда создание хранилища моментальных снимков_ в соответствующей статье hello [резервной копии руководства по SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).

## <a name="next-steps"></a>Дальнейшие действия
* Общие сведения и информацию о начале работы см. в [руководстве по резервному копированию SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).
* [SAP HANA резервного копирования в зависимости от уровня файла](sap-hana-backup-file-level.md) деле hello параметра резервного копирования на основе файлов.
* tooestablish высокого уровня доступности и план аварийного восстановления из SAP HANA в Azure (большие экземпляры). в статье toolearn [SAP HANA (крупных экземпляров) высокой доступности и аварийного восстановления в Azure](hana-overview-high-availability-disaster-recovery.md).
