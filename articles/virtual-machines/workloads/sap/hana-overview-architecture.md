---
title: "Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт"
description: "Основные сведения об архитектуре и развертывании SAP HANA в Azure (крупные экземпляры)."
services: virtual-machines-linux
documentationcenter: 
author: RicksterCDN
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 10/02/2017
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 63e1820033e051b72601291c5206772192e68769
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="sap-hana-large-instances-overview-and-architecture-on-azure"></a>Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)

## <a name="what-is-sap-hana-on-azure-large-instances"></a>Что такое SAP HANA в Azure (большие экземпляры)?

SAP HANA в Azure (крупные экземпляры) — это уникальное решение для Azure. Помимо предоставления виртуальных машин Azure с целью развертывания и выполнения SAP HANA платформа Azure также предлагает возможность выполнения и развертывания SAP HANA на серверах без операционной системы, которые выделены для вас как клиента. Решение SAP HANA в Azure (крупные экземпляры) основано на оборудовании узла (сервера) без общего доступа и без операционной системы, которое назначается вам как клиенту. Оборудование сервера внедряется в более крупные стеки, которые содержат вычислительную и сетевую инфраструктуру, а также инфраструктуру сервера и хранилища. Оно является сертифицированным оборудованием HANA TDI. Предложение службы SAP HANA в Azure (крупные экземпляры) предоставляет различные номера SKU или размеры серверов, начиная с экземпляров, имеющих 72 ЦП и 768 ГБ памяти, и заканчивая экземплярами с 960 ЦП и 20 ТБ памяти.

Изоляция пользователей внутри стека инфраструктуры выполняется в клиентах. Подробно это выглядит следующим образом:

- Сети. Изоляция пользователей в стеке инфраструктуры с помощью виртуальных сетей для каждого назначенного пользователю клиента. Клиент назначается только одному клиенту. Пользователь может иметь несколько клиентов. Сетевая изоляция клиентов запрещает взаимодействие между клиентами по сети на уровне стека инфраструктуры. Даже если клиенты принадлежат одному пользователю.
- Компоненты хранилища. Изоляция с помощью виртуальных машин хранилища, которые имеют назначенные им тома хранилища. Тома хранилища могут назначаться только одной виртуальной машине хранилища. Виртуальная машина хранилища назначается монопольно одному клиенту в сертифицированном стеке инфраструктуры SAP HANA TDI. В результате доступ к томам хранилища, назначенным виртуальной машине хранилища, можно получить только через один определенный и связанный клиент. И они не видны между разными развернутыми клиентами.
- Сервер или узел. Экземпляр сервера или узла не может использоваться одновременно несколькими пользователями или клиентами. Сервер или узел, развернутый для пользователя, является атомарной единицей вычисления без операционной системы, назначенной одному клиенту. Секционирование оборудования или программного обеспечения **не используется**, поэтому вы, как пользователь, не можете предоставить другому пользователю общий доступ к узлу или серверу. Тома хранилища, назначенные виртуальной машине хранилища определенного клиента, подключаются к такому серверу. Клиент может иметь от одного до множества экземпляров сервера с различными номерами SKU, назначенных им монопольно.
- В стеке инфраструктуры SAP HANA в Azure (крупные экземпляры) множество различных клиентов развертывается и изолируется друг от друга с помощью концепций клиента на уровне сети, хранилища и вычислений. 


Эти экземпляры сервера без операционной системы поддерживают только выполнение SAP HANA. Слой приложения или ПО промежуточного слоя рабочих нагрузок SAP выполняется на виртуальных машинах Microsoft Azure. Стеки инфраструктуры, в которых выполняются экземпляры SAP HANA в Azure (крупные экземпляры), подключаются к магистралям сети Azure, что позволяет обеспечить подключение с низкой задержкой между экземплярами SAP HANA в Azure (крупные экземпляры) и виртуальными машинами Azure.

Это один из пяти документов, посвященных теме SAP HANA в Azure (крупные экземпляры). В этом документе мы пройдем по базовой архитектуре, обязанностям, предоставляемым службам, а также в общих чертах рассмотрим возможности решения. Большинство вопросов, таких как принципы работы сетей и подключений, подробно рассматривается в остальных четырех документах. В документации по SAP HANA в Azure (крупные экземпляры) не охвачены вопросы установки SAP NetWeaver или развертывания SAP NetWeaver на виртуальных машинах Azure. Эта тема раскрывается в отдельном документе, который находится в том же контейнере документации. 


В этом руководстве рассматриваются следующие темы:

- [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](hana-overview-architecture.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
- [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
- [Как установить и настроить SAP HANA в Azure (крупные экземпляры)](hana-installation.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
- [Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)](hana-overview-high-availability-disaster-recovery.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
- [Как устранять неполадки и отслеживать работу SAP HANA (крупные экземпляры) в Azure](troubleshooting-monitoring.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

## <a name="definitions"></a>Определения

В этом руководстве широко используются некоторые общие определения. Ознакомьтесь со следующими терминами и их описанием.

- **IaaS:** инфраструктура как услуга.
- **PaaS:** платформа как услуга.
- **SaaS:** программное обеспечение как услуга.
- **Компонент SAP:** отдельное приложение SAP, например ECC, BW, Solution Manager или EP. Компоненты SAP могут основываться на традиционной технологии ABAP или Java или быть приложениями не на основе NetWeaver, например бизнес-объектами.
- **Среда SAP:** один или несколько компонентов SAP, логически сгруппированных для выполнения бизнес-функции (разработка, оценка качества, обучение, аварийное восстановление или производство).
- **Ландшафт SAP:** термин обозначает все ресурсы SAP, доступные в ИТ-ландшафте. Ландшафт SAP включает все рабочие и нерабочие среды.
- **Система SAP**: сочетание уровня СУБД и уровня приложений системы разработки SAP ERP, тестовой системы SAP BW, рабочей системы SAP CRM и т. д. В развертываниях Azure не поддерживается разделение этих двух уровней между локальной средой и Azure. Таким образом, система SAP должна быть развернута полностью в локальной среде или полностью в Azure. Но при этом вы можете развернуть различные системы ландшафта SAP как в Azure, так и локально. Например, системы разработки и тестирования SAP CRM можно развернуть в Azure, а рабочую систему SAP CRM — в локальной среде. Решение SAP HANA в Azure (крупные экземпляры) предназначено для размещения уровня приложений систем SAP на виртуальных машинах Azure и соответствующего экземпляра SAP HANA в единице в стеке крупных экземпляров HANA.
- **Стек крупных экземпляров:** сертифицированный для программы SAP HANA TDI аппаратный стек, предназначенный для запуска экземпляров SAP HANA в Azure.
- **SAP HANA в Azure (крупные экземпляры):** официальное название предложения в Azure, предусматривающее запуск экземпляров SAP HANA на оборудовании, сертифицированном для программы SAP HANA TDI, которые развертываются в стеках крупных экземпляров в разных регионах Azure. Связанный термин **крупные экземпляры HANA** — сокращенное название SAP HANA в Azure (крупные экземпляры), которое широко используется в этом техническом руководстве по развертыванию.
- **Распределенное развертывание:** описывает сценарии, при которых в подписке Azure развернуты виртуальные машины с подключениями типа "сеть — сеть" или ExpressRoute между локальными центрами обработки данных и Azure. В документации Azure развертывания такого рода также называются распределенными развертываниями. Такое подключение используется для расширения в Azure локальных доменов, локальной службы Active Directory, OpenLDAP и локальной службы DNS. Локальная среда распространяется на ресурсы Azure, входящие в подписки Azure. При таком расширении виртуальные машины могут быть частью локального домена. Пользователи локального домена имеют доступ к серверам и могут запускать службы на этих виртуальных машинах (например, службы СУБД). Возможно взаимодействие и разрешение имен между виртуальными машинами, развернутыми в локальной сети и в Azure. Это типичный сценарий, при котором развертывается большинство ресурсов SAP. Дополнительные сведения см. в статьях [Планирование и проектирование VPN-шлюза](../../../vpn-gateway/vpn-gateway-plan-design.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) и [Создание виртуальной сети с подключением типа "сеть — сеть" с помощью портала Azure](../../../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).
- **Клиент:** пользователь, развернутый в стеке крупных экземпляров HANA, изолируется в "клиент". Клиент изолируется от других клиентов на уровне сети, хранилища и вычислений. Таким образом, единицы хранения и вычисления, назначенные разным клиентам, не могут видеть друг друга или взаимодействовать друг с другом на уровне стека крупных экземпляров HANA. Пользователь может выполнить развертывание в разные клиенты. Но и в таком случае клиенты не будут взаимодействовать на уровне стека крупных экземпляров HANA.

Существует множество дополнительных ресурсов, посвященных развертыванию рабочих нагрузок SAP в общедоступном облаке Microsoft Azure. Всем, кто планирует развернуть и выполняет развертывание SAP HANA в Azure, настоятельно рекомендуется ознакомиться с особенностями сред Azure IaaS и подготовиться к развертыванию рабочих нагрузок SAP в такой среде. Прежде чем продолжить работу с руководством, ознакомьтесь со следующими ресурсами, содержащими дополнительные сведения по теме:


- [Использование решений SAP на виртуальных машинах Microsoft Azure](get-started.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

## <a name="certification"></a>Сертификация

Помимо сертификации NetWeaver, требуется специальная сертификация для SAP HANA, обеспечивающая поддержку развертывания этого решения на определенных инфраструктурах, например Azure IaaS.

Основное примечание SAP для NetWeaver, также касающееся сертификации SAP HANA, — [SAP Note #1928533 – SAP Applications on Azure: Supported Products and Azure VM types](https://launchpad.support.sap.com/#/notes/1928533) (Примечание SAP № 1928533. Приложения SAP в Azure: поддерживаемые продукты и типы виртуальных машин Azure).

Также следует ознакомиться с примечанием [SAP Note #2316233 - SAP HANA on Microsoft Azure (Large Instances)](https://launchpad.support.sap.com/#/notes/2316233/E) (Примечание SAP № 2316233. SAP HANA в Microsoft Azure (крупные экземпляры)). Здесь рассматривается решение, описанное в этом руководстве. Кроме того, вы можете запускать решение SAP HANA на виртуальных машинах Azure серии GS5. Сведения по этому сценарию опубликованы на [веб-сайте SAP](http://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html).

Решение "SAP HANA в Azure (крупные экземпляры)", рассматриваемое в примечании SAP № 2316233, позволяет клиентам Майкрософт и SAP развертывать в Azure такие крупные рабочие нагрузки SAP HANA, как SAP Business Suite, SAP Business Warehouse (BW), S/4 HANA, BW/4HANA и другие. В решении используется специальный аппаратный стек SAP HANA, сертифицированный для программы SAP HANA TDI ([SAP HANA Tailored Datacenter Integration — TDI](https://scn.sap.com/docs/DOC-63140)). Используя сертифицированное решение SAP HANA TDI, вы точно знаете, что все приложения на основе SAP HANA (в том числе SAP Business Suite в SAP HANA, SAP Business Warehouse (BW) в SAP HANA, S4/HANA и BW4/HANA) будут работать в аппаратной инфраструктуре.

В отличие от решения SAP HANA, выполняемого на виртуальных машинах Azure, это решение предоставляет гораздо больший объем памяти. Если вы хотите использовать это решение, вам нужно знать некоторые ключевые аспекты:

- Уровень приложений SAP и приложения других поставщиков выполняются на виртуальных машинах Azure, размещенных в обычных аппаратных стеках Azure.
- Среды с клиентской локальной инфраструктурой, центрами обработки данных и приложениями подключены к облачной платформе Microsoft Azure через Azure ExpressRoute (рекомендуется) или виртуальную частную сеть (VPN). Active Directory (AD) и DNS также распространяются в Azure.
- Экземпляр базы данных SAP HANA для рабочей нагрузки HANA выполняется в SAP HANA в Azure (крупные экземпляры). Стек крупных экземпляров подключается к сети Azure, так что программное обеспечение, запущенное на виртуальных машинах Azure, может взаимодействовать с экземпляром HANA в крупных экземплярах HANA.
- Оборудование SAP HANA в Azure (крупные экземпляры) — специальное оборудование, предоставленное в виде инфраструктуры как услуги (IaaS), где предварительно установлена ОС SUSE Linux Enterprise Server или Red Hat Enterprise Linux. Как и в случае с виртуальными машинами Azure, вы самостоятельно устанавливаете дополнительные обновления и обслуживаете операционную систему.
- Вы также отвечаете за установку HANA или дополнительных компонентов, необходимых для запуска SAP HANA на единицах крупных экземпляров HANA, а также за все текущие операции и управление решением SAP HANA в Azure.
- Помимо описанных выше решений вы можете установить другие компоненты в подписке Azure, которая подключена к SAP HANA в Azure (крупные экземпляры).  Например, компоненты, обеспечивающие взаимодействие с базой данных SAP HANA, опосредованно или напрямую (серверы перехода, серверы RDP, SAP HANA Studio, SAP Data Services для сценариев бизнес-аналитики SAP или решения для мониторинга сети).
- Как и в Azure, крупные экземпляры HANA предлагают дополнительные возможности для создания решения для высокой доступности и аварийного восстановления.

## <a name="architecture"></a>Архитектура

Решение "SAP HANA в Azure (крупные экземпляры)" включает в себя уровень приложений SAP, размещенный на виртуальных машинах Azure, и уровень базы данных, расположенный в сертифицированном оборудовании SAP TDI, размещенном в стеке крупных экземпляров в том же регионе Azure, где находится Azure IaaS.

> [!NOTE]
> Уровень приложений SAP необходимо развернуть в том же регионе Azure, что и уровень СУБД SAP. Это правило подробно описано в разделе о рабочей нагрузке SAP в Azure. 

Общая архитектура SAP HANA в Azure (крупные экземпляры) предоставляет конфигурацию сертифицированного оборудования SAP TDI (невиртуализированный физический высокопроизводительный сервер для базы данных SAP HANA), а также возможность Azure гибко масштабировать ресурсы для уровня приложений SAP в соответствии с вашими требованиями.

![Основные сведения об архитектуре решения "SAP HANA в Azure (крупные экземпляры)"](./media/hana-overview-architecture/image1-architecture.png)

Представленная выше архитектура состоит из трех частей:

- **Правая часть:** показана локальная инфраструктура, где выполняются различные приложения в центрах обработки данных (при этом пользователи имеют доступ к бизнес-приложениям, например SAP). В идеале эта локальная инфраструктура затем подключается к Azure через Azure [ExpressRoute](https://azure.microsoft.com/services/expressroute/).

- **Центр:** показана инфраструктура Azure IaaS и (в этом случае) использование виртуальных машин Azure для размещения приложений SAP или других приложений, использующих SAP HANA в качестве системы СУБД. Небольшие экземпляры HANA, использующие память виртуальных машин Azure, развертываются на виртуальных машинах Azure со своим уровнем приложений. См. дополнительные сведения о [виртуальных машинах](https://azure.microsoft.com/services/virtual-machines/).
<br />Сети Azure используются для объединения систем SAP вместе с другими приложениями в виртуальные сети Azure. Эти виртуальные сети подключаются к локальным системам, а также к SAP HANA в Azure (крупные экземпляры).
<br />Сведения для приложений и баз данных SAP NetWeaver, которые могут выполняться в Microsoft Azure, см. в примечании [SAP Support Note #1928533 – SAP Applications on Azure: Supported Products and Azure VM types](https://launchpad.support.sap.com/#/notes/1928533) (Примечание SAP № 1928533. Приложения SAP в Azure: поддерживаемые продукты и типы виртуальных машин Azure). См. документацию по развертыванию решений SAP в Azure:

  -  [Использование SAP на виртуальных машинах Windows](../../virtual-machines-windows-sap-get-started.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
  -  [Использование решений SAP на виртуальных машинах Microsoft Azure](get-started.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

- **Левая часть:** показано сертифицированное оборудование SAP HANA TDI в стеке крупных экземпляров Azure. Единицы крупных экземпляров HANA подключены к виртуальным сетям Azure вашей подписки с помощью того же метода, что и локальная среда к Azure.

Стек крупных экземпляров Azure включает в себя следующие компоненты:

- **Вычисления:** серверы на базе процессоров Intel Xeon E7-8890v3 и Intel Xeon E7-8890v4, которые предоставляют необходимую вычислительную мощность и сертифицированы для SAP HANA.
- **Сети:** единая структура высокоскоростных сетей, которая соединяет компоненты вычислений, хранения и локальной сети.
- **Хранилище:** инфраструктура хранилища, к которому осуществляется доступ через единую структуру сети. Выделяемый объем хранилища зависит от развертываемой конфигурации SAP HANA в Azure (крупные экземпляры). Дополнительный объем хранилища можно получить за дополнительную ежемесячную плату.

В рамках мультитенантной инфраструктуры стека крупных экземпляров клиенты развертываются как изолированные клиенты. Во время развертывания клиента необходимо присвоить имя подписке Azure в регистрации Azure. Это будет подписка Azure, в которую будут выставляться счета за крупные экземпляры HANA. Один клиент соответствует одной подписке Azure. С точки зрения сети можно осуществлять доступ к единице крупного экземпляра HANA, развернутой в одном клиенте в одном регионе Azure, из разных виртуальных сетей Azure, которые относятся к разным подпискам Azure. Тем не менее эти подписки Azure должны принадлежать к одной регистрации Azure. 

Как и в случае с виртуальными машинами Azure, решение "SAP HANA в Azure (крупные экземпляры)" доступно в нескольких регионах Azure. Вы можете использовать несколько регионов, чтобы обеспечить возможность аварийного восстановления. Разные стеки крупных экземпляров в одном геополитическом регионе Azure подключены друг к другу. Например, стеки крупных экземпляров HANA в западной и восточной частях США подключаются через выделенное сетевое соединение с целью репликации и аварийного восстановления. 

Точно так же, как можно выбирать между различными типами виртуальных машин Azure, можно выбирать среди разных номеров SKU для крупных экземпляров HANA, предназначенных для различных типов рабочих нагрузок SAP HANA. SAP выделяет для разных рабочих нагрузок память с учетом количества сокетов в зависимости от поколений процессоров Intel. Таким образом, доступно четыре разных типа SKU.

Начиная с июля 2017 г. решение SAP HANA в Azure (крупные экземпляры) доступно в нескольких конфигурациях в следующих регионах Azure: "Западная часть США", "Восточная часть США", "Восточная Австралия", "Юго-восточная Австралия", "Западная Европа" и "Северная Европа".

| Решение SAP | ЦП | Память | Хранилище | Доступность |
| --- | --- | --- | --- | --- |
| Оптимизировано для OLAP: SAP BW, BW/4HANA<br /> или SAP HANA для общих рабочих нагрузок OLAP | SAP HANA на виртуальных машинах Azure S72<br /> — 2 процессора Intel® Xeon® E7-8890 v3<br /> 36 ядер ЦП и 72 потока ЦП |  768 ГБ |  3 TБ | Доступна |
| --- | SAP HANA на виртуальных машинах Azure S144<br /> — 4 процессора Intel® Xeon® E7-8890 v3<br /> 72 ядра ЦП и 144 потока ЦП |  1,5 ТБ |  6 TБ | Больше не предоставляются |
| --- | SAP HANA на виртуальных машинах Azure S192<br /> — 4 процессора Intel® Xeon® E7-8890 v4<br /> 96 ядер ЦП и 192 потока ЦП |  2 TБ |  8 ТБ | Доступна |
| --- | SAP HANA на виртуальных машинах Azure S384<br /> — 8 процессоров Intel® Xeon® E7-8890 v4<br /> 192 ядра ЦП и 384 потока ЦП |  4 TБ |  16 ТБ | Доступны для заказа |
| Оптимизировано для OLTP: SAP Business Suite<br /> в SAP HANA или S/4HANA (OLTP)<br /> для общих рабочих нагрузок OLTP | SAP HANA на виртуальных машинах Azure S72m<br /> — 2 процессора Intel® Xeon® E7-8890 v3<br /> 36 ядер ЦП и 72 потока ЦП |  1,5 ТБ |  6 TБ | Доступна |
|---| SAP HANA на виртуальных машинах Azure S144m<br /> — 4 процессора Intel® Xeon® E7-8890 v3<br /> 72 ядра ЦП и 144 потока ЦП |  3 ТБ |  12 ТБ | Больше не предоставляются |
|---| SAP HANA на виртуальных машинах Azure S192m<br /> — 4 процессора Intel® Xeon® E7-8890 v4<br /> 96 ядер ЦП и 192 потока ЦП  |  4 TБ |  16 ТБ | Доступна |
|---| SAP HANA на виртуальных машинах Azure S384m<br /> — 8 процессоров Intel® Xeon® E7-8890 v4<br /> 192 ядра ЦП и 384 потока ЦП |  6 ТБ |  18 ТБ | Доступны для заказа |
|---| SAP HANA на виртуальных машинах Azure S384xm<br /> — 8 процессоров Intel® Xeon® E7-8890 v4<br /> 192 ядра ЦП и 384 потока ЦП |  8 TБ |  22 ТБ |  Доступны для заказа |
|---| SAP HANA на виртуальных машинах Azure S576<br /> — 12 процессоров Intel® Xeon® E7-8890 v4<br /> 288 ядер ЦП и 576 потоков ЦП |  12 ТБ |  28 ТБ | Доступны для заказа |
|---| SAP HANA на виртуальных машинах Azure S768<br /> — 16 процессоров Intel® Xeon® E7-8890 v4<br /> 384 ядра ЦП и 768 потоков ЦП |  16 TБ |  36 ТБ | Доступны для заказа |
|---| SAP HANA на виртуальных машинах Azure S960<br /> — 20 процессоров Intel® Xeon® E7-8890 v4<br /> 480 ядер ЦП и 960 потоков ЦП |  20 ТБ |  46 ТБ | Доступны для заказа |

- Число ядер ЦП = сумма ядер ЦП без поддержки технологии Hyper-Threading из суммы процессоров экземпляра сервера.
- Число потоков ЦП = сумма потоков вычислений, предоставляемых ядрами ЦП с поддержкой технологии Hyper-Threading из суммы процессоров экземпляра сервера. По умолчанию все экземпляры настроены для использования технологии Hyper-Threading.


Упомянутые выше конфигурации (которые помечены как "Доступны" и "Больше не предоставляются") описаны в примечании [SAP Support Note #2316233 – SAP HANA on Microsoft Azure (Large Instances)](https://launchpad.support.sap.com/#/notes/2316233/E) (Примечание SAP № 2316233. SAP HANA в Microsoft Azure (крупные экземпляры)). Конфигурации, которые помечены как "Доступны для заказа", скоро будут добавлены в примечании SAP. Тем не менее номера SKU этих экземпляров уже можно заказать в шести различных регионах Azure, где доступна служба крупных экземпляров HANA.

Выбираемые конфигурации зависят от рабочей нагрузки, ресурсов ЦП и необходимого объема памяти. Для рабочих нагрузок OLTP можно использовать номера SKU, оптимизированные для рабочих нагрузок OLAP. 

Аппаратная часть всех предложений является сертифицированным оборудованием SAP HANA TDI. Тем не менее оборудование делится на два различных класса по номерам SKU:

- S72, S72m, S144, S144m, S192 и S192m относятся к номерам SKU 1 класса.
- S384, S384m, S384xm, S576, S768 и S960, которые обычно называются номерами SKU 2 класса.

Важно отметить, что полный стек крупных экземпляров HANA не выделяется монопольно для одного клиента. Это также относится к стойкам ресурсов вычислений и хранения, соединенным через сетевую структуру, развернутую в Azure. Инфраструктура крупных экземпляров HANA, такая как Azure, развертывает &quot;клиенты&quot; другого пользователя, которые изолированы друг от друга на следующих трех уровнях:

- Сеть. Изоляция с помощью виртуальных сетей в стеке крупных экземпляров HANA.
- Хранилище. Изоляция с помощью виртуальных машин хранилища, которые имеют назначенные им тома хранилища и изолируют тома хранилища между клиентами.
- Вычисления. Выделенное назначение экземпляров сервера одному клиенту. Нет секционирования оборудования или программного обеспечения для экземпляров сервера. Один экземпляр сервера или узла не может одновременно использоваться несколькими клиентами. 

Таким образом, развертывания крупных экземпляров HANA на различных клиентах невидимы друг для друга. А крупные экземпляры HANA, развернутые в разных клиентах, не могут взаимодействовать напрямую друг с другом на уровне стека крупных экземпляров HANA. Взаимодействовать друг с другом на уровне стека крупных экземпляров HANA могут только крупные экземпляры HANA внутри одного клиента.
Развернутый клиент в стеке крупных экземпляров назначается одной подписке Azure, в которую выставляются счета. Однако с точки зрения сети к нему можно получить доступ из виртуальных сетей Azure других подписок Azure в рамках одной регистрации Azure. При развертывании в другой подписке Azure в том же регионе Azure вы также можете попросить отдельный клиент крупных экземпляров HANA.

Существуют значительные различия между запуском SAP HANA в крупных экземплярах HANA и на виртуальных машинах, развернутых в Azure:

- Для SAP HANA в Azure (крупные экземпляры) не предусмотрен уровень виртуализации. Вы получаете производительность базового физического оборудования.
- В отличие от Azure сервер решения "SAP HANA в Azure (крупные экземпляры)" выделяется для конкретного клиента. Исключена вероятность того, что на экземпляре сервера или узле будет использоваться секционирование оборудования или программного обеспечения. В результате крупный экземпляр HANA используется как в целом назначено для клиента и, следовательно, для вас, как пользователя. Перезагрузка или завершение работы сервера не влечет за собой автоматически развертывание операционной системы и SAP HANA на другом сервере. (Единственное исключение для SKU 1 класса — когда на сервере могут возникнуть проблемы и необходимо выполнить повторное развертывание на другой сервер.)
- В отличие от Azure, где типы процессоров узла выбираются на основе лучшего соотношения цены и производительности, для SAP HANA в Azure (крупные экземпляры) выбираются самые высокопроизводительные процессоры из линейки Intel E7v3 и E7v4.


### <a name="running-multiple-sap-hana-instances-on-one-hana-large-instance-unit"></a>Запуск нескольких экземпляров SAP HANA в одной единице крупных экземпляров HANA
В единицах крупных экземпляров HANA можно разместить несколько активных экземпляров SAP HANA. Чтобы по-прежнему иметь доступ к моментальным снимкам хранилища и аварийному восстановлению, в такой конфигурации требуется настроить том в каждом экземпляре. В данный момент единицы крупных экземпляров HANA можно разделить следующим образом:

- S72, S72m, S144, S192: с шагом приращения 256 ГБ и наименьшей начальной единицей 256 ГБ. Можно комбинировать шаги приращения 256 ГБ, 512 ГБ и т. д. до достижения максимального значения объема памяти единицы.
- S144m и S192m: с шагом приращения 256 ГБ и наименьшей начальной единицей 512 ГБ. Можно комбинировать шаги приращения 512 ГБ, 768 ГБ и т. д. до достижения максимального значения объема памяти единицы.
- Класс 2: с шагом приращения 512 ГБ и наименьшей начальной единицей 2 ТБ. Можно комбинировать шаги приращения 512 ГБ, 1 ТБ, 1,5 ТБ и т. д. до достижения максимального значения объема памяти единицы.

Некоторые примеры использования нескольких экземпляров SAP HANA могут выглядеть так:

| SKU | Размер памяти | Размер хранилища | Размеры с несколькими базами данных |
| --- | --- | --- | --- |
| S72 | 768 ГБ | 3 TБ | 1 экземпляр HANA 768 ГБ<br /> или 1 экземпляр 512 ГБ + 1 экземпляр 256 ГБ<br /> или 3 экземпляра 256 ГБ | 
| S72m | 1,5 ТБ | 6 TБ | 3 экземпляра HANA 512 ГБ<br />или 1 экземпляр 512 ГБ + 1 экземпляр 1 ТБ<br />или 6 экземпляров 256 ГБ<br />или 1 экземпляр 1,5 ТБ | 
| S192m | 4 TБ | 16 ТБ | 8 экземпляров 512 ГБ<br />или 4 экземпляра 1 ТБ<br />или 4 экземпляра 512 ГБ + 2 экземпляра 1 ТБ<br />или 4 экземпляра 768 ГБ + 2 экземпляра 512 ГБ<br />или 1 экземпляр 4 ТБ |
| S384xm | 8 ТБ | 22 ТБ | 4 экземпляра 2 ТБ<br />или 2 экземпляра 4 ТБ<br />или 2 экземпляра 3 ТБ + 1 экземпляр 2 ТБ<br />или 2 экземпляра 2,5 ТБ + 1 экземпляр 3 ТБ<br />или 1 экземпляр 8 ТБ |


Примерно так. Конечно также существуют другие варианты. 

### <a name="using-sap-hana-data-tiering-and-extension-nodes"></a>Использование многоуровневого хранения данных и узлов расширения SAP HANA
SAP поддерживает модель многоуровневого хранения данных для SAP BW различных выпусков SAP NetWeaver и SAP BW/4HANA. Сведения о модели многоуровневого хранения данных можно найти в этом документе и блоге, упомянутом в этой документации по SAP: [SAP BW/4HANA AND SAP BW ON HANA WITH SAP HANA EXTENSION NODES](https://www.sap.com/documents/2017/05/ac051285-bc7c-0010-82c7-eda71af511fa.html#) (SAP BW/4HANA и SAP BW в HANA с узлами расширения SAP HANA).
Как описано в блоге SAP и документе с вопросами и ответами, вместе с крупными экземплярами HANA можно использовать конфигурацию варианта 1 узлов расширения SAP HANA. Конфигурацию варианта 2 можно настроить со следующими номерами SKU для крупных экземпляров HANA: S72m, S192, S192m, S384 и S384m.  
При просмотре документации преимущество может быть заметно не сразу. Однако посмотрев рекомендации по размерам SAP, вы увидите преимущество использования вариантов 1 и 2 узлов расширения SAP HANA. Ниже приведен пример:

- Рекомендации по определению размеров SAP HANA обычно требуют, чтобы объем данных был вдвое больше памяти. Поэтому при запуске экземпляра SAP HANA с "горячими" данными только 50 % (или меньше) памяти заполнено данными. Остальная часть памяти резервируется для SAP HANA.
- Это значит, что в крупном экземпляре HANA S192 с 2 ТБ памяти, выполняющем базу данных SAP BW, вы получите только 1 ТБ объема данных.
- При использовании узла расширения SAP HANA варианта 1 и крупного экземпляра HANA S192 можно получить дополнительный объем данных в 2 ТБ, а в конфигурации варианта 2 даже 4 ТБ для активного объема данных. По сравнению с "горячим" узлом, для хранения данных с конфигурацией варианта 1 можно использовать полный объем памяти "теплого" узла расширения, а конфигурация варианта 2 узла расширения SAP HANA позволяет удвоить память.
- В результате вы получите для данных емкость 3 ТБ и соотношение "горячего" к "теплому" 1:2 для конфигурации узла расширения варианта 1 и 5 ТБ данных с соотношением 1:4 для конфигурации варианта 2.

Чем выше объем данных по сравнению с памятью, тем выше шансы, что данные, которые используются время от времени, будут храниться на диске.


## <a name="operations-model-and-responsibilities"></a>Модель операций и обязанности

Службы, предоставляемые SAP HANA в Azure (крупные экземпляры), соответствуют службам Azure IaaS. Экземпляр решения "Крупные экземпляры HANA" поставляется с установленной операционной системой, оптимизированной для SAP HANA. Как и в случае с виртуальными машинами Azure IaaS, вы отвечаете за большинство задач по повышению безопасности операционной системы, установку дополнительного программного обеспечения, решения HANA, работу с ОС и HANA, а также их обновление. Корпорация Майкрософт не требует установки обновлений для операционной системы и HANA.

![Обязанности, связанные с SAP HANA в Azure (крупные экземпляры)](./media/hana-overview-architecture/image2-responsibilities.png)

Как видно на рисунке выше, решение "SAP HANA в Azure (крупные экземпляры)" — это мультитенантная инфраструктура как услуга. Как результат, разделение обязанностей по большей части наблюдается на границе инфраструктуры и ОС. Корпорация Майкрософт отвечает за все аспекты обслуживания, которые расположены после уровня операционной системы, а вы отвечаете за те, которые расположены над ним, включая саму операционную систему. Таким образом, вы можете продолжать применять самые последние локальные методы для обеспечения соответствия требованиям, безопасности, управления приложениями, базового управления и управления операционной системой. Обслуживание таких систем ничем не отличается от систем, находящихся в вашей сети.

Тем не менее эта служба оптимизирована для SAP HANA, поэтому есть некоторые аспекты, требующие сотрудничества с корпорацией Майкрософт. Ее сотрудники помогут вам эффективнее использовать возможности базовой инфраструктуры.

Ниже приведены дополнительные сведения по каждому уровню и ваши обязанности.

**Сети.** Все внутренние сети для стека крупных экземпляров с SAP HANA, его доступ к хранилищу, подключение между экземплярами (для масштабирования и других функций), подключение к ландшафту и подключение к Azure, если уровень приложений SAP размещен на виртуальных машинах Azure. Этот уровень также включает в себя подключение через глобальную сеть между центрами обработки данных Azure для репликации в целях аварийного восстановления. Все сети распределяются по клиентам, и к ним применяются требования к качеству обслуживания.

**Хранилище:** виртуализированное секционированное хранилище для всех томов, необходимых серверам SAP HANA, а также для моментальных снимков. 

**Серверы:** выделенные физические серверы для выполнения баз данных SAP HANA, назначенных клиентам. Серверы SKU 1 класса абстрагированы на уровне оборудования. С этими типами серверов конфигурация сервера собирается и обслуживается в профилях, которые можно перемещать из одного физического оборудования на другое. Такой принцип перемещения профиля (вручную) немного похож на восстановление службы Azure. Серверы SKU 2 класса не предоставляют такой возможности.

**Программно-определяемый центр обработки данных (SDDC):** программное обеспечение для управления центром обработки данных как программно-определяемой сущностью. С его помощью корпорация Майкрософт может объединять ресурсы в пул для масштабирования, повышения уровня доступности и производительности.

**ОС:** операционная система (SUSE Linux или Red Hat Linux), под управлением которой работают серверы. Вам предоставляются образы операционной системы, переданные отдельными поставщиками Linux корпорации Майкрософт с целью выполнения на них SAP HANA. Вам нужно получить подписку у поставщика конкретного образа, оптимизированного для SAP HANA. Вы также обязаны зарегистрировать образ у поставщика ОС. С момента передачи вам образа корпорацией Майкрософт вы также самостоятельно отвечаете за любые дополнительные исправления операционной системы Linux. Эти исправления содержат дополнительные пакеты, которые могут потребоваться для успешной установки SAP HANA (изучите документацию по установке HANA компании SAP и примечания по SAP), не включенных поставщиком Linux в конкретный используемый образ ОС, оптимизированный для SAP HANA. К области ответственности клиента относятся также любые исправления ОС, применяемые для исправления ошибок или оптимизации ОС и ее драйверов для конкретного аппаратного оборудования. Клиент также отвечает за любые исправления для повышения безопасности или изменения функциональности операционной системы. Клиент несет ответственность за мониторинг и планирование производительности по следующим аспектам:

- потребление ресурсов ЦП;
- потребление памяти;
- тома диска для обеспечения свободного пространства, поддержки операций ввода-вывода и регулирования задержки;
- сетевой трафик между крупным экземпляром HANA и уровнем приложений SAP.

Базовая инфраструктура крупных экземпляров HANA предоставляет функции резервного копирования и восстановления тома ОС. Вы также отвечаете за использование этих функций.

**ПО промежуточного слоя:** в первую очередь сюда относится экземпляр SAP HANA. Вы отвечаете за администрирование, выполнение операций и мониторинг. Вы также можете использовать моментальные снимки хранилища для резервного копирования и восстановления, а также аварийного восстановления. Эти возможности обеспечиваются с помощью инфраструктуры. Тем не менее вы также отвечаете за создание решения для обеспечения высокого уровня доступности и аварийного восстановления с этими возможностями, использование их и отслеживание успешного выполнения моментальных снимков хранилища.

**Данные:** управление вашими данными и другими данными, например файлами резервных копий, расположенными на томах или в файловых ресурсах, осуществляется с помощью SAP HANA. Вы отвечаете за мониторинг свободного места на диске и управление содержимым томов, а также отслеживание успешного выполнения резервного копирования томов и моментальных снимков хранилища. Однако за успешное выполнение репликации данных на сайты аварийного восстановления отвечает корпорация Майкрософт.

**Приложения:** экземпляры приложений SAP или уровень этих приложений (в случае с приложениями других поставщиков). Вы отвечаете за развертывание, администрирование, эксплуатацию и мониторинг этих приложений в контексте планирования потребления ресурсов ЦП, объема памяти, емкости службы хранилища Azure и использования пропускной способности сети в виртуальных сетях Azure и из виртуальных сетей Azure в SAP HANA в Azure (крупные экземпляры).

**Глобальные сети:** подключения между локальной средой и развертываниями в Azure, устанавливаемые для рабочих нагрузок. Для подключения всех клиентов крупных экземпляров HANA используется Azure ExpressRoute. Это подключение не является частью SAP HANA в Azure (крупные экземпляры), поэтому вы несете ответственность за установку этого подключения.

**Архивирование:** вы можете архивировать копии данных в учетные записи хранения, используя собственные методы. Архивация сопровождается затратами и необходимостью управления, обеспечения соответствия и обслуживания. Вы несете ответственность за создание архивных копий и резервных копий в Azure, а также сохранение их надлежащим способом.

См. статью [Соглашение об уровне обслуживания для SAP HANA в больших экземплярах Azure](https://azure.microsoft.com/support/legal/sla/sap-hana-large/v1_0/).

## <a name="sizing"></a>Определение размера

В целом определение размера для крупных экземпляров HANA ничем не отличается от определения размера для HANA. Для существующих и развернутых систем необходимо перенести данные из других реляционных СУБД в HANA, так как SAP предоставляет ряд отчетов, которые выполняются в имеющихся системах SAP. Эти отчеты проверяют данные и определяют требования к памяти при перемещении базы данных в HANA. Прочтите следующие примечания SAP, чтобы получить дополнительные сведения о выполнении этих отчетов и информацию о последних исправлениях и версиях этих отчетов:

- [SAP Note #1793345 — Sizing for SAP Suite on HANA (Примечание SAP № 1793345. Определение размера для SAP Suite в HANA)](https://launchpad.support.sap.com/#/notes/1793345);
- [SAP Note #1872170 — Suite on HANA and S/4 HANA sizing report (Примечание SAP № 1872170. Отчет для определения размера Suite в HANA и S/4 HANA)](https://launchpad.support.sap.com/#/notes/1872170);
- [SAP Note #2121330 — FAQ: SAP BW on HANA Sizing Report (Примечание SAP № 2121330. Часто задаваемые вопросы: отчет для определения размера SAP BW в HANA)](https://launchpad.support.sap.com/#/notes/2121330);
- [SAP Note #1736976 — Sizing Report for BW on HANA (Примечание SAP № 1736976. Отчет для определения размера BW в HANA)](https://launchpad.support.sap.com/#/notes/1736976);
- [SAP Note #2296290 — New Sizing Report for BW on HANA (Примечание SAP № 2296290. Новый отчет для определения размера BW в HANA)](https://launchpad.support.sap.com/#/notes/2296290).

Для новых развертываний доступно средство для определения требований к памяти для реализации программного обеспечения SAP на базе HANA — SAP Quick Sizer.

Требования к памяти для HANA повышаются по мере роста объема данных, поэтому вам нужно следить за потреблением памяти, чтобы спрогнозировать будущие требования. В зависимости от требований к памяти вы можете определить подходящий SKU для крупных экземпляров HANA.

## <a name="requirements"></a>Требования

В этом списке перечислены требования для запуска SAP HANA в Azure (крупные экземпляры).

**Microsoft Azure**

- Подписка Azure, которую можно связать с SAP HANA в Azure (крупные экземпляры).
- Контракт на поддержку Microsoft Premier. Сведения о работе с решением SAP в Azure см. в примечании [SAP Support Note #2015553 – SAP on Microsoft Azure: Support Prerequisites](https://launchpad.support.sap.com/#/notes/2015553) (Примечание SAP № 2015553. SAP в Microsoft Azure: требования для поддержки). При использовании единиц крупных экземпляров HANA с числом процессоров от 384 необходимо расширить контракт поддержки Premier, чтобы добавить поддержку Azure Rapid Response (ARR).
- Знание необходимых SKU для крупных экземпляров HANA после определения размера с помощью SAP.

**Сетевое подключение**

- Azure ExpressRoute между локальной средой и Azure. Для подключения локального центра обработки данных к Azure у поставщика услуг Интернета необходимо запросить подключение со скоростью не менее 1 Гбит/с. 

**Операционная система**

- Лицензии на SUSE Linux Enterprise Server 12 для приложений SAP.

> [!NOTE] 
> Операционная система, поставляемая корпорацией Майкрософт, не зарегистрирована в SUSE и не подключена к экземпляру SMT.

- Средство для управления подписками SUSE Linux (SMT), развернутое в Azure или на виртуальной машине Azure. При его наличии SUSE сможет выполнять регистрацию и надлежащее обновление SAP HANA в Azure (крупные экземпляры) (так как в центре обработки данных крупных экземпляров HANA отсутствует доступ в Интернет). 
- Лицензии на Red Hat Enterprise Linux 6.7 или 7.2 для SAP HANA.

> [!NOTE]
> Операционная система, поставляемая корпорацией Майкрософт, не зарегистрирована в Red Hat и не подключена к экземпляру диспетчера подписок компании Red Hat.

- Red Hat Subscription Manager, развернутый в Azure или на виртуальной машине Azure. При его наличии Red Hat Subscription Manager сможет выполнять регистрацию и надлежащее обновление SAP HANA в Azure (крупные экземпляры) (так как в клиенте, развернутом в стеке крупных экземпляров Azure, отсутствует прямой доступ в Интернет).
- SAP требуется наличие договора на поддержку с поставщиком Linux. Это требование не отменяется в решении больших экземпляров HANA или если вы используете Linux в Azure. В отличие от некоторых образов Linux в Azure из коллекции плата за обслуживание не включена в предложение решения крупных экземпляров HANA. Именно клиент выполняет требования SAP в отношении договора на поддержку с распространителем Linux.   
   - Ознакомьтесь с требованиями договора на поддержку SUSE Linux в документах [SAP Note #1984787 — SUSE LINUX Enterprise Server 12: Installation notes](https://launchpad.support.sap.com/#/notes/1984787) (Примечание SAP № 1984787 — SUSE LINUX Enterprise Server 12: примечания к установке) и [SAP Note #1056161 — SUSE Priority Support for SAP applications](https://launchpad.support.sap.com/#/notes/1056161) (Примечание SAP № 1056161 — приоритетная поддержка SUSE для приложений SAP).
   - Для Red Hat Linux необходимо иметь правильный уровень подписки, который включает в себя поддержку и обслуживание (обновления операционных систем крупных экземпляров HANA). Специалисты Red Hat советуют получить подписку RHEL for SAP Business Applications. Дополнительные сведения о службе поддержки и услугах см. в документах [SAP Note #2002167 — Red Hat Enterprise Linux 7.x: Installation and Upgrade](https://launchpad.support.sap.com/#/notes/2002167) (Примечание SAP № 2002167 — Red Hat Enterprise Linux 7.x: установка и обновление) и [SAP Note #1496410 — Red Hat Enterprise Linux 6.x: Installation and Upgrade](https://launchpad.support.sap.com/#/notes/1496410) (Примечание SAP № 1496410 — Red Hat Enterprise Linux 6.x: установка и обновление).

**База данных:**

- Лицензии и компоненты установки программного обеспечения для SAP HANA (выпуск Platform или Enterprise).

**Приложения**

- Лицензии и компоненты установки программного обеспечения для любых приложений SAP, которые подключаются к SAP HANA, и связанные договора на поддержку SAP.
- Лицензии и компоненты установки программного обеспечения для всех приложений других поставщиков (не SAP), используемых по отношению к среде SAP HANA в Azure (крупные экземпляры), и связанные договора на поддержку.

**Требования**

- Опыт работы со средой Azure IaaS и ее компонентами и общие знания о них.
- Общие знания о развертывании рабочей нагрузки SAP в Azure.
- Сертифицированные сотрудники для установки SAP HANA.
- Навыки проектирования в среде SAP, чтобы создать решение для обеспечения высокого уровня доступности и аварийного восстановления в SAP HANA.

**SAP:**

- Ожидается, что вы являетесь клиентом SAP и у вас есть договор на поддержку с SAP.
- Специально для реализации номеров SKU крупных экземпляров HANA 2 класса настоятельно рекомендуется проконсультироваться со специалистами SAP о версиях SAP HANA и окончательной конфигурации крупного вертикально масштабируемого оборудования.


## <a name="storage"></a>Хранилище

Структура хранения для SAP HANA в Azure (крупные экземпляры) настраивается через управление службами SAP HANA в Azure с применением рекомендаций, как описано в техническом документе с описанием [требований к хранилищу для SAP HANA](http://go.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html).

Обычно объем памяти крупных экземпляров HANA класса типа II в 4 раза больше объема памяти тома хранилища. Хранилище единиц крупных экземпляров HANA класса типа II не будет иметь в четыре раза больший объем памяти. Такой объем предназначен для хранения резервных копий журналов транзакций HANA. Дополнительные сведения см. в статье [Как установить и настроить SAP HANA в Azure (крупные экземпляры)](hana-installation.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

См. следующую таблицу, где представлены сведения о выделении объема хранилища. В таблице приведена примерная емкость для разных томов, предоставляемых в составе единиц крупных экземпляров HANA.

| SKU крупных экземпляров HANA | hana/data; | hana/log; | hana/shared. | hana/log/backup |
| --- | --- | --- | --- | --- |
| S72 | 1280 ГБ | 512 ГБ | 768 ГБ | 512 ГБ |
| S72m | 3328 ГБ | 768 ГБ |1280 ГБ | 768 ГБ |
| S192 | 4608 ГБ | 1024 ГБ | 1536 ГБ | 1024 ГБ |
| S192m | 11 520 ГБ | 1536 ГБ | 1792 ГБ | 1536 ГБ |
| S384 | 11 520 ГБ | 1536 ГБ | 1792 ГБ | 1536 ГБ |
| S384m | 12 000 ГБ | 2050 ГБ | 2050 ГБ | 2040 ГБ |
| S384xm | 16 000 ГБ | 2050 ГБ | 2050 ГБ | 2040 ГБ |
| S576 | 20 000 ГБ | 3100 ГБ | 2050 ГБ | 3100 ГБ |
| S768 | 28 000 ГБ | 3100 ГБ | 2050 ГБ | 3100 ГБ |
| S960 | 36 000 ГБ | 4100 ГБ | 2050 ГБ | 4100 ГБ |


Фактический размер развернутого тома может изменяться в зависимости от развертывания и инструмента, который используется для отображения размера тома.

Если вы разделите SKU крупных экземпляров HANA, примеры возможного деления будут выглядеть следующим образом:

| Секция памяти в ГБ | hana/data; | hana/log; | hana/shared. | hana/log/backup |
| --- | --- | --- | --- | --- |
| 256 | 400 ГБ | 160 ГБ | 304 ГБ | 160 ГБ |
| 512 | 768 ГБ | 384 ГБ | 512 ГБ | 384 ГБ |
| 768 | 1280 ГБ | 512 ГБ | 768 ГБ | 512 ГБ |
| 1024 | 1792 ГБ | 640 ГБ | 1024 ГБ | 640 ГБ |
| 1536 | 3328 ГБ | 768 ГБ | 1280 ГБ | 768 ГБ |


Это примерные объемы томов, которые могут незначительно отличаться в зависимости от развертывания и средств, используемых для просмотра томов. Также существуют другие размеры разделов, например 2,5 ТБ. Размеры этих хранилищ вычисляются по аналогичной формуле, как для разделов выше. Термин "разделы" не подразумевает, что операционная система, память или ресурсы ЦП каким-либо образом разделяются. Таким образом указываются разделы хранения различных экземпляров HANA, которые можно развернуть в одной единице крупных экземпляров HANA. 

Если клиенту потребуется больший объем хранилища, можно заказать дополнительное хранилище емкостью 1 ТБ. Это дополнительное хранилище можно добавить в качестве дополнительного тома или использовать для расширения одного или нескольких существующих томов. Невозможно уменьшить размер первоначально развернутых томов, а также перечисленных в таблице выше. Также невозможно изменить имена томов или имена подключений. Тома описанных выше хранилищ присоединяются к единицам крупных экземпляров HANA в качестве томов NFS4.

Клиент может использовать моментальные снимки для архивации, восстановления и аварийного восстановления. Дополнительные сведения см. в [Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)](hana-overview-high-availability-disaster-recovery.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

### <a name="encryption-of-data-at-rest"></a>Шифрование неактивных данных
Хранилище, используемое для крупных экземпляров HANA, обеспечивает прозрачное шифрование данных, так как оно хранится на дисках. Во время развертывания единицы крупных экземпляров HANA вы можете включить шифрование такого типа. После развертывания вы также можете переключиться на зашифрованные тома. Переход от незашифрованных к зашифрованным томам прозрачен и не вызывает простоя. 

Для номеров SKU класса типа 1 том с загрузочным логическим номером LUN зашифрован. Для номеров SKU класса типа 2 крупных экземпляров HANA загрузочный логический номер LUN необходимо зашифровать с помощью методов ОС. 


## <a name="networking"></a>Сеть

Архитектура сети Azure является ключевым компонентом для успешного развертывания приложений SAP в крупных экземплярах HANA. Как правило, развернутое решение "SAP HANA в Azure (крупные экземпляры)" отличается большим ландшафтом SAP, который включает в себя несколько разных решений SAP с различными размерами баз данных, а также показателями потребления ресурсов ЦП и памяти. Скорее всего, не все из этих систем SAP основаны на SAP HANA, поэтому ландшафт SAP, возможно, будет гибридным, и в нем будут использоваться следующие системы.

- Системы SAP, развернутые локально. Из-за размеров эти системы в настоящее время не могут размещаться в Azure. Классический пример — рабочая система SAP ERP в Microsoft SQL Server (как база данных), для которой требуется больше ресурсов ЦП и памяти, чем могут предоставить виртуальные машины Azure.
- Системы SAP на основе SAP HANA, развернутые локально.
- Системы SAP, развернутые на виртуальных машинах Azure. Это могут быть экземпляры разработки, тестирования, песочницы или рабочие экземпляры для всех приложений на основе SAP NetWeaver, которые можно развернуть в Azure (на виртуальных машинах) с учетом требований к ресурсам и памяти. Эти системы могут быть созданы на основе баз данных, например SQL Server (см. примечание [SAP Note #1928533 – SAP Applications on Azure: Supported Products and Azure VM types](https://launchpad.support.sap.com/#/notes/1928533/E) (Примечание SAP № 1928533. Приложения SAP в Azure: поддерживаемые продукты и типы виртуальных машин Azure)) или SAP HANA (см. [список сертифицированных платформ IaaS для SAP HANA](http://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html)).
- Серверы приложений SAP, развернутые в Azure (на виртуальных машинах), которые используют SAP HANA в Azure (крупные экземпляры) в стеках крупных экземпляров Azure.

Хотя гибридный ландшафт SAP (с четырьмя или более разными сценариями развертывания) — обычное явление, в Azure может работать весь ландшафт SAP. По мере увеличения производительности виртуальных машин Microsoft Azure число решений SAP, развертываемых на этих виртуальных машинах, будет расти.

Сети Azure в контексте систем SAP, развернутых в Azure, не сложные. Это связано со следующими аспектами.

- Виртуальные сети Azure должны быть подключены к каналу Azure ExpressRoute, который подключается к локальной сети.
- Канал ExpressRoute для подключения локальной среды к Azure обычно должен иметь пропускную способность 1 Гбит/с или выше. Эта минимальная пропускная способность позволяет обеспечить достаточную пропускную способность для передачи данных между локальными системами и системами, запущенными на виртуальных машинах Azure (а также подключение к системам Azure из локальной среды конечных пользователей).
- Для взаимодействия друг с другом все системы SAP в Azure должны быть настроены в виртуальных сетях Azure.
- Службы Active Directory и DNS, размещенные локально, можно использовать в Azure через локальный ExpressRoute.


> [!NOTE] 
> С точки зрения выставления счетов одну подписку Azure можно привязать только к одному клиенту в стеке крупных экземпляров в определенном регионе Azure и наоборот. Этот факт не отличается от любых других объектов в Azure, которые подлежат оплате.

Развертывание SAP HANA в Azure (крупные экземпляры) в нескольких разных регионах Azure приведет к тому, что другой клиент будет развернут в стеке крупных экземпляров. Тем не менее оба клиента могут выполняться в одной подписке Azure, если эти экземпляры являются частью одного ландшафта SAP. 

> [!IMPORTANT] 
> Для SAP HANA в Azure (крупные экземпляры) поддерживается только модель развертывания Azure Resource Manager.

 

### <a name="additional-azure-vnet-information"></a>Дополнительные сведения о виртуальной сети Azure

Чтобы подключить виртуальную сеть Azure к ExpressRoute, необходимо создать шлюз Azure (см. статью [Сведения о шлюзах виртуальных сетей ExpressRoute](../../../expressroute/expressroute-about-virtual-network-gateways.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). Шлюз Azure можно использовать для подключения ExpressRoute к инфраструктуре за пределами Azure (или к стеку крупных экземпляров Azure) или для подключения между виртуальными сетями Azure (см. статью [Настройка подключения между виртуальными сетями в развертывании Resource Manager с помощью PowerShell](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). Шлюз Azure можно подключить максимум к четырем разным соединениям ExpressRoute при условии, что они поступают из различных конечных маршрутизаторов Microsoft Enterprise Edges (MSEE).  Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

> [!NOTE] 
> В обоих случаях шлюз Azure обеспечивает разную пропускную способность (см. статью [Основные сведения о VPN-шлюзах Azure](../../../vpn-gateway/vpn-gateway-about-vpngateways.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). Максимальная пропускная способность, которой можно достичь с использованием шлюза виртуальной сети, — 10 Гбит/с при подключении ExpressRoute. Следует помнить, что при копировании файлов между виртуальной машиной Azure, расположенной в виртуальной сети Azure, и локальной системой (в рамках одного потока копирования) невозможно достичь полной пропускной способности шлюза с разными номерами SKU. Чтобы получить максимальную пропускную способность шлюза виртуальной сети, нужно использовать несколько потоков или копировать разные файлы с помощью параллельных потоков одного файла.


### <a name="networking-architecture-for-hana-large-instances"></a>Архитектура сети для крупных экземпляров HANA
Архитектуру сети для крупных экземпляров HANA, как показано ниже, можно разделить на четыре части:

- Локальная сеть и подключение ExpressRoute к Azure. Эта часть является доменом пользователей и подключается к Azure через ExpressRoute. Эта часть расположена в правом нижнем углу на схеме ниже.
- Сеть Azure, описанная выше, состоит из виртуальных сетей Azure со шлюзами. В этой области необходимо определить подходящую структуру в соответствии с требованиями приложений, безопасности и нормативных требований. При использовании крупных экземпляров HANA также необходимо выбрать число виртуальных сетей и SKU шлюзов Azure. Эта часть расположена в правом верхнем углу на схеме.
- Подключение крупных экземпляров HANA к Azure с помощью технологии ExpressRoute. Эту часть развертывает и обслуживает корпорация Майкрософт. Вам достаточно предоставить диапазоны IP-адресов и после развертывания ресурсов в крупных экземплярах HANA подключить канал ExpressRoute к виртуальным сетям Azure (см. статью [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). 
- Сетевое взаимодействие в крупных экземплярах HANA, которое в основном прозрачно для вас как клиента.

![Виртуальная сеть Azure подключена к SAP HANA в Azure (крупные экземпляры) и к локальной сети](./media/hana-overview-architecture/image3-on-premises-infrastructure.png)

Использование крупных экземпляров HANA не отменяет требование подключать локальные ресурсы к Azure через ExpressRoute. Также требуется иметь одну или несколько виртуальных сетей с виртуальными машинами Azure, на которых размещен уровень приложений, который подключается к экземплярам HANA, размещенным в единицах крупных экземпляров HANA. 

Отличия развертываний SAP только в Azure заключаются в следующем:

- Единицы крупных экземпляров HANA пользовательского клиента соединены через другой канал ExpressRoute с виртуальными сетями Azure. Для разделения условий нагрузки локальные подключения ExpressRoute к виртуальным сетям Azure и подключения между виртуальными сетями Azure и крупными экземплярами HANA не могут совместно использовать те же маршрутизаторы.
- Профиль рабочей нагрузки между уровнем приложений SAP и экземпляром HANA является другой причиной возникновения множества небольших запросов и пиков передачи данных (результирующие наборы) между SAP HANA и уровнем приложений.
- Архитектура приложения SAP более чувствительна к задержкам в сети, чем в типичных сценариях, где обмен данными происходит между локальной средой и Azure.
- Шлюз виртуальной сети имеет по крайней мере два подключения ExpressRoute, которые будут обеспечивать максимальную пропускную способность для входящих данных шлюза виртуальной сети.

Сетевая задержка между виртуальными машинами Azure и единицами крупных экземпляров HANA может быть выше, чем обычная задержка приема-передачи между виртуальными машинами. В зависимости от региона Azure значения задержки приема-передачи могут превышать 0,7 мс. Такие значения классифицируются как значения ниже среднего в [SAP Note #1100926 - FAQ: Network performance](https://launchpad.support.sap.com/#/notes/1100926/E) (Примечание к SAP № 1100926. Часто задаваемые вопросы: производительность сети). Тем не менее клиенты успешно развертывают производственные приложения SAP на основе SAP HANA в крупных экземплярах SAP HANA. Клиенты сообщили об улучшении работы приложений SAP в SAP HANA с использованием единиц крупных экземпляров HANA. Однако следует тщательно протестировать бизнес-процессы в крупных экземплярах HANA в Azure.
 
Чтобы обеспечить детерминированную сетевую задержку между виртуальными машинами Azure и крупными экземплярами HANA, важно выбрать правильный номер SKU шлюза виртуальной сети Azure. В отличие от шаблонов трафика между локальными и виртуальными машинами Azure, шаблон трафика между виртуальными машинами Azure и крупными экземплярами HANA может показывать короткий, но высокий пик запросов и объемов передаваемых данных. Для нормальной обработки таких пиков рекомендуется использовать шлюз с номером SKU UltraPerformance. Для номеров SKU крупных экземпляров HANA 2 класса использование номера SKU шлюза UltraPerformance в качестве шлюза виртуальной сети Azure является обязательным.  

> [!IMPORTANT] 
> Учитывая общий сетевой трафик между уровнями базы данных и приложений SAP, для подключения виртуальных сетей к SAP HANA в Azure (крупные экземпляры) поддерживается только шлюз с номером SKU HighPerformance или UltraPerformance. Для номеров SKU крупных экземпляров HANA 2 класса в качестве шлюза виртуальной сети Azure поддерживается только шлюз UltraPerformance.



### <a name="single-sap-system"></a>Одна система SAP

Локальная инфраструктура, показанная выше, подключена к Azure через канал ExpressRoute, который подключен к конечному маршрутизатору Microsoft Enterprise (см. статью [Технический обзор ExpressRoute](../../../expressroute/expressroute-introduction.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). После установки этот маршрут подключается к магистральной сети Microsoft Azure, и все регионы Azure становятся доступными.

> [!NOTE] 
> Для работы с ландшафтом SAP в Azure выполните подключение к маршрутизатору MSEE, который расположен ближе других к региону Azure в пределах ландшафта SAP. Стеки крупных экземпляров Azure подключаются с помощью специальных устройств MSEE для минимизации сетевой задержки между виртуальными машинами Azure в Azure IaaS и стеками крупных экземпляров.

Шлюз виртуальной сети для виртуальных машин Azure, где размещены экземпляры приложений SAP, подключен к этому каналу ExpressRoute, а та же виртуальная сеть подключена к отдельному маршрутизатору MSEE, предназначенному для подключения к стекам крупных экземпляров.

Это простой пример одной системы SAP, где уровень приложений SAP размещен в Azure, а база данных SAP HANA выполняется в SAP HANA в Azure (крупные экземпляры). Предполагается, что пропускная способность шлюза виртуальной сети 2 Гбит/с или 10 Гбит/с не подразумевает узкое место производительности.

### <a name="multiple-sap-systems-or-large-sap-systems"></a>Несколько обычных или крупных систем SAP

Если несколько обычных или крупных систем SAP подключены к SAP HANA в Azure (крупные экземпляры), целесообразно предположить, что пропускная способность шлюза виртуальной сети может стать узким местом. В этом случае необходимо разбить уровни приложений на несколько виртуальных сетей Azure. Мы также рекомендуем создать специальные виртуальные сети, которые подключаются к крупным экземплярам HANA в таких случаях:

- Выполнение архивации непосредственно из экземпляров HANA в крупных экземплярах HANA на виртуальную машину в Azure, где размещаются общие ресурсы NFS.
- Копирование больших резервных копий и других файлов из крупных экземпляров HANA на диск, управляемый в Azure.

При использовании отдельных виртуальных сетей, в которых размещаются виртуальные машины, управляющие хранилищем, передача крупных файлов или большого объема данных из крупных экземпляров HANA в Azure на шлюзе виртуальной сети, обслуживающем виртуальные машины, на которых выполняется уровень приложений SAP, никак не повлияет на работу. 

Для более масштабируемой сетевой архитектуры:

- Используйте несколько виртуальных сетей Azure для одного большего уровня приложений SAP.
- Вместо объединения систем SAP из разных подсетей в одну виртуальную сеть разверните отдельную виртуальную сеть Azure для каждой развернутой системы SAP.

 Более масштабируемая сетевая архитектура для SAP HANA в Azure (крупные экземпляры):

![Развертывание уровня приложений SAP в нескольких виртуальных сетях Azure](./media/hana-overview-architecture/image4-networking-architecture.png)

Если развернуть уровень приложений SAP или его компоненты в нескольких виртуальных сетях Azure, как показано выше, это неизбежно вызовет дополнительные задержки, возникающие во время обмена данными между приложениями, размещенными в разных виртуальных сетях Azure. По умолчанию сетевой трафик между виртуальными машинами Azure, расположенными в разных виртуальных сетях, проходит через маршрутизаторы MSEE. Начиная с сентября 2016 года существует возможность избежать такой маршрутизации и оптимизировать среду. Чтобы повысить эффективность и сократить задержки в взаимодействии между двумя виртуальными сетями, следует сделать их одноранговыми виртуальными сетями в одном регионе Azure. Это возможно, даже если эти виртуальные сети относятся к разным подпискам. Пиринг виртуальных сетей Azure позволяет виртуальным машинам в двух разных виртуальных сетях Azure напрямую взаимодействовать друг с другом через магистральную сеть Azure. В этом случае задержка будет такая же, как если бы эти виртуальные машины находились в одной виртуальной сети. Если же взаимодействие выполняется между диапазонами IP-адресов, соединенными через шлюз виртуальной сети Azure, весь трафик направляется через этот конкретный шлюз виртуальной сети. Информацию о пиринге виртуальных сетей Azure можно получить в статье [Пиринговая связь между виртуальными сетями](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview).


### <a name="routing-in-azure"></a>Маршрутизация в Azure

Существует две важные рекомендации относительно сетевой маршрутизации для SAP HANA в Azure (крупные экземпляры).

1. К SAP HANA в Azure (крупные экземпляры) могут получать доступ только виртуальные машины Azure через выделенное подключение ExpressRoute. К этому решению нельзя получить доступ напрямую из локальной среды. Таким образом, клиенты администрирования и любые приложения, требующие прямого доступа, например запущенный локально SAP Solution Manager, не могут подключиться к базе данных SAP HANA.

2. Единицам SAP HANA в Azure (крупные экземпляры) назначается IP-адрес из диапазона IP-адресов пула серверов, указанного клиентом. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).  Доступ к этому IP-адресу можно получить с помощью подписки Azure и канала ExpressRoute, по которому виртуальные сети Azure подключаются к HANA в Azure (крупные экземпляры). IP-адрес, назначенный из этого диапазона IP-адресов пула серверов, напрямую присваивается аппаратной единице и больше не используется NAT, как это имело место в первых развертываниях этого решения. 

> [!NOTE] 
> Если в сценарии с _хранилищем данных_, где приложениям и (или) конечным пользователям требуется подключение к базе данных SAP HANA (напрямую), необходимо подключение к SAP HANA в Azure (крупные экземпляры), нужно использовать другой сетевой компонент: обратный прокси-сервер для маршрутизации входящих и исходящих данных. Например, F5 BIG-IP, NGINX с диспетчером трафика, развернутый в Azure как решение для маршрутизации трафика и реализации виртуального брандмауэра.

### <a name="internet-connectivity-of-hana-large-instances"></a>Подключение крупных экземпляров HANA к Интернету
Крупные экземпляры HANA не подключены к Интернету напрямую. Это ограничивает ваши возможности, например зарегистрировать образ ОС напрямую с использованием поставщика ОС. Следовательно, вам может потребоваться поработать с локальным сервером SLES SMT или диспетчером подписки RHEL.

### <a name="data-encryption-between-azure-vms-and-hana-large-instances"></a>Шифрование данных между виртуальными машинами Azure и крупными экземплярами HANA
Данные, передаваемые между виртуальными машинами Azure и крупными экземплярами HANA, не шифруются. Однако исключительно для обмена между СУБД HANA и приложениями на основе JDBC/ODBC вы можете включить шифрование трафика. Подробнее об этом см. в [этой документации по SAP](http://help-legacy.sap.com/saphelp_hanaplatform/helpdata/en/db/d3d887bb571014bf05ca887f897b99/content.htm?frameset=/en/dd/a2ae94bb571014a48fc3b22f8e919e/frameset.htm&current_toc=/en/de/ec02ebbb57101483bdf3194c301d2e/plain.htm&node_id=20&show_children=false).

### <a name="using-hana-large-instance-units-in-multiple-regions"></a>Использование единиц крупных экземпляров HANA в нескольких регионах

У вас могут быть другие причины для развертывания SAP HANA в Azure (крупные экземпляры) в нескольких регионах Azure помимо аварийного восстановления. Возможно, вам необходимо получить доступ к крупным экземплярам HANA из каждой виртуальной машины, развернутой в разных виртуальных сетях в регионах. Так как IP-адреса, назначенные разным единицам крупных экземпляров HANA, не распространяются за пределы виртуальных сетей Azure (которые напрямую подключены к экземплярам через шлюз), в представленную выше структуру виртуальной сети внесено некоторое изменение: шлюз виртуальной сети Azure может обрабатывать четыре различных канала ExpressRoute из разных маршрутизаторов MSEE, и каждая виртуальная сеть, подключенная к одному из стеков крупных экземпляров, может быть подключена к стеку крупных экземпляров в другом регионе Azure.

![Виртуальные сети Azure, подключенные к стекам крупных экземпляров Azure в разных регионах Azure](./media/hana-overview-architecture/image8-multiple-regions.png)

На рисунке выше показано, как разные виртуальные сети Azure в обоих регионах подключены к двум разным каналам ExpressRoute, используемым для подключения к SAP HANA в Azure (крупные экземпляры) в обоих регионах Azure. Новые подключения представлены прямоугольными красными линиями. При такой схеме подключений из виртуальных сетей Azure виртуальные машины, работающие в одной из этих виртуальных сетей, могут получать доступ к каждому из разных единиц крупных экземпляров HANA, развернутых в двух регионах. Как видно на рисунке выше, предполагается, что имеется два подключения ExpressRoute между локальной системой и двумя регионами Azure. Это рекомендуется в целях аварийного восстановления.

> [!IMPORTANT] 
> Если используется несколько каналов ExpressRoute, чтобы обеспечить правильную маршрутизацию трафика, следует использовать атрибут AS PATH и настройки локального предпочтения BGP.


