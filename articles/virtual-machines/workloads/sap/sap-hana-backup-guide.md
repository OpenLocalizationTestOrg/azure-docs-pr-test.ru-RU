---
title: "Руководство по резервному копированию SAP HANA на виртуальных машинах Azure | Документация Майкрософт"
description: "Рекомендации по использованию двух основных возможностей резервного копирования SAP HANA на виртуальных машинах Azure."
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 9e5b124643b753f404ba6012d3df998f567be59a
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2017
---
# <a name="backup-guide-for-sap-hana-on-azure-virtual-machines"></a><span data-ttu-id="b38d3-103">Руководство по резервному копированию SAP HANA на виртуальных машинах Azure</span><span class="sxs-lookup"><span data-stu-id="b38d3-103">Backup guide for SAP HANA on Azure Virtual Machines</span></span>

## <a name="getting-started"></a><span data-ttu-id="b38d3-104">Приступая к работе</span><span class="sxs-lookup"><span data-stu-id="b38d3-104">Getting Started</span></span>

<span data-ttu-id="b38d3-105">В этом руководстве по резервному копированию для платформы SAP HANA, запущенной на виртуальных машинах Azure, рассматриваются темы, относящиеся только к Azure.</span><span class="sxs-lookup"><span data-stu-id="b38d3-105">The backup guide for SAP HANA running on Azure virtual Machines will only describe Azure-specific topics.</span></span> <span data-ttu-id="b38d3-106">Общие сведения об элементах, связанных с резервным копированием на платформе SAP HANA, см. в _документации по SAP HANA_, ссылки на которую представлены далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="b38d3-106">For general SAP HANA backup related items, check the SAP HANA documentation (see _SAP HANA backup documentation_ later in this article).</span></span>

<span data-ttu-id="b38d3-107">В этой статье рассматриваются две основные возможности резервного копирования SAP HANA на виртуальных машинах Azure:</span><span class="sxs-lookup"><span data-stu-id="b38d3-107">The focus of this article is on two major backup possibilities for SAP HANA on Azure virtual machines:</span></span>

- <span data-ttu-id="b38d3-108">резервное копирование HANA в файловую систему на виртуальной машине Azure под управлением Linux (см. статью [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md));</span><span class="sxs-lookup"><span data-stu-id="b38d3-108">HANA backup to the file system in an Azure Linux Virtual Machine (see [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md))</span></span>
- <span data-ttu-id="b38d3-109">резервное копирование HANA на основе моментальных снимков хранилища с помощью функции создания моментальных снимков Azure Storage Blob (вручную) или службы архивации Azure (см. статью [Резервное копирование SAP HANA на основе моментальных снимков хранилища](sap-hana-backup-storage-snapshots.md)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-109">HANA backup based on storage snapshots using the Azure storage blob snapshot feature manually or Azure Backup Service (see [SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md))</span></span>

<span data-ttu-id="b38d3-110">SAP HANA предоставляет API-интерфейс архивации, который позволяет интегрировать средства резервного копирования сторонних поставщиков непосредственно с SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-110">SAP HANA offers a backup API, which allows third-party backup tools to integrate directly with SAP HANA.</span></span> <span data-ttu-id="b38d3-111">(В этом руководстве эта возможность не рассматривается.) Сейчас этот API-интерфейс не поддерживает прямую интеграцию SAP HANA со службой архивации Azure.</span><span class="sxs-lookup"><span data-stu-id="b38d3-111">(That is not within the scope of this guide.) There is no direct integration of SAP HANA with Azure Backup service available right now based on this API.</span></span>

<span data-ttu-id="b38d3-112">SAP HANA официально поддерживается на виртуальных машинах Azure типа GS5 как отдельный экземпляр с дополнительными ограничениями для рабочих нагрузок OLAP (см. [список сертифицированных платформ IaaS](https://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html) на веб-сайте SAP).</span><span class="sxs-lookup"><span data-stu-id="b38d3-112">SAP HANA is officially supported on Azure VM type GS5 as single instance with an additional restriction to OLAP workloads (see [Find Certified IaaS Platforms](https://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html) on the SAP website).</span></span> <span data-ttu-id="b38d3-113">При добавлении новых предложений для SAP HANA в Azure мы обновим эту статью.</span><span class="sxs-lookup"><span data-stu-id="b38d3-113">This article will be updated as new offerings for SAP HANA on Azure become available.</span></span>

<span data-ttu-id="b38d3-114">В Azure также доступно гибридное решение SAP HANA, где эта платформа выполняется на невиртуализированных физических серверах.</span><span class="sxs-lookup"><span data-stu-id="b38d3-114">There is also an SAP HANA hybrid solution available on Azure, where SAP HANA runs non-virtualized on physical servers.</span></span> <span data-ttu-id="b38d3-115">Тем не менее, в этом руководстве по резервному копированию SAP HANA в Azure рассматривается чистая среда Azure, где SAP HANA выполняется на виртуальной машине Azure, а не в &quot;крупных экземплярах&quot;. Дополнительные сведения об этом решении для резервного копирования в &quot;крупных экземплярах&quot; на основе моментальных снимков хранилища см. в статье [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](hana-overview-architecture.md).</span><span class="sxs-lookup"><span data-stu-id="b38d3-115">However, this SAP HANA Azure backup guide covers a pure Azure environment where SAP HANA runs in an Azure VM, not SAP HANA running on &quot;large instances.&quot; See [SAP HANA (large instances) overview and architecture on Azure](hana-overview-architecture.md) for more information about this backup solution on &quot;large instances&quot; based on storage snapshots.</span></span>

<span data-ttu-id="b38d3-116">Общие сведения о продуктах SAP, поддерживаемых в Azure, см. в [примечании SAP 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span><span class="sxs-lookup"><span data-stu-id="b38d3-116">General information about SAP products supported on Azure can be found in [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span></span>

<span data-ttu-id="b38d3-117">На трех рисунках ниже представлены общие сведения о вариантах резервного копирования SAP HANA с использованием возможностей Azure, а также показаны три возможных будущих сценария резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b38d3-117">The following three figures give an overview of the SAP HANA backup options using native Azure capabilities currently, and also show three potential future backup scenarios.</span></span> <span data-ttu-id="b38d3-118">Эти варианты подробно описаны в связанных статьях [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md) и [Резервное копирование SAP HANA на основе моментальных снимков хранилища](sap-hana-backup-storage-snapshots.md). Кроме того, в них представлены рекомендации по размеру и производительности резервных копий SAP HANA, размер которых может составлять несколько терабайт.</span><span class="sxs-lookup"><span data-stu-id="b38d3-118">The related articles [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) and [SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describe these options in more detail, including size and performance considerations for SAP HANA backups that are multi-terabytes in size.</span></span>

![Две возможности сохранения текущего состояния виртуальной машины](media/sap-hana-backup-guide/image001.png)

<span data-ttu-id="b38d3-120">На рисунке выше показана возможность сохранения текущего состояния виртуальной машины в службе архивации Azure или вручную на основе моментального снимка дисков виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="b38d3-120">This figure shows the possibility of saving the current VM state, either via Azure Backup service or manual snapshot of VM disks.</span></span> <span data-ttu-id="b38d3-121">При таком подходе пользователи не должны управлять резервными копиями SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-121">With this approach, one doesn&#39;t have to manage SAP HANA backups.</span></span> <span data-ttu-id="b38d3-122">При использовании сценария резервного копирования на основе моментального снимка диска клиенты сталкиваются с проблемами, связанными с согласованностью файловой системы и состоянием соответствующего приложению диска.</span><span class="sxs-lookup"><span data-stu-id="b38d3-122">The challenge of the disk snapshot scenario is file system consistency, and an application-consistent disk state.</span></span> <span data-ttu-id="b38d3-123">Сведения о согласованности см. в разделе _Согласованность данных SAP HANA при создании моментальных снимков хранилища_ этой статьи.</span><span class="sxs-lookup"><span data-stu-id="b38d3-123">The consistency topic is discussed in the section _SAP HANA data consistency when taking storage snapshots_ later in this article.</span></span> <span data-ttu-id="b38d3-124">Далее в этой статье также рассматриваются возможности и ограничения службы архивации Azure в отношении резервных копий SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-124">Capabilities and restrictions of Azure Backup service related to SAP HANA backups are also discussed later in this article.</span></span>

![Варианты создания резервной копии файлов SAP HANA на виртуальной машине](media/sap-hana-backup-guide/image002.png)

<span data-ttu-id="b38d3-126">На рисунке выше показаны варианты создания резервной копии файлов SAP HANA на виртуальной машине, а также их сохранение в другое расположение с помощью разных средств.</span><span class="sxs-lookup"><span data-stu-id="b38d3-126">This figure shows options for taking an SAP HANA file backup inside the VM, and then storing it HANA backup files somewhere else using different tools.</span></span> <span data-ttu-id="b38d3-127">Для создания резервной копии HANA требуется больше времени, чем для выполнения этого процесса на основе моментальных снимков, но первый вариант более целесообразный в плане целостности и согласованности данных.</span><span class="sxs-lookup"><span data-stu-id="b38d3-127">Taking a HANA backup requires more time than a snapshot-based backup solution, but it has advantages regarding integrity and consistency.</span></span> <span data-ttu-id="b38d3-128">Дополнительные сведения приведены далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="b38d3-128">More details are provided later in this article.</span></span>

![Возможный будущий сценарий резервного копирования SAP HANA](media/sap-hana-backup-guide/image003.png)

<span data-ttu-id="b38d3-130">На рисунке выше показан возможный будущий сценарий резервного копирования SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-130">This figure shows a potential future SAP HANA backup scenario.</span></span> <span data-ttu-id="b38d3-131">Если SAP HANA поддерживает создание резервных копий во вторичном экземпляре репликации, это обеспечивает дополнительные возможности резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b38d3-131">If SAP HANA allowed taking backups from a replication secondary, it would add additional options for backup strategies.</span></span> <span data-ttu-id="b38d3-132">В соответствии с записью на вики-сайте о SAP HANA сейчас эта возможность недоступна:</span><span class="sxs-lookup"><span data-stu-id="b38d3-132">Currently it isn't possible according to a post in the SAP HANA Wiki:</span></span>

<span data-ttu-id="b38d3-133">_&quot;Можно ли создавать резервные копии во вторичном экземпляре?_</span><span class="sxs-lookup"><span data-stu-id="b38d3-133">_&quot;Is it possible to take backups on the secondary side?_</span></span>

<span data-ttu-id="b38d3-134">_Нет. Сейчас резервные копии данных и журналов можно создавать только в первичном экземпляре. Если включена функция автоматического резервного копирования журналов, после перенаправления на вторичный экземпляр резервные копии журнала автоматически записываются туда&quot;_.</span><span class="sxs-lookup"><span data-stu-id="b38d3-134">_No, currently you can only take data and log backups on the primary side. If automatic log backup is enabled, after takeover to the secondary side, the log backups will automatically be written there.&quot;_</span></span>

## <a name="sap-resources-for-hana-backup"></a><span data-ttu-id="b38d3-135">Ресурсы SAP для резервного копирования HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-135">SAP resources for HANA backup</span></span>

### <a name="sap-hana-backup-documentation"></a><span data-ttu-id="b38d3-136">Документация по резервному копированию SAP HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-136">SAP HANA backup documentation</span></span>

- <span data-ttu-id="b38d3-137">[Introduction to SAP HANA Administration](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.00/en-US) (Общие сведения об администрировании SAP HANA)</span><span class="sxs-lookup"><span data-stu-id="b38d3-137">[Introduction to SAP HANA Administration](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.00/en-US)</span></span>
- <span data-ttu-id="b38d3-138">[Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) (Планирование стратегии резервного копирования и восстановления)</span><span class="sxs-lookup"><span data-stu-id="b38d3-138">[Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)</span></span>
- <span data-ttu-id="b38d3-139">[Schedule HANA Backup using ABAP DBACOCKPIT](http://www.hanatutorials.com/p/schedule-hana-backup-using-abap.html) (Планирование резервного копирования HANA с помощью ABAP DBACOCKPIT)</span><span class="sxs-lookup"><span data-stu-id="b38d3-139">[Schedule HANA Backup using ABAP DBACOCKPIT](http://www.hanatutorials.com/p/schedule-hana-backup-using-abap.html)</span></span>
- <span data-ttu-id="b38d3-140">[Schedule Data Backups (SAP HANA Cockpit)](http://help.sap.com/saphelp_hanaplatform/helpdata/en/6d/385fa14ef64a6bab2c97a3d3e40292/frameset.htm) (Планирование резервного копирования данных (панель SAP HANA))</span><span class="sxs-lookup"><span data-stu-id="b38d3-140">[Schedule Data Backups (SAP HANA Cockpit)](http://help.sap.com/saphelp_hanaplatform/helpdata/en/6d/385fa14ef64a6bab2c97a3d3e40292/frameset.htm)</span></span>
- <span data-ttu-id="b38d3-141">Часто задаваемые вопросы о резервном копировании SAP HANA см. в [примечании к SAP 1642148](https://launchpad.support.sap.com/#/notes/1642148)</span><span class="sxs-lookup"><span data-stu-id="b38d3-141">FAQ about SAP HANA backup in [SAP Note 1642148](https://launchpad.support.sap.com/#/notes/1642148)</span></span>
- <span data-ttu-id="b38d3-142">Часто задаваемые вопросы о моментальных снимках базы данных и хранилища SAP HANA см. в [примечании к SAP 2039883](https://launchpad.support.sap.com/#/notes/2039883)</span><span class="sxs-lookup"><span data-stu-id="b38d3-142">FAQ about SAP HANA database and storage snapshots in [SAP Note 2039883](https://launchpad.support.sap.com/#/notes/2039883)</span></span>
- <span data-ttu-id="b38d3-143">Сведения о сетевых файловых системах (NFS), неподдерживаемых для резервного копирования и восстановления, см. в [примечании к SAP 1820529](https://launchpad.support.sap.com/#/notes/1820529)</span><span class="sxs-lookup"><span data-stu-id="b38d3-143">Unsuitable network file systems for backup and recovery in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529)</span></span>

### <a name="why-sap-hana-backup"></a><span data-ttu-id="b38d3-144">Преимущества резервного копирования SAP HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-144">Why SAP HANA backup?</span></span>

<span data-ttu-id="b38d3-145">Служба хранилища Azure обеспечивает доступность и надежность по умолчанию. (Дополнительные сведения см. в статье [Введение в хранилище Microsoft Azure](../../../storage/common/storage-introduction.md).)</span><span class="sxs-lookup"><span data-stu-id="b38d3-145">Azure storage offers availability and reliability out of the box (see [Introduction to Microsoft Azure Storage](../../../storage/common/storage-introduction.md) for more information about Azure storage).</span></span>

<span data-ttu-id="b38d3-146">Минимальный размер &quot;резервной копии&quot; зависит от соглашений об уровне обслуживания для Azure, используемых для хранения файлов журналов и данных SAP HANA на виртуальных жестких дисках Azure, подключенных к виртуальной машине сервера SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-146">The minimum for &quot;backup&quot; is to rely on the Azure SLAs, keeping the SAP HANA data and log files on Azure VHDs attached to the SAP HANA server VM.</span></span> <span data-ttu-id="b38d3-147">Этот подход охватывает сбои виртуальной машины, но не возможные повреждения файлов журналов и данных SAP HANA или логические ошибки, например случайное удаление данных или файлов.</span><span class="sxs-lookup"><span data-stu-id="b38d3-147">This approach covers VM failures, but not potential damage to the SAP HANA data and log files, or logical errors like deleting data or files by accident.</span></span> <span data-ttu-id="b38d3-148">Резервные копии также необходимы для обеспечения соответствия требованиям или по юридическим причинам.</span><span class="sxs-lookup"><span data-stu-id="b38d3-148">Backups are also required for compliance or legal reasons.</span></span> <span data-ttu-id="b38d3-149">Короче говоря, резервные копии SAP HANA нужны всегда.</span><span class="sxs-lookup"><span data-stu-id="b38d3-149">In short, there is always a need for SAP HANA backups.</span></span>

### <a name="how-to-verify-correctness-of-sap-hana-backup"></a><span data-ttu-id="b38d3-150">Как проверить правильность резервной копии SAP HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-150">How to verify correctness of SAP HANA backup</span></span>
<span data-ttu-id="b38d3-151">При использовании моментальных снимков хранилища мы советуем выполнять тестовое восстановление в другой системе.</span><span class="sxs-lookup"><span data-stu-id="b38d3-151">When using storage snapshots, running a test restore on a different system is recommended.</span></span> <span data-ttu-id="b38d3-152">Этот подход позволяет убедиться в правильности резервной копии, а также в том, что внутренние процессы резервного копирования и восстановления выполняются должным образом.</span><span class="sxs-lookup"><span data-stu-id="b38d3-152">This approach provides a way to ensure that a backup is correct, and internal processes for backup and restore work as expected.</span></span> <span data-ttu-id="b38d3-153">Хотя в локальной среде этот процесс выполнить сложно, в облаке это можно сделать гораздо проще, временно выделив для этой цели необходимые ресурсы.</span><span class="sxs-lookup"><span data-stu-id="b38d3-153">While this is a significant hurdle on-premises, it is much easier to accomplish in the cloud by providing necessary resources temporarily for this purpose.</span></span>

<span data-ttu-id="b38d3-154">Обратите внимание, что недостаточно выполнить простое восстановление и проверку, когда платформа HANA настроена и запущена.</span><span class="sxs-lookup"><span data-stu-id="b38d3-154">Keep in mind that doing a simple restore and checking if HANA is up and running is not sufficient.</span></span> <span data-ttu-id="b38d3-155">В идеале необходимо проверить согласованность таблицы. Это позволит убедиться, что восстановленная база данных в порядке.</span><span class="sxs-lookup"><span data-stu-id="b38d3-155">Ideally, one should run a table consistency check to be sure that the restored database is fine.</span></span> <span data-ttu-id="b38d3-156">SAP HANA предлагает несколько типов проверок согласованности (см. [примечание к SAP 1977584](https://launchpad.support.sap.com/#/notes/1977584)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-156">SAP HANA offers several kinds of consistency checks described in [SAP Note 1977584](https://launchpad.support.sap.com/#/notes/1977584).</span></span>

<span data-ttu-id="b38d3-157">Сведения о проверке согласованности таблицы см. на веб-сайте SAP в [этой статье](http://help.sap.com/saphelp_hanaplatform/helpdata/en/25/84ec2e324d44529edc8221956359ea/content.htm#loio9357bf52c7324bee9567dca417ad9f8b).</span><span class="sxs-lookup"><span data-stu-id="b38d3-157">Information about the table consistency check can also be found on the SAP website at [Table and Catalog Consistency Checks](http://help.sap.com/saphelp_hanaplatform/helpdata/en/25/84ec2e324d44529edc8221956359ea/content.htm#loio9357bf52c7324bee9567dca417ad9f8b).</span></span>

<span data-ttu-id="b38d3-158">Для стандартных резервных копий файлов тестовое восстановление выполнять не обязательно.</span><span class="sxs-lookup"><span data-stu-id="b38d3-158">For standard file backups, a test restore is not necessary.</span></span> <span data-ttu-id="b38d3-159">Есть два средства SAP HANA, с помощью которых можно проверить, какую резервную копию можно использовать для восстановления: hdbbackupdiag и hdbbackupcheck.</span><span class="sxs-lookup"><span data-stu-id="b38d3-159">There are two SAP HANA tools that help to check which backup can be used for restore: hdbbackupdiag and hdbbackupcheck.</span></span> <span data-ttu-id="b38d3-160">Дополнительные сведения об этих средствах см. в статье [Manually Checking Whether a Recovery is Possible](https://help.sap.com/saphelp_hanaplatform/helpdata/en/77/522ef1e3cb4d799bab33e0aeb9c93b/content.htm) (Проверка возможности восстановления вручную).</span><span class="sxs-lookup"><span data-stu-id="b38d3-160">See [Manually Checking Whether a Recovery is Possible](https://help.sap.com/saphelp_hanaplatform/helpdata/en/77/522ef1e3cb4d799bab33e0aeb9c93b/content.htm) for more information about these tools.</span></span>

### <a name="pros-and-cons-of-hana-backup-versus-storage-snapshot"></a><span data-ttu-id="b38d3-161">Преимущества и недостатки резервной копии HANA и резервной копии на основе моментального снимка хранилища</span><span class="sxs-lookup"><span data-stu-id="b38d3-161">Pros and cons of HANA backup versus storage snapshot</span></span>

<span data-ttu-id="b38d3-162">В документации по SAP не указано, какая резервная копия более предпочтительна: резервная копия HANA или резервная копия на основе моментальных снимков хранилища.</span><span class="sxs-lookup"><span data-stu-id="b38d3-162">SAP doesn&#39;t give preference to either HANA backup versus storage snapshot.</span></span> <span data-ttu-id="b38d3-163">Там перечислены только преимущества и недостатки каждой из них. Таким образом каждый пользователь может выбрать предпочитаемый вариант в зависимости от ситуации и доступной технологии хранения (см. статью [Планирование стратегии резервного копирования и восстановления](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-163">It lists their pros and cons, so one can determine which to use depending on the situation and available storage technology (see [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)).</span></span>

<span data-ttu-id="b38d3-164">В Azure необходимо учитывать, что функция создания моментальных снимков больших двоичных объектов Azure не гарантирует согласованность файловой системы (см. статью [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) (Использование моментальных снимков больших двоичных объектов в PowerShell)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-164">On Azure, be aware of the fact that the Azure blob snapshot feature doesn&#39;t guarantee file system consistency (see [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/)).</span></span> <span data-ttu-id="b38d3-165">В разделе _Согласованность данных SAP HANA при создании моментальных снимков хранилища_ (см. ниже) рассматриваются некоторые вопросы, касающиеся этой функции.</span><span class="sxs-lookup"><span data-stu-id="b38d3-165">The next section, _SAP HANA data consistency when taking storage snapshots_, discusses some considerations regarding this feature.</span></span>

<span data-ttu-id="b38d3-166">Кроме того, пользователи, которые часто работают с моментальными снимками больших двоичных объектов, должны понимать процесс выставления счетов. Дополнительные сведения см. в статье [Understanding How Snapshots Accrue Charges](/rest/api/storageservices/understanding-how-snapshots-accrue-charges) (Общие сведения об увеличении платы при использовании моментальных снимков). Это не так очевидно, как при использовании виртуальных дисков Azure.</span><span class="sxs-lookup"><span data-stu-id="b38d3-166">In addition, one has to understand the billing implications when working frequently with blob snapshots as described in this article: [Understanding How Snapshots Accrue Charges](/rest/api/storageservices/understanding-how-snapshots-accrue-charges)—it isn&#39;t as obvious as using Azure virtual disks.</span></span>

### <a name="sap-hana-data-consistency-when-taking-storage-snapshots"></a><span data-ttu-id="b38d3-167">Согласованность данных SAP HANA при создании моментальных снимков хранилища</span><span class="sxs-lookup"><span data-stu-id="b38d3-167">SAP HANA data consistency when taking storage snapshots</span></span>

<span data-ttu-id="b38d3-168">При создании моментальных снимков хранилища обеспечение согласованности файловой системы и приложения связанно с определенными проблемами.</span><span class="sxs-lookup"><span data-stu-id="b38d3-168">File system and application consistency is a complex issue when taking storage snapshots.</span></span> <span data-ttu-id="b38d3-169">Самый простой способ избежать проблем — завершить работу SAP HANA или даже всей виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="b38d3-169">The easiest way to avoid problems would be to shut down SAP HANA, or maybe even the whole virtual machine.</span></span> <span data-ttu-id="b38d3-170">Это можно выполнить в прототипе, демонстрационной системе или даже в системе разработки. Но это не вариант для рабочей системы.</span><span class="sxs-lookup"><span data-stu-id="b38d3-170">A shutdown might be doable with a demo or prototype, or even a development system, but it is not an option for a production system.</span></span>

<span data-ttu-id="b38d3-171">В Azure необходимо учитывать, что функция создания моментальных снимков больших двоичных объектов Azure не гарантирует согласованность файловой системы.</span><span class="sxs-lookup"><span data-stu-id="b38d3-171">On Azure, one has to keep in mind that the Azure blob snapshot feature doesn&#39;t guarantee file system consistency.</span></span> <span data-ttu-id="b38d3-172">Она хорошо работает, если задействован только один диск виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="b38d3-172">It works fine however by using the SAP HANA snapshot feature, as long as there is only a single virtual disk involved.</span></span> <span data-ttu-id="b38d3-173">Но даже в таком случае необходимо проверять дополнительные компоненты.</span><span class="sxs-lookup"><span data-stu-id="b38d3-173">But even with a single disk, additional items have to be checked.</span></span> <span data-ttu-id="b38d3-174">В [примечании к SAP 2039883](https://launchpad.support.sap.com/#/notes/2039883) приведены важные сведения о резервных копиях SAP HANA и моментальных снимках хранилища.</span><span class="sxs-lookup"><span data-stu-id="b38d3-174">[SAP Note 2039883](https://launchpad.support.sap.com/#/notes/2039883) has important information about SAP HANA backups via storage snapshots.</span></span> <span data-ttu-id="b38d3-175">Например, там указано, что при использовании файловой системы XFS перед созданием моментального снимка хранилища необходимо выполнить **xfs\_freeze**. Это позволит обеспечить согласованность данных. (Дополнительные сведения о **xfs\_freeze** см. на [странице руководства Linux по xfs\_freeze(8)](https://linux.die.net/man/8/xfs_freeze).)</span><span class="sxs-lookup"><span data-stu-id="b38d3-175">For example, it mentions that, with the XFS file system, it is necessary to run **xfs\_freeze** before starting a storage snapshot to guarantee consistency (see [xfs\_freeze(8) - Linux man page](https://linux.die.net/man/8/xfs_freeze) for details on **xfs\_freeze**).</span></span>

<span data-ttu-id="b38d3-176">Тема согласованности данных становится еще более сложной, если в отдельной файловой системе находится несколько дисков или томов.</span><span class="sxs-lookup"><span data-stu-id="b38d3-176">The topic of consistency becomes even more challenging in a case where a single file system spans multiple disks/volumes.</span></span> <span data-ttu-id="b38d3-177">Примером может служить чередование данных с помощью mdadm или LVM.</span><span class="sxs-lookup"><span data-stu-id="b38d3-177">For example, by using mdadm or LVM and striping.</span></span> <span data-ttu-id="b38d3-178">В упомянутом выше примечании к SAP указано:</span><span class="sxs-lookup"><span data-stu-id="b38d3-178">The SAP Note mentioned above states:</span></span>

<span data-ttu-id="b38d3-179">_&quot;Помните, что система хранения должна гарантировать согласованность операций ввода-вывода при создании моментального снимка хранилища для каждого тома данных SAP HANA. Это значит, что создание моментальных снимков для тома данных определенной службы SAP HANA должно быть атомарной операцией&quot;_.</span><span class="sxs-lookup"><span data-stu-id="b38d3-179">_&quot;But keep in mind that the storage system has to guarantee I/O consistency while creating a storage snapshot per SAP HANA data volume, i.e. snapshotting of an SAP HANA service-specific data volume must be an atomic operation.&quot;_</span></span>

<span data-ttu-id="b38d3-180">Ниже приведены действия для создания согласованного моментального снимка, представляющего область данных HANA, в сценарии, когда файловая система XFS охватывает четыре виртуальных диска Azure.</span><span class="sxs-lookup"><span data-stu-id="b38d3-180">Assuming there is an XFS file system spanning four Azure virtual disks, the following steps provide a consistent snapshot that represents the HANA data area:</span></span>

- <span data-ttu-id="b38d3-181">Подготовьте моментальный снимок HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-181">HANA snapshot prepare</span></span>
- <span data-ttu-id="b38d3-182">Заморозьте файловую систему (например, выполните **xfs\_freeze**).</span><span class="sxs-lookup"><span data-stu-id="b38d3-182">Freeze the file system (for example, use **xfs\_freeze**)</span></span>
- <span data-ttu-id="b38d3-183">Создайте все необходимые моментальные снимки больших двоичных объектов в Azure.</span><span class="sxs-lookup"><span data-stu-id="b38d3-183">Create all necessary blob snapshots on Azure</span></span>
- <span data-ttu-id="b38d3-184">Освободите файловую систему.</span><span class="sxs-lookup"><span data-stu-id="b38d3-184">Unfreeze the file system</span></span>
- <span data-ttu-id="b38d3-185">Подтвердите моментальный снимок HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-185">Confirm the HANA snapshot</span></span>

<span data-ttu-id="b38d3-186">Мы советуем использовать приведенный выше процесс во всех случаях вне зависимости от файловой системы. Так вы гарантируете безопасность данных.</span><span class="sxs-lookup"><span data-stu-id="b38d3-186">Recommendation is to use the procedure above in all cases to be on the safe side, no matter which file system.</span></span> <span data-ttu-id="b38d3-187">Кроме того, его можно использовать при наличии одного диска или при чередовании данных по нескольким дискам с помощью mdadm или LVM.</span><span class="sxs-lookup"><span data-stu-id="b38d3-187">Or if it is a single disk or striping, via mdadm or LVM across multiple disks.</span></span>

<span data-ttu-id="b38d3-188">Очень важно подтвердить моментальный снимок HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-188">It is important to confirm the HANA snapshot.</span></span> <span data-ttu-id="b38d3-189">В режиме подготовки моментального снимка системе SAP HANA может потребоваться дополнительное дисковое пространство, так как этот процесс сопровождается &quot;копированием при записи&quot;.</span><span class="sxs-lookup"><span data-stu-id="b38d3-189">Due to the &quot;Copy-on-Write,&quot; SAP HANA might not require additional disk space while in this snapshot-prepare mode.</span></span> <span data-ttu-id="b38d3-190">Кроме того, вы также не сможете запустить новое резервное копирование до подтверждения моментального снимка SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-190">It&#39;s also not possible to start new backups until the SAP HANA snapshot is confirmed.</span></span>

<span data-ttu-id="b38d3-191">Служба архивации Azure использует расширения виртуальной машины Azure, что позволяет обеспечить согласованность файловой системы.</span><span class="sxs-lookup"><span data-stu-id="b38d3-191">Azure Backup service uses Azure VM extensions to take care of the file system consistency.</span></span> <span data-ttu-id="b38d3-192">Эти расширения недоступны для автономного использования.</span><span class="sxs-lookup"><span data-stu-id="b38d3-192">These VM extensions are not available for standalone usage.</span></span> <span data-ttu-id="b38d3-193">Пользователи по-прежнему должны управлять согласованностью SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-193">One still has to manage SAP HANA consistency.</span></span> <span data-ttu-id="b38d3-194">Дополнительные сведения см. в статье [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md).</span><span class="sxs-lookup"><span data-stu-id="b38d3-194">See the related article [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) for more information.</span></span>

### <a name="sap-hana-backup-scheduling-strategy"></a><span data-ttu-id="b38d3-195">Стратегия планирования резервного копирования SAP HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-195">SAP HANA backup scheduling strategy</span></span>

<span data-ttu-id="b38d3-196">В статье SAP HANA [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) (Планирование стратегии резервного копирования и восстановления) приведен базовый план резервного копирования:</span><span class="sxs-lookup"><span data-stu-id="b38d3-196">The SAP HANA article [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) states a basic plan to do backups:</span></span>

- <span data-ttu-id="b38d3-197">создание моментального снимка хранилища (ежедневно);</span><span class="sxs-lookup"><span data-stu-id="b38d3-197">Storage snapshot (daily)</span></span>
- <span data-ttu-id="b38d3-198">создание полной резервной копии данных с использованием файла или формата backint (раз в неделю);</span><span class="sxs-lookup"><span data-stu-id="b38d3-198">Complete data backup using file or bacint format (once a week)</span></span>
- <span data-ttu-id="b38d3-199">создание автоматических резервных копий журналов.</span><span class="sxs-lookup"><span data-stu-id="b38d3-199">Automatic log backups</span></span>

<span data-ttu-id="b38d3-200">Моментальное снимки хранилища создавать необязательно. Вместо них можно использовать измененные резервные копии HANA, например добавочные или разностные резервные копии (см. статью об [измененных резервных копиях](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-200">Optionally, one could go completely without storage snapshots; they could be replaced by HANA delta backups, like incremental or differential backups (see [Delta Backups](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm)).</span></span>

<span data-ttu-id="b38d3-201">В руководстве по администрированию HANA приведен пример списка,</span><span class="sxs-lookup"><span data-stu-id="b38d3-201">The HANA Administration guide provides an example list.</span></span> <span data-ttu-id="b38d3-202">где предполагается, что пользователь восстанавливает SAP HANA до определенной точки во времени, используя следующую последовательность резервных копий:</span><span class="sxs-lookup"><span data-stu-id="b38d3-202">It suggests that one recover SAP HANA to a specific point in time using the following sequence of backups:</span></span>

1. <span data-ttu-id="b38d3-203">полная резервная копия данных;</span><span class="sxs-lookup"><span data-stu-id="b38d3-203">Full data backup</span></span>
2. <span data-ttu-id="b38d3-204">разностная резервная копия;</span><span class="sxs-lookup"><span data-stu-id="b38d3-204">Differential backup</span></span>
3. <span data-ttu-id="b38d3-205">добавочная резервная копия 1;</span><span class="sxs-lookup"><span data-stu-id="b38d3-205">Incremental backup 1</span></span>
4. <span data-ttu-id="b38d3-206">добавочная резервная копия 2;</span><span class="sxs-lookup"><span data-stu-id="b38d3-206">Incremental backup 2</span></span>
5. <span data-ttu-id="b38d3-207">резервные копии журнала.</span><span class="sxs-lookup"><span data-stu-id="b38d3-207">Log backups</span></span>

<span data-ttu-id="b38d3-208">Рассматривая точное расписание в отношении того, когда и как часто должен выполняться определенный тип резервного копирования, мы не можем предоставить общие рекомендации. Этот процесс очень сильно зависит от клиента и от количества изменений данных в системе.</span><span class="sxs-lookup"><span data-stu-id="b38d3-208">Regarding an exact schedule as to when and how often a specific backup type should happen, it is not possible to give a general guideline—it is too customer-specific, and depends on how many data changes occur in the system.</span></span> <span data-ttu-id="b38d3-209">Специалисты SAP советуют создавать одну полную копию HANA раз в неделю, и это можно рассматривать как общую рекомендацию.</span><span class="sxs-lookup"><span data-stu-id="b38d3-209">One basic recommendation from SAP side, which can be seen as general guidance, is to make one full HANA backup once a week.</span></span>
<span data-ttu-id="b38d3-210">Сведения о резервных копиях журнала см. в [документации по SAP HANA](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm).</span><span class="sxs-lookup"><span data-stu-id="b38d3-210">Regarding log backups, see the SAP HANA documentation [Log Backups](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm).</span></span>

<span data-ttu-id="b38d3-211">Кроме того, специалисты SAP советуют выполнять действия по обслуживанию каталога резервных копий, чтобы предотвратить его постоянный рост. (Дополнительные сведения см. в статье [Housekeeping for Backup Catalog and Backup Storage](http://help.sap.com/saphelp_hanaplatform/helpdata/en/ca/c903c28b0e4301b39814ef41dbf568/content.htm) (Действия по обслуживанию каталога резервных копий и хранилища службы архивации)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-211">SAP also recommends doing some housekeeping of the backup catalog to keep it from growing infinitely (see [Housekeeping for Backup Catalog and Backup Storage](http://help.sap.com/saphelp_hanaplatform/helpdata/en/ca/c903c28b0e4301b39814ef41dbf568/content.htm)).</span></span>

### <a name="sap-hana-configuration-files"></a><span data-ttu-id="b38d3-212">Файлы конфигурации SAP HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-212">SAP HANA configuration files</span></span>

<span data-ttu-id="b38d3-213">Как указано в часто задаваемых вопросах в [примечании к SAP 1642148](https://launchpad.support.sap.com/#/notes/1642148), файлы конфигурации SAP HANA не являются частью стандартной резервной копии HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-213">As stated in the FAQ in [SAP Note 1642148](https://launchpad.support.sap.com/#/notes/1642148), the SAP HANA configuration files are not part of a standard HANA backup.</span></span> <span data-ttu-id="b38d3-214">Они не важны для восстановления системы.</span><span class="sxs-lookup"><span data-stu-id="b38d3-214">They are not essential to restore a system.</span></span> <span data-ttu-id="b38d3-215">После восстановления конфигурацию HANA можно изменить вручную.</span><span class="sxs-lookup"><span data-stu-id="b38d3-215">The HANA configuration could be changed manually after the restore.</span></span> <span data-ttu-id="b38d3-216">Если пользователь хочет получить ту же настраиваемую конфигурацию в процессе восстановления, файлы конфигурации HANA необходимо восстанавливать отдельно.</span><span class="sxs-lookup"><span data-stu-id="b38d3-216">In case one would like to get the same custom configuration during the restore process, it is necessary to back up the HANA configuration files separately.</span></span>

<span data-ttu-id="b38d3-217">Если стандартные резервные копии HANA передаются в выделенную файловую систему резервного копирования HANA, пользователь может также копировать в нее файлы конфигурации, а затем скопировать все вместе в конечное хранилище, например в "холодное" хранилище BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="b38d3-217">If standard HANA backups are going to a dedicated HANA backup file system, one could also copy the configuration files to the same backup filesystem, and then copy everything together to the final storage destination like cool blob storage.</span></span>

### <a name="sap-hana-cockpit"></a><span data-ttu-id="b38d3-218">Панель SAP HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-218">SAP HANA Cockpit</span></span>

<span data-ttu-id="b38d3-219">Панель SAP HANA позволяет выполнять мониторинг, а также управлять платформой SAP HANA через браузер.</span><span class="sxs-lookup"><span data-stu-id="b38d3-219">SAP HANA Cockpit offers the possibility of monitoring and managing SAP HANA via a browser.</span></span> <span data-ttu-id="b38d3-220">Здесь также можно обрабатывать резервные копии SAP HANA, и, следовательно, ее можно использовать в качестве альтернативы SAP HANA Studio и ABAP DBACOCKPIT. (Дополнительные сведения см. в [этой статье](https://help.sap.com/saphelp_hanaplatform/helpdata/en/73/c37822444344f3973e0e976b77958e/content.htm).)</span><span class="sxs-lookup"><span data-stu-id="b38d3-220">It also allows handling of SAP HANA backups, and therefore can be used as an alternative to SAP HANA Studio and ABAP DBACOCKPIT (see [SAP HANA Cockpit](https://help.sap.com/saphelp_hanaplatform/helpdata/en/73/c37822444344f3973e0e976b77958e/content.htm) for more information).</span></span>

![Экран управления базами данных на панели SAP HANA](media/sap-hana-backup-guide/image004.png)

<span data-ttu-id="b38d3-222">На рисунке выше показан экран управления базами данных на панели SAP HANA и элемент резервного копирования слева.</span><span class="sxs-lookup"><span data-stu-id="b38d3-222">This figure shows the SAP HANA Cockpit Database Administration Screen, and the backup tile on the left.</span></span> <span data-ttu-id="b38d3-223">Чтобы просмотреть резервные копии, требуются определенные разрешения пользователя для учетной записи входа.</span><span class="sxs-lookup"><span data-stu-id="b38d3-223">Seeing the backup tile requires appropriate user permissions for login account.</span></span>

![Мониторинг текущих резервных копий на панели SAP HANA](media/sap-hana-backup-guide/image005.png)

<span data-ttu-id="b38d3-225">Вы можете отслеживать состояние резервных копий на панели SAP HANA во время их создания. Как только резервное копирование будет завершено, станут доступны все сведения о резервных копиях.</span><span class="sxs-lookup"><span data-stu-id="b38d3-225">Backups can be monitored in SAP HANA Cockpit while they are ongoing and, once it is finished, all the backup details are available.</span></span>

![Пример использования Firefox на виртуальной машине Azure SLES 12 с GNOME Desktop](media/sap-hana-backup-guide/image006.png)

<span data-ttu-id="b38d3-227">Предыдущие снимки экрана сделаны на виртуальной машине Azure под управлением Windows.</span><span class="sxs-lookup"><span data-stu-id="b38d3-227">The previous screenshots were made from an Azure Windows VM.</span></span> <span data-ttu-id="b38d3-228">В отличии от них снимок экрана выше сделан в браузере Firefox на виртуальной машине Azure SLES 12 с GNOME Desktop.</span><span class="sxs-lookup"><span data-stu-id="b38d3-228">This one is an example using Firefox on an Azure SLES 12 VM with Gnome desktop.</span></span> <span data-ttu-id="b38d3-229">На нем показаны параметры определения расписания резервного копирования на панели SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-229">It shows the option to define SAP HANA backup schedules in SAP HANA Cockpit.</span></span> <span data-ttu-id="b38d3-230">Обратите внимание, что в качестве префикса в файлах резервных копий используются дата и время.</span><span class="sxs-lookup"><span data-stu-id="b38d3-230">As one can also see, it suggests date/time as a prefix for the backup files.</span></span> <span data-ttu-id="b38d3-231">В SAP HANA Studio при создании полной резервной копии файла по умолчанию используется префикс &quot;COMPLETE\_DATA\_BACKUP&quot;.</span><span class="sxs-lookup"><span data-stu-id="b38d3-231">In SAP HANA Studio, the default prefix is &quot;COMPLETE\_DATA\_BACKUP&quot; when doing a full file backup.</span></span> <span data-ttu-id="b38d3-232">Мы советуем использовать уникальный префикс.</span><span class="sxs-lookup"><span data-stu-id="b38d3-232">Using a unique prefix is recommended.</span></span>

### <a name="sap-hana-backup-encryption"></a><span data-ttu-id="b38d3-233">Шифрование резервной копии SAP HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-233">SAP HANA backup encryption</span></span>

<span data-ttu-id="b38d3-234">SAP HANA обеспечивает шифрование данных и журнала.</span><span class="sxs-lookup"><span data-stu-id="b38d3-234">SAP HANA offers encryption of data and log.</span></span> <span data-ttu-id="b38d3-235">Если данные и журнал SAP HANA не зашифрованы, тогда резервные копии также не шифруются.</span><span class="sxs-lookup"><span data-stu-id="b38d3-235">If SAP HANA data and log are not encrypted, then the backups are also not encrypted.</span></span> <span data-ttu-id="b38d3-236">Пользователи могут использовать для шифрования резервных копий SAP HANA сторонние решения.</span><span class="sxs-lookup"><span data-stu-id="b38d3-236">It is up to the customer to use some form of third-party solution to encrypt the SAP HANA backups.</span></span> <span data-ttu-id="b38d3-237">Дополнительные сведения о шифровании SAP HANA см. в статье [Data and Log Volume Encryption](https://help.sap.com/saphelp_hanaplatform/helpdata/en/dc/01f36fbb5710148b668201a6e95cf2/content.htm) (Шифрование журнального тома и тома данных).</span><span class="sxs-lookup"><span data-stu-id="b38d3-237">See [Data and Log Volume Encryption](https://help.sap.com/saphelp_hanaplatform/helpdata/en/dc/01f36fbb5710148b668201a6e95cf2/content.htm) to find out more about SAP HANA encryption.</span></span>

<span data-ttu-id="b38d3-238">В Microsoft Azure клиент может использовать для шифрования соответствующую функцию на виртуальной машине IaaS.</span><span class="sxs-lookup"><span data-stu-id="b38d3-238">On Microsoft Azure, a customer could use the IaaS VM encryption feature to encrypt.</span></span> <span data-ttu-id="b38d3-239">Например, пользователи могут использовать присоединенные к виртуальной машине выделенные диски данных, на которых хранятся резервные копии SAP HANA, а затем сделать копии на эти диски.</span><span class="sxs-lookup"><span data-stu-id="b38d3-239">For example, one could use dedicated data disks attached to the VM, which are used to store SAP HANA backups, then make copies of these disks.</span></span>

<span data-ttu-id="b38d3-240">Зашифрованные диски и виртуальные машины можно обрабатывать в службе архивации Azure (см. статью [Архивация и восстановление зашифрованных виртуальных машин с помощью службы архивации Azure](../../../backup/backup-azure-vms-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-240">Azure Backup service can handle encrypted VMs/disks (see [How to back up and restore encrypted virtual machines with Azure Backup](../../../backup/backup-azure-vms-encryption.md)).</span></span>

<span data-ttu-id="b38d3-241">Кроме того, вы можете отключить шифрование виртуальной машины SAP HANA и ее дисков, а затем сохранить файлы резервных копий SAP HANA в учетной записи хранения с поддержкой шифрования (см. статью [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](../../../storage/common/storage-service-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-241">Another option would be to maintain the SAP HANA VM and its disks without encryption, and store the SAP HANA backup files in a storage account for which encryption was enabled (see [Azure Storage Service Encryption for Data at Rest](../../../storage/common/storage-service-encryption.md)).</span></span>

## <a name="test-setup"></a><span data-ttu-id="b38d3-242">Тестирование настройки</span><span class="sxs-lookup"><span data-stu-id="b38d3-242">Test setup</span></span>

### <a name="test-virtual-machine-on-azure"></a><span data-ttu-id="b38d3-243">Тестирование виртуальных машин в Azure</span><span class="sxs-lookup"><span data-stu-id="b38d3-243">Test Virtual Machine on Azure</span></span>

<span data-ttu-id="b38d3-244">Ниже приведены проверки резервного копирования и восстановления, выполняемые с использованием SAP HANA на виртуальной машине Azure типа GS5.</span><span class="sxs-lookup"><span data-stu-id="b38d3-244">An SAP HANA installation in an Azure GS5 VM was used for the following backup/restore tests.</span></span>

![Раздел "Обзор" на портале Azure для тестовой виртуальной машины HANA](media/sap-hana-backup-guide/image007.png)

<span data-ttu-id="b38d3-246">На рисунке выше показан раздел "Обзор" на портале Azure для тестовой виртуальной машины HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-246">This figure shows part of the Azure portal overview for the HANA test VM.</span></span>

### <a name="test-backup-size"></a><span data-ttu-id="b38d3-247">Проверка размера резервной копии</span><span class="sxs-lookup"><span data-stu-id="b38d3-247">Test backup size</span></span>

![Снимок экрана консоли резервного копирования в HANA Studio с файлом резервной копии размером 229 ГБ для сервера индекса HANA](media/sap-hana-backup-guide/image008.png)

<span data-ttu-id="b38d3-249">Пустая таблица заполнена данными, общий размер резервной копии которых составляет 200 ГБ. Это позволит получить точные данные о производительности.</span><span class="sxs-lookup"><span data-stu-id="b38d3-249">A dummy table was filled up with data to get a total data backup size of over 200 GB to derive realistic performance data.</span></span> <span data-ttu-id="b38d3-250">На снимке экрана выше показана консоль резервного копирования в HANA Studio с файлом резервной копии размером 229 ГБ для сервера индекса HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-250">The figure was taken from the backup console in HANA Studio and shows the backup file size of 229 GB for the HANA index server.</span></span> <span data-ttu-id="b38d3-251">В тестах в SAP HANA Studio использовался префикс резервного копирования COMPLETE_DATA_BACKUP (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="b38d3-251">For the tests, the default backup prefix "COMPLETE_DATA_BACKUP" in SAP HANA Studio was used.</span></span> <span data-ttu-id="b38d3-252">В реальных рабочих системах следует определить более практичный префикс.</span><span class="sxs-lookup"><span data-stu-id="b38d3-252">In real production systems, a more useful prefix should be defined.</span></span> <span data-ttu-id="b38d3-253">На панели SAP HANA это время и дата.</span><span class="sxs-lookup"><span data-stu-id="b38d3-253">SAP HANA Cockpit suggests date/time.</span></span>

### <a name="test-tool-to-copy-files-directly-to-azure-storage"></a><span data-ttu-id="b38d3-254">Тестирование средства для копирования файлов непосредственно в службу хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="b38d3-254">Test tool to copy files directly to Azure storage</span></span>

<span data-ttu-id="b38d3-255">Чтобы передать файлы резервных копий SAP HANA непосредственно в хранилище BLOB-объектов Azure или общие папки Azure, использовалось средство blobxfer. Оно поддерживает оба целевых объекта и легко интегрируется в скрипты автоматизации благодаря интерфейсу командной строки.</span><span class="sxs-lookup"><span data-stu-id="b38d3-255">To transfer SAP HANA backup files directly to Azure blob storage, or Azure file shares, the blobxfer tool was used because it supports both targets and it can be easily integrated into automation scripts due to its command-line interface.</span></span> <span data-ttu-id="b38d3-256">Средство blobxfer доступно в [GitHub](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="b38d3-256">The blobxfer tool is available on [GitHub](https://github.com/Azure/blobxfer).</span></span>

### <a name="test-backup-size-estimation"></a><span data-ttu-id="b38d3-257">Оценка размера тестовой резервной копии</span><span class="sxs-lookup"><span data-stu-id="b38d3-257">Test backup size estimation</span></span>

<span data-ttu-id="b38d3-258">Очень важно оценить размер резервной копии SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-258">It is important to estimate the backup size of SAP HANA.</span></span> <span data-ttu-id="b38d3-259">Это позволяет улучшить производительность за счет определения максимального размера файла для нескольких файлов резервных копий в связи с параллелизмом во время копирования файлов.</span><span class="sxs-lookup"><span data-stu-id="b38d3-259">This estimate helps to improve performance by defining the max backup file size for a number of backup files, due to parallelism during a file copy.</span></span> <span data-ttu-id="b38d3-260">(Это объясняется далее в статье.) Необходимо также определить, какую резервную копию необходимо создавать: полную или измененную (добавочную или разностную).</span><span class="sxs-lookup"><span data-stu-id="b38d3-260">(Those details are explained later in this article.) One must also decide whether to do a full backup or a delta backup (incremental or differential).</span></span>

<span data-ttu-id="b38d3-261">К счастью, размер файлов резервных копий можно оценить с помощью простой инструкции SQL: **select \* from M\_BACKUP\_SIZE\_ESTIMATIONS** (см. статью [Estimate the Space Needed in the File System for a Data Backup](https://help.sap.com/saphelp_hanaplatform/helpdata/en/7d/46337b7a9c4c708d965b65bc0f343c/content.htm) (Оценка пространства, необходимого в файловой системе для резервной копии данных)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-261">Fortunately, there is a simple SQL statement that estimates the size of the backup files: **select \* from M\_BACKUP\_SIZE\_ESTIMATIONS** (see [Estimate the Space Needed in the File System for a Data Backup](https://help.sap.com/saphelp_hanaplatform/helpdata/en/7d/46337b7a9c4c708d965b65bc0f343c/content.htm)).</span></span>

![Выходные данные этой инструкции SQL практически соответствует реальному размеру полной резервной копии данных на диске](media/sap-hana-backup-guide/image009.png)

<span data-ttu-id="b38d3-263">В тестовой системе выходные данные этой инструкции SQL практически соответствуют реальному размеру полной резервной копии данных на диске.</span><span class="sxs-lookup"><span data-stu-id="b38d3-263">For the test system, the output of this SQL statement matches almost exactly the real size of the full data backup on disk.</span></span>

### <a name="test-hana-backup-file-size"></a><span data-ttu-id="b38d3-264">Проверка размера файла резервной копии HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-264">Test HANA backup file size</span></span>

![Ограничение максимального размера файлов резервных копий HANA в консоли резервного копирования HANA Studio](media/sap-hana-backup-guide/image010.png)

<span data-ttu-id="b38d3-266">В консоли резервного копирования HANA Studio можно ограничить максимальный размер файлов резервных копий HANA.</span><span class="sxs-lookup"><span data-stu-id="b38d3-266">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="b38d3-267">В примере среды эта функция позволяет разбить файл резервной копии емкостью 230 ГБ на несколько меньших файлов.</span><span class="sxs-lookup"><span data-stu-id="b38d3-267">In the sample environment, that feature makes it possible to get multiple smaller backup files instead of one 230-GB backup file.</span></span> <span data-ttu-id="b38d3-268">Файлы меньшего размера значительно влияют на производительность (см. статью [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md)).</span><span class="sxs-lookup"><span data-stu-id="b38d3-268">Smaller file size has a significant impact on performance (see the related article [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md)).</span></span>

## <a name="summary"></a><span data-ttu-id="b38d3-269">Сводка</span><span class="sxs-lookup"><span data-stu-id="b38d3-269">Summary</span></span>

<span data-ttu-id="b38d3-270">В таблице ниже приведены определенные на основе результатов тестов преимущества и недостатки решений для резервного копирования базы данных SAP HANA, запущенной на виртуальных машинах Azure.</span><span class="sxs-lookup"><span data-stu-id="b38d3-270">Based on the test results the following tables show pros and cons of solutions to back up an SAP HANA database running on Azure virtual machines.</span></span>

<span data-ttu-id="b38d3-271">**Резервное копирование SAP HANA в файловую систему и последующее копирование файлов резервных копий в окончательное расположение**</span><span class="sxs-lookup"><span data-stu-id="b38d3-271">**Back up SAP HANA to the file system and copy backup files afterwards to the final backup destination**</span></span>

|<span data-ttu-id="b38d3-272">Решение</span><span class="sxs-lookup"><span data-stu-id="b38d3-272">Solution</span></span>                                           |<span data-ttu-id="b38d3-273">Преимущества</span><span class="sxs-lookup"><span data-stu-id="b38d3-273">Pros</span></span>                                 |<span data-ttu-id="b38d3-274">Недостатки</span><span class="sxs-lookup"><span data-stu-id="b38d3-274">Cons</span></span>                                  |
|---------------------------------------------------|-------------------------------------|--------------------------------------|
|<span data-ttu-id="b38d3-275">Хранение резервных копий HANA на дисках виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="b38d3-275">Keep HANA backups on VM disks</span></span>                      |<span data-ttu-id="b38d3-276">Управление выполняется без дополнительных усилий</span><span class="sxs-lookup"><span data-stu-id="b38d3-276">No additional management efforts</span></span>     |<span data-ttu-id="b38d3-277">Используется дисковое пространство локальной виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="b38d3-277">Eats up local VM disk space</span></span>           |
|<span data-ttu-id="b38d3-278">Копирование файлов резервных копий в хранилище BLOB-объектов с помощью средства blobxfer</span><span class="sxs-lookup"><span data-stu-id="b38d3-278">Blobxfer tool to copy backup files to blob storage</span></span> |<span data-ttu-id="b38d3-279">Параллелизм для копирования нескольких файлов, возможность использования "холодного" хранилища BLOB-объектов</span><span class="sxs-lookup"><span data-stu-id="b38d3-279">Parallelism to copy multiple files, choice to use cool blob storage</span></span> | <span data-ttu-id="b38d3-280">Настройка дополнительного средства и написание пользовательских скриптов</span><span class="sxs-lookup"><span data-stu-id="b38d3-280">Additional tool maintenance and custom scripting</span></span> | 
|<span data-ttu-id="b38d3-281">Копирование больших двоичных объектов через PowerShell или интерфейс командной строки</span><span class="sxs-lookup"><span data-stu-id="b38d3-281">Blob copy via Powershell or CLI</span></span>                    |<span data-ttu-id="b38d3-282">Не нужно использовать дополнительные средства. Процесс выполняется через PowerShell или интерфейс командной строки</span><span class="sxs-lookup"><span data-stu-id="b38d3-282">No additional tool necessary, can be accomplished via Azure Powershell or CLI</span></span> |<span data-ttu-id="b38d3-283">Процесс выполняется вручную. Пользователь должен писать скрипты и управлять скопированными большими двоичными объектами для восстановления</span><span class="sxs-lookup"><span data-stu-id="b38d3-283">manual process, customer has to take care of scripting and management of copied blobs for restore</span></span>|
|<span data-ttu-id="b38d3-284">Копирование в общую папку NFS</span><span class="sxs-lookup"><span data-stu-id="b38d3-284">Copy to NFS share</span></span>                                  |<span data-ttu-id="b38d3-285">Постобработка файлов резервных копий на другой виртуальной машине, не влияя на сервер HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-285">Post-processing of backup files on other VM without impact on the HANA server</span></span>|<span data-ttu-id="b38d3-286">Копирование выполняется медленно</span><span class="sxs-lookup"><span data-stu-id="b38d3-286">Slow copy process</span></span>|
|<span data-ttu-id="b38d3-287">Копирование в службу файлов Azure с помощью blobxfer</span><span class="sxs-lookup"><span data-stu-id="b38d3-287">Blobxfer copy to Azure File Service</span></span>                |<span data-ttu-id="b38d3-288">Пространство на дисках локальной виртуальной машины не используется</span><span class="sxs-lookup"><span data-stu-id="b38d3-288">Doesn't eat up space on local VM disks</span></span>|<span data-ttu-id="b38d3-289">Резервная копия HANA не поддерживает непосредственную запись. Сейчас ограничение размера файлового ресурса составляет 5 ТБ</span><span class="sxs-lookup"><span data-stu-id="b38d3-289">No direct write support by HANA backup, size restriction of file share currently at 5 TB</span></span>|
|<span data-ttu-id="b38d3-290">Агент службы архивации Azure</span><span class="sxs-lookup"><span data-stu-id="b38d3-290">Azure Backup Agent</span></span>                                 | <span data-ttu-id="b38d3-291">Используется как предпочтительное решение</span><span class="sxs-lookup"><span data-stu-id="b38d3-291">Would be preferred solution</span></span>         | <span data-ttu-id="b38d3-292">Сейчас недоступен в Linux</span><span class="sxs-lookup"><span data-stu-id="b38d3-292">Currently not available on Linux</span></span>    |



<span data-ttu-id="b38d3-293">**Резервное копирование SAP HANA на основе моментальных снимков хранилища**</span><span class="sxs-lookup"><span data-stu-id="b38d3-293">**Backup SAP HANA based on storage snapshots**</span></span>

|<span data-ttu-id="b38d3-294">Решение</span><span class="sxs-lookup"><span data-stu-id="b38d3-294">Solution</span></span>                                           |<span data-ttu-id="b38d3-295">Преимущества</span><span class="sxs-lookup"><span data-stu-id="b38d3-295">Pros</span></span>                                 |<span data-ttu-id="b38d3-296">Недостатки</span><span class="sxs-lookup"><span data-stu-id="b38d3-296">Cons</span></span>                                  |
|---------------------------------------------------|-------------------------------------|--------------------------------------|
|<span data-ttu-id="b38d3-297">Служба архивации Azure</span><span class="sxs-lookup"><span data-stu-id="b38d3-297">Azure Backup Service</span></span>                               | <span data-ttu-id="b38d3-298">Поддерживает резервное копирование виртуальной машины на основе моментальных снимков хранилища</span><span class="sxs-lookup"><span data-stu-id="b38d3-298">Allows VM backup based on blob snapshots</span></span> | <span data-ttu-id="b38d3-299">Если восстановление выполняется не на уровне файлов, необходимо создать виртуальную машину, что подразумевает получение нового лицензионного ключа SAP HANA</span><span class="sxs-lookup"><span data-stu-id="b38d3-299">When not using file level restore, it requires the creation of a new VM for the restore process, which then implies the need of a new SAP HANA license key</span></span>|
|<span data-ttu-id="b38d3-300">Создание моментальных снимков больших двоичных объектов вручную</span><span class="sxs-lookup"><span data-stu-id="b38d3-300">Manual blob snapshots</span></span>                              | <span data-ttu-id="b38d3-301">Гибкость создания и восстановления конкретных дисков, не изменяя уникальный идентификатор виртуальной машины</span><span class="sxs-lookup"><span data-stu-id="b38d3-301">Flexibility to create and restore specific VM disks without changing the unique VM ID</span></span>|<span data-ttu-id="b38d3-302">Все процессы выполняются клиентами вручную</span><span class="sxs-lookup"><span data-stu-id="b38d3-302">All manual work, which has to be done by the customer</span></span>|

## <a name="next-steps"></a><span data-ttu-id="b38d3-303">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b38d3-303">Next steps</span></span>
* <span data-ttu-id="b38d3-304">В статье [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md) описан вариант резервного копирования на основе файлов,</span><span class="sxs-lookup"><span data-stu-id="b38d3-304">[SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) describes the file-based backup option.</span></span>
* <span data-ttu-id="b38d3-305">а в статье [Резервное копирование SAP HANA на основе моментальных снимков хранилища](sap-hana-backup-storage-snapshots.md) — на основе моментальных снимков хранилища.</span><span class="sxs-lookup"><span data-stu-id="b38d3-305">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="b38d3-306">Дополнительные сведения об обеспечении высокого уровня доступности и планировании аварийного восстановления SAP HANA в Azure (крупные экземпляры) см. в [этой статье](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="b38d3-306">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
