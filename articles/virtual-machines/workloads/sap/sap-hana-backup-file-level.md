---
title: "aaaSAP HANA резервного копирования Azure на уровне файлов | Документы Microsoft"
description: "Существуют две основные возможности резервного копирования SAP HANA на виртуальных машинах Azure. В этой статье рассматривается резервное копирование на уровне файлов."
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: d5a55de5634ac7724e7fd0fa3760c6c408c3db74
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-azure-backup-on-file-level"></a>Резервное копирование SAP HANA в Azure на уровне файлов

## <a name="introduction"></a>Введение

Эта статья входит в цикл из трех связанных статей, посвященных резервному копированию SAP HANA. [Руководстве по резервному копированию для SAP HANA на виртуальных машинах Azure](./sap-hana-backup-guide.md) содержит обзор и сведения о начале работы и [SAP HANA резервной копии, основанные на моментальных снимках хранилища](./sap-hana-backup-storage-snapshots.md) деле hello параметра резервного копирования на основе моментального снимка хранилища.

Просматривая hello размеров виртуальных Машин Azure, увидит, GS5 разрешает 64 подключенные диски данных. В крупных системах SAP HANA большее число этих дисков могут занимать файлы данных и журналов, а также программный RAID-массив, обеспечивающий оптимальную пропускную способность операций ввода-вывода на диске. Hello вопрос — где toostore SAP HANA резервное копирование файлов, которые может заполниться до конца данных hello присоединенных дисков со временем? В разделе [размеры виртуальных машин Linux в Azure](../../linux/sizes.md) для hello таблицы размера виртуальной Машины Azure.

Сейчас служба архивации Azure не поддерживает интеграцию с резервным копированием SAP HANA. стандартный способ Hello toomanage резервного копирования и восстановления на уровне файла hello — с помощью файлов резервной копии SAP HANA Studio или с помощью инструкций SAP HANA SQL. Дополнительные сведения см. в [справочнике по системным представлениям и представлениям SQL для SAP HANA](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf).

![На этом рисунке показано диалоговое окно приветствия пункта меню резервного копирования hello в SAP HANA Studio](media/sap-hana-backup-file-level/image022.png)

На этом рисунке показано диалоговое окно приветствия пункта меню резервного копирования hello в SAP HANA Studio. При выборе типа &quot;файл&quot; один имеет toospecify путь в файловой системе hello, где SAP HANA записывает hello файлов резервных копий. Восстановление работает hello таким же образом.

Хотя этот вариант выглядит простым, он имеет некоторые особенности. Как упоминалось ранее, к виртуальной машине Azure можно подключить ограничение количества дисков данных. Не может быть емкость toostore SAP HANA резервного копирования файлов в файловых системах hello объекта hello виртуальной Машины, в зависимости от размера hello hello базы данных и диск пропускной способности требования, выполнение которых может потребоваться программного обеспечения RAID-с помощью чередованием по нескольким данных дисков. Сведения о разных вариантах перемещения этих файлов резервных копий, а также об управлении ограничениями размера и производительностью при обработке терабайт данных приведены далее в этой статье.

Еще один вариант, обеспечивающий большую гибкость в отношении общей емкости, — это хранилище BLOB-объектов Azure. Один большой двоичный объект также является ограниченным too1 ТБ, общая емкость hello один большой двоичный объект контейнера в настоящее время составляет 500 ТБ. Кроме того, он дает пользователям hello choice tooselect так называемые &quot;ожиданием&quot; BLOB-объект хранилища, который имеет преимущество затрат. Сведения об этом хранилище см. в статье [Хранилище BLOB-объектов Azure: "горячий" и "холодный" уровни хранилища](../../../storage/blobs/storage-blob-storage-tiers.md).

В целях дополнительной безопасности геореплицированном хранилище учетной записи toostore hello SAP HANA резервные копии используйте. Дополнительные сведения о репликации учетной записи хранения см. в статье [Репликация службы хранилища Azure](../../../storage/common/storage-redundancy.md).

Пользователи могут поместить выделенные виртуальные жесткие диски, на которых хранятся резервные копии SAP HANA, в геореплицированную учетную запись хранения резервных копий. В противном случае один удалось скопировать hello VHD, в которых сохраняются резервные копии SAP HANA hello учетной записи хранилища с георепликацией tooa или tooa учетной записи хранилища, который находится в другом регионе.

## <a name="azure-backup-agent"></a>Агент службы архивации Azure

Toonot параметр hello Azure предлагает резервного копирования только резервное копирование завершено виртуальные машины, но также файлы и каталоги через hello резервного копирования, имеющая toobe установлен на hello гостевой ОС. Однако начиная с 2016 декабря, этот агент поддерживается только в Windows (см. [резервное копирование сервера или клиента tooAzure, с помощью модели развертывания диспетчера ресурсов hello](../../../backup/backup-configure-vault.md)).

Решения этой проблемы является копией toofirst tooa SAP HANA файлов резервных копий виртуальной Машины Windows в Azure (например, через общий ресурс SAMBA), а затем используйте hello агента резервного копирования Azure оттуда. Хотя технически возможно, он будет усложнения и замедлить hello резервного копирования или восстановления немного из-за toohello копию между hello Linux и ВМ Windows hello. Это не рекомендуется toofollow этот подход.

## <a name="azure-blobxfer-utility-details"></a>Сведения о служебной программе Azure blobxfer

toostore каталогам и файлам на хранилища Azure, можно было использовать интерфейс командной строки или PowerShell, или создайте средство, с помощью одного из hello [пакеты SDK Azure](https://azure.microsoft.com/downloads/). Существует также готовые к использованию служебной программы AzCopy, для копирования tooAzure хранения данных, но только в том случае Windows (в разделе [передачи данных с помощью командной строки программу AzCopy hello](../../../storage/common/storage-use-azcopy.md)).

Поэтому в рамках этой статьи для копирования файлов резервных копий SAP HANA мы используем blobxfer. Это средство с открытым исходным кодом доступно в [GitHub](https://github.com/Azure/blobxfer). Большое количество пользователей использует его в рабочих средах. Это средство позволяет toocopy данных напрямую tooeither Azure BLOB-объектов хранилища или Azure общей папке. Кроме того, это средство предоставляет ряд полезных возможностей, таких как поддержка MD5-хэша или автоматического параллелизма при копировании каталога с несколькими файлами.

## <a name="sap-hana-backup-performance"></a>Производительность резервного копирования SAP HANA

![На этом снимке экрана — SAP HANA hello резервного копирования консоли в SAP HANA Studio](media/sap-hana-backup-file-level/image023.png)

На этом снимке экрана — SAP HANA hello резервного копирования консоли в SAP HANA Studio. Ушло примерно 42 минут toodo hello архивации из hello 230 ГБ на диске один Azure стандартное хранилище присоединенного toohello HANA виртуальной Машины с помощью XFS файловой системы.

![На этом снимке экрана имеет YaST на hello SAP HANA тестовой виртуальной Машине](media/sap-hana-backup-file-level/image024.png)

На этом снимке экрана имеет YaST на hello SAP HANA тестовой виртуальной Машине. Как уже упоминалось увидит hello 1 ТБ отдельный диск для резервного копирования SAP HANA. Ушло примерно 42 минут toobackup 230 ГБ. Кроме того, к виртуальной машине подключены 5 дисков емкостью 200 ГБ, на которых установлен программный RAID-массив md0, выполняющий чередование по этим дискам данных Azure.

![Повторение hello же резервного копирования на программное обеспечение RAID с чередованием через пять присоединенных дисков с данными Azure стандартное хранилище](media/sap-hana-backup-file-level/image025.png)

Повторяющийся hello же резервного копирования на программное обеспечение RAID с чередованием через пять присоединенного время резервного копирования hello перевести диски данных Azure стандартное хранилище из 42 минут вниз too10 минут. без кэширования toohello виртуальной Машины были присоединены диски Hello. В этом случае является очевидным важность производительность записи на диск для hello время резервного копирования. Один может затем toofurther хранилища premium tooAzure коммутатора ускорить процесс hello для достижения оптимальной производительности. Как правило, это хранилище следует использовать в рабочих системах.

## <a name="copy-sap-hana-backup-files-tooazure-blob-storage"></a>Скопируйте хранилища больших двоичных объектов tooAzure SAP HANA файлов резервных копий

Как лучше всего 2016 декабря hello параметр tooquickly хранилище SAP HANA резервного копирования файлов: хранилище больших двоичных объектов. Один контейнер один большой двоичный объект имеет ограничение в 500 ТБ, достаточно для большинства систем SAP HANA, запущенным на виртуальной машине, GS5 в Azure, tookeep достаточно SAP HANA, резервные копии. Клиенты имеют hello Выбор между &quot;горячей&quot; и &quot;холодного&quot; хранилище больших двоичных объектов (в разделе [хранилища больших двоичных объектов: горячей и охлаждение уровни хранилища](../../../storage/blobs/storage-blob-storage-tiers.md)).

С помощью средства blobxfer hello это файлов резервных копий SAP HANA hello легко toocopy напрямую tooAzure хранилище больших двоичных объектов.

![Здесь один могут видеть файлы hello полной резервной копии файла SAP HANA](media/sap-hana-backup-file-level/image026.png)

Здесь один могут видеть файлы hello полной резервной копии файла SAP HANA. Существует четыре файла и hello крупнейших есть примерно 230 ГБ.

![Ушло примерно 3000 секунд toocopy tooan 230 ГБ hello Azure стандартное хранилище контейнер BLOB-объектов учетной записи](media/sap-hana-backup-file-level/image027.png)

Не использует хэш md5 в первоначальном тестировании hello, ушло примерно 3000 секунд toocopy tooan 230 ГБ hello Azure стандартное хранилище контейнер BLOB-объектов учетной записи.

![На этом снимке экрана можно см. на внешний вид на hello портал Azure](media/sap-hana-backup-file-level/image028.png)

На этом снимке экрана один см, как будет выглядеть на портал Azure hello. Контейнер больших двоичных объектов с именем &quot;sap hana резервные копии&quot; был создан и включает в себя четыре hello больших двоичных объектов, которые представляют Привет SAP HANA резервного копирования файлов. Размер одного из них составляет 230 ГБ.

консоль резервного копирования HANA Studio Hello позволяет один toorestrict hello максимальный размер файла резервной копии файлов HANA. В среде образец hello Улучшенная производительность за счет возможности toohave файлы несколько меньшего размера резервной копии, а не один большой файл 230 ГБ.

![Задание hello предельный размер файла резервной копии на стороне hello HANA &#39; t увеличить время резервного копирования hello](media/sap-hana-backup-file-level/image029.png)

Задание hello предельный размер файла резервной копии на стороне hello HANA &#39; t увеличить hello время резервного копирования, так как файлы hello записываются последовательно, как показано на рисунке. предельный размер файла Hello был установлен too60 ГБ, поэтому hello резервного копирования созданы четыре больших файлов данных вместо 230 ГБ hello одного файла.

![tootest параллелизма средства blobxfer hello, hello максимальный размер файла для резервного копирования HANA затем был настроен too15 ГБ](media/sap-hana-backup-file-level/image030.png)

tootest параллелизма средства blobxfer hello, hello максимальный размер файла для резервного копирования HANA затем был настроен too15 ГБ, что привело к 19 файлов резервных копий. Эта конфигурация перевести в режим hello время tooAzure blobxfer toocopy hello 230 ГБ хранилища BLOB-объектов из 3000 секунд работу too875 сек.

Этот результат — из-за ограничения toohello 60 МБ в секунду для записи большого двоичного объекта Azure. Параллелизм через несколько больших двоичных объектов позволяет решить hello узким местом, но есть недостаток: увеличение производительности hello blobxfer средство toocopy все эти файлы резервных копий tooAzure HANA хранилища больших двоичных объектов помещает нагрузки на hello HANA виртуальную Машину и сети hello. а это влияет на операции в системе HANA.

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a>Копирование большого двоичного объекта выделенных дисков данных Azure в программном RAID-массиве резервного копирования

В отличие от hello вручную виртуальной Машины диск резервного копирования данных в этом подходе одно не резервное копирование всех дисков виртуальной Машины toosave hello всю SAP сборку, включая данных HANA hello данных HANA регистрирует файлы и файлы конфигурации. Вместо этого hello представление — это toohave выделенной программное обеспечение RAID с чередованием через несколько данных Azure виртуальные жесткие диски для хранения полной резервной копии файла SAP HANA. Один копирует только эти диски, имеющих резервного копирования hello SAP HANA. Они легко может храниться в выделенную учетную запись хранения резервных копий HANA или присоединенного выделенного tooa &quot;резервного копирования виртуальных Машин управления&quot; для дальнейшей обработки.

![Все виртуальные жесткие диски участвующих были скопированы с помощью hello ** Пуск-azurestorageblobcopy ** команды PowerShell](media/sap-hana-backup-file-level/image031.png)

После завершения hello резервного копирования toohello локального программного обеспечения RAID, все виртуальные жесткие диски участвующих были скопированы с помощью hello **начала azurestorageblobcopy** команду PowerShell (см. [AzureStorageBlobCopy начала](/powershell/module/azure.storage/start-azurestorageblobcopy)). Как оно влияет только на выделенный hello файловой системы для хранения файлов резервных копий hello, нет никаких проблем, о SAP HANA данных или журнала согласованность файлов на диске hello. Преимущество этой команды — что он работает во время интерактивной hello виртуальной Машины. убедиться, что toounmount быть toobe, определенных в том, что процесс не записывает toohello резервного копирования чередующемся наборе, перед hello больших двоичных объектов копирования, а затем снова подключить его. Или можно было использовать соответствующий слишком&quot;закрепить&quot; hello файловой системы. Например, через xfs\_заморозить для hello XFS файловой системы.

![На этом снимке экрана показан список hello больших двоичных объектов в контейнере hello виртуальные жесткие диски на hello портал Azure](media/sap-hana-backup-file-level/image032.png)

На этом снимке экрана показан список hello больших двоичных объектов в hello &quot;виртуальные жесткие диски&quot; контейнера на hello портал Azure. Hello снимке экрана приветствия пяти виртуальных жестких дисков, которой были вложены tooserve виртуальной Машины сервера SAP HANA toohello как hello программного RAID tookeep SAP HANA файлов резервных копий. Он также показывает hello пять копий, которые были выполнены с помощью команды копирования большого двоичного объекта hello.

![В целях тестирования hello копий дисков RAID hello SAP HANA программное обеспечение резервного копирования были toohello вложенного приложения сервера виртуальной Машины](media/sap-hana-backup-file-level/image033.png)

В целях тестирования hello копии hello SAP HANA программное обеспечение резервного копирования RAID дисков были toohello вложенного приложения сервера виртуальной Машины.

![Виртуальная машина сервера приложения Hello была выключена копий дисков tooattach hello](media/sap-hana-backup-file-level/image034.png)

Виртуальная машина сервера приложения Hello была завершена копий дисков tooattach hello. После запуска hello виртуальной Машины, hello дисков и hello RAID обнаруженные правильно (устанавливать при помощи UUID). Только точку подключения hello отсутствует, которой была создана с помощью разделителя YaST hello. После этого копирует файл резервной копии SAP HANA hello стало видимым на уровне операционной системы.

## <a name="copy-sap-hana-backup-files-toonfs-share"></a>Скопируйте файлы резервной копии SAP HANA tooNFS общей папки

toolessen hello может оказать влияние на hello системы SAP HANA из производительности или дискового пространства перспективы, один может рассмотрите возможность хранения файлов резервной копии hello SAP HANA на общего ресурса NFS. Технически это работает, но это означает, что использование второй виртуальной Машине Azure в качестве узла hello из общей папки NFS приветствия. Не должно быть небольшой размер виртуальной Машины, из-за toohello пропускной способности сети виртуальной Машины. Это сделает смысле, а затем tooshut вниз это &quot;резервного копирования виртуальной Машины&quot; и вызове его только для выполнения резервного копирования hello SAP HANA. Запись на NFS общего ресурса помещает нагрузки на сеть hello влияние hello системы SAP HANA, а просто управление hello файлы резервных копий позже на hello &quot;резервного копирования виртуальной Машины&quot; не во всех влияют hello системы SAP HANA.

![Общего ресурса NFS с другой ВМ был сервером SAP HANA toohello подключенных виртуальных Машин](media/sap-hana-backup-file-level/image035.png)

вариант использования tooverify hello NFS, общего ресурса NFS с другой ВМ был сервером SAP HANA toohello подключенных виртуальных Машин. не используя специальные настройки этой системы.

![Резервное копирование hello toodo 1 час 46 минут потребовалось напрямую](media/sap-hana-backup-file-level/image036.png)

общего ресурса NFS Hello был быстрого чередующемся наборе, например hello один на сервере SAP HANA hello. Тем не менее заняло 1 час и 46 минут toodo hello резервного копирования непосредственно на общих папок NFS hello вместо 10 минут при записи tooa локального чередующийся набор.

![альтернативой Hello не намного быстрее, поскольку на 1 час 43 минуты](media/sap-hana-backup-file-level/image037.png)

альтернативой Hello это локальный чередующегося набора архивации tooa и копирование toohello общих ресурсов NFS на уровне операционной системы (простой **cp - avr** команда) не было намного быстрее, поскольку. В целом этот процесс занимает 1 час 43 минуты, что не сильно отличается от первого значения.

Поэтому он работает, но производительность не была хорошо подходит для тестирования резервного копирования 230 ГБ hello. А при резервном копировании нескольких терабайт производительность будет еще ниже.

## <a name="copy-sap-hana-backup-files-tooazure-file-service"></a>Скопируйте SAP HANA файлов резервных копий tooAzure файловой службы

Это возможно toomount Azure общей папки в виртуальной Машине Linux Azure. статья Hello [как toouse хранилища Azure File с Linux](../../../storage/files/storage-how-to-use-files-linux.md) предоставляет подробные сведения о том, как toodo его. Помните, что сейчас в файловом ресурсе Azure можно хранить 5 ТБ данных, а максимальный размер файла составляет 1 ТБ. Дополнительные сведения об ограничениях хранилища см. в статье [Целевые показатели масштабируемости и производительности службы хранилища Azure](../../../storage/common/storage-scalability-targets.md).

Тесты показывают, что сейчас резервное копирование SAP HANA напрямую не поддерживает этот тип подключения CIFS. В [примечании к SAP 1820529](https://launchpad.support.sap.com/#/notes/1820529) также указано, что специалисты не советуют использовать CIFS.

![На рисунке показана ошибка в диалоговое окно hello в SAP HANA Studio](media/sap-hana-backup-file-level/image038.png)

Этот рисунок отображает ошибку в диалоговое окно hello в SAP HANA Studio, при попытке tooback вверх непосредственно tooa CIFS подключить Azure общей папки. Поэтому один имеет toodo стандартную резервную копию SAP HANA в файловой системе виртуальной Машины сначала, а затем hello резервного копирования файлов из отсутствует tooAzure файловой службы.

![На этом рисунке показано занимает 929 секунд toocopy 19 SAP HANA файлов резервных копий](media/sap-hana-backup-file-level/image039.png)

На этом рисунке показано затраченное о toocopy 929 секунд 19 SAP HANA резервного копирования файлов общим размером примерно 230 ГБ toohello Azure файлового ресурса общего доступа.

![Hello структуру каталогов источника на hello ВМ SAP HANA был скопированный toohello Azure общей папки](media/sap-hana-backup-file-level/image040.png)

На этом снимке экрана, увидит, что структуру каталогов источника hello на hello ВМ SAP HANA был скопированный toohello Azure общей папки: один каталог (hana\_резервного копирования\_fsl\_15 ГБ) и 19 отдельные файлы резервных копий.

Хранение резервных копий файлов SAP HANA на файлы Azure может быть интересные параметра в будущем hello при его непосредственно поддерживает резервные копии файлов SAP HANA. Или когда он становится возможным toomount Azure файлы через NFS и максимальную квоту hello значительно больше, чем 5 ТБ.

## <a name="next-steps"></a>Дальнейшие действия
* Общие сведения и информацию о начале работы см. в [руководстве по резервному копированию SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).
* [Резервное копирование SAP HANA, основанные на моментальных снимках хранилища](sap-hana-backup-storage-snapshots.md) описывает hello вариант хранения данных на основе моментального снимка резервной копии.
* tooestablish высокого уровня доступности и план аварийного восстановления из SAP HANA в Azure (большие экземпляры). в статье toolearn [SAP HANA (крупных экземпляров) высокой доступности и аварийного восстановления в Azure](hana-overview-high-availability-disaster-recovery.md).
