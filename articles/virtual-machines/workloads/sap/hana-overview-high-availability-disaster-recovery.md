---
title: "aaaHigh доступности и аварийного восстановления из SAP HANA в Azure (большие экземпляры) | Документы Microsoft"
description: "Сведения об обеспечении высокого уровня доступности и о планировании аварийного восстановления решения \"SAP HANA в Azure (крупные экземпляры)\"."
services: virtual-machines-linux
documentationcenter: 
author: RicksterCDN
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/01/2016
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 0c0967f54cf29bbb275eb7cda9d36608488add9e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-large-instances-high-availability-and-disaster-recovery-on-azure"></a><span data-ttu-id="3960b-103">Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)</span><span class="sxs-lookup"><span data-stu-id="3960b-103">SAP HANA (large instances) high availability and disaster recovery on Azure</span></span> 

<span data-ttu-id="3960b-104">Для работы критически важных серверов SAP HANA в Azure (крупные экземпляры) важно обеспечить высокий уровень доступности и реализовать стратегию аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-104">High availability and disaster recovery are important aspects of running your mission-critical SAP HANA on Azure (large instances) servers.</span></span> <span data-ttu-id="3960b-105">Он является важным toowork с SAP, системные интеграторы или архитектор tooproperly Microsoft и реализуйте hello стратегии справа высокой доступности и аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-105">It's important toowork with SAP, your system integrator, or Microsoft tooproperly architect and implement hello right high-availability/disaster-recovery strategy.</span></span> <span data-ttu-id="3960b-106">Это также цели точки восстановления важных tooconsider hello и цель времени восстановления, которые являются определенной tooyour среды.</span><span class="sxs-lookup"><span data-stu-id="3960b-106">It is also important tooconsider hello recovery point objective and recovery time objective, which are specific tooyour environment.</span></span>

## <a name="high-availability"></a><span data-ttu-id="3960b-107">высокую доступность;</span><span class="sxs-lookup"><span data-stu-id="3960b-107">High availability</span></span>

<span data-ttu-id="3960b-108">Корпорация Майкрософт поддерживает методы высокого уровня доступности SAP HANA «готовую hello,», которые включают:</span><span class="sxs-lookup"><span data-stu-id="3960b-108">Microsoft supports SAP HANA high-availability methods "out of hello box," which include:</span></span>

- <span data-ttu-id="3960b-109">**Репликация службы хранилища:** hello tooreplicate возможности системы хранения всех данных tooanother расположение (в пределах, или отдельно от hello одного центра обработки данных).</span><span class="sxs-lookup"><span data-stu-id="3960b-109">**Storage replication:** hello storage system's ability tooreplicate all data tooanother location (within, or separate from, hello same datacenter).</span></span> <span data-ttu-id="3960b-110">SAP HANA работает независимо от этого метода.</span><span class="sxs-lookup"><span data-stu-id="3960b-110">SAP HANA operates independently of this method.</span></span>
- <span data-ttu-id="3960b-111">**Система репликации HANA:** hello репликации всех данных в отдельной системе SAP HANA SAP HANA tooa.</span><span class="sxs-lookup"><span data-stu-id="3960b-111">**HANA system replication:** hello replication of all data in SAP HANA tooa separate SAP HANA system.</span></span> <span data-ttu-id="3960b-112">Цель времени восстановления Hello сведено к минимуму посредством репликации данных через регулярные интервалы.</span><span class="sxs-lookup"><span data-stu-id="3960b-112">hello recovery time objective is minimized through data replication at regular intervals.</span></span> <span data-ttu-id="3960b-113">SAP HANA поддерживает асинхронные, синхронный в памяти и синхронные (рекомендуется только для SAP HANA hello систем, которые находятся в одном центре обработки данных или меньше 100 км друг от друга).</span><span class="sxs-lookup"><span data-stu-id="3960b-113">SAP HANA supports asynchronous, synchronous in-memory, and synchronous modes (recommended only for SAP HANA systems that are within hello same datacenter or less than 100 KM apart).</span></span> <span data-ttu-id="3960b-114">В hello текущего конструктора HANA большом экземпляре штампов HANA системы репликации может использоваться для обеспечения высокой доступности.</span><span class="sxs-lookup"><span data-stu-id="3960b-114">In hello current design of HANA large-instance stamps, HANA system replication can be used for high availability only.</span></span>
- <span data-ttu-id="3960b-115">**Разместить автоматического перехода на другой ресурс:** toouse решения локального-восстановление после сбоев как альтернативный toosystem репликации.</span><span class="sxs-lookup"><span data-stu-id="3960b-115">**Host auto-failover:** A local fault-recovery solution toouse as an alternative toosystem replication.</span></span> <span data-ttu-id="3960b-116">При hello основной узел становится недоступным, один или несколько узлов резервный SAP HANA, настроенные в режиме масштабирования и SAP HANA автоматически переключается tooanother узла.</span><span class="sxs-lookup"><span data-stu-id="3960b-116">When hello master node becomes unavailable, one or more standby SAP HANA nodes are configured in scale-out mode and SAP HANA automatically fails over tooanother node.</span></span>

<span data-ttu-id="3960b-117">Дополнительные сведения о SAP HANA высокого уровня доступности см. следующую информацию SAP hello:</span><span class="sxs-lookup"><span data-stu-id="3960b-117">For more information on SAP HANA high availability, see hello following SAP information:</span></span>

- [<span data-ttu-id="3960b-118">Техническая документация по высокому уровню доступности SAP HANA</span><span class="sxs-lookup"><span data-stu-id="3960b-118">SAP HANA High-Availability Whitepaper</span></span>](http://go.sap.com/documents/2016/05/f8e5eeba-737c-0010-82c7-eda71af511fa.html)
- [<span data-ttu-id="3960b-119">Руководство по администрированию SAP HANA</span><span class="sxs-lookup"><span data-stu-id="3960b-119">SAP HANA Administration Guide</span></span>](http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf)
- [<span data-ttu-id="3960b-120">Видеокурс SAP по репликации системы SAP HANA</span><span class="sxs-lookup"><span data-stu-id="3960b-120">SAP Academy Video on SAP HANA System Replication</span></span>](http://scn.sap.com/community/hana-in-memory/blog/2015/05/19/sap-hana-system-replication)
- [<span data-ttu-id="3960b-121">Примечание по SAP № 1999880. Часто задаваемые вопросы о репликации системы SAP HANA</span><span class="sxs-lookup"><span data-stu-id="3960b-121">SAP Support Note #1999880 – FAQ on SAP HANA System Replication</span></span>](https://bcs.wdf.sap.corp/sap/support/notes/1999880)
- <span data-ttu-id="3960b-122">[Примечание по SAP № 2165547. Резервное копирование и восстановление SAP HANA в среде репликации системы SAP HANA](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)</span><span class="sxs-lookup"><span data-stu-id="3960b-122">[SAP Support Note #2165547 – SAP HANA Backup and Restore within SAP HANA System Replication Environment](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)</span></span>
- <span data-ttu-id="3960b-123">[Примечание по SAP № 1984882. Использование репликации системы SAP HANA для замены оборудования без простоя](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)</span><span class="sxs-lookup"><span data-stu-id="3960b-123">[SAP Support Note #1984882 – Using SAP HANA System Replication for Hardware Exchange with Minimum/Zero Downtime](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)</span></span>

## <a name="disaster-recovery"></a><span data-ttu-id="3960b-124">Аварийное восстановление</span><span class="sxs-lookup"><span data-stu-id="3960b-124">Disaster recovery</span></span>

<span data-ttu-id="3960b-125">Решение "SAP HANA в Azure (крупные экземпляры)" доступно в двух регионах Azure геополитического региона.</span><span class="sxs-lookup"><span data-stu-id="3960b-125">SAP HANA on Azure (large instances) is offered in two Azure regions in a geopolitical region.</span></span> <span data-ttu-id="3960b-126">Между hello два больших экземпляр меток двух разных регионах имеет прямое сетевое соединение для репликации данных во время аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-126">Between hello two large-instance stamps of two different regions is a direct network connectivity for replicating data during disaster recovery.</span></span> <span data-ttu-id="3960b-127">репликация Hello hello данных выполняется на основе инфраструктуры хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-127">hello replication of hello data is storage-infrastructure based.</span></span> <span data-ttu-id="3960b-128">по умолчанию Hello репликация не происходит.</span><span class="sxs-lookup"><span data-stu-id="3960b-128">hello replication is not done by default.</span></span> <span data-ttu-id="3960b-129">Это делается для конфигураций клиента hello, порядка аварийного восстановления hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-129">It is done for hello customer configurations that ordered hello disaster recovery.</span></span> <span data-ttu-id="3960b-130">В текущей структуре hello HANA системы репликации не может использоваться для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-130">In hello current design, HANA system replication can't be used for disaster recovery.</span></span>

<span data-ttu-id="3960b-131">Однако преимущество tootake hello аварийного восстановления, вы должны toostart toodesign hello сетевого подключения toohello двух различных регионах Azure.</span><span class="sxs-lookup"><span data-stu-id="3960b-131">However, tootake advantage of hello disaster recovery, you need toostart toodesign hello network connectivity toohello two different Azure regions.</span></span> <span data-ttu-id="3960b-132">toodo таким образом, необходимо подключение канала Azure ExpressRoute из локального в ваш основной регион Azure и другое подключение канала из локальной tooyour аварийного восстановления области.</span><span class="sxs-lookup"><span data-stu-id="3960b-132">toodo so, you need an Azure ExpressRoute circuit connection from on-premises in your main Azure region and another circuit connection from on-premises tooyour disaster-recovery region.</span></span> <span data-ttu-id="3960b-133">Это позволит обеспечить работоспособность в случае возникновения проблем со всем регионом Azure, в том числе с расположением конечного маршрутизатора Microsoft Enterprise (MSEE).</span><span class="sxs-lookup"><span data-stu-id="3960b-133">This measure would cover a situation in which a complete Azure region, including a Microsoft enterprise edge router (MSEE) location, has an issue.</span></span>

<span data-ttu-id="3960b-134">Как вторую меру можно подключить все Azure виртуальных сетей, соединяющих tooSAP HANA в Azure (большие экземпляры) в одном из tooboth областей hello этих каналов ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3960b-134">As a second measure, you can connect all Azure virtual networks that connect tooSAP HANA on Azure (large instances) in one of hello regions tooboth of those ExpressRoute circuits.</span></span> <span data-ttu-id="3960b-135">Эта мера адреса случай, где только один из расположения MSEE hello, подключается к локальным расположением с Azure передается не обслуживает.</span><span class="sxs-lookup"><span data-stu-id="3960b-135">This measure addresses a case where only one of hello MSEE locations that connects your on-premises location with Azure goes off duty.</span></span>

<span data-ttu-id="3960b-136">Hello следующем рисунке показана hello оптимальную конфигурацию для аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-136">hello following figure shows hello optimal configuration for disaster recovery:</span></span>

![Оптимальная конфигурация для аварийного восстановления](./media/hana-overview-high-availability-disaster-recovery/image1-optimal-configuration.png)

<span data-ttu-id="3960b-138">Hello оптимальный вариант для аварийного восстановления конфигурации сети hello — toohave два каналы ExpressRoute от локальной toohello двух различных регионах Azure.</span><span class="sxs-lookup"><span data-stu-id="3960b-138">hello optimal case for a disaster-recovery configuration of hello network is toohave two ExpressRoute circuits from on-premises toohello two different Azure regions.</span></span> <span data-ttu-id="3960b-139">Один канал переходит в действующем экземпляре под управлением tooregion #1.</span><span class="sxs-lookup"><span data-stu-id="3960b-139">One circuit goes tooregion #1, running a production instance.</span></span> <span data-ttu-id="3960b-140">Второй канал ExpressRoute Hello переходит tooregion #2, выполнение некоторых экземпляров HANA нерабочей.</span><span class="sxs-lookup"><span data-stu-id="3960b-140">hello second ExpressRoute circuit goes tooregion #2, running some non-production HANA instances.</span></span> <span data-ttu-id="3960b-141">(Это важно, если весь регион Azure, включая hello MSEE и отметки большом экземпляре уходит из сетки hello.)</span><span class="sxs-lookup"><span data-stu-id="3960b-141">(This is important if an entire Azure region, including hello MSEE and large-instance stamp, goes off hello grid.)</span></span>

<span data-ttu-id="3960b-142">В качестве второго меры hello различных виртуальных сетей являются подключенных toohello различные каналы ExpressRoute, подключенных tooSAP HANA в Azure (большие экземпляры).</span><span class="sxs-lookup"><span data-stu-id="3960b-142">As a second measure, hello various virtual networks are connected toohello various ExpressRoute circuits that are connected tooSAP HANA on Azure (large instances).</span></span> <span data-ttu-id="3960b-143">Вы можете обойти hello расположение, где MSEE дает сбой, или можно понизить hello цель точки восстановления для аварийного восстановления, как мы обсудим позже.</span><span class="sxs-lookup"><span data-stu-id="3960b-143">You can bypass hello location where an MSEE is failing, or you can lower hello recovery point objective for disaster recovery, as we discuss later.</span></span>

<span data-ttu-id="3960b-144">приводятся Hello Далее требования для установки аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-144">hello next requirements for a disaster-recovery setup are:</span></span>

- <span data-ttu-id="3960b-145">Необходимо упорядочить SAP HANA на конфигурациями hello же размера, что номера SKU рабочей и развернуть их в регионе аварийного восстановления hello Azure (большие экземпляры).</span><span class="sxs-lookup"><span data-stu-id="3960b-145">You must order SAP HANA on Azure (large instances) SKUs of hello same size as your production SKUs and deploy them in hello disaster-recovery region.</span></span> <span data-ttu-id="3960b-146">Эти экземпляры могут быть теста используется toorun, "песочницы" или QA HANA экземпляров.</span><span class="sxs-lookup"><span data-stu-id="3960b-146">These instances can be used toorun test, sandbox, or QA HANA instances.</span></span>
- <span data-ttu-id="3960b-147">Необходимо упорядочить профиля аварийного восстановления для каждого из вашего SAP HANA в SKU Azure (большие экземпляры), которые должны toorecover hello сайте аварийного восстановления, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="3960b-147">You must order a disaster-recovery profile for each of your SAP HANA on Azure (large instances) SKUs that you want toorecover in hello disaster-recovery site, if necessary.</span></span> <span data-ttu-id="3960b-148">Это действие приводит toohello выделения томов хранилища, которые являются целью hello hello репликации хранилища из вашей рабочей области в область hello аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-148">This action leads toohello allocation of storage volumes, which are hello target of hello storage replication from your production region into hello disaster-recovery region.</span></span>

<span data-ttu-id="3960b-149">После выполнения предшествующих требования hello это hello хранилища ответственности toostart репликации.</span><span class="sxs-lookup"><span data-stu-id="3960b-149">After you meet hello preceding requirements, it is your responsibility toostart hello storage replication.</span></span> <span data-ttu-id="3960b-150">В инфраструктуре хранилища hello для SAP HANA в Azure (большие экземпляры) основой hello репликации хранилища является моментальные снимки хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-150">In hello storage infrastructure used for SAP HANA on Azure (large instances), hello basis of storage replication is storage snapshots.</span></span> <span data-ttu-id="3960b-151">репликация аварийного восстановления toostart hello, требуется tooperform:</span><span class="sxs-lookup"><span data-stu-id="3960b-151">toostart hello disaster-recovery replication, you need tooperform:</span></span>

- <span data-ttu-id="3960b-152">моментальный снимок загрузочного логического номера устройства (LUN), как описано выше;</span><span class="sxs-lookup"><span data-stu-id="3960b-152">A snapshot of your boot LUN, as described earlier.</span></span>
- <span data-ttu-id="3960b-153">моментальный снимок томов, связанных с HANA, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="3960b-153">A snapshot of your HANA-related volumes, as described earlier.</span></span>

<span data-ttu-id="3960b-154">После выполнения эти снимки hello томах, связанных с профилем аварийного восстановления в регионе аварийного восстановления hello запускается начальная реплика hello томов.</span><span class="sxs-lookup"><span data-stu-id="3960b-154">After you execute these snapshots, an initial replica of hello volumes is seeded on hello volumes that are associated with your disaster-recovery profile in hello disaster-recovery region.</span></span>

<span data-ttu-id="3960b-155">Впоследствии, hello самый последний моментальный снимок хранилища используется каждый час дельты tooreplicate hello, которые разрабатывать на томах хранения hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-155">Subsequently, hello most recent storage snapshot is used every hour tooreplicate hello deltas that develop on hello storage volumes.</span></span>

<span data-ttu-id="3960b-156">Цель точки восстановления Hello, которое достигается с помощью этой конфигурации, за 60 минут too90.</span><span class="sxs-lookup"><span data-stu-id="3960b-156">hello recovery point objective that's achieved with this configuration is from 60 too90 minutes.</span></span> <span data-ttu-id="3960b-157">целевой в случае аварийного восстановления hello копирования hello HANA резервные копии журналов транзакций из SAP HANA на Azure (большие экземпляры) toohello tooachieve лучше восстановления точки другой регион Azure.</span><span class="sxs-lookup"><span data-stu-id="3960b-157">tooachieve a better recovery point objective in hello disaster-recovery case, copy hello HANA transaction log backups from SAP HANA on Azure (large instances) toohello other Azure region.</span></span> <span data-ttu-id="3960b-158">tooachieve этой цели точки восстановления, hello следующие:</span><span class="sxs-lookup"><span data-stu-id="3960b-158">tooachieve this recovery point objective, do hello following:</span></span>

1. <span data-ttu-id="3960b-159">Резервное копирование транзакции HANA hello так часто, как можно слишком/hana/журнала или резервная копия журналов.</span><span class="sxs-lookup"><span data-stu-id="3960b-159">Back up hello HANA transaction log as frequently as possible too/hana/log/backup.</span></span>
2. <span data-ttu-id="3960b-160">Скопируйте hello резервные копии журналов транзакций при завершении tooan Azure виртуальной машины (VM), который находится в виртуальной сети, подключенный toohello SAP HANA на сервере Azure (большие экземпляры).</span><span class="sxs-lookup"><span data-stu-id="3960b-160">Copy hello transaction log backups when they are finished tooan Azure virtual machine (VM), which is in a virtual network that's connected toohello SAP HANA on Azure (large instances) server.</span></span>
3. <span data-ttu-id="3960b-161">От этой виртуальной Машины скопируйте hello резервного копирования tooa виртуальной Машины в виртуальной сети в регионе аварийного восстановления hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-161">From that VM, copy hello backup tooa VM that's in a virtual network in hello disaster-recovery region.</span></span>
4. <span data-ttu-id="3960b-162">Хранить резервные копии журналов транзакций hello в этом регионе в hello виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="3960b-162">Keep hello transaction log backups in that region in hello VM.</span></span>

<span data-ttu-id="3960b-163">В случае сбоя, после развертывания профилей hello аварийного восстановления на сервере фактическое скопируйте hello резервные копии журналов транзакций из toohello hello ВМ SAP HANA в Azure (большие экземпляры), теперь hello сервера-источника в регионе hello аварийного восстановления, и Восстановите эти резервные копии.</span><span class="sxs-lookup"><span data-stu-id="3960b-163">In case of disaster, after hello disaster-recovery profile has been deployed on an actual server, copy hello transaction log backups from hello VM toohello SAP HANA on Azure (large instances) that is now hello primary server in hello disaster-recovery region, and restore those backups.</span></span> <span data-ttu-id="3960b-164">Эта операция восстановления возможна, так как состояние hello HANA на дисках hello аварийного восстановления, HANA моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-164">This recovery is possible because hello state of HANA on hello disaster-recovery disks is that of a HANA snapshot.</span></span> <span data-ttu-id="3960b-165">Это правило смещения hello для дальнейшего восстановления резервных копий журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="3960b-165">This is hello offset point for further restorations of transaction log backups.</span></span>

## <a name="backup-and-restore"></a><span data-ttu-id="3960b-166">Архивация и восстановление</span><span class="sxs-lookup"><span data-stu-id="3960b-166">Backup and restore</span></span>

<span data-ttu-id="3960b-167">Одной из баз данных наиболее важные аспекты toooperating hello убедиться, что hello базы данных может быть защищена от различных стихийных бедствий.</span><span class="sxs-lookup"><span data-stu-id="3960b-167">One of hello most important aspects toooperating databases is making sure hello database can be protected from various catastrophic events.</span></span> <span data-ttu-id="3960b-168">Эти события вызываются все, от ошибок пользователей toosimple стихийных бедствий.</span><span class="sxs-lookup"><span data-stu-id="3960b-168">These events can be caused by anything from natural disasters toosimple user errors.</span></span>

<span data-ttu-id="3960b-169">Резервное копирование базы данных, с возможностью toorestore hello его точки tooany времени (например, перед удалением кто-то критически важных данных), позволяет состояние tooa восстановления, максимально близкой как toohello способов было до возникновения перебоев в работе hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-169">Backing up a database, with hello ability toorestore it tooany point in time (such as before somebody deleted critical data), allows restoration tooa state that is as close as possible toohello way it was before hello disruption occurred.</span></span>

<span data-ttu-id="3960b-170">Для получения оптимальных результатов выполните следующие два типа резервного копирования:</span><span class="sxs-lookup"><span data-stu-id="3960b-170">Two types of backups must be performed for best results:</span></span>

- <span data-ttu-id="3960b-171">Резервные копии базы данных</span><span class="sxs-lookup"><span data-stu-id="3960b-171">Database backups</span></span>
- <span data-ttu-id="3960b-172">резервное копирование журналов транзакций.</span><span class="sxs-lookup"><span data-stu-id="3960b-172">Transaction log backups</span></span>

<span data-ttu-id="3960b-173">В дополнение к этому toofull базы данных резервные копии, созданные на уровне приложения, можно еще более тщательной путем создания резервных копий с помощью хранилища моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="3960b-173">In addition toofull database backups performed at an application-level, you can be even more thorough by performing backups with storage snapshots.</span></span> <span data-ttu-id="3960b-174">Выполнение резервного копирования журнала также важно для восстановления базы данных hello (tooempty hello журналы и уже зафиксированных транзакций).</span><span class="sxs-lookup"><span data-stu-id="3960b-174">Performing log backups is also important for restoring hello database (and tooempty hello logs from already committed transactions).</span></span>

<span data-ttu-id="3960b-175">SAP HANA в Azure (крупные экземпляры) поддерживает следующие два варианта резервного копирования и восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-175">SAP HANA on Azure (large instances) offers two backup and restore options:</span></span>

- <span data-ttu-id="3960b-176">Модель "Сделай сам".</span><span class="sxs-lookup"><span data-stu-id="3960b-176">Do it yourself (DIY).</span></span> <span data-ttu-id="3960b-177">После вычисления tooensure недостаточно места на диске выполните полные резервные копии базы данных и журнала, используя методы резервного копирования диска (toothose диски).</span><span class="sxs-lookup"><span data-stu-id="3960b-177">After you calculate tooensure enough disk space, perform full database and log backups by using disk backup methods (toothose disks).</span></span> <span data-ttu-id="3960b-178">Со временем hello резервные копии, скопированного tooan учетной записи хранилища Azure (после настройки Azure на файловом сервере с практически неограниченное хранение) или использовать резервное хранилище или хранилище Azure начального.</span><span class="sxs-lookup"><span data-stu-id="3960b-178">Over time, hello backups are copied tooan Azure storage account (after you set up an Azure-based file server with virtually unlimited storage), or use an Azure Backup vault or Azure cold storage.</span></span> <span data-ttu-id="3960b-179">Другой вариант — toouse средство защиты данных сторонних разработчиков, например Commvault toostore hello резервных копий после их копирования tooa учетной записи хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-179">Another option is toouse a third-party data protection tool, such as Commvault, toostore hello backups after they are copied tooa storage account.</span></span> <span data-ttu-id="3960b-180">Hello DIY параметра резервного копирования также может быть необходим для данных, которые должны toobe хранящиеся дольше для совместимости с и целей аудита.</span><span class="sxs-lookup"><span data-stu-id="3960b-180">hello DIY backup option might also be necessary for data that needs toobe stored for longer periods for compliancy and auditing purposes.</span></span>
- <span data-ttu-id="3960b-181">Использование hello резервное копирование и восстановление функциональные возможности, hello базовой инфраструктурой SAP HANA в Azure (большие экземпляры) предоставляет.</span><span class="sxs-lookup"><span data-stu-id="3960b-181">Use hello backup and restore functionality that hello underlying infrastructure of SAP HANA on Azure (large instances) provides.</span></span> <span data-ttu-id="3960b-182">Этот параметр соответствует hello потребность в резервные копии и делает вручную резервных копий почти устаревшие (за исключением того, где требуются резервные копии данных, для соответствия нормативным требованиям).</span><span class="sxs-lookup"><span data-stu-id="3960b-182">This option fulfills hello need for backups, and it makes manual backups nearly obsolete (except where data backups are required for compliance purposes).</span></span> <span data-ttu-id="3960b-183">Этот раздел посвящен остальные Hello hello резервного копирования и восстановления функциональные возможности, предлагаемые с HANA (крупных экземпляров).</span><span class="sxs-lookup"><span data-stu-id="3960b-183">hello rest of this section addresses hello backup and restore functionality that's offered with HANA (large instances).</span></span>

> [!NOTE]
> <span data-ttu-id="3960b-184">Технология Hello моментальных снимков, используемый hello инфраструктуре HANA (крупных экземпляров) имеет зависимость от моментальные снимки SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-184">hello snapshot technology that is used by hello underlying infrastructure of HANA (large instances) has a dependency on SAP HANA snapshots.</span></span> <span data-ttu-id="3960b-185">Моментальные снимки SAP HANA не работают в сочетании с мультитенантными контейнерами баз данных SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-185">SAP HANA snapshots do not work in conjunction with SAP HANA Multitenant Database Containers.</span></span> <span data-ttu-id="3960b-186">В результате этот метод резервного копирования не может быть используется toodeploy SAP HANA Мультитенантного базы данных контейнеров.</span><span class="sxs-lookup"><span data-stu-id="3960b-186">As a result, this method of backup cannot be used toodeploy SAP HANA Multitenant Database Containers.</span></span>

### <a name="using-storage-snapshots-of-sap-hana-on-azure-large-instances"></a><span data-ttu-id="3960b-187">Использование моментальных снимков хранилища SAP HANA в Azure (крупные экземпляры)</span><span class="sxs-lookup"><span data-stu-id="3960b-187">Using storage snapshots of SAP HANA on Azure (large instances)</span></span>

<span data-ttu-id="3960b-188">Инфраструктура хранилища Hello базовый HANA SAP в Azure (большие экземпляры) поддерживает понятие hello моментальный снимок тома хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-188">hello storage infrastructure underlying SAP HANA on Azure (large instances) supports hello notion of a storage snapshot of volumes.</span></span> <span data-ttu-id="3960b-189">Резервное копирование и восстановление для определенного тома поддерживаются, hello следующие вопросы:</span><span class="sxs-lookup"><span data-stu-id="3960b-189">Both backup and restoration of a particular volume are supported, with hello following considerations:</span></span>

- <span data-ttu-id="3960b-190">Вместо резервных копий базы данных на регулярной основе создаются моментальные снимки тома хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-190">Instead of database backups, storage volume snapshots are taken on a frequent basis.</span></span>
- <span data-ttu-id="3960b-191">моментальный снимок хранилища Hello инициирует моментальный снимок SAP HANA, до начала выполнения моментального снимка хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-191">hello storage snapshot initiates an SAP HANA snapshot before it executes hello storage snapshot.</span></span> <span data-ttu-id="3960b-192">Этот моментальный снимок SAP HANA — точка установки hello окончательной журнала восстановления после восстановления моментального снимка хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-192">This SAP HANA snapshot is hello setup point for eventual log restorations after recovery of hello storage snapshot.</span></span>
- <span data-ttu-id="3960b-193">В точке hello, где моментального снимка хранилища hello выполнена успешно удаление снимка hello SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-193">At hello point where hello storage snapshot is executed successfully, hello SAP HANA snapshot is deleted.</span></span>
- <span data-ttu-id="3960b-194">Резервные копии журналов берутся часто и хранятся в тома резервного копирования журнала hello или в Azure.</span><span class="sxs-lookup"><span data-stu-id="3960b-194">Log backups are taken frequently and stored in hello log backup volume or in Azure.</span></span>
- <span data-ttu-id="3960b-195">Если необходимо восстановить базу данных hello tooa определенные на определенный момент времени, запрос на получение поддержки Azure (простоях производственного) или SAP HANA tooMicrosoft на tooa toorestore управления службами Azure определенных хранилища моментальных снимков (например, планового восстановления системы "песочницы" исходное состояние tooits).</span><span class="sxs-lookup"><span data-stu-id="3960b-195">If hello database must be restored tooa certain point in time, a request is made tooMicrosoft Azure Support (production outage) or SAP HANA on Azure Service Management toorestore tooa certain storage snapshot (for example, a planned restoration of a sandbox system tooits original state).</span></span>
- <span data-ttu-id="3960b-196">SAP HANA Hello моментальный снимок, который включен в моментальный снимок hello хранилища — это смещения точка для применения резервных копий журнала, которые были выполнены и сохранены после hello хранилища моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-196">hello SAP HANA snapshot that's included in hello storage snapshot is an offset point for applying log backups that have been executed and stored after hello storage snapshot was taken.</span></span>
- <span data-ttu-id="3960b-197">Эти резервные копии журналов создаются toorestore tooa серверной базы данных hello определенные на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="3960b-197">These log backups are taken toorestore hello database back tooa certain point in time.</span></span>

<span data-ttu-id="3960b-198">Задание резервного копирования hello\_имя создает моментальный снимок hello следующих томов:</span><span class="sxs-lookup"><span data-stu-id="3960b-198">Specifying hello backup\_name creates a snapshot of hello following volumes:</span></span>

- <span data-ttu-id="3960b-199">hana/data;</span><span class="sxs-lookup"><span data-stu-id="3960b-199">hana/data</span></span>
- <span data-ttu-id="3960b-200">hana/log;</span><span class="sxs-lookup"><span data-stu-id="3960b-200">hana/log</span></span>
- <span data-ttu-id="3960b-201">hana/log\_backup (подключен как резервная копия в hana/log);</span><span class="sxs-lookup"><span data-stu-id="3960b-201">hana/log\_backup (mounted as backup into hana/log)</span></span>
- <span data-ttu-id="3960b-202">hana/shared.</span><span class="sxs-lookup"><span data-stu-id="3960b-202">hana/shared</span></span>

### <a name="storage-snapshot-considerations"></a><span data-ttu-id="3960b-203">Факторы, которые необходимо учитывать при создании моментальных снимков хранилища</span><span class="sxs-lookup"><span data-stu-id="3960b-203">Storage snapshot considerations</span></span>

>[!NOTE]
><span data-ttu-id="3960b-204">Моментальные снимки хранилища _не_ предоставляются бесплатно, так как для их хранения требуется дополнительное дисковое пространство.</span><span class="sxs-lookup"><span data-stu-id="3960b-204">Storage snapshots are _not_ provided free of charge, because additional storage space must be allocated.</span></span>

<span data-ttu-id="3960b-205">следующие Hello конкретных механизм хранения моментальных снимков для SAP HANA в Azure (большие экземпляры).</span><span class="sxs-lookup"><span data-stu-id="3960b-205">hello specific mechanics of storage snapshots for SAP HANA on Azure (large instances) include:</span></span>

- <span data-ttu-id="3960b-206">Моментальный снимок данных (на момент времени, когда берется hello) использует очень мало места.</span><span class="sxs-lookup"><span data-stu-id="3960b-206">A specific storage snapshot (at hello point in time when it is taken) consumes very little storage.</span></span>
- <span data-ttu-id="3960b-207">Изменения данных содержимого и содержимым hello в данных SAP HANA, изменение файлов на томе хранилища hello hello моментальных снимков должен содержимое исходного блока toostore hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-207">As data content changes and hello content in SAP HANA data files change on hello storage volume, hello snapshot needs toostore hello original block content.</span></span>
- <span data-ttu-id="3960b-208">размер моментального снимка хранилища Hello увеличивается.</span><span class="sxs-lookup"><span data-stu-id="3960b-208">hello storage snapshot increases in size.</span></span> <span data-ttu-id="3960b-209">имеется больше hello снимок Hello, становится моментального снимка хранилища больше hello hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-209">hello longer hello snapshot exists, hello larger hello storage snapshot becomes.</span></span>
- <span data-ttu-id="3960b-210">Здравствуйте дополнительные изменения, внесенные toohello объема базы данных SAP HANA за время жизни моментального снимка хранилища hello, становится hello большего hello объем занятого места хранения снимка hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-210">hello more changes made toohello SAP HANA database volume over hello lifetime of a storage snapshot, hello larger hello space consumption of hello storage snapshot becomes.</span></span>

<span data-ttu-id="3960b-211">SAP HANA в Azure (большие экземпляры) поставляется с фиксированный размер тома журналов и данных SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-211">SAP HANA on Azure (large instances) comes with fixed volume sizes for hello SAP HANA data and log volume.</span></span> <span data-ttu-id="3960b-212">Выполнение моментальные снимки для этих томов требуют большого объема в свободное место на томе, так что это ваш моментальные снимки хранилища ответственности tooschedule (в пределах hello SAP HANA на процесс Azure [крупных экземпляров]).</span><span class="sxs-lookup"><span data-stu-id="3960b-212">Performing snapshots of those volumes eats into your volume space, so it is your responsibility tooschedule storage snapshots (within hello SAP HANA on Azure [large instances] process).</span></span>

<span data-ttu-id="3960b-213">Hello следующие разделы предоставляют сведения о выполнении этих моментальных снимков, включая общие рекомендации:</span><span class="sxs-lookup"><span data-stu-id="3960b-213">hello following sections provide information for performing these snapshots, including general recommendations:</span></span>

- <span data-ttu-id="3960b-214">Хотя hello оборудования может выдержать 255 моментальные снимки на одном томе, настоятельно рекомендуется сохранить меньше этого числа.</span><span class="sxs-lookup"><span data-stu-id="3960b-214">Though hello hardware can sustain 255 snapshots per volume, we highly recommend that you stay well below this number.</span></span>
- <span data-ttu-id="3960b-215">Прежде чем выполнять моментальные снимки хранилища, отслеживайте свободное пространство.</span><span class="sxs-lookup"><span data-stu-id="3960b-215">Before you perform storage snapshots, monitor and keep track of free space.</span></span>
- <span data-ttu-id="3960b-216">Ниже hello количество хранилища моментальных снимков зависит от свободного пространства.</span><span class="sxs-lookup"><span data-stu-id="3960b-216">Lower hello number of storage snapshots based on free space.</span></span> <span data-ttu-id="3960b-217">Может потребоваться toolower hello количество моментальных снимков, которые можно сохранить или может потребоваться tooextend hello тома.</span><span class="sxs-lookup"><span data-stu-id="3960b-217">You might need toolower hello number of snapshots that you keep, or you might need tooextend hello volumes.</span></span> <span data-ttu-id="3960b-218">(Вы можете заказать дополнительное пространство в единицах по 1 ТБ.)</span><span class="sxs-lookup"><span data-stu-id="3960b-218">(You can order additional storage in 1-TB units.)</span></span>
- <span data-ttu-id="3960b-219">При выполнении действий, например при переносе данных в SAP HANA с помощью средств переноса системы (в частности, с помощью R3load) или при восстановлении баз данных SAP HANA на основе резервных копий, мы настоятельно советуем не создавать моментальные снимки хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-219">During activities such as moving data into SAP HANA with system migration tools (with R3load, or by restoring SAP HANA databases from backups), we highly recommended that you not perform any storage snapshots.</span></span> <span data-ttu-id="3960b-220">(Если миграция системы выполняется на новую систему SAP HANA, моментальные снимки хранилища не потребуется выполнить toobe.)</span><span class="sxs-lookup"><span data-stu-id="3960b-220">(If a system migration is being done on a new SAP HANA system, storage snapshots would not need toobe performed.)</span></span>
- <span data-ttu-id="3960b-221">При более значительных реорганизациях таблиц SAP HANA по возможности не создавайте моментальные снимки хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-221">During larger reorganizations of SAP HANA tables, storage snapshots should be avoided if possible.</span></span>
- <span data-ttu-id="3960b-222">Моментальные снимки хранилища являются готовности tooengaging возможности аварийного восстановления hello SAP HANA в Azure (большие экземпляры).</span><span class="sxs-lookup"><span data-stu-id="3960b-222">Storage snapshots are a prerequisite tooengaging hello disaster-recovery capabilities of SAP HANA on Azure (large instances).</span></span>

### <a name="setting-up-storage-snapshots"></a><span data-ttu-id="3960b-223">Настройка моментальных снимков хранилища</span><span class="sxs-lookup"><span data-stu-id="3960b-223">Setting up storage snapshots</span></span>

1. <span data-ttu-id="3960b-224">Убедитесь, что Perl установлен в ОС Linux hello hello HANA (крупных экземпляров) сервера.</span><span class="sxs-lookup"><span data-stu-id="3960b-224">Make sure that Perl is installed in hello Linux operating system on hello HANA (large instances) server.</span></span>
2. <span data-ttu-id="3960b-225">Изменить/etc/ssh/ssh\_строку hello config tooadd _компьютеры Mac hmac-sha1_.</span><span class="sxs-lookup"><span data-stu-id="3960b-225">Modify /etc/ssh/ssh\_config tooadd hello line _MACs hmac-sha1_.</span></span>
3. <span data-ttu-id="3960b-226">Создайте учетную запись пользователя с резервным копированием SAP HANA hello главного узла для каждого экземпляра SAP HANA, которую вы используете (если применимо).</span><span class="sxs-lookup"><span data-stu-id="3960b-226">Create an SAP HANA backup user account on hello master node for each SAP HANA instance you are running (if applicable).</span></span>
4. <span data-ttu-id="3960b-227">Hello SAP HANA HDB клиент должен быть установлен на всех серверах SAP HANA (крупных экземпляров).</span><span class="sxs-lookup"><span data-stu-id="3960b-227">hello SAP HANA HDB client must be installed on all SAP HANA (large instances) servers.</span></span>
5. <span data-ttu-id="3960b-228">На hello первого сервера SAP HANA (крупных экземпляров) для каждого региона открытого ключа должны создаваться hello tooaccess базовой инфраструктуры хранилища, управляющий созданием моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-228">On hello first SAP HANA (large instances) server of each region, a public key must be created tooaccess hello underlying storage infrastructure that controls snapshot creation.</span></span>
6. <span data-ttu-id="3960b-229">Скопируйте сценарий hello azure\_hana\_backup.pl из места/Scripts toohello **hdbsql** из hello установки SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-229">Copy hello script azure\_hana\_backup.pl from /scripts toohello location of **hdbsql** of hello SAP HANA installation.</span></span>
7. <span data-ttu-id="3960b-230">Файл hello копирования HANABackupDetails.txt из toohello/Scripts таким же как hello сценариев Perl.</span><span class="sxs-lookup"><span data-stu-id="3960b-230">Copy hello HANABackupDetails.txt file from /scripts toohello same location as hello Perl script.</span></span>
8. <span data-ttu-id="3960b-231">Измените файл HANABackupDetails.txt hello согласно требованиям спецификации hello соответствующего клиента.</span><span class="sxs-lookup"><span data-stu-id="3960b-231">Modify hello HANABackupDetails.txt file as necessary for hello appropriate customer specifications.</span></span>

### <a name="step-1-install-sap-hana-hdbclient"></a><span data-ttu-id="3960b-232">Этап 1. Установка клиента SAP HANA HDB</span><span class="sxs-lookup"><span data-stu-id="3960b-232">Step 1: Install SAP HANA HDBClient</span></span>

<span data-ttu-id="3960b-233">Hello Linux установлен на HANA SAP в Azure (большие экземпляры) включает папки hello и сценариев необходимые tooexecute SAP HANA моментальные снимки хранилища для целей резервного копирования и аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-233">hello Linux installed on SAP HANA on Azure (large instances) includes hello folders and scripts necessary tooexecute SAP HANA storage snapshots for backup and disaster-recovery purposes.</span></span> <span data-ttu-id="3960b-234">Однако это вашей обязанностью tooinstall SAP HANA HDBclient при установке SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-234">However, it is your responsibility tooinstall SAP HANA HDBclient while you are installing SAP HANA.</span></span> <span data-ttu-id="3960b-235">(Microsoft устанавливает hello HDBclient ни SAP HANA.)</span><span class="sxs-lookup"><span data-stu-id="3960b-235">(Microsoft installs neither hello HDBclient nor SAP HANA.)</span></span>

### <a name="step-2-change-etcsshsshconfig"></a><span data-ttu-id="3960b-236">Этап 2. Изменение файла /etc/ssh/ssh\_config</span><span class="sxs-lookup"><span data-stu-id="3960b-236">Step 2: Change /etc/ssh/ssh\_config</span></span>

<span data-ttu-id="3960b-237">Добавьте в файл /etc/ssh/ssh\_config строку _MACs hmac-sha1_, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="3960b-237">Change /etc/ssh/ssh\_config by adding _MACs hmac-sha1_ line as shown here:</span></span>
```
#   RhostsRSAAuthentication no
#   RSAAuthentication yes
#   PasswordAuthentication yes
#   HostbasedAuthentication no
#   GSSAPIAuthentication no
#   GSSAPIDelegateCredentials no
#   GSSAPIKeyExchange no
#   GSSAPITrustDNS no
#   BatchMode no
#   CheckHostIP yes
#   AddressFamily any
#   ConnectTimeout 0
#   StrictHostKeyChecking ask
#   IdentityFile ~/.ssh/identity
#   IdentityFile ~/.ssh/id_rsa
#   IdentityFile ~/.ssh/id_dsa
#   Port 22
Protocol 2
#   Cipher 3des
#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc
#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160
MACs hmac-sha1
#   EscapeChar ~
#   Tunnel no
#   TunnelDevice any:any
#   PermitLocalCommand no
#   VisualHostKey no
#   ProxyCommand ssh -q -W %h:%p gateway.example.com
```

### <a name="step-3-create-a-public-key"></a><span data-ttu-id="3960b-238">Этап 3. Создание открытого ключа</span><span class="sxs-lookup"><span data-stu-id="3960b-238">Step 3: Create a public key</span></span>

<span data-ttu-id="3960b-239">На hello первой SAP HANA на сервере Azure (большие экземпляры) в каждом регионе Azure создайте инфраструктуры открытого ключа toobe используется tooaccess hello хранилища, чтобы вы могли создавать моментальные снимки.</span><span class="sxs-lookup"><span data-stu-id="3960b-239">On hello first SAP HANA on Azure (large instances) server in each Azure region, create a public key toobe used tooaccess hello storage infrastructure so that you can create snapshots.</span></span> <span data-ttu-id="3960b-240">открытый ключ Hello гарантирует пароль не является обязательным toosign в хранилище toohello и пароль учетных данных не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="3960b-240">hello public key ensures that a password is not required toosign in toohello storage and that password credentials are not maintained.</span></span> <span data-ttu-id="3960b-241">Выполните в Linux на сервере SAP HANA (крупных экземпляров) hello hello, следующая команда toogenerate hello открытый ключ.</span><span class="sxs-lookup"><span data-stu-id="3960b-241">In Linux on hello SAP HANA (large instances) server, execute hello following command toogenerate hello public key:</span></span>
```
  ssh-keygen –t dsa –b 1024
```
<span data-ttu-id="3960b-242">новое расположение Hello — _/root/.ssh/id\_dsa.pub.</span><span class="sxs-lookup"><span data-stu-id="3960b-242">hello new location is _/root/.ssh/id\_dsa.pub.</span></span> <span data-ttu-id="3960b-243">Не вводите фактическое парольную фразу, в противном случае парольную фразу hello необходимые tooenter будет каждый раз при входе в.</span><span class="sxs-lookup"><span data-stu-id="3960b-243">Do not enter an actual passphrase, or else you will be required tooenter hello passphrase each time you sign in.</span></span> <span data-ttu-id="3960b-244">Нажмите клавиши **ввод** дважды tooremove hello введите парольную фразу требование для входа.</span><span class="sxs-lookup"><span data-stu-id="3960b-244">Instead, press **Enter** twice tooremove hello enter passphrase requirement for signing in.</span></span>

<span data-ttu-id="3960b-245">Проверьте, что этот открытый ключ hello была исправлена, как ожидалось, изменение папки too/root/.ssh/ и последующего выполнения hello toomake **ls** команды.</span><span class="sxs-lookup"><span data-stu-id="3960b-245">Check toomake sure that hello public key was corrected as expected by changing folders too/root/.ssh/ and then executing hello **ls** command.</span></span> <span data-ttu-id="3960b-246">Если присутствует ключ hello, можно скопировать его, выполнив следующую команду hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-246">If hello key is present, you can copy it by running hello following command:</span></span>

![Команда для копирования открытого ключа](./media/hana-overview-high-availability-disaster-recovery/image2-public-key.png)

<span data-ttu-id="3960b-248">На этом этапе обратитесь к SAP HANA на управления службами Azure и укажите ключ hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-248">At this point, contact SAP HANA on Azure Service Management and provide hello key.</span></span> <span data-ttu-id="3960b-249">Hello представителю службы поддержки использует открытого ключа tooregister hello в hello базовой инфраструктуры хранения.</span><span class="sxs-lookup"><span data-stu-id="3960b-249">hello service representative uses hello public key tooregister it in hello underlying storage infrastructure.</span></span>

### <a name="step-4-create-an-sap-hana-user-account"></a><span data-ttu-id="3960b-250">Этап 4. Создание учетной записи пользователя SAP HANA</span><span class="sxs-lookup"><span data-stu-id="3960b-250">Step 4: Create an SAP HANA user account</span></span>

<span data-ttu-id="3960b-251">Создайте в SAP HANA Studio учетную запись пользователя SAP HANA. Она будет использоваться для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="3960b-251">Create an SAP HANA user account within SAP HANA Studio for backup purposes.</span></span> <span data-ttu-id="3960b-252">Это учетная запись должна иметь следующие права hello: _администратора резервного копирования_ и _чтения каталога_.</span><span class="sxs-lookup"><span data-stu-id="3960b-252">This account must have hello following privileges: _Backup Admin_ and _Catalog Read_.</span></span> <span data-ttu-id="3960b-253">В этом примере hello username SCADMIN создается.</span><span class="sxs-lookup"><span data-stu-id="3960b-253">In this example, hello username SCADMIN is created.</span></span>

![Создание пользователя в HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image3-creating-user.png)

### <a name="step-5-authorize-hello-sap-hana-user-account"></a><span data-ttu-id="3960b-255">Шаг 5: Авторизации учетной записи пользователя SAP HANA hello</span><span class="sxs-lookup"><span data-stu-id="3960b-255">Step 5: Authorize hello SAP HANA user account</span></span>

<span data-ttu-id="3960b-256">Разрешить учетную запись пользователя SAP HANA hello (toobe использовать скриптами hello без авторизации, каждый раз, чтобы запустить скрипт hello).</span><span class="sxs-lookup"><span data-stu-id="3960b-256">Authorize hello SAP HANA user account (toobe used by hello scripts without requiring authorization every time hello script is run).</span></span> <span data-ttu-id="3960b-257">Hello SAP HANA команда `hdbuserstore` позволяет создавать hello ключ пользователя SAP HANA, которая хранится на одном или нескольких узлах SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-257">hello SAP HANA command `hdbuserstore` allows hello creation of an SAP HANA user key, which is stored on one or more SAP HANA nodes.</span></span> <span data-ttu-id="3960b-258">ключ пользователя Hello также позволяет tooaccess пользователя hello SAP HANA без необходимости toomanage пароли из значений в hello сценариев процесс, который рассматривается ниже.</span><span class="sxs-lookup"><span data-stu-id="3960b-258">hello user key also allows hello user tooaccess SAP HANA without having toomanage passwords from within hello scripting process that's discussed later.</span></span>

>[!IMPORTANT]
><span data-ttu-id="3960b-259">Выполнения hello следующую команду, как `_root_`.</span><span class="sxs-lookup"><span data-stu-id="3960b-259">Run hello following command as `_root_`.</span></span> <span data-ttu-id="3960b-260">В противном случае скрипт hello не может работать неправильно.</span><span class="sxs-lookup"><span data-stu-id="3960b-260">Otherwise, hello script cannot work properly.</span></span>

<span data-ttu-id="3960b-261">Введите hello `hdbuserstore` следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3960b-261">Enter hello `hdbuserstore` command as follows:</span></span>

![Введите команду hdbuserstore hello](./media/hana-overview-high-availability-disaster-recovery/image4-hdbuserstore-command.png)

<span data-ttu-id="3960b-263">В следующий пример, где hello выполняется SCADMIN01 и hello hostname является lhanad01, hello hello команда является:</span><span class="sxs-lookup"><span data-stu-id="3960b-263">In hello following example, where hello user is SCADMIN01 and hello hostname is lhanad01, hello command is:</span></span>
```
hdbuserstore set SCADMIN01 lhanad01:30115 <backup username> <password>
```
<span data-ttu-id="3960b-264">Управляйте всеми процессами написания скрипта для масштабируемых экземпляров HANA с одного сервера.</span><span class="sxs-lookup"><span data-stu-id="3960b-264">Manage all scripting from a single server for scale-out HANA instances.</span></span> <span data-ttu-id="3960b-265">В этом примере ключ SAP HANA hello SCADMIN01 должен быть изменен для каждого узла в способом, который соответствует hello узел, который является ключом связанные toohello.</span><span class="sxs-lookup"><span data-stu-id="3960b-265">In this example, hello SAP HANA key SCADMIN01 must be altered for each host in a way that reflects hello host that is related toohello key.</span></span> <span data-ttu-id="3960b-266">То есть изменен hello SAP HANA резервного копирования учетных записей с числом экземпляр hello hello HANA DB **lhanad**.</span><span class="sxs-lookup"><span data-stu-id="3960b-266">That is, hello SAP HANA backup account is amended with hello instance number of hello HANA DB, **lhanad**.</span></span> <span data-ttu-id="3960b-267">ключ Hello требуются права администратора на узле hello, когда он присваивается и hello резервного копирования пользователь для масштабного развертывания должен иметь экземпляры SAP HANA tooall прав доступа.</span><span class="sxs-lookup"><span data-stu-id="3960b-267">hello key must have administrative privileges on hello host it is assigned to, and hello backup user for scale-out must have access rights tooall SAP HANA instances.</span></span>
```
hdbuserstore set SCADMIN01 lhanad:30015 SCADMIN <password>
hdbuserstore set SCADMIN02 lhanad:30115 SCADMIN <password>
hdbuserstore set SCADMIN03 lhanad:30215 SCADMIN <password>
```

### <a name="step-6-copy-items-from-hello-scripts-folder"></a><span data-ttu-id="3960b-268">Шаг 6: Копирование элементов из папки/Scripts hello</span><span class="sxs-lookup"><span data-stu-id="3960b-268">Step 6: Copy items from hello /scripts folder</span></span>

<span data-ttu-id="3960b-269">Следующие hello копии элементов из hello/скрипты (в hello золотой образ установки hello содержаться) toohello рабочий каталог для **hdbsql**.</span><span class="sxs-lookup"><span data-stu-id="3960b-269">Copy hello following items from hello /scripts folder (included on hello gold image of hello installation) toohello working directory for **hdbsql**.</span></span> <span data-ttu-id="3960b-270">Для текущих установок HANA это каталог /hana/shared/D01/exe/linuxx86\_64/hdb.</span><span class="sxs-lookup"><span data-stu-id="3960b-270">For current HANA installations, this directory is /hana/shared/D01/exe/linuxx86\_64/hdb.</span></span>
```
azure\_hana\_backup.pl
testHANAConnection.pl
testStorageSnapshotConnection.pl
removeTestStorageSnapshot.pl
HANABackupCustomerDetails.txt
```
<span data-ttu-id="3960b-271">Скопируйте hello следующих элементов, если они выполняются с горизонтальным масштабированием или OLAP:</span><span class="sxs-lookup"><span data-stu-id="3960b-271">Copy hello following items if they are running scale-out or OLAP:</span></span>
```
azure\_hana\_backup\_bw.pl
testHANAConnectionBW.pl
testStorageSnapshotConnectionBW.pl
removeTestStorageSnapshotBW.pl
HANABackupCustomerDetailsBW.txt
```
<span data-ttu-id="3960b-272">файл HANABackupCustomerDetails.txt Hello следующим образом для развертывания масштабируемых или нет.</span><span class="sxs-lookup"><span data-stu-id="3960b-272">hello HANABackupCustomerDetails.txt file is modifiable as follows for a scale-up deployment.</span></span> <span data-ttu-id="3960b-273">Это hello управления и файл конфигурации для hello скрипта, выполняемого моментальные снимки хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-273">It is hello control and configuration file for hello script that runs hello storage snapshots.</span></span> <span data-ttu-id="3960b-274">Вы должны были получить hello _имя хранилища архивации_ и _IP-адрес хранилища_ из SAP HANA на управления службами Azure, если экземпляры были развернуты.</span><span class="sxs-lookup"><span data-stu-id="3960b-274">You should have received hello _Storage Backup Name_ and _Storage IP Address_ from SAP HANA on Azure Service Management when your instances were deployed.</span></span> <span data-ttu-id="3960b-275">Не удается изменить последовательность hello упорядочение или интервалы какой-либо переменные hello, или сценария hello не выполняется должным образом.</span><span class="sxs-lookup"><span data-stu-id="3960b-275">You cannot modify hello sequence, ordering, or spacing of any of hello variables, or hello script does not run properly.</span></span>

<span data-ttu-id="3960b-276">Для развертывания масштабируемых файл конфигурации hello выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3960b-276">For a scale-up deployment, hello configuration file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Created by customer using hdbuserstore
HANA Backup Name: SCADMIND01
```
<span data-ttu-id="3960b-277">Для конфигурации горизонтального масштабирования файл HANABackupCustomerDetailsBW.txt hello выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3960b-277">For a scale-out configuration, hello HANABackupCustomerDetailsBW.txt file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Node IP addresses, instance numbers, and HANA backup name
#provided by customer.  HANA backup name created using
#hdbuserstore utility.
Node 1 IP Address: 10.254.15.21
Node 1 HANA instance number: 01
Node 1 HANA Backup Name: SCADMIN01
Node 2 IP Address: 10.254.15.22
Node 2 HANA instance number: 02
Node 2 HANA Backup Name: SCADMIN02
Node 3 IP Address: 10.254.15.23
Node 3 HANA instance number: 03
Node 3 HANA Backup Name: SCADMIN03
Node 4 IP Address: 10.254.15.24
Node 4 HANA instance number: 04
Node 4 HANA Backup Name: SCADMIN04
Node 5 IP Address: 10.254.15.25
Node 5 HANA instance number: 05
Node 5 HANA Backup Name: SCADMIN05
Node 6 IP Address: 10.254.15.26
Node 6 HANA instance number: 06
Node 6 HANA Backup Name: SCADMIN06
Node 7 IP Address: 10.254.15.27
Node 7 HANA instance number: 07
Node 7 HANA Backup Name: SCADMIN07
Node 8 IP Address: 10.254.15.28
Node 8 HANA instance number: 08
Node 8 HANA Backup Name: SCADMIN08
```
>[!NOTE]
><span data-ttu-id="3960b-278">В настоящее время в hello фактический HANA хранилища моментальных снимков скрипт используются только сведения об узле 1.</span><span class="sxs-lookup"><span data-stu-id="3960b-278">Currently, only Node 1 details are used in hello actual HANA storage snapshot script.</span></span> <span data-ttu-id="3960b-279">Рекомендуется протестировать tooor доступ со всех узлов HANA таким образом, чтобы при изменении главного узла резервного копирования hello уже гарантирует, что любой другой узел может занять его место, изменив hello сведения в узле 1.</span><span class="sxs-lookup"><span data-stu-id="3960b-279">We recommend that you test access tooor from all HANA nodes so that, if hello master backup node ever changes, you have already ensured that any other node can take its place by modifying hello details in Node 1.</span></span>

<span data-ttu-id="3960b-280">toocheck для hello правильными настройками в файле конфигурации hello или экземпляров HANA toohello связи, выполните одно из следующих сценариев hello:</span><span class="sxs-lookup"><span data-stu-id="3960b-280">toocheck for hello correct configurations in hello configuration file or proper connectivity toohello HANA instances, run either of hello following scripts:</span></span>
- <span data-ttu-id="3960b-281">Для конфигурации вертикального масштабирования (независимо от рабочей нагрузки SAP):</span><span class="sxs-lookup"><span data-stu-id="3960b-281">For a scale-up configuration (independent on SAP workload):</span></span>

 ```
testHANAConnection.pl
```
- <span data-ttu-id="3960b-282">Для конфигурации горизонтального масштабирования:</span><span class="sxs-lookup"><span data-stu-id="3960b-282">For a scale-out configuration:</span></span>

 ```
testHANAConnectionBW.pl
```

<span data-ttu-id="3960b-283">Убедитесь, что этот экземпляр hello master HANA серверы HANA tooall требуется доступ.</span><span class="sxs-lookup"><span data-stu-id="3960b-283">Ensure that hello master HANA instance has access tooall required HANA servers.</span></span> <span data-ttu-id="3960b-284">Существуют toohello нет параметров скрипта, но необходимо выполнить соответствующие HANABackupCustomerDetails hello / HANABackupCustomerDetailsBW в файле сценария toorun hello должным образом.</span><span class="sxs-lookup"><span data-stu-id="3960b-284">There are no parameters toohello script, but you must complete hello appropriate HANABackupCustomerDetails/ HANABackupCustomerDetailsBW file for hello script toorun properly.</span></span> <span data-ttu-id="3960b-285">Так как возвращается только hello оболочки команда коды ошибок, возможна не для hello скрипт проверки tooerror каждого экземпляра.</span><span class="sxs-lookup"><span data-stu-id="3960b-285">Because only hello shell command error codes are returned, it is not possible for hello script tooerror-check every instance.</span></span> <span data-ttu-id="3960b-286">Даже в этом случае скрипт hello предоставляет некоторые полезные комментарии вы toodouble проверки.</span><span class="sxs-lookup"><span data-stu-id="3960b-286">Even so, hello script does provide some helpful comments for you toodouble-check.</span></span>

<span data-ttu-id="3960b-287">скрипт hello toorun:</span><span class="sxs-lookup"><span data-stu-id="3960b-287">toorun hello script:</span></span>
```
 ./testHANAConnection.pl
```
 <span data-ttu-id="3960b-288">Если скрипт hello успешно получает состояние hello экземпляра HANA hello, отображается сообщение, что hello HANA подключение выполнено успешно.</span><span class="sxs-lookup"><span data-stu-id="3960b-288">If hello script successfully obtains hello status of hello HANA instance, it displays a message that hello HANA connection was successful.</span></span>

<span data-ttu-id="3960b-289">Кроме того, имеется второй тип скрипта можно использовать возможности toosign toocheck hello главного HANA экземпляра сервера в хранилище toohello.</span><span class="sxs-lookup"><span data-stu-id="3960b-289">Additionally, there is a second type of script you can use toocheck hello master HANA instance server's ability toosign in toohello storage.</span></span> <span data-ttu-id="3960b-290">Перед выполнением hello azure\_hana\_резервного копирования (\_bw) .pl сценария, необходимо выполнить следующий скрипт hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-290">Before you execute hello azure\_hana\_backup(\_bw).pl script, you must execute hello next script.</span></span> <span data-ttu-id="3960b-291">Если том содержит снимки, это невозможно toodetermine ли том hello просто пуст или отсутствует ssh hello tooobtain сбоя сведения о снимке.</span><span class="sxs-lookup"><span data-stu-id="3960b-291">If a volume contains no snapshots, it is impossible toodetermine whether hello volume is simply empty or there is an ssh failure tooobtain hello snapshot details.</span></span> <span data-ttu-id="3960b-292">По этой причине hello сценарий выполняет два действия:</span><span class="sxs-lookup"><span data-stu-id="3960b-292">For this reason, hello script executes two steps:</span></span>

- <span data-ttu-id="3960b-293">Он проверяет, что доступно этой консоли hello хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-293">It verifies that hello storage console is accessible.</span></span>
- <span data-ttu-id="3960b-294">создание тестового (фиктивного) моментального снимка для каждого тома экземпляра HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-294">It creates a test, or dummy, snapshot for each volume by HANA instance.</span></span>

<span data-ttu-id="3960b-295">По этой причине экземпляр HANA hello включается в качестве аргумента.</span><span class="sxs-lookup"><span data-stu-id="3960b-295">For this reason, hello HANA instance is included as an argument.</span></span> <span data-ttu-id="3960b-296">Опять же не возможные tooprovide проверку ошибок для подключения хранилища hello, но hello сценарий предоставляет полезные ссылки, если происходит сбой выполнения hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-296">Again, it is not possible tooprovide error checking for hello storage connection, but hello script provides helpful hints if hello execution fails.</span></span>

<span data-ttu-id="3960b-297">Hello скрипт выполняется как:</span><span class="sxs-lookup"><span data-stu-id="3960b-297">hello script is run as:</span></span>
```
 ./testStorageSnapshotConnection.pl <hana instance>
```
<span data-ttu-id="3960b-298">Или как:</span><span class="sxs-lookup"><span data-stu-id="3960b-298">Or it is run as:</span></span>
```
./testStorageSnapshotConnectionBW.pl <hana instance>
```
<span data-ttu-id="3960b-299">сценарий Hello также отображает сообщения, которые могут toosign соответствующим образом tooyour развернуть хранилище клиента, которая организована вокруг hello логических номеров (устройств LUN), которые используются экземплярами серверов hello, которыми вы владеете.</span><span class="sxs-lookup"><span data-stu-id="3960b-299">hello script also displays a message that you are able toosign in appropriately tooyour deployed storage tenant, which is organized around hello logical unit numbers (LUNs) that are used by hello server instances you own.</span></span>

<span data-ttu-id="3960b-300">Перед выполнением hello первого хранилища моментальных снимков резервного копирования на основе запустите hello Далее сценарии toomake правильность конфигурации hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-300">Before you execute hello first storage snapshot-based backups, run hello next scripts toomake sure that hello configuration is correct.</span></span>

<span data-ttu-id="3960b-301">После выполнения этих сценариев, можно удалить моментальные снимки hello, выполнив:</span><span class="sxs-lookup"><span data-stu-id="3960b-301">After running these scripts, you can delete hello snapshots by executing:</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```
<span data-ttu-id="3960b-302">Или</span><span class="sxs-lookup"><span data-stu-id="3960b-302">Or</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```

### <a name="step-7-perform-on-demand-snapshots"></a><span data-ttu-id="3960b-303">Этап 7. Создание моментальных снимков по запросу</span><span class="sxs-lookup"><span data-stu-id="3960b-303">Step 7: Perform on-demand snapshots</span></span>

<span data-ttu-id="3960b-304">Создайте моментальные снимки по запросу (или же запланируйте регулярное создание этих снимков с помощью Cron), выполнив один из следующих скриптов.</span><span class="sxs-lookup"><span data-stu-id="3960b-304">Perform on-demand snapshots (as well as schedule regular snapshots by using cron) as described here.</span></span>

<span data-ttu-id="3960b-305">Для конфигураций с горизонтальным масштабированием выполните следующий сценарий hello:</span><span class="sxs-lookup"><span data-stu-id="3960b-305">For scale-up configurations, execute hello following script:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="3960b-306">Для конфигурациях с масштабным развертыванием выполните следующий сценарий hello:</span><span class="sxs-lookup"><span data-stu-id="3960b-306">For scale-out configurations, execute hello following script:</span></span>
```
./azure_hana_backup_bw.pl lhanad01 customer 20
```
<span data-ttu-id="3960b-307">сценарий масштабирования Hello выполняет некоторые дополнительные проверки toomake, убедиться, что доступны все серверы HANA, что все экземпляры HANA возвращают соответствующее состояние экземпляра hello перед тем как продолжить создание SAP HANA или хранилище моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="3960b-307">hello scale-out script does some additional checking toomake sure that all HANA servers can be accessed, and all HANA instances return appropriate status of hello instance before proceeding with creating SAP HANA or storage snapshots.</span></span>

<span data-ttu-id="3960b-308">Hello следующие аргументы не требуются:</span><span class="sxs-lookup"><span data-stu-id="3960b-308">hello following arguments are required:</span></span>

- <span data-ttu-id="3960b-309">Hello HANA экземпляр требование резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="3960b-309">hello HANA instance requiring backup.</span></span>
- <span data-ttu-id="3960b-310">префикс Hello моментальных снимков для хранения снимка hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-310">hello snapshot prefix for hello storage snapshot.</span></span>
- <span data-ttu-id="3960b-311">Количество toobe моментальные снимки сохраняются в течение указанного префикса hello Hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-311">hello number of snapshots toobe kept for hello specific prefix.</span></span>

```
./azure_hana_backup.pl lhanad01 customer 20
```

<span data-ttu-id="3960b-312">Выполнение скрипта hello Hello создает моментальный снимок хранилища hello в эти три этапа:</span><span class="sxs-lookup"><span data-stu-id="3960b-312">hello execution of hello script creates hello storage snapshot in these three distinct phases:</span></span>

- <span data-ttu-id="3960b-313">создание моментального снимка HANA;</span><span class="sxs-lookup"><span data-stu-id="3960b-313">Execute a HANA snapshot.</span></span>
- <span data-ttu-id="3960b-314">создание моментального снимка хранилища;</span><span class="sxs-lookup"><span data-stu-id="3960b-314">Execute a storage snapshot.</span></span>
- <span data-ttu-id="3960b-315">Удаление моментального снимка HANA hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-315">Remove hello HANA snapshot.</span></span>

<span data-ttu-id="3960b-316">Выполните сценарий hello путем вызова из hello HDB папку с исполняемым файлом, он был скопирован.</span><span class="sxs-lookup"><span data-stu-id="3960b-316">Execute hello script by calling it from hello HDB executable folder that it was copied to.</span></span> <span data-ttu-id="3960b-317">Он создает резервную копию по крайней мере hello следующие тома, но он также выполняет резервное копирование любой том, имеет имя экземпляра SAP HANA явные hello в hello имя тома.</span><span class="sxs-lookup"><span data-stu-id="3960b-317">It backs up at least hello following volumes, but it also backs up any volume that has hello explicit SAP HANA instance name in hello volume name.</span></span>
```
hana_data_<hana instance>_prod_t020_vol
hana_log_<hana instance>_prod_t020_vol
hana_log_backup_<hana instance>_prod_t020_vol
hana_shared_<hana instance>_prod_t020_vol
```
<span data-ttu-id="3960b-318">срок хранения Hello строго Администрирование с hello количество моментальных снимков, отправки в качестве параметра при выполнении сценария hello (например, 20, показанному ранее).</span><span class="sxs-lookup"><span data-stu-id="3960b-318">hello retention period is strictly administered, with hello number of snapshots submitted as a parameter when you execute hello script (such as 20, shown previously).</span></span> <span data-ttu-id="3960b-319">Поэтому hello количество времени — это функция hello периода выполнения и hello количество моментальных снимков в вызове hello hello скрипта.</span><span class="sxs-lookup"><span data-stu-id="3960b-319">So hello amount of time is a function of hello period of execution and hello number of snapshots in hello call of hello script.</span></span> <span data-ttu-id="3960b-320">Если hello количество моментальных снимков, которые хранятся превышает число hello, который указан как параметр в вызове hello hello скрипта, hello наиболее старые моментальные снимки хранилища этой метки (в нашем случае предыдущих _пользовательские_) удаляется до требуется новый моментальный снимок выполнена.</span><span class="sxs-lookup"><span data-stu-id="3960b-320">If hello number of snapshots that are kept exceeds hello number that are named as a parameter in hello call of hello script, hello oldest storage snapshot of this label (in our previous case, _custom_) is deleted before a new snapshot is executed.</span></span> <span data-ttu-id="3960b-321">Это означает номер hello назначаем как hello последнего параметра вызова hello номер hello, можно использовать toocontrol hello количество моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="3960b-321">This means hello number you give as hello last parameter of hello call is hello number you can use toocontrol hello number of snapshots.</span></span>

>[!NOTE]
><span data-ttu-id="3960b-322">Как только вы измените метку hello, подсчет hello запускается снова.</span><span class="sxs-lookup"><span data-stu-id="3960b-322">As soon as you change hello label, hello counting starts again.</span></span>

<span data-ttu-id="3960b-323">Необходимо имя экземпляра HANA hello tooinclude, предоставляемая SAP HANA на управления службами Azure в качестве аргумента, если они создаются моментальные снимки в средах с несколькими узлами.</span><span class="sxs-lookup"><span data-stu-id="3960b-323">You need tooinclude hello HANA instance name that's provided by SAP HANA on Azure Service Management as an argument if they are creating snapshots in multi-node environments.</span></span> <span data-ttu-id="3960b-324">В средах с одним узлом достаточно hello имя hello SAP HANA на устройстве Azure (большие экземпляры), но по-прежнему рекомендуется использовать имя экземпляра HANA hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-324">In single-node environments, hello name of hello SAP HANA on Azure (large instances) unit is sufficient, but hello HANA instance name is still recommended.</span></span>

<span data-ttu-id="3960b-325">Кроме того, вы может создать резервную копию volumes\LUNs загрузки с помощью hello же скрипт.</span><span class="sxs-lookup"><span data-stu-id="3960b-325">Additionally, you can back up boot volumes\LUNs by using hello same script.</span></span> <span data-ttu-id="3960b-326">Резервную копию загрузочного тома необходимо создать по крайней мере при первом запуске HANA. Однако мы советуем запланировать резервное копирование, выполняемое каждую неделю или каждую ночь, с помощью Cron.</span><span class="sxs-lookup"><span data-stu-id="3960b-326">You must back up your boot volume at least once when you first run HANA, although we recommend a weekly or nightly backup schedule for booting in cron.</span></span> <span data-ttu-id="3960b-327">Вместо вставки не добавляйте имя экземпляра SAP HANA, _загрузки_ как hello аргумент в сценарий hello следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3960b-327">Rather than add an SAP HANA instance name, insert _boot_ as hello argument into hello script as follows:</span></span>
```
./azure_hana_backup boot customer 20
```
<span data-ttu-id="3960b-328">Hello одной политике хранения предоставленные toohello также загрузочного тома.</span><span class="sxs-lookup"><span data-stu-id="3960b-328">hello same retention policy is afforded toohello boot volume as well.</span></span> <span data-ttu-id="3960b-329">Используйте моментальные снимки по запросу, как описано ранее, в особых случаях, например, во время обновления пакета (EHP) расширения SAP или при необходимости toocreate отдельное хранилище моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-329">Use on-demand snapshots, as described previously, for special cases only, such as during an SAP enhancement package (EHP) upgrade, or when you need toocreate a distinct storage snapshot.</span></span>

<span data-ttu-id="3960b-330">Мы рекомендуем вам tooperform запланированные моментальные снимки хранилища с помощью cron, и мы рекомендуем использовать hello же скрипт для всех резервных копий и потребностей аварийного восстановления (изменение hello скрипт входов toomatch hello различных запрошенный время резервного копирования).</span><span class="sxs-lookup"><span data-stu-id="3960b-330">We encourage you tooperform scheduled storage snapshots using cron, and we recommend that you use hello same script for all backups and disaster-recovery needs (modifying hello script inputs toomatch hello various requested backup times).</span></span> <span data-ttu-id="3960b-331">Это средство позволяет настроить резервное копирование на регулярной основе, например каждый час, каждые 12 часов, каждый день или каждую неделю.</span><span class="sxs-lookup"><span data-stu-id="3960b-331">These are all scheduled differently in cron depending on their execution time: hourly, 12-hour, daily, or weekly.</span></span> <span data-ttu-id="3960b-332">расписание cron Hello — спроектированный toocreate моментальные снимки хранилища, соответствующие hello описывалось ранее хранения метки для долгосрочного резервную.</span><span class="sxs-lookup"><span data-stu-id="3960b-332">hello cron schedule is designed toocreate storage snapshots that match hello previously discussed retention labeling for long-term off-site backup.</span></span> <span data-ttu-id="3960b-333">Hello скрипт включает команды tooback архивацию всех томов производства, в зависимости от их Запрошенная периодичность (файлы данных и журналов резервного копирования каждый час, тогда как hello загрузочного тома резервного копирования ежедневно).</span><span class="sxs-lookup"><span data-stu-id="3960b-333">hello script includes commands tooback up all production volumes, depending on their requested frequency (data and log files are backed up hourly, whereas hello boot volume is backed up daily).</span></span>

<span data-ttu-id="3960b-334">Десятый минуты, через каждые 12 часов на hello десятый минуты и ежедневно hello десятый минуту записей Hello в следующий скрипт cron hello запустить в hello каждый час.</span><span class="sxs-lookup"><span data-stu-id="3960b-334">hello entries in hello following cron script run every hour at hello tenth minute, every 12 hours at hello tenth minute, and daily at hello tenth minute.</span></span> <span data-ttu-id="3960b-335">Hello cron задания создаются таким образом, наличие единственного моментального снимка хранилища SAP HANA выполняется в течение определенного времени, поэтому hello часам и дням резервные копии не создаются через hello же время (12:10 AM).</span><span class="sxs-lookup"><span data-stu-id="3960b-335">hello cron jobs are created in such a way that only one SAP HANA storage snapshot takes place during any particular hour, so that hello hourly and daily backups do not occur at hello same time (12:10 AM).</span></span> <span data-ttu-id="3960b-336">toohelp оптимизировать создание моментальных снимков и репликации, SAP HANA на управление службой Azure предоставляет hello рекомендуется время вы toorun резервных копий.</span><span class="sxs-lookup"><span data-stu-id="3960b-336">toohelp optimize your snapshot creation and replication, SAP HANA on Azure Service Management provides hello recommended time for you toorun your backups.</span></span>

<span data-ttu-id="3960b-337">Планирование в /etc/crontab cron по умолчанию Hello выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3960b-337">hello default cron scheduling in /etc/crontab is as follows:</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 14
```
<span data-ttu-id="3960b-338">В предыдущей инструкции cron hello hello тома HANA (без загрузочного тома) получение моментальных снимков с меткой hello каждый час.</span><span class="sxs-lookup"><span data-stu-id="3960b-338">In hello previous cron instructions, hello HANA volumes (without boot volume) get an hourly snapshot with hello label.</span></span> <span data-ttu-id="3960b-339">и 66 из них сохраняются.</span><span class="sxs-lookup"><span data-stu-id="3960b-339">Of these snapshots, 66 are retained.</span></span> <span data-ttu-id="3960b-340">Кроме того 14 моментальные снимки с меткой 12-часовой hello сохраняются.</span><span class="sxs-lookup"><span data-stu-id="3960b-340">Additionally, 14 snapshots with hello 12-hour label are retained.</span></span> <span data-ttu-id="3960b-341">Таким образом, вы можете хранить моментальные снимки, создаваемые каждый час, в течение трех дней и моментальные снимки, создаваемые каждые 12 часов, в течение четырех дней. Следовательно, моментальные снимки позволяют охватить целую неделю.</span><span class="sxs-lookup"><span data-stu-id="3960b-341">You potentially get hourly snapshots for three days, plus 12-hour snapshots for another four days, which gives you an entire week of snapshots.</span></span>

<span data-ttu-id="3960b-342">Планирование в cron может быть непростой задачей, так как только один сценарий должна выполняться в любой конкретный момент времени, если скрипты hello располагаются в шахматном порядке на несколько минут.</span><span class="sxs-lookup"><span data-stu-id="3960b-342">Scheduling within cron can be tricky, because only one script should be executed at any particular time, unless hello scripts are staggered by several minutes.</span></span> <span data-ttu-id="3960b-343">Если требуется ежедневного резервного копирования для долгосрочного хранения моментальный снимок хранится вместе с 12-часовой моментальный снимок (с количеством хранения каждого 7) или почасовой hello моментальный снимок — по ширине tootake месте 10 минут позже.</span><span class="sxs-lookup"><span data-stu-id="3960b-343">If you want daily backups for long-term retention, either a daily snapshot is kept along with a 12-hour snapshot (with a retention count of seven each), or hello hourly snapshot is staggered tootake place 10 minutes later.</span></span> <span data-ttu-id="3960b-344">Только один моментальный снимок хранится в hello рабочего тома.</span><span class="sxs-lookup"><span data-stu-id="3960b-344">Only one daily snapshot is kept in hello production volume.</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 7
10 0 * * * ./azure_hana_backup.pl lhanad01 daily 7
```
<span data-ttu-id="3960b-345">перечисленные здесь частот Hello являются только примеры.</span><span class="sxs-lookup"><span data-stu-id="3960b-345">hello frequencies listed here are only examples.</span></span> <span data-ttu-id="3960b-346">tooderive вашей оптимальное количество моментальных снимков, hello используйте следующие критерии:</span><span class="sxs-lookup"><span data-stu-id="3960b-346">tooderive your optimum number of snapshots, use hello following criteria:</span></span>

- <span data-ttu-id="3960b-347">Требования к RTO для восстановления на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="3960b-347">Requirements in recovery time objective for point-in-time recovery.</span></span>
- <span data-ttu-id="3960b-348">Использование пространства.</span><span class="sxs-lookup"><span data-stu-id="3960b-348">Space usage.</span></span>
- <span data-ttu-id="3960b-349">Требования к RTO и RTO в случае возможного аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-349">Requirements in recovery point objective and recovery time objective for potential disaster recovery.</span></span>
- <span data-ttu-id="3960b-350">Последующее выполнение полного резервного копирования базы данных HANA на диски.</span><span class="sxs-lookup"><span data-stu-id="3960b-350">Eventual execution of HANA full database backups against disks.</span></span> <span data-ttu-id="3960b-351">Всякий раз, когда полной резервной копии для дисков, или _backint_ интерфейсом, будет выполнено, происходит сбой выполнения hello моментальные снимки хранилища.</span><span class="sxs-lookup"><span data-stu-id="3960b-351">Whenever a full database backup against disks, or _backint_ interface, is performed, hello execution of storage snapshots fails.</span></span> <span data-ttu-id="3960b-352">Если планируется tooexecute полные резервные копии на основе хранилища моментальных снимков, убедитесь, что отключен, выполнение hello моментальные снимки хранилища в течение этого времени.</span><span class="sxs-lookup"><span data-stu-id="3960b-352">If you plan tooexecute full database backups on top of storage snapshots, make sure that hello execution of storage snapshots is disabled during this time.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="3960b-353">Использование Hello моментальные снимки хранилища для резервных копий SAP HANA допустим только в том случае, когда моментальные снимки hello выполняются в сочетании с резервными копиями журнала SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-353">hello use of storage snapshots for SAP HANA backups is valid only when hello snapshots are performed in conjunction with SAP HANA log backups.</span></span> <span data-ttu-id="3960b-354">Hello может toocover toobe необходимость резервных копий журнала периодов времени между моментальные снимки хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-354">These log backups need toobe able toocover hello time periods between hello storage snapshots.</span></span> <span data-ttu-id="3960b-355">При установке toousers обязательств восстановления на момент 30 дней необходимо hello следующее:</span><span class="sxs-lookup"><span data-stu-id="3960b-355">If you've set a commitment toousers of a point-in-time recovery of 30 days, you need hello following:</span></span>

- <span data-ttu-id="3960b-356">Возможность tooaccess хранилища моментальных снимков, то есть 30 дней.</span><span class="sxs-lookup"><span data-stu-id="3960b-356">Ability tooaccess a storage snapshot that is 30 days old.</span></span>
- <span data-ttu-id="3960b-357">Резервные копии журналов смежных через hello последние 30 дней.</span><span class="sxs-lookup"><span data-stu-id="3960b-357">Contiguous log backups over hello last 30 days.</span></span>

<span data-ttu-id="3960b-358">В диапазоне hello резервных копий журналов создайте моментальный снимок тома резервного копирования журнала hello также.</span><span class="sxs-lookup"><span data-stu-id="3960b-358">In hello range of log backups, create a snapshot of hello backup log volume as well.</span></span> <span data-ttu-id="3960b-359">Однако необходимо убедиться, что tooperform регулярное резервное копирование журнала, чтобы пользователь мог:</span><span class="sxs-lookup"><span data-stu-id="3960b-359">However, be sure tooperform regular log backups so that you can:</span></span>

- <span data-ttu-id="3960b-360">Имеется резервные копии журнала смежных hello необходимое tooperform восстановление на момент времени.</span><span class="sxs-lookup"><span data-stu-id="3960b-360">Have hello contiguous log backups needed tooperform point-in-time recoveries.</span></span>
- <span data-ttu-id="3960b-361">Запретить тома журнала SAP HANA hello переполнения.</span><span class="sxs-lookup"><span data-stu-id="3960b-361">Prevent hello SAP HANA log volume from running out of space.</span></span>

<span data-ttu-id="3960b-362">Один из последних шагах hello — SAP HANA tooschedule резервных копий журналов в SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="3960b-362">One of hello last steps is tooschedule SAP HANA backup logs in SAP HANA Studio.</span></span> <span data-ttu-id="3960b-363">Hello SAP HANA резервного копирования журнала целевой назначением является hello специально созданные hana или журнала\_резервные копии томов с точкой подключения hello /hana/log/backups.</span><span class="sxs-lookup"><span data-stu-id="3960b-363">hello SAP HANA backup log target destination is hello specially created hana/log\_backups volume with hello mount point of /hana/log/backups.</span></span>

![Настройка расписания для создания резервных копий журнала SAP HANA в SAP HANA Studio.](./media/hana-overview-high-availability-disaster-recovery/image5-schedule-backup.png)

<span data-ttu-id="3960b-365">Можно выполнять резервные копии намного чаще, чем каждые 15 минут.</span><span class="sxs-lookup"><span data-stu-id="3960b-365">You can choose backups that are more frequent than every 15 minutes.</span></span> <span data-ttu-id="3960b-366">Некоторые пользователи выполняют резервное копирование журналов каждую минуту. Однако мы не советуем создавать резервные копии _реже_, чем раз в 15 минут.</span><span class="sxs-lookup"><span data-stu-id="3960b-366">Some users even perform log backups every minute, although we do not recommend going _over_ 15 minutes.</span></span>

<span data-ttu-id="3960b-367">Последний шаг Hello — toocreate tooperform на основе файла резервной копии (после hello первоначальной установки SAP HANA) одного резервного копирования запись, которая должна быть создана в каталог резервных копий hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-367">hello final step is tooperform a file-based backup (after hello initial installation of SAP HANA) toocreate a single backup entry that must exist within hello backup catalog.</span></span> <span data-ttu-id="3960b-368">В противном случае SAP HANA не может инициировать резервное копирование журнала.</span><span class="sxs-lookup"><span data-stu-id="3960b-368">Otherwise SAP HANA cannot initiate your specified log backups.</span></span>

![Сделать файловых toocreate резервного копирования одной операции резервного копирования](./media/hana-overview-high-availability-disaster-recovery/image6-make-backup.png)

### <a name="monitoring-hello-number-and-size-of-snapshots-on-hello-disk-volume"></a><span data-ttu-id="3960b-370">Мониторинг hello числа и размера моментальных снимков на диске hello</span><span class="sxs-lookup"><span data-stu-id="3960b-370">Monitoring hello number and size of snapshots on hello disk volume</span></span>

<span data-ttu-id="3960b-371">На томе конкретное хранилище можно отслеживать количество hello моментальные снимки и использование хранилища hello моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="3960b-371">On a particular storage volume, you can monitor hello number of snapshots and hello storage consumption of snapshots.</span></span> <span data-ttu-id="3960b-372">Hello `ls` команда не указывает hello каталога моментальных снимков или файлов.</span><span class="sxs-lookup"><span data-stu-id="3960b-372">hello `ls` command doesn't show hello snapshot directory or files.</span></span> <span data-ttu-id="3960b-373">Однако hello команда ОС Linux `du` делает hello, следующие команды:</span><span class="sxs-lookup"><span data-stu-id="3960b-373">However, hello Linux OS command `du` does, with hello following commands:</span></span>

- <span data-ttu-id="3960b-374">`du –sh .snapshot`предоставляет сумму всех моментальных снимков в папке моментальных снимков hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-374">`du –sh .snapshot` provides a total of all snapshots within hello snapshot directory.</span></span>
- <span data-ttu-id="3960b-375">`du –sh --max-depth=1`список всех моментальных снимков, сохраненных в папке .snapshot hello и hello размер каждого моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-375">`du –sh --max-depth=1` lists all snapshots that are saved in hello .snapshot folder and hello size of each snapshot.</span></span>
- <span data-ttu-id="3960b-376">`du –hc`предоставляет общий размер hello, используемые всеми моментальными снимками.</span><span class="sxs-lookup"><span data-stu-id="3960b-376">`du –hc` provides hello total size used by all snapshots.</span></span>

<span data-ttu-id="3960b-377">С помощью этих команд toomake убедиться, что hello моментальных снимков, которые берутся и хранятся не потребляют всех хранилищ hello на томах hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-377">Use these commands toomake sure that hello snapshots that are taken and stored are not consuming all hello storage on hello volumes.</span></span>

### <a name="reducing-hello-number-of-snapshots-on-a-server"></a><span data-ttu-id="3960b-378">Уменьшение числа hello моментальных снимков на сервере</span><span class="sxs-lookup"><span data-stu-id="3960b-378">Reducing hello number of snapshots on a server</span></span>

<span data-ttu-id="3960b-379">Как было описано выше, можно уменьшить количество hello определенных меток моментальных снимков, которые хранятся.</span><span class="sxs-lookup"><span data-stu-id="3960b-379">As explained earlier, you can reduce hello number of certain labels of snapshots that you store.</span></span> <span data-ttu-id="3960b-380">Hello последние два параметра tooinitiate команда hello моментальный снимок ряд метку и hello моментальные снимки, которые нужно tooretain.</span><span class="sxs-lookup"><span data-stu-id="3960b-380">hello last two parameters of hello command tooinitiate a snapshot are a label and hello number of snapshots you want tooretain.</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="3960b-381">В предыдущем примере hello hello моментального снимка называется _клиента_ и hello число моментальных снимков с этой toobe метки сохраняются _20_.</span><span class="sxs-lookup"><span data-stu-id="3960b-381">In hello previous example, hello snapshot label is _customer_ and hello number of snapshots with this label toobe retained is _20_.</span></span> <span data-ttu-id="3960b-382">Как ответ toodisk объем занятого места, может потребоваться tooreduce hello число хранимых моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="3960b-382">As you respond toodisk space consumption, you might want tooreduce hello number of stored snapshots.</span></span> <span data-ttu-id="3960b-383">простой способ Hello tooreduce hello количество моментальных снимков — toorun hello скрипт с hello последнего параметра set too5:</span><span class="sxs-lookup"><span data-stu-id="3960b-383">hello easy way tooreduce hello number of snapshots is toorun hello script with hello last parameter set too5:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 5
```
<span data-ttu-id="3960b-384">В результате выполняемого сценария hello с этим параметром, hello количество моментальных снимков, включая hello новое хранилище моментальных снимков, — _5_.</span><span class="sxs-lookup"><span data-stu-id="3960b-384">As a result of running hello script with this setting, hello number of snapshots, including hello new storage snapshot, is _5_.</span></span>

 >[!NOTE]
 > <span data-ttu-id="3960b-385">Этот сценарий сокращает hello количество моментальных снимков только в том случае, если последние предыдущего снимка hello более одного часа назад.</span><span class="sxs-lookup"><span data-stu-id="3960b-385">This script reduces hello number of snapshots only if hello most recent previous snapshot is more than one hour old.</span></span> <span data-ttu-id="3960b-386">сценарий Hello моментальных снимков, меньше, чем один час старый не удаляется.</span><span class="sxs-lookup"><span data-stu-id="3960b-386">hello script does not delete snapshots that are less than one hour old.</span></span>

<span data-ttu-id="3960b-387">Эти ограничения не toohello связанных необязательное аварийного восстановления возможности, предоставляемые.</span><span class="sxs-lookup"><span data-stu-id="3960b-387">These restrictions are related toohello optional disaster-recovery functionality offered.</span></span>

<span data-ttu-id="3960b-388">Если вы больше не требуется toomaintain набора моментальных снимков с этим префиксом, можно выполнить сценарий hello с _0_ как hello хранения номер tooremove все моментальные снимки, соответствующие этим префиксом.</span><span class="sxs-lookup"><span data-stu-id="3960b-388">If you no longer want toomaintain a set of snapshots with that prefix, you can execute hello script with _0_ as hello retention number tooremove all snapshots matching that prefix.</span></span> <span data-ttu-id="3960b-389">Тем не менее удаление всех моментальных снимков может повлиять на возможности hello аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="3960b-389">However, removing all snapshots can affect hello capabilities of disaster recovery.</span></span>

### <a name="recovering-toohello-most-recent-hana-snapshot"></a><span data-ttu-id="3960b-390">Восстановление toohello самый последний моментальный снимок HANA</span><span class="sxs-lookup"><span data-stu-id="3960b-390">Recovering toohello most recent HANA snapshot</span></span>

<span data-ttu-id="3960b-391">В событии hello возникают сценарии производства раскрывающегося списка, hello процесс восстановления из хранилища моментального снимка может быть инициировано как с инцидентом клиента с SAP HANA на управления службами Azure.</span><span class="sxs-lookup"><span data-stu-id="3960b-391">In hello event that you experience a production-down scenario, hello process of recovering from a storage snapshot can be initiated as a customer incident with SAP HANA on Azure Service Management.</span></span> <span data-ttu-id="3960b-392">Непредвиденная сценарий может быть предметом высокий уровень срочности рабочей системы и hello единственным способом tooretrieve hello данных равен toorestore hello рабочей базы данных было потеряно.</span><span class="sxs-lookup"><span data-stu-id="3960b-392">Such an unexpected scenario might be a high-urgency matter if data was deleted in a production system and hello only way tooretrieve hello data is toorestore hello production database.</span></span>

<span data-ttu-id="3960b-393">На hello другой стороны, восстановление на момент может быть низким срочность и планируется дней.</span><span class="sxs-lookup"><span data-stu-id="3960b-393">On hello other hand, a point-in-time recovery could be low urgency and planned for days in advance.</span></span> <span data-ttu-id="3960b-394">Чтобы спланировать восстановление, можно обратиться в отдел по управлению службами SAP HANA в Azure и поднять высокоприоритетные вопросы.</span><span class="sxs-lookup"><span data-stu-id="3960b-394">You can plan this recovery with SAP HANA on Azure Service Management instead of raising a high-priority issue.</span></span> <span data-ttu-id="3960b-395">Например может планирования tootry обновление hello по SAP, применяя новый пакет расширения и затем toorevert создать резервные tooa моментальный снимок, который представляет состояние hello перед обновлением hello EHP.</span><span class="sxs-lookup"><span data-stu-id="3960b-395">For example, you might be planning tootry an upgrade of hello SAP software by applying a new enhancement package, and you then need toorevert back tooa snapshot that represents hello state before hello EHP upgrade.</span></span>

<span data-ttu-id="3960b-396">Перед выполнением инструкции запроса hello, toodo требуется некоторая подготовка.</span><span class="sxs-lookup"><span data-stu-id="3960b-396">Before you issue hello request, you need toodo some preparation.</span></span> <span data-ttu-id="3960b-397">SAP HANA команды управления службами Azure можно обработать запрос hello и предоставить hello восстановления тома.</span><span class="sxs-lookup"><span data-stu-id="3960b-397">SAP HANA on Azure Service Management team can then handle hello request and provide hello restored volumes.</span></span> <span data-ttu-id="3960b-398">После этого — базу данных tooyou toorestore hello HANA основанные на моментальных снимках hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-398">Afterward, it is up tooyou toorestore hello HANA database based on hello snapshots.</span></span> <span data-ttu-id="3960b-399">Вот способ запроса tooprepare для hello:</span><span class="sxs-lookup"><span data-stu-id="3960b-399">Here is how tooprepare for hello request:</span></span>

>[!NOTE]
><span data-ttu-id="3960b-400">Пользовательский интерфейс может отличаться от hello следующие снимки экрана, в зависимости от выпуска SAP HANA, которую вы используете hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-400">Your user interface might vary from hello following screenshots, depending on hello SAP HANA release you are using.</span></span>

1. <span data-ttu-id="3960b-401">Решите, какие toorestore моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-401">Decide which snapshot toorestore.</span></span> <span data-ttu-id="3960b-402">Если будет предложено, в противном случае нужно восстановить только тома данных hana или hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-402">Only hello hana/data volume would be restored unless you are instructed otherwise.</span></span>

2. <span data-ttu-id="3960b-403">Завершите работу экземпляра HANA hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-403">Shut down hello HANA instance.</span></span>

 ![Завершить работу экземпляра HANA hello](./media/hana-overview-high-availability-disaster-recovery/image7-shutdown-hana.png)

3. <span data-ttu-id="3960b-405">Отключите hello тома данных на каждом узле базы данных HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-405">Unmount hello data volumes on each HANA database node.</span></span> <span data-ttu-id="3960b-406">Восстановление Hello hello моментального снимка завершается сбоем, если объемы данных hello не отключены.</span><span class="sxs-lookup"><span data-stu-id="3960b-406">hello restoration of hello snapshot fails if hello data volumes are not unmounted.</span></span>

 ![Отключить hello тома данных на каждом узле базы данных HANA](./media/hana-overview-high-availability-disaster-recovery/image8-unmount-data-volumes.png)

4. <span data-ttu-id="3960b-408">Откройте tooinstruct hello Azure поддержки запроса восстановления определенного моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-408">Open an Azure support request tooinstruct hello restoration of a specific snapshot.</span></span>

 - <span data-ttu-id="3960b-409">Во время восстановления hello: SAP HANA на управление службой Azure может запросить tooattend tooensure конференции, который потерь данных нет.</span><span class="sxs-lookup"><span data-stu-id="3960b-409">During hello restoration: SAP HANA on Azure Service Management might ask you tooattend a conference call tooensure that no data is getting lost.</span></span>

 - <span data-ttu-id="3960b-410">После восстановления hello: SAP HANA на управления службами Azure уведомляет о восстановления моментального снимка хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-410">After hello restoration: SAP HANA on Azure Service Management notifies you when hello storage snapshot has been restored.</span></span>

5. <span data-ttu-id="3960b-411">После завершения процесса восстановления hello, подключите томов с данными.</span><span class="sxs-lookup"><span data-stu-id="3960b-411">After hello restoration process is complete, remount all data volumes.</span></span>

 ![Подключение всех томов данных](./media/hana-overview-high-availability-disaster-recovery/image9-remount-data-volumes.png)

6. <span data-ttu-id="3960b-413">Выберите параметры восстановления среды SAP HANA Studio, если они не загружается автоматически при следующем подключении tooHANA DB через SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="3960b-413">Select recovery options within SAP HANA Studio, if they do not automatically come up when you reconnect tooHANA DB through SAP HANA Studio.</span></span> <span data-ttu-id="3960b-414">Hello следующем примере показано восстановление toohello последнего HANA моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-414">hello following example shows a restoration toohello last HANA snapshot.</span></span> <span data-ttu-id="3960b-415">Хранилище моментального снимка внедряет один HANA моментального снимка, и если вы восстанавливаете toohello самый последний моментальный снимок хранилища, он должен быть hello самый последний моментальный снимок HANA.</span><span class="sxs-lookup"><span data-stu-id="3960b-415">A storage snapshot embeds one HANA snapshot, and if you are restoring toohello most recent storage snapshot, it should be hello most recent HANA snapshot.</span></span> <span data-ttu-id="3960b-416">(Если вы восстанавливаете tooolder моментальные снимки хранилища, необходимо toolocate hello HANA на основе моментального снимка для хранения hello время hello снимка.)</span><span class="sxs-lookup"><span data-stu-id="3960b-416">(If you are restoring tooolder storage snapshots, you need toolocate hello HANA snapshot based on hello time hello storage snapshot was taken.)</span></span>

 ![Выбор параметров восстановления в SAP HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image10-recover-options-a.png)

7. <span data-ttu-id="3960b-418">Выберите **восстановить hello tooa определенные данные резервного копирования или хранения моментальный снимок базы данных**.</span><span class="sxs-lookup"><span data-stu-id="3960b-418">Select **Recover hello database tooa specific data backup or storage snapshot**.</span></span>

 ![окно «Укажите параметры восстановления» Hello](./media/hana-overview-high-availability-disaster-recovery/image11-recover-options-b.png)

8. <span data-ttu-id="3960b-420">Установите переключатель **Specify backup without catalog** (Указать резервную копию без каталога).</span><span class="sxs-lookup"><span data-stu-id="3960b-420">Select **Specify backup without catalog**.</span></span>

 ![окно «Укажите расположение резервной копии» Hello](./media/hana-overview-high-availability-disaster-recovery/image12-recover-options-c.png)

9. <span data-ttu-id="3960b-422">В hello **конечный тип** выберите **моментального снимка**.</span><span class="sxs-lookup"><span data-stu-id="3960b-422">In hello **Destination Type** list, select **Snapshot**.</span></span>

 ![окно «TooRecover резервного копирования укажите hello» Hello](./media/hana-overview-high-availability-disaster-recovery/image13-recover-options-d.png)

10. <span data-ttu-id="3960b-424">Нажмите кнопку **Готово** процесса восстановления toostart hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-424">Click **Finish** toostart hello recovery process.</span></span>

 ![Нажмите кнопку «Готово», процесс восстановления toostart hello](./media/hana-overview-high-availability-disaster-recovery/image14-recover-options-e.png)

11. <span data-ttu-id="3960b-426">База данных HANA Hello восстановлении и восстановлении HANA toohello моментальный снимок, который включается в моментальный снимок хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-426">hello HANA database is restored and recovered toohello HANA snapshot that's included in hello storage snapshot.</span></span>

 ![База данных HANA является снимком восстановлена и восстановленные toohello HANA](./media/hana-overview-high-availability-disaster-recovery/image15-recover-options-f.png)

### <a name="recovering-toohello-most-recent-state"></a><span data-ttu-id="3960b-428">Состояние последней toohello восстановления</span><span class="sxs-lookup"><span data-stu-id="3960b-428">Recovering toohello most recent state</span></span>

<span data-ttu-id="3960b-429">Hello следующий процесс восстанавливает HANA hello моментальный снимок, который включается в моментальный снимок хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-429">hello following process restores hello HANA snapshot that is included in hello storage snapshot.</span></span> <span data-ttu-id="3960b-430">Он затем восстанавливает hello транзакции журнала резервных копий toohello последних состояние hello базы данных перед восстановлением моментального снимка хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-430">It then restores hello transaction log backups toohello most recent state of hello database before restoring hello storage snapshot.</span></span>

>[!IMPORTANT]
><span data-ttu-id="3960b-431">Прежде чем продолжить, завершите создание цепочки последовательных резервных копий журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="3960b-431">Before you proceed, make sure that you have a complete and contiguous chain of transaction log backups.</span></span> <span data-ttu-id="3960b-432">Без этих резервных копий нельзя будет восстановить hello текущим состоянием базы данных hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-432">Without these backups, you cannot restore hello current state of hello database.</span></span>

1. <span data-ttu-id="3960b-433">Выполните шаги 1-6 hello предшествующий процедура в «Recovering toohello последних HANA моментального снимка.»</span><span class="sxs-lookup"><span data-stu-id="3960b-433">Complete steps 1-6 of hello preceding procedure in "Recovering toohello most recent HANA snapshot."</span></span>

2. <span data-ttu-id="3960b-434">Выберите **восстановить состояние последней tooits базы данных hello**.</span><span class="sxs-lookup"><span data-stu-id="3960b-434">Select **Recover hello database tooits most recent state**.</span></span>

 ![Выберите «Восстановить состояние последней tooits базы данных hello»](./media/hana-overview-high-availability-disaster-recovery/image16-recover-database-a.png)

3. <span data-ttu-id="3960b-436">Укажите расположение hello hello самые последние HANA резервные копии журнала.</span><span class="sxs-lookup"><span data-stu-id="3960b-436">Specify hello location of hello most recent HANA log backups.</span></span> <span data-ttu-id="3960b-437">расположение Hello должно toocontain все резервные копии журналов HANA транзакции из самой последней состояния моментального снимка HANA toohello hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-437">hello location needs toocontain all HANA transaction log backups from hello HANA snapshot toohello most recent state.</span></span>

 ![Укажите расположение hello резервных копий журнала последней HANA hello](./media/hana-overview-high-availability-disaster-recovery/image17-recover-database-b.png)

4. <span data-ttu-id="3960b-439">Выберите резервную копию в качестве базы из базы данных, который hello toorecover.</span><span class="sxs-lookup"><span data-stu-id="3960b-439">Select a backup as a base from which toorecover hello database.</span></span> <span data-ttu-id="3960b-440">В нашем примере это HANA hello моментальный снимок, который был включен в моментальный снимок хранилища hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-440">In our example, this is hello HANA snapshot that was included in hello storage snapshot.</span></span> <span data-ttu-id="3960b-441">(Только один моментальный снимок присутствует в следующий снимок экрана приветствия).</span><span class="sxs-lookup"><span data-stu-id="3960b-441">(Only one snapshot is listed in hello following screenshot.)</span></span>

 ![Выберите резервную копию в качестве базы из базы данных, который hello toorecover](./media/hana-overview-high-availability-disaster-recovery/image18-recover-database-c.png)

5. <span data-ttu-id="3960b-443">Очистить hello **резервные копии используются разностные** флажок, если разности между временем hello моментального снимка HANA hello и последнее состояние hello не существуют.</span><span class="sxs-lookup"><span data-stu-id="3960b-443">Clear hello **Use Delta Backups** check box if deltas do not exist between hello time of hello HANA snapshot and hello most recent state.</span></span>

 ![Очистить hello «Разностные резервные копии используются» флажок, если дельты не существует](./media/hana-overview-high-availability-disaster-recovery/image19-recover-database-d.png)

6. <span data-ttu-id="3960b-445">На экране сводки hello, нажмите кнопку **Готово** процедуры восстановления toostart hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-445">On hello summary screen, click **Finish** toostart hello restoration procedure.</span></span>

 ![В итоговом окне приветствия нажмите кнопку «Готово»](./media/hana-overview-high-availability-disaster-recovery/image20-recover-database-e.png)

### <a name="recovering-tooanother-point-in-time"></a><span data-ttu-id="3960b-447">Восстановление tooanother моменту времени</span><span class="sxs-lookup"><span data-stu-id="3960b-447">Recovering tooanother point in time</span></span>
<span data-ttu-id="3960b-448">toorecover tooa точки во времени между и hello моментального снимка HANA (включен в моментальный снимок hello хранилища), которая является более поздней, чем восстановления на момент снимка hello HANA hello следующие:</span><span class="sxs-lookup"><span data-stu-id="3960b-448">toorecover tooa point in time between hello HANA snapshot (included in hello storage snapshot) and one that is later than hello HANA snapshot point-in-time recovery, do hello following:</span></span>

1. <span data-ttu-id="3960b-449">Убедитесь, что все резервные копии журналов транзакций из требуется toorecover toohello время hello HANA моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-449">Make sure that you have all transaction log backups from hello HANA snapshot toohello time you want toorecover.</span></span>
2. <span data-ttu-id="3960b-450">Начать процедуру hello в разделе «Toohello последних состоянии Recovering.»</span><span class="sxs-lookup"><span data-stu-id="3960b-450">Begin hello procedure under "Recovering toohello most recent state."</span></span>
3. <span data-ttu-id="3960b-451">На шаге 2 процедуры hello hello **укажите параметры восстановления** выберите **восстановить hello базы данных toohello следующий момент времени**, укажите hello момент времени, а затем завершите шаги 3 – 6.</span><span class="sxs-lookup"><span data-stu-id="3960b-451">In step 2 of hello procedure, in hello **Specify Recovery Type** window, select **Recover hello database toohello following point in time**, specify hello point in time, and then complete steps 3-6.</span></span>

## <a name="monitoring-hello-execution-of-snapshots"></a><span data-ttu-id="3960b-452">Мониторинг выполнения hello моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="3960b-452">Monitoring hello execution of snapshots</span></span>

<span data-ttu-id="3960b-453">Требуется выполнение hello toomonitor хранилища моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="3960b-453">You need toomonitor hello execution of storage snapshots.</span></span> <span data-ttu-id="3960b-454">Записывает выходной файл tooa Hello скрипта, исполняющего хранилища моментального снимка, а затем сохраняет его toohello местоположения скриптами Perl hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-454">hello script that executes a storage snapshot writes output tooa file and then saves it toohello same location as hello Perl scripts.</span></span> <span data-ttu-id="3960b-455">Для каждого моментального снимка создается отдельный файл.</span><span class="sxs-lookup"><span data-stu-id="3960b-455">A separate file is written for each snapshot.</span></span> <span data-ttu-id="3960b-456">Hello каждого файла четко видно hello различных этапов, которые выполняет скрипт hello моментального снимка:</span><span class="sxs-lookup"><span data-stu-id="3960b-456">hello output of each file clearly shows hello various phases that hello snapshot script executes:</span></span>

- <span data-ttu-id="3960b-457">Поиск hello тома, которые требуется toocreate моментального снимка</span><span class="sxs-lookup"><span data-stu-id="3960b-457">Finding hello volumes that need toocreate a snapshot</span></span>
- <span data-ttu-id="3960b-458">Поиск hello моментальных снимков берется из этих томов</span><span class="sxs-lookup"><span data-stu-id="3960b-458">Finding hello snapshots taken from these volumes</span></span>
- <span data-ttu-id="3960b-459">Удаление окончательной существующие моментальные снимки toomatch hello количество моментальных снимков, указываемой</span><span class="sxs-lookup"><span data-stu-id="3960b-459">Deleting eventual existing snapshots toomatch hello number of snapshots you specified</span></span>
- <span data-ttu-id="3960b-460">создание моментального снимка HANA;</span><span class="sxs-lookup"><span data-stu-id="3960b-460">Creating a HANA snapshot</span></span>
- <span data-ttu-id="3960b-461">Создание моментального снимка хранилища hello по томам hello</span><span class="sxs-lookup"><span data-stu-id="3960b-461">Creating hello storage snapshot over hello volumes</span></span>
- <span data-ttu-id="3960b-462">Удаление снимка HANA hello</span><span class="sxs-lookup"><span data-stu-id="3960b-462">Deleting hello HANA snapshot</span></span>
- <span data-ttu-id="3960b-463">Переименование hello последних моментальный снимок слишком**.0**</span><span class="sxs-lookup"><span data-stu-id="3960b-463">Renaming hello most recent snapshot too**.0**</span></span>

<span data-ttu-id="3960b-464">Наиболее важной частью сценария hello Hello такова:</span><span class="sxs-lookup"><span data-stu-id="3960b-464">hello most important part of hello script is this:</span></span>
```
**********************Creating HANA snapshot**********************
Creating hello HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data create snapshot"" ...
HANA snapshot created successfully.
**********************Creating Storage snapshot**********************
Taking snapshot hourly.recent for hana_data_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_backup_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_shared_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for sapmnt_lhanad01_t020_vol ...
Snapshot created successfully.
**********************Deleting HANA snapshot**********************
Deleting hello HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data drop snapshot"" ...
HANA snapshot deletion successfully.
```
<span data-ttu-id="3960b-465">Из этого образца можно увидеть, как записи скрипта hello hello создания моментального снимка HANA hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-465">You can see from this sample how hello script records hello creation of hello HANA snapshot.</span></span> <span data-ttu-id="3960b-466">В случае масштабного hello этот процесс запущен на главном узле hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-466">In hello scale-out case, this process is initiated on hello master node.</span></span> <span data-ttu-id="3960b-467">главный узел Hello инициирует hello синхронной создание моментальных снимков hello на всех рабочих узлов hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-467">hello master node initiates hello synchronous creation of hello snapshots on each of hello worker nodes.</span></span> <span data-ttu-id="3960b-468">Затем hello хранилища моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="3960b-468">Then hello storage snapshot is taken.</span></span> <span data-ttu-id="3960b-469">После ее успешного выполнения hello моментальных снимков hello хранилища удаление снимка HANA hello.</span><span class="sxs-lookup"><span data-stu-id="3960b-469">After hello successful execution of hello storage snapshots, hello HANA snapshot is deleted.</span></span>
