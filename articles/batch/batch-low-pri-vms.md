---
title: "рабочие нагрузки пакетной службы Azure aaaRun на виртуальных машинах экономичное низким приоритетом (Предварительная версия) | Документы Microsoft"
description: "Узнайте, как виртуальные машины tooreduce tooprovision низкоприоритетных hello стоимости рабочих нагрузок пакетной службы Azure."
services: batch
author: mscurrell
manager: timlt
ms.assetid: dc6ba151-1718-468a-b455-2da549225ab2
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.workload: na
ms.date: 07/21/2017
ms.author: markscu
ms.openlocfilehash: 91a5e89a819d05583e6b146932d925e217b4be4e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="use-low-priority-vms-with-batch-preview"></a>Использование низкоприоритетных виртуальных машин в пакетной службе (предварительная версия)

Пакетная служба Azure предлагает стоимость hello tooreduce low приоритету виртуальных машин (ВМ) пакета рабочих нагрузок. Виртуальные машины с низким приоритетом позволяют использовать новые типы рабочих нагрузок пакетной службы, предоставляя большой объем вычислительных ресурсов по доступной цене.

Низкоприоритетные виртуальные машины используют избыточные ресурсы в Azure. При указании низкоприоритетных виртуальных машин в пулах пакетная служба Azure может автоматически использовать этот избыток при его наличии.

Hello платой за использование виртуальных машин с низким приоритетом —, когда нет излишком доступен в Azure может возможность прерывания этих виртуальных машин. Именно поэтому низкоприоритетные виртуальные машины лучше всего подходят для определенных типов рабочих нагрузок. Используйте виртуальные машины с низким приоритетом для пакета и асинхронной обработки рабочих нагрузок, где время выполнения задания hello гибок и hello работа распределяется между много виртуальных машин.

Низкоприоритетные виртуальные машины значительно дешевле выделенных аналогов. Сведения о ценах на пакетную службу см. [здесь](https://azure.microsoft.com/pricing/details/batch/).

Дополнительные сведения по виртуальные машины с низким приоритетом, в разделе hello объявлении в блоге: [пакета вычислений в малую долю цена hello](https://azure.microsoft.com/blog/announcing-public-preview-of-azure-batch-low-priority-vms/).

> [!IMPORTANT]
> Сейчас низкоприоритетные виртуальные машины доступны в предварительной версии для рабочих нагрузок, выполняющихся в пакетной службе. 
>
>

## <a name="use-cases-for-low-priority-vms"></a>Варианты использования низкоприоритетных виртуальных машин

Имея hello характеристики виртуальные машины с низким приоритетом, какие рабочие нагрузки можно и их нельзя использовать? Как правило, это рабочие нагрузки пакетной обработки, так как задания разбиваются на несколько параллельных задач или развертываются и распределяются по нескольким виртуальным машинам.

-   Использование toomaximize излишком в Azure, подходящий заданий можно масштабировать.

-   Иногда виртуальные машины могут быть недоступны или будет невозможно заместить, который приведет к ограниченной емкости для задания и может вызвать прерывание tootask и повторов. Задания, поэтому должно быть гибкие hello времени, которые они могут предпринять toorun.

-   Прерывание заданий с более продолжительными задачами может привести к более серьезным последствиям. Если длительные задачи реализуют выполняется toosave контрольные точки, как они выполняются, то влияние прерывания будет гораздо меньше. Задачи с более короткий интервал выполнения лучше всего обычно toowork с низким приоритетом виртуальные машины как влияние hello прерывания гораздо меньше.

-   Длительные заданий MPI, использующих несколько виртуальных машин не подходит toouse низкоприоритетных виртуальных машинах с одной виртуальной Машины внеочередного выполнения будет все наличие toobe снова запустите задание toohello скорее всего, руководитель.

Некоторые примеры пакетной обработки используйте toouse хорошо подходит случаев являются виртуальные машины с низким приоритетом.

-   **Разработка и тестирование.** При разработке крупномасштабных решений, в частности, можно существенно сэкономить средства. Преимущества доступны для всех видов тестирования, но лучше всего подходит крупномасштабное нагрузочное тестирование и тестирование регрессии.

-   **Добавление емкости по требованию**: виртуальные машины с низким приоритетом можно использовать в дополнение regular выделенных виртуальных машин — если она доступна, масштабировать и поэтому быстрее выполнить более низкую стоимость заданий; при недоступна, hello базового плана выделенных виртуальных машин доступны.

-   **Время выполнения задания гибкие**: если задания таймера hello гибкость имеют toocomplete, а затем вероятностью падения емкости можно допустимое; тем не менее, с hello добавления задания низкого приоритета виртуальные машины будут часто выполняются быстрее и более низкую стоимость.

Пулы пакета может быть настроенный toouse времени выполнения задания низкого приоритета виртуальных машин несколькими способами в зависимости от hello гибкость в:

-   Виртуальные машины с низким приоритетом можно использовать только в пуле. При этом пакетная служба будет просто восстанавливать замещенные ресурсы, когда они станут доступными. Это hello дешевые способом tooexecute заданий, которые используются только низкого приоритета виртуальных машин.

-   Низкоприоритетные виртуальные машины можно использовать в сочетании с фиксированными базовыми выделенными виртуальными машинами. Hello фиксированное число выделенных виртуальных машин гарантирует, что имеется всегда некоторые tookeep емкости хода работ.

-   Может существовать динамического набора виртуальных машин выделенным и низкого приоритета дешевле ВМ низкого приоритета используются только при наличии, но hello дорогими full выделенных виртуальных машин масштабируются при необходимости tookeep минимальный объем емкости доступных tookeep hello заданий выполняет.

## <a name="batch-support-for-low-priority-vms"></a>Поддержка пакетной службы для виртуальных машин с низким приоритетом

Пакет Azure предоставляет несколько возможностей, сделайте его легко tooconsume и использовать преимущества виртуальных машин с низким приоритетом.

-   Пулы пакетной службы могут содержать выделенные и низкоприоритетные виртуальные машины. Hello количество каждого типа ВМ можно указать при создании пула, или изменить в любое время для существующего пула, с помощью операции hello явного изменения размера или автоматическое масштабирование. Отправка заданий и задач может оставаться без изменений и не нужно беспокоиться hello типов ВМ в пуле hello. Это также возможно toohave пул полностью используйте низкого приоритета виртуальных машин toorun задания, но не раскрутки выделенных виртуальных машин экономно Если емкость hello падает ниже установленного порога, чтобы сохранить заданий, выполняемых.

-   Пулы пакета поиска автоматически toohello целевое количество виртуальных машин с низким приоритетом. Если прерывания виртуальные машины, пакет попытается hello tooreplace потерянных емкости и возврата toohello целевой.

-   В случае прерывания задач hello пакета обнаружит и автоматически повторной постановки в очередь снова запустите toobe задачи.

-   Низкоприоритетные виртуальные машины имеют квоту ядер, которая отличается от квоты выделенных виртуальных машин. 
    Hello квоты для виртуальных машин с низким приоритетом выше, чем выделенных виртуальных машин, так как виртуальные машины с низким приоритетом снижение расходов. Дополнительные сведения см. в статье [Квоты и ограничения пакетной службы](batch-quota-limit.md#resource-quotas).    

> [!NOTE]
> Виртуальные машины с низким приоритетом не поддерживаются для массовых учетных записей, где режим распределения пула hello установлено слишком[подписки пользователя](batch-account-create-portal.md#user-subscription-mode).
>
>

## <a name="create-and-update-pools"></a>Создание и обновление пулов

Пул пакет может содержать выделенным и низкого приоритета виртуальных машин (также назывались tooas вычислительных узлов). Можно задать hello целевое количество вычислительных узлов для виртуальных машин, выделенных и низким приоритетом. Hello целевое количество узлов номер hello виртуальных машин требуется toohave в пуле hello.

Например toocreate пул с помощью облачной службы Azure виртуальные машины с целью 5 выделенных виртуальных машин и 20 виртуальных машин с низким приоритетом:

```csharp
CloudPool pool = batchClient.PoolOperations.CreatePool(
    poolId: "cspool",
    targetDedicatedComputeNodes: 5,
    targetLowPriorityComputeNodes: 20,
    virtualMachineSize: "Standard_D2_v2",
    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "4") // WS 2012 R2
);
```

toocreate пул с помощью виртуальных машин Azure (в данном случае виртуальных машин Linux) с целью 5 выделенных виртуальных машин и 20 виртуальных машин с низким приоритетом:

```csharp
ImageReference imageRef = new ImageReference(
    publisher: "Canonical",
    offer: "UbuntuServer",
    sku: "16.04.0-LTS",
    version: "latest");

// Create hello pool
VirtualMachineConfiguration virtualMachineConfiguration =
    new VirtualMachineConfiguration("batch.node.ubuntu 16.04", imageRef);

pool = batchClient.PoolOperations.CreatePool(
    poolId: "vmpool",
    targetDedicatedComputeNodes: 5,
    targetLowPriorityComputeNodes: 20,
    virtualMachineSize: "Standard\_D2\_v2",
    virtualMachineConfiguration: virtualMachineConfiguration);
```

Можно получить hello текущее число узлов для виртуальных машин, выделенных и низким приоритетом:

```csharp
int? numDedicated = pool1.CurrentDedicatedComputeNodes;
int? numLowPri = pool1.CurrentLowPriorityComputeNodes;
```

Пул узлы имеют tooindicate свойства, если узел hello выделенными и низкого приоритета виртуальной Машины:

```csharp
bool? isNodeDedicated = poolNode.IsDedicated;
```

Задать прерывания один или несколько узлов в пуле, операция списка узлов в пуле по-прежнему будет возвращать те узлы, текущее число узлов низкого приоритета для hello не изменится, однако эти узлы будут иметь свое состояние toothe **замещена**состояние. Пакет попытается замены toofind виртуальные машины, и в случае успешного выполнения hello узлы будут проходить через **создание** и затем **запуск** состояния перед тем как стать доступными для выполнения задач, так же, как новые узлы.

## <a name="scale-a-pool-containing-low-priority-vms"></a>Масштабирование пула низкоприоритетных виртуальных машин

С помощью пулы, состоящей исключительно выделенных виртуальных машин, это возможных tooscale пула содержащего низкоприоритетных виртуальных машин путем вызова метода hello изменения размера или с помощью автоматического масштабирования.

Hello операция изменения размера пула принимает второй необязательный параметр, который обновляет значение **targetLowPriorityNodes**:

```csharp
pool.Resize(targetDedicatedComputeNodes: 0, targetLowPriorityComputeNodes: 25);
```

Формула автоматического масштабирования пула Hello поддерживает виртуальные машины с низким приоритетом следующим образом:

-   Можно получить или задать значение hello переменной определяемого пользователем службы hello **$TargetLowPriorityNodes**.

-   Можно получить hello значения переменной определяемого пользователем службы hello **$CurrentLowPriorityNodes**.

-   Можно получить hello значения переменной определяемого пользователем службы hello **$PreemptedNodeCount**. 
    Эта переменная возвращает hello количество узлов в hello различные состояния и дает возможность масштабирования вверх или вниз hello количество выделенных узлов, в зависимости от числа hello прерванный узлов, которые недоступны.

## <a name="jobs-and-tasks"></a>Задания и задачи

Заданий и задач требуется поддержка очень мало низкоприоритетных узлов; поддерживают только Hello выглядит следующим образом:

-   Hello JobManagerTask свойства задания имеет новое свойство, **AllowLowPriorityNode**. 
    Если это свойство имеет значение true, задача диспетчера заданий hello могут быть назначены на выделенном или низким приоритетом узла. Если это свойство имеет значение false, hello задачи диспетчера заданий будет запланированных tooa только выделенный узел.

-   [Переменной среды](batch-compute-node-environment-variables.md) является приложение tooa доступных задач, чтобы он мог определить, выполняется ли он на узле с низким приоритетом или выделенный. переменная среды Hello — AZ_BATCH_NODE_IS_DEDICATED.

## <a name="handling-preemption"></a>Обработка замещения

Иногда может быть высвобождены виртуальных машин; в этом случае пакет hello следующие:

-   Hello прерванный виртуальные машины имели свое состояние, также обновляются**замещена**.
-   Если задачи выполнялись на hello высвобождены ВМ узлов, а затем повторно поставлен в очередь и снова запустите эти задачи.
-   фактически удаляется Hello виртуальной Машины, начальные tooany данные, хранящиеся локально на hello потерю виртуальной Машины.
-   пул Hello постоянно предпринимает tooreach hello целевое количество доступных узлов низким приоритетом. При обнаружении замены идентификаторы узлов сохраняются, но узлы повторно инициализируются и их состояние меняется на **Создание** и **Запуск** перед тем, как они станут доступными для планирования задач.
-   Замещение счетчики доступны как показатель в hello портал Azure.

## <a name="metrics"></a>Метрики

Доступны новые метрики в hello [портал Azure](https://portal.azure.com) для узлов с низким приоритетом. Это такие метрики:

- Low-Priority Node Count
- Low-Priority Core Count; 
- Preempted Node Count

метрики tooview в hello портал Azure.

1. Перейти tooyour пакетной учетной записи на портале hello и открыть параметры hello пакетной учетной записи.
2. Выберите **метрики** из hello **мониторинг** раздела.
3. Выберите метрики hello нужен hello **доступные метрики** списка.

![Метрики для узлов с низким приоритетом](media/batch-low-pri-vms/low-pri-metrics.png)

## <a name="next-steps"></a>Дальнейшие действия

* Чтение hello [пакета Обзор возможностей для разработчиков](batch-api-basics.md), важные сведения для тех, кто Подготовка toouse пакета. Hello статья содержит более подробные сведения о пакете службы ресурсы, такие как пулы, узлы, заданий и задач и hello множество функций API, которые можно использовать при создании пакета приложения.
* Дополнительные сведения о hello [API-интерфейсы пакета и средства](batch-apis-tools.md) для сборки пакета решения.
