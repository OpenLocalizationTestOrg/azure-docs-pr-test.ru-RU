---
title: "aaaAutomatically масштабирование вычислительных узлов в пуле пакетной службы Azure | Документы Microsoft"
description: "Включение автоматического масштабирования облака пула toodynamically настроить hello количество вычислительных узлов в пуле hello."
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: tysonn
ms.assetid: c624cdfc-c5f2-4d13-a7d7-ae080833b779
ms.service: batch
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: multiple
ms.date: 06/20/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: b6d1e0c5d8e0e56e15a4d3588150f2466a689f19
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="create-an-automatic-scaling-formula-for-scaling-compute-nodes-in-a-batch-pool"></a>Создание формулы автоматического масштабирования для масштабирования вычислительных узлов в пуле пакетной службы

Пакетная служба Azure может автоматически масштабировать пулы в зависимости от определенных вами параметров. При автоматическом масштабировании пакета динамически добавляет пул tooa узлов в качестве задачи роста потребностей и удаляет вычислительных узлов, которые снижают. С помощью автоматической регулировки hello количество вычислительных узлов, используемых приложением пакета можно сохранить времени и денег. 

Чтобы включить автоматическое масштабирование для пула вычислительных узлов, определите и установите для него *формулу автомасштабирования*. Hello пакетная служба использует hello автомасштабирования формулы toodetermine hello количество вычислительных узлов, которые являются необходимые tooexecute рабочей нагрузки. Вычислительные узлы могут быть выделенными узлами или [узлами с низким приоритетом](batch-low-pri-vms.md). Пакет отвечает tooservice периодически собираемые данные метрик. Используя эти данные метрик, пакет корректирует hello количество вычислительных узлов в пуле hello на основе формулы и с заданным интервалом.

Автоматическое масштабирование можно включить во время создания пула или для существующего пула. Также можно изменить назначенную формулу для пула с настроенным автоматическим масштабированием. Пакет включает tooevaluate выполняется формулы перед назначением их состояние hello toopools и toomonitor автоматического масштабирования.

В этой статье описывается hello различных сущностей, которые составляют формулы автоматического масштабирования, включая переменные, операторы, операций и функций. Рассматриваются как tooobtain различных вычислений метрики ресурсов и задачи в пакете. Можно использовать эти tooadjust показатели вашей пула количество узлов на основе ресурсов об использовании и задача состояния. Затем рассматривается как tooconstruct формулу и включение автоматического масштабирования в пуле с помощью обоих hello пакета REST и API-интерфейсы .NET. Наконец, мы рассмотрим несколько примеров формул.

> [!IMPORTANT]
> Можно указать при создании учетной записи пакетной hello [настройки учетной записи](batch-api-basics.md#account), которое определяет, выделяются ли пулов в пакетной службы подписки (по умолчанию hello) или в вашей подписке пользователя. При создании учетной записи пакетного hello конфигурации по умолчанию служба Batch, ваша учетная запись является ограниченной tooa максимальное количество ядер, которые могут использоваться для обработки. Hello пакетная служба масштабирует вычислительные узлы только копирование предельное toothat ядер. По этой причине hello пакетная служба не может достичь hello целевое количество вычислительных узлов, указанные в формуле автоматического масштабирования. В разделе [квоты и лимиты для пакетной службы Azure hello](batch-quota-limit.md) сведения о просмотре и увеличения квоты вашей учетной записи.
>
>Если была создана учетная запись с конфигурацией hello подписки пользователя, то ваша учетная запись в общие папки на hello основная квота для hello подписки. Дополнительные сведения см. в разделе [Ограничения виртуальных машин](../azure-subscription-service-limits.md#virtual-machines-limits) в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-subscription-service-limits.md).
>
>

## <a name="automatic-scaling-formulas"></a>Формулы автоматического масштабирования
Формула автоматического масштабирования представляет собой определяемое пользователем строковое значение, которое содержит один или несколько операторов. Формула автоматического масштабирования Hello назначается пула tooa [autoScaleFormula] [ rest_autoscaleformula] элемент (пакета REST) или [CloudPool.AutoScaleFormula] [ net_cloudpool_autoscaleformula] свойство (пакета .NET). Hello пакетная служба использует ваш формулы toodetermine hello целевое количество вычислительных узлов в пуле hello для следующего интервала обработки hello. формулы строка Hello не может превышать 8 КБ, могут включать копирование too100 инструкций, разделенных точкой с запятой и может содержать разрывы строк и комментарии.

Вы можете представить, что формулы автоматического масштабирования — это язык автомасштабирования пакетной службы. Формулы инструкции являются выражениями произвольной формы, которые могут содержать определенные службы переменными (определяется hello пакетная служба) и пользовательские переменные (переменные, которые указываются). С этими переменными могут выполняться различные операции с помощью встроенных типов, операторов и функций. Например оператор может принимать hello следующие формы:

```
$myNewVariable = function($ServiceDefinedVariable, $myCustomVariable);
```

Обычно формулы содержат несколько инструкций, выполняющих операции со значениями, полученными в предыдущих инструкциях. Например, сначала мы получаем значение для `variable1`, передать его функции toopopulate tooa `variable2`:

```
$variable1 = function1($ServiceDefinedVariable);
$variable2 = function2($OtherServiceDefinedVariable, $variable1);
```

Включите эти инструкции в tooarrive вашей формулы автоматического масштабирования, в целевое количество вычислительных узлов. Выделенные узлы и узлы с низким приоритетом имеют свои собственные целевые показатели, что позволяет определять целевое количество для каждого типа узла. Формула автомасштабирования может включать в себя целевое значение для выделенных узлов, целевое значение для узлов с низким приоритетом или и то, и другое.

Hello целевое количество узлов может быть выше, ниже или hello таким же, как hello текущее число узлов типа в пуле hello. Пакетная служба вычисляет формулу автомасштабирования пула с указанным интервалом (см. раздел, посвященный [интервалам автоматического масштабирования](#automatic-scaling-interval)). Пакет корректирует hello целевое количество каждого типа узла в hello пула toohello число, которое указывает формулы автоматического масштабирования во время hello оценки.

### <a name="sample-autoscale-formula"></a>Пример формулы автоматического масштабирования

Ниже приведен пример формулу автомасштабирования, которая может быть скорректированное toowork для большинства сценариев. Здравствуйте, переменные `startingNumberOfVMs` и `maxNumberofVMs` в hello формулы из примера может быть скорректированное tooyour потребностей. Эта формула масштабирует выделенных узлов, но может быть измененный tooapply tooscale также узлы низким приоритетом. 

```
startingNumberOfVMs = 1;
maxNumberofVMs = 25;
pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);
pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));
$TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
```

С помощью этой формулы автомасштабирования hello изначально создается пул с одной виртуальной Машины. Hello `$PendingTasks` метрика определяет hello число задач, которые запущены или в очереди. Формула Hello находит hello среднее число ожидающих задач в hello последние 180 секунд и задает hello `$TargetDedicatedNodes` переменной соответствующим образом. Формула Hello гарантирует, что hello целевое количество выделенных узлов никогда не превышает 25 виртуальных машин. Отправлены новые задачи, hello пул автоматически увеличивается. Как задачи завершения виртуальные машины станут свободного по одному и формулы автомасштабирования hello уменьшается hello пула.

## <a name="variables"></a>Переменные
В формуле автоматического масштабирования можно использовать как **служебные**, так и **пользовательские** переменные. переменные, определенные службы Hello строятся в toohello пакетной службы. Некоторые из них доступны для чтения и записи, а некоторые — только для чтения. Пользовательские переменные — это переменные, которые определяете вы. В hello формулы из примера показано в предыдущем разделе hello `$TargetDedicatedNodes` и `$PendingTasks` — это переменные, определенные службы. Переменные `startingNumberOfVMs` и `maxNumberofVMs` — это переменные, определяемые пользователем.

> [!NOTE]
> Служебные переменные всегда начинаются с символа доллара ($). Для определяемых пользователем переменных hello доллара является необязательным.
>
>

Hello следующие таблицы показывают и операции чтения записи и переменные только для чтения, которые определены в hello пакетной службы.

Можно получить и задать hello значения этих переменных, определяемых службы toomanage hello количество вычислительных узлов в пуле:

| Определяемые службой переменные для чтения и записи | Описание |
| --- | --- |
| $TargetDedicatedNodes |Hello целевое количество выделенных вычислительных узлов для пула hello. Hello количество выделенных узлов задается как целевой объект, поскольку пул может не всегда произойдет hello требуемого числа узлов. Например при изменении hello целевое количество выделенных узлов с ознакомительной версии до hello автомасштабирования пула достигнуто hello начального целевого объекта, а затем hello пула не могут достичь цели hello. <br /><br /> Пула в создании учетной записи с конфигурацией службы Batch hello может достичь своей цели не в том случае, если целевой hello превышает квоту на узел или core учетной записи пакета. Пул в создании учетной записи с конфигурацией hello подписки пользователя может достичь своей цели не в том случае, если целевой hello превышает квоту общее ядро hello для hello подписки.|
| $TargetLowPriorityNodes |Hello целевое количество низкоприоритетных вычислительных узлов для пула hello. Hello количество узлов низкоприоритетных задается как целевой объект, поскольку пул может не всегда произойдет hello требуемого числа узлов. Например hello целевое количество узлов с низким приоритетом при изменении по ознакомительной версии до hello автомасштабирования пула достигнуто hello начального целевого объекта, а затем hello пула не могут достичь цели hello. Пул также не добиться своей цели Если целевой hello превышает квоту на узел или core учетной записи пакета. <br /><br /> Дополнительные сведения о вычислительных узлах с низким приоритетом см. в статье [Использование низкоприоритетных виртуальных машин в пакетной службе (предварительная версия)](batch-low-pri-vms.md). |
| $NodeDeallocationOption |Действие Hello, которое возникает, когда вычислительные узлы удаляются из пула. Возможные значения:<ul><li>**повторной постановки в очередь**--немедленно прекращает задачи и помещает их обратно в очередь задания hello, чтобы они были заново запланированы.<li>**Завершение**--немедленно прекращает задачи и удаляет их из очереди заданий hello.<li>**taskcompletion**--ожидает, пока в настоящее время задачи toofinish и затем удаляет узел hello из пула hello.<li>**retaineddata**--ожидает все hello локальные задачи сохраняются данные на узел toobe hello очистки, перед удалением узла hello из пула hello.</ul> |

Можно получить значение hello корректировок toomake эти переменные, определенные службы, с учетом показателей hello пакетной службы:

| Определяемые службой переменные только для чтения | Описание |
| --- | --- |
| $CPUPercent |Hello средний процент использования ЦП. |
| $WallClockSeconds |число секунд потребляет Hello. |
| $MemoryBytes |Среднее число мегабайт используется Hello. |
| $DiskBytes |Среднее число гигабайт, используемых на локальных дисках hello Hello. |
| $DiskReadBytes |Hello число считанных байтов. |
| $DiskWriteBytes |Hello число записанных байтов. |
| $DiskReadOps |выполнить Hello число операций чтения с диска. |
| $DiskWriteOps |Количество операций записи диска Hello. |
| $NetworkInBytes |число входящих байтов Hello. |
| $NetworkOutBytes |число исходящих байтов Hello. |
| $SampleNodeCount |Hello количество вычислительных узлов. |
| $ActiveTasks |Hello число задач, которые являются tooexecute готовности, но еще не запущена. Hello $ActiveTasks счетчик учитывает все задачи, находящиеся в активном состоянии hello и которого зависимости были выполнены. Все задачи, находящихся в активном состоянии hello, но не удовлетворены, зависимости которого исключаются из hello $ActiveTasks count.|
| $RunningTasks |Hello число задач в состоянии выполнения. |
| $PendingTasks |Сумма Hello $ActiveTasks и $RunningTasks. |
| $SucceededTasks |Количество успешно завершенных задач Hello. |
| $FailedTasks |число задач, которые не удалось выполнить Hello. |
| $CurrentDedicatedNodes |Привет текущее количество выделенных вычислительных узлов. |
| $CurrentLowPriorityNodes |Текущее количество Hello низкоприоритетных вычислительных узлов, включая все узлы, которые были pre-empted. |
| $PreemptedNodeCount | количество узлов в пул hello, которые находятся в состоянии pre-empted Hello. |

> [!TIP]
> Hello только для чтения, определяемый службой переменные, указанные в предыдущей таблице hello, *объектов* различные методы, обеспечивающие tooaccess данные, связанные с каждым. Дополнительные сведения см. в разделе [Получение выборки данных](#getsampledata) далее в этой статье.
>
>

## <a name="types"></a>Типы
В формуле поддерживаются следующие типы:

* double
* doubleVec
* doubleVecList
* string
* Отметка времени — отметка времени расположена комплексной структуру, содержащую hello следующие члены:

  * year
  * month (1-12)
  * day (1-31)
  * день недели (в формате hello числа; например, 1 — понедельник)
  * hour (час в 24-часовом формате, например 13 соответствует 13:00)
  * minute (00–59)
  * second (00–59)
* timeInterval

  * TimeInterval_Zero
  * TimeInterval_100ns
  * TimeInterval_Microsecond
  * TimeInterval_Millisecond
  * TimeInterval_Second
  * TimeInterval_Minute
  * TimeInterval_Hour
  * TimeInterval_Day
  * TimeInterval_Week
  * TimeInterval_Year

## <a name="operations"></a>Операции
Эти операции допустимы для hello типов, перечисленных в предыдущем разделе hello.

| Операция | Поддерживаемые операторы | Тип результата |
| --- | --- | --- |
| double *оператор* double |+, -, *, / |double |
| double *оператор* timeinterval |* |timeInterval |
| doubleVec *оператор* double |+, -, *, / |doubleVec |
| doubleVec *оператор* doubleVec |+, -, *, / |doubleVec |
| timeinterval *оператор* double |*, / |timeInterval |
| timeinterval *оператор* timeinterval |+, - |timeInterval |
| timeinterval *оператор* timestamp |+ |timestamp |
| timestamp *оператор* timeinterval |+ |timestamp |
| timestamp *оператор* timestamp |- |timeInterval |
| *оператор*double |-, ! |double |
| *оператор*timeInterval |- |timeInterval |
| double *оператор* double |<, <=, ==, >=, >, != |double |
| string *оператор* string |<, <=, ==, >=, >, != |double |
| timestamp *оператор* timestamp |<, <=, ==, >=, >, != |double |
| timeinterval *оператор* timeinterval |<, <=, ==, >=, >, != |double |
| double *оператор* double |&&, &#124;&#124; |double |

При тестировании double с тернарным оператором (`double ? statement1 : statement2`) ненулевое значение равно **true**, а нулевое — **false**.

## <a name="functions"></a>Функции
Эти предопределенные **функции** доступны для toouse при определении формулы автоматического масштабирования.

| Функция | Тип возвращаемого значения | Описание |
| --- | --- | --- |
| avg(doubleVecList) |double |Возвращает hello среднее значение для всех значений в hello doubleVecList. |
| len(doubleVecList) |double |Возвращает hello длины hello вектора, созданного из hello doubleVecList. |
| lg(double) |double |Возвращает журнал hello основанию 2 от hello double. |
| lg(doubleVecList) |doubleVec |Возвращает базовый 2 hello doubleVecList hello component-wise журнала. Vec(double) должно быть явно передано для параметра hello. В противном случае подразумевается версия double lg(double) hello. |
| ln(double) |double |Возвращает hello натуральный логарифм hello double. |
| ln(doubleVecList) |doubleVec |Возвращает базовый 2 hello doubleVecList hello component-wise журнала. Vec(double) должно быть явно передано для параметра hello. В противном случае подразумевается версия double lg(double) hello. |
| log(double) |double |Возвращает журнал hello основание 10 hello double. |
| log(doubleVecList) |doubleVec |Возвращает основание 10 hello doubleVecList hello component-wise журнала. Vec(double) должно быть явно передано для единственного параметра double hello. В противном случае подразумевается версия double log(double) hello. |
| max(doubleVecList) |double |Возвращает hello максимальное значение в hello doubleVecList. |
| min(doubleVecList) |double |Возвращает hello минимальное значение в hello doubleVecList. |
| norm(doubleVecList) |double |Возвращает hello норма hello вектора, созданного из hello doubleVecList. |
| percentile(doubleVec v, double p) |double |Возвращает hello элемент percentile вектора hello v. |
| rand() |double |Возвращает случайное значение от 0,0 до 1,0. |
| range(doubleVecList) |double |Возвращает разность hello hello минимальным и максимальным значениями в hello doubleVecList. |
| std(doubleVecList) |double |Возвращает hello среднеквадратичное отклонение выборки для hello значений в hello doubleVecList. |
| stop() | |Остановка вычисления выражения автоматического масштабирования hello. |
| sum(doubleVecList) |double |Возвращает hello сумма всех компонентов hello doubleVecList hello. |
| time(string dateTime="") |Timestamp |Возвращает отметку времени hello hello текущее время, если параметры не передаются или hello отметку времени строка hello даты и времени, если он передается. Поддерживаемые форматы даты и времени: W3C-DTF и RFC 1123. |
| val(doubleVec v, double i) |double |Возвращает значение hello hello элемента, который находится в расположении i в векторе v с начальным индексом 0. |

Некоторые из функций hello, описанных в предыдущей таблице hello могут принимать список в качестве аргумента. Разделенный запятыми список Hello — это любое сочетание *двойные* и *doubleVec*. Например:

`doubleVecList := ( (double | doubleVec)+(, (double | doubleVec) )* )?`

Hello *doubleVecList* значение — один преобразованный tooa *doubleVec* до оценки. Например если `v = [1,2,3]`, затем вызвать `avg(v)` — эквивалент toocalling `avg(1,2,3)`. Вызов `avg(v, 7)` — эквивалент toocalling `avg(1,2,3,7)`.

## <a name="getsampledata"></a>Получение выборки данных
Формулы автомасштабирования, влияют на данные метрик (примеры), предоставляемый hello пакетной службы. Формула при увеличении или уменьшении размера пула на основе значений hello, он получает от службы hello. переменные, определенные службы Hello, описанные ранее, объекты, которые предоставляют различные методы tooaccess данных, связанный с этим объектом. Например hello следующее выражение показывает hello tooget запрос ЦП за последние пять минут:

```
$CPUPercent.GetSample(TimeInterval_Minute * 5)
```

| Метод | Описание |
| --- | --- |
| GetSample() |Hello `GetSample()` метод возвращает вектор образцы данных.<br/><br/>Выборка — это данные метрики за 30 секунд. Другими словами, выборки делаются каждые 30 секунд. Но происходит задержка между при выборке собирается и когда это формула доступных tooa указаны ниже. Таким образом, не все выборки за заданный период времени могут быть доступны для оценки формулой.<ul><li>`doubleVec GetSample(double count)`<br/>Указывает количество hello tooobtain образцы из hello наиболее свежие образцы, которые были собраны.<br/><br/>`GetSample(1)`Возвращает последние доступные образцы hello. Для метрик, таких как `$CPUPercent`, однако это не следует использовать, так как это невозможно tooknow *при* сбор выборок hello. Она может оказаться свежей, но может и устареть, если в системе возникли проблемы. Лучше в таких случаях toouse интервал времени, как показано ниже.<li>`doubleVec GetSample((timestamp or timeinterval) startTime [, double samplePercent])`<br/>Задает интервал времени для данных выборки. При необходимости он также указывает, что процент hello образцы, которые должны быть доступны в hello запрошенный промежуток времени.<br/><br/>`$CPUPercent.GetSample(TimeInterval_Minute * 10)`Если присутствуют все образцы для hello последние 10 минут в журнале CPUPercent hello вернет 20 точек. Если последнюю минуту hello журнала не был доступен, однако только 18 образцы будут возвращены. В данном случае:<br/><br/>`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)`произойдет сбой, так как только 90 процентов hello образцы доступны.<br/><br/>Метод `$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` будет выполнен успешно.<li>`doubleVec GetSample((timestamp or timeinterval) startTime, (timestamp or timeinterval) endTime [, double samplePercent])`<br/>Задает интервал времени для сбора данных, т. е. начало и конец сбора.<br/><br/>Как упоминалось выше, возникает задержка между при выборке собирается и когда это формула доступных tooa. Рассмотрим эту задержку, при использовании hello `GetSample` метод. Ознакомьтесь с `GetSamplePercent` ниже. |
| GetSamplePeriod() |Возвращает hello период выборки, собранные в исторические данные выборки. |
| Count() |Возвращает hello общее количество выборок в журнале метрики hello. |
| HistoryBeginTime() |Возвращает hello hello старые образец доступных данных для метрики hello отметку времени. |
| GetSamplePercent() |Возвращает hello доля образцов, доступных для заданного интервала времени. Например:<br/><br/>`doubleVec GetSamplePercent( (timestamp or timeinterval) startTime [, (timestamp or timeinterval) endTime] )`<br/><br/>Поскольку hello `GetSample` метод завершается ошибкой, если процент возвращаемых образцы hello меньше, чем hello `samplePercent` указано, можно использовать hello `GetSamplePercent` toocheck метод первой. Затем можно выполнить альтернативное действие, если недостаточно образцы присутствуют, без прекращение выполнения автоматического масштабирования вычисления hello. |

### <a name="samples-sample-percentage-and-hello-getsample-method"></a>Примеры, процент образца и hello *GetSample()* метод
Hello базового функционирования формулу автомасштабирования tooobtain задач и ресурсов метрики данным, а затем измените размер пула на основе этих данных. Таким образом рекомендуется важные toohave четкое представление о формулах автомасштабирования взаимодействие с данными метрик (примеры).

**Примеры**

периодически Hello пакетная служба принимает примеры задач и ресурсов метрик и становятся доступны tooyour формулы автоматического масштабирования. В этих примерах записываются каждые 30 секунд hello пакетной службы. Однако есть обычно задержка между при эти образцы были записаны, и когда они становятся доступными слишком (и может быть прочитан) формулы автоматического масштабирования. Кроме того из-за toovarious факторов, таких как сети или других проблем инфраструктуры, образцы не могут быть записаны в течение определенного интервала.

**Процент выборок**

Когда `samplePercent` передается toohello `GetSample()` метода или hello `GetSamplePercent()` вызывается метод, _процентов_ ссылается tooa сравнение hello Общее возможное количество образцов, записанных hello пакетная служба и Hello число выборок, являются доступными tooyour формула автоматического масштабирования.

Для примера рассмотрим промежуток времени в 10 минут. Так как образцы записываются каждые 30 секунд, в течение 10 минут timespan, hello максимальное общее число выборок, записываемых пакетом будет 20 точек (2 в минуту). Однако из-за toohello внутренней задержки hello reporting механизм и другие проблемы в Azure, может существовать только 15 примеры, формула автоматического масштабирования tooyour доступной для чтения. Так например, этого 10-минутного периода только 75% hello общее число записанных образцы его доступных tooyour формулы.

**Метод GetSample() и диапазоны выборок**

Формулы автоматического масштабирования являются постоянной toobe расширение и сжатие пулов &mdash; узлы Добавление или удаление узлов. Так как узлы тратить, следует tooensure, метод интеллектуального анализа, который основан на данных достаточно использовать формулы. Поэтому в формулах рекомендуется использовать анализ тенденций. С таким анализом пулы увеличиваются и уменьшаются на основе диапазона собранных выборок.

Таким образом, используйте toodo `GetSample(interval look-back start, interval look-back end)` tooreturn вектор примеров:

```
$runningTasksSample = $RunningTasks.GetSample(1 * TimeInterval_Minute, 6 * TimeInterval_Minute);
```

При вычислении hello над линией пакетом возвращается ряд примеров как вектор значений. Например:

```
$runningTasksSample=[1,1,1,1,1,1,1,1,1,1];
```

После собранными вектор hello образцов, затем можно использовать функции, такие как `min()`, `max()`, и `avg()` tooderive значимые значения из hello собранные диапазона.

Для обеспечения дополнительной безопасности можно принудительно выполнить toofail вычисления, если меньше, чем определенный процент пример доступен в течение конкретного периода времени. При выполнении принудительного toofail вычисления, вы указываете пакета toocease дальнейшей вычисления формулы hello Если hello указанный процент примеров недоступна. В этом случае размер пула toohello не вносятся никакие изменения. toospecify требуемый процент образцов для toosucceed оценки hello, укажите его как hello третий параметр слишком`GetSample()`. Здесь указано, что обязательный процент выборок равен 75 %:

```
$runningTasksSample = $RunningTasks.GetSample(60 * TimeInterval_Second, 120 * TimeInterval_Second, 75);
```

Так как в образце доступности возможна задержка, очень важно, tooalways указать диапазон времени с временем начала Искать назад, более ранняя, чем на одну минуту. Принимает примерно через одну минуту toopropagate образцы через систему hello, поэтому образцы в диапазоне hello `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` могут быть недоступны. Еще раз, можно использовать параметр процент hello `GetSample()` tooforce требования конкретного примера в процентах.

> [!IMPORTANT]
> Мы **настоятельно рекомендуем** **не полагаться *только* на метод `GetSample(1)` в формулах автомасштабирования**. Это вызвано `GetSample(1)` фактически говорит toohello пакетная служба «Предоставьте мне hello последней выборки, у вас не проверяются как давно вы получили.» Так как он является только один образец, и она может быть пример более старые, он может не представлять hello общую картину запущенное задание или состояние ресурса. Если вы используете `GetSample(1)`, убедитесь, что он является частью большего инструкции и не hello только точки данных, которая зависит от формулы.
>
>

## <a name="metrics"></a>Метрики
При определении формулы можно использовать метрики ресурсов и задач. Можно настроить hello целевое количество выделенных узлов в hello пула на основании данных метрик hello, получения и оценки. В разделе hello [переменных](#variables) выше в разделе Дополнительные сведения о каждой метрики.

<table>
  <tr>
    <th>Метрика</th>
    <th>Описание</th>
  </tr>
  <tr>
    <td><b>Ресурс</b></td>
    <td><p>Метрики ресурсов основаны на hello ЦП, пропускную способность hello, использование памяти hello вычислительные узлы и hello количество узлов.</p>
        <p> Для внесения изменений с учетом количества узлов используются следующие служебные переменные:</p>
    <p><ul>
            <li>$TargetDedicatedNodes</li>
            <li>$TargetLowPriorityNodes</li>
            <li>$CurrentDedicatedNodes</li>
            <li>$CurrentLowPriorityNodes</li>
            <li>$preemptedNodeCount</li>
            <li>$SampleNodeCount</li>
    </ul></p>
    <p>Для внесения изменений с учетом потребляемых ресурсов используются следующие служебные переменные:</p>
    <p><ul>
      <li>$CPUPercent</li>
      <li>$WallClockSeconds</li>
      <li>$MemoryBytes</li>
      <li>$DiskBytes</li>
      <li>$DiskReadBytes</li>
      <li>$DiskWriteBytes</li>
      <li>$DiskReadOps</li>
      <li>$DiskWriteOps</li>
      <li>$NetworkInBytes</li>
      <li>$NetworkOutBytes</li></ul></p>
  </tr>
  <tr>
    <td><b>Задача.</b></td>
    <td><p>Задача метрики на основе hello состояния задач, таких как активные, Ожидание и завершена. Hello следующие переменные, определенные службы используются для регулировки размера пула на основе задач.</p>
    <p><ul>
      <li>$ActiveTasks</li>
      <li>$RunningTasks</li>
      <li>$PendingTasks</li>
      <li>$SucceededTasks</li>
            <li>$FailedTasks</li></ul></p>
        </td>
  </tr>
</table>

## <a name="write-an-autoscale-formula"></a>Написание формулы автомасштабирования
Построить формулу автомасштабирования посредством формирования инструкции, которые используют hello выше компонентов, а затем объединить эти инструкции в полную формулу. В этом разделе мы создадим пример формулы автомасштабирования, с помощью которой можно выполнять некоторые задачи масштабирования из реальной жизни.

Во-первых определим hello требования для нового формулы автоматического масштабирования. Формула Hello следует:

1. Если высокая загрузка ЦП, увеличьте hello целевое количество выделенных вычислительных узлов в пуле.
2. При низком уровне использования ЦП, уменьшение hello целевое количество выделенных вычислительных узлов в пуле.
3. Всегда ограничивает максимальное число выделенных узлов too400 hello.

tooincrease hello количество узлов во время высокой загрузки ЦП, определите hello инструкцию, которая заполняет определяемой пользователем переменной (`$totalDedicatedNodes`) со значением, которое 110% hello текущее целевое количество выделенных узлов, но только если hello минимальное среднее время использования ЦП во время hello последние 10 минут было более 70 процентов. В противном случае используйте значение hello для hello текущее количество выделенных узлов.

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
```

слишком*уменьшить* Здравствуйте количество выделенных узлов, при низкой загрузке ЦП, hello следующий оператор в нашей формулы наборов hello же `$totalDedicatedNodes` переменной too90 процентов hello текущее целевое количество выделенных узлов, если hello средняя загрузка ЦП в hello за последние 60 минут в разделе было 20 процентов. В противном случае используйте hello текущее значение `$totalDedicatedNodes` мы заполненной в инструкции hello выше.

```
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
```

Теперь можно ограничьте hello целевое количество выделенных вычислительных узлов tooa более 400:

```
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

Вот hello полную формулу.

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

## <a name="create-an-autoscale-enabled-pool-with-net"></a>Создание пула с поддержкой автомасштабирования с помощью .NET

toocreate пул с включенного в .NET, выполните следующие действия.

1. Создание пула hello с [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).
2. Набор hello [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) свойство слишком`true`.
3. Набор hello [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) свойство с формулы автоматического масштабирования.
4. (Необязательно) Набор hello [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) свойство (по умолчанию — 15 минут).
5. Зафиксировать hello пул с [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) или [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).

Hello следующий фрагмент кода создает пул включена автомасштабирования в .NET. Hello формулу автомасштабирования пула задает hello целевое количество выделенных узлов too5 по понедельникам, а 1 на каждый день недели hello. Hello [интервал автоматического масштабирования](#automatic-scaling-interval) — установить too30 минут. В этом и hello другие фрагменты C# в этой статье `myBatchClient` — это правильно инициализированный экземпляр hello [BatchClient] [ net_batchclient] класса.

```csharp
CloudPool pool = myBatchClient.PoolOperations.CreatePool(
                    poolId: "mypool",
                    virtualMachineSize: "small", // single-core, 1.75 GB memory, 225 GB disk
                    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "5"));    
pool.AutoScaleEnabled = true;
pool.AutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";
pool.AutoScaleEvaluationInterval = TimeSpan.FromMinutes(30);
await pool.CommitAsync();
```

> [!IMPORTANT]
> При создании пула включена автомасштабирования не следует указывать hello _targetDedicatedComputeNodes_ параметр или hello _targetLowPriorityComputeNodes_ параметром hello вызвать слишком **CreatePool**. Вместо этого укажите hello **AutoScaleEnabled** и **AutoScaleFormula** свойства пула hello. Hello значения этих свойств определяют hello целевое количество каждого типа узла. Кроме того, toomanually изменения размера пула включена автомасштабирования (например, с помощью [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), сначала **отключить** автоматического масштабирования Здравствуйте пула, а затем изменить его размер.
>
>

В дополнение к этому tooBatch .NET, можно использовать любой из других hello [пакета SDK](batch-apis-tools.md#azure-accounts-for-batch-development), [REST пакетной](https://docs.microsoft.com/rest/api/batchservice/), [командлеты PowerShell пакета](batch-powershell-cmdlets-get-started.md)и hello [CLI пакета](batch-cli-get-started.md)tooconfigure автоматического масштабирования.


### <a name="automatic-scaling-interval"></a>Интервал автоматического масштабирования
По умолчанию hello пакетная служба корректирует размер пула, в соответствии с tooits формула автоматического масштабирования каждые 15 минут. Этот интервал настраивается с помощью hello следующие свойства пула:

* [CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (.NET пакетной службы)
* [autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)

Минимальный интервал Hello пять минут, который hello максимальное 168 часов. Если указан интервал вне этого диапазона, hello пакетная служба возвращает ошибку неправильный запрос (400).

> [!NOTE]
> Автоматическое масштабирование не рекомендуемый в настоящий момент toorespond toochanges менее чем через минуту, но скорее постепенно предназначен tooadjust hello размер пула, при выполнении рабочей нагрузки.
>
>

## <a name="enable-autoscaling-on-an-existing-pool"></a>Включение автомасштабирования в имеющемся пуле

Каждый пакет SDK предоставляет автоматическое масштабирование tooenable способом. Например:

* [BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (библиотека .NET пакетной службы)
* [Включение автомасштабирования пула][rest_enableautoscale] (REST API)

При включении автоматического масштабирования для существующего пула, имейте в виду hello после точки.

* Если автоматическое масштабирование в настоящее время отключена на пул hello при выполнении автоматического масштабирования tooenable запрос hello, необходимо указать формулу автомасштабирования допустимым при выполнении запроса hello. При необходимости можно указать интервал оценки автомасштабирования. Если интервал не указан, используется значение по умолчанию hello 15 минут.
* Если в пуле hello включена автомасштабирования, можно указать формулу автомасштабирования и интервал оценки. Необходимо указать по крайней мере одно из этих свойств.

  * Если указать новый интервал оценки автомасштабирования hello существующее расписание оценки остановлена, и запускается новое расписание. время начала Hello Создание расписания — время hello, какие hello выдачи запроса tooenable автомасштабирования.
  * Если опустить интервал автоматического масштабирования либо приветствия формулы или оценки, hello пакетная служба продолжает toouse hello текущее значение этого параметра.

> [!NOTE]
> При указании значения для hello *targetDedicatedComputeNodes* или *targetLowPriorityComputeNodes* параметры hello **CreatePool** метод при создании hello пула в .NET, либо для hello сопоставимых параметров в другом языке, то эти значения учитываются при вычислении hello автоматического масштабирования формулы.
>
>

Фрагмент кода C# использует hello [пакета .NET] [ net_api] автоматическое масштабирование tooenable библиотеки для существующего пула:

```csharp
// Define hello autoscaling formula. This formula sets hello target number of nodes
// too5 on Mondays, and 1 on every other day of hello week
string myAutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";

// Set hello autoscale formula on hello existing pool
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myAutoScaleFormula);
```

### <a name="update-an-autoscale-formula"></a>Обновление формулы автомасштабирования

Формула hello tooupdate для существующего включена автомасштабирования пула, вызов автоматическое масштабирование tooenable hello операции с hello новую формулу. Например, если автоматическое масштабирование уже включен в `myexistingpool` при выполнении hello после кода .NET hello содержимое заменяется указанной формуле автоматического масштабирования `myNewFormula`.

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myNewFormula);
```

### <a name="update-hello-autoscale-interval"></a>Интервал автоматического масштабирования hello обновления

tooupdate hello автомасштабирования интервал оценки существующего включена автомасштабирования пула, вызов автоматическое масштабирование tooenable hello операции попытку, используя новый интервал приветствия. Например tooset hello автомасштабирования оценки too60 по прошествии интервала для пула, который уже включена автомасштабирования в .NET:

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleEvaluationInterval: TimeSpan.FromMinutes(60));
```

## <a name="evaluate-an-autoscale-formula"></a>Оценка формулы автомасштабирования

Можно вычислить формулу перед ее применением tooa пула. Таким образом можно проверить формулы toosee hello, как его инструкций вычисляет перед включением hello формулы в рабочей среде.

tooevaluate формулу автомасштабирования, необходимо сначала включить автоматическое масштабирование в пуле hello с допустимую формулу. включен tootest формулы в пуле, которые еще не имеют автоматическое масштабирование, одна строка hello использовать формулу `$TargetDedicatedNodes = 0` при включении сначала автоматического масштабирования. Затем воспользуйтесь одним из следующую формулу hello tooevaluate требуется tootest hello.

* Вызовите метод [BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) или [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync).

    Эти методы .NET пакета требуют идентификатор hello существующего пула и строка, содержащая tooevaluate формулы автомасштабирования hello.

* [Оцените формулу автомасштабирования.](https://docs.microsoft.com/rest/api/batchservice/evaluate-an-automatic-scaling-formula)

    В этом запросе REST API, укажите идентификатор пула hello в hello URI и hello формула автоматического масштабирования в hello *autoScaleFormula* элемента hello тексте запроса. ответ Hello операции hello содержит все сведения об ошибках, которые могут быть связанные toohello формулы.

В этом фрагменте кода [.NET пакетной службы][net_api] вычисляется формула автомасштабирования. Если пул hello не имеет включено автоматическое масштабирование, мы включить сначала.

```csharp
// First obtain a reference tooan existing pool
CloudPool pool = await batchClient.PoolOperations.GetPoolAsync("myExistingPool");

// If autoscaling isn't already enabled on hello pool, enable it.
// You can't evaluate an autoscale formula on non-autoscale-enabled pool.
if (pool.AutoScaleEnabled == false)
{
    // We need a valid autoscale formula tooenable autoscaling on the
    // pool. This formula is valid, but won't resize hello pool:
    await pool.EnableAutoScaleAsync(
        autoscaleFormula: "$TargetDedicatedNodes = {pool.CurrentDedicatedNodes};",
        autoscaleEvaluationInterval: TimeSpan.FromMinutes(5));

    // Batch limits EnableAutoScaleAsync calls tooonce every 30 seconds.
    // Because we want tooapply our new autoscale formula below if it
    // evaluates successfully, and we *just* enabled autoscaling on
    // this pool, we pause here tooensure we pass that threshold.
    Thread.Sleep(TimeSpan.FromSeconds(31));

    // Refresh hello properties of hello pool so that we've got the
    // latest value for AutoScaleEnabled
    await pool.RefreshAsync();
}

// We must ensure that autoscaling is enabled on hello pool prior to
// evaluating a formula
if (pool.AutoScaleEnabled == true)
{
    // hello formula tooevaluate - adjusts target number of nodes based on
    // day of week and time of day
    string myFormula = @"
        $curTime = time();
        $workHours = $curTime.hour >= 8 && $curTime.hour < 18;
        $isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
        $isWorkingWeekdayHour = $workHours && $isWeekday;
        $TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
    ";

    // Perform hello autoscale formula evaluation. Note that this code does not
    // actually apply hello formula toohello pool.
    AutoScaleRun eval =
        await batchClient.PoolOperations.EvaluateAutoScaleAsync(pool.Id, myFormula);

    if (eval.Error == null)
    {
        // Evaluation success - print hello results of hello AutoScaleRun.
        // This will display hello values of each variable as evaluated by the
        // autoscale formula.
        Console.WriteLine("AutoScaleRun.Results: " +
            eval.Results.Replace("$", "\n    $"));

        // Apply hello formula toohello pool since it evaluated successfully
        await batchClient.PoolOperations.EnableAutoScaleAsync(pool.Id, myFormula);
    }
    else
    {
        // Evaluation failed, output hello message associated with hello error
        Console.WriteLine("AutoScaleRun.Error.Message: " +
            eval.Error.Message);
    }
}
```

Успешно проходит проверку hello формулы, показанной в этом фрагменте кода выводятся результаты, аналогичные:

```
AutoScaleRun.Results:
    $TargetDedicatedNodes=10;
    $NodeDeallocationOption=requeue;
    $curTime=2016-10-13T19:18:47.805Z;
    $isWeekday=1;
    $isWorkingWeekdayHour=0;
    $workHours=0
```

## <a name="get-information-about-autoscale-runs"></a>Получение сведений о выполнениях автомасштабирования

tooensure, ваша формула работает как ожидалось, рекомендуется периодически проверять hello результаты запусков hello автоматического масштабирования, выполняемых в пакете в пуле. toodo таким образом, get (или обновите) toohello ссылка пул, а также проверяет свойства hello его последней автомасштабирования запуска.

В пакете .NET hello [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) свойство имеет несколько свойств, предоставляющих сведения о hello последнюю автоматическое масштабирование запуска выполняется в пуле hello:

* [AutoScaleRun.Timestamp.](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.timestamp)
* [AutoScaleRun.Results;](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.results)
* [AutoScaleRun.Error;](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.error)

В hello REST API, hello [получить сведения о пуле](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) запрос возвращает сведения о пуле hello, который включает hello последнюю автоматическое масштабирование запускаться сведения в hello [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) свойство.

Hello следующий фрагмент кода C# использует hello пакета .NET библиотеки tooprint сведения о последней автоматическое масштабирование hello запуска в пуле _myPool_:

```csharp
await Cloud pool = myBatchClient.PoolOperations.GetPoolAsync("myPool");
Console.WriteLine("Last execution: " + pool.AutoScaleRun.Timestamp);
Console.WriteLine("Result:" + pool.AutoScaleRun.Results.Replace("$", "\n  $"));
Console.WriteLine("Error: " + pool.AutoScaleRun.Error);
```

Вывод образца hello предшествующий фрагмент кода:

```
Last execution: 10/14/2016 18:36:43
Result:
  $TargetDedicatedNodes=10;
  $NodeDeallocationOption=requeue;
  $curTime=2016-10-14T18:36:43.282Z;
  $isWeekday=1;
  $isWorkingWeekdayHour=0;
  $workHours=0
Error:
```

## <a name="example-autoscale-formulas"></a>Примеры формул автомасштабирования
Рассмотрим некоторые формулы, которые показывают различные способы tooadjust hello объем вычислительных ресурсов в пул.

### <a name="example-1-time-based-adjustment"></a>Пример 1. Изменение с учетом времени
Предположим, требуется, чтобы размер пула hello tooadjust в зависимости от hello день недели hello и времени суток. В этом примере показано, как tooincrease или уменьшении hello количество узлов в hello пул соответствующим образом.

Формула Hello сначала получает hello текущее время. Если день недели (1-5) и в рабочие часы (too6 8: 00 PM), hello целевой размер пула задано too20 узлов. В противном случае оно задано too10 узлов.

```
$curTime = time();
$workHours = $curTime.hour >= 8 && $curTime.hour < 18;
$isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
$isWorkingWeekdayHour = $workHours && $isWeekday;
$TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
```

### <a name="example-2-task-based-adjustment"></a>Пример 2. Изменение с учетом задачи
В этом примере размер пула hello изменяется на основе hello количества задач в очереди hello. В строках формул допускаются как комментарии, так и разрывы строк.

```csharp
// Get pending tasks for hello past 15 minutes.
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
// If we have fewer than 70 percent data points, we use hello last sample point,
// otherwise we use hello maximum of last sample point and hello history average.
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1), avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// If number of pending tasks is not 0, set targetVM toopending tasks, otherwise
// half of current dedicated.
$targetVMs = $tasks > 0? $tasks:max(0, $TargetDedicatedNodes/2);
// hello pool size is capped at 20, if target VM value is more than that, set it
// too20. This value should be adjusted according tooyour use case.
$TargetDedicatedNodes = max(0, min($targetVMs, 20));
// Set node deallocation mode - keep nodes active only until tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-3-accounting-for-parallel-tasks"></a>Пример 3. Параллельные задачи
В этом примере изменяется размер пула hello в зависимости от hello количество задач. Эта формула также учитывает hello учетной записи [MaxTasksPerComputeNode] [ net_maxtasks] значения, которое задано для пула hello. Такой подход полезен, если в пуле поддерживается [параллельное выполнение задач](batch-parallel-node-tasks.md).

```csharp
// Determine whether 70 percent of hello samples have been recorded in hello past
// 15 minutes; if not, use last sample
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1),avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// Set hello number of nodes tooadd tooone-fourth hello number of active tasks (the
// MaxTasksPerComputeNode property on this pool is set too4, adjust this number
// for your use case)
$cores = $TargetDedicatedNodes * 4;
$extraVMs = (($tasks - $cores) + 3) / 4;
$targetVMs = ($TargetDedicatedNodes + $extraVMs);
// Attempt toogrow hello number of compute nodes toomatch hello number of active
// tasks, with a maximum of 3
$TargetDedicatedNodes = max(0,min($targetVMs,3));
// Keep hello nodes active until hello tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-4-setting-an-initial-pool-size"></a>Пример 4. Настройка исходного размера пула
В этом примере, что показано на языке C# фрагмент с формулу автомасштабирования, которая задает кода hello tooa размер пула указано количество узлов для начальный период времени. Затем он корректирует размер пула hello в зависимости от hello число работающих и по истечении активные задачи после hello начальный период времени.

Формула Hello в hello, следующий фрагмент кода:

* Задает размер toofour узлы начального пула в hello.
* Корректирует размер пула hello в hello первый 10 минут hello пула жизненного цикла.
* Через 10 минут получает hello максимальное значение параметра hello число запущена и активных задач в пределах hello за последние 60 минут.
  * Если оба значения равны 0 (это означает, что никакие задачи были запущенной или активного в hello последние 60 минут), too0 задается размер пула hello.
  * Если любое из значений больше нуля, изменений не производится.

```csharp
string now = DateTime.UtcNow.ToString("r");
string formula = string.Format(@"
    $TargetDedicatedNodes = {1};
    lifespan         = time() - time(""{0}"");
    span             = TimeInterval_Minute * 60;
    startup          = TimeInterval_Minute * 10;
    ratio            = 50;

    $TargetDedicatedNodes = (lifespan > startup ? (max($RunningTasks.GetSample(span, ratio), $ActiveTasks.GetSample(span, ratio)) == 0 ? 0 : $TargetDedicatedNodes) : {1});
    ", now, 4);
```

## <a name="next-steps"></a>Дальнейшие действия
* [Максимально увеличить использование ресурсов вычислений пакета Azure с помощью узла параллельных задач](batch-parallel-node-tasks.md) содержит сведения о том, как можно выполнять несколько задач одновременно на вычислительных узлах hello в пуле. В дополнение к этому tooautoscaling, эта функция может помочь toolower длительности задания некоторых рабочих нагрузок, экономя деньги.
* Другой оптимизации эффективности убедитесь, что запросы пакета приложения hello пакетной службы в большинстве оптимальным способом hello. В разделе [эффективно запрашивать hello пакетной службы Azure](batch-efficient-list-queries.md) toolearn как toolimit hello объем данных, передаваемых по сети hello при запросе состояния hello тысяч вычислительные узлы или задачи.

[net_api]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch
[net_batchclient]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.batchclient
[net_cloudpool_autoscaleformula]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula
[net_cloudpool_autoscaleevalinterval]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval
[net_enableautoscaleasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.enableautoscaleasync
[net_maxtasks]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.maxtaskspercomputenode
[net_poolops_resizepoolasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.resizepoolasync

[rest_api]: https://docs.microsoft.com/rest/api/batchservice/
[rest_autoscaleformula]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_autoscaleinterval]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_enableautoscale]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
