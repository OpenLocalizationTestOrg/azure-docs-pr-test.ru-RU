---
title: "aaaAutomatically масштабирование вычислительных узлов в пуле пакетной службы Azure | Документы Microsoft"
description: "Включение автоматического масштабирования облака пула toodynamically настроить hello количество вычислительных узлов в пуле hello."
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: tysonn
ms.assetid: c624cdfc-c5f2-4d13-a7d7-ae080833b779
ms.service: batch
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: multiple
ms.date: 06/20/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: b6d1e0c5d8e0e56e15a4d3588150f2466a689f19
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="create-an-automatic-scaling-formula-for-scaling-compute-nodes-in-a-batch-pool"></a><span data-ttu-id="9df47-103">Создание формулы автоматического масштабирования для масштабирования вычислительных узлов в пуле пакетной службы</span><span class="sxs-lookup"><span data-stu-id="9df47-103">Create an automatic scaling formula for scaling compute nodes in a Batch pool</span></span>

<span data-ttu-id="9df47-104">Пакетная служба Azure может автоматически масштабировать пулы в зависимости от определенных вами параметров.</span><span class="sxs-lookup"><span data-stu-id="9df47-104">Azure Batch can automatically scale pools based on parameters that you define.</span></span> <span data-ttu-id="9df47-105">При автоматическом масштабировании пакета динамически добавляет пул tooa узлов в качестве задачи роста потребностей и удаляет вычислительных узлов, которые снижают.</span><span class="sxs-lookup"><span data-stu-id="9df47-105">With automatic scaling, Batch dynamically adds nodes tooa pool as task demands increase, and removes compute nodes as they decrease.</span></span> <span data-ttu-id="9df47-106">С помощью автоматической регулировки hello количество вычислительных узлов, используемых приложением пакета можно сохранить времени и денег.</span><span class="sxs-lookup"><span data-stu-id="9df47-106">You can save both time and money by automatically adjusting hello number of compute nodes used by your Batch application.</span></span> 

<span data-ttu-id="9df47-107">Чтобы включить автоматическое масштабирование для пула вычислительных узлов, определите и установите для него *формулу автомасштабирования*.</span><span class="sxs-lookup"><span data-stu-id="9df47-107">You enable automatic scaling on a pool of compute nodes by associating with it an *autoscale formula* that you define.</span></span> <span data-ttu-id="9df47-108">Hello пакетная служба использует hello автомасштабирования формулы toodetermine hello количество вычислительных узлов, которые являются необходимые tooexecute рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="9df47-108">hello Batch service uses hello autoscale formula toodetermine hello number of compute nodes that are needed tooexecute your workload.</span></span> <span data-ttu-id="9df47-109">Вычислительные узлы могут быть выделенными узлами или [узлами с низким приоритетом](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="9df47-109">Compute nodes may be dedicated nodes or [low-priority nodes](batch-low-pri-vms.md).</span></span> <span data-ttu-id="9df47-110">Пакет отвечает tooservice периодически собираемые данные метрик.</span><span class="sxs-lookup"><span data-stu-id="9df47-110">Batch responds tooservice metrics data that is collected periodically.</span></span> <span data-ttu-id="9df47-111">Используя эти данные метрик, пакет корректирует hello количество вычислительных узлов в пуле hello на основе формулы и с заданным интервалом.</span><span class="sxs-lookup"><span data-stu-id="9df47-111">Using this metrics data, Batch adjusts hello number of compute nodes in hello pool based on your formula and at a configurable interval.</span></span>

<span data-ttu-id="9df47-112">Автоматическое масштабирование можно включить во время создания пула или для существующего пула.</span><span class="sxs-lookup"><span data-stu-id="9df47-112">You can enable automatic scaling either when a pool is created, or on an existing pool.</span></span> <span data-ttu-id="9df47-113">Также можно изменить назначенную формулу для пула с настроенным автоматическим масштабированием.</span><span class="sxs-lookup"><span data-stu-id="9df47-113">You can also change an existing formula on a pool that is configured for autoscaling.</span></span> <span data-ttu-id="9df47-114">Пакет включает tooevaluate выполняется формулы перед назначением их состояние hello toopools и toomonitor автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-114">Batch enables you tooevaluate your formulas before assigning them toopools and toomonitor hello status of automatic scaling runs.</span></span>

<span data-ttu-id="9df47-115">В этой статье описывается hello различных сущностей, которые составляют формулы автоматического масштабирования, включая переменные, операторы, операций и функций.</span><span class="sxs-lookup"><span data-stu-id="9df47-115">This article discusses hello various entities that make up your autoscale formulas, including variables, operators, operations, and functions.</span></span> <span data-ttu-id="9df47-116">Рассматриваются как tooobtain различных вычислений метрики ресурсов и задачи в пакете.</span><span class="sxs-lookup"><span data-stu-id="9df47-116">We discuss how tooobtain various compute resource and task metrics within Batch.</span></span> <span data-ttu-id="9df47-117">Можно использовать эти tooadjust показатели вашей пула количество узлов на основе ресурсов об использовании и задача состояния.</span><span class="sxs-lookup"><span data-stu-id="9df47-117">You can use these metrics tooadjust your pool's node count based on resource usage and task status.</span></span> <span data-ttu-id="9df47-118">Затем рассматривается как tooconstruct формулу и включение автоматического масштабирования в пуле с помощью обоих hello пакета REST и API-интерфейсы .NET.</span><span class="sxs-lookup"><span data-stu-id="9df47-118">We then describe how tooconstruct a formula and enable automatic scaling on a pool by using both hello Batch REST and .NET APIs.</span></span> <span data-ttu-id="9df47-119">Наконец, мы рассмотрим несколько примеров формул.</span><span class="sxs-lookup"><span data-stu-id="9df47-119">Finally, we finish up with a few example formulas.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9df47-120">Можно указать при создании учетной записи пакетной hello [настройки учетной записи](batch-api-basics.md#account), которое определяет, выделяются ли пулов в пакетной службы подписки (по умолчанию hello) или в вашей подписке пользователя.</span><span class="sxs-lookup"><span data-stu-id="9df47-120">When you create a Batch account, you can specify hello [account configuration](batch-api-basics.md#account), which determines whether pools are allocated in a Batch service subscription (hello default), or in your user subscription.</span></span> <span data-ttu-id="9df47-121">При создании учетной записи пакетного hello конфигурации по умолчанию служба Batch, ваша учетная запись является ограниченной tooa максимальное количество ядер, которые могут использоваться для обработки.</span><span class="sxs-lookup"><span data-stu-id="9df47-121">If you created your Batch account with hello default Batch Service configuration, then your account is limited tooa maximum number of cores that can be used for processing.</span></span> <span data-ttu-id="9df47-122">Hello пакетная служба масштабирует вычислительные узлы только копирование предельное toothat ядер.</span><span class="sxs-lookup"><span data-stu-id="9df47-122">hello Batch service scales compute nodes only up toothat core limit.</span></span> <span data-ttu-id="9df47-123">По этой причине hello пакетная служба не может достичь hello целевое количество вычислительных узлов, указанные в формуле автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-123">For this reason, hello Batch service may not reach hello target number of compute nodes specified by an autoscale formula.</span></span> <span data-ttu-id="9df47-124">В разделе [квоты и лимиты для пакетной службы Azure hello](batch-quota-limit.md) сведения о просмотре и увеличения квоты вашей учетной записи.</span><span class="sxs-lookup"><span data-stu-id="9df47-124">See [Quotas and limits for hello Azure Batch service](batch-quota-limit.md) for information on viewing and increasing your account quotas.</span></span>
>
><span data-ttu-id="9df47-125">Если была создана учетная запись с конфигурацией hello подписки пользователя, то ваша учетная запись в общие папки на hello основная квота для hello подписки.</span><span class="sxs-lookup"><span data-stu-id="9df47-125">If you created your account with hello User Subscription configuration, then your account shares in hello core quota for hello subscription.</span></span> <span data-ttu-id="9df47-126">Дополнительные сведения см. в разделе [Ограничения виртуальных машин](../azure-subscription-service-limits.md#virtual-machines-limits) в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-subscription-service-limits.md).</span><span class="sxs-lookup"><span data-stu-id="9df47-126">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

## <a name="automatic-scaling-formulas"></a><span data-ttu-id="9df47-127">Формулы автоматического масштабирования</span><span class="sxs-lookup"><span data-stu-id="9df47-127">Automatic scaling formulas</span></span>
<span data-ttu-id="9df47-128">Формула автоматического масштабирования представляет собой определяемое пользователем строковое значение, которое содержит один или несколько операторов.</span><span class="sxs-lookup"><span data-stu-id="9df47-128">An automatic scaling formula is a string value that you define that contains one or more statements.</span></span> <span data-ttu-id="9df47-129">Формула автоматического масштабирования Hello назначается пула tooa [autoScaleFormula] [ rest_autoscaleformula] элемент (пакета REST) или [CloudPool.AutoScaleFormula] [ net_cloudpool_autoscaleformula] свойство (пакета .NET).</span><span class="sxs-lookup"><span data-stu-id="9df47-129">hello autoscale formula is assigned tooa pool's [autoScaleFormula][rest_autoscaleformula] element (Batch REST) or [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] property (Batch .NET).</span></span> <span data-ttu-id="9df47-130">Hello пакетная служба использует ваш формулы toodetermine hello целевое количество вычислительных узлов в пуле hello для следующего интервала обработки hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-130">hello Batch service uses your formula toodetermine hello target number of compute nodes in hello pool for hello next interval of processing.</span></span> <span data-ttu-id="9df47-131">формулы строка Hello не может превышать 8 КБ, могут включать копирование too100 инструкций, разделенных точкой с запятой и может содержать разрывы строк и комментарии.</span><span class="sxs-lookup"><span data-stu-id="9df47-131">hello formula string cannot exceed 8 KB, can include up too100 statements that are separated by semicolons, and can include line breaks and comments.</span></span>

<span data-ttu-id="9df47-132">Вы можете представить, что формулы автоматического масштабирования — это язык автомасштабирования пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="9df47-132">You can think of automatic scaling formulas as a Batch autoscale "language."</span></span> <span data-ttu-id="9df47-133">Формулы инструкции являются выражениями произвольной формы, которые могут содержать определенные службы переменными (определяется hello пакетная служба) и пользовательские переменные (переменные, которые указываются).</span><span class="sxs-lookup"><span data-stu-id="9df47-133">Formula statements are free-formed expressions that can include both service-defined variables (variables defined by hello Batch service) and user-defined variables (variables that you define).</span></span> <span data-ttu-id="9df47-134">С этими переменными могут выполняться различные операции с помощью встроенных типов, операторов и функций.</span><span class="sxs-lookup"><span data-stu-id="9df47-134">They can perform various operations on these values by using built-in types, operators, and functions.</span></span> <span data-ttu-id="9df47-135">Например оператор может принимать hello следующие формы:</span><span class="sxs-lookup"><span data-stu-id="9df47-135">For example, a statement might take hello following form:</span></span>

```
$myNewVariable = function($ServiceDefinedVariable, $myCustomVariable);
```

<span data-ttu-id="9df47-136">Обычно формулы содержат несколько инструкций, выполняющих операции со значениями, полученными в предыдущих инструкциях.</span><span class="sxs-lookup"><span data-stu-id="9df47-136">Formulas generally contain multiple statements that perform operations on values that are obtained in previous statements.</span></span> <span data-ttu-id="9df47-137">Например, сначала мы получаем значение для `variable1`, передать его функции toopopulate tooa `variable2`:</span><span class="sxs-lookup"><span data-stu-id="9df47-137">For example, first we obtain a value for `variable1`, then pass it tooa function toopopulate `variable2`:</span></span>

```
$variable1 = function1($ServiceDefinedVariable);
$variable2 = function2($OtherServiceDefinedVariable, $variable1);
```

<span data-ttu-id="9df47-138">Включите эти инструкции в tooarrive вашей формулы автоматического масштабирования, в целевое количество вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-138">Include these statements in your autoscale formula tooarrive at a target number of compute nodes.</span></span> <span data-ttu-id="9df47-139">Выделенные узлы и узлы с низким приоритетом имеют свои собственные целевые показатели, что позволяет определять целевое количество для каждого типа узла.</span><span class="sxs-lookup"><span data-stu-id="9df47-139">Dedicated nodes and low-priority nodes each have their own target settings, so that you can define a target for each type of node.</span></span> <span data-ttu-id="9df47-140">Формула автомасштабирования может включать в себя целевое значение для выделенных узлов, целевое значение для узлов с низким приоритетом или и то, и другое.</span><span class="sxs-lookup"><span data-stu-id="9df47-140">An autoscale formula can include a target value for dedicated nodes, a target value for low-priority nodes, or both.</span></span>

<span data-ttu-id="9df47-141">Hello целевое количество узлов может быть выше, ниже или hello таким же, как hello текущее число узлов типа в пуле hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-141">hello target number of nodes may be higher, lower, or hello same as hello current number of nodes of that type in hello pool.</span></span> <span data-ttu-id="9df47-142">Пакетная служба вычисляет формулу автомасштабирования пула с указанным интервалом (см. раздел, посвященный [интервалам автоматического масштабирования](#automatic-scaling-interval)).</span><span class="sxs-lookup"><span data-stu-id="9df47-142">Batch evaluates a pool's autoscale formula at a specific interval (see [automatic scaling intervals](#automatic-scaling-interval)).</span></span> <span data-ttu-id="9df47-143">Пакет корректирует hello целевое количество каждого типа узла в hello пула toohello число, которое указывает формулы автоматического масштабирования во время hello оценки.</span><span class="sxs-lookup"><span data-stu-id="9df47-143">Batch adjusts hello target number of each type of node in hello pool toohello number that your autoscale formula specifies at hello time of evaluation.</span></span>

### <a name="sample-autoscale-formula"></a><span data-ttu-id="9df47-144">Пример формулы автоматического масштабирования</span><span class="sxs-lookup"><span data-stu-id="9df47-144">Sample autoscale formula</span></span>

<span data-ttu-id="9df47-145">Ниже приведен пример формулу автомасштабирования, которая может быть скорректированное toowork для большинства сценариев.</span><span class="sxs-lookup"><span data-stu-id="9df47-145">Here is an example of an autoscale formula that can be adjusted toowork for most scenarios.</span></span> <span data-ttu-id="9df47-146">Здравствуйте, переменные `startingNumberOfVMs` и `maxNumberofVMs` в hello формулы из примера может быть скорректированное tooyour потребностей.</span><span class="sxs-lookup"><span data-stu-id="9df47-146">hello variables `startingNumberOfVMs` and `maxNumberofVMs` in hello example formula can be adjusted tooyour needs.</span></span> <span data-ttu-id="9df47-147">Эта формула масштабирует выделенных узлов, но может быть измененный tooapply tooscale также узлы низким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="9df47-147">This formula scales dedicated nodes, but can be modified tooapply tooscale low-priority nodes as well.</span></span> 

```
startingNumberOfVMs = 1;
maxNumberofVMs = 25;
pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);
pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));
$TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
```

<span data-ttu-id="9df47-148">С помощью этой формулы автомасштабирования hello изначально создается пул с одной виртуальной Машины.</span><span class="sxs-lookup"><span data-stu-id="9df47-148">With this autoscale formula, hello pool is initially created with a single VM.</span></span> <span data-ttu-id="9df47-149">Hello `$PendingTasks` метрика определяет hello число задач, которые запущены или в очереди.</span><span class="sxs-lookup"><span data-stu-id="9df47-149">hello `$PendingTasks` metric defines hello number of tasks that are running or queued.</span></span> <span data-ttu-id="9df47-150">Формула Hello находит hello среднее число ожидающих задач в hello последние 180 секунд и задает hello `$TargetDedicatedNodes` переменной соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="9df47-150">hello formula finds hello average number of pending tasks in hello last 180 seconds and sets hello `$TargetDedicatedNodes` variable accordingly.</span></span> <span data-ttu-id="9df47-151">Формула Hello гарантирует, что hello целевое количество выделенных узлов никогда не превышает 25 виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="9df47-151">hello formula ensures that hello target number of dedicated nodes never exceeds 25 VMs.</span></span> <span data-ttu-id="9df47-152">Отправлены новые задачи, hello пул автоматически увеличивается.</span><span class="sxs-lookup"><span data-stu-id="9df47-152">As new tasks are submitted, hello pool automatically grows.</span></span> <span data-ttu-id="9df47-153">Как задачи завершения виртуальные машины станут свободного по одному и формулы автомасштабирования hello уменьшается hello пула.</span><span class="sxs-lookup"><span data-stu-id="9df47-153">As tasks complete, VMs become free one by one and hello autoscaling formula shrinks hello pool.</span></span>

## <a name="variables"></a><span data-ttu-id="9df47-154">Переменные</span><span class="sxs-lookup"><span data-stu-id="9df47-154">Variables</span></span>
<span data-ttu-id="9df47-155">В формуле автоматического масштабирования можно использовать как **служебные**, так и **пользовательские** переменные.</span><span class="sxs-lookup"><span data-stu-id="9df47-155">You can use both **service-defined** and **user-defined** variables in your autoscale formulas.</span></span> <span data-ttu-id="9df47-156">переменные, определенные службы Hello строятся в toohello пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="9df47-156">hello service-defined variables are built in toohello Batch service.</span></span> <span data-ttu-id="9df47-157">Некоторые из них доступны для чтения и записи, а некоторые — только для чтения.</span><span class="sxs-lookup"><span data-stu-id="9df47-157">Some service-defined variables are read-write, and some are read-only.</span></span> <span data-ttu-id="9df47-158">Пользовательские переменные — это переменные, которые определяете вы.</span><span class="sxs-lookup"><span data-stu-id="9df47-158">User-defined variables are variables that you define.</span></span> <span data-ttu-id="9df47-159">В hello формулы из примера показано в предыдущем разделе hello `$TargetDedicatedNodes` и `$PendingTasks` — это переменные, определенные службы.</span><span class="sxs-lookup"><span data-stu-id="9df47-159">In hello example formula shown in hello previous section, `$TargetDedicatedNodes` and `$PendingTasks` are service-defined variables.</span></span> <span data-ttu-id="9df47-160">Переменные `startingNumberOfVMs` и `maxNumberofVMs` — это переменные, определяемые пользователем.</span><span class="sxs-lookup"><span data-stu-id="9df47-160">Variables `startingNumberOfVMs` and `maxNumberofVMs` are user-defined variables.</span></span>

> [!NOTE]
> <span data-ttu-id="9df47-161">Служебные переменные всегда начинаются с символа доллара ($).</span><span class="sxs-lookup"><span data-stu-id="9df47-161">Service-defined variables are always preceded by a dollar sign ($).</span></span> <span data-ttu-id="9df47-162">Для определяемых пользователем переменных hello доллара является необязательным.</span><span class="sxs-lookup"><span data-stu-id="9df47-162">For user-defined variables, hello dollar sign is optional.</span></span>
>
>

<span data-ttu-id="9df47-163">Hello следующие таблицы показывают и операции чтения записи и переменные только для чтения, которые определены в hello пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="9df47-163">hello following tables show both read-write and read-only variables that are defined by hello Batch service.</span></span>

<span data-ttu-id="9df47-164">Можно получить и задать hello значения этих переменных, определяемых службы toomanage hello количество вычислительных узлов в пуле:</span><span class="sxs-lookup"><span data-stu-id="9df47-164">You can get and set hello values of these service-defined variables toomanage hello number of compute nodes in a pool:</span></span>

| <span data-ttu-id="9df47-165">Определяемые службой переменные для чтения и записи</span><span class="sxs-lookup"><span data-stu-id="9df47-165">Read-write service-defined variables</span></span> | <span data-ttu-id="9df47-166">Описание</span><span class="sxs-lookup"><span data-stu-id="9df47-166">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9df47-167">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="9df47-167">$TargetDedicatedNodes</span></span> |<span data-ttu-id="9df47-168">Hello целевое количество выделенных вычислительных узлов для пула hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-168">hello target number of dedicated compute nodes for hello pool.</span></span> <span data-ttu-id="9df47-169">Hello количество выделенных узлов задается как целевой объект, поскольку пул может не всегда произойдет hello требуемого числа узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-169">hello number of dedicated nodes is specified as a target because a pool may not always achieve hello desired number of nodes.</span></span> <span data-ttu-id="9df47-170">Например при изменении hello целевое количество выделенных узлов с ознакомительной версии до hello автомасштабирования пула достигнуто hello начального целевого объекта, а затем hello пула не могут достичь цели hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-170">For example, if hello target number of dedicated nodes is modified by an autoscale evaluation before hello pool has reached hello initial target, then hello pool may not reach hello target.</span></span> <br /><br /> <span data-ttu-id="9df47-171">Пула в создании учетной записи с конфигурацией службы Batch hello может достичь своей цели не в том случае, если целевой hello превышает квоту на узел или core учетной записи пакета.</span><span class="sxs-lookup"><span data-stu-id="9df47-171">A pool in an account created with hello Batch Service configuration may not achieve its target if hello target exceeds a Batch account node or core quota.</span></span> <span data-ttu-id="9df47-172">Пул в создании учетной записи с конфигурацией hello подписки пользователя может достичь своей цели не в том случае, если целевой hello превышает квоту общее ядро hello для hello подписки.</span><span class="sxs-lookup"><span data-stu-id="9df47-172">A pool in an account created with hello User Subscription configuration may not achieve its target if hello target exceeds hello shared core quota for hello subscription.</span></span>|
| <span data-ttu-id="9df47-173">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="9df47-173">$TargetLowPriorityNodes</span></span> |<span data-ttu-id="9df47-174">Hello целевое количество низкоприоритетных вычислительных узлов для пула hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-174">hello target number of low-priority compute nodes for hello pool.</span></span> <span data-ttu-id="9df47-175">Hello количество узлов низкоприоритетных задается как целевой объект, поскольку пул может не всегда произойдет hello требуемого числа узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-175">hello number of low-priority nodes is specified as a target because a pool may not always achieve hello desired number of nodes.</span></span> <span data-ttu-id="9df47-176">Например hello целевое количество узлов с низким приоритетом при изменении по ознакомительной версии до hello автомасштабирования пула достигнуто hello начального целевого объекта, а затем hello пула не могут достичь цели hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-176">For example, if hello target number of low-priority nodes is modified by an autoscale evaluation before hello pool has reached hello initial target, then hello pool may not reach hello target.</span></span> <span data-ttu-id="9df47-177">Пул также не добиться своей цели Если целевой hello превышает квоту на узел или core учетной записи пакета.</span><span class="sxs-lookup"><span data-stu-id="9df47-177">A pool may also not achieve its target if hello target exceeds a Batch account node or core quota.</span></span> <br /><br /> <span data-ttu-id="9df47-178">Дополнительные сведения о вычислительных узлах с низким приоритетом см. в статье [Использование низкоприоритетных виртуальных машин в пакетной службе (предварительная версия)](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="9df47-178">For more information on low-priority compute nodes, see [Use low-priority VMs with Batch (Preview)](batch-low-pri-vms.md).</span></span> |
| <span data-ttu-id="9df47-179">$NodeDeallocationOption</span><span class="sxs-lookup"><span data-stu-id="9df47-179">$NodeDeallocationOption</span></span> |<span data-ttu-id="9df47-180">Действие Hello, которое возникает, когда вычислительные узлы удаляются из пула.</span><span class="sxs-lookup"><span data-stu-id="9df47-180">hello action that occurs when compute nodes are removed from a pool.</span></span> <span data-ttu-id="9df47-181">Возможные значения:</span><span class="sxs-lookup"><span data-stu-id="9df47-181">Possible values are:</span></span><ul><li><span data-ttu-id="9df47-182">**повторной постановки в очередь**--немедленно прекращает задачи и помещает их обратно в очередь задания hello, чтобы они были заново запланированы.</span><span class="sxs-lookup"><span data-stu-id="9df47-182">**requeue**--Terminates tasks immediately and puts them back on hello job queue so that they are rescheduled.</span></span><li><span data-ttu-id="9df47-183">**Завершение**--немедленно прекращает задачи и удаляет их из очереди заданий hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-183">**terminate**--Terminates tasks immediately and removes them from hello job queue.</span></span><li><span data-ttu-id="9df47-184">**taskcompletion**--ожидает, пока в настоящее время задачи toofinish и затем удаляет узел hello из пула hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-184">**taskcompletion**--Waits for currently running tasks toofinish and then removes hello node from hello pool.</span></span><li><span data-ttu-id="9df47-185">**retaineddata**--ожидает все hello локальные задачи сохраняются данные на узел toobe hello очистки, перед удалением узла hello из пула hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-185">**retaineddata**--Waits for all hello local task-retained data on hello node toobe cleaned up before removing hello node from hello pool.</span></span></ul> |

<span data-ttu-id="9df47-186">Можно получить значение hello корректировок toomake эти переменные, определенные службы, с учетом показателей hello пакетной службы:</span><span class="sxs-lookup"><span data-stu-id="9df47-186">You can get hello value of these service-defined variables toomake adjustments that are based on metrics from hello Batch service:</span></span>

| <span data-ttu-id="9df47-187">Определяемые службой переменные только для чтения</span><span class="sxs-lookup"><span data-stu-id="9df47-187">Read-only service-defined variables</span></span> | <span data-ttu-id="9df47-188">Описание</span><span class="sxs-lookup"><span data-stu-id="9df47-188">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9df47-189">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="9df47-189">$CPUPercent</span></span> |<span data-ttu-id="9df47-190">Hello средний процент использования ЦП.</span><span class="sxs-lookup"><span data-stu-id="9df47-190">hello average percentage of CPU usage.</span></span> |
| <span data-ttu-id="9df47-191">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="9df47-191">$WallClockSeconds</span></span> |<span data-ttu-id="9df47-192">число секунд потребляет Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-192">hello number of seconds consumed.</span></span> |
| <span data-ttu-id="9df47-193">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-193">$MemoryBytes</span></span> |<span data-ttu-id="9df47-194">Среднее число мегабайт используется Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-194">hello average number of megabytes used.</span></span> |
| <span data-ttu-id="9df47-195">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-195">$DiskBytes</span></span> |<span data-ttu-id="9df47-196">Среднее число гигабайт, используемых на локальных дисках hello Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-196">hello average number of gigabytes used on hello local disks.</span></span> |
| <span data-ttu-id="9df47-197">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-197">$DiskReadBytes</span></span> |<span data-ttu-id="9df47-198">Hello число считанных байтов.</span><span class="sxs-lookup"><span data-stu-id="9df47-198">hello number of bytes read.</span></span> |
| <span data-ttu-id="9df47-199">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-199">$DiskWriteBytes</span></span> |<span data-ttu-id="9df47-200">Hello число записанных байтов.</span><span class="sxs-lookup"><span data-stu-id="9df47-200">hello number of bytes written.</span></span> |
| <span data-ttu-id="9df47-201">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="9df47-201">$DiskReadOps</span></span> |<span data-ttu-id="9df47-202">выполнить Hello число операций чтения с диска.</span><span class="sxs-lookup"><span data-stu-id="9df47-202">hello count of read disk operations performed.</span></span> |
| <span data-ttu-id="9df47-203">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="9df47-203">$DiskWriteOps</span></span> |<span data-ttu-id="9df47-204">Количество операций записи диска Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-204">hello count of write disk operations performed.</span></span> |
| <span data-ttu-id="9df47-205">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-205">$NetworkInBytes</span></span> |<span data-ttu-id="9df47-206">число входящих байтов Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-206">hello number of inbound bytes.</span></span> |
| <span data-ttu-id="9df47-207">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-207">$NetworkOutBytes</span></span> |<span data-ttu-id="9df47-208">число исходящих байтов Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-208">hello number of outbound bytes.</span></span> |
| <span data-ttu-id="9df47-209">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="9df47-209">$SampleNodeCount</span></span> |<span data-ttu-id="9df47-210">Hello количество вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-210">hello count of compute nodes.</span></span> |
| <span data-ttu-id="9df47-211">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-211">$ActiveTasks</span></span> |<span data-ttu-id="9df47-212">Hello число задач, которые являются tooexecute готовности, но еще не запущена.</span><span class="sxs-lookup"><span data-stu-id="9df47-212">hello number of tasks that are ready tooexecute but are not yet executing.</span></span> <span data-ttu-id="9df47-213">Hello $ActiveTasks счетчик учитывает все задачи, находящиеся в активном состоянии hello и которого зависимости были выполнены.</span><span class="sxs-lookup"><span data-stu-id="9df47-213">hello $ActiveTasks count includes all tasks that are in hello active state and whose dependencies have been satisfied.</span></span> <span data-ttu-id="9df47-214">Все задачи, находящихся в активном состоянии hello, но не удовлетворены, зависимости которого исключаются из hello $ActiveTasks count.</span><span class="sxs-lookup"><span data-stu-id="9df47-214">Any tasks that are in hello active state but whose dependencies have not been satisfied are excluded from hello $ActiveTasks count.</span></span>|
| <span data-ttu-id="9df47-215">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-215">$RunningTasks</span></span> |<span data-ttu-id="9df47-216">Hello число задач в состоянии выполнения.</span><span class="sxs-lookup"><span data-stu-id="9df47-216">hello number of tasks in a running state.</span></span> |
| <span data-ttu-id="9df47-217">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-217">$PendingTasks</span></span> |<span data-ttu-id="9df47-218">Сумма Hello $ActiveTasks и $RunningTasks.</span><span class="sxs-lookup"><span data-stu-id="9df47-218">hello sum of $ActiveTasks and $RunningTasks.</span></span> |
| <span data-ttu-id="9df47-219">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-219">$SucceededTasks</span></span> |<span data-ttu-id="9df47-220">Количество успешно завершенных задач Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-220">hello number of tasks that finished successfully.</span></span> |
| <span data-ttu-id="9df47-221">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-221">$FailedTasks</span></span> |<span data-ttu-id="9df47-222">число задач, которые не удалось выполнить Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-222">hello number of tasks that failed.</span></span> |
| <span data-ttu-id="9df47-223">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="9df47-223">$CurrentDedicatedNodes</span></span> |<span data-ttu-id="9df47-224">Привет текущее количество выделенных вычислительных узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-224">hello current number of dedicated compute nodes.</span></span> |
| <span data-ttu-id="9df47-225">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="9df47-225">$CurrentLowPriorityNodes</span></span> |<span data-ttu-id="9df47-226">Текущее количество Hello низкоприоритетных вычислительных узлов, включая все узлы, которые были pre-empted.</span><span class="sxs-lookup"><span data-stu-id="9df47-226">hello current number of low-priority compute nodes, including any nodes that have been pre-empted.</span></span> |
| <span data-ttu-id="9df47-227">$PreemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="9df47-227">$PreemptedNodeCount</span></span> | <span data-ttu-id="9df47-228">количество узлов в пул hello, которые находятся в состоянии pre-empted Hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-228">hello number of nodes in hello pool that are in a pre-empted state.</span></span> |

> [!TIP]
> <span data-ttu-id="9df47-229">Hello только для чтения, определяемый службой переменные, указанные в предыдущей таблице hello, *объектов* различные методы, обеспечивающие tooaccess данные, связанные с каждым.</span><span class="sxs-lookup"><span data-stu-id="9df47-229">hello read-only, service-defined variables that are shown in hello previous table are *objects* that provide various methods tooaccess data associated with each.</span></span> <span data-ttu-id="9df47-230">Дополнительные сведения см. в разделе [Получение выборки данных](#getsampledata) далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="9df47-230">For more information, see [Obtain sample data](#getsampledata) later in this article.</span></span>
>
>

## <a name="types"></a><span data-ttu-id="9df47-231">Типы</span><span class="sxs-lookup"><span data-stu-id="9df47-231">Types</span></span>
<span data-ttu-id="9df47-232">В формуле поддерживаются следующие типы:</span><span class="sxs-lookup"><span data-stu-id="9df47-232">These types are supported in a formula:</span></span>

* <span data-ttu-id="9df47-233">double</span><span class="sxs-lookup"><span data-stu-id="9df47-233">double</span></span>
* <span data-ttu-id="9df47-234">doubleVec</span><span class="sxs-lookup"><span data-stu-id="9df47-234">doubleVec</span></span>
* <span data-ttu-id="9df47-235">doubleVecList</span><span class="sxs-lookup"><span data-stu-id="9df47-235">doubleVecList</span></span>
* <span data-ttu-id="9df47-236">string</span><span class="sxs-lookup"><span data-stu-id="9df47-236">string</span></span>
* <span data-ttu-id="9df47-237">Отметка времени — отметка времени расположена комплексной структуру, содержащую hello следующие члены:</span><span class="sxs-lookup"><span data-stu-id="9df47-237">timestamp--timestamp is a compound structure that contains hello following members:</span></span>

  * <span data-ttu-id="9df47-238">year</span><span class="sxs-lookup"><span data-stu-id="9df47-238">year</span></span>
  * <span data-ttu-id="9df47-239">month (1-12)</span><span class="sxs-lookup"><span data-stu-id="9df47-239">month (1-12)</span></span>
  * <span data-ttu-id="9df47-240">day (1-31)</span><span class="sxs-lookup"><span data-stu-id="9df47-240">day (1-31)</span></span>
  * <span data-ttu-id="9df47-241">день недели (в формате hello числа; например, 1 — понедельник)</span><span class="sxs-lookup"><span data-stu-id="9df47-241">weekday (in hello format of number; for example, 1 for Monday)</span></span>
  * <span data-ttu-id="9df47-242">hour (час в 24-часовом формате, например 13 соответствует 13:00)</span><span class="sxs-lookup"><span data-stu-id="9df47-242">hour (in 24-hour number format; for example, 13 means 1 PM)</span></span>
  * <span data-ttu-id="9df47-243">minute (00–59)</span><span class="sxs-lookup"><span data-stu-id="9df47-243">minute (00-59)</span></span>
  * <span data-ttu-id="9df47-244">second (00–59)</span><span class="sxs-lookup"><span data-stu-id="9df47-244">second (00-59)</span></span>
* <span data-ttu-id="9df47-245">timeInterval</span><span class="sxs-lookup"><span data-stu-id="9df47-245">timeinterval</span></span>

  * <span data-ttu-id="9df47-246">TimeInterval_Zero</span><span class="sxs-lookup"><span data-stu-id="9df47-246">TimeInterval_Zero</span></span>
  * <span data-ttu-id="9df47-247">TimeInterval_100ns</span><span class="sxs-lookup"><span data-stu-id="9df47-247">TimeInterval_100ns</span></span>
  * <span data-ttu-id="9df47-248">TimeInterval_Microsecond</span><span class="sxs-lookup"><span data-stu-id="9df47-248">TimeInterval_Microsecond</span></span>
  * <span data-ttu-id="9df47-249">TimeInterval_Millisecond</span><span class="sxs-lookup"><span data-stu-id="9df47-249">TimeInterval_Millisecond</span></span>
  * <span data-ttu-id="9df47-250">TimeInterval_Second</span><span class="sxs-lookup"><span data-stu-id="9df47-250">TimeInterval_Second</span></span>
  * <span data-ttu-id="9df47-251">TimeInterval_Minute</span><span class="sxs-lookup"><span data-stu-id="9df47-251">TimeInterval_Minute</span></span>
  * <span data-ttu-id="9df47-252">TimeInterval_Hour</span><span class="sxs-lookup"><span data-stu-id="9df47-252">TimeInterval_Hour</span></span>
  * <span data-ttu-id="9df47-253">TimeInterval_Day</span><span class="sxs-lookup"><span data-stu-id="9df47-253">TimeInterval_Day</span></span>
  * <span data-ttu-id="9df47-254">TimeInterval_Week</span><span class="sxs-lookup"><span data-stu-id="9df47-254">TimeInterval_Week</span></span>
  * <span data-ttu-id="9df47-255">TimeInterval_Year</span><span class="sxs-lookup"><span data-stu-id="9df47-255">TimeInterval_Year</span></span>

## <a name="operations"></a><span data-ttu-id="9df47-256">Операции</span><span class="sxs-lookup"><span data-stu-id="9df47-256">Operations</span></span>
<span data-ttu-id="9df47-257">Эти операции допустимы для hello типов, перечисленных в предыдущем разделе hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-257">These operations are allowed on hello types that are listed in hello previous section.</span></span>

| <span data-ttu-id="9df47-258">Операция</span><span class="sxs-lookup"><span data-stu-id="9df47-258">Operation</span></span> | <span data-ttu-id="9df47-259">Поддерживаемые операторы</span><span class="sxs-lookup"><span data-stu-id="9df47-259">Supported operators</span></span> | <span data-ttu-id="9df47-260">Тип результата</span><span class="sxs-lookup"><span data-stu-id="9df47-260">Result type</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9df47-261">double *оператор* double</span><span class="sxs-lookup"><span data-stu-id="9df47-261">double *operator* double</span></span> |<span data-ttu-id="9df47-262">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="9df47-262">+, -, *, /</span></span> |<span data-ttu-id="9df47-263">double</span><span class="sxs-lookup"><span data-stu-id="9df47-263">double</span></span> |
| <span data-ttu-id="9df47-264">double *оператор* timeinterval</span><span class="sxs-lookup"><span data-stu-id="9df47-264">double *operator* timeinterval</span></span> |* |<span data-ttu-id="9df47-265">timeInterval</span><span class="sxs-lookup"><span data-stu-id="9df47-265">timeinterval</span></span> |
| <span data-ttu-id="9df47-266">doubleVec *оператор* double</span><span class="sxs-lookup"><span data-stu-id="9df47-266">doubleVec *operator* double</span></span> |<span data-ttu-id="9df47-267">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="9df47-267">+, -, *, /</span></span> |<span data-ttu-id="9df47-268">doubleVec</span><span class="sxs-lookup"><span data-stu-id="9df47-268">doubleVec</span></span> |
| <span data-ttu-id="9df47-269">doubleVec *оператор* doubleVec</span><span class="sxs-lookup"><span data-stu-id="9df47-269">doubleVec *operator* doubleVec</span></span> |<span data-ttu-id="9df47-270">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="9df47-270">+, -, *, /</span></span> |<span data-ttu-id="9df47-271">doubleVec</span><span class="sxs-lookup"><span data-stu-id="9df47-271">doubleVec</span></span> |
| <span data-ttu-id="9df47-272">timeinterval *оператор* double</span><span class="sxs-lookup"><span data-stu-id="9df47-272">timeinterval *operator* double</span></span> |<span data-ttu-id="9df47-273">*, /</span><span class="sxs-lookup"><span data-stu-id="9df47-273">*, /</span></span> |<span data-ttu-id="9df47-274">timeInterval</span><span class="sxs-lookup"><span data-stu-id="9df47-274">timeinterval</span></span> |
| <span data-ttu-id="9df47-275">timeinterval *оператор* timeinterval</span><span class="sxs-lookup"><span data-stu-id="9df47-275">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="9df47-276">+, -</span><span class="sxs-lookup"><span data-stu-id="9df47-276">+, -</span></span> |<span data-ttu-id="9df47-277">timeInterval</span><span class="sxs-lookup"><span data-stu-id="9df47-277">timeinterval</span></span> |
| <span data-ttu-id="9df47-278">timeinterval *оператор* timestamp</span><span class="sxs-lookup"><span data-stu-id="9df47-278">timeinterval *operator* timestamp</span></span> |+ |<span data-ttu-id="9df47-279">timestamp</span><span class="sxs-lookup"><span data-stu-id="9df47-279">timestamp</span></span> |
| <span data-ttu-id="9df47-280">timestamp *оператор* timeinterval</span><span class="sxs-lookup"><span data-stu-id="9df47-280">timestamp *operator* timeinterval</span></span> |+ |<span data-ttu-id="9df47-281">timestamp</span><span class="sxs-lookup"><span data-stu-id="9df47-281">timestamp</span></span> |
| <span data-ttu-id="9df47-282">timestamp *оператор* timestamp</span><span class="sxs-lookup"><span data-stu-id="9df47-282">timestamp *operator* timestamp</span></span> |- |<span data-ttu-id="9df47-283">timeInterval</span><span class="sxs-lookup"><span data-stu-id="9df47-283">timeinterval</span></span> |
| <span data-ttu-id="9df47-284">*оператор*double</span><span class="sxs-lookup"><span data-stu-id="9df47-284">*operator*double</span></span> |<span data-ttu-id="9df47-285">-, !</span><span class="sxs-lookup"><span data-stu-id="9df47-285">-, !</span></span> |<span data-ttu-id="9df47-286">double</span><span class="sxs-lookup"><span data-stu-id="9df47-286">double</span></span> |
| <span data-ttu-id="9df47-287">*оператор*timeInterval</span><span class="sxs-lookup"><span data-stu-id="9df47-287">*operator*timeinterval</span></span> |- |<span data-ttu-id="9df47-288">timeInterval</span><span class="sxs-lookup"><span data-stu-id="9df47-288">timeinterval</span></span> |
| <span data-ttu-id="9df47-289">double *оператор* double</span><span class="sxs-lookup"><span data-stu-id="9df47-289">double *operator* double</span></span> |<span data-ttu-id="9df47-290"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="9df47-290"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="9df47-291">double</span><span class="sxs-lookup"><span data-stu-id="9df47-291">double</span></span> |
| <span data-ttu-id="9df47-292">string *оператор* string</span><span class="sxs-lookup"><span data-stu-id="9df47-292">string *operator* string</span></span> |<span data-ttu-id="9df47-293"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="9df47-293"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="9df47-294">double</span><span class="sxs-lookup"><span data-stu-id="9df47-294">double</span></span> |
| <span data-ttu-id="9df47-295">timestamp *оператор* timestamp</span><span class="sxs-lookup"><span data-stu-id="9df47-295">timestamp *operator* timestamp</span></span> |<span data-ttu-id="9df47-296"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="9df47-296"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="9df47-297">double</span><span class="sxs-lookup"><span data-stu-id="9df47-297">double</span></span> |
| <span data-ttu-id="9df47-298">timeinterval *оператор* timeinterval</span><span class="sxs-lookup"><span data-stu-id="9df47-298">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="9df47-299"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="9df47-299"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="9df47-300">double</span><span class="sxs-lookup"><span data-stu-id="9df47-300">double</span></span> |
| <span data-ttu-id="9df47-301">double *оператор* double</span><span class="sxs-lookup"><span data-stu-id="9df47-301">double *operator* double</span></span> |<span data-ttu-id="9df47-302">&&, &#124;&#124;</span><span class="sxs-lookup"><span data-stu-id="9df47-302">&&, &#124;&#124;</span></span> |<span data-ttu-id="9df47-303">double</span><span class="sxs-lookup"><span data-stu-id="9df47-303">double</span></span> |

<span data-ttu-id="9df47-304">При тестировании double с тернарным оператором (`double ? statement1 : statement2`) ненулевое значение равно **true**, а нулевое — **false**.</span><span class="sxs-lookup"><span data-stu-id="9df47-304">When testing a double with a ternary operator (`double ? statement1 : statement2`), nonzero is **true**, and zero is **false**.</span></span>

## <a name="functions"></a><span data-ttu-id="9df47-305">Функции</span><span class="sxs-lookup"><span data-stu-id="9df47-305">Functions</span></span>
<span data-ttu-id="9df47-306">Эти предопределенные **функции** доступны для toouse при определении формулы автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-306">These predefined **functions** are available for you toouse in defining an automatic scaling formula.</span></span>

| <span data-ttu-id="9df47-307">Функция</span><span class="sxs-lookup"><span data-stu-id="9df47-307">Function</span></span> | <span data-ttu-id="9df47-308">Тип возвращаемого значения</span><span class="sxs-lookup"><span data-stu-id="9df47-308">Return type</span></span> | <span data-ttu-id="9df47-309">Описание</span><span class="sxs-lookup"><span data-stu-id="9df47-309">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9df47-310">avg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-310">avg(doubleVecList)</span></span> |<span data-ttu-id="9df47-311">double</span><span class="sxs-lookup"><span data-stu-id="9df47-311">double</span></span> |<span data-ttu-id="9df47-312">Возвращает hello среднее значение для всех значений в hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="9df47-312">Returns hello average value for all values in hello doubleVecList.</span></span> |
| <span data-ttu-id="9df47-313">len(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-313">len(doubleVecList)</span></span> |<span data-ttu-id="9df47-314">double</span><span class="sxs-lookup"><span data-stu-id="9df47-314">double</span></span> |<span data-ttu-id="9df47-315">Возвращает hello длины hello вектора, созданного из hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="9df47-315">Returns hello length of hello vector that is created from hello doubleVecList.</span></span> |
| <span data-ttu-id="9df47-316">lg(double)</span><span class="sxs-lookup"><span data-stu-id="9df47-316">lg(double)</span></span> |<span data-ttu-id="9df47-317">double</span><span class="sxs-lookup"><span data-stu-id="9df47-317">double</span></span> |<span data-ttu-id="9df47-318">Возвращает журнал hello основанию 2 от hello double.</span><span class="sxs-lookup"><span data-stu-id="9df47-318">Returns hello log base 2 of hello double.</span></span> |
| <span data-ttu-id="9df47-319">lg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-319">lg(doubleVecList)</span></span> |<span data-ttu-id="9df47-320">doubleVec</span><span class="sxs-lookup"><span data-stu-id="9df47-320">doubleVec</span></span> |<span data-ttu-id="9df47-321">Возвращает базовый 2 hello doubleVecList hello component-wise журнала.</span><span class="sxs-lookup"><span data-stu-id="9df47-321">Returns hello component-wise log base 2 of hello doubleVecList.</span></span> <span data-ttu-id="9df47-322">Vec(double) должно быть явно передано для параметра hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-322">A vec(double) must be explicitly passed for hello parameter.</span></span> <span data-ttu-id="9df47-323">В противном случае подразумевается версия double lg(double) hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-323">Otherwise, hello double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="9df47-324">ln(double)</span><span class="sxs-lookup"><span data-stu-id="9df47-324">ln(double)</span></span> |<span data-ttu-id="9df47-325">double</span><span class="sxs-lookup"><span data-stu-id="9df47-325">double</span></span> |<span data-ttu-id="9df47-326">Возвращает hello натуральный логарифм hello double.</span><span class="sxs-lookup"><span data-stu-id="9df47-326">Returns hello natural log of hello double.</span></span> |
| <span data-ttu-id="9df47-327">ln(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-327">ln(doubleVecList)</span></span> |<span data-ttu-id="9df47-328">doubleVec</span><span class="sxs-lookup"><span data-stu-id="9df47-328">doubleVec</span></span> |<span data-ttu-id="9df47-329">Возвращает базовый 2 hello doubleVecList hello component-wise журнала.</span><span class="sxs-lookup"><span data-stu-id="9df47-329">Returns hello component-wise log base 2 of hello doubleVecList.</span></span> <span data-ttu-id="9df47-330">Vec(double) должно быть явно передано для параметра hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-330">A vec(double) must be explicitly passed for hello parameter.</span></span> <span data-ttu-id="9df47-331">В противном случае подразумевается версия double lg(double) hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-331">Otherwise, hello double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="9df47-332">log(double)</span><span class="sxs-lookup"><span data-stu-id="9df47-332">log(double)</span></span> |<span data-ttu-id="9df47-333">double</span><span class="sxs-lookup"><span data-stu-id="9df47-333">double</span></span> |<span data-ttu-id="9df47-334">Возвращает журнал hello основание 10 hello double.</span><span class="sxs-lookup"><span data-stu-id="9df47-334">Returns hello log base 10 of hello double.</span></span> |
| <span data-ttu-id="9df47-335">log(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-335">log(doubleVecList)</span></span> |<span data-ttu-id="9df47-336">doubleVec</span><span class="sxs-lookup"><span data-stu-id="9df47-336">doubleVec</span></span> |<span data-ttu-id="9df47-337">Возвращает основание 10 hello doubleVecList hello component-wise журнала.</span><span class="sxs-lookup"><span data-stu-id="9df47-337">Returns hello component-wise log base 10 of hello doubleVecList.</span></span> <span data-ttu-id="9df47-338">Vec(double) должно быть явно передано для единственного параметра double hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-338">A vec(double) must be explicitly passed for hello single double parameter.</span></span> <span data-ttu-id="9df47-339">В противном случае подразумевается версия double log(double) hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-339">Otherwise, hello double log(double) version is assumed.</span></span> |
| <span data-ttu-id="9df47-340">max(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-340">max(doubleVecList)</span></span> |<span data-ttu-id="9df47-341">double</span><span class="sxs-lookup"><span data-stu-id="9df47-341">double</span></span> |<span data-ttu-id="9df47-342">Возвращает hello максимальное значение в hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="9df47-342">Returns hello maximum value in hello doubleVecList.</span></span> |
| <span data-ttu-id="9df47-343">min(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-343">min(doubleVecList)</span></span> |<span data-ttu-id="9df47-344">double</span><span class="sxs-lookup"><span data-stu-id="9df47-344">double</span></span> |<span data-ttu-id="9df47-345">Возвращает hello минимальное значение в hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="9df47-345">Returns hello minimum value in hello doubleVecList.</span></span> |
| <span data-ttu-id="9df47-346">norm(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-346">norm(doubleVecList)</span></span> |<span data-ttu-id="9df47-347">double</span><span class="sxs-lookup"><span data-stu-id="9df47-347">double</span></span> |<span data-ttu-id="9df47-348">Возвращает hello норма hello вектора, созданного из hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="9df47-348">Returns hello two-norm of hello vector that is created from hello doubleVecList.</span></span> |
| <span data-ttu-id="9df47-349">percentile(doubleVec v, double p)</span><span class="sxs-lookup"><span data-stu-id="9df47-349">percentile(doubleVec v, double p)</span></span> |<span data-ttu-id="9df47-350">double</span><span class="sxs-lookup"><span data-stu-id="9df47-350">double</span></span> |<span data-ttu-id="9df47-351">Возвращает hello элемент percentile вектора hello v.</span><span class="sxs-lookup"><span data-stu-id="9df47-351">Returns hello percentile element of hello vector v.</span></span> |
| <span data-ttu-id="9df47-352">rand()</span><span class="sxs-lookup"><span data-stu-id="9df47-352">rand()</span></span> |<span data-ttu-id="9df47-353">double</span><span class="sxs-lookup"><span data-stu-id="9df47-353">double</span></span> |<span data-ttu-id="9df47-354">Возвращает случайное значение от 0,0 до 1,0.</span><span class="sxs-lookup"><span data-stu-id="9df47-354">Returns a random value between 0.0 and 1.0.</span></span> |
| <span data-ttu-id="9df47-355">range(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-355">range(doubleVecList)</span></span> |<span data-ttu-id="9df47-356">double</span><span class="sxs-lookup"><span data-stu-id="9df47-356">double</span></span> |<span data-ttu-id="9df47-357">Возвращает разность hello hello минимальным и максимальным значениями в hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="9df47-357">Returns hello difference between hello min and max values in hello doubleVecList.</span></span> |
| <span data-ttu-id="9df47-358">std(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-358">std(doubleVecList)</span></span> |<span data-ttu-id="9df47-359">double</span><span class="sxs-lookup"><span data-stu-id="9df47-359">double</span></span> |<span data-ttu-id="9df47-360">Возвращает hello среднеквадратичное отклонение выборки для hello значений в hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="9df47-360">Returns hello sample standard deviation of hello values in hello doubleVecList.</span></span> |
| <span data-ttu-id="9df47-361">stop()</span><span class="sxs-lookup"><span data-stu-id="9df47-361">stop()</span></span> | |<span data-ttu-id="9df47-362">Остановка вычисления выражения автоматического масштабирования hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-362">Stops evaluation of hello autoscaling expression.</span></span> |
| <span data-ttu-id="9df47-363">sum(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="9df47-363">sum(doubleVecList)</span></span> |<span data-ttu-id="9df47-364">double</span><span class="sxs-lookup"><span data-stu-id="9df47-364">double</span></span> |<span data-ttu-id="9df47-365">Возвращает hello сумма всех компонентов hello doubleVecList hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-365">Returns hello sum of all hello components of hello doubleVecList.</span></span> |
| <span data-ttu-id="9df47-366">time(string dateTime="")</span><span class="sxs-lookup"><span data-stu-id="9df47-366">time(string dateTime="")</span></span> |<span data-ttu-id="9df47-367">Timestamp</span><span class="sxs-lookup"><span data-stu-id="9df47-367">timestamp</span></span> |<span data-ttu-id="9df47-368">Возвращает отметку времени hello hello текущее время, если параметры не передаются или hello отметку времени строка hello даты и времени, если он передается.</span><span class="sxs-lookup"><span data-stu-id="9df47-368">Returns hello time stamp of hello current time if no parameters are passed, or hello time stamp of hello dateTime string if it is passed.</span></span> <span data-ttu-id="9df47-369">Поддерживаемые форматы даты и времени: W3C-DTF и RFC 1123.</span><span class="sxs-lookup"><span data-stu-id="9df47-369">Supported dateTime formats are W3C-DTF and RFC 1123.</span></span> |
| <span data-ttu-id="9df47-370">val(doubleVec v, double i)</span><span class="sxs-lookup"><span data-stu-id="9df47-370">val(doubleVec v, double i)</span></span> |<span data-ttu-id="9df47-371">double</span><span class="sxs-lookup"><span data-stu-id="9df47-371">double</span></span> |<span data-ttu-id="9df47-372">Возвращает значение hello hello элемента, который находится в расположении i в векторе v с начальным индексом 0.</span><span class="sxs-lookup"><span data-stu-id="9df47-372">Returns hello value of hello element that is at location i in vector v, with a starting index of zero.</span></span> |

<span data-ttu-id="9df47-373">Некоторые из функций hello, описанных в предыдущей таблице hello могут принимать список в качестве аргумента.</span><span class="sxs-lookup"><span data-stu-id="9df47-373">Some of hello functions that are described in hello previous table can accept a list as an argument.</span></span> <span data-ttu-id="9df47-374">Разделенный запятыми список Hello — это любое сочетание *двойные* и *doubleVec*.</span><span class="sxs-lookup"><span data-stu-id="9df47-374">hello comma-separated list is any combination of *double* and *doubleVec*.</span></span> <span data-ttu-id="9df47-375">Например:</span><span class="sxs-lookup"><span data-stu-id="9df47-375">For example:</span></span>

`doubleVecList := ( (double | doubleVec)+(, (double | doubleVec) )* )?`

<span data-ttu-id="9df47-376">Hello *doubleVecList* значение — один преобразованный tooa *doubleVec* до оценки.</span><span class="sxs-lookup"><span data-stu-id="9df47-376">hello *doubleVecList* value is converted tooa single *doubleVec* before evaluation.</span></span> <span data-ttu-id="9df47-377">Например если `v = [1,2,3]`, затем вызвать `avg(v)` — эквивалент toocalling `avg(1,2,3)`.</span><span class="sxs-lookup"><span data-stu-id="9df47-377">For example, if `v = [1,2,3]`, then calling `avg(v)` is equivalent toocalling `avg(1,2,3)`.</span></span> <span data-ttu-id="9df47-378">Вызов `avg(v, 7)` — эквивалент toocalling `avg(1,2,3,7)`.</span><span class="sxs-lookup"><span data-stu-id="9df47-378">Calling `avg(v, 7)` is equivalent toocalling `avg(1,2,3,7)`.</span></span>

## <span data-ttu-id="9df47-379"><a name="getsampledata"></a>Получение выборки данных</span><span class="sxs-lookup"><span data-stu-id="9df47-379"><a name="getsampledata"></a>Obtain sample data</span></span>
<span data-ttu-id="9df47-380">Формулы автомасштабирования, влияют на данные метрик (примеры), предоставляемый hello пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="9df47-380">Autoscale formulas act on metrics data (samples) that is provided by hello Batch service.</span></span> <span data-ttu-id="9df47-381">Формула при увеличении или уменьшении размера пула на основе значений hello, он получает от службы hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-381">A formula grows or shrinks pool size based on hello values that it obtains from hello service.</span></span> <span data-ttu-id="9df47-382">переменные, определенные службы Hello, описанные ранее, объекты, которые предоставляют различные методы tooaccess данных, связанный с этим объектом.</span><span class="sxs-lookup"><span data-stu-id="9df47-382">hello service-defined variables that were described previously are objects that provide various methods tooaccess data that is associated with that object.</span></span> <span data-ttu-id="9df47-383">Например hello следующее выражение показывает hello tooget запрос ЦП за последние пять минут:</span><span class="sxs-lookup"><span data-stu-id="9df47-383">For example, hello following expression shows a request tooget hello last five minutes of CPU usage:</span></span>

```
$CPUPercent.GetSample(TimeInterval_Minute * 5)
```

| <span data-ttu-id="9df47-384">Метод</span><span class="sxs-lookup"><span data-stu-id="9df47-384">Method</span></span> | <span data-ttu-id="9df47-385">Описание</span><span class="sxs-lookup"><span data-stu-id="9df47-385">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9df47-386">GetSample()</span><span class="sxs-lookup"><span data-stu-id="9df47-386">GetSample()</span></span> |<span data-ttu-id="9df47-387">Hello `GetSample()` метод возвращает вектор образцы данных.</span><span class="sxs-lookup"><span data-stu-id="9df47-387">hello `GetSample()` method returns a vector of data samples.</span></span><br/><br/><span data-ttu-id="9df47-388">Выборка — это данные метрики за 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="9df47-388">A sample is 30 seconds worth of metrics data.</span></span> <span data-ttu-id="9df47-389">Другими словами, выборки делаются каждые 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="9df47-389">In other words, samples are obtained every 30 seconds.</span></span> <span data-ttu-id="9df47-390">Но происходит задержка между при выборке собирается и когда это формула доступных tooa указаны ниже.</span><span class="sxs-lookup"><span data-stu-id="9df47-390">But as noted below, there is a delay between when a sample is collected and when it is available tooa formula.</span></span> <span data-ttu-id="9df47-391">Таким образом, не все выборки за заданный период времени могут быть доступны для оценки формулой.</span><span class="sxs-lookup"><span data-stu-id="9df47-391">As such, not all samples for a given time period may be available for evaluation by a formula.</span></span><ul><li>`doubleVec GetSample(double count)`<br/><span data-ttu-id="9df47-392">Указывает количество hello tooobtain образцы из hello наиболее свежие образцы, которые были собраны.</span><span class="sxs-lookup"><span data-stu-id="9df47-392">Specifies hello number of samples tooobtain from hello most recent samples that were collected.</span></span><br/><br/><span data-ttu-id="9df47-393">`GetSample(1)`Возвращает последние доступные образцы hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-393">`GetSample(1)` returns hello last available sample.</span></span> <span data-ttu-id="9df47-394">Для метрик, таких как `$CPUPercent`, однако это не следует использовать, так как это невозможно tooknow *при* сбор выборок hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-394">For metrics like `$CPUPercent`, however, this should not be used because it is impossible tooknow *when* hello sample was collected.</span></span> <span data-ttu-id="9df47-395">Она может оказаться свежей, но может и устареть, если в системе возникли проблемы.</span><span class="sxs-lookup"><span data-stu-id="9df47-395">It might be recent, or, because of system issues, it might be much older.</span></span> <span data-ttu-id="9df47-396">Лучше в таких случаях toouse интервал времени, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="9df47-396">It is better in such cases toouse a time interval as shown below.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime [, double samplePercent])`<br/><span data-ttu-id="9df47-397">Задает интервал времени для данных выборки.</span><span class="sxs-lookup"><span data-stu-id="9df47-397">Specifies a time frame for gathering sample data.</span></span> <span data-ttu-id="9df47-398">При необходимости он также указывает, что процент hello образцы, которые должны быть доступны в hello запрошенный промежуток времени.</span><span class="sxs-lookup"><span data-stu-id="9df47-398">Optionally, it also specifies hello percentage of samples that must be available in hello requested time frame.</span></span><br/><br/><span data-ttu-id="9df47-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)`Если присутствуют все образцы для hello последние 10 минут в журнале CPUPercent hello вернет 20 точек.</span><span class="sxs-lookup"><span data-stu-id="9df47-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` would return 20 samples if all samples for hello last 10 minutes are present in hello CPUPercent history.</span></span> <span data-ttu-id="9df47-400">Если последнюю минуту hello журнала не был доступен, однако только 18 образцы будут возвращены.</span><span class="sxs-lookup"><span data-stu-id="9df47-400">If hello last minute of history was not available, however, only 18 samples would be returned.</span></span> <span data-ttu-id="9df47-401">В данном случае:</span><span class="sxs-lookup"><span data-stu-id="9df47-401">In this case:</span></span><br/><br/><span data-ttu-id="9df47-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)`произойдет сбой, так как только 90 процентов hello образцы доступны.</span><span class="sxs-lookup"><span data-stu-id="9df47-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` would fail because only 90 percent of hello samples are available.</span></span><br/><br/><span data-ttu-id="9df47-403">Метод `$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` будет выполнен успешно.</span><span class="sxs-lookup"><span data-stu-id="9df47-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` would succeed.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime, (timestamp or timeinterval) endTime [, double samplePercent])`<br/><span data-ttu-id="9df47-404">Задает интервал времени для сбора данных, т. е. начало и конец сбора.</span><span class="sxs-lookup"><span data-stu-id="9df47-404">Specifies a time frame for gathering data, with both a start time and an end time.</span></span><br/><br/><span data-ttu-id="9df47-405">Как упоминалось выше, возникает задержка между при выборке собирается и когда это формула доступных tooa.</span><span class="sxs-lookup"><span data-stu-id="9df47-405">As mentioned above, there is a delay between when a sample is collected and when it is available tooa formula.</span></span> <span data-ttu-id="9df47-406">Рассмотрим эту задержку, при использовании hello `GetSample` метод.</span><span class="sxs-lookup"><span data-stu-id="9df47-406">Consider this delay when you use hello `GetSample` method.</span></span> <span data-ttu-id="9df47-407">Ознакомьтесь с `GetSamplePercent` ниже.</span><span class="sxs-lookup"><span data-stu-id="9df47-407">See `GetSamplePercent` below.</span></span> |
| <span data-ttu-id="9df47-408">GetSamplePeriod()</span><span class="sxs-lookup"><span data-stu-id="9df47-408">GetSamplePeriod()</span></span> |<span data-ttu-id="9df47-409">Возвращает hello период выборки, собранные в исторические данные выборки.</span><span class="sxs-lookup"><span data-stu-id="9df47-409">Returns hello period of samples that were taken in a historical sample data set.</span></span> |
| <span data-ttu-id="9df47-410">Count()</span><span class="sxs-lookup"><span data-stu-id="9df47-410">Count()</span></span> |<span data-ttu-id="9df47-411">Возвращает hello общее количество выборок в журнале метрики hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-411">Returns hello total number of samples in hello metric history.</span></span> |
| <span data-ttu-id="9df47-412">HistoryBeginTime()</span><span class="sxs-lookup"><span data-stu-id="9df47-412">HistoryBeginTime()</span></span> |<span data-ttu-id="9df47-413">Возвращает hello hello старые образец доступных данных для метрики hello отметку времени.</span><span class="sxs-lookup"><span data-stu-id="9df47-413">Returns hello time stamp of hello oldest available data sample for hello metric.</span></span> |
| <span data-ttu-id="9df47-414">GetSamplePercent()</span><span class="sxs-lookup"><span data-stu-id="9df47-414">GetSamplePercent()</span></span> |<span data-ttu-id="9df47-415">Возвращает hello доля образцов, доступных для заданного интервала времени.</span><span class="sxs-lookup"><span data-stu-id="9df47-415">Returns hello percentage of samples that are available for a given time interval.</span></span> <span data-ttu-id="9df47-416">Например:</span><span class="sxs-lookup"><span data-stu-id="9df47-416">For example:</span></span><br/><br/>`doubleVec GetSamplePercent( (timestamp or timeinterval) startTime [, (timestamp or timeinterval) endTime] )`<br/><br/><span data-ttu-id="9df47-417">Поскольку hello `GetSample` метод завершается ошибкой, если процент возвращаемых образцы hello меньше, чем hello `samplePercent` указано, можно использовать hello `GetSamplePercent` toocheck метод первой.</span><span class="sxs-lookup"><span data-stu-id="9df47-417">Because hello `GetSample` method fails if hello percentage of samples returned is less than hello `samplePercent` specified, you can use hello `GetSamplePercent` method toocheck first.</span></span> <span data-ttu-id="9df47-418">Затем можно выполнить альтернативное действие, если недостаточно образцы присутствуют, без прекращение выполнения автоматического масштабирования вычисления hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-418">Then you can perform an alternate action if insufficient samples are present, without halting hello automatic scaling evaluation.</span></span> |

### <a name="samples-sample-percentage-and-hello-getsample-method"></a><span data-ttu-id="9df47-419">Примеры, процент образца и hello *GetSample()* метод</span><span class="sxs-lookup"><span data-stu-id="9df47-419">Samples, sample percentage, and hello *GetSample()* method</span></span>
<span data-ttu-id="9df47-420">Hello базового функционирования формулу автомасштабирования tooobtain задач и ресурсов метрики данным, а затем измените размер пула на основе этих данных.</span><span class="sxs-lookup"><span data-stu-id="9df47-420">hello core operation of an autoscale formula is tooobtain task and resource metric data and then adjust pool size based on that data.</span></span> <span data-ttu-id="9df47-421">Таким образом рекомендуется важные toohave четкое представление о формулах автомасштабирования взаимодействие с данными метрик (примеры).</span><span class="sxs-lookup"><span data-stu-id="9df47-421">As such, it is important toohave a clear understanding of how autoscale formulas interact with metrics data (samples).</span></span>

<span data-ttu-id="9df47-422">**Примеры**</span><span class="sxs-lookup"><span data-stu-id="9df47-422">**Samples**</span></span>

<span data-ttu-id="9df47-423">периодически Hello пакетная служба принимает примеры задач и ресурсов метрик и становятся доступны tooyour формулы автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-423">hello Batch service periodically takes samples of task and resource metrics and makes them available tooyour autoscale formulas.</span></span> <span data-ttu-id="9df47-424">В этих примерах записываются каждые 30 секунд hello пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="9df47-424">These samples are recorded every 30 seconds by hello Batch service.</span></span> <span data-ttu-id="9df47-425">Однако есть обычно задержка между при эти образцы были записаны, и когда они становятся доступными слишком (и может быть прочитан) формулы автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-425">However, there is typically a delay between when those samples were recorded and when they are made available too(and can be read by) your autoscale formulas.</span></span> <span data-ttu-id="9df47-426">Кроме того из-за toovarious факторов, таких как сети или других проблем инфраструктуры, образцы не могут быть записаны в течение определенного интервала.</span><span class="sxs-lookup"><span data-stu-id="9df47-426">Additionally, due toovarious factors such as network or other infrastructure issues, samples may not be recorded for a particular interval.</span></span>

<span data-ttu-id="9df47-427">**Процент выборок**</span><span class="sxs-lookup"><span data-stu-id="9df47-427">**Sample percentage**</span></span>

<span data-ttu-id="9df47-428">Когда `samplePercent` передается toohello `GetSample()` метода или hello `GetSamplePercent()` вызывается метод, _процентов_ ссылается tooa сравнение hello Общее возможное количество образцов, записанных hello пакетная служба и Hello число выборок, являются доступными tooyour формула автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-428">When `samplePercent` is passed toohello `GetSample()` method or hello `GetSamplePercent()` method is called, _percent_ refers tooa comparison between hello total possible number of samples that are recorded by hello Batch service and hello number of samples that are available tooyour autoscale formula.</span></span>

<span data-ttu-id="9df47-429">Для примера рассмотрим промежуток времени в 10 минут.</span><span class="sxs-lookup"><span data-stu-id="9df47-429">Let's look at a 10-minute timespan as an example.</span></span> <span data-ttu-id="9df47-430">Так как образцы записываются каждые 30 секунд, в течение 10 минут timespan, hello максимальное общее число выборок, записываемых пакетом будет 20 точек (2 в минуту).</span><span class="sxs-lookup"><span data-stu-id="9df47-430">Because samples are recorded every 30 seconds within a 10-minute timespan, hello maximum total number of samples that are recorded by Batch would be 20 samples (2 per minute).</span></span> <span data-ttu-id="9df47-431">Однако из-за toohello внутренней задержки hello reporting механизм и другие проблемы в Azure, может существовать только 15 примеры, формула автоматического масштабирования tooyour доступной для чтения.</span><span class="sxs-lookup"><span data-stu-id="9df47-431">However, due toohello inherent latency of hello reporting mechanism and other issues within Azure, there may be only 15 samples that are available tooyour autoscale formula for reading.</span></span> <span data-ttu-id="9df47-432">Так например, этого 10-минутного периода только 75% hello общее число записанных образцы его доступных tooyour формулы.</span><span class="sxs-lookup"><span data-stu-id="9df47-432">So, for example, for that 10-minute period, only 75% of hello total number of samples recorded may be available tooyour formula.</span></span>

<span data-ttu-id="9df47-433">**Метод GetSample() и диапазоны выборок**</span><span class="sxs-lookup"><span data-stu-id="9df47-433">**GetSample() and sample ranges**</span></span>

<span data-ttu-id="9df47-434">Формулы автоматического масштабирования являются постоянной toobe расширение и сжатие пулов &mdash; узлы Добавление или удаление узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-434">Your autoscale formulas are going toobe growing and shrinking your pools &mdash; adding nodes or removing nodes.</span></span> <span data-ttu-id="9df47-435">Так как узлы тратить, следует tooensure, метод интеллектуального анализа, который основан на данных достаточно использовать формулы.</span><span class="sxs-lookup"><span data-stu-id="9df47-435">Because nodes cost you money, you want tooensure that your formulas use an intelligent method of analysis that is based on sufficient data.</span></span> <span data-ttu-id="9df47-436">Поэтому в формулах рекомендуется использовать анализ тенденций.</span><span class="sxs-lookup"><span data-stu-id="9df47-436">Therefore, we recommend that you use a trending-type analysis in your formulas.</span></span> <span data-ttu-id="9df47-437">С таким анализом пулы увеличиваются и уменьшаются на основе диапазона собранных выборок.</span><span class="sxs-lookup"><span data-stu-id="9df47-437">This type grows and shrinks your pools based on a range of collected samples.</span></span>

<span data-ttu-id="9df47-438">Таким образом, используйте toodo `GetSample(interval look-back start, interval look-back end)` tooreturn вектор примеров:</span><span class="sxs-lookup"><span data-stu-id="9df47-438">toodo so, use `GetSample(interval look-back start, interval look-back end)` tooreturn a vector of samples:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(1 * TimeInterval_Minute, 6 * TimeInterval_Minute);
```

<span data-ttu-id="9df47-439">При вычислении hello над линией пакетом возвращается ряд примеров как вектор значений.</span><span class="sxs-lookup"><span data-stu-id="9df47-439">When hello above line is evaluated by Batch, it returns a range of samples as a vector of values.</span></span> <span data-ttu-id="9df47-440">Например:</span><span class="sxs-lookup"><span data-stu-id="9df47-440">For example:</span></span>

```
$runningTasksSample=[1,1,1,1,1,1,1,1,1,1];
```

<span data-ttu-id="9df47-441">После собранными вектор hello образцов, затем можно использовать функции, такие как `min()`, `max()`, и `avg()` tooderive значимые значения из hello собранные диапазона.</span><span class="sxs-lookup"><span data-stu-id="9df47-441">Once you've collected hello vector of samples, you can then use functions like `min()`, `max()`, and `avg()` tooderive meaningful values from hello collected range.</span></span>

<span data-ttu-id="9df47-442">Для обеспечения дополнительной безопасности можно принудительно выполнить toofail вычисления, если меньше, чем определенный процент пример доступен в течение конкретного периода времени.</span><span class="sxs-lookup"><span data-stu-id="9df47-442">For additional security, you can force a formula evaluation toofail if less than a certain sample percentage is available for a particular time period.</span></span> <span data-ttu-id="9df47-443">При выполнении принудительного toofail вычисления, вы указываете пакета toocease дальнейшей вычисления формулы hello Если hello указанный процент примеров недоступна.</span><span class="sxs-lookup"><span data-stu-id="9df47-443">When you force a formula evaluation toofail, you instruct Batch toocease further evaluation of hello formula if hello specified percentage of samples is not available.</span></span> <span data-ttu-id="9df47-444">В этом случае размер пула toohello не вносятся никакие изменения.</span><span class="sxs-lookup"><span data-stu-id="9df47-444">In this case, no change is made toohello pool size.</span></span> <span data-ttu-id="9df47-445">toospecify требуемый процент образцов для toosucceed оценки hello, укажите его как hello третий параметр слишком`GetSample()`.</span><span class="sxs-lookup"><span data-stu-id="9df47-445">toospecify a required percentage of samples for hello evaluation toosucceed, specify it as hello third parameter too`GetSample()`.</span></span> <span data-ttu-id="9df47-446">Здесь указано, что обязательный процент выборок равен 75 %:</span><span class="sxs-lookup"><span data-stu-id="9df47-446">Here, a requirement of 75 percent of samples is specified:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(60 * TimeInterval_Second, 120 * TimeInterval_Second, 75);
```

<span data-ttu-id="9df47-447">Так как в образце доступности возможна задержка, очень важно, tooalways указать диапазон времени с временем начала Искать назад, более ранняя, чем на одну минуту.</span><span class="sxs-lookup"><span data-stu-id="9df47-447">Because there may be a delay in sample availability, it is important tooalways specify a time range with a look-back start time that is older than one minute.</span></span> <span data-ttu-id="9df47-448">Принимает примерно через одну минуту toopropagate образцы через систему hello, поэтому образцы в диапазоне hello `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` могут быть недоступны.</span><span class="sxs-lookup"><span data-stu-id="9df47-448">It takes approximately one minute for samples toopropagate through hello system, so samples in hello range `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` may not be available.</span></span> <span data-ttu-id="9df47-449">Еще раз, можно использовать параметр процент hello `GetSample()` tooforce требования конкретного примера в процентах.</span><span class="sxs-lookup"><span data-stu-id="9df47-449">Again, you can use hello percentage parameter of `GetSample()` tooforce a particular sample percentage requirement.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9df47-450">Мы **настоятельно рекомендуем** **не полагаться *только* на метод `GetSample(1)` в формулах автомасштабирования**.</span><span class="sxs-lookup"><span data-stu-id="9df47-450">We **strongly recommend** that you **avoid relying *only* on `GetSample(1)` in your autoscale formulas**.</span></span> <span data-ttu-id="9df47-451">Это вызвано `GetSample(1)` фактически говорит toohello пакетная служба «Предоставьте мне hello последней выборки, у вас не проверяются как давно вы получили.»</span><span class="sxs-lookup"><span data-stu-id="9df47-451">This is because `GetSample(1)` essentially says toohello Batch service, "Give me hello last sample you have, no matter how long ago you retrieved it."</span></span> <span data-ttu-id="9df47-452">Так как он является только один образец, и она может быть пример более старые, он может не представлять hello общую картину запущенное задание или состояние ресурса.</span><span class="sxs-lookup"><span data-stu-id="9df47-452">Since it is only a single sample, and it may be an older sample, it may not be representative of hello larger picture of recent task or resource state.</span></span> <span data-ttu-id="9df47-453">Если вы используете `GetSample(1)`, убедитесь, что он является частью большего инструкции и не hello только точки данных, которая зависит от формулы.</span><span class="sxs-lookup"><span data-stu-id="9df47-453">If you do use `GetSample(1)`, make sure that it's part of a larger statement and not hello only data point that your formula relies on.</span></span>
>
>

## <a name="metrics"></a><span data-ttu-id="9df47-454">Метрики</span><span class="sxs-lookup"><span data-stu-id="9df47-454">Metrics</span></span>
<span data-ttu-id="9df47-455">При определении формулы можно использовать метрики ресурсов и задач.</span><span class="sxs-lookup"><span data-stu-id="9df47-455">You can use both resource and task metrics when you're defining a formula.</span></span> <span data-ttu-id="9df47-456">Можно настроить hello целевое количество выделенных узлов в hello пула на основании данных метрик hello, получения и оценки.</span><span class="sxs-lookup"><span data-stu-id="9df47-456">You adjust hello target number of dedicated nodes in hello pool based on hello metrics data that you obtain and evaluate.</span></span> <span data-ttu-id="9df47-457">В разделе hello [переменных](#variables) выше в разделе Дополнительные сведения о каждой метрики.</span><span class="sxs-lookup"><span data-stu-id="9df47-457">See hello [Variables](#variables) section above for more information on each metric.</span></span>

<table>
  <tr>
    <th><span data-ttu-id="9df47-458">Метрика</span><span class="sxs-lookup"><span data-stu-id="9df47-458">Metric</span></span></th>
    <th><span data-ttu-id="9df47-459">Описание</span><span class="sxs-lookup"><span data-stu-id="9df47-459">Description</span></span></th>
  </tr>
  <tr>
    <td><span data-ttu-id="9df47-460"><b>Ресурс</b></span><span class="sxs-lookup"><span data-stu-id="9df47-460"><b>Resource</b></span></span></td>
    <td><p><span data-ttu-id="9df47-461">Метрики ресурсов основаны на hello ЦП, пропускную способность hello, использование памяти hello вычислительные узлы и hello количество узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-461">Resource metrics are based on hello CPU, hello bandwidth, hello memory usage of compute nodes, and hello number of nodes.</span></span></p>
        <p> <span data-ttu-id="9df47-462">Для внесения изменений с учетом количества узлов используются следующие служебные переменные:</span><span class="sxs-lookup"><span data-stu-id="9df47-462">These service-defined variables are useful for making adjustments based on node count:</span></span></p>
    <p><ul>
            <li><span data-ttu-id="9df47-463">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="9df47-463">$TargetDedicatedNodes</span></span></li>
            <li><span data-ttu-id="9df47-464">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="9df47-464">$TargetLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="9df47-465">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="9df47-465">$CurrentDedicatedNodes</span></span></li>
            <li><span data-ttu-id="9df47-466">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="9df47-466">$CurrentLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="9df47-467">$preemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="9df47-467">$preemptedNodeCount</span></span></li>
            <li><span data-ttu-id="9df47-468">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="9df47-468">$SampleNodeCount</span></span></li>
    </ul></p>
    <p><span data-ttu-id="9df47-469">Для внесения изменений с учетом потребляемых ресурсов используются следующие служебные переменные:</span><span class="sxs-lookup"><span data-stu-id="9df47-469">These service-defined variables are useful for making adjustments based on node resource usage:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="9df47-470">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="9df47-470">$CPUPercent</span></span></li>
      <li><span data-ttu-id="9df47-471">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="9df47-471">$WallClockSeconds</span></span></li>
      <li><span data-ttu-id="9df47-472">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-472">$MemoryBytes</span></span></li>
      <li><span data-ttu-id="9df47-473">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-473">$DiskBytes</span></span></li>
      <li><span data-ttu-id="9df47-474">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-474">$DiskReadBytes</span></span></li>
      <li><span data-ttu-id="9df47-475">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-475">$DiskWriteBytes</span></span></li>
      <li><span data-ttu-id="9df47-476">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="9df47-476">$DiskReadOps</span></span></li>
      <li><span data-ttu-id="9df47-477">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="9df47-477">$DiskWriteOps</span></span></li>
      <li><span data-ttu-id="9df47-478">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-478">$NetworkInBytes</span></span></li>
      <li><span data-ttu-id="9df47-479">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="9df47-479">$NetworkOutBytes</span></span></li></ul></p>
  </tr>
  <tr>
    <td><span data-ttu-id="9df47-480"><b>Задача.</b></span><span class="sxs-lookup"><span data-stu-id="9df47-480"><b>Task</b></span></span></td>
    <td><p><span data-ttu-id="9df47-481">Задача метрики на основе hello состояния задач, таких как активные, Ожидание и завершена.</span><span class="sxs-lookup"><span data-stu-id="9df47-481">Task metrics are based on hello status of tasks, such as Active, Pending, and Completed.</span></span> <span data-ttu-id="9df47-482">Hello следующие переменные, определенные службы используются для регулировки размера пула на основе задач.</span><span class="sxs-lookup"><span data-stu-id="9df47-482">hello following service-defined variables are useful for making pool-size adjustments based on task metrics:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="9df47-483">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-483">$ActiveTasks</span></span></li>
      <li><span data-ttu-id="9df47-484">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-484">$RunningTasks</span></span></li>
      <li><span data-ttu-id="9df47-485">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-485">$PendingTasks</span></span></li>
      <li><span data-ttu-id="9df47-486">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-486">$SucceededTasks</span></span></li>
            <li><span data-ttu-id="9df47-487">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="9df47-487">$FailedTasks</span></span></li></ul></p>
        </td>
  </tr>
</table>

## <a name="write-an-autoscale-formula"></a><span data-ttu-id="9df47-488">Написание формулы автомасштабирования</span><span class="sxs-lookup"><span data-stu-id="9df47-488">Write an autoscale formula</span></span>
<span data-ttu-id="9df47-489">Построить формулу автомасштабирования посредством формирования инструкции, которые используют hello выше компонентов, а затем объединить эти инструкции в полную формулу.</span><span class="sxs-lookup"><span data-stu-id="9df47-489">You build an autoscale formula by forming statements that use hello above components, then combine those statements into a complete formula.</span></span> <span data-ttu-id="9df47-490">В этом разделе мы создадим пример формулы автомасштабирования, с помощью которой можно выполнять некоторые задачи масштабирования из реальной жизни.</span><span class="sxs-lookup"><span data-stu-id="9df47-490">In this section, we create an example autoscale formula that can perform some real-world scaling decisions.</span></span>

<span data-ttu-id="9df47-491">Во-первых определим hello требования для нового формулы автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-491">First, let's define hello requirements for our new autoscale formula.</span></span> <span data-ttu-id="9df47-492">Формула Hello следует:</span><span class="sxs-lookup"><span data-stu-id="9df47-492">hello formula should:</span></span>

1. <span data-ttu-id="9df47-493">Если высокая загрузка ЦП, увеличьте hello целевое количество выделенных вычислительных узлов в пуле.</span><span class="sxs-lookup"><span data-stu-id="9df47-493">Increase hello target number of dedicated compute nodes in a pool if CPU usage is high.</span></span>
2. <span data-ttu-id="9df47-494">При низком уровне использования ЦП, уменьшение hello целевое количество выделенных вычислительных узлов в пуле.</span><span class="sxs-lookup"><span data-stu-id="9df47-494">Decrease hello target number of dedicated compute nodes in a pool when CPU usage is low.</span></span>
3. <span data-ttu-id="9df47-495">Всегда ограничивает максимальное число выделенных узлов too400 hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-495">Always restrict hello maximum number of dedicated nodes too400.</span></span>

<span data-ttu-id="9df47-496">tooincrease hello количество узлов во время высокой загрузки ЦП, определите hello инструкцию, которая заполняет определяемой пользователем переменной (`$totalDedicatedNodes`) со значением, которое 110% hello текущее целевое количество выделенных узлов, но только если hello минимальное среднее время использования ЦП во время hello последние 10 минут было более 70 процентов.</span><span class="sxs-lookup"><span data-stu-id="9df47-496">tooincrease hello number of nodes during high CPU usage, define hello statement that populates a user-defined variable (`$totalDedicatedNodes`) with a value that is 110 percent of hello current target number of dedicated nodes, but only if hello minimum average CPU usage during hello last 10 minutes was above 70 percent.</span></span> <span data-ttu-id="9df47-497">В противном случае используйте значение hello для hello текущее количество выделенных узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-497">Otherwise, use hello value for hello current number of dedicated nodes.</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
```

<span data-ttu-id="9df47-498">слишком*уменьшить* Здравствуйте количество выделенных узлов, при низкой загрузке ЦП, hello следующий оператор в нашей формулы наборов hello же `$totalDedicatedNodes` переменной too90 процентов hello текущее целевое количество выделенных узлов, если hello средняя загрузка ЦП в hello за последние 60 минут в разделе было 20 процентов.</span><span class="sxs-lookup"><span data-stu-id="9df47-498">too*decrease* hello number of dedicated nodes during low CPU usage, hello next statement in our formula sets hello same `$totalDedicatedNodes` variable too90 percent of hello current target number of dedicated nodes if hello average CPU usage in hello past 60 minutes was under 20 percent.</span></span> <span data-ttu-id="9df47-499">В противном случае используйте hello текущее значение `$totalDedicatedNodes` мы заполненной в инструкции hello выше.</span><span class="sxs-lookup"><span data-stu-id="9df47-499">Otherwise, use hello current value of `$totalDedicatedNodes` that we populated in hello statement above.</span></span>

```
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
```

<span data-ttu-id="9df47-500">Теперь можно ограничьте hello целевое количество выделенных вычислительных узлов tooa более 400:</span><span class="sxs-lookup"><span data-stu-id="9df47-500">Now limit hello target number of dedicated compute nodes tooa maximum of 400:</span></span>

```
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

<span data-ttu-id="9df47-501">Вот hello полную формулу.</span><span class="sxs-lookup"><span data-stu-id="9df47-501">Here's hello complete formula:</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

## <a name="create-an-autoscale-enabled-pool-with-net"></a><span data-ttu-id="9df47-502">Создание пула с поддержкой автомасштабирования с помощью .NET</span><span class="sxs-lookup"><span data-stu-id="9df47-502">Create an autoscale-enabled pool with .NET</span></span>

<span data-ttu-id="9df47-503">toocreate пул с включенного в .NET, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="9df47-503">toocreate a pool with autoscaling enabled in .NET, follow these steps:</span></span>

1. <span data-ttu-id="9df47-504">Создание пула hello с [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span><span class="sxs-lookup"><span data-stu-id="9df47-504">Create hello pool with [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span></span>
2. <span data-ttu-id="9df47-505">Набор hello [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) свойство слишком`true`.</span><span class="sxs-lookup"><span data-stu-id="9df47-505">Set hello [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) property too`true`.</span></span>
3. <span data-ttu-id="9df47-506">Набор hello [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) свойство с формулы автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-506">Set hello [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) property with your autoscale formula.</span></span>
4. <span data-ttu-id="9df47-507">(Необязательно) Набор hello [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) свойство (по умолчанию — 15 минут).</span><span class="sxs-lookup"><span data-stu-id="9df47-507">(Optional) Set hello [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) property (default is 15 minutes).</span></span>
5. <span data-ttu-id="9df47-508">Зафиксировать hello пул с [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) или [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span><span class="sxs-lookup"><span data-stu-id="9df47-508">Commit hello pool with [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) or [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span></span>

<span data-ttu-id="9df47-509">Hello следующий фрагмент кода создает пул включена автомасштабирования в .NET.</span><span class="sxs-lookup"><span data-stu-id="9df47-509">hello following code snippet creates an autoscale-enabled pool in .NET.</span></span> <span data-ttu-id="9df47-510">Hello формулу автомасштабирования пула задает hello целевое количество выделенных узлов too5 по понедельникам, а 1 на каждый день недели hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-510">hello pool's autoscale formula sets hello target number of dedicated nodes too5 on Mondays, and 1 on every other day of hello week.</span></span> <span data-ttu-id="9df47-511">Hello [интервал автоматического масштабирования](#automatic-scaling-interval) — установить too30 минут.</span><span class="sxs-lookup"><span data-stu-id="9df47-511">hello [automatic scaling interval](#automatic-scaling-interval) is set too30 minutes.</span></span> <span data-ttu-id="9df47-512">В этом и hello другие фрагменты C# в этой статье `myBatchClient` — это правильно инициализированный экземпляр hello [BatchClient] [ net_batchclient] класса.</span><span class="sxs-lookup"><span data-stu-id="9df47-512">In this and hello other C# snippets in this article, `myBatchClient` is a properly initialized instance of hello [BatchClient][net_batchclient] class.</span></span>

```csharp
CloudPool pool = myBatchClient.PoolOperations.CreatePool(
                    poolId: "mypool",
                    virtualMachineSize: "small", // single-core, 1.75 GB memory, 225 GB disk
                    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "5"));    
pool.AutoScaleEnabled = true;
pool.AutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";
pool.AutoScaleEvaluationInterval = TimeSpan.FromMinutes(30);
await pool.CommitAsync();
```

> [!IMPORTANT]
> <span data-ttu-id="9df47-513">При создании пула включена автомасштабирования не следует указывать hello _targetDedicatedComputeNodes_ параметр или hello _targetLowPriorityComputeNodes_ параметром hello вызвать слишком **CreatePool**.</span><span class="sxs-lookup"><span data-stu-id="9df47-513">When you create an autoscale-enabled pool, do not specify hello _targetDedicatedComputeNodes_ parameter or hello _targetLowPriorityComputeNodes_ parameter on hello call too**CreatePool**.</span></span> <span data-ttu-id="9df47-514">Вместо этого укажите hello **AutoScaleEnabled** и **AutoScaleFormula** свойства пула hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-514">Instead, specify hello **AutoScaleEnabled** and **AutoScaleFormula** properties on hello pool.</span></span> <span data-ttu-id="9df47-515">Hello значения этих свойств определяют hello целевое количество каждого типа узла.</span><span class="sxs-lookup"><span data-stu-id="9df47-515">hello values for these properties determine hello target number of each type of node.</span></span> <span data-ttu-id="9df47-516">Кроме того, toomanually изменения размера пула включена автомасштабирования (например, с помощью [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), сначала **отключить** автоматического масштабирования Здравствуйте пула, а затем изменить его размер.</span><span class="sxs-lookup"><span data-stu-id="9df47-516">Also, toomanually resize an autoscale-enabled pool (for example, with [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), first **disable** automatic scaling on hello pool, then resize it.</span></span>
>
>

<span data-ttu-id="9df47-517">В дополнение к этому tooBatch .NET, можно использовать любой из других hello [пакета SDK](batch-apis-tools.md#azure-accounts-for-batch-development), [REST пакетной](https://docs.microsoft.com/rest/api/batchservice/), [командлеты PowerShell пакета](batch-powershell-cmdlets-get-started.md)и hello [CLI пакета](batch-cli-get-started.md)tooconfigure автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-517">In addition tooBatch .NET, you can use any of hello other [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell cmdlets](batch-powershell-cmdlets-get-started.md), and hello [Batch CLI](batch-cli-get-started.md) tooconfigure autoscaling.</span></span>


### <a name="automatic-scaling-interval"></a><span data-ttu-id="9df47-518">Интервал автоматического масштабирования</span><span class="sxs-lookup"><span data-stu-id="9df47-518">Automatic scaling interval</span></span>
<span data-ttu-id="9df47-519">По умолчанию hello пакетная служба корректирует размер пула, в соответствии с tooits формула автоматического масштабирования каждые 15 минут.</span><span class="sxs-lookup"><span data-stu-id="9df47-519">By default, hello Batch service adjusts a pool's size according tooits autoscale formula every 15 minutes.</span></span> <span data-ttu-id="9df47-520">Этот интервал настраивается с помощью hello следующие свойства пула:</span><span class="sxs-lookup"><span data-stu-id="9df47-520">This interval is configurable by using hello following pool properties:</span></span>

* <span data-ttu-id="9df47-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (.NET пакетной службы)</span><span class="sxs-lookup"><span data-stu-id="9df47-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span></span>
* <span data-ttu-id="9df47-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)</span><span class="sxs-lookup"><span data-stu-id="9df47-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)</span></span>

<span data-ttu-id="9df47-523">Минимальный интервал Hello пять минут, который hello максимальное 168 часов.</span><span class="sxs-lookup"><span data-stu-id="9df47-523">hello minimum interval is five minutes, and hello maximum is 168 hours.</span></span> <span data-ttu-id="9df47-524">Если указан интервал вне этого диапазона, hello пакетная служба возвращает ошибку неправильный запрос (400).</span><span class="sxs-lookup"><span data-stu-id="9df47-524">If an interval outside this range is specified, hello Batch service returns a Bad Request (400) error.</span></span>

> [!NOTE]
> <span data-ttu-id="9df47-525">Автоматическое масштабирование не рекомендуемый в настоящий момент toorespond toochanges менее чем через минуту, но скорее постепенно предназначен tooadjust hello размер пула, при выполнении рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="9df47-525">Autoscaling is not currently intended toorespond toochanges in less than a minute, but rather is intended tooadjust hello size of your pool gradually as you run a workload.</span></span>
>
>

## <a name="enable-autoscaling-on-an-existing-pool"></a><span data-ttu-id="9df47-526">Включение автомасштабирования в имеющемся пуле</span><span class="sxs-lookup"><span data-stu-id="9df47-526">Enable autoscaling on an existing pool</span></span>

<span data-ttu-id="9df47-527">Каждый пакет SDK предоставляет автоматическое масштабирование tooenable способом.</span><span class="sxs-lookup"><span data-stu-id="9df47-527">Each Batch SDK provides a way tooenable autoscaling.</span></span> <span data-ttu-id="9df47-528">Например:</span><span class="sxs-lookup"><span data-stu-id="9df47-528">For example:</span></span>

* <span data-ttu-id="9df47-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (библиотека .NET пакетной службы)</span><span class="sxs-lookup"><span data-stu-id="9df47-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span></span>
* <span data-ttu-id="9df47-530">[Включение автомасштабирования пула][rest_enableautoscale] (REST API)</span><span class="sxs-lookup"><span data-stu-id="9df47-530">[Enable automatic scaling on a pool][rest_enableautoscale] (REST API)</span></span>

<span data-ttu-id="9df47-531">При включении автоматического масштабирования для существующего пула, имейте в виду hello после точки.</span><span class="sxs-lookup"><span data-stu-id="9df47-531">When you enable autoscaling on an existing pool, keep in mind hello following points:</span></span>

* <span data-ttu-id="9df47-532">Если автоматическое масштабирование в настоящее время отключена на пул hello при выполнении автоматического масштабирования tooenable запрос hello, необходимо указать формулу автомасштабирования допустимым при выполнении запроса hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-532">If automatic scaling is currently disabled on hello pool when you issue hello request tooenable autoscaling, you must specify a valid autoscale formula when you issue hello request.</span></span> <span data-ttu-id="9df47-533">При необходимости можно указать интервал оценки автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-533">You can optionally specify an autoscale evaluation interval.</span></span> <span data-ttu-id="9df47-534">Если интервал не указан, используется значение по умолчанию hello 15 минут.</span><span class="sxs-lookup"><span data-stu-id="9df47-534">If you do not specify an interval, hello default value of 15 minutes is used.</span></span>
* <span data-ttu-id="9df47-535">Если в пуле hello включена автомасштабирования, можно указать формулу автомасштабирования и интервал оценки.</span><span class="sxs-lookup"><span data-stu-id="9df47-535">If autoscale is currently enabled on hello pool, you can specify an autoscale formula, an evaluation interval, or both.</span></span> <span data-ttu-id="9df47-536">Необходимо указать по крайней мере одно из этих свойств.</span><span class="sxs-lookup"><span data-stu-id="9df47-536">You must specify at least one of these properties.</span></span>

  * <span data-ttu-id="9df47-537">Если указать новый интервал оценки автомасштабирования hello существующее расписание оценки остановлена, и запускается новое расписание.</span><span class="sxs-lookup"><span data-stu-id="9df47-537">If you specify a new autoscale evaluation interval, then hello existing evaluation schedule is stopped and a new schedule is started.</span></span> <span data-ttu-id="9df47-538">время начала Hello Создание расписания — время hello, какие hello выдачи запроса tooenable автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-538">hello new schedule's start time is hello time at which hello request tooenable autoscaling was issued.</span></span>
  * <span data-ttu-id="9df47-539">Если опустить интервал автоматического масштабирования либо приветствия формулы или оценки, hello пакетная служба продолжает toouse hello текущее значение этого параметра.</span><span class="sxs-lookup"><span data-stu-id="9df47-539">If you omit either hello autoscale formula or evaluation interval, hello Batch service continues toouse hello current value of that setting.</span></span>

> [!NOTE]
> <span data-ttu-id="9df47-540">При указании значения для hello *targetDedicatedComputeNodes* или *targetLowPriorityComputeNodes* параметры hello **CreatePool** метод при создании hello пула в .NET, либо для hello сопоставимых параметров в другом языке, то эти значения учитываются при вычислении hello автоматического масштабирования формулы.</span><span class="sxs-lookup"><span data-stu-id="9df47-540">If you specified values for hello *targetDedicatedComputeNodes* or *targetLowPriorityComputeNodes* parameters of hello **CreatePool** method when you created hello pool in .NET, or for hello comparable parameters in another language, then those values are ignored when hello automatic scaling formula is evaluated.</span></span>
>
>

<span data-ttu-id="9df47-541">Фрагмент кода C# использует hello [пакета .NET] [ net_api] автоматическое масштабирование tooenable библиотеки для существующего пула:</span><span class="sxs-lookup"><span data-stu-id="9df47-541">This C# code snippet uses hello [Batch .NET][net_api] library tooenable autoscaling on an existing pool:</span></span>

```csharp
// Define hello autoscaling formula. This formula sets hello target number of nodes
// too5 on Mondays, and 1 on every other day of hello week
string myAutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";

// Set hello autoscale formula on hello existing pool
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myAutoScaleFormula);
```

### <a name="update-an-autoscale-formula"></a><span data-ttu-id="9df47-542">Обновление формулы автомасштабирования</span><span class="sxs-lookup"><span data-stu-id="9df47-542">Update an autoscale formula</span></span>

<span data-ttu-id="9df47-543">Формула hello tooupdate для существующего включена автомасштабирования пула, вызов автоматическое масштабирование tooenable hello операции с hello новую формулу.</span><span class="sxs-lookup"><span data-stu-id="9df47-543">tooupdate hello formula on an existing autoscale-enabled pool, call hello operation tooenable autoscaling again with hello new formula.</span></span> <span data-ttu-id="9df47-544">Например, если автоматическое масштабирование уже включен в `myexistingpool` при выполнении hello после кода .NET hello содержимое заменяется указанной формуле автоматического масштабирования `myNewFormula`.</span><span class="sxs-lookup"><span data-stu-id="9df47-544">For example, if autoscaling is already enabled on `myexistingpool` when hello following .NET code is executed, its autoscale formula is replaced with hello contents of `myNewFormula`.</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myNewFormula);
```

### <a name="update-hello-autoscale-interval"></a><span data-ttu-id="9df47-545">Интервал автоматического масштабирования hello обновления</span><span class="sxs-lookup"><span data-stu-id="9df47-545">Update hello autoscale interval</span></span>

<span data-ttu-id="9df47-546">tooupdate hello автомасштабирования интервал оценки существующего включена автомасштабирования пула, вызов автоматическое масштабирование tooenable hello операции попытку, используя новый интервал приветствия.</span><span class="sxs-lookup"><span data-stu-id="9df47-546">tooupdate hello autoscale evaluation interval of an existing autoscale-enabled pool, call hello operation tooenable autoscaling again with hello new interval.</span></span> <span data-ttu-id="9df47-547">Например tooset hello автомасштабирования оценки too60 по прошествии интервала для пула, который уже включена автомасштабирования в .NET:</span><span class="sxs-lookup"><span data-stu-id="9df47-547">For example, tooset hello autoscale evaluation interval too60 minutes for a pool that's already autoscale-enabled in .NET:</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleEvaluationInterval: TimeSpan.FromMinutes(60));
```

## <a name="evaluate-an-autoscale-formula"></a><span data-ttu-id="9df47-548">Оценка формулы автомасштабирования</span><span class="sxs-lookup"><span data-stu-id="9df47-548">Evaluate an autoscale formula</span></span>

<span data-ttu-id="9df47-549">Можно вычислить формулу перед ее применением tooa пула.</span><span class="sxs-lookup"><span data-stu-id="9df47-549">You can evaluate a formula before applying it tooa pool.</span></span> <span data-ttu-id="9df47-550">Таким образом можно проверить формулы toosee hello, как его инструкций вычисляет перед включением hello формулы в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="9df47-550">In this way, you can test hello formula toosee how its statements evaluate before you put hello formula into production.</span></span>

<span data-ttu-id="9df47-551">tooevaluate формулу автомасштабирования, необходимо сначала включить автоматическое масштабирование в пуле hello с допустимую формулу.</span><span class="sxs-lookup"><span data-stu-id="9df47-551">tooevaluate an autoscale formula, you must first enable autoscaling on hello pool with a valid formula.</span></span> <span data-ttu-id="9df47-552">включен tootest формулы в пуле, которые еще не имеют автоматическое масштабирование, одна строка hello использовать формулу `$TargetDedicatedNodes = 0` при включении сначала автоматического масштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-552">tootest a formula on a pool that doesn't yet have autoscaling enabled, use hello one-line formula `$TargetDedicatedNodes = 0` when you first enable autoscaling.</span></span> <span data-ttu-id="9df47-553">Затем воспользуйтесь одним из следующую формулу hello tooevaluate требуется tootest hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-553">Then, use one of hello following tooevaluate hello formula you want tootest:</span></span>

* <span data-ttu-id="9df47-554">Вызовите метод [BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) или [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync).</span><span class="sxs-lookup"><span data-stu-id="9df47-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) or [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span></span>

    <span data-ttu-id="9df47-555">Эти методы .NET пакета требуют идентификатор hello существующего пула и строка, содержащая tooevaluate формулы автомасштабирования hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-555">These Batch .NET methods require hello ID of an existing pool and a string containing hello autoscale formula tooevaluate.</span></span>

* [<span data-ttu-id="9df47-556">Оцените формулу автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-556">Evaluate an automatic scaling formula</span></span>](https://docs.microsoft.com/rest/api/batchservice/evaluate-an-automatic-scaling-formula)

    <span data-ttu-id="9df47-557">В этом запросе REST API, укажите идентификатор пула hello в hello URI и hello формула автоматического масштабирования в hello *autoScaleFormula* элемента hello тексте запроса.</span><span class="sxs-lookup"><span data-stu-id="9df47-557">In this REST API request, specify hello pool ID in hello URI, and hello autoscale formula in hello *autoScaleFormula* element of hello request body.</span></span> <span data-ttu-id="9df47-558">ответ Hello операции hello содержит все сведения об ошибках, которые могут быть связанные toohello формулы.</span><span class="sxs-lookup"><span data-stu-id="9df47-558">hello response of hello operation contains any error information that might be related toohello formula.</span></span>

<span data-ttu-id="9df47-559">В этом фрагменте кода [.NET пакетной службы][net_api] вычисляется формула автомасштабирования.</span><span class="sxs-lookup"><span data-stu-id="9df47-559">In this [Batch .NET][net_api] code snippet, we evaluate an autoscale formula.</span></span> <span data-ttu-id="9df47-560">Если пул hello не имеет включено автоматическое масштабирование, мы включить сначала.</span><span class="sxs-lookup"><span data-stu-id="9df47-560">If hello pool does not have autoscaling enabled, we enable it first.</span></span>

```csharp
// First obtain a reference tooan existing pool
CloudPool pool = await batchClient.PoolOperations.GetPoolAsync("myExistingPool");

// If autoscaling isn't already enabled on hello pool, enable it.
// You can't evaluate an autoscale formula on non-autoscale-enabled pool.
if (pool.AutoScaleEnabled == false)
{
    // We need a valid autoscale formula tooenable autoscaling on the
    // pool. This formula is valid, but won't resize hello pool:
    await pool.EnableAutoScaleAsync(
        autoscaleFormula: "$TargetDedicatedNodes = {pool.CurrentDedicatedNodes};",
        autoscaleEvaluationInterval: TimeSpan.FromMinutes(5));

    // Batch limits EnableAutoScaleAsync calls tooonce every 30 seconds.
    // Because we want tooapply our new autoscale formula below if it
    // evaluates successfully, and we *just* enabled autoscaling on
    // this pool, we pause here tooensure we pass that threshold.
    Thread.Sleep(TimeSpan.FromSeconds(31));

    // Refresh hello properties of hello pool so that we've got the
    // latest value for AutoScaleEnabled
    await pool.RefreshAsync();
}

// We must ensure that autoscaling is enabled on hello pool prior to
// evaluating a formula
if (pool.AutoScaleEnabled == true)
{
    // hello formula tooevaluate - adjusts target number of nodes based on
    // day of week and time of day
    string myFormula = @"
        $curTime = time();
        $workHours = $curTime.hour >= 8 && $curTime.hour < 18;
        $isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
        $isWorkingWeekdayHour = $workHours && $isWeekday;
        $TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
    ";

    // Perform hello autoscale formula evaluation. Note that this code does not
    // actually apply hello formula toohello pool.
    AutoScaleRun eval =
        await batchClient.PoolOperations.EvaluateAutoScaleAsync(pool.Id, myFormula);

    if (eval.Error == null)
    {
        // Evaluation success - print hello results of hello AutoScaleRun.
        // This will display hello values of each variable as evaluated by the
        // autoscale formula.
        Console.WriteLine("AutoScaleRun.Results: " +
            eval.Results.Replace("$", "\n    $"));

        // Apply hello formula toohello pool since it evaluated successfully
        await batchClient.PoolOperations.EnableAutoScaleAsync(pool.Id, myFormula);
    }
    else
    {
        // Evaluation failed, output hello message associated with hello error
        Console.WriteLine("AutoScaleRun.Error.Message: " +
            eval.Error.Message);
    }
}
```

<span data-ttu-id="9df47-561">Успешно проходит проверку hello формулы, показанной в этом фрагменте кода выводятся результаты, аналогичные:</span><span class="sxs-lookup"><span data-stu-id="9df47-561">Successful evaluation of hello formula shown in this code snippet produces results similar to:</span></span>

```
AutoScaleRun.Results:
    $TargetDedicatedNodes=10;
    $NodeDeallocationOption=requeue;
    $curTime=2016-10-13T19:18:47.805Z;
    $isWeekday=1;
    $isWorkingWeekdayHour=0;
    $workHours=0
```

## <a name="get-information-about-autoscale-runs"></a><span data-ttu-id="9df47-562">Получение сведений о выполнениях автомасштабирования</span><span class="sxs-lookup"><span data-stu-id="9df47-562">Get information about autoscale runs</span></span>

<span data-ttu-id="9df47-563">tooensure, ваша формула работает как ожидалось, рекомендуется периодически проверять hello результаты запусков hello автоматического масштабирования, выполняемых в пакете в пуле.</span><span class="sxs-lookup"><span data-stu-id="9df47-563">tooensure that your formula is performing as expected, we recommend that you periodically check hello results of hello autoscaling runs that Batch performs on your pool.</span></span> <span data-ttu-id="9df47-564">toodo таким образом, get (или обновите) toohello ссылка пул, а также проверяет свойства hello его последней автомасштабирования запуска.</span><span class="sxs-lookup"><span data-stu-id="9df47-564">toodo so, get (or refresh) a reference toohello pool, and examine hello properties of its last autoscale run.</span></span>

<span data-ttu-id="9df47-565">В пакете .NET hello [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) свойство имеет несколько свойств, предоставляющих сведения о hello последнюю автоматическое масштабирование запуска выполняется в пуле hello:</span><span class="sxs-lookup"><span data-stu-id="9df47-565">In Batch .NET, hello [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) property has several properties that provide information about hello latest automatic scaling run performed on hello pool:</span></span>

* [<span data-ttu-id="9df47-566">AutoScaleRun.Timestamp.</span><span class="sxs-lookup"><span data-stu-id="9df47-566">AutoScaleRun.Timestamp</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.timestamp)
* [<span data-ttu-id="9df47-567">AutoScaleRun.Results;</span><span class="sxs-lookup"><span data-stu-id="9df47-567">AutoScaleRun.Results</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.results)
* [<span data-ttu-id="9df47-568">AutoScaleRun.Error;</span><span class="sxs-lookup"><span data-stu-id="9df47-568">AutoScaleRun.Error</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.error)

<span data-ttu-id="9df47-569">В hello REST API, hello [получить сведения о пуле](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) запрос возвращает сведения о пуле hello, который включает hello последнюю автоматическое масштабирование запускаться сведения в hello [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) свойство.</span><span class="sxs-lookup"><span data-stu-id="9df47-569">In hello REST API, hello [Get information about a pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) request returns information about hello pool, which includes hello latest automatic scaling run information in hello [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) property.</span></span>

<span data-ttu-id="9df47-570">Hello следующий фрагмент кода C# использует hello пакета .NET библиотеки tooprint сведения о последней автоматическое масштабирование hello запуска в пуле _myPool_:</span><span class="sxs-lookup"><span data-stu-id="9df47-570">hello following C# code snippet uses hello Batch .NET library tooprint information about hello last autoscaling run on pool _myPool_:</span></span>

```csharp
await Cloud pool = myBatchClient.PoolOperations.GetPoolAsync("myPool");
Console.WriteLine("Last execution: " + pool.AutoScaleRun.Timestamp);
Console.WriteLine("Result:" + pool.AutoScaleRun.Results.Replace("$", "\n  $"));
Console.WriteLine("Error: " + pool.AutoScaleRun.Error);
```

<span data-ttu-id="9df47-571">Вывод образца hello предшествующий фрагмент кода:</span><span class="sxs-lookup"><span data-stu-id="9df47-571">Sample output of hello preceding snippet:</span></span>

```
Last execution: 10/14/2016 18:36:43
Result:
  $TargetDedicatedNodes=10;
  $NodeDeallocationOption=requeue;
  $curTime=2016-10-14T18:36:43.282Z;
  $isWeekday=1;
  $isWorkingWeekdayHour=0;
  $workHours=0
Error:
```

## <a name="example-autoscale-formulas"></a><span data-ttu-id="9df47-572">Примеры формул автомасштабирования</span><span class="sxs-lookup"><span data-stu-id="9df47-572">Example autoscale formulas</span></span>
<span data-ttu-id="9df47-573">Рассмотрим некоторые формулы, которые показывают различные способы tooadjust hello объем вычислительных ресурсов в пул.</span><span class="sxs-lookup"><span data-stu-id="9df47-573">Let's look at a few formulas that show different ways tooadjust hello amount of compute resources in a pool.</span></span>

### <a name="example-1-time-based-adjustment"></a><span data-ttu-id="9df47-574">Пример 1. Изменение с учетом времени</span><span class="sxs-lookup"><span data-stu-id="9df47-574">Example 1: Time-based adjustment</span></span>
<span data-ttu-id="9df47-575">Предположим, требуется, чтобы размер пула hello tooadjust в зависимости от hello день недели hello и времени суток.</span><span class="sxs-lookup"><span data-stu-id="9df47-575">Suppose you want tooadjust hello pool size based on hello day of hello week and time of day.</span></span> <span data-ttu-id="9df47-576">В этом примере показано, как tooincrease или уменьшении hello количество узлов в hello пул соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="9df47-576">This example shows how tooincrease or decrease hello number of nodes in hello pool accordingly.</span></span>

<span data-ttu-id="9df47-577">Формула Hello сначала получает hello текущее время.</span><span class="sxs-lookup"><span data-stu-id="9df47-577">hello formula first obtains hello current time.</span></span> <span data-ttu-id="9df47-578">Если день недели (1-5) и в рабочие часы (too6 8: 00 PM), hello целевой размер пула задано too20 узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-578">If it's a weekday (1-5) and within working hours (8 AM too6 PM), hello target pool size is set too20 nodes.</span></span> <span data-ttu-id="9df47-579">В противном случае оно задано too10 узлов.</span><span class="sxs-lookup"><span data-stu-id="9df47-579">Otherwise, it's set too10 nodes.</span></span>

```
$curTime = time();
$workHours = $curTime.hour >= 8 && $curTime.hour < 18;
$isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
$isWorkingWeekdayHour = $workHours && $isWeekday;
$TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
```

### <a name="example-2-task-based-adjustment"></a><span data-ttu-id="9df47-580">Пример 2. Изменение с учетом задачи</span><span class="sxs-lookup"><span data-stu-id="9df47-580">Example 2: Task-based adjustment</span></span>
<span data-ttu-id="9df47-581">В этом примере размер пула hello изменяется на основе hello количества задач в очереди hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-581">In this example, hello pool size is adjusted based on hello number of tasks in hello queue.</span></span> <span data-ttu-id="9df47-582">В строках формул допускаются как комментарии, так и разрывы строк.</span><span class="sxs-lookup"><span data-stu-id="9df47-582">Both comments and line breaks are acceptable in formula strings.</span></span>

```csharp
// Get pending tasks for hello past 15 minutes.
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
// If we have fewer than 70 percent data points, we use hello last sample point,
// otherwise we use hello maximum of last sample point and hello history average.
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1), avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// If number of pending tasks is not 0, set targetVM toopending tasks, otherwise
// half of current dedicated.
$targetVMs = $tasks > 0? $tasks:max(0, $TargetDedicatedNodes/2);
// hello pool size is capped at 20, if target VM value is more than that, set it
// too20. This value should be adjusted according tooyour use case.
$TargetDedicatedNodes = max(0, min($targetVMs, 20));
// Set node deallocation mode - keep nodes active only until tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-3-accounting-for-parallel-tasks"></a><span data-ttu-id="9df47-583">Пример 3. Параллельные задачи</span><span class="sxs-lookup"><span data-stu-id="9df47-583">Example 3: Accounting for parallel tasks</span></span>
<span data-ttu-id="9df47-584">В этом примере изменяется размер пула hello в зависимости от hello количество задач.</span><span class="sxs-lookup"><span data-stu-id="9df47-584">This example adjusts hello pool size based on hello number of tasks.</span></span> <span data-ttu-id="9df47-585">Эта формула также учитывает hello учетной записи [MaxTasksPerComputeNode] [ net_maxtasks] значения, которое задано для пула hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-585">This formula also takes into account hello [MaxTasksPerComputeNode][net_maxtasks] value that has been set for hello pool.</span></span> <span data-ttu-id="9df47-586">Такой подход полезен, если в пуле поддерживается [параллельное выполнение задач](batch-parallel-node-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="9df47-586">This approach is useful in situations where [parallel task execution](batch-parallel-node-tasks.md) has been enabled on your pool.</span></span>

```csharp
// Determine whether 70 percent of hello samples have been recorded in hello past
// 15 minutes; if not, use last sample
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1),avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// Set hello number of nodes tooadd tooone-fourth hello number of active tasks (the
// MaxTasksPerComputeNode property on this pool is set too4, adjust this number
// for your use case)
$cores = $TargetDedicatedNodes * 4;
$extraVMs = (($tasks - $cores) + 3) / 4;
$targetVMs = ($TargetDedicatedNodes + $extraVMs);
// Attempt toogrow hello number of compute nodes toomatch hello number of active
// tasks, with a maximum of 3
$TargetDedicatedNodes = max(0,min($targetVMs,3));
// Keep hello nodes active until hello tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-4-setting-an-initial-pool-size"></a><span data-ttu-id="9df47-587">Пример 4. Настройка исходного размера пула</span><span class="sxs-lookup"><span data-stu-id="9df47-587">Example 4: Setting an initial pool size</span></span>
<span data-ttu-id="9df47-588">В этом примере, что показано на языке C# фрагмент с формулу автомасштабирования, которая задает кода hello tooa размер пула указано количество узлов для начальный период времени.</span><span class="sxs-lookup"><span data-stu-id="9df47-588">This example shows a C# code snippet with an autoscale formula that sets hello pool size tooa specified number of nodes for an initial time period.</span></span> <span data-ttu-id="9df47-589">Затем он корректирует размер пула hello в зависимости от hello число работающих и по истечении активные задачи после hello начальный период времени.</span><span class="sxs-lookup"><span data-stu-id="9df47-589">Then it adjusts hello pool size based on hello number of running and active tasks after hello initial time period has elapsed.</span></span>

<span data-ttu-id="9df47-590">Формула Hello в hello, следующий фрагмент кода:</span><span class="sxs-lookup"><span data-stu-id="9df47-590">hello formula in hello following code snippet:</span></span>

* <span data-ttu-id="9df47-591">Задает размер toofour узлы начального пула в hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-591">Sets hello initial pool size toofour nodes.</span></span>
* <span data-ttu-id="9df47-592">Корректирует размер пула hello в hello первый 10 минут hello пула жизненного цикла.</span><span class="sxs-lookup"><span data-stu-id="9df47-592">Does not adjust hello pool size within hello first 10 minutes of hello pool's lifecycle.</span></span>
* <span data-ttu-id="9df47-593">Через 10 минут получает hello максимальное значение параметра hello число запущена и активных задач в пределах hello за последние 60 минут.</span><span class="sxs-lookup"><span data-stu-id="9df47-593">After 10 minutes, obtains hello max value of hello number of running and active tasks within hello past 60 minutes.</span></span>
  * <span data-ttu-id="9df47-594">Если оба значения равны 0 (это означает, что никакие задачи были запущенной или активного в hello последние 60 минут), too0 задается размер пула hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-594">If both values are 0 (indicating that no tasks were running or active in hello last 60 minutes), hello pool size is set too0.</span></span>
  * <span data-ttu-id="9df47-595">Если любое из значений больше нуля, изменений не производится.</span><span class="sxs-lookup"><span data-stu-id="9df47-595">If either value is greater than zero, no change is made.</span></span>

```csharp
string now = DateTime.UtcNow.ToString("r");
string formula = string.Format(@"
    $TargetDedicatedNodes = {1};
    lifespan         = time() - time(""{0}"");
    span             = TimeInterval_Minute * 60;
    startup          = TimeInterval_Minute * 10;
    ratio            = 50;

    $TargetDedicatedNodes = (lifespan > startup ? (max($RunningTasks.GetSample(span, ratio), $ActiveTasks.GetSample(span, ratio)) == 0 ? 0 : $TargetDedicatedNodes) : {1});
    ", now, 4);
```

## <a name="next-steps"></a><span data-ttu-id="9df47-596">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="9df47-596">Next steps</span></span>
* <span data-ttu-id="9df47-597">[Максимально увеличить использование ресурсов вычислений пакета Azure с помощью узла параллельных задач](batch-parallel-node-tasks.md) содержит сведения о том, как можно выполнять несколько задач одновременно на вычислительных узлах hello в пуле.</span><span class="sxs-lookup"><span data-stu-id="9df47-597">[Maximize Azure Batch compute resource usage with concurrent node tasks](batch-parallel-node-tasks.md) contains details about how you can execute multiple tasks simultaneously on hello compute nodes in your pool.</span></span> <span data-ttu-id="9df47-598">В дополнение к этому tooautoscaling, эта функция может помочь toolower длительности задания некоторых рабочих нагрузок, экономя деньги.</span><span class="sxs-lookup"><span data-stu-id="9df47-598">In addition tooautoscaling, this feature may help toolower job duration for some workloads, saving you money.</span></span>
* <span data-ttu-id="9df47-599">Другой оптимизации эффективности убедитесь, что запросы пакета приложения hello пакетной службы в большинстве оптимальным способом hello.</span><span class="sxs-lookup"><span data-stu-id="9df47-599">For another efficiency booster, ensure that your Batch application queries hello Batch service in hello most optimal way.</span></span> <span data-ttu-id="9df47-600">В разделе [эффективно запрашивать hello пакетной службы Azure](batch-efficient-list-queries.md) toolearn как toolimit hello объем данных, передаваемых по сети hello при запросе состояния hello тысяч вычислительные узлы или задачи.</span><span class="sxs-lookup"><span data-stu-id="9df47-600">See [Query hello Azure Batch service efficiently](batch-efficient-list-queries.md) toolearn how toolimit hello amount of data that crosses hello wire when you query hello status of potentially thousands of compute nodes or tasks.</span></span>

[net_api]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch
[net_batchclient]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.batchclient
[net_cloudpool_autoscaleformula]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula
[net_cloudpool_autoscaleevalinterval]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval
[net_enableautoscaleasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.enableautoscaleasync
[net_maxtasks]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.maxtaskspercomputenode
[net_poolops_resizepoolasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.resizepoolasync

[rest_api]: https://docs.microsoft.com/rest/api/batchservice/
[rest_autoscaleformula]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_autoscaleinterval]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_enableautoscale]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
