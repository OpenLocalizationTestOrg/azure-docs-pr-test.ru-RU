---
title: "aaaPersist заданий и задач вывода tooAzure хранилища с hello API службы пакетной службы Azure | Документы Microsoft"
description: "Узнайте, как задачи пакета toopersist toouse API пакетной службы и задания вывода tooAzure хранилища."
services: batch
author: tamram
manager: timlt
editor: 
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.openlocfilehash: 71b3f7c0dda2d2a9d8eb3eef83229873c70ca22c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/06/2017
---
# <a name="persist-task-data-tooazure-storage-with-hello-batch-service-api"></a><span data-ttu-id="818bc-103">Сохранение данных задач tooAzure хранилища с hello API пакетной службы</span><span class="sxs-lookup"><span data-stu-id="818bc-103">Persist task data tooAzure Storage with hello Batch service API</span></span>

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

<span data-ttu-id="818bc-104">Начиная с версии 2017 г-05-01, hello API пакетной службы поддерживает сохранение вывода данных tooAzure хранилища для задач и задание диспетчера задач, которые выполняются в пулах, hello конфигурации виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="818bc-104">Starting with version 2017-05-01, hello Batch service API supports persisting output data tooAzure Storage for tasks and job manager tasks that run on pools with hello virtual machine configuration.</span></span> <span data-ttu-id="818bc-105">При добавлении задачи, можно указать контейнер в хранилище Azure как hello назначение для выходных данных задачи hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-105">When you add a task, you can specify a container in Azure Storage as hello destination for hello task's output.</span></span> <span data-ttu-id="818bc-106">Здравствуйте, пакетная служба, а затем записывает любого контейнера toothat вывода данных, при завершении задачи hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-106">hello Batch service then writes any output data toothat container when hello task is complete.</span></span>

<span data-ttu-id="818bc-107">Выполняется hello toousing преимущества пакета, выходные данные задачи toopersist API службы является приложение hello toomodify, hello задач не требуется.</span><span class="sxs-lookup"><span data-stu-id="818bc-107">An advantage toousing hello Batch service API toopersist task output is that you do not need toomodify hello application that hello task is running.</span></span> <span data-ttu-id="818bc-108">Вместо этого с несколько простых изменения tooyour клиентского приложения можно сохранить задачу hello выходные данные в пределах hello код, создающий задачу hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-108">Instead, with a few simple modifications tooyour client application, you can persist hello task's output from within hello code that creates hello task.</span></span>   

## <a name="when-do-i-use-hello-batch-service-api-toopersist-task-output"></a><span data-ttu-id="818bc-109">Когда использовать выходные данные задачи toopersist hello API пакетной службы?</span><span class="sxs-lookup"><span data-stu-id="818bc-109">When do I use hello Batch service API toopersist task output?</span></span>

<span data-ttu-id="818bc-110">Пакет Azure предоставляет несколько способов toopersist выходные данные задачи.</span><span class="sxs-lookup"><span data-stu-id="818bc-110">Azure Batch provides more than one way toopersist task output.</span></span> <span data-ttu-id="818bc-111">Использование hello API пакетной службы — удобный подход, который наиболее подходит toothese сценариев:</span><span class="sxs-lookup"><span data-stu-id="818bc-111">Using hello Batch service API is a convenient approach that's best suited toothese scenarios:</span></span>

- <span data-ttu-id="818bc-112">Требуется toowrite кода toopersist задач выходные данные в клиентском приложении без изменения приложения hello, на котором работает ваша задача.</span><span class="sxs-lookup"><span data-stu-id="818bc-112">You want toowrite code toopersist task output from within your client application, without modifying hello application that your task is running.</span></span>
- <span data-ttu-id="818bc-113">Вы хотите toopersist выходных данных пакетных задач и задачи диспетчера заданий в пулах, созданных с помощью hello конфигурации виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="818bc-113">You want toopersist output from Batch tasks and job manager tasks in pools created with hello virtual machine configuration.</span></span>
- <span data-ttu-id="818bc-114">Вы хотите toopersist выходной tooan контейнер хранилища Azure с произвольное имя.</span><span class="sxs-lookup"><span data-stu-id="818bc-114">You want toopersist output tooan Azure Storage container with an arbitrary name.</span></span>
- <span data-ttu-id="818bc-115">Требуется tooan хранилища Azure toopersist выходной контейнер с именем, соответствующим toohello [пакетных файлов, принятых standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="818bc-115">You want toopersist output tooan Azure Storage container named according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> 

<span data-ttu-id="818bc-116">Если ваш сценарий отличается от перечисленных выше, может потребоваться tooconsider другой подход.</span><span class="sxs-lookup"><span data-stu-id="818bc-116">If your scenario differs from those listed above, you may need tooconsider a different approach.</span></span> <span data-ttu-id="818bc-117">Например, hello пакетной службы API не поддерживает в настоящее время потоковой передачи tooAzure выходные данные хранилища во время выполнения задачи hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-117">For example, hello Batch service API does not currently support streaming output tooAzure Storage while hello task is running.</span></span> <span data-ttu-id="818bc-118">Выход toostream, рассмотрите возможность использования библиотеки пакетных файлов, принятых hello, доступных для .NET.</span><span class="sxs-lookup"><span data-stu-id="818bc-118">toostream output, consider using hello Batch File Conventions library, available for .NET.</span></span> <span data-ttu-id="818bc-119">Для других языков вам потребуется tooimplement собственное решение.</span><span class="sxs-lookup"><span data-stu-id="818bc-119">For other languages, you'll need tooimplement your own solution.</span></span> <span data-ttu-id="818bc-120">Дополнительные сведения о других способах сохранения выходных данных задачи. в разделе [Persist заданий и задач вывода tooAzure хранения](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="818bc-120">For more information on other options for persisting task output, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span> 

## <a name="create-a-container-in-azure-storage"></a><span data-ttu-id="818bc-121">Создание контейнера в службе хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="818bc-121">Create a container in Azure Storage</span></span>

<span data-ttu-id="818bc-122">Задача toopersist вывод tooAzure хранилища, вам потребуется toocreate контейнер, который служит в качестве назначения hello для выходные файлы.</span><span class="sxs-lookup"><span data-stu-id="818bc-122">toopersist task output tooAzure Storage, you'll need toocreate a container that serves as hello destination for your output files.</span></span> <span data-ttu-id="818bc-123">Создание контейнера hello, прежде чем запускать задачу, предпочтительно перед отправкой задания.</span><span class="sxs-lookup"><span data-stu-id="818bc-123">Create hello container before you run your task, preferably before you submit your job.</span></span> <span data-ttu-id="818bc-124">toocreate hello контейнера, используйте hello соответствующую хранилища Azure клиентскую библиотеку или SDK.</span><span class="sxs-lookup"><span data-stu-id="818bc-124">toocreate hello container, use hello appropriate Azure Storage client library or SDK.</span></span> <span data-ttu-id="818bc-125">Дополнительные сведения об API-интерфейсов хранилища Azure см. в разделе hello [документации по хранилищу Azure](https://docs.microsoft.com/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="818bc-125">For more information about Azure Storage APIs, see hello [Azure Storage documentation](https://docs.microsoft.com/azure/storage/).</span></span>

<span data-ttu-id="818bc-126">Например, при создании приложения на языке C# используйте hello [клиентской библиотеки хранилища Azure для .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="818bc-126">For example, if you are writing your application in C#, use hello [Azure Storage client library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="818bc-127">Следующий пример показывает как Hello toocreate контейнер:</span><span class="sxs-lookup"><span data-stu-id="818bc-127">hello following example shows how toocreate a container:</span></span>

```csharp
CloudBlobContainer container = storageAccount.CreateCloudBlobClient().GetContainerReference(containerName);
await conainer.CreateIfNotExists();
```

## <a name="get-a-shared-access-signature-for-hello-container"></a><span data-ttu-id="818bc-128">Получить подписанный URL-адрес для контейнера hello</span><span class="sxs-lookup"><span data-stu-id="818bc-128">Get a shared access signature for hello container</span></span>

<span data-ttu-id="818bc-129">После создания контейнера hello получите подпись общего доступа (SAS) с контейнером toohello доступ для записи.</span><span class="sxs-lookup"><span data-stu-id="818bc-129">After you create hello container, get a shared access signature (SAS) with write access toohello container.</span></span> <span data-ttu-id="818bc-130">Подписанный URL-адрес содержит контейнер toohello делегированный доступ.</span><span class="sxs-lookup"><span data-stu-id="818bc-130">A SAS provides delegated access toohello container.</span></span> <span data-ttu-id="818bc-131">Hello SAS предоставляет доступ с указанным набором разрешений и через указанный интервал времени.</span><span class="sxs-lookup"><span data-stu-id="818bc-131">hello SAS grants access with a specified set of permissions and over a specified time interval.</span></span> <span data-ttu-id="818bc-132">Hello пакетная служба должна SAS с контейнера toohello выходные данные задачи toowrite записи разрешений.</span><span class="sxs-lookup"><span data-stu-id="818bc-132">hello Batch service needs a SAS with write permissions toowrite task output toohello container.</span></span> <span data-ttu-id="818bc-133">Дополнительные сведения о подписанных URL-адресах см. в разделе [Использование подписанных URL-адресов \(SAS\) в службе хранилища Azure](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="818bc-133">For more information about SAS, see [Using shared access signatures \(SAS\) in Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="818bc-134">При получении SAS, с помощью API-интерфейсов хранилища Azure hello hello API возвращает строку токена SAS.</span><span class="sxs-lookup"><span data-stu-id="818bc-134">When you get a SAS using hello Azure Storage APIs, hello API returns a SAS token string.</span></span> <span data-ttu-id="818bc-135">Эта строка токена, включает все параметры hello SAS, включая разрешения hello и интервал приветствия, над какой hello SAS является допустимым.</span><span class="sxs-lookup"><span data-stu-id="818bc-135">This token string includes all parameters of hello SAS, including hello permissions and hello interval over which hello SAS is valid.</span></span> <span data-ttu-id="818bc-136">toouse hello tooaccess SAS контейнера в хранилище Azure, необходимо tooappend hello SAS строку лексемы toohello ресурса (URI).</span><span class="sxs-lookup"><span data-stu-id="818bc-136">toouse hello SAS tooaccess a container in Azure Storage, you need tooappend hello SAS token string toohello resource URI.</span></span> <span data-ttu-id="818bc-137">Hello URI ресурса, а также hello добавляется маркер SAS, предоставляет доступ с проверкой подлинности tooAzure хранилища.</span><span class="sxs-lookup"><span data-stu-id="818bc-137">hello resource URI, together with hello appended SAS token, provides authenticated access tooAzure Storage.</span></span>

<span data-ttu-id="818bc-138">Hello следующем примере показано, как строку hello контейнера токена tooget SAS только для записи, а затем добавляет URI контейнера toohello hello SAS:</span><span class="sxs-lookup"><span data-stu-id="818bc-138">hello following example shows how tooget a write-only SAS token string for hello container, then appends hello SAS toohello container URI:</span></span>

```csharp
string containerSasToken = container.GetSharedAccessSignature(new SharedAccessBlobPolicy()
{
    SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddDays(1),
    Permissions = SharedAccessBlobPermissions.Write
});

string containerSasUrl = container.Uri.AbsoluteUri + containerSasToken; 
```

## <a name="specify-output-files-for-task-output"></a><span data-ttu-id="818bc-139">Указание файлов для выходных данных задачи</span><span class="sxs-lookup"><span data-stu-id="818bc-139">Specify output files for task output</span></span>

<span data-ttu-id="818bc-140">toospecify выходные файлы для задачи, создать коллекцию [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) объектов и назначьте его toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) свойства при создании задачи hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-140">toospecify output files for a task, create a collection of [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objects and assign it toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) property when you create hello task.</span></span> 

<span data-ttu-id="818bc-141">Hello пример кода .NET создает задачу, которая создает случайные числа tooa файл с именем `output.txt`.</span><span class="sxs-lookup"><span data-stu-id="818bc-141">hello following .NET code example creates a task that writes random numbers tooa file named `output.txt`.</span></span> <span data-ttu-id="818bc-142">пример Hello создает выходной файл для `output.txt` toobe записи toohello контейнера.</span><span class="sxs-lookup"><span data-stu-id="818bc-142">hello example creates an output file for `output.txt` toobe written toohello container.</span></span> <span data-ttu-id="818bc-143">пример Hello также создает выходные файлы для всех файлов журнала, соответствующие шаблону файла hello `std*.txt` (_например_, `stdout.txt` и `stderr.txt`).</span><span class="sxs-lookup"><span data-stu-id="818bc-143">hello example also creates output files for any log files that match hello file pattern `std*.txt` (_e.g._, `stdout.txt` and `stderr.txt`).</span></span> <span data-ttu-id="818bc-144">URL-адрес контейнера Hello требует hello SAS, который был создан ранее для контейнера hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-144">hello container URL requires hello SAS that was created previously for hello container.</span></span> <span data-ttu-id="818bc-145">Hello пакетная служба использует hello SAS tooauthenticate доступа toohello контейнера:</span><span class="sxs-lookup"><span data-stu-id="818bc-145">hello Batch service uses hello SAS tooauthenticate access toohello container:</span></span> 

```csharp
new CloudTask(taskId, "cmd /v:ON /c \"echo off && set && (FOR /L %i IN (1,1,100000) DO (ECHO !RANDOM!)) > output.txt\"")
{
    OutputFiles = new List<OutputFile>
    {
        new OutputFile(
            filePattern: @"..\std*.txt",
            destination: new OutputFileDestination(
         new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId)),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
        new OutputFile(
            filePattern: @"output.txt",
            destination: 
         new OutputFileDestination(new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId + @"\output.txt")),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
}
```

### <a name="specify-a-file-pattern-for-matching"></a><span data-ttu-id="818bc-146">Указание шаблона файла для поиска соответствий</span><span class="sxs-lookup"><span data-stu-id="818bc-146">Specify a file pattern for matching</span></span>

<span data-ttu-id="818bc-147">При указании выходной файл, можно использовать hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) toospecify свойство шаблон файла для сопоставления.</span><span class="sxs-lookup"><span data-stu-id="818bc-147">When you specify an output file, you can use hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) property toospecify a file pattern for matching.</span></span> <span data-ttu-id="818bc-148">шаблон файла Hello может соответствовать файлов ноль, один файл или набор файлов, созданных задачей «hello».</span><span class="sxs-lookup"><span data-stu-id="818bc-148">hello file pattern may match zero files, a single file, or a set of files that are created by hello task.</span></span>

<span data-ttu-id="818bc-149">Hello **FilePattern** свойство поддерживает подстановочные знаки стандартной файловой системы, такие как `*` (для нерекурсивных соответствует) и `**` (для рекурсивного соответствует).</span><span class="sxs-lookup"><span data-stu-id="818bc-149">hello **FilePattern** property supports standard filesystem wildcards such as `*` (for non-recursive matches) and `**` (for recursive matches).</span></span> <span data-ttu-id="818bc-150">Hello приведенном выше примере указывается hello файл шаблона toomatch `std*.txt` нерекурсивно:</span><span class="sxs-lookup"><span data-stu-id="818bc-150">For example, hello code sample above specifies hello file pattern toomatch `std*.txt` non-recursively:</span></span> 

`filePattern: @"..\std*.txt"`

<span data-ttu-id="818bc-151">tooupload один файл, укажите шаблон файла без подстановочных знаков.</span><span class="sxs-lookup"><span data-stu-id="818bc-151">tooupload a single file, specify a file pattern with no wildcards.</span></span> <span data-ttu-id="818bc-152">Hello приведенном выше примере указывается hello файл шаблона toomatch `output.txt`:</span><span class="sxs-lookup"><span data-stu-id="818bc-152">For example, hello code sample above specifies hello file pattern toomatch `output.txt`:</span></span>

`filePattern: @"output.txt"`

### <a name="specify-an-upload-condition"></a><span data-ttu-id="818bc-153">Указание условия отправки</span><span class="sxs-lookup"><span data-stu-id="818bc-153">Specify an upload condition</span></span>

<span data-ttu-id="818bc-154">Hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) свойство разрешает условного Отправка выходных файлов.</span><span class="sxs-lookup"><span data-stu-id="818bc-154">hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) property permits conditional uploading of output files.</span></span> <span data-ttu-id="818bc-155">Распространенным сценарием является tooupload один набор файлов, если hello задача выполнена успешно, а другой набор файлов в случае неудачи.</span><span class="sxs-lookup"><span data-stu-id="818bc-155">A common scenario is tooupload one set of files if hello task succeeds, and a different set of files if it fails.</span></span> <span data-ttu-id="818bc-156">Например вы можете tooupload подробных файлов журнала только в том случае, когда задача hello завершается ошибкой и завершает работу с ненулевой код выхода.</span><span class="sxs-lookup"><span data-stu-id="818bc-156">For example, you may want tooupload verbose log files only when hello task fails and exits with a nonzero exit code.</span></span> <span data-ttu-id="818bc-157">Аналогичным образом вы можете tooupload результирующие файлы только в том случае, если задача hello завершается успешно, как возможно, эти файлы отсутствуют или являются неполными, если происходит сбой задачи hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-157">Similarly, you may want tooupload result files only if hello task succeeds, as those files may be missing or incomplete if hello task fails.</span></span>

<span data-ttu-id="818bc-158">Hello кода выше образце hello **UploadCondition** свойство слишком**TaskCompletion**.</span><span class="sxs-lookup"><span data-stu-id="818bc-158">hello code sample above sets hello **UploadCondition** property too**TaskCompletion**.</span></span> <span data-ttu-id="818bc-159">Этот параметр указывает, что это файл hello toobe отправлен после завершения задачи hello, независимо от того, hello значение кода выхода hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-159">This setting specifies that hello file is toobe uploaded after hello tasks completes, regardless of hello value of hello exit code.</span></span> 

`uploadCondition: OutputFileUploadCondition.TaskCompletion`

<span data-ttu-id="818bc-160">Другие параметры в разделе hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) перечисления.</span><span class="sxs-lookup"><span data-stu-id="818bc-160">For other settings, see hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span></span>

### <a name="disambiguate-files-with-hello-same-name"></a><span data-ttu-id="818bc-161">Файлы с hello устранения неоднозначности таким же именем</span><span class="sxs-lookup"><span data-stu-id="818bc-161">Disambiguate files with hello same name</span></span>

<span data-ttu-id="818bc-162">Hello задачи в задании может создают файлы, содержащие hello таким же именем.</span><span class="sxs-lookup"><span data-stu-id="818bc-162">hello tasks in a job may produce files that have hello same name.</span></span> <span data-ttu-id="818bc-163">Например, для каждой задачи, выполняемой в задании, создаются файлы `stdout.txt` и `stderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="818bc-163">For example, `stdout.txt` and `stderr.txt` are created for every task that runs in a job.</span></span> <span data-ttu-id="818bc-164">Поскольку каждая задача выполняется в его собственном контексте, эти файлы не конфликтует hello узла в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="818bc-164">Because each task runs in its own context, these files don't conflict on hello node's file system.</span></span> <span data-ttu-id="818bc-165">Однако при передаче файлов из общего контейнера tooa несколько задач, вам потребуется toodisambiguate файлы с hello таким же именем.</span><span class="sxs-lookup"><span data-stu-id="818bc-165">However, when you upload files from multiple tasks tooa shared container, you'll need toodisambiguate files with hello same name.</span></span>

<span data-ttu-id="818bc-166">Hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) свойство задает BLOB-объект назначения hello или виртуальный каталог для выходных файлов.</span><span class="sxs-lookup"><span data-stu-id="818bc-166">hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) property specifies hello destination blob or virtual directory for output files.</span></span> <span data-ttu-id="818bc-167">Можно использовать hello **путь** свойство tooname hello blob или виртуального каталога, таким образом, что выходные данные файлы с таким же именем должны иметь уникальные имена в хранилище Azure hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-167">You can use hello **Path** property tooname hello blob or virtual directory in such a way that output files with hello same name are uniquely named in Azure Storage.</span></span> <span data-ttu-id="818bc-168">Использование ИД задачи: hello hello пути является хорошим способом tooensure уникальные имена и легко идентифицировать файлы.</span><span class="sxs-lookup"><span data-stu-id="818bc-168">Using hello task ID in hello path is a good way tooensure unique names and easily identify files.</span></span>

<span data-ttu-id="818bc-169">Если hello **FilePattern** свойству tooa выражение с подстановочными знаками, то все файлы, которые соответствуют шаблону hello не переданные toohello виртуальный каталог, заданный параметром hello **путь** свойство.</span><span class="sxs-lookup"><span data-stu-id="818bc-169">If hello **FilePattern** property is set tooa wildcard expression, then all files that match hello pattern are uploaded toohello virtual directory specified by hello **Path** property.</span></span> <span data-ttu-id="818bc-170">Например, если hello контейнером является `mycontainer`, hello задачи с Идентификатором `mytask`, и является шаблон файла hello `..\std*.txt`, затем hello абсолютные идентификаторы URI toohello выходные файлы в хранилище Azure будет выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="818bc-170">For example, if hello container is `mycontainer`, hello task ID is `mytask`, and hello file pattern is `..\std*.txt`, then hello absolute URIs toohello output files in Azure Storage will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/mytask/stderr.txt
https://myaccount.blob.core.windows.net/mycontainer/mytask/stdout.txt
```

<span data-ttu-id="818bc-171">Если hello **FilePattern** свойство является набор toomatch одно имя файла, то есть не содержит подстановочные знаки, затем hello значение hello **путь** указывает имя hello полное больших двоичных объектов .</span><span class="sxs-lookup"><span data-stu-id="818bc-171">If hello **FilePattern** property is set toomatch a single file name, meaning it does not contain any wildcard characters, then hello value of hello **Path** property specifies hello fully qualified blob name.</span></span> <span data-ttu-id="818bc-172">Если предполагается конфликты имен с один файл из нескольких задач, включите hello имя виртуального каталога hello как часть toodisambiguate имя файла hello этих файлов.</span><span class="sxs-lookup"><span data-stu-id="818bc-172">If you anticipate naming conflicts with a single file from multiple tasks, then include hello name of hello virtual directory as part of hello file name toodisambiguate those files.</span></span> <span data-ttu-id="818bc-173">Например, набор hello **путь** идентификатор задачи hello tooinclude свойства, символ-разделитель hello (обычно косой черты) и имя файла hello:</span><span class="sxs-lookup"><span data-stu-id="818bc-173">For example, set hello **Path** property tooinclude hello task ID, hello delimiter character (typically a forward slash), and hello file name:</span></span>

`path: taskId + @"/output.txt"`

<span data-ttu-id="818bc-174">Hello абсолютные идентификаторы URI toohello выходных файлов для списка задач будет аналогичен:</span><span class="sxs-lookup"><span data-stu-id="818bc-174">hello absolute URIs toohello output files for a set of tasks will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/task1/output.txt
https://myaccount.blob.core.windows.net/mycontainer/task2/output.txt
```

<span data-ttu-id="818bc-175">Дополнительные сведения о виртуальных каталогах в хранилище Azure см. в разделе [hello двоичные объекты перечислены в контейнер](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span><span class="sxs-lookup"><span data-stu-id="818bc-175">For more information about virtual directories in Azure Storage, see [List hello blobs in a container](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span></span>


## <a name="diagnose-file-upload-errors"></a><span data-ttu-id="818bc-176">Диагностика ошибок при передаче файлов</span><span class="sxs-lookup"><span data-stu-id="818bc-176">Diagnose file upload errors</span></span>

<span data-ttu-id="818bc-177">Если отправка выходных данных файлов tooAzure хранилища, а затем задачу hello переходит toohello **завершено** состояния и hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) свойству.</span><span class="sxs-lookup"><span data-stu-id="818bc-177">If uploading output files tooAzure Storage fails, then hello task moves toohello **Completed** state and hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) property is set.</span></span> <span data-ttu-id="818bc-178">Изучите hello **FailureInformation** toodetermine свойство причину возникновения ошибки.</span><span class="sxs-lookup"><span data-stu-id="818bc-178">Examine hello **FailureInformation** property toodetermine what error occurred.</span></span> <span data-ttu-id="818bc-179">Например это ошибка, возникающая на передачу файла, если не удается найти контейнер hello:</span><span class="sxs-lookup"><span data-stu-id="818bc-179">For example, here is an error that occurs on file upload if hello container cannot be found:</span></span> 

```
Category: UserError
Code: FileUploadContainerNotFound
Message: One of hello specified Azure container(s) was not found while attempting tooupload an output file
```

<span data-ttu-id="818bc-180">На каждой отправки файла пакета записывает два журнала файлов toohello вычислительных узлов, `fileuploadout.txt` и `fileuploaderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="818bc-180">On every file upload, Batch writes two log files toohello compute node, `fileuploadout.txt` and `fileuploaderr.txt`.</span></span> <span data-ttu-id="818bc-181">Можно проверить эти toolearn файлы журналов, дополнительные о конкретной ошибке.</span><span class="sxs-lookup"><span data-stu-id="818bc-181">You can examine these log files toolearn more about a specific failure.</span></span> <span data-ttu-id="818bc-182">В случаях, где hello попыталась загрузить файл никогда не, например, так как не удалось выполнить саму задачу hello затем эти файлы журналов не существует.</span><span class="sxs-lookup"><span data-stu-id="818bc-182">In cases where hello file upload was never attempted, for example because hello task itself couldn’t run, then these log files will not exist.</span></span>

## <a name="diagnose-file-upload-performance"></a><span data-ttu-id="818bc-183">Диагностика производительности передачи файлов</span><span class="sxs-lookup"><span data-stu-id="818bc-183">Diagnose file upload performance</span></span>

<span data-ttu-id="818bc-184">Hello `fileuploadout.txt` прогресса отправки журналов файла.</span><span class="sxs-lookup"><span data-stu-id="818bc-184">hello `fileuploadout.txt` file logs upload progress.</span></span> <span data-ttu-id="818bc-185">Можно проверить этот файл toolearn, которые делаются узнать, как долго загружает файл.</span><span class="sxs-lookup"><span data-stu-id="818bc-185">You can examine this file toolearn more about how long your file uploads are taking.</span></span> <span data-ttu-id="818bc-186">Следует помнить, существует множество ключевых факторов производительности tooupload, включая размер hello узла hello, другие действия на узле hello во время hello передачи hello, является ли целевой контейнер hello hello, сколько узлов же регионе в качестве пула пакета hello Отправка toohello учетной записи хранилища в hello же время и т. д.</span><span class="sxs-lookup"><span data-stu-id="818bc-186">Keep in mind that there are many contributing factors tooupload performance, including hello size of hello node, other activity on hello node at hello time of hello upload, whether hello target container is in hello same region as hello Batch pool, how many nodes are uploading toohello storage account at hello same time, and so on.</span></span>

## <a name="use-hello-batch-service-api-with-hello-batch-file-conventions-standard"></a><span data-ttu-id="818bc-187">Использовать API-Интерфейс службы hello пакета с hello пакетных файлов, принятых standard</span><span class="sxs-lookup"><span data-stu-id="818bc-187">Use hello Batch service API with hello Batch File Conventions standard</span></span>

<span data-ttu-id="818bc-188">При сохранении выходные данные задачи с hello API пакетной службы вы можно присвоить имя конечного контейнера и больших двоичных объектов, однако вам нравится.</span><span class="sxs-lookup"><span data-stu-id="818bc-188">When you persist task output with hello Batch service API, you can name your destination container and blobs however you like.</span></span> <span data-ttu-id="818bc-189">Вы также можете tooname их в соответствии с toohello [пакетных файлов, принятых standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="818bc-189">You can also choose tooname them according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> <span data-ttu-id="818bc-190">стандартный файл соглашения Hello определяет имена hello hello конечный контейнер и BLOB-объектов в хранилище Azure для данной выходной файл, на основе имен hello hello заданий и задач.</span><span class="sxs-lookup"><span data-stu-id="818bc-190">hello File Conventions standard determines hello names of hello destination container and blob in Azure Storage for a given output file based on hello names of hello job and task.</span></span> <span data-ttu-id="818bc-191">Если вы используете hello стандартные соглашения файлов для именования выходных файлов, то выходные файлы были доступны для просмотра в hello [портал Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="818bc-191">If you do use hello File Conventions standard for naming output files, then your output files are available for viewing in hello [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="818bc-192">При разработке на языке C# можно использовать методы hello, встроенные в hello [пакетных файлов, принятых библиотека для .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span><span class="sxs-lookup"><span data-stu-id="818bc-192">If you are developing in C#, you can use hello methods built into hello [Batch File Conventions library for .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span></span> <span data-ttu-id="818bc-193">Эта библиотека создает hello правильно указаны контейнеры и путей больших двоичных объектов для вас.</span><span class="sxs-lookup"><span data-stu-id="818bc-193">This library creates hello properly named containers and blob paths for you.</span></span> <span data-ttu-id="818bc-194">Например можно вызвать hello API tooget hello верное имя для контейнера hello, на основе имени задания hello:</span><span class="sxs-lookup"><span data-stu-id="818bc-194">For example, you can call hello API tooget hello correct name for hello container, based on hello job name:</span></span>

```csharp
string containerName = job.OutputStorageContainerName();
```

<span data-ttu-id="818bc-195">Можно использовать hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) tooreturn метод адреса (SAS) URL-адрес используется toowrite toohello контейнера.</span><span class="sxs-lookup"><span data-stu-id="818bc-195">You can use hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) method tooreturn a shared access signature (SAS) URL that is used toowrite toohello container.</span></span> <span data-ttu-id="818bc-196">Затем можно передать этот SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) конструктор.</span><span class="sxs-lookup"><span data-stu-id="818bc-196">You can then pass this SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructor.</span></span>

<span data-ttu-id="818bc-197">При разработке на языке, отличном от C#, необходимо будет стандартного соглашения файлов hello tooimplement самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="818bc-197">If you are developing in a language other than C#, you will need tooimplement hello File Conventions standard yourself.</span></span>

## <a name="code-sample"></a><span data-ttu-id="818bc-198">Пример кода</span><span class="sxs-lookup"><span data-stu-id="818bc-198">Code sample</span></span>

<span data-ttu-id="818bc-199">Hello [PersistOutputs] [ github_persistoutputs] образец проекта является одним из hello [образцы кода пакетной службы Azure] [ github_samples] на GitHub.</span><span class="sxs-lookup"><span data-stu-id="818bc-199">hello [PersistOutputs][github_persistoutputs] sample project is one of hello [Azure Batch code samples][github_samples] on GitHub.</span></span> <span data-ttu-id="818bc-200">Это решение Visual Studio показывает, как toouse hello пакета клиентская библиотека .NET toopersist задачи вывода toodurable хранилища.</span><span class="sxs-lookup"><span data-stu-id="818bc-200">This Visual Studio solution demonstrates how toouse hello Batch client library for .NET toopersist task output toodurable storage.</span></span> <span data-ttu-id="818bc-201">toorun hello образец, выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="818bc-201">toorun hello sample, follow these steps:</span></span>

1. <span data-ttu-id="818bc-202">Привет открыть проект в **Visual Studio 2015 или более новой версии**.</span><span class="sxs-lookup"><span data-stu-id="818bc-202">Open hello project in **Visual Studio 2015 or newer**.</span></span>
2. <span data-ttu-id="818bc-203">Добавить пакет и хранилища **учетные данные учетной записи** слишком**AccountSettings.settings** в проекте Microsoft.Azure.Batch.Samples.Common hello.</span><span class="sxs-lookup"><span data-stu-id="818bc-203">Add your Batch and Storage **account credentials** too**AccountSettings.settings** in hello Microsoft.Azure.Batch.Samples.Common project.</span></span>
3. <span data-ttu-id="818bc-204">**Построение** (но не запускайте) hello решения.</span><span class="sxs-lookup"><span data-stu-id="818bc-204">**Build** (but do not run) hello solution.</span></span> <span data-ttu-id="818bc-205">Восстановите необходимые пакеты NuGet в случае появления соответствующего запроса.</span><span class="sxs-lookup"><span data-stu-id="818bc-205">Restore any NuGet packages if prompted.</span></span>
4. <span data-ttu-id="818bc-206">Используйте hello Azure портала tooupload [пакета приложения](batch-application-packages.md) для **PersistOutputsTask**.</span><span class="sxs-lookup"><span data-stu-id="818bc-206">Use hello Azure portal tooupload an [application package](batch-application-packages.md) for **PersistOutputsTask**.</span></span> <span data-ttu-id="818bc-207">Включить hello `PersistOutputsTask.exe` и ее зависимые сборки в пакете .zip hello, идентификатор приложения hello набор слишком версии пакета «PersistOutputsTask» и приложение hello слишком «1.0».</span><span class="sxs-lookup"><span data-stu-id="818bc-207">Include hello `PersistOutputsTask.exe` and its dependent assemblies in hello .zip package, set hello application ID too"PersistOutputsTask", and hello application package version too"1.0".</span></span>
5. <span data-ttu-id="818bc-208">**Запуск** (выполнения) hello **PersistOutputs** проекта.</span><span class="sxs-lookup"><span data-stu-id="818bc-208">**Start** (run) hello **PersistOutputs** project.</span></span>
6. <span data-ttu-id="818bc-209">При вводе toouse технологии запрашиваемые toochoose hello сохраняемости для выполнения образца hello, **2** toorun hello выборке, используя выходные данные задачи toopersist hello API пакетной службы.</span><span class="sxs-lookup"><span data-stu-id="818bc-209">When prompted toochoose hello persistence technology toouse for running hello sample, enter **2** toorun hello sample using hello Batch service API toopersist task output.</span></span>
7. <span data-ttu-id="818bc-210">При желании образец hello снова запустить, введя **3** toopersist выходные данные с API-Интерфейс службы пакета hello и tooname hello контейнера и больших двоичных объектов путь назначения toohello стандартные соглашения файлов в соответствии с.</span><span class="sxs-lookup"><span data-stu-id="818bc-210">If desired, run hello sample again, entering **3** toopersist output with hello Batch service API, and also tooname hello destination container and blob path according toohello File Conventions standard.</span></span>

## <a name="next-steps"></a><span data-ttu-id="818bc-211">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="818bc-211">Next steps</span></span>

- <span data-ttu-id="818bc-212">Дополнительные сведения о сохранения выходных данных задачи с библиотекой hello файлов, принятых для .NET. в разделе [сохранения заданий и задач tooAzure данные хранилища с библиотекой hello пакетных файлов, принятых для .NET toopersist ](batch-task-output-file-conventions.md).</span><span class="sxs-lookup"><span data-stu-id="818bc-212">For more information on persisting task output with hello File Conventions library for .NET, see [Persist job and task data tooAzure Storage with hello Batch File Conventions library for .NET toopersist ](batch-task-output-file-conventions.md).</span></span>
- <span data-ttu-id="818bc-213">Сведения о других подходов для сохранения выходных данных в пакете Azure см. в разделе [Persist заданий и задач вывода tooAzure хранения](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="818bc-213">For information on other approaches for persisting output data in Azure Batch, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span>

[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs
[github_samples]: https://github.com/Azure/azure-batch-samples
