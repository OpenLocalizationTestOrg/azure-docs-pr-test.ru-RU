---
title: "Отслеживание хода выполнения задания путем подсчета задач по состоянию (пакетная служба Azure) | Документация Майкрософт"
description: "Отслеживайте ход выполнения задания путем вызова операции получения количества задач для подсчета задач для задания. Вы можете подсчитать число активных, выполняющихся, завершенных, успешно и неудачно выполненных задач."
services: batch
author: tamram
manager: timlt
ms.service: batch
ms.topic: article
ms.date: 08/02/2017
ms.author: tamram
ms.openlocfilehash: ceff59d7063b60a1344a47489d3d73e0e8ee07df
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="count-tasks-by-state-to-monitor-a-jobs-progress-preview"></a>Подсчет задач по состоянию для отслеживания хода выполнения задания (предварительная версия)

Пакетная служба Azure предоставляет эффективный способ отслеживания хода выполнения задания при выполнении задач. Вы можете вызвать операцию [Получить количество задач][rest_get_task_counts], чтобы узнать, сколько задач находятся в активном, выполняющемся или завершенном состоянии и сколько из них успешно или неудачно выполнены. Узнав количество задач в каждом из состояний, вы можете легко отобразить ход выполнения задания пользователю или обнаружить непредвиденные задержки или ошибки, которые могут повлиять на задание.

> [!IMPORTANT]
> Сейчас операция "Получить количество задач" находится на стадии предварительной версии и пока недоступна в Azure для государственных организаций, Китая и Германии. 
>
>

## <a name="how-tasks-are-counted"></a>Подсчет задач

Операция "Получить количество задач" подсчитывает задачи по состоянию следующим образом:

- Задача считается **активной**, если она находится в очереди и ее можно выполнить, но она еще не назначена вычислительному узлу. Задача также считается **активной**, если она зависит от родительской задачи, которая еще не завершена. Дополнительные сведения о зависимостях задач см. в статье [Создание зависимостей для выполнения задач, которые зависят от других задач](batch-task-dependencies.md). 
- Задача считается **выполняющейся**, если она назначена вычислительному узлу, но еще не завершена. Задача считается **выполняющейся**, если она находится в состоянии `preparing` или `running`, как указывает операция [Получение информации о задаче][rest_get_task].
- Задача считается **завершенной**, если ее невозможно выполнить. **Завершенные** задачи обычно завершились успешно или неудачно и исчерпали предел повторных попыток. 

Операция "Получить количество задач" также позволяет узнать, сколько задач завершились успешно или неудачно. Пакетная служба определяет, как именно завершилась задача (успешно или неудачно) путем проверки свойства **result** свойства [executionInfo] [https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-task#executionInfo]:

    - Задача считается **успешно выполненной**, если результатом выполнения задачи является состояние `success`.
    - Задача считается **неудачно выполненной**, если результатом выполнения задачи является состояние `failure`.

Дополнительные сведения о состояниях задачи см. в статье [Get information about a task][rest_get_task] (Получение сведений о задаче).

В следующем примере кода .NET показано, как получить число задач по состоянию: 

```csharp
var taskCounts = await batchClient.JobOperations.GetTaskCountsAsync("job-1");

Console.WriteLine("Task count in active state: {0}", taskCounts.Active);
Console.WriteLine("Task count in preparing or running state: {0}", taskCounts.Running);
Console.WriteLine("Task count in completed state: {0}", taskCounts.Completed);
Console.WriteLine("Succeeded task count: {0}", taskCounts.Succeeded);
Console.WriteLine("Failed task count: {0}", taskCounts.Failed);
Console.WriteLine("ValidationStatus: {0}", taskCounts.ValidationStatus);
```

> [!NOTE]
> Чтобы получить количество задач для задания, можно использовать аналогичный шаблон для REST и других поддерживаемых языков. 
> 
> 

## <a name="consistency-checking-for-task-counts"></a>Проверка согласованности количества задач

Пакетная служба вычисляет число задач путем сбора данных из нескольких областей асинхронной распределенной системы. Для проверки правильности количества задач пакетная служба предоставляет дополнительную проверку количества по состоянию, выполняя проверку согласованности по нескольким системным компонентам. Пакетная служба выполняет эти проверки согласованности, если в задании имеется не более 200 000 задач. Маловероятно, что при проверке согласованности будут обнаружены ошибки. Пакетная служба исправляет результат операции "Получить количество задач" на основе результатов проверки согласованности. Проверка согласованности — это дополнительная мера, которая позволяет обеспечить правильность сведений, необходимых для решения, которые клиенты получают при выполнении операции "Получить количество задач".

Свойство **validationStatus** в ответе указывает, выполнила ли пакетная служба проверку согласованности. Если пакетной службе не удалось сопоставить количество по состоянию с фактическим состоянием в системе, для свойства **validationStatus** задается значение `unvalidated`. Из соображений производительности пакетная служба не будет выполнять проверку согласованности, если задание включает более 200 000 задач. В этом случае для свойства **validationStatus** может быть задано значение `unvalidated`. Тем не менее в такой ситуации число задач не обязательно неправильное, так как даже потеря малого объема данных крайне маловероятна. 

При изменении состояния задачи конвейер агрегирования обрабатывает изменение в течение нескольких секунд. Операция "Получить количество задач" отражает обновленное количество задач за указанный период. Однако если конвейер агрегирования пропускает изменение состояния задачи, такое изменение не регистрируется до следующей проверки. В течение этого времени количество задач может быть немного неточным из-за пропущенного события, но оно будет исправлено при следующей проверке.

## <a name="best-practices-for-counting-a-jobs-tasks"></a>Рекомендации по подсчету задач задания

Вызов операции "Получить количество задач" — самый эффективный способ получения базового количества заданий задачи по состоянию. Если вы используете версию пакетной службы 2017-06-01.5.1, мы рекомендуем написать или обновить код для использования операции "Получить количество задач".

Операция получения количества задач недоступна в версиях пакетной службы до 2017-06-01.5.1. Если вы используете более старую версию службы, используйте запрос списка для подсчета задач в задании. Дополнительные сведения см. в статье [Эффективное создание запросов на вывод списка ресурсов пакетной службы](batch-efficient-list-queries.md).

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об основных понятиях и функциях пакетной службы см. в статье [Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы](batch-api-basics.md). В этой статье рассматриваются основные ресурсы пакетной службы, такие как пулы, вычислительные узлы, задания и задачи, а также приведены общие сведения о функциях этой службы.
* Здесь приведены основные сведения о разработке приложений с поддержкой пакетной службы с помощью [клиентской библиотеки .NET для пакетной службы](batch-dotnet-get-started.md) или [Python](batch-python-tutorial.md). В этой вводной статье рассматривается рабочее приложение, которое использует пакетную службу для выполнения рабочей нагрузки.


[rest_get_task_counts]: https://docs.microsoft.com/rest/api/batchservice/get-the-task-counts-for-a-job
[rest_get_task]: https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-task
[rest_list_tasks]: https://docs.microsoft.com/rest/api/batchservice/list-the-tasks-associated-with-a-job
